<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html" class="current">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4233424">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4233479">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4233533">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4233584">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4233663">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4233689">package</span>&nbsp;<span class="ident" id="4233697">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4233704">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4233719">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4233774">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4233820">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4233844">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4233901">import</span>&nbsp;<span class="op" id="4233908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4233911">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4233921">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4233940">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4233957">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4233963">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4233974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4233977">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4234022">type</span>&nbsp;<span class="ident" id="4234027">PublicKey</span>&nbsp;<span class="keyword" id="4234037">struct</span>&nbsp;<span class="op" id="4234044">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234047">elliptic</span><span class="op" id="4234055">.</span><span class="ident" id="4234056">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234063">X</span><span class="op" id="4234064">,</span>&nbsp;<span class="ident" id="4234066">Y</span>&nbsp;<span class="op" id="4234068">*</span><span class="ident" id="4234069">big</span><span class="op" id="4234072">.</span><span class="ident" id="4234073">Int</span><br>
<span class="lineno"></span><span class="op" id="4234077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4234080">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4234126">type</span>&nbsp;<span class="ident" id="4234131">PrivateKey</span>&nbsp;<span class="keyword" id="4234142">struct</span>&nbsp;<span class="op" id="4234149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234152">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234163">D</span>&nbsp;<span class="op" id="4234165">*</span><span class="ident" id="4234166">big</span><span class="op" id="4234169">.</span><span class="ident" id="4234170">Int</span><br>
<span class="lineno"></span><span class="op" id="4234174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4234177">type</span>&nbsp;<span class="ident" id="4234182">ecdsaSignature</span>&nbsp;<span class="keyword" id="4234197">struct</span>&nbsp;<span class="op" id="4234204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234207">R</span><span class="op" id="4234208">,</span>&nbsp;<span class="ident" id="4234210">S</span>&nbsp;<span class="op" id="4234212">*</span><span class="ident" id="4234213">big</span><span class="op" id="4234216">.</span><span class="ident" id="4234217">Int</span><br>
<span class="lineno"></span><span class="op" id="4234221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4234224">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4234280">func</span>&nbsp;<span class="op" id="4234285">(</span><span class="ident" id="4234286">priv</span>&nbsp;<span class="op" id="4234291">*</span><span class="ident" id="4234292">PrivateKey</span><span class="op" id="4234302">)</span>&nbsp;<span class="ident" id="4234304">Public</span><span class="op" id="4234310">(</span><span class="op" id="4234311">)</span>&nbsp;<span class="ident" id="4234313">crypto</span><span class="op" id="4234319">.</span><span class="ident" id="4234320">PublicKey</span>&nbsp;<span class="op" id="4234330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234333">return</span>&nbsp;<span class="op" id="4234340">&amp;</span><span class="ident" id="4234341">priv</span><span class="op" id="4234345">.</span><span class="ident" id="4234346">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4234356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4234359">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4234433">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4234511">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4234588">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4234601">func</span>&nbsp;<span class="op" id="4234606">(</span><span class="ident" id="4234607">priv</span>&nbsp;<span class="op" id="4234612">*</span><span class="ident" id="4234613">PrivateKey</span><span class="op" id="4234623">)</span>&nbsp;<span class="ident" id="4234625">Sign</span><span class="op" id="4234629">(</span><span class="ident" id="4234630">rand</span>&nbsp;<span class="ident" id="4234635">io</span><span class="op" id="4234637">.</span><span class="ident" id="4234638">Reader</span><span class="op" id="4234644">,</span>&nbsp;<span class="ident" id="4234646">msg</span>&nbsp;<span class="op" id="4234650">[</span><span class="op" id="4234651">]</span><span class="builtintype" id="4234652">byte</span><span class="op" id="4234656">,</span>&nbsp;<span class="ident" id="4234658">opts</span>&nbsp;<span class="ident" id="4234663">crypto</span><span class="op" id="4234669">.</span><span class="ident" id="4234670">SignerOpts</span><span class="op" id="4234680">)</span>&nbsp;<span class="op" id="4234682">(</span><span class="op" id="4234683">[</span><span class="op" id="4234684">]</span><span class="builtintype" id="4234685">byte</span><span class="op" id="4234689">,</span>&nbsp;<span class="builtintype" id="4234691">error</span><span class="op" id="4234696">)</span>&nbsp;<span class="op" id="4234698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4234701">r</span><span class="op" id="4234702">,</span>&nbsp;<span class="ident" id="4234704">s</span><span class="op" id="4234705">,</span>&nbsp;<span class="ident" id="4234707">err</span>&nbsp;<span class="op" id="4234711">:=</span>&nbsp;<span class="ident" id="4234714">Sign</span><span class="op" id="4234718">(</span><span class="ident" id="4234719">rand</span><span class="op" id="4234723">,</span>&nbsp;<span class="ident" id="4234725">priv</span><span class="op" id="4234729">,</span>&nbsp;<span class="ident" id="4234731">msg</span><span class="op" id="4234734">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234737">if</span>&nbsp;<span class="ident" id="4234740">err</span>&nbsp;<span class="op" id="4234744">!=</span>&nbsp;<span class="ident" id="4234747">nil</span>&nbsp;<span class="op" id="4234751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234755">return</span>&nbsp;<span class="ident" id="4234762">nil</span><span class="op" id="4234765">,</span>&nbsp;<span class="ident" id="4234767">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4234772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4234776">return</span>&nbsp;<span class="ident" id="4234783">asn1</span><span class="op" id="4234787">.</span><span class="ident" id="4234788">Marshal</span><span class="op" id="4234795">(</span><span class="ident" id="4234796">ecdsaSignature</span><span class="op" id="4234810">{</span><span class="ident" id="4234811">r</span><span class="op" id="4234812">,</span>&nbsp;<span class="ident" id="4234814">s</span><span class="op" id="4234815">}</span><span class="op" id="4234816">)</span><br>
<span class="lineno">55</span><span class="op" id="4234818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4234821">var</span>&nbsp;<span class="ident" id="4234825">one</span>&nbsp;<span class="op" id="4234829">=</span>&nbsp;<span class="builtinfunc" id="4234831">new</span><span class="op" id="4234834">(</span><span class="ident" id="4234835">big</span><span class="op" id="4234838">.</span><span class="ident" id="4234839">Int</span><span class="op" id="4234842">)</span><span class="op" id="4234843">.</span><span class="ident" id="4234844">SetInt64</span><span class="op" id="4234852">(</span><span class="num" id="4234853">1</span><span class="op" id="4234854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4234857">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4234936">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4234987">func</span>&nbsp;<span class="ident" id="4234992">randFieldElement</span><span class="op" id="4235008">(</span><span class="ident" id="4235009">c</span>&nbsp;<span class="ident" id="4235011">elliptic</span><span class="op" id="4235019">.</span><span class="ident" id="4235020">Curve</span><span class="op" id="4235025">,</span>&nbsp;<span class="ident" id="4235027">rand</span>&nbsp;<span class="ident" id="4235032">io</span><span class="op" id="4235034">.</span><span class="ident" id="4235035">Reader</span><span class="op" id="4235041">)</span>&nbsp;<span class="op" id="4235043">(</span><span class="ident" id="4235044">k</span>&nbsp;<span class="op" id="4235046">*</span><span class="ident" id="4235047">big</span><span class="op" id="4235050">.</span><span class="ident" id="4235051">Int</span><span class="op" id="4235054">,</span>&nbsp;<span class="ident" id="4235056">err</span>&nbsp;<span class="builtintype" id="4235060">error</span><span class="op" id="4235065">)</span>&nbsp;<span class="op" id="4235067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235070">params</span>&nbsp;<span class="op" id="4235077">:=</span>&nbsp;<span class="ident" id="4235080">c</span><span class="op" id="4235081">.</span><span class="ident" id="4235082">Params</span><span class="op" id="4235088">(</span><span class="op" id="4235089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235092">b</span>&nbsp;<span class="op" id="4235094">:=</span>&nbsp;<span class="builtinfunc" id="4235097">make</span><span class="op" id="4235101">(</span><span class="op" id="4235102">[</span><span class="op" id="4235103">]</span><span class="builtintype" id="4235104">byte</span><span class="op" id="4235108">,</span>&nbsp;<span class="ident" id="4235110">params</span><span class="op" id="4235116">.</span><span class="ident" id="4235117">BitSize</span><span class="op" id="4235124">/</span><span class="num" id="4235125">8</span><span class="op" id="4235126">+</span><span class="num" id="4235127">8</span><span class="op" id="4235128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235131">_</span><span class="op" id="4235132">,</span>&nbsp;<span class="ident" id="4235134">err</span>&nbsp;<span class="op" id="4235138">=</span>&nbsp;<span class="ident" id="4235140">io</span><span class="op" id="4235142">.</span><span class="ident" id="4235143">ReadFull</span><span class="op" id="4235151">(</span><span class="ident" id="4235152">rand</span><span class="op" id="4235156">,</span>&nbsp;<span class="ident" id="4235158">b</span><span class="op" id="4235159">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235162">if</span>&nbsp;<span class="ident" id="4235165">err</span>&nbsp;<span class="op" id="4235169">!=</span>&nbsp;<span class="ident" id="4235172">nil</span>&nbsp;<span class="op" id="4235176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235192">k</span>&nbsp;<span class="op" id="4235194">=</span>&nbsp;<span class="builtinfunc" id="4235196">new</span><span class="op" id="4235199">(</span><span class="ident" id="4235200">big</span><span class="op" id="4235203">.</span><span class="ident" id="4235204">Int</span><span class="op" id="4235207">)</span><span class="op" id="4235208">.</span><span class="ident" id="4235209">SetBytes</span><span class="op" id="4235217">(</span><span class="ident" id="4235218">b</span><span class="op" id="4235219">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235222">n</span>&nbsp;<span class="op" id="4235224">:=</span>&nbsp;<span class="builtinfunc" id="4235227">new</span><span class="op" id="4235230">(</span><span class="ident" id="4235231">big</span><span class="op" id="4235234">.</span><span class="ident" id="4235235">Int</span><span class="op" id="4235238">)</span><span class="op" id="4235239">.</span><span class="ident" id="4235240">Sub</span><span class="op" id="4235243">(</span><span class="ident" id="4235244">params</span><span class="op" id="4235250">.</span><span class="ident" id="4235251">N</span><span class="op" id="4235252">,</span>&nbsp;<span class="ident" id="4235254">one</span><span class="op" id="4235257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235260">k</span><span class="op" id="4235261">.</span><span class="ident" id="4235262">Mod</span><span class="op" id="4235265">(</span><span class="ident" id="4235266">k</span><span class="op" id="4235267">,</span>&nbsp;<span class="ident" id="4235269">n</span><span class="op" id="4235270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235273">k</span><span class="op" id="4235274">.</span><span class="ident" id="4235275">Add</span><span class="op" id="4235278">(</span><span class="ident" id="4235279">k</span><span class="op" id="4235280">,</span>&nbsp;<span class="ident" id="4235282">one</span><span class="op" id="4235285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235288">return</span><br>
<span class="lineno"></span><span class="op" id="4235295">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4235298">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4235354">func</span>&nbsp;<span class="ident" id="4235359">GenerateKey</span><span class="op" id="4235370">(</span><span class="ident" id="4235371">c</span>&nbsp;<span class="ident" id="4235373">elliptic</span><span class="op" id="4235381">.</span><span class="ident" id="4235382">Curve</span><span class="op" id="4235387">,</span>&nbsp;<span class="ident" id="4235389">rand</span>&nbsp;<span class="ident" id="4235394">io</span><span class="op" id="4235396">.</span><span class="ident" id="4235397">Reader</span><span class="op" id="4235403">)</span>&nbsp;<span class="op" id="4235405">(</span><span class="ident" id="4235406">priv</span>&nbsp;<span class="op" id="4235411">*</span><span class="ident" id="4235412">PrivateKey</span><span class="op" id="4235422">,</span>&nbsp;<span class="ident" id="4235424">err</span>&nbsp;<span class="builtintype" id="4235428">error</span><span class="op" id="4235433">)</span>&nbsp;<span class="op" id="4235435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235438">k</span><span class="op" id="4235439">,</span>&nbsp;<span class="ident" id="4235441">err</span>&nbsp;<span class="op" id="4235445">:=</span>&nbsp;<span class="ident" id="4235448">randFieldElement</span><span class="op" id="4235464">(</span><span class="ident" id="4235465">c</span><span class="op" id="4235466">,</span>&nbsp;<span class="ident" id="4235468">rand</span><span class="op" id="4235472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235475">if</span>&nbsp;<span class="ident" id="4235478">err</span>&nbsp;<span class="op" id="4235482">!=</span>&nbsp;<span class="ident" id="4235485">nil</span>&nbsp;<span class="op" id="4235489">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235493">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4235501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235505">priv</span>&nbsp;<span class="op" id="4235510">=</span>&nbsp;<span class="builtinfunc" id="4235512">new</span><span class="op" id="4235515">(</span><span class="ident" id="4235516">PrivateKey</span><span class="op" id="4235526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235529">priv</span><span class="op" id="4235533">.</span><span class="ident" id="4235534">PublicKey</span><span class="op" id="4235543">.</span><span class="ident" id="4235544">Curve</span>&nbsp;<span class="op" id="4235550">=</span>&nbsp;<span class="ident" id="4235552">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235555">priv</span><span class="op" id="4235559">.</span><span class="ident" id="4235560">D</span>&nbsp;<span class="op" id="4235562">=</span>&nbsp;<span class="ident" id="4235564">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4235567">priv</span><span class="op" id="4235571">.</span><span class="ident" id="4235572">PublicKey</span><span class="op" id="4235581">.</span><span class="ident" id="4235582">X</span><span class="op" id="4235583">,</span>&nbsp;<span class="ident" id="4235585">priv</span><span class="op" id="4235589">.</span><span class="ident" id="4235590">PublicKey</span><span class="op" id="4235599">.</span><span class="ident" id="4235600">Y</span>&nbsp;<span class="op" id="4235602">=</span>&nbsp;<span class="ident" id="4235604">c</span><span class="op" id="4235605">.</span><span class="ident" id="4235606">ScalarBaseMult</span><span class="op" id="4235620">(</span><span class="ident" id="4235621">k</span><span class="op" id="4235622">.</span><span class="ident" id="4235623">Bytes</span><span class="op" id="4235628">(</span><span class="op" id="4235629">)</span><span class="op" id="4235630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4235633">return</span><br>
<span class="lineno"></span><span class="op" id="4235640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4235643">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4235720">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4235795">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4235873">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4235948">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4236025">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4236052">func</span>&nbsp;<span class="ident" id="4236057">hashToInt</span><span class="op" id="4236066">(</span><span class="ident" id="4236067">hash</span>&nbsp;<span class="op" id="4236072">[</span><span class="op" id="4236073">]</span><span class="builtintype" id="4236074">byte</span><span class="op" id="4236078">,</span>&nbsp;<span class="ident" id="4236080">c</span>&nbsp;<span class="ident" id="4236082">elliptic</span><span class="op" id="4236090">.</span><span class="ident" id="4236091">Curve</span><span class="op" id="4236096">)</span>&nbsp;<span class="op" id="4236098">*</span><span class="ident" id="4236099">big</span><span class="op" id="4236102">.</span><span class="ident" id="4236103">Int</span>&nbsp;<span class="op" id="4236107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236110">orderBits</span>&nbsp;<span class="op" id="4236120">:=</span>&nbsp;<span class="ident" id="4236123">c</span><span class="op" id="4236124">.</span><span class="ident" id="4236125">Params</span><span class="op" id="4236131">(</span><span class="op" id="4236132">)</span><span class="op" id="4236133">.</span><span class="ident" id="4236134">N</span><span class="op" id="4236135">.</span><span class="ident" id="4236136">BitLen</span><span class="op" id="4236142">(</span><span class="op" id="4236143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236146">orderBytes</span>&nbsp;<span class="op" id="4236157">:=</span>&nbsp;<span class="op" id="4236160">(</span><span class="ident" id="4236161">orderBits</span>&nbsp;<span class="op" id="4236171">+</span>&nbsp;<span class="num" id="4236173">7</span><span class="op" id="4236174">)</span>&nbsp;<span class="op" id="4236176">/</span>&nbsp;<span class="num" id="4236178">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236181">if</span>&nbsp;<span class="builtinfunc" id="4236184">len</span><span class="op" id="4236187">(</span><span class="ident" id="4236188">hash</span><span class="op" id="4236192">)</span>&nbsp;<span class="op" id="4236194">&gt;</span>&nbsp;<span class="ident" id="4236196">orderBytes</span>&nbsp;<span class="op" id="4236207">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236211">hash</span>&nbsp;<span class="op" id="4236216">=</span>&nbsp;<span class="ident" id="4236218">hash</span><span class="op" id="4236222">[</span><span class="op" id="4236223">:</span><span class="ident" id="4236224">orderBytes</span><span class="op" id="4236234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236241">ret</span>&nbsp;<span class="op" id="4236245">:=</span>&nbsp;<span class="builtinfunc" id="4236248">new</span><span class="op" id="4236251">(</span><span class="ident" id="4236252">big</span><span class="op" id="4236255">.</span><span class="ident" id="4236256">Int</span><span class="op" id="4236259">)</span><span class="op" id="4236260">.</span><span class="ident" id="4236261">SetBytes</span><span class="op" id="4236269">(</span><span class="ident" id="4236270">hash</span><span class="op" id="4236274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236277">excess</span>&nbsp;<span class="op" id="4236284">:=</span>&nbsp;<span class="builtinfunc" id="4236287">len</span><span class="op" id="4236290">(</span><span class="ident" id="4236291">hash</span><span class="op" id="4236295">)</span><span class="op" id="4236296">*</span><span class="num" id="4236297">8</span>&nbsp;<span class="op" id="4236299">-</span>&nbsp;<span class="ident" id="4236301">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236312">if</span>&nbsp;<span class="ident" id="4236315">excess</span>&nbsp;<span class="op" id="4236322">&gt;</span>&nbsp;<span class="num" id="4236324">0</span>&nbsp;<span class="op" id="4236326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236330">ret</span><span class="op" id="4236333">.</span><span class="ident" id="4236334">Rsh</span><span class="op" id="4236337">(</span><span class="ident" id="4236338">ret</span><span class="op" id="4236341">,</span>&nbsp;<span class="builtintype" id="4236343">uint</span><span class="op" id="4236347">(</span><span class="ident" id="4236348">excess</span><span class="op" id="4236354">)</span><span class="op" id="4236355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4236358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236361">return</span>&nbsp;<span class="ident" id="4236368">ret</span><br>
<span class="lineno"></span><span class="op" id="4236372">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4236375">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4236452">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4236530">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4236601">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4236639">func</span>&nbsp;<span class="ident" id="4236644">fermatInverse</span><span class="op" id="4236657">(</span><span class="ident" id="4236658">k</span><span class="op" id="4236659">,</span>&nbsp;<span class="ident" id="4236661">N</span>&nbsp;<span class="op" id="4236663">*</span><span class="ident" id="4236664">big</span><span class="op" id="4236667">.</span><span class="ident" id="4236668">Int</span><span class="op" id="4236671">)</span>&nbsp;<span class="op" id="4236673">*</span><span class="ident" id="4236674">big</span><span class="op" id="4236677">.</span><span class="ident" id="4236678">Int</span>&nbsp;<span class="op" id="4236682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236685">two</span>&nbsp;<span class="op" id="4236689">:=</span>&nbsp;<span class="ident" id="4236692">big</span><span class="op" id="4236695">.</span><span class="ident" id="4236696">NewInt</span><span class="op" id="4236702">(</span><span class="num" id="4236703">2</span><span class="op" id="4236704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4236707">nMinus2</span>&nbsp;<span class="op" id="4236715">:=</span>&nbsp;<span class="builtinfunc" id="4236718">new</span><span class="op" id="4236721">(</span><span class="ident" id="4236722">big</span><span class="op" id="4236725">.</span><span class="ident" id="4236726">Int</span><span class="op" id="4236729">)</span><span class="op" id="4236730">.</span><span class="ident" id="4236731">Sub</span><span class="op" id="4236734">(</span><span class="ident" id="4236735">N</span><span class="op" id="4236736">,</span>&nbsp;<span class="ident" id="4236738">two</span><span class="op" id="4236741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4236744">return</span>&nbsp;<span class="builtinfunc" id="4236751">new</span><span class="op" id="4236754">(</span><span class="ident" id="4236755">big</span><span class="op" id="4236758">.</span><span class="ident" id="4236759">Int</span><span class="op" id="4236762">)</span><span class="op" id="4236763">.</span><span class="ident" id="4236764">Exp</span><span class="op" id="4236767">(</span><span class="ident" id="4236768">k</span><span class="op" id="4236769">,</span>&nbsp;<span class="ident" id="4236771">nMinus2</span><span class="op" id="4236778">,</span>&nbsp;<span class="ident" id="4236780">N</span><span class="op" id="4236781">)</span><br>
<span class="lineno"></span><span class="op" id="4236783">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4236786">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4236866">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4236944">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4237023">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4237032">func</span>&nbsp;<span class="ident" id="4237037">Sign</span><span class="op" id="4237041">(</span><span class="ident" id="4237042">rand</span>&nbsp;<span class="ident" id="4237047">io</span><span class="op" id="4237049">.</span><span class="ident" id="4237050">Reader</span><span class="op" id="4237056">,</span>&nbsp;<span class="ident" id="4237058">priv</span>&nbsp;<span class="op" id="4237063">*</span><span class="ident" id="4237064">PrivateKey</span><span class="op" id="4237074">,</span>&nbsp;<span class="ident" id="4237076">hash</span>&nbsp;<span class="op" id="4237081">[</span><span class="op" id="4237082">]</span><span class="builtintype" id="4237083">byte</span><span class="op" id="4237087">)</span>&nbsp;<span class="op" id="4237089">(</span><span class="ident" id="4237090">r</span><span class="op" id="4237091">,</span>&nbsp;<span class="ident" id="4237093">s</span>&nbsp;<span class="op" id="4237095">*</span><span class="ident" id="4237096">big</span><span class="op" id="4237099">.</span><span class="ident" id="4237100">Int</span><span class="op" id="4237103">,</span>&nbsp;<span class="ident" id="4237105">err</span>&nbsp;<span class="builtintype" id="4237109">error</span><span class="op" id="4237114">)</span>&nbsp;<span class="op" id="4237116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237119">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237139">c</span>&nbsp;<span class="op" id="4237141">:=</span>&nbsp;<span class="ident" id="4237144">priv</span><span class="op" id="4237148">.</span><span class="ident" id="4237149">PublicKey</span><span class="op" id="4237158">.</span><span class="ident" id="4237159">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237166">N</span>&nbsp;<span class="op" id="4237168">:=</span>&nbsp;<span class="ident" id="4237171">c</span><span class="op" id="4237172">.</span><span class="ident" id="4237173">Params</span><span class="op" id="4237179">(</span><span class="op" id="4237180">)</span><span class="op" id="4237181">.</span><span class="ident" id="4237182">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237186">var</span>&nbsp;<span class="ident" id="4237190">k</span><span class="op" id="4237191">,</span>&nbsp;<span class="ident" id="4237193">kInv</span>&nbsp;<span class="op" id="4237198">*</span><span class="ident" id="4237199">big</span><span class="op" id="4237202">.</span><span class="ident" id="4237203">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237208">for</span>&nbsp;<span class="op" id="4237212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237216">for</span>&nbsp;<span class="op" id="4237220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237225">k</span><span class="op" id="4237226">,</span>&nbsp;<span class="ident" id="4237228">err</span>&nbsp;<span class="op" id="4237232">=</span>&nbsp;<span class="ident" id="4237234">randFieldElement</span><span class="op" id="4237250">(</span><span class="ident" id="4237251">c</span><span class="op" id="4237252">,</span>&nbsp;<span class="ident" id="4237254">rand</span><span class="op" id="4237258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237263">if</span>&nbsp;<span class="ident" id="4237266">err</span>&nbsp;<span class="op" id="4237270">!=</span>&nbsp;<span class="ident" id="4237273">nil</span>&nbsp;<span class="op" id="4237277">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237283">r</span>&nbsp;<span class="op" id="4237285">=</span>&nbsp;<span class="ident" id="4237287">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237295">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237311">kInv</span>&nbsp;<span class="op" id="4237316">=</span>&nbsp;<span class="ident" id="4237318">fermatInverse</span><span class="op" id="4237331">(</span><span class="ident" id="4237332">k</span><span class="op" id="4237333">,</span>&nbsp;<span class="ident" id="4237335">N</span><span class="op" id="4237336">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237341">r</span><span class="op" id="4237342">,</span>&nbsp;<span class="ident" id="4237344">_</span>&nbsp;<span class="op" id="4237346">=</span>&nbsp;<span class="ident" id="4237348">priv</span><span class="op" id="4237352">.</span><span class="ident" id="4237353">Curve</span><span class="op" id="4237358">.</span><span class="ident" id="4237359">ScalarBaseMult</span><span class="op" id="4237373">(</span><span class="ident" id="4237374">k</span><span class="op" id="4237375">.</span><span class="ident" id="4237376">Bytes</span><span class="op" id="4237381">(</span><span class="op" id="4237382">)</span><span class="op" id="4237383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237388">r</span><span class="op" id="4237389">.</span><span class="ident" id="4237390">Mod</span><span class="op" id="4237393">(</span><span class="ident" id="4237394">r</span><span class="op" id="4237395">,</span>&nbsp;<span class="ident" id="4237397">N</span><span class="op" id="4237398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237403">if</span>&nbsp;<span class="ident" id="4237406">r</span><span class="op" id="4237407">.</span><span class="ident" id="4237408">Sign</span><span class="op" id="4237412">(</span><span class="op" id="4237413">)</span>&nbsp;<span class="op" id="4237415">!=</span>&nbsp;<span class="num" id="4237418">0</span>&nbsp;<span class="op" id="4237420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237426">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237435">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237444">e</span>&nbsp;<span class="op" id="4237446">:=</span>&nbsp;<span class="ident" id="4237449">hashToInt</span><span class="op" id="4237458">(</span><span class="ident" id="4237459">hash</span><span class="op" id="4237463">,</span>&nbsp;<span class="ident" id="4237465">c</span><span class="op" id="4237466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237470">s</span>&nbsp;<span class="op" id="4237472">=</span>&nbsp;<span class="builtinfunc" id="4237474">new</span><span class="op" id="4237477">(</span><span class="ident" id="4237478">big</span><span class="op" id="4237481">.</span><span class="ident" id="4237482">Int</span><span class="op" id="4237485">)</span><span class="op" id="4237486">.</span><span class="ident" id="4237487">Mul</span><span class="op" id="4237490">(</span><span class="ident" id="4237491">priv</span><span class="op" id="4237495">.</span><span class="ident" id="4237496">D</span><span class="op" id="4237497">,</span>&nbsp;<span class="ident" id="4237499">r</span><span class="op" id="4237500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237504">s</span><span class="op" id="4237505">.</span><span class="ident" id="4237506">Add</span><span class="op" id="4237509">(</span><span class="ident" id="4237510">s</span><span class="op" id="4237511">,</span>&nbsp;<span class="ident" id="4237513">e</span><span class="op" id="4237514">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237518">s</span><span class="op" id="4237519">.</span><span class="ident" id="4237520">Mul</span><span class="op" id="4237523">(</span><span class="ident" id="4237524">s</span><span class="op" id="4237525">,</span>&nbsp;<span class="ident" id="4237527">kInv</span><span class="op" id="4237531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237535">s</span><span class="op" id="4237536">.</span><span class="ident" id="4237537">Mod</span><span class="op" id="4237540">(</span><span class="ident" id="4237541">s</span><span class="op" id="4237542">,</span>&nbsp;<span class="ident" id="4237544">N</span><span class="op" id="4237545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237549">if</span>&nbsp;<span class="ident" id="4237552">s</span><span class="op" id="4237553">.</span><span class="ident" id="4237554">Sign</span><span class="op" id="4237558">(</span><span class="op" id="4237559">)</span>&nbsp;<span class="op" id="4237561">!=</span>&nbsp;<span class="num" id="4237564">0</span>&nbsp;<span class="op" id="4237566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237571">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237579">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237586">return</span><br>
<span class="lineno"></span><span class="op" id="4237593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4237596">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4237676">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4237732">func</span>&nbsp;<span class="ident" id="4237737">Verify</span><span class="op" id="4237743">(</span><span class="ident" id="4237744">pub</span>&nbsp;<span class="op" id="4237748">*</span><span class="ident" id="4237749">PublicKey</span><span class="op" id="4237758">,</span>&nbsp;<span class="ident" id="4237760">hash</span>&nbsp;<span class="op" id="4237765">[</span><span class="op" id="4237766">]</span><span class="builtintype" id="4237767">byte</span><span class="op" id="4237771">,</span>&nbsp;<span class="ident" id="4237773">r</span><span class="op" id="4237774">,</span>&nbsp;<span class="ident" id="4237776">s</span>&nbsp;<span class="op" id="4237778">*</span><span class="ident" id="4237779">big</span><span class="op" id="4237782">.</span><span class="ident" id="4237783">Int</span><span class="op" id="4237786">)</span>&nbsp;<span class="builtintype" id="4237788">bool</span>&nbsp;<span class="op" id="4237793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4237796">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237816">c</span>&nbsp;<span class="op" id="4237818">:=</span>&nbsp;<span class="ident" id="4237821">pub</span><span class="op" id="4237824">.</span><span class="ident" id="4237825">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237832">N</span>&nbsp;<span class="op" id="4237834">:=</span>&nbsp;<span class="ident" id="4237837">c</span><span class="op" id="4237838">.</span><span class="ident" id="4237839">Params</span><span class="op" id="4237845">(</span><span class="op" id="4237846">)</span><span class="op" id="4237847">.</span><span class="ident" id="4237848">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237852">if</span>&nbsp;<span class="ident" id="4237855">r</span><span class="op" id="4237856">.</span><span class="ident" id="4237857">Sign</span><span class="op" id="4237861">(</span><span class="op" id="4237862">)</span>&nbsp;<span class="op" id="4237864">==</span>&nbsp;<span class="num" id="4237867">0</span>&nbsp;<span class="op" id="4237869">||</span>&nbsp;<span class="ident" id="4237872">s</span><span class="op" id="4237873">.</span><span class="ident" id="4237874">Sign</span><span class="op" id="4237878">(</span><span class="op" id="4237879">)</span>&nbsp;<span class="op" id="4237881">==</span>&nbsp;<span class="num" id="4237884">0</span>&nbsp;<span class="op" id="4237886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237890">return</span>&nbsp;<span class="builtintype" id="4237897">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237904">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237907">if</span>&nbsp;<span class="ident" id="4237910">r</span><span class="op" id="4237911">.</span><span class="ident" id="4237912">Cmp</span><span class="op" id="4237915">(</span><span class="ident" id="4237916">N</span><span class="op" id="4237917">)</span>&nbsp;<span class="op" id="4237919">&gt;=</span>&nbsp;<span class="num" id="4237922">0</span>&nbsp;<span class="op" id="4237924">||</span>&nbsp;<span class="ident" id="4237927">s</span><span class="op" id="4237928">.</span><span class="ident" id="4237929">Cmp</span><span class="op" id="4237932">(</span><span class="ident" id="4237933">N</span><span class="op" id="4237934">)</span>&nbsp;<span class="op" id="4237936">&gt;=</span>&nbsp;<span class="num" id="4237939">0</span>&nbsp;<span class="op" id="4237941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4237945">return</span>&nbsp;<span class="builtintype" id="4237952">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4237959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237962">e</span>&nbsp;<span class="op" id="4237964">:=</span>&nbsp;<span class="ident" id="4237967">hashToInt</span><span class="op" id="4237976">(</span><span class="ident" id="4237977">hash</span><span class="op" id="4237981">,</span>&nbsp;<span class="ident" id="4237983">c</span><span class="op" id="4237984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4237987">w</span>&nbsp;<span class="op" id="4237989">:=</span>&nbsp;<span class="builtinfunc" id="4237992">new</span><span class="op" id="4237995">(</span><span class="ident" id="4237996">big</span><span class="op" id="4237999">.</span><span class="ident" id="4238000">Int</span><span class="op" id="4238003">)</span><span class="op" id="4238004">.</span><span class="ident" id="4238005">ModInverse</span><span class="op" id="4238015">(</span><span class="ident" id="4238016">s</span><span class="op" id="4238017">,</span>&nbsp;<span class="ident" id="4238019">N</span><span class="op" id="4238020">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238024">u1</span>&nbsp;<span class="op" id="4238027">:=</span>&nbsp;<span class="ident" id="4238030">e</span><span class="op" id="4238031">.</span><span class="ident" id="4238032">Mul</span><span class="op" id="4238035">(</span><span class="ident" id="4238036">e</span><span class="op" id="4238037">,</span>&nbsp;<span class="ident" id="4238039">w</span><span class="op" id="4238040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238043">u1</span><span class="op" id="4238045">.</span><span class="ident" id="4238046">Mod</span><span class="op" id="4238049">(</span><span class="ident" id="4238050">u1</span><span class="op" id="4238052">,</span>&nbsp;<span class="ident" id="4238054">N</span><span class="op" id="4238055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238058">u2</span>&nbsp;<span class="op" id="4238061">:=</span>&nbsp;<span class="ident" id="4238064">w</span><span class="op" id="4238065">.</span><span class="ident" id="4238066">Mul</span><span class="op" id="4238069">(</span><span class="ident" id="4238070">r</span><span class="op" id="4238071">,</span>&nbsp;<span class="ident" id="4238073">w</span><span class="op" id="4238074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238077">u2</span><span class="op" id="4238079">.</span><span class="ident" id="4238080">Mod</span><span class="op" id="4238083">(</span><span class="ident" id="4238084">u2</span><span class="op" id="4238086">,</span>&nbsp;<span class="ident" id="4238088">N</span><span class="op" id="4238089">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238093">x1</span><span class="op" id="4238095">,</span>&nbsp;<span class="ident" id="4238097">y1</span>&nbsp;<span class="op" id="4238100">:=</span>&nbsp;<span class="ident" id="4238103">c</span><span class="op" id="4238104">.</span><span class="ident" id="4238105">ScalarBaseMult</span><span class="op" id="4238119">(</span><span class="ident" id="4238120">u1</span><span class="op" id="4238122">.</span><span class="ident" id="4238123">Bytes</span><span class="op" id="4238128">(</span><span class="op" id="4238129">)</span><span class="op" id="4238130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238133">x2</span><span class="op" id="4238135">,</span>&nbsp;<span class="ident" id="4238137">y2</span>&nbsp;<span class="op" id="4238140">:=</span>&nbsp;<span class="ident" id="4238143">c</span><span class="op" id="4238144">.</span><span class="ident" id="4238145">ScalarMult</span><span class="op" id="4238155">(</span><span class="ident" id="4238156">pub</span><span class="op" id="4238159">.</span><span class="ident" id="4238160">X</span><span class="op" id="4238161">,</span>&nbsp;<span class="ident" id="4238163">pub</span><span class="op" id="4238166">.</span><span class="ident" id="4238167">Y</span><span class="op" id="4238168">,</span>&nbsp;<span class="ident" id="4238170">u2</span><span class="op" id="4238172">.</span><span class="ident" id="4238173">Bytes</span><span class="op" id="4238178">(</span><span class="op" id="4238179">)</span><span class="op" id="4238180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238183">x</span><span class="op" id="4238184">,</span>&nbsp;<span class="ident" id="4238186">y</span>&nbsp;<span class="op" id="4238188">:=</span>&nbsp;<span class="ident" id="4238191">c</span><span class="op" id="4238192">.</span><span class="ident" id="4238193">Add</span><span class="op" id="4238196">(</span><span class="ident" id="4238197">x1</span><span class="op" id="4238199">,</span>&nbsp;<span class="ident" id="4238201">y1</span><span class="op" id="4238203">,</span>&nbsp;<span class="ident" id="4238205">x2</span><span class="op" id="4238207">,</span>&nbsp;<span class="ident" id="4238209">y2</span><span class="op" id="4238211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238214">if</span>&nbsp;<span class="ident" id="4238217">x</span><span class="op" id="4238218">.</span><span class="ident" id="4238219">Sign</span><span class="op" id="4238223">(</span><span class="op" id="4238224">)</span>&nbsp;<span class="op" id="4238226">==</span>&nbsp;<span class="num" id="4238229">0</span>&nbsp;<span class="op" id="4238231">&amp;&amp;</span>&nbsp;<span class="ident" id="4238234">y</span><span class="op" id="4238235">.</span><span class="ident" id="4238236">Sign</span><span class="op" id="4238240">(</span><span class="op" id="4238241">)</span>&nbsp;<span class="op" id="4238243">==</span>&nbsp;<span class="num" id="4238246">0</span>&nbsp;<span class="op" id="4238248">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238252">return</span>&nbsp;<span class="builtintype" id="4238259">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4238266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4238269">x</span><span class="op" id="4238270">.</span><span class="ident" id="4238271">Mod</span><span class="op" id="4238274">(</span><span class="ident" id="4238275">x</span><span class="op" id="4238276">,</span>&nbsp;<span class="ident" id="4238278">N</span><span class="op" id="4238279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4238282">return</span>&nbsp;<span class="ident" id="4238289">x</span><span class="op" id="4238290">.</span><span class="ident" id="4238291">Cmp</span><span class="op" id="4238294">(</span><span class="ident" id="4238295">r</span><span class="op" id="4238296">)</span>&nbsp;<span class="op" id="4238298">==</span>&nbsp;<span class="num" id="4238301">0</span><br>
<span class="lineno"></span><span class="op" id="4238303">}</span>
</div>
</body>
</html>
