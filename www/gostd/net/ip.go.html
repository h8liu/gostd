<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3310027">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3310082">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3310136">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3310187">//&nbsp;IP&nbsp;address&nbsp;manipulations</span><br>
<span class="lineno"></span><span class="comment" id="3310215">//</span><br>
<span class="lineno"></span><span class="comment" id="3310218">//&nbsp;IPv4&nbsp;addresses&nbsp;are&nbsp;4&nbsp;bytes;&nbsp;IPv6&nbsp;addresses&nbsp;are&nbsp;16&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3310278">//&nbsp;An&nbsp;IPv4&nbsp;address&nbsp;can&nbsp;be&nbsp;converted&nbsp;to&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3310336">//&nbsp;adding&nbsp;a&nbsp;canonical&nbsp;prefix&nbsp;(10&nbsp;zeros,&nbsp;2&nbsp;0xFFs).</span><br>
<span class="lineno">10</span><span class="comment" id="3310386">//&nbsp;This&nbsp;library&nbsp;accepts&nbsp;either&nbsp;size&nbsp;of&nbsp;byte&nbsp;slice&nbsp;but&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="3310447">//&nbsp;returns&nbsp;16-byte&nbsp;addresses.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3310478">package</span>&nbsp;<span class="ident" id="3310486">net</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="3310491">import</span>&nbsp;<span class="string" id="3310498">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310508">//&nbsp;IP&nbsp;address&nbsp;lengths&nbsp;(bytes).</span><br>
<span class="lineno"></span><span class="keyword" id="3310539">const</span>&nbsp;<span class="op" id="3310545">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310548">IPv4len</span>&nbsp;<span class="op" id="3310556">=</span>&nbsp;<span class="num" id="3310558">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3310561">IPv6len</span>&nbsp;<span class="op" id="3310569">=</span>&nbsp;<span class="num" id="3310571">16</span><br>
<span class="lineno"></span><span class="op" id="3310574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310577">//&nbsp;An&nbsp;IP&nbsp;is&nbsp;a&nbsp;single&nbsp;IP&nbsp;address,&nbsp;a&nbsp;slice&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3310628">//&nbsp;Functions&nbsp;in&nbsp;this&nbsp;package&nbsp;accept&nbsp;either&nbsp;4-byte&nbsp;(IPv4)</span><br>
<span class="lineno">25</span><span class="comment" id="3310685">//&nbsp;or&nbsp;16-byte&nbsp;(IPv6)&nbsp;slices&nbsp;as&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3310723">//</span><br>
<span class="lineno"></span><span class="comment" id="3310726">//&nbsp;Note&nbsp;that&nbsp;in&nbsp;this&nbsp;documentation,&nbsp;referring&nbsp;to&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3310778">//&nbsp;IP&nbsp;address&nbsp;as&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;or&nbsp;an&nbsp;IPv6&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3310830">//&nbsp;is&nbsp;a&nbsp;semantic&nbsp;property&nbsp;of&nbsp;the&nbsp;address,&nbsp;not&nbsp;just&nbsp;the</span><br>
<span class="lineno">30</span><span class="comment" id="3310885">//&nbsp;length&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice:&nbsp;a&nbsp;16-byte&nbsp;slice&nbsp;can&nbsp;still</span><br>
<span class="lineno"></span><span class="comment" id="3310940">//&nbsp;be&nbsp;an&nbsp;IPv4&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3310963">type</span>&nbsp;<span class="ident" id="3310968">IP</span>&nbsp;<span class="op" id="3310971">[</span><span class="op" id="3310972">]</span><span class="builtintype" id="3310973">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3310979">//&nbsp;An&nbsp;IP&nbsp;mask&nbsp;is&nbsp;an&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">35</span><span class="keyword" id="3311011">type</span>&nbsp;<span class="ident" id="3311016">IPMask</span>&nbsp;<span class="op" id="3311023">[</span><span class="op" id="3311024">]</span><span class="builtintype" id="3311025">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311031">//&nbsp;An&nbsp;IPNet&nbsp;represents&nbsp;an&nbsp;IP&nbsp;network.</span><br>
<span class="lineno"></span><span class="keyword" id="3311069">type</span>&nbsp;<span class="ident" id="3311074">IPNet</span>&nbsp;<span class="keyword" id="3311080">struct</span>&nbsp;<span class="op" id="3311087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311090">IP</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3311095">IP</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3311102">//&nbsp;network&nbsp;number</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311121">Mask</span>&nbsp;<span class="ident" id="3311126">IPMask</span>&nbsp;<span class="comment" id="3311133">//&nbsp;network&nbsp;mask</span><br>
<span class="lineno"></span><span class="op" id="3311149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311152">//&nbsp;IPv4&nbsp;returns&nbsp;the&nbsp;IP&nbsp;address&nbsp;(in&nbsp;16-byte&nbsp;form)&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3311208">//&nbsp;IPv4&nbsp;address&nbsp;a.b.c.d.</span><br>
<span class="lineno">45</span><span class="keyword" id="3311233">func</span>&nbsp;<span class="ident" id="3311238">IPv4</span><span class="op" id="3311242">(</span><span class="ident" id="3311243">a</span><span class="op" id="3311244">,</span>&nbsp;<span class="ident" id="3311246">b</span><span class="op" id="3311247">,</span>&nbsp;<span class="ident" id="3311249">c</span><span class="op" id="3311250">,</span>&nbsp;<span class="ident" id="3311252">d</span>&nbsp;<span class="builtintype" id="3311254">byte</span><span class="op" id="3311258">)</span>&nbsp;<span class="ident" id="3311260">IP</span>&nbsp;<span class="op" id="3311263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311266">p</span>&nbsp;<span class="op" id="3311268">:=</span>&nbsp;<span class="builtinfunc" id="3311271">make</span><span class="op" id="3311275">(</span><span class="ident" id="3311276">IP</span><span class="op" id="3311278">,</span>&nbsp;<span class="ident" id="3311280">IPv6len</span><span class="op" id="3311287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3311290">copy</span><span class="op" id="3311294">(</span><span class="ident" id="3311295">p</span><span class="op" id="3311296">,</span>&nbsp;<span class="ident" id="3311298">v4InV6Prefix</span><span class="op" id="3311310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311313">p</span><span class="op" id="3311314">[</span><span class="num" id="3311315">12</span><span class="op" id="3311317">]</span>&nbsp;<span class="op" id="3311319">=</span>&nbsp;<span class="ident" id="3311321">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311324">p</span><span class="op" id="3311325">[</span><span class="num" id="3311326">13</span><span class="op" id="3311328">]</span>&nbsp;<span class="op" id="3311330">=</span>&nbsp;<span class="ident" id="3311332">b</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311335">p</span><span class="op" id="3311336">[</span><span class="num" id="3311337">14</span><span class="op" id="3311339">]</span>&nbsp;<span class="op" id="3311341">=</span>&nbsp;<span class="ident" id="3311343">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311346">p</span><span class="op" id="3311347">[</span><span class="num" id="3311348">15</span><span class="op" id="3311350">]</span>&nbsp;<span class="op" id="3311352">=</span>&nbsp;<span class="ident" id="3311354">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311357">return</span>&nbsp;<span class="ident" id="3311364">p</span><br>
<span class="lineno"></span><span class="op" id="3311366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3311369">var</span>&nbsp;<span class="ident" id="3311373">v4InV6Prefix</span>&nbsp;<span class="op" id="3311386">=</span>&nbsp;<span class="op" id="3311388">[</span><span class="op" id="3311389">]</span><span class="builtintype" id="3311390">byte</span><span class="op" id="3311394">{</span><span class="num" id="3311395">0</span><span class="op" id="3311396">,</span>&nbsp;<span class="num" id="3311398">0</span><span class="op" id="3311399">,</span>&nbsp;<span class="num" id="3311401">0</span><span class="op" id="3311402">,</span>&nbsp;<span class="num" id="3311404">0</span><span class="op" id="3311405">,</span>&nbsp;<span class="num" id="3311407">0</span><span class="op" id="3311408">,</span>&nbsp;<span class="num" id="3311410">0</span><span class="op" id="3311411">,</span>&nbsp;<span class="num" id="3311413">0</span><span class="op" id="3311414">,</span>&nbsp;<span class="num" id="3311416">0</span><span class="op" id="3311417">,</span>&nbsp;<span class="num" id="3311419">0</span><span class="op" id="3311420">,</span>&nbsp;<span class="num" id="3311422">0</span><span class="op" id="3311423">,</span>&nbsp;<span class="num" id="3311425">0xff</span><span class="op" id="3311429">,</span>&nbsp;<span class="num" id="3311431">0xff</span><span class="op" id="3311435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311438">//&nbsp;IPv4Mask&nbsp;returns&nbsp;the&nbsp;IP&nbsp;mask&nbsp;(in&nbsp;4-byte&nbsp;form)&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3311494">//&nbsp;IPv4&nbsp;mask&nbsp;a.b.c.d.</span><br>
<span class="lineno"></span><span class="keyword" id="3311516">func</span>&nbsp;<span class="ident" id="3311521">IPv4Mask</span><span class="op" id="3311529">(</span><span class="ident" id="3311530">a</span><span class="op" id="3311531">,</span>&nbsp;<span class="ident" id="3311533">b</span><span class="op" id="3311534">,</span>&nbsp;<span class="ident" id="3311536">c</span><span class="op" id="3311537">,</span>&nbsp;<span class="ident" id="3311539">d</span>&nbsp;<span class="builtintype" id="3311541">byte</span><span class="op" id="3311545">)</span>&nbsp;<span class="ident" id="3311547">IPMask</span>&nbsp;<span class="op" id="3311554">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311557">p</span>&nbsp;<span class="op" id="3311559">:=</span>&nbsp;<span class="builtinfunc" id="3311562">make</span><span class="op" id="3311566">(</span><span class="ident" id="3311567">IPMask</span><span class="op" id="3311573">,</span>&nbsp;<span class="ident" id="3311575">IPv4len</span><span class="op" id="3311582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311585">p</span><span class="op" id="3311586">[</span><span class="num" id="3311587">0</span><span class="op" id="3311588">]</span>&nbsp;<span class="op" id="3311590">=</span>&nbsp;<span class="ident" id="3311592">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311595">p</span><span class="op" id="3311596">[</span><span class="num" id="3311597">1</span><span class="op" id="3311598">]</span>&nbsp;<span class="op" id="3311600">=</span>&nbsp;<span class="ident" id="3311602">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311605">p</span><span class="op" id="3311606">[</span><span class="num" id="3311607">2</span><span class="op" id="3311608">]</span>&nbsp;<span class="op" id="3311610">=</span>&nbsp;<span class="ident" id="3311612">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311615">p</span><span class="op" id="3311616">[</span><span class="num" id="3311617">3</span><span class="op" id="3311618">]</span>&nbsp;<span class="op" id="3311620">=</span>&nbsp;<span class="ident" id="3311622">d</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311625">return</span>&nbsp;<span class="ident" id="3311632">p</span><br>
<span class="lineno"></span><span class="op" id="3311634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3311637">//&nbsp;CIDRMask&nbsp;returns&nbsp;an&nbsp;IPMask&nbsp;consisting&nbsp;of&nbsp;`ones&#39;&nbsp;1&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3311695">//&nbsp;followed&nbsp;by&nbsp;0s&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;length&nbsp;of&nbsp;`bits&#39;&nbsp;bits.</span><br>
<span class="lineno">70</span><span class="comment" id="3311750">//&nbsp;For&nbsp;a&nbsp;mask&nbsp;of&nbsp;this&nbsp;form,&nbsp;CIDRMask&nbsp;is&nbsp;the&nbsp;inverse&nbsp;of&nbsp;IPMask.Size.</span><br>
<span class="lineno"></span><span class="keyword" id="3311818">func</span>&nbsp;<span class="ident" id="3311823">CIDRMask</span><span class="op" id="3311831">(</span><span class="ident" id="3311832">ones</span><span class="op" id="3311836">,</span>&nbsp;<span class="ident" id="3311838">bits</span>&nbsp;<span class="builtintype" id="3311843">int</span><span class="op" id="3311846">)</span>&nbsp;<span class="ident" id="3311848">IPMask</span>&nbsp;<span class="op" id="3311855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311858">if</span>&nbsp;<span class="ident" id="3311861">bits</span>&nbsp;<span class="op" id="3311866">!=</span>&nbsp;<span class="num" id="3311869">8</span><span class="op" id="3311870">*</span><span class="ident" id="3311871">IPv4len</span>&nbsp;<span class="op" id="3311879">&amp;&amp;</span>&nbsp;<span class="ident" id="3311882">bits</span>&nbsp;<span class="op" id="3311887">!=</span>&nbsp;<span class="num" id="3311890">8</span><span class="op" id="3311891">*</span><span class="ident" id="3311892">IPv6len</span>&nbsp;<span class="op" id="3311900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311904">return</span>&nbsp;<span class="ident" id="3311911">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311916">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311919">if</span>&nbsp;<span class="ident" id="3311922">ones</span>&nbsp;<span class="op" id="3311927">&lt;</span>&nbsp;<span class="num" id="3311929">0</span>&nbsp;<span class="op" id="3311931">||</span>&nbsp;<span class="ident" id="3311934">ones</span>&nbsp;<span class="op" id="3311939">&gt;</span>&nbsp;<span class="ident" id="3311941">bits</span>&nbsp;<span class="op" id="3311946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3311950">return</span>&nbsp;<span class="ident" id="3311957">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3311962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311965">l</span>&nbsp;<span class="op" id="3311967">:=</span>&nbsp;<span class="ident" id="3311970">bits</span>&nbsp;<span class="op" id="3311975">/</span>&nbsp;<span class="num" id="3311977">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3311980">m</span>&nbsp;<span class="op" id="3311982">:=</span>&nbsp;<span class="builtinfunc" id="3311985">make</span><span class="op" id="3311989">(</span><span class="ident" id="3311990">IPMask</span><span class="op" id="3311996">,</span>&nbsp;<span class="ident" id="3311998">l</span><span class="op" id="3311999">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312002">n</span>&nbsp;<span class="op" id="3312004">:=</span>&nbsp;<span class="builtintype" id="3312007">uint</span><span class="op" id="3312011">(</span><span class="ident" id="3312012">ones</span><span class="op" id="3312016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312019">for</span>&nbsp;<span class="ident" id="3312023">i</span>&nbsp;<span class="op" id="3312025">:=</span>&nbsp;<span class="num" id="3312028">0</span><span class="op" id="3312029">;</span>&nbsp;<span class="ident" id="3312031">i</span>&nbsp;<span class="op" id="3312033">&lt;</span>&nbsp;<span class="ident" id="3312035">l</span><span class="op" id="3312036">;</span>&nbsp;<span class="ident" id="3312038">i</span><span class="op" id="3312039">++</span>&nbsp;<span class="op" id="3312042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312046">if</span>&nbsp;<span class="ident" id="3312049">n</span>&nbsp;<span class="op" id="3312051">&gt;=</span>&nbsp;<span class="num" id="3312054">8</span>&nbsp;<span class="op" id="3312056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312061">m</span><span class="op" id="3312062">[</span><span class="ident" id="3312063">i</span><span class="op" id="3312064">]</span>&nbsp;<span class="op" id="3312066">=</span>&nbsp;<span class="num" id="3312068">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312076">n</span>&nbsp;<span class="op" id="3312078">-=</span>&nbsp;<span class="num" id="3312081">8</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312086">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3312097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312101">m</span><span class="op" id="3312102">[</span><span class="ident" id="3312103">i</span><span class="op" id="3312104">]</span>&nbsp;<span class="op" id="3312106">=</span>&nbsp;<span class="op" id="3312108">^</span><span class="builtintype" id="3312109">byte</span><span class="op" id="3312113">(</span><span class="num" id="3312114">0xff</span>&nbsp;<span class="op" id="3312119">&gt;&gt;</span>&nbsp;<span class="ident" id="3312122">n</span><span class="op" id="3312123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312127">n</span>&nbsp;<span class="op" id="3312129">=</span>&nbsp;<span class="num" id="3312131">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3312134">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3312137">return</span>&nbsp;<span class="ident" id="3312144">m</span><br>
<span class="lineno"></span><span class="op" id="3312146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3312149">//&nbsp;Well-known&nbsp;IPv4&nbsp;addresses</span><br>
<span class="lineno"></span><span class="keyword" id="3312178">var</span>&nbsp;<span class="op" id="3312182">(</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312185">IPv4bcast</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312199">=</span>&nbsp;<span class="ident" id="3312201">IPv4</span><span class="op" id="3312205">(</span><span class="num" id="3312206">255</span><span class="op" id="3312209">,</span>&nbsp;<span class="num" id="3312211">255</span><span class="op" id="3312214">,</span>&nbsp;<span class="num" id="3312216">255</span><span class="op" id="3312219">,</span>&nbsp;<span class="num" id="3312221">255</span><span class="op" id="3312224">)</span>&nbsp;<span class="comment" id="3312226">//&nbsp;broadcast</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312240">IPv4allsys</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312254">=</span>&nbsp;<span class="ident" id="3312256">IPv4</span><span class="op" id="3312260">(</span><span class="num" id="3312261">224</span><span class="op" id="3312264">,</span>&nbsp;<span class="num" id="3312266">0</span><span class="op" id="3312267">,</span>&nbsp;<span class="num" id="3312269">0</span><span class="op" id="3312270">,</span>&nbsp;<span class="num" id="3312272">1</span><span class="op" id="3312273">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312281">//&nbsp;all&nbsp;systems</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312297">IPv4allrouter</span>&nbsp;<span class="op" id="3312311">=</span>&nbsp;<span class="ident" id="3312313">IPv4</span><span class="op" id="3312317">(</span><span class="num" id="3312318">224</span><span class="op" id="3312321">,</span>&nbsp;<span class="num" id="3312323">0</span><span class="op" id="3312324">,</span>&nbsp;<span class="num" id="3312326">0</span><span class="op" id="3312327">,</span>&nbsp;<span class="num" id="3312329">2</span><span class="op" id="3312330">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312338">//&nbsp;all&nbsp;routers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312354">IPv4zero</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312368">=</span>&nbsp;<span class="ident" id="3312370">IPv4</span><span class="op" id="3312374">(</span><span class="num" id="3312375">0</span><span class="op" id="3312376">,</span>&nbsp;<span class="num" id="3312378">0</span><span class="op" id="3312379">,</span>&nbsp;<span class="num" id="3312381">0</span><span class="op" id="3312382">,</span>&nbsp;<span class="num" id="3312384">0</span><span class="op" id="3312385">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3312395">//&nbsp;all&nbsp;zeros</span><br>
<span class="lineno"></span><span class="op" id="3312408">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3312411">//&nbsp;Well-known&nbsp;IPv6&nbsp;addresses</span><br>
<span class="lineno"></span><span class="keyword" id="3312440">var</span>&nbsp;<span class="op" id="3312444">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312447">IPv6zero</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312474">=</span>&nbsp;<span class="ident" id="3312476">IP</span><span class="op" id="3312478">{</span><span class="num" id="3312479">0</span><span class="op" id="3312480">,</span>&nbsp;<span class="num" id="3312482">0</span><span class="op" id="3312483">,</span>&nbsp;<span class="num" id="3312485">0</span><span class="op" id="3312486">,</span>&nbsp;<span class="num" id="3312488">0</span><span class="op" id="3312489">,</span>&nbsp;<span class="num" id="3312491">0</span><span class="op" id="3312492">,</span>&nbsp;<span class="num" id="3312494">0</span><span class="op" id="3312495">,</span>&nbsp;<span class="num" id="3312497">0</span><span class="op" id="3312498">,</span>&nbsp;<span class="num" id="3312500">0</span><span class="op" id="3312501">,</span>&nbsp;<span class="num" id="3312503">0</span><span class="op" id="3312504">,</span>&nbsp;<span class="num" id="3312506">0</span><span class="op" id="3312507">,</span>&nbsp;<span class="num" id="3312509">0</span><span class="op" id="3312510">,</span>&nbsp;<span class="num" id="3312512">0</span><span class="op" id="3312513">,</span>&nbsp;<span class="num" id="3312515">0</span><span class="op" id="3312516">,</span>&nbsp;<span class="num" id="3312518">0</span><span class="op" id="3312519">,</span>&nbsp;<span class="num" id="3312521">0</span><span class="op" id="3312522">,</span>&nbsp;<span class="num" id="3312524">0</span><span class="op" id="3312525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312528">IPv6unspecified</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312555">=</span>&nbsp;<span class="ident" id="3312557">IP</span><span class="op" id="3312559">{</span><span class="num" id="3312560">0</span><span class="op" id="3312561">,</span>&nbsp;<span class="num" id="3312563">0</span><span class="op" id="3312564">,</span>&nbsp;<span class="num" id="3312566">0</span><span class="op" id="3312567">,</span>&nbsp;<span class="num" id="3312569">0</span><span class="op" id="3312570">,</span>&nbsp;<span class="num" id="3312572">0</span><span class="op" id="3312573">,</span>&nbsp;<span class="num" id="3312575">0</span><span class="op" id="3312576">,</span>&nbsp;<span class="num" id="3312578">0</span><span class="op" id="3312579">,</span>&nbsp;<span class="num" id="3312581">0</span><span class="op" id="3312582">,</span>&nbsp;<span class="num" id="3312584">0</span><span class="op" id="3312585">,</span>&nbsp;<span class="num" id="3312587">0</span><span class="op" id="3312588">,</span>&nbsp;<span class="num" id="3312590">0</span><span class="op" id="3312591">,</span>&nbsp;<span class="num" id="3312593">0</span><span class="op" id="3312594">,</span>&nbsp;<span class="num" id="3312596">0</span><span class="op" id="3312597">,</span>&nbsp;<span class="num" id="3312599">0</span><span class="op" id="3312600">,</span>&nbsp;<span class="num" id="3312602">0</span><span class="op" id="3312603">,</span>&nbsp;<span class="num" id="3312605">0</span><span class="op" id="3312606">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312609">IPv6loopback</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312636">=</span>&nbsp;<span class="ident" id="3312638">IP</span><span class="op" id="3312640">{</span><span class="num" id="3312641">0</span><span class="op" id="3312642">,</span>&nbsp;<span class="num" id="3312644">0</span><span class="op" id="3312645">,</span>&nbsp;<span class="num" id="3312647">0</span><span class="op" id="3312648">,</span>&nbsp;<span class="num" id="3312650">0</span><span class="op" id="3312651">,</span>&nbsp;<span class="num" id="3312653">0</span><span class="op" id="3312654">,</span>&nbsp;<span class="num" id="3312656">0</span><span class="op" id="3312657">,</span>&nbsp;<span class="num" id="3312659">0</span><span class="op" id="3312660">,</span>&nbsp;<span class="num" id="3312662">0</span><span class="op" id="3312663">,</span>&nbsp;<span class="num" id="3312665">0</span><span class="op" id="3312666">,</span>&nbsp;<span class="num" id="3312668">0</span><span class="op" id="3312669">,</span>&nbsp;<span class="num" id="3312671">0</span><span class="op" id="3312672">,</span>&nbsp;<span class="num" id="3312674">0</span><span class="op" id="3312675">,</span>&nbsp;<span class="num" id="3312677">0</span><span class="op" id="3312678">,</span>&nbsp;<span class="num" id="3312680">0</span><span class="op" id="3312681">,</span>&nbsp;<span class="num" id="3312683">0</span><span class="op" id="3312684">,</span>&nbsp;<span class="num" id="3312686">1</span><span class="op" id="3312687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312690">IPv6interfacelocalallnodes</span>&nbsp;<span class="op" id="3312717">=</span>&nbsp;<span class="ident" id="3312719">IP</span><span class="op" id="3312721">{</span><span class="num" id="3312722">0xff</span><span class="op" id="3312726">,</span>&nbsp;<span class="num" id="3312728">0x01</span><span class="op" id="3312732">,</span>&nbsp;<span class="num" id="3312734">0</span><span class="op" id="3312735">,</span>&nbsp;<span class="num" id="3312737">0</span><span class="op" id="3312738">,</span>&nbsp;<span class="num" id="3312740">0</span><span class="op" id="3312741">,</span>&nbsp;<span class="num" id="3312743">0</span><span class="op" id="3312744">,</span>&nbsp;<span class="num" id="3312746">0</span><span class="op" id="3312747">,</span>&nbsp;<span class="num" id="3312749">0</span><span class="op" id="3312750">,</span>&nbsp;<span class="num" id="3312752">0</span><span class="op" id="3312753">,</span>&nbsp;<span class="num" id="3312755">0</span><span class="op" id="3312756">,</span>&nbsp;<span class="num" id="3312758">0</span><span class="op" id="3312759">,</span>&nbsp;<span class="num" id="3312761">0</span><span class="op" id="3312762">,</span>&nbsp;<span class="num" id="3312764">0</span><span class="op" id="3312765">,</span>&nbsp;<span class="num" id="3312767">0</span><span class="op" id="3312768">,</span>&nbsp;<span class="num" id="3312770">0</span><span class="op" id="3312771">,</span>&nbsp;<span class="num" id="3312773">0x01</span><span class="op" id="3312777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312780">IPv6linklocalallnodes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312807">=</span>&nbsp;<span class="ident" id="3312809">IP</span><span class="op" id="3312811">{</span><span class="num" id="3312812">0xff</span><span class="op" id="3312816">,</span>&nbsp;<span class="num" id="3312818">0x02</span><span class="op" id="3312822">,</span>&nbsp;<span class="num" id="3312824">0</span><span class="op" id="3312825">,</span>&nbsp;<span class="num" id="3312827">0</span><span class="op" id="3312828">,</span>&nbsp;<span class="num" id="3312830">0</span><span class="op" id="3312831">,</span>&nbsp;<span class="num" id="3312833">0</span><span class="op" id="3312834">,</span>&nbsp;<span class="num" id="3312836">0</span><span class="op" id="3312837">,</span>&nbsp;<span class="num" id="3312839">0</span><span class="op" id="3312840">,</span>&nbsp;<span class="num" id="3312842">0</span><span class="op" id="3312843">,</span>&nbsp;<span class="num" id="3312845">0</span><span class="op" id="3312846">,</span>&nbsp;<span class="num" id="3312848">0</span><span class="op" id="3312849">,</span>&nbsp;<span class="num" id="3312851">0</span><span class="op" id="3312852">,</span>&nbsp;<span class="num" id="3312854">0</span><span class="op" id="3312855">,</span>&nbsp;<span class="num" id="3312857">0</span><span class="op" id="3312858">,</span>&nbsp;<span class="num" id="3312860">0</span><span class="op" id="3312861">,</span>&nbsp;<span class="num" id="3312863">0x01</span><span class="op" id="3312867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3312870">IPv6linklocalallrouters</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3312897">=</span>&nbsp;<span class="ident" id="3312899">IP</span><span class="op" id="3312901">{</span><span class="num" id="3312902">0xff</span><span class="op" id="3312906">,</span>&nbsp;<span class="num" id="3312908">0x02</span><span class="op" id="3312912">,</span>&nbsp;<span class="num" id="3312914">0</span><span class="op" id="3312915">,</span>&nbsp;<span class="num" id="3312917">0</span><span class="op" id="3312918">,</span>&nbsp;<span class="num" id="3312920">0</span><span class="op" id="3312921">,</span>&nbsp;<span class="num" id="3312923">0</span><span class="op" id="3312924">,</span>&nbsp;<span class="num" id="3312926">0</span><span class="op" id="3312927">,</span>&nbsp;<span class="num" id="3312929">0</span><span class="op" id="3312930">,</span>&nbsp;<span class="num" id="3312932">0</span><span class="op" id="3312933">,</span>&nbsp;<span class="num" id="3312935">0</span><span class="op" id="3312936">,</span>&nbsp;<span class="num" id="3312938">0</span><span class="op" id="3312939">,</span>&nbsp;<span class="num" id="3312941">0</span><span class="op" id="3312942">,</span>&nbsp;<span class="num" id="3312944">0</span><span class="op" id="3312945">,</span>&nbsp;<span class="num" id="3312947">0</span><span class="op" id="3312948">,</span>&nbsp;<span class="num" id="3312950">0</span><span class="op" id="3312951">,</span>&nbsp;<span class="num" id="3312953">0x02</span><span class="op" id="3312957">}</span><br>
<span class="lineno"></span><span class="op" id="3312959">)</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="3312962">//&nbsp;IsUnspecified&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;an&nbsp;unspecified&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3313025">func</span>&nbsp;<span class="op" id="3313030">(</span><span class="ident" id="3313031">ip</span>&nbsp;<span class="ident" id="3313034">IP</span><span class="op" id="3313036">)</span>&nbsp;<span class="ident" id="3313038">IsUnspecified</span><span class="op" id="3313051">(</span><span class="op" id="3313052">)</span>&nbsp;<span class="builtintype" id="3313054">bool</span>&nbsp;<span class="op" id="3313059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313062">if</span>&nbsp;<span class="ident" id="3313065">ip</span><span class="op" id="3313067">.</span><span class="ident" id="3313068">Equal</span><span class="op" id="3313073">(</span><span class="ident" id="3313074">IPv4zero</span><span class="op" id="3313082">)</span>&nbsp;<span class="op" id="3313084">||</span>&nbsp;<span class="ident" id="3313087">ip</span><span class="op" id="3313089">.</span><span class="ident" id="3313090">Equal</span><span class="op" id="3313095">(</span><span class="ident" id="3313096">IPv6unspecified</span><span class="op" id="3313111">)</span>&nbsp;<span class="op" id="3313113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313117">return</span>&nbsp;<span class="builtintype" id="3313124">true</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313133">return</span>&nbsp;<span class="builtintype" id="3313140">false</span><br>
<span class="lineno"></span><span class="op" id="3313146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3313149">//&nbsp;IsLoopback&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;loopback&nbsp;address.</span><br>
<span class="lineno">120</span><span class="keyword" id="3313205">func</span>&nbsp;<span class="op" id="3313210">(</span><span class="ident" id="3313211">ip</span>&nbsp;<span class="ident" id="3313214">IP</span><span class="op" id="3313216">)</span>&nbsp;<span class="ident" id="3313218">IsLoopback</span><span class="op" id="3313228">(</span><span class="op" id="3313229">)</span>&nbsp;<span class="builtintype" id="3313231">bool</span>&nbsp;<span class="op" id="3313236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313239">if</span>&nbsp;<span class="ident" id="3313242">ip4</span>&nbsp;<span class="op" id="3313246">:=</span>&nbsp;<span class="ident" id="3313249">ip</span><span class="op" id="3313251">.</span><span class="ident" id="3313252">To4</span><span class="op" id="3313255">(</span><span class="op" id="3313256">)</span><span class="op" id="3313257">;</span>&nbsp;<span class="ident" id="3313259">ip4</span>&nbsp;<span class="op" id="3313263">!=</span>&nbsp;<span class="ident" id="3313266">nil</span>&nbsp;<span class="op" id="3313270">&amp;&amp;</span>&nbsp;<span class="ident" id="3313273">ip4</span><span class="op" id="3313276">[</span><span class="num" id="3313277">0</span><span class="op" id="3313278">]</span>&nbsp;<span class="op" id="3313280">==</span>&nbsp;<span class="num" id="3313283">127</span>&nbsp;<span class="op" id="3313287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313291">return</span>&nbsp;<span class="builtintype" id="3313298">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313307">return</span>&nbsp;<span class="ident" id="3313314">ip</span><span class="op" id="3313316">.</span><span class="ident" id="3313317">Equal</span><span class="op" id="3313322">(</span><span class="ident" id="3313323">IPv6loopback</span><span class="op" id="3313335">)</span><br>
<span class="lineno">125</span><span class="op" id="3313337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3313340">//&nbsp;IsMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3313398">func</span>&nbsp;<span class="op" id="3313403">(</span><span class="ident" id="3313404">ip</span>&nbsp;<span class="ident" id="3313407">IP</span><span class="op" id="3313409">)</span>&nbsp;<span class="ident" id="3313411">IsMulticast</span><span class="op" id="3313422">(</span><span class="op" id="3313423">)</span>&nbsp;<span class="builtintype" id="3313425">bool</span>&nbsp;<span class="op" id="3313430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313433">if</span>&nbsp;<span class="ident" id="3313436">ip4</span>&nbsp;<span class="op" id="3313440">:=</span>&nbsp;<span class="ident" id="3313443">ip</span><span class="op" id="3313445">.</span><span class="ident" id="3313446">To4</span><span class="op" id="3313449">(</span><span class="op" id="3313450">)</span><span class="op" id="3313451">;</span>&nbsp;<span class="ident" id="3313453">ip4</span>&nbsp;<span class="op" id="3313457">!=</span>&nbsp;<span class="ident" id="3313460">nil</span>&nbsp;<span class="op" id="3313464">&amp;&amp;</span>&nbsp;<span class="ident" id="3313467">ip4</span><span class="op" id="3313470">[</span><span class="num" id="3313471">0</span><span class="op" id="3313472">]</span><span class="op" id="3313473">&amp;</span><span class="num" id="3313474">0xf0</span>&nbsp;<span class="op" id="3313479">==</span>&nbsp;<span class="num" id="3313482">0xe0</span>&nbsp;<span class="op" id="3313487">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313491">return</span>&nbsp;<span class="builtintype" id="3313498">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313507">return</span>&nbsp;<span class="ident" id="3313514">ip</span><span class="op" id="3313516">[</span><span class="num" id="3313517">0</span><span class="op" id="3313518">]</span>&nbsp;<span class="op" id="3313520">==</span>&nbsp;<span class="num" id="3313523">0xff</span><br>
<span class="lineno"></span><span class="op" id="3313528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="3313531">//&nbsp;IsInterfaceLinkLocalMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3313586">//&nbsp;an&nbsp;interface-local&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3313627">func</span>&nbsp;<span class="op" id="3313632">(</span><span class="ident" id="3313633">ip</span>&nbsp;<span class="ident" id="3313636">IP</span><span class="op" id="3313638">)</span>&nbsp;<span class="ident" id="3313640">IsInterfaceLocalMulticast</span><span class="op" id="3313665">(</span><span class="op" id="3313666">)</span>&nbsp;<span class="builtintype" id="3313668">bool</span>&nbsp;<span class="op" id="3313673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313676">return</span>&nbsp;<span class="builtinfunc" id="3313683">len</span><span class="op" id="3313686">(</span><span class="ident" id="3313687">ip</span><span class="op" id="3313689">)</span>&nbsp;<span class="op" id="3313691">==</span>&nbsp;<span class="ident" id="3313694">IPv6len</span>&nbsp;<span class="op" id="3313702">&amp;&amp;</span>&nbsp;<span class="ident" id="3313705">ip</span><span class="op" id="3313707">[</span><span class="num" id="3313708">0</span><span class="op" id="3313709">]</span>&nbsp;<span class="op" id="3313711">==</span>&nbsp;<span class="num" id="3313714">0xff</span>&nbsp;<span class="op" id="3313719">&amp;&amp;</span>&nbsp;<span class="ident" id="3313722">ip</span><span class="op" id="3313724">[</span><span class="num" id="3313725">1</span><span class="op" id="3313726">]</span><span class="op" id="3313727">&amp;</span><span class="num" id="3313728">0x0f</span>&nbsp;<span class="op" id="3313733">==</span>&nbsp;<span class="num" id="3313736">0x01</span><br>
<span class="lineno"></span><span class="op" id="3313741">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3313744">//&nbsp;IsLinkLocalMulticast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;link-local</span><br>
<span class="lineno"></span><span class="comment" id="3313803">//&nbsp;multicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3313825">func</span>&nbsp;<span class="op" id="3313830">(</span><span class="ident" id="3313831">ip</span>&nbsp;<span class="ident" id="3313834">IP</span><span class="op" id="3313836">)</span>&nbsp;<span class="ident" id="3313838">IsLinkLocalMulticast</span><span class="op" id="3313858">(</span><span class="op" id="3313859">)</span>&nbsp;<span class="builtintype" id="3313861">bool</span>&nbsp;<span class="op" id="3313866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313869">if</span>&nbsp;<span class="ident" id="3313872">ip4</span>&nbsp;<span class="op" id="3313876">:=</span>&nbsp;<span class="ident" id="3313879">ip</span><span class="op" id="3313881">.</span><span class="ident" id="3313882">To4</span><span class="op" id="3313885">(</span><span class="op" id="3313886">)</span><span class="op" id="3313887">;</span>&nbsp;<span class="ident" id="3313889">ip4</span>&nbsp;<span class="op" id="3313893">!=</span>&nbsp;<span class="ident" id="3313896">nil</span>&nbsp;<span class="op" id="3313900">&amp;&amp;</span>&nbsp;<span class="ident" id="3313903">ip4</span><span class="op" id="3313906">[</span><span class="num" id="3313907">0</span><span class="op" id="3313908">]</span>&nbsp;<span class="op" id="3313910">==</span>&nbsp;<span class="num" id="3313913">224</span>&nbsp;<span class="op" id="3313917">&amp;&amp;</span>&nbsp;<span class="ident" id="3313920">ip4</span><span class="op" id="3313923">[</span><span class="num" id="3313924">1</span><span class="op" id="3313925">]</span>&nbsp;<span class="op" id="3313927">==</span>&nbsp;<span class="num" id="3313930">0</span>&nbsp;<span class="op" id="3313932">&amp;&amp;</span>&nbsp;<span class="ident" id="3313935">ip4</span><span class="op" id="3313938">[</span><span class="num" id="3313939">2</span><span class="op" id="3313940">]</span>&nbsp;<span class="op" id="3313942">==</span>&nbsp;<span class="num" id="3313945">0</span>&nbsp;<span class="op" id="3313947">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313951">return</span>&nbsp;<span class="builtintype" id="3313958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3313964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3313967">return</span>&nbsp;<span class="ident" id="3313974">ip</span><span class="op" id="3313976">[</span><span class="num" id="3313977">0</span><span class="op" id="3313978">]</span>&nbsp;<span class="op" id="3313980">==</span>&nbsp;<span class="num" id="3313983">0xff</span>&nbsp;<span class="op" id="3313988">&amp;&amp;</span>&nbsp;<span class="ident" id="3313991">ip</span><span class="op" id="3313993">[</span><span class="num" id="3313994">1</span><span class="op" id="3313995">]</span><span class="op" id="3313996">&amp;</span><span class="num" id="3313997">0x0f</span>&nbsp;<span class="op" id="3314002">==</span>&nbsp;<span class="num" id="3314005">0x02</span><br>
<span class="lineno"></span><span class="op" id="3314010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="3314013">//&nbsp;IsLinkLocalUnicast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;link-local</span><br>
<span class="lineno"></span><span class="comment" id="3314070">//&nbsp;unicast&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3314090">func</span>&nbsp;<span class="op" id="3314095">(</span><span class="ident" id="3314096">ip</span>&nbsp;<span class="ident" id="3314099">IP</span><span class="op" id="3314101">)</span>&nbsp;<span class="ident" id="3314103">IsLinkLocalUnicast</span><span class="op" id="3314121">(</span><span class="op" id="3314122">)</span>&nbsp;<span class="builtintype" id="3314124">bool</span>&nbsp;<span class="op" id="3314129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314132">if</span>&nbsp;<span class="ident" id="3314135">ip4</span>&nbsp;<span class="op" id="3314139">:=</span>&nbsp;<span class="ident" id="3314142">ip</span><span class="op" id="3314144">.</span><span class="ident" id="3314145">To4</span><span class="op" id="3314148">(</span><span class="op" id="3314149">)</span><span class="op" id="3314150">;</span>&nbsp;<span class="ident" id="3314152">ip4</span>&nbsp;<span class="op" id="3314156">!=</span>&nbsp;<span class="ident" id="3314159">nil</span>&nbsp;<span class="op" id="3314163">&amp;&amp;</span>&nbsp;<span class="ident" id="3314166">ip4</span><span class="op" id="3314169">[</span><span class="num" id="3314170">0</span><span class="op" id="3314171">]</span>&nbsp;<span class="op" id="3314173">==</span>&nbsp;<span class="num" id="3314176">169</span>&nbsp;<span class="op" id="3314180">&amp;&amp;</span>&nbsp;<span class="ident" id="3314183">ip4</span><span class="op" id="3314186">[</span><span class="num" id="3314187">1</span><span class="op" id="3314188">]</span>&nbsp;<span class="op" id="3314190">==</span>&nbsp;<span class="num" id="3314193">254</span>&nbsp;<span class="op" id="3314197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314201">return</span>&nbsp;<span class="builtintype" id="3314208">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314217">return</span>&nbsp;<span class="ident" id="3314224">ip</span><span class="op" id="3314226">[</span><span class="num" id="3314227">0</span><span class="op" id="3314228">]</span>&nbsp;<span class="op" id="3314230">==</span>&nbsp;<span class="num" id="3314233">0xfe</span>&nbsp;<span class="op" id="3314238">&amp;&amp;</span>&nbsp;<span class="ident" id="3314241">ip</span><span class="op" id="3314243">[</span><span class="num" id="3314244">1</span><span class="op" id="3314245">]</span><span class="op" id="3314246">&amp;</span><span class="num" id="3314247">0xc0</span>&nbsp;<span class="op" id="3314252">==</span>&nbsp;<span class="num" id="3314255">0x80</span><br>
<span class="lineno"></span><span class="op" id="3314260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314263">//&nbsp;IsGlobalUnicast&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;is&nbsp;a&nbsp;global&nbsp;unicast</span><br>
<span class="lineno">160</span><span class="comment" id="3314321">//&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3314333">func</span>&nbsp;<span class="op" id="3314338">(</span><span class="ident" id="3314339">ip</span>&nbsp;<span class="ident" id="3314342">IP</span><span class="op" id="3314344">)</span>&nbsp;<span class="ident" id="3314346">IsGlobalUnicast</span><span class="op" id="3314361">(</span><span class="op" id="3314362">)</span>&nbsp;<span class="builtintype" id="3314364">bool</span>&nbsp;<span class="op" id="3314369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314372">return</span>&nbsp;<span class="op" id="3314379">!</span><span class="ident" id="3314380">ip</span><span class="op" id="3314382">.</span><span class="ident" id="3314383">IsUnspecified</span><span class="op" id="3314396">(</span><span class="op" id="3314397">)</span>&nbsp;<span class="op" id="3314399">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314404">!</span><span class="ident" id="3314405">ip</span><span class="op" id="3314407">.</span><span class="ident" id="3314408">IsLoopback</span><span class="op" id="3314418">(</span><span class="op" id="3314419">)</span>&nbsp;<span class="op" id="3314421">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314426">!</span><span class="ident" id="3314427">ip</span><span class="op" id="3314429">.</span><span class="ident" id="3314430">IsMulticast</span><span class="op" id="3314441">(</span><span class="op" id="3314442">)</span>&nbsp;<span class="op" id="3314444">&amp;&amp;</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314449">!</span><span class="ident" id="3314450">ip</span><span class="op" id="3314452">.</span><span class="ident" id="3314453">IsLinkLocalUnicast</span><span class="op" id="3314471">(</span><span class="op" id="3314472">)</span><br>
<span class="lineno"></span><span class="op" id="3314474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314477">//&nbsp;Is&nbsp;p&nbsp;all&nbsp;zeros?</span><br>
<span class="lineno"></span><span class="keyword" id="3314496">func</span>&nbsp;<span class="ident" id="3314501">isZeros</span><span class="op" id="3314508">(</span><span class="ident" id="3314509">p</span>&nbsp;<span class="ident" id="3314511">IP</span><span class="op" id="3314513">)</span>&nbsp;<span class="builtintype" id="3314515">bool</span>&nbsp;<span class="op" id="3314520">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314523">for</span>&nbsp;<span class="ident" id="3314527">i</span>&nbsp;<span class="op" id="3314529">:=</span>&nbsp;<span class="num" id="3314532">0</span><span class="op" id="3314533">;</span>&nbsp;<span class="ident" id="3314535">i</span>&nbsp;<span class="op" id="3314537">&lt;</span>&nbsp;<span class="builtinfunc" id="3314539">len</span><span class="op" id="3314542">(</span><span class="ident" id="3314543">p</span><span class="op" id="3314544">)</span><span class="op" id="3314545">;</span>&nbsp;<span class="ident" id="3314547">i</span><span class="op" id="3314548">++</span>&nbsp;<span class="op" id="3314551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314555">if</span>&nbsp;<span class="ident" id="3314558">p</span><span class="op" id="3314559">[</span><span class="ident" id="3314560">i</span><span class="op" id="3314561">]</span>&nbsp;<span class="op" id="3314563">!=</span>&nbsp;<span class="num" id="3314566">0</span>&nbsp;<span class="op" id="3314568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314573">return</span>&nbsp;<span class="builtintype" id="3314580">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314591">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314594">return</span>&nbsp;<span class="builtintype" id="3314601">true</span><br>
<span class="lineno"></span><span class="op" id="3314606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314609">//&nbsp;To4&nbsp;converts&nbsp;the&nbsp;IPv4&nbsp;address&nbsp;ip&nbsp;to&nbsp;a&nbsp;4-byte&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3314673">//&nbsp;If&nbsp;ip&nbsp;is&nbsp;not&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;To4&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">180</span><span class="keyword" id="3314723">func</span>&nbsp;<span class="op" id="3314728">(</span><span class="ident" id="3314729">ip</span>&nbsp;<span class="ident" id="3314732">IP</span><span class="op" id="3314734">)</span>&nbsp;<span class="ident" id="3314736">To4</span><span class="op" id="3314739">(</span><span class="op" id="3314740">)</span>&nbsp;<span class="ident" id="3314742">IP</span>&nbsp;<span class="op" id="3314745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314748">if</span>&nbsp;<span class="builtinfunc" id="3314751">len</span><span class="op" id="3314754">(</span><span class="ident" id="3314755">ip</span><span class="op" id="3314757">)</span>&nbsp;<span class="op" id="3314759">==</span>&nbsp;<span class="ident" id="3314762">IPv4len</span>&nbsp;<span class="op" id="3314770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314774">return</span>&nbsp;<span class="ident" id="3314781">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314788">if</span>&nbsp;<span class="builtinfunc" id="3314791">len</span><span class="op" id="3314794">(</span><span class="ident" id="3314795">ip</span><span class="op" id="3314797">)</span>&nbsp;<span class="op" id="3314799">==</span>&nbsp;<span class="ident" id="3314802">IPv6len</span>&nbsp;<span class="op" id="3314810">&amp;&amp;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314815">isZeros</span><span class="op" id="3314822">(</span><span class="ident" id="3314823">ip</span><span class="op" id="3314825">[</span><span class="num" id="3314826">0</span><span class="op" id="3314827">:</span><span class="num" id="3314828">10</span><span class="op" id="3314830">]</span><span class="op" id="3314831">)</span>&nbsp;<span class="op" id="3314833">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314838">ip</span><span class="op" id="3314840">[</span><span class="num" id="3314841">10</span><span class="op" id="3314843">]</span>&nbsp;<span class="op" id="3314845">==</span>&nbsp;<span class="num" id="3314848">0xff</span>&nbsp;<span class="op" id="3314853">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3314858">ip</span><span class="op" id="3314860">[</span><span class="num" id="3314861">11</span><span class="op" id="3314863">]</span>&nbsp;<span class="op" id="3314865">==</span>&nbsp;<span class="num" id="3314868">0xff</span>&nbsp;<span class="op" id="3314873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314877">return</span>&nbsp;<span class="ident" id="3314884">ip</span><span class="op" id="3314886">[</span><span class="num" id="3314887">12</span><span class="op" id="3314889">:</span><span class="num" id="3314890">16</span><span class="op" id="3314892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3314895">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3314898">return</span>&nbsp;<span class="ident" id="3314905">nil</span><br>
<span class="lineno"></span><span class="op" id="3314909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314912">//&nbsp;To16&nbsp;converts&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip&nbsp;to&nbsp;a&nbsp;16-byte&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="3314976">//&nbsp;If&nbsp;ip&nbsp;is&nbsp;not&nbsp;an&nbsp;IP&nbsp;address&nbsp;(it&nbsp;is&nbsp;the&nbsp;wrong&nbsp;length),&nbsp;To16&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">195</span><span class="keyword" id="3315050">func</span>&nbsp;<span class="op" id="3315055">(</span><span class="ident" id="3315056">ip</span>&nbsp;<span class="ident" id="3315059">IP</span><span class="op" id="3315061">)</span>&nbsp;<span class="ident" id="3315063">To16</span><span class="op" id="3315067">(</span><span class="op" id="3315068">)</span>&nbsp;<span class="ident" id="3315070">IP</span>&nbsp;<span class="op" id="3315073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315076">if</span>&nbsp;<span class="builtinfunc" id="3315079">len</span><span class="op" id="3315082">(</span><span class="ident" id="3315083">ip</span><span class="op" id="3315085">)</span>&nbsp;<span class="op" id="3315087">==</span>&nbsp;<span class="ident" id="3315090">IPv4len</span>&nbsp;<span class="op" id="3315098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315102">return</span>&nbsp;<span class="ident" id="3315109">IPv4</span><span class="op" id="3315113">(</span><span class="ident" id="3315114">ip</span><span class="op" id="3315116">[</span><span class="num" id="3315117">0</span><span class="op" id="3315118">]</span><span class="op" id="3315119">,</span>&nbsp;<span class="ident" id="3315121">ip</span><span class="op" id="3315123">[</span><span class="num" id="3315124">1</span><span class="op" id="3315125">]</span><span class="op" id="3315126">,</span>&nbsp;<span class="ident" id="3315128">ip</span><span class="op" id="3315130">[</span><span class="num" id="3315131">2</span><span class="op" id="3315132">]</span><span class="op" id="3315133">,</span>&nbsp;<span class="ident" id="3315135">ip</span><span class="op" id="3315137">[</span><span class="num" id="3315138">3</span><span class="op" id="3315139">]</span><span class="op" id="3315140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315146">if</span>&nbsp;<span class="builtinfunc" id="3315149">len</span><span class="op" id="3315152">(</span><span class="ident" id="3315153">ip</span><span class="op" id="3315155">)</span>&nbsp;<span class="op" id="3315157">==</span>&nbsp;<span class="ident" id="3315160">IPv6len</span>&nbsp;<span class="op" id="3315168">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315172">return</span>&nbsp;<span class="ident" id="3315179">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315186">return</span>&nbsp;<span class="ident" id="3315193">nil</span><br>
<span class="lineno"></span><span class="op" id="3315197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3315200">//&nbsp;Default&nbsp;route&nbsp;masks&nbsp;for&nbsp;IPv4.</span><br>
<span class="lineno"></span><span class="keyword" id="3315233">var</span>&nbsp;<span class="op" id="3315237">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315240">classAMask</span>&nbsp;<span class="op" id="3315251">=</span>&nbsp;<span class="ident" id="3315253">IPv4Mask</span><span class="op" id="3315261">(</span><span class="num" id="3315262">0xff</span><span class="op" id="3315266">,</span>&nbsp;<span class="num" id="3315268">0</span><span class="op" id="3315269">,</span>&nbsp;<span class="num" id="3315271">0</span><span class="op" id="3315272">,</span>&nbsp;<span class="num" id="3315274">0</span><span class="op" id="3315275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315278">classBMask</span>&nbsp;<span class="op" id="3315289">=</span>&nbsp;<span class="ident" id="3315291">IPv4Mask</span><span class="op" id="3315299">(</span><span class="num" id="3315300">0xff</span><span class="op" id="3315304">,</span>&nbsp;<span class="num" id="3315306">0xff</span><span class="op" id="3315310">,</span>&nbsp;<span class="num" id="3315312">0</span><span class="op" id="3315313">,</span>&nbsp;<span class="num" id="3315315">0</span><span class="op" id="3315316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3315319">classCMask</span>&nbsp;<span class="op" id="3315330">=</span>&nbsp;<span class="ident" id="3315332">IPv4Mask</span><span class="op" id="3315340">(</span><span class="num" id="3315341">0xff</span><span class="op" id="3315345">,</span>&nbsp;<span class="num" id="3315347">0xff</span><span class="op" id="3315351">,</span>&nbsp;<span class="num" id="3315353">0xff</span><span class="op" id="3315357">,</span>&nbsp;<span class="num" id="3315359">0</span><span class="op" id="3315360">)</span><br>
<span class="lineno">210</span><span class="op" id="3315362">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315365">//&nbsp;DefaultMask&nbsp;returns&nbsp;the&nbsp;default&nbsp;IP&nbsp;mask&nbsp;for&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip.</span><br>
<span class="lineno"></span><span class="comment" id="3315431">//&nbsp;Only&nbsp;IPv4&nbsp;addresses&nbsp;have&nbsp;default&nbsp;masks;&nbsp;DefaultMask&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3315494">//&nbsp;nil&nbsp;if&nbsp;ip&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;IPv4&nbsp;address.</span><br>
<span class="lineno">215</span><span class="keyword" id="3315536">func</span>&nbsp;<span class="op" id="3315541">(</span><span class="ident" id="3315542">ip</span>&nbsp;<span class="ident" id="3315545">IP</span><span class="op" id="3315547">)</span>&nbsp;<span class="ident" id="3315549">DefaultMask</span><span class="op" id="3315560">(</span><span class="op" id="3315561">)</span>&nbsp;<span class="ident" id="3315563">IPMask</span>&nbsp;<span class="op" id="3315570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315573">if</span>&nbsp;<span class="ident" id="3315576">ip</span>&nbsp;<span class="op" id="3315579">=</span>&nbsp;<span class="ident" id="3315581">ip</span><span class="op" id="3315583">.</span><span class="ident" id="3315584">To4</span><span class="op" id="3315587">(</span><span class="op" id="3315588">)</span><span class="op" id="3315589">;</span>&nbsp;<span class="ident" id="3315591">ip</span>&nbsp;<span class="op" id="3315594">==</span>&nbsp;<span class="ident" id="3315597">nil</span>&nbsp;<span class="op" id="3315601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315605">return</span>&nbsp;<span class="ident" id="3315612">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315620">switch</span>&nbsp;<span class="builtintype" id="3315627">true</span>&nbsp;<span class="op" id="3315632">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315635">case</span>&nbsp;<span class="ident" id="3315640">ip</span><span class="op" id="3315642">[</span><span class="num" id="3315643">0</span><span class="op" id="3315644">]</span>&nbsp;<span class="op" id="3315646">&lt;</span>&nbsp;<span class="num" id="3315648">0x80</span><span class="op" id="3315652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315656">return</span>&nbsp;<span class="ident" id="3315663">classAMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315675">case</span>&nbsp;<span class="ident" id="3315680">ip</span><span class="op" id="3315682">[</span><span class="num" id="3315683">0</span><span class="op" id="3315684">]</span>&nbsp;<span class="op" id="3315686">&lt;</span>&nbsp;<span class="num" id="3315688">0xC0</span><span class="op" id="3315692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315696">return</span>&nbsp;<span class="ident" id="3315703">classBMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315715">default</span><span class="op" id="3315722">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315726">return</span>&nbsp;<span class="ident" id="3315733">classCMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315745">}</span><br>
<span class="lineno"></span><span class="op" id="3315747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3315750">func</span>&nbsp;<span class="ident" id="3315755">allFF</span><span class="op" id="3315760">(</span><span class="ident" id="3315761">b</span>&nbsp;<span class="op" id="3315763">[</span><span class="op" id="3315764">]</span><span class="builtintype" id="3315765">byte</span><span class="op" id="3315769">)</span>&nbsp;<span class="builtintype" id="3315771">bool</span>&nbsp;<span class="op" id="3315776">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315779">for</span>&nbsp;<span class="ident" id="3315783">_</span><span class="op" id="3315784">,</span>&nbsp;<span class="ident" id="3315786">c</span>&nbsp;<span class="op" id="3315788">:=</span>&nbsp;<span class="keyword" id="3315791">range</span>&nbsp;<span class="ident" id="3315797">b</span>&nbsp;<span class="op" id="3315799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315803">if</span>&nbsp;<span class="ident" id="3315806">c</span>&nbsp;<span class="op" id="3315808">!=</span>&nbsp;<span class="num" id="3315811">0xff</span>&nbsp;<span class="op" id="3315816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315821">return</span>&nbsp;<span class="builtintype" id="3315828">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3315839">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315842">return</span>&nbsp;<span class="builtintype" id="3315849">true</span><br>
<span class="lineno"></span><span class="op" id="3315854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3315857">//&nbsp;Mask&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;masking&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip&nbsp;with&nbsp;mask.</span><br>
<span class="lineno"></span><span class="keyword" id="3315924">func</span>&nbsp;<span class="op" id="3315929">(</span><span class="ident" id="3315930">ip</span>&nbsp;<span class="ident" id="3315933">IP</span><span class="op" id="3315935">)</span>&nbsp;<span class="ident" id="3315937">Mask</span><span class="op" id="3315941">(</span><span class="ident" id="3315942">mask</span>&nbsp;<span class="ident" id="3315947">IPMask</span><span class="op" id="3315953">)</span>&nbsp;<span class="ident" id="3315955">IP</span>&nbsp;<span class="op" id="3315958">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3315961">if</span>&nbsp;<span class="builtinfunc" id="3315964">len</span><span class="op" id="3315967">(</span><span class="ident" id="3315968">mask</span><span class="op" id="3315972">)</span>&nbsp;<span class="op" id="3315974">==</span>&nbsp;<span class="ident" id="3315977">IPv6len</span>&nbsp;<span class="op" id="3315985">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3315988">len</span><span class="op" id="3315991">(</span><span class="ident" id="3315992">ip</span><span class="op" id="3315994">)</span>&nbsp;<span class="op" id="3315996">==</span>&nbsp;<span class="ident" id="3315999">IPv4len</span>&nbsp;<span class="op" id="3316007">&amp;&amp;</span>&nbsp;<span class="ident" id="3316010">allFF</span><span class="op" id="3316015">(</span><span class="ident" id="3316016">mask</span><span class="op" id="3316020">[</span><span class="op" id="3316021">:</span><span class="num" id="3316022">12</span><span class="op" id="3316024">]</span><span class="op" id="3316025">)</span>&nbsp;<span class="op" id="3316027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316031">mask</span>&nbsp;<span class="op" id="3316036">=</span>&nbsp;<span class="ident" id="3316038">mask</span><span class="op" id="3316042">[</span><span class="num" id="3316043">12</span><span class="op" id="3316045">:</span><span class="op" id="3316046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316052">if</span>&nbsp;<span class="builtinfunc" id="3316055">len</span><span class="op" id="3316058">(</span><span class="ident" id="3316059">mask</span><span class="op" id="3316063">)</span>&nbsp;<span class="op" id="3316065">==</span>&nbsp;<span class="ident" id="3316068">IPv4len</span>&nbsp;<span class="op" id="3316076">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3316079">len</span><span class="op" id="3316082">(</span><span class="ident" id="3316083">ip</span><span class="op" id="3316085">)</span>&nbsp;<span class="op" id="3316087">==</span>&nbsp;<span class="ident" id="3316090">IPv6len</span>&nbsp;<span class="op" id="3316098">&amp;&amp;</span>&nbsp;<span class="ident" id="3316101">bytesEqual</span><span class="op" id="3316111">(</span><span class="ident" id="3316112">ip</span><span class="op" id="3316114">[</span><span class="op" id="3316115">:</span><span class="num" id="3316116">12</span><span class="op" id="3316118">]</span><span class="op" id="3316119">,</span>&nbsp;<span class="ident" id="3316121">v4InV6Prefix</span><span class="op" id="3316133">)</span>&nbsp;<span class="op" id="3316135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316139">ip</span>&nbsp;<span class="op" id="3316142">=</span>&nbsp;<span class="ident" id="3316144">ip</span><span class="op" id="3316146">[</span><span class="num" id="3316147">12</span><span class="op" id="3316149">:</span><span class="op" id="3316150">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316156">n</span>&nbsp;<span class="op" id="3316158">:=</span>&nbsp;<span class="builtinfunc" id="3316161">len</span><span class="op" id="3316164">(</span><span class="ident" id="3316165">ip</span><span class="op" id="3316167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316170">if</span>&nbsp;<span class="ident" id="3316173">n</span>&nbsp;<span class="op" id="3316175">!=</span>&nbsp;<span class="builtinfunc" id="3316178">len</span><span class="op" id="3316181">(</span><span class="ident" id="3316182">mask</span><span class="op" id="3316186">)</span>&nbsp;<span class="op" id="3316188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316192">return</span>&nbsp;<span class="ident" id="3316199">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316204">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316207">out</span>&nbsp;<span class="op" id="3316211">:=</span>&nbsp;<span class="builtinfunc" id="3316214">make</span><span class="op" id="3316218">(</span><span class="ident" id="3316219">IP</span><span class="op" id="3316221">,</span>&nbsp;<span class="ident" id="3316223">n</span><span class="op" id="3316224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316227">for</span>&nbsp;<span class="ident" id="3316231">i</span>&nbsp;<span class="op" id="3316233">:=</span>&nbsp;<span class="num" id="3316236">0</span><span class="op" id="3316237">;</span>&nbsp;<span class="ident" id="3316239">i</span>&nbsp;<span class="op" id="3316241">&lt;</span>&nbsp;<span class="ident" id="3316243">n</span><span class="op" id="3316244">;</span>&nbsp;<span class="ident" id="3316246">i</span><span class="op" id="3316247">++</span>&nbsp;<span class="op" id="3316250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316254">out</span><span class="op" id="3316257">[</span><span class="ident" id="3316258">i</span><span class="op" id="3316259">]</span>&nbsp;<span class="op" id="3316261">=</span>&nbsp;<span class="ident" id="3316263">ip</span><span class="op" id="3316265">[</span><span class="ident" id="3316266">i</span><span class="op" id="3316267">]</span>&nbsp;<span class="op" id="3316269">&amp;</span>&nbsp;<span class="ident" id="3316271">mask</span><span class="op" id="3316275">[</span><span class="ident" id="3316276">i</span><span class="op" id="3316277">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316283">return</span>&nbsp;<span class="ident" id="3316290">out</span><br>
<span class="lineno">255</span><span class="op" id="3316294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316297">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;IP&nbsp;address&nbsp;ip.</span><br>
<span class="lineno"></span><span class="comment" id="3316353">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;the&nbsp;string&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="3316417">//&nbsp;is&nbsp;dotted&nbsp;decimal&nbsp;(&#34;74.125.19.99&#34;).&nbsp;&nbsp;Otherwise&nbsp;the&nbsp;representation</span><br>
<span class="lineno">260</span><span class="comment" id="3316486">//&nbsp;is&nbsp;IPv6&nbsp;(&#34;2001:4860:0:2001::68&#34;).</span><br>
<span class="lineno"></span><span class="keyword" id="3316523">func</span>&nbsp;<span class="op" id="3316528">(</span><span class="ident" id="3316529">ip</span>&nbsp;<span class="ident" id="3316532">IP</span><span class="op" id="3316534">)</span>&nbsp;<span class="ident" id="3316536">String</span><span class="op" id="3316542">(</span><span class="op" id="3316543">)</span>&nbsp;<span class="builtintype" id="3316545">string</span>&nbsp;<span class="op" id="3316552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316555">p</span>&nbsp;<span class="op" id="3316557">:=</span>&nbsp;<span class="ident" id="3316560">ip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316565">if</span>&nbsp;<span class="builtinfunc" id="3316568">len</span><span class="op" id="3316571">(</span><span class="ident" id="3316572">ip</span><span class="op" id="3316574">)</span>&nbsp;<span class="op" id="3316576">==</span>&nbsp;<span class="num" id="3316579">0</span>&nbsp;<span class="op" id="3316581">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316585">return</span>&nbsp;<span class="string" id="3316592">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316605">//&nbsp;If&nbsp;IPv4,&nbsp;use&nbsp;dotted&nbsp;notation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316639">if</span>&nbsp;<span class="ident" id="3316642">p4</span>&nbsp;<span class="op" id="3316645">:=</span>&nbsp;<span class="ident" id="3316648">p</span><span class="op" id="3316649">.</span><span class="ident" id="3316650">To4</span><span class="op" id="3316653">(</span><span class="op" id="3316654">)</span><span class="op" id="3316655">;</span>&nbsp;<span class="builtinfunc" id="3316657">len</span><span class="op" id="3316660">(</span><span class="ident" id="3316661">p4</span><span class="op" id="3316663">)</span>&nbsp;<span class="op" id="3316665">==</span>&nbsp;<span class="ident" id="3316668">IPv4len</span>&nbsp;<span class="op" id="3316676">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316680">return</span>&nbsp;<span class="ident" id="3316687">itod</span><span class="op" id="3316691">(</span><span class="builtintype" id="3316692">uint</span><span class="op" id="3316696">(</span><span class="ident" id="3316697">p4</span><span class="op" id="3316699">[</span><span class="num" id="3316700">0</span><span class="op" id="3316701">]</span><span class="op" id="3316702">)</span><span class="op" id="3316703">)</span>&nbsp;<span class="op" id="3316705">+</span>&nbsp;<span class="string" id="3316707">&#34;.&#34;</span>&nbsp;<span class="op" id="3316711">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316716">itod</span><span class="op" id="3316720">(</span><span class="builtintype" id="3316721">uint</span><span class="op" id="3316725">(</span><span class="ident" id="3316726">p4</span><span class="op" id="3316728">[</span><span class="num" id="3316729">1</span><span class="op" id="3316730">]</span><span class="op" id="3316731">)</span><span class="op" id="3316732">)</span>&nbsp;<span class="op" id="3316734">+</span>&nbsp;<span class="string" id="3316736">&#34;.&#34;</span>&nbsp;<span class="op" id="3316740">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316745">itod</span><span class="op" id="3316749">(</span><span class="builtintype" id="3316750">uint</span><span class="op" id="3316754">(</span><span class="ident" id="3316755">p4</span><span class="op" id="3316757">[</span><span class="num" id="3316758">2</span><span class="op" id="3316759">]</span><span class="op" id="3316760">)</span><span class="op" id="3316761">)</span>&nbsp;<span class="op" id="3316763">+</span>&nbsp;<span class="string" id="3316765">&#34;.&#34;</span>&nbsp;<span class="op" id="3316769">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316774">itod</span><span class="op" id="3316778">(</span><span class="builtintype" id="3316779">uint</span><span class="op" id="3316783">(</span><span class="ident" id="3316784">p4</span><span class="op" id="3316786">[</span><span class="num" id="3316787">3</span><span class="op" id="3316788">]</span><span class="op" id="3316789">)</span><span class="op" id="3316790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316793">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316796">if</span>&nbsp;<span class="builtinfunc" id="3316799">len</span><span class="op" id="3316802">(</span><span class="ident" id="3316803">p</span><span class="op" id="3316804">)</span>&nbsp;<span class="op" id="3316806">!=</span>&nbsp;<span class="ident" id="3316809">IPv6len</span>&nbsp;<span class="op" id="3316817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316821">return</span>&nbsp;<span class="string" id="3316828">&#34;?&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3316837">//&nbsp;Find&nbsp;longest&nbsp;run&nbsp;of&nbsp;zeros.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316868">e0</span>&nbsp;<span class="op" id="3316871">:=</span>&nbsp;<span class="op" id="3316874">-</span><span class="num" id="3316875">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316878">e1</span>&nbsp;<span class="op" id="3316881">:=</span>&nbsp;<span class="op" id="3316884">-</span><span class="num" id="3316885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316888">for</span>&nbsp;<span class="ident" id="3316892">i</span>&nbsp;<span class="op" id="3316894">:=</span>&nbsp;<span class="num" id="3316897">0</span><span class="op" id="3316898">;</span>&nbsp;<span class="ident" id="3316900">i</span>&nbsp;<span class="op" id="3316902">&lt;</span>&nbsp;<span class="ident" id="3316904">IPv6len</span><span class="op" id="3316911">;</span>&nbsp;<span class="ident" id="3316913">i</span>&nbsp;<span class="op" id="3316915">+=</span>&nbsp;<span class="num" id="3316918">2</span>&nbsp;<span class="op" id="3316920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316924">j</span>&nbsp;<span class="op" id="3316926">:=</span>&nbsp;<span class="ident" id="3316929">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316933">for</span>&nbsp;<span class="ident" id="3316937">j</span>&nbsp;<span class="op" id="3316939">&lt;</span>&nbsp;<span class="ident" id="3316941">IPv6len</span>&nbsp;<span class="op" id="3316949">&amp;&amp;</span>&nbsp;<span class="ident" id="3316952">p</span><span class="op" id="3316953">[</span><span class="ident" id="3316954">j</span><span class="op" id="3316955">]</span>&nbsp;<span class="op" id="3316957">==</span>&nbsp;<span class="num" id="3316960">0</span>&nbsp;<span class="op" id="3316962">&amp;&amp;</span>&nbsp;<span class="ident" id="3316965">p</span><span class="op" id="3316966">[</span><span class="ident" id="3316967">j</span><span class="op" id="3316968">+</span><span class="num" id="3316969">1</span><span class="op" id="3316970">]</span>&nbsp;<span class="op" id="3316972">==</span>&nbsp;<span class="num" id="3316975">0</span>&nbsp;<span class="op" id="3316977">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3316982">j</span>&nbsp;<span class="op" id="3316984">+=</span>&nbsp;<span class="num" id="3316987">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3316991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3316995">if</span>&nbsp;<span class="ident" id="3316998">j</span>&nbsp;<span class="op" id="3317000">&gt;</span>&nbsp;<span class="ident" id="3317002">i</span>&nbsp;<span class="op" id="3317004">&amp;&amp;</span>&nbsp;<span class="ident" id="3317007">j</span><span class="op" id="3317008">-</span><span class="ident" id="3317009">i</span>&nbsp;<span class="op" id="3317011">&gt;</span>&nbsp;<span class="ident" id="3317013">e1</span><span class="op" id="3317015">-</span><span class="ident" id="3317016">e0</span>&nbsp;<span class="op" id="3317019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317024">e0</span>&nbsp;<span class="op" id="3317027">=</span>&nbsp;<span class="ident" id="3317029">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317034">e1</span>&nbsp;<span class="op" id="3317037">=</span>&nbsp;<span class="ident" id="3317039">j</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317044">i</span>&nbsp;<span class="op" id="3317046">=</span>&nbsp;<span class="ident" id="3317048">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317058">//&nbsp;The&nbsp;symbol&nbsp;&#34;::&#34;&nbsp;MUST&nbsp;NOT&nbsp;be&nbsp;used&nbsp;to&nbsp;shorten&nbsp;just&nbsp;one&nbsp;16&nbsp;bit&nbsp;0&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317131">if</span>&nbsp;<span class="ident" id="3317134">e1</span><span class="op" id="3317136">-</span><span class="ident" id="3317137">e0</span>&nbsp;<span class="op" id="3317140">&lt;=</span>&nbsp;<span class="num" id="3317143">2</span>&nbsp;<span class="op" id="3317145">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317149">e0</span>&nbsp;<span class="op" id="3317152">=</span>&nbsp;<span class="op" id="3317154">-</span><span class="num" id="3317155">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317159">e1</span>&nbsp;<span class="op" id="3317162">=</span>&nbsp;<span class="op" id="3317164">-</span><span class="num" id="3317165">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317172">const</span>&nbsp;<span class="ident" id="3317178">maxLen</span>&nbsp;<span class="op" id="3317185">=</span>&nbsp;<span class="builtinfunc" id="3317187">len</span><span class="op" id="3317190">(</span><span class="string" id="3317191">&#34;ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff&#34;</span><span class="op" id="3317232">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317235">b</span>&nbsp;<span class="op" id="3317237">:=</span>&nbsp;<span class="builtinfunc" id="3317240">make</span><span class="op" id="3317244">(</span><span class="op" id="3317245">[</span><span class="op" id="3317246">]</span><span class="builtintype" id="3317247">byte</span><span class="op" id="3317251">,</span>&nbsp;<span class="num" id="3317253">0</span><span class="op" id="3317254">,</span>&nbsp;<span class="ident" id="3317256">maxLen</span><span class="op" id="3317262">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3317266">//&nbsp;Print&nbsp;with&nbsp;possible&nbsp;::&nbsp;in&nbsp;place&nbsp;of&nbsp;run&nbsp;of&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317318">for</span>&nbsp;<span class="ident" id="3317322">i</span>&nbsp;<span class="op" id="3317324">:=</span>&nbsp;<span class="num" id="3317327">0</span><span class="op" id="3317328">;</span>&nbsp;<span class="ident" id="3317330">i</span>&nbsp;<span class="op" id="3317332">&lt;</span>&nbsp;<span class="ident" id="3317334">IPv6len</span><span class="op" id="3317341">;</span>&nbsp;<span class="ident" id="3317343">i</span>&nbsp;<span class="op" id="3317345">+=</span>&nbsp;<span class="num" id="3317348">2</span>&nbsp;<span class="op" id="3317350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317354">if</span>&nbsp;<span class="ident" id="3317357">i</span>&nbsp;<span class="op" id="3317359">==</span>&nbsp;<span class="ident" id="3317362">e0</span>&nbsp;<span class="op" id="3317365">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317370">b</span>&nbsp;<span class="op" id="3317372">=</span>&nbsp;<span class="builtinfunc" id="3317374">append</span><span class="op" id="3317380">(</span><span class="ident" id="3317381">b</span><span class="op" id="3317382">,</span>&nbsp;<span class="string" id="3317384">&#39;:&#39;</span><span class="op" id="3317387">,</span>&nbsp;<span class="string" id="3317389">&#39;:&#39;</span><span class="op" id="3317392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317397">i</span>&nbsp;<span class="op" id="3317399">=</span>&nbsp;<span class="ident" id="3317401">e1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317407">if</span>&nbsp;<span class="ident" id="3317410">i</span>&nbsp;<span class="op" id="3317412">&gt;=</span>&nbsp;<span class="ident" id="3317415">IPv6len</span>&nbsp;<span class="op" id="3317423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317429">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317438">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317442">}</span>&nbsp;<span class="keyword" id="3317444">else</span>&nbsp;<span class="keyword" id="3317449">if</span>&nbsp;<span class="ident" id="3317452">i</span>&nbsp;<span class="op" id="3317454">&gt;</span>&nbsp;<span class="num" id="3317456">0</span>&nbsp;<span class="op" id="3317458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317463">b</span>&nbsp;<span class="op" id="3317465">=</span>&nbsp;<span class="builtinfunc" id="3317467">append</span><span class="op" id="3317473">(</span><span class="ident" id="3317474">b</span><span class="op" id="3317475">,</span>&nbsp;<span class="string" id="3317477">&#39;:&#39;</span><span class="op" id="3317480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3317488">b</span>&nbsp;<span class="op" id="3317490">=</span>&nbsp;<span class="ident" id="3317492">appendHex</span><span class="op" id="3317501">(</span><span class="ident" id="3317502">b</span><span class="op" id="3317503">,</span>&nbsp;<span class="op" id="3317505">(</span><span class="builtintype" id="3317506">uint32</span><span class="op" id="3317512">(</span><span class="ident" id="3317513">p</span><span class="op" id="3317514">[</span><span class="ident" id="3317515">i</span><span class="op" id="3317516">]</span><span class="op" id="3317517">)</span><span class="op" id="3317518">&lt;&lt;</span><span class="num" id="3317520">8</span><span class="op" id="3317521">)</span><span class="op" id="3317522">|</span><span class="builtintype" id="3317523">uint32</span><span class="op" id="3317529">(</span><span class="ident" id="3317530">p</span><span class="op" id="3317531">[</span><span class="ident" id="3317532">i</span><span class="op" id="3317533">+</span><span class="num" id="3317534">1</span><span class="op" id="3317535">]</span><span class="op" id="3317536">)</span><span class="op" id="3317537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317540">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317543">return</span>&nbsp;<span class="builtintype" id="3317550">string</span><span class="op" id="3317556">(</span><span class="ident" id="3317557">b</span><span class="op" id="3317558">)</span><br>
<span class="lineno"></span><span class="op" id="3317560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317563">//&nbsp;ipEmptyString&nbsp;is&nbsp;like&nbsp;ip.String&nbsp;except&nbsp;that&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3317621">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;when&nbsp;ip&nbsp;is&nbsp;unset.</span><br>
<span class="lineno">320</span><span class="keyword" id="3317658">func</span>&nbsp;<span class="ident" id="3317663">ipEmptyString</span><span class="op" id="3317676">(</span><span class="ident" id="3317677">ip</span>&nbsp;<span class="ident" id="3317680">IP</span><span class="op" id="3317682">)</span>&nbsp;<span class="builtintype" id="3317684">string</span>&nbsp;<span class="op" id="3317691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317694">if</span>&nbsp;<span class="builtinfunc" id="3317697">len</span><span class="op" id="3317700">(</span><span class="ident" id="3317701">ip</span><span class="op" id="3317703">)</span>&nbsp;<span class="op" id="3317705">==</span>&nbsp;<span class="num" id="3317708">0</span>&nbsp;<span class="op" id="3317710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317714">return</span>&nbsp;<span class="string" id="3317721">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317728">return</span>&nbsp;<span class="ident" id="3317735">ip</span><span class="op" id="3317737">.</span><span class="ident" id="3317738">String</span><span class="op" id="3317744">(</span><span class="op" id="3317745">)</span><br>
<span class="lineno">325</span><span class="op" id="3317747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317750">//&nbsp;MarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextMarshaler&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3317814">//&nbsp;The&nbsp;encoding&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;returned&nbsp;by&nbsp;String.</span><br>
<span class="lineno"></span><span class="keyword" id="3317865">func</span>&nbsp;<span class="op" id="3317870">(</span><span class="ident" id="3317871">ip</span>&nbsp;<span class="ident" id="3317874">IP</span><span class="op" id="3317876">)</span>&nbsp;<span class="ident" id="3317878">MarshalText</span><span class="op" id="3317889">(</span><span class="op" id="3317890">)</span>&nbsp;<span class="op" id="3317892">(</span><span class="op" id="3317893">[</span><span class="op" id="3317894">]</span><span class="builtintype" id="3317895">byte</span><span class="op" id="3317899">,</span>&nbsp;<span class="builtintype" id="3317901">error</span><span class="op" id="3317906">)</span>&nbsp;<span class="op" id="3317908">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317911">if</span>&nbsp;<span class="builtinfunc" id="3317914">len</span><span class="op" id="3317917">(</span><span class="ident" id="3317918">ip</span><span class="op" id="3317920">)</span>&nbsp;<span class="op" id="3317922">==</span>&nbsp;<span class="num" id="3317925">0</span>&nbsp;<span class="op" id="3317927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317931">return</span>&nbsp;<span class="op" id="3317938">[</span><span class="op" id="3317939">]</span><span class="builtintype" id="3317940">byte</span><span class="op" id="3317944">(</span><span class="string" id="3317945">&#34;&#34;</span><span class="op" id="3317947">)</span><span class="op" id="3317948">,</span>&nbsp;<span class="ident" id="3317950">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3317955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3317958">if</span>&nbsp;<span class="builtinfunc" id="3317961">len</span><span class="op" id="3317964">(</span><span class="ident" id="3317965">ip</span><span class="op" id="3317967">)</span>&nbsp;<span class="op" id="3317969">!=</span>&nbsp;<span class="ident" id="3317972">IPv4len</span>&nbsp;<span class="op" id="3317980">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3317983">len</span><span class="op" id="3317986">(</span><span class="ident" id="3317987">ip</span><span class="op" id="3317989">)</span>&nbsp;<span class="op" id="3317991">!=</span>&nbsp;<span class="ident" id="3317994">IPv6len</span>&nbsp;<span class="op" id="3318002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318006">return</span>&nbsp;<span class="ident" id="3318013">nil</span><span class="op" id="3318016">,</span>&nbsp;<span class="ident" id="3318018">errors</span><span class="op" id="3318024">.</span><span class="ident" id="3318025">New</span><span class="op" id="3318028">(</span><span class="string" id="3318029">&#34;invalid&nbsp;IP&nbsp;address&#34;</span><span class="op" id="3318049">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318055">return</span>&nbsp;<span class="op" id="3318062">[</span><span class="op" id="3318063">]</span><span class="builtintype" id="3318064">byte</span><span class="op" id="3318068">(</span><span class="ident" id="3318069">ip</span><span class="op" id="3318071">.</span><span class="ident" id="3318072">String</span><span class="op" id="3318078">(</span><span class="op" id="3318079">)</span><span class="op" id="3318080">)</span><span class="op" id="3318081">,</span>&nbsp;<span class="ident" id="3318083">nil</span><br>
<span class="lineno"></span><span class="op" id="3318087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318090">//&nbsp;UnmarshalText&nbsp;implements&nbsp;the&nbsp;encoding.TextUnmarshaler&nbsp;interface.</span><br>
<span class="lineno">340</span><span class="comment" id="3318158">//&nbsp;The&nbsp;IP&nbsp;address&nbsp;is&nbsp;expected&nbsp;in&nbsp;a&nbsp;form&nbsp;accepted&nbsp;by&nbsp;ParseIP.</span><br>
<span class="lineno"></span><span class="keyword" id="3318219">func</span>&nbsp;<span class="op" id="3318224">(</span><span class="ident" id="3318225">ip</span>&nbsp;<span class="op" id="3318228">*</span><span class="ident" id="3318229">IP</span><span class="op" id="3318231">)</span>&nbsp;<span class="ident" id="3318233">UnmarshalText</span><span class="op" id="3318246">(</span><span class="ident" id="3318247">text</span>&nbsp;<span class="op" id="3318252">[</span><span class="op" id="3318253">]</span><span class="builtintype" id="3318254">byte</span><span class="op" id="3318258">)</span>&nbsp;<span class="builtintype" id="3318260">error</span>&nbsp;<span class="op" id="3318266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318269">if</span>&nbsp;<span class="builtinfunc" id="3318272">len</span><span class="op" id="3318275">(</span><span class="ident" id="3318276">text</span><span class="op" id="3318280">)</span>&nbsp;<span class="op" id="3318282">==</span>&nbsp;<span class="num" id="3318285">0</span>&nbsp;<span class="op" id="3318287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318291">*</span><span class="ident" id="3318292">ip</span>&nbsp;<span class="op" id="3318295">=</span>&nbsp;<span class="ident" id="3318297">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318303">return</span>&nbsp;<span class="ident" id="3318310">nil</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318318">s</span>&nbsp;<span class="op" id="3318320">:=</span>&nbsp;<span class="builtintype" id="3318323">string</span><span class="op" id="3318329">(</span><span class="ident" id="3318330">text</span><span class="op" id="3318334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3318337">x</span>&nbsp;<span class="op" id="3318339">:=</span>&nbsp;<span class="ident" id="3318342">ParseIP</span><span class="op" id="3318349">(</span><span class="ident" id="3318350">s</span><span class="op" id="3318351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318354">if</span>&nbsp;<span class="ident" id="3318357">x</span>&nbsp;<span class="op" id="3318359">==</span>&nbsp;<span class="ident" id="3318362">nil</span>&nbsp;<span class="op" id="3318366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318370">return</span>&nbsp;<span class="op" id="3318377">&amp;</span><span class="ident" id="3318378">ParseError</span><span class="op" id="3318388">{</span><span class="string" id="3318389">&#34;IP&nbsp;address&#34;</span><span class="op" id="3318401">,</span>&nbsp;<span class="ident" id="3318403">s</span><span class="op" id="3318404">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318410">*</span><span class="ident" id="3318411">ip</span>&nbsp;<span class="op" id="3318414">=</span>&nbsp;<span class="ident" id="3318416">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318419">return</span>&nbsp;<span class="ident" id="3318426">nil</span><br>
<span class="lineno"></span><span class="op" id="3318430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3318433">//&nbsp;Equal&nbsp;returns&nbsp;true&nbsp;if&nbsp;ip&nbsp;and&nbsp;x&nbsp;are&nbsp;the&nbsp;same&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3318492">//&nbsp;An&nbsp;IPv4&nbsp;address&nbsp;and&nbsp;that&nbsp;same&nbsp;address&nbsp;in&nbsp;IPv6&nbsp;form&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3318550">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;equal.</span><br>
<span class="lineno"></span><span class="keyword" id="3318577">func</span>&nbsp;<span class="op" id="3318582">(</span><span class="ident" id="3318583">ip</span>&nbsp;<span class="ident" id="3318586">IP</span><span class="op" id="3318588">)</span>&nbsp;<span class="ident" id="3318590">Equal</span><span class="op" id="3318595">(</span><span class="ident" id="3318596">x</span>&nbsp;<span class="ident" id="3318598">IP</span><span class="op" id="3318600">)</span>&nbsp;<span class="builtintype" id="3318602">bool</span>&nbsp;<span class="op" id="3318607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318610">if</span>&nbsp;<span class="builtinfunc" id="3318613">len</span><span class="op" id="3318616">(</span><span class="ident" id="3318617">ip</span><span class="op" id="3318619">)</span>&nbsp;<span class="op" id="3318621">==</span>&nbsp;<span class="builtinfunc" id="3318624">len</span><span class="op" id="3318627">(</span><span class="ident" id="3318628">x</span><span class="op" id="3318629">)</span>&nbsp;<span class="op" id="3318631">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318635">return</span>&nbsp;<span class="ident" id="3318642">bytesEqual</span><span class="op" id="3318652">(</span><span class="ident" id="3318653">ip</span><span class="op" id="3318655">,</span>&nbsp;<span class="ident" id="3318657">x</span><span class="op" id="3318658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318664">if</span>&nbsp;<span class="builtinfunc" id="3318667">len</span><span class="op" id="3318670">(</span><span class="ident" id="3318671">ip</span><span class="op" id="3318673">)</span>&nbsp;<span class="op" id="3318675">==</span>&nbsp;<span class="ident" id="3318678">IPv4len</span>&nbsp;<span class="op" id="3318686">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3318689">len</span><span class="op" id="3318692">(</span><span class="ident" id="3318693">x</span><span class="op" id="3318694">)</span>&nbsp;<span class="op" id="3318696">==</span>&nbsp;<span class="ident" id="3318699">IPv6len</span>&nbsp;<span class="op" id="3318707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318711">return</span>&nbsp;<span class="ident" id="3318718">bytesEqual</span><span class="op" id="3318728">(</span><span class="ident" id="3318729">x</span><span class="op" id="3318730">[</span><span class="num" id="3318731">0</span><span class="op" id="3318732">:</span><span class="num" id="3318733">12</span><span class="op" id="3318735">]</span><span class="op" id="3318736">,</span>&nbsp;<span class="ident" id="3318738">v4InV6Prefix</span><span class="op" id="3318750">)</span>&nbsp;<span class="op" id="3318752">&amp;&amp;</span>&nbsp;<span class="ident" id="3318755">bytesEqual</span><span class="op" id="3318765">(</span><span class="ident" id="3318766">ip</span><span class="op" id="3318768">,</span>&nbsp;<span class="ident" id="3318770">x</span><span class="op" id="3318771">[</span><span class="num" id="3318772">12</span><span class="op" id="3318774">:</span><span class="op" id="3318775">]</span><span class="op" id="3318776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318779">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318782">if</span>&nbsp;<span class="builtinfunc" id="3318785">len</span><span class="op" id="3318788">(</span><span class="ident" id="3318789">ip</span><span class="op" id="3318791">)</span>&nbsp;<span class="op" id="3318793">==</span>&nbsp;<span class="ident" id="3318796">IPv6len</span>&nbsp;<span class="op" id="3318804">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3318807">len</span><span class="op" id="3318810">(</span><span class="ident" id="3318811">x</span><span class="op" id="3318812">)</span>&nbsp;<span class="op" id="3318814">==</span>&nbsp;<span class="ident" id="3318817">IPv4len</span>&nbsp;<span class="op" id="3318825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318829">return</span>&nbsp;<span class="ident" id="3318836">bytesEqual</span><span class="op" id="3318846">(</span><span class="ident" id="3318847">ip</span><span class="op" id="3318849">[</span><span class="num" id="3318850">0</span><span class="op" id="3318851">:</span><span class="num" id="3318852">12</span><span class="op" id="3318854">]</span><span class="op" id="3318855">,</span>&nbsp;<span class="ident" id="3318857">v4InV6Prefix</span><span class="op" id="3318869">)</span>&nbsp;<span class="op" id="3318871">&amp;&amp;</span>&nbsp;<span class="ident" id="3318874">bytesEqual</span><span class="op" id="3318884">(</span><span class="ident" id="3318885">ip</span><span class="op" id="3318887">[</span><span class="num" id="3318888">12</span><span class="op" id="3318890">:</span><span class="op" id="3318891">]</span><span class="op" id="3318892">,</span>&nbsp;<span class="ident" id="3318894">x</span><span class="op" id="3318895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318901">return</span>&nbsp;<span class="builtintype" id="3318908">false</span><br>
<span class="lineno"></span><span class="op" id="3318914">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span><span class="keyword" id="3318917">func</span>&nbsp;<span class="ident" id="3318922">bytesEqual</span><span class="op" id="3318932">(</span><span class="ident" id="3318933">x</span><span class="op" id="3318934">,</span>&nbsp;<span class="ident" id="3318936">y</span>&nbsp;<span class="op" id="3318938">[</span><span class="op" id="3318939">]</span><span class="builtintype" id="3318940">byte</span><span class="op" id="3318944">)</span>&nbsp;<span class="builtintype" id="3318946">bool</span>&nbsp;<span class="op" id="3318951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318954">if</span>&nbsp;<span class="builtinfunc" id="3318957">len</span><span class="op" id="3318960">(</span><span class="ident" id="3318961">x</span><span class="op" id="3318962">)</span>&nbsp;<span class="op" id="3318964">!=</span>&nbsp;<span class="builtinfunc" id="3318967">len</span><span class="op" id="3318970">(</span><span class="ident" id="3318971">y</span><span class="op" id="3318972">)</span>&nbsp;<span class="op" id="3318974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318978">return</span>&nbsp;<span class="builtintype" id="3318985">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3318992">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3318995">for</span>&nbsp;<span class="ident" id="3318999">i</span><span class="op" id="3319000">,</span>&nbsp;<span class="ident" id="3319002">b</span>&nbsp;<span class="op" id="3319004">:=</span>&nbsp;<span class="keyword" id="3319007">range</span>&nbsp;<span class="ident" id="3319013">x</span>&nbsp;<span class="op" id="3319015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319019">if</span>&nbsp;<span class="ident" id="3319022">y</span><span class="op" id="3319023">[</span><span class="ident" id="3319024">i</span><span class="op" id="3319025">]</span>&nbsp;<span class="op" id="3319027">!=</span>&nbsp;<span class="ident" id="3319030">b</span>&nbsp;<span class="op" id="3319032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319037">return</span>&nbsp;<span class="builtintype" id="3319044">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319055">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319058">return</span>&nbsp;<span class="builtintype" id="3319065">true</span><br>
<span class="lineno"></span><span class="op" id="3319070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319073">//&nbsp;If&nbsp;mask&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;1&nbsp;bits&nbsp;followed&nbsp;by&nbsp;0&nbsp;bits,</span><br>
<span class="lineno"></span><span class="comment" id="3319128">//&nbsp;return&nbsp;the&nbsp;number&nbsp;of&nbsp;1&nbsp;bits.</span><br>
<span class="lineno">385</span><span class="keyword" id="3319160">func</span>&nbsp;<span class="ident" id="3319165">simpleMaskLength</span><span class="op" id="3319181">(</span><span class="ident" id="3319182">mask</span>&nbsp;<span class="ident" id="3319187">IPMask</span><span class="op" id="3319193">)</span>&nbsp;<span class="builtintype" id="3319195">int</span>&nbsp;<span class="op" id="3319199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319202">var</span>&nbsp;<span class="ident" id="3319206">n</span>&nbsp;<span class="builtintype" id="3319208">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319213">for</span>&nbsp;<span class="ident" id="3319217">i</span><span class="op" id="3319218">,</span>&nbsp;<span class="ident" id="3319220">v</span>&nbsp;<span class="op" id="3319222">:=</span>&nbsp;<span class="keyword" id="3319225">range</span>&nbsp;<span class="ident" id="3319231">mask</span>&nbsp;<span class="op" id="3319236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319240">if</span>&nbsp;<span class="ident" id="3319243">v</span>&nbsp;<span class="op" id="3319245">==</span>&nbsp;<span class="num" id="3319248">0xff</span>&nbsp;<span class="op" id="3319253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319258">n</span>&nbsp;<span class="op" id="3319260">+=</span>&nbsp;<span class="num" id="3319263">8</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319268">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319283">//&nbsp;found&nbsp;non-ff&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319306">//&nbsp;count&nbsp;1&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319324">for</span>&nbsp;<span class="ident" id="3319328">v</span><span class="op" id="3319329">&amp;</span><span class="num" id="3319330">0x80</span>&nbsp;<span class="op" id="3319335">!=</span>&nbsp;<span class="num" id="3319338">0</span>&nbsp;<span class="op" id="3319340">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319345">n</span><span class="op" id="3319346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319352">v</span>&nbsp;<span class="op" id="3319354">&lt;&lt;=</span>&nbsp;<span class="num" id="3319358">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3319366">//&nbsp;rest&nbsp;must&nbsp;be&nbsp;0&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319391">if</span>&nbsp;<span class="ident" id="3319394">v</span>&nbsp;<span class="op" id="3319396">!=</span>&nbsp;<span class="num" id="3319399">0</span>&nbsp;<span class="op" id="3319401">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319406">return</span>&nbsp;<span class="op" id="3319413">-</span><span class="num" id="3319414">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319422">for</span>&nbsp;<span class="ident" id="3319426">i</span><span class="op" id="3319427">++</span><span class="op" id="3319429">;</span>&nbsp;<span class="ident" id="3319431">i</span>&nbsp;<span class="op" id="3319433">&lt;</span>&nbsp;<span class="builtinfunc" id="3319435">len</span><span class="op" id="3319438">(</span><span class="ident" id="3319439">mask</span><span class="op" id="3319443">)</span><span class="op" id="3319444">;</span>&nbsp;<span class="ident" id="3319446">i</span><span class="op" id="3319447">++</span>&nbsp;<span class="op" id="3319450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319455">if</span>&nbsp;<span class="ident" id="3319458">mask</span><span class="op" id="3319462">[</span><span class="ident" id="3319463">i</span><span class="op" id="3319464">]</span>&nbsp;<span class="op" id="3319466">!=</span>&nbsp;<span class="num" id="3319469">0</span>&nbsp;<span class="op" id="3319471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319477">return</span>&nbsp;<span class="op" id="3319484">-</span><span class="num" id="3319485">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319498">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319508">return</span>&nbsp;<span class="ident" id="3319515">n</span><br>
<span class="lineno">410</span><span class="op" id="3319517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319520">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;ones&nbsp;and&nbsp;total&nbsp;bits&nbsp;in&nbsp;the&nbsp;mask.</span><br>
<span class="lineno"></span><span class="comment" id="3319591">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;canonical&nbsp;form--ones&nbsp;followed&nbsp;by&nbsp;zeros--then</span><br>
<span class="lineno"></span><span class="comment" id="3319665">//&nbsp;Size&nbsp;returns&nbsp;0,&nbsp;0.</span><br>
<span class="lineno">415</span><span class="keyword" id="3319687">func</span>&nbsp;<span class="op" id="3319692">(</span><span class="ident" id="3319693">m</span>&nbsp;<span class="ident" id="3319695">IPMask</span><span class="op" id="3319701">)</span>&nbsp;<span class="ident" id="3319703">Size</span><span class="op" id="3319707">(</span><span class="op" id="3319708">)</span>&nbsp;<span class="op" id="3319710">(</span><span class="ident" id="3319711">ones</span><span class="op" id="3319715">,</span>&nbsp;<span class="ident" id="3319717">bits</span>&nbsp;<span class="builtintype" id="3319722">int</span><span class="op" id="3319725">)</span>&nbsp;<span class="op" id="3319727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319730">ones</span><span class="op" id="3319734">,</span>&nbsp;<span class="ident" id="3319736">bits</span>&nbsp;<span class="op" id="3319741">=</span>&nbsp;<span class="ident" id="3319743">simpleMaskLength</span><span class="op" id="3319759">(</span><span class="ident" id="3319760">m</span><span class="op" id="3319761">)</span><span class="op" id="3319762">,</span>&nbsp;<span class="builtinfunc" id="3319764">len</span><span class="op" id="3319767">(</span><span class="ident" id="3319768">m</span><span class="op" id="3319769">)</span><span class="op" id="3319770">*</span><span class="num" id="3319771">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319774">if</span>&nbsp;<span class="ident" id="3319777">ones</span>&nbsp;<span class="op" id="3319782">==</span>&nbsp;<span class="op" id="3319785">-</span><span class="num" id="3319786">1</span>&nbsp;<span class="op" id="3319788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319792">return</span>&nbsp;<span class="num" id="3319799">0</span><span class="op" id="3319800">,</span>&nbsp;<span class="num" id="3319802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319805">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319808">return</span><br>
<span class="lineno"></span><span class="op" id="3319815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319818">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;hexadecimal&nbsp;form&nbsp;of&nbsp;m,&nbsp;with&nbsp;no&nbsp;punctuation.</span><br>
<span class="lineno"></span><span class="keyword" id="3319884">func</span>&nbsp;<span class="op" id="3319889">(</span><span class="ident" id="3319890">m</span>&nbsp;<span class="ident" id="3319892">IPMask</span><span class="op" id="3319898">)</span>&nbsp;<span class="ident" id="3319900">String</span><span class="op" id="3319906">(</span><span class="op" id="3319907">)</span>&nbsp;<span class="builtintype" id="3319909">string</span>&nbsp;<span class="op" id="3319916">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319919">if</span>&nbsp;<span class="builtinfunc" id="3319922">len</span><span class="op" id="3319925">(</span><span class="ident" id="3319926">m</span><span class="op" id="3319927">)</span>&nbsp;<span class="op" id="3319929">==</span>&nbsp;<span class="num" id="3319932">0</span>&nbsp;<span class="op" id="3319934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319938">return</span>&nbsp;<span class="string" id="3319945">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3319954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3319957">buf</span>&nbsp;<span class="op" id="3319961">:=</span>&nbsp;<span class="builtinfunc" id="3319964">make</span><span class="op" id="3319968">(</span><span class="op" id="3319969">[</span><span class="op" id="3319970">]</span><span class="builtintype" id="3319971">byte</span><span class="op" id="3319975">,</span>&nbsp;<span class="builtinfunc" id="3319977">len</span><span class="op" id="3319980">(</span><span class="ident" id="3319981">m</span><span class="op" id="3319982">)</span><span class="op" id="3319983">*</span><span class="num" id="3319984">2</span><span class="op" id="3319985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3319988">for</span>&nbsp;<span class="ident" id="3319992">i</span><span class="op" id="3319993">,</span>&nbsp;<span class="ident" id="3319995">b</span>&nbsp;<span class="op" id="3319997">:=</span>&nbsp;<span class="keyword" id="3320000">range</span>&nbsp;<span class="ident" id="3320006">m</span>&nbsp;<span class="op" id="3320008">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320012">buf</span><span class="op" id="3320015">[</span><span class="ident" id="3320016">i</span><span class="op" id="3320017">*</span><span class="num" id="3320018">2</span><span class="op" id="3320019">]</span><span class="op" id="3320020">,</span>&nbsp;<span class="ident" id="3320022">buf</span><span class="op" id="3320025">[</span><span class="ident" id="3320026">i</span><span class="op" id="3320027">*</span><span class="num" id="3320028">2</span><span class="op" id="3320029">+</span><span class="num" id="3320030">1</span><span class="op" id="3320031">]</span>&nbsp;<span class="op" id="3320033">=</span>&nbsp;<span class="ident" id="3320035">hexDigit</span><span class="op" id="3320043">[</span><span class="ident" id="3320044">b</span><span class="op" id="3320045">&gt;&gt;</span><span class="num" id="3320047">4</span><span class="op" id="3320048">]</span><span class="op" id="3320049">,</span>&nbsp;<span class="ident" id="3320051">hexDigit</span><span class="op" id="3320059">[</span><span class="ident" id="3320060">b</span><span class="op" id="3320061">&amp;</span><span class="num" id="3320062">0xf</span><span class="op" id="3320065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320071">return</span>&nbsp;<span class="builtintype" id="3320078">string</span><span class="op" id="3320084">(</span><span class="ident" id="3320085">buf</span><span class="op" id="3320088">)</span><br>
<span class="lineno"></span><span class="op" id="3320090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="3320093">func</span>&nbsp;<span class="ident" id="3320098">networkNumberAndMask</span><span class="op" id="3320118">(</span><span class="ident" id="3320119">n</span>&nbsp;<span class="op" id="3320121">*</span><span class="ident" id="3320122">IPNet</span><span class="op" id="3320127">)</span>&nbsp;<span class="op" id="3320129">(</span><span class="ident" id="3320130">ip</span>&nbsp;<span class="ident" id="3320133">IP</span><span class="op" id="3320135">,</span>&nbsp;<span class="ident" id="3320137">m</span>&nbsp;<span class="ident" id="3320139">IPMask</span><span class="op" id="3320145">)</span>&nbsp;<span class="op" id="3320147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320150">if</span>&nbsp;<span class="ident" id="3320153">ip</span>&nbsp;<span class="op" id="3320156">=</span>&nbsp;<span class="ident" id="3320158">n</span><span class="op" id="3320159">.</span><span class="ident" id="3320160">IP</span><span class="op" id="3320162">.</span><span class="ident" id="3320163">To4</span><span class="op" id="3320166">(</span><span class="op" id="3320167">)</span><span class="op" id="3320168">;</span>&nbsp;<span class="ident" id="3320170">ip</span>&nbsp;<span class="op" id="3320173">==</span>&nbsp;<span class="ident" id="3320176">nil</span>&nbsp;<span class="op" id="3320180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320184">ip</span>&nbsp;<span class="op" id="3320187">=</span>&nbsp;<span class="ident" id="3320189">n</span><span class="op" id="3320190">.</span><span class="ident" id="3320191">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320196">if</span>&nbsp;<span class="builtinfunc" id="3320199">len</span><span class="op" id="3320202">(</span><span class="ident" id="3320203">ip</span><span class="op" id="3320205">)</span>&nbsp;<span class="op" id="3320207">!=</span>&nbsp;<span class="ident" id="3320210">IPv6len</span>&nbsp;<span class="op" id="3320218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320223">return</span>&nbsp;<span class="ident" id="3320230">nil</span><span class="op" id="3320233">,</span>&nbsp;<span class="ident" id="3320235">nil</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320247">m</span>&nbsp;<span class="op" id="3320249">=</span>&nbsp;<span class="ident" id="3320251">n</span><span class="op" id="3320252">.</span><span class="ident" id="3320253">Mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320259">switch</span>&nbsp;<span class="builtinfunc" id="3320266">len</span><span class="op" id="3320269">(</span><span class="ident" id="3320270">m</span><span class="op" id="3320271">)</span>&nbsp;<span class="op" id="3320273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320276">case</span>&nbsp;<span class="ident" id="3320281">IPv4len</span><span class="op" id="3320288">:</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320292">if</span>&nbsp;<span class="builtinfunc" id="3320295">len</span><span class="op" id="3320298">(</span><span class="ident" id="3320299">ip</span><span class="op" id="3320301">)</span>&nbsp;<span class="op" id="3320303">!=</span>&nbsp;<span class="ident" id="3320306">IPv4len</span>&nbsp;<span class="op" id="3320314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320319">return</span>&nbsp;<span class="ident" id="3320326">nil</span><span class="op" id="3320329">,</span>&nbsp;<span class="ident" id="3320331">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320340">case</span>&nbsp;<span class="ident" id="3320345">IPv6len</span><span class="op" id="3320352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320356">if</span>&nbsp;<span class="builtinfunc" id="3320359">len</span><span class="op" id="3320362">(</span><span class="ident" id="3320363">ip</span><span class="op" id="3320365">)</span>&nbsp;<span class="op" id="3320367">==</span>&nbsp;<span class="ident" id="3320370">IPv4len</span>&nbsp;<span class="op" id="3320378">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320383">m</span>&nbsp;<span class="op" id="3320385">=</span>&nbsp;<span class="ident" id="3320387">m</span><span class="op" id="3320388">[</span><span class="num" id="3320389">12</span><span class="op" id="3320391">:</span><span class="op" id="3320392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320399">default</span><span class="op" id="3320406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320410">return</span>&nbsp;<span class="ident" id="3320417">nil</span><span class="op" id="3320420">,</span>&nbsp;<span class="ident" id="3320422">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320427">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320430">return</span><br>
<span class="lineno"></span><span class="op" id="3320437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3320440">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;the&nbsp;network&nbsp;includes&nbsp;ip.</span><br>
<span class="lineno"></span><span class="keyword" id="3320493">func</span>&nbsp;<span class="op" id="3320498">(</span><span class="ident" id="3320499">n</span>&nbsp;<span class="op" id="3320501">*</span><span class="ident" id="3320502">IPNet</span><span class="op" id="3320507">)</span>&nbsp;<span class="ident" id="3320509">Contains</span><span class="op" id="3320517">(</span><span class="ident" id="3320518">ip</span>&nbsp;<span class="ident" id="3320521">IP</span><span class="op" id="3320523">)</span>&nbsp;<span class="builtintype" id="3320525">bool</span>&nbsp;<span class="op" id="3320530">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320533">nn</span><span class="op" id="3320535">,</span>&nbsp;<span class="ident" id="3320537">m</span>&nbsp;<span class="op" id="3320539">:=</span>&nbsp;<span class="ident" id="3320542">networkNumberAndMask</span><span class="op" id="3320562">(</span><span class="ident" id="3320563">n</span><span class="op" id="3320564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320567">if</span>&nbsp;<span class="ident" id="3320570">x</span>&nbsp;<span class="op" id="3320572">:=</span>&nbsp;<span class="ident" id="3320575">ip</span><span class="op" id="3320577">.</span><span class="ident" id="3320578">To4</span><span class="op" id="3320581">(</span><span class="op" id="3320582">)</span><span class="op" id="3320583">;</span>&nbsp;<span class="ident" id="3320585">x</span>&nbsp;<span class="op" id="3320587">!=</span>&nbsp;<span class="ident" id="3320590">nil</span>&nbsp;<span class="op" id="3320594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320598">ip</span>&nbsp;<span class="op" id="3320601">=</span>&nbsp;<span class="ident" id="3320603">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3320609">l</span>&nbsp;<span class="op" id="3320611">:=</span>&nbsp;<span class="builtinfunc" id="3320614">len</span><span class="op" id="3320617">(</span><span class="ident" id="3320618">ip</span><span class="op" id="3320620">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320623">if</span>&nbsp;<span class="ident" id="3320626">l</span>&nbsp;<span class="op" id="3320628">!=</span>&nbsp;<span class="builtinfunc" id="3320631">len</span><span class="op" id="3320634">(</span><span class="ident" id="3320635">nn</span><span class="op" id="3320637">)</span>&nbsp;<span class="op" id="3320639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320643">return</span>&nbsp;<span class="builtintype" id="3320650">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320660">for</span>&nbsp;<span class="ident" id="3320664">i</span>&nbsp;<span class="op" id="3320666">:=</span>&nbsp;<span class="num" id="3320669">0</span><span class="op" id="3320670">;</span>&nbsp;<span class="ident" id="3320672">i</span>&nbsp;<span class="op" id="3320674">&lt;</span>&nbsp;<span class="ident" id="3320676">l</span><span class="op" id="3320677">;</span>&nbsp;<span class="ident" id="3320679">i</span><span class="op" id="3320680">++</span>&nbsp;<span class="op" id="3320683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320687">if</span>&nbsp;<span class="ident" id="3320690">nn</span><span class="op" id="3320692">[</span><span class="ident" id="3320693">i</span><span class="op" id="3320694">]</span><span class="op" id="3320695">&amp;</span><span class="ident" id="3320696">m</span><span class="op" id="3320697">[</span><span class="ident" id="3320698">i</span><span class="op" id="3320699">]</span>&nbsp;<span class="op" id="3320701">!=</span>&nbsp;<span class="ident" id="3320704">ip</span><span class="op" id="3320706">[</span><span class="ident" id="3320707">i</span><span class="op" id="3320708">]</span><span class="op" id="3320709">&amp;</span><span class="ident" id="3320710">m</span><span class="op" id="3320711">[</span><span class="ident" id="3320712">i</span><span class="op" id="3320713">]</span>&nbsp;<span class="op" id="3320715">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320720">return</span>&nbsp;<span class="builtintype" id="3320727">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3320738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3320741">return</span>&nbsp;<span class="builtintype" id="3320748">true</span><br>
<span class="lineno"></span><span class="op" id="3320753">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="comment" id="3320756">//&nbsp;Network&nbsp;returns&nbsp;the&nbsp;address&#39;s&nbsp;network&nbsp;name,&nbsp;&#34;ip+net&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3320813">func</span>&nbsp;<span class="op" id="3320818">(</span><span class="ident" id="3320819">n</span>&nbsp;<span class="op" id="3320821">*</span><span class="ident" id="3320822">IPNet</span><span class="op" id="3320827">)</span>&nbsp;<span class="ident" id="3320829">Network</span><span class="op" id="3320836">(</span><span class="op" id="3320837">)</span>&nbsp;<span class="builtintype" id="3320839">string</span>&nbsp;<span class="op" id="3320846">{</span>&nbsp;<span class="keyword" id="3320848">return</span>&nbsp;<span class="string" id="3320855">&#34;ip+net&#34;</span>&nbsp;<span class="op" id="3320864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3320867">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;CIDR&nbsp;notation&nbsp;of&nbsp;n&nbsp;like&nbsp;&#34;192.168.100.1/24&#34;</span><br>
<span class="lineno">480</span><span class="comment" id="3320932">//&nbsp;or&nbsp;&#34;2001:DB8::/48&#34;&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4632&nbsp;and&nbsp;RFC&nbsp;4291.</span><br>
<span class="lineno"></span><span class="comment" id="3320991">//&nbsp;If&nbsp;the&nbsp;mask&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;canonical&nbsp;form,&nbsp;it&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3321051">//&nbsp;string&nbsp;which&nbsp;consists&nbsp;of&nbsp;an&nbsp;IP&nbsp;address,&nbsp;followed&nbsp;by&nbsp;a&nbsp;slash</span><br>
<span class="lineno"></span><span class="comment" id="3321114">//&nbsp;character&nbsp;and&nbsp;a&nbsp;mask&nbsp;expressed&nbsp;as&nbsp;hexadecimal&nbsp;form&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3321176">//&nbsp;punctuation&nbsp;like&nbsp;&#34;192.168.100.1/c000ff00&#34;.</span><br>
<span class="lineno">485</span><span class="keyword" id="3321222">func</span>&nbsp;<span class="op" id="3321227">(</span><span class="ident" id="3321228">n</span>&nbsp;<span class="op" id="3321230">*</span><span class="ident" id="3321231">IPNet</span><span class="op" id="3321236">)</span>&nbsp;<span class="ident" id="3321238">String</span><span class="op" id="3321244">(</span><span class="op" id="3321245">)</span>&nbsp;<span class="builtintype" id="3321247">string</span>&nbsp;<span class="op" id="3321254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321257">nn</span><span class="op" id="3321259">,</span>&nbsp;<span class="ident" id="3321261">m</span>&nbsp;<span class="op" id="3321263">:=</span>&nbsp;<span class="ident" id="3321266">networkNumberAndMask</span><span class="op" id="3321286">(</span><span class="ident" id="3321287">n</span><span class="op" id="3321288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321291">if</span>&nbsp;<span class="ident" id="3321294">nn</span>&nbsp;<span class="op" id="3321297">==</span>&nbsp;<span class="ident" id="3321300">nil</span>&nbsp;<span class="op" id="3321304">||</span>&nbsp;<span class="ident" id="3321307">m</span>&nbsp;<span class="op" id="3321309">==</span>&nbsp;<span class="ident" id="3321312">nil</span>&nbsp;<span class="op" id="3321316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321320">return</span>&nbsp;<span class="string" id="3321327">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321336">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321339">l</span>&nbsp;<span class="op" id="3321341">:=</span>&nbsp;<span class="ident" id="3321344">simpleMaskLength</span><span class="op" id="3321360">(</span><span class="ident" id="3321361">m</span><span class="op" id="3321362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321365">if</span>&nbsp;<span class="ident" id="3321368">l</span>&nbsp;<span class="op" id="3321370">==</span>&nbsp;<span class="op" id="3321373">-</span><span class="num" id="3321374">1</span>&nbsp;<span class="op" id="3321376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321380">return</span>&nbsp;<span class="ident" id="3321387">nn</span><span class="op" id="3321389">.</span><span class="ident" id="3321390">String</span><span class="op" id="3321396">(</span><span class="op" id="3321397">)</span>&nbsp;<span class="op" id="3321399">+</span>&nbsp;<span class="string" id="3321401">&#34;/&#34;</span>&nbsp;<span class="op" id="3321405">+</span>&nbsp;<span class="ident" id="3321407">m</span><span class="op" id="3321408">.</span><span class="ident" id="3321409">String</span><span class="op" id="3321415">(</span><span class="op" id="3321416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321422">return</span>&nbsp;<span class="ident" id="3321429">nn</span><span class="op" id="3321431">.</span><span class="ident" id="3321432">String</span><span class="op" id="3321438">(</span><span class="op" id="3321439">)</span>&nbsp;<span class="op" id="3321441">+</span>&nbsp;<span class="string" id="3321443">&#34;/&#34;</span>&nbsp;<span class="op" id="3321447">+</span>&nbsp;<span class="ident" id="3321449">itod</span><span class="op" id="3321453">(</span><span class="builtintype" id="3321454">uint</span><span class="op" id="3321458">(</span><span class="ident" id="3321459">l</span><span class="op" id="3321460">)</span><span class="op" id="3321461">)</span><br>
<span class="lineno">495</span><span class="op" id="3321463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321466">//&nbsp;Parse&nbsp;IPv4&nbsp;address&nbsp;(d.d.d.d).</span><br>
<span class="lineno"></span><span class="keyword" id="3321499">func</span>&nbsp;<span class="ident" id="3321504">parseIPv4</span><span class="op" id="3321513">(</span><span class="ident" id="3321514">s</span>&nbsp;<span class="builtintype" id="3321516">string</span><span class="op" id="3321522">)</span>&nbsp;<span class="ident" id="3321524">IP</span>&nbsp;<span class="op" id="3321527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321530">var</span>&nbsp;<span class="ident" id="3321534">p</span>&nbsp;<span class="op" id="3321536">[</span><span class="ident" id="3321537">IPv4len</span><span class="op" id="3321544">]</span><span class="builtintype" id="3321545">byte</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321551">i</span>&nbsp;<span class="op" id="3321553">:=</span>&nbsp;<span class="num" id="3321556">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321559">for</span>&nbsp;<span class="ident" id="3321563">j</span>&nbsp;<span class="op" id="3321565">:=</span>&nbsp;<span class="num" id="3321568">0</span><span class="op" id="3321569">;</span>&nbsp;<span class="ident" id="3321571">j</span>&nbsp;<span class="op" id="3321573">&lt;</span>&nbsp;<span class="ident" id="3321575">IPv4len</span><span class="op" id="3321582">;</span>&nbsp;<span class="ident" id="3321584">j</span><span class="op" id="3321585">++</span>&nbsp;<span class="op" id="3321588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321592">if</span>&nbsp;<span class="ident" id="3321595">i</span>&nbsp;<span class="op" id="3321597">&gt;=</span>&nbsp;<span class="builtinfunc" id="3321600">len</span><span class="op" id="3321603">(</span><span class="ident" id="3321604">s</span><span class="op" id="3321605">)</span>&nbsp;<span class="op" id="3321607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3321612">//&nbsp;Missing&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321634">return</span>&nbsp;<span class="ident" id="3321641">nil</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321651">if</span>&nbsp;<span class="ident" id="3321654">j</span>&nbsp;<span class="op" id="3321656">&gt;</span>&nbsp;<span class="num" id="3321658">0</span>&nbsp;<span class="op" id="3321660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321665">if</span>&nbsp;<span class="ident" id="3321668">s</span><span class="op" id="3321669">[</span><span class="ident" id="3321670">i</span><span class="op" id="3321671">]</span>&nbsp;<span class="op" id="3321673">!=</span>&nbsp;<span class="string" id="3321676">&#39;.&#39;</span>&nbsp;<span class="op" id="3321680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321686">return</span>&nbsp;<span class="ident" id="3321693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321700">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321705">i</span><span class="op" id="3321706">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321715">var</span>&nbsp;<span class="op" id="3321719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321724">n</span>&nbsp;&nbsp;<span class="builtintype" id="3321727">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321734">ok</span>&nbsp;<span class="builtintype" id="3321737">bool</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321748">n</span><span class="op" id="3321749">,</span>&nbsp;<span class="ident" id="3321751">i</span><span class="op" id="3321752">,</span>&nbsp;<span class="ident" id="3321754">ok</span>&nbsp;<span class="op" id="3321757">=</span>&nbsp;<span class="ident" id="3321759">dtoi</span><span class="op" id="3321763">(</span><span class="ident" id="3321764">s</span><span class="op" id="3321765">,</span>&nbsp;<span class="ident" id="3321767">i</span><span class="op" id="3321768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321772">if</span>&nbsp;<span class="op" id="3321775">!</span><span class="ident" id="3321776">ok</span>&nbsp;<span class="op" id="3321779">||</span>&nbsp;<span class="ident" id="3321782">n</span>&nbsp;<span class="op" id="3321784">&gt;</span>&nbsp;<span class="num" id="3321786">0xFF</span>&nbsp;<span class="op" id="3321791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321796">return</span>&nbsp;<span class="ident" id="3321803">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321809">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3321813">p</span><span class="op" id="3321814">[</span><span class="ident" id="3321815">j</span><span class="op" id="3321816">]</span>&nbsp;<span class="op" id="3321818">=</span>&nbsp;<span class="builtintype" id="3321820">byte</span><span class="op" id="3321824">(</span><span class="ident" id="3321825">n</span><span class="op" id="3321826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321832">if</span>&nbsp;<span class="ident" id="3321835">i</span>&nbsp;<span class="op" id="3321837">!=</span>&nbsp;<span class="builtinfunc" id="3321840">len</span><span class="op" id="3321843">(</span><span class="ident" id="3321844">s</span><span class="op" id="3321845">)</span>&nbsp;<span class="op" id="3321847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321851">return</span>&nbsp;<span class="ident" id="3321858">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3321863">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3321866">return</span>&nbsp;<span class="ident" id="3321873">IPv4</span><span class="op" id="3321877">(</span><span class="ident" id="3321878">p</span><span class="op" id="3321879">[</span><span class="num" id="3321880">0</span><span class="op" id="3321881">]</span><span class="op" id="3321882">,</span>&nbsp;<span class="ident" id="3321884">p</span><span class="op" id="3321885">[</span><span class="num" id="3321886">1</span><span class="op" id="3321887">]</span><span class="op" id="3321888">,</span>&nbsp;<span class="ident" id="3321890">p</span><span class="op" id="3321891">[</span><span class="num" id="3321892">2</span><span class="op" id="3321893">]</span><span class="op" id="3321894">,</span>&nbsp;<span class="ident" id="3321896">p</span><span class="op" id="3321897">[</span><span class="num" id="3321898">3</span><span class="op" id="3321899">]</span><span class="op" id="3321900">)</span><br>
<span class="lineno"></span><span class="op" id="3321902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321905">//&nbsp;parseIPv6&nbsp;parses&nbsp;s&nbsp;as&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;described&nbsp;in&nbsp;RFC&nbsp;4291</span><br>
<span class="lineno"></span><span class="comment" id="3321975">//&nbsp;and&nbsp;RFC&nbsp;5952.&nbsp;&nbsp;It&nbsp;can&nbsp;also&nbsp;parse&nbsp;a&nbsp;literal&nbsp;scoped&nbsp;IPv6&nbsp;address&nbsp;with</span><br>
<span class="lineno">530</span><span class="comment" id="3322046">//&nbsp;zone&nbsp;identifier&nbsp;which&nbsp;is&nbsp;described&nbsp;in&nbsp;RFC&nbsp;4007&nbsp;when&nbsp;zoneAllowed&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3322116">//&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3322125">func</span>&nbsp;<span class="ident" id="3322130">parseIPv6</span><span class="op" id="3322139">(</span><span class="ident" id="3322140">s</span>&nbsp;<span class="builtintype" id="3322142">string</span><span class="op" id="3322148">,</span>&nbsp;<span class="ident" id="3322150">zoneAllowed</span>&nbsp;<span class="builtintype" id="3322162">bool</span><span class="op" id="3322166">)</span>&nbsp;<span class="op" id="3322168">(</span><span class="ident" id="3322169">ip</span>&nbsp;<span class="ident" id="3322172">IP</span><span class="op" id="3322174">,</span>&nbsp;<span class="ident" id="3322176">zone</span>&nbsp;<span class="builtintype" id="3322181">string</span><span class="op" id="3322187">)</span>&nbsp;<span class="op" id="3322189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322192">ip</span>&nbsp;<span class="op" id="3322195">=</span>&nbsp;<span class="builtinfunc" id="3322197">make</span><span class="op" id="3322201">(</span><span class="ident" id="3322202">IP</span><span class="op" id="3322204">,</span>&nbsp;<span class="ident" id="3322206">IPv6len</span><span class="op" id="3322213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322216">ellipsis</span>&nbsp;<span class="op" id="3322225">:=</span>&nbsp;<span class="op" id="3322228">-</span><span class="num" id="3322229">1</span>&nbsp;<span class="comment" id="3322231">//&nbsp;position&nbsp;of&nbsp;ellipsis&nbsp;in&nbsp;p</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322261">i</span>&nbsp;<span class="op" id="3322263">:=</span>&nbsp;<span class="num" id="3322266">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3322276">//&nbsp;index&nbsp;in&nbsp;string&nbsp;s</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322299">if</span>&nbsp;<span class="ident" id="3322302">zoneAllowed</span>&nbsp;<span class="op" id="3322314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322318">s</span><span class="op" id="3322319">,</span>&nbsp;<span class="ident" id="3322321">zone</span>&nbsp;<span class="op" id="3322326">=</span>&nbsp;<span class="ident" id="3322328">splitHostZone</span><span class="op" id="3322341">(</span><span class="ident" id="3322342">s</span><span class="op" id="3322343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322346">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322350">//&nbsp;Might&nbsp;have&nbsp;leading&nbsp;ellipsis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322382">if</span>&nbsp;<span class="builtinfunc" id="3322385">len</span><span class="op" id="3322388">(</span><span class="ident" id="3322389">s</span><span class="op" id="3322390">)</span>&nbsp;<span class="op" id="3322392">&gt;=</span>&nbsp;<span class="num" id="3322395">2</span>&nbsp;<span class="op" id="3322397">&amp;&amp;</span>&nbsp;<span class="ident" id="3322400">s</span><span class="op" id="3322401">[</span><span class="num" id="3322402">0</span><span class="op" id="3322403">]</span>&nbsp;<span class="op" id="3322405">==</span>&nbsp;<span class="string" id="3322408">&#39;:&#39;</span>&nbsp;<span class="op" id="3322412">&amp;&amp;</span>&nbsp;<span class="ident" id="3322415">s</span><span class="op" id="3322416">[</span><span class="num" id="3322417">1</span><span class="op" id="3322418">]</span>&nbsp;<span class="op" id="3322420">==</span>&nbsp;<span class="string" id="3322423">&#39;:&#39;</span>&nbsp;<span class="op" id="3322427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322431">ellipsis</span>&nbsp;<span class="op" id="3322440">=</span>&nbsp;<span class="num" id="3322442">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322446">i</span>&nbsp;<span class="op" id="3322448">=</span>&nbsp;<span class="num" id="3322450">2</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322454">//&nbsp;Might&nbsp;be&nbsp;only&nbsp;ellipsis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322482">if</span>&nbsp;<span class="ident" id="3322485">i</span>&nbsp;<span class="op" id="3322487">==</span>&nbsp;<span class="builtinfunc" id="3322490">len</span><span class="op" id="3322493">(</span><span class="ident" id="3322494">s</span><span class="op" id="3322495">)</span>&nbsp;<span class="op" id="3322497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322502">return</span>&nbsp;<span class="ident" id="3322509">ip</span><span class="op" id="3322511">,</span>&nbsp;<span class="ident" id="3322513">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322523">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322527">//&nbsp;Loop,&nbsp;parsing&nbsp;hex&nbsp;numbers&nbsp;followed&nbsp;by&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322576">j</span>&nbsp;<span class="op" id="3322578">:=</span>&nbsp;<span class="num" id="3322581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322584">for</span>&nbsp;<span class="ident" id="3322588">j</span>&nbsp;<span class="op" id="3322590">&lt;</span>&nbsp;<span class="ident" id="3322592">IPv6len</span>&nbsp;<span class="op" id="3322600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322604">//&nbsp;Hex&nbsp;number.</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322621">n</span><span class="op" id="3322622">,</span>&nbsp;<span class="ident" id="3322624">i1</span><span class="op" id="3322626">,</span>&nbsp;<span class="ident" id="3322628">ok</span>&nbsp;<span class="op" id="3322631">:=</span>&nbsp;<span class="ident" id="3322634">xtoi</span><span class="op" id="3322638">(</span><span class="ident" id="3322639">s</span><span class="op" id="3322640">,</span>&nbsp;<span class="ident" id="3322642">i</span><span class="op" id="3322643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322647">if</span>&nbsp;<span class="op" id="3322650">!</span><span class="ident" id="3322651">ok</span>&nbsp;<span class="op" id="3322654">||</span>&nbsp;<span class="ident" id="3322657">n</span>&nbsp;<span class="op" id="3322659">&gt;</span>&nbsp;<span class="num" id="3322661">0xFFFF</span>&nbsp;<span class="op" id="3322668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322673">return</span>&nbsp;<span class="ident" id="3322680">nil</span><span class="op" id="3322683">,</span>&nbsp;<span class="ident" id="3322685">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322697">//&nbsp;If&nbsp;followed&nbsp;by&nbsp;dot,&nbsp;might&nbsp;be&nbsp;in&nbsp;trailing&nbsp;IPv4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322749">if</span>&nbsp;<span class="ident" id="3322752">i1</span>&nbsp;<span class="op" id="3322755">&lt;</span>&nbsp;<span class="builtinfunc" id="3322757">len</span><span class="op" id="3322760">(</span><span class="ident" id="3322761">s</span><span class="op" id="3322762">)</span>&nbsp;<span class="op" id="3322764">&amp;&amp;</span>&nbsp;<span class="ident" id="3322767">s</span><span class="op" id="3322768">[</span><span class="ident" id="3322769">i1</span><span class="op" id="3322771">]</span>&nbsp;<span class="op" id="3322773">==</span>&nbsp;<span class="string" id="3322776">&#39;.&#39;</span>&nbsp;<span class="op" id="3322780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322785">if</span>&nbsp;<span class="ident" id="3322788">ellipsis</span>&nbsp;<span class="op" id="3322797">&lt;</span>&nbsp;<span class="num" id="3322799">0</span>&nbsp;<span class="op" id="3322801">&amp;&amp;</span>&nbsp;<span class="ident" id="3322804">j</span>&nbsp;<span class="op" id="3322806">!=</span>&nbsp;<span class="ident" id="3322809">IPv6len</span><span class="op" id="3322816">-</span><span class="ident" id="3322817">IPv4len</span>&nbsp;<span class="op" id="3322825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322831">//&nbsp;Not&nbsp;the&nbsp;right&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322859">return</span>&nbsp;<span class="ident" id="3322866">nil</span><span class="op" id="3322869">,</span>&nbsp;<span class="ident" id="3322871">zone</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322884">if</span>&nbsp;<span class="ident" id="3322887">j</span><span class="op" id="3322888">+</span><span class="ident" id="3322889">IPv4len</span>&nbsp;<span class="op" id="3322897">&gt;</span>&nbsp;<span class="ident" id="3322899">IPv6len</span>&nbsp;<span class="op" id="3322907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3322913">//&nbsp;Not&nbsp;enough&nbsp;room.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322937">return</span>&nbsp;<span class="ident" id="3322944">nil</span><span class="op" id="3322947">,</span>&nbsp;<span class="ident" id="3322949">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3322957">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3322962">ip4</span>&nbsp;<span class="op" id="3322966">:=</span>&nbsp;<span class="ident" id="3322969">parseIPv4</span><span class="op" id="3322978">(</span><span class="ident" id="3322979">s</span><span class="op" id="3322980">[</span><span class="ident" id="3322981">i</span><span class="op" id="3322982">:</span><span class="op" id="3322983">]</span><span class="op" id="3322984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3322989">if</span>&nbsp;<span class="ident" id="3322992">ip4</span>&nbsp;<span class="op" id="3322996">==</span>&nbsp;<span class="ident" id="3322999">nil</span>&nbsp;<span class="op" id="3323003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323009">return</span>&nbsp;<span class="ident" id="3323016">nil</span><span class="op" id="3323019">,</span>&nbsp;<span class="ident" id="3323021">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323034">ip</span><span class="op" id="3323036">[</span><span class="ident" id="3323037">j</span><span class="op" id="3323038">]</span>&nbsp;<span class="op" id="3323040">=</span>&nbsp;<span class="ident" id="3323042">ip4</span><span class="op" id="3323045">[</span><span class="num" id="3323046">12</span><span class="op" id="3323048">]</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323053">ip</span><span class="op" id="3323055">[</span><span class="ident" id="3323056">j</span><span class="op" id="3323057">+</span><span class="num" id="3323058">1</span><span class="op" id="3323059">]</span>&nbsp;<span class="op" id="3323061">=</span>&nbsp;<span class="ident" id="3323063">ip4</span><span class="op" id="3323066">[</span><span class="num" id="3323067">13</span><span class="op" id="3323069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323074">ip</span><span class="op" id="3323076">[</span><span class="ident" id="3323077">j</span><span class="op" id="3323078">+</span><span class="num" id="3323079">2</span><span class="op" id="3323080">]</span>&nbsp;<span class="op" id="3323082">=</span>&nbsp;<span class="ident" id="3323084">ip4</span><span class="op" id="3323087">[</span><span class="num" id="3323088">14</span><span class="op" id="3323090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323095">ip</span><span class="op" id="3323097">[</span><span class="ident" id="3323098">j</span><span class="op" id="3323099">+</span><span class="num" id="3323100">3</span><span class="op" id="3323101">]</span>&nbsp;<span class="op" id="3323103">=</span>&nbsp;<span class="ident" id="3323105">ip4</span><span class="op" id="3323108">[</span><span class="num" id="3323109">15</span><span class="op" id="3323111">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323116">i</span>&nbsp;<span class="op" id="3323118">=</span>&nbsp;<span class="builtinfunc" id="3323120">len</span><span class="op" id="3323123">(</span><span class="ident" id="3323124">s</span><span class="op" id="3323125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323130">j</span>&nbsp;<span class="op" id="3323132">+=</span>&nbsp;<span class="ident" id="3323135">IPv4len</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323146">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323159">//&nbsp;Save&nbsp;this&nbsp;16-bit&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323188">ip</span><span class="op" id="3323190">[</span><span class="ident" id="3323191">j</span><span class="op" id="3323192">]</span>&nbsp;<span class="op" id="3323194">=</span>&nbsp;<span class="builtintype" id="3323196">byte</span><span class="op" id="3323200">(</span><span class="ident" id="3323201">n</span>&nbsp;<span class="op" id="3323203">&gt;&gt;</span>&nbsp;<span class="num" id="3323206">8</span><span class="op" id="3323207">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323211">ip</span><span class="op" id="3323213">[</span><span class="ident" id="3323214">j</span><span class="op" id="3323215">+</span><span class="num" id="3323216">1</span><span class="op" id="3323217">]</span>&nbsp;<span class="op" id="3323219">=</span>&nbsp;<span class="builtintype" id="3323221">byte</span><span class="op" id="3323225">(</span><span class="ident" id="3323226">n</span><span class="op" id="3323227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323231">j</span>&nbsp;<span class="op" id="3323233">+=</span>&nbsp;<span class="num" id="3323236">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323241">//&nbsp;Stop&nbsp;at&nbsp;end&nbsp;of&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323269">i</span>&nbsp;<span class="op" id="3323271">=</span>&nbsp;<span class="ident" id="3323273">i1</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323278">if</span>&nbsp;<span class="ident" id="3323281">i</span>&nbsp;<span class="op" id="3323283">==</span>&nbsp;<span class="builtinfunc" id="3323286">len</span><span class="op" id="3323289">(</span><span class="ident" id="3323290">s</span><span class="op" id="3323291">)</span>&nbsp;<span class="op" id="3323293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323298">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323311">//&nbsp;Otherwise&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;colon&nbsp;and&nbsp;more.</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323362">if</span>&nbsp;<span class="ident" id="3323365">s</span><span class="op" id="3323366">[</span><span class="ident" id="3323367">i</span><span class="op" id="3323368">]</span>&nbsp;<span class="op" id="3323370">!=</span>&nbsp;<span class="string" id="3323373">&#39;:&#39;</span>&nbsp;<span class="op" id="3323377">||</span>&nbsp;<span class="ident" id="3323380">i</span><span class="op" id="3323381">+</span><span class="num" id="3323382">1</span>&nbsp;<span class="op" id="3323384">==</span>&nbsp;<span class="builtinfunc" id="3323387">len</span><span class="op" id="3323390">(</span><span class="ident" id="3323391">s</span><span class="op" id="3323392">)</span>&nbsp;<span class="op" id="3323394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323399">return</span>&nbsp;<span class="ident" id="3323406">nil</span><span class="op" id="3323409">,</span>&nbsp;<span class="ident" id="3323411">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323422">i</span><span class="op" id="3323423">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323429">//&nbsp;Look&nbsp;for&nbsp;ellipsis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323453">if</span>&nbsp;<span class="ident" id="3323456">s</span><span class="op" id="3323457">[</span><span class="ident" id="3323458">i</span><span class="op" id="3323459">]</span>&nbsp;<span class="op" id="3323461">==</span>&nbsp;<span class="string" id="3323464">&#39;:&#39;</span>&nbsp;<span class="op" id="3323468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323473">if</span>&nbsp;<span class="ident" id="3323476">ellipsis</span>&nbsp;<span class="op" id="3323485">&gt;=</span>&nbsp;<span class="num" id="3323488">0</span>&nbsp;<span class="op" id="3323490">{</span>&nbsp;<span class="comment" id="3323492">//&nbsp;already&nbsp;have&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323516">return</span>&nbsp;<span class="ident" id="3323523">nil</span><span class="op" id="3323526">,</span>&nbsp;<span class="ident" id="3323528">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323536">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323541">ellipsis</span>&nbsp;<span class="op" id="3323550">=</span>&nbsp;<span class="ident" id="3323552">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323557">if</span>&nbsp;<span class="ident" id="3323560">i</span><span class="op" id="3323561">++</span><span class="op" id="3323563">;</span>&nbsp;<span class="ident" id="3323565">i</span>&nbsp;<span class="op" id="3323567">==</span>&nbsp;<span class="builtinfunc" id="3323570">len</span><span class="op" id="3323573">(</span><span class="ident" id="3323574">s</span><span class="op" id="3323575">)</span>&nbsp;<span class="op" id="3323577">{</span>&nbsp;<span class="comment" id="3323579">//&nbsp;can&nbsp;be&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323600">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323613">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323620">//&nbsp;Must&nbsp;have&nbsp;used&nbsp;entire&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323654">if</span>&nbsp;<span class="ident" id="3323657">i</span>&nbsp;<span class="op" id="3323659">!=</span>&nbsp;<span class="builtinfunc" id="3323662">len</span><span class="op" id="3323665">(</span><span class="ident" id="3323666">s</span><span class="op" id="3323667">)</span>&nbsp;<span class="op" id="3323669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323673">return</span>&nbsp;<span class="ident" id="3323680">nil</span><span class="op" id="3323683">,</span>&nbsp;<span class="ident" id="3323685">zone</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323695">//&nbsp;If&nbsp;didn&#39;t&nbsp;parse&nbsp;enough,&nbsp;expand&nbsp;ellipsis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323740">if</span>&nbsp;<span class="ident" id="3323743">j</span>&nbsp;<span class="op" id="3323745">&lt;</span>&nbsp;<span class="ident" id="3323747">IPv6len</span>&nbsp;<span class="op" id="3323755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323759">if</span>&nbsp;<span class="ident" id="3323762">ellipsis</span>&nbsp;<span class="op" id="3323771">&lt;</span>&nbsp;<span class="num" id="3323773">0</span>&nbsp;<span class="op" id="3323775">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323780">return</span>&nbsp;<span class="ident" id="3323787">nil</span><span class="op" id="3323790">,</span>&nbsp;<span class="ident" id="3323792">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323803">n</span>&nbsp;<span class="op" id="3323805">:=</span>&nbsp;<span class="ident" id="3323808">IPv6len</span>&nbsp;<span class="op" id="3323816">-</span>&nbsp;<span class="ident" id="3323818">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323822">for</span>&nbsp;<span class="ident" id="3323826">k</span>&nbsp;<span class="op" id="3323828">:=</span>&nbsp;<span class="ident" id="3323831">j</span>&nbsp;<span class="op" id="3323833">-</span>&nbsp;<span class="num" id="3323835">1</span><span class="op" id="3323836">;</span>&nbsp;<span class="ident" id="3323838">k</span>&nbsp;<span class="op" id="3323840">&gt;=</span>&nbsp;<span class="ident" id="3323843">ellipsis</span><span class="op" id="3323851">;</span>&nbsp;<span class="ident" id="3323853">k</span><span class="op" id="3323854">--</span>&nbsp;<span class="op" id="3323857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323862">ip</span><span class="op" id="3323864">[</span><span class="ident" id="3323865">k</span><span class="op" id="3323866">+</span><span class="ident" id="3323867">n</span><span class="op" id="3323868">]</span>&nbsp;<span class="op" id="3323870">=</span>&nbsp;<span class="ident" id="3323872">ip</span><span class="op" id="3323874">[</span><span class="ident" id="3323875">k</span><span class="op" id="3323876">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3323884">for</span>&nbsp;<span class="ident" id="3323888">k</span>&nbsp;<span class="op" id="3323890">:=</span>&nbsp;<span class="ident" id="3323893">ellipsis</span>&nbsp;<span class="op" id="3323902">+</span>&nbsp;<span class="ident" id="3323904">n</span>&nbsp;<span class="op" id="3323906">-</span>&nbsp;<span class="num" id="3323908">1</span><span class="op" id="3323909">;</span>&nbsp;<span class="ident" id="3323911">k</span>&nbsp;<span class="op" id="3323913">&gt;=</span>&nbsp;<span class="ident" id="3323916">ellipsis</span><span class="op" id="3323924">;</span>&nbsp;<span class="ident" id="3323926">k</span><span class="op" id="3323927">--</span>&nbsp;<span class="op" id="3323930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323935">ip</span><span class="op" id="3323937">[</span><span class="ident" id="3323938">k</span><span class="op" id="3323939">]</span>&nbsp;<span class="op" id="3323941">=</span>&nbsp;<span class="num" id="3323943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3323950">}</span>&nbsp;<span class="keyword" id="3323952">else</span>&nbsp;<span class="keyword" id="3323957">if</span>&nbsp;<span class="ident" id="3323960">ellipsis</span>&nbsp;<span class="op" id="3323969">&gt;=</span>&nbsp;<span class="num" id="3323972">0</span>&nbsp;<span class="op" id="3323974">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3323978">//&nbsp;Ellipsis&nbsp;must&nbsp;represent&nbsp;at&nbsp;least&nbsp;one&nbsp;0&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324029">return</span>&nbsp;<span class="ident" id="3324036">nil</span><span class="op" id="3324039">,</span>&nbsp;<span class="ident" id="3324041">zone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324050">return</span>&nbsp;<span class="ident" id="3324057">ip</span><span class="op" id="3324059">,</span>&nbsp;<span class="ident" id="3324061">zone</span><br>
<span class="lineno"></span><span class="op" id="3324066">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span><span class="comment" id="3324069">//&nbsp;A&nbsp;ParseError&nbsp;represents&nbsp;a&nbsp;malformed&nbsp;text&nbsp;string&nbsp;and&nbsp;the&nbsp;type&nbsp;of&nbsp;string&nbsp;that&nbsp;was&nbsp;expected.</span><br>
<span class="lineno"></span><span class="keyword" id="3324162">type</span>&nbsp;<span class="ident" id="3324167">ParseError</span>&nbsp;<span class="keyword" id="3324178">struct</span>&nbsp;<span class="op" id="3324185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324188">Type</span>&nbsp;<span class="builtintype" id="3324193">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324201">Text</span>&nbsp;<span class="builtintype" id="3324206">string</span><br>
<span class="lineno">640</span><span class="op" id="3324213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3324216">func</span>&nbsp;<span class="op" id="3324221">(</span><span class="ident" id="3324222">e</span>&nbsp;<span class="op" id="3324224">*</span><span class="ident" id="3324225">ParseError</span><span class="op" id="3324235">)</span>&nbsp;<span class="ident" id="3324237">Error</span><span class="op" id="3324242">(</span><span class="op" id="3324243">)</span>&nbsp;<span class="builtintype" id="3324245">string</span>&nbsp;<span class="op" id="3324252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324255">return</span>&nbsp;<span class="string" id="3324262">&#34;invalid&nbsp;&#34;</span>&nbsp;<span class="op" id="3324273">+</span>&nbsp;<span class="ident" id="3324275">e</span><span class="op" id="3324276">.</span><span class="ident" id="3324277">Type</span>&nbsp;<span class="op" id="3324282">+</span>&nbsp;<span class="string" id="3324284">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3324289">+</span>&nbsp;<span class="ident" id="3324291">e</span><span class="op" id="3324292">.</span><span class="ident" id="3324293">Text</span><br>
<span class="lineno"></span><span class="op" id="3324298">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="comment" id="3324301">//&nbsp;ParseIP&nbsp;parses&nbsp;s&nbsp;as&nbsp;an&nbsp;IP&nbsp;address,&nbsp;returning&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="3324361">//&nbsp;The&nbsp;string&nbsp;s&nbsp;can&nbsp;be&nbsp;in&nbsp;dotted&nbsp;decimal&nbsp;(&#34;74.125.19.99&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3324419">//&nbsp;or&nbsp;IPv6&nbsp;(&#34;2001:4860:0:2001::68&#34;)&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3324461">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;textual&nbsp;representation&nbsp;of&nbsp;an&nbsp;IP&nbsp;address,</span><br>
<span class="lineno">650</span><span class="comment" id="3324525">//&nbsp;ParseIP&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3324549">func</span>&nbsp;<span class="ident" id="3324554">ParseIP</span><span class="op" id="3324561">(</span><span class="ident" id="3324562">s</span>&nbsp;<span class="builtintype" id="3324564">string</span><span class="op" id="3324570">)</span>&nbsp;<span class="ident" id="3324572">IP</span>&nbsp;<span class="op" id="3324575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324578">for</span>&nbsp;<span class="ident" id="3324582">i</span>&nbsp;<span class="op" id="3324584">:=</span>&nbsp;<span class="num" id="3324587">0</span><span class="op" id="3324588">;</span>&nbsp;<span class="ident" id="3324590">i</span>&nbsp;<span class="op" id="3324592">&lt;</span>&nbsp;<span class="builtinfunc" id="3324594">len</span><span class="op" id="3324597">(</span><span class="ident" id="3324598">s</span><span class="op" id="3324599">)</span><span class="op" id="3324600">;</span>&nbsp;<span class="ident" id="3324602">i</span><span class="op" id="3324603">++</span>&nbsp;<span class="op" id="3324606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324610">switch</span>&nbsp;<span class="ident" id="3324617">s</span><span class="op" id="3324618">[</span><span class="ident" id="3324619">i</span><span class="op" id="3324620">]</span>&nbsp;<span class="op" id="3324622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324626">case</span>&nbsp;<span class="string" id="3324631">&#39;.&#39;</span><span class="op" id="3324634">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324639">return</span>&nbsp;<span class="ident" id="3324646">parseIPv4</span><span class="op" id="3324655">(</span><span class="ident" id="3324656">s</span><span class="op" id="3324657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324661">case</span>&nbsp;<span class="string" id="3324666">&#39;:&#39;</span><span class="op" id="3324669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324674">ip</span><span class="op" id="3324676">,</span>&nbsp;<span class="ident" id="3324678">_</span>&nbsp;<span class="op" id="3324680">:=</span>&nbsp;<span class="ident" id="3324683">parseIPv6</span><span class="op" id="3324692">(</span><span class="ident" id="3324693">s</span><span class="op" id="3324694">,</span>&nbsp;<span class="builtintype" id="3324696">false</span><span class="op" id="3324701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324706">return</span>&nbsp;<span class="ident" id="3324713">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324718">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324724">return</span>&nbsp;<span class="ident" id="3324731">nil</span><br>
<span class="lineno"></span><span class="op" id="3324735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3324738">//&nbsp;ParseCIDR&nbsp;parses&nbsp;s&nbsp;as&nbsp;a&nbsp;CIDR&nbsp;notation&nbsp;IP&nbsp;address&nbsp;and&nbsp;mask,</span><br>
<span class="lineno">665</span><span class="comment" id="3324800">//&nbsp;like&nbsp;&#34;192.168.100.1/24&#34;&nbsp;or&nbsp;&#34;2001:DB8::/48&#34;,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3324861">//&nbsp;RFC&nbsp;4632&nbsp;and&nbsp;RFC&nbsp;4291.</span><br>
<span class="lineno"></span><span class="comment" id="3324887">//</span><br>
<span class="lineno"></span><span class="comment" id="3324890">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;IP&nbsp;address&nbsp;and&nbsp;the&nbsp;network&nbsp;implied&nbsp;by&nbsp;the&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3324953">//&nbsp;and&nbsp;mask.&nbsp;&nbsp;For&nbsp;example,&nbsp;ParseCIDR(&#34;192.168.100.1/16&#34;)&nbsp;returns</span><br>
<span class="lineno">670</span><span class="comment" id="3325018">//&nbsp;the&nbsp;IP&nbsp;address&nbsp;192.168.100.1&nbsp;and&nbsp;the&nbsp;network&nbsp;192.168.0.0/16.</span><br>
<span class="lineno"></span><span class="keyword" id="3325082">func</span>&nbsp;<span class="ident" id="3325087">ParseCIDR</span><span class="op" id="3325096">(</span><span class="ident" id="3325097">s</span>&nbsp;<span class="builtintype" id="3325099">string</span><span class="op" id="3325105">)</span>&nbsp;<span class="op" id="3325107">(</span><span class="ident" id="3325108">IP</span><span class="op" id="3325110">,</span>&nbsp;<span class="op" id="3325112">*</span><span class="ident" id="3325113">IPNet</span><span class="op" id="3325118">,</span>&nbsp;<span class="builtintype" id="3325120">error</span><span class="op" id="3325125">)</span>&nbsp;<span class="op" id="3325127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325130">i</span>&nbsp;<span class="op" id="3325132">:=</span>&nbsp;<span class="ident" id="3325135">byteIndex</span><span class="op" id="3325144">(</span><span class="ident" id="3325145">s</span><span class="op" id="3325146">,</span>&nbsp;<span class="string" id="3325148">&#39;/&#39;</span><span class="op" id="3325151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325154">if</span>&nbsp;<span class="ident" id="3325157">i</span>&nbsp;<span class="op" id="3325159">&lt;</span>&nbsp;<span class="num" id="3325161">0</span>&nbsp;<span class="op" id="3325163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325167">return</span>&nbsp;<span class="ident" id="3325174">nil</span><span class="op" id="3325177">,</span>&nbsp;<span class="ident" id="3325179">nil</span><span class="op" id="3325182">,</span>&nbsp;<span class="op" id="3325184">&amp;</span><span class="ident" id="3325185">ParseError</span><span class="op" id="3325195">{</span><span class="string" id="3325196">&#34;CIDR&nbsp;address&#34;</span><span class="op" id="3325210">,</span>&nbsp;<span class="ident" id="3325212">s</span><span class="op" id="3325213">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325219">addr</span><span class="op" id="3325223">,</span>&nbsp;<span class="ident" id="3325225">mask</span>&nbsp;<span class="op" id="3325230">:=</span>&nbsp;<span class="ident" id="3325233">s</span><span class="op" id="3325234">[</span><span class="op" id="3325235">:</span><span class="ident" id="3325236">i</span><span class="op" id="3325237">]</span><span class="op" id="3325238">,</span>&nbsp;<span class="ident" id="3325240">s</span><span class="op" id="3325241">[</span><span class="ident" id="3325242">i</span><span class="op" id="3325243">+</span><span class="num" id="3325244">1</span><span class="op" id="3325245">:</span><span class="op" id="3325246">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325249">iplen</span>&nbsp;<span class="op" id="3325255">:=</span>&nbsp;<span class="ident" id="3325258">IPv4len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325267">ip</span>&nbsp;<span class="op" id="3325270">:=</span>&nbsp;<span class="ident" id="3325273">parseIPv4</span><span class="op" id="3325282">(</span><span class="ident" id="3325283">addr</span><span class="op" id="3325287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325290">if</span>&nbsp;<span class="ident" id="3325293">ip</span>&nbsp;<span class="op" id="3325296">==</span>&nbsp;<span class="ident" id="3325299">nil</span>&nbsp;<span class="op" id="3325303">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325307">iplen</span>&nbsp;<span class="op" id="3325313">=</span>&nbsp;<span class="ident" id="3325315">IPv6len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325325">ip</span><span class="op" id="3325327">,</span>&nbsp;<span class="ident" id="3325329">_</span>&nbsp;<span class="op" id="3325331">=</span>&nbsp;<span class="ident" id="3325333">parseIPv6</span><span class="op" id="3325342">(</span><span class="ident" id="3325343">addr</span><span class="op" id="3325347">,</span>&nbsp;<span class="builtintype" id="3325349">false</span><span class="op" id="3325354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325360">n</span><span class="op" id="3325361">,</span>&nbsp;<span class="ident" id="3325363">i</span><span class="op" id="3325364">,</span>&nbsp;<span class="ident" id="3325366">ok</span>&nbsp;<span class="op" id="3325369">:=</span>&nbsp;<span class="ident" id="3325372">dtoi</span><span class="op" id="3325376">(</span><span class="ident" id="3325377">mask</span><span class="op" id="3325381">,</span>&nbsp;<span class="num" id="3325383">0</span><span class="op" id="3325384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325387">if</span>&nbsp;<span class="ident" id="3325390">ip</span>&nbsp;<span class="op" id="3325393">==</span>&nbsp;<span class="ident" id="3325396">nil</span>&nbsp;<span class="op" id="3325400">||</span>&nbsp;<span class="op" id="3325403">!</span><span class="ident" id="3325404">ok</span>&nbsp;<span class="op" id="3325407">||</span>&nbsp;<span class="ident" id="3325410">i</span>&nbsp;<span class="op" id="3325412">!=</span>&nbsp;<span class="builtinfunc" id="3325415">len</span><span class="op" id="3325418">(</span><span class="ident" id="3325419">mask</span><span class="op" id="3325423">)</span>&nbsp;<span class="op" id="3325425">||</span>&nbsp;<span class="ident" id="3325428">n</span>&nbsp;<span class="op" id="3325430">&lt;</span>&nbsp;<span class="num" id="3325432">0</span>&nbsp;<span class="op" id="3325434">||</span>&nbsp;<span class="ident" id="3325437">n</span>&nbsp;<span class="op" id="3325439">&gt;</span>&nbsp;<span class="num" id="3325441">8</span><span class="op" id="3325442">*</span><span class="ident" id="3325443">iplen</span>&nbsp;<span class="op" id="3325449">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325453">return</span>&nbsp;<span class="ident" id="3325460">nil</span><span class="op" id="3325463">,</span>&nbsp;<span class="ident" id="3325465">nil</span><span class="op" id="3325468">,</span>&nbsp;<span class="op" id="3325470">&amp;</span><span class="ident" id="3325471">ParseError</span><span class="op" id="3325481">{</span><span class="string" id="3325482">&#34;CIDR&nbsp;address&#34;</span><span class="op" id="3325496">,</span>&nbsp;<span class="ident" id="3325498">s</span><span class="op" id="3325499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325505">m</span>&nbsp;<span class="op" id="3325507">:=</span>&nbsp;<span class="ident" id="3325510">CIDRMask</span><span class="op" id="3325518">(</span><span class="ident" id="3325519">n</span><span class="op" id="3325520">,</span>&nbsp;<span class="num" id="3325522">8</span><span class="op" id="3325523">*</span><span class="ident" id="3325524">iplen</span><span class="op" id="3325529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325532">return</span>&nbsp;<span class="ident" id="3325539">ip</span><span class="op" id="3325541">,</span>&nbsp;<span class="op" id="3325543">&amp;</span><span class="ident" id="3325544">IPNet</span><span class="op" id="3325549">{</span><span class="ident" id="3325550">IP</span><span class="op" id="3325552">:</span>&nbsp;<span class="ident" id="3325554">ip</span><span class="op" id="3325556">.</span><span class="ident" id="3325557">Mask</span><span class="op" id="3325561">(</span><span class="ident" id="3325562">m</span><span class="op" id="3325563">)</span><span class="op" id="3325564">,</span>&nbsp;<span class="ident" id="3325566">Mask</span><span class="op" id="3325570">:</span>&nbsp;<span class="ident" id="3325572">m</span><span class="op" id="3325573">}</span><span class="op" id="3325574">,</span>&nbsp;<span class="ident" id="3325576">nil</span><br>
<span class="lineno"></span><span class="op" id="3325580">}</span>
</div>
</body>
</html>
