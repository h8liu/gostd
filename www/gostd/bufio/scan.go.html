<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2831631">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2831686">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2831740">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2831791">package</span>&nbsp;<span class="ident" id="2831799">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2831806">import</span>&nbsp;<span class="op" id="2831813">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2831816">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2831825">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2831835">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2831841">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2831856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831859">//&nbsp;Scanner&nbsp;provides&nbsp;a&nbsp;convenient&nbsp;interface&nbsp;for&nbsp;reading&nbsp;data&nbsp;such&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="2831927">//&nbsp;a&nbsp;file&nbsp;of&nbsp;newline-delimited&nbsp;lines&nbsp;of&nbsp;text.&nbsp;Successive&nbsp;calls&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2831993">//&nbsp;the&nbsp;Scan&nbsp;method&nbsp;will&nbsp;step&nbsp;through&nbsp;the&nbsp;&#39;tokens&#39;&nbsp;of&nbsp;a&nbsp;file,&nbsp;skipping</span><br>
<span class="lineno"></span><span class="comment" id="2832063">//&nbsp;the&nbsp;bytes&nbsp;between&nbsp;the&nbsp;tokens.&nbsp;The&nbsp;specification&nbsp;of&nbsp;a&nbsp;token&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2832128">//&nbsp;defined&nbsp;by&nbsp;a&nbsp;split&nbsp;function&nbsp;of&nbsp;type&nbsp;SplitFunc;&nbsp;the&nbsp;default&nbsp;split</span><br>
<span class="lineno"></span><span class="comment" id="2832196">//&nbsp;function&nbsp;breaks&nbsp;the&nbsp;input&nbsp;into&nbsp;lines&nbsp;with&nbsp;line&nbsp;termination&nbsp;stripped.&nbsp;Split</span><br>
<span class="lineno">20</span><span class="comment" id="2832274">//&nbsp;functions&nbsp;are&nbsp;defined&nbsp;in&nbsp;this&nbsp;package&nbsp;for&nbsp;scanning&nbsp;a&nbsp;file&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="2832340">//&nbsp;lines,&nbsp;bytes,&nbsp;UTF-8-encoded&nbsp;runes,&nbsp;and&nbsp;space-delimited&nbsp;words.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="2832409">//&nbsp;client&nbsp;may&nbsp;instead&nbsp;provide&nbsp;a&nbsp;custom&nbsp;split&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2832464">//</span><br>
<span class="lineno"></span><span class="comment" id="2832467">//&nbsp;Scanning&nbsp;stops&nbsp;unrecoverably&nbsp;at&nbsp;EOF,&nbsp;the&nbsp;first&nbsp;I/O&nbsp;error,&nbsp;or&nbsp;a&nbsp;token&nbsp;too</span><br>
<span class="lineno">25</span><span class="comment" id="2832543">//&nbsp;large&nbsp;to&nbsp;fit&nbsp;in&nbsp;the&nbsp;buffer.&nbsp;When&nbsp;a&nbsp;scan&nbsp;stops,&nbsp;the&nbsp;reader&nbsp;may&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="2832613">//&nbsp;advanced&nbsp;arbitrarily&nbsp;far&nbsp;past&nbsp;the&nbsp;last&nbsp;token.&nbsp;Programs&nbsp;that&nbsp;need&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="2832686">//&nbsp;control&nbsp;over&nbsp;error&nbsp;handling&nbsp;or&nbsp;large&nbsp;tokens,&nbsp;or&nbsp;must&nbsp;run&nbsp;sequential&nbsp;scans</span><br>
<span class="lineno"></span><span class="comment" id="2832763">//&nbsp;on&nbsp;a&nbsp;reader,&nbsp;should&nbsp;use&nbsp;bufio.Reader&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2832812">//</span><br>
<span class="lineno">30</span><span class="keyword" id="2832815">type</span>&nbsp;<span class="ident" id="2832820">Scanner</span>&nbsp;<span class="keyword" id="2832828">struct</span>&nbsp;<span class="op" id="2832835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2832838">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2832851">io</span><span class="op" id="2832853">.</span><span class="ident" id="2832854">Reader</span>&nbsp;<span class="comment" id="2832861">//&nbsp;The&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2832900">split</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2832913">SplitFunc</span>&nbsp;<span class="comment" id="2832923">//&nbsp;The&nbsp;function&nbsp;to&nbsp;split&nbsp;the&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2832961">maxTokenSize</span>&nbsp;<span class="builtintype" id="2832974">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2832984">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;a&nbsp;token;&nbsp;modified&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833032">token</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2833045">[</span><span class="op" id="2833046">]</span><span class="builtintype" id="2833047">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833055">//&nbsp;Last&nbsp;token&nbsp;returned&nbsp;by&nbsp;split.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833089">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2833102">[</span><span class="op" id="2833103">]</span><span class="builtintype" id="2833104">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833112">//&nbsp;Buffer&nbsp;used&nbsp;as&nbsp;argument&nbsp;to&nbsp;split.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833150">start</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2833163">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833173">//&nbsp;First&nbsp;non-processed&nbsp;byte&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833210">end</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2833223">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833233">//&nbsp;End&nbsp;of&nbsp;data&nbsp;in&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833257">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2833270">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833280">//&nbsp;Sticky&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2833298">empties</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2833311">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2833321">//&nbsp;Count&nbsp;of&nbsp;successive&nbsp;empty&nbsp;tokens.</span><br>
<span class="lineno">40</span><span class="op" id="2833358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2833361">//&nbsp;SplitFunc&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;the&nbsp;split&nbsp;function&nbsp;used&nbsp;to&nbsp;tokenize&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2833434">//&nbsp;input.&nbsp;The&nbsp;arguments&nbsp;are&nbsp;an&nbsp;initial&nbsp;substring&nbsp;of&nbsp;the&nbsp;remaining&nbsp;unprocessed</span><br>
<span class="lineno"></span><span class="comment" id="2833512">//&nbsp;data&nbsp;and&nbsp;a&nbsp;flag,&nbsp;atEOF,&nbsp;that&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Reader&nbsp;has&nbsp;no&nbsp;more&nbsp;data</span><br>
<span class="lineno">45</span><span class="comment" id="2833588">//&nbsp;to&nbsp;give.&nbsp;The&nbsp;return&nbsp;values&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;advance&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="2833663">//&nbsp;and&nbsp;the&nbsp;next&nbsp;token&nbsp;to&nbsp;return&nbsp;to&nbsp;the&nbsp;user,&nbsp;plus&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2833738">//&nbsp;data&nbsp;does&nbsp;not&nbsp;yet&nbsp;hold&nbsp;a&nbsp;complete&nbsp;token,&nbsp;for&nbsp;instance&nbsp;if&nbsp;it&nbsp;has&nbsp;no&nbsp;newline</span><br>
<span class="lineno"></span><span class="comment" id="2833816">//&nbsp;while&nbsp;scanning&nbsp;lines,&nbsp;SplitFunc&nbsp;can&nbsp;return&nbsp;(0,&nbsp;nil,&nbsp;nil)&nbsp;to&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2833890">//&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;more&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;and&nbsp;try&nbsp;again&nbsp;with&nbsp;a&nbsp;longer&nbsp;slice</span><br>
<span class="lineno">50</span><span class="comment" id="2833968">//&nbsp;starting&nbsp;at&nbsp;the&nbsp;same&nbsp;point&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="2834012">//</span><br>
<span class="lineno"></span><span class="comment" id="2834015">//&nbsp;If&nbsp;the&nbsp;returned&nbsp;error&nbsp;is&nbsp;non-nil,&nbsp;scanning&nbsp;stops&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2834081">//&nbsp;is&nbsp;returned&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="2834111">//</span><br>
<span class="lineno">55</span><span class="comment" id="2834114">//&nbsp;The&nbsp;function&nbsp;is&nbsp;never&nbsp;called&nbsp;with&nbsp;an&nbsp;empty&nbsp;data&nbsp;slice&nbsp;unless&nbsp;atEOF</span><br>
<span class="lineno"></span><span class="comment" id="2834184">//&nbsp;is&nbsp;true.&nbsp;If&nbsp;atEOF&nbsp;is&nbsp;true,&nbsp;however,&nbsp;data&nbsp;may&nbsp;be&nbsp;non-empty&nbsp;and,</span><br>
<span class="lineno"></span><span class="comment" id="2834250">//&nbsp;as&nbsp;always,&nbsp;holds&nbsp;unprocessed&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="2834288">type</span>&nbsp;<span class="ident" id="2834293">SplitFunc</span>&nbsp;<span class="keyword" id="2834303">func</span><span class="op" id="2834307">(</span><span class="ident" id="2834308">data</span>&nbsp;<span class="op" id="2834313">[</span><span class="op" id="2834314">]</span><span class="builtintype" id="2834315">byte</span><span class="op" id="2834319">,</span>&nbsp;<span class="ident" id="2834321">atEOF</span>&nbsp;<span class="builtintype" id="2834327">bool</span><span class="op" id="2834331">)</span>&nbsp;<span class="op" id="2834333">(</span><span class="ident" id="2834334">advance</span>&nbsp;<span class="builtintype" id="2834342">int</span><span class="op" id="2834345">,</span>&nbsp;<span class="ident" id="2834347">token</span>&nbsp;<span class="op" id="2834353">[</span><span class="op" id="2834354">]</span><span class="builtintype" id="2834355">byte</span><span class="op" id="2834359">,</span>&nbsp;<span class="ident" id="2834361">err</span>&nbsp;<span class="builtintype" id="2834365">error</span><span class="op" id="2834370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2834373">//&nbsp;Errors&nbsp;returned&nbsp;by&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="2834404">var</span>&nbsp;<span class="op" id="2834408">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2834411">ErrTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2834430">=</span>&nbsp;<span class="ident" id="2834432">errors</span><span class="op" id="2834438">.</span><span class="ident" id="2834439">New</span><span class="op" id="2834442">(</span><span class="string" id="2834443">&#34;bufio.Scanner:&nbsp;token&nbsp;too&nbsp;long&#34;</span><span class="op" id="2834474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2834477">ErrNegativeAdvance</span>&nbsp;<span class="op" id="2834496">=</span>&nbsp;<span class="ident" id="2834498">errors</span><span class="op" id="2834504">.</span><span class="ident" id="2834505">New</span><span class="op" id="2834508">(</span><span class="string" id="2834509">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;negative&nbsp;advance&nbsp;count&#34;</span><span class="op" id="2834566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2834569">ErrAdvanceTooFar</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2834588">=</span>&nbsp;<span class="ident" id="2834590">errors</span><span class="op" id="2834596">.</span><span class="ident" id="2834597">New</span><span class="op" id="2834600">(</span><span class="string" id="2834601">&#34;bufio.Scanner:&nbsp;SplitFunc&nbsp;returns&nbsp;advance&nbsp;count&nbsp;beyond&nbsp;input&#34;</span><span class="op" id="2834662">)</span><br>
<span class="lineno">65</span><span class="op" id="2834664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2834667">const</span>&nbsp;<span class="op" id="2834673">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2834676">//&nbsp;MaxScanTokenSize&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;used&nbsp;to&nbsp;buffer&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2834741">//&nbsp;The&nbsp;actual&nbsp;maximum&nbsp;token&nbsp;size&nbsp;may&nbsp;be&nbsp;smaller&nbsp;as&nbsp;the&nbsp;buffer</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2834804">//&nbsp;may&nbsp;need&nbsp;to&nbsp;include,&nbsp;for&nbsp;instance,&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2834854">MaxScanTokenSize</span>&nbsp;<span class="op" id="2834871">=</span>&nbsp;<span class="num" id="2834873">64</span>&nbsp;<span class="op" id="2834876">*</span>&nbsp;<span class="num" id="2834878">1024</span><br>
<span class="lineno"></span><span class="op" id="2834883">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2834886">//&nbsp;NewScanner&nbsp;returns&nbsp;a&nbsp;new&nbsp;Scanner&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno">75</span><span class="comment" id="2834938">//&nbsp;The&nbsp;split&nbsp;function&nbsp;defaults&nbsp;to&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="2834983">func</span>&nbsp;<span class="ident" id="2834988">NewScanner</span><span class="op" id="2834998">(</span><span class="ident" id="2834999">r</span>&nbsp;<span class="ident" id="2835001">io</span><span class="op" id="2835003">.</span><span class="ident" id="2835004">Reader</span><span class="op" id="2835010">)</span>&nbsp;<span class="op" id="2835012">*</span><span class="ident" id="2835013">Scanner</span>&nbsp;<span class="op" id="2835021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835024">return</span>&nbsp;<span class="op" id="2835031">&amp;</span><span class="ident" id="2835032">Scanner</span><span class="op" id="2835039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835043">r</span><span class="op" id="2835044">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835057">r</span><span class="op" id="2835058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835062">split</span><span class="op" id="2835067">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835076">ScanLines</span><span class="op" id="2835085">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835089">maxTokenSize</span><span class="op" id="2835101">:</span>&nbsp;<span class="ident" id="2835103">MaxScanTokenSize</span><span class="op" id="2835119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2835123">buf</span><span class="op" id="2835126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2835137">make</span><span class="op" id="2835141">(</span><span class="op" id="2835142">[</span><span class="op" id="2835143">]</span><span class="builtintype" id="2835144">byte</span><span class="op" id="2835148">,</span>&nbsp;<span class="num" id="2835150">4096</span><span class="op" id="2835154">)</span><span class="op" id="2835155">,</span>&nbsp;<span class="comment" id="2835157">//&nbsp;Plausible&nbsp;starting&nbsp;size;&nbsp;needn&#39;t&nbsp;be&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2835204">}</span><br>
<span class="lineno"></span><span class="op" id="2835206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2835209">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;first&nbsp;non-EOF&nbsp;error&nbsp;that&nbsp;was&nbsp;encountered&nbsp;by&nbsp;the&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="keyword" id="2835285">func</span>&nbsp;<span class="op" id="2835290">(</span><span class="ident" id="2835291">s</span>&nbsp;<span class="op" id="2835293">*</span><span class="ident" id="2835294">Scanner</span><span class="op" id="2835301">)</span>&nbsp;<span class="ident" id="2835303">Err</span><span class="op" id="2835306">(</span><span class="op" id="2835307">)</span>&nbsp;<span class="builtintype" id="2835309">error</span>&nbsp;<span class="op" id="2835315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835318">if</span>&nbsp;<span class="ident" id="2835321">s</span><span class="op" id="2835322">.</span><span class="ident" id="2835323">err</span>&nbsp;<span class="op" id="2835327">==</span>&nbsp;<span class="ident" id="2835330">io</span><span class="op" id="2835332">.</span><span class="ident" id="2835333">EOF</span>&nbsp;<span class="op" id="2835337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835341">return</span>&nbsp;<span class="builtintype" id="2835348">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2835353">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835356">return</span>&nbsp;<span class="ident" id="2835363">s</span><span class="op" id="2835364">.</span><span class="ident" id="2835365">err</span><br>
<span class="lineno"></span><span class="op" id="2835369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2835372">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="comment" id="2835440">//&nbsp;The&nbsp;underlying&nbsp;array&nbsp;may&nbsp;point&nbsp;to&nbsp;data&nbsp;that&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno">95</span><span class="comment" id="2835507">//&nbsp;by&nbsp;a&nbsp;subsequent&nbsp;call&nbsp;to&nbsp;Scan.&nbsp;It&nbsp;does&nbsp;no&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="2835563">func</span>&nbsp;<span class="op" id="2835568">(</span><span class="ident" id="2835569">s</span>&nbsp;<span class="op" id="2835571">*</span><span class="ident" id="2835572">Scanner</span><span class="op" id="2835579">)</span>&nbsp;<span class="ident" id="2835581">Bytes</span><span class="op" id="2835586">(</span><span class="op" id="2835587">)</span>&nbsp;<span class="op" id="2835589">[</span><span class="op" id="2835590">]</span><span class="builtintype" id="2835591">byte</span>&nbsp;<span class="op" id="2835596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835599">return</span>&nbsp;<span class="ident" id="2835606">s</span><span class="op" id="2835607">.</span><span class="ident" id="2835608">token</span><br>
<span class="lineno"></span><span class="op" id="2835614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2835617">//&nbsp;Text&nbsp;returns&nbsp;the&nbsp;most&nbsp;recent&nbsp;token&nbsp;generated&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan</span><br>
<span class="lineno"></span><span class="comment" id="2835683">//&nbsp;as&nbsp;a&nbsp;newly&nbsp;allocated&nbsp;string&nbsp;holding&nbsp;its&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="2835733">func</span>&nbsp;<span class="op" id="2835738">(</span><span class="ident" id="2835739">s</span>&nbsp;<span class="op" id="2835741">*</span><span class="ident" id="2835742">Scanner</span><span class="op" id="2835749">)</span>&nbsp;<span class="ident" id="2835751">Text</span><span class="op" id="2835755">(</span><span class="op" id="2835756">)</span>&nbsp;<span class="builtintype" id="2835758">string</span>&nbsp;<span class="op" id="2835765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2835768">return</span>&nbsp;<span class="builtintype" id="2835775">string</span><span class="op" id="2835781">(</span><span class="ident" id="2835782">s</span><span class="op" id="2835783">.</span><span class="ident" id="2835784">token</span><span class="op" id="2835789">)</span><br>
<span class="lineno"></span><span class="op" id="2835791">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="2835794">//&nbsp;Scan&nbsp;advances&nbsp;the&nbsp;Scanner&nbsp;to&nbsp;the&nbsp;next&nbsp;token,&nbsp;which&nbsp;will&nbsp;then&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2835861">//&nbsp;available&nbsp;through&nbsp;the&nbsp;Bytes&nbsp;or&nbsp;Text&nbsp;method.&nbsp;It&nbsp;returns&nbsp;false&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2835934">//&nbsp;scan&nbsp;stops,&nbsp;either&nbsp;by&nbsp;reaching&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;or&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2836002">//&nbsp;After&nbsp;Scan&nbsp;returns&nbsp;false,&nbsp;the&nbsp;Err&nbsp;method&nbsp;will&nbsp;return&nbsp;any&nbsp;error&nbsp;that</span><br>
<span class="lineno">110</span><span class="comment" id="2836073">//&nbsp;occurred&nbsp;during&nbsp;scanning,&nbsp;except&nbsp;that&nbsp;if&nbsp;it&nbsp;was&nbsp;io.EOF,&nbsp;Err</span><br>
<span class="lineno"></span><span class="comment" id="2836136">//&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2836156">//&nbsp;Split&nbsp;panics&nbsp;if&nbsp;the&nbsp;split&nbsp;function&nbsp;returns&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="2836227">//&nbsp;advancing&nbsp;the&nbsp;input.&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;error&nbsp;mode&nbsp;for&nbsp;scanners.</span><br>
<span class="lineno"></span><span class="keyword" id="2836293">func</span>&nbsp;<span class="op" id="2836298">(</span><span class="ident" id="2836299">s</span>&nbsp;<span class="op" id="2836301">*</span><span class="ident" id="2836302">Scanner</span><span class="op" id="2836309">)</span>&nbsp;<span class="ident" id="2836311">Scan</span><span class="op" id="2836315">(</span><span class="op" id="2836316">)</span>&nbsp;<span class="builtintype" id="2836318">bool</span>&nbsp;<span class="op" id="2836323">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2836326">//&nbsp;Loop&nbsp;until&nbsp;we&nbsp;have&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836358">for</span>&nbsp;<span class="op" id="2836362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2836366">//&nbsp;See&nbsp;if&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;already&nbsp;have.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2836424">//&nbsp;If&nbsp;we&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;data&nbsp;but&nbsp;have&nbsp;an&nbsp;error,&nbsp;give&nbsp;the&nbsp;split&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2836497">//&nbsp;a&nbsp;chance&nbsp;to&nbsp;recover&nbsp;any&nbsp;remaining,&nbsp;possibly&nbsp;empty&nbsp;token.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836559">if</span>&nbsp;<span class="ident" id="2836562">s</span><span class="op" id="2836563">.</span><span class="ident" id="2836564">end</span>&nbsp;<span class="op" id="2836568">&gt;</span>&nbsp;<span class="ident" id="2836570">s</span><span class="op" id="2836571">.</span><span class="ident" id="2836572">start</span>&nbsp;<span class="op" id="2836578">||</span>&nbsp;<span class="ident" id="2836581">s</span><span class="op" id="2836582">.</span><span class="ident" id="2836583">err</span>&nbsp;<span class="op" id="2836587">!=</span>&nbsp;<span class="builtintype" id="2836590">nil</span>&nbsp;<span class="op" id="2836594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2836599">advance</span><span class="op" id="2836606">,</span>&nbsp;<span class="ident" id="2836608">token</span><span class="op" id="2836613">,</span>&nbsp;<span class="ident" id="2836615">err</span>&nbsp;<span class="op" id="2836619">:=</span>&nbsp;<span class="ident" id="2836622">s</span><span class="op" id="2836623">.</span><span class="ident" id="2836624">split</span><span class="op" id="2836629">(</span><span class="ident" id="2836630">s</span><span class="op" id="2836631">.</span><span class="ident" id="2836632">buf</span><span class="op" id="2836635">[</span><span class="ident" id="2836636">s</span><span class="op" id="2836637">.</span><span class="ident" id="2836638">start</span><span class="op" id="2836643">:</span><span class="ident" id="2836644">s</span><span class="op" id="2836645">.</span><span class="ident" id="2836646">end</span><span class="op" id="2836649">]</span><span class="op" id="2836650">,</span>&nbsp;<span class="ident" id="2836652">s</span><span class="op" id="2836653">.</span><span class="ident" id="2836654">err</span>&nbsp;<span class="op" id="2836658">!=</span>&nbsp;<span class="builtintype" id="2836661">nil</span><span class="op" id="2836664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836669">if</span>&nbsp;<span class="ident" id="2836672">err</span>&nbsp;<span class="op" id="2836676">!=</span>&nbsp;<span class="builtintype" id="2836679">nil</span>&nbsp;<span class="op" id="2836683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2836689">s</span><span class="op" id="2836690">.</span><span class="ident" id="2836691">setErr</span><span class="op" id="2836697">(</span><span class="ident" id="2836698">err</span><span class="op" id="2836701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836707">return</span>&nbsp;<span class="builtintype" id="2836714">false</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2836723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836728">if</span>&nbsp;<span class="op" id="2836731">!</span><span class="ident" id="2836732">s</span><span class="op" id="2836733">.</span><span class="ident" id="2836734">advance</span><span class="op" id="2836741">(</span><span class="ident" id="2836742">advance</span><span class="op" id="2836749">)</span>&nbsp;<span class="op" id="2836751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836757">return</span>&nbsp;<span class="builtintype" id="2836764">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2836773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2836778">s</span><span class="op" id="2836779">.</span><span class="ident" id="2836780">token</span>&nbsp;<span class="op" id="2836786">=</span>&nbsp;<span class="ident" id="2836788">token</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836797">if</span>&nbsp;<span class="ident" id="2836800">token</span>&nbsp;<span class="op" id="2836806">!=</span>&nbsp;<span class="builtintype" id="2836809">nil</span>&nbsp;<span class="op" id="2836813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836819">if</span>&nbsp;<span class="ident" id="2836822">s</span><span class="op" id="2836823">.</span><span class="ident" id="2836824">err</span>&nbsp;<span class="op" id="2836828">==</span>&nbsp;<span class="builtintype" id="2836831">nil</span>&nbsp;<span class="op" id="2836835">||</span>&nbsp;<span class="ident" id="2836838">advance</span>&nbsp;<span class="op" id="2836846">&gt;</span>&nbsp;<span class="num" id="2836848">0</span>&nbsp;<span class="op" id="2836850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2836857">s</span><span class="op" id="2836858">.</span><span class="ident" id="2836859">empties</span>&nbsp;<span class="op" id="2836867">=</span>&nbsp;<span class="num" id="2836869">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2836875">}</span>&nbsp;<span class="keyword" id="2836877">else</span>&nbsp;<span class="op" id="2836882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2836889">//&nbsp;Returning&nbsp;tokens&nbsp;not&nbsp;advancing&nbsp;input&nbsp;at&nbsp;EOF.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2836942">s</span><span class="op" id="2836943">.</span><span class="ident" id="2836944">empties</span><span class="op" id="2836951">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2836959">if</span>&nbsp;<span class="ident" id="2836962">s</span><span class="op" id="2836963">.</span><span class="ident" id="2836964">empties</span>&nbsp;<span class="op" id="2836972">&gt;</span>&nbsp;<span class="num" id="2836974">100</span>&nbsp;<span class="op" id="2836978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2836986">panic</span><span class="op" id="2836991">(</span><span class="string" id="2836992">&#34;bufio.Scan:&nbsp;100&nbsp;empty&nbsp;tokens&nbsp;without&nbsp;progressing&#34;</span><span class="op" id="2837042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837055">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837061">return</span>&nbsp;<span class="builtintype" id="2837068">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837084">//&nbsp;We&nbsp;cannot&nbsp;generate&nbsp;a&nbsp;token&nbsp;with&nbsp;what&nbsp;we&nbsp;are&nbsp;holding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837142">//&nbsp;If&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;EOF&nbsp;or&nbsp;an&nbsp;I/O&nbsp;error,&nbsp;we&nbsp;are&nbsp;done.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837202">if</span>&nbsp;<span class="ident" id="2837205">s</span><span class="op" id="2837206">.</span><span class="ident" id="2837207">err</span>&nbsp;<span class="op" id="2837211">!=</span>&nbsp;<span class="builtintype" id="2837214">nil</span>&nbsp;<span class="op" id="2837218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837223">//&nbsp;Shut&nbsp;it&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837243">s</span><span class="op" id="2837244">.</span><span class="ident" id="2837245">start</span>&nbsp;<span class="op" id="2837251">=</span>&nbsp;<span class="num" id="2837253">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837258">s</span><span class="op" id="2837259">.</span><span class="ident" id="2837260">end</span>&nbsp;<span class="op" id="2837264">=</span>&nbsp;<span class="num" id="2837266">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837271">return</span>&nbsp;<span class="builtintype" id="2837278">false</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837290">//&nbsp;Must&nbsp;read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837316">//&nbsp;First,&nbsp;shift&nbsp;data&nbsp;to&nbsp;beginning&nbsp;of&nbsp;buffer&nbsp;if&nbsp;there&#39;s&nbsp;lots&nbsp;of&nbsp;empty&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837393">//&nbsp;or&nbsp;space&nbsp;is&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837418">if</span>&nbsp;<span class="ident" id="2837421">s</span><span class="op" id="2837422">.</span><span class="ident" id="2837423">start</span>&nbsp;<span class="op" id="2837429">&gt;</span>&nbsp;<span class="num" id="2837431">0</span>&nbsp;<span class="op" id="2837433">&amp;&amp;</span>&nbsp;<span class="op" id="2837436">(</span><span class="ident" id="2837437">s</span><span class="op" id="2837438">.</span><span class="ident" id="2837439">end</span>&nbsp;<span class="op" id="2837443">==</span>&nbsp;<span class="builtinfunc" id="2837446">len</span><span class="op" id="2837449">(</span><span class="ident" id="2837450">s</span><span class="op" id="2837451">.</span><span class="ident" id="2837452">buf</span><span class="op" id="2837455">)</span>&nbsp;<span class="op" id="2837457">||</span>&nbsp;<span class="ident" id="2837460">s</span><span class="op" id="2837461">.</span><span class="ident" id="2837462">start</span>&nbsp;<span class="op" id="2837468">&gt;</span>&nbsp;<span class="builtinfunc" id="2837470">len</span><span class="op" id="2837473">(</span><span class="ident" id="2837474">s</span><span class="op" id="2837475">.</span><span class="ident" id="2837476">buf</span><span class="op" id="2837479">)</span><span class="op" id="2837480">/</span><span class="num" id="2837481">2</span><span class="op" id="2837482">)</span>&nbsp;<span class="op" id="2837484">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2837489">copy</span><span class="op" id="2837493">(</span><span class="ident" id="2837494">s</span><span class="op" id="2837495">.</span><span class="ident" id="2837496">buf</span><span class="op" id="2837499">,</span>&nbsp;<span class="ident" id="2837501">s</span><span class="op" id="2837502">.</span><span class="ident" id="2837503">buf</span><span class="op" id="2837506">[</span><span class="ident" id="2837507">s</span><span class="op" id="2837508">.</span><span class="ident" id="2837509">start</span><span class="op" id="2837514">:</span><span class="ident" id="2837515">s</span><span class="op" id="2837516">.</span><span class="ident" id="2837517">end</span><span class="op" id="2837520">]</span><span class="op" id="2837521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837526">s</span><span class="op" id="2837527">.</span><span class="ident" id="2837528">end</span>&nbsp;<span class="op" id="2837532">-=</span>&nbsp;<span class="ident" id="2837535">s</span><span class="op" id="2837536">.</span><span class="ident" id="2837537">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837546">s</span><span class="op" id="2837547">.</span><span class="ident" id="2837548">start</span>&nbsp;<span class="op" id="2837554">=</span>&nbsp;<span class="num" id="2837556">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837564">//&nbsp;Is&nbsp;the&nbsp;buffer&nbsp;full?&nbsp;If&nbsp;so,&nbsp;resize.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837604">if</span>&nbsp;<span class="ident" id="2837607">s</span><span class="op" id="2837608">.</span><span class="ident" id="2837609">end</span>&nbsp;<span class="op" id="2837613">==</span>&nbsp;<span class="builtinfunc" id="2837616">len</span><span class="op" id="2837619">(</span><span class="ident" id="2837620">s</span><span class="op" id="2837621">.</span><span class="ident" id="2837622">buf</span><span class="op" id="2837625">)</span>&nbsp;<span class="op" id="2837627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837632">if</span>&nbsp;<span class="builtinfunc" id="2837635">len</span><span class="op" id="2837638">(</span><span class="ident" id="2837639">s</span><span class="op" id="2837640">.</span><span class="ident" id="2837641">buf</span><span class="op" id="2837644">)</span>&nbsp;<span class="op" id="2837646">&gt;=</span>&nbsp;<span class="ident" id="2837649">s</span><span class="op" id="2837650">.</span><span class="ident" id="2837651">maxTokenSize</span>&nbsp;<span class="op" id="2837664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837670">s</span><span class="op" id="2837671">.</span><span class="ident" id="2837672">setErr</span><span class="op" id="2837678">(</span><span class="ident" id="2837679">ErrTooLong</span><span class="op" id="2837689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837695">return</span>&nbsp;<span class="builtintype" id="2837702">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837711">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837716">newSize</span>&nbsp;<span class="op" id="2837724">:=</span>&nbsp;<span class="builtinfunc" id="2837727">len</span><span class="op" id="2837730">(</span><span class="ident" id="2837731">s</span><span class="op" id="2837732">.</span><span class="ident" id="2837733">buf</span><span class="op" id="2837736">)</span>&nbsp;<span class="op" id="2837738">*</span>&nbsp;<span class="num" id="2837740">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837745">if</span>&nbsp;<span class="ident" id="2837748">newSize</span>&nbsp;<span class="op" id="2837756">&gt;</span>&nbsp;<span class="ident" id="2837758">s</span><span class="op" id="2837759">.</span><span class="ident" id="2837760">maxTokenSize</span>&nbsp;<span class="op" id="2837773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837779">newSize</span>&nbsp;<span class="op" id="2837787">=</span>&nbsp;<span class="ident" id="2837789">s</span><span class="op" id="2837790">.</span><span class="ident" id="2837791">maxTokenSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837812">newBuf</span>&nbsp;<span class="op" id="2837819">:=</span>&nbsp;<span class="builtinfunc" id="2837822">make</span><span class="op" id="2837826">(</span><span class="op" id="2837827">[</span><span class="op" id="2837828">]</span><span class="builtintype" id="2837829">byte</span><span class="op" id="2837833">,</span>&nbsp;<span class="ident" id="2837835">newSize</span><span class="op" id="2837842">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2837847">copy</span><span class="op" id="2837851">(</span><span class="ident" id="2837852">newBuf</span><span class="op" id="2837858">,</span>&nbsp;<span class="ident" id="2837860">s</span><span class="op" id="2837861">.</span><span class="ident" id="2837862">buf</span><span class="op" id="2837865">[</span><span class="ident" id="2837866">s</span><span class="op" id="2837867">.</span><span class="ident" id="2837868">start</span><span class="op" id="2837873">:</span><span class="ident" id="2837874">s</span><span class="op" id="2837875">.</span><span class="ident" id="2837876">end</span><span class="op" id="2837879">]</span><span class="op" id="2837880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837885">s</span><span class="op" id="2837886">.</span><span class="ident" id="2837887">buf</span>&nbsp;<span class="op" id="2837891">=</span>&nbsp;<span class="ident" id="2837893">newBuf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837903">s</span><span class="op" id="2837904">.</span><span class="ident" id="2837905">end</span>&nbsp;<span class="op" id="2837909">-=</span>&nbsp;<span class="ident" id="2837912">s</span><span class="op" id="2837913">.</span><span class="ident" id="2837914">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2837923">s</span><span class="op" id="2837924">.</span><span class="ident" id="2837925">start</span>&nbsp;<span class="op" id="2837931">=</span>&nbsp;<span class="num" id="2837933">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2837938">continue</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2837949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2837953">//&nbsp;Finally&nbsp;we&nbsp;can&nbsp;read&nbsp;some&nbsp;input.&nbsp;Make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;stuck&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2838024">//&nbsp;a&nbsp;misbehaving&nbsp;Reader.&nbsp;Officially&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;do&nbsp;this,&nbsp;but&nbsp;let&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2838098">//&nbsp;be&nbsp;extra&nbsp;careful:&nbsp;Scanner&nbsp;is&nbsp;for&nbsp;safe,&nbsp;simple&nbsp;jobs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838155">for</span>&nbsp;<span class="ident" id="2838159">loop</span>&nbsp;<span class="op" id="2838164">:=</span>&nbsp;<span class="num" id="2838167">0</span><span class="op" id="2838168">;</span>&nbsp;<span class="op" id="2838170">;</span>&nbsp;<span class="op" id="2838172">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838177">n</span><span class="op" id="2838178">,</span>&nbsp;<span class="ident" id="2838180">err</span>&nbsp;<span class="op" id="2838184">:=</span>&nbsp;<span class="ident" id="2838187">s</span><span class="op" id="2838188">.</span><span class="ident" id="2838189">r</span><span class="op" id="2838190">.</span><span class="ident" id="2838191">Read</span><span class="op" id="2838195">(</span><span class="ident" id="2838196">s</span><span class="op" id="2838197">.</span><span class="ident" id="2838198">buf</span><span class="op" id="2838201">[</span><span class="ident" id="2838202">s</span><span class="op" id="2838203">.</span><span class="ident" id="2838204">end</span><span class="op" id="2838207">:</span><span class="builtinfunc" id="2838208">len</span><span class="op" id="2838211">(</span><span class="ident" id="2838212">s</span><span class="op" id="2838213">.</span><span class="ident" id="2838214">buf</span><span class="op" id="2838217">)</span><span class="op" id="2838218">]</span><span class="op" id="2838219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838224">s</span><span class="op" id="2838225">.</span><span class="ident" id="2838226">end</span>&nbsp;<span class="op" id="2838230">+=</span>&nbsp;<span class="ident" id="2838233">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838238">if</span>&nbsp;<span class="ident" id="2838241">err</span>&nbsp;<span class="op" id="2838245">!=</span>&nbsp;<span class="builtintype" id="2838248">nil</span>&nbsp;<span class="op" id="2838252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838258">s</span><span class="op" id="2838259">.</span><span class="ident" id="2838260">setErr</span><span class="op" id="2838266">(</span><span class="ident" id="2838267">err</span><span class="op" id="2838270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838276">break</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838290">if</span>&nbsp;<span class="ident" id="2838293">n</span>&nbsp;<span class="op" id="2838295">&gt;</span>&nbsp;<span class="num" id="2838297">0</span>&nbsp;<span class="op" id="2838299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838305">s</span><span class="op" id="2838306">.</span><span class="ident" id="2838307">empties</span>&nbsp;<span class="op" id="2838315">=</span>&nbsp;<span class="num" id="2838317">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838323">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838332">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838337">loop</span><span class="op" id="2838341">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838347">if</span>&nbsp;<span class="ident" id="2838350">loop</span>&nbsp;<span class="op" id="2838355">&gt;</span>&nbsp;<span class="ident" id="2838357">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2838382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838388">s</span><span class="op" id="2838389">.</span><span class="ident" id="2838390">setErr</span><span class="op" id="2838396">(</span><span class="ident" id="2838397">io</span><span class="op" id="2838399">.</span><span class="ident" id="2838400">ErrNoProgress</span><span class="op" id="2838413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838419">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838428">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838435">}</span><br>
<span class="lineno"></span><span class="op" id="2838437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2838440">//&nbsp;advance&nbsp;consumes&nbsp;n&nbsp;bytes&nbsp;of&nbsp;the&nbsp;buffer.&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;advance&nbsp;was&nbsp;legal.</span><br>
<span class="lineno">200</span><span class="keyword" id="2838525">func</span>&nbsp;<span class="op" id="2838530">(</span><span class="ident" id="2838531">s</span>&nbsp;<span class="op" id="2838533">*</span><span class="ident" id="2838534">Scanner</span><span class="op" id="2838541">)</span>&nbsp;<span class="ident" id="2838543">advance</span><span class="op" id="2838550">(</span><span class="ident" id="2838551">n</span>&nbsp;<span class="builtintype" id="2838553">int</span><span class="op" id="2838556">)</span>&nbsp;<span class="builtintype" id="2838558">bool</span>&nbsp;<span class="op" id="2838563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838566">if</span>&nbsp;<span class="ident" id="2838569">n</span>&nbsp;<span class="op" id="2838571">&lt;</span>&nbsp;<span class="num" id="2838573">0</span>&nbsp;<span class="op" id="2838575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838579">s</span><span class="op" id="2838580">.</span><span class="ident" id="2838581">setErr</span><span class="op" id="2838587">(</span><span class="ident" id="2838588">ErrNegativeAdvance</span><span class="op" id="2838606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838610">return</span>&nbsp;<span class="builtintype" id="2838617">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838624">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838627">if</span>&nbsp;<span class="ident" id="2838630">n</span>&nbsp;<span class="op" id="2838632">&gt;</span>&nbsp;<span class="ident" id="2838634">s</span><span class="op" id="2838635">.</span><span class="ident" id="2838636">end</span><span class="op" id="2838639">-</span><span class="ident" id="2838640">s</span><span class="op" id="2838641">.</span><span class="ident" id="2838642">start</span>&nbsp;<span class="op" id="2838648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838652">s</span><span class="op" id="2838653">.</span><span class="ident" id="2838654">setErr</span><span class="op" id="2838660">(</span><span class="ident" id="2838661">ErrAdvanceTooFar</span><span class="op" id="2838677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838681">return</span>&nbsp;<span class="builtintype" id="2838688">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838698">s</span><span class="op" id="2838699">.</span><span class="ident" id="2838700">start</span>&nbsp;<span class="op" id="2838706">+=</span>&nbsp;<span class="ident" id="2838709">n</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838712">return</span>&nbsp;<span class="builtintype" id="2838719">true</span><br>
<span class="lineno"></span><span class="op" id="2838724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2838727">//&nbsp;setErr&nbsp;records&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="2838774">func</span>&nbsp;<span class="op" id="2838779">(</span><span class="ident" id="2838780">s</span>&nbsp;<span class="op" id="2838782">*</span><span class="ident" id="2838783">Scanner</span><span class="op" id="2838790">)</span>&nbsp;<span class="ident" id="2838792">setErr</span><span class="op" id="2838798">(</span><span class="ident" id="2838799">err</span>&nbsp;<span class="builtintype" id="2838803">error</span><span class="op" id="2838808">)</span>&nbsp;<span class="op" id="2838810">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2838813">if</span>&nbsp;<span class="ident" id="2838816">s</span><span class="op" id="2838817">.</span><span class="ident" id="2838818">err</span>&nbsp;<span class="op" id="2838822">==</span>&nbsp;<span class="builtintype" id="2838825">nil</span>&nbsp;<span class="op" id="2838829">||</span>&nbsp;<span class="ident" id="2838832">s</span><span class="op" id="2838833">.</span><span class="ident" id="2838834">err</span>&nbsp;<span class="op" id="2838838">==</span>&nbsp;<span class="ident" id="2838841">io</span><span class="op" id="2838843">.</span><span class="ident" id="2838844">EOF</span>&nbsp;<span class="op" id="2838848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2838852">s</span><span class="op" id="2838853">.</span><span class="ident" id="2838854">err</span>&nbsp;<span class="op" id="2838858">=</span>&nbsp;<span class="ident" id="2838860">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2838865">}</span><br>
<span class="lineno"></span><span class="op" id="2838867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="2838870">//&nbsp;Split&nbsp;sets&nbsp;the&nbsp;split&nbsp;function&nbsp;for&nbsp;the&nbsp;Scanner.&nbsp;If&nbsp;called,&nbsp;it&nbsp;must&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2838942">//&nbsp;called&nbsp;before&nbsp;Scan.&nbsp;The&nbsp;default&nbsp;split&nbsp;function&nbsp;is&nbsp;ScanLines.</span><br>
<span class="lineno"></span><span class="keyword" id="2839006">func</span>&nbsp;<span class="op" id="2839011">(</span><span class="ident" id="2839012">s</span>&nbsp;<span class="op" id="2839014">*</span><span class="ident" id="2839015">Scanner</span><span class="op" id="2839022">)</span>&nbsp;<span class="ident" id="2839024">Split</span><span class="op" id="2839029">(</span><span class="ident" id="2839030">split</span>&nbsp;<span class="ident" id="2839036">SplitFunc</span><span class="op" id="2839045">)</span>&nbsp;<span class="op" id="2839047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2839050">s</span><span class="op" id="2839051">.</span><span class="ident" id="2839052">split</span>&nbsp;<span class="op" id="2839058">=</span>&nbsp;<span class="ident" id="2839060">split</span><br>
<span class="lineno"></span><span class="op" id="2839066">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2839069">//&nbsp;Split&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2839089">//&nbsp;ScanBytes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;byte&nbsp;as&nbsp;a&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="2839171">func</span>&nbsp;<span class="ident" id="2839176">ScanBytes</span><span class="op" id="2839185">(</span><span class="ident" id="2839186">data</span>&nbsp;<span class="op" id="2839191">[</span><span class="op" id="2839192">]</span><span class="builtintype" id="2839193">byte</span><span class="op" id="2839197">,</span>&nbsp;<span class="ident" id="2839199">atEOF</span>&nbsp;<span class="builtintype" id="2839205">bool</span><span class="op" id="2839209">)</span>&nbsp;<span class="op" id="2839211">(</span><span class="ident" id="2839212">advance</span>&nbsp;<span class="builtintype" id="2839220">int</span><span class="op" id="2839223">,</span>&nbsp;<span class="ident" id="2839225">token</span>&nbsp;<span class="op" id="2839231">[</span><span class="op" id="2839232">]</span><span class="builtintype" id="2839233">byte</span><span class="op" id="2839237">,</span>&nbsp;<span class="ident" id="2839239">err</span>&nbsp;<span class="builtintype" id="2839243">error</span><span class="op" id="2839248">)</span>&nbsp;<span class="op" id="2839250">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839253">if</span>&nbsp;<span class="ident" id="2839256">atEOF</span>&nbsp;<span class="op" id="2839262">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2839265">len</span><span class="op" id="2839268">(</span><span class="ident" id="2839269">data</span><span class="op" id="2839273">)</span>&nbsp;<span class="op" id="2839275">==</span>&nbsp;<span class="num" id="2839278">0</span>&nbsp;<span class="op" id="2839280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839284">return</span>&nbsp;<span class="num" id="2839291">0</span><span class="op" id="2839292">,</span>&nbsp;<span class="builtintype" id="2839294">nil</span><span class="op" id="2839297">,</span>&nbsp;<span class="builtintype" id="2839299">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2839304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839307">return</span>&nbsp;<span class="num" id="2839314">1</span><span class="op" id="2839315">,</span>&nbsp;<span class="ident" id="2839317">data</span><span class="op" id="2839321">[</span><span class="num" id="2839322">0</span><span class="op" id="2839323">:</span><span class="num" id="2839324">1</span><span class="op" id="2839325">]</span><span class="op" id="2839326">,</span>&nbsp;<span class="builtintype" id="2839328">nil</span><br>
<span class="lineno"></span><span class="op" id="2839332">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="2839335">var</span>&nbsp;<span class="ident" id="2839339">errorRune</span>&nbsp;<span class="op" id="2839349">=</span>&nbsp;<span class="op" id="2839351">[</span><span class="op" id="2839352">]</span><span class="builtintype" id="2839353">byte</span><span class="op" id="2839357">(</span><span class="builtintype" id="2839358">string</span><span class="op" id="2839364">(</span><span class="ident" id="2839365">utf8</span><span class="op" id="2839369">.</span><span class="ident" id="2839370">RuneError</span><span class="op" id="2839379">)</span><span class="op" id="2839380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2839383">//&nbsp;ScanRunes&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="2839448">//&nbsp;UTF-8-encoded&nbsp;rune&nbsp;as&nbsp;a&nbsp;token.&nbsp;The&nbsp;sequence&nbsp;of&nbsp;runes&nbsp;returned&nbsp;is</span><br>
<span class="lineno">240</span><span class="comment" id="2839516">//&nbsp;equivalent&nbsp;to&nbsp;that&nbsp;from&nbsp;a&nbsp;range&nbsp;loop&nbsp;over&nbsp;the&nbsp;input&nbsp;as&nbsp;a&nbsp;string,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2839590">//&nbsp;means&nbsp;that&nbsp;erroneous&nbsp;UTF-8&nbsp;encodings&nbsp;translate&nbsp;to&nbsp;U+FFFD&nbsp;=&nbsp;&#34;\xef\xbf\xbd&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2839668">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;Scan&nbsp;interface,&nbsp;this&nbsp;makes&nbsp;it&nbsp;impossible&nbsp;for&nbsp;the&nbsp;client&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2839745">//&nbsp;distinguish&nbsp;correctly&nbsp;encoded&nbsp;replacement&nbsp;runes&nbsp;from&nbsp;encoding&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="2839818">func</span>&nbsp;<span class="ident" id="2839823">ScanRunes</span><span class="op" id="2839832">(</span><span class="ident" id="2839833">data</span>&nbsp;<span class="op" id="2839838">[</span><span class="op" id="2839839">]</span><span class="builtintype" id="2839840">byte</span><span class="op" id="2839844">,</span>&nbsp;<span class="ident" id="2839846">atEOF</span>&nbsp;<span class="builtintype" id="2839852">bool</span><span class="op" id="2839856">)</span>&nbsp;<span class="op" id="2839858">(</span><span class="ident" id="2839859">advance</span>&nbsp;<span class="builtintype" id="2839867">int</span><span class="op" id="2839870">,</span>&nbsp;<span class="ident" id="2839872">token</span>&nbsp;<span class="op" id="2839878">[</span><span class="op" id="2839879">]</span><span class="builtintype" id="2839880">byte</span><span class="op" id="2839884">,</span>&nbsp;<span class="ident" id="2839886">err</span>&nbsp;<span class="builtintype" id="2839890">error</span><span class="op" id="2839895">)</span>&nbsp;<span class="op" id="2839897">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839900">if</span>&nbsp;<span class="ident" id="2839903">atEOF</span>&nbsp;<span class="op" id="2839909">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2839912">len</span><span class="op" id="2839915">(</span><span class="ident" id="2839916">data</span><span class="op" id="2839920">)</span>&nbsp;<span class="op" id="2839922">==</span>&nbsp;<span class="num" id="2839925">0</span>&nbsp;<span class="op" id="2839927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839931">return</span>&nbsp;<span class="num" id="2839938">0</span><span class="op" id="2839939">,</span>&nbsp;<span class="builtintype" id="2839941">nil</span><span class="op" id="2839944">,</span>&nbsp;<span class="builtintype" id="2839946">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2839951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2839955">//&nbsp;Fast&nbsp;path&nbsp;1:&nbsp;ASCII.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2839979">if</span>&nbsp;<span class="ident" id="2839982">data</span><span class="op" id="2839986">[</span><span class="num" id="2839987">0</span><span class="op" id="2839988">]</span>&nbsp;<span class="op" id="2839990">&lt;</span>&nbsp;<span class="ident" id="2839992">utf8</span><span class="op" id="2839996">.</span><span class="ident" id="2839997">RuneSelf</span>&nbsp;<span class="op" id="2840006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840010">return</span>&nbsp;<span class="num" id="2840017">1</span><span class="op" id="2840018">,</span>&nbsp;<span class="ident" id="2840020">data</span><span class="op" id="2840024">[</span><span class="num" id="2840025">0</span><span class="op" id="2840026">:</span><span class="num" id="2840027">1</span><span class="op" id="2840028">]</span><span class="op" id="2840029">,</span>&nbsp;<span class="builtintype" id="2840031">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2840036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840040">//&nbsp;Fast&nbsp;path&nbsp;2:&nbsp;Correct&nbsp;UTF-8&nbsp;decode&nbsp;without&nbsp;error.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2840093">_</span><span class="op" id="2840094">,</span>&nbsp;<span class="ident" id="2840096">width</span>&nbsp;<span class="op" id="2840102">:=</span>&nbsp;<span class="ident" id="2840105">utf8</span><span class="op" id="2840109">.</span><span class="ident" id="2840110">DecodeRune</span><span class="op" id="2840120">(</span><span class="ident" id="2840121">data</span><span class="op" id="2840125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840128">if</span>&nbsp;<span class="ident" id="2840131">width</span>&nbsp;<span class="op" id="2840137">&gt;</span>&nbsp;<span class="num" id="2840139">1</span>&nbsp;<span class="op" id="2840141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840145">//&nbsp;It&#39;s&nbsp;a&nbsp;valid&nbsp;encoding.&nbsp;Width&nbsp;cannot&nbsp;be&nbsp;one&nbsp;for&nbsp;a&nbsp;correctly&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840217">//&nbsp;non-ASCII&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840238">return</span>&nbsp;<span class="ident" id="2840245">width</span><span class="op" id="2840250">,</span>&nbsp;<span class="ident" id="2840252">data</span><span class="op" id="2840256">[</span><span class="num" id="2840257">0</span><span class="op" id="2840258">:</span><span class="ident" id="2840259">width</span><span class="op" id="2840264">]</span><span class="op" id="2840265">,</span>&nbsp;<span class="builtintype" id="2840267">nil</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2840272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840276">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;an&nbsp;error:&nbsp;we&nbsp;have&nbsp;width==1&nbsp;and&nbsp;implicitly&nbsp;r==utf8.RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840354">//&nbsp;Is&nbsp;the&nbsp;error&nbsp;because&nbsp;there&nbsp;wasn&#39;t&nbsp;a&nbsp;full&nbsp;rune&nbsp;to&nbsp;be&nbsp;decoded?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840419">//&nbsp;FullRune&nbsp;distinguishes&nbsp;correctly&nbsp;between&nbsp;erroneous&nbsp;and&nbsp;incomplete&nbsp;encodings.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840500">if</span>&nbsp;<span class="op" id="2840503">!</span><span class="ident" id="2840504">atEOF</span>&nbsp;<span class="op" id="2840510">&amp;&amp;</span>&nbsp;<span class="op" id="2840513">!</span><span class="ident" id="2840514">utf8</span><span class="op" id="2840518">.</span><span class="ident" id="2840519">FullRune</span><span class="op" id="2840527">(</span><span class="ident" id="2840528">data</span><span class="op" id="2840532">)</span>&nbsp;<span class="op" id="2840534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840538">//&nbsp;Incomplete;&nbsp;get&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840571">return</span>&nbsp;<span class="num" id="2840578">0</span><span class="op" id="2840579">,</span>&nbsp;<span class="builtintype" id="2840581">nil</span><span class="op" id="2840584">,</span>&nbsp;<span class="builtintype" id="2840586">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2840591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840595">//&nbsp;We&nbsp;have&nbsp;a&nbsp;real&nbsp;UTF-8&nbsp;encoding&nbsp;error.&nbsp;Return&nbsp;a&nbsp;properly&nbsp;encoded&nbsp;error&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840673">//&nbsp;but&nbsp;advance&nbsp;only&nbsp;one&nbsp;byte.&nbsp;This&nbsp;matches&nbsp;the&nbsp;behavior&nbsp;of&nbsp;a&nbsp;range&nbsp;loop&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2840751">//&nbsp;an&nbsp;incorrectly&nbsp;encoded&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840786">return</span>&nbsp;<span class="num" id="2840793">1</span><span class="op" id="2840794">,</span>&nbsp;<span class="ident" id="2840796">errorRune</span><span class="op" id="2840805">,</span>&nbsp;<span class="builtintype" id="2840807">nil</span><br>
<span class="lineno"></span><span class="op" id="2840811">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="2840814">//&nbsp;dropCR&nbsp;drops&nbsp;a&nbsp;terminal&nbsp;\r&nbsp;from&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2840859">func</span>&nbsp;<span class="ident" id="2840864">dropCR</span><span class="op" id="2840870">(</span><span class="ident" id="2840871">data</span>&nbsp;<span class="op" id="2840876">[</span><span class="op" id="2840877">]</span><span class="builtintype" id="2840878">byte</span><span class="op" id="2840882">)</span>&nbsp;<span class="op" id="2840884">[</span><span class="op" id="2840885">]</span><span class="builtintype" id="2840886">byte</span>&nbsp;<span class="op" id="2840891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840894">if</span>&nbsp;<span class="builtinfunc" id="2840897">len</span><span class="op" id="2840900">(</span><span class="ident" id="2840901">data</span><span class="op" id="2840905">)</span>&nbsp;<span class="op" id="2840907">&gt;</span>&nbsp;<span class="num" id="2840909">0</span>&nbsp;<span class="op" id="2840911">&amp;&amp;</span>&nbsp;<span class="ident" id="2840914">data</span><span class="op" id="2840918">[</span><span class="builtinfunc" id="2840919">len</span><span class="op" id="2840922">(</span><span class="ident" id="2840923">data</span><span class="op" id="2840927">)</span><span class="op" id="2840928">-</span><span class="num" id="2840929">1</span><span class="op" id="2840930">]</span>&nbsp;<span class="op" id="2840932">==</span>&nbsp;<span class="string" id="2840935">&#39;\r&#39;</span>&nbsp;<span class="op" id="2840940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840944">return</span>&nbsp;<span class="ident" id="2840951">data</span><span class="op" id="2840955">[</span><span class="num" id="2840956">0</span>&nbsp;<span class="op" id="2840958">:</span>&nbsp;<span class="builtinfunc" id="2840960">len</span><span class="op" id="2840963">(</span><span class="ident" id="2840964">data</span><span class="op" id="2840968">)</span><span class="op" id="2840969">-</span><span class="num" id="2840970">1</span><span class="op" id="2840971">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2840974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2840977">return</span>&nbsp;<span class="ident" id="2840984">data</span><br>
<span class="lineno"></span><span class="op" id="2840989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2840992">//&nbsp;ScanLines&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each&nbsp;line&nbsp;of</span><br>
<span class="lineno">285</span><span class="comment" id="2841065">//&nbsp;text,&nbsp;stripped&nbsp;of&nbsp;any&nbsp;trailing&nbsp;end-of-line&nbsp;marker.&nbsp;The&nbsp;returned&nbsp;line&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="2841141">//&nbsp;be&nbsp;empty.&nbsp;The&nbsp;end-of-line&nbsp;marker&nbsp;is&nbsp;one&nbsp;optional&nbsp;carriage&nbsp;return&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="2841218">//&nbsp;by&nbsp;one&nbsp;mandatory&nbsp;newline.&nbsp;In&nbsp;regular&nbsp;expression&nbsp;notation,&nbsp;it&nbsp;is&nbsp;`\r?\n`.</span><br>
<span class="lineno"></span><span class="comment" id="2841294">//&nbsp;The&nbsp;last&nbsp;non-empty&nbsp;line&nbsp;of&nbsp;input&nbsp;will&nbsp;be&nbsp;returned&nbsp;even&nbsp;if&nbsp;it&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="2841365">//&nbsp;newline.</span><br>
<span class="lineno">290</span><span class="keyword" id="2841377">func</span>&nbsp;<span class="ident" id="2841382">ScanLines</span><span class="op" id="2841391">(</span><span class="ident" id="2841392">data</span>&nbsp;<span class="op" id="2841397">[</span><span class="op" id="2841398">]</span><span class="builtintype" id="2841399">byte</span><span class="op" id="2841403">,</span>&nbsp;<span class="ident" id="2841405">atEOF</span>&nbsp;<span class="builtintype" id="2841411">bool</span><span class="op" id="2841415">)</span>&nbsp;<span class="op" id="2841417">(</span><span class="ident" id="2841418">advance</span>&nbsp;<span class="builtintype" id="2841426">int</span><span class="op" id="2841429">,</span>&nbsp;<span class="ident" id="2841431">token</span>&nbsp;<span class="op" id="2841437">[</span><span class="op" id="2841438">]</span><span class="builtintype" id="2841439">byte</span><span class="op" id="2841443">,</span>&nbsp;<span class="ident" id="2841445">err</span>&nbsp;<span class="builtintype" id="2841449">error</span><span class="op" id="2841454">)</span>&nbsp;<span class="op" id="2841456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841459">if</span>&nbsp;<span class="ident" id="2841462">atEOF</span>&nbsp;<span class="op" id="2841468">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2841471">len</span><span class="op" id="2841474">(</span><span class="ident" id="2841475">data</span><span class="op" id="2841479">)</span>&nbsp;<span class="op" id="2841481">==</span>&nbsp;<span class="num" id="2841484">0</span>&nbsp;<span class="op" id="2841486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841490">return</span>&nbsp;<span class="num" id="2841497">0</span><span class="op" id="2841498">,</span>&nbsp;<span class="builtintype" id="2841500">nil</span><span class="op" id="2841503">,</span>&nbsp;<span class="builtintype" id="2841505">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2841510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841513">if</span>&nbsp;<span class="ident" id="2841516">i</span>&nbsp;<span class="op" id="2841518">:=</span>&nbsp;<span class="ident" id="2841521">bytes</span><span class="op" id="2841526">.</span><span class="ident" id="2841527">IndexByte</span><span class="op" id="2841536">(</span><span class="ident" id="2841537">data</span><span class="op" id="2841541">,</span>&nbsp;<span class="string" id="2841543">&#39;\n&#39;</span><span class="op" id="2841547">)</span><span class="op" id="2841548">;</span>&nbsp;<span class="ident" id="2841550">i</span>&nbsp;<span class="op" id="2841552">&gt;=</span>&nbsp;<span class="num" id="2841555">0</span>&nbsp;<span class="op" id="2841557">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2841561">//&nbsp;We&nbsp;have&nbsp;a&nbsp;full&nbsp;newline-terminated&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841606">return</span>&nbsp;<span class="ident" id="2841613">i</span>&nbsp;<span class="op" id="2841615">+</span>&nbsp;<span class="num" id="2841617">1</span><span class="op" id="2841618">,</span>&nbsp;<span class="ident" id="2841620">dropCR</span><span class="op" id="2841626">(</span><span class="ident" id="2841627">data</span><span class="op" id="2841631">[</span><span class="num" id="2841632">0</span><span class="op" id="2841633">:</span><span class="ident" id="2841634">i</span><span class="op" id="2841635">]</span><span class="op" id="2841636">)</span><span class="op" id="2841637">,</span>&nbsp;<span class="builtintype" id="2841639">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2841644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2841647">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-terminated&nbsp;line.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841717">if</span>&nbsp;<span class="ident" id="2841720">atEOF</span>&nbsp;<span class="op" id="2841726">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841730">return</span>&nbsp;<span class="builtinfunc" id="2841737">len</span><span class="op" id="2841740">(</span><span class="ident" id="2841741">data</span><span class="op" id="2841745">)</span><span class="op" id="2841746">,</span>&nbsp;<span class="ident" id="2841748">dropCR</span><span class="op" id="2841754">(</span><span class="ident" id="2841755">data</span><span class="op" id="2841759">)</span><span class="op" id="2841760">,</span>&nbsp;<span class="builtintype" id="2841762">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2841767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2841770">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2841793">return</span>&nbsp;<span class="num" id="2841800">0</span><span class="op" id="2841801">,</span>&nbsp;<span class="builtintype" id="2841803">nil</span><span class="op" id="2841806">,</span>&nbsp;<span class="builtintype" id="2841808">nil</span><br>
<span class="lineno"></span><span class="op" id="2841812">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="comment" id="2841815">//&nbsp;isSpace&nbsp;reports&nbsp;whether&nbsp;the&nbsp;character&nbsp;is&nbsp;a&nbsp;Unicode&nbsp;white&nbsp;space&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="2841892">//&nbsp;We&nbsp;avoid&nbsp;dependency&nbsp;on&nbsp;the&nbsp;unicode&nbsp;package,&nbsp;but&nbsp;check&nbsp;validity&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="2841980">//&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="keyword" id="2841997">func</span>&nbsp;<span class="ident" id="2842002">isSpace</span><span class="op" id="2842009">(</span><span class="ident" id="2842010">r</span>&nbsp;<span class="builtintype" id="2842012">rune</span><span class="op" id="2842016">)</span>&nbsp;<span class="builtintype" id="2842018">bool</span>&nbsp;<span class="op" id="2842023">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842026">if</span>&nbsp;<span class="ident" id="2842029">r</span>&nbsp;<span class="op" id="2842031">&lt;=</span>&nbsp;<span class="string" id="2842034">&#39;\u00FF&#39;</span>&nbsp;<span class="op" id="2842043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2842047">//&nbsp;Obvious&nbsp;ASCII&nbsp;ones:&nbsp;\t&nbsp;through&nbsp;\r&nbsp;plus&nbsp;space.&nbsp;Plus&nbsp;two&nbsp;Latin-1&nbsp;oddballs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842125">switch</span>&nbsp;<span class="ident" id="2842132">r</span>&nbsp;<span class="op" id="2842134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842138">case</span>&nbsp;<span class="string" id="2842143">&#39;&nbsp;&#39;</span><span class="op" id="2842146">,</span>&nbsp;<span class="string" id="2842148">&#39;\t&#39;</span><span class="op" id="2842152">,</span>&nbsp;<span class="string" id="2842154">&#39;\n&#39;</span><span class="op" id="2842158">,</span>&nbsp;<span class="string" id="2842160">&#39;\v&#39;</span><span class="op" id="2842164">,</span>&nbsp;<span class="string" id="2842166">&#39;\f&#39;</span><span class="op" id="2842170">,</span>&nbsp;<span class="string" id="2842172">&#39;\r&#39;</span><span class="op" id="2842176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842181">return</span>&nbsp;<span class="builtintype" id="2842188">true</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842195">case</span>&nbsp;<span class="string" id="2842200">&#39;\u0085&#39;</span><span class="op" id="2842208">,</span>&nbsp;<span class="string" id="2842210">&#39;\u00A0&#39;</span><span class="op" id="2842218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842223">return</span>&nbsp;<span class="builtintype" id="2842230">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842241">return</span>&nbsp;<span class="builtintype" id="2842248">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842255">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2842258">//&nbsp;High-valued&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842280">if</span>&nbsp;<span class="string" id="2842283">&#39;\u2000&#39;</span>&nbsp;<span class="op" id="2842292">&lt;=</span>&nbsp;<span class="ident" id="2842295">r</span>&nbsp;<span class="op" id="2842297">&amp;&amp;</span>&nbsp;<span class="ident" id="2842300">r</span>&nbsp;<span class="op" id="2842302">&lt;=</span>&nbsp;<span class="string" id="2842305">&#39;\u200a&#39;</span>&nbsp;<span class="op" id="2842314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842318">return</span>&nbsp;<span class="builtintype" id="2842325">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842334">switch</span>&nbsp;<span class="ident" id="2842341">r</span>&nbsp;<span class="op" id="2842343">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842346">case</span>&nbsp;<span class="string" id="2842351">&#39;\u1680&#39;</span><span class="op" id="2842359">,</span>&nbsp;<span class="string" id="2842361">&#39;\u2028&#39;</span><span class="op" id="2842369">,</span>&nbsp;<span class="string" id="2842371">&#39;\u2029&#39;</span><span class="op" id="2842379">,</span>&nbsp;<span class="string" id="2842381">&#39;\u202f&#39;</span><span class="op" id="2842389">,</span>&nbsp;<span class="string" id="2842391">&#39;\u205f&#39;</span><span class="op" id="2842399">,</span>&nbsp;<span class="string" id="2842401">&#39;\u3000&#39;</span><span class="op" id="2842409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842413">return</span>&nbsp;<span class="builtintype" id="2842420">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842429">return</span>&nbsp;<span class="builtintype" id="2842436">false</span><br>
<span class="lineno"></span><span class="op" id="2842442">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="2842445">//&nbsp;ScanWords&nbsp;is&nbsp;a&nbsp;split&nbsp;function&nbsp;for&nbsp;a&nbsp;Scanner&nbsp;that&nbsp;returns&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="2842510">//&nbsp;space-separated&nbsp;word&nbsp;of&nbsp;text,&nbsp;with&nbsp;surrounding&nbsp;spaces&nbsp;deleted.&nbsp;It&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="2842584">//&nbsp;never&nbsp;return&nbsp;an&nbsp;empty&nbsp;string.&nbsp;The&nbsp;definition&nbsp;of&nbsp;space&nbsp;is&nbsp;set&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2842651">//&nbsp;unicode.IsSpace.</span><br>
<span class="lineno">335</span><span class="keyword" id="2842671">func</span>&nbsp;<span class="ident" id="2842676">ScanWords</span><span class="op" id="2842685">(</span><span class="ident" id="2842686">data</span>&nbsp;<span class="op" id="2842691">[</span><span class="op" id="2842692">]</span><span class="builtintype" id="2842693">byte</span><span class="op" id="2842697">,</span>&nbsp;<span class="ident" id="2842699">atEOF</span>&nbsp;<span class="builtintype" id="2842705">bool</span><span class="op" id="2842709">)</span>&nbsp;<span class="op" id="2842711">(</span><span class="ident" id="2842712">advance</span>&nbsp;<span class="builtintype" id="2842720">int</span><span class="op" id="2842723">,</span>&nbsp;<span class="ident" id="2842725">token</span>&nbsp;<span class="op" id="2842731">[</span><span class="op" id="2842732">]</span><span class="builtintype" id="2842733">byte</span><span class="op" id="2842737">,</span>&nbsp;<span class="ident" id="2842739">err</span>&nbsp;<span class="builtintype" id="2842743">error</span><span class="op" id="2842748">)</span>&nbsp;<span class="op" id="2842750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2842753">//&nbsp;Skip&nbsp;leading&nbsp;spaces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2842778">start</span>&nbsp;<span class="op" id="2842784">:=</span>&nbsp;<span class="num" id="2842787">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842790">for</span>&nbsp;<span class="ident" id="2842794">width</span>&nbsp;<span class="op" id="2842800">:=</span>&nbsp;<span class="num" id="2842803">0</span><span class="op" id="2842804">;</span>&nbsp;<span class="ident" id="2842806">start</span>&nbsp;<span class="op" id="2842812">&lt;</span>&nbsp;<span class="builtinfunc" id="2842814">len</span><span class="op" id="2842817">(</span><span class="ident" id="2842818">data</span><span class="op" id="2842822">)</span><span class="op" id="2842823">;</span>&nbsp;<span class="ident" id="2842825">start</span>&nbsp;<span class="op" id="2842831">+=</span>&nbsp;<span class="ident" id="2842834">width</span>&nbsp;<span class="op" id="2842840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842844">var</span>&nbsp;<span class="ident" id="2842848">r</span>&nbsp;<span class="builtintype" id="2842850">rune</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2842857">r</span><span class="op" id="2842858">,</span>&nbsp;<span class="ident" id="2842860">width</span>&nbsp;<span class="op" id="2842866">=</span>&nbsp;<span class="ident" id="2842868">utf8</span><span class="op" id="2842872">.</span><span class="ident" id="2842873">DecodeRune</span><span class="op" id="2842883">(</span><span class="ident" id="2842884">data</span><span class="op" id="2842888">[</span><span class="ident" id="2842889">start</span><span class="op" id="2842894">:</span><span class="op" id="2842895">]</span><span class="op" id="2842896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842900">if</span>&nbsp;<span class="op" id="2842903">!</span><span class="ident" id="2842904">isSpace</span><span class="op" id="2842911">(</span><span class="ident" id="2842912">r</span><span class="op" id="2842913">)</span>&nbsp;<span class="op" id="2842915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842920">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2842931">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2842934">//&nbsp;Scan&nbsp;until&nbsp;space,&nbsp;marking&nbsp;end&nbsp;of&nbsp;word.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2842977">for</span>&nbsp;<span class="ident" id="2842981">width</span><span class="op" id="2842986">,</span>&nbsp;<span class="ident" id="2842988">i</span>&nbsp;<span class="op" id="2842990">:=</span>&nbsp;<span class="num" id="2842993">0</span><span class="op" id="2842994">,</span>&nbsp;<span class="ident" id="2842996">start</span><span class="op" id="2843001">;</span>&nbsp;<span class="ident" id="2843003">i</span>&nbsp;<span class="op" id="2843005">&lt;</span>&nbsp;<span class="builtinfunc" id="2843007">len</span><span class="op" id="2843010">(</span><span class="ident" id="2843011">data</span><span class="op" id="2843015">)</span><span class="op" id="2843016">;</span>&nbsp;<span class="ident" id="2843018">i</span>&nbsp;<span class="op" id="2843020">+=</span>&nbsp;<span class="ident" id="2843023">width</span>&nbsp;<span class="op" id="2843029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843033">var</span>&nbsp;<span class="ident" id="2843037">r</span>&nbsp;<span class="builtintype" id="2843039">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2843046">r</span><span class="op" id="2843047">,</span>&nbsp;<span class="ident" id="2843049">width</span>&nbsp;<span class="op" id="2843055">=</span>&nbsp;<span class="ident" id="2843057">utf8</span><span class="op" id="2843061">.</span><span class="ident" id="2843062">DecodeRune</span><span class="op" id="2843072">(</span><span class="ident" id="2843073">data</span><span class="op" id="2843077">[</span><span class="ident" id="2843078">i</span><span class="op" id="2843079">:</span><span class="op" id="2843080">]</span><span class="op" id="2843081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843085">if</span>&nbsp;<span class="ident" id="2843088">isSpace</span><span class="op" id="2843095">(</span><span class="ident" id="2843096">r</span><span class="op" id="2843097">)</span>&nbsp;<span class="op" id="2843099">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843104">return</span>&nbsp;<span class="ident" id="2843111">i</span>&nbsp;<span class="op" id="2843113">+</span>&nbsp;<span class="ident" id="2843115">width</span><span class="op" id="2843120">,</span>&nbsp;<span class="ident" id="2843122">data</span><span class="op" id="2843126">[</span><span class="ident" id="2843127">start</span><span class="op" id="2843132">:</span><span class="ident" id="2843133">i</span><span class="op" id="2843134">]</span><span class="op" id="2843135">,</span>&nbsp;<span class="builtintype" id="2843137">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2843149">//&nbsp;If&nbsp;we&#39;re&nbsp;at&nbsp;EOF,&nbsp;we&nbsp;have&nbsp;a&nbsp;final,&nbsp;non-empty,&nbsp;non-terminated&nbsp;word.&nbsp;Return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843230">if</span>&nbsp;<span class="ident" id="2843233">atEOF</span>&nbsp;<span class="op" id="2843239">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2843242">len</span><span class="op" id="2843245">(</span><span class="ident" id="2843246">data</span><span class="op" id="2843250">)</span>&nbsp;<span class="op" id="2843252">&gt;</span>&nbsp;<span class="ident" id="2843254">start</span>&nbsp;<span class="op" id="2843260">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843264">return</span>&nbsp;<span class="builtinfunc" id="2843271">len</span><span class="op" id="2843274">(</span><span class="ident" id="2843275">data</span><span class="op" id="2843279">)</span><span class="op" id="2843280">,</span>&nbsp;<span class="ident" id="2843282">data</span><span class="op" id="2843286">[</span><span class="ident" id="2843287">start</span><span class="op" id="2843292">:</span><span class="op" id="2843293">]</span><span class="op" id="2843294">,</span>&nbsp;<span class="builtintype" id="2843296">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2843301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2843304">//&nbsp;Request&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2843327">return</span>&nbsp;<span class="ident" id="2843334">start</span><span class="op" id="2843339">,</span>&nbsp;<span class="builtintype" id="2843341">nil</span><span class="op" id="2843344">,</span>&nbsp;<span class="builtintype" id="2843346">nil</span><br>
<span class="lineno"></span><span class="op" id="2843350">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
