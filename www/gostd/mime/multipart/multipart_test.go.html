<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7287340">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7287395">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7287449">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7287500">package</span>&nbsp;<span class="ident" id="7287508">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7287519">import</span>&nbsp;<span class="op" id="7287526">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287529">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287538">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287555">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287562">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287568">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287581">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287598">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287604">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287615">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7287626">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7287636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7287639">func</span>&nbsp;<span class="ident" id="7287644">TestBoundaryLine</span><span class="op" id="7287660">(</span><span class="ident" id="7287661">t</span>&nbsp;<span class="op" id="7287663">*</span><span class="ident" id="7287664">testing</span><span class="op" id="7287671">.</span><span class="ident" id="7287672">T</span><span class="op" id="7287673">)</span>&nbsp;<span class="op" id="7287675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287678">mr</span>&nbsp;<span class="op" id="7287681">:=</span>&nbsp;<span class="ident" id="7287684">NewReader</span><span class="op" id="7287693">(</span><span class="ident" id="7287694">strings</span><span class="op" id="7287701">.</span><span class="ident" id="7287702">NewReader</span><span class="op" id="7287711">(</span><span class="string" id="7287712">&#34;&#34;</span><span class="op" id="7287714">)</span><span class="op" id="7287715">,</span>&nbsp;<span class="string" id="7287717">&#34;myBoundary&#34;</span><span class="op" id="7287729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287732">if</span>&nbsp;<span class="op" id="7287735">!</span><span class="ident" id="7287736">mr</span><span class="op" id="7287738">.</span><span class="ident" id="7287739">isBoundaryDelimiterLine</span><span class="op" id="7287762">(</span><span class="op" id="7287763">[</span><span class="op" id="7287764">]</span><span class="builtintype" id="7287765">byte</span><span class="op" id="7287769">(</span><span class="string" id="7287770">&#34;--myBoundary\r\n&#34;</span><span class="op" id="7287788">)</span><span class="op" id="7287789">)</span>&nbsp;<span class="op" id="7287791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287795">t</span><span class="op" id="7287796">.</span><span class="ident" id="7287797">Error</span><span class="op" id="7287802">(</span><span class="string" id="7287803">&#34;expected&#34;</span><span class="op" id="7287813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287816">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287819">if</span>&nbsp;<span class="op" id="7287822">!</span><span class="ident" id="7287823">mr</span><span class="op" id="7287825">.</span><span class="ident" id="7287826">isBoundaryDelimiterLine</span><span class="op" id="7287849">(</span><span class="op" id="7287850">[</span><span class="op" id="7287851">]</span><span class="builtintype" id="7287852">byte</span><span class="op" id="7287856">(</span><span class="string" id="7287857">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="7287876">)</span><span class="op" id="7287877">)</span>&nbsp;<span class="op" id="7287879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287883">t</span><span class="op" id="7287884">.</span><span class="ident" id="7287885">Error</span><span class="op" id="7287890">(</span><span class="string" id="7287891">&#34;expected&#34;</span><span class="op" id="7287901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287907">if</span>&nbsp;<span class="op" id="7287910">!</span><span class="ident" id="7287911">mr</span><span class="op" id="7287913">.</span><span class="ident" id="7287914">isBoundaryDelimiterLine</span><span class="op" id="7287937">(</span><span class="op" id="7287938">[</span><span class="op" id="7287939">]</span><span class="builtintype" id="7287940">byte</span><span class="op" id="7287944">(</span><span class="string" id="7287945">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="7287962">)</span><span class="op" id="7287963">)</span>&nbsp;<span class="op" id="7287965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7287969">t</span><span class="op" id="7287970">.</span><span class="ident" id="7287971">Error</span><span class="op" id="7287976">(</span><span class="string" id="7287977">&#34;expected&#34;</span><span class="op" id="7287987">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7287990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7287993">if</span>&nbsp;<span class="ident" id="7287996">mr</span><span class="op" id="7287998">.</span><span class="ident" id="7287999">isBoundaryDelimiterLine</span><span class="op" id="7288022">(</span><span class="op" id="7288023">[</span><span class="op" id="7288024">]</span><span class="builtintype" id="7288025">byte</span><span class="op" id="7288029">(</span><span class="string" id="7288030">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="7288053">)</span><span class="op" id="7288054">)</span>&nbsp;<span class="op" id="7288056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288060">t</span><span class="op" id="7288061">.</span><span class="ident" id="7288062">Error</span><span class="op" id="7288067">(</span><span class="string" id="7288068">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7288083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288089">if</span>&nbsp;<span class="ident" id="7288092">mr</span><span class="op" id="7288094">.</span><span class="ident" id="7288095">isBoundaryDelimiterLine</span><span class="op" id="7288118">(</span><span class="op" id="7288119">[</span><span class="op" id="7288120">]</span><span class="builtintype" id="7288121">byte</span><span class="op" id="7288125">(</span><span class="string" id="7288126">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="7288148">)</span><span class="op" id="7288149">)</span>&nbsp;<span class="op" id="7288151">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288155">t</span><span class="op" id="7288156">.</span><span class="ident" id="7288157">Error</span><span class="op" id="7288162">(</span><span class="string" id="7288163">&#34;expected&nbsp;fail&#34;</span><span class="op" id="7288178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288181">}</span><br>
<span class="lineno"></span><span class="op" id="7288183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7288186">func</span>&nbsp;<span class="ident" id="7288191">escapeString</span><span class="op" id="7288203">(</span><span class="ident" id="7288204">v</span>&nbsp;<span class="builtintype" id="7288206">string</span><span class="op" id="7288212">)</span>&nbsp;<span class="builtintype" id="7288214">string</span>&nbsp;<span class="op" id="7288221">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288224">bytes</span><span class="op" id="7288229">,</span>&nbsp;<span class="ident" id="7288231">_</span>&nbsp;<span class="op" id="7288233">:=</span>&nbsp;<span class="ident" id="7288236">json</span><span class="op" id="7288240">.</span><span class="ident" id="7288241">Marshal</span><span class="op" id="7288248">(</span><span class="ident" id="7288249">v</span><span class="op" id="7288250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288253">return</span>&nbsp;<span class="builtintype" id="7288260">string</span><span class="op" id="7288266">(</span><span class="ident" id="7288267">bytes</span><span class="op" id="7288272">)</span><br>
<span class="lineno"></span><span class="op" id="7288274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7288277">func</span>&nbsp;<span class="ident" id="7288282">expectEq</span><span class="op" id="7288290">(</span><span class="ident" id="7288291">t</span>&nbsp;<span class="op" id="7288293">*</span><span class="ident" id="7288294">testing</span><span class="op" id="7288301">.</span><span class="ident" id="7288302">T</span><span class="op" id="7288303">,</span>&nbsp;<span class="ident" id="7288305">expected</span><span class="op" id="7288313">,</span>&nbsp;<span class="ident" id="7288315">actual</span><span class="op" id="7288321">,</span>&nbsp;<span class="ident" id="7288323">what</span>&nbsp;<span class="builtintype" id="7288328">string</span><span class="op" id="7288334">)</span>&nbsp;<span class="op" id="7288336">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288339">if</span>&nbsp;<span class="ident" id="7288342">expected</span>&nbsp;<span class="op" id="7288351">==</span>&nbsp;<span class="ident" id="7288354">actual</span>&nbsp;<span class="op" id="7288361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7288365">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288376">t</span><span class="op" id="7288377">.</span><span class="ident" id="7288378">Errorf</span><span class="op" id="7288384">(</span><span class="string" id="7288385">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="7288453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288457">what</span><span class="op" id="7288461">,</span>&nbsp;<span class="ident" id="7288463">escapeString</span><span class="op" id="7288475">(</span><span class="ident" id="7288476">actual</span><span class="op" id="7288482">)</span><span class="op" id="7288483">,</span>&nbsp;<span class="builtinfunc" id="7288485">len</span><span class="op" id="7288488">(</span><span class="ident" id="7288489">actual</span><span class="op" id="7288495">)</span><span class="op" id="7288496">,</span>&nbsp;<span class="ident" id="7288498">escapeString</span><span class="op" id="7288510">(</span><span class="ident" id="7288511">expected</span><span class="op" id="7288519">)</span><span class="op" id="7288520">,</span>&nbsp;<span class="builtinfunc" id="7288522">len</span><span class="op" id="7288525">(</span><span class="ident" id="7288526">expected</span><span class="op" id="7288534">)</span><span class="op" id="7288535">)</span><br>
<span class="lineno">50</span><span class="op" id="7288537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7288540">func</span>&nbsp;<span class="ident" id="7288545">TestNameAccessors</span><span class="op" id="7288562">(</span><span class="ident" id="7288563">t</span>&nbsp;<span class="op" id="7288565">*</span><span class="ident" id="7288566">testing</span><span class="op" id="7288573">.</span><span class="ident" id="7288574">T</span><span class="op" id="7288575">)</span>&nbsp;<span class="op" id="7288577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7288580">tests</span>&nbsp;<span class="op" id="7288586">:=</span>&nbsp;<span class="op" id="7288589">[</span><span class="op" id="7288590">...</span><span class="op" id="7288593">]</span><span class="op" id="7288594">[</span><span class="num" id="7288595">3</span><span class="op" id="7288596">]</span><span class="builtintype" id="7288597">string</span><span class="op" id="7288603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288607">{</span><span class="string" id="7288608">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7288631">,</span>&nbsp;<span class="string" id="7288633">&#34;foo&#34;</span><span class="op" id="7288638">,</span>&nbsp;<span class="string" id="7288640">&#34;&#34;</span><span class="op" id="7288642">}</span><span class="op" id="7288643">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288647">{</span><span class="string" id="7288648">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="7288671">,</span>&nbsp;<span class="string" id="7288673">&#34;foo&#34;</span><span class="op" id="7288678">,</span>&nbsp;<span class="string" id="7288680">&#34;&#34;</span><span class="op" id="7288682">}</span><span class="op" id="7288683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288687">{</span><span class="string" id="7288688">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="7288710">,</span>&nbsp;<span class="string" id="7288712">&#34;foo&#34;</span><span class="op" id="7288717">,</span>&nbsp;<span class="string" id="7288719">&#34;&#34;</span><span class="op" id="7288721">}</span><span class="op" id="7288722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288726">{</span><span class="string" id="7288727">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7288752">,</span>&nbsp;<span class="string" id="7288754">&#34;foo&#34;</span><span class="op" id="7288759">,</span>&nbsp;<span class="string" id="7288761">&#34;&#34;</span><span class="op" id="7288763">}</span><span class="op" id="7288764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288768">{</span><span class="string" id="7288769">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="7288794">,</span>&nbsp;<span class="string" id="7288796">&#34;foo&#34;</span><span class="op" id="7288801">,</span>&nbsp;<span class="string" id="7288803">&#34;&#34;</span><span class="op" id="7288805">}</span><span class="op" id="7288806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288810">{</span><span class="string" id="7288811">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="7288834">,</span>&nbsp;<span class="string" id="7288836">&#34;foo&#34;</span><span class="op" id="7288841">,</span>&nbsp;<span class="string" id="7288843">&#34;&#34;</span><span class="op" id="7288845">}</span><span class="op" id="7288846">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288850">{</span><span class="string" id="7288851">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7288904">,</span>&nbsp;<span class="string" id="7288906">&#34;foo&#34;</span><span class="op" id="7288911">,</span>&nbsp;<span class="string" id="7288913">&#34;foo.txt&#34;</span><span class="op" id="7288922">}</span><span class="op" id="7288923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7288927">{</span><span class="string" id="7288928">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="7288985">,</span>&nbsp;<span class="string" id="7288987">&#34;&#34;</span><span class="op" id="7288989">,</span>&nbsp;<span class="string" id="7288991">&#34;bar.txt&#34;</span><span class="op" id="7289000">}</span><span class="op" id="7289001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289007">for</span>&nbsp;<span class="ident" id="7289011">i</span><span class="op" id="7289012">,</span>&nbsp;<span class="ident" id="7289014">test</span>&nbsp;<span class="op" id="7289019">:=</span>&nbsp;<span class="keyword" id="7289022">range</span>&nbsp;<span class="ident" id="7289028">tests</span>&nbsp;<span class="op" id="7289034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289038">p</span>&nbsp;<span class="op" id="7289040">:=</span>&nbsp;<span class="op" id="7289043">&amp;</span><span class="ident" id="7289044">Part</span><span class="op" id="7289048">{</span><span class="ident" id="7289049">Header</span><span class="op" id="7289055">:</span>&nbsp;<span class="builtinfunc" id="7289057">make</span><span class="op" id="7289061">(</span><span class="keyword" id="7289062">map</span><span class="op" id="7289065">[</span><span class="builtintype" id="7289066">string</span><span class="op" id="7289072">]</span><span class="op" id="7289073">[</span><span class="op" id="7289074">]</span><span class="builtintype" id="7289075">string</span><span class="op" id="7289081">)</span><span class="op" id="7289082">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289086">p</span><span class="op" id="7289087">.</span><span class="ident" id="7289088">Header</span><span class="op" id="7289094">.</span><span class="ident" id="7289095">Set</span><span class="op" id="7289098">(</span><span class="string" id="7289099">&#34;Content-Disposition&#34;</span><span class="op" id="7289120">,</span>&nbsp;<span class="ident" id="7289122">test</span><span class="op" id="7289126">[</span><span class="num" id="7289127">0</span><span class="op" id="7289128">]</span><span class="op" id="7289129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289133">if</span>&nbsp;<span class="ident" id="7289136">g</span><span class="op" id="7289137">,</span>&nbsp;<span class="ident" id="7289139">e</span>&nbsp;<span class="op" id="7289141">:=</span>&nbsp;<span class="ident" id="7289144">p</span><span class="op" id="7289145">.</span><span class="ident" id="7289146">FormName</span><span class="op" id="7289154">(</span><span class="op" id="7289155">)</span><span class="op" id="7289156">,</span>&nbsp;<span class="ident" id="7289158">test</span><span class="op" id="7289162">[</span><span class="num" id="7289163">1</span><span class="op" id="7289164">]</span><span class="op" id="7289165">;</span>&nbsp;<span class="ident" id="7289167">g</span>&nbsp;<span class="op" id="7289169">!=</span>&nbsp;<span class="ident" id="7289172">e</span>&nbsp;<span class="op" id="7289174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289179">t</span><span class="op" id="7289180">.</span><span class="ident" id="7289181">Errorf</span><span class="op" id="7289187">(</span><span class="string" id="7289188">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7289223">,</span>&nbsp;<span class="ident" id="7289225">i</span><span class="op" id="7289226">,</span>&nbsp;<span class="ident" id="7289228">g</span><span class="op" id="7289229">,</span>&nbsp;<span class="ident" id="7289231">e</span><span class="op" id="7289232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289240">if</span>&nbsp;<span class="ident" id="7289243">g</span><span class="op" id="7289244">,</span>&nbsp;<span class="ident" id="7289246">e</span>&nbsp;<span class="op" id="7289248">:=</span>&nbsp;<span class="ident" id="7289251">p</span><span class="op" id="7289252">.</span><span class="ident" id="7289253">FileName</span><span class="op" id="7289261">(</span><span class="op" id="7289262">)</span><span class="op" id="7289263">,</span>&nbsp;<span class="ident" id="7289265">test</span><span class="op" id="7289269">[</span><span class="num" id="7289270">2</span><span class="op" id="7289271">]</span><span class="op" id="7289272">;</span>&nbsp;<span class="ident" id="7289274">g</span>&nbsp;<span class="op" id="7289276">!=</span>&nbsp;<span class="ident" id="7289279">e</span>&nbsp;<span class="op" id="7289281">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289286">t</span><span class="op" id="7289287">.</span><span class="ident" id="7289288">Errorf</span><span class="op" id="7289294">(</span><span class="string" id="7289295">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7289330">,</span>&nbsp;<span class="ident" id="7289332">i</span><span class="op" id="7289333">,</span>&nbsp;<span class="ident" id="7289335">g</span><span class="op" id="7289336">,</span>&nbsp;<span class="ident" id="7289338">e</span><span class="op" id="7289339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7289346">}</span><br>
<span class="lineno"></span><span class="op" id="7289348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="7289351">var</span>&nbsp;<span class="ident" id="7289355">longLine</span>&nbsp;<span class="op" id="7289364">=</span>&nbsp;<span class="ident" id="7289366">strings</span><span class="op" id="7289373">.</span><span class="ident" id="7289374">Repeat</span><span class="op" id="7289380">(</span><span class="string" id="7289381">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="7289401">,</span>&nbsp;<span class="op" id="7289403">(</span><span class="num" id="7289404">1</span><span class="op" id="7289405">&lt;&lt;</span><span class="num" id="7289407">20</span><span class="op" id="7289409">)</span><span class="op" id="7289410">/</span><span class="num" id="7289411">8</span><span class="op" id="7289412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7289415">func</span>&nbsp;<span class="ident" id="7289420">testMultipartBody</span><span class="op" id="7289437">(</span><span class="ident" id="7289438">sep</span>&nbsp;<span class="builtintype" id="7289442">string</span><span class="op" id="7289448">)</span>&nbsp;<span class="builtintype" id="7289450">string</span>&nbsp;<span class="op" id="7289457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289460">testBody</span>&nbsp;<span class="op" id="7289469">:=</span>&nbsp;<span class="string" id="7289472">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289829">testBody</span>&nbsp;<span class="op" id="7289838">=</span>&nbsp;<span class="ident" id="7289840">strings</span><span class="op" id="7289847">.</span><span class="ident" id="7289848">Replace</span><span class="op" id="7289855">(</span><span class="ident" id="7289856">testBody</span><span class="op" id="7289864">,</span>&nbsp;<span class="string" id="7289866">&#34;\n&#34;</span><span class="op" id="7289870">,</span>&nbsp;<span class="ident" id="7289872">sep</span><span class="op" id="7289875">,</span>&nbsp;<span class="op" id="7289877">-</span><span class="num" id="7289878">1</span><span class="op" id="7289879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7289882">return</span>&nbsp;<span class="ident" id="7289889">strings</span><span class="op" id="7289896">.</span><span class="ident" id="7289897">Replace</span><span class="op" id="7289904">(</span><span class="ident" id="7289905">testBody</span><span class="op" id="7289913">,</span>&nbsp;<span class="string" id="7289915">&#34;[longline]&#34;</span><span class="op" id="7289927">,</span>&nbsp;<span class="ident" id="7289929">longLine</span><span class="op" id="7289937">,</span>&nbsp;<span class="num" id="7289939">1</span><span class="op" id="7289940">)</span><br>
<span class="lineno">110</span><span class="op" id="7289942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7289945">func</span>&nbsp;<span class="ident" id="7289950">TestMultipart</span><span class="op" id="7289963">(</span><span class="ident" id="7289964">t</span>&nbsp;<span class="op" id="7289966">*</span><span class="ident" id="7289967">testing</span><span class="op" id="7289974">.</span><span class="ident" id="7289975">T</span><span class="op" id="7289976">)</span>&nbsp;<span class="op" id="7289978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7289981">bodyReader</span>&nbsp;<span class="op" id="7289992">:=</span>&nbsp;<span class="ident" id="7289995">strings</span><span class="op" id="7290002">.</span><span class="ident" id="7290003">NewReader</span><span class="op" id="7290012">(</span><span class="ident" id="7290013">testMultipartBody</span><span class="op" id="7290030">(</span><span class="string" id="7290031">&#34;\r\n&#34;</span><span class="op" id="7290037">)</span><span class="op" id="7290038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290041">testMultipart</span><span class="op" id="7290054">(</span><span class="ident" id="7290055">t</span><span class="op" id="7290056">,</span>&nbsp;<span class="ident" id="7290058">bodyReader</span><span class="op" id="7290068">,</span>&nbsp;<span class="builtintype" id="7290070">false</span><span class="op" id="7290075">)</span><br>
<span class="lineno">115</span><span class="op" id="7290077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290080">func</span>&nbsp;<span class="ident" id="7290085">TestMultipartOnlyNewlines</span><span class="op" id="7290110">(</span><span class="ident" id="7290111">t</span>&nbsp;<span class="op" id="7290113">*</span><span class="ident" id="7290114">testing</span><span class="op" id="7290121">.</span><span class="ident" id="7290122">T</span><span class="op" id="7290123">)</span>&nbsp;<span class="op" id="7290125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290128">bodyReader</span>&nbsp;<span class="op" id="7290139">:=</span>&nbsp;<span class="ident" id="7290142">strings</span><span class="op" id="7290149">.</span><span class="ident" id="7290150">NewReader</span><span class="op" id="7290159">(</span><span class="ident" id="7290160">testMultipartBody</span><span class="op" id="7290177">(</span><span class="string" id="7290178">&#34;\n&#34;</span><span class="op" id="7290182">)</span><span class="op" id="7290183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290186">testMultipart</span><span class="op" id="7290199">(</span><span class="ident" id="7290200">t</span><span class="op" id="7290201">,</span>&nbsp;<span class="ident" id="7290203">bodyReader</span><span class="op" id="7290213">,</span>&nbsp;<span class="builtintype" id="7290215">true</span><span class="op" id="7290219">)</span><br>
<span class="lineno">120</span><span class="op" id="7290221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290224">func</span>&nbsp;<span class="ident" id="7290229">TestMultipartSlowInput</span><span class="op" id="7290251">(</span><span class="ident" id="7290252">t</span>&nbsp;<span class="op" id="7290254">*</span><span class="ident" id="7290255">testing</span><span class="op" id="7290262">.</span><span class="ident" id="7290263">T</span><span class="op" id="7290264">)</span>&nbsp;<span class="op" id="7290266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290269">bodyReader</span>&nbsp;<span class="op" id="7290280">:=</span>&nbsp;<span class="ident" id="7290283">strings</span><span class="op" id="7290290">.</span><span class="ident" id="7290291">NewReader</span><span class="op" id="7290300">(</span><span class="ident" id="7290301">testMultipartBody</span><span class="op" id="7290318">(</span><span class="string" id="7290319">&#34;\r\n&#34;</span><span class="op" id="7290325">)</span><span class="op" id="7290326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290329">testMultipart</span><span class="op" id="7290342">(</span><span class="ident" id="7290343">t</span><span class="op" id="7290344">,</span>&nbsp;<span class="op" id="7290346">&amp;</span><span class="ident" id="7290347">slowReader</span><span class="op" id="7290357">{</span><span class="ident" id="7290358">bodyReader</span><span class="op" id="7290368">}</span><span class="op" id="7290369">,</span>&nbsp;<span class="builtintype" id="7290371">false</span><span class="op" id="7290376">)</span><br>
<span class="lineno">125</span><span class="op" id="7290378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7290381">func</span>&nbsp;<span class="ident" id="7290386">testMultipart</span><span class="op" id="7290399">(</span><span class="ident" id="7290400">t</span>&nbsp;<span class="op" id="7290402">*</span><span class="ident" id="7290403">testing</span><span class="op" id="7290410">.</span><span class="ident" id="7290411">T</span><span class="op" id="7290412">,</span>&nbsp;<span class="ident" id="7290414">r</span>&nbsp;<span class="ident" id="7290416">io</span><span class="op" id="7290418">.</span><span class="ident" id="7290419">Reader</span><span class="op" id="7290425">,</span>&nbsp;<span class="ident" id="7290427">onlyNewlines</span>&nbsp;<span class="builtintype" id="7290440">bool</span><span class="op" id="7290444">)</span>&nbsp;<span class="op" id="7290446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290449">reader</span>&nbsp;<span class="op" id="7290456">:=</span>&nbsp;<span class="ident" id="7290459">NewReader</span><span class="op" id="7290468">(</span><span class="ident" id="7290469">r</span><span class="op" id="7290470">,</span>&nbsp;<span class="string" id="7290472">&#34;MyBoundary&#34;</span><span class="op" id="7290484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290487">buf</span>&nbsp;<span class="op" id="7290491">:=</span>&nbsp;<span class="builtinfunc" id="7290494">new</span><span class="op" id="7290497">(</span><span class="ident" id="7290498">bytes</span><span class="op" id="7290503">.</span><span class="ident" id="7290504">Buffer</span><span class="op" id="7290510">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7290514">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290524">part</span><span class="op" id="7290528">,</span>&nbsp;<span class="ident" id="7290530">err</span>&nbsp;<span class="op" id="7290534">:=</span>&nbsp;<span class="ident" id="7290537">reader</span><span class="op" id="7290543">.</span><span class="ident" id="7290544">NextPart</span><span class="op" id="7290552">(</span><span class="op" id="7290553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290556">if</span>&nbsp;<span class="ident" id="7290559">part</span>&nbsp;<span class="op" id="7290564">==</span>&nbsp;<span class="ident" id="7290567">nil</span>&nbsp;<span class="op" id="7290571">||</span>&nbsp;<span class="ident" id="7290574">err</span>&nbsp;<span class="op" id="7290578">!=</span>&nbsp;<span class="ident" id="7290581">nil</span>&nbsp;<span class="op" id="7290585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290589">t</span><span class="op" id="7290590">.</span><span class="ident" id="7290591">Error</span><span class="op" id="7290596">(</span><span class="string" id="7290597">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="7290613">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290617">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290628">if</span>&nbsp;<span class="ident" id="7290631">x</span>&nbsp;<span class="op" id="7290633">:=</span>&nbsp;<span class="ident" id="7290636">part</span><span class="op" id="7290640">.</span><span class="ident" id="7290641">Header</span><span class="op" id="7290647">.</span><span class="ident" id="7290648">Get</span><span class="op" id="7290651">(</span><span class="string" id="7290652">&#34;Header1&#34;</span><span class="op" id="7290661">)</span><span class="op" id="7290662">;</span>&nbsp;<span class="ident" id="7290664">x</span>&nbsp;<span class="op" id="7290666">!=</span>&nbsp;<span class="string" id="7290669">&#34;value1&#34;</span>&nbsp;<span class="op" id="7290678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290682">t</span><span class="op" id="7290683">.</span><span class="ident" id="7290684">Errorf</span><span class="op" id="7290690">(</span><span class="string" id="7290691">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7290726">,</span>&nbsp;<span class="string" id="7290728">&#34;Header1&#34;</span><span class="op" id="7290737">,</span>&nbsp;<span class="ident" id="7290739">x</span><span class="op" id="7290740">,</span>&nbsp;<span class="string" id="7290742">&#34;value1&#34;</span><span class="op" id="7290750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290753">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290756">if</span>&nbsp;<span class="ident" id="7290759">x</span>&nbsp;<span class="op" id="7290761">:=</span>&nbsp;<span class="ident" id="7290764">part</span><span class="op" id="7290768">.</span><span class="ident" id="7290769">Header</span><span class="op" id="7290775">.</span><span class="ident" id="7290776">Get</span><span class="op" id="7290779">(</span><span class="string" id="7290780">&#34;foo-bar&#34;</span><span class="op" id="7290789">)</span><span class="op" id="7290790">;</span>&nbsp;<span class="ident" id="7290792">x</span>&nbsp;<span class="op" id="7290794">!=</span>&nbsp;<span class="string" id="7290797">&#34;baz&#34;</span>&nbsp;<span class="op" id="7290803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290807">t</span><span class="op" id="7290808">.</span><span class="ident" id="7290809">Errorf</span><span class="op" id="7290815">(</span><span class="string" id="7290816">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7290851">,</span>&nbsp;<span class="string" id="7290853">&#34;foo-bar&#34;</span><span class="op" id="7290862">,</span>&nbsp;<span class="ident" id="7290864">x</span><span class="op" id="7290865">,</span>&nbsp;<span class="string" id="7290867">&#34;baz&#34;</span><span class="op" id="7290872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7290878">if</span>&nbsp;<span class="ident" id="7290881">x</span>&nbsp;<span class="op" id="7290883">:=</span>&nbsp;<span class="ident" id="7290886">part</span><span class="op" id="7290890">.</span><span class="ident" id="7290891">Header</span><span class="op" id="7290897">.</span><span class="ident" id="7290898">Get</span><span class="op" id="7290901">(</span><span class="string" id="7290902">&#34;Foo-Bar&#34;</span><span class="op" id="7290911">)</span><span class="op" id="7290912">;</span>&nbsp;<span class="ident" id="7290914">x</span>&nbsp;<span class="op" id="7290916">!=</span>&nbsp;<span class="string" id="7290919">&#34;baz&#34;</span>&nbsp;<span class="op" id="7290925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7290929">t</span><span class="op" id="7290930">.</span><span class="ident" id="7290931">Errorf</span><span class="op" id="7290937">(</span><span class="string" id="7290938">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7290973">,</span>&nbsp;<span class="string" id="7290975">&#34;Foo-Bar&#34;</span><span class="op" id="7290984">,</span>&nbsp;<span class="ident" id="7290986">x</span><span class="op" id="7290987">,</span>&nbsp;<span class="string" id="7290989">&#34;baz&#34;</span><span class="op" id="7290994">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7290997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291000">buf</span><span class="op" id="7291003">.</span><span class="ident" id="7291004">Reset</span><span class="op" id="7291009">(</span><span class="op" id="7291010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291013">if</span>&nbsp;<span class="ident" id="7291016">_</span><span class="op" id="7291017">,</span>&nbsp;<span class="ident" id="7291019">err</span>&nbsp;<span class="op" id="7291023">:=</span>&nbsp;<span class="ident" id="7291026">io</span><span class="op" id="7291028">.</span><span class="ident" id="7291029">Copy</span><span class="op" id="7291033">(</span><span class="ident" id="7291034">buf</span><span class="op" id="7291037">,</span>&nbsp;<span class="ident" id="7291039">part</span><span class="op" id="7291043">)</span><span class="op" id="7291044">;</span>&nbsp;<span class="ident" id="7291046">err</span>&nbsp;<span class="op" id="7291050">!=</span>&nbsp;<span class="ident" id="7291053">nil</span>&nbsp;<span class="op" id="7291057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291061">t</span><span class="op" id="7291062">.</span><span class="ident" id="7291063">Errorf</span><span class="op" id="7291069">(</span><span class="string" id="7291070">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7291087">,</span>&nbsp;<span class="ident" id="7291089">err</span><span class="op" id="7291092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291095">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291099">adjustNewlines</span>&nbsp;<span class="op" id="7291114">:=</span>&nbsp;<span class="keyword" id="7291117">func</span><span class="op" id="7291121">(</span><span class="ident" id="7291122">s</span>&nbsp;<span class="builtintype" id="7291124">string</span><span class="op" id="7291130">)</span>&nbsp;<span class="builtintype" id="7291132">string</span>&nbsp;<span class="op" id="7291139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291143">if</span>&nbsp;<span class="ident" id="7291146">onlyNewlines</span>&nbsp;<span class="op" id="7291159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291164">return</span>&nbsp;<span class="ident" id="7291171">strings</span><span class="op" id="7291178">.</span><span class="ident" id="7291179">Replace</span><span class="op" id="7291186">(</span><span class="ident" id="7291187">s</span><span class="op" id="7291188">,</span>&nbsp;<span class="string" id="7291190">&#34;\r\n&#34;</span><span class="op" id="7291196">,</span>&nbsp;<span class="string" id="7291198">&#34;\n&#34;</span><span class="op" id="7291202">,</span>&nbsp;<span class="op" id="7291204">-</span><span class="num" id="7291205">1</span><span class="op" id="7291206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291210">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291214">return</span>&nbsp;<span class="ident" id="7291221">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291228">expectEq</span><span class="op" id="7291236">(</span><span class="ident" id="7291237">t</span><span class="op" id="7291238">,</span>&nbsp;<span class="ident" id="7291240">adjustNewlines</span><span class="op" id="7291254">(</span><span class="string" id="7291255">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="7291277">)</span><span class="op" id="7291278">,</span>&nbsp;<span class="ident" id="7291280">buf</span><span class="op" id="7291283">.</span><span class="ident" id="7291284">String</span><span class="op" id="7291290">(</span><span class="op" id="7291291">)</span><span class="op" id="7291292">,</span>&nbsp;<span class="string" id="7291294">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="7291315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7291319">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291329">part</span><span class="op" id="7291333">,</span>&nbsp;<span class="ident" id="7291335">err</span>&nbsp;<span class="op" id="7291339">=</span>&nbsp;<span class="ident" id="7291341">reader</span><span class="op" id="7291347">.</span><span class="ident" id="7291348">NextPart</span><span class="op" id="7291356">(</span><span class="op" id="7291357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291360">if</span>&nbsp;<span class="ident" id="7291363">err</span>&nbsp;<span class="op" id="7291367">!=</span>&nbsp;<span class="ident" id="7291370">nil</span>&nbsp;<span class="op" id="7291374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291378">t</span><span class="op" id="7291379">.</span><span class="ident" id="7291380">Fatalf</span><span class="op" id="7291386">(</span><span class="string" id="7291387">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="7291412">,</span>&nbsp;<span class="ident" id="7291414">err</span><span class="op" id="7291417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291421">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291432">if</span>&nbsp;<span class="ident" id="7291435">e</span><span class="op" id="7291436">,</span>&nbsp;<span class="ident" id="7291438">g</span>&nbsp;<span class="op" id="7291440">:=</span>&nbsp;<span class="string" id="7291443">&#34;bigsection&#34;</span><span class="op" id="7291455">,</span>&nbsp;<span class="ident" id="7291457">part</span><span class="op" id="7291461">.</span><span class="ident" id="7291462">Header</span><span class="op" id="7291468">.</span><span class="ident" id="7291469">Get</span><span class="op" id="7291472">(</span><span class="string" id="7291473">&#34;name&#34;</span><span class="op" id="7291479">)</span><span class="op" id="7291480">;</span>&nbsp;<span class="ident" id="7291482">e</span>&nbsp;<span class="op" id="7291484">!=</span>&nbsp;<span class="ident" id="7291487">g</span>&nbsp;<span class="op" id="7291489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291493">t</span><span class="op" id="7291494">.</span><span class="ident" id="7291495">Errorf</span><span class="op" id="7291501">(</span><span class="string" id="7291502">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7291544">,</span>&nbsp;<span class="ident" id="7291546">e</span><span class="op" id="7291547">,</span>&nbsp;<span class="ident" id="7291549">g</span><span class="op" id="7291550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291556">buf</span><span class="op" id="7291559">.</span><span class="ident" id="7291560">Reset</span><span class="op" id="7291565">(</span><span class="op" id="7291566">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291569">if</span>&nbsp;<span class="ident" id="7291572">_</span><span class="op" id="7291573">,</span>&nbsp;<span class="ident" id="7291575">err</span>&nbsp;<span class="op" id="7291579">:=</span>&nbsp;<span class="ident" id="7291582">io</span><span class="op" id="7291584">.</span><span class="ident" id="7291585">Copy</span><span class="op" id="7291589">(</span><span class="ident" id="7291590">buf</span><span class="op" id="7291593">,</span>&nbsp;<span class="ident" id="7291595">part</span><span class="op" id="7291599">)</span><span class="op" id="7291600">;</span>&nbsp;<span class="ident" id="7291602">err</span>&nbsp;<span class="op" id="7291606">!=</span>&nbsp;<span class="ident" id="7291609">nil</span>&nbsp;<span class="op" id="7291613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291617">t</span><span class="op" id="7291618">.</span><span class="ident" id="7291619">Errorf</span><span class="op" id="7291625">(</span><span class="string" id="7291626">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7291643">,</span>&nbsp;<span class="ident" id="7291645">err</span><span class="op" id="7291648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291654">s</span>&nbsp;<span class="op" id="7291656">:=</span>&nbsp;<span class="ident" id="7291659">buf</span><span class="op" id="7291662">.</span><span class="ident" id="7291663">String</span><span class="op" id="7291669">(</span><span class="op" id="7291670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291673">if</span>&nbsp;<span class="builtinfunc" id="7291676">len</span><span class="op" id="7291679">(</span><span class="ident" id="7291680">s</span><span class="op" id="7291681">)</span>&nbsp;<span class="op" id="7291683">!=</span>&nbsp;<span class="builtinfunc" id="7291686">len</span><span class="op" id="7291689">(</span><span class="ident" id="7291690">longLine</span><span class="op" id="7291698">)</span>&nbsp;<span class="op" id="7291700">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291704">t</span><span class="op" id="7291705">.</span><span class="ident" id="7291706">Errorf</span><span class="op" id="7291712">(</span><span class="string" id="7291713">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="7291772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7291777">len</span><span class="op" id="7291780">(</span><span class="ident" id="7291781">longLine</span><span class="op" id="7291789">)</span><span class="op" id="7291790">,</span>&nbsp;<span class="builtinfunc" id="7291792">len</span><span class="op" id="7291795">(</span><span class="ident" id="7291796">s</span><span class="op" id="7291797">)</span><span class="op" id="7291798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291804">if</span>&nbsp;<span class="ident" id="7291807">s</span>&nbsp;<span class="op" id="7291809">!=</span>&nbsp;<span class="ident" id="7291812">longLine</span>&nbsp;<span class="op" id="7291821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291825">t</span><span class="op" id="7291826">.</span><span class="ident" id="7291827">Errorf</span><span class="op" id="7291833">(</span><span class="string" id="7291834">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="7291864">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7291871">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291881">part</span><span class="op" id="7291885">,</span>&nbsp;<span class="ident" id="7291887">err</span>&nbsp;<span class="op" id="7291891">=</span>&nbsp;<span class="ident" id="7291893">reader</span><span class="op" id="7291899">.</span><span class="ident" id="7291900">NextPart</span><span class="op" id="7291908">(</span><span class="op" id="7291909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291912">if</span>&nbsp;<span class="ident" id="7291915">part</span>&nbsp;<span class="op" id="7291920">==</span>&nbsp;<span class="ident" id="7291923">nil</span>&nbsp;<span class="op" id="7291927">||</span>&nbsp;<span class="ident" id="7291930">err</span>&nbsp;<span class="op" id="7291934">!=</span>&nbsp;<span class="ident" id="7291937">nil</span>&nbsp;<span class="op" id="7291941">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7291945">t</span><span class="op" id="7291946">.</span><span class="ident" id="7291947">Error</span><span class="op" id="7291952">(</span><span class="string" id="7291953">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="7291969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7291981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7291984">if</span>&nbsp;<span class="ident" id="7291987">part</span><span class="op" id="7291991">.</span><span class="ident" id="7291992">Header</span><span class="op" id="7291998">.</span><span class="ident" id="7291999">Get</span><span class="op" id="7292002">(</span><span class="string" id="7292003">&#34;foo-bar&#34;</span><span class="op" id="7292012">)</span>&nbsp;<span class="op" id="7292014">!=</span>&nbsp;<span class="string" id="7292017">&#34;bazb&#34;</span>&nbsp;<span class="op" id="7292024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292028">t</span><span class="op" id="7292029">.</span><span class="ident" id="7292030">Error</span><span class="op" id="7292035">(</span><span class="string" id="7292036">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="7292060">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292066">buf</span><span class="op" id="7292069">.</span><span class="ident" id="7292070">Reset</span><span class="op" id="7292075">(</span><span class="op" id="7292076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292079">if</span>&nbsp;<span class="ident" id="7292082">_</span><span class="op" id="7292083">,</span>&nbsp;<span class="ident" id="7292085">err</span>&nbsp;<span class="op" id="7292089">:=</span>&nbsp;<span class="ident" id="7292092">io</span><span class="op" id="7292094">.</span><span class="ident" id="7292095">Copy</span><span class="op" id="7292099">(</span><span class="ident" id="7292100">buf</span><span class="op" id="7292103">,</span>&nbsp;<span class="ident" id="7292105">part</span><span class="op" id="7292109">)</span><span class="op" id="7292110">;</span>&nbsp;<span class="ident" id="7292112">err</span>&nbsp;<span class="op" id="7292116">!=</span>&nbsp;<span class="ident" id="7292119">nil</span>&nbsp;<span class="op" id="7292123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292127">t</span><span class="op" id="7292128">.</span><span class="ident" id="7292129">Errorf</span><span class="op" id="7292135">(</span><span class="string" id="7292136">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="7292153">,</span>&nbsp;<span class="ident" id="7292155">err</span><span class="op" id="7292158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292161">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292164">expectEq</span><span class="op" id="7292172">(</span><span class="ident" id="7292173">t</span><span class="op" id="7292174">,</span>&nbsp;<span class="ident" id="7292176">adjustNewlines</span><span class="op" id="7292190">(</span><span class="string" id="7292191">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="7292256">)</span><span class="op" id="7292257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292261">buf</span><span class="op" id="7292264">.</span><span class="ident" id="7292265">String</span><span class="op" id="7292271">(</span><span class="op" id="7292272">)</span><span class="op" id="7292273">,</span>&nbsp;<span class="string" id="7292275">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="7292291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7292295">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292305">part</span><span class="op" id="7292309">,</span>&nbsp;<span class="ident" id="7292311">err</span>&nbsp;<span class="op" id="7292315">=</span>&nbsp;<span class="ident" id="7292317">reader</span><span class="op" id="7292323">.</span><span class="ident" id="7292324">NextPart</span><span class="op" id="7292332">(</span><span class="op" id="7292333">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292336">if</span>&nbsp;<span class="ident" id="7292339">part</span>&nbsp;<span class="op" id="7292344">==</span>&nbsp;<span class="ident" id="7292347">nil</span>&nbsp;<span class="op" id="7292351">||</span>&nbsp;<span class="ident" id="7292354">err</span>&nbsp;<span class="op" id="7292358">!=</span>&nbsp;<span class="ident" id="7292361">nil</span>&nbsp;<span class="op" id="7292365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292369">t</span><span class="op" id="7292370">.</span><span class="ident" id="7292371">Error</span><span class="op" id="7292376">(</span><span class="string" id="7292377">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="7292409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7292425">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292448">part</span><span class="op" id="7292452">,</span>&nbsp;<span class="ident" id="7292454">err</span>&nbsp;<span class="op" id="7292458">=</span>&nbsp;<span class="ident" id="7292460">reader</span><span class="op" id="7292466">.</span><span class="ident" id="7292467">NextPart</span><span class="op" id="7292475">(</span><span class="op" id="7292476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292479">if</span>&nbsp;<span class="ident" id="7292482">part</span>&nbsp;<span class="op" id="7292487">!=</span>&nbsp;<span class="ident" id="7292490">nil</span>&nbsp;<span class="op" id="7292494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292498">t</span><span class="op" id="7292499">.</span><span class="ident" id="7292500">Error</span><span class="op" id="7292505">(</span><span class="string" id="7292506">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="7292535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292538">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292541">if</span>&nbsp;<span class="ident" id="7292544">err</span>&nbsp;<span class="op" id="7292548">!=</span>&nbsp;<span class="ident" id="7292551">io</span><span class="op" id="7292553">.</span><span class="ident" id="7292554">EOF</span>&nbsp;<span class="op" id="7292558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292562">t</span><span class="op" id="7292563">.</span><span class="ident" id="7292564">Errorf</span><span class="op" id="7292570">(</span><span class="string" id="7292571">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7292610">,</span>&nbsp;<span class="ident" id="7292612">err</span><span class="op" id="7292615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292618">}</span><br>
<span class="lineno"></span><span class="op" id="7292620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7292623">func</span>&nbsp;<span class="ident" id="7292628">TestVariousTextLineEndings</span><span class="op" id="7292654">(</span><span class="ident" id="7292655">t</span>&nbsp;<span class="op" id="7292657">*</span><span class="ident" id="7292658">testing</span><span class="op" id="7292665">.</span><span class="ident" id="7292666">T</span><span class="op" id="7292667">)</span>&nbsp;<span class="op" id="7292669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292672">tests</span>&nbsp;<span class="op" id="7292678">:=</span>&nbsp;<span class="op" id="7292681">[</span><span class="op" id="7292682">...</span><span class="op" id="7292685">]</span><span class="builtintype" id="7292686">string</span><span class="op" id="7292692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292696">&#34;Foo\nBar&#34;</span><span class="op" id="7292706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292710">&#34;Foo\nBar\n&#34;</span><span class="op" id="7292722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292726">&#34;Foo\r\nBar&#34;</span><span class="op" id="7292738">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292742">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="7292758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292762">&#34;Foo\rBar&#34;</span><span class="op" id="7292772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292776">&#34;Foo\rBar\r&#34;</span><span class="op" id="7292788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292792">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="7292838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7292841">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7292845">for</span>&nbsp;<span class="ident" id="7292849">testNum</span><span class="op" id="7292856">,</span>&nbsp;<span class="ident" id="7292858">expectedBody</span>&nbsp;<span class="op" id="7292871">:=</span>&nbsp;<span class="keyword" id="7292874">range</span>&nbsp;<span class="ident" id="7292880">tests</span>&nbsp;<span class="op" id="7292886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292890">body</span>&nbsp;<span class="op" id="7292895">:=</span>&nbsp;<span class="string" id="7292898">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="7292915">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292920">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7292973">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7292978">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="7292985">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7292990">expectedBody</span>&nbsp;<span class="op" id="7293003">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7293008">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293033">bodyReader</span>&nbsp;<span class="op" id="7293044">:=</span>&nbsp;<span class="ident" id="7293047">strings</span><span class="op" id="7293054">.</span><span class="ident" id="7293055">NewReader</span><span class="op" id="7293064">(</span><span class="ident" id="7293065">body</span><span class="op" id="7293069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293074">reader</span>&nbsp;<span class="op" id="7293081">:=</span>&nbsp;<span class="ident" id="7293084">NewReader</span><span class="op" id="7293093">(</span><span class="ident" id="7293094">bodyReader</span><span class="op" id="7293104">,</span>&nbsp;<span class="string" id="7293106">&#34;BOUNDARY&#34;</span><span class="op" id="7293116">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293120">buf</span>&nbsp;<span class="op" id="7293124">:=</span>&nbsp;<span class="builtinfunc" id="7293127">new</span><span class="op" id="7293130">(</span><span class="ident" id="7293131">bytes</span><span class="op" id="7293136">.</span><span class="ident" id="7293137">Buffer</span><span class="op" id="7293143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293147">part</span><span class="op" id="7293151">,</span>&nbsp;<span class="ident" id="7293153">err</span>&nbsp;<span class="op" id="7293157">:=</span>&nbsp;<span class="ident" id="7293160">reader</span><span class="op" id="7293166">.</span><span class="ident" id="7293167">NextPart</span><span class="op" id="7293175">(</span><span class="op" id="7293176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293180">if</span>&nbsp;<span class="ident" id="7293183">part</span>&nbsp;<span class="op" id="7293188">==</span>&nbsp;<span class="ident" id="7293191">nil</span>&nbsp;<span class="op" id="7293195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293200">t</span><span class="op" id="7293201">.</span><span class="ident" id="7293202">Errorf</span><span class="op" id="7293208">(</span><span class="string" id="7293209">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="7293242">,</span>&nbsp;<span class="ident" id="7293244">testNum</span><span class="op" id="7293251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293256">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293271">if</span>&nbsp;<span class="ident" id="7293274">err</span>&nbsp;<span class="op" id="7293278">!=</span>&nbsp;<span class="ident" id="7293281">nil</span>&nbsp;<span class="op" id="7293285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293290">t</span><span class="op" id="7293291">.</span><span class="ident" id="7293292">Errorf</span><span class="op" id="7293298">(</span><span class="string" id="7293299">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7293332">,</span>&nbsp;<span class="ident" id="7293334">testNum</span><span class="op" id="7293341">,</span>&nbsp;<span class="ident" id="7293343">err</span><span class="op" id="7293346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293351">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293362">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293366">written</span><span class="op" id="7293373">,</span>&nbsp;<span class="ident" id="7293375">err</span>&nbsp;<span class="op" id="7293379">:=</span>&nbsp;<span class="ident" id="7293382">io</span><span class="op" id="7293384">.</span><span class="ident" id="7293385">Copy</span><span class="op" id="7293389">(</span><span class="ident" id="7293390">buf</span><span class="op" id="7293393">,</span>&nbsp;<span class="ident" id="7293395">part</span><span class="op" id="7293399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293403">expectEq</span><span class="op" id="7293411">(</span><span class="ident" id="7293412">t</span><span class="op" id="7293413">,</span>&nbsp;<span class="ident" id="7293415">expectedBody</span><span class="op" id="7293427">,</span>&nbsp;<span class="ident" id="7293429">buf</span><span class="op" id="7293432">.</span><span class="ident" id="7293433">String</span><span class="op" id="7293439">(</span><span class="op" id="7293440">)</span><span class="op" id="7293441">,</span>&nbsp;<span class="ident" id="7293443">fmt</span><span class="op" id="7293446">.</span><span class="ident" id="7293447">Sprintf</span><span class="op" id="7293454">(</span><span class="string" id="7293455">&#34;test&nbsp;%d&#34;</span><span class="op" id="7293464">,</span>&nbsp;<span class="ident" id="7293466">testNum</span><span class="op" id="7293473">)</span><span class="op" id="7293474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293478">if</span>&nbsp;<span class="ident" id="7293481">err</span>&nbsp;<span class="op" id="7293485">!=</span>&nbsp;<span class="ident" id="7293488">nil</span>&nbsp;<span class="op" id="7293492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293497">t</span><span class="op" id="7293498">.</span><span class="ident" id="7293499">Errorf</span><span class="op" id="7293505">(</span><span class="string" id="7293506">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="7293551">,</span>&nbsp;<span class="ident" id="7293553">written</span><span class="op" id="7293560">,</span>&nbsp;<span class="ident" id="7293562">err</span><span class="op" id="7293565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293569">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293574">part</span><span class="op" id="7293578">,</span>&nbsp;<span class="ident" id="7293580">err</span>&nbsp;<span class="op" id="7293584">=</span>&nbsp;<span class="ident" id="7293586">reader</span><span class="op" id="7293592">.</span><span class="ident" id="7293593">NextPart</span><span class="op" id="7293601">(</span><span class="op" id="7293602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293606">if</span>&nbsp;<span class="ident" id="7293609">part</span>&nbsp;<span class="op" id="7293614">!=</span>&nbsp;<span class="ident" id="7293617">nil</span>&nbsp;<span class="op" id="7293621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293626">t</span><span class="op" id="7293627">.</span><span class="ident" id="7293628">Errorf</span><span class="op" id="7293634">(</span><span class="string" id="7293635">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="7293663">,</span>&nbsp;<span class="ident" id="7293665">testNum</span><span class="op" id="7293672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293676">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293680">if</span>&nbsp;<span class="ident" id="7293683">err</span>&nbsp;<span class="op" id="7293687">!=</span>&nbsp;<span class="ident" id="7293690">io</span><span class="op" id="7293692">.</span><span class="ident" id="7293693">EOF</span>&nbsp;<span class="op" id="7293697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293702">t</span><span class="op" id="7293703">.</span><span class="ident" id="7293704">Errorf</span><span class="op" id="7293710">(</span><span class="string" id="7293711">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7293747">,</span>&nbsp;<span class="ident" id="7293749">testNum</span><span class="op" id="7293756">,</span>&nbsp;<span class="ident" id="7293758">err</span><span class="op" id="7293761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7293769">}</span><br>
<span class="lineno">260</span><span class="op" id="7293771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7293774">type</span>&nbsp;<span class="ident" id="7293779">maliciousReader</span>&nbsp;<span class="keyword" id="7293795">struct</span>&nbsp;<span class="op" id="7293802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293805">t</span>&nbsp;<span class="op" id="7293807">*</span><span class="ident" id="7293808">testing</span><span class="op" id="7293815">.</span><span class="ident" id="7293816">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293819">n</span>&nbsp;<span class="builtintype" id="7293821">int</span><br>
<span class="lineno">265</span><span class="op" id="7293825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7293828">const</span>&nbsp;<span class="ident" id="7293834">maxReadThreshold</span>&nbsp;<span class="op" id="7293851">=</span>&nbsp;<span class="num" id="7293853">1</span>&nbsp;<span class="op" id="7293855">&lt;&lt;</span>&nbsp;<span class="num" id="7293858">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7293862">func</span>&nbsp;<span class="op" id="7293867">(</span><span class="ident" id="7293868">mr</span>&nbsp;<span class="op" id="7293871">*</span><span class="ident" id="7293872">maliciousReader</span><span class="op" id="7293887">)</span>&nbsp;<span class="ident" id="7293889">Read</span><span class="op" id="7293893">(</span><span class="ident" id="7293894">b</span>&nbsp;<span class="op" id="7293896">[</span><span class="op" id="7293897">]</span><span class="builtintype" id="7293898">byte</span><span class="op" id="7293902">)</span>&nbsp;<span class="op" id="7293904">(</span><span class="ident" id="7293905">n</span>&nbsp;<span class="builtintype" id="7293907">int</span><span class="op" id="7293910">,</span>&nbsp;<span class="ident" id="7293912">err</span>&nbsp;<span class="builtintype" id="7293916">error</span><span class="op" id="7293921">)</span>&nbsp;<span class="op" id="7293923">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293926">mr</span><span class="op" id="7293928">.</span><span class="ident" id="7293929">n</span>&nbsp;<span class="op" id="7293931">+=</span>&nbsp;<span class="builtinfunc" id="7293934">len</span><span class="op" id="7293937">(</span><span class="ident" id="7293938">b</span><span class="op" id="7293939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7293942">if</span>&nbsp;<span class="ident" id="7293945">mr</span><span class="op" id="7293947">.</span><span class="ident" id="7293948">n</span>&nbsp;<span class="op" id="7293950">&gt;=</span>&nbsp;<span class="ident" id="7293953">maxReadThreshold</span>&nbsp;<span class="op" id="7293970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7293974">mr</span><span class="op" id="7293976">.</span><span class="ident" id="7293977">t</span><span class="op" id="7293978">.</span><span class="ident" id="7293979">Fatal</span><span class="op" id="7293984">(</span><span class="string" id="7293985">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="7294004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294008">return</span>&nbsp;<span class="num" id="7294015">0</span><span class="op" id="7294016">,</span>&nbsp;<span class="ident" id="7294018">io</span><span class="op" id="7294020">.</span><span class="ident" id="7294021">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294026">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294029">return</span>&nbsp;<span class="builtinfunc" id="7294036">len</span><span class="op" id="7294039">(</span><span class="ident" id="7294040">b</span><span class="op" id="7294041">)</span><span class="op" id="7294042">,</span>&nbsp;<span class="ident" id="7294044">nil</span><br>
<span class="lineno"></span><span class="op" id="7294048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7294051">func</span>&nbsp;<span class="ident" id="7294056">TestLineLimit</span><span class="op" id="7294069">(</span><span class="ident" id="7294070">t</span>&nbsp;<span class="op" id="7294072">*</span><span class="ident" id="7294073">testing</span><span class="op" id="7294080">.</span><span class="ident" id="7294081">T</span><span class="op" id="7294082">)</span>&nbsp;<span class="op" id="7294084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294087">mr</span>&nbsp;<span class="op" id="7294090">:=</span>&nbsp;<span class="op" id="7294093">&amp;</span><span class="ident" id="7294094">maliciousReader</span><span class="op" id="7294109">{</span><span class="ident" id="7294110">t</span><span class="op" id="7294111">:</span>&nbsp;<span class="ident" id="7294113">t</span><span class="op" id="7294114">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294117">r</span>&nbsp;<span class="op" id="7294119">:=</span>&nbsp;<span class="ident" id="7294122">NewReader</span><span class="op" id="7294131">(</span><span class="ident" id="7294132">mr</span><span class="op" id="7294134">,</span>&nbsp;<span class="string" id="7294136">&#34;fooBoundary&#34;</span><span class="op" id="7294149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294152">part</span><span class="op" id="7294156">,</span>&nbsp;<span class="ident" id="7294158">err</span>&nbsp;<span class="op" id="7294162">:=</span>&nbsp;<span class="ident" id="7294165">r</span><span class="op" id="7294166">.</span><span class="ident" id="7294167">NextPart</span><span class="op" id="7294175">(</span><span class="op" id="7294176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294179">if</span>&nbsp;<span class="ident" id="7294182">part</span>&nbsp;<span class="op" id="7294187">!=</span>&nbsp;<span class="ident" id="7294190">nil</span>&nbsp;<span class="op" id="7294194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294198">t</span><span class="op" id="7294199">.</span><span class="ident" id="7294200">Errorf</span><span class="op" id="7294206">(</span><span class="string" id="7294207">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="7294229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294232">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294235">if</span>&nbsp;<span class="ident" id="7294238">err</span>&nbsp;<span class="op" id="7294242">==</span>&nbsp;<span class="ident" id="7294245">nil</span>&nbsp;<span class="op" id="7294249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294253">t</span><span class="op" id="7294254">.</span><span class="ident" id="7294255">Errorf</span><span class="op" id="7294261">(</span><span class="string" id="7294262">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="7294281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294287">if</span>&nbsp;<span class="ident" id="7294290">mr</span><span class="op" id="7294292">.</span><span class="ident" id="7294293">n</span>&nbsp;<span class="op" id="7294295">&gt;=</span>&nbsp;<span class="ident" id="7294298">maxReadThreshold</span>&nbsp;<span class="op" id="7294315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294319">t</span><span class="op" id="7294320">.</span><span class="ident" id="7294321">Errorf</span><span class="op" id="7294327">(</span><span class="string" id="7294328">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7294366">,</span>&nbsp;<span class="ident" id="7294368">maxReadThreshold</span><span class="op" id="7294384">,</span>&nbsp;<span class="ident" id="7294386">mr</span><span class="op" id="7294388">.</span><span class="ident" id="7294389">n</span><span class="op" id="7294390">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294393">}</span><br>
<span class="lineno"></span><span class="op" id="7294395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7294398">func</span>&nbsp;<span class="ident" id="7294403">TestMultipartTruncated</span><span class="op" id="7294425">(</span><span class="ident" id="7294426">t</span>&nbsp;<span class="op" id="7294428">*</span><span class="ident" id="7294429">testing</span><span class="op" id="7294436">.</span><span class="ident" id="7294437">T</span><span class="op" id="7294438">)</span>&nbsp;<span class="op" id="7294440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294443">testBody</span>&nbsp;<span class="op" id="7294452">:=</span>&nbsp;<span class="string" id="7294455">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294562">body</span>&nbsp;<span class="op" id="7294567">:=</span>&nbsp;<span class="ident" id="7294570">strings</span><span class="op" id="7294577">.</span><span class="ident" id="7294578">Replace</span><span class="op" id="7294585">(</span><span class="ident" id="7294586">testBody</span><span class="op" id="7294594">,</span>&nbsp;<span class="string" id="7294596">&#34;\n&#34;</span><span class="op" id="7294600">,</span>&nbsp;<span class="string" id="7294602">&#34;\r\n&#34;</span><span class="op" id="7294608">,</span>&nbsp;<span class="op" id="7294610">-</span><span class="num" id="7294611">1</span><span class="op" id="7294612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294615">bodyReader</span>&nbsp;<span class="op" id="7294626">:=</span>&nbsp;<span class="ident" id="7294629">strings</span><span class="op" id="7294636">.</span><span class="ident" id="7294637">NewReader</span><span class="op" id="7294646">(</span><span class="ident" id="7294647">body</span><span class="op" id="7294651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294654">r</span>&nbsp;<span class="op" id="7294656">:=</span>&nbsp;<span class="ident" id="7294659">NewReader</span><span class="op" id="7294668">(</span><span class="ident" id="7294669">bodyReader</span><span class="op" id="7294679">,</span>&nbsp;<span class="string" id="7294681">&#34;MyBoundary&#34;</span><span class="op" id="7294693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294697">part</span><span class="op" id="7294701">,</span>&nbsp;<span class="ident" id="7294703">err</span>&nbsp;<span class="op" id="7294707">:=</span>&nbsp;<span class="ident" id="7294710">r</span><span class="op" id="7294711">.</span><span class="ident" id="7294712">NextPart</span><span class="op" id="7294720">(</span><span class="op" id="7294721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294724">if</span>&nbsp;<span class="ident" id="7294727">err</span>&nbsp;<span class="op" id="7294731">!=</span>&nbsp;<span class="ident" id="7294734">nil</span>&nbsp;<span class="op" id="7294738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294742">t</span><span class="op" id="7294743">.</span><span class="ident" id="7294744">Fatalf</span><span class="op" id="7294750">(</span><span class="string" id="7294751">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7294770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294776">_</span><span class="op" id="7294777">,</span>&nbsp;<span class="ident" id="7294779">err</span>&nbsp;<span class="op" id="7294783">=</span>&nbsp;<span class="ident" id="7294785">io</span><span class="op" id="7294787">.</span><span class="ident" id="7294788">Copy</span><span class="op" id="7294792">(</span><span class="ident" id="7294793">ioutil</span><span class="op" id="7294799">.</span><span class="ident" id="7294800">Discard</span><span class="op" id="7294807">,</span>&nbsp;<span class="ident" id="7294809">part</span><span class="op" id="7294813">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7294816">if</span>&nbsp;<span class="ident" id="7294819">err</span>&nbsp;<span class="op" id="7294823">!=</span>&nbsp;<span class="ident" id="7294826">io</span><span class="op" id="7294828">.</span><span class="ident" id="7294829">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7294846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294850">t</span><span class="op" id="7294851">.</span><span class="ident" id="7294852">Fatalf</span><span class="op" id="7294858">(</span><span class="string" id="7294859">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7294903">,</span>&nbsp;<span class="ident" id="7294905">err</span><span class="op" id="7294908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7294911">}</span><br>
<span class="lineno"></span><span class="op" id="7294913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7294916">type</span>&nbsp;<span class="ident" id="7294921">slowReader</span>&nbsp;<span class="keyword" id="7294932">struct</span>&nbsp;<span class="op" id="7294939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7294942">r</span>&nbsp;<span class="ident" id="7294944">io</span><span class="op" id="7294946">.</span><span class="ident" id="7294947">Reader</span><br>
<span class="lineno"></span><span class="op" id="7294954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7294957">func</span>&nbsp;<span class="op" id="7294962">(</span><span class="ident" id="7294963">s</span>&nbsp;<span class="op" id="7294965">*</span><span class="ident" id="7294966">slowReader</span><span class="op" id="7294976">)</span>&nbsp;<span class="ident" id="7294978">Read</span><span class="op" id="7294982">(</span><span class="ident" id="7294983">p</span>&nbsp;<span class="op" id="7294985">[</span><span class="op" id="7294986">]</span><span class="builtintype" id="7294987">byte</span><span class="op" id="7294991">)</span>&nbsp;<span class="op" id="7294993">(</span><span class="builtintype" id="7294994">int</span><span class="op" id="7294997">,</span>&nbsp;<span class="builtintype" id="7294999">error</span><span class="op" id="7295004">)</span>&nbsp;<span class="op" id="7295006">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295009">if</span>&nbsp;<span class="builtinfunc" id="7295012">len</span><span class="op" id="7295015">(</span><span class="ident" id="7295016">p</span><span class="op" id="7295017">)</span>&nbsp;<span class="op" id="7295019">==</span>&nbsp;<span class="num" id="7295022">0</span>&nbsp;<span class="op" id="7295024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295028">return</span>&nbsp;<span class="ident" id="7295035">s</span><span class="op" id="7295036">.</span><span class="ident" id="7295037">r</span><span class="op" id="7295038">.</span><span class="ident" id="7295039">Read</span><span class="op" id="7295043">(</span><span class="ident" id="7295044">p</span><span class="op" id="7295045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7295048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295051">return</span>&nbsp;<span class="ident" id="7295058">s</span><span class="op" id="7295059">.</span><span class="ident" id="7295060">r</span><span class="op" id="7295061">.</span><span class="ident" id="7295062">Read</span><span class="op" id="7295066">(</span><span class="ident" id="7295067">p</span><span class="op" id="7295068">[</span><span class="op" id="7295069">:</span><span class="num" id="7295070">1</span><span class="op" id="7295071">]</span><span class="op" id="7295072">)</span><br>
<span class="lineno"></span><span class="op" id="7295074">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="7295077">func</span>&nbsp;<span class="ident" id="7295082">TestLineContinuation</span><span class="op" id="7295102">(</span><span class="ident" id="7295103">t</span>&nbsp;<span class="op" id="7295105">*</span><span class="ident" id="7295106">testing</span><span class="op" id="7295113">.</span><span class="ident" id="7295114">T</span><span class="op" id="7295115">)</span>&nbsp;<span class="op" id="7295117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7295120">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7295196">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7295208">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7295275">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295336">testBody</span>&nbsp;<span class="op" id="7295345">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7295350">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295846">r</span>&nbsp;<span class="op" id="7295848">:=</span>&nbsp;<span class="ident" id="7295851">NewReader</span><span class="op" id="7295860">(</span><span class="ident" id="7295861">strings</span><span class="op" id="7295868">.</span><span class="ident" id="7295869">NewReader</span><span class="op" id="7295878">(</span><span class="ident" id="7295879">testBody</span><span class="op" id="7295887">)</span><span class="op" id="7295888">,</span>&nbsp;<span class="string" id="7295890">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="7295914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295918">for</span>&nbsp;<span class="ident" id="7295922">i</span>&nbsp;<span class="op" id="7295924">:=</span>&nbsp;<span class="num" id="7295927">0</span><span class="op" id="7295928">;</span>&nbsp;<span class="ident" id="7295930">i</span>&nbsp;<span class="op" id="7295932">&lt;</span>&nbsp;<span class="num" id="7295934">2</span><span class="op" id="7295935">;</span>&nbsp;<span class="ident" id="7295937">i</span><span class="op" id="7295938">++</span>&nbsp;<span class="op" id="7295941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295945">part</span><span class="op" id="7295949">,</span>&nbsp;<span class="ident" id="7295951">err</span>&nbsp;<span class="op" id="7295955">:=</span>&nbsp;<span class="ident" id="7295958">r</span><span class="op" id="7295959">.</span><span class="ident" id="7295960">NextPart</span><span class="op" id="7295968">(</span><span class="op" id="7295969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7295973">if</span>&nbsp;<span class="ident" id="7295976">err</span>&nbsp;<span class="op" id="7295980">!=</span>&nbsp;<span class="ident" id="7295983">nil</span>&nbsp;<span class="op" id="7295987">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7295992">t</span><span class="op" id="7295993">.</span><span class="ident" id="7295994">Fatalf</span><span class="op" id="7296000">(</span><span class="string" id="7296001">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="7296020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296028">var</span>&nbsp;<span class="ident" id="7296032">buf</span>&nbsp;<span class="ident" id="7296036">bytes</span><span class="op" id="7296041">.</span><span class="ident" id="7296042">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296051">n</span><span class="op" id="7296052">,</span>&nbsp;<span class="ident" id="7296054">err</span>&nbsp;<span class="op" id="7296058">:=</span>&nbsp;<span class="ident" id="7296061">io</span><span class="op" id="7296063">.</span><span class="ident" id="7296064">Copy</span><span class="op" id="7296068">(</span><span class="op" id="7296069">&amp;</span><span class="ident" id="7296070">buf</span><span class="op" id="7296073">,</span>&nbsp;<span class="ident" id="7296075">part</span><span class="op" id="7296079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296083">if</span>&nbsp;<span class="ident" id="7296086">err</span>&nbsp;<span class="op" id="7296090">!=</span>&nbsp;<span class="ident" id="7296093">nil</span>&nbsp;<span class="op" id="7296097">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296102">t</span><span class="op" id="7296103">.</span><span class="ident" id="7296104">Errorf</span><span class="op" id="7296110">(</span><span class="string" id="7296111">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="7296152">,</span>&nbsp;<span class="ident" id="7296154">err</span><span class="op" id="7296157">,</span>&nbsp;<span class="ident" id="7296159">buf</span><span class="op" id="7296162">.</span><span class="ident" id="7296163">String</span><span class="op" id="7296169">(</span><span class="op" id="7296170">)</span><span class="op" id="7296171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7296179">if</span>&nbsp;<span class="ident" id="7296182">n</span>&nbsp;<span class="op" id="7296184">&lt;=</span>&nbsp;<span class="num" id="7296187">0</span>&nbsp;<span class="op" id="7296189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296194">t</span><span class="op" id="7296195">.</span><span class="ident" id="7296196">Errorf</span><span class="op" id="7296202">(</span><span class="string" id="7296203">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="7296231">,</span>&nbsp;<span class="ident" id="7296233">n</span><span class="op" id="7296234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296238">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7296241">}</span><br>
<span class="lineno"></span><span class="op" id="7296243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7296246">func</span>&nbsp;<span class="ident" id="7296251">TestQuotedPrintableEncoding</span><span class="op" id="7296278">(</span><span class="ident" id="7296279">t</span>&nbsp;<span class="op" id="7296281">*</span><span class="ident" id="7296282">testing</span><span class="op" id="7296289">.</span><span class="ident" id="7296290">T</span><span class="op" id="7296291">)</span>&nbsp;<span class="op" id="7296293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7296296">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7296334">body</span>&nbsp;<span class="op" id="7296339">:=</span>&nbsp;<span class="string" id="7296342">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297076">r</span>&nbsp;<span class="op" id="7297078">:=</span>&nbsp;<span class="ident" id="7297081">NewReader</span><span class="op" id="7297090">(</span><span class="ident" id="7297091">strings</span><span class="op" id="7297098">.</span><span class="ident" id="7297099">NewReader</span><span class="op" id="7297108">(</span><span class="ident" id="7297109">body</span><span class="op" id="7297113">)</span><span class="op" id="7297114">,</span>&nbsp;<span class="string" id="7297116">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="7297146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297149">part</span><span class="op" id="7297153">,</span>&nbsp;<span class="ident" id="7297155">err</span>&nbsp;<span class="op" id="7297159">:=</span>&nbsp;<span class="ident" id="7297162">r</span><span class="op" id="7297163">.</span><span class="ident" id="7297164">NextPart</span><span class="op" id="7297172">(</span><span class="op" id="7297173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297176">if</span>&nbsp;<span class="ident" id="7297179">err</span>&nbsp;<span class="op" id="7297183">!=</span>&nbsp;<span class="ident" id="7297186">nil</span>&nbsp;<span class="op" id="7297190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297194">t</span><span class="op" id="7297195">.</span><span class="ident" id="7297196">Fatal</span><span class="op" id="7297201">(</span><span class="ident" id="7297202">err</span><span class="op" id="7297205">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297211">if</span>&nbsp;<span class="ident" id="7297214">te</span><span class="op" id="7297216">,</span>&nbsp;<span class="ident" id="7297218">ok</span>&nbsp;<span class="op" id="7297221">:=</span>&nbsp;<span class="ident" id="7297224">part</span><span class="op" id="7297228">.</span><span class="ident" id="7297229">Header</span><span class="op" id="7297235">[</span><span class="string" id="7297236">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="7297263">]</span><span class="op" id="7297264">;</span>&nbsp;<span class="ident" id="7297266">ok</span>&nbsp;<span class="op" id="7297269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297273">t</span><span class="op" id="7297274">.</span><span class="ident" id="7297275">Errorf</span><span class="op" id="7297281">(</span><span class="string" id="7297282">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7297326">,</span>&nbsp;<span class="ident" id="7297328">te</span><span class="op" id="7297330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297336">var</span>&nbsp;<span class="ident" id="7297340">buf</span>&nbsp;<span class="ident" id="7297344">bytes</span><span class="op" id="7297349">.</span><span class="ident" id="7297350">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297358">_</span><span class="op" id="7297359">,</span>&nbsp;<span class="ident" id="7297361">err</span>&nbsp;<span class="op" id="7297365">=</span>&nbsp;<span class="ident" id="7297367">io</span><span class="op" id="7297369">.</span><span class="ident" id="7297370">Copy</span><span class="op" id="7297374">(</span><span class="op" id="7297375">&amp;</span><span class="ident" id="7297376">buf</span><span class="op" id="7297379">,</span>&nbsp;<span class="ident" id="7297381">part</span><span class="op" id="7297385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297388">if</span>&nbsp;<span class="ident" id="7297391">err</span>&nbsp;<span class="op" id="7297395">!=</span>&nbsp;<span class="ident" id="7297398">nil</span>&nbsp;<span class="op" id="7297402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297406">t</span><span class="op" id="7297407">.</span><span class="ident" id="7297408">Error</span><span class="op" id="7297413">(</span><span class="ident" id="7297414">err</span><span class="op" id="7297417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297423">got</span>&nbsp;<span class="op" id="7297427">:=</span>&nbsp;<span class="ident" id="7297430">buf</span><span class="op" id="7297433">.</span><span class="ident" id="7297434">String</span><span class="op" id="7297440">(</span><span class="op" id="7297441">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297444">want</span>&nbsp;<span class="op" id="7297449">:=</span>&nbsp;<span class="string" id="7297452">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7297809">if</span>&nbsp;<span class="ident" id="7297812">got</span>&nbsp;<span class="op" id="7297816">!=</span>&nbsp;<span class="ident" id="7297819">want</span>&nbsp;<span class="op" id="7297824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7297828">t</span><span class="op" id="7297829">.</span><span class="ident" id="7297830">Errorf</span><span class="op" id="7297836">(</span><span class="string" id="7297837">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="7297876">,</span>&nbsp;<span class="ident" id="7297878">got</span><span class="op" id="7297881">,</span>&nbsp;<span class="ident" id="7297883">want</span><span class="op" id="7297887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7297890">}</span><br>
<span class="lineno"></span><span class="op" id="7297892">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="7297895">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="7297968">func</span>&nbsp;<span class="ident" id="7297973">TestNested</span><span class="op" id="7297983">(</span><span class="ident" id="7297984">t</span>&nbsp;<span class="op" id="7297986">*</span><span class="ident" id="7297987">testing</span><span class="op" id="7297994">.</span><span class="ident" id="7297995">T</span><span class="op" id="7297996">)</span>&nbsp;<span class="op" id="7297998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7298001">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7298061">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298108">f</span><span class="op" id="7298109">,</span>&nbsp;<span class="ident" id="7298111">err</span>&nbsp;<span class="op" id="7298115">:=</span>&nbsp;<span class="ident" id="7298118">os</span><span class="op" id="7298120">.</span><span class="ident" id="7298121">Open</span><span class="op" id="7298125">(</span><span class="string" id="7298126">&#34;testdata/nested-mime&#34;</span><span class="op" id="7298148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298151">if</span>&nbsp;<span class="ident" id="7298154">err</span>&nbsp;<span class="op" id="7298158">!=</span>&nbsp;<span class="ident" id="7298161">nil</span>&nbsp;<span class="op" id="7298165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298169">t</span><span class="op" id="7298170">.</span><span class="ident" id="7298171">Fatal</span><span class="op" id="7298176">(</span><span class="ident" id="7298177">err</span><span class="op" id="7298180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298186">defer</span>&nbsp;<span class="ident" id="7298192">f</span><span class="op" id="7298193">.</span><span class="ident" id="7298194">Close</span><span class="op" id="7298199">(</span><span class="op" id="7298200">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298203">mr</span>&nbsp;<span class="op" id="7298206">:=</span>&nbsp;<span class="ident" id="7298209">NewReader</span><span class="op" id="7298218">(</span><span class="ident" id="7298219">f</span><span class="op" id="7298220">,</span>&nbsp;<span class="string" id="7298222">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="7298252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298255">p</span><span class="op" id="7298256">,</span>&nbsp;<span class="ident" id="7298258">err</span>&nbsp;<span class="op" id="7298262">:=</span>&nbsp;<span class="ident" id="7298265">mr</span><span class="op" id="7298267">.</span><span class="ident" id="7298268">NextPart</span><span class="op" id="7298276">(</span><span class="op" id="7298277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298280">if</span>&nbsp;<span class="ident" id="7298283">err</span>&nbsp;<span class="op" id="7298287">!=</span>&nbsp;<span class="ident" id="7298290">nil</span>&nbsp;<span class="op" id="7298294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298298">t</span><span class="op" id="7298299">.</span><span class="ident" id="7298300">Fatalf</span><span class="op" id="7298306">(</span><span class="string" id="7298307">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="7298354">,</span>&nbsp;<span class="ident" id="7298356">err</span><span class="op" id="7298359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298362">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7298366">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298449">mr2</span>&nbsp;<span class="op" id="7298453">:=</span>&nbsp;<span class="ident" id="7298456">NewReader</span><span class="op" id="7298465">(</span><span class="ident" id="7298466">p</span><span class="op" id="7298467">,</span>&nbsp;<span class="string" id="7298469">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="7298499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298502">p</span><span class="op" id="7298503">,</span>&nbsp;<span class="ident" id="7298505">err</span>&nbsp;<span class="op" id="7298509">=</span>&nbsp;<span class="ident" id="7298511">mr2</span><span class="op" id="7298514">.</span><span class="ident" id="7298515">NextPart</span><span class="op" id="7298523">(</span><span class="op" id="7298524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298527">if</span>&nbsp;<span class="ident" id="7298530">err</span>&nbsp;<span class="op" id="7298534">!=</span>&nbsp;<span class="ident" id="7298537">nil</span>&nbsp;<span class="op" id="7298541">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298545">t</span><span class="op" id="7298546">.</span><span class="ident" id="7298547">Fatalf</span><span class="op" id="7298553">(</span><span class="string" id="7298554">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7298583">,</span>&nbsp;<span class="ident" id="7298585">err</span><span class="op" id="7298588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298594">if</span>&nbsp;<span class="ident" id="7298597">b</span><span class="op" id="7298598">,</span>&nbsp;<span class="ident" id="7298600">err</span>&nbsp;<span class="op" id="7298604">:=</span>&nbsp;<span class="ident" id="7298607">ioutil</span><span class="op" id="7298613">.</span><span class="ident" id="7298614">ReadAll</span><span class="op" id="7298621">(</span><span class="ident" id="7298622">p</span><span class="op" id="7298623">)</span><span class="op" id="7298624">;</span>&nbsp;<span class="builtintype" id="7298626">string</span><span class="op" id="7298632">(</span><span class="ident" id="7298633">b</span><span class="op" id="7298634">)</span>&nbsp;<span class="op" id="7298636">!=</span>&nbsp;<span class="string" id="7298639">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="7298652">||</span>&nbsp;<span class="ident" id="7298655">err</span>&nbsp;<span class="op" id="7298659">!=</span>&nbsp;<span class="ident" id="7298662">nil</span>&nbsp;<span class="op" id="7298666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298670">t</span><span class="op" id="7298671">.</span><span class="ident" id="7298672">Fatalf</span><span class="op" id="7298678">(</span><span class="string" id="7298679">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7298716">,</span>&nbsp;<span class="ident" id="7298718">b</span><span class="op" id="7298719">,</span>&nbsp;<span class="ident" id="7298721">err</span><span class="op" id="7298724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298727">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298730">p</span><span class="op" id="7298731">,</span>&nbsp;<span class="ident" id="7298733">err</span>&nbsp;<span class="op" id="7298737">=</span>&nbsp;<span class="ident" id="7298739">mr2</span><span class="op" id="7298742">.</span><span class="ident" id="7298743">NextPart</span><span class="op" id="7298751">(</span><span class="op" id="7298752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298755">if</span>&nbsp;<span class="ident" id="7298758">err</span>&nbsp;<span class="op" id="7298762">!=</span>&nbsp;<span class="ident" id="7298765">nil</span>&nbsp;<span class="op" id="7298769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298773">t</span><span class="op" id="7298774">.</span><span class="ident" id="7298775">Fatalf</span><span class="op" id="7298781">(</span><span class="string" id="7298782">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7298810">,</span>&nbsp;<span class="ident" id="7298812">err</span><span class="op" id="7298815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298821">if</span>&nbsp;<span class="ident" id="7298824">b</span><span class="op" id="7298825">,</span>&nbsp;<span class="ident" id="7298827">err</span>&nbsp;<span class="op" id="7298831">:=</span>&nbsp;<span class="ident" id="7298834">ioutil</span><span class="op" id="7298840">.</span><span class="ident" id="7298841">ReadAll</span><span class="op" id="7298848">(</span><span class="ident" id="7298849">p</span><span class="op" id="7298850">)</span><span class="op" id="7298851">;</span>&nbsp;<span class="builtintype" id="7298853">string</span><span class="op" id="7298859">(</span><span class="ident" id="7298860">b</span><span class="op" id="7298861">)</span>&nbsp;<span class="op" id="7298863">!=</span>&nbsp;<span class="string" id="7298866">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="7298884">||</span>&nbsp;<span class="ident" id="7298887">err</span>&nbsp;<span class="op" id="7298891">!=</span>&nbsp;<span class="ident" id="7298894">nil</span>&nbsp;<span class="op" id="7298898">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298902">t</span><span class="op" id="7298903">.</span><span class="ident" id="7298904">Fatalf</span><span class="op" id="7298910">(</span><span class="string" id="7298911">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="7298947">,</span>&nbsp;<span class="ident" id="7298949">b</span><span class="op" id="7298950">,</span>&nbsp;<span class="ident" id="7298952">err</span><span class="op" id="7298955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7298958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7298962">p</span><span class="op" id="7298963">,</span>&nbsp;<span class="ident" id="7298965">err</span>&nbsp;<span class="op" id="7298969">=</span>&nbsp;<span class="ident" id="7298971">mr2</span><span class="op" id="7298974">.</span><span class="ident" id="7298975">NextPart</span><span class="op" id="7298983">(</span><span class="op" id="7298984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7298987">if</span>&nbsp;<span class="ident" id="7298990">err</span>&nbsp;<span class="op" id="7298994">!=</span>&nbsp;<span class="ident" id="7298997">io</span><span class="op" id="7298999">.</span><span class="ident" id="7299000">EOF</span>&nbsp;<span class="op" id="7299004">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299008">t</span><span class="op" id="7299009">.</span><span class="ident" id="7299010">Fatalf</span><span class="op" id="7299016">(</span><span class="string" id="7299017">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7299057">,</span>&nbsp;<span class="ident" id="7299059">err</span><span class="op" id="7299062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7299065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7299069">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299138">_</span><span class="op" id="7299139">,</span>&nbsp;<span class="ident" id="7299141">err</span>&nbsp;<span class="op" id="7299145">=</span>&nbsp;<span class="ident" id="7299147">mr</span><span class="op" id="7299149">.</span><span class="ident" id="7299150">NextPart</span><span class="op" id="7299158">(</span><span class="op" id="7299159">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7299162">if</span>&nbsp;<span class="ident" id="7299165">err</span>&nbsp;<span class="op" id="7299169">!=</span>&nbsp;<span class="ident" id="7299172">nil</span>&nbsp;<span class="op" id="7299176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299180">t</span><span class="op" id="7299181">.</span><span class="ident" id="7299182">Fatalf</span><span class="op" id="7299188">(</span><span class="string" id="7299189">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="7299240">,</span>&nbsp;<span class="ident" id="7299242">err</span><span class="op" id="7299245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7299248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299252">_</span><span class="op" id="7299253">,</span>&nbsp;<span class="ident" id="7299255">err</span>&nbsp;<span class="op" id="7299259">=</span>&nbsp;<span class="ident" id="7299261">mr</span><span class="op" id="7299263">.</span><span class="ident" id="7299264">NextPart</span><span class="op" id="7299272">(</span><span class="op" id="7299273">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7299276">if</span>&nbsp;<span class="ident" id="7299279">err</span>&nbsp;<span class="op" id="7299283">!=</span>&nbsp;<span class="ident" id="7299286">io</span><span class="op" id="7299288">.</span><span class="ident" id="7299289">EOF</span>&nbsp;<span class="op" id="7299293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299297">t</span><span class="op" id="7299298">.</span><span class="ident" id="7299299">Fatalf</span><span class="op" id="7299305">(</span><span class="string" id="7299306">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7299346">,</span>&nbsp;<span class="ident" id="7299348">err</span><span class="op" id="7299351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7299354">}</span><br>
<span class="lineno"></span><span class="op" id="7299356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="7299359">type</span>&nbsp;<span class="ident" id="7299364">headerBody</span>&nbsp;<span class="keyword" id="7299375">struct</span>&nbsp;<span class="op" id="7299382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299385">header</span>&nbsp;<span class="ident" id="7299392">textproto</span><span class="op" id="7299401">.</span><span class="ident" id="7299402">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299414">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7299421">string</span><br>
<span class="lineno"></span><span class="op" id="7299428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7299431">func</span>&nbsp;<span class="ident" id="7299436">formData</span><span class="op" id="7299444">(</span><span class="ident" id="7299445">key</span><span class="op" id="7299448">,</span>&nbsp;<span class="ident" id="7299450">value</span>&nbsp;<span class="builtintype" id="7299456">string</span><span class="op" id="7299462">)</span>&nbsp;<span class="ident" id="7299464">headerBody</span>&nbsp;<span class="op" id="7299475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7299478">return</span>&nbsp;<span class="ident" id="7299485">headerBody</span><span class="op" id="7299495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299499">textproto</span><span class="op" id="7299508">.</span><span class="ident" id="7299509">MIMEHeader</span><span class="op" id="7299519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299524">&#34;Content-Type&#34;</span><span class="op" id="7299538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7299547">{</span><span class="string" id="7299548">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="7299580">}</span><span class="op" id="7299581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299586">&#34;Content-Disposition&#34;</span><span class="op" id="7299607">:</span>&nbsp;<span class="op" id="7299609">{</span><span class="string" id="7299610">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="7299629">+</span>&nbsp;<span class="ident" id="7299631">key</span><span class="op" id="7299634">}</span><span class="op" id="7299635">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7299639">}</span><span class="op" id="7299640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299644">value</span><span class="op" id="7299649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7299652">}</span><br>
<span class="lineno"></span><span class="op" id="7299654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="7299657">type</span>&nbsp;<span class="ident" id="7299662">parseTest</span>&nbsp;<span class="keyword" id="7299672">struct</span>&nbsp;<span class="op" id="7299679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299682">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7299690">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299698">in</span><span class="op" id="7299700">,</span>&nbsp;<span class="ident" id="7299702">sep</span>&nbsp;<span class="builtintype" id="7299706">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7299714">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7299722">[</span><span class="op" id="7299723">]</span><span class="ident" id="7299724">headerBody</span><br>
<span class="lineno"></span><span class="op" id="7299735">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="7299738">var</span>&nbsp;<span class="ident" id="7299742">parseTests</span>&nbsp;<span class="op" id="7299753">=</span>&nbsp;<span class="op" id="7299755">[</span><span class="op" id="7299756">]</span><span class="ident" id="7299757">parseTest</span><span class="op" id="7299766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7299769">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7299839">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7299908">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7299974">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7300037">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7300103">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7300166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7300170">name</span><span class="op" id="7300174">:</span>&nbsp;<span class="string" id="7300176">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="7300193">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7300197">sep</span><span class="op" id="7300200">:</span>&nbsp;&nbsp;<span class="string" id="7300203">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="7300233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7300237">in</span><span class="op" id="7300239">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7300243">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="7302151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302155">want</span><span class="op" id="7302159">:</span>&nbsp;<span class="op" id="7302161">[</span><span class="op" id="7302162">]</span><span class="ident" id="7302163">headerBody</span><span class="op" id="7302173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302178">formData</span><span class="op" id="7302186">(</span><span class="string" id="7302187">&#34;otherEmpty1&#34;</span><span class="op" id="7302200">,</span>&nbsp;<span class="string" id="7302202">&#34;&#34;</span><span class="op" id="7302204">)</span><span class="op" id="7302205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302210">formData</span><span class="op" id="7302218">(</span><span class="string" id="7302219">&#34;otherFoo1&#34;</span><span class="op" id="7302230">,</span>&nbsp;<span class="string" id="7302232">&#34;foo&#34;</span><span class="op" id="7302237">)</span><span class="op" id="7302238">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302243">formData</span><span class="op" id="7302251">(</span><span class="string" id="7302252">&#34;otherFoo2&#34;</span><span class="op" id="7302263">,</span>&nbsp;<span class="string" id="7302265">&#34;foo&#34;</span><span class="op" id="7302270">)</span><span class="op" id="7302271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302276">formData</span><span class="op" id="7302284">(</span><span class="string" id="7302285">&#34;otherEmpty2&#34;</span><span class="op" id="7302298">,</span>&nbsp;<span class="string" id="7302300">&#34;&#34;</span><span class="op" id="7302302">)</span><span class="op" id="7302303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302308">formData</span><span class="op" id="7302316">(</span><span class="string" id="7302317">&#34;otherRepeatFoo&#34;</span><span class="op" id="7302333">,</span>&nbsp;<span class="string" id="7302335">&#34;foo&#34;</span><span class="op" id="7302340">)</span><span class="op" id="7302341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302346">formData</span><span class="op" id="7302354">(</span><span class="string" id="7302355">&#34;otherRepeatFoo&#34;</span><span class="op" id="7302371">,</span>&nbsp;<span class="string" id="7302373">&#34;foo&#34;</span><span class="op" id="7302378">)</span><span class="op" id="7302379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302384">formData</span><span class="op" id="7302392">(</span><span class="string" id="7302393">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7302411">,</span>&nbsp;<span class="string" id="7302413">&#34;&#34;</span><span class="op" id="7302415">)</span><span class="op" id="7302416">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302421">formData</span><span class="op" id="7302429">(</span><span class="string" id="7302430">&#34;otherRepeatEmpty&#34;</span><span class="op" id="7302448">,</span>&nbsp;<span class="string" id="7302450">&#34;&#34;</span><span class="op" id="7302452">)</span><span class="op" id="7302453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7302458">formData</span><span class="op" id="7302466">(</span><span class="string" id="7302467">&#34;submit&#34;</span><span class="op" id="7302475">,</span>&nbsp;<span class="string" id="7302477">&#34;Submit&#34;</span><span class="op" id="7302485">)</span><span class="op" id="7302486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7302491">{</span><span class="ident" id="7302492">textproto</span><span class="op" id="7302501">.</span><span class="ident" id="7302502">MIMEHeader</span><span class="op" id="7302512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302518">&#34;Content-Type&#34;</span><span class="op" id="7302532">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7302541">{</span><span class="string" id="7302542">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="7302758">}</span><span class="op" id="7302759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7302765">&#34;Content-Disposition&#34;</span><span class="op" id="7302786">:</span>&nbsp;<span class="op" id="7302788">{</span><span class="string" id="7302789">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="7302834">}</span><span class="op" id="7302835">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7302840">}</span><span class="op" id="7302841">,</span>&nbsp;<span class="string" id="7302843">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="7303090">}</span><span class="op" id="7303091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303095">}</span><span class="op" id="7303096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303099">}</span><span class="op" id="7303100">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7303104">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303180">name</span><span class="op" id="7303184">:</span>&nbsp;<span class="string" id="7303186">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="7303217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303221">sep</span><span class="op" id="7303224">:</span>&nbsp;&nbsp;<span class="string" id="7303227">&#34;abc&#34;</span><span class="op" id="7303232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303236">in</span><span class="op" id="7303238">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7303242">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="7303276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303280">want</span><span class="op" id="7303284">:</span>&nbsp;<span class="op" id="7303286">[</span><span class="op" id="7303287">]</span><span class="ident" id="7303288">headerBody</span><span class="op" id="7303298">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303303">{</span><span class="ident" id="7303304">textproto</span><span class="op" id="7303313">.</span><span class="ident" id="7303314">MIMEHeader</span><span class="op" id="7303324">{</span><span class="string" id="7303325">&#34;Foo&#34;</span><span class="op" id="7303330">:</span>&nbsp;<span class="op" id="7303332">{</span><span class="string" id="7303333">&#34;bar&#34;</span><span class="op" id="7303338">}</span><span class="op" id="7303339">}</span><span class="op" id="7303340">,</span>&nbsp;<span class="string" id="7303342">&#34;&#34;</span><span class="op" id="7303344">}</span><span class="op" id="7303345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303349">}</span><span class="op" id="7303350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303353">}</span><span class="op" id="7303354">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7303358">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303438">name</span><span class="op" id="7303442">:</span>&nbsp;<span class="string" id="7303444">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="7303479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303483">sep</span><span class="op" id="7303486">:</span>&nbsp;&nbsp;<span class="string" id="7303489">&#34;abc&#34;</span><span class="op" id="7303494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303498">in</span><span class="op" id="7303500">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7303504">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="7303542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303546">want</span><span class="op" id="7303550">:</span>&nbsp;<span class="op" id="7303552">[</span><span class="op" id="7303553">]</span><span class="ident" id="7303554">headerBody</span><span class="op" id="7303564">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303569">{</span><span class="ident" id="7303570">textproto</span><span class="op" id="7303579">.</span><span class="ident" id="7303580">MIMEHeader</span><span class="op" id="7303590">{</span><span class="string" id="7303591">&#34;Foo&#34;</span><span class="op" id="7303596">:</span>&nbsp;<span class="op" id="7303598">{</span><span class="string" id="7303599">&#34;bar&#34;</span><span class="op" id="7303604">}</span><span class="op" id="7303605">}</span><span class="op" id="7303606">,</span>&nbsp;<span class="string" id="7303608">&#34;&#34;</span><span class="op" id="7303610">}</span><span class="op" id="7303611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303615">}</span><span class="op" id="7303616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303619">}</span><span class="op" id="7303620">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7303624">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303650">name</span><span class="op" id="7303654">:</span>&nbsp;<span class="string" id="7303656">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="7303674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303678">sep</span><span class="op" id="7303681">:</span>&nbsp;&nbsp;<span class="string" id="7303684">&#34;abc&#34;</span><span class="op" id="7303689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303693">in</span><span class="op" id="7303695">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7303699">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="7303760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303764">want</span><span class="op" id="7303768">:</span>&nbsp;<span class="op" id="7303770">[</span><span class="op" id="7303771">]</span><span class="ident" id="7303772">headerBody</span><span class="op" id="7303782">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303787">{</span><span class="ident" id="7303788">textproto</span><span class="op" id="7303797">.</span><span class="ident" id="7303798">MIMEHeader</span><span class="op" id="7303808">{</span><span class="string" id="7303809">&#34;Foo&#34;</span><span class="op" id="7303814">:</span>&nbsp;<span class="op" id="7303816">{</span><span class="string" id="7303817">&#34;bar&#34;</span><span class="op" id="7303822">}</span><span class="op" id="7303823">}</span><span class="op" id="7303824">,</span>&nbsp;<span class="string" id="7303826">&#34;&#34;</span><span class="op" id="7303828">}</span><span class="op" id="7303829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303834">{</span><span class="ident" id="7303835">textproto</span><span class="op" id="7303844">.</span><span class="ident" id="7303845">MIMEHeader</span><span class="op" id="7303855">{</span><span class="string" id="7303856">&#34;Foo2&#34;</span><span class="op" id="7303862">:</span>&nbsp;<span class="op" id="7303864">{</span><span class="string" id="7303865">&#34;bar2&#34;</span><span class="op" id="7303871">}</span><span class="op" id="7303872">}</span><span class="op" id="7303873">,</span>&nbsp;<span class="string" id="7303875">&#34;&#34;</span><span class="op" id="7303877">}</span><span class="op" id="7303878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303882">}</span><span class="op" id="7303883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303886">}</span><span class="op" id="7303887">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7303891">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303953">name</span><span class="op" id="7303957">:</span>&nbsp;<span class="string" id="7303959">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="7303987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303991">sep</span><span class="op" id="7303994">:</span>&nbsp;&nbsp;<span class="string" id="7303997">&#34;abc&#34;</span><span class="op" id="7304002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304006">in</span><span class="op" id="7304008">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7304012">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="7304050">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304054">want</span><span class="op" id="7304058">:</span>&nbsp;<span class="op" id="7304060">[</span><span class="op" id="7304061">]</span><span class="ident" id="7304062">headerBody</span><span class="op" id="7304072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304077">{</span><span class="ident" id="7304078">textproto</span><span class="op" id="7304087">.</span><span class="ident" id="7304088">MIMEHeader</span><span class="op" id="7304098">{</span><span class="string" id="7304099">&#34;Foo&#34;</span><span class="op" id="7304104">:</span>&nbsp;<span class="op" id="7304106">{</span><span class="string" id="7304107">&#34;bar&#34;</span><span class="op" id="7304112">}</span><span class="op" id="7304113">}</span><span class="op" id="7304114">,</span>&nbsp;<span class="string" id="7304116">&#34;&#34;</span><span class="op" id="7304118">}</span><span class="op" id="7304119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304123">}</span><span class="op" id="7304124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304127">}</span><span class="op" id="7304128">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7304132">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304196">name</span><span class="op" id="7304200">:</span>&nbsp;<span class="string" id="7304202">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="7304230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304234">sep</span><span class="op" id="7304237">:</span>&nbsp;&nbsp;<span class="string" id="7304240">&#34;abc&#34;</span><span class="op" id="7304245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304249">in</span><span class="op" id="7304251">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7304255">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="7304292">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304296">want</span><span class="op" id="7304300">:</span>&nbsp;<span class="op" id="7304302">[</span><span class="op" id="7304303">]</span><span class="ident" id="7304304">headerBody</span><span class="op" id="7304314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304319">{</span><span class="ident" id="7304320">textproto</span><span class="op" id="7304329">.</span><span class="ident" id="7304330">MIMEHeader</span><span class="op" id="7304340">{</span><span class="string" id="7304341">&#34;Foo&#34;</span><span class="op" id="7304346">:</span>&nbsp;<span class="op" id="7304348">{</span><span class="string" id="7304349">&#34;bar&#34;</span><span class="op" id="7304354">}</span><span class="op" id="7304355">}</span><span class="op" id="7304356">,</span>&nbsp;<span class="string" id="7304358">&#34;&#34;</span><span class="op" id="7304360">}</span><span class="op" id="7304361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304365">}</span><span class="op" id="7304366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304369">}</span><span class="op" id="7304370">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7304374">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304427">name</span><span class="op" id="7304431">:</span>&nbsp;<span class="string" id="7304433">&#34;no&nbsp;parts&#34;</span><span class="op" id="7304443">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304447">sep</span><span class="op" id="7304450">:</span>&nbsp;&nbsp;<span class="string" id="7304453">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="7304493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304497">in</span><span class="op" id="7304499">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7304503">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="7304551">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304555">want</span><span class="op" id="7304559">:</span>&nbsp;<span class="op" id="7304561">[</span><span class="op" id="7304562">]</span><span class="ident" id="7304563">headerBody</span><span class="op" id="7304573">{</span><span class="op" id="7304574">}</span><span class="op" id="7304575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304578">}</span><span class="op" id="7304579">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7304583">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304664">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304668">name</span><span class="op" id="7304672">:</span>&nbsp;<span class="string" id="7304674">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="7304698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304702">sep</span><span class="op" id="7304705">:</span>&nbsp;&nbsp;<span class="string" id="7304708">&#34;sep&#34;</span><span class="op" id="7304713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304717">in</span><span class="op" id="7304719">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7304723">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="7304770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304774">want</span><span class="op" id="7304778">:</span>&nbsp;<span class="op" id="7304780">[</span><span class="op" id="7304781">]</span><span class="ident" id="7304782">headerBody</span><span class="op" id="7304792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304797">{</span><span class="ident" id="7304798">textproto</span><span class="op" id="7304807">.</span><span class="ident" id="7304808">MIMEHeader</span><span class="op" id="7304818">{</span><span class="string" id="7304819">&#34;Foo&#34;</span><span class="op" id="7304824">:</span>&nbsp;<span class="op" id="7304826">{</span><span class="string" id="7304827">&#34;bar&#34;</span><span class="op" id="7304832">}</span><span class="op" id="7304833">}</span><span class="op" id="7304834">,</span>&nbsp;<span class="string" id="7304836">&#34;--sepFAKE&#34;</span><span class="op" id="7304847">}</span><span class="op" id="7304848">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304852">}</span><span class="op" id="7304853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304856">}</span><span class="op" id="7304857">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7304861">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304922">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304926">name</span><span class="op" id="7304930">:</span>&nbsp;<span class="string" id="7304932">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="7304958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304962">sep</span><span class="op" id="7304965">:</span>&nbsp;&nbsp;<span class="string" id="7304968">&#34;sep&#34;</span><span class="op" id="7304973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304977">in</span><span class="op" id="7304979">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7304983">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="7305026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305030">want</span><span class="op" id="7305034">:</span>&nbsp;<span class="op" id="7305036">[</span><span class="op" id="7305037">]</span><span class="ident" id="7305038">headerBody</span><span class="op" id="7305048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305053">{</span><span class="ident" id="7305054">textproto</span><span class="op" id="7305063">.</span><span class="ident" id="7305064">MIMEHeader</span><span class="op" id="7305074">{</span><span class="string" id="7305075">&#34;Foo&#34;</span><span class="op" id="7305080">:</span>&nbsp;<span class="op" id="7305082">{</span><span class="string" id="7305083">&#34;bar&#34;</span><span class="op" id="7305088">}</span><span class="op" id="7305089">}</span><span class="op" id="7305090">,</span>&nbsp;<span class="string" id="7305092">&#34;text&#34;</span><span class="op" id="7305098">}</span><span class="op" id="7305099">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305103">}</span><span class="op" id="7305104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305107">}</span><span class="op" id="7305108">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305112">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305143">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305147">name</span><span class="op" id="7305151">:</span>&nbsp;<span class="string" id="7305153">&#34;leading&nbsp;line&#34;</span><span class="op" id="7305167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305171">sep</span><span class="op" id="7305174">:</span>&nbsp;&nbsp;<span class="string" id="7305177">&#34;MyBoundary&#34;</span><span class="op" id="7305189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305193">in</span><span class="op" id="7305195">:</span>&nbsp;<span class="ident" id="7305197">strings</span><span class="op" id="7305204">.</span><span class="ident" id="7305205">Replace</span><span class="op" id="7305212">(</span><span class="string" id="7305213">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="7305306">,</span>&nbsp;<span class="string" id="7305308">&#34;\n&#34;</span><span class="op" id="7305312">,</span>&nbsp;<span class="string" id="7305314">&#34;\r\n&#34;</span><span class="op" id="7305320">,</span>&nbsp;<span class="op" id="7305322">-</span><span class="num" id="7305323">1</span><span class="op" id="7305324">)</span><span class="op" id="7305325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305329">want</span><span class="op" id="7305333">:</span>&nbsp;<span class="op" id="7305335">[</span><span class="op" id="7305336">]</span><span class="ident" id="7305337">headerBody</span><span class="op" id="7305347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305352">{</span><span class="ident" id="7305353">textproto</span><span class="op" id="7305362">.</span><span class="ident" id="7305363">MIMEHeader</span><span class="op" id="7305373">{</span><span class="string" id="7305374">&#34;Foo&#34;</span><span class="op" id="7305379">:</span>&nbsp;<span class="op" id="7305381">{</span><span class="string" id="7305382">&#34;bar&#34;</span><span class="op" id="7305387">}</span><span class="op" id="7305388">}</span><span class="op" id="7305389">,</span>&nbsp;<span class="string" id="7305391">&#34;&#34;</span><span class="op" id="7305393">}</span><span class="op" id="7305394">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305398">}</span><span class="op" id="7305399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305402">}</span><span class="op" id="7305403">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305407">roundTripParseTest</span><span class="op" id="7305425">(</span><span class="op" id="7305426">)</span><span class="op" id="7305427">,</span><br>
<span class="lineno"></span><span class="op" id="7305429">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="7305432">func</span>&nbsp;<span class="ident" id="7305437">TestParse</span><span class="op" id="7305446">(</span><span class="ident" id="7305447">t</span>&nbsp;<span class="op" id="7305449">*</span><span class="ident" id="7305450">testing</span><span class="op" id="7305457">.</span><span class="ident" id="7305458">T</span><span class="op" id="7305459">)</span>&nbsp;<span class="op" id="7305461">{</span><br>
<span class="lineno"></span><span class="ident" id="7305463">Cases</span><span class="op" id="7305468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305471">for</span>&nbsp;<span class="ident" id="7305475">_</span><span class="op" id="7305476">,</span>&nbsp;<span class="ident" id="7305478">tt</span>&nbsp;<span class="op" id="7305481">:=</span>&nbsp;<span class="keyword" id="7305484">range</span>&nbsp;<span class="ident" id="7305490">parseTests</span>&nbsp;<span class="op" id="7305501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305505">r</span>&nbsp;<span class="op" id="7305507">:=</span>&nbsp;<span class="ident" id="7305510">NewReader</span><span class="op" id="7305519">(</span><span class="ident" id="7305520">strings</span><span class="op" id="7305527">.</span><span class="ident" id="7305528">NewReader</span><span class="op" id="7305537">(</span><span class="ident" id="7305538">tt</span><span class="op" id="7305540">.</span><span class="ident" id="7305541">in</span><span class="op" id="7305543">)</span><span class="op" id="7305544">,</span>&nbsp;<span class="ident" id="7305546">tt</span><span class="op" id="7305548">.</span><span class="ident" id="7305549">sep</span><span class="op" id="7305552">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305556">got</span>&nbsp;<span class="op" id="7305560">:=</span>&nbsp;<span class="op" id="7305563">[</span><span class="op" id="7305564">]</span><span class="ident" id="7305565">headerBody</span><span class="op" id="7305575">{</span><span class="op" id="7305576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305580">for</span>&nbsp;<span class="op" id="7305584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305589">p</span><span class="op" id="7305590">,</span>&nbsp;<span class="ident" id="7305592">err</span>&nbsp;<span class="op" id="7305596">:=</span>&nbsp;<span class="ident" id="7305599">r</span><span class="op" id="7305600">.</span><span class="ident" id="7305601">NextPart</span><span class="op" id="7305609">(</span><span class="op" id="7305610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305615">if</span>&nbsp;<span class="ident" id="7305618">err</span>&nbsp;<span class="op" id="7305622">==</span>&nbsp;<span class="ident" id="7305625">io</span><span class="op" id="7305627">.</span><span class="ident" id="7305628">EOF</span>&nbsp;<span class="op" id="7305632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305638">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305652">if</span>&nbsp;<span class="ident" id="7305655">err</span>&nbsp;<span class="op" id="7305659">!=</span>&nbsp;<span class="ident" id="7305662">nil</span>&nbsp;<span class="op" id="7305666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305672">t</span><span class="op" id="7305673">.</span><span class="ident" id="7305674">Errorf</span><span class="op" id="7305680">(</span><span class="string" id="7305681">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="7305707">,</span>&nbsp;<span class="ident" id="7305709">tt</span><span class="op" id="7305711">.</span><span class="ident" id="7305712">name</span><span class="op" id="7305716">,</span>&nbsp;<span class="ident" id="7305718">err</span><span class="op" id="7305721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305727">continue</span>&nbsp;<span class="ident" id="7305736">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305745">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305750">pbody</span><span class="op" id="7305755">,</span>&nbsp;<span class="ident" id="7305757">err</span>&nbsp;<span class="op" id="7305761">:=</span>&nbsp;<span class="ident" id="7305764">ioutil</span><span class="op" id="7305770">.</span><span class="ident" id="7305771">ReadAll</span><span class="op" id="7305778">(</span><span class="ident" id="7305779">p</span><span class="op" id="7305780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305785">if</span>&nbsp;<span class="ident" id="7305788">err</span>&nbsp;<span class="op" id="7305792">!=</span>&nbsp;<span class="ident" id="7305795">nil</span>&nbsp;<span class="op" id="7305799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305805">t</span><span class="op" id="7305806">.</span><span class="ident" id="7305807">Errorf</span><span class="op" id="7305813">(</span><span class="string" id="7305814">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="7305850">,</span>&nbsp;<span class="ident" id="7305852">tt</span><span class="op" id="7305854">.</span><span class="ident" id="7305855">name</span><span class="op" id="7305859">,</span>&nbsp;<span class="ident" id="7305861">err</span><span class="op" id="7305864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305870">continue</span>&nbsp;<span class="ident" id="7305879">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305888">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305893">got</span>&nbsp;<span class="op" id="7305897">=</span>&nbsp;<span class="builtinfunc" id="7305899">append</span><span class="op" id="7305905">(</span><span class="ident" id="7305906">got</span><span class="op" id="7305909">,</span>&nbsp;<span class="ident" id="7305911">headerBody</span><span class="op" id="7305921">{</span><span class="ident" id="7305922">p</span><span class="op" id="7305923">.</span><span class="ident" id="7305924">Header</span><span class="op" id="7305930">,</span>&nbsp;<span class="builtintype" id="7305932">string</span><span class="op" id="7305938">(</span><span class="ident" id="7305939">pbody</span><span class="op" id="7305944">)</span><span class="op" id="7305945">}</span><span class="op" id="7305946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305954">if</span>&nbsp;<span class="op" id="7305957">!</span><span class="ident" id="7305958">reflect</span><span class="op" id="7305965">.</span><span class="ident" id="7305966">DeepEqual</span><span class="op" id="7305975">(</span><span class="ident" id="7305976">tt</span><span class="op" id="7305978">.</span><span class="ident" id="7305979">want</span><span class="op" id="7305983">,</span>&nbsp;<span class="ident" id="7305985">got</span><span class="op" id="7305988">)</span>&nbsp;<span class="op" id="7305990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305995">t</span><span class="op" id="7305996">.</span><span class="ident" id="7305997">Errorf</span><span class="op" id="7306003">(</span><span class="string" id="7306004">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7306034">,</span>&nbsp;<span class="ident" id="7306036">tt</span><span class="op" id="7306038">.</span><span class="ident" id="7306039">name</span><span class="op" id="7306043">,</span>&nbsp;<span class="ident" id="7306045">got</span><span class="op" id="7306048">,</span>&nbsp;<span class="ident" id="7306050">tt</span><span class="op" id="7306052">.</span><span class="ident" id="7306053">want</span><span class="op" id="7306057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306062">if</span>&nbsp;<span class="builtinfunc" id="7306065">len</span><span class="op" id="7306068">(</span><span class="ident" id="7306069">tt</span><span class="op" id="7306071">.</span><span class="ident" id="7306072">want</span><span class="op" id="7306076">)</span>&nbsp;<span class="op" id="7306078">!=</span>&nbsp;<span class="builtinfunc" id="7306081">len</span><span class="op" id="7306084">(</span><span class="ident" id="7306085">got</span><span class="op" id="7306088">)</span>&nbsp;<span class="op" id="7306090">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306096">t</span><span class="op" id="7306097">.</span><span class="ident" id="7306098">Errorf</span><span class="op" id="7306104">(</span><span class="string" id="7306105">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7306137">,</span>&nbsp;<span class="ident" id="7306139">tt</span><span class="op" id="7306141">.</span><span class="ident" id="7306142">name</span><span class="op" id="7306146">,</span>&nbsp;<span class="builtinfunc" id="7306148">len</span><span class="op" id="7306151">(</span><span class="ident" id="7306152">got</span><span class="op" id="7306155">)</span><span class="op" id="7306156">,</span>&nbsp;<span class="builtinfunc" id="7306158">len</span><span class="op" id="7306161">(</span><span class="ident" id="7306162">tt</span><span class="op" id="7306164">.</span><span class="ident" id="7306165">want</span><span class="op" id="7306169">)</span><span class="op" id="7306170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306175">}</span>&nbsp;<span class="keyword" id="7306177">else</span>&nbsp;<span class="keyword" id="7306182">if</span>&nbsp;<span class="builtinfunc" id="7306185">len</span><span class="op" id="7306188">(</span><span class="ident" id="7306189">got</span><span class="op" id="7306192">)</span>&nbsp;<span class="op" id="7306194">&gt;</span>&nbsp;<span class="num" id="7306196">1</span>&nbsp;<span class="op" id="7306198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306204">for</span>&nbsp;<span class="ident" id="7306208">pi</span><span class="op" id="7306210">,</span>&nbsp;<span class="ident" id="7306212">wantPart</span>&nbsp;<span class="op" id="7306221">:=</span>&nbsp;<span class="keyword" id="7306224">range</span>&nbsp;<span class="ident" id="7306230">tt</span><span class="op" id="7306232">.</span><span class="ident" id="7306233">want</span>&nbsp;<span class="op" id="7306238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306245">if</span>&nbsp;<span class="op" id="7306248">!</span><span class="ident" id="7306249">reflect</span><span class="op" id="7306256">.</span><span class="ident" id="7306257">DeepEqual</span><span class="op" id="7306266">(</span><span class="ident" id="7306267">wantPart</span><span class="op" id="7306275">,</span>&nbsp;<span class="ident" id="7306277">got</span><span class="op" id="7306280">[</span><span class="ident" id="7306281">pi</span><span class="op" id="7306283">]</span><span class="op" id="7306284">)</span>&nbsp;<span class="op" id="7306286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306294">t</span><span class="op" id="7306295">.</span><span class="ident" id="7306296">Errorf</span><span class="op" id="7306302">(</span><span class="string" id="7306303">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="7306342">,</span>&nbsp;<span class="ident" id="7306344">tt</span><span class="op" id="7306346">.</span><span class="ident" id="7306347">name</span><span class="op" id="7306351">,</span>&nbsp;<span class="ident" id="7306353">pi</span><span class="op" id="7306355">,</span>&nbsp;<span class="ident" id="7306357">got</span><span class="op" id="7306360">[</span><span class="ident" id="7306361">pi</span><span class="op" id="7306363">]</span><span class="op" id="7306364">,</span>&nbsp;<span class="ident" id="7306366">wantPart</span><span class="op" id="7306374">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306399">}</span><br>
<span class="lineno">605</span><span class="op" id="7306401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7306404">func</span>&nbsp;<span class="ident" id="7306409">roundTripParseTest</span><span class="op" id="7306427">(</span><span class="op" id="7306428">)</span>&nbsp;<span class="ident" id="7306430">parseTest</span>&nbsp;<span class="op" id="7306440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306443">t</span>&nbsp;<span class="op" id="7306445">:=</span>&nbsp;<span class="ident" id="7306448">parseTest</span><span class="op" id="7306457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306461">name</span><span class="op" id="7306465">:</span>&nbsp;<span class="string" id="7306467">&#34;round&nbsp;trip&#34;</span><span class="op" id="7306479">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306483">want</span><span class="op" id="7306487">:</span>&nbsp;<span class="op" id="7306489">[</span><span class="op" id="7306490">]</span><span class="ident" id="7306491">headerBody</span><span class="op" id="7306501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306506">formData</span><span class="op" id="7306514">(</span><span class="string" id="7306515">&#34;empty&#34;</span><span class="op" id="7306522">,</span>&nbsp;<span class="string" id="7306524">&#34;&#34;</span><span class="op" id="7306526">)</span><span class="op" id="7306527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306532">formData</span><span class="op" id="7306540">(</span><span class="string" id="7306541">&#34;lf&#34;</span><span class="op" id="7306545">,</span>&nbsp;<span class="string" id="7306547">&#34;\n&#34;</span><span class="op" id="7306551">)</span><span class="op" id="7306552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306557">formData</span><span class="op" id="7306565">(</span><span class="string" id="7306566">&#34;cr&#34;</span><span class="op" id="7306570">,</span>&nbsp;<span class="string" id="7306572">&#34;\r&#34;</span><span class="op" id="7306576">)</span><span class="op" id="7306577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306582">formData</span><span class="op" id="7306590">(</span><span class="string" id="7306591">&#34;crlf&#34;</span><span class="op" id="7306597">,</span>&nbsp;<span class="string" id="7306599">&#34;\r\n&#34;</span><span class="op" id="7306605">)</span><span class="op" id="7306606">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306611">formData</span><span class="op" id="7306619">(</span><span class="string" id="7306620">&#34;foo&#34;</span><span class="op" id="7306625">,</span>&nbsp;<span class="string" id="7306627">&#34;bar&#34;</span><span class="op" id="7306632">)</span><span class="op" id="7306633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306637">}</span><span class="op" id="7306638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306644">var</span>&nbsp;<span class="ident" id="7306648">buf</span>&nbsp;<span class="ident" id="7306652">bytes</span><span class="op" id="7306657">.</span><span class="ident" id="7306658">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306666">w</span>&nbsp;<span class="op" id="7306668">:=</span>&nbsp;<span class="ident" id="7306671">NewWriter</span><span class="op" id="7306680">(</span><span class="op" id="7306681">&amp;</span><span class="ident" id="7306682">buf</span><span class="op" id="7306685">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306688">for</span>&nbsp;<span class="ident" id="7306692">_</span><span class="op" id="7306693">,</span>&nbsp;<span class="ident" id="7306695">p</span>&nbsp;<span class="op" id="7306697">:=</span>&nbsp;<span class="keyword" id="7306700">range</span>&nbsp;<span class="ident" id="7306706">t</span><span class="op" id="7306707">.</span><span class="ident" id="7306708">want</span>&nbsp;<span class="op" id="7306713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306717">pw</span><span class="op" id="7306719">,</span>&nbsp;<span class="ident" id="7306721">err</span>&nbsp;<span class="op" id="7306725">:=</span>&nbsp;<span class="ident" id="7306728">w</span><span class="op" id="7306729">.</span><span class="ident" id="7306730">CreatePart</span><span class="op" id="7306740">(</span><span class="ident" id="7306741">p</span><span class="op" id="7306742">.</span><span class="ident" id="7306743">header</span><span class="op" id="7306749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306753">if</span>&nbsp;<span class="ident" id="7306756">err</span>&nbsp;<span class="op" id="7306760">!=</span>&nbsp;<span class="ident" id="7306763">nil</span>&nbsp;<span class="op" id="7306767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7306772">panic</span><span class="op" id="7306777">(</span><span class="ident" id="7306778">err</span><span class="op" id="7306781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306785">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306789">_</span><span class="op" id="7306790">,</span>&nbsp;<span class="ident" id="7306792">err</span>&nbsp;<span class="op" id="7306796">=</span>&nbsp;<span class="ident" id="7306798">pw</span><span class="op" id="7306800">.</span><span class="ident" id="7306801">Write</span><span class="op" id="7306806">(</span><span class="op" id="7306807">[</span><span class="op" id="7306808">]</span><span class="builtintype" id="7306809">byte</span><span class="op" id="7306813">(</span><span class="ident" id="7306814">p</span><span class="op" id="7306815">.</span><span class="ident" id="7306816">body</span><span class="op" id="7306820">)</span><span class="op" id="7306821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306825">if</span>&nbsp;<span class="ident" id="7306828">err</span>&nbsp;<span class="op" id="7306832">!=</span>&nbsp;<span class="ident" id="7306835">nil</span>&nbsp;<span class="op" id="7306839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7306844">panic</span><span class="op" id="7306849">(</span><span class="ident" id="7306850">err</span><span class="op" id="7306853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306860">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306863">w</span><span class="op" id="7306864">.</span><span class="ident" id="7306865">Close</span><span class="op" id="7306870">(</span><span class="op" id="7306871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306874">t</span><span class="op" id="7306875">.</span><span class="ident" id="7306876">in</span>&nbsp;<span class="op" id="7306879">=</span>&nbsp;<span class="ident" id="7306881">buf</span><span class="op" id="7306884">.</span><span class="ident" id="7306885">String</span><span class="op" id="7306891">(</span><span class="op" id="7306892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306895">t</span><span class="op" id="7306896">.</span><span class="ident" id="7306897">sep</span>&nbsp;<span class="op" id="7306901">=</span>&nbsp;<span class="ident" id="7306903">w</span><span class="op" id="7306904">.</span><span class="ident" id="7306905">Boundary</span><span class="op" id="7306913">(</span><span class="op" id="7306914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306917">return</span>&nbsp;<span class="ident" id="7306924">t</span><br>
<span class="lineno"></span><span class="op" id="7306926">}</span>
</div>
</body>
</html>
