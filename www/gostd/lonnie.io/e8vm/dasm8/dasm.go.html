<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/dasm8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/dasm.go.html">dasm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/line.go.html">line.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/dasm8/reg.go.html">reg.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="5535299">package</span>&nbsp;<span class="ident" id="5535307">dasm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5535314">import</span>&nbsp;<span class="op" id="5535321">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5535324">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5535332">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><span class="op" id="5535350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5535353">//&nbsp;Dasm&nbsp;disassembles&nbsp;a&nbsp;byte&nbsp;block.</span><br>
<span class="lineno">10</span><span class="keyword" id="5535388">func</span>&nbsp;<span class="ident" id="5535393">Dasm</span><span class="op" id="5535397">(</span><span class="ident" id="5535398">bs</span>&nbsp;<span class="op" id="5535401">[</span><span class="op" id="5535402">]</span><span class="builtintype" id="5535403">byte</span><span class="op" id="5535407">,</span>&nbsp;<span class="ident" id="5535409">addr</span>&nbsp;<span class="builtintype" id="5535414">uint32</span><span class="op" id="5535420">)</span>&nbsp;<span class="op" id="5535422">[</span><span class="op" id="5535423">]</span><span class="op" id="5535424">*</span><span class="ident" id="5535425">Line</span>&nbsp;<span class="op" id="5535430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535433">var</span>&nbsp;<span class="ident" id="5535437">ret</span>&nbsp;<span class="op" id="5535441">[</span><span class="op" id="5535442">]</span><span class="op" id="5535443">*</span><span class="ident" id="5535444">Line</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535451">base</span>&nbsp;<span class="op" id="5535456">:=</span>&nbsp;<span class="ident" id="5535459">addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535466">add</span>&nbsp;<span class="op" id="5535470">:=</span>&nbsp;<span class="keyword" id="5535473">func</span><span class="op" id="5535477">(</span><span class="ident" id="5535478">b</span>&nbsp;<span class="op" id="5535480">[</span><span class="op" id="5535481">]</span><span class="builtintype" id="5535482">byte</span><span class="op" id="5535486">)</span>&nbsp;<span class="op" id="5535488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535492">inst</span>&nbsp;<span class="op" id="5535497">:=</span>&nbsp;<span class="ident" id="5535500">binary</span><span class="op" id="5535506">.</span><span class="ident" id="5535507">LittleEndian</span><span class="op" id="5535519">.</span><span class="ident" id="5535520">Uint32</span><span class="op" id="5535526">(</span><span class="ident" id="5535527">b</span><span class="op" id="5535528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535532">ret</span>&nbsp;<span class="op" id="5535536">=</span>&nbsp;<span class="builtinfunc" id="5535538">append</span><span class="op" id="5535544">(</span><span class="ident" id="5535545">ret</span><span class="op" id="5535548">,</span>&nbsp;<span class="ident" id="5535550">NewLine</span><span class="op" id="5535557">(</span><span class="ident" id="5535558">addr</span><span class="op" id="5535562">,</span>&nbsp;<span class="ident" id="5535564">inst</span><span class="op" id="5535568">)</span><span class="op" id="5535569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535573">addr</span>&nbsp;<span class="op" id="5535578">+=</span>&nbsp;<span class="num" id="5535581">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535584">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535588">nline</span>&nbsp;<span class="op" id="5535594">:=</span>&nbsp;<span class="builtinfunc" id="5535597">len</span><span class="op" id="5535600">(</span><span class="ident" id="5535601">bs</span><span class="op" id="5535603">)</span>&nbsp;<span class="op" id="5535605">/</span>&nbsp;<span class="num" id="5535607">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535610">for</span>&nbsp;<span class="ident" id="5535614">i</span>&nbsp;<span class="op" id="5535616">:=</span>&nbsp;<span class="num" id="5535619">0</span><span class="op" id="5535620">;</span>&nbsp;<span class="ident" id="5535622">i</span>&nbsp;<span class="op" id="5535624">&lt;</span>&nbsp;<span class="ident" id="5535626">nline</span><span class="op" id="5535631">;</span>&nbsp;<span class="ident" id="5535633">i</span><span class="op" id="5535634">++</span>&nbsp;<span class="op" id="5535637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535641">off</span>&nbsp;<span class="op" id="5535645">:=</span>&nbsp;<span class="ident" id="5535648">i</span>&nbsp;<span class="op" id="5535650">*</span>&nbsp;<span class="num" id="5535652">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535656">add</span><span class="op" id="5535659">(</span><span class="ident" id="5535660">bs</span><span class="op" id="5535662">[</span><span class="ident" id="5535663">off</span>&nbsp;<span class="op" id="5535667">:</span>&nbsp;<span class="ident" id="5535669">off</span><span class="op" id="5535672">+</span><span class="num" id="5535673">4</span><span class="op" id="5535674">]</span><span class="op" id="5535675">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535682">//&nbsp;residue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535694">if</span>&nbsp;<span class="builtinfunc" id="5535697">len</span><span class="op" id="5535700">(</span><span class="ident" id="5535701">bs</span><span class="op" id="5535703">)</span><span class="op" id="5535704">%</span><span class="num" id="5535705">4</span>&nbsp;<span class="op" id="5535707">!=</span>&nbsp;<span class="num" id="5535710">0</span>&nbsp;<span class="op" id="5535712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535716">var</span>&nbsp;<span class="ident" id="5535720">buf</span>&nbsp;<span class="op" id="5535724">[</span><span class="num" id="5535725">4</span><span class="op" id="5535726">]</span><span class="builtintype" id="5535727">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5535734">copy</span><span class="op" id="5535738">(</span><span class="ident" id="5535739">buf</span><span class="op" id="5535742">[</span><span class="op" id="5535743">:</span><span class="op" id="5535744">]</span><span class="op" id="5535745">,</span>&nbsp;<span class="ident" id="5535747">bs</span><span class="op" id="5535749">[</span><span class="ident" id="5535750">nline</span><span class="op" id="5535755">*</span><span class="num" id="5535756">4</span><span class="op" id="5535757">:</span><span class="op" id="5535758">]</span><span class="op" id="5535759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535763">add</span><span class="op" id="5535766">(</span><span class="ident" id="5535767">buf</span><span class="op" id="5535770">[</span><span class="op" id="5535771">:</span><span class="op" id="5535772">]</span><span class="op" id="5535773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5535780">//&nbsp;link&nbsp;the&nbsp;jumps</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535799">for</span>&nbsp;<span class="ident" id="5535803">_</span><span class="op" id="5535804">,</span>&nbsp;<span class="ident" id="5535806">line</span>&nbsp;<span class="op" id="5535811">:=</span>&nbsp;<span class="keyword" id="5535814">range</span>&nbsp;<span class="ident" id="5535820">ret</span>&nbsp;<span class="op" id="5535824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535828">if</span>&nbsp;<span class="op" id="5535831">!</span><span class="ident" id="5535832">line</span><span class="op" id="5535836">.</span><span class="ident" id="5535837">IsJump</span>&nbsp;<span class="op" id="5535844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535849">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535865">index</span>&nbsp;<span class="op" id="5535871">:=</span>&nbsp;<span class="builtintype" id="5535874">int</span><span class="op" id="5535877">(</span><span class="ident" id="5535878">line</span><span class="op" id="5535882">.</span><span class="ident" id="5535883">To</span><span class="op" id="5535885">-</span><span class="ident" id="5535886">base</span><span class="op" id="5535890">)</span>&nbsp;<span class="op" id="5535892">/</span>&nbsp;<span class="num" id="5535894">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535898">if</span>&nbsp;<span class="ident" id="5535901">index</span>&nbsp;<span class="op" id="5535907">&gt;=</span>&nbsp;<span class="num" id="5535910">0</span>&nbsp;<span class="op" id="5535912">&amp;&amp;</span>&nbsp;<span class="ident" id="5535915">index</span>&nbsp;<span class="op" id="5535921">&lt;</span>&nbsp;<span class="ident" id="5535923">nline</span>&nbsp;<span class="op" id="5535929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5535934">line</span><span class="op" id="5535938">.</span><span class="ident" id="5535939">ToLine</span>&nbsp;<span class="op" id="5535946">=</span>&nbsp;<span class="ident" id="5535948">ret</span><span class="op" id="5535951">[</span><span class="ident" id="5535952">index</span><span class="op" id="5535957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5535964">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5535968">return</span>&nbsp;<span class="ident" id="5535975">ret</span><br>
<span class="lineno"></span><span class="op" id="5535979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5535982">//&nbsp;Print&nbsp;prints&nbsp;a&nbsp;byte&nbsp;block&nbsp;as&nbsp;assembly&nbsp;lines.</span><br>
<span class="lineno">50</span><span class="keyword" id="5536030">func</span>&nbsp;<span class="ident" id="5536035">Print</span><span class="op" id="5536040">(</span><span class="ident" id="5536041">bs</span>&nbsp;<span class="op" id="5536044">[</span><span class="op" id="5536045">]</span><span class="builtintype" id="5536046">byte</span><span class="op" id="5536050">,</span>&nbsp;<span class="ident" id="5536052">addr</span>&nbsp;<span class="builtintype" id="5536057">uint32</span><span class="op" id="5536063">)</span>&nbsp;<span class="op" id="5536065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536068">lines</span>&nbsp;<span class="op" id="5536074">:=</span>&nbsp;<span class="ident" id="5536077">Dasm</span><span class="op" id="5536081">(</span><span class="ident" id="5536082">bs</span><span class="op" id="5536084">,</span>&nbsp;<span class="ident" id="5536086">addr</span><span class="op" id="5536090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5536094">for</span>&nbsp;<span class="ident" id="5536098">_</span><span class="op" id="5536099">,</span>&nbsp;<span class="ident" id="5536101">line</span>&nbsp;<span class="op" id="5536106">:=</span>&nbsp;<span class="keyword" id="5536109">range</span>&nbsp;<span class="ident" id="5536115">lines</span>&nbsp;<span class="op" id="5536121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5536125">fmt</span><span class="op" id="5536128">.</span><span class="ident" id="5536129">Println</span><span class="op" id="5536136">(</span><span class="ident" id="5536137">line</span><span class="op" id="5536141">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5536144">}</span><br>
<span class="lineno"></span><span class="op" id="5536146">}</span>
</div>
</body>
</html>
