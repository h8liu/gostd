<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5393620">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5393675">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5393729">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5393780">//&nbsp;Package&nbsp;image&nbsp;implements&nbsp;a&nbsp;basic&nbsp;2-D&nbsp;image&nbsp;library.</span><br>
<span class="lineno"></span><span class="comment" id="5393835">//</span><br>
<span class="lineno"></span><span class="comment" id="5393838">//&nbsp;The&nbsp;fundamental&nbsp;interface&nbsp;is&nbsp;called&nbsp;Image.&nbsp;An&nbsp;Image&nbsp;contains&nbsp;colors,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="5393916">//&nbsp;are&nbsp;described&nbsp;in&nbsp;the&nbsp;image/color&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="5393961">//</span><br>
<span class="lineno">10</span><span class="comment" id="5393964">//&nbsp;Values&nbsp;of&nbsp;the&nbsp;Image&nbsp;interface&nbsp;are&nbsp;created&nbsp;either&nbsp;by&nbsp;calling&nbsp;functions&nbsp;such</span><br>
<span class="lineno"></span><span class="comment" id="5394042">//&nbsp;as&nbsp;NewRGBA&nbsp;and&nbsp;NewPaletted,&nbsp;or&nbsp;by&nbsp;calling&nbsp;Decode&nbsp;on&nbsp;an&nbsp;io.Reader&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="5394121">//&nbsp;image&nbsp;data&nbsp;in&nbsp;a&nbsp;format&nbsp;such&nbsp;as&nbsp;GIF,&nbsp;JPEG&nbsp;or&nbsp;PNG.&nbsp;Decoding&nbsp;any&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="5394197">//&nbsp;image&nbsp;format&nbsp;requires&nbsp;the&nbsp;prior&nbsp;registration&nbsp;of&nbsp;a&nbsp;decoder&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5394268">//&nbsp;Registration&nbsp;is&nbsp;typically&nbsp;automatic&nbsp;as&nbsp;a&nbsp;side&nbsp;effect&nbsp;of&nbsp;initializing&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="5394345">//&nbsp;format&#39;s&nbsp;package&nbsp;so&nbsp;that,&nbsp;to&nbsp;decode&nbsp;a&nbsp;PNG&nbsp;image,&nbsp;it&nbsp;suffices&nbsp;to&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5394417">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;image/png&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5394441">//&nbsp;in&nbsp;a&nbsp;program&#39;s&nbsp;main&nbsp;package.&nbsp;The&nbsp;_&nbsp;means&nbsp;to&nbsp;import&nbsp;a&nbsp;package&nbsp;purely&nbsp;for&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5394520">//&nbsp;initialization&nbsp;side&nbsp;effects.</span><br>
<span class="lineno"></span><span class="comment" id="5394552">//</span><br>
<span class="lineno">20</span><span class="comment" id="5394555">//&nbsp;See&nbsp;&#34;The&nbsp;Go&nbsp;image&nbsp;package&#34;&nbsp;for&nbsp;more&nbsp;details:</span><br>
<span class="lineno"></span><span class="comment" id="5394603">//&nbsp;http://golang.org/doc/articles/image_package.html</span><br>
<span class="lineno"></span><span class="keyword" id="5394656">package</span>&nbsp;<span class="ident" id="5394664">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5394671">import</span>&nbsp;<span class="op" id="5394678">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5394681">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5394695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5394698">//&nbsp;Config&nbsp;holds&nbsp;an&nbsp;image&#39;s&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions.</span><br>
<span class="lineno"></span><span class="keyword" id="5394753">type</span>&nbsp;<span class="ident" id="5394758">Config</span>&nbsp;<span class="keyword" id="5394765">struct</span>&nbsp;<span class="op" id="5394772">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394775">ColorModel</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5394789">color</span><span class="op" id="5394794">.</span><span class="ident" id="5394795">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394802">Width</span><span class="op" id="5394807">,</span>&nbsp;<span class="ident" id="5394809">Height</span>&nbsp;<span class="builtintype" id="5394816">int</span><br>
<span class="lineno"></span><span class="op" id="5394820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5394823">//&nbsp;Image&nbsp;is&nbsp;a&nbsp;finite&nbsp;rectangular&nbsp;grid&nbsp;of&nbsp;color.Color&nbsp;values&nbsp;taken&nbsp;from&nbsp;a&nbsp;color</span><br>
<span class="lineno">35</span><span class="comment" id="5394902">//&nbsp;model.</span><br>
<span class="lineno"></span><span class="keyword" id="5394912">type</span>&nbsp;<span class="ident" id="5394917">Image</span>&nbsp;<span class="keyword" id="5394923">interface</span>&nbsp;<span class="op" id="5394933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394936">//&nbsp;ColorModel&nbsp;returns&nbsp;the&nbsp;Image&#39;s&nbsp;color&nbsp;model.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394984">ColorModel</span><span class="op" id="5394994">(</span><span class="op" id="5394995">)</span>&nbsp;<span class="ident" id="5394997">color</span><span class="op" id="5395002">.</span><span class="ident" id="5395003">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395010">//&nbsp;Bounds&nbsp;returns&nbsp;the&nbsp;domain&nbsp;for&nbsp;which&nbsp;At&nbsp;can&nbsp;return&nbsp;non-zero&nbsp;color.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395080">//&nbsp;The&nbsp;bounds&nbsp;do&nbsp;not&nbsp;necessarily&nbsp;contain&nbsp;the&nbsp;point&nbsp;(0,&nbsp;0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395140">Bounds</span><span class="op" id="5395146">(</span><span class="op" id="5395147">)</span>&nbsp;<span class="ident" id="5395149">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395160">//&nbsp;At&nbsp;returns&nbsp;the&nbsp;color&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395209">//&nbsp;At(Bounds().Min.X,&nbsp;Bounds().Min.Y)&nbsp;returns&nbsp;the&nbsp;upper-left&nbsp;pixel&nbsp;of&nbsp;the&nbsp;grid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395290">//&nbsp;At(Bounds().Max.X-1,&nbsp;Bounds().Max.Y-1)&nbsp;returns&nbsp;the&nbsp;lower-right&nbsp;one.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395362">At</span><span class="op" id="5395364">(</span><span class="ident" id="5395365">x</span><span class="op" id="5395366">,</span>&nbsp;<span class="ident" id="5395368">y</span>&nbsp;<span class="builtintype" id="5395370">int</span><span class="op" id="5395373">)</span>&nbsp;<span class="ident" id="5395375">color</span><span class="op" id="5395380">.</span><span class="ident" id="5395381">Color</span><br>
<span class="lineno"></span><span class="op" id="5395387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5395390">//&nbsp;PalettedImage&nbsp;is&nbsp;an&nbsp;image&nbsp;whose&nbsp;colors&nbsp;may&nbsp;come&nbsp;from&nbsp;a&nbsp;limited&nbsp;palette.</span><br>
<span class="lineno"></span><span class="comment" id="5395465">//&nbsp;If&nbsp;m&nbsp;is&nbsp;a&nbsp;PalettedImage&nbsp;and&nbsp;m.ColorModel()&nbsp;returns&nbsp;a&nbsp;PalettedColorModel&nbsp;p,</span><br>
<span class="lineno">50</span><span class="comment" id="5395543">//&nbsp;then&nbsp;m.At(x,&nbsp;y)&nbsp;should&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;p[m.ColorIndexAt(x,&nbsp;y)].&nbsp;If&nbsp;m&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5395618">//&nbsp;color&nbsp;model&nbsp;is&nbsp;not&nbsp;a&nbsp;PalettedColorModel,&nbsp;then&nbsp;ColorIndexAt&#39;s&nbsp;behavior&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5395694">//&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="keyword" id="5395708">type</span>&nbsp;<span class="ident" id="5395713">PalettedImage</span>&nbsp;<span class="keyword" id="5395727">interface</span>&nbsp;<span class="op" id="5395737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395740">//&nbsp;ColorIndexAt&nbsp;returns&nbsp;the&nbsp;palette&nbsp;index&nbsp;of&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395807">ColorIndexAt</span><span class="op" id="5395819">(</span><span class="ident" id="5395820">x</span><span class="op" id="5395821">,</span>&nbsp;<span class="ident" id="5395823">y</span>&nbsp;<span class="builtintype" id="5395825">int</span><span class="op" id="5395828">)</span>&nbsp;<span class="builtintype" id="5395830">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395837">Image</span><br>
<span class="lineno"></span><span class="op" id="5395843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5395846">//&nbsp;RGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA&nbsp;values.</span><br>
<span class="lineno">60</span><span class="keyword" id="5395919">type</span>&nbsp;<span class="ident" id="5395924">RGBA</span>&nbsp;<span class="keyword" id="5395929">struct</span>&nbsp;<span class="op" id="5395936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395939">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396007">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396075">Pix</span>&nbsp;<span class="op" id="5396079">[</span><span class="op" id="5396080">]</span><span class="builtintype" id="5396081">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396088">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396164">Stride</span>&nbsp;<span class="builtintype" id="5396171">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5396176">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396208">Rect</span>&nbsp;<span class="ident" id="5396213">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5396223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="5396226">func</span>&nbsp;<span class="op" id="5396231">(</span><span class="ident" id="5396232">p</span>&nbsp;<span class="op" id="5396234">*</span><span class="ident" id="5396235">RGBA</span><span class="op" id="5396239">)</span>&nbsp;<span class="ident" id="5396241">ColorModel</span><span class="op" id="5396251">(</span><span class="op" id="5396252">)</span>&nbsp;<span class="ident" id="5396254">color</span><span class="op" id="5396259">.</span><span class="ident" id="5396260">Model</span>&nbsp;<span class="op" id="5396266">{</span>&nbsp;<span class="keyword" id="5396268">return</span>&nbsp;<span class="ident" id="5396275">color</span><span class="op" id="5396280">.</span><span class="ident" id="5396281">RGBAModel</span>&nbsp;<span class="op" id="5396291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396294">func</span>&nbsp;<span class="op" id="5396299">(</span><span class="ident" id="5396300">p</span>&nbsp;<span class="op" id="5396302">*</span><span class="ident" id="5396303">RGBA</span><span class="op" id="5396307">)</span>&nbsp;<span class="ident" id="5396309">Bounds</span><span class="op" id="5396315">(</span><span class="op" id="5396316">)</span>&nbsp;<span class="ident" id="5396318">Rectangle</span>&nbsp;<span class="op" id="5396328">{</span>&nbsp;<span class="keyword" id="5396330">return</span>&nbsp;<span class="ident" id="5396337">p</span><span class="op" id="5396338">.</span><span class="ident" id="5396339">Rect</span>&nbsp;<span class="op" id="5396344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396347">func</span>&nbsp;<span class="op" id="5396352">(</span><span class="ident" id="5396353">p</span>&nbsp;<span class="op" id="5396355">*</span><span class="ident" id="5396356">RGBA</span><span class="op" id="5396360">)</span>&nbsp;<span class="ident" id="5396362">At</span><span class="op" id="5396364">(</span><span class="ident" id="5396365">x</span><span class="op" id="5396366">,</span>&nbsp;<span class="ident" id="5396368">y</span>&nbsp;<span class="builtintype" id="5396370">int</span><span class="op" id="5396373">)</span>&nbsp;<span class="ident" id="5396375">color</span><span class="op" id="5396380">.</span><span class="ident" id="5396381">Color</span>&nbsp;<span class="op" id="5396387">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396390">return</span>&nbsp;<span class="ident" id="5396397">p</span><span class="op" id="5396398">.</span><span class="ident" id="5396399">RGBAAt</span><span class="op" id="5396405">(</span><span class="ident" id="5396406">x</span><span class="op" id="5396407">,</span>&nbsp;<span class="ident" id="5396409">y</span><span class="op" id="5396410">)</span><br>
<span class="lineno"></span><span class="op" id="5396412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396415">func</span>&nbsp;<span class="op" id="5396420">(</span><span class="ident" id="5396421">p</span>&nbsp;<span class="op" id="5396423">*</span><span class="ident" id="5396424">RGBA</span><span class="op" id="5396428">)</span>&nbsp;<span class="ident" id="5396430">RGBAAt</span><span class="op" id="5396436">(</span><span class="ident" id="5396437">x</span><span class="op" id="5396438">,</span>&nbsp;<span class="ident" id="5396440">y</span>&nbsp;<span class="builtintype" id="5396442">int</span><span class="op" id="5396445">)</span>&nbsp;<span class="ident" id="5396447">color</span><span class="op" id="5396452">.</span><span class="ident" id="5396453">RGBA</span>&nbsp;<span class="op" id="5396458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396461">if</span>&nbsp;<span class="op" id="5396464">!</span><span class="op" id="5396465">(</span><span class="ident" id="5396466">Point</span><span class="op" id="5396471">{</span><span class="ident" id="5396472">x</span><span class="op" id="5396473">,</span>&nbsp;<span class="ident" id="5396475">y</span><span class="op" id="5396476">}</span><span class="op" id="5396477">.</span><span class="ident" id="5396478">In</span><span class="op" id="5396480">(</span><span class="ident" id="5396481">p</span><span class="op" id="5396482">.</span><span class="ident" id="5396483">Rect</span><span class="op" id="5396487">)</span><span class="op" id="5396488">)</span>&nbsp;<span class="op" id="5396490">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396494">return</span>&nbsp;<span class="ident" id="5396501">color</span><span class="op" id="5396506">.</span><span class="ident" id="5396507">RGBA</span><span class="op" id="5396511">{</span><span class="op" id="5396512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396518">i</span>&nbsp;<span class="op" id="5396520">:=</span>&nbsp;<span class="ident" id="5396523">p</span><span class="op" id="5396524">.</span><span class="ident" id="5396525">PixOffset</span><span class="op" id="5396534">(</span><span class="ident" id="5396535">x</span><span class="op" id="5396536">,</span>&nbsp;<span class="ident" id="5396538">y</span><span class="op" id="5396539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396542">return</span>&nbsp;<span class="ident" id="5396549">color</span><span class="op" id="5396554">.</span><span class="ident" id="5396555">RGBA</span><span class="op" id="5396559">{</span><span class="ident" id="5396560">p</span><span class="op" id="5396561">.</span><span class="ident" id="5396562">Pix</span><span class="op" id="5396565">[</span><span class="ident" id="5396566">i</span><span class="op" id="5396567">+</span><span class="num" id="5396568">0</span><span class="op" id="5396569">]</span><span class="op" id="5396570">,</span>&nbsp;<span class="ident" id="5396572">p</span><span class="op" id="5396573">.</span><span class="ident" id="5396574">Pix</span><span class="op" id="5396577">[</span><span class="ident" id="5396578">i</span><span class="op" id="5396579">+</span><span class="num" id="5396580">1</span><span class="op" id="5396581">]</span><span class="op" id="5396582">,</span>&nbsp;<span class="ident" id="5396584">p</span><span class="op" id="5396585">.</span><span class="ident" id="5396586">Pix</span><span class="op" id="5396589">[</span><span class="ident" id="5396590">i</span><span class="op" id="5396591">+</span><span class="num" id="5396592">2</span><span class="op" id="5396593">]</span><span class="op" id="5396594">,</span>&nbsp;<span class="ident" id="5396596">p</span><span class="op" id="5396597">.</span><span class="ident" id="5396598">Pix</span><span class="op" id="5396601">[</span><span class="ident" id="5396602">i</span><span class="op" id="5396603">+</span><span class="num" id="5396604">3</span><span class="op" id="5396605">]</span><span class="op" id="5396606">}</span><br>
<span class="lineno"></span><span class="op" id="5396608">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5396611">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5396690">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5396714">func</span>&nbsp;<span class="op" id="5396719">(</span><span class="ident" id="5396720">p</span>&nbsp;<span class="op" id="5396722">*</span><span class="ident" id="5396723">RGBA</span><span class="op" id="5396727">)</span>&nbsp;<span class="ident" id="5396729">PixOffset</span><span class="op" id="5396738">(</span><span class="ident" id="5396739">x</span><span class="op" id="5396740">,</span>&nbsp;<span class="ident" id="5396742">y</span>&nbsp;<span class="builtintype" id="5396744">int</span><span class="op" id="5396747">)</span>&nbsp;<span class="builtintype" id="5396749">int</span>&nbsp;<span class="op" id="5396753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396756">return</span>&nbsp;<span class="op" id="5396763">(</span><span class="ident" id="5396764">y</span><span class="op" id="5396765">-</span><span class="ident" id="5396766">p</span><span class="op" id="5396767">.</span><span class="ident" id="5396768">Rect</span><span class="op" id="5396772">.</span><span class="ident" id="5396773">Min</span><span class="op" id="5396776">.</span><span class="ident" id="5396777">Y</span><span class="op" id="5396778">)</span><span class="op" id="5396779">*</span><span class="ident" id="5396780">p</span><span class="op" id="5396781">.</span><span class="ident" id="5396782">Stride</span>&nbsp;<span class="op" id="5396789">+</span>&nbsp;<span class="op" id="5396791">(</span><span class="ident" id="5396792">x</span><span class="op" id="5396793">-</span><span class="ident" id="5396794">p</span><span class="op" id="5396795">.</span><span class="ident" id="5396796">Rect</span><span class="op" id="5396800">.</span><span class="ident" id="5396801">Min</span><span class="op" id="5396804">.</span><span class="ident" id="5396805">X</span><span class="op" id="5396806">)</span><span class="op" id="5396807">*</span><span class="num" id="5396808">4</span><br>
<span class="lineno">90</span><span class="op" id="5396810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396813">func</span>&nbsp;<span class="op" id="5396818">(</span><span class="ident" id="5396819">p</span>&nbsp;<span class="op" id="5396821">*</span><span class="ident" id="5396822">RGBA</span><span class="op" id="5396826">)</span>&nbsp;<span class="ident" id="5396828">Set</span><span class="op" id="5396831">(</span><span class="ident" id="5396832">x</span><span class="op" id="5396833">,</span>&nbsp;<span class="ident" id="5396835">y</span>&nbsp;<span class="builtintype" id="5396837">int</span><span class="op" id="5396840">,</span>&nbsp;<span class="ident" id="5396842">c</span>&nbsp;<span class="ident" id="5396844">color</span><span class="op" id="5396849">.</span><span class="ident" id="5396850">Color</span><span class="op" id="5396855">)</span>&nbsp;<span class="op" id="5396857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396860">if</span>&nbsp;<span class="op" id="5396863">!</span><span class="op" id="5396864">(</span><span class="ident" id="5396865">Point</span><span class="op" id="5396870">{</span><span class="ident" id="5396871">x</span><span class="op" id="5396872">,</span>&nbsp;<span class="ident" id="5396874">y</span><span class="op" id="5396875">}</span><span class="op" id="5396876">.</span><span class="ident" id="5396877">In</span><span class="op" id="5396879">(</span><span class="ident" id="5396880">p</span><span class="op" id="5396881">.</span><span class="ident" id="5396882">Rect</span><span class="op" id="5396886">)</span><span class="op" id="5396887">)</span>&nbsp;<span class="op" id="5396889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396893">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396904">i</span>&nbsp;<span class="op" id="5396906">:=</span>&nbsp;<span class="ident" id="5396909">p</span><span class="op" id="5396910">.</span><span class="ident" id="5396911">PixOffset</span><span class="op" id="5396920">(</span><span class="ident" id="5396921">x</span><span class="op" id="5396922">,</span>&nbsp;<span class="ident" id="5396924">y</span><span class="op" id="5396925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396928">c1</span>&nbsp;<span class="op" id="5396931">:=</span>&nbsp;<span class="ident" id="5396934">color</span><span class="op" id="5396939">.</span><span class="ident" id="5396940">RGBAModel</span><span class="op" id="5396949">.</span><span class="ident" id="5396950">Convert</span><span class="op" id="5396957">(</span><span class="ident" id="5396958">c</span><span class="op" id="5396959">)</span><span class="op" id="5396960">.</span><span class="op" id="5396961">(</span><span class="ident" id="5396962">color</span><span class="op" id="5396967">.</span><span class="ident" id="5396968">RGBA</span><span class="op" id="5396972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396975">p</span><span class="op" id="5396976">.</span><span class="ident" id="5396977">Pix</span><span class="op" id="5396980">[</span><span class="ident" id="5396981">i</span><span class="op" id="5396982">+</span><span class="num" id="5396983">0</span><span class="op" id="5396984">]</span>&nbsp;<span class="op" id="5396986">=</span>&nbsp;<span class="ident" id="5396988">c1</span><span class="op" id="5396990">.</span><span class="ident" id="5396991">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396994">p</span><span class="op" id="5396995">.</span><span class="ident" id="5396996">Pix</span><span class="op" id="5396999">[</span><span class="ident" id="5397000">i</span><span class="op" id="5397001">+</span><span class="num" id="5397002">1</span><span class="op" id="5397003">]</span>&nbsp;<span class="op" id="5397005">=</span>&nbsp;<span class="ident" id="5397007">c1</span><span class="op" id="5397009">.</span><span class="ident" id="5397010">G</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397013">p</span><span class="op" id="5397014">.</span><span class="ident" id="5397015">Pix</span><span class="op" id="5397018">[</span><span class="ident" id="5397019">i</span><span class="op" id="5397020">+</span><span class="num" id="5397021">2</span><span class="op" id="5397022">]</span>&nbsp;<span class="op" id="5397024">=</span>&nbsp;<span class="ident" id="5397026">c1</span><span class="op" id="5397028">.</span><span class="ident" id="5397029">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397032">p</span><span class="op" id="5397033">.</span><span class="ident" id="5397034">Pix</span><span class="op" id="5397037">[</span><span class="ident" id="5397038">i</span><span class="op" id="5397039">+</span><span class="num" id="5397040">3</span><span class="op" id="5397041">]</span>&nbsp;<span class="op" id="5397043">=</span>&nbsp;<span class="ident" id="5397045">c1</span><span class="op" id="5397047">.</span><span class="ident" id="5397048">A</span><br>
<span class="lineno"></span><span class="op" id="5397050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5397053">func</span>&nbsp;<span class="op" id="5397058">(</span><span class="ident" id="5397059">p</span>&nbsp;<span class="op" id="5397061">*</span><span class="ident" id="5397062">RGBA</span><span class="op" id="5397066">)</span>&nbsp;<span class="ident" id="5397068">SetRGBA</span><span class="op" id="5397075">(</span><span class="ident" id="5397076">x</span><span class="op" id="5397077">,</span>&nbsp;<span class="ident" id="5397079">y</span>&nbsp;<span class="builtintype" id="5397081">int</span><span class="op" id="5397084">,</span>&nbsp;<span class="ident" id="5397086">c</span>&nbsp;<span class="ident" id="5397088">color</span><span class="op" id="5397093">.</span><span class="ident" id="5397094">RGBA</span><span class="op" id="5397098">)</span>&nbsp;<span class="op" id="5397100">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397103">if</span>&nbsp;<span class="op" id="5397106">!</span><span class="op" id="5397107">(</span><span class="ident" id="5397108">Point</span><span class="op" id="5397113">{</span><span class="ident" id="5397114">x</span><span class="op" id="5397115">,</span>&nbsp;<span class="ident" id="5397117">y</span><span class="op" id="5397118">}</span><span class="op" id="5397119">.</span><span class="ident" id="5397120">In</span><span class="op" id="5397122">(</span><span class="ident" id="5397123">p</span><span class="op" id="5397124">.</span><span class="ident" id="5397125">Rect</span><span class="op" id="5397129">)</span><span class="op" id="5397130">)</span>&nbsp;<span class="op" id="5397132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397136">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397147">i</span>&nbsp;<span class="op" id="5397149">:=</span>&nbsp;<span class="ident" id="5397152">p</span><span class="op" id="5397153">.</span><span class="ident" id="5397154">PixOffset</span><span class="op" id="5397163">(</span><span class="ident" id="5397164">x</span><span class="op" id="5397165">,</span>&nbsp;<span class="ident" id="5397167">y</span><span class="op" id="5397168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397171">p</span><span class="op" id="5397172">.</span><span class="ident" id="5397173">Pix</span><span class="op" id="5397176">[</span><span class="ident" id="5397177">i</span><span class="op" id="5397178">+</span><span class="num" id="5397179">0</span><span class="op" id="5397180">]</span>&nbsp;<span class="op" id="5397182">=</span>&nbsp;<span class="ident" id="5397184">c</span><span class="op" id="5397185">.</span><span class="ident" id="5397186">R</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397189">p</span><span class="op" id="5397190">.</span><span class="ident" id="5397191">Pix</span><span class="op" id="5397194">[</span><span class="ident" id="5397195">i</span><span class="op" id="5397196">+</span><span class="num" id="5397197">1</span><span class="op" id="5397198">]</span>&nbsp;<span class="op" id="5397200">=</span>&nbsp;<span class="ident" id="5397202">c</span><span class="op" id="5397203">.</span><span class="ident" id="5397204">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397207">p</span><span class="op" id="5397208">.</span><span class="ident" id="5397209">Pix</span><span class="op" id="5397212">[</span><span class="ident" id="5397213">i</span><span class="op" id="5397214">+</span><span class="num" id="5397215">2</span><span class="op" id="5397216">]</span>&nbsp;<span class="op" id="5397218">=</span>&nbsp;<span class="ident" id="5397220">c</span><span class="op" id="5397221">.</span><span class="ident" id="5397222">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397225">p</span><span class="op" id="5397226">.</span><span class="ident" id="5397227">Pix</span><span class="op" id="5397230">[</span><span class="ident" id="5397231">i</span><span class="op" id="5397232">+</span><span class="num" id="5397233">3</span><span class="op" id="5397234">]</span>&nbsp;<span class="op" id="5397236">=</span>&nbsp;<span class="ident" id="5397238">c</span><span class="op" id="5397239">.</span><span class="ident" id="5397240">A</span><br>
<span class="lineno"></span><span class="op" id="5397242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5397245">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5397322">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5397394">func</span>&nbsp;<span class="op" id="5397399">(</span><span class="ident" id="5397400">p</span>&nbsp;<span class="op" id="5397402">*</span><span class="ident" id="5397403">RGBA</span><span class="op" id="5397407">)</span>&nbsp;<span class="ident" id="5397409">SubImage</span><span class="op" id="5397417">(</span><span class="ident" id="5397418">r</span>&nbsp;<span class="ident" id="5397420">Rectangle</span><span class="op" id="5397429">)</span>&nbsp;<span class="ident" id="5397431">Image</span>&nbsp;<span class="op" id="5397437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397440">r</span>&nbsp;<span class="op" id="5397442">=</span>&nbsp;<span class="ident" id="5397444">r</span><span class="op" id="5397445">.</span><span class="ident" id="5397446">Intersect</span><span class="op" id="5397455">(</span><span class="ident" id="5397456">p</span><span class="op" id="5397457">.</span><span class="ident" id="5397458">Rect</span><span class="op" id="5397462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397465">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397546">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397628">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397678">if</span>&nbsp;<span class="ident" id="5397681">r</span><span class="op" id="5397682">.</span><span class="ident" id="5397683">Empty</span><span class="op" id="5397688">(</span><span class="op" id="5397689">)</span>&nbsp;<span class="op" id="5397691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397695">return</span>&nbsp;<span class="op" id="5397702">&amp;</span><span class="ident" id="5397703">RGBA</span><span class="op" id="5397707">{</span><span class="op" id="5397708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397711">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397714">i</span>&nbsp;<span class="op" id="5397716">:=</span>&nbsp;<span class="ident" id="5397719">p</span><span class="op" id="5397720">.</span><span class="ident" id="5397721">PixOffset</span><span class="op" id="5397730">(</span><span class="ident" id="5397731">r</span><span class="op" id="5397732">.</span><span class="ident" id="5397733">Min</span><span class="op" id="5397736">.</span><span class="ident" id="5397737">X</span><span class="op" id="5397738">,</span>&nbsp;<span class="ident" id="5397740">r</span><span class="op" id="5397741">.</span><span class="ident" id="5397742">Min</span><span class="op" id="5397745">.</span><span class="ident" id="5397746">Y</span><span class="op" id="5397747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397750">return</span>&nbsp;<span class="op" id="5397757">&amp;</span><span class="ident" id="5397758">RGBA</span><span class="op" id="5397762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397766">Pix</span><span class="op" id="5397769">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5397774">p</span><span class="op" id="5397775">.</span><span class="ident" id="5397776">Pix</span><span class="op" id="5397779">[</span><span class="ident" id="5397780">i</span><span class="op" id="5397781">:</span><span class="op" id="5397782">]</span><span class="op" id="5397783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397787">Stride</span><span class="op" id="5397793">:</span>&nbsp;<span class="ident" id="5397795">p</span><span class="op" id="5397796">.</span><span class="ident" id="5397797">Stride</span><span class="op" id="5397803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397807">Rect</span><span class="op" id="5397811">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5397815">r</span><span class="op" id="5397816">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397819">}</span><br>
<span class="lineno"></span><span class="op" id="5397821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5397824">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5397897">func</span>&nbsp;<span class="op" id="5397902">(</span><span class="ident" id="5397903">p</span>&nbsp;<span class="op" id="5397905">*</span><span class="ident" id="5397906">RGBA</span><span class="op" id="5397910">)</span>&nbsp;<span class="ident" id="5397912">Opaque</span><span class="op" id="5397918">(</span><span class="op" id="5397919">)</span>&nbsp;<span class="builtintype" id="5397921">bool</span>&nbsp;<span class="op" id="5397926">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397929">if</span>&nbsp;<span class="ident" id="5397932">p</span><span class="op" id="5397933">.</span><span class="ident" id="5397934">Rect</span><span class="op" id="5397938">.</span><span class="ident" id="5397939">Empty</span><span class="op" id="5397944">(</span><span class="op" id="5397945">)</span>&nbsp;<span class="op" id="5397947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397951">return</span>&nbsp;<span class="builtintype" id="5397958">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397967">i0</span><span class="op" id="5397969">,</span>&nbsp;<span class="ident" id="5397971">i1</span>&nbsp;<span class="op" id="5397974">:=</span>&nbsp;<span class="num" id="5397977">3</span><span class="op" id="5397978">,</span>&nbsp;<span class="ident" id="5397980">p</span><span class="op" id="5397981">.</span><span class="ident" id="5397982">Rect</span><span class="op" id="5397986">.</span><span class="ident" id="5397987">Dx</span><span class="op" id="5397989">(</span><span class="op" id="5397990">)</span><span class="op" id="5397991">*</span><span class="num" id="5397992">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397995">for</span>&nbsp;<span class="ident" id="5397999">y</span>&nbsp;<span class="op" id="5398001">:=</span>&nbsp;<span class="ident" id="5398004">p</span><span class="op" id="5398005">.</span><span class="ident" id="5398006">Rect</span><span class="op" id="5398010">.</span><span class="ident" id="5398011">Min</span><span class="op" id="5398014">.</span><span class="ident" id="5398015">Y</span><span class="op" id="5398016">;</span>&nbsp;<span class="ident" id="5398018">y</span>&nbsp;<span class="op" id="5398020">&lt;</span>&nbsp;<span class="ident" id="5398022">p</span><span class="op" id="5398023">.</span><span class="ident" id="5398024">Rect</span><span class="op" id="5398028">.</span><span class="ident" id="5398029">Max</span><span class="op" id="5398032">.</span><span class="ident" id="5398033">Y</span><span class="op" id="5398034">;</span>&nbsp;<span class="ident" id="5398036">y</span><span class="op" id="5398037">++</span>&nbsp;<span class="op" id="5398040">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398044">for</span>&nbsp;<span class="ident" id="5398048">i</span>&nbsp;<span class="op" id="5398050">:=</span>&nbsp;<span class="ident" id="5398053">i0</span><span class="op" id="5398055">;</span>&nbsp;<span class="ident" id="5398057">i</span>&nbsp;<span class="op" id="5398059">&lt;</span>&nbsp;<span class="ident" id="5398061">i1</span><span class="op" id="5398063">;</span>&nbsp;<span class="ident" id="5398065">i</span>&nbsp;<span class="op" id="5398067">+=</span>&nbsp;<span class="num" id="5398070">4</span>&nbsp;<span class="op" id="5398072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398077">if</span>&nbsp;<span class="ident" id="5398080">p</span><span class="op" id="5398081">.</span><span class="ident" id="5398082">Pix</span><span class="op" id="5398085">[</span><span class="ident" id="5398086">i</span><span class="op" id="5398087">]</span>&nbsp;<span class="op" id="5398089">!=</span>&nbsp;<span class="num" id="5398092">0xff</span>&nbsp;<span class="op" id="5398097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398103">return</span>&nbsp;<span class="builtintype" id="5398110">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398123">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398127">i0</span>&nbsp;<span class="op" id="5398130">+=</span>&nbsp;<span class="ident" id="5398133">p</span><span class="op" id="5398134">.</span><span class="ident" id="5398135">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398144">i1</span>&nbsp;<span class="op" id="5398147">+=</span>&nbsp;<span class="ident" id="5398150">p</span><span class="op" id="5398151">.</span><span class="ident" id="5398152">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398163">return</span>&nbsp;<span class="builtintype" id="5398170">true</span><br>
<span class="lineno"></span><span class="op" id="5398175">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="5398178">//&nbsp;NewRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5398231">func</span>&nbsp;<span class="ident" id="5398236">NewRGBA</span><span class="op" id="5398243">(</span><span class="ident" id="5398244">r</span>&nbsp;<span class="ident" id="5398246">Rectangle</span><span class="op" id="5398255">)</span>&nbsp;<span class="op" id="5398257">*</span><span class="ident" id="5398258">RGBA</span>&nbsp;<span class="op" id="5398263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398266">w</span><span class="op" id="5398267">,</span>&nbsp;<span class="ident" id="5398269">h</span>&nbsp;<span class="op" id="5398271">:=</span>&nbsp;<span class="ident" id="5398274">r</span><span class="op" id="5398275">.</span><span class="ident" id="5398276">Dx</span><span class="op" id="5398278">(</span><span class="op" id="5398279">)</span><span class="op" id="5398280">,</span>&nbsp;<span class="ident" id="5398282">r</span><span class="op" id="5398283">.</span><span class="ident" id="5398284">Dy</span><span class="op" id="5398286">(</span><span class="op" id="5398287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398290">buf</span>&nbsp;<span class="op" id="5398294">:=</span>&nbsp;<span class="builtinfunc" id="5398297">make</span><span class="op" id="5398301">(</span><span class="op" id="5398302">[</span><span class="op" id="5398303">]</span><span class="builtintype" id="5398304">uint8</span><span class="op" id="5398309">,</span>&nbsp;<span class="num" id="5398311">4</span><span class="op" id="5398312">*</span><span class="ident" id="5398313">w</span><span class="op" id="5398314">*</span><span class="ident" id="5398315">h</span><span class="op" id="5398316">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398319">return</span>&nbsp;<span class="op" id="5398326">&amp;</span><span class="ident" id="5398327">RGBA</span><span class="op" id="5398331">{</span><span class="ident" id="5398332">buf</span><span class="op" id="5398335">,</span>&nbsp;<span class="num" id="5398337">4</span>&nbsp;<span class="op" id="5398339">*</span>&nbsp;<span class="ident" id="5398341">w</span><span class="op" id="5398342">,</span>&nbsp;<span class="ident" id="5398344">r</span><span class="op" id="5398345">}</span><br>
<span class="lineno"></span><span class="op" id="5398347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5398350">//&nbsp;RGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.RGBA64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5398427">type</span>&nbsp;<span class="ident" id="5398432">RGBA64</span>&nbsp;<span class="keyword" id="5398439">struct</span>&nbsp;<span class="op" id="5398446">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398449">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398539">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398607">Pix</span>&nbsp;<span class="op" id="5398611">[</span><span class="op" id="5398612">]</span><span class="builtintype" id="5398613">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398620">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398696">Stride</span>&nbsp;<span class="builtintype" id="5398703">int</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398708">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398740">Rect</span>&nbsp;<span class="ident" id="5398745">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5398755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398758">func</span>&nbsp;<span class="op" id="5398763">(</span><span class="ident" id="5398764">p</span>&nbsp;<span class="op" id="5398766">*</span><span class="ident" id="5398767">RGBA64</span><span class="op" id="5398773">)</span>&nbsp;<span class="ident" id="5398775">ColorModel</span><span class="op" id="5398785">(</span><span class="op" id="5398786">)</span>&nbsp;<span class="ident" id="5398788">color</span><span class="op" id="5398793">.</span><span class="ident" id="5398794">Model</span>&nbsp;<span class="op" id="5398800">{</span>&nbsp;<span class="keyword" id="5398802">return</span>&nbsp;<span class="ident" id="5398809">color</span><span class="op" id="5398814">.</span><span class="ident" id="5398815">RGBA64Model</span>&nbsp;<span class="op" id="5398827">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5398830">func</span>&nbsp;<span class="op" id="5398835">(</span><span class="ident" id="5398836">p</span>&nbsp;<span class="op" id="5398838">*</span><span class="ident" id="5398839">RGBA64</span><span class="op" id="5398845">)</span>&nbsp;<span class="ident" id="5398847">Bounds</span><span class="op" id="5398853">(</span><span class="op" id="5398854">)</span>&nbsp;<span class="ident" id="5398856">Rectangle</span>&nbsp;<span class="op" id="5398866">{</span>&nbsp;<span class="keyword" id="5398868">return</span>&nbsp;<span class="ident" id="5398875">p</span><span class="op" id="5398876">.</span><span class="ident" id="5398877">Rect</span>&nbsp;<span class="op" id="5398882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398885">func</span>&nbsp;<span class="op" id="5398890">(</span><span class="ident" id="5398891">p</span>&nbsp;<span class="op" id="5398893">*</span><span class="ident" id="5398894">RGBA64</span><span class="op" id="5398900">)</span>&nbsp;<span class="ident" id="5398902">At</span><span class="op" id="5398904">(</span><span class="ident" id="5398905">x</span><span class="op" id="5398906">,</span>&nbsp;<span class="ident" id="5398908">y</span>&nbsp;<span class="builtintype" id="5398910">int</span><span class="op" id="5398913">)</span>&nbsp;<span class="ident" id="5398915">color</span><span class="op" id="5398920">.</span><span class="ident" id="5398921">Color</span>&nbsp;<span class="op" id="5398927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398930">return</span>&nbsp;<span class="ident" id="5398937">p</span><span class="op" id="5398938">.</span><span class="ident" id="5398939">RGBA64At</span><span class="op" id="5398947">(</span><span class="ident" id="5398948">x</span><span class="op" id="5398949">,</span>&nbsp;<span class="ident" id="5398951">y</span><span class="op" id="5398952">)</span><br>
<span class="lineno">175</span><span class="op" id="5398954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5398957">func</span>&nbsp;<span class="op" id="5398962">(</span><span class="ident" id="5398963">p</span>&nbsp;<span class="op" id="5398965">*</span><span class="ident" id="5398966">RGBA64</span><span class="op" id="5398972">)</span>&nbsp;<span class="ident" id="5398974">RGBA64At</span><span class="op" id="5398982">(</span><span class="ident" id="5398983">x</span><span class="op" id="5398984">,</span>&nbsp;<span class="ident" id="5398986">y</span>&nbsp;<span class="builtintype" id="5398988">int</span><span class="op" id="5398991">)</span>&nbsp;<span class="ident" id="5398993">color</span><span class="op" id="5398998">.</span><span class="ident" id="5398999">RGBA64</span>&nbsp;<span class="op" id="5399006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399009">if</span>&nbsp;<span class="op" id="5399012">!</span><span class="op" id="5399013">(</span><span class="ident" id="5399014">Point</span><span class="op" id="5399019">{</span><span class="ident" id="5399020">x</span><span class="op" id="5399021">,</span>&nbsp;<span class="ident" id="5399023">y</span><span class="op" id="5399024">}</span><span class="op" id="5399025">.</span><span class="ident" id="5399026">In</span><span class="op" id="5399028">(</span><span class="ident" id="5399029">p</span><span class="op" id="5399030">.</span><span class="ident" id="5399031">Rect</span><span class="op" id="5399035">)</span><span class="op" id="5399036">)</span>&nbsp;<span class="op" id="5399038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399042">return</span>&nbsp;<span class="ident" id="5399049">color</span><span class="op" id="5399054">.</span><span class="ident" id="5399055">RGBA64</span><span class="op" id="5399061">{</span><span class="op" id="5399062">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399068">i</span>&nbsp;<span class="op" id="5399070">:=</span>&nbsp;<span class="ident" id="5399073">p</span><span class="op" id="5399074">.</span><span class="ident" id="5399075">PixOffset</span><span class="op" id="5399084">(</span><span class="ident" id="5399085">x</span><span class="op" id="5399086">,</span>&nbsp;<span class="ident" id="5399088">y</span><span class="op" id="5399089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399092">return</span>&nbsp;<span class="ident" id="5399099">color</span><span class="op" id="5399104">.</span><span class="ident" id="5399105">RGBA64</span><span class="op" id="5399111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5399115">uint16</span><span class="op" id="5399121">(</span><span class="ident" id="5399122">p</span><span class="op" id="5399123">.</span><span class="ident" id="5399124">Pix</span><span class="op" id="5399127">[</span><span class="ident" id="5399128">i</span><span class="op" id="5399129">+</span><span class="num" id="5399130">0</span><span class="op" id="5399131">]</span><span class="op" id="5399132">)</span><span class="op" id="5399133">&lt;&lt;</span><span class="num" id="5399135">8</span>&nbsp;<span class="op" id="5399137">|</span>&nbsp;<span class="builtintype" id="5399139">uint16</span><span class="op" id="5399145">(</span><span class="ident" id="5399146">p</span><span class="op" id="5399147">.</span><span class="ident" id="5399148">Pix</span><span class="op" id="5399151">[</span><span class="ident" id="5399152">i</span><span class="op" id="5399153">+</span><span class="num" id="5399154">1</span><span class="op" id="5399155">]</span><span class="op" id="5399156">)</span><span class="op" id="5399157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5399161">uint16</span><span class="op" id="5399167">(</span><span class="ident" id="5399168">p</span><span class="op" id="5399169">.</span><span class="ident" id="5399170">Pix</span><span class="op" id="5399173">[</span><span class="ident" id="5399174">i</span><span class="op" id="5399175">+</span><span class="num" id="5399176">2</span><span class="op" id="5399177">]</span><span class="op" id="5399178">)</span><span class="op" id="5399179">&lt;&lt;</span><span class="num" id="5399181">8</span>&nbsp;<span class="op" id="5399183">|</span>&nbsp;<span class="builtintype" id="5399185">uint16</span><span class="op" id="5399191">(</span><span class="ident" id="5399192">p</span><span class="op" id="5399193">.</span><span class="ident" id="5399194">Pix</span><span class="op" id="5399197">[</span><span class="ident" id="5399198">i</span><span class="op" id="5399199">+</span><span class="num" id="5399200">3</span><span class="op" id="5399201">]</span><span class="op" id="5399202">)</span><span class="op" id="5399203">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5399207">uint16</span><span class="op" id="5399213">(</span><span class="ident" id="5399214">p</span><span class="op" id="5399215">.</span><span class="ident" id="5399216">Pix</span><span class="op" id="5399219">[</span><span class="ident" id="5399220">i</span><span class="op" id="5399221">+</span><span class="num" id="5399222">4</span><span class="op" id="5399223">]</span><span class="op" id="5399224">)</span><span class="op" id="5399225">&lt;&lt;</span><span class="num" id="5399227">8</span>&nbsp;<span class="op" id="5399229">|</span>&nbsp;<span class="builtintype" id="5399231">uint16</span><span class="op" id="5399237">(</span><span class="ident" id="5399238">p</span><span class="op" id="5399239">.</span><span class="ident" id="5399240">Pix</span><span class="op" id="5399243">[</span><span class="ident" id="5399244">i</span><span class="op" id="5399245">+</span><span class="num" id="5399246">5</span><span class="op" id="5399247">]</span><span class="op" id="5399248">)</span><span class="op" id="5399249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5399253">uint16</span><span class="op" id="5399259">(</span><span class="ident" id="5399260">p</span><span class="op" id="5399261">.</span><span class="ident" id="5399262">Pix</span><span class="op" id="5399265">[</span><span class="ident" id="5399266">i</span><span class="op" id="5399267">+</span><span class="num" id="5399268">6</span><span class="op" id="5399269">]</span><span class="op" id="5399270">)</span><span class="op" id="5399271">&lt;&lt;</span><span class="num" id="5399273">8</span>&nbsp;<span class="op" id="5399275">|</span>&nbsp;<span class="builtintype" id="5399277">uint16</span><span class="op" id="5399283">(</span><span class="ident" id="5399284">p</span><span class="op" id="5399285">.</span><span class="ident" id="5399286">Pix</span><span class="op" id="5399289">[</span><span class="ident" id="5399290">i</span><span class="op" id="5399291">+</span><span class="num" id="5399292">7</span><span class="op" id="5399293">]</span><span class="op" id="5399294">)</span><span class="op" id="5399295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399298">}</span><br>
<span class="lineno"></span><span class="op" id="5399300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5399303">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5399382">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5399406">func</span>&nbsp;<span class="op" id="5399411">(</span><span class="ident" id="5399412">p</span>&nbsp;<span class="op" id="5399414">*</span><span class="ident" id="5399415">RGBA64</span><span class="op" id="5399421">)</span>&nbsp;<span class="ident" id="5399423">PixOffset</span><span class="op" id="5399432">(</span><span class="ident" id="5399433">x</span><span class="op" id="5399434">,</span>&nbsp;<span class="ident" id="5399436">y</span>&nbsp;<span class="builtintype" id="5399438">int</span><span class="op" id="5399441">)</span>&nbsp;<span class="builtintype" id="5399443">int</span>&nbsp;<span class="op" id="5399447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399450">return</span>&nbsp;<span class="op" id="5399457">(</span><span class="ident" id="5399458">y</span><span class="op" id="5399459">-</span><span class="ident" id="5399460">p</span><span class="op" id="5399461">.</span><span class="ident" id="5399462">Rect</span><span class="op" id="5399466">.</span><span class="ident" id="5399467">Min</span><span class="op" id="5399470">.</span><span class="ident" id="5399471">Y</span><span class="op" id="5399472">)</span><span class="op" id="5399473">*</span><span class="ident" id="5399474">p</span><span class="op" id="5399475">.</span><span class="ident" id="5399476">Stride</span>&nbsp;<span class="op" id="5399483">+</span>&nbsp;<span class="op" id="5399485">(</span><span class="ident" id="5399486">x</span><span class="op" id="5399487">-</span><span class="ident" id="5399488">p</span><span class="op" id="5399489">.</span><span class="ident" id="5399490">Rect</span><span class="op" id="5399494">.</span><span class="ident" id="5399495">Min</span><span class="op" id="5399498">.</span><span class="ident" id="5399499">X</span><span class="op" id="5399500">)</span><span class="op" id="5399501">*</span><span class="num" id="5399502">8</span><br>
<span class="lineno"></span><span class="op" id="5399504">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="5399507">func</span>&nbsp;<span class="op" id="5399512">(</span><span class="ident" id="5399513">p</span>&nbsp;<span class="op" id="5399515">*</span><span class="ident" id="5399516">RGBA64</span><span class="op" id="5399522">)</span>&nbsp;<span class="ident" id="5399524">Set</span><span class="op" id="5399527">(</span><span class="ident" id="5399528">x</span><span class="op" id="5399529">,</span>&nbsp;<span class="ident" id="5399531">y</span>&nbsp;<span class="builtintype" id="5399533">int</span><span class="op" id="5399536">,</span>&nbsp;<span class="ident" id="5399538">c</span>&nbsp;<span class="ident" id="5399540">color</span><span class="op" id="5399545">.</span><span class="ident" id="5399546">Color</span><span class="op" id="5399551">)</span>&nbsp;<span class="op" id="5399553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399556">if</span>&nbsp;<span class="op" id="5399559">!</span><span class="op" id="5399560">(</span><span class="ident" id="5399561">Point</span><span class="op" id="5399566">{</span><span class="ident" id="5399567">x</span><span class="op" id="5399568">,</span>&nbsp;<span class="ident" id="5399570">y</span><span class="op" id="5399571">}</span><span class="op" id="5399572">.</span><span class="ident" id="5399573">In</span><span class="op" id="5399575">(</span><span class="ident" id="5399576">p</span><span class="op" id="5399577">.</span><span class="ident" id="5399578">Rect</span><span class="op" id="5399582">)</span><span class="op" id="5399583">)</span>&nbsp;<span class="op" id="5399585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399589">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399597">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399600">i</span>&nbsp;<span class="op" id="5399602">:=</span>&nbsp;<span class="ident" id="5399605">p</span><span class="op" id="5399606">.</span><span class="ident" id="5399607">PixOffset</span><span class="op" id="5399616">(</span><span class="ident" id="5399617">x</span><span class="op" id="5399618">,</span>&nbsp;<span class="ident" id="5399620">y</span><span class="op" id="5399621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399624">c1</span>&nbsp;<span class="op" id="5399627">:=</span>&nbsp;<span class="ident" id="5399630">color</span><span class="op" id="5399635">.</span><span class="ident" id="5399636">RGBA64Model</span><span class="op" id="5399647">.</span><span class="ident" id="5399648">Convert</span><span class="op" id="5399655">(</span><span class="ident" id="5399656">c</span><span class="op" id="5399657">)</span><span class="op" id="5399658">.</span><span class="op" id="5399659">(</span><span class="ident" id="5399660">color</span><span class="op" id="5399665">.</span><span class="ident" id="5399666">RGBA64</span><span class="op" id="5399672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399675">p</span><span class="op" id="5399676">.</span><span class="ident" id="5399677">Pix</span><span class="op" id="5399680">[</span><span class="ident" id="5399681">i</span><span class="op" id="5399682">+</span><span class="num" id="5399683">0</span><span class="op" id="5399684">]</span>&nbsp;<span class="op" id="5399686">=</span>&nbsp;<span class="builtintype" id="5399688">uint8</span><span class="op" id="5399693">(</span><span class="ident" id="5399694">c1</span><span class="op" id="5399696">.</span><span class="ident" id="5399697">R</span>&nbsp;<span class="op" id="5399699">&gt;&gt;</span>&nbsp;<span class="num" id="5399702">8</span><span class="op" id="5399703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399706">p</span><span class="op" id="5399707">.</span><span class="ident" id="5399708">Pix</span><span class="op" id="5399711">[</span><span class="ident" id="5399712">i</span><span class="op" id="5399713">+</span><span class="num" id="5399714">1</span><span class="op" id="5399715">]</span>&nbsp;<span class="op" id="5399717">=</span>&nbsp;<span class="builtintype" id="5399719">uint8</span><span class="op" id="5399724">(</span><span class="ident" id="5399725">c1</span><span class="op" id="5399727">.</span><span class="ident" id="5399728">R</span><span class="op" id="5399729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399732">p</span><span class="op" id="5399733">.</span><span class="ident" id="5399734">Pix</span><span class="op" id="5399737">[</span><span class="ident" id="5399738">i</span><span class="op" id="5399739">+</span><span class="num" id="5399740">2</span><span class="op" id="5399741">]</span>&nbsp;<span class="op" id="5399743">=</span>&nbsp;<span class="builtintype" id="5399745">uint8</span><span class="op" id="5399750">(</span><span class="ident" id="5399751">c1</span><span class="op" id="5399753">.</span><span class="ident" id="5399754">G</span>&nbsp;<span class="op" id="5399756">&gt;&gt;</span>&nbsp;<span class="num" id="5399759">8</span><span class="op" id="5399760">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399763">p</span><span class="op" id="5399764">.</span><span class="ident" id="5399765">Pix</span><span class="op" id="5399768">[</span><span class="ident" id="5399769">i</span><span class="op" id="5399770">+</span><span class="num" id="5399771">3</span><span class="op" id="5399772">]</span>&nbsp;<span class="op" id="5399774">=</span>&nbsp;<span class="builtintype" id="5399776">uint8</span><span class="op" id="5399781">(</span><span class="ident" id="5399782">c1</span><span class="op" id="5399784">.</span><span class="ident" id="5399785">G</span><span class="op" id="5399786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399789">p</span><span class="op" id="5399790">.</span><span class="ident" id="5399791">Pix</span><span class="op" id="5399794">[</span><span class="ident" id="5399795">i</span><span class="op" id="5399796">+</span><span class="num" id="5399797">4</span><span class="op" id="5399798">]</span>&nbsp;<span class="op" id="5399800">=</span>&nbsp;<span class="builtintype" id="5399802">uint8</span><span class="op" id="5399807">(</span><span class="ident" id="5399808">c1</span><span class="op" id="5399810">.</span><span class="ident" id="5399811">B</span>&nbsp;<span class="op" id="5399813">&gt;&gt;</span>&nbsp;<span class="num" id="5399816">8</span><span class="op" id="5399817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399820">p</span><span class="op" id="5399821">.</span><span class="ident" id="5399822">Pix</span><span class="op" id="5399825">[</span><span class="ident" id="5399826">i</span><span class="op" id="5399827">+</span><span class="num" id="5399828">5</span><span class="op" id="5399829">]</span>&nbsp;<span class="op" id="5399831">=</span>&nbsp;<span class="builtintype" id="5399833">uint8</span><span class="op" id="5399838">(</span><span class="ident" id="5399839">c1</span><span class="op" id="5399841">.</span><span class="ident" id="5399842">B</span><span class="op" id="5399843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399846">p</span><span class="op" id="5399847">.</span><span class="ident" id="5399848">Pix</span><span class="op" id="5399851">[</span><span class="ident" id="5399852">i</span><span class="op" id="5399853">+</span><span class="num" id="5399854">6</span><span class="op" id="5399855">]</span>&nbsp;<span class="op" id="5399857">=</span>&nbsp;<span class="builtintype" id="5399859">uint8</span><span class="op" id="5399864">(</span><span class="ident" id="5399865">c1</span><span class="op" id="5399867">.</span><span class="ident" id="5399868">A</span>&nbsp;<span class="op" id="5399870">&gt;&gt;</span>&nbsp;<span class="num" id="5399873">8</span><span class="op" id="5399874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5399877">p</span><span class="op" id="5399878">.</span><span class="ident" id="5399879">Pix</span><span class="op" id="5399882">[</span><span class="ident" id="5399883">i</span><span class="op" id="5399884">+</span><span class="num" id="5399885">7</span><span class="op" id="5399886">]</span>&nbsp;<span class="op" id="5399888">=</span>&nbsp;<span class="builtintype" id="5399890">uint8</span><span class="op" id="5399895">(</span><span class="ident" id="5399896">c1</span><span class="op" id="5399898">.</span><span class="ident" id="5399899">A</span><span class="op" id="5399900">)</span><br>
<span class="lineno">210</span><span class="op" id="5399902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5399905">func</span>&nbsp;<span class="op" id="5399910">(</span><span class="ident" id="5399911">p</span>&nbsp;<span class="op" id="5399913">*</span><span class="ident" id="5399914">RGBA64</span><span class="op" id="5399920">)</span>&nbsp;<span class="ident" id="5399922">SetRGBA64</span><span class="op" id="5399931">(</span><span class="ident" id="5399932">x</span><span class="op" id="5399933">,</span>&nbsp;<span class="ident" id="5399935">y</span>&nbsp;<span class="builtintype" id="5399937">int</span><span class="op" id="5399940">,</span>&nbsp;<span class="ident" id="5399942">c</span>&nbsp;<span class="ident" id="5399944">color</span><span class="op" id="5399949">.</span><span class="ident" id="5399950">RGBA64</span><span class="op" id="5399956">)</span>&nbsp;<span class="op" id="5399958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399961">if</span>&nbsp;<span class="op" id="5399964">!</span><span class="op" id="5399965">(</span><span class="ident" id="5399966">Point</span><span class="op" id="5399971">{</span><span class="ident" id="5399972">x</span><span class="op" id="5399973">,</span>&nbsp;<span class="ident" id="5399975">y</span><span class="op" id="5399976">}</span><span class="op" id="5399977">.</span><span class="ident" id="5399978">In</span><span class="op" id="5399980">(</span><span class="ident" id="5399981">p</span><span class="op" id="5399982">.</span><span class="ident" id="5399983">Rect</span><span class="op" id="5399987">)</span><span class="op" id="5399988">)</span>&nbsp;<span class="op" id="5399990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399994">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400005">i</span>&nbsp;<span class="op" id="5400007">:=</span>&nbsp;<span class="ident" id="5400010">p</span><span class="op" id="5400011">.</span><span class="ident" id="5400012">PixOffset</span><span class="op" id="5400021">(</span><span class="ident" id="5400022">x</span><span class="op" id="5400023">,</span>&nbsp;<span class="ident" id="5400025">y</span><span class="op" id="5400026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400029">p</span><span class="op" id="5400030">.</span><span class="ident" id="5400031">Pix</span><span class="op" id="5400034">[</span><span class="ident" id="5400035">i</span><span class="op" id="5400036">+</span><span class="num" id="5400037">0</span><span class="op" id="5400038">]</span>&nbsp;<span class="op" id="5400040">=</span>&nbsp;<span class="builtintype" id="5400042">uint8</span><span class="op" id="5400047">(</span><span class="ident" id="5400048">c</span><span class="op" id="5400049">.</span><span class="ident" id="5400050">R</span>&nbsp;<span class="op" id="5400052">&gt;&gt;</span>&nbsp;<span class="num" id="5400055">8</span><span class="op" id="5400056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400059">p</span><span class="op" id="5400060">.</span><span class="ident" id="5400061">Pix</span><span class="op" id="5400064">[</span><span class="ident" id="5400065">i</span><span class="op" id="5400066">+</span><span class="num" id="5400067">1</span><span class="op" id="5400068">]</span>&nbsp;<span class="op" id="5400070">=</span>&nbsp;<span class="builtintype" id="5400072">uint8</span><span class="op" id="5400077">(</span><span class="ident" id="5400078">c</span><span class="op" id="5400079">.</span><span class="ident" id="5400080">R</span><span class="op" id="5400081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400084">p</span><span class="op" id="5400085">.</span><span class="ident" id="5400086">Pix</span><span class="op" id="5400089">[</span><span class="ident" id="5400090">i</span><span class="op" id="5400091">+</span><span class="num" id="5400092">2</span><span class="op" id="5400093">]</span>&nbsp;<span class="op" id="5400095">=</span>&nbsp;<span class="builtintype" id="5400097">uint8</span><span class="op" id="5400102">(</span><span class="ident" id="5400103">c</span><span class="op" id="5400104">.</span><span class="ident" id="5400105">G</span>&nbsp;<span class="op" id="5400107">&gt;&gt;</span>&nbsp;<span class="num" id="5400110">8</span><span class="op" id="5400111">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400114">p</span><span class="op" id="5400115">.</span><span class="ident" id="5400116">Pix</span><span class="op" id="5400119">[</span><span class="ident" id="5400120">i</span><span class="op" id="5400121">+</span><span class="num" id="5400122">3</span><span class="op" id="5400123">]</span>&nbsp;<span class="op" id="5400125">=</span>&nbsp;<span class="builtintype" id="5400127">uint8</span><span class="op" id="5400132">(</span><span class="ident" id="5400133">c</span><span class="op" id="5400134">.</span><span class="ident" id="5400135">G</span><span class="op" id="5400136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400139">p</span><span class="op" id="5400140">.</span><span class="ident" id="5400141">Pix</span><span class="op" id="5400144">[</span><span class="ident" id="5400145">i</span><span class="op" id="5400146">+</span><span class="num" id="5400147">4</span><span class="op" id="5400148">]</span>&nbsp;<span class="op" id="5400150">=</span>&nbsp;<span class="builtintype" id="5400152">uint8</span><span class="op" id="5400157">(</span><span class="ident" id="5400158">c</span><span class="op" id="5400159">.</span><span class="ident" id="5400160">B</span>&nbsp;<span class="op" id="5400162">&gt;&gt;</span>&nbsp;<span class="num" id="5400165">8</span><span class="op" id="5400166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400169">p</span><span class="op" id="5400170">.</span><span class="ident" id="5400171">Pix</span><span class="op" id="5400174">[</span><span class="ident" id="5400175">i</span><span class="op" id="5400176">+</span><span class="num" id="5400177">5</span><span class="op" id="5400178">]</span>&nbsp;<span class="op" id="5400180">=</span>&nbsp;<span class="builtintype" id="5400182">uint8</span><span class="op" id="5400187">(</span><span class="ident" id="5400188">c</span><span class="op" id="5400189">.</span><span class="ident" id="5400190">B</span><span class="op" id="5400191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400194">p</span><span class="op" id="5400195">.</span><span class="ident" id="5400196">Pix</span><span class="op" id="5400199">[</span><span class="ident" id="5400200">i</span><span class="op" id="5400201">+</span><span class="num" id="5400202">6</span><span class="op" id="5400203">]</span>&nbsp;<span class="op" id="5400205">=</span>&nbsp;<span class="builtintype" id="5400207">uint8</span><span class="op" id="5400212">(</span><span class="ident" id="5400213">c</span><span class="op" id="5400214">.</span><span class="ident" id="5400215">A</span>&nbsp;<span class="op" id="5400217">&gt;&gt;</span>&nbsp;<span class="num" id="5400220">8</span><span class="op" id="5400221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400224">p</span><span class="op" id="5400225">.</span><span class="ident" id="5400226">Pix</span><span class="op" id="5400229">[</span><span class="ident" id="5400230">i</span><span class="op" id="5400231">+</span><span class="num" id="5400232">7</span><span class="op" id="5400233">]</span>&nbsp;<span class="op" id="5400235">=</span>&nbsp;<span class="builtintype" id="5400237">uint8</span><span class="op" id="5400242">(</span><span class="ident" id="5400243">c</span><span class="op" id="5400244">.</span><span class="ident" id="5400245">A</span><span class="op" id="5400246">)</span><br>
<span class="lineno">225</span><span class="op" id="5400248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5400251">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5400328">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5400400">func</span>&nbsp;<span class="op" id="5400405">(</span><span class="ident" id="5400406">p</span>&nbsp;<span class="op" id="5400408">*</span><span class="ident" id="5400409">RGBA64</span><span class="op" id="5400415">)</span>&nbsp;<span class="ident" id="5400417">SubImage</span><span class="op" id="5400425">(</span><span class="ident" id="5400426">r</span>&nbsp;<span class="ident" id="5400428">Rectangle</span><span class="op" id="5400437">)</span>&nbsp;<span class="ident" id="5400439">Image</span>&nbsp;<span class="op" id="5400445">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400448">r</span>&nbsp;<span class="op" id="5400450">=</span>&nbsp;<span class="ident" id="5400452">r</span><span class="op" id="5400453">.</span><span class="ident" id="5400454">Intersect</span><span class="op" id="5400463">(</span><span class="ident" id="5400464">p</span><span class="op" id="5400465">.</span><span class="ident" id="5400466">Rect</span><span class="op" id="5400470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400473">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400554">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5400636">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400686">if</span>&nbsp;<span class="ident" id="5400689">r</span><span class="op" id="5400690">.</span><span class="ident" id="5400691">Empty</span><span class="op" id="5400696">(</span><span class="op" id="5400697">)</span>&nbsp;<span class="op" id="5400699">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400703">return</span>&nbsp;<span class="op" id="5400710">&amp;</span><span class="ident" id="5400711">RGBA64</span><span class="op" id="5400717">{</span><span class="op" id="5400718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400724">i</span>&nbsp;<span class="op" id="5400726">:=</span>&nbsp;<span class="ident" id="5400729">p</span><span class="op" id="5400730">.</span><span class="ident" id="5400731">PixOffset</span><span class="op" id="5400740">(</span><span class="ident" id="5400741">r</span><span class="op" id="5400742">.</span><span class="ident" id="5400743">Min</span><span class="op" id="5400746">.</span><span class="ident" id="5400747">X</span><span class="op" id="5400748">,</span>&nbsp;<span class="ident" id="5400750">r</span><span class="op" id="5400751">.</span><span class="ident" id="5400752">Min</span><span class="op" id="5400755">.</span><span class="ident" id="5400756">Y</span><span class="op" id="5400757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400760">return</span>&nbsp;<span class="op" id="5400767">&amp;</span><span class="ident" id="5400768">RGBA64</span><span class="op" id="5400774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400778">Pix</span><span class="op" id="5400781">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5400786">p</span><span class="op" id="5400787">.</span><span class="ident" id="5400788">Pix</span><span class="op" id="5400791">[</span><span class="ident" id="5400792">i</span><span class="op" id="5400793">:</span><span class="op" id="5400794">]</span><span class="op" id="5400795">,</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400799">Stride</span><span class="op" id="5400805">:</span>&nbsp;<span class="ident" id="5400807">p</span><span class="op" id="5400808">.</span><span class="ident" id="5400809">Stride</span><span class="op" id="5400815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400819">Rect</span><span class="op" id="5400823">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5400827">r</span><span class="op" id="5400828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400831">}</span><br>
<span class="lineno"></span><span class="op" id="5400833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="5400836">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5400909">func</span>&nbsp;<span class="op" id="5400914">(</span><span class="ident" id="5400915">p</span>&nbsp;<span class="op" id="5400917">*</span><span class="ident" id="5400918">RGBA64</span><span class="op" id="5400924">)</span>&nbsp;<span class="ident" id="5400926">Opaque</span><span class="op" id="5400932">(</span><span class="op" id="5400933">)</span>&nbsp;<span class="builtintype" id="5400935">bool</span>&nbsp;<span class="op" id="5400940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400943">if</span>&nbsp;<span class="ident" id="5400946">p</span><span class="op" id="5400947">.</span><span class="ident" id="5400948">Rect</span><span class="op" id="5400952">.</span><span class="ident" id="5400953">Empty</span><span class="op" id="5400958">(</span><span class="op" id="5400959">)</span>&nbsp;<span class="op" id="5400961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5400965">return</span>&nbsp;<span class="builtintype" id="5400972">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5400978">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5400981">i0</span><span class="op" id="5400983">,</span>&nbsp;<span class="ident" id="5400985">i1</span>&nbsp;<span class="op" id="5400988">:=</span>&nbsp;<span class="num" id="5400991">6</span><span class="op" id="5400992">,</span>&nbsp;<span class="ident" id="5400994">p</span><span class="op" id="5400995">.</span><span class="ident" id="5400996">Rect</span><span class="op" id="5401000">.</span><span class="ident" id="5401001">Dx</span><span class="op" id="5401003">(</span><span class="op" id="5401004">)</span><span class="op" id="5401005">*</span><span class="num" id="5401006">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401009">for</span>&nbsp;<span class="ident" id="5401013">y</span>&nbsp;<span class="op" id="5401015">:=</span>&nbsp;<span class="ident" id="5401018">p</span><span class="op" id="5401019">.</span><span class="ident" id="5401020">Rect</span><span class="op" id="5401024">.</span><span class="ident" id="5401025">Min</span><span class="op" id="5401028">.</span><span class="ident" id="5401029">Y</span><span class="op" id="5401030">;</span>&nbsp;<span class="ident" id="5401032">y</span>&nbsp;<span class="op" id="5401034">&lt;</span>&nbsp;<span class="ident" id="5401036">p</span><span class="op" id="5401037">.</span><span class="ident" id="5401038">Rect</span><span class="op" id="5401042">.</span><span class="ident" id="5401043">Max</span><span class="op" id="5401046">.</span><span class="ident" id="5401047">Y</span><span class="op" id="5401048">;</span>&nbsp;<span class="ident" id="5401050">y</span><span class="op" id="5401051">++</span>&nbsp;<span class="op" id="5401054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401058">for</span>&nbsp;<span class="ident" id="5401062">i</span>&nbsp;<span class="op" id="5401064">:=</span>&nbsp;<span class="ident" id="5401067">i0</span><span class="op" id="5401069">;</span>&nbsp;<span class="ident" id="5401071">i</span>&nbsp;<span class="op" id="5401073">&lt;</span>&nbsp;<span class="ident" id="5401075">i1</span><span class="op" id="5401077">;</span>&nbsp;<span class="ident" id="5401079">i</span>&nbsp;<span class="op" id="5401081">+=</span>&nbsp;<span class="num" id="5401084">8</span>&nbsp;<span class="op" id="5401086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401091">if</span>&nbsp;<span class="ident" id="5401094">p</span><span class="op" id="5401095">.</span><span class="ident" id="5401096">Pix</span><span class="op" id="5401099">[</span><span class="ident" id="5401100">i</span><span class="op" id="5401101">+</span><span class="num" id="5401102">0</span><span class="op" id="5401103">]</span>&nbsp;<span class="op" id="5401105">!=</span>&nbsp;<span class="num" id="5401108">0xff</span>&nbsp;<span class="op" id="5401113">||</span>&nbsp;<span class="ident" id="5401116">p</span><span class="op" id="5401117">.</span><span class="ident" id="5401118">Pix</span><span class="op" id="5401121">[</span><span class="ident" id="5401122">i</span><span class="op" id="5401123">+</span><span class="num" id="5401124">1</span><span class="op" id="5401125">]</span>&nbsp;<span class="op" id="5401127">!=</span>&nbsp;<span class="num" id="5401130">0xff</span>&nbsp;<span class="op" id="5401135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401141">return</span>&nbsp;<span class="builtintype" id="5401148">false</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401165">i0</span>&nbsp;<span class="op" id="5401168">+=</span>&nbsp;<span class="ident" id="5401171">p</span><span class="op" id="5401172">.</span><span class="ident" id="5401173">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401182">i1</span>&nbsp;<span class="op" id="5401185">+=</span>&nbsp;<span class="ident" id="5401188">p</span><span class="op" id="5401189">.</span><span class="ident" id="5401190">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5401198">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401201">return</span>&nbsp;<span class="builtintype" id="5401208">true</span><br>
<span class="lineno"></span><span class="op" id="5401213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5401216">//&nbsp;NewRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;RGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5401273">func</span>&nbsp;<span class="ident" id="5401278">NewRGBA64</span><span class="op" id="5401287">(</span><span class="ident" id="5401288">r</span>&nbsp;<span class="ident" id="5401290">Rectangle</span><span class="op" id="5401299">)</span>&nbsp;<span class="op" id="5401301">*</span><span class="ident" id="5401302">RGBA64</span>&nbsp;<span class="op" id="5401309">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401312">w</span><span class="op" id="5401313">,</span>&nbsp;<span class="ident" id="5401315">h</span>&nbsp;<span class="op" id="5401317">:=</span>&nbsp;<span class="ident" id="5401320">r</span><span class="op" id="5401321">.</span><span class="ident" id="5401322">Dx</span><span class="op" id="5401324">(</span><span class="op" id="5401325">)</span><span class="op" id="5401326">,</span>&nbsp;<span class="ident" id="5401328">r</span><span class="op" id="5401329">.</span><span class="ident" id="5401330">Dy</span><span class="op" id="5401332">(</span><span class="op" id="5401333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401336">pix</span>&nbsp;<span class="op" id="5401340">:=</span>&nbsp;<span class="builtinfunc" id="5401343">make</span><span class="op" id="5401347">(</span><span class="op" id="5401348">[</span><span class="op" id="5401349">]</span><span class="builtintype" id="5401350">uint8</span><span class="op" id="5401355">,</span>&nbsp;<span class="num" id="5401357">8</span><span class="op" id="5401358">*</span><span class="ident" id="5401359">w</span><span class="op" id="5401360">*</span><span class="ident" id="5401361">h</span><span class="op" id="5401362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401365">return</span>&nbsp;<span class="op" id="5401372">&amp;</span><span class="ident" id="5401373">RGBA64</span><span class="op" id="5401379">{</span><span class="ident" id="5401380">pix</span><span class="op" id="5401383">,</span>&nbsp;<span class="num" id="5401385">8</span>&nbsp;<span class="op" id="5401387">*</span>&nbsp;<span class="ident" id="5401389">w</span><span class="op" id="5401390">,</span>&nbsp;<span class="ident" id="5401392">r</span><span class="op" id="5401393">}</span><br>
<span class="lineno"></span><span class="op" id="5401395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5401398">//&nbsp;NRGBA&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5401473">type</span>&nbsp;<span class="ident" id="5401478">NRGBA</span>&nbsp;<span class="keyword" id="5401484">struct</span>&nbsp;<span class="op" id="5401491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401494">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401562">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401630">Pix</span>&nbsp;<span class="op" id="5401634">[</span><span class="op" id="5401635">]</span><span class="builtintype" id="5401636">uint8</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401643">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401719">Stride</span>&nbsp;<span class="builtintype" id="5401726">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5401731">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5401763">Rect</span>&nbsp;<span class="ident" id="5401768">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5401778">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="5401781">func</span>&nbsp;<span class="op" id="5401786">(</span><span class="ident" id="5401787">p</span>&nbsp;<span class="op" id="5401789">*</span><span class="ident" id="5401790">NRGBA</span><span class="op" id="5401795">)</span>&nbsp;<span class="ident" id="5401797">ColorModel</span><span class="op" id="5401807">(</span><span class="op" id="5401808">)</span>&nbsp;<span class="ident" id="5401810">color</span><span class="op" id="5401815">.</span><span class="ident" id="5401816">Model</span>&nbsp;<span class="op" id="5401822">{</span>&nbsp;<span class="keyword" id="5401824">return</span>&nbsp;<span class="ident" id="5401831">color</span><span class="op" id="5401836">.</span><span class="ident" id="5401837">NRGBAModel</span>&nbsp;<span class="op" id="5401848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5401851">func</span>&nbsp;<span class="op" id="5401856">(</span><span class="ident" id="5401857">p</span>&nbsp;<span class="op" id="5401859">*</span><span class="ident" id="5401860">NRGBA</span><span class="op" id="5401865">)</span>&nbsp;<span class="ident" id="5401867">Bounds</span><span class="op" id="5401873">(</span><span class="op" id="5401874">)</span>&nbsp;<span class="ident" id="5401876">Rectangle</span>&nbsp;<span class="op" id="5401886">{</span>&nbsp;<span class="keyword" id="5401888">return</span>&nbsp;<span class="ident" id="5401895">p</span><span class="op" id="5401896">.</span><span class="ident" id="5401897">Rect</span>&nbsp;<span class="op" id="5401902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="5401905">func</span>&nbsp;<span class="op" id="5401910">(</span><span class="ident" id="5401911">p</span>&nbsp;<span class="op" id="5401913">*</span><span class="ident" id="5401914">NRGBA</span><span class="op" id="5401919">)</span>&nbsp;<span class="ident" id="5401921">At</span><span class="op" id="5401923">(</span><span class="ident" id="5401924">x</span><span class="op" id="5401925">,</span>&nbsp;<span class="ident" id="5401927">y</span>&nbsp;<span class="builtintype" id="5401929">int</span><span class="op" id="5401932">)</span>&nbsp;<span class="ident" id="5401934">color</span><span class="op" id="5401939">.</span><span class="ident" id="5401940">Color</span>&nbsp;<span class="op" id="5401946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5401949">return</span>&nbsp;<span class="ident" id="5401956">p</span><span class="op" id="5401957">.</span><span class="ident" id="5401958">NRGBAAt</span><span class="op" id="5401965">(</span><span class="ident" id="5401966">x</span><span class="op" id="5401967">,</span>&nbsp;<span class="ident" id="5401969">y</span><span class="op" id="5401970">)</span><br>
<span class="lineno"></span><span class="op" id="5401972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5401975">func</span>&nbsp;<span class="op" id="5401980">(</span><span class="ident" id="5401981">p</span>&nbsp;<span class="op" id="5401983">*</span><span class="ident" id="5401984">NRGBA</span><span class="op" id="5401989">)</span>&nbsp;<span class="ident" id="5401991">NRGBAAt</span><span class="op" id="5401998">(</span><span class="ident" id="5401999">x</span><span class="op" id="5402000">,</span>&nbsp;<span class="ident" id="5402002">y</span>&nbsp;<span class="builtintype" id="5402004">int</span><span class="op" id="5402007">)</span>&nbsp;<span class="ident" id="5402009">color</span><span class="op" id="5402014">.</span><span class="ident" id="5402015">NRGBA</span>&nbsp;<span class="op" id="5402021">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402024">if</span>&nbsp;<span class="op" id="5402027">!</span><span class="op" id="5402028">(</span><span class="ident" id="5402029">Point</span><span class="op" id="5402034">{</span><span class="ident" id="5402035">x</span><span class="op" id="5402036">,</span>&nbsp;<span class="ident" id="5402038">y</span><span class="op" id="5402039">}</span><span class="op" id="5402040">.</span><span class="ident" id="5402041">In</span><span class="op" id="5402043">(</span><span class="ident" id="5402044">p</span><span class="op" id="5402045">.</span><span class="ident" id="5402046">Rect</span><span class="op" id="5402050">)</span><span class="op" id="5402051">)</span>&nbsp;<span class="op" id="5402053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402057">return</span>&nbsp;<span class="ident" id="5402064">color</span><span class="op" id="5402069">.</span><span class="ident" id="5402070">NRGBA</span><span class="op" id="5402075">{</span><span class="op" id="5402076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402082">i</span>&nbsp;<span class="op" id="5402084">:=</span>&nbsp;<span class="ident" id="5402087">p</span><span class="op" id="5402088">.</span><span class="ident" id="5402089">PixOffset</span><span class="op" id="5402098">(</span><span class="ident" id="5402099">x</span><span class="op" id="5402100">,</span>&nbsp;<span class="ident" id="5402102">y</span><span class="op" id="5402103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402106">return</span>&nbsp;<span class="ident" id="5402113">color</span><span class="op" id="5402118">.</span><span class="ident" id="5402119">NRGBA</span><span class="op" id="5402124">{</span><span class="ident" id="5402125">p</span><span class="op" id="5402126">.</span><span class="ident" id="5402127">Pix</span><span class="op" id="5402130">[</span><span class="ident" id="5402131">i</span><span class="op" id="5402132">+</span><span class="num" id="5402133">0</span><span class="op" id="5402134">]</span><span class="op" id="5402135">,</span>&nbsp;<span class="ident" id="5402137">p</span><span class="op" id="5402138">.</span><span class="ident" id="5402139">Pix</span><span class="op" id="5402142">[</span><span class="ident" id="5402143">i</span><span class="op" id="5402144">+</span><span class="num" id="5402145">1</span><span class="op" id="5402146">]</span><span class="op" id="5402147">,</span>&nbsp;<span class="ident" id="5402149">p</span><span class="op" id="5402150">.</span><span class="ident" id="5402151">Pix</span><span class="op" id="5402154">[</span><span class="ident" id="5402155">i</span><span class="op" id="5402156">+</span><span class="num" id="5402157">2</span><span class="op" id="5402158">]</span><span class="op" id="5402159">,</span>&nbsp;<span class="ident" id="5402161">p</span><span class="op" id="5402162">.</span><span class="ident" id="5402163">Pix</span><span class="op" id="5402166">[</span><span class="ident" id="5402167">i</span><span class="op" id="5402168">+</span><span class="num" id="5402169">3</span><span class="op" id="5402170">]</span><span class="op" id="5402171">}</span><br>
<span class="lineno">295</span><span class="op" id="5402173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5402176">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5402255">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5402279">func</span>&nbsp;<span class="op" id="5402284">(</span><span class="ident" id="5402285">p</span>&nbsp;<span class="op" id="5402287">*</span><span class="ident" id="5402288">NRGBA</span><span class="op" id="5402293">)</span>&nbsp;<span class="ident" id="5402295">PixOffset</span><span class="op" id="5402304">(</span><span class="ident" id="5402305">x</span><span class="op" id="5402306">,</span>&nbsp;<span class="ident" id="5402308">y</span>&nbsp;<span class="builtintype" id="5402310">int</span><span class="op" id="5402313">)</span>&nbsp;<span class="builtintype" id="5402315">int</span>&nbsp;<span class="op" id="5402319">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402322">return</span>&nbsp;<span class="op" id="5402329">(</span><span class="ident" id="5402330">y</span><span class="op" id="5402331">-</span><span class="ident" id="5402332">p</span><span class="op" id="5402333">.</span><span class="ident" id="5402334">Rect</span><span class="op" id="5402338">.</span><span class="ident" id="5402339">Min</span><span class="op" id="5402342">.</span><span class="ident" id="5402343">Y</span><span class="op" id="5402344">)</span><span class="op" id="5402345">*</span><span class="ident" id="5402346">p</span><span class="op" id="5402347">.</span><span class="ident" id="5402348">Stride</span>&nbsp;<span class="op" id="5402355">+</span>&nbsp;<span class="op" id="5402357">(</span><span class="ident" id="5402358">x</span><span class="op" id="5402359">-</span><span class="ident" id="5402360">p</span><span class="op" id="5402361">.</span><span class="ident" id="5402362">Rect</span><span class="op" id="5402366">.</span><span class="ident" id="5402367">Min</span><span class="op" id="5402370">.</span><span class="ident" id="5402371">X</span><span class="op" id="5402372">)</span><span class="op" id="5402373">*</span><span class="num" id="5402374">4</span><br>
<span class="lineno"></span><span class="op" id="5402376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5402379">func</span>&nbsp;<span class="op" id="5402384">(</span><span class="ident" id="5402385">p</span>&nbsp;<span class="op" id="5402387">*</span><span class="ident" id="5402388">NRGBA</span><span class="op" id="5402393">)</span>&nbsp;<span class="ident" id="5402395">Set</span><span class="op" id="5402398">(</span><span class="ident" id="5402399">x</span><span class="op" id="5402400">,</span>&nbsp;<span class="ident" id="5402402">y</span>&nbsp;<span class="builtintype" id="5402404">int</span><span class="op" id="5402407">,</span>&nbsp;<span class="ident" id="5402409">c</span>&nbsp;<span class="ident" id="5402411">color</span><span class="op" id="5402416">.</span><span class="ident" id="5402417">Color</span><span class="op" id="5402422">)</span>&nbsp;<span class="op" id="5402424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402427">if</span>&nbsp;<span class="op" id="5402430">!</span><span class="op" id="5402431">(</span><span class="ident" id="5402432">Point</span><span class="op" id="5402437">{</span><span class="ident" id="5402438">x</span><span class="op" id="5402439">,</span>&nbsp;<span class="ident" id="5402441">y</span><span class="op" id="5402442">}</span><span class="op" id="5402443">.</span><span class="ident" id="5402444">In</span><span class="op" id="5402446">(</span><span class="ident" id="5402447">p</span><span class="op" id="5402448">.</span><span class="ident" id="5402449">Rect</span><span class="op" id="5402453">)</span><span class="op" id="5402454">)</span>&nbsp;<span class="op" id="5402456">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402460">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402471">i</span>&nbsp;<span class="op" id="5402473">:=</span>&nbsp;<span class="ident" id="5402476">p</span><span class="op" id="5402477">.</span><span class="ident" id="5402478">PixOffset</span><span class="op" id="5402487">(</span><span class="ident" id="5402488">x</span><span class="op" id="5402489">,</span>&nbsp;<span class="ident" id="5402491">y</span><span class="op" id="5402492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402495">c1</span>&nbsp;<span class="op" id="5402498">:=</span>&nbsp;<span class="ident" id="5402501">color</span><span class="op" id="5402506">.</span><span class="ident" id="5402507">NRGBAModel</span><span class="op" id="5402517">.</span><span class="ident" id="5402518">Convert</span><span class="op" id="5402525">(</span><span class="ident" id="5402526">c</span><span class="op" id="5402527">)</span><span class="op" id="5402528">.</span><span class="op" id="5402529">(</span><span class="ident" id="5402530">color</span><span class="op" id="5402535">.</span><span class="ident" id="5402536">NRGBA</span><span class="op" id="5402541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402544">p</span><span class="op" id="5402545">.</span><span class="ident" id="5402546">Pix</span><span class="op" id="5402549">[</span><span class="ident" id="5402550">i</span><span class="op" id="5402551">+</span><span class="num" id="5402552">0</span><span class="op" id="5402553">]</span>&nbsp;<span class="op" id="5402555">=</span>&nbsp;<span class="ident" id="5402557">c1</span><span class="op" id="5402559">.</span><span class="ident" id="5402560">R</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402563">p</span><span class="op" id="5402564">.</span><span class="ident" id="5402565">Pix</span><span class="op" id="5402568">[</span><span class="ident" id="5402569">i</span><span class="op" id="5402570">+</span><span class="num" id="5402571">1</span><span class="op" id="5402572">]</span>&nbsp;<span class="op" id="5402574">=</span>&nbsp;<span class="ident" id="5402576">c1</span><span class="op" id="5402578">.</span><span class="ident" id="5402579">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402582">p</span><span class="op" id="5402583">.</span><span class="ident" id="5402584">Pix</span><span class="op" id="5402587">[</span><span class="ident" id="5402588">i</span><span class="op" id="5402589">+</span><span class="num" id="5402590">2</span><span class="op" id="5402591">]</span>&nbsp;<span class="op" id="5402593">=</span>&nbsp;<span class="ident" id="5402595">c1</span><span class="op" id="5402597">.</span><span class="ident" id="5402598">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402601">p</span><span class="op" id="5402602">.</span><span class="ident" id="5402603">Pix</span><span class="op" id="5402606">[</span><span class="ident" id="5402607">i</span><span class="op" id="5402608">+</span><span class="num" id="5402609">3</span><span class="op" id="5402610">]</span>&nbsp;<span class="op" id="5402612">=</span>&nbsp;<span class="ident" id="5402614">c1</span><span class="op" id="5402616">.</span><span class="ident" id="5402617">A</span><br>
<span class="lineno"></span><span class="op" id="5402619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="5402622">func</span>&nbsp;<span class="op" id="5402627">(</span><span class="ident" id="5402628">p</span>&nbsp;<span class="op" id="5402630">*</span><span class="ident" id="5402631">NRGBA</span><span class="op" id="5402636">)</span>&nbsp;<span class="ident" id="5402638">SetNRGBA</span><span class="op" id="5402646">(</span><span class="ident" id="5402647">x</span><span class="op" id="5402648">,</span>&nbsp;<span class="ident" id="5402650">y</span>&nbsp;<span class="builtintype" id="5402652">int</span><span class="op" id="5402655">,</span>&nbsp;<span class="ident" id="5402657">c</span>&nbsp;<span class="ident" id="5402659">color</span><span class="op" id="5402664">.</span><span class="ident" id="5402665">NRGBA</span><span class="op" id="5402670">)</span>&nbsp;<span class="op" id="5402672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402675">if</span>&nbsp;<span class="op" id="5402678">!</span><span class="op" id="5402679">(</span><span class="ident" id="5402680">Point</span><span class="op" id="5402685">{</span><span class="ident" id="5402686">x</span><span class="op" id="5402687">,</span>&nbsp;<span class="ident" id="5402689">y</span><span class="op" id="5402690">}</span><span class="op" id="5402691">.</span><span class="ident" id="5402692">In</span><span class="op" id="5402694">(</span><span class="ident" id="5402695">p</span><span class="op" id="5402696">.</span><span class="ident" id="5402697">Rect</span><span class="op" id="5402701">)</span><span class="op" id="5402702">)</span>&nbsp;<span class="op" id="5402704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5402708">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5402716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402719">i</span>&nbsp;<span class="op" id="5402721">:=</span>&nbsp;<span class="ident" id="5402724">p</span><span class="op" id="5402725">.</span><span class="ident" id="5402726">PixOffset</span><span class="op" id="5402735">(</span><span class="ident" id="5402736">x</span><span class="op" id="5402737">,</span>&nbsp;<span class="ident" id="5402739">y</span><span class="op" id="5402740">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402743">p</span><span class="op" id="5402744">.</span><span class="ident" id="5402745">Pix</span><span class="op" id="5402748">[</span><span class="ident" id="5402749">i</span><span class="op" id="5402750">+</span><span class="num" id="5402751">0</span><span class="op" id="5402752">]</span>&nbsp;<span class="op" id="5402754">=</span>&nbsp;<span class="ident" id="5402756">c</span><span class="op" id="5402757">.</span><span class="ident" id="5402758">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402761">p</span><span class="op" id="5402762">.</span><span class="ident" id="5402763">Pix</span><span class="op" id="5402766">[</span><span class="ident" id="5402767">i</span><span class="op" id="5402768">+</span><span class="num" id="5402769">1</span><span class="op" id="5402770">]</span>&nbsp;<span class="op" id="5402772">=</span>&nbsp;<span class="ident" id="5402774">c</span><span class="op" id="5402775">.</span><span class="ident" id="5402776">G</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402779">p</span><span class="op" id="5402780">.</span><span class="ident" id="5402781">Pix</span><span class="op" id="5402784">[</span><span class="ident" id="5402785">i</span><span class="op" id="5402786">+</span><span class="num" id="5402787">2</span><span class="op" id="5402788">]</span>&nbsp;<span class="op" id="5402790">=</span>&nbsp;<span class="ident" id="5402792">c</span><span class="op" id="5402793">.</span><span class="ident" id="5402794">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5402797">p</span><span class="op" id="5402798">.</span><span class="ident" id="5402799">Pix</span><span class="op" id="5402802">[</span><span class="ident" id="5402803">i</span><span class="op" id="5402804">+</span><span class="num" id="5402805">3</span><span class="op" id="5402806">]</span>&nbsp;<span class="op" id="5402808">=</span>&nbsp;<span class="ident" id="5402810">c</span><span class="op" id="5402811">.</span><span class="ident" id="5402812">A</span><br>
<span class="lineno"></span><span class="op" id="5402814">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="5402817">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5402894">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5402966">func</span>&nbsp;<span class="op" id="5402971">(</span><span class="ident" id="5402972">p</span>&nbsp;<span class="op" id="5402974">*</span><span class="ident" id="5402975">NRGBA</span><span class="op" id="5402980">)</span>&nbsp;<span class="ident" id="5402982">SubImage</span><span class="op" id="5402990">(</span><span class="ident" id="5402991">r</span>&nbsp;<span class="ident" id="5402993">Rectangle</span><span class="op" id="5403002">)</span>&nbsp;<span class="ident" id="5403004">Image</span>&nbsp;<span class="op" id="5403010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403013">r</span>&nbsp;<span class="op" id="5403015">=</span>&nbsp;<span class="ident" id="5403017">r</span><span class="op" id="5403018">.</span><span class="ident" id="5403019">Intersect</span><span class="op" id="5403028">(</span><span class="ident" id="5403029">p</span><span class="op" id="5403030">.</span><span class="ident" id="5403031">Rect</span><span class="op" id="5403035">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403038">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403119">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5403201">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403251">if</span>&nbsp;<span class="ident" id="5403254">r</span><span class="op" id="5403255">.</span><span class="ident" id="5403256">Empty</span><span class="op" id="5403261">(</span><span class="op" id="5403262">)</span>&nbsp;<span class="op" id="5403264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403268">return</span>&nbsp;<span class="op" id="5403275">&amp;</span><span class="ident" id="5403276">NRGBA</span><span class="op" id="5403281">{</span><span class="op" id="5403282">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403288">i</span>&nbsp;<span class="op" id="5403290">:=</span>&nbsp;<span class="ident" id="5403293">p</span><span class="op" id="5403294">.</span><span class="ident" id="5403295">PixOffset</span><span class="op" id="5403304">(</span><span class="ident" id="5403305">r</span><span class="op" id="5403306">.</span><span class="ident" id="5403307">Min</span><span class="op" id="5403310">.</span><span class="ident" id="5403311">X</span><span class="op" id="5403312">,</span>&nbsp;<span class="ident" id="5403314">r</span><span class="op" id="5403315">.</span><span class="ident" id="5403316">Min</span><span class="op" id="5403319">.</span><span class="ident" id="5403320">Y</span><span class="op" id="5403321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403324">return</span>&nbsp;<span class="op" id="5403331">&amp;</span><span class="ident" id="5403332">NRGBA</span><span class="op" id="5403337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403341">Pix</span><span class="op" id="5403344">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5403349">p</span><span class="op" id="5403350">.</span><span class="ident" id="5403351">Pix</span><span class="op" id="5403354">[</span><span class="ident" id="5403355">i</span><span class="op" id="5403356">:</span><span class="op" id="5403357">]</span><span class="op" id="5403358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403362">Stride</span><span class="op" id="5403368">:</span>&nbsp;<span class="ident" id="5403370">p</span><span class="op" id="5403371">.</span><span class="ident" id="5403372">Stride</span><span class="op" id="5403378">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403382">Rect</span><span class="op" id="5403386">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5403390">r</span><span class="op" id="5403391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403394">}</span><br>
<span class="lineno"></span><span class="op" id="5403396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403399">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno">345</span><span class="keyword" id="5403472">func</span>&nbsp;<span class="op" id="5403477">(</span><span class="ident" id="5403478">p</span>&nbsp;<span class="op" id="5403480">*</span><span class="ident" id="5403481">NRGBA</span><span class="op" id="5403486">)</span>&nbsp;<span class="ident" id="5403488">Opaque</span><span class="op" id="5403494">(</span><span class="op" id="5403495">)</span>&nbsp;<span class="builtintype" id="5403497">bool</span>&nbsp;<span class="op" id="5403502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403505">if</span>&nbsp;<span class="ident" id="5403508">p</span><span class="op" id="5403509">.</span><span class="ident" id="5403510">Rect</span><span class="op" id="5403514">.</span><span class="ident" id="5403515">Empty</span><span class="op" id="5403520">(</span><span class="op" id="5403521">)</span>&nbsp;<span class="op" id="5403523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403527">return</span>&nbsp;<span class="builtintype" id="5403534">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403543">i0</span><span class="op" id="5403545">,</span>&nbsp;<span class="ident" id="5403547">i1</span>&nbsp;<span class="op" id="5403550">:=</span>&nbsp;<span class="num" id="5403553">3</span><span class="op" id="5403554">,</span>&nbsp;<span class="ident" id="5403556">p</span><span class="op" id="5403557">.</span><span class="ident" id="5403558">Rect</span><span class="op" id="5403562">.</span><span class="ident" id="5403563">Dx</span><span class="op" id="5403565">(</span><span class="op" id="5403566">)</span><span class="op" id="5403567">*</span><span class="num" id="5403568">4</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403571">for</span>&nbsp;<span class="ident" id="5403575">y</span>&nbsp;<span class="op" id="5403577">:=</span>&nbsp;<span class="ident" id="5403580">p</span><span class="op" id="5403581">.</span><span class="ident" id="5403582">Rect</span><span class="op" id="5403586">.</span><span class="ident" id="5403587">Min</span><span class="op" id="5403590">.</span><span class="ident" id="5403591">Y</span><span class="op" id="5403592">;</span>&nbsp;<span class="ident" id="5403594">y</span>&nbsp;<span class="op" id="5403596">&lt;</span>&nbsp;<span class="ident" id="5403598">p</span><span class="op" id="5403599">.</span><span class="ident" id="5403600">Rect</span><span class="op" id="5403604">.</span><span class="ident" id="5403605">Max</span><span class="op" id="5403608">.</span><span class="ident" id="5403609">Y</span><span class="op" id="5403610">;</span>&nbsp;<span class="ident" id="5403612">y</span><span class="op" id="5403613">++</span>&nbsp;<span class="op" id="5403616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403620">for</span>&nbsp;<span class="ident" id="5403624">i</span>&nbsp;<span class="op" id="5403626">:=</span>&nbsp;<span class="ident" id="5403629">i0</span><span class="op" id="5403631">;</span>&nbsp;<span class="ident" id="5403633">i</span>&nbsp;<span class="op" id="5403635">&lt;</span>&nbsp;<span class="ident" id="5403637">i1</span><span class="op" id="5403639">;</span>&nbsp;<span class="ident" id="5403641">i</span>&nbsp;<span class="op" id="5403643">+=</span>&nbsp;<span class="num" id="5403646">4</span>&nbsp;<span class="op" id="5403648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403653">if</span>&nbsp;<span class="ident" id="5403656">p</span><span class="op" id="5403657">.</span><span class="ident" id="5403658">Pix</span><span class="op" id="5403661">[</span><span class="ident" id="5403662">i</span><span class="op" id="5403663">]</span>&nbsp;<span class="op" id="5403665">!=</span>&nbsp;<span class="num" id="5403668">0xff</span>&nbsp;<span class="op" id="5403673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403679">return</span>&nbsp;<span class="builtintype" id="5403686">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403695">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403703">i0</span>&nbsp;<span class="op" id="5403706">+=</span>&nbsp;<span class="ident" id="5403709">p</span><span class="op" id="5403710">.</span><span class="ident" id="5403711">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403720">i1</span>&nbsp;<span class="op" id="5403723">+=</span>&nbsp;<span class="ident" id="5403726">p</span><span class="op" id="5403727">.</span><span class="ident" id="5403728">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5403736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403739">return</span>&nbsp;<span class="builtintype" id="5403746">true</span><br>
<span class="lineno">360</span><span class="op" id="5403751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403754">//&nbsp;NewNRGBA&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5403809">func</span>&nbsp;<span class="ident" id="5403814">NewNRGBA</span><span class="op" id="5403822">(</span><span class="ident" id="5403823">r</span>&nbsp;<span class="ident" id="5403825">Rectangle</span><span class="op" id="5403834">)</span>&nbsp;<span class="op" id="5403836">*</span><span class="ident" id="5403837">NRGBA</span>&nbsp;<span class="op" id="5403843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403846">w</span><span class="op" id="5403847">,</span>&nbsp;<span class="ident" id="5403849">h</span>&nbsp;<span class="op" id="5403851">:=</span>&nbsp;<span class="ident" id="5403854">r</span><span class="op" id="5403855">.</span><span class="ident" id="5403856">Dx</span><span class="op" id="5403858">(</span><span class="op" id="5403859">)</span><span class="op" id="5403860">,</span>&nbsp;<span class="ident" id="5403862">r</span><span class="op" id="5403863">.</span><span class="ident" id="5403864">Dy</span><span class="op" id="5403866">(</span><span class="op" id="5403867">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5403870">pix</span>&nbsp;<span class="op" id="5403874">:=</span>&nbsp;<span class="builtinfunc" id="5403877">make</span><span class="op" id="5403881">(</span><span class="op" id="5403882">[</span><span class="op" id="5403883">]</span><span class="builtintype" id="5403884">uint8</span><span class="op" id="5403889">,</span>&nbsp;<span class="num" id="5403891">4</span><span class="op" id="5403892">*</span><span class="ident" id="5403893">w</span><span class="op" id="5403894">*</span><span class="ident" id="5403895">h</span><span class="op" id="5403896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5403899">return</span>&nbsp;<span class="op" id="5403906">&amp;</span><span class="ident" id="5403907">NRGBA</span><span class="op" id="5403912">{</span><span class="ident" id="5403913">pix</span><span class="op" id="5403916">,</span>&nbsp;<span class="num" id="5403918">4</span>&nbsp;<span class="op" id="5403920">*</span>&nbsp;<span class="ident" id="5403922">w</span><span class="op" id="5403923">,</span>&nbsp;<span class="ident" id="5403925">r</span><span class="op" id="5403926">}</span><br>
<span class="lineno"></span><span class="op" id="5403928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5403931">//&nbsp;NRGBA64&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.NRGBA64&nbsp;values.</span><br>
<span class="lineno">370</span><span class="keyword" id="5404010">type</span>&nbsp;<span class="ident" id="5404015">NRGBA64</span>&nbsp;<span class="keyword" id="5404023">struct</span>&nbsp;<span class="op" id="5404030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404033">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;in&nbsp;R,&nbsp;G,&nbsp;B,&nbsp;A&nbsp;order&nbsp;and&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404123">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*8].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404191">Pix</span>&nbsp;<span class="op" id="5404195">[</span><span class="op" id="5404196">]</span><span class="builtintype" id="5404197">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404204">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404280">Stride</span>&nbsp;<span class="builtintype" id="5404287">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5404292">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404324">Rect</span>&nbsp;<span class="ident" id="5404329">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5404339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="5404342">func</span>&nbsp;<span class="op" id="5404347">(</span><span class="ident" id="5404348">p</span>&nbsp;<span class="op" id="5404350">*</span><span class="ident" id="5404351">NRGBA64</span><span class="op" id="5404358">)</span>&nbsp;<span class="ident" id="5404360">ColorModel</span><span class="op" id="5404370">(</span><span class="op" id="5404371">)</span>&nbsp;<span class="ident" id="5404373">color</span><span class="op" id="5404378">.</span><span class="ident" id="5404379">Model</span>&nbsp;<span class="op" id="5404385">{</span>&nbsp;<span class="keyword" id="5404387">return</span>&nbsp;<span class="ident" id="5404394">color</span><span class="op" id="5404399">.</span><span class="ident" id="5404400">NRGBA64Model</span>&nbsp;<span class="op" id="5404413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5404416">func</span>&nbsp;<span class="op" id="5404421">(</span><span class="ident" id="5404422">p</span>&nbsp;<span class="op" id="5404424">*</span><span class="ident" id="5404425">NRGBA64</span><span class="op" id="5404432">)</span>&nbsp;<span class="ident" id="5404434">Bounds</span><span class="op" id="5404440">(</span><span class="op" id="5404441">)</span>&nbsp;<span class="ident" id="5404443">Rectangle</span>&nbsp;<span class="op" id="5404453">{</span>&nbsp;<span class="keyword" id="5404455">return</span>&nbsp;<span class="ident" id="5404462">p</span><span class="op" id="5404463">.</span><span class="ident" id="5404464">Rect</span>&nbsp;<span class="op" id="5404469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5404472">func</span>&nbsp;<span class="op" id="5404477">(</span><span class="ident" id="5404478">p</span>&nbsp;<span class="op" id="5404480">*</span><span class="ident" id="5404481">NRGBA64</span><span class="op" id="5404488">)</span>&nbsp;<span class="ident" id="5404490">At</span><span class="op" id="5404492">(</span><span class="ident" id="5404493">x</span><span class="op" id="5404494">,</span>&nbsp;<span class="ident" id="5404496">y</span>&nbsp;<span class="builtintype" id="5404498">int</span><span class="op" id="5404501">)</span>&nbsp;<span class="ident" id="5404503">color</span><span class="op" id="5404508">.</span><span class="ident" id="5404509">Color</span>&nbsp;<span class="op" id="5404515">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404518">return</span>&nbsp;<span class="ident" id="5404525">p</span><span class="op" id="5404526">.</span><span class="ident" id="5404527">NRGBA64At</span><span class="op" id="5404536">(</span><span class="ident" id="5404537">x</span><span class="op" id="5404538">,</span>&nbsp;<span class="ident" id="5404540">y</span><span class="op" id="5404541">)</span><br>
<span class="lineno"></span><span class="op" id="5404543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5404546">func</span>&nbsp;<span class="op" id="5404551">(</span><span class="ident" id="5404552">p</span>&nbsp;<span class="op" id="5404554">*</span><span class="ident" id="5404555">NRGBA64</span><span class="op" id="5404562">)</span>&nbsp;<span class="ident" id="5404564">NRGBA64At</span><span class="op" id="5404573">(</span><span class="ident" id="5404574">x</span><span class="op" id="5404575">,</span>&nbsp;<span class="ident" id="5404577">y</span>&nbsp;<span class="builtintype" id="5404579">int</span><span class="op" id="5404582">)</span>&nbsp;<span class="ident" id="5404584">color</span><span class="op" id="5404589">.</span><span class="ident" id="5404590">NRGBA64</span>&nbsp;<span class="op" id="5404598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404601">if</span>&nbsp;<span class="op" id="5404604">!</span><span class="op" id="5404605">(</span><span class="ident" id="5404606">Point</span><span class="op" id="5404611">{</span><span class="ident" id="5404612">x</span><span class="op" id="5404613">,</span>&nbsp;<span class="ident" id="5404615">y</span><span class="op" id="5404616">}</span><span class="op" id="5404617">.</span><span class="ident" id="5404618">In</span><span class="op" id="5404620">(</span><span class="ident" id="5404621">p</span><span class="op" id="5404622">.</span><span class="ident" id="5404623">Rect</span><span class="op" id="5404627">)</span><span class="op" id="5404628">)</span>&nbsp;<span class="op" id="5404630">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404634">return</span>&nbsp;<span class="ident" id="5404641">color</span><span class="op" id="5404646">.</span><span class="ident" id="5404647">NRGBA64</span><span class="op" id="5404654">{</span><span class="op" id="5404655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5404661">i</span>&nbsp;<span class="op" id="5404663">:=</span>&nbsp;<span class="ident" id="5404666">p</span><span class="op" id="5404667">.</span><span class="ident" id="5404668">PixOffset</span><span class="op" id="5404677">(</span><span class="ident" id="5404678">x</span><span class="op" id="5404679">,</span>&nbsp;<span class="ident" id="5404681">y</span><span class="op" id="5404682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5404685">return</span>&nbsp;<span class="ident" id="5404692">color</span><span class="op" id="5404697">.</span><span class="ident" id="5404698">NRGBA64</span><span class="op" id="5404705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5404709">uint16</span><span class="op" id="5404715">(</span><span class="ident" id="5404716">p</span><span class="op" id="5404717">.</span><span class="ident" id="5404718">Pix</span><span class="op" id="5404721">[</span><span class="ident" id="5404722">i</span><span class="op" id="5404723">+</span><span class="num" id="5404724">0</span><span class="op" id="5404725">]</span><span class="op" id="5404726">)</span><span class="op" id="5404727">&lt;&lt;</span><span class="num" id="5404729">8</span>&nbsp;<span class="op" id="5404731">|</span>&nbsp;<span class="builtintype" id="5404733">uint16</span><span class="op" id="5404739">(</span><span class="ident" id="5404740">p</span><span class="op" id="5404741">.</span><span class="ident" id="5404742">Pix</span><span class="op" id="5404745">[</span><span class="ident" id="5404746">i</span><span class="op" id="5404747">+</span><span class="num" id="5404748">1</span><span class="op" id="5404749">]</span><span class="op" id="5404750">)</span><span class="op" id="5404751">,</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5404755">uint16</span><span class="op" id="5404761">(</span><span class="ident" id="5404762">p</span><span class="op" id="5404763">.</span><span class="ident" id="5404764">Pix</span><span class="op" id="5404767">[</span><span class="ident" id="5404768">i</span><span class="op" id="5404769">+</span><span class="num" id="5404770">2</span><span class="op" id="5404771">]</span><span class="op" id="5404772">)</span><span class="op" id="5404773">&lt;&lt;</span><span class="num" id="5404775">8</span>&nbsp;<span class="op" id="5404777">|</span>&nbsp;<span class="builtintype" id="5404779">uint16</span><span class="op" id="5404785">(</span><span class="ident" id="5404786">p</span><span class="op" id="5404787">.</span><span class="ident" id="5404788">Pix</span><span class="op" id="5404791">[</span><span class="ident" id="5404792">i</span><span class="op" id="5404793">+</span><span class="num" id="5404794">3</span><span class="op" id="5404795">]</span><span class="op" id="5404796">)</span><span class="op" id="5404797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5404801">uint16</span><span class="op" id="5404807">(</span><span class="ident" id="5404808">p</span><span class="op" id="5404809">.</span><span class="ident" id="5404810">Pix</span><span class="op" id="5404813">[</span><span class="ident" id="5404814">i</span><span class="op" id="5404815">+</span><span class="num" id="5404816">4</span><span class="op" id="5404817">]</span><span class="op" id="5404818">)</span><span class="op" id="5404819">&lt;&lt;</span><span class="num" id="5404821">8</span>&nbsp;<span class="op" id="5404823">|</span>&nbsp;<span class="builtintype" id="5404825">uint16</span><span class="op" id="5404831">(</span><span class="ident" id="5404832">p</span><span class="op" id="5404833">.</span><span class="ident" id="5404834">Pix</span><span class="op" id="5404837">[</span><span class="ident" id="5404838">i</span><span class="op" id="5404839">+</span><span class="num" id="5404840">5</span><span class="op" id="5404841">]</span><span class="op" id="5404842">)</span><span class="op" id="5404843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5404847">uint16</span><span class="op" id="5404853">(</span><span class="ident" id="5404854">p</span><span class="op" id="5404855">.</span><span class="ident" id="5404856">Pix</span><span class="op" id="5404859">[</span><span class="ident" id="5404860">i</span><span class="op" id="5404861">+</span><span class="num" id="5404862">6</span><span class="op" id="5404863">]</span><span class="op" id="5404864">)</span><span class="op" id="5404865">&lt;&lt;</span><span class="num" id="5404867">8</span>&nbsp;<span class="op" id="5404869">|</span>&nbsp;<span class="builtintype" id="5404871">uint16</span><span class="op" id="5404877">(</span><span class="ident" id="5404878">p</span><span class="op" id="5404879">.</span><span class="ident" id="5404880">Pix</span><span class="op" id="5404883">[</span><span class="ident" id="5404884">i</span><span class="op" id="5404885">+</span><span class="num" id="5404886">7</span><span class="op" id="5404887">]</span><span class="op" id="5404888">)</span><span class="op" id="5404889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5404892">}</span><br>
<span class="lineno"></span><span class="op" id="5404894">}</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span><span class="comment" id="5404897">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5404976">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5405000">func</span>&nbsp;<span class="op" id="5405005">(</span><span class="ident" id="5405006">p</span>&nbsp;<span class="op" id="5405008">*</span><span class="ident" id="5405009">NRGBA64</span><span class="op" id="5405016">)</span>&nbsp;<span class="ident" id="5405018">PixOffset</span><span class="op" id="5405027">(</span><span class="ident" id="5405028">x</span><span class="op" id="5405029">,</span>&nbsp;<span class="ident" id="5405031">y</span>&nbsp;<span class="builtintype" id="5405033">int</span><span class="op" id="5405036">)</span>&nbsp;<span class="builtintype" id="5405038">int</span>&nbsp;<span class="op" id="5405042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405045">return</span>&nbsp;<span class="op" id="5405052">(</span><span class="ident" id="5405053">y</span><span class="op" id="5405054">-</span><span class="ident" id="5405055">p</span><span class="op" id="5405056">.</span><span class="ident" id="5405057">Rect</span><span class="op" id="5405061">.</span><span class="ident" id="5405062">Min</span><span class="op" id="5405065">.</span><span class="ident" id="5405066">Y</span><span class="op" id="5405067">)</span><span class="op" id="5405068">*</span><span class="ident" id="5405069">p</span><span class="op" id="5405070">.</span><span class="ident" id="5405071">Stride</span>&nbsp;<span class="op" id="5405078">+</span>&nbsp;<span class="op" id="5405080">(</span><span class="ident" id="5405081">x</span><span class="op" id="5405082">-</span><span class="ident" id="5405083">p</span><span class="op" id="5405084">.</span><span class="ident" id="5405085">Rect</span><span class="op" id="5405089">.</span><span class="ident" id="5405090">Min</span><span class="op" id="5405093">.</span><span class="ident" id="5405094">X</span><span class="op" id="5405095">)</span><span class="op" id="5405096">*</span><span class="num" id="5405097">8</span><br>
<span class="lineno">405</span><span class="op" id="5405099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5405102">func</span>&nbsp;<span class="op" id="5405107">(</span><span class="ident" id="5405108">p</span>&nbsp;<span class="op" id="5405110">*</span><span class="ident" id="5405111">NRGBA64</span><span class="op" id="5405118">)</span>&nbsp;<span class="ident" id="5405120">Set</span><span class="op" id="5405123">(</span><span class="ident" id="5405124">x</span><span class="op" id="5405125">,</span>&nbsp;<span class="ident" id="5405127">y</span>&nbsp;<span class="builtintype" id="5405129">int</span><span class="op" id="5405132">,</span>&nbsp;<span class="ident" id="5405134">c</span>&nbsp;<span class="ident" id="5405136">color</span><span class="op" id="5405141">.</span><span class="ident" id="5405142">Color</span><span class="op" id="5405147">)</span>&nbsp;<span class="op" id="5405149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405152">if</span>&nbsp;<span class="op" id="5405155">!</span><span class="op" id="5405156">(</span><span class="ident" id="5405157">Point</span><span class="op" id="5405162">{</span><span class="ident" id="5405163">x</span><span class="op" id="5405164">,</span>&nbsp;<span class="ident" id="5405166">y</span><span class="op" id="5405167">}</span><span class="op" id="5405168">.</span><span class="ident" id="5405169">In</span><span class="op" id="5405171">(</span><span class="ident" id="5405172">p</span><span class="op" id="5405173">.</span><span class="ident" id="5405174">Rect</span><span class="op" id="5405178">)</span><span class="op" id="5405179">)</span>&nbsp;<span class="op" id="5405181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405185">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405196">i</span>&nbsp;<span class="op" id="5405198">:=</span>&nbsp;<span class="ident" id="5405201">p</span><span class="op" id="5405202">.</span><span class="ident" id="5405203">PixOffset</span><span class="op" id="5405212">(</span><span class="ident" id="5405213">x</span><span class="op" id="5405214">,</span>&nbsp;<span class="ident" id="5405216">y</span><span class="op" id="5405217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405220">c1</span>&nbsp;<span class="op" id="5405223">:=</span>&nbsp;<span class="ident" id="5405226">color</span><span class="op" id="5405231">.</span><span class="ident" id="5405232">NRGBA64Model</span><span class="op" id="5405244">.</span><span class="ident" id="5405245">Convert</span><span class="op" id="5405252">(</span><span class="ident" id="5405253">c</span><span class="op" id="5405254">)</span><span class="op" id="5405255">.</span><span class="op" id="5405256">(</span><span class="ident" id="5405257">color</span><span class="op" id="5405262">.</span><span class="ident" id="5405263">NRGBA64</span><span class="op" id="5405270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405273">p</span><span class="op" id="5405274">.</span><span class="ident" id="5405275">Pix</span><span class="op" id="5405278">[</span><span class="ident" id="5405279">i</span><span class="op" id="5405280">+</span><span class="num" id="5405281">0</span><span class="op" id="5405282">]</span>&nbsp;<span class="op" id="5405284">=</span>&nbsp;<span class="builtintype" id="5405286">uint8</span><span class="op" id="5405291">(</span><span class="ident" id="5405292">c1</span><span class="op" id="5405294">.</span><span class="ident" id="5405295">R</span>&nbsp;<span class="op" id="5405297">&gt;&gt;</span>&nbsp;<span class="num" id="5405300">8</span><span class="op" id="5405301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405304">p</span><span class="op" id="5405305">.</span><span class="ident" id="5405306">Pix</span><span class="op" id="5405309">[</span><span class="ident" id="5405310">i</span><span class="op" id="5405311">+</span><span class="num" id="5405312">1</span><span class="op" id="5405313">]</span>&nbsp;<span class="op" id="5405315">=</span>&nbsp;<span class="builtintype" id="5405317">uint8</span><span class="op" id="5405322">(</span><span class="ident" id="5405323">c1</span><span class="op" id="5405325">.</span><span class="ident" id="5405326">R</span><span class="op" id="5405327">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405330">p</span><span class="op" id="5405331">.</span><span class="ident" id="5405332">Pix</span><span class="op" id="5405335">[</span><span class="ident" id="5405336">i</span><span class="op" id="5405337">+</span><span class="num" id="5405338">2</span><span class="op" id="5405339">]</span>&nbsp;<span class="op" id="5405341">=</span>&nbsp;<span class="builtintype" id="5405343">uint8</span><span class="op" id="5405348">(</span><span class="ident" id="5405349">c1</span><span class="op" id="5405351">.</span><span class="ident" id="5405352">G</span>&nbsp;<span class="op" id="5405354">&gt;&gt;</span>&nbsp;<span class="num" id="5405357">8</span><span class="op" id="5405358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405361">p</span><span class="op" id="5405362">.</span><span class="ident" id="5405363">Pix</span><span class="op" id="5405366">[</span><span class="ident" id="5405367">i</span><span class="op" id="5405368">+</span><span class="num" id="5405369">3</span><span class="op" id="5405370">]</span>&nbsp;<span class="op" id="5405372">=</span>&nbsp;<span class="builtintype" id="5405374">uint8</span><span class="op" id="5405379">(</span><span class="ident" id="5405380">c1</span><span class="op" id="5405382">.</span><span class="ident" id="5405383">G</span><span class="op" id="5405384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405387">p</span><span class="op" id="5405388">.</span><span class="ident" id="5405389">Pix</span><span class="op" id="5405392">[</span><span class="ident" id="5405393">i</span><span class="op" id="5405394">+</span><span class="num" id="5405395">4</span><span class="op" id="5405396">]</span>&nbsp;<span class="op" id="5405398">=</span>&nbsp;<span class="builtintype" id="5405400">uint8</span><span class="op" id="5405405">(</span><span class="ident" id="5405406">c1</span><span class="op" id="5405408">.</span><span class="ident" id="5405409">B</span>&nbsp;<span class="op" id="5405411">&gt;&gt;</span>&nbsp;<span class="num" id="5405414">8</span><span class="op" id="5405415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405418">p</span><span class="op" id="5405419">.</span><span class="ident" id="5405420">Pix</span><span class="op" id="5405423">[</span><span class="ident" id="5405424">i</span><span class="op" id="5405425">+</span><span class="num" id="5405426">5</span><span class="op" id="5405427">]</span>&nbsp;<span class="op" id="5405429">=</span>&nbsp;<span class="builtintype" id="5405431">uint8</span><span class="op" id="5405436">(</span><span class="ident" id="5405437">c1</span><span class="op" id="5405439">.</span><span class="ident" id="5405440">B</span><span class="op" id="5405441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405444">p</span><span class="op" id="5405445">.</span><span class="ident" id="5405446">Pix</span><span class="op" id="5405449">[</span><span class="ident" id="5405450">i</span><span class="op" id="5405451">+</span><span class="num" id="5405452">6</span><span class="op" id="5405453">]</span>&nbsp;<span class="op" id="5405455">=</span>&nbsp;<span class="builtintype" id="5405457">uint8</span><span class="op" id="5405462">(</span><span class="ident" id="5405463">c1</span><span class="op" id="5405465">.</span><span class="ident" id="5405466">A</span>&nbsp;<span class="op" id="5405468">&gt;&gt;</span>&nbsp;<span class="num" id="5405471">8</span><span class="op" id="5405472">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405475">p</span><span class="op" id="5405476">.</span><span class="ident" id="5405477">Pix</span><span class="op" id="5405480">[</span><span class="ident" id="5405481">i</span><span class="op" id="5405482">+</span><span class="num" id="5405483">7</span><span class="op" id="5405484">]</span>&nbsp;<span class="op" id="5405486">=</span>&nbsp;<span class="builtintype" id="5405488">uint8</span><span class="op" id="5405493">(</span><span class="ident" id="5405494">c1</span><span class="op" id="5405496">.</span><span class="ident" id="5405497">A</span><span class="op" id="5405498">)</span><br>
<span class="lineno"></span><span class="op" id="5405500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5405503">func</span>&nbsp;<span class="op" id="5405508">(</span><span class="ident" id="5405509">p</span>&nbsp;<span class="op" id="5405511">*</span><span class="ident" id="5405512">NRGBA64</span><span class="op" id="5405519">)</span>&nbsp;<span class="ident" id="5405521">SetNRGBA64</span><span class="op" id="5405531">(</span><span class="ident" id="5405532">x</span><span class="op" id="5405533">,</span>&nbsp;<span class="ident" id="5405535">y</span>&nbsp;<span class="builtintype" id="5405537">int</span><span class="op" id="5405540">,</span>&nbsp;<span class="ident" id="5405542">c</span>&nbsp;<span class="ident" id="5405544">color</span><span class="op" id="5405549">.</span><span class="ident" id="5405550">NRGBA64</span><span class="op" id="5405557">)</span>&nbsp;<span class="op" id="5405559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405562">if</span>&nbsp;<span class="op" id="5405565">!</span><span class="op" id="5405566">(</span><span class="ident" id="5405567">Point</span><span class="op" id="5405572">{</span><span class="ident" id="5405573">x</span><span class="op" id="5405574">,</span>&nbsp;<span class="ident" id="5405576">y</span><span class="op" id="5405577">}</span><span class="op" id="5405578">.</span><span class="ident" id="5405579">In</span><span class="op" id="5405581">(</span><span class="ident" id="5405582">p</span><span class="op" id="5405583">.</span><span class="ident" id="5405584">Rect</span><span class="op" id="5405588">)</span><span class="op" id="5405589">)</span>&nbsp;<span class="op" id="5405591">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5405595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5405603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405606">i</span>&nbsp;<span class="op" id="5405608">:=</span>&nbsp;<span class="ident" id="5405611">p</span><span class="op" id="5405612">.</span><span class="ident" id="5405613">PixOffset</span><span class="op" id="5405622">(</span><span class="ident" id="5405623">x</span><span class="op" id="5405624">,</span>&nbsp;<span class="ident" id="5405626">y</span><span class="op" id="5405627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405630">p</span><span class="op" id="5405631">.</span><span class="ident" id="5405632">Pix</span><span class="op" id="5405635">[</span><span class="ident" id="5405636">i</span><span class="op" id="5405637">+</span><span class="num" id="5405638">0</span><span class="op" id="5405639">]</span>&nbsp;<span class="op" id="5405641">=</span>&nbsp;<span class="builtintype" id="5405643">uint8</span><span class="op" id="5405648">(</span><span class="ident" id="5405649">c</span><span class="op" id="5405650">.</span><span class="ident" id="5405651">R</span>&nbsp;<span class="op" id="5405653">&gt;&gt;</span>&nbsp;<span class="num" id="5405656">8</span><span class="op" id="5405657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405660">p</span><span class="op" id="5405661">.</span><span class="ident" id="5405662">Pix</span><span class="op" id="5405665">[</span><span class="ident" id="5405666">i</span><span class="op" id="5405667">+</span><span class="num" id="5405668">1</span><span class="op" id="5405669">]</span>&nbsp;<span class="op" id="5405671">=</span>&nbsp;<span class="builtintype" id="5405673">uint8</span><span class="op" id="5405678">(</span><span class="ident" id="5405679">c</span><span class="op" id="5405680">.</span><span class="ident" id="5405681">R</span><span class="op" id="5405682">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405685">p</span><span class="op" id="5405686">.</span><span class="ident" id="5405687">Pix</span><span class="op" id="5405690">[</span><span class="ident" id="5405691">i</span><span class="op" id="5405692">+</span><span class="num" id="5405693">2</span><span class="op" id="5405694">]</span>&nbsp;<span class="op" id="5405696">=</span>&nbsp;<span class="builtintype" id="5405698">uint8</span><span class="op" id="5405703">(</span><span class="ident" id="5405704">c</span><span class="op" id="5405705">.</span><span class="ident" id="5405706">G</span>&nbsp;<span class="op" id="5405708">&gt;&gt;</span>&nbsp;<span class="num" id="5405711">8</span><span class="op" id="5405712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405715">p</span><span class="op" id="5405716">.</span><span class="ident" id="5405717">Pix</span><span class="op" id="5405720">[</span><span class="ident" id="5405721">i</span><span class="op" id="5405722">+</span><span class="num" id="5405723">3</span><span class="op" id="5405724">]</span>&nbsp;<span class="op" id="5405726">=</span>&nbsp;<span class="builtintype" id="5405728">uint8</span><span class="op" id="5405733">(</span><span class="ident" id="5405734">c</span><span class="op" id="5405735">.</span><span class="ident" id="5405736">G</span><span class="op" id="5405737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405740">p</span><span class="op" id="5405741">.</span><span class="ident" id="5405742">Pix</span><span class="op" id="5405745">[</span><span class="ident" id="5405746">i</span><span class="op" id="5405747">+</span><span class="num" id="5405748">4</span><span class="op" id="5405749">]</span>&nbsp;<span class="op" id="5405751">=</span>&nbsp;<span class="builtintype" id="5405753">uint8</span><span class="op" id="5405758">(</span><span class="ident" id="5405759">c</span><span class="op" id="5405760">.</span><span class="ident" id="5405761">B</span>&nbsp;<span class="op" id="5405763">&gt;&gt;</span>&nbsp;<span class="num" id="5405766">8</span><span class="op" id="5405767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405770">p</span><span class="op" id="5405771">.</span><span class="ident" id="5405772">Pix</span><span class="op" id="5405775">[</span><span class="ident" id="5405776">i</span><span class="op" id="5405777">+</span><span class="num" id="5405778">5</span><span class="op" id="5405779">]</span>&nbsp;<span class="op" id="5405781">=</span>&nbsp;<span class="builtintype" id="5405783">uint8</span><span class="op" id="5405788">(</span><span class="ident" id="5405789">c</span><span class="op" id="5405790">.</span><span class="ident" id="5405791">B</span><span class="op" id="5405792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405795">p</span><span class="op" id="5405796">.</span><span class="ident" id="5405797">Pix</span><span class="op" id="5405800">[</span><span class="ident" id="5405801">i</span><span class="op" id="5405802">+</span><span class="num" id="5405803">6</span><span class="op" id="5405804">]</span>&nbsp;<span class="op" id="5405806">=</span>&nbsp;<span class="builtintype" id="5405808">uint8</span><span class="op" id="5405813">(</span><span class="ident" id="5405814">c</span><span class="op" id="5405815">.</span><span class="ident" id="5405816">A</span>&nbsp;<span class="op" id="5405818">&gt;&gt;</span>&nbsp;<span class="num" id="5405821">8</span><span class="op" id="5405822">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5405825">p</span><span class="op" id="5405826">.</span><span class="ident" id="5405827">Pix</span><span class="op" id="5405830">[</span><span class="ident" id="5405831">i</span><span class="op" id="5405832">+</span><span class="num" id="5405833">7</span><span class="op" id="5405834">]</span>&nbsp;<span class="op" id="5405836">=</span>&nbsp;<span class="builtintype" id="5405838">uint8</span><span class="op" id="5405843">(</span><span class="ident" id="5405844">c</span><span class="op" id="5405845">.</span><span class="ident" id="5405846">A</span><span class="op" id="5405847">)</span><br>
<span class="lineno"></span><span class="op" id="5405849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5405852">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5405929">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno">440</span><span class="keyword" id="5406001">func</span>&nbsp;<span class="op" id="5406006">(</span><span class="ident" id="5406007">p</span>&nbsp;<span class="op" id="5406009">*</span><span class="ident" id="5406010">NRGBA64</span><span class="op" id="5406017">)</span>&nbsp;<span class="ident" id="5406019">SubImage</span><span class="op" id="5406027">(</span><span class="ident" id="5406028">r</span>&nbsp;<span class="ident" id="5406030">Rectangle</span><span class="op" id="5406039">)</span>&nbsp;<span class="ident" id="5406041">Image</span>&nbsp;<span class="op" id="5406047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406050">r</span>&nbsp;<span class="op" id="5406052">=</span>&nbsp;<span class="ident" id="5406054">r</span><span class="op" id="5406055">.</span><span class="ident" id="5406056">Intersect</span><span class="op" id="5406065">(</span><span class="ident" id="5406066">p</span><span class="op" id="5406067">.</span><span class="ident" id="5406068">Rect</span><span class="op" id="5406072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406075">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406156">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5406238">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406288">if</span>&nbsp;<span class="ident" id="5406291">r</span><span class="op" id="5406292">.</span><span class="ident" id="5406293">Empty</span><span class="op" id="5406298">(</span><span class="op" id="5406299">)</span>&nbsp;<span class="op" id="5406301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406305">return</span>&nbsp;<span class="op" id="5406312">&amp;</span><span class="ident" id="5406313">NRGBA64</span><span class="op" id="5406320">{</span><span class="op" id="5406321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406327">i</span>&nbsp;<span class="op" id="5406329">:=</span>&nbsp;<span class="ident" id="5406332">p</span><span class="op" id="5406333">.</span><span class="ident" id="5406334">PixOffset</span><span class="op" id="5406343">(</span><span class="ident" id="5406344">r</span><span class="op" id="5406345">.</span><span class="ident" id="5406346">Min</span><span class="op" id="5406349">.</span><span class="ident" id="5406350">X</span><span class="op" id="5406351">,</span>&nbsp;<span class="ident" id="5406353">r</span><span class="op" id="5406354">.</span><span class="ident" id="5406355">Min</span><span class="op" id="5406358">.</span><span class="ident" id="5406359">Y</span><span class="op" id="5406360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406363">return</span>&nbsp;<span class="op" id="5406370">&amp;</span><span class="ident" id="5406371">NRGBA64</span><span class="op" id="5406378">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406382">Pix</span><span class="op" id="5406385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5406390">p</span><span class="op" id="5406391">.</span><span class="ident" id="5406392">Pix</span><span class="op" id="5406395">[</span><span class="ident" id="5406396">i</span><span class="op" id="5406397">:</span><span class="op" id="5406398">]</span><span class="op" id="5406399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406403">Stride</span><span class="op" id="5406409">:</span>&nbsp;<span class="ident" id="5406411">p</span><span class="op" id="5406412">.</span><span class="ident" id="5406413">Stride</span><span class="op" id="5406419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406423">Rect</span><span class="op" id="5406427">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5406431">r</span><span class="op" id="5406432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406435">}</span><br>
<span class="lineno"></span><span class="op" id="5406437">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5406440">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5406513">func</span>&nbsp;<span class="op" id="5406518">(</span><span class="ident" id="5406519">p</span>&nbsp;<span class="op" id="5406521">*</span><span class="ident" id="5406522">NRGBA64</span><span class="op" id="5406529">)</span>&nbsp;<span class="ident" id="5406531">Opaque</span><span class="op" id="5406537">(</span><span class="op" id="5406538">)</span>&nbsp;<span class="builtintype" id="5406540">bool</span>&nbsp;<span class="op" id="5406545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406548">if</span>&nbsp;<span class="ident" id="5406551">p</span><span class="op" id="5406552">.</span><span class="ident" id="5406553">Rect</span><span class="op" id="5406557">.</span><span class="ident" id="5406558">Empty</span><span class="op" id="5406563">(</span><span class="op" id="5406564">)</span>&nbsp;<span class="op" id="5406566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406570">return</span>&nbsp;<span class="builtintype" id="5406577">true</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406586">i0</span><span class="op" id="5406588">,</span>&nbsp;<span class="ident" id="5406590">i1</span>&nbsp;<span class="op" id="5406593">:=</span>&nbsp;<span class="num" id="5406596">6</span><span class="op" id="5406597">,</span>&nbsp;<span class="ident" id="5406599">p</span><span class="op" id="5406600">.</span><span class="ident" id="5406601">Rect</span><span class="op" id="5406605">.</span><span class="ident" id="5406606">Dx</span><span class="op" id="5406608">(</span><span class="op" id="5406609">)</span><span class="op" id="5406610">*</span><span class="num" id="5406611">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406614">for</span>&nbsp;<span class="ident" id="5406618">y</span>&nbsp;<span class="op" id="5406620">:=</span>&nbsp;<span class="ident" id="5406623">p</span><span class="op" id="5406624">.</span><span class="ident" id="5406625">Rect</span><span class="op" id="5406629">.</span><span class="ident" id="5406630">Min</span><span class="op" id="5406633">.</span><span class="ident" id="5406634">Y</span><span class="op" id="5406635">;</span>&nbsp;<span class="ident" id="5406637">y</span>&nbsp;<span class="op" id="5406639">&lt;</span>&nbsp;<span class="ident" id="5406641">p</span><span class="op" id="5406642">.</span><span class="ident" id="5406643">Rect</span><span class="op" id="5406647">.</span><span class="ident" id="5406648">Max</span><span class="op" id="5406651">.</span><span class="ident" id="5406652">Y</span><span class="op" id="5406653">;</span>&nbsp;<span class="ident" id="5406655">y</span><span class="op" id="5406656">++</span>&nbsp;<span class="op" id="5406659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406663">for</span>&nbsp;<span class="ident" id="5406667">i</span>&nbsp;<span class="op" id="5406669">:=</span>&nbsp;<span class="ident" id="5406672">i0</span><span class="op" id="5406674">;</span>&nbsp;<span class="ident" id="5406676">i</span>&nbsp;<span class="op" id="5406678">&lt;</span>&nbsp;<span class="ident" id="5406680">i1</span><span class="op" id="5406682">;</span>&nbsp;<span class="ident" id="5406684">i</span>&nbsp;<span class="op" id="5406686">+=</span>&nbsp;<span class="num" id="5406689">8</span>&nbsp;<span class="op" id="5406691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406696">if</span>&nbsp;<span class="ident" id="5406699">p</span><span class="op" id="5406700">.</span><span class="ident" id="5406701">Pix</span><span class="op" id="5406704">[</span><span class="ident" id="5406705">i</span><span class="op" id="5406706">+</span><span class="num" id="5406707">0</span><span class="op" id="5406708">]</span>&nbsp;<span class="op" id="5406710">!=</span>&nbsp;<span class="num" id="5406713">0xff</span>&nbsp;<span class="op" id="5406718">||</span>&nbsp;<span class="ident" id="5406721">p</span><span class="op" id="5406722">.</span><span class="ident" id="5406723">Pix</span><span class="op" id="5406726">[</span><span class="ident" id="5406727">i</span><span class="op" id="5406728">+</span><span class="num" id="5406729">1</span><span class="op" id="5406730">]</span>&nbsp;<span class="op" id="5406732">!=</span>&nbsp;<span class="num" id="5406735">0xff</span>&nbsp;<span class="op" id="5406740">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406746">return</span>&nbsp;<span class="builtintype" id="5406753">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406770">i0</span>&nbsp;<span class="op" id="5406773">+=</span>&nbsp;<span class="ident" id="5406776">p</span><span class="op" id="5406777">.</span><span class="ident" id="5406778">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406787">i1</span>&nbsp;<span class="op" id="5406790">+=</span>&nbsp;<span class="ident" id="5406793">p</span><span class="op" id="5406794">.</span><span class="ident" id="5406795">Stride</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5406803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406806">return</span>&nbsp;<span class="builtintype" id="5406813">true</span><br>
<span class="lineno"></span><span class="op" id="5406818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5406821">//&nbsp;NewNRGBA64&nbsp;returns&nbsp;a&nbsp;new&nbsp;NRGBA64&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno">475</span><span class="keyword" id="5406880">func</span>&nbsp;<span class="ident" id="5406885">NewNRGBA64</span><span class="op" id="5406895">(</span><span class="ident" id="5406896">r</span>&nbsp;<span class="ident" id="5406898">Rectangle</span><span class="op" id="5406907">)</span>&nbsp;<span class="op" id="5406909">*</span><span class="ident" id="5406910">NRGBA64</span>&nbsp;<span class="op" id="5406918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406921">w</span><span class="op" id="5406922">,</span>&nbsp;<span class="ident" id="5406924">h</span>&nbsp;<span class="op" id="5406926">:=</span>&nbsp;<span class="ident" id="5406929">r</span><span class="op" id="5406930">.</span><span class="ident" id="5406931">Dx</span><span class="op" id="5406933">(</span><span class="op" id="5406934">)</span><span class="op" id="5406935">,</span>&nbsp;<span class="ident" id="5406937">r</span><span class="op" id="5406938">.</span><span class="ident" id="5406939">Dy</span><span class="op" id="5406941">(</span><span class="op" id="5406942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5406945">pix</span>&nbsp;<span class="op" id="5406949">:=</span>&nbsp;<span class="builtinfunc" id="5406952">make</span><span class="op" id="5406956">(</span><span class="op" id="5406957">[</span><span class="op" id="5406958">]</span><span class="builtintype" id="5406959">uint8</span><span class="op" id="5406964">,</span>&nbsp;<span class="num" id="5406966">8</span><span class="op" id="5406967">*</span><span class="ident" id="5406968">w</span><span class="op" id="5406969">*</span><span class="ident" id="5406970">h</span><span class="op" id="5406971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5406974">return</span>&nbsp;<span class="op" id="5406981">&amp;</span><span class="ident" id="5406982">NRGBA64</span><span class="op" id="5406989">{</span><span class="ident" id="5406990">pix</span><span class="op" id="5406993">,</span>&nbsp;<span class="num" id="5406995">8</span>&nbsp;<span class="op" id="5406997">*</span>&nbsp;<span class="ident" id="5406999">w</span><span class="op" id="5407000">,</span>&nbsp;<span class="ident" id="5407002">r</span><span class="op" id="5407003">}</span><br>
<span class="lineno"></span><span class="op" id="5407005">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="5407008">//&nbsp;Alpha&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5407083">type</span>&nbsp;<span class="ident" id="5407088">Alpha</span>&nbsp;<span class="keyword" id="5407094">struct</span>&nbsp;<span class="op" id="5407101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407104">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407168">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407236">Pix</span>&nbsp;<span class="op" id="5407240">[</span><span class="op" id="5407241">]</span><span class="builtintype" id="5407242">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407249">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407325">Stride</span>&nbsp;<span class="builtintype" id="5407332">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5407337">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407369">Rect</span>&nbsp;<span class="ident" id="5407374">Rectangle</span><br>
<span class="lineno">490</span><span class="op" id="5407384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407387">func</span>&nbsp;<span class="op" id="5407392">(</span><span class="ident" id="5407393">p</span>&nbsp;<span class="op" id="5407395">*</span><span class="ident" id="5407396">Alpha</span><span class="op" id="5407401">)</span>&nbsp;<span class="ident" id="5407403">ColorModel</span><span class="op" id="5407413">(</span><span class="op" id="5407414">)</span>&nbsp;<span class="ident" id="5407416">color</span><span class="op" id="5407421">.</span><span class="ident" id="5407422">Model</span>&nbsp;<span class="op" id="5407428">{</span>&nbsp;<span class="keyword" id="5407430">return</span>&nbsp;<span class="ident" id="5407437">color</span><span class="op" id="5407442">.</span><span class="ident" id="5407443">AlphaModel</span>&nbsp;<span class="op" id="5407454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407457">func</span>&nbsp;<span class="op" id="5407462">(</span><span class="ident" id="5407463">p</span>&nbsp;<span class="op" id="5407465">*</span><span class="ident" id="5407466">Alpha</span><span class="op" id="5407471">)</span>&nbsp;<span class="ident" id="5407473">Bounds</span><span class="op" id="5407479">(</span><span class="op" id="5407480">)</span>&nbsp;<span class="ident" id="5407482">Rectangle</span>&nbsp;<span class="op" id="5407492">{</span>&nbsp;<span class="keyword" id="5407494">return</span>&nbsp;<span class="ident" id="5407501">p</span><span class="op" id="5407502">.</span><span class="ident" id="5407503">Rect</span>&nbsp;<span class="op" id="5407508">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="5407511">func</span>&nbsp;<span class="op" id="5407516">(</span><span class="ident" id="5407517">p</span>&nbsp;<span class="op" id="5407519">*</span><span class="ident" id="5407520">Alpha</span><span class="op" id="5407525">)</span>&nbsp;<span class="ident" id="5407527">At</span><span class="op" id="5407529">(</span><span class="ident" id="5407530">x</span><span class="op" id="5407531">,</span>&nbsp;<span class="ident" id="5407533">y</span>&nbsp;<span class="builtintype" id="5407535">int</span><span class="op" id="5407538">)</span>&nbsp;<span class="ident" id="5407540">color</span><span class="op" id="5407545">.</span><span class="ident" id="5407546">Color</span>&nbsp;<span class="op" id="5407552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407555">return</span>&nbsp;<span class="ident" id="5407562">p</span><span class="op" id="5407563">.</span><span class="ident" id="5407564">AlphaAt</span><span class="op" id="5407571">(</span><span class="ident" id="5407572">x</span><span class="op" id="5407573">,</span>&nbsp;<span class="ident" id="5407575">y</span><span class="op" id="5407576">)</span><br>
<span class="lineno"></span><span class="op" id="5407578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5407581">func</span>&nbsp;<span class="op" id="5407586">(</span><span class="ident" id="5407587">p</span>&nbsp;<span class="op" id="5407589">*</span><span class="ident" id="5407590">Alpha</span><span class="op" id="5407595">)</span>&nbsp;<span class="ident" id="5407597">AlphaAt</span><span class="op" id="5407604">(</span><span class="ident" id="5407605">x</span><span class="op" id="5407606">,</span>&nbsp;<span class="ident" id="5407608">y</span>&nbsp;<span class="builtintype" id="5407610">int</span><span class="op" id="5407613">)</span>&nbsp;<span class="ident" id="5407615">color</span><span class="op" id="5407620">.</span><span class="ident" id="5407621">Alpha</span>&nbsp;<span class="op" id="5407627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407630">if</span>&nbsp;<span class="op" id="5407633">!</span><span class="op" id="5407634">(</span><span class="ident" id="5407635">Point</span><span class="op" id="5407640">{</span><span class="ident" id="5407641">x</span><span class="op" id="5407642">,</span>&nbsp;<span class="ident" id="5407644">y</span><span class="op" id="5407645">}</span><span class="op" id="5407646">.</span><span class="ident" id="5407647">In</span><span class="op" id="5407649">(</span><span class="ident" id="5407650">p</span><span class="op" id="5407651">.</span><span class="ident" id="5407652">Rect</span><span class="op" id="5407656">)</span><span class="op" id="5407657">)</span>&nbsp;<span class="op" id="5407659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407663">return</span>&nbsp;<span class="ident" id="5407670">color</span><span class="op" id="5407675">.</span><span class="ident" id="5407676">Alpha</span><span class="op" id="5407681">{</span><span class="op" id="5407682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5407685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5407688">i</span>&nbsp;<span class="op" id="5407690">:=</span>&nbsp;<span class="ident" id="5407693">p</span><span class="op" id="5407694">.</span><span class="ident" id="5407695">PixOffset</span><span class="op" id="5407704">(</span><span class="ident" id="5407705">x</span><span class="op" id="5407706">,</span>&nbsp;<span class="ident" id="5407708">y</span><span class="op" id="5407709">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407712">return</span>&nbsp;<span class="ident" id="5407719">color</span><span class="op" id="5407724">.</span><span class="ident" id="5407725">Alpha</span><span class="op" id="5407730">{</span><span class="ident" id="5407731">p</span><span class="op" id="5407732">.</span><span class="ident" id="5407733">Pix</span><span class="op" id="5407736">[</span><span class="ident" id="5407737">i</span><span class="op" id="5407738">]</span><span class="op" id="5407739">}</span><br>
<span class="lineno"></span><span class="op" id="5407741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5407744">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5407823">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno">510</span><span class="keyword" id="5407847">func</span>&nbsp;<span class="op" id="5407852">(</span><span class="ident" id="5407853">p</span>&nbsp;<span class="op" id="5407855">*</span><span class="ident" id="5407856">Alpha</span><span class="op" id="5407861">)</span>&nbsp;<span class="ident" id="5407863">PixOffset</span><span class="op" id="5407872">(</span><span class="ident" id="5407873">x</span><span class="op" id="5407874">,</span>&nbsp;<span class="ident" id="5407876">y</span>&nbsp;<span class="builtintype" id="5407878">int</span><span class="op" id="5407881">)</span>&nbsp;<span class="builtintype" id="5407883">int</span>&nbsp;<span class="op" id="5407887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407890">return</span>&nbsp;<span class="op" id="5407897">(</span><span class="ident" id="5407898">y</span><span class="op" id="5407899">-</span><span class="ident" id="5407900">p</span><span class="op" id="5407901">.</span><span class="ident" id="5407902">Rect</span><span class="op" id="5407906">.</span><span class="ident" id="5407907">Min</span><span class="op" id="5407910">.</span><span class="ident" id="5407911">Y</span><span class="op" id="5407912">)</span><span class="op" id="5407913">*</span><span class="ident" id="5407914">p</span><span class="op" id="5407915">.</span><span class="ident" id="5407916">Stride</span>&nbsp;<span class="op" id="5407923">+</span>&nbsp;<span class="op" id="5407925">(</span><span class="ident" id="5407926">x</span><span class="op" id="5407927">-</span><span class="ident" id="5407928">p</span><span class="op" id="5407929">.</span><span class="ident" id="5407930">Rect</span><span class="op" id="5407934">.</span><span class="ident" id="5407935">Min</span><span class="op" id="5407938">.</span><span class="ident" id="5407939">X</span><span class="op" id="5407940">)</span><span class="op" id="5407941">*</span><span class="num" id="5407942">1</span><br>
<span class="lineno"></span><span class="op" id="5407944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5407947">func</span>&nbsp;<span class="op" id="5407952">(</span><span class="ident" id="5407953">p</span>&nbsp;<span class="op" id="5407955">*</span><span class="ident" id="5407956">Alpha</span><span class="op" id="5407961">)</span>&nbsp;<span class="ident" id="5407963">Set</span><span class="op" id="5407966">(</span><span class="ident" id="5407967">x</span><span class="op" id="5407968">,</span>&nbsp;<span class="ident" id="5407970">y</span>&nbsp;<span class="builtintype" id="5407972">int</span><span class="op" id="5407975">,</span>&nbsp;<span class="ident" id="5407977">c</span>&nbsp;<span class="ident" id="5407979">color</span><span class="op" id="5407984">.</span><span class="ident" id="5407985">Color</span><span class="op" id="5407990">)</span>&nbsp;<span class="op" id="5407992">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5407995">if</span>&nbsp;<span class="op" id="5407998">!</span><span class="op" id="5407999">(</span><span class="ident" id="5408000">Point</span><span class="op" id="5408005">{</span><span class="ident" id="5408006">x</span><span class="op" id="5408007">,</span>&nbsp;<span class="ident" id="5408009">y</span><span class="op" id="5408010">}</span><span class="op" id="5408011">.</span><span class="ident" id="5408012">In</span><span class="op" id="5408014">(</span><span class="ident" id="5408015">p</span><span class="op" id="5408016">.</span><span class="ident" id="5408017">Rect</span><span class="op" id="5408021">)</span><span class="op" id="5408022">)</span>&nbsp;<span class="op" id="5408024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408039">i</span>&nbsp;<span class="op" id="5408041">:=</span>&nbsp;<span class="ident" id="5408044">p</span><span class="op" id="5408045">.</span><span class="ident" id="5408046">PixOffset</span><span class="op" id="5408055">(</span><span class="ident" id="5408056">x</span><span class="op" id="5408057">,</span>&nbsp;<span class="ident" id="5408059">y</span><span class="op" id="5408060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408063">p</span><span class="op" id="5408064">.</span><span class="ident" id="5408065">Pix</span><span class="op" id="5408068">[</span><span class="ident" id="5408069">i</span><span class="op" id="5408070">]</span>&nbsp;<span class="op" id="5408072">=</span>&nbsp;<span class="ident" id="5408074">color</span><span class="op" id="5408079">.</span><span class="ident" id="5408080">AlphaModel</span><span class="op" id="5408090">.</span><span class="ident" id="5408091">Convert</span><span class="op" id="5408098">(</span><span class="ident" id="5408099">c</span><span class="op" id="5408100">)</span><span class="op" id="5408101">.</span><span class="op" id="5408102">(</span><span class="ident" id="5408103">color</span><span class="op" id="5408108">.</span><span class="ident" id="5408109">Alpha</span><span class="op" id="5408114">)</span><span class="op" id="5408115">.</span><span class="ident" id="5408116">A</span><br>
<span class="lineno">520</span><span class="op" id="5408118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5408121">func</span>&nbsp;<span class="op" id="5408126">(</span><span class="ident" id="5408127">p</span>&nbsp;<span class="op" id="5408129">*</span><span class="ident" id="5408130">Alpha</span><span class="op" id="5408135">)</span>&nbsp;<span class="ident" id="5408137">SetAlpha</span><span class="op" id="5408145">(</span><span class="ident" id="5408146">x</span><span class="op" id="5408147">,</span>&nbsp;<span class="ident" id="5408149">y</span>&nbsp;<span class="builtintype" id="5408151">int</span><span class="op" id="5408154">,</span>&nbsp;<span class="ident" id="5408156">c</span>&nbsp;<span class="ident" id="5408158">color</span><span class="op" id="5408163">.</span><span class="ident" id="5408164">Alpha</span><span class="op" id="5408169">)</span>&nbsp;<span class="op" id="5408171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408174">if</span>&nbsp;<span class="op" id="5408177">!</span><span class="op" id="5408178">(</span><span class="ident" id="5408179">Point</span><span class="op" id="5408184">{</span><span class="ident" id="5408185">x</span><span class="op" id="5408186">,</span>&nbsp;<span class="ident" id="5408188">y</span><span class="op" id="5408189">}</span><span class="op" id="5408190">.</span><span class="ident" id="5408191">In</span><span class="op" id="5408193">(</span><span class="ident" id="5408194">p</span><span class="op" id="5408195">.</span><span class="ident" id="5408196">Rect</span><span class="op" id="5408200">)</span><span class="op" id="5408201">)</span>&nbsp;<span class="op" id="5408203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408207">return</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408218">i</span>&nbsp;<span class="op" id="5408220">:=</span>&nbsp;<span class="ident" id="5408223">p</span><span class="op" id="5408224">.</span><span class="ident" id="5408225">PixOffset</span><span class="op" id="5408234">(</span><span class="ident" id="5408235">x</span><span class="op" id="5408236">,</span>&nbsp;<span class="ident" id="5408238">y</span><span class="op" id="5408239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408242">p</span><span class="op" id="5408243">.</span><span class="ident" id="5408244">Pix</span><span class="op" id="5408247">[</span><span class="ident" id="5408248">i</span><span class="op" id="5408249">]</span>&nbsp;<span class="op" id="5408251">=</span>&nbsp;<span class="ident" id="5408253">c</span><span class="op" id="5408254">.</span><span class="ident" id="5408255">A</span><br>
<span class="lineno"></span><span class="op" id="5408257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5408260">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5408337">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5408409">func</span>&nbsp;<span class="op" id="5408414">(</span><span class="ident" id="5408415">p</span>&nbsp;<span class="op" id="5408417">*</span><span class="ident" id="5408418">Alpha</span><span class="op" id="5408423">)</span>&nbsp;<span class="ident" id="5408425">SubImage</span><span class="op" id="5408433">(</span><span class="ident" id="5408434">r</span>&nbsp;<span class="ident" id="5408436">Rectangle</span><span class="op" id="5408445">)</span>&nbsp;<span class="ident" id="5408447">Image</span>&nbsp;<span class="op" id="5408453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408456">r</span>&nbsp;<span class="op" id="5408458">=</span>&nbsp;<span class="ident" id="5408460">r</span><span class="op" id="5408461">.</span><span class="ident" id="5408462">Intersect</span><span class="op" id="5408471">(</span><span class="ident" id="5408472">p</span><span class="op" id="5408473">.</span><span class="ident" id="5408474">Rect</span><span class="op" id="5408478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408481">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408562">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5408644">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408694">if</span>&nbsp;<span class="ident" id="5408697">r</span><span class="op" id="5408698">.</span><span class="ident" id="5408699">Empty</span><span class="op" id="5408704">(</span><span class="op" id="5408705">)</span>&nbsp;<span class="op" id="5408707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408711">return</span>&nbsp;<span class="op" id="5408718">&amp;</span><span class="ident" id="5408719">Alpha</span><span class="op" id="5408724">{</span><span class="op" id="5408725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408728">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408731">i</span>&nbsp;<span class="op" id="5408733">:=</span>&nbsp;<span class="ident" id="5408736">p</span><span class="op" id="5408737">.</span><span class="ident" id="5408738">PixOffset</span><span class="op" id="5408747">(</span><span class="ident" id="5408748">r</span><span class="op" id="5408749">.</span><span class="ident" id="5408750">Min</span><span class="op" id="5408753">.</span><span class="ident" id="5408754">X</span><span class="op" id="5408755">,</span>&nbsp;<span class="ident" id="5408757">r</span><span class="op" id="5408758">.</span><span class="ident" id="5408759">Min</span><span class="op" id="5408762">.</span><span class="ident" id="5408763">Y</span><span class="op" id="5408764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408767">return</span>&nbsp;<span class="op" id="5408774">&amp;</span><span class="ident" id="5408775">Alpha</span><span class="op" id="5408780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408784">Pix</span><span class="op" id="5408787">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5408792">p</span><span class="op" id="5408793">.</span><span class="ident" id="5408794">Pix</span><span class="op" id="5408797">[</span><span class="ident" id="5408798">i</span><span class="op" id="5408799">:</span><span class="op" id="5408800">]</span><span class="op" id="5408801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408805">Stride</span><span class="op" id="5408811">:</span>&nbsp;<span class="ident" id="5408813">p</span><span class="op" id="5408814">.</span><span class="ident" id="5408815">Stride</span><span class="op" id="5408821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408825">Rect</span><span class="op" id="5408829">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5408833">r</span><span class="op" id="5408834">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408837">}</span><br>
<span class="lineno"></span><span class="op" id="5408839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5408842">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5408915">func</span>&nbsp;<span class="op" id="5408920">(</span><span class="ident" id="5408921">p</span>&nbsp;<span class="op" id="5408923">*</span><span class="ident" id="5408924">Alpha</span><span class="op" id="5408929">)</span>&nbsp;<span class="ident" id="5408931">Opaque</span><span class="op" id="5408937">(</span><span class="op" id="5408938">)</span>&nbsp;<span class="builtintype" id="5408940">bool</span>&nbsp;<span class="op" id="5408945">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408948">if</span>&nbsp;<span class="ident" id="5408951">p</span><span class="op" id="5408952">.</span><span class="ident" id="5408953">Rect</span><span class="op" id="5408957">.</span><span class="ident" id="5408958">Empty</span><span class="op" id="5408963">(</span><span class="op" id="5408964">)</span>&nbsp;<span class="op" id="5408966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5408970">return</span>&nbsp;<span class="builtintype" id="5408977">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5408983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5408986">i0</span><span class="op" id="5408988">,</span>&nbsp;<span class="ident" id="5408990">i1</span>&nbsp;<span class="op" id="5408993">:=</span>&nbsp;<span class="num" id="5408996">0</span><span class="op" id="5408997">,</span>&nbsp;<span class="ident" id="5408999">p</span><span class="op" id="5409000">.</span><span class="ident" id="5409001">Rect</span><span class="op" id="5409005">.</span><span class="ident" id="5409006">Dx</span><span class="op" id="5409008">(</span><span class="op" id="5409009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409012">for</span>&nbsp;<span class="ident" id="5409016">y</span>&nbsp;<span class="op" id="5409018">:=</span>&nbsp;<span class="ident" id="5409021">p</span><span class="op" id="5409022">.</span><span class="ident" id="5409023">Rect</span><span class="op" id="5409027">.</span><span class="ident" id="5409028">Min</span><span class="op" id="5409031">.</span><span class="ident" id="5409032">Y</span><span class="op" id="5409033">;</span>&nbsp;<span class="ident" id="5409035">y</span>&nbsp;<span class="op" id="5409037">&lt;</span>&nbsp;<span class="ident" id="5409039">p</span><span class="op" id="5409040">.</span><span class="ident" id="5409041">Rect</span><span class="op" id="5409045">.</span><span class="ident" id="5409046">Max</span><span class="op" id="5409049">.</span><span class="ident" id="5409050">Y</span><span class="op" id="5409051">;</span>&nbsp;<span class="ident" id="5409053">y</span><span class="op" id="5409054">++</span>&nbsp;<span class="op" id="5409057">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409061">for</span>&nbsp;<span class="ident" id="5409065">i</span>&nbsp;<span class="op" id="5409067">:=</span>&nbsp;<span class="ident" id="5409070">i0</span><span class="op" id="5409072">;</span>&nbsp;<span class="ident" id="5409074">i</span>&nbsp;<span class="op" id="5409076">&lt;</span>&nbsp;<span class="ident" id="5409078">i1</span><span class="op" id="5409080">;</span>&nbsp;<span class="ident" id="5409082">i</span><span class="op" id="5409083">++</span>&nbsp;<span class="op" id="5409086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409091">if</span>&nbsp;<span class="ident" id="5409094">p</span><span class="op" id="5409095">.</span><span class="ident" id="5409096">Pix</span><span class="op" id="5409099">[</span><span class="ident" id="5409100">i</span><span class="op" id="5409101">]</span>&nbsp;<span class="op" id="5409103">!=</span>&nbsp;<span class="num" id="5409106">0xff</span>&nbsp;<span class="op" id="5409111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409117">return</span>&nbsp;<span class="builtintype" id="5409124">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409137">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409141">i0</span>&nbsp;<span class="op" id="5409144">+=</span>&nbsp;<span class="ident" id="5409147">p</span><span class="op" id="5409148">.</span><span class="ident" id="5409149">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409158">i1</span>&nbsp;<span class="op" id="5409161">+=</span>&nbsp;<span class="ident" id="5409164">p</span><span class="op" id="5409165">.</span><span class="ident" id="5409166">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5409174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409177">return</span>&nbsp;<span class="builtintype" id="5409184">true</span><br>
<span class="lineno"></span><span class="op" id="5409189">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5409192">//&nbsp;NewAlpha&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5409247">func</span>&nbsp;<span class="ident" id="5409252">NewAlpha</span><span class="op" id="5409260">(</span><span class="ident" id="5409261">r</span>&nbsp;<span class="ident" id="5409263">Rectangle</span><span class="op" id="5409272">)</span>&nbsp;<span class="op" id="5409274">*</span><span class="ident" id="5409275">Alpha</span>&nbsp;<span class="op" id="5409281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409284">w</span><span class="op" id="5409285">,</span>&nbsp;<span class="ident" id="5409287">h</span>&nbsp;<span class="op" id="5409289">:=</span>&nbsp;<span class="ident" id="5409292">r</span><span class="op" id="5409293">.</span><span class="ident" id="5409294">Dx</span><span class="op" id="5409296">(</span><span class="op" id="5409297">)</span><span class="op" id="5409298">,</span>&nbsp;<span class="ident" id="5409300">r</span><span class="op" id="5409301">.</span><span class="ident" id="5409302">Dy</span><span class="op" id="5409304">(</span><span class="op" id="5409305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409308">pix</span>&nbsp;<span class="op" id="5409312">:=</span>&nbsp;<span class="builtinfunc" id="5409315">make</span><span class="op" id="5409319">(</span><span class="op" id="5409320">[</span><span class="op" id="5409321">]</span><span class="builtintype" id="5409322">uint8</span><span class="op" id="5409327">,</span>&nbsp;<span class="num" id="5409329">1</span><span class="op" id="5409330">*</span><span class="ident" id="5409331">w</span><span class="op" id="5409332">*</span><span class="ident" id="5409333">h</span><span class="op" id="5409334">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409337">return</span>&nbsp;<span class="op" id="5409344">&amp;</span><span class="ident" id="5409345">Alpha</span><span class="op" id="5409350">{</span><span class="ident" id="5409351">pix</span><span class="op" id="5409354">,</span>&nbsp;<span class="num" id="5409356">1</span>&nbsp;<span class="op" id="5409358">*</span>&nbsp;<span class="ident" id="5409360">w</span><span class="op" id="5409361">,</span>&nbsp;<span class="ident" id="5409363">r</span><span class="op" id="5409364">}</span><br>
<span class="lineno"></span><span class="op" id="5409366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5409369">//&nbsp;Alpha16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Alpha64&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5409448">type</span>&nbsp;<span class="ident" id="5409453">Alpha16</span>&nbsp;<span class="keyword" id="5409461">struct</span>&nbsp;<span class="op" id="5409468">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409471">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;alpha&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409556">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409624">Pix</span>&nbsp;<span class="op" id="5409628">[</span><span class="op" id="5409629">]</span><span class="builtintype" id="5409630">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409637">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409713">Stride</span>&nbsp;<span class="builtintype" id="5409720">int</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5409725">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5409757">Rect</span>&nbsp;<span class="ident" id="5409762">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5409772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409775">func</span>&nbsp;<span class="op" id="5409780">(</span><span class="ident" id="5409781">p</span>&nbsp;<span class="op" id="5409783">*</span><span class="ident" id="5409784">Alpha16</span><span class="op" id="5409791">)</span>&nbsp;<span class="ident" id="5409793">ColorModel</span><span class="op" id="5409803">(</span><span class="op" id="5409804">)</span>&nbsp;<span class="ident" id="5409806">color</span><span class="op" id="5409811">.</span><span class="ident" id="5409812">Model</span>&nbsp;<span class="op" id="5409818">{</span>&nbsp;<span class="keyword" id="5409820">return</span>&nbsp;<span class="ident" id="5409827">color</span><span class="op" id="5409832">.</span><span class="ident" id="5409833">Alpha16Model</span>&nbsp;<span class="op" id="5409846">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="keyword" id="5409849">func</span>&nbsp;<span class="op" id="5409854">(</span><span class="ident" id="5409855">p</span>&nbsp;<span class="op" id="5409857">*</span><span class="ident" id="5409858">Alpha16</span><span class="op" id="5409865">)</span>&nbsp;<span class="ident" id="5409867">Bounds</span><span class="op" id="5409873">(</span><span class="op" id="5409874">)</span>&nbsp;<span class="ident" id="5409876">Rectangle</span>&nbsp;<span class="op" id="5409886">{</span>&nbsp;<span class="keyword" id="5409888">return</span>&nbsp;<span class="ident" id="5409895">p</span><span class="op" id="5409896">.</span><span class="ident" id="5409897">Rect</span>&nbsp;<span class="op" id="5409902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409905">func</span>&nbsp;<span class="op" id="5409910">(</span><span class="ident" id="5409911">p</span>&nbsp;<span class="op" id="5409913">*</span><span class="ident" id="5409914">Alpha16</span><span class="op" id="5409921">)</span>&nbsp;<span class="ident" id="5409923">At</span><span class="op" id="5409925">(</span><span class="ident" id="5409926">x</span><span class="op" id="5409927">,</span>&nbsp;<span class="ident" id="5409929">y</span>&nbsp;<span class="builtintype" id="5409931">int</span><span class="op" id="5409934">)</span>&nbsp;<span class="ident" id="5409936">color</span><span class="op" id="5409941">.</span><span class="ident" id="5409942">Color</span>&nbsp;<span class="op" id="5409948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5409951">return</span>&nbsp;<span class="ident" id="5409958">p</span><span class="op" id="5409959">.</span><span class="ident" id="5409960">Alpha16At</span><span class="op" id="5409969">(</span><span class="ident" id="5409970">x</span><span class="op" id="5409971">,</span>&nbsp;<span class="ident" id="5409973">y</span><span class="op" id="5409974">)</span><br>
<span class="lineno">590</span><span class="op" id="5409976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5409979">func</span>&nbsp;<span class="op" id="5409984">(</span><span class="ident" id="5409985">p</span>&nbsp;<span class="op" id="5409987">*</span><span class="ident" id="5409988">Alpha16</span><span class="op" id="5409995">)</span>&nbsp;<span class="ident" id="5409997">Alpha16At</span><span class="op" id="5410006">(</span><span class="ident" id="5410007">x</span><span class="op" id="5410008">,</span>&nbsp;<span class="ident" id="5410010">y</span>&nbsp;<span class="builtintype" id="5410012">int</span><span class="op" id="5410015">)</span>&nbsp;<span class="ident" id="5410017">color</span><span class="op" id="5410022">.</span><span class="ident" id="5410023">Alpha16</span>&nbsp;<span class="op" id="5410031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410034">if</span>&nbsp;<span class="op" id="5410037">!</span><span class="op" id="5410038">(</span><span class="ident" id="5410039">Point</span><span class="op" id="5410044">{</span><span class="ident" id="5410045">x</span><span class="op" id="5410046">,</span>&nbsp;<span class="ident" id="5410048">y</span><span class="op" id="5410049">}</span><span class="op" id="5410050">.</span><span class="ident" id="5410051">In</span><span class="op" id="5410053">(</span><span class="ident" id="5410054">p</span><span class="op" id="5410055">.</span><span class="ident" id="5410056">Rect</span><span class="op" id="5410060">)</span><span class="op" id="5410061">)</span>&nbsp;<span class="op" id="5410063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410067">return</span>&nbsp;<span class="ident" id="5410074">color</span><span class="op" id="5410079">.</span><span class="ident" id="5410080">Alpha16</span><span class="op" id="5410087">{</span><span class="op" id="5410088">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410094">i</span>&nbsp;<span class="op" id="5410096">:=</span>&nbsp;<span class="ident" id="5410099">p</span><span class="op" id="5410100">.</span><span class="ident" id="5410101">PixOffset</span><span class="op" id="5410110">(</span><span class="ident" id="5410111">x</span><span class="op" id="5410112">,</span>&nbsp;<span class="ident" id="5410114">y</span><span class="op" id="5410115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410118">return</span>&nbsp;<span class="ident" id="5410125">color</span><span class="op" id="5410130">.</span><span class="ident" id="5410131">Alpha16</span><span class="op" id="5410138">{</span><span class="builtintype" id="5410139">uint16</span><span class="op" id="5410145">(</span><span class="ident" id="5410146">p</span><span class="op" id="5410147">.</span><span class="ident" id="5410148">Pix</span><span class="op" id="5410151">[</span><span class="ident" id="5410152">i</span><span class="op" id="5410153">+</span><span class="num" id="5410154">0</span><span class="op" id="5410155">]</span><span class="op" id="5410156">)</span><span class="op" id="5410157">&lt;&lt;</span><span class="num" id="5410159">8</span>&nbsp;<span class="op" id="5410161">|</span>&nbsp;<span class="builtintype" id="5410163">uint16</span><span class="op" id="5410169">(</span><span class="ident" id="5410170">p</span><span class="op" id="5410171">.</span><span class="ident" id="5410172">Pix</span><span class="op" id="5410175">[</span><span class="ident" id="5410176">i</span><span class="op" id="5410177">+</span><span class="num" id="5410178">1</span><span class="op" id="5410179">]</span><span class="op" id="5410180">)</span><span class="op" id="5410181">}</span><br>
<span class="lineno"></span><span class="op" id="5410183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="comment" id="5410186">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5410265">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5410289">func</span>&nbsp;<span class="op" id="5410294">(</span><span class="ident" id="5410295">p</span>&nbsp;<span class="op" id="5410297">*</span><span class="ident" id="5410298">Alpha16</span><span class="op" id="5410305">)</span>&nbsp;<span class="ident" id="5410307">PixOffset</span><span class="op" id="5410316">(</span><span class="ident" id="5410317">x</span><span class="op" id="5410318">,</span>&nbsp;<span class="ident" id="5410320">y</span>&nbsp;<span class="builtintype" id="5410322">int</span><span class="op" id="5410325">)</span>&nbsp;<span class="builtintype" id="5410327">int</span>&nbsp;<span class="op" id="5410331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410334">return</span>&nbsp;<span class="op" id="5410341">(</span><span class="ident" id="5410342">y</span><span class="op" id="5410343">-</span><span class="ident" id="5410344">p</span><span class="op" id="5410345">.</span><span class="ident" id="5410346">Rect</span><span class="op" id="5410350">.</span><span class="ident" id="5410351">Min</span><span class="op" id="5410354">.</span><span class="ident" id="5410355">Y</span><span class="op" id="5410356">)</span><span class="op" id="5410357">*</span><span class="ident" id="5410358">p</span><span class="op" id="5410359">.</span><span class="ident" id="5410360">Stride</span>&nbsp;<span class="op" id="5410367">+</span>&nbsp;<span class="op" id="5410369">(</span><span class="ident" id="5410370">x</span><span class="op" id="5410371">-</span><span class="ident" id="5410372">p</span><span class="op" id="5410373">.</span><span class="ident" id="5410374">Rect</span><span class="op" id="5410378">.</span><span class="ident" id="5410379">Min</span><span class="op" id="5410382">.</span><span class="ident" id="5410383">X</span><span class="op" id="5410384">)</span><span class="op" id="5410385">*</span><span class="num" id="5410386">2</span><br>
<span class="lineno"></span><span class="op" id="5410388">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span><span class="keyword" id="5410391">func</span>&nbsp;<span class="op" id="5410396">(</span><span class="ident" id="5410397">p</span>&nbsp;<span class="op" id="5410399">*</span><span class="ident" id="5410400">Alpha16</span><span class="op" id="5410407">)</span>&nbsp;<span class="ident" id="5410409">Set</span><span class="op" id="5410412">(</span><span class="ident" id="5410413">x</span><span class="op" id="5410414">,</span>&nbsp;<span class="ident" id="5410416">y</span>&nbsp;<span class="builtintype" id="5410418">int</span><span class="op" id="5410421">,</span>&nbsp;<span class="ident" id="5410423">c</span>&nbsp;<span class="ident" id="5410425">color</span><span class="op" id="5410430">.</span><span class="ident" id="5410431">Color</span><span class="op" id="5410436">)</span>&nbsp;<span class="op" id="5410438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410441">if</span>&nbsp;<span class="op" id="5410444">!</span><span class="op" id="5410445">(</span><span class="ident" id="5410446">Point</span><span class="op" id="5410451">{</span><span class="ident" id="5410452">x</span><span class="op" id="5410453">,</span>&nbsp;<span class="ident" id="5410455">y</span><span class="op" id="5410456">}</span><span class="op" id="5410457">.</span><span class="ident" id="5410458">In</span><span class="op" id="5410460">(</span><span class="ident" id="5410461">p</span><span class="op" id="5410462">.</span><span class="ident" id="5410463">Rect</span><span class="op" id="5410467">)</span><span class="op" id="5410468">)</span>&nbsp;<span class="op" id="5410470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410474">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410482">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410485">i</span>&nbsp;<span class="op" id="5410487">:=</span>&nbsp;<span class="ident" id="5410490">p</span><span class="op" id="5410491">.</span><span class="ident" id="5410492">PixOffset</span><span class="op" id="5410501">(</span><span class="ident" id="5410502">x</span><span class="op" id="5410503">,</span>&nbsp;<span class="ident" id="5410505">y</span><span class="op" id="5410506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410509">c1</span>&nbsp;<span class="op" id="5410512">:=</span>&nbsp;<span class="ident" id="5410515">color</span><span class="op" id="5410520">.</span><span class="ident" id="5410521">Alpha16Model</span><span class="op" id="5410533">.</span><span class="ident" id="5410534">Convert</span><span class="op" id="5410541">(</span><span class="ident" id="5410542">c</span><span class="op" id="5410543">)</span><span class="op" id="5410544">.</span><span class="op" id="5410545">(</span><span class="ident" id="5410546">color</span><span class="op" id="5410551">.</span><span class="ident" id="5410552">Alpha16</span><span class="op" id="5410559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410562">p</span><span class="op" id="5410563">.</span><span class="ident" id="5410564">Pix</span><span class="op" id="5410567">[</span><span class="ident" id="5410568">i</span><span class="op" id="5410569">+</span><span class="num" id="5410570">0</span><span class="op" id="5410571">]</span>&nbsp;<span class="op" id="5410573">=</span>&nbsp;<span class="builtintype" id="5410575">uint8</span><span class="op" id="5410580">(</span><span class="ident" id="5410581">c1</span><span class="op" id="5410583">.</span><span class="ident" id="5410584">A</span>&nbsp;<span class="op" id="5410586">&gt;&gt;</span>&nbsp;<span class="num" id="5410589">8</span><span class="op" id="5410590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410593">p</span><span class="op" id="5410594">.</span><span class="ident" id="5410595">Pix</span><span class="op" id="5410598">[</span><span class="ident" id="5410599">i</span><span class="op" id="5410600">+</span><span class="num" id="5410601">1</span><span class="op" id="5410602">]</span>&nbsp;<span class="op" id="5410604">=</span>&nbsp;<span class="builtintype" id="5410606">uint8</span><span class="op" id="5410611">(</span><span class="ident" id="5410612">c1</span><span class="op" id="5410614">.</span><span class="ident" id="5410615">A</span><span class="op" id="5410616">)</span><br>
<span class="lineno"></span><span class="op" id="5410618">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5410621">func</span>&nbsp;<span class="op" id="5410626">(</span><span class="ident" id="5410627">p</span>&nbsp;<span class="op" id="5410629">*</span><span class="ident" id="5410630">Alpha16</span><span class="op" id="5410637">)</span>&nbsp;<span class="ident" id="5410639">SetAlpha16</span><span class="op" id="5410649">(</span><span class="ident" id="5410650">x</span><span class="op" id="5410651">,</span>&nbsp;<span class="ident" id="5410653">y</span>&nbsp;<span class="builtintype" id="5410655">int</span><span class="op" id="5410658">,</span>&nbsp;<span class="ident" id="5410660">c</span>&nbsp;<span class="ident" id="5410662">color</span><span class="op" id="5410667">.</span><span class="ident" id="5410668">Alpha16</span><span class="op" id="5410675">)</span>&nbsp;<span class="op" id="5410677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410680">if</span>&nbsp;<span class="op" id="5410683">!</span><span class="op" id="5410684">(</span><span class="ident" id="5410685">Point</span><span class="op" id="5410690">{</span><span class="ident" id="5410691">x</span><span class="op" id="5410692">,</span>&nbsp;<span class="ident" id="5410694">y</span><span class="op" id="5410695">}</span><span class="op" id="5410696">.</span><span class="ident" id="5410697">In</span><span class="op" id="5410699">(</span><span class="ident" id="5410700">p</span><span class="op" id="5410701">.</span><span class="ident" id="5410702">Rect</span><span class="op" id="5410706">)</span><span class="op" id="5410707">)</span>&nbsp;<span class="op" id="5410709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5410713">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5410721">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410724">i</span>&nbsp;<span class="op" id="5410726">:=</span>&nbsp;<span class="ident" id="5410729">p</span><span class="op" id="5410730">.</span><span class="ident" id="5410731">PixOffset</span><span class="op" id="5410740">(</span><span class="ident" id="5410741">x</span><span class="op" id="5410742">,</span>&nbsp;<span class="ident" id="5410744">y</span><span class="op" id="5410745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410748">p</span><span class="op" id="5410749">.</span><span class="ident" id="5410750">Pix</span><span class="op" id="5410753">[</span><span class="ident" id="5410754">i</span><span class="op" id="5410755">+</span><span class="num" id="5410756">0</span><span class="op" id="5410757">]</span>&nbsp;<span class="op" id="5410759">=</span>&nbsp;<span class="builtintype" id="5410761">uint8</span><span class="op" id="5410766">(</span><span class="ident" id="5410767">c</span><span class="op" id="5410768">.</span><span class="ident" id="5410769">A</span>&nbsp;<span class="op" id="5410771">&gt;&gt;</span>&nbsp;<span class="num" id="5410774">8</span><span class="op" id="5410775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5410778">p</span><span class="op" id="5410779">.</span><span class="ident" id="5410780">Pix</span><span class="op" id="5410783">[</span><span class="ident" id="5410784">i</span><span class="op" id="5410785">+</span><span class="num" id="5410786">1</span><span class="op" id="5410787">]</span>&nbsp;<span class="op" id="5410789">=</span>&nbsp;<span class="builtintype" id="5410791">uint8</span><span class="op" id="5410796">(</span><span class="ident" id="5410797">c</span><span class="op" id="5410798">.</span><span class="ident" id="5410799">A</span><span class="op" id="5410800">)</span><br>
<span class="lineno"></span><span class="op" id="5410802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="5410805">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5410882">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5410954">func</span>&nbsp;<span class="op" id="5410959">(</span><span class="ident" id="5410960">p</span>&nbsp;<span class="op" id="5410962">*</span><span class="ident" id="5410963">Alpha16</span><span class="op" id="5410970">)</span>&nbsp;<span class="ident" id="5410972">SubImage</span><span class="op" id="5410980">(</span><span class="ident" id="5410981">r</span>&nbsp;<span class="ident" id="5410983">Rectangle</span><span class="op" id="5410992">)</span>&nbsp;<span class="ident" id="5410994">Image</span>&nbsp;<span class="op" id="5411000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411003">r</span>&nbsp;<span class="op" id="5411005">=</span>&nbsp;<span class="ident" id="5411007">r</span><span class="op" id="5411008">.</span><span class="ident" id="5411009">Intersect</span><span class="op" id="5411018">(</span><span class="ident" id="5411019">p</span><span class="op" id="5411020">.</span><span class="ident" id="5411021">Rect</span><span class="op" id="5411025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411028">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411109">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5411191">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411241">if</span>&nbsp;<span class="ident" id="5411244">r</span><span class="op" id="5411245">.</span><span class="ident" id="5411246">Empty</span><span class="op" id="5411251">(</span><span class="op" id="5411252">)</span>&nbsp;<span class="op" id="5411254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411258">return</span>&nbsp;<span class="op" id="5411265">&amp;</span><span class="ident" id="5411266">Alpha16</span><span class="op" id="5411273">{</span><span class="op" id="5411274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411277">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411280">i</span>&nbsp;<span class="op" id="5411282">:=</span>&nbsp;<span class="ident" id="5411285">p</span><span class="op" id="5411286">.</span><span class="ident" id="5411287">PixOffset</span><span class="op" id="5411296">(</span><span class="ident" id="5411297">r</span><span class="op" id="5411298">.</span><span class="ident" id="5411299">Min</span><span class="op" id="5411302">.</span><span class="ident" id="5411303">X</span><span class="op" id="5411304">,</span>&nbsp;<span class="ident" id="5411306">r</span><span class="op" id="5411307">.</span><span class="ident" id="5411308">Min</span><span class="op" id="5411311">.</span><span class="ident" id="5411312">Y</span><span class="op" id="5411313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411316">return</span>&nbsp;<span class="op" id="5411323">&amp;</span><span class="ident" id="5411324">Alpha16</span><span class="op" id="5411331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411335">Pix</span><span class="op" id="5411338">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5411343">p</span><span class="op" id="5411344">.</span><span class="ident" id="5411345">Pix</span><span class="op" id="5411348">[</span><span class="ident" id="5411349">i</span><span class="op" id="5411350">:</span><span class="op" id="5411351">]</span><span class="op" id="5411352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411356">Stride</span><span class="op" id="5411362">:</span>&nbsp;<span class="ident" id="5411364">p</span><span class="op" id="5411365">.</span><span class="ident" id="5411366">Stride</span><span class="op" id="5411372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411376">Rect</span><span class="op" id="5411380">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5411384">r</span><span class="op" id="5411385">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411388">}</span><br>
<span class="lineno"></span><span class="op" id="5411390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5411393">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5411466">func</span>&nbsp;<span class="op" id="5411471">(</span><span class="ident" id="5411472">p</span>&nbsp;<span class="op" id="5411474">*</span><span class="ident" id="5411475">Alpha16</span><span class="op" id="5411482">)</span>&nbsp;<span class="ident" id="5411484">Opaque</span><span class="op" id="5411490">(</span><span class="op" id="5411491">)</span>&nbsp;<span class="builtintype" id="5411493">bool</span>&nbsp;<span class="op" id="5411498">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411501">if</span>&nbsp;<span class="ident" id="5411504">p</span><span class="op" id="5411505">.</span><span class="ident" id="5411506">Rect</span><span class="op" id="5411510">.</span><span class="ident" id="5411511">Empty</span><span class="op" id="5411516">(</span><span class="op" id="5411517">)</span>&nbsp;<span class="op" id="5411519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411523">return</span>&nbsp;<span class="builtintype" id="5411530">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411539">i0</span><span class="op" id="5411541">,</span>&nbsp;<span class="ident" id="5411543">i1</span>&nbsp;<span class="op" id="5411546">:=</span>&nbsp;<span class="num" id="5411549">0</span><span class="op" id="5411550">,</span>&nbsp;<span class="ident" id="5411552">p</span><span class="op" id="5411553">.</span><span class="ident" id="5411554">Rect</span><span class="op" id="5411558">.</span><span class="ident" id="5411559">Dx</span><span class="op" id="5411561">(</span><span class="op" id="5411562">)</span><span class="op" id="5411563">*</span><span class="num" id="5411564">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411567">for</span>&nbsp;<span class="ident" id="5411571">y</span>&nbsp;<span class="op" id="5411573">:=</span>&nbsp;<span class="ident" id="5411576">p</span><span class="op" id="5411577">.</span><span class="ident" id="5411578">Rect</span><span class="op" id="5411582">.</span><span class="ident" id="5411583">Min</span><span class="op" id="5411586">.</span><span class="ident" id="5411587">Y</span><span class="op" id="5411588">;</span>&nbsp;<span class="ident" id="5411590">y</span>&nbsp;<span class="op" id="5411592">&lt;</span>&nbsp;<span class="ident" id="5411594">p</span><span class="op" id="5411595">.</span><span class="ident" id="5411596">Rect</span><span class="op" id="5411600">.</span><span class="ident" id="5411601">Max</span><span class="op" id="5411604">.</span><span class="ident" id="5411605">Y</span><span class="op" id="5411606">;</span>&nbsp;<span class="ident" id="5411608">y</span><span class="op" id="5411609">++</span>&nbsp;<span class="op" id="5411612">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411616">for</span>&nbsp;<span class="ident" id="5411620">i</span>&nbsp;<span class="op" id="5411622">:=</span>&nbsp;<span class="ident" id="5411625">i0</span><span class="op" id="5411627">;</span>&nbsp;<span class="ident" id="5411629">i</span>&nbsp;<span class="op" id="5411631">&lt;</span>&nbsp;<span class="ident" id="5411633">i1</span><span class="op" id="5411635">;</span>&nbsp;<span class="ident" id="5411637">i</span>&nbsp;<span class="op" id="5411639">+=</span>&nbsp;<span class="num" id="5411642">2</span>&nbsp;<span class="op" id="5411644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411649">if</span>&nbsp;<span class="ident" id="5411652">p</span><span class="op" id="5411653">.</span><span class="ident" id="5411654">Pix</span><span class="op" id="5411657">[</span><span class="ident" id="5411658">i</span><span class="op" id="5411659">+</span><span class="num" id="5411660">0</span><span class="op" id="5411661">]</span>&nbsp;<span class="op" id="5411663">!=</span>&nbsp;<span class="num" id="5411666">0xff</span>&nbsp;<span class="op" id="5411671">||</span>&nbsp;<span class="ident" id="5411674">p</span><span class="op" id="5411675">.</span><span class="ident" id="5411676">Pix</span><span class="op" id="5411679">[</span><span class="ident" id="5411680">i</span><span class="op" id="5411681">+</span><span class="num" id="5411682">1</span><span class="op" id="5411683">]</span>&nbsp;<span class="op" id="5411685">!=</span>&nbsp;<span class="num" id="5411688">0xff</span>&nbsp;<span class="op" id="5411693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411699">return</span>&nbsp;<span class="builtintype" id="5411706">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411719">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411723">i0</span>&nbsp;<span class="op" id="5411726">+=</span>&nbsp;<span class="ident" id="5411729">p</span><span class="op" id="5411730">.</span><span class="ident" id="5411731">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411740">i1</span>&nbsp;<span class="op" id="5411743">+=</span>&nbsp;<span class="ident" id="5411746">p</span><span class="op" id="5411747">.</span><span class="ident" id="5411748">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5411756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411759">return</span>&nbsp;<span class="builtintype" id="5411766">true</span><br>
<span class="lineno"></span><span class="op" id="5411771">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="5411774">//&nbsp;NewAlpha16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Alpha16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5411833">func</span>&nbsp;<span class="ident" id="5411838">NewAlpha16</span><span class="op" id="5411848">(</span><span class="ident" id="5411849">r</span>&nbsp;<span class="ident" id="5411851">Rectangle</span><span class="op" id="5411860">)</span>&nbsp;<span class="op" id="5411862">*</span><span class="ident" id="5411863">Alpha16</span>&nbsp;<span class="op" id="5411871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411874">w</span><span class="op" id="5411875">,</span>&nbsp;<span class="ident" id="5411877">h</span>&nbsp;<span class="op" id="5411879">:=</span>&nbsp;<span class="ident" id="5411882">r</span><span class="op" id="5411883">.</span><span class="ident" id="5411884">Dx</span><span class="op" id="5411886">(</span><span class="op" id="5411887">)</span><span class="op" id="5411888">,</span>&nbsp;<span class="ident" id="5411890">r</span><span class="op" id="5411891">.</span><span class="ident" id="5411892">Dy</span><span class="op" id="5411894">(</span><span class="op" id="5411895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5411898">pix</span>&nbsp;<span class="op" id="5411902">:=</span>&nbsp;<span class="builtinfunc" id="5411905">make</span><span class="op" id="5411909">(</span><span class="op" id="5411910">[</span><span class="op" id="5411911">]</span><span class="builtintype" id="5411912">uint8</span><span class="op" id="5411917">,</span>&nbsp;<span class="num" id="5411919">2</span><span class="op" id="5411920">*</span><span class="ident" id="5411921">w</span><span class="op" id="5411922">*</span><span class="ident" id="5411923">h</span><span class="op" id="5411924">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5411927">return</span>&nbsp;<span class="op" id="5411934">&amp;</span><span class="ident" id="5411935">Alpha16</span><span class="op" id="5411942">{</span><span class="ident" id="5411943">pix</span><span class="op" id="5411946">,</span>&nbsp;<span class="num" id="5411948">2</span>&nbsp;<span class="op" id="5411950">*</span>&nbsp;<span class="ident" id="5411952">w</span><span class="op" id="5411953">,</span>&nbsp;<span class="ident" id="5411955">r</span><span class="op" id="5411956">}</span><br>
<span class="lineno"></span><span class="op" id="5411958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5411961">//&nbsp;Gray&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5412034">type</span>&nbsp;<span class="ident" id="5412039">Gray</span>&nbsp;<span class="keyword" id="5412044">struct</span>&nbsp;<span class="op" id="5412051">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412054">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412117">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412185">Pix</span>&nbsp;<span class="op" id="5412189">[</span><span class="op" id="5412190">]</span><span class="builtintype" id="5412191">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412198">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412274">Stride</span>&nbsp;<span class="builtintype" id="5412281">int</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5412286">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412318">Rect</span>&nbsp;<span class="ident" id="5412323">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5412333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5412336">func</span>&nbsp;<span class="op" id="5412341">(</span><span class="ident" id="5412342">p</span>&nbsp;<span class="op" id="5412344">*</span><span class="ident" id="5412345">Gray</span><span class="op" id="5412349">)</span>&nbsp;<span class="ident" id="5412351">ColorModel</span><span class="op" id="5412361">(</span><span class="op" id="5412362">)</span>&nbsp;<span class="ident" id="5412364">color</span><span class="op" id="5412369">.</span><span class="ident" id="5412370">Model</span>&nbsp;<span class="op" id="5412376">{</span>&nbsp;<span class="keyword" id="5412378">return</span>&nbsp;<span class="ident" id="5412385">color</span><span class="op" id="5412390">.</span><span class="ident" id="5412391">GrayModel</span>&nbsp;<span class="op" id="5412401">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="5412404">func</span>&nbsp;<span class="op" id="5412409">(</span><span class="ident" id="5412410">p</span>&nbsp;<span class="op" id="5412412">*</span><span class="ident" id="5412413">Gray</span><span class="op" id="5412417">)</span>&nbsp;<span class="ident" id="5412419">Bounds</span><span class="op" id="5412425">(</span><span class="op" id="5412426">)</span>&nbsp;<span class="ident" id="5412428">Rectangle</span>&nbsp;<span class="op" id="5412438">{</span>&nbsp;<span class="keyword" id="5412440">return</span>&nbsp;<span class="ident" id="5412447">p</span><span class="op" id="5412448">.</span><span class="ident" id="5412449">Rect</span>&nbsp;<span class="op" id="5412454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5412457">func</span>&nbsp;<span class="op" id="5412462">(</span><span class="ident" id="5412463">p</span>&nbsp;<span class="op" id="5412465">*</span><span class="ident" id="5412466">Gray</span><span class="op" id="5412470">)</span>&nbsp;<span class="ident" id="5412472">At</span><span class="op" id="5412474">(</span><span class="ident" id="5412475">x</span><span class="op" id="5412476">,</span>&nbsp;<span class="ident" id="5412478">y</span>&nbsp;<span class="builtintype" id="5412480">int</span><span class="op" id="5412483">)</span>&nbsp;<span class="ident" id="5412485">color</span><span class="op" id="5412490">.</span><span class="ident" id="5412491">Color</span>&nbsp;<span class="op" id="5412497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412500">return</span>&nbsp;<span class="ident" id="5412507">p</span><span class="op" id="5412508">.</span><span class="ident" id="5412509">GrayAt</span><span class="op" id="5412515">(</span><span class="ident" id="5412516">x</span><span class="op" id="5412517">,</span>&nbsp;<span class="ident" id="5412519">y</span><span class="op" id="5412520">)</span><br>
<span class="lineno">685</span><span class="op" id="5412522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5412525">func</span>&nbsp;<span class="op" id="5412530">(</span><span class="ident" id="5412531">p</span>&nbsp;<span class="op" id="5412533">*</span><span class="ident" id="5412534">Gray</span><span class="op" id="5412538">)</span>&nbsp;<span class="ident" id="5412540">GrayAt</span><span class="op" id="5412546">(</span><span class="ident" id="5412547">x</span><span class="op" id="5412548">,</span>&nbsp;<span class="ident" id="5412550">y</span>&nbsp;<span class="builtintype" id="5412552">int</span><span class="op" id="5412555">)</span>&nbsp;<span class="ident" id="5412557">color</span><span class="op" id="5412562">.</span><span class="ident" id="5412563">Gray</span>&nbsp;<span class="op" id="5412568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412571">if</span>&nbsp;<span class="op" id="5412574">!</span><span class="op" id="5412575">(</span><span class="ident" id="5412576">Point</span><span class="op" id="5412581">{</span><span class="ident" id="5412582">x</span><span class="op" id="5412583">,</span>&nbsp;<span class="ident" id="5412585">y</span><span class="op" id="5412586">}</span><span class="op" id="5412587">.</span><span class="ident" id="5412588">In</span><span class="op" id="5412590">(</span><span class="ident" id="5412591">p</span><span class="op" id="5412592">.</span><span class="ident" id="5412593">Rect</span><span class="op" id="5412597">)</span><span class="op" id="5412598">)</span>&nbsp;<span class="op" id="5412600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412604">return</span>&nbsp;<span class="ident" id="5412611">color</span><span class="op" id="5412616">.</span><span class="ident" id="5412617">Gray</span><span class="op" id="5412621">{</span><span class="op" id="5412622">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412628">i</span>&nbsp;<span class="op" id="5412630">:=</span>&nbsp;<span class="ident" id="5412633">p</span><span class="op" id="5412634">.</span><span class="ident" id="5412635">PixOffset</span><span class="op" id="5412644">(</span><span class="ident" id="5412645">x</span><span class="op" id="5412646">,</span>&nbsp;<span class="ident" id="5412648">y</span><span class="op" id="5412649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412652">return</span>&nbsp;<span class="ident" id="5412659">color</span><span class="op" id="5412664">.</span><span class="ident" id="5412665">Gray</span><span class="op" id="5412669">{</span><span class="ident" id="5412670">p</span><span class="op" id="5412671">.</span><span class="ident" id="5412672">Pix</span><span class="op" id="5412675">[</span><span class="ident" id="5412676">i</span><span class="op" id="5412677">]</span><span class="op" id="5412678">}</span><br>
<span class="lineno"></span><span class="op" id="5412680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="5412683">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5412762">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5412786">func</span>&nbsp;<span class="op" id="5412791">(</span><span class="ident" id="5412792">p</span>&nbsp;<span class="op" id="5412794">*</span><span class="ident" id="5412795">Gray</span><span class="op" id="5412799">)</span>&nbsp;<span class="ident" id="5412801">PixOffset</span><span class="op" id="5412810">(</span><span class="ident" id="5412811">x</span><span class="op" id="5412812">,</span>&nbsp;<span class="ident" id="5412814">y</span>&nbsp;<span class="builtintype" id="5412816">int</span><span class="op" id="5412819">)</span>&nbsp;<span class="builtintype" id="5412821">int</span>&nbsp;<span class="op" id="5412825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412828">return</span>&nbsp;<span class="op" id="5412835">(</span><span class="ident" id="5412836">y</span><span class="op" id="5412837">-</span><span class="ident" id="5412838">p</span><span class="op" id="5412839">.</span><span class="ident" id="5412840">Rect</span><span class="op" id="5412844">.</span><span class="ident" id="5412845">Min</span><span class="op" id="5412848">.</span><span class="ident" id="5412849">Y</span><span class="op" id="5412850">)</span><span class="op" id="5412851">*</span><span class="ident" id="5412852">p</span><span class="op" id="5412853">.</span><span class="ident" id="5412854">Stride</span>&nbsp;<span class="op" id="5412861">+</span>&nbsp;<span class="op" id="5412863">(</span><span class="ident" id="5412864">x</span><span class="op" id="5412865">-</span><span class="ident" id="5412866">p</span><span class="op" id="5412867">.</span><span class="ident" id="5412868">Rect</span><span class="op" id="5412872">.</span><span class="ident" id="5412873">Min</span><span class="op" id="5412876">.</span><span class="ident" id="5412877">X</span><span class="op" id="5412878">)</span><span class="op" id="5412879">*</span><span class="num" id="5412880">1</span><br>
<span class="lineno"></span><span class="op" id="5412882">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span><span class="keyword" id="5412885">func</span>&nbsp;<span class="op" id="5412890">(</span><span class="ident" id="5412891">p</span>&nbsp;<span class="op" id="5412893">*</span><span class="ident" id="5412894">Gray</span><span class="op" id="5412898">)</span>&nbsp;<span class="ident" id="5412900">Set</span><span class="op" id="5412903">(</span><span class="ident" id="5412904">x</span><span class="op" id="5412905">,</span>&nbsp;<span class="ident" id="5412907">y</span>&nbsp;<span class="builtintype" id="5412909">int</span><span class="op" id="5412912">,</span>&nbsp;<span class="ident" id="5412914">c</span>&nbsp;<span class="ident" id="5412916">color</span><span class="op" id="5412921">.</span><span class="ident" id="5412922">Color</span><span class="op" id="5412927">)</span>&nbsp;<span class="op" id="5412929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412932">if</span>&nbsp;<span class="op" id="5412935">!</span><span class="op" id="5412936">(</span><span class="ident" id="5412937">Point</span><span class="op" id="5412942">{</span><span class="ident" id="5412943">x</span><span class="op" id="5412944">,</span>&nbsp;<span class="ident" id="5412946">y</span><span class="op" id="5412947">}</span><span class="op" id="5412948">.</span><span class="ident" id="5412949">In</span><span class="op" id="5412951">(</span><span class="ident" id="5412952">p</span><span class="op" id="5412953">.</span><span class="ident" id="5412954">Rect</span><span class="op" id="5412958">)</span><span class="op" id="5412959">)</span>&nbsp;<span class="op" id="5412961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5412965">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5412973">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5412976">i</span>&nbsp;<span class="op" id="5412978">:=</span>&nbsp;<span class="ident" id="5412981">p</span><span class="op" id="5412982">.</span><span class="ident" id="5412983">PixOffset</span><span class="op" id="5412992">(</span><span class="ident" id="5412993">x</span><span class="op" id="5412994">,</span>&nbsp;<span class="ident" id="5412996">y</span><span class="op" id="5412997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413000">p</span><span class="op" id="5413001">.</span><span class="ident" id="5413002">Pix</span><span class="op" id="5413005">[</span><span class="ident" id="5413006">i</span><span class="op" id="5413007">]</span>&nbsp;<span class="op" id="5413009">=</span>&nbsp;<span class="ident" id="5413011">color</span><span class="op" id="5413016">.</span><span class="ident" id="5413017">GrayModel</span><span class="op" id="5413026">.</span><span class="ident" id="5413027">Convert</span><span class="op" id="5413034">(</span><span class="ident" id="5413035">c</span><span class="op" id="5413036">)</span><span class="op" id="5413037">.</span><span class="op" id="5413038">(</span><span class="ident" id="5413039">color</span><span class="op" id="5413044">.</span><span class="ident" id="5413045">Gray</span><span class="op" id="5413049">)</span><span class="op" id="5413050">.</span><span class="ident" id="5413051">Y</span><br>
<span class="lineno"></span><span class="op" id="5413053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5413056">func</span>&nbsp;<span class="op" id="5413061">(</span><span class="ident" id="5413062">p</span>&nbsp;<span class="op" id="5413064">*</span><span class="ident" id="5413065">Gray</span><span class="op" id="5413069">)</span>&nbsp;<span class="ident" id="5413071">SetGray</span><span class="op" id="5413078">(</span><span class="ident" id="5413079">x</span><span class="op" id="5413080">,</span>&nbsp;<span class="ident" id="5413082">y</span>&nbsp;<span class="builtintype" id="5413084">int</span><span class="op" id="5413087">,</span>&nbsp;<span class="ident" id="5413089">c</span>&nbsp;<span class="ident" id="5413091">color</span><span class="op" id="5413096">.</span><span class="ident" id="5413097">Gray</span><span class="op" id="5413101">)</span>&nbsp;<span class="op" id="5413103">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413106">if</span>&nbsp;<span class="op" id="5413109">!</span><span class="op" id="5413110">(</span><span class="ident" id="5413111">Point</span><span class="op" id="5413116">{</span><span class="ident" id="5413117">x</span><span class="op" id="5413118">,</span>&nbsp;<span class="ident" id="5413120">y</span><span class="op" id="5413121">}</span><span class="op" id="5413122">.</span><span class="ident" id="5413123">In</span><span class="op" id="5413125">(</span><span class="ident" id="5413126">p</span><span class="op" id="5413127">.</span><span class="ident" id="5413128">Rect</span><span class="op" id="5413132">)</span><span class="op" id="5413133">)</span>&nbsp;<span class="op" id="5413135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413139">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413150">i</span>&nbsp;<span class="op" id="5413152">:=</span>&nbsp;<span class="ident" id="5413155">p</span><span class="op" id="5413156">.</span><span class="ident" id="5413157">PixOffset</span><span class="op" id="5413166">(</span><span class="ident" id="5413167">x</span><span class="op" id="5413168">,</span>&nbsp;<span class="ident" id="5413170">y</span><span class="op" id="5413171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413174">p</span><span class="op" id="5413175">.</span><span class="ident" id="5413176">Pix</span><span class="op" id="5413179">[</span><span class="ident" id="5413180">i</span><span class="op" id="5413181">]</span>&nbsp;<span class="op" id="5413183">=</span>&nbsp;<span class="ident" id="5413185">c</span><span class="op" id="5413186">.</span><span class="ident" id="5413187">Y</span><br>
<span class="lineno">715</span><span class="op" id="5413189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5413192">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5413269">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5413341">func</span>&nbsp;<span class="op" id="5413346">(</span><span class="ident" id="5413347">p</span>&nbsp;<span class="op" id="5413349">*</span><span class="ident" id="5413350">Gray</span><span class="op" id="5413354">)</span>&nbsp;<span class="ident" id="5413356">SubImage</span><span class="op" id="5413364">(</span><span class="ident" id="5413365">r</span>&nbsp;<span class="ident" id="5413367">Rectangle</span><span class="op" id="5413376">)</span>&nbsp;<span class="ident" id="5413378">Image</span>&nbsp;<span class="op" id="5413384">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413387">r</span>&nbsp;<span class="op" id="5413389">=</span>&nbsp;<span class="ident" id="5413391">r</span><span class="op" id="5413392">.</span><span class="ident" id="5413393">Intersect</span><span class="op" id="5413402">(</span><span class="ident" id="5413403">p</span><span class="op" id="5413404">.</span><span class="ident" id="5413405">Rect</span><span class="op" id="5413409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413412">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413493">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5413575">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413625">if</span>&nbsp;<span class="ident" id="5413628">r</span><span class="op" id="5413629">.</span><span class="ident" id="5413630">Empty</span><span class="op" id="5413635">(</span><span class="op" id="5413636">)</span>&nbsp;<span class="op" id="5413638">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413642">return</span>&nbsp;<span class="op" id="5413649">&amp;</span><span class="ident" id="5413650">Gray</span><span class="op" id="5413654">{</span><span class="op" id="5413655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413661">i</span>&nbsp;<span class="op" id="5413663">:=</span>&nbsp;<span class="ident" id="5413666">p</span><span class="op" id="5413667">.</span><span class="ident" id="5413668">PixOffset</span><span class="op" id="5413677">(</span><span class="ident" id="5413678">r</span><span class="op" id="5413679">.</span><span class="ident" id="5413680">Min</span><span class="op" id="5413683">.</span><span class="ident" id="5413684">X</span><span class="op" id="5413685">,</span>&nbsp;<span class="ident" id="5413687">r</span><span class="op" id="5413688">.</span><span class="ident" id="5413689">Min</span><span class="op" id="5413692">.</span><span class="ident" id="5413693">Y</span><span class="op" id="5413694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413697">return</span>&nbsp;<span class="op" id="5413704">&amp;</span><span class="ident" id="5413705">Gray</span><span class="op" id="5413709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413713">Pix</span><span class="op" id="5413716">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5413721">p</span><span class="op" id="5413722">.</span><span class="ident" id="5413723">Pix</span><span class="op" id="5413726">[</span><span class="ident" id="5413727">i</span><span class="op" id="5413728">:</span><span class="op" id="5413729">]</span><span class="op" id="5413730">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413734">Stride</span><span class="op" id="5413740">:</span>&nbsp;<span class="ident" id="5413742">p</span><span class="op" id="5413743">.</span><span class="ident" id="5413744">Stride</span><span class="op" id="5413750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413754">Rect</span><span class="op" id="5413758">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5413762">r</span><span class="op" id="5413763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5413766">}</span><br>
<span class="lineno"></span><span class="op" id="5413768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">735</span><span class="comment" id="5413771">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5413844">func</span>&nbsp;<span class="op" id="5413849">(</span><span class="ident" id="5413850">p</span>&nbsp;<span class="op" id="5413852">*</span><span class="ident" id="5413853">Gray</span><span class="op" id="5413857">)</span>&nbsp;<span class="ident" id="5413859">Opaque</span><span class="op" id="5413865">(</span><span class="op" id="5413866">)</span>&nbsp;<span class="builtintype" id="5413868">bool</span>&nbsp;<span class="op" id="5413873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5413876">return</span>&nbsp;<span class="builtintype" id="5413883">true</span><br>
<span class="lineno"></span><span class="op" id="5413888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="5413891">//&nbsp;NewGray&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5413944">func</span>&nbsp;<span class="ident" id="5413949">NewGray</span><span class="op" id="5413956">(</span><span class="ident" id="5413957">r</span>&nbsp;<span class="ident" id="5413959">Rectangle</span><span class="op" id="5413968">)</span>&nbsp;<span class="op" id="5413970">*</span><span class="ident" id="5413971">Gray</span>&nbsp;<span class="op" id="5413976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5413979">w</span><span class="op" id="5413980">,</span>&nbsp;<span class="ident" id="5413982">h</span>&nbsp;<span class="op" id="5413984">:=</span>&nbsp;<span class="ident" id="5413987">r</span><span class="op" id="5413988">.</span><span class="ident" id="5413989">Dx</span><span class="op" id="5413991">(</span><span class="op" id="5413992">)</span><span class="op" id="5413993">,</span>&nbsp;<span class="ident" id="5413995">r</span><span class="op" id="5413996">.</span><span class="ident" id="5413997">Dy</span><span class="op" id="5413999">(</span><span class="op" id="5414000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414003">pix</span>&nbsp;<span class="op" id="5414007">:=</span>&nbsp;<span class="builtinfunc" id="5414010">make</span><span class="op" id="5414014">(</span><span class="op" id="5414015">[</span><span class="op" id="5414016">]</span><span class="builtintype" id="5414017">uint8</span><span class="op" id="5414022">,</span>&nbsp;<span class="num" id="5414024">1</span><span class="op" id="5414025">*</span><span class="ident" id="5414026">w</span><span class="op" id="5414027">*</span><span class="ident" id="5414028">h</span><span class="op" id="5414029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414032">return</span>&nbsp;<span class="op" id="5414039">&amp;</span><span class="ident" id="5414040">Gray</span><span class="op" id="5414044">{</span><span class="ident" id="5414045">pix</span><span class="op" id="5414048">,</span>&nbsp;<span class="num" id="5414050">1</span>&nbsp;<span class="op" id="5414052">*</span>&nbsp;<span class="ident" id="5414054">w</span><span class="op" id="5414055">,</span>&nbsp;<span class="ident" id="5414057">r</span><span class="op" id="5414058">}</span><br>
<span class="lineno">745</span><span class="op" id="5414060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5414063">//&nbsp;Gray16&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;whose&nbsp;At&nbsp;method&nbsp;returns&nbsp;color.Gray16&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5414140">type</span>&nbsp;<span class="ident" id="5414145">Gray16</span>&nbsp;<span class="keyword" id="5414152">struct</span>&nbsp;<span class="op" id="5414159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414162">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;gray&nbsp;values&nbsp;in&nbsp;big-endian&nbsp;format.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414246">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*2].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414314">Pix</span>&nbsp;<span class="op" id="5414318">[</span><span class="op" id="5414319">]</span><span class="builtintype" id="5414320">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414327">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414403">Stride</span>&nbsp;<span class="builtintype" id="5414410">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5414415">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414447">Rect</span>&nbsp;<span class="ident" id="5414452">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5414462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414465">func</span>&nbsp;<span class="op" id="5414470">(</span><span class="ident" id="5414471">p</span>&nbsp;<span class="op" id="5414473">*</span><span class="ident" id="5414474">Gray16</span><span class="op" id="5414480">)</span>&nbsp;<span class="ident" id="5414482">ColorModel</span><span class="op" id="5414492">(</span><span class="op" id="5414493">)</span>&nbsp;<span class="ident" id="5414495">color</span><span class="op" id="5414500">.</span><span class="ident" id="5414501">Model</span>&nbsp;<span class="op" id="5414507">{</span>&nbsp;<span class="keyword" id="5414509">return</span>&nbsp;<span class="ident" id="5414516">color</span><span class="op" id="5414521">.</span><span class="ident" id="5414522">Gray16Model</span>&nbsp;<span class="op" id="5414534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span><span class="keyword" id="5414537">func</span>&nbsp;<span class="op" id="5414542">(</span><span class="ident" id="5414543">p</span>&nbsp;<span class="op" id="5414545">*</span><span class="ident" id="5414546">Gray16</span><span class="op" id="5414552">)</span>&nbsp;<span class="ident" id="5414554">Bounds</span><span class="op" id="5414560">(</span><span class="op" id="5414561">)</span>&nbsp;<span class="ident" id="5414563">Rectangle</span>&nbsp;<span class="op" id="5414573">{</span>&nbsp;<span class="keyword" id="5414575">return</span>&nbsp;<span class="ident" id="5414582">p</span><span class="op" id="5414583">.</span><span class="ident" id="5414584">Rect</span>&nbsp;<span class="op" id="5414589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5414592">func</span>&nbsp;<span class="op" id="5414597">(</span><span class="ident" id="5414598">p</span>&nbsp;<span class="op" id="5414600">*</span><span class="ident" id="5414601">Gray16</span><span class="op" id="5414607">)</span>&nbsp;<span class="ident" id="5414609">At</span><span class="op" id="5414611">(</span><span class="ident" id="5414612">x</span><span class="op" id="5414613">,</span>&nbsp;<span class="ident" id="5414615">y</span>&nbsp;<span class="builtintype" id="5414617">int</span><span class="op" id="5414620">)</span>&nbsp;<span class="ident" id="5414622">color</span><span class="op" id="5414627">.</span><span class="ident" id="5414628">Color</span>&nbsp;<span class="op" id="5414634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414637">return</span>&nbsp;<span class="ident" id="5414644">p</span><span class="op" id="5414645">.</span><span class="ident" id="5414646">Gray16At</span><span class="op" id="5414654">(</span><span class="ident" id="5414655">x</span><span class="op" id="5414656">,</span>&nbsp;<span class="ident" id="5414658">y</span><span class="op" id="5414659">)</span><br>
<span class="lineno"></span><span class="op" id="5414661">}</span><br>
<span class="lineno">765</span><br>
<span class="lineno"></span><span class="keyword" id="5414664">func</span>&nbsp;<span class="op" id="5414669">(</span><span class="ident" id="5414670">p</span>&nbsp;<span class="op" id="5414672">*</span><span class="ident" id="5414673">Gray16</span><span class="op" id="5414679">)</span>&nbsp;<span class="ident" id="5414681">Gray16At</span><span class="op" id="5414689">(</span><span class="ident" id="5414690">x</span><span class="op" id="5414691">,</span>&nbsp;<span class="ident" id="5414693">y</span>&nbsp;<span class="builtintype" id="5414695">int</span><span class="op" id="5414698">)</span>&nbsp;<span class="ident" id="5414700">color</span><span class="op" id="5414705">.</span><span class="ident" id="5414706">Gray16</span>&nbsp;<span class="op" id="5414713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414716">if</span>&nbsp;<span class="op" id="5414719">!</span><span class="op" id="5414720">(</span><span class="ident" id="5414721">Point</span><span class="op" id="5414726">{</span><span class="ident" id="5414727">x</span><span class="op" id="5414728">,</span>&nbsp;<span class="ident" id="5414730">y</span><span class="op" id="5414731">}</span><span class="op" id="5414732">.</span><span class="ident" id="5414733">In</span><span class="op" id="5414735">(</span><span class="ident" id="5414736">p</span><span class="op" id="5414737">.</span><span class="ident" id="5414738">Rect</span><span class="op" id="5414742">)</span><span class="op" id="5414743">)</span>&nbsp;<span class="op" id="5414745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414749">return</span>&nbsp;<span class="ident" id="5414756">color</span><span class="op" id="5414761">.</span><span class="ident" id="5414762">Gray16</span><span class="op" id="5414768">{</span><span class="op" id="5414769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5414772">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5414775">i</span>&nbsp;<span class="op" id="5414777">:=</span>&nbsp;<span class="ident" id="5414780">p</span><span class="op" id="5414781">.</span><span class="ident" id="5414782">PixOffset</span><span class="op" id="5414791">(</span><span class="ident" id="5414792">x</span><span class="op" id="5414793">,</span>&nbsp;<span class="ident" id="5414795">y</span><span class="op" id="5414796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5414799">return</span>&nbsp;<span class="ident" id="5414806">color</span><span class="op" id="5414811">.</span><span class="ident" id="5414812">Gray16</span><span class="op" id="5414818">{</span><span class="builtintype" id="5414819">uint16</span><span class="op" id="5414825">(</span><span class="ident" id="5414826">p</span><span class="op" id="5414827">.</span><span class="ident" id="5414828">Pix</span><span class="op" id="5414831">[</span><span class="ident" id="5414832">i</span><span class="op" id="5414833">+</span><span class="num" id="5414834">0</span><span class="op" id="5414835">]</span><span class="op" id="5414836">)</span><span class="op" id="5414837">&lt;&lt;</span><span class="num" id="5414839">8</span>&nbsp;<span class="op" id="5414841">|</span>&nbsp;<span class="builtintype" id="5414843">uint16</span><span class="op" id="5414849">(</span><span class="ident" id="5414850">p</span><span class="op" id="5414851">.</span><span class="ident" id="5414852">Pix</span><span class="op" id="5414855">[</span><span class="ident" id="5414856">i</span><span class="op" id="5414857">+</span><span class="num" id="5414858">1</span><span class="op" id="5414859">]</span><span class="op" id="5414860">)</span><span class="op" id="5414861">}</span><br>
<span class="lineno"></span><span class="op" id="5414863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5414866">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">775</span><span class="comment" id="5414945">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5414969">func</span>&nbsp;<span class="op" id="5414974">(</span><span class="ident" id="5414975">p</span>&nbsp;<span class="op" id="5414977">*</span><span class="ident" id="5414978">Gray16</span><span class="op" id="5414984">)</span>&nbsp;<span class="ident" id="5414986">PixOffset</span><span class="op" id="5414995">(</span><span class="ident" id="5414996">x</span><span class="op" id="5414997">,</span>&nbsp;<span class="ident" id="5414999">y</span>&nbsp;<span class="builtintype" id="5415001">int</span><span class="op" id="5415004">)</span>&nbsp;<span class="builtintype" id="5415006">int</span>&nbsp;<span class="op" id="5415010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415013">return</span>&nbsp;<span class="op" id="5415020">(</span><span class="ident" id="5415021">y</span><span class="op" id="5415022">-</span><span class="ident" id="5415023">p</span><span class="op" id="5415024">.</span><span class="ident" id="5415025">Rect</span><span class="op" id="5415029">.</span><span class="ident" id="5415030">Min</span><span class="op" id="5415033">.</span><span class="ident" id="5415034">Y</span><span class="op" id="5415035">)</span><span class="op" id="5415036">*</span><span class="ident" id="5415037">p</span><span class="op" id="5415038">.</span><span class="ident" id="5415039">Stride</span>&nbsp;<span class="op" id="5415046">+</span>&nbsp;<span class="op" id="5415048">(</span><span class="ident" id="5415049">x</span><span class="op" id="5415050">-</span><span class="ident" id="5415051">p</span><span class="op" id="5415052">.</span><span class="ident" id="5415053">Rect</span><span class="op" id="5415057">.</span><span class="ident" id="5415058">Min</span><span class="op" id="5415061">.</span><span class="ident" id="5415062">X</span><span class="op" id="5415063">)</span><span class="op" id="5415064">*</span><span class="num" id="5415065">2</span><br>
<span class="lineno"></span><span class="op" id="5415067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">780</span><span class="keyword" id="5415070">func</span>&nbsp;<span class="op" id="5415075">(</span><span class="ident" id="5415076">p</span>&nbsp;<span class="op" id="5415078">*</span><span class="ident" id="5415079">Gray16</span><span class="op" id="5415085">)</span>&nbsp;<span class="ident" id="5415087">Set</span><span class="op" id="5415090">(</span><span class="ident" id="5415091">x</span><span class="op" id="5415092">,</span>&nbsp;<span class="ident" id="5415094">y</span>&nbsp;<span class="builtintype" id="5415096">int</span><span class="op" id="5415099">,</span>&nbsp;<span class="ident" id="5415101">c</span>&nbsp;<span class="ident" id="5415103">color</span><span class="op" id="5415108">.</span><span class="ident" id="5415109">Color</span><span class="op" id="5415114">)</span>&nbsp;<span class="op" id="5415116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415119">if</span>&nbsp;<span class="op" id="5415122">!</span><span class="op" id="5415123">(</span><span class="ident" id="5415124">Point</span><span class="op" id="5415129">{</span><span class="ident" id="5415130">x</span><span class="op" id="5415131">,</span>&nbsp;<span class="ident" id="5415133">y</span><span class="op" id="5415134">}</span><span class="op" id="5415135">.</span><span class="ident" id="5415136">In</span><span class="op" id="5415138">(</span><span class="ident" id="5415139">p</span><span class="op" id="5415140">.</span><span class="ident" id="5415141">Rect</span><span class="op" id="5415145">)</span><span class="op" id="5415146">)</span>&nbsp;<span class="op" id="5415148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415152">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415163">i</span>&nbsp;<span class="op" id="5415165">:=</span>&nbsp;<span class="ident" id="5415168">p</span><span class="op" id="5415169">.</span><span class="ident" id="5415170">PixOffset</span><span class="op" id="5415179">(</span><span class="ident" id="5415180">x</span><span class="op" id="5415181">,</span>&nbsp;<span class="ident" id="5415183">y</span><span class="op" id="5415184">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415187">c1</span>&nbsp;<span class="op" id="5415190">:=</span>&nbsp;<span class="ident" id="5415193">color</span><span class="op" id="5415198">.</span><span class="ident" id="5415199">Gray16Model</span><span class="op" id="5415210">.</span><span class="ident" id="5415211">Convert</span><span class="op" id="5415218">(</span><span class="ident" id="5415219">c</span><span class="op" id="5415220">)</span><span class="op" id="5415221">.</span><span class="op" id="5415222">(</span><span class="ident" id="5415223">color</span><span class="op" id="5415228">.</span><span class="ident" id="5415229">Gray16</span><span class="op" id="5415235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415238">p</span><span class="op" id="5415239">.</span><span class="ident" id="5415240">Pix</span><span class="op" id="5415243">[</span><span class="ident" id="5415244">i</span><span class="op" id="5415245">+</span><span class="num" id="5415246">0</span><span class="op" id="5415247">]</span>&nbsp;<span class="op" id="5415249">=</span>&nbsp;<span class="builtintype" id="5415251">uint8</span><span class="op" id="5415256">(</span><span class="ident" id="5415257">c1</span><span class="op" id="5415259">.</span><span class="ident" id="5415260">Y</span>&nbsp;<span class="op" id="5415262">&gt;&gt;</span>&nbsp;<span class="num" id="5415265">8</span><span class="op" id="5415266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415269">p</span><span class="op" id="5415270">.</span><span class="ident" id="5415271">Pix</span><span class="op" id="5415274">[</span><span class="ident" id="5415275">i</span><span class="op" id="5415276">+</span><span class="num" id="5415277">1</span><span class="op" id="5415278">]</span>&nbsp;<span class="op" id="5415280">=</span>&nbsp;<span class="builtintype" id="5415282">uint8</span><span class="op" id="5415287">(</span><span class="ident" id="5415288">c1</span><span class="op" id="5415290">.</span><span class="ident" id="5415291">Y</span><span class="op" id="5415292">)</span><br>
<span class="lineno"></span><span class="op" id="5415294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="keyword" id="5415297">func</span>&nbsp;<span class="op" id="5415302">(</span><span class="ident" id="5415303">p</span>&nbsp;<span class="op" id="5415305">*</span><span class="ident" id="5415306">Gray16</span><span class="op" id="5415312">)</span>&nbsp;<span class="ident" id="5415314">SetGray16</span><span class="op" id="5415323">(</span><span class="ident" id="5415324">x</span><span class="op" id="5415325">,</span>&nbsp;<span class="ident" id="5415327">y</span>&nbsp;<span class="builtintype" id="5415329">int</span><span class="op" id="5415332">,</span>&nbsp;<span class="ident" id="5415334">c</span>&nbsp;<span class="ident" id="5415336">color</span><span class="op" id="5415341">.</span><span class="ident" id="5415342">Gray16</span><span class="op" id="5415348">)</span>&nbsp;<span class="op" id="5415350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415353">if</span>&nbsp;<span class="op" id="5415356">!</span><span class="op" id="5415357">(</span><span class="ident" id="5415358">Point</span><span class="op" id="5415363">{</span><span class="ident" id="5415364">x</span><span class="op" id="5415365">,</span>&nbsp;<span class="ident" id="5415367">y</span><span class="op" id="5415368">}</span><span class="op" id="5415369">.</span><span class="ident" id="5415370">In</span><span class="op" id="5415372">(</span><span class="ident" id="5415373">p</span><span class="op" id="5415374">.</span><span class="ident" id="5415375">Rect</span><span class="op" id="5415379">)</span><span class="op" id="5415380">)</span>&nbsp;<span class="op" id="5415382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415386">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415397">i</span>&nbsp;<span class="op" id="5415399">:=</span>&nbsp;<span class="ident" id="5415402">p</span><span class="op" id="5415403">.</span><span class="ident" id="5415404">PixOffset</span><span class="op" id="5415413">(</span><span class="ident" id="5415414">x</span><span class="op" id="5415415">,</span>&nbsp;<span class="ident" id="5415417">y</span><span class="op" id="5415418">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415421">p</span><span class="op" id="5415422">.</span><span class="ident" id="5415423">Pix</span><span class="op" id="5415426">[</span><span class="ident" id="5415427">i</span><span class="op" id="5415428">+</span><span class="num" id="5415429">0</span><span class="op" id="5415430">]</span>&nbsp;<span class="op" id="5415432">=</span>&nbsp;<span class="builtintype" id="5415434">uint8</span><span class="op" id="5415439">(</span><span class="ident" id="5415440">c</span><span class="op" id="5415441">.</span><span class="ident" id="5415442">Y</span>&nbsp;<span class="op" id="5415444">&gt;&gt;</span>&nbsp;<span class="num" id="5415447">8</span><span class="op" id="5415448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415451">p</span><span class="op" id="5415452">.</span><span class="ident" id="5415453">Pix</span><span class="op" id="5415456">[</span><span class="ident" id="5415457">i</span><span class="op" id="5415458">+</span><span class="num" id="5415459">1</span><span class="op" id="5415460">]</span>&nbsp;<span class="op" id="5415462">=</span>&nbsp;<span class="builtintype" id="5415464">uint8</span><span class="op" id="5415469">(</span><span class="ident" id="5415470">c</span><span class="op" id="5415471">.</span><span class="ident" id="5415472">Y</span><span class="op" id="5415473">)</span><br>
<span class="lineno"></span><span class="op" id="5415475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5415478">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno">800</span><span class="comment" id="5415555">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5415627">func</span>&nbsp;<span class="op" id="5415632">(</span><span class="ident" id="5415633">p</span>&nbsp;<span class="op" id="5415635">*</span><span class="ident" id="5415636">Gray16</span><span class="op" id="5415642">)</span>&nbsp;<span class="ident" id="5415644">SubImage</span><span class="op" id="5415652">(</span><span class="ident" id="5415653">r</span>&nbsp;<span class="ident" id="5415655">Rectangle</span><span class="op" id="5415664">)</span>&nbsp;<span class="ident" id="5415666">Image</span>&nbsp;<span class="op" id="5415672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415675">r</span>&nbsp;<span class="op" id="5415677">=</span>&nbsp;<span class="ident" id="5415679">r</span><span class="op" id="5415680">.</span><span class="ident" id="5415681">Intersect</span><span class="op" id="5415690">(</span><span class="ident" id="5415691">p</span><span class="op" id="5415692">.</span><span class="ident" id="5415693">Rect</span><span class="op" id="5415697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415700">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415781">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5415863">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415913">if</span>&nbsp;<span class="ident" id="5415916">r</span><span class="op" id="5415917">.</span><span class="ident" id="5415918">Empty</span><span class="op" id="5415923">(</span><span class="op" id="5415924">)</span>&nbsp;<span class="op" id="5415926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415930">return</span>&nbsp;<span class="op" id="5415937">&amp;</span><span class="ident" id="5415938">Gray16</span><span class="op" id="5415944">{</span><span class="op" id="5415945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5415948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5415951">i</span>&nbsp;<span class="op" id="5415953">:=</span>&nbsp;<span class="ident" id="5415956">p</span><span class="op" id="5415957">.</span><span class="ident" id="5415958">PixOffset</span><span class="op" id="5415967">(</span><span class="ident" id="5415968">r</span><span class="op" id="5415969">.</span><span class="ident" id="5415970">Min</span><span class="op" id="5415973">.</span><span class="ident" id="5415974">X</span><span class="op" id="5415975">,</span>&nbsp;<span class="ident" id="5415977">r</span><span class="op" id="5415978">.</span><span class="ident" id="5415979">Min</span><span class="op" id="5415982">.</span><span class="ident" id="5415983">Y</span><span class="op" id="5415984">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5415987">return</span>&nbsp;<span class="op" id="5415994">&amp;</span><span class="ident" id="5415995">Gray16</span><span class="op" id="5416001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416005">Pix</span><span class="op" id="5416008">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5416013">p</span><span class="op" id="5416014">.</span><span class="ident" id="5416015">Pix</span><span class="op" id="5416018">[</span><span class="ident" id="5416019">i</span><span class="op" id="5416020">:</span><span class="op" id="5416021">]</span><span class="op" id="5416022">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416026">Stride</span><span class="op" id="5416032">:</span>&nbsp;<span class="ident" id="5416034">p</span><span class="op" id="5416035">.</span><span class="ident" id="5416036">Stride</span><span class="op" id="5416042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416046">Rect</span><span class="op" id="5416050">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5416054">r</span><span class="op" id="5416055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5416058">}</span><br>
<span class="lineno">815</span><span class="op" id="5416060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416063">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5416136">func</span>&nbsp;<span class="op" id="5416141">(</span><span class="ident" id="5416142">p</span>&nbsp;<span class="op" id="5416144">*</span><span class="ident" id="5416145">Gray16</span><span class="op" id="5416151">)</span>&nbsp;<span class="ident" id="5416153">Opaque</span><span class="op" id="5416159">(</span><span class="op" id="5416160">)</span>&nbsp;<span class="builtintype" id="5416162">bool</span>&nbsp;<span class="op" id="5416167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416170">return</span>&nbsp;<span class="builtintype" id="5416177">true</span><br>
<span class="lineno">820</span><span class="op" id="5416182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416185">//&nbsp;NewGray16&nbsp;returns&nbsp;a&nbsp;new&nbsp;Gray16&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="5416242">func</span>&nbsp;<span class="ident" id="5416247">NewGray16</span><span class="op" id="5416256">(</span><span class="ident" id="5416257">r</span>&nbsp;<span class="ident" id="5416259">Rectangle</span><span class="op" id="5416268">)</span>&nbsp;<span class="op" id="5416270">*</span><span class="ident" id="5416271">Gray16</span>&nbsp;<span class="op" id="5416278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416281">w</span><span class="op" id="5416282">,</span>&nbsp;<span class="ident" id="5416284">h</span>&nbsp;<span class="op" id="5416286">:=</span>&nbsp;<span class="ident" id="5416289">r</span><span class="op" id="5416290">.</span><span class="ident" id="5416291">Dx</span><span class="op" id="5416293">(</span><span class="op" id="5416294">)</span><span class="op" id="5416295">,</span>&nbsp;<span class="ident" id="5416297">r</span><span class="op" id="5416298">.</span><span class="ident" id="5416299">Dy</span><span class="op" id="5416301">(</span><span class="op" id="5416302">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416305">pix</span>&nbsp;<span class="op" id="5416309">:=</span>&nbsp;<span class="builtinfunc" id="5416312">make</span><span class="op" id="5416316">(</span><span class="op" id="5416317">[</span><span class="op" id="5416318">]</span><span class="builtintype" id="5416319">uint8</span><span class="op" id="5416324">,</span>&nbsp;<span class="num" id="5416326">2</span><span class="op" id="5416327">*</span><span class="ident" id="5416328">w</span><span class="op" id="5416329">*</span><span class="ident" id="5416330">h</span><span class="op" id="5416331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416334">return</span>&nbsp;<span class="op" id="5416341">&amp;</span><span class="ident" id="5416342">Gray16</span><span class="op" id="5416348">{</span><span class="ident" id="5416349">pix</span><span class="op" id="5416352">,</span>&nbsp;<span class="num" id="5416354">2</span>&nbsp;<span class="op" id="5416356">*</span>&nbsp;<span class="ident" id="5416358">w</span><span class="op" id="5416359">,</span>&nbsp;<span class="ident" id="5416361">r</span><span class="op" id="5416362">}</span><br>
<span class="lineno"></span><span class="op" id="5416364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5416367">//&nbsp;Paletted&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;uint8&nbsp;indices&nbsp;into&nbsp;a&nbsp;given&nbsp;palette.</span><br>
<span class="lineno">830</span><span class="keyword" id="5416440">type</span>&nbsp;<span class="ident" id="5416445">Paletted</span>&nbsp;<span class="keyword" id="5416454">struct</span>&nbsp;<span class="op" id="5416461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416464">//&nbsp;Pix&nbsp;holds&nbsp;the&nbsp;image&#39;s&nbsp;pixels,&nbsp;as&nbsp;palette&nbsp;indices.&nbsp;The&nbsp;pixel&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416531">//&nbsp;(x,&nbsp;y)&nbsp;starts&nbsp;at&nbsp;Pix[(y-Rect.Min.Y)*Stride&nbsp;+&nbsp;(x-Rect.Min.X)*1].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416599">Pix</span>&nbsp;<span class="op" id="5416603">[</span><span class="op" id="5416604">]</span><span class="builtintype" id="5416605">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416612">//&nbsp;Stride&nbsp;is&nbsp;the&nbsp;Pix&nbsp;stride&nbsp;(in&nbsp;bytes)&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416688">Stride</span>&nbsp;<span class="builtintype" id="5416695">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416700">//&nbsp;Rect&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416732">Rect</span>&nbsp;<span class="ident" id="5416737">Rectangle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5416748">//&nbsp;Palette&nbsp;is&nbsp;the&nbsp;image&#39;s&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5416784">Palette</span>&nbsp;<span class="ident" id="5416792">color</span><span class="op" id="5416797">.</span><span class="ident" id="5416798">Palette</span><br>
<span class="lineno">840</span><span class="op" id="5416806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416809">func</span>&nbsp;<span class="op" id="5416814">(</span><span class="ident" id="5416815">p</span>&nbsp;<span class="op" id="5416817">*</span><span class="ident" id="5416818">Paletted</span><span class="op" id="5416826">)</span>&nbsp;<span class="ident" id="5416828">ColorModel</span><span class="op" id="5416838">(</span><span class="op" id="5416839">)</span>&nbsp;<span class="ident" id="5416841">color</span><span class="op" id="5416846">.</span><span class="ident" id="5416847">Model</span>&nbsp;<span class="op" id="5416853">{</span>&nbsp;<span class="keyword" id="5416855">return</span>&nbsp;<span class="ident" id="5416862">p</span><span class="op" id="5416863">.</span><span class="ident" id="5416864">Palette</span>&nbsp;<span class="op" id="5416872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5416875">func</span>&nbsp;<span class="op" id="5416880">(</span><span class="ident" id="5416881">p</span>&nbsp;<span class="op" id="5416883">*</span><span class="ident" id="5416884">Paletted</span><span class="op" id="5416892">)</span>&nbsp;<span class="ident" id="5416894">Bounds</span><span class="op" id="5416900">(</span><span class="op" id="5416901">)</span>&nbsp;<span class="ident" id="5416903">Rectangle</span>&nbsp;<span class="op" id="5416913">{</span>&nbsp;<span class="keyword" id="5416915">return</span>&nbsp;<span class="ident" id="5416922">p</span><span class="op" id="5416923">.</span><span class="ident" id="5416924">Rect</span>&nbsp;<span class="op" id="5416929">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="5416932">func</span>&nbsp;<span class="op" id="5416937">(</span><span class="ident" id="5416938">p</span>&nbsp;<span class="op" id="5416940">*</span><span class="ident" id="5416941">Paletted</span><span class="op" id="5416949">)</span>&nbsp;<span class="ident" id="5416951">At</span><span class="op" id="5416953">(</span><span class="ident" id="5416954">x</span><span class="op" id="5416955">,</span>&nbsp;<span class="ident" id="5416957">y</span>&nbsp;<span class="builtintype" id="5416959">int</span><span class="op" id="5416962">)</span>&nbsp;<span class="ident" id="5416964">color</span><span class="op" id="5416969">.</span><span class="ident" id="5416970">Color</span>&nbsp;<span class="op" id="5416976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5416979">if</span>&nbsp;<span class="builtinfunc" id="5416982">len</span><span class="op" id="5416985">(</span><span class="ident" id="5416986">p</span><span class="op" id="5416987">.</span><span class="ident" id="5416988">Palette</span><span class="op" id="5416995">)</span>&nbsp;<span class="op" id="5416997">==</span>&nbsp;<span class="num" id="5417000">0</span>&nbsp;<span class="op" id="5417002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417006">return</span>&nbsp;<span class="ident" id="5417013">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417018">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417021">if</span>&nbsp;<span class="op" id="5417024">!</span><span class="op" id="5417025">(</span><span class="ident" id="5417026">Point</span><span class="op" id="5417031">{</span><span class="ident" id="5417032">x</span><span class="op" id="5417033">,</span>&nbsp;<span class="ident" id="5417035">y</span><span class="op" id="5417036">}</span><span class="op" id="5417037">.</span><span class="ident" id="5417038">In</span><span class="op" id="5417040">(</span><span class="ident" id="5417041">p</span><span class="op" id="5417042">.</span><span class="ident" id="5417043">Rect</span><span class="op" id="5417047">)</span><span class="op" id="5417048">)</span>&nbsp;<span class="op" id="5417050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417054">return</span>&nbsp;<span class="ident" id="5417061">p</span><span class="op" id="5417062">.</span><span class="ident" id="5417063">Palette</span><span class="op" id="5417070">[</span><span class="num" id="5417071">0</span><span class="op" id="5417072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417078">i</span>&nbsp;<span class="op" id="5417080">:=</span>&nbsp;<span class="ident" id="5417083">p</span><span class="op" id="5417084">.</span><span class="ident" id="5417085">PixOffset</span><span class="op" id="5417094">(</span><span class="ident" id="5417095">x</span><span class="op" id="5417096">,</span>&nbsp;<span class="ident" id="5417098">y</span><span class="op" id="5417099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417102">return</span>&nbsp;<span class="ident" id="5417109">p</span><span class="op" id="5417110">.</span><span class="ident" id="5417111">Palette</span><span class="op" id="5417118">[</span><span class="ident" id="5417119">p</span><span class="op" id="5417120">.</span><span class="ident" id="5417121">Pix</span><span class="op" id="5417124">[</span><span class="ident" id="5417125">i</span><span class="op" id="5417126">]</span><span class="op" id="5417127">]</span><br>
<span class="lineno">855</span><span class="op" id="5417129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417132">//&nbsp;PixOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Pix&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5417211">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5417235">func</span>&nbsp;<span class="op" id="5417240">(</span><span class="ident" id="5417241">p</span>&nbsp;<span class="op" id="5417243">*</span><span class="ident" id="5417244">Paletted</span><span class="op" id="5417252">)</span>&nbsp;<span class="ident" id="5417254">PixOffset</span><span class="op" id="5417263">(</span><span class="ident" id="5417264">x</span><span class="op" id="5417265">,</span>&nbsp;<span class="ident" id="5417267">y</span>&nbsp;<span class="builtintype" id="5417269">int</span><span class="op" id="5417272">)</span>&nbsp;<span class="builtintype" id="5417274">int</span>&nbsp;<span class="op" id="5417278">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417281">return</span>&nbsp;<span class="op" id="5417288">(</span><span class="ident" id="5417289">y</span><span class="op" id="5417290">-</span><span class="ident" id="5417291">p</span><span class="op" id="5417292">.</span><span class="ident" id="5417293">Rect</span><span class="op" id="5417297">.</span><span class="ident" id="5417298">Min</span><span class="op" id="5417301">.</span><span class="ident" id="5417302">Y</span><span class="op" id="5417303">)</span><span class="op" id="5417304">*</span><span class="ident" id="5417305">p</span><span class="op" id="5417306">.</span><span class="ident" id="5417307">Stride</span>&nbsp;<span class="op" id="5417314">+</span>&nbsp;<span class="op" id="5417316">(</span><span class="ident" id="5417317">x</span><span class="op" id="5417318">-</span><span class="ident" id="5417319">p</span><span class="op" id="5417320">.</span><span class="ident" id="5417321">Rect</span><span class="op" id="5417325">.</span><span class="ident" id="5417326">Min</span><span class="op" id="5417329">.</span><span class="ident" id="5417330">X</span><span class="op" id="5417331">)</span><span class="op" id="5417332">*</span><span class="num" id="5417333">1</span><br>
<span class="lineno"></span><span class="op" id="5417335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417338">func</span>&nbsp;<span class="op" id="5417343">(</span><span class="ident" id="5417344">p</span>&nbsp;<span class="op" id="5417346">*</span><span class="ident" id="5417347">Paletted</span><span class="op" id="5417355">)</span>&nbsp;<span class="ident" id="5417357">Set</span><span class="op" id="5417360">(</span><span class="ident" id="5417361">x</span><span class="op" id="5417362">,</span>&nbsp;<span class="ident" id="5417364">y</span>&nbsp;<span class="builtintype" id="5417366">int</span><span class="op" id="5417369">,</span>&nbsp;<span class="ident" id="5417371">c</span>&nbsp;<span class="ident" id="5417373">color</span><span class="op" id="5417378">.</span><span class="ident" id="5417379">Color</span><span class="op" id="5417384">)</span>&nbsp;<span class="op" id="5417386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417389">if</span>&nbsp;<span class="op" id="5417392">!</span><span class="op" id="5417393">(</span><span class="ident" id="5417394">Point</span><span class="op" id="5417399">{</span><span class="ident" id="5417400">x</span><span class="op" id="5417401">,</span>&nbsp;<span class="ident" id="5417403">y</span><span class="op" id="5417404">}</span><span class="op" id="5417405">.</span><span class="ident" id="5417406">In</span><span class="op" id="5417408">(</span><span class="ident" id="5417409">p</span><span class="op" id="5417410">.</span><span class="ident" id="5417411">Rect</span><span class="op" id="5417415">)</span><span class="op" id="5417416">)</span>&nbsp;<span class="op" id="5417418">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417422">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417433">i</span>&nbsp;<span class="op" id="5417435">:=</span>&nbsp;<span class="ident" id="5417438">p</span><span class="op" id="5417439">.</span><span class="ident" id="5417440">PixOffset</span><span class="op" id="5417449">(</span><span class="ident" id="5417450">x</span><span class="op" id="5417451">,</span>&nbsp;<span class="ident" id="5417453">y</span><span class="op" id="5417454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417457">p</span><span class="op" id="5417458">.</span><span class="ident" id="5417459">Pix</span><span class="op" id="5417462">[</span><span class="ident" id="5417463">i</span><span class="op" id="5417464">]</span>&nbsp;<span class="op" id="5417466">=</span>&nbsp;<span class="builtintype" id="5417468">uint8</span><span class="op" id="5417473">(</span><span class="ident" id="5417474">p</span><span class="op" id="5417475">.</span><span class="ident" id="5417476">Palette</span><span class="op" id="5417483">.</span><span class="ident" id="5417484">Index</span><span class="op" id="5417489">(</span><span class="ident" id="5417490">c</span><span class="op" id="5417491">)</span><span class="op" id="5417492">)</span><br>
<span class="lineno"></span><span class="op" id="5417494">}</span><br>
<span class="lineno">870</span><br>
<span class="lineno"></span><span class="keyword" id="5417497">func</span>&nbsp;<span class="op" id="5417502">(</span><span class="ident" id="5417503">p</span>&nbsp;<span class="op" id="5417505">*</span><span class="ident" id="5417506">Paletted</span><span class="op" id="5417514">)</span>&nbsp;<span class="ident" id="5417516">ColorIndexAt</span><span class="op" id="5417528">(</span><span class="ident" id="5417529">x</span><span class="op" id="5417530">,</span>&nbsp;<span class="ident" id="5417532">y</span>&nbsp;<span class="builtintype" id="5417534">int</span><span class="op" id="5417537">)</span>&nbsp;<span class="builtintype" id="5417539">uint8</span>&nbsp;<span class="op" id="5417545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417548">if</span>&nbsp;<span class="op" id="5417551">!</span><span class="op" id="5417552">(</span><span class="ident" id="5417553">Point</span><span class="op" id="5417558">{</span><span class="ident" id="5417559">x</span><span class="op" id="5417560">,</span>&nbsp;<span class="ident" id="5417562">y</span><span class="op" id="5417563">}</span><span class="op" id="5417564">.</span><span class="ident" id="5417565">In</span><span class="op" id="5417567">(</span><span class="ident" id="5417568">p</span><span class="op" id="5417569">.</span><span class="ident" id="5417570">Rect</span><span class="op" id="5417574">)</span><span class="op" id="5417575">)</span>&nbsp;<span class="op" id="5417577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417581">return</span>&nbsp;<span class="num" id="5417588">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417591">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417594">i</span>&nbsp;<span class="op" id="5417596">:=</span>&nbsp;<span class="ident" id="5417599">p</span><span class="op" id="5417600">.</span><span class="ident" id="5417601">PixOffset</span><span class="op" id="5417610">(</span><span class="ident" id="5417611">x</span><span class="op" id="5417612">,</span>&nbsp;<span class="ident" id="5417614">y</span><span class="op" id="5417615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417618">return</span>&nbsp;<span class="ident" id="5417625">p</span><span class="op" id="5417626">.</span><span class="ident" id="5417627">Pix</span><span class="op" id="5417630">[</span><span class="ident" id="5417631">i</span><span class="op" id="5417632">]</span><br>
<span class="lineno"></span><span class="op" id="5417634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417637">func</span>&nbsp;<span class="op" id="5417642">(</span><span class="ident" id="5417643">p</span>&nbsp;<span class="op" id="5417645">*</span><span class="ident" id="5417646">Paletted</span><span class="op" id="5417654">)</span>&nbsp;<span class="ident" id="5417656">SetColorIndex</span><span class="op" id="5417669">(</span><span class="ident" id="5417670">x</span><span class="op" id="5417671">,</span>&nbsp;<span class="ident" id="5417673">y</span>&nbsp;<span class="builtintype" id="5417675">int</span><span class="op" id="5417678">,</span>&nbsp;<span class="ident" id="5417680">index</span>&nbsp;<span class="builtintype" id="5417686">uint8</span><span class="op" id="5417691">)</span>&nbsp;<span class="op" id="5417693">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417696">if</span>&nbsp;<span class="op" id="5417699">!</span><span class="op" id="5417700">(</span><span class="ident" id="5417701">Point</span><span class="op" id="5417706">{</span><span class="ident" id="5417707">x</span><span class="op" id="5417708">,</span>&nbsp;<span class="ident" id="5417710">y</span><span class="op" id="5417711">}</span><span class="op" id="5417712">.</span><span class="ident" id="5417713">In</span><span class="op" id="5417715">(</span><span class="ident" id="5417716">p</span><span class="op" id="5417717">.</span><span class="ident" id="5417718">Rect</span><span class="op" id="5417722">)</span><span class="op" id="5417723">)</span>&nbsp;<span class="op" id="5417725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5417729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5417737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417740">i</span>&nbsp;<span class="op" id="5417742">:=</span>&nbsp;<span class="ident" id="5417745">p</span><span class="op" id="5417746">.</span><span class="ident" id="5417747">PixOffset</span><span class="op" id="5417756">(</span><span class="ident" id="5417757">x</span><span class="op" id="5417758">,</span>&nbsp;<span class="ident" id="5417760">y</span><span class="op" id="5417761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417764">p</span><span class="op" id="5417765">.</span><span class="ident" id="5417766">Pix</span><span class="op" id="5417769">[</span><span class="ident" id="5417770">i</span><span class="op" id="5417771">]</span>&nbsp;<span class="op" id="5417773">=</span>&nbsp;<span class="ident" id="5417775">index</span><br>
<span class="lineno">885</span><span class="op" id="5417781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5417784">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5417861">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5417933">func</span>&nbsp;<span class="op" id="5417938">(</span><span class="ident" id="5417939">p</span>&nbsp;<span class="op" id="5417941">*</span><span class="ident" id="5417942">Paletted</span><span class="op" id="5417950">)</span>&nbsp;<span class="ident" id="5417952">SubImage</span><span class="op" id="5417960">(</span><span class="ident" id="5417961">r</span>&nbsp;<span class="ident" id="5417963">Rectangle</span><span class="op" id="5417972">)</span>&nbsp;<span class="ident" id="5417974">Image</span>&nbsp;<span class="op" id="5417980">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5417983">r</span>&nbsp;<span class="op" id="5417985">=</span>&nbsp;<span class="ident" id="5417987">r</span><span class="op" id="5417988">.</span><span class="ident" id="5417989">Intersect</span><span class="op" id="5417998">(</span><span class="ident" id="5417999">p</span><span class="op" id="5418000">.</span><span class="ident" id="5418001">Rect</span><span class="op" id="5418005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418008">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418089">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5418171">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418221">if</span>&nbsp;<span class="ident" id="5418224">r</span><span class="op" id="5418225">.</span><span class="ident" id="5418226">Empty</span><span class="op" id="5418231">(</span><span class="op" id="5418232">)</span>&nbsp;<span class="op" id="5418234">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418238">return</span>&nbsp;<span class="op" id="5418245">&amp;</span><span class="ident" id="5418246">Paletted</span><span class="op" id="5418254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418259">Palette</span><span class="op" id="5418266">:</span>&nbsp;<span class="ident" id="5418268">p</span><span class="op" id="5418269">.</span><span class="ident" id="5418270">Palette</span><span class="op" id="5418277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418287">i</span>&nbsp;<span class="op" id="5418289">:=</span>&nbsp;<span class="ident" id="5418292">p</span><span class="op" id="5418293">.</span><span class="ident" id="5418294">PixOffset</span><span class="op" id="5418303">(</span><span class="ident" id="5418304">r</span><span class="op" id="5418305">.</span><span class="ident" id="5418306">Min</span><span class="op" id="5418309">.</span><span class="ident" id="5418310">X</span><span class="op" id="5418311">,</span>&nbsp;<span class="ident" id="5418313">r</span><span class="op" id="5418314">.</span><span class="ident" id="5418315">Min</span><span class="op" id="5418318">.</span><span class="ident" id="5418319">Y</span><span class="op" id="5418320">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418323">return</span>&nbsp;<span class="op" id="5418330">&amp;</span><span class="ident" id="5418331">Paletted</span><span class="op" id="5418339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418343">Pix</span><span class="op" id="5418346">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418352">p</span><span class="op" id="5418353">.</span><span class="ident" id="5418354">Pix</span><span class="op" id="5418357">[</span><span class="ident" id="5418358">i</span><span class="op" id="5418359">:</span><span class="op" id="5418360">]</span><span class="op" id="5418361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418365">Stride</span><span class="op" id="5418371">:</span>&nbsp;&nbsp;<span class="ident" id="5418374">p</span><span class="op" id="5418375">.</span><span class="ident" id="5418376">Stride</span><span class="op" id="5418382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418386">Rect</span><span class="op" id="5418390">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418395">p</span><span class="op" id="5418396">.</span><span class="ident" id="5418397">Rect</span><span class="op" id="5418401">.</span><span class="ident" id="5418402">Intersect</span><span class="op" id="5418411">(</span><span class="ident" id="5418412">r</span><span class="op" id="5418413">)</span><span class="op" id="5418414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418418">Palette</span><span class="op" id="5418425">:</span>&nbsp;<span class="ident" id="5418427">p</span><span class="op" id="5418428">.</span><span class="ident" id="5418429">Palette</span><span class="op" id="5418436">,</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418439">}</span><br>
<span class="lineno"></span><span class="op" id="5418441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5418444">//&nbsp;Opaque&nbsp;scans&nbsp;the&nbsp;entire&nbsp;image&nbsp;and&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="5418517">func</span>&nbsp;<span class="op" id="5418522">(</span><span class="ident" id="5418523">p</span>&nbsp;<span class="op" id="5418525">*</span><span class="ident" id="5418526">Paletted</span><span class="op" id="5418534">)</span>&nbsp;<span class="ident" id="5418536">Opaque</span><span class="op" id="5418542">(</span><span class="op" id="5418543">)</span>&nbsp;<span class="builtintype" id="5418545">bool</span>&nbsp;<span class="op" id="5418550">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418553">var</span>&nbsp;<span class="ident" id="5418557">present</span>&nbsp;<span class="op" id="5418565">[</span><span class="num" id="5418566">256</span><span class="op" id="5418569">]</span><span class="builtintype" id="5418570">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418576">i0</span><span class="op" id="5418578">,</span>&nbsp;<span class="ident" id="5418580">i1</span>&nbsp;<span class="op" id="5418583">:=</span>&nbsp;<span class="num" id="5418586">0</span><span class="op" id="5418587">,</span>&nbsp;<span class="ident" id="5418589">p</span><span class="op" id="5418590">.</span><span class="ident" id="5418591">Rect</span><span class="op" id="5418595">.</span><span class="ident" id="5418596">Dx</span><span class="op" id="5418598">(</span><span class="op" id="5418599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418602">for</span>&nbsp;<span class="ident" id="5418606">y</span>&nbsp;<span class="op" id="5418608">:=</span>&nbsp;<span class="ident" id="5418611">p</span><span class="op" id="5418612">.</span><span class="ident" id="5418613">Rect</span><span class="op" id="5418617">.</span><span class="ident" id="5418618">Min</span><span class="op" id="5418621">.</span><span class="ident" id="5418622">Y</span><span class="op" id="5418623">;</span>&nbsp;<span class="ident" id="5418625">y</span>&nbsp;<span class="op" id="5418627">&lt;</span>&nbsp;<span class="ident" id="5418629">p</span><span class="op" id="5418630">.</span><span class="ident" id="5418631">Rect</span><span class="op" id="5418635">.</span><span class="ident" id="5418636">Max</span><span class="op" id="5418639">.</span><span class="ident" id="5418640">Y</span><span class="op" id="5418641">;</span>&nbsp;<span class="ident" id="5418643">y</span><span class="op" id="5418644">++</span>&nbsp;<span class="op" id="5418647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418651">for</span>&nbsp;<span class="ident" id="5418655">_</span><span class="op" id="5418656">,</span>&nbsp;<span class="ident" id="5418658">c</span>&nbsp;<span class="op" id="5418660">:=</span>&nbsp;<span class="keyword" id="5418663">range</span>&nbsp;<span class="ident" id="5418669">p</span><span class="op" id="5418670">.</span><span class="ident" id="5418671">Pix</span><span class="op" id="5418674">[</span><span class="ident" id="5418675">i0</span><span class="op" id="5418677">:</span><span class="ident" id="5418678">i1</span><span class="op" id="5418680">]</span>&nbsp;<span class="op" id="5418682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418687">present</span><span class="op" id="5418694">[</span><span class="ident" id="5418695">c</span><span class="op" id="5418696">]</span>&nbsp;<span class="op" id="5418698">=</span>&nbsp;<span class="builtintype" id="5418700">true</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418711">i0</span>&nbsp;<span class="op" id="5418714">+=</span>&nbsp;<span class="ident" id="5418717">p</span><span class="op" id="5418718">.</span><span class="ident" id="5418719">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418728">i1</span>&nbsp;<span class="op" id="5418731">+=</span>&nbsp;<span class="ident" id="5418734">p</span><span class="op" id="5418735">.</span><span class="ident" id="5418736">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418747">for</span>&nbsp;<span class="ident" id="5418751">i</span><span class="op" id="5418752">,</span>&nbsp;<span class="ident" id="5418754">c</span>&nbsp;<span class="op" id="5418756">:=</span>&nbsp;<span class="keyword" id="5418759">range</span>&nbsp;<span class="ident" id="5418765">p</span><span class="op" id="5418766">.</span><span class="ident" id="5418767">Palette</span>&nbsp;<span class="op" id="5418775">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418779">if</span>&nbsp;<span class="op" id="5418782">!</span><span class="ident" id="5418783">present</span><span class="op" id="5418790">[</span><span class="ident" id="5418791">i</span><span class="op" id="5418792">]</span>&nbsp;<span class="op" id="5418794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418799">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5418814">_</span><span class="op" id="5418815">,</span>&nbsp;<span class="ident" id="5418817">_</span><span class="op" id="5418818">,</span>&nbsp;<span class="ident" id="5418820">_</span><span class="op" id="5418821">,</span>&nbsp;<span class="ident" id="5418823">a</span>&nbsp;<span class="op" id="5418825">:=</span>&nbsp;<span class="ident" id="5418828">c</span><span class="op" id="5418829">.</span><span class="ident" id="5418830">RGBA</span><span class="op" id="5418834">(</span><span class="op" id="5418835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418839">if</span>&nbsp;<span class="ident" id="5418842">a</span>&nbsp;<span class="op" id="5418844">!=</span>&nbsp;<span class="num" id="5418847">0xffff</span>&nbsp;<span class="op" id="5418854">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418859">return</span>&nbsp;<span class="builtintype" id="5418866">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5418877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5418880">return</span>&nbsp;<span class="builtintype" id="5418887">true</span><br>
<span class="lineno"></span><span class="op" id="5418892">}</span><br>
<span class="lineno">930</span><br>
<span class="lineno"></span><span class="comment" id="5418895">//&nbsp;NewPaletted&nbsp;returns&nbsp;a&nbsp;new&nbsp;Paletted&nbsp;with&nbsp;the&nbsp;given&nbsp;width,&nbsp;height&nbsp;and&nbsp;palette.</span><br>
<span class="lineno"></span><span class="keyword" id="5418975">func</span>&nbsp;<span class="ident" id="5418980">NewPaletted</span><span class="op" id="5418991">(</span><span class="ident" id="5418992">r</span>&nbsp;<span class="ident" id="5418994">Rectangle</span><span class="op" id="5419003">,</span>&nbsp;<span class="ident" id="5419005">p</span>&nbsp;<span class="ident" id="5419007">color</span><span class="op" id="5419012">.</span><span class="ident" id="5419013">Palette</span><span class="op" id="5419020">)</span>&nbsp;<span class="op" id="5419022">*</span><span class="ident" id="5419023">Paletted</span>&nbsp;<span class="op" id="5419032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419035">w</span><span class="op" id="5419036">,</span>&nbsp;<span class="ident" id="5419038">h</span>&nbsp;<span class="op" id="5419040">:=</span>&nbsp;<span class="ident" id="5419043">r</span><span class="op" id="5419044">.</span><span class="ident" id="5419045">Dx</span><span class="op" id="5419047">(</span><span class="op" id="5419048">)</span><span class="op" id="5419049">,</span>&nbsp;<span class="ident" id="5419051">r</span><span class="op" id="5419052">.</span><span class="ident" id="5419053">Dy</span><span class="op" id="5419055">(</span><span class="op" id="5419056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5419059">pix</span>&nbsp;<span class="op" id="5419063">:=</span>&nbsp;<span class="builtinfunc" id="5419066">make</span><span class="op" id="5419070">(</span><span class="op" id="5419071">[</span><span class="op" id="5419072">]</span><span class="builtintype" id="5419073">uint8</span><span class="op" id="5419078">,</span>&nbsp;<span class="num" id="5419080">1</span><span class="op" id="5419081">*</span><span class="ident" id="5419082">w</span><span class="op" id="5419083">*</span><span class="ident" id="5419084">h</span><span class="op" id="5419085">)</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5419088">return</span>&nbsp;<span class="op" id="5419095">&amp;</span><span class="ident" id="5419096">Paletted</span><span class="op" id="5419104">{</span><span class="ident" id="5419105">pix</span><span class="op" id="5419108">,</span>&nbsp;<span class="num" id="5419110">1</span>&nbsp;<span class="op" id="5419112">*</span>&nbsp;<span class="ident" id="5419114">w</span><span class="op" id="5419115">,</span>&nbsp;<span class="ident" id="5419117">r</span><span class="op" id="5419118">,</span>&nbsp;<span class="ident" id="5419120">p</span><span class="op" id="5419121">}</span><br>
<span class="lineno"></span><span class="op" id="5419123">}</span>
</div>
</body>
</html>
