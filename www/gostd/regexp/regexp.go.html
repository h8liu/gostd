<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3392314">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3392369">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3392423">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3392474">//&nbsp;Package&nbsp;regexp&nbsp;implements&nbsp;regular&nbsp;expression&nbsp;search.</span><br>
<span class="lineno"></span><span class="comment" id="3392530">//</span><br>
<span class="lineno"></span><span class="comment" id="3392533">//&nbsp;The&nbsp;syntax&nbsp;of&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;accepted&nbsp;is&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3392595">//&nbsp;general&nbsp;syntax&nbsp;used&nbsp;by&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;languages.</span><br>
<span class="lineno"></span><span class="comment" id="3392656">//&nbsp;More&nbsp;precisely,&nbsp;it&nbsp;is&nbsp;the&nbsp;syntax&nbsp;accepted&nbsp;by&nbsp;RE2&nbsp;and&nbsp;described&nbsp;at</span><br>
<span class="lineno">10</span><span class="comment" id="3392725">//&nbsp;http://code.google.com/p/re2/wiki/Syntax,&nbsp;except&nbsp;for&nbsp;\C.</span><br>
<span class="lineno"></span><span class="comment" id="3392785">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;the&nbsp;syntax,&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="3392823">//&nbsp;&nbsp;&nbsp;godoc&nbsp;regexp/syntax</span><br>
<span class="lineno"></span><span class="comment" id="3392848">//</span><br>
<span class="lineno"></span><span class="comment" id="3392851">//&nbsp;The&nbsp;regexp&nbsp;implementation&nbsp;provided&nbsp;by&nbsp;this&nbsp;package&nbsp;is</span><br>
<span class="lineno">15</span><span class="comment" id="3392908">//&nbsp;guaranteed&nbsp;to&nbsp;run&nbsp;in&nbsp;time&nbsp;linear&nbsp;in&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3392970">//&nbsp;(This&nbsp;is&nbsp;a&nbsp;property&nbsp;not&nbsp;guaranteed&nbsp;by&nbsp;most&nbsp;open&nbsp;source</span><br>
<span class="lineno"></span><span class="comment" id="3393028">//&nbsp;implementations&nbsp;of&nbsp;regular&nbsp;expressions.)&nbsp;For&nbsp;more&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="3393093">//&nbsp;about&nbsp;this&nbsp;property,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="3393121">//&nbsp;&nbsp;&nbsp;&nbsphttp://swtch.com/~rsc/regexp/regexp1.html</span><br>
<span class="lineno">20</span><span class="comment" id="3393166">//&nbsp;or&nbsp;any&nbsp;book&nbsp;about&nbsp;automata&nbsp;theory.</span><br>
<span class="lineno"></span><span class="comment" id="3393204">//</span><br>
<span class="lineno"></span><span class="comment" id="3393207">//&nbsp;All&nbsp;characters&nbsp;are&nbsp;UTF-8-encoded&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="3393256">//</span><br>
<span class="lineno"></span><span class="comment" id="3393259">//&nbsp;There&nbsp;are&nbsp;16&nbsp;methods&nbsp;of&nbsp;Regexp&nbsp;that&nbsp;match&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;identify</span><br>
<span class="lineno">25</span><span class="comment" id="3393338">//&nbsp;the&nbsp;matched&nbsp;text.&nbsp;&nbsp;Their&nbsp;names&nbsp;are&nbsp;matched&nbsp;by&nbsp;this&nbsp;regular&nbsp;expression:</span><br>
<span class="lineno"></span><span class="comment" id="3393412">//</span><br>
<span class="lineno"></span><span class="comment" id="3393415">//&nbsp;&nbsp;&nbsp;&nbspFind(All)?(String)?(Submatch)?(Index)?</span><br>
<span class="lineno"></span><span class="comment" id="3393457">//</span><br>
<span class="lineno"></span><span class="comment" id="3393460">//&nbsp;If&nbsp;&#39;All&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;routine&nbsp;matches&nbsp;successive&nbsp;non-overlapping</span><br>
<span class="lineno">30</span><span class="comment" id="3393531">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression.&nbsp;&nbsp;Empty&nbsp;matches&nbsp;abutting&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="3393604">//&nbsp;match&nbsp;are&nbsp;ignored.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3393681">//&nbsp;return&nbsp;values&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;non-&#39;All&#39;&nbsp;routine.&nbsp;&nbsp;These&nbsp;routines&nbsp;take</span><br>
<span class="lineno"></span><span class="comment" id="3393759">//&nbsp;an&nbsp;extra&nbsp;integer&nbsp;argument,&nbsp;n;&nbsp;if&nbsp;n&nbsp;&gt;=&nbsp;0,&nbsp;the&nbsp;function&nbsp;returns&nbsp;at&nbsp;most&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3393834">//&nbsp;matches/submatches.</span><br>
<span class="lineno">35</span><span class="comment" id="3393857">//</span><br>
<span class="lineno"></span><span class="comment" id="3393860">//&nbsp;If&nbsp;&#39;String&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;argument&nbsp;is&nbsp;a&nbsp;string;&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3393937">//&nbsp;of&nbsp;bytes;&nbsp;return&nbsp;values&nbsp;are&nbsp;adjusted&nbsp;as&nbsp;appropriate.</span><br>
<span class="lineno"></span><span class="comment" id="3393993">//</span><br>
<span class="lineno"></span><span class="comment" id="3393996">//&nbsp;If&nbsp;&#39;Submatch&#39;&nbsp;is&nbsp;present,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;a&nbsp;slice&nbsp;identifying&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="3394069">//&nbsp;successive&nbsp;submatches&nbsp;of&nbsp;the&nbsp;expression.&nbsp;Submatches&nbsp;are&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3394139">//&nbsp;parenthesized&nbsp;subexpressions&nbsp;(also&nbsp;known&nbsp;as&nbsp;capturing&nbsp;groups)&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3394215">//&nbsp;regular&nbsp;expression,&nbsp;numbered&nbsp;from&nbsp;left&nbsp;to&nbsp;right&nbsp;in&nbsp;order&nbsp;of&nbsp;opening</span><br>
<span class="lineno"></span><span class="comment" id="3394286">//&nbsp;parenthesis.&nbsp;Submatch&nbsp;0&nbsp;is&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire&nbsp;expression,&nbsp;submatch&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3394363">//&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;first&nbsp;parenthesized&nbsp;subexpression,&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">45</span><span class="comment" id="3394429">//</span><br>
<span class="lineno"></span><span class="comment" id="3394432">//&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;present,&nbsp;matches&nbsp;and&nbsp;submatches&nbsp;are&nbsp;identified&nbsp;by&nbsp;byte&nbsp;index</span><br>
<span class="lineno"></span><span class="comment" id="3394510">//&nbsp;pairs&nbsp;within&nbsp;the&nbsp;input&nbsp;string:&nbsp;result[2*n:2*n+1]&nbsp;identifies&nbsp;the&nbsp;indexes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3394588">//&nbsp;the&nbsp;nth&nbsp;submatch.&nbsp;&nbsp;The&nbsp;pair&nbsp;for&nbsp;n==0&nbsp;identifies&nbsp;the&nbsp;match&nbsp;of&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3394663">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;&#39;Index&#39;&nbsp;is&nbsp;not&nbsp;present,&nbsp;the&nbsp;match&nbsp;is&nbsp;identified&nbsp;by&nbsp;the</span><br>
<span class="lineno">50</span><span class="comment" id="3394737">//&nbsp;text&nbsp;of&nbsp;the&nbsp;match/submatch.&nbsp;&nbsp;If&nbsp;an&nbsp;index&nbsp;is&nbsp;negative,&nbsp;it&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3394808">//&nbsp;subexpression&nbsp;did&nbsp;not&nbsp;match&nbsp;any&nbsp;string&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3394864">//</span><br>
<span class="lineno"></span><span class="comment" id="3394867">//&nbsp;There&nbsp;is&nbsp;also&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;methods&nbsp;that&nbsp;can&nbsp;be&nbsp;applied&nbsp;to&nbsp;text&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3394941">//&nbsp;from&nbsp;a&nbsp;RuneReader:</span><br>
<span class="lineno">55</span><span class="comment" id="3394963">//</span><br>
<span class="lineno"></span><span class="comment" id="3394966">//&nbsp;&nbsp;&nbsp;&nbspMatchReader,&nbsp;FindReaderIndex,&nbsp;FindReaderSubmatchIndex</span><br>
<span class="lineno"></span><span class="comment" id="3395023">//</span><br>
<span class="lineno"></span><span class="comment" id="3395026">//&nbsp;This&nbsp;set&nbsp;may&nbsp;grow.&nbsp;&nbsp;Note&nbsp;that&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;may&nbsp;need&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3395098">//&nbsp;examine&nbsp;text&nbsp;beyond&nbsp;the&nbsp;text&nbsp;returned&nbsp;by&nbsp;a&nbsp;match,&nbsp;so&nbsp;the&nbsp;methods&nbsp;that</span><br>
<span class="lineno">60</span><span class="comment" id="3395171">//&nbsp;match&nbsp;text&nbsp;from&nbsp;a&nbsp;RuneReader&nbsp;may&nbsp;read&nbsp;arbitrarily&nbsp;far&nbsp;into&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span><span class="comment" id="3395243">//&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="comment" id="3395264">//</span><br>
<span class="lineno"></span><span class="comment" id="3395267">//&nbsp;(There&nbsp;are&nbsp;a&nbsp;few&nbsp;other&nbsp;methods&nbsp;that&nbsp;do&nbsp;not&nbsp;match&nbsp;this&nbsp;pattern.)</span><br>
<span class="lineno"></span><span class="comment" id="3395334">//</span><br>
<span class="lineno">65</span><span class="keyword" id="3395337">package</span>&nbsp;<span class="ident" id="3395345">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395353">import</span>&nbsp;<span class="op" id="3395360">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395363">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395372">&#34;io&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395378">&#34;regexp/syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395395">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395406">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395417">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395425">&#34;unicode&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3395436">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3395451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3395454">var</span>&nbsp;<span class="ident" id="3395458">debug</span>&nbsp;<span class="op" id="3395464">=</span>&nbsp;<span class="builtintype" id="3395466">false</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3395473">//&nbsp;Regexp&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;compiled&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3395539">//&nbsp;A&nbsp;Regexp&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3395602">type</span>&nbsp;<span class="ident" id="3395607">Regexp</span>&nbsp;<span class="keyword" id="3395614">struct</span>&nbsp;<span class="op" id="3395621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395624">//&nbsp;read-only&nbsp;after&nbsp;Compile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395652">expr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3395667">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395682">//&nbsp;as&nbsp;passed&nbsp;to&nbsp;Compile</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395707">prog</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395722">*</span><span class="ident" id="3395723">syntax</span><span class="op" id="3395729">.</span><span class="ident" id="3395730">Prog</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3395737">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395758">onepass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395773">*</span><span class="ident" id="3395774">onePassProg</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3395788">//&nbsp;onpass&nbsp;program&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395814">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3395829">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395844">//&nbsp;required&nbsp;prefix&nbsp;in&nbsp;unanchored&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395886">prefixBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3395901">[</span><span class="op" id="3395902">]</span><span class="builtintype" id="3395903">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395916">//&nbsp;prefix,&nbsp;as&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395940">prefixComplete</span>&nbsp;<span class="builtintype" id="3395955">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3395970">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;entire&nbsp;regexp</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396002">prefixRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3396017">rune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396032">//&nbsp;first&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396057">prefixEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3396072">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3396087">//&nbsp;pc&nbsp;for&nbsp;last&nbsp;rune&nbsp;in&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396118">cond</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396133">syntax</span><span class="op" id="3396139">.</span><span class="ident" id="3396140">EmptyOp</span>&nbsp;<span class="comment" id="3396148">//&nbsp;empty-width&nbsp;conditions&nbsp;required&nbsp;at&nbsp;start&nbsp;of&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396202">numSubexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3396217">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396222">subexpNames</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3396237">[</span><span class="op" id="3396238">]</span><span class="builtintype" id="3396239">string</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396247">longest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3396262">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3396269">//&nbsp;cache&nbsp;of&nbsp;machines&nbsp;for&nbsp;running&nbsp;regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396310">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3396318">sync</span><span class="op" id="3396322">.</span><span class="ident" id="3396323">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396330">machine</span>&nbsp;<span class="op" id="3396338">[</span><span class="op" id="3396339">]</span><span class="op" id="3396340">*</span><span class="ident" id="3396341">machine</span><br>
<span class="lineno">100</span><span class="op" id="3396349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396352">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;source&nbsp;text&nbsp;used&nbsp;to&nbsp;compile&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3396426">func</span>&nbsp;<span class="op" id="3396431">(</span><span class="ident" id="3396432">re</span>&nbsp;<span class="op" id="3396435">*</span><span class="ident" id="3396436">Regexp</span><span class="op" id="3396442">)</span>&nbsp;<span class="ident" id="3396444">String</span><span class="op" id="3396450">(</span><span class="op" id="3396451">)</span>&nbsp;<span class="builtintype" id="3396453">string</span>&nbsp;<span class="op" id="3396460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396463">return</span>&nbsp;<span class="ident" id="3396470">re</span><span class="op" id="3396472">.</span><span class="ident" id="3396473">expr</span><br>
<span class="lineno">105</span><span class="op" id="3396478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396481">//&nbsp;Compile&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;and&nbsp;returns,&nbsp;if&nbsp;successful,</span><br>
<span class="lineno"></span><span class="comment" id="3396548">//&nbsp;a&nbsp;Regexp&nbsp;object&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;match&nbsp;against&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="3396607">//</span><br>
<span class="lineno">110</span><span class="comment" id="3396610">//&nbsp;When&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3396673">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3396745">//&nbsp;it&nbsp;chooses&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3396818">//&nbsp;This&nbsp;so-called&nbsp;leftmost-first&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3396882">//&nbsp;that&nbsp;Perl,&nbsp;Python,&nbsp;and&nbsp;other&nbsp;implementations&nbsp;use,&nbsp;although&nbsp;this</span><br>
<span class="lineno">115</span><span class="comment" id="3396949">//&nbsp;package&nbsp;implements&nbsp;it&nbsp;without&nbsp;the&nbsp;expense&nbsp;of&nbsp;backtracking.</span><br>
<span class="lineno"></span><span class="comment" id="3397011">//&nbsp;For&nbsp;POSIX&nbsp;leftmost-longest&nbsp;matching,&nbsp;see&nbsp;CompilePOSIX.</span><br>
<span class="lineno"></span><span class="keyword" id="3397069">func</span>&nbsp;<span class="ident" id="3397074">Compile</span><span class="op" id="3397081">(</span><span class="ident" id="3397082">expr</span>&nbsp;<span class="builtintype" id="3397087">string</span><span class="op" id="3397093">)</span>&nbsp;<span class="op" id="3397095">(</span><span class="op" id="3397096">*</span><span class="ident" id="3397097">Regexp</span><span class="op" id="3397103">,</span>&nbsp;<span class="builtintype" id="3397105">error</span><span class="op" id="3397110">)</span>&nbsp;<span class="op" id="3397112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397115">return</span>&nbsp;<span class="ident" id="3397122">compile</span><span class="op" id="3397129">(</span><span class="ident" id="3397130">expr</span><span class="op" id="3397134">,</span>&nbsp;<span class="ident" id="3397136">syntax</span><span class="op" id="3397142">.</span><span class="ident" id="3397143">Perl</span><span class="op" id="3397147">,</span>&nbsp;<span class="builtintype" id="3397149">false</span><span class="op" id="3397154">)</span><br>
<span class="lineno"></span><span class="op" id="3397156">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3397159">//&nbsp;CompilePOSIX&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;restricts&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3397228">//&nbsp;to&nbsp;POSIX&nbsp;ERE&nbsp;(egrep)&nbsp;syntax&nbsp;and&nbsp;changes&nbsp;the&nbsp;match&nbsp;semantics&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3397294">//&nbsp;leftmost-longest.</span><br>
<span class="lineno"></span><span class="comment" id="3397315">//</span><br>
<span class="lineno">125</span><span class="comment" id="3397318">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3397390">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3397462">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="comment" id="3397513">//&nbsp;This&nbsp;so-called&nbsp;leftmost-longest&nbsp;matching&nbsp;is&nbsp;the&nbsp;same&nbsp;semantics</span><br>
<span class="lineno"></span><span class="comment" id="3397579">//&nbsp;that&nbsp;early&nbsp;regular&nbsp;expression&nbsp;implementations&nbsp;used&nbsp;and&nbsp;that&nbsp;POSIX</span><br>
<span class="lineno">130</span><span class="comment" id="3397648">//&nbsp;specifies.</span><br>
<span class="lineno"></span><span class="comment" id="3397662">//</span><br>
<span class="lineno"></span><span class="comment" id="3397665">//&nbsp;However,&nbsp;there&nbsp;can&nbsp;be&nbsp;multiple&nbsp;leftmost-longest&nbsp;matches,&nbsp;with&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3397740">//&nbsp;submatch&nbsp;choices,&nbsp;and&nbsp;here&nbsp;this&nbsp;package&nbsp;diverges&nbsp;from&nbsp;POSIX.</span><br>
<span class="lineno"></span><span class="comment" id="3397804">//&nbsp;Among&nbsp;the&nbsp;possible&nbsp;leftmost-longest&nbsp;matches,&nbsp;this&nbsp;package&nbsp;chooses</span><br>
<span class="lineno">135</span><span class="comment" id="3397873">//&nbsp;the&nbsp;one&nbsp;that&nbsp;a&nbsp;backtracking&nbsp;search&nbsp;would&nbsp;have&nbsp;found&nbsp;first,&nbsp;while&nbsp;POSIX</span><br>
<span class="lineno"></span><span class="comment" id="3397947">//&nbsp;specifies&nbsp;that&nbsp;the&nbsp;match&nbsp;be&nbsp;chosen&nbsp;to&nbsp;maximize&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3398021">//&nbsp;subexpression,&nbsp;then&nbsp;the&nbsp;second,&nbsp;and&nbsp;so&nbsp;on&nbsp;from&nbsp;left&nbsp;to&nbsp;right.</span><br>
<span class="lineno"></span><span class="comment" id="3398086">//&nbsp;The&nbsp;POSIX&nbsp;rule&nbsp;is&nbsp;computationally&nbsp;prohibitive&nbsp;and&nbsp;not&nbsp;even&nbsp;well-defined.</span><br>
<span class="lineno"></span><span class="comment" id="3398162">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html#posix&nbsp;for&nbsp;details.</span><br>
<span class="lineno">140</span><span class="keyword" id="3398230">func</span>&nbsp;<span class="ident" id="3398235">CompilePOSIX</span><span class="op" id="3398247">(</span><span class="ident" id="3398248">expr</span>&nbsp;<span class="builtintype" id="3398253">string</span><span class="op" id="3398259">)</span>&nbsp;<span class="op" id="3398261">(</span><span class="op" id="3398262">*</span><span class="ident" id="3398263">Regexp</span><span class="op" id="3398269">,</span>&nbsp;<span class="builtintype" id="3398271">error</span><span class="op" id="3398276">)</span>&nbsp;<span class="op" id="3398278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398281">return</span>&nbsp;<span class="ident" id="3398288">compile</span><span class="op" id="3398295">(</span><span class="ident" id="3398296">expr</span><span class="op" id="3398300">,</span>&nbsp;<span class="ident" id="3398302">syntax</span><span class="op" id="3398308">.</span><span class="ident" id="3398309">POSIX</span><span class="op" id="3398314">,</span>&nbsp;<span class="builtintype" id="3398316">true</span><span class="op" id="3398320">)</span><br>
<span class="lineno"></span><span class="op" id="3398322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3398325">//&nbsp;Longest&nbsp;makes&nbsp;future&nbsp;searches&nbsp;prefer&nbsp;the&nbsp;leftmost-longest&nbsp;match.</span><br>
<span class="lineno">145</span><span class="comment" id="3398393">//&nbsp;That&nbsp;is,&nbsp;when&nbsp;matching&nbsp;against&nbsp;text,&nbsp;the&nbsp;regexp&nbsp;returns&nbsp;a&nbsp;match&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3398465">//&nbsp;begins&nbsp;as&nbsp;early&nbsp;as&nbsp;possible&nbsp;in&nbsp;the&nbsp;input&nbsp;(leftmost),&nbsp;and&nbsp;among&nbsp;those</span><br>
<span class="lineno"></span><span class="comment" id="3398537">//&nbsp;it&nbsp;chooses&nbsp;a&nbsp;match&nbsp;that&nbsp;is&nbsp;as&nbsp;long&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="3398588">func</span>&nbsp;<span class="op" id="3398593">(</span><span class="ident" id="3398594">re</span>&nbsp;<span class="op" id="3398597">*</span><span class="ident" id="3398598">Regexp</span><span class="op" id="3398604">)</span>&nbsp;<span class="ident" id="3398606">Longest</span><span class="op" id="3398613">(</span><span class="op" id="3398614">)</span>&nbsp;<span class="op" id="3398616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398619">re</span><span class="op" id="3398621">.</span><span class="ident" id="3398622">longest</span>&nbsp;<span class="op" id="3398630">=</span>&nbsp;<span class="builtintype" id="3398632">true</span><br>
<span class="lineno">150</span><span class="op" id="3398637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3398640">func</span>&nbsp;<span class="ident" id="3398645">compile</span><span class="op" id="3398652">(</span><span class="ident" id="3398653">expr</span>&nbsp;<span class="builtintype" id="3398658">string</span><span class="op" id="3398664">,</span>&nbsp;<span class="ident" id="3398666">mode</span>&nbsp;<span class="ident" id="3398671">syntax</span><span class="op" id="3398677">.</span><span class="ident" id="3398678">Flags</span><span class="op" id="3398683">,</span>&nbsp;<span class="ident" id="3398685">longest</span>&nbsp;<span class="builtintype" id="3398693">bool</span><span class="op" id="3398697">)</span>&nbsp;<span class="op" id="3398699">(</span><span class="op" id="3398700">*</span><span class="ident" id="3398701">Regexp</span><span class="op" id="3398707">,</span>&nbsp;<span class="builtintype" id="3398709">error</span><span class="op" id="3398714">)</span>&nbsp;<span class="op" id="3398716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398719">re</span><span class="op" id="3398721">,</span>&nbsp;<span class="ident" id="3398723">err</span>&nbsp;<span class="op" id="3398727">:=</span>&nbsp;<span class="ident" id="3398730">syntax</span><span class="op" id="3398736">.</span><span class="ident" id="3398737">Parse</span><span class="op" id="3398742">(</span><span class="ident" id="3398743">expr</span><span class="op" id="3398747">,</span>&nbsp;<span class="ident" id="3398749">mode</span><span class="op" id="3398753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398756">if</span>&nbsp;<span class="ident" id="3398759">err</span>&nbsp;<span class="op" id="3398763">!=</span>&nbsp;<span class="ident" id="3398766">nil</span>&nbsp;<span class="op" id="3398770">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398774">return</span>&nbsp;<span class="ident" id="3398781">nil</span><span class="op" id="3398784">,</span>&nbsp;<span class="ident" id="3398786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398794">maxCap</span>&nbsp;<span class="op" id="3398801">:=</span>&nbsp;<span class="ident" id="3398804">re</span><span class="op" id="3398806">.</span><span class="ident" id="3398807">MaxCap</span><span class="op" id="3398813">(</span><span class="op" id="3398814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398817">capNames</span>&nbsp;<span class="op" id="3398826">:=</span>&nbsp;<span class="ident" id="3398829">re</span><span class="op" id="3398831">.</span><span class="ident" id="3398832">CapNames</span><span class="op" id="3398840">(</span><span class="op" id="3398841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398845">re</span>&nbsp;<span class="op" id="3398848">=</span>&nbsp;<span class="ident" id="3398850">re</span><span class="op" id="3398852">.</span><span class="ident" id="3398853">Simplify</span><span class="op" id="3398861">(</span><span class="op" id="3398862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398865">prog</span><span class="op" id="3398869">,</span>&nbsp;<span class="ident" id="3398871">err</span>&nbsp;<span class="op" id="3398875">:=</span>&nbsp;<span class="ident" id="3398878">syntax</span><span class="op" id="3398884">.</span><span class="ident" id="3398885">Compile</span><span class="op" id="3398892">(</span><span class="ident" id="3398893">re</span><span class="op" id="3398895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398898">if</span>&nbsp;<span class="ident" id="3398901">err</span>&nbsp;<span class="op" id="3398905">!=</span>&nbsp;<span class="ident" id="3398908">nil</span>&nbsp;<span class="op" id="3398912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398916">return</span>&nbsp;<span class="ident" id="3398923">nil</span><span class="op" id="3398926">,</span>&nbsp;<span class="ident" id="3398928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398933">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398936">regexp</span>&nbsp;<span class="op" id="3398943">:=</span>&nbsp;<span class="op" id="3398946">&amp;</span><span class="ident" id="3398947">Regexp</span><span class="op" id="3398953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398957">expr</span><span class="op" id="3398961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398970">expr</span><span class="op" id="3398974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398978">prog</span><span class="op" id="3398982">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3398991">prog</span><span class="op" id="3398995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398999">onepass</span><span class="op" id="3399006">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399012">compileOnePass</span><span class="op" id="3399026">(</span><span class="ident" id="3399027">prog</span><span class="op" id="3399031">)</span><span class="op" id="3399032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399036">numSubexp</span><span class="op" id="3399045">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3399049">maxCap</span><span class="op" id="3399055">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399059">subexpNames</span><span class="op" id="3399070">:</span>&nbsp;<span class="ident" id="3399072">capNames</span><span class="op" id="3399080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399084">cond</span><span class="op" id="3399088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399097">prog</span><span class="op" id="3399101">.</span><span class="ident" id="3399102">StartCond</span><span class="op" id="3399111">(</span><span class="op" id="3399112">)</span><span class="op" id="3399113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399117">longest</span><span class="op" id="3399124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3399130">longest</span><span class="op" id="3399137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399143">if</span>&nbsp;<span class="ident" id="3399146">regexp</span><span class="op" id="3399152">.</span><span class="ident" id="3399153">onepass</span>&nbsp;<span class="op" id="3399161">==</span>&nbsp;<span class="ident" id="3399164">notOnePass</span>&nbsp;<span class="op" id="3399175">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399179">regexp</span><span class="op" id="3399185">.</span><span class="ident" id="3399186">prefix</span><span class="op" id="3399192">,</span>&nbsp;<span class="ident" id="3399194">regexp</span><span class="op" id="3399200">.</span><span class="ident" id="3399201">prefixComplete</span>&nbsp;<span class="op" id="3399216">=</span>&nbsp;<span class="ident" id="3399218">prog</span><span class="op" id="3399222">.</span><span class="ident" id="3399223">Prefix</span><span class="op" id="3399229">(</span><span class="op" id="3399230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399233">}</span>&nbsp;<span class="keyword" id="3399235">else</span>&nbsp;<span class="op" id="3399240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399244">regexp</span><span class="op" id="3399250">.</span><span class="ident" id="3399251">prefix</span><span class="op" id="3399257">,</span>&nbsp;<span class="ident" id="3399259">regexp</span><span class="op" id="3399265">.</span><span class="ident" id="3399266">prefixComplete</span><span class="op" id="3399280">,</span>&nbsp;<span class="ident" id="3399282">regexp</span><span class="op" id="3399288">.</span><span class="ident" id="3399289">prefixEnd</span>&nbsp;<span class="op" id="3399299">=</span>&nbsp;<span class="ident" id="3399301">onePassPrefix</span><span class="op" id="3399314">(</span><span class="ident" id="3399315">prog</span><span class="op" id="3399319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399325">if</span>&nbsp;<span class="ident" id="3399328">regexp</span><span class="op" id="3399334">.</span><span class="ident" id="3399335">prefix</span>&nbsp;<span class="op" id="3399342">!=</span>&nbsp;<span class="string" id="3399345">&#34;&#34;</span>&nbsp;<span class="op" id="3399348">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399352">//&nbsp;TODO(rsc):&nbsp;Remove&nbsp;this&nbsp;allocation&nbsp;by&nbsp;adding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399401">//&nbsp;IndexString&nbsp;to&nbsp;package&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399436">regexp</span><span class="op" id="3399442">.</span><span class="ident" id="3399443">prefixBytes</span>&nbsp;<span class="op" id="3399455">=</span>&nbsp;<span class="op" id="3399457">[</span><span class="op" id="3399458">]</span><span class="builtintype" id="3399459">byte</span><span class="op" id="3399463">(</span><span class="ident" id="3399464">regexp</span><span class="op" id="3399470">.</span><span class="ident" id="3399471">prefix</span><span class="op" id="3399477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399481">regexp</span><span class="op" id="3399487">.</span><span class="ident" id="3399488">prefixRune</span><span class="op" id="3399498">,</span>&nbsp;<span class="ident" id="3399500">_</span>&nbsp;<span class="op" id="3399502">=</span>&nbsp;<span class="ident" id="3399504">utf8</span><span class="op" id="3399508">.</span><span class="ident" id="3399509">DecodeRuneInString</span><span class="op" id="3399527">(</span><span class="ident" id="3399528">regexp</span><span class="op" id="3399534">.</span><span class="ident" id="3399535">prefix</span><span class="op" id="3399541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399544">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399547">return</span>&nbsp;<span class="ident" id="3399554">regexp</span><span class="op" id="3399560">,</span>&nbsp;<span class="ident" id="3399562">nil</span><br>
<span class="lineno"></span><span class="op" id="3399566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3399569">//&nbsp;get&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;use&nbsp;for&nbsp;matching&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="3399618">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache&nbsp;if&nbsp;possible,&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">190</span><span class="comment" id="3399674">//&nbsp;unnecessary&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3399701">func</span>&nbsp;<span class="op" id="3399706">(</span><span class="ident" id="3399707">re</span>&nbsp;<span class="op" id="3399710">*</span><span class="ident" id="3399711">Regexp</span><span class="op" id="3399717">)</span>&nbsp;<span class="ident" id="3399719">get</span><span class="op" id="3399722">(</span><span class="op" id="3399723">)</span>&nbsp;<span class="op" id="3399725">*</span><span class="ident" id="3399726">machine</span>&nbsp;<span class="op" id="3399734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399737">re</span><span class="op" id="3399739">.</span><span class="ident" id="3399740">mu</span><span class="op" id="3399742">.</span><span class="ident" id="3399743">Lock</span><span class="op" id="3399747">(</span><span class="op" id="3399748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399751">if</span>&nbsp;<span class="ident" id="3399754">n</span>&nbsp;<span class="op" id="3399756">:=</span>&nbsp;<span class="builtinfunc" id="3399759">len</span><span class="op" id="3399762">(</span><span class="ident" id="3399763">re</span><span class="op" id="3399765">.</span><span class="ident" id="3399766">machine</span><span class="op" id="3399773">)</span><span class="op" id="3399774">;</span>&nbsp;<span class="ident" id="3399776">n</span>&nbsp;<span class="op" id="3399778">&gt;</span>&nbsp;<span class="num" id="3399780">0</span>&nbsp;<span class="op" id="3399782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399786">z</span>&nbsp;<span class="op" id="3399788">:=</span>&nbsp;<span class="ident" id="3399791">re</span><span class="op" id="3399793">.</span><span class="ident" id="3399794">machine</span><span class="op" id="3399801">[</span><span class="ident" id="3399802">n</span><span class="op" id="3399803">-</span><span class="num" id="3399804">1</span><span class="op" id="3399805">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399809">re</span><span class="op" id="3399811">.</span><span class="ident" id="3399812">machine</span>&nbsp;<span class="op" id="3399820">=</span>&nbsp;<span class="ident" id="3399822">re</span><span class="op" id="3399824">.</span><span class="ident" id="3399825">machine</span><span class="op" id="3399832">[</span><span class="op" id="3399833">:</span><span class="ident" id="3399834">n</span><span class="op" id="3399835">-</span><span class="num" id="3399836">1</span><span class="op" id="3399837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399841">re</span><span class="op" id="3399843">.</span><span class="ident" id="3399844">mu</span><span class="op" id="3399846">.</span><span class="ident" id="3399847">Unlock</span><span class="op" id="3399853">(</span><span class="op" id="3399854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399858">return</span>&nbsp;<span class="ident" id="3399865">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399871">re</span><span class="op" id="3399873">.</span><span class="ident" id="3399874">mu</span><span class="op" id="3399876">.</span><span class="ident" id="3399877">Unlock</span><span class="op" id="3399883">(</span><span class="op" id="3399884">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399887">z</span>&nbsp;<span class="op" id="3399889">:=</span>&nbsp;<span class="ident" id="3399892">progMachine</span><span class="op" id="3399903">(</span><span class="ident" id="3399904">re</span><span class="op" id="3399906">.</span><span class="ident" id="3399907">prog</span><span class="op" id="3399911">,</span>&nbsp;<span class="ident" id="3399913">re</span><span class="op" id="3399915">.</span><span class="ident" id="3399916">onepass</span><span class="op" id="3399923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399926">z</span><span class="op" id="3399927">.</span><span class="ident" id="3399928">re</span>&nbsp;<span class="op" id="3399931">=</span>&nbsp;<span class="ident" id="3399933">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399937">return</span>&nbsp;<span class="ident" id="3399944">z</span><br>
<span class="lineno"></span><span class="op" id="3399946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="3399949">//&nbsp;put&nbsp;returns&nbsp;a&nbsp;machine&nbsp;to&nbsp;the&nbsp;re&#39;s&nbsp;machine&nbsp;cache.</span><br>
<span class="lineno"></span><span class="comment" id="3400001">//&nbsp;There&nbsp;is&nbsp;no&nbsp;attempt&nbsp;to&nbsp;limit&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;cache,&nbsp;so&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="3400067">//&nbsp;grow&nbsp;to&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;simultaneous&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3400121">//&nbsp;run&nbsp;using&nbsp;re.&nbsp;&nbsp;(The&nbsp;cache&nbsp;empties&nbsp;when&nbsp;re&nbsp;gets&nbsp;garbage&nbsp;collected.)</span><br>
<span class="lineno"></span><span class="keyword" id="3400191">func</span>&nbsp;<span class="op" id="3400196">(</span><span class="ident" id="3400197">re</span>&nbsp;<span class="op" id="3400200">*</span><span class="ident" id="3400201">Regexp</span><span class="op" id="3400207">)</span>&nbsp;<span class="ident" id="3400209">put</span><span class="op" id="3400212">(</span><span class="ident" id="3400213">z</span>&nbsp;<span class="op" id="3400215">*</span><span class="ident" id="3400216">machine</span><span class="op" id="3400223">)</span>&nbsp;<span class="op" id="3400225">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400228">re</span><span class="op" id="3400230">.</span><span class="ident" id="3400231">mu</span><span class="op" id="3400233">.</span><span class="ident" id="3400234">Lock</span><span class="op" id="3400238">(</span><span class="op" id="3400239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400242">re</span><span class="op" id="3400244">.</span><span class="ident" id="3400245">machine</span>&nbsp;<span class="op" id="3400253">=</span>&nbsp;<span class="builtinfunc" id="3400255">append</span><span class="op" id="3400261">(</span><span class="ident" id="3400262">re</span><span class="op" id="3400264">.</span><span class="ident" id="3400265">machine</span><span class="op" id="3400272">,</span>&nbsp;<span class="ident" id="3400274">z</span><span class="op" id="3400275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400278">re</span><span class="op" id="3400280">.</span><span class="ident" id="3400281">mu</span><span class="op" id="3400283">.</span><span class="ident" id="3400284">Unlock</span><span class="op" id="3400290">(</span><span class="op" id="3400291">)</span><br>
<span class="lineno"></span><span class="op" id="3400293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="3400296">//&nbsp;MustCompile&nbsp;is&nbsp;like&nbsp;Compile&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3400374">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3400456">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3400472">func</span>&nbsp;<span class="ident" id="3400477">MustCompile</span><span class="op" id="3400488">(</span><span class="ident" id="3400489">str</span>&nbsp;<span class="builtintype" id="3400493">string</span><span class="op" id="3400499">)</span>&nbsp;<span class="op" id="3400501">*</span><span class="ident" id="3400502">Regexp</span>&nbsp;<span class="op" id="3400509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400512">regexp</span><span class="op" id="3400518">,</span>&nbsp;<span class="builtintype" id="3400520">error</span>&nbsp;<span class="op" id="3400526">:=</span>&nbsp;<span class="ident" id="3400529">Compile</span><span class="op" id="3400536">(</span><span class="ident" id="3400537">str</span><span class="op" id="3400540">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400543">if</span>&nbsp;<span class="builtintype" id="3400546">error</span>&nbsp;<span class="op" id="3400552">!=</span>&nbsp;<span class="ident" id="3400555">nil</span>&nbsp;<span class="op" id="3400559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3400563">panic</span><span class="op" id="3400568">(</span><span class="string" id="3400569">`regexp:&nbsp;Compile(`</span>&nbsp;<span class="op" id="3400588">+</span>&nbsp;<span class="ident" id="3400590">quote</span><span class="op" id="3400595">(</span><span class="ident" id="3400596">str</span><span class="op" id="3400599">)</span>&nbsp;<span class="op" id="3400601">+</span>&nbsp;<span class="string" id="3400603">`):&nbsp;`</span>&nbsp;<span class="op" id="3400609">+</span>&nbsp;<span class="builtintype" id="3400611">error</span><span class="op" id="3400616">.</span><span class="ident" id="3400617">Error</span><span class="op" id="3400622">(</span><span class="op" id="3400623">)</span><span class="op" id="3400624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400630">return</span>&nbsp;<span class="ident" id="3400637">regexp</span><br>
<span class="lineno"></span><span class="op" id="3400644">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3400647">//&nbsp;MustCompilePOSIX&nbsp;is&nbsp;like&nbsp;CompilePOSIX&nbsp;but&nbsp;panics&nbsp;if&nbsp;the&nbsp;expression&nbsp;cannot&nbsp;be&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3400735">//&nbsp;It&nbsp;simplifies&nbsp;safe&nbsp;initialization&nbsp;of&nbsp;global&nbsp;variables&nbsp;holding&nbsp;compiled&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3400817">//&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="keyword" id="3400833">func</span>&nbsp;<span class="ident" id="3400838">MustCompilePOSIX</span><span class="op" id="3400854">(</span><span class="ident" id="3400855">str</span>&nbsp;<span class="builtintype" id="3400859">string</span><span class="op" id="3400865">)</span>&nbsp;<span class="op" id="3400867">*</span><span class="ident" id="3400868">Regexp</span>&nbsp;<span class="op" id="3400875">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400878">regexp</span><span class="op" id="3400884">,</span>&nbsp;<span class="builtintype" id="3400886">error</span>&nbsp;<span class="op" id="3400892">:=</span>&nbsp;<span class="ident" id="3400895">CompilePOSIX</span><span class="op" id="3400907">(</span><span class="ident" id="3400908">str</span><span class="op" id="3400911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400914">if</span>&nbsp;<span class="builtintype" id="3400917">error</span>&nbsp;<span class="op" id="3400923">!=</span>&nbsp;<span class="ident" id="3400926">nil</span>&nbsp;<span class="op" id="3400930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3400934">panic</span><span class="op" id="3400939">(</span><span class="string" id="3400940">`regexp:&nbsp;CompilePOSIX(`</span>&nbsp;<span class="op" id="3400964">+</span>&nbsp;<span class="ident" id="3400966">quote</span><span class="op" id="3400971">(</span><span class="ident" id="3400972">str</span><span class="op" id="3400975">)</span>&nbsp;<span class="op" id="3400977">+</span>&nbsp;<span class="string" id="3400979">`):&nbsp;`</span>&nbsp;<span class="op" id="3400985">+</span>&nbsp;<span class="builtintype" id="3400987">error</span><span class="op" id="3400992">.</span><span class="ident" id="3400993">Error</span><span class="op" id="3400998">(</span><span class="op" id="3400999">)</span><span class="op" id="3401000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401006">return</span>&nbsp;<span class="ident" id="3401013">regexp</span><br>
<span class="lineno">235</span><span class="op" id="3401020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3401023">func</span>&nbsp;<span class="ident" id="3401028">quote</span><span class="op" id="3401033">(</span><span class="ident" id="3401034">s</span>&nbsp;<span class="builtintype" id="3401036">string</span><span class="op" id="3401042">)</span>&nbsp;<span class="builtintype" id="3401044">string</span>&nbsp;<span class="op" id="3401051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401054">if</span>&nbsp;<span class="ident" id="3401057">strconv</span><span class="op" id="3401064">.</span><span class="ident" id="3401065">CanBackquote</span><span class="op" id="3401077">(</span><span class="ident" id="3401078">s</span><span class="op" id="3401079">)</span>&nbsp;<span class="op" id="3401081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401085">return</span>&nbsp;<span class="string" id="3401092">&#34;`&#34;</span>&nbsp;<span class="op" id="3401096">+</span>&nbsp;<span class="ident" id="3401098">s</span>&nbsp;<span class="op" id="3401100">+</span>&nbsp;<span class="string" id="3401102">&#34;`&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401110">return</span>&nbsp;<span class="ident" id="3401117">strconv</span><span class="op" id="3401124">.</span><span class="ident" id="3401125">Quote</span><span class="op" id="3401130">(</span><span class="ident" id="3401131">s</span><span class="op" id="3401132">)</span><br>
<span class="lineno"></span><span class="op" id="3401134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3401137">//&nbsp;NumSubexp&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;parenthesized&nbsp;subexpressions&nbsp;in&nbsp;this&nbsp;Regexp.</span><br>
<span class="lineno">245</span><span class="keyword" id="3401217">func</span>&nbsp;<span class="op" id="3401222">(</span><span class="ident" id="3401223">re</span>&nbsp;<span class="op" id="3401226">*</span><span class="ident" id="3401227">Regexp</span><span class="op" id="3401233">)</span>&nbsp;<span class="ident" id="3401235">NumSubexp</span><span class="op" id="3401244">(</span><span class="op" id="3401245">)</span>&nbsp;<span class="builtintype" id="3401247">int</span>&nbsp;<span class="op" id="3401251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401254">return</span>&nbsp;<span class="ident" id="3401261">re</span><span class="op" id="3401263">.</span><span class="ident" id="3401264">numSubexp</span><br>
<span class="lineno"></span><span class="op" id="3401274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3401277">//&nbsp;SubexpNames&nbsp;returns&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;parenthesized&nbsp;subexpressions</span><br>
<span class="lineno">250</span><span class="comment" id="3401346">//&nbsp;in&nbsp;this&nbsp;Regexp.&nbsp;&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;first&nbsp;sub-expression&nbsp;is&nbsp;names[1],</span><br>
<span class="lineno"></span><span class="comment" id="3401417">//&nbsp;so&nbsp;that&nbsp;if&nbsp;m&nbsp;is&nbsp;a&nbsp;match&nbsp;slice,&nbsp;the&nbsp;name&nbsp;for&nbsp;m[i]&nbsp;is&nbsp;SubexpNames()[i].</span><br>
<span class="lineno"></span><span class="comment" id="3401490">//&nbsp;Since&nbsp;the&nbsp;Regexp&nbsp;as&nbsp;a&nbsp;whole&nbsp;cannot&nbsp;be&nbsp;named,&nbsp;names[0]&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span><span class="comment" id="3401557">//&nbsp;the&nbsp;empty&nbsp;string.&nbsp;&nbsp;The&nbsp;slice&nbsp;should&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="keyword" id="3401613">func</span>&nbsp;<span class="op" id="3401618">(</span><span class="ident" id="3401619">re</span>&nbsp;<span class="op" id="3401622">*</span><span class="ident" id="3401623">Regexp</span><span class="op" id="3401629">)</span>&nbsp;<span class="ident" id="3401631">SubexpNames</span><span class="op" id="3401642">(</span><span class="op" id="3401643">)</span>&nbsp;<span class="op" id="3401645">[</span><span class="op" id="3401646">]</span><span class="builtintype" id="3401647">string</span>&nbsp;<span class="op" id="3401654">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401657">return</span>&nbsp;<span class="ident" id="3401664">re</span><span class="op" id="3401666">.</span><span class="ident" id="3401667">subexpNames</span><br>
<span class="lineno"></span><span class="op" id="3401679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3401682">const</span>&nbsp;<span class="ident" id="3401688">endOfText</span>&nbsp;<span class="builtintype" id="3401698">rune</span>&nbsp;<span class="op" id="3401703">=</span>&nbsp;<span class="op" id="3401705">-</span><span class="num" id="3401706">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3401709">//&nbsp;input&nbsp;abstracts&nbsp;different&nbsp;representations&nbsp;of&nbsp;the&nbsp;input&nbsp;text.&nbsp;It&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment" id="3401785">//&nbsp;one-character&nbsp;lookahead.</span><br>
<span class="lineno"></span><span class="keyword" id="3401813">type</span>&nbsp;<span class="ident" id="3401818">input</span>&nbsp;<span class="keyword" id="3401824">interface</span>&nbsp;<span class="op" id="3401834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401837">step</span><span class="op" id="3401841">(</span><span class="ident" id="3401842">pos</span>&nbsp;<span class="builtintype" id="3401846">int</span><span class="op" id="3401849">)</span>&nbsp;<span class="op" id="3401851">(</span><span class="ident" id="3401852">r</span>&nbsp;<span class="builtintype" id="3401854">rune</span><span class="op" id="3401858">,</span>&nbsp;<span class="ident" id="3401860">width</span>&nbsp;<span class="builtintype" id="3401866">int</span><span class="op" id="3401869">)</span>&nbsp;<span class="comment" id="3401871">//&nbsp;advance&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401892">canCheckPrefix</span><span class="op" id="3401906">(</span><span class="op" id="3401907">)</span>&nbsp;<span class="builtintype" id="3401909">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3401926">//&nbsp;can&nbsp;we&nbsp;look&nbsp;ahead&nbsp;without&nbsp;losing&nbsp;info?</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401969">hasPrefix</span><span class="op" id="3401978">(</span><span class="ident" id="3401979">re</span>&nbsp;<span class="op" id="3401982">*</span><span class="ident" id="3401983">Regexp</span><span class="op" id="3401989">)</span>&nbsp;<span class="builtintype" id="3401991">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401997">index</span><span class="op" id="3402002">(</span><span class="ident" id="3402003">re</span>&nbsp;<span class="op" id="3402006">*</span><span class="ident" id="3402007">Regexp</span><span class="op" id="3402013">,</span>&nbsp;<span class="ident" id="3402015">pos</span>&nbsp;<span class="builtintype" id="3402019">int</span><span class="op" id="3402022">)</span>&nbsp;<span class="builtintype" id="3402024">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402029">context</span><span class="op" id="3402036">(</span><span class="ident" id="3402037">pos</span>&nbsp;<span class="builtintype" id="3402041">int</span><span class="op" id="3402044">)</span>&nbsp;<span class="ident" id="3402046">syntax</span><span class="op" id="3402052">.</span><span class="ident" id="3402053">EmptyOp</span><br>
<span class="lineno"></span><span class="op" id="3402061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3402064">//&nbsp;inputString&nbsp;scans&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3402095">type</span>&nbsp;<span class="ident" id="3402100">inputString</span>&nbsp;<span class="keyword" id="3402112">struct</span>&nbsp;<span class="op" id="3402119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402122">str</span>&nbsp;<span class="builtintype" id="3402126">string</span><br>
<span class="lineno"></span><span class="op" id="3402133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="3402136">func</span>&nbsp;<span class="op" id="3402141">(</span><span class="ident" id="3402142">i</span>&nbsp;<span class="op" id="3402144">*</span><span class="ident" id="3402145">inputString</span><span class="op" id="3402156">)</span>&nbsp;<span class="ident" id="3402158">step</span><span class="op" id="3402162">(</span><span class="ident" id="3402163">pos</span>&nbsp;<span class="builtintype" id="3402167">int</span><span class="op" id="3402170">)</span>&nbsp;<span class="op" id="3402172">(</span><span class="builtintype" id="3402173">rune</span><span class="op" id="3402177">,</span>&nbsp;<span class="builtintype" id="3402179">int</span><span class="op" id="3402182">)</span>&nbsp;<span class="op" id="3402184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402187">if</span>&nbsp;<span class="ident" id="3402190">pos</span>&nbsp;<span class="op" id="3402194">&lt;</span>&nbsp;<span class="builtinfunc" id="3402196">len</span><span class="op" id="3402199">(</span><span class="ident" id="3402200">i</span><span class="op" id="3402201">.</span><span class="ident" id="3402202">str</span><span class="op" id="3402205">)</span>&nbsp;<span class="op" id="3402207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402211">c</span>&nbsp;<span class="op" id="3402213">:=</span>&nbsp;<span class="ident" id="3402216">i</span><span class="op" id="3402217">.</span><span class="ident" id="3402218">str</span><span class="op" id="3402221">[</span><span class="ident" id="3402222">pos</span><span class="op" id="3402225">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402229">if</span>&nbsp;<span class="ident" id="3402232">c</span>&nbsp;<span class="op" id="3402234">&lt;</span>&nbsp;<span class="ident" id="3402236">utf8</span><span class="op" id="3402240">.</span><span class="ident" id="3402241">RuneSelf</span>&nbsp;<span class="op" id="3402250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402255">return</span>&nbsp;<span class="builtintype" id="3402262">rune</span><span class="op" id="3402266">(</span><span class="ident" id="3402267">c</span><span class="op" id="3402268">)</span><span class="op" id="3402269">,</span>&nbsp;<span class="num" id="3402271">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402279">return</span>&nbsp;<span class="ident" id="3402286">utf8</span><span class="op" id="3402290">.</span><span class="ident" id="3402291">DecodeRuneInString</span><span class="op" id="3402309">(</span><span class="ident" id="3402310">i</span><span class="op" id="3402311">.</span><span class="ident" id="3402312">str</span><span class="op" id="3402315">[</span><span class="ident" id="3402316">pos</span><span class="op" id="3402319">:</span><span class="op" id="3402320">]</span><span class="op" id="3402321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402327">return</span>&nbsp;<span class="ident" id="3402334">endOfText</span><span class="op" id="3402343">,</span>&nbsp;<span class="num" id="3402345">0</span><br>
<span class="lineno"></span><span class="op" id="3402347">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="3402350">func</span>&nbsp;<span class="op" id="3402355">(</span><span class="ident" id="3402356">i</span>&nbsp;<span class="op" id="3402358">*</span><span class="ident" id="3402359">inputString</span><span class="op" id="3402370">)</span>&nbsp;<span class="ident" id="3402372">canCheckPrefix</span><span class="op" id="3402386">(</span><span class="op" id="3402387">)</span>&nbsp;<span class="builtintype" id="3402389">bool</span>&nbsp;<span class="op" id="3402394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402397">return</span>&nbsp;<span class="builtintype" id="3402404">true</span><br>
<span class="lineno"></span><span class="op" id="3402409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="3402412">func</span>&nbsp;<span class="op" id="3402417">(</span><span class="ident" id="3402418">i</span>&nbsp;<span class="op" id="3402420">*</span><span class="ident" id="3402421">inputString</span><span class="op" id="3402432">)</span>&nbsp;<span class="ident" id="3402434">hasPrefix</span><span class="op" id="3402443">(</span><span class="ident" id="3402444">re</span>&nbsp;<span class="op" id="3402447">*</span><span class="ident" id="3402448">Regexp</span><span class="op" id="3402454">)</span>&nbsp;<span class="builtintype" id="3402456">bool</span>&nbsp;<span class="op" id="3402461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402464">return</span>&nbsp;<span class="ident" id="3402471">strings</span><span class="op" id="3402478">.</span><span class="ident" id="3402479">HasPrefix</span><span class="op" id="3402488">(</span><span class="ident" id="3402489">i</span><span class="op" id="3402490">.</span><span class="ident" id="3402491">str</span><span class="op" id="3402494">,</span>&nbsp;<span class="ident" id="3402496">re</span><span class="op" id="3402498">.</span><span class="ident" id="3402499">prefix</span><span class="op" id="3402505">)</span><br>
<span class="lineno"></span><span class="op" id="3402507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402510">func</span>&nbsp;<span class="op" id="3402515">(</span><span class="ident" id="3402516">i</span>&nbsp;<span class="op" id="3402518">*</span><span class="ident" id="3402519">inputString</span><span class="op" id="3402530">)</span>&nbsp;<span class="ident" id="3402532">index</span><span class="op" id="3402537">(</span><span class="ident" id="3402538">re</span>&nbsp;<span class="op" id="3402541">*</span><span class="ident" id="3402542">Regexp</span><span class="op" id="3402548">,</span>&nbsp;<span class="ident" id="3402550">pos</span>&nbsp;<span class="builtintype" id="3402554">int</span><span class="op" id="3402557">)</span>&nbsp;<span class="builtintype" id="3402559">int</span>&nbsp;<span class="op" id="3402563">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402566">return</span>&nbsp;<span class="ident" id="3402573">strings</span><span class="op" id="3402580">.</span><span class="ident" id="3402581">Index</span><span class="op" id="3402586">(</span><span class="ident" id="3402587">i</span><span class="op" id="3402588">.</span><span class="ident" id="3402589">str</span><span class="op" id="3402592">[</span><span class="ident" id="3402593">pos</span><span class="op" id="3402596">:</span><span class="op" id="3402597">]</span><span class="op" id="3402598">,</span>&nbsp;<span class="ident" id="3402600">re</span><span class="op" id="3402602">.</span><span class="ident" id="3402603">prefix</span><span class="op" id="3402609">)</span><br>
<span class="lineno"></span><span class="op" id="3402611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402614">func</span>&nbsp;<span class="op" id="3402619">(</span><span class="ident" id="3402620">i</span>&nbsp;<span class="op" id="3402622">*</span><span class="ident" id="3402623">inputString</span><span class="op" id="3402634">)</span>&nbsp;<span class="ident" id="3402636">context</span><span class="op" id="3402643">(</span><span class="ident" id="3402644">pos</span>&nbsp;<span class="builtintype" id="3402648">int</span><span class="op" id="3402651">)</span>&nbsp;<span class="ident" id="3402653">syntax</span><span class="op" id="3402659">.</span><span class="ident" id="3402660">EmptyOp</span>&nbsp;<span class="op" id="3402668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402671">r1</span><span class="op" id="3402673">,</span>&nbsp;<span class="ident" id="3402675">r2</span>&nbsp;<span class="op" id="3402678">:=</span>&nbsp;<span class="ident" id="3402681">endOfText</span><span class="op" id="3402690">,</span>&nbsp;<span class="ident" id="3402692">endOfText</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402703">if</span>&nbsp;<span class="ident" id="3402706">pos</span>&nbsp;<span class="op" id="3402710">&gt;</span>&nbsp;<span class="num" id="3402712">0</span>&nbsp;<span class="op" id="3402714">&amp;&amp;</span>&nbsp;<span class="ident" id="3402717">pos</span>&nbsp;<span class="op" id="3402721">&lt;=</span>&nbsp;<span class="builtinfunc" id="3402724">len</span><span class="op" id="3402727">(</span><span class="ident" id="3402728">i</span><span class="op" id="3402729">.</span><span class="ident" id="3402730">str</span><span class="op" id="3402733">)</span>&nbsp;<span class="op" id="3402735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402739">r1</span><span class="op" id="3402741">,</span>&nbsp;<span class="ident" id="3402743">_</span>&nbsp;<span class="op" id="3402745">=</span>&nbsp;<span class="ident" id="3402747">utf8</span><span class="op" id="3402751">.</span><span class="ident" id="3402752">DecodeLastRuneInString</span><span class="op" id="3402774">(</span><span class="ident" id="3402775">i</span><span class="op" id="3402776">.</span><span class="ident" id="3402777">str</span><span class="op" id="3402780">[</span><span class="op" id="3402781">:</span><span class="ident" id="3402782">pos</span><span class="op" id="3402785">]</span><span class="op" id="3402786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402792">if</span>&nbsp;<span class="ident" id="3402795">pos</span>&nbsp;<span class="op" id="3402799">&lt;</span>&nbsp;<span class="builtinfunc" id="3402801">len</span><span class="op" id="3402804">(</span><span class="ident" id="3402805">i</span><span class="op" id="3402806">.</span><span class="ident" id="3402807">str</span><span class="op" id="3402810">)</span>&nbsp;<span class="op" id="3402812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402816">r2</span><span class="op" id="3402818">,</span>&nbsp;<span class="ident" id="3402820">_</span>&nbsp;<span class="op" id="3402822">=</span>&nbsp;<span class="ident" id="3402824">utf8</span><span class="op" id="3402828">.</span><span class="ident" id="3402829">DecodeRuneInString</span><span class="op" id="3402847">(</span><span class="ident" id="3402848">i</span><span class="op" id="3402849">.</span><span class="ident" id="3402850">str</span><span class="op" id="3402853">[</span><span class="ident" id="3402854">pos</span><span class="op" id="3402857">:</span><span class="op" id="3402858">]</span><span class="op" id="3402859">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402865">return</span>&nbsp;<span class="ident" id="3402872">syntax</span><span class="op" id="3402878">.</span><span class="ident" id="3402879">EmptyOpContext</span><span class="op" id="3402893">(</span><span class="ident" id="3402894">r1</span><span class="op" id="3402896">,</span>&nbsp;<span class="ident" id="3402898">r2</span><span class="op" id="3402900">)</span><br>
<span class="lineno"></span><span class="op" id="3402902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3402905">//&nbsp;inputBytes&nbsp;scans&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="3402939">type</span>&nbsp;<span class="ident" id="3402944">inputBytes</span>&nbsp;<span class="keyword" id="3402955">struct</span>&nbsp;<span class="op" id="3402962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402965">str</span>&nbsp;<span class="op" id="3402969">[</span><span class="op" id="3402970">]</span><span class="builtintype" id="3402971">byte</span><br>
<span class="lineno"></span><span class="op" id="3402976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3402979">func</span>&nbsp;<span class="op" id="3402984">(</span><span class="ident" id="3402985">i</span>&nbsp;<span class="op" id="3402987">*</span><span class="ident" id="3402988">inputBytes</span><span class="op" id="3402998">)</span>&nbsp;<span class="ident" id="3403000">step</span><span class="op" id="3403004">(</span><span class="ident" id="3403005">pos</span>&nbsp;<span class="builtintype" id="3403009">int</span><span class="op" id="3403012">)</span>&nbsp;<span class="op" id="3403014">(</span><span class="builtintype" id="3403015">rune</span><span class="op" id="3403019">,</span>&nbsp;<span class="builtintype" id="3403021">int</span><span class="op" id="3403024">)</span>&nbsp;<span class="op" id="3403026">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403029">if</span>&nbsp;<span class="ident" id="3403032">pos</span>&nbsp;<span class="op" id="3403036">&lt;</span>&nbsp;<span class="builtinfunc" id="3403038">len</span><span class="op" id="3403041">(</span><span class="ident" id="3403042">i</span><span class="op" id="3403043">.</span><span class="ident" id="3403044">str</span><span class="op" id="3403047">)</span>&nbsp;<span class="op" id="3403049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403053">c</span>&nbsp;<span class="op" id="3403055">:=</span>&nbsp;<span class="ident" id="3403058">i</span><span class="op" id="3403059">.</span><span class="ident" id="3403060">str</span><span class="op" id="3403063">[</span><span class="ident" id="3403064">pos</span><span class="op" id="3403067">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403071">if</span>&nbsp;<span class="ident" id="3403074">c</span>&nbsp;<span class="op" id="3403076">&lt;</span>&nbsp;<span class="ident" id="3403078">utf8</span><span class="op" id="3403082">.</span><span class="ident" id="3403083">RuneSelf</span>&nbsp;<span class="op" id="3403092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403097">return</span>&nbsp;<span class="builtintype" id="3403104">rune</span><span class="op" id="3403108">(</span><span class="ident" id="3403109">c</span><span class="op" id="3403110">)</span><span class="op" id="3403111">,</span>&nbsp;<span class="num" id="3403113">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403117">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403121">return</span>&nbsp;<span class="ident" id="3403128">utf8</span><span class="op" id="3403132">.</span><span class="ident" id="3403133">DecodeRune</span><span class="op" id="3403143">(</span><span class="ident" id="3403144">i</span><span class="op" id="3403145">.</span><span class="ident" id="3403146">str</span><span class="op" id="3403149">[</span><span class="ident" id="3403150">pos</span><span class="op" id="3403153">:</span><span class="op" id="3403154">]</span><span class="op" id="3403155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403161">return</span>&nbsp;<span class="ident" id="3403168">endOfText</span><span class="op" id="3403177">,</span>&nbsp;<span class="num" id="3403179">0</span><br>
<span class="lineno"></span><span class="op" id="3403181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="3403184">func</span>&nbsp;<span class="op" id="3403189">(</span><span class="ident" id="3403190">i</span>&nbsp;<span class="op" id="3403192">*</span><span class="ident" id="3403193">inputBytes</span><span class="op" id="3403203">)</span>&nbsp;<span class="ident" id="3403205">canCheckPrefix</span><span class="op" id="3403219">(</span><span class="op" id="3403220">)</span>&nbsp;<span class="builtintype" id="3403222">bool</span>&nbsp;<span class="op" id="3403227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403230">return</span>&nbsp;<span class="builtintype" id="3403237">true</span><br>
<span class="lineno"></span><span class="op" id="3403242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3403245">func</span>&nbsp;<span class="op" id="3403250">(</span><span class="ident" id="3403251">i</span>&nbsp;<span class="op" id="3403253">*</span><span class="ident" id="3403254">inputBytes</span><span class="op" id="3403264">)</span>&nbsp;<span class="ident" id="3403266">hasPrefix</span><span class="op" id="3403275">(</span><span class="ident" id="3403276">re</span>&nbsp;<span class="op" id="3403279">*</span><span class="ident" id="3403280">Regexp</span><span class="op" id="3403286">)</span>&nbsp;<span class="builtintype" id="3403288">bool</span>&nbsp;<span class="op" id="3403293">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403296">return</span>&nbsp;<span class="ident" id="3403303">bytes</span><span class="op" id="3403308">.</span><span class="ident" id="3403309">HasPrefix</span><span class="op" id="3403318">(</span><span class="ident" id="3403319">i</span><span class="op" id="3403320">.</span><span class="ident" id="3403321">str</span><span class="op" id="3403324">,</span>&nbsp;<span class="ident" id="3403326">re</span><span class="op" id="3403328">.</span><span class="ident" id="3403329">prefixBytes</span><span class="op" id="3403340">)</span><br>
<span class="lineno"></span><span class="op" id="3403342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3403345">func</span>&nbsp;<span class="op" id="3403350">(</span><span class="ident" id="3403351">i</span>&nbsp;<span class="op" id="3403353">*</span><span class="ident" id="3403354">inputBytes</span><span class="op" id="3403364">)</span>&nbsp;<span class="ident" id="3403366">index</span><span class="op" id="3403371">(</span><span class="ident" id="3403372">re</span>&nbsp;<span class="op" id="3403375">*</span><span class="ident" id="3403376">Regexp</span><span class="op" id="3403382">,</span>&nbsp;<span class="ident" id="3403384">pos</span>&nbsp;<span class="builtintype" id="3403388">int</span><span class="op" id="3403391">)</span>&nbsp;<span class="builtintype" id="3403393">int</span>&nbsp;<span class="op" id="3403397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403400">return</span>&nbsp;<span class="ident" id="3403407">bytes</span><span class="op" id="3403412">.</span><span class="ident" id="3403413">Index</span><span class="op" id="3403418">(</span><span class="ident" id="3403419">i</span><span class="op" id="3403420">.</span><span class="ident" id="3403421">str</span><span class="op" id="3403424">[</span><span class="ident" id="3403425">pos</span><span class="op" id="3403428">:</span><span class="op" id="3403429">]</span><span class="op" id="3403430">,</span>&nbsp;<span class="ident" id="3403432">re</span><span class="op" id="3403434">.</span><span class="ident" id="3403435">prefixBytes</span><span class="op" id="3403446">)</span><br>
<span class="lineno">335</span><span class="op" id="3403448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3403451">func</span>&nbsp;<span class="op" id="3403456">(</span><span class="ident" id="3403457">i</span>&nbsp;<span class="op" id="3403459">*</span><span class="ident" id="3403460">inputBytes</span><span class="op" id="3403470">)</span>&nbsp;<span class="ident" id="3403472">context</span><span class="op" id="3403479">(</span><span class="ident" id="3403480">pos</span>&nbsp;<span class="builtintype" id="3403484">int</span><span class="op" id="3403487">)</span>&nbsp;<span class="ident" id="3403489">syntax</span><span class="op" id="3403495">.</span><span class="ident" id="3403496">EmptyOp</span>&nbsp;<span class="op" id="3403504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403507">r1</span><span class="op" id="3403509">,</span>&nbsp;<span class="ident" id="3403511">r2</span>&nbsp;<span class="op" id="3403514">:=</span>&nbsp;<span class="ident" id="3403517">endOfText</span><span class="op" id="3403526">,</span>&nbsp;<span class="ident" id="3403528">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403539">if</span>&nbsp;<span class="ident" id="3403542">pos</span>&nbsp;<span class="op" id="3403546">&gt;</span>&nbsp;<span class="num" id="3403548">0</span>&nbsp;<span class="op" id="3403550">&amp;&amp;</span>&nbsp;<span class="ident" id="3403553">pos</span>&nbsp;<span class="op" id="3403557">&lt;=</span>&nbsp;<span class="builtinfunc" id="3403560">len</span><span class="op" id="3403563">(</span><span class="ident" id="3403564">i</span><span class="op" id="3403565">.</span><span class="ident" id="3403566">str</span><span class="op" id="3403569">)</span>&nbsp;<span class="op" id="3403571">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403575">r1</span><span class="op" id="3403577">,</span>&nbsp;<span class="ident" id="3403579">_</span>&nbsp;<span class="op" id="3403581">=</span>&nbsp;<span class="ident" id="3403583">utf8</span><span class="op" id="3403587">.</span><span class="ident" id="3403588">DecodeLastRune</span><span class="op" id="3403602">(</span><span class="ident" id="3403603">i</span><span class="op" id="3403604">.</span><span class="ident" id="3403605">str</span><span class="op" id="3403608">[</span><span class="op" id="3403609">:</span><span class="ident" id="3403610">pos</span><span class="op" id="3403613">]</span><span class="op" id="3403614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403620">if</span>&nbsp;<span class="ident" id="3403623">pos</span>&nbsp;<span class="op" id="3403627">&lt;</span>&nbsp;<span class="builtinfunc" id="3403629">len</span><span class="op" id="3403632">(</span><span class="ident" id="3403633">i</span><span class="op" id="3403634">.</span><span class="ident" id="3403635">str</span><span class="op" id="3403638">)</span>&nbsp;<span class="op" id="3403640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403644">r2</span><span class="op" id="3403646">,</span>&nbsp;<span class="ident" id="3403648">_</span>&nbsp;<span class="op" id="3403650">=</span>&nbsp;<span class="ident" id="3403652">utf8</span><span class="op" id="3403656">.</span><span class="ident" id="3403657">DecodeRune</span><span class="op" id="3403667">(</span><span class="ident" id="3403668">i</span><span class="op" id="3403669">.</span><span class="ident" id="3403670">str</span><span class="op" id="3403673">[</span><span class="ident" id="3403674">pos</span><span class="op" id="3403677">:</span><span class="op" id="3403678">]</span><span class="op" id="3403679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403682">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403685">return</span>&nbsp;<span class="ident" id="3403692">syntax</span><span class="op" id="3403698">.</span><span class="ident" id="3403699">EmptyOpContext</span><span class="op" id="3403713">(</span><span class="ident" id="3403714">r1</span><span class="op" id="3403716">,</span>&nbsp;<span class="ident" id="3403718">r2</span><span class="op" id="3403720">)</span><br>
<span class="lineno"></span><span class="op" id="3403722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3403725">//&nbsp;inputReader&nbsp;scans&nbsp;a&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3403760">type</span>&nbsp;<span class="ident" id="3403765">inputReader</span>&nbsp;<span class="keyword" id="3403777">struct</span>&nbsp;<span class="op" id="3403784">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403787">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3403793">io</span><span class="op" id="3403795">.</span><span class="ident" id="3403796">RuneReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403808">atEOT</span>&nbsp;<span class="builtintype" id="3403814">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403820">pos</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3403826">int</span><br>
<span class="lineno"></span><span class="op" id="3403830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="3403833">func</span>&nbsp;<span class="op" id="3403838">(</span><span class="ident" id="3403839">i</span>&nbsp;<span class="op" id="3403841">*</span><span class="ident" id="3403842">inputReader</span><span class="op" id="3403853">)</span>&nbsp;<span class="ident" id="3403855">step</span><span class="op" id="3403859">(</span><span class="ident" id="3403860">pos</span>&nbsp;<span class="builtintype" id="3403864">int</span><span class="op" id="3403867">)</span>&nbsp;<span class="op" id="3403869">(</span><span class="builtintype" id="3403870">rune</span><span class="op" id="3403874">,</span>&nbsp;<span class="builtintype" id="3403876">int</span><span class="op" id="3403879">)</span>&nbsp;<span class="op" id="3403881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403884">if</span>&nbsp;<span class="op" id="3403887">!</span><span class="ident" id="3403888">i</span><span class="op" id="3403889">.</span><span class="ident" id="3403890">atEOT</span>&nbsp;<span class="op" id="3403896">&amp;&amp;</span>&nbsp;<span class="ident" id="3403899">pos</span>&nbsp;<span class="op" id="3403903">!=</span>&nbsp;<span class="ident" id="3403906">i</span><span class="op" id="3403907">.</span><span class="ident" id="3403908">pos</span>&nbsp;<span class="op" id="3403912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403916">return</span>&nbsp;<span class="ident" id="3403923">endOfText</span><span class="op" id="3403932">,</span>&nbsp;<span class="num" id="3403934">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403938">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403941">r</span><span class="op" id="3403942">,</span>&nbsp;<span class="ident" id="3403944">w</span><span class="op" id="3403945">,</span>&nbsp;<span class="ident" id="3403947">err</span>&nbsp;<span class="op" id="3403951">:=</span>&nbsp;<span class="ident" id="3403954">i</span><span class="op" id="3403955">.</span><span class="ident" id="3403956">r</span><span class="op" id="3403957">.</span><span class="ident" id="3403958">ReadRune</span><span class="op" id="3403966">(</span><span class="op" id="3403967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403970">if</span>&nbsp;<span class="ident" id="3403973">err</span>&nbsp;<span class="op" id="3403977">!=</span>&nbsp;<span class="ident" id="3403980">nil</span>&nbsp;<span class="op" id="3403984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403988">i</span><span class="op" id="3403989">.</span><span class="ident" id="3403990">atEOT</span>&nbsp;<span class="op" id="3403996">=</span>&nbsp;<span class="builtintype" id="3403998">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404005">return</span>&nbsp;<span class="ident" id="3404012">endOfText</span><span class="op" id="3404021">,</span>&nbsp;<span class="num" id="3404023">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404026">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404029">i</span><span class="op" id="3404030">.</span><span class="ident" id="3404031">pos</span>&nbsp;<span class="op" id="3404035">+=</span>&nbsp;<span class="ident" id="3404038">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404041">return</span>&nbsp;<span class="ident" id="3404048">r</span><span class="op" id="3404049">,</span>&nbsp;<span class="ident" id="3404051">w</span><br>
<span class="lineno"></span><span class="op" id="3404053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3404056">func</span>&nbsp;<span class="op" id="3404061">(</span><span class="ident" id="3404062">i</span>&nbsp;<span class="op" id="3404064">*</span><span class="ident" id="3404065">inputReader</span><span class="op" id="3404076">)</span>&nbsp;<span class="ident" id="3404078">canCheckPrefix</span><span class="op" id="3404092">(</span><span class="op" id="3404093">)</span>&nbsp;<span class="builtintype" id="3404095">bool</span>&nbsp;<span class="op" id="3404100">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404103">return</span>&nbsp;<span class="builtintype" id="3404110">false</span><br>
<span class="lineno"></span><span class="op" id="3404116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3404119">func</span>&nbsp;<span class="op" id="3404124">(</span><span class="ident" id="3404125">i</span>&nbsp;<span class="op" id="3404127">*</span><span class="ident" id="3404128">inputReader</span><span class="op" id="3404139">)</span>&nbsp;<span class="ident" id="3404141">hasPrefix</span><span class="op" id="3404150">(</span><span class="ident" id="3404151">re</span>&nbsp;<span class="op" id="3404154">*</span><span class="ident" id="3404155">Regexp</span><span class="op" id="3404161">)</span>&nbsp;<span class="builtintype" id="3404163">bool</span>&nbsp;<span class="op" id="3404168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404171">return</span>&nbsp;<span class="builtintype" id="3404178">false</span><br>
<span class="lineno">375</span><span class="op" id="3404184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3404187">func</span>&nbsp;<span class="op" id="3404192">(</span><span class="ident" id="3404193">i</span>&nbsp;<span class="op" id="3404195">*</span><span class="ident" id="3404196">inputReader</span><span class="op" id="3404207">)</span>&nbsp;<span class="ident" id="3404209">index</span><span class="op" id="3404214">(</span><span class="ident" id="3404215">re</span>&nbsp;<span class="op" id="3404218">*</span><span class="ident" id="3404219">Regexp</span><span class="op" id="3404225">,</span>&nbsp;<span class="ident" id="3404227">pos</span>&nbsp;<span class="builtintype" id="3404231">int</span><span class="op" id="3404234">)</span>&nbsp;<span class="builtintype" id="3404236">int</span>&nbsp;<span class="op" id="3404240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404243">return</span>&nbsp;<span class="op" id="3404250">-</span><span class="num" id="3404251">1</span><br>
<span class="lineno"></span><span class="op" id="3404253">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="keyword" id="3404256">func</span>&nbsp;<span class="op" id="3404261">(</span><span class="ident" id="3404262">i</span>&nbsp;<span class="op" id="3404264">*</span><span class="ident" id="3404265">inputReader</span><span class="op" id="3404276">)</span>&nbsp;<span class="ident" id="3404278">context</span><span class="op" id="3404285">(</span><span class="ident" id="3404286">pos</span>&nbsp;<span class="builtintype" id="3404290">int</span><span class="op" id="3404293">)</span>&nbsp;<span class="ident" id="3404295">syntax</span><span class="op" id="3404301">.</span><span class="ident" id="3404302">EmptyOp</span>&nbsp;<span class="op" id="3404310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404313">return</span>&nbsp;<span class="num" id="3404320">0</span><br>
<span class="lineno"></span><span class="op" id="3404322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3404325">//&nbsp;LiteralPrefix&nbsp;returns&nbsp;a&nbsp;literal&nbsp;string&nbsp;that&nbsp;must&nbsp;begin&nbsp;any&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3404393">//&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;boolean&nbsp;true&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3404462">//&nbsp;literal&nbsp;string&nbsp;comprises&nbsp;the&nbsp;entire&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="3404521">func</span>&nbsp;<span class="op" id="3404526">(</span><span class="ident" id="3404527">re</span>&nbsp;<span class="op" id="3404530">*</span><span class="ident" id="3404531">Regexp</span><span class="op" id="3404537">)</span>&nbsp;<span class="ident" id="3404539">LiteralPrefix</span><span class="op" id="3404552">(</span><span class="op" id="3404553">)</span>&nbsp;<span class="op" id="3404555">(</span><span class="ident" id="3404556">prefix</span>&nbsp;<span class="builtintype" id="3404563">string</span><span class="op" id="3404569">,</span>&nbsp;<span class="ident" id="3404571">complete</span>&nbsp;<span class="builtintype" id="3404580">bool</span><span class="op" id="3404584">)</span>&nbsp;<span class="op" id="3404586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404589">return</span>&nbsp;<span class="ident" id="3404596">re</span><span class="op" id="3404598">.</span><span class="ident" id="3404599">prefix</span><span class="op" id="3404605">,</span>&nbsp;<span class="ident" id="3404607">re</span><span class="op" id="3404609">.</span><span class="ident" id="3404610">prefixComplete</span><br>
<span class="lineno">390</span><span class="op" id="3404625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404628">//&nbsp;MatchReader&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;text&nbsp;read&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3404699">//&nbsp;RuneReader.</span><br>
<span class="lineno"></span><span class="keyword" id="3404714">func</span>&nbsp;<span class="op" id="3404719">(</span><span class="ident" id="3404720">re</span>&nbsp;<span class="op" id="3404723">*</span><span class="ident" id="3404724">Regexp</span><span class="op" id="3404730">)</span>&nbsp;<span class="ident" id="3404732">MatchReader</span><span class="op" id="3404743">(</span><span class="ident" id="3404744">r</span>&nbsp;<span class="ident" id="3404746">io</span><span class="op" id="3404748">.</span><span class="ident" id="3404749">RuneReader</span><span class="op" id="3404759">)</span>&nbsp;<span class="builtintype" id="3404761">bool</span>&nbsp;<span class="op" id="3404766">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404769">return</span>&nbsp;<span class="ident" id="3404776">re</span><span class="op" id="3404778">.</span><span class="ident" id="3404779">doExecute</span><span class="op" id="3404788">(</span><span class="ident" id="3404789">r</span><span class="op" id="3404790">,</span>&nbsp;<span class="ident" id="3404792">nil</span><span class="op" id="3404795">,</span>&nbsp;<span class="string" id="3404797">&#34;&#34;</span><span class="op" id="3404799">,</span>&nbsp;<span class="num" id="3404801">0</span><span class="op" id="3404802">,</span>&nbsp;<span class="num" id="3404804">0</span><span class="op" id="3404805">)</span>&nbsp;<span class="op" id="3404807">!=</span>&nbsp;<span class="ident" id="3404810">nil</span><br>
<span class="lineno"></span><span class="op" id="3404814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404817">//&nbsp;MatchString&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3404881">func</span>&nbsp;<span class="op" id="3404886">(</span><span class="ident" id="3404887">re</span>&nbsp;<span class="op" id="3404890">*</span><span class="ident" id="3404891">Regexp</span><span class="op" id="3404897">)</span>&nbsp;<span class="ident" id="3404899">MatchString</span><span class="op" id="3404910">(</span><span class="ident" id="3404911">s</span>&nbsp;<span class="builtintype" id="3404913">string</span><span class="op" id="3404919">)</span>&nbsp;<span class="builtintype" id="3404921">bool</span>&nbsp;<span class="op" id="3404926">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404929">return</span>&nbsp;<span class="ident" id="3404936">re</span><span class="op" id="3404938">.</span><span class="ident" id="3404939">doExecute</span><span class="op" id="3404948">(</span><span class="ident" id="3404949">nil</span><span class="op" id="3404952">,</span>&nbsp;<span class="ident" id="3404954">nil</span><span class="op" id="3404957">,</span>&nbsp;<span class="ident" id="3404959">s</span><span class="op" id="3404960">,</span>&nbsp;<span class="num" id="3404962">0</span><span class="op" id="3404963">,</span>&nbsp;<span class="num" id="3404965">0</span><span class="op" id="3404966">)</span>&nbsp;<span class="op" id="3404968">!=</span>&nbsp;<span class="ident" id="3404971">nil</span><br>
<span class="lineno"></span><span class="op" id="3404975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404978">//&nbsp;Match&nbsp;reports&nbsp;whether&nbsp;the&nbsp;Regexp&nbsp;matches&nbsp;the&nbsp;byte&nbsp;slice&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3405040">func</span>&nbsp;<span class="op" id="3405045">(</span><span class="ident" id="3405046">re</span>&nbsp;<span class="op" id="3405049">*</span><span class="ident" id="3405050">Regexp</span><span class="op" id="3405056">)</span>&nbsp;<span class="ident" id="3405058">Match</span><span class="op" id="3405063">(</span><span class="ident" id="3405064">b</span>&nbsp;<span class="op" id="3405066">[</span><span class="op" id="3405067">]</span><span class="builtintype" id="3405068">byte</span><span class="op" id="3405072">)</span>&nbsp;<span class="builtintype" id="3405074">bool</span>&nbsp;<span class="op" id="3405079">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405082">return</span>&nbsp;<span class="ident" id="3405089">re</span><span class="op" id="3405091">.</span><span class="ident" id="3405092">doExecute</span><span class="op" id="3405101">(</span><span class="ident" id="3405102">nil</span><span class="op" id="3405105">,</span>&nbsp;<span class="ident" id="3405107">b</span><span class="op" id="3405108">,</span>&nbsp;<span class="string" id="3405110">&#34;&#34;</span><span class="op" id="3405112">,</span>&nbsp;<span class="num" id="3405114">0</span><span class="op" id="3405115">,</span>&nbsp;<span class="num" id="3405117">0</span><span class="op" id="3405118">)</span>&nbsp;<span class="op" id="3405120">!=</span>&nbsp;<span class="ident" id="3405123">nil</span><br>
<span class="lineno"></span><span class="op" id="3405127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3405130">//&nbsp;MatchReader&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression&nbsp;matches&nbsp;the&nbsp;text</span><br>
<span class="lineno"></span><span class="comment" id="3405206">//&nbsp;read&nbsp;by&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and</span><br>
<span class="lineno">410</span><span class="comment" id="3405283">//&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3405313">func</span>&nbsp;<span class="ident" id="3405318">MatchReader</span><span class="op" id="3405329">(</span><span class="ident" id="3405330">pattern</span>&nbsp;<span class="builtintype" id="3405338">string</span><span class="op" id="3405344">,</span>&nbsp;<span class="ident" id="3405346">r</span>&nbsp;<span class="ident" id="3405348">io</span><span class="op" id="3405350">.</span><span class="ident" id="3405351">RuneReader</span><span class="op" id="3405361">)</span>&nbsp;<span class="op" id="3405363">(</span><span class="ident" id="3405364">matched</span>&nbsp;<span class="builtintype" id="3405372">bool</span><span class="op" id="3405376">,</span>&nbsp;<span class="ident" id="3405378">err</span>&nbsp;<span class="builtintype" id="3405382">error</span><span class="op" id="3405387">)</span>&nbsp;<span class="op" id="3405389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405392">re</span><span class="op" id="3405394">,</span>&nbsp;<span class="ident" id="3405396">err</span>&nbsp;<span class="op" id="3405400">:=</span>&nbsp;<span class="ident" id="3405403">Compile</span><span class="op" id="3405410">(</span><span class="ident" id="3405411">pattern</span><span class="op" id="3405418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405421">if</span>&nbsp;<span class="ident" id="3405424">err</span>&nbsp;<span class="op" id="3405428">!=</span>&nbsp;<span class="ident" id="3405431">nil</span>&nbsp;<span class="op" id="3405435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405439">return</span>&nbsp;<span class="builtintype" id="3405446">false</span><span class="op" id="3405451">,</span>&nbsp;<span class="ident" id="3405453">err</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405461">return</span>&nbsp;<span class="ident" id="3405468">re</span><span class="op" id="3405470">.</span><span class="ident" id="3405471">MatchReader</span><span class="op" id="3405482">(</span><span class="ident" id="3405483">r</span><span class="op" id="3405484">)</span><span class="op" id="3405485">,</span>&nbsp;<span class="ident" id="3405487">nil</span><br>
<span class="lineno"></span><span class="op" id="3405491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3405494">//&nbsp;MatchString&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">420</span><span class="comment" id="3405553">//&nbsp;matches&nbsp;a&nbsp;string.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3405605">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3405654">func</span>&nbsp;<span class="ident" id="3405659">MatchString</span><span class="op" id="3405670">(</span><span class="ident" id="3405671">pattern</span>&nbsp;<span class="builtintype" id="3405679">string</span><span class="op" id="3405685">,</span>&nbsp;<span class="ident" id="3405687">s</span>&nbsp;<span class="builtintype" id="3405689">string</span><span class="op" id="3405695">)</span>&nbsp;<span class="op" id="3405697">(</span><span class="ident" id="3405698">matched</span>&nbsp;<span class="builtintype" id="3405706">bool</span><span class="op" id="3405710">,</span>&nbsp;<span class="ident" id="3405712">err</span>&nbsp;<span class="builtintype" id="3405716">error</span><span class="op" id="3405721">)</span>&nbsp;<span class="op" id="3405723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405726">re</span><span class="op" id="3405728">,</span>&nbsp;<span class="ident" id="3405730">err</span>&nbsp;<span class="op" id="3405734">:=</span>&nbsp;<span class="ident" id="3405737">Compile</span><span class="op" id="3405744">(</span><span class="ident" id="3405745">pattern</span><span class="op" id="3405752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405755">if</span>&nbsp;<span class="ident" id="3405758">err</span>&nbsp;<span class="op" id="3405762">!=</span>&nbsp;<span class="ident" id="3405765">nil</span>&nbsp;<span class="op" id="3405769">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405773">return</span>&nbsp;<span class="builtintype" id="3405780">false</span><span class="op" id="3405785">,</span>&nbsp;<span class="ident" id="3405787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405795">return</span>&nbsp;<span class="ident" id="3405802">re</span><span class="op" id="3405804">.</span><span class="ident" id="3405805">MatchString</span><span class="op" id="3405816">(</span><span class="ident" id="3405817">s</span><span class="op" id="3405818">)</span><span class="op" id="3405819">,</span>&nbsp;<span class="ident" id="3405821">nil</span><br>
<span class="lineno"></span><span class="op" id="3405825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="comment" id="3405828">//&nbsp;Match&nbsp;checks&nbsp;whether&nbsp;a&nbsp;textual&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3405881">//&nbsp;matches&nbsp;a&nbsp;byte&nbsp;slice.&nbsp;&nbsp;More&nbsp;complicated&nbsp;queries&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="3405937">//&nbsp;to&nbsp;use&nbsp;Compile&nbsp;and&nbsp;the&nbsp;full&nbsp;Regexp&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="3405986">func</span>&nbsp;<span class="ident" id="3405991">Match</span><span class="op" id="3405996">(</span><span class="ident" id="3405997">pattern</span>&nbsp;<span class="builtintype" id="3406005">string</span><span class="op" id="3406011">,</span>&nbsp;<span class="ident" id="3406013">b</span>&nbsp;<span class="op" id="3406015">[</span><span class="op" id="3406016">]</span><span class="builtintype" id="3406017">byte</span><span class="op" id="3406021">)</span>&nbsp;<span class="op" id="3406023">(</span><span class="ident" id="3406024">matched</span>&nbsp;<span class="builtintype" id="3406032">bool</span><span class="op" id="3406036">,</span>&nbsp;<span class="ident" id="3406038">err</span>&nbsp;<span class="builtintype" id="3406042">error</span><span class="op" id="3406047">)</span>&nbsp;<span class="op" id="3406049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406052">re</span><span class="op" id="3406054">,</span>&nbsp;<span class="ident" id="3406056">err</span>&nbsp;<span class="op" id="3406060">:=</span>&nbsp;<span class="ident" id="3406063">Compile</span><span class="op" id="3406070">(</span><span class="ident" id="3406071">pattern</span><span class="op" id="3406078">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406081">if</span>&nbsp;<span class="ident" id="3406084">err</span>&nbsp;<span class="op" id="3406088">!=</span>&nbsp;<span class="ident" id="3406091">nil</span>&nbsp;<span class="op" id="3406095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406099">return</span>&nbsp;<span class="builtintype" id="3406106">false</span><span class="op" id="3406111">,</span>&nbsp;<span class="ident" id="3406113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406121">return</span>&nbsp;<span class="ident" id="3406128">re</span><span class="op" id="3406130">.</span><span class="ident" id="3406131">Match</span><span class="op" id="3406136">(</span><span class="ident" id="3406137">b</span><span class="op" id="3406138">)</span><span class="op" id="3406139">,</span>&nbsp;<span class="ident" id="3406141">nil</span><br>
<span class="lineno"></span><span class="op" id="3406145">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="3406148">//&nbsp;ReplaceAllString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3406223">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3406301">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3406377">func</span>&nbsp;<span class="op" id="3406382">(</span><span class="ident" id="3406383">re</span>&nbsp;<span class="op" id="3406386">*</span><span class="ident" id="3406387">Regexp</span><span class="op" id="3406393">)</span>&nbsp;<span class="ident" id="3406395">ReplaceAllString</span><span class="op" id="3406411">(</span><span class="ident" id="3406412">src</span><span class="op" id="3406415">,</span>&nbsp;<span class="ident" id="3406417">repl</span>&nbsp;<span class="builtintype" id="3406422">string</span><span class="op" id="3406428">)</span>&nbsp;<span class="builtintype" id="3406430">string</span>&nbsp;<span class="op" id="3406437">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406440">n</span>&nbsp;<span class="op" id="3406442">:=</span>&nbsp;<span class="num" id="3406445">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406448">if</span>&nbsp;<span class="ident" id="3406451">strings</span><span class="op" id="3406458">.</span><span class="ident" id="3406459">Index</span><span class="op" id="3406464">(</span><span class="ident" id="3406465">repl</span><span class="op" id="3406469">,</span>&nbsp;<span class="string" id="3406471">&#34;$&#34;</span><span class="op" id="3406474">)</span>&nbsp;<span class="op" id="3406476">&gt;=</span>&nbsp;<span class="num" id="3406479">0</span>&nbsp;<span class="op" id="3406481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406485">n</span>&nbsp;<span class="op" id="3406487">=</span>&nbsp;<span class="num" id="3406489">2</span>&nbsp;<span class="op" id="3406491">*</span>&nbsp;<span class="op" id="3406493">(</span><span class="ident" id="3406494">re</span><span class="op" id="3406496">.</span><span class="ident" id="3406497">numSubexp</span>&nbsp;<span class="op" id="3406507">+</span>&nbsp;<span class="num" id="3406509">1</span><span class="op" id="3406510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406516">b</span>&nbsp;<span class="op" id="3406518">:=</span>&nbsp;<span class="ident" id="3406521">re</span><span class="op" id="3406523">.</span><span class="ident" id="3406524">replaceAll</span><span class="op" id="3406534">(</span><span class="ident" id="3406535">nil</span><span class="op" id="3406538">,</span>&nbsp;<span class="ident" id="3406540">src</span><span class="op" id="3406543">,</span>&nbsp;<span class="ident" id="3406545">n</span><span class="op" id="3406546">,</span>&nbsp;<span class="keyword" id="3406548">func</span><span class="op" id="3406552">(</span><span class="ident" id="3406553">dst</span>&nbsp;<span class="op" id="3406557">[</span><span class="op" id="3406558">]</span><span class="builtintype" id="3406559">byte</span><span class="op" id="3406563">,</span>&nbsp;<span class="ident" id="3406565">match</span>&nbsp;<span class="op" id="3406571">[</span><span class="op" id="3406572">]</span><span class="builtintype" id="3406573">int</span><span class="op" id="3406576">)</span>&nbsp;<span class="op" id="3406578">[</span><span class="op" id="3406579">]</span><span class="builtintype" id="3406580">byte</span>&nbsp;<span class="op" id="3406585">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406589">return</span>&nbsp;<span class="ident" id="3406596">re</span><span class="op" id="3406598">.</span><span class="ident" id="3406599">expand</span><span class="op" id="3406605">(</span><span class="ident" id="3406606">dst</span><span class="op" id="3406609">,</span>&nbsp;<span class="ident" id="3406611">repl</span><span class="op" id="3406615">,</span>&nbsp;<span class="ident" id="3406617">nil</span><span class="op" id="3406620">,</span>&nbsp;<span class="ident" id="3406622">src</span><span class="op" id="3406625">,</span>&nbsp;<span class="ident" id="3406627">match</span><span class="op" id="3406632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406635">}</span><span class="op" id="3406636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406639">return</span>&nbsp;<span class="builtintype" id="3406646">string</span><span class="op" id="3406652">(</span><span class="ident" id="3406653">b</span><span class="op" id="3406654">)</span><br>
<span class="lineno"></span><span class="op" id="3406656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="3406659">//&nbsp;ReplaceAllLiteralString&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3406741">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;string&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno"></span><span class="comment" id="3406825">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3406850">func</span>&nbsp;<span class="op" id="3406855">(</span><span class="ident" id="3406856">re</span>&nbsp;<span class="op" id="3406859">*</span><span class="ident" id="3406860">Regexp</span><span class="op" id="3406866">)</span>&nbsp;<span class="ident" id="3406868">ReplaceAllLiteralString</span><span class="op" id="3406891">(</span><span class="ident" id="3406892">src</span><span class="op" id="3406895">,</span>&nbsp;<span class="ident" id="3406897">repl</span>&nbsp;<span class="builtintype" id="3406902">string</span><span class="op" id="3406908">)</span>&nbsp;<span class="builtintype" id="3406910">string</span>&nbsp;<span class="op" id="3406917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406920">return</span>&nbsp;<span class="builtintype" id="3406927">string</span><span class="op" id="3406933">(</span><span class="ident" id="3406934">re</span><span class="op" id="3406936">.</span><span class="ident" id="3406937">replaceAll</span><span class="op" id="3406947">(</span><span class="ident" id="3406948">nil</span><span class="op" id="3406951">,</span>&nbsp;<span class="ident" id="3406953">src</span><span class="op" id="3406956">,</span>&nbsp;<span class="num" id="3406958">2</span><span class="op" id="3406959">,</span>&nbsp;<span class="keyword" id="3406961">func</span><span class="op" id="3406965">(</span><span class="ident" id="3406966">dst</span>&nbsp;<span class="op" id="3406970">[</span><span class="op" id="3406971">]</span><span class="builtintype" id="3406972">byte</span><span class="op" id="3406976">,</span>&nbsp;<span class="ident" id="3406978">match</span>&nbsp;<span class="op" id="3406984">[</span><span class="op" id="3406985">]</span><span class="builtintype" id="3406986">int</span><span class="op" id="3406989">)</span>&nbsp;<span class="op" id="3406991">[</span><span class="op" id="3406992">]</span><span class="builtintype" id="3406993">byte</span>&nbsp;<span class="op" id="3406998">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407002">return</span>&nbsp;<span class="builtinfunc" id="3407009">append</span><span class="op" id="3407015">(</span><span class="ident" id="3407016">dst</span><span class="op" id="3407019">,</span>&nbsp;<span class="ident" id="3407021">repl</span><span class="op" id="3407025">...</span><span class="op" id="3407028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407031">}</span><span class="op" id="3407032">)</span><span class="op" id="3407033">)</span><br>
<span class="lineno"></span><span class="op" id="3407035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407038">//&nbsp;ReplaceAllStringFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="3407112">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3407186">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;substring.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno"></span><span class="comment" id="3407264">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3407299">func</span>&nbsp;<span class="op" id="3407304">(</span><span class="ident" id="3407305">re</span>&nbsp;<span class="op" id="3407308">*</span><span class="ident" id="3407309">Regexp</span><span class="op" id="3407315">)</span>&nbsp;<span class="ident" id="3407317">ReplaceAllStringFunc</span><span class="op" id="3407337">(</span><span class="ident" id="3407338">src</span>&nbsp;<span class="builtintype" id="3407342">string</span><span class="op" id="3407348">,</span>&nbsp;<span class="ident" id="3407350">repl</span>&nbsp;<span class="keyword" id="3407355">func</span><span class="op" id="3407359">(</span><span class="builtintype" id="3407360">string</span><span class="op" id="3407366">)</span>&nbsp;<span class="builtintype" id="3407368">string</span><span class="op" id="3407374">)</span>&nbsp;<span class="builtintype" id="3407376">string</span>&nbsp;<span class="op" id="3407383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407386">b</span>&nbsp;<span class="op" id="3407388">:=</span>&nbsp;<span class="ident" id="3407391">re</span><span class="op" id="3407393">.</span><span class="ident" id="3407394">replaceAll</span><span class="op" id="3407404">(</span><span class="ident" id="3407405">nil</span><span class="op" id="3407408">,</span>&nbsp;<span class="ident" id="3407410">src</span><span class="op" id="3407413">,</span>&nbsp;<span class="num" id="3407415">2</span><span class="op" id="3407416">,</span>&nbsp;<span class="keyword" id="3407418">func</span><span class="op" id="3407422">(</span><span class="ident" id="3407423">dst</span>&nbsp;<span class="op" id="3407427">[</span><span class="op" id="3407428">]</span><span class="builtintype" id="3407429">byte</span><span class="op" id="3407433">,</span>&nbsp;<span class="ident" id="3407435">match</span>&nbsp;<span class="op" id="3407441">[</span><span class="op" id="3407442">]</span><span class="builtintype" id="3407443">int</span><span class="op" id="3407446">)</span>&nbsp;<span class="op" id="3407448">[</span><span class="op" id="3407449">]</span><span class="builtintype" id="3407450">byte</span>&nbsp;<span class="op" id="3407455">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407459">return</span>&nbsp;<span class="builtinfunc" id="3407466">append</span><span class="op" id="3407472">(</span><span class="ident" id="3407473">dst</span><span class="op" id="3407476">,</span>&nbsp;<span class="ident" id="3407478">repl</span><span class="op" id="3407482">(</span><span class="ident" id="3407483">src</span><span class="op" id="3407486">[</span><span class="ident" id="3407487">match</span><span class="op" id="3407492">[</span><span class="num" id="3407493">0</span><span class="op" id="3407494">]</span><span class="op" id="3407495">:</span><span class="ident" id="3407496">match</span><span class="op" id="3407501">[</span><span class="num" id="3407502">1</span><span class="op" id="3407503">]</span><span class="op" id="3407504">]</span><span class="op" id="3407505">)</span><span class="op" id="3407506">...</span><span class="op" id="3407509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407512">}</span><span class="op" id="3407513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407516">return</span>&nbsp;<span class="builtintype" id="3407523">string</span><span class="op" id="3407529">(</span><span class="ident" id="3407530">b</span><span class="op" id="3407531">)</span><br>
<span class="lineno"></span><span class="op" id="3407533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span><span class="keyword" id="3407536">func</span>&nbsp;<span class="op" id="3407541">(</span><span class="ident" id="3407542">re</span>&nbsp;<span class="op" id="3407545">*</span><span class="ident" id="3407546">Regexp</span><span class="op" id="3407552">)</span>&nbsp;<span class="ident" id="3407554">replaceAll</span><span class="op" id="3407564">(</span><span class="ident" id="3407565">bsrc</span>&nbsp;<span class="op" id="3407570">[</span><span class="op" id="3407571">]</span><span class="builtintype" id="3407572">byte</span><span class="op" id="3407576">,</span>&nbsp;<span class="ident" id="3407578">src</span>&nbsp;<span class="builtintype" id="3407582">string</span><span class="op" id="3407588">,</span>&nbsp;<span class="ident" id="3407590">nmatch</span>&nbsp;<span class="builtintype" id="3407597">int</span><span class="op" id="3407600">,</span>&nbsp;<span class="ident" id="3407602">repl</span>&nbsp;<span class="keyword" id="3407607">func</span><span class="op" id="3407611">(</span><span class="ident" id="3407612">dst</span>&nbsp;<span class="op" id="3407616">[</span><span class="op" id="3407617">]</span><span class="builtintype" id="3407618">byte</span><span class="op" id="3407622">,</span>&nbsp;<span class="ident" id="3407624">m</span>&nbsp;<span class="op" id="3407626">[</span><span class="op" id="3407627">]</span><span class="builtintype" id="3407628">int</span><span class="op" id="3407631">)</span>&nbsp;<span class="op" id="3407633">[</span><span class="op" id="3407634">]</span><span class="builtintype" id="3407635">byte</span><span class="op" id="3407639">)</span>&nbsp;<span class="op" id="3407641">[</span><span class="op" id="3407642">]</span><span class="builtintype" id="3407643">byte</span>&nbsp;<span class="op" id="3407648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407651">lastMatchEnd</span>&nbsp;<span class="op" id="3407664">:=</span>&nbsp;<span class="num" id="3407667">0</span>&nbsp;<span class="comment" id="3407669">//&nbsp;end&nbsp;position&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407711">searchPos</span>&nbsp;<span class="op" id="3407721">:=</span>&nbsp;<span class="num" id="3407724">0</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3407729">//&nbsp;position&nbsp;where&nbsp;we&nbsp;next&nbsp;look&nbsp;for&nbsp;a&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407773">var</span>&nbsp;<span class="ident" id="3407777">buf</span>&nbsp;<span class="op" id="3407781">[</span><span class="op" id="3407782">]</span><span class="builtintype" id="3407783">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407789">var</span>&nbsp;<span class="ident" id="3407793">endPos</span>&nbsp;<span class="builtintype" id="3407800">int</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407805">if</span>&nbsp;<span class="ident" id="3407808">bsrc</span>&nbsp;<span class="op" id="3407813">!=</span>&nbsp;<span class="ident" id="3407816">nil</span>&nbsp;<span class="op" id="3407820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407824">endPos</span>&nbsp;<span class="op" id="3407831">=</span>&nbsp;<span class="builtinfunc" id="3407833">len</span><span class="op" id="3407836">(</span><span class="ident" id="3407837">bsrc</span><span class="op" id="3407841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407844">}</span>&nbsp;<span class="keyword" id="3407846">else</span>&nbsp;<span class="op" id="3407851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407855">endPos</span>&nbsp;<span class="op" id="3407862">=</span>&nbsp;<span class="builtinfunc" id="3407864">len</span><span class="op" id="3407867">(</span><span class="ident" id="3407868">src</span><span class="op" id="3407871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3407874">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407877">for</span>&nbsp;<span class="ident" id="3407881">searchPos</span>&nbsp;<span class="op" id="3407891">&lt;=</span>&nbsp;<span class="ident" id="3407894">endPos</span>&nbsp;<span class="op" id="3407901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407905">a</span>&nbsp;<span class="op" id="3407907">:=</span>&nbsp;<span class="ident" id="3407910">re</span><span class="op" id="3407912">.</span><span class="ident" id="3407913">doExecute</span><span class="op" id="3407922">(</span><span class="ident" id="3407923">nil</span><span class="op" id="3407926">,</span>&nbsp;<span class="ident" id="3407928">bsrc</span><span class="op" id="3407932">,</span>&nbsp;<span class="ident" id="3407934">src</span><span class="op" id="3407937">,</span>&nbsp;<span class="ident" id="3407939">searchPos</span><span class="op" id="3407948">,</span>&nbsp;<span class="ident" id="3407950">nmatch</span><span class="op" id="3407956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407960">if</span>&nbsp;<span class="builtinfunc" id="3407963">len</span><span class="op" id="3407966">(</span><span class="ident" id="3407967">a</span><span class="op" id="3407968">)</span>&nbsp;<span class="op" id="3407970">==</span>&nbsp;<span class="num" id="3407973">0</span>&nbsp;<span class="op" id="3407975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407980">break</span>&nbsp;<span class="comment" id="3407986">//&nbsp;no&nbsp;more&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408007">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408012">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;before&nbsp;this&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408066">if</span>&nbsp;<span class="ident" id="3408069">bsrc</span>&nbsp;<span class="op" id="3408074">!=</span>&nbsp;<span class="ident" id="3408077">nil</span>&nbsp;<span class="op" id="3408081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408086">buf</span>&nbsp;<span class="op" id="3408090">=</span>&nbsp;<span class="builtinfunc" id="3408092">append</span><span class="op" id="3408098">(</span><span class="ident" id="3408099">buf</span><span class="op" id="3408102">,</span>&nbsp;<span class="ident" id="3408104">bsrc</span><span class="op" id="3408108">[</span><span class="ident" id="3408109">lastMatchEnd</span><span class="op" id="3408121">:</span><span class="ident" id="3408122">a</span><span class="op" id="3408123">[</span><span class="num" id="3408124">0</span><span class="op" id="3408125">]</span><span class="op" id="3408126">]</span><span class="op" id="3408127">...</span><span class="op" id="3408130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408134">}</span>&nbsp;<span class="keyword" id="3408136">else</span>&nbsp;<span class="op" id="3408141">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408146">buf</span>&nbsp;<span class="op" id="3408150">=</span>&nbsp;<span class="builtinfunc" id="3408152">append</span><span class="op" id="3408158">(</span><span class="ident" id="3408159">buf</span><span class="op" id="3408162">,</span>&nbsp;<span class="ident" id="3408164">src</span><span class="op" id="3408167">[</span><span class="ident" id="3408168">lastMatchEnd</span><span class="op" id="3408180">:</span><span class="ident" id="3408181">a</span><span class="op" id="3408182">[</span><span class="num" id="3408183">0</span><span class="op" id="3408184">]</span><span class="op" id="3408185">]</span><span class="op" id="3408186">...</span><span class="op" id="3408189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408198">//&nbsp;Now&nbsp;insert&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;replacement&nbsp;string,&nbsp;but&nbsp;not&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408262">//&nbsp;match&nbsp;of&nbsp;the&nbsp;empty&nbsp;string&nbsp;immediately&nbsp;after&nbsp;another&nbsp;match.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408326">//&nbsp;(Otherwise,&nbsp;we&nbsp;get&nbsp;double&nbsp;replacement&nbsp;for&nbsp;patterns&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408387">//&nbsp;match&nbsp;both&nbsp;empty&nbsp;and&nbsp;nonempty&nbsp;strings.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408432">if</span>&nbsp;<span class="ident" id="3408435">a</span><span class="op" id="3408436">[</span><span class="num" id="3408437">1</span><span class="op" id="3408438">]</span>&nbsp;<span class="op" id="3408440">&gt;</span>&nbsp;<span class="ident" id="3408442">lastMatchEnd</span>&nbsp;<span class="op" id="3408455">||</span>&nbsp;<span class="ident" id="3408458">a</span><span class="op" id="3408459">[</span><span class="num" id="3408460">0</span><span class="op" id="3408461">]</span>&nbsp;<span class="op" id="3408463">==</span>&nbsp;<span class="num" id="3408466">0</span>&nbsp;<span class="op" id="3408468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408473">buf</span>&nbsp;<span class="op" id="3408477">=</span>&nbsp;<span class="ident" id="3408479">repl</span><span class="op" id="3408483">(</span><span class="ident" id="3408484">buf</span><span class="op" id="3408487">,</span>&nbsp;<span class="ident" id="3408489">a</span><span class="op" id="3408490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408494">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408498">lastMatchEnd</span>&nbsp;<span class="op" id="3408511">=</span>&nbsp;<span class="ident" id="3408513">a</span><span class="op" id="3408514">[</span><span class="num" id="3408515">1</span><span class="op" id="3408516">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408521">//&nbsp;Advance&nbsp;past&nbsp;this&nbsp;match;&nbsp;always&nbsp;advance&nbsp;at&nbsp;least&nbsp;one&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408590">var</span>&nbsp;<span class="ident" id="3408594">width</span>&nbsp;<span class="builtintype" id="3408600">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408606">if</span>&nbsp;<span class="ident" id="3408609">bsrc</span>&nbsp;<span class="op" id="3408614">!=</span>&nbsp;<span class="ident" id="3408617">nil</span>&nbsp;<span class="op" id="3408621">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408626">_</span><span class="op" id="3408627">,</span>&nbsp;<span class="ident" id="3408629">width</span>&nbsp;<span class="op" id="3408635">=</span>&nbsp;<span class="ident" id="3408637">utf8</span><span class="op" id="3408641">.</span><span class="ident" id="3408642">DecodeRune</span><span class="op" id="3408652">(</span><span class="ident" id="3408653">bsrc</span><span class="op" id="3408657">[</span><span class="ident" id="3408658">searchPos</span><span class="op" id="3408667">:</span><span class="op" id="3408668">]</span><span class="op" id="3408669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408673">}</span>&nbsp;<span class="keyword" id="3408675">else</span>&nbsp;<span class="op" id="3408680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408685">_</span><span class="op" id="3408686">,</span>&nbsp;<span class="ident" id="3408688">width</span>&nbsp;<span class="op" id="3408694">=</span>&nbsp;<span class="ident" id="3408696">utf8</span><span class="op" id="3408700">.</span><span class="ident" id="3408701">DecodeRuneInString</span><span class="op" id="3408719">(</span><span class="ident" id="3408720">src</span><span class="op" id="3408723">[</span><span class="ident" id="3408724">searchPos</span><span class="op" id="3408733">:</span><span class="op" id="3408734">]</span><span class="op" id="3408735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408743">if</span>&nbsp;<span class="ident" id="3408746">searchPos</span><span class="op" id="3408755">+</span><span class="ident" id="3408756">width</span>&nbsp;<span class="op" id="3408762">&gt;</span>&nbsp;<span class="ident" id="3408764">a</span><span class="op" id="3408765">[</span><span class="num" id="3408766">1</span><span class="op" id="3408767">]</span>&nbsp;<span class="op" id="3408769">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408774">searchPos</span>&nbsp;<span class="op" id="3408784">+=</span>&nbsp;<span class="ident" id="3408787">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408795">}</span>&nbsp;<span class="keyword" id="3408797">else</span>&nbsp;<span class="keyword" id="3408802">if</span>&nbsp;<span class="ident" id="3408805">searchPos</span><span class="op" id="3408814">+</span><span class="num" id="3408815">1</span>&nbsp;<span class="op" id="3408817">&gt;</span>&nbsp;<span class="ident" id="3408819">a</span><span class="op" id="3408820">[</span><span class="num" id="3408821">1</span><span class="op" id="3408822">]</span>&nbsp;<span class="op" id="3408824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408829">//&nbsp;This&nbsp;clause&nbsp;is&nbsp;only&nbsp;needed&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408886">//&nbsp;string.&nbsp;&nbsp;In&nbsp;that&nbsp;case,&nbsp;DecodeRuneInString&nbsp;returns&nbsp;width=0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408951">searchPos</span><span class="op" id="3408960">++</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408965">}</span>&nbsp;<span class="keyword" id="3408967">else</span>&nbsp;<span class="op" id="3408972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408977">searchPos</span>&nbsp;<span class="op" id="3408987">=</span>&nbsp;<span class="ident" id="3408989">a</span><span class="op" id="3408990">[</span><span class="num" id="3408991">1</span><span class="op" id="3408992">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409003">//&nbsp;Copy&nbsp;the&nbsp;unmatched&nbsp;characters&nbsp;after&nbsp;the&nbsp;last&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409059">if</span>&nbsp;<span class="ident" id="3409062">bsrc</span>&nbsp;<span class="op" id="3409067">!=</span>&nbsp;<span class="ident" id="3409070">nil</span>&nbsp;<span class="op" id="3409074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409078">buf</span>&nbsp;<span class="op" id="3409082">=</span>&nbsp;<span class="builtinfunc" id="3409084">append</span><span class="op" id="3409090">(</span><span class="ident" id="3409091">buf</span><span class="op" id="3409094">,</span>&nbsp;<span class="ident" id="3409096">bsrc</span><span class="op" id="3409100">[</span><span class="ident" id="3409101">lastMatchEnd</span><span class="op" id="3409113">:</span><span class="op" id="3409114">]</span><span class="op" id="3409115">...</span><span class="op" id="3409118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409121">}</span>&nbsp;<span class="keyword" id="3409123">else</span>&nbsp;<span class="op" id="3409128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409132">buf</span>&nbsp;<span class="op" id="3409136">=</span>&nbsp;<span class="builtinfunc" id="3409138">append</span><span class="op" id="3409144">(</span><span class="ident" id="3409145">buf</span><span class="op" id="3409148">,</span>&nbsp;<span class="ident" id="3409150">src</span><span class="op" id="3409153">[</span><span class="ident" id="3409154">lastMatchEnd</span><span class="op" id="3409166">:</span><span class="op" id="3409167">]</span><span class="op" id="3409168">...</span><span class="op" id="3409171">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409178">return</span>&nbsp;<span class="ident" id="3409185">buf</span><br>
<span class="lineno"></span><span class="op" id="3409189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="comment" id="3409192">//&nbsp;ReplaceAll&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3409261">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;text&nbsp;repl.&nbsp;&nbsp;Inside&nbsp;repl,&nbsp;$&nbsp;signs&nbsp;are&nbsp;interpreted&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3409337">//&nbsp;in&nbsp;Expand,&nbsp;so&nbsp;for&nbsp;instance&nbsp;$1&nbsp;represents&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;submatch.</span><br>
<span class="lineno"></span><span class="keyword" id="3409413">func</span>&nbsp;<span class="op" id="3409418">(</span><span class="ident" id="3409419">re</span>&nbsp;<span class="op" id="3409422">*</span><span class="ident" id="3409423">Regexp</span><span class="op" id="3409429">)</span>&nbsp;<span class="ident" id="3409431">ReplaceAll</span><span class="op" id="3409441">(</span><span class="ident" id="3409442">src</span><span class="op" id="3409445">,</span>&nbsp;<span class="ident" id="3409447">repl</span>&nbsp;<span class="op" id="3409452">[</span><span class="op" id="3409453">]</span><span class="builtintype" id="3409454">byte</span><span class="op" id="3409458">)</span>&nbsp;<span class="op" id="3409460">[</span><span class="op" id="3409461">]</span><span class="builtintype" id="3409462">byte</span>&nbsp;<span class="op" id="3409467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409470">n</span>&nbsp;<span class="op" id="3409472">:=</span>&nbsp;<span class="num" id="3409475">2</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409478">if</span>&nbsp;<span class="ident" id="3409481">bytes</span><span class="op" id="3409486">.</span><span class="ident" id="3409487">IndexByte</span><span class="op" id="3409496">(</span><span class="ident" id="3409497">repl</span><span class="op" id="3409501">,</span>&nbsp;<span class="string" id="3409503">&#39;$&#39;</span><span class="op" id="3409506">)</span>&nbsp;<span class="op" id="3409508">&gt;=</span>&nbsp;<span class="num" id="3409511">0</span>&nbsp;<span class="op" id="3409513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409517">n</span>&nbsp;<span class="op" id="3409519">=</span>&nbsp;<span class="num" id="3409521">2</span>&nbsp;<span class="op" id="3409523">*</span>&nbsp;<span class="op" id="3409525">(</span><span class="ident" id="3409526">re</span><span class="op" id="3409528">.</span><span class="ident" id="3409529">numSubexp</span>&nbsp;<span class="op" id="3409539">+</span>&nbsp;<span class="num" id="3409541">1</span><span class="op" id="3409542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409548">srepl</span>&nbsp;<span class="op" id="3409554">:=</span>&nbsp;<span class="string" id="3409557">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409561">b</span>&nbsp;<span class="op" id="3409563">:=</span>&nbsp;<span class="ident" id="3409566">re</span><span class="op" id="3409568">.</span><span class="ident" id="3409569">replaceAll</span><span class="op" id="3409579">(</span><span class="ident" id="3409580">src</span><span class="op" id="3409583">,</span>&nbsp;<span class="string" id="3409585">&#34;&#34;</span><span class="op" id="3409587">,</span>&nbsp;<span class="ident" id="3409589">n</span><span class="op" id="3409590">,</span>&nbsp;<span class="keyword" id="3409592">func</span><span class="op" id="3409596">(</span><span class="ident" id="3409597">dst</span>&nbsp;<span class="op" id="3409601">[</span><span class="op" id="3409602">]</span><span class="builtintype" id="3409603">byte</span><span class="op" id="3409607">,</span>&nbsp;<span class="ident" id="3409609">match</span>&nbsp;<span class="op" id="3409615">[</span><span class="op" id="3409616">]</span><span class="builtintype" id="3409617">int</span><span class="op" id="3409620">)</span>&nbsp;<span class="op" id="3409622">[</span><span class="op" id="3409623">]</span><span class="builtintype" id="3409624">byte</span>&nbsp;<span class="op" id="3409629">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409633">if</span>&nbsp;<span class="builtinfunc" id="3409636">len</span><span class="op" id="3409639">(</span><span class="ident" id="3409640">srepl</span><span class="op" id="3409645">)</span>&nbsp;<span class="op" id="3409647">!=</span>&nbsp;<span class="builtinfunc" id="3409650">len</span><span class="op" id="3409653">(</span><span class="ident" id="3409654">repl</span><span class="op" id="3409658">)</span>&nbsp;<span class="op" id="3409660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409665">srepl</span>&nbsp;<span class="op" id="3409671">=</span>&nbsp;<span class="builtintype" id="3409673">string</span><span class="op" id="3409679">(</span><span class="ident" id="3409680">repl</span><span class="op" id="3409684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409692">return</span>&nbsp;<span class="ident" id="3409699">re</span><span class="op" id="3409701">.</span><span class="ident" id="3409702">expand</span><span class="op" id="3409708">(</span><span class="ident" id="3409709">dst</span><span class="op" id="3409712">,</span>&nbsp;<span class="ident" id="3409714">srepl</span><span class="op" id="3409719">,</span>&nbsp;<span class="ident" id="3409721">src</span><span class="op" id="3409724">,</span>&nbsp;<span class="string" id="3409726">&#34;&#34;</span><span class="op" id="3409728">,</span>&nbsp;<span class="ident" id="3409730">match</span><span class="op" id="3409735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409738">}</span><span class="op" id="3409739">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409742">return</span>&nbsp;<span class="ident" id="3409749">b</span><br>
<span class="lineno"></span><span class="op" id="3409751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3409754">//&nbsp;ReplaceAllLiteral&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src,&nbsp;replacing&nbsp;matches&nbsp;of&nbsp;the&nbsp;Regexp</span><br>
<span class="lineno"></span><span class="comment" id="3409830">//&nbsp;with&nbsp;the&nbsp;replacement&nbsp;bytes&nbsp;repl.&nbsp;&nbsp;The&nbsp;replacement&nbsp;repl&nbsp;is&nbsp;substituted&nbsp;directly,</span><br>
<span class="lineno">555</span><span class="comment" id="3409913">//&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3409938">func</span>&nbsp;<span class="op" id="3409943">(</span><span class="ident" id="3409944">re</span>&nbsp;<span class="op" id="3409947">*</span><span class="ident" id="3409948">Regexp</span><span class="op" id="3409954">)</span>&nbsp;<span class="ident" id="3409956">ReplaceAllLiteral</span><span class="op" id="3409973">(</span><span class="ident" id="3409974">src</span><span class="op" id="3409977">,</span>&nbsp;<span class="ident" id="3409979">repl</span>&nbsp;<span class="op" id="3409984">[</span><span class="op" id="3409985">]</span><span class="builtintype" id="3409986">byte</span><span class="op" id="3409990">)</span>&nbsp;<span class="op" id="3409992">[</span><span class="op" id="3409993">]</span><span class="builtintype" id="3409994">byte</span>&nbsp;<span class="op" id="3409999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410002">return</span>&nbsp;<span class="ident" id="3410009">re</span><span class="op" id="3410011">.</span><span class="ident" id="3410012">replaceAll</span><span class="op" id="3410022">(</span><span class="ident" id="3410023">src</span><span class="op" id="3410026">,</span>&nbsp;<span class="string" id="3410028">&#34;&#34;</span><span class="op" id="3410030">,</span>&nbsp;<span class="num" id="3410032">2</span><span class="op" id="3410033">,</span>&nbsp;<span class="keyword" id="3410035">func</span><span class="op" id="3410039">(</span><span class="ident" id="3410040">dst</span>&nbsp;<span class="op" id="3410044">[</span><span class="op" id="3410045">]</span><span class="builtintype" id="3410046">byte</span><span class="op" id="3410050">,</span>&nbsp;<span class="ident" id="3410052">match</span>&nbsp;<span class="op" id="3410058">[</span><span class="op" id="3410059">]</span><span class="builtintype" id="3410060">int</span><span class="op" id="3410063">)</span>&nbsp;<span class="op" id="3410065">[</span><span class="op" id="3410066">]</span><span class="builtintype" id="3410067">byte</span>&nbsp;<span class="op" id="3410072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410076">return</span>&nbsp;<span class="builtinfunc" id="3410083">append</span><span class="op" id="3410089">(</span><span class="ident" id="3410090">dst</span><span class="op" id="3410093">,</span>&nbsp;<span class="ident" id="3410095">repl</span><span class="op" id="3410099">...</span><span class="op" id="3410102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410105">}</span><span class="op" id="3410106">)</span><br>
<span class="lineno">560</span><span class="op" id="3410108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3410111">//&nbsp;ReplaceAllFunc&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;src&nbsp;in&nbsp;which&nbsp;all&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3410179">//&nbsp;Regexp&nbsp;have&nbsp;been&nbsp;replaced&nbsp;by&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;function&nbsp;repl&nbsp;applied</span><br>
<span class="lineno"></span><span class="comment" id="3410253">//&nbsp;to&nbsp;the&nbsp;matched&nbsp;byte&nbsp;slice.&nbsp;&nbsp;The&nbsp;replacement&nbsp;returned&nbsp;by&nbsp;repl&nbsp;is&nbsp;substituted</span><br>
<span class="lineno">565</span><span class="comment" id="3410332">//&nbsp;directly,&nbsp;without&nbsp;using&nbsp;Expand.</span><br>
<span class="lineno"></span><span class="keyword" id="3410367">func</span>&nbsp;<span class="op" id="3410372">(</span><span class="ident" id="3410373">re</span>&nbsp;<span class="op" id="3410376">*</span><span class="ident" id="3410377">Regexp</span><span class="op" id="3410383">)</span>&nbsp;<span class="ident" id="3410385">ReplaceAllFunc</span><span class="op" id="3410399">(</span><span class="ident" id="3410400">src</span>&nbsp;<span class="op" id="3410404">[</span><span class="op" id="3410405">]</span><span class="builtintype" id="3410406">byte</span><span class="op" id="3410410">,</span>&nbsp;<span class="ident" id="3410412">repl</span>&nbsp;<span class="keyword" id="3410417">func</span><span class="op" id="3410421">(</span><span class="op" id="3410422">[</span><span class="op" id="3410423">]</span><span class="builtintype" id="3410424">byte</span><span class="op" id="3410428">)</span>&nbsp;<span class="op" id="3410430">[</span><span class="op" id="3410431">]</span><span class="builtintype" id="3410432">byte</span><span class="op" id="3410436">)</span>&nbsp;<span class="op" id="3410438">[</span><span class="op" id="3410439">]</span><span class="builtintype" id="3410440">byte</span>&nbsp;<span class="op" id="3410445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410448">return</span>&nbsp;<span class="ident" id="3410455">re</span><span class="op" id="3410457">.</span><span class="ident" id="3410458">replaceAll</span><span class="op" id="3410468">(</span><span class="ident" id="3410469">src</span><span class="op" id="3410472">,</span>&nbsp;<span class="string" id="3410474">&#34;&#34;</span><span class="op" id="3410476">,</span>&nbsp;<span class="num" id="3410478">2</span><span class="op" id="3410479">,</span>&nbsp;<span class="keyword" id="3410481">func</span><span class="op" id="3410485">(</span><span class="ident" id="3410486">dst</span>&nbsp;<span class="op" id="3410490">[</span><span class="op" id="3410491">]</span><span class="builtintype" id="3410492">byte</span><span class="op" id="3410496">,</span>&nbsp;<span class="ident" id="3410498">match</span>&nbsp;<span class="op" id="3410504">[</span><span class="op" id="3410505">]</span><span class="builtintype" id="3410506">int</span><span class="op" id="3410509">)</span>&nbsp;<span class="op" id="3410511">[</span><span class="op" id="3410512">]</span><span class="builtintype" id="3410513">byte</span>&nbsp;<span class="op" id="3410518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410522">return</span>&nbsp;<span class="builtinfunc" id="3410529">append</span><span class="op" id="3410535">(</span><span class="ident" id="3410536">dst</span><span class="op" id="3410539">,</span>&nbsp;<span class="ident" id="3410541">repl</span><span class="op" id="3410545">(</span><span class="ident" id="3410546">src</span><span class="op" id="3410549">[</span><span class="ident" id="3410550">match</span><span class="op" id="3410555">[</span><span class="num" id="3410556">0</span><span class="op" id="3410557">]</span><span class="op" id="3410558">:</span><span class="ident" id="3410559">match</span><span class="op" id="3410564">[</span><span class="num" id="3410565">1</span><span class="op" id="3410566">]</span><span class="op" id="3410567">]</span><span class="op" id="3410568">)</span><span class="op" id="3410569">...</span><span class="op" id="3410572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410575">}</span><span class="op" id="3410576">)</span><br>
<span class="lineno">570</span><span class="op" id="3410578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3410581">var</span>&nbsp;<span class="ident" id="3410585">specialBytes</span>&nbsp;<span class="op" id="3410598">=</span>&nbsp;<span class="op" id="3410600">[</span><span class="op" id="3410601">]</span><span class="builtintype" id="3410602">byte</span><span class="op" id="3410606">(</span><span class="string" id="3410607">`\.+*?()|[]{}^$`</span><span class="op" id="3410623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3410626">func</span>&nbsp;<span class="ident" id="3410631">special</span><span class="op" id="3410638">(</span><span class="ident" id="3410639">b</span>&nbsp;<span class="builtintype" id="3410641">byte</span><span class="op" id="3410645">)</span>&nbsp;<span class="builtintype" id="3410647">bool</span>&nbsp;<span class="op" id="3410652">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410655">return</span>&nbsp;<span class="ident" id="3410662">bytes</span><span class="op" id="3410667">.</span><span class="ident" id="3410668">IndexByte</span><span class="op" id="3410677">(</span><span class="ident" id="3410678">specialBytes</span><span class="op" id="3410690">,</span>&nbsp;<span class="ident" id="3410692">b</span><span class="op" id="3410693">)</span>&nbsp;<span class="op" id="3410695">&gt;=</span>&nbsp;<span class="num" id="3410698">0</span><br>
<span class="lineno"></span><span class="op" id="3410700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3410703">//&nbsp;QuoteMeta&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;quotes&nbsp;all&nbsp;regular&nbsp;expression&nbsp;metacharacters</span><br>
<span class="lineno"></span><span class="comment" id="3410783">//&nbsp;inside&nbsp;the&nbsp;argument&nbsp;text;&nbsp;the&nbsp;returned&nbsp;string&nbsp;is&nbsp;a&nbsp;regular&nbsp;expression&nbsp;matching</span><br>
<span class="lineno">580</span><span class="comment" id="3410865">//&nbsp;the&nbsp;literal&nbsp;text.&nbsp;&nbsp;For&nbsp;example,&nbsp;QuoteMeta(`[foo]`)&nbsp;returns&nbsp;`\[foo\]`.</span><br>
<span class="lineno"></span><span class="keyword" id="3410938">func</span>&nbsp;<span class="ident" id="3410943">QuoteMeta</span><span class="op" id="3410952">(</span><span class="ident" id="3410953">s</span>&nbsp;<span class="builtintype" id="3410955">string</span><span class="op" id="3410961">)</span>&nbsp;<span class="builtintype" id="3410963">string</span>&nbsp;<span class="op" id="3410970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410973">b</span>&nbsp;<span class="op" id="3410975">:=</span>&nbsp;<span class="builtinfunc" id="3410978">make</span><span class="op" id="3410982">(</span><span class="op" id="3410983">[</span><span class="op" id="3410984">]</span><span class="builtintype" id="3410985">byte</span><span class="op" id="3410989">,</span>&nbsp;<span class="num" id="3410991">2</span><span class="op" id="3410992">*</span><span class="builtinfunc" id="3410993">len</span><span class="op" id="3410996">(</span><span class="ident" id="3410997">s</span><span class="op" id="3410998">)</span><span class="op" id="3410999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411003">//&nbsp;A&nbsp;byte&nbsp;loop&nbsp;is&nbsp;correct&nbsp;because&nbsp;all&nbsp;metacharacters&nbsp;are&nbsp;ASCII.</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411068">j</span>&nbsp;<span class="op" id="3411070">:=</span>&nbsp;<span class="num" id="3411073">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411076">for</span>&nbsp;<span class="ident" id="3411080">i</span>&nbsp;<span class="op" id="3411082">:=</span>&nbsp;<span class="num" id="3411085">0</span><span class="op" id="3411086">;</span>&nbsp;<span class="ident" id="3411088">i</span>&nbsp;<span class="op" id="3411090">&lt;</span>&nbsp;<span class="builtinfunc" id="3411092">len</span><span class="op" id="3411095">(</span><span class="ident" id="3411096">s</span><span class="op" id="3411097">)</span><span class="op" id="3411098">;</span>&nbsp;<span class="ident" id="3411100">i</span><span class="op" id="3411101">++</span>&nbsp;<span class="op" id="3411104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411108">if</span>&nbsp;<span class="ident" id="3411111">special</span><span class="op" id="3411118">(</span><span class="ident" id="3411119">s</span><span class="op" id="3411120">[</span><span class="ident" id="3411121">i</span><span class="op" id="3411122">]</span><span class="op" id="3411123">)</span>&nbsp;<span class="op" id="3411125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411130">b</span><span class="op" id="3411131">[</span><span class="ident" id="3411132">j</span><span class="op" id="3411133">]</span>&nbsp;<span class="op" id="3411135">=</span>&nbsp;<span class="string" id="3411137">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411145">j</span><span class="op" id="3411146">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411155">b</span><span class="op" id="3411156">[</span><span class="ident" id="3411157">j</span><span class="op" id="3411158">]</span>&nbsp;<span class="op" id="3411160">=</span>&nbsp;<span class="ident" id="3411162">s</span><span class="op" id="3411163">[</span><span class="ident" id="3411164">i</span><span class="op" id="3411165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411169">j</span><span class="op" id="3411170">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411177">return</span>&nbsp;<span class="builtintype" id="3411184">string</span><span class="op" id="3411190">(</span><span class="ident" id="3411191">b</span><span class="op" id="3411192">[</span><span class="num" id="3411193">0</span><span class="op" id="3411194">:</span><span class="ident" id="3411195">j</span><span class="op" id="3411196">]</span><span class="op" id="3411197">)</span><br>
<span class="lineno">595</span><span class="op" id="3411199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3411202">//&nbsp;The&nbsp;number&nbsp;of&nbsp;capture&nbsp;values&nbsp;in&nbsp;the&nbsp;program&nbsp;may&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="3411264">//&nbsp;to&nbsp;fewer&nbsp;capturing&nbsp;expressions&nbsp;than&nbsp;are&nbsp;in&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="comment" id="3411322">//&nbsp;For&nbsp;example,&nbsp;&#34;(a){0}&#34;&nbsp;turns&nbsp;into&nbsp;an&nbsp;empty&nbsp;program,&nbsp;so&nbsp;the</span><br>
<span class="lineno">600</span><span class="comment" id="3411383">//&nbsp;maximum&nbsp;capture&nbsp;in&nbsp;the&nbsp;program&nbsp;is&nbsp;0&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3411444">//&nbsp;an&nbsp;expression&nbsp;for&nbsp;\1.&nbsp;&nbsp;Pad&nbsp;appends&nbsp;-1s&nbsp;to&nbsp;the&nbsp;slice&nbsp;a&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="3411512">func</span>&nbsp;<span class="op" id="3411517">(</span><span class="ident" id="3411518">re</span>&nbsp;<span class="op" id="3411521">*</span><span class="ident" id="3411522">Regexp</span><span class="op" id="3411528">)</span>&nbsp;<span class="ident" id="3411530">pad</span><span class="op" id="3411533">(</span><span class="ident" id="3411534">a</span>&nbsp;<span class="op" id="3411536">[</span><span class="op" id="3411537">]</span><span class="builtintype" id="3411538">int</span><span class="op" id="3411541">)</span>&nbsp;<span class="op" id="3411543">[</span><span class="op" id="3411544">]</span><span class="builtintype" id="3411545">int</span>&nbsp;<span class="op" id="3411549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411552">if</span>&nbsp;<span class="ident" id="3411555">a</span>&nbsp;<span class="op" id="3411557">==</span>&nbsp;<span class="ident" id="3411560">nil</span>&nbsp;<span class="op" id="3411564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411568">//&nbsp;No&nbsp;match.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411583">return</span>&nbsp;<span class="ident" id="3411590">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411598">n</span>&nbsp;<span class="op" id="3411600">:=</span>&nbsp;<span class="op" id="3411603">(</span><span class="num" id="3411604">1</span>&nbsp;<span class="op" id="3411606">+</span>&nbsp;<span class="ident" id="3411608">re</span><span class="op" id="3411610">.</span><span class="ident" id="3411611">numSubexp</span><span class="op" id="3411620">)</span>&nbsp;<span class="op" id="3411622">*</span>&nbsp;<span class="num" id="3411624">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411627">for</span>&nbsp;<span class="builtinfunc" id="3411631">len</span><span class="op" id="3411634">(</span><span class="ident" id="3411635">a</span><span class="op" id="3411636">)</span>&nbsp;<span class="op" id="3411638">&lt;</span>&nbsp;<span class="ident" id="3411640">n</span>&nbsp;<span class="op" id="3411642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411646">a</span>&nbsp;<span class="op" id="3411648">=</span>&nbsp;<span class="builtinfunc" id="3411650">append</span><span class="op" id="3411656">(</span><span class="ident" id="3411657">a</span><span class="op" id="3411658">,</span>&nbsp;<span class="op" id="3411660">-</span><span class="num" id="3411661">1</span><span class="op" id="3411662">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411668">return</span>&nbsp;<span class="ident" id="3411675">a</span><br>
<span class="lineno"></span><span class="op" id="3411677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3411680">//&nbsp;Find&nbsp;matches&nbsp;in&nbsp;slice&nbsp;b&nbsp;if&nbsp;b&nbsp;is&nbsp;non-nil,&nbsp;otherwise&nbsp;find&nbsp;matches&nbsp;in&nbsp;string&nbsp;s.</span><br>
<span class="lineno">615</span><span class="keyword" id="3411760">func</span>&nbsp;<span class="op" id="3411765">(</span><span class="ident" id="3411766">re</span>&nbsp;<span class="op" id="3411769">*</span><span class="ident" id="3411770">Regexp</span><span class="op" id="3411776">)</span>&nbsp;<span class="ident" id="3411778">allMatches</span><span class="op" id="3411788">(</span><span class="ident" id="3411789">s</span>&nbsp;<span class="builtintype" id="3411791">string</span><span class="op" id="3411797">,</span>&nbsp;<span class="ident" id="3411799">b</span>&nbsp;<span class="op" id="3411801">[</span><span class="op" id="3411802">]</span><span class="builtintype" id="3411803">byte</span><span class="op" id="3411807">,</span>&nbsp;<span class="ident" id="3411809">n</span>&nbsp;<span class="builtintype" id="3411811">int</span><span class="op" id="3411814">,</span>&nbsp;<span class="ident" id="3411816">deliver</span>&nbsp;<span class="keyword" id="3411824">func</span><span class="op" id="3411828">(</span><span class="op" id="3411829">[</span><span class="op" id="3411830">]</span><span class="builtintype" id="3411831">int</span><span class="op" id="3411834">)</span><span class="op" id="3411835">)</span>&nbsp;<span class="op" id="3411837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411840">var</span>&nbsp;<span class="ident" id="3411844">end</span>&nbsp;<span class="builtintype" id="3411848">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411853">if</span>&nbsp;<span class="ident" id="3411856">b</span>&nbsp;<span class="op" id="3411858">==</span>&nbsp;<span class="ident" id="3411861">nil</span>&nbsp;<span class="op" id="3411865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411869">end</span>&nbsp;<span class="op" id="3411873">=</span>&nbsp;<span class="builtinfunc" id="3411875">len</span><span class="op" id="3411878">(</span><span class="ident" id="3411879">s</span><span class="op" id="3411880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411883">}</span>&nbsp;<span class="keyword" id="3411885">else</span>&nbsp;<span class="op" id="3411890">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411894">end</span>&nbsp;<span class="op" id="3411898">=</span>&nbsp;<span class="builtinfunc" id="3411900">len</span><span class="op" id="3411903">(</span><span class="ident" id="3411904">b</span><span class="op" id="3411905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411912">for</span>&nbsp;<span class="ident" id="3411916">pos</span><span class="op" id="3411919">,</span>&nbsp;<span class="ident" id="3411921">i</span><span class="op" id="3411922">,</span>&nbsp;<span class="ident" id="3411924">prevMatchEnd</span>&nbsp;<span class="op" id="3411937">:=</span>&nbsp;<span class="num" id="3411940">0</span><span class="op" id="3411941">,</span>&nbsp;<span class="num" id="3411943">0</span><span class="op" id="3411944">,</span>&nbsp;<span class="op" id="3411946">-</span><span class="num" id="3411947">1</span><span class="op" id="3411948">;</span>&nbsp;<span class="ident" id="3411950">i</span>&nbsp;<span class="op" id="3411952">&lt;</span>&nbsp;<span class="ident" id="3411954">n</span>&nbsp;<span class="op" id="3411956">&amp;&amp;</span>&nbsp;<span class="ident" id="3411959">pos</span>&nbsp;<span class="op" id="3411963">&lt;=</span>&nbsp;<span class="ident" id="3411966">end</span><span class="op" id="3411969">;</span>&nbsp;<span class="op" id="3411971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411975">matches</span>&nbsp;<span class="op" id="3411983">:=</span>&nbsp;<span class="ident" id="3411986">re</span><span class="op" id="3411988">.</span><span class="ident" id="3411989">doExecute</span><span class="op" id="3411998">(</span><span class="ident" id="3411999">nil</span><span class="op" id="3412002">,</span>&nbsp;<span class="ident" id="3412004">b</span><span class="op" id="3412005">,</span>&nbsp;<span class="ident" id="3412007">s</span><span class="op" id="3412008">,</span>&nbsp;<span class="ident" id="3412010">pos</span><span class="op" id="3412013">,</span>&nbsp;<span class="ident" id="3412015">re</span><span class="op" id="3412017">.</span><span class="ident" id="3412018">prog</span><span class="op" id="3412022">.</span><span class="ident" id="3412023">NumCap</span><span class="op" id="3412029">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412033">if</span>&nbsp;<span class="builtinfunc" id="3412036">len</span><span class="op" id="3412039">(</span><span class="ident" id="3412040">matches</span><span class="op" id="3412047">)</span>&nbsp;<span class="op" id="3412049">==</span>&nbsp;<span class="num" id="3412052">0</span>&nbsp;<span class="op" id="3412054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412059">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412072">accept</span>&nbsp;<span class="op" id="3412079">:=</span>&nbsp;<span class="builtintype" id="3412082">true</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412089">if</span>&nbsp;<span class="ident" id="3412092">matches</span><span class="op" id="3412099">[</span><span class="num" id="3412100">1</span><span class="op" id="3412101">]</span>&nbsp;<span class="op" id="3412103">==</span>&nbsp;<span class="ident" id="3412106">pos</span>&nbsp;<span class="op" id="3412110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412115">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412149">if</span>&nbsp;<span class="ident" id="3412152">matches</span><span class="op" id="3412159">[</span><span class="num" id="3412160">0</span><span class="op" id="3412161">]</span>&nbsp;<span class="op" id="3412163">==</span>&nbsp;<span class="ident" id="3412166">prevMatchEnd</span>&nbsp;<span class="op" id="3412179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412185">//&nbsp;We&nbsp;don&#39;t&nbsp;allow&nbsp;an&nbsp;empty&nbsp;match&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412228">//&nbsp;after&nbsp;a&nbsp;previous&nbsp;match,&nbsp;so&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412273">accept</span>&nbsp;<span class="op" id="3412280">=</span>&nbsp;<span class="builtintype" id="3412282">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412296">var</span>&nbsp;<span class="ident" id="3412300">width</span>&nbsp;<span class="builtintype" id="3412306">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412313">//&nbsp;TODO:&nbsp;use&nbsp;step()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412336">if</span>&nbsp;<span class="ident" id="3412339">b</span>&nbsp;<span class="op" id="3412341">==</span>&nbsp;<span class="ident" id="3412344">nil</span>&nbsp;<span class="op" id="3412348">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412354">_</span><span class="op" id="3412355">,</span>&nbsp;<span class="ident" id="3412357">width</span>&nbsp;<span class="op" id="3412363">=</span>&nbsp;<span class="ident" id="3412365">utf8</span><span class="op" id="3412369">.</span><span class="ident" id="3412370">DecodeRuneInString</span><span class="op" id="3412388">(</span><span class="ident" id="3412389">s</span><span class="op" id="3412390">[</span><span class="ident" id="3412391">pos</span><span class="op" id="3412394">:</span><span class="ident" id="3412395">end</span><span class="op" id="3412398">]</span><span class="op" id="3412399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412404">}</span>&nbsp;<span class="keyword" id="3412406">else</span>&nbsp;<span class="op" id="3412411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412417">_</span><span class="op" id="3412418">,</span>&nbsp;<span class="ident" id="3412420">width</span>&nbsp;<span class="op" id="3412426">=</span>&nbsp;<span class="ident" id="3412428">utf8</span><span class="op" id="3412432">.</span><span class="ident" id="3412433">DecodeRune</span><span class="op" id="3412443">(</span><span class="ident" id="3412444">b</span><span class="op" id="3412445">[</span><span class="ident" id="3412446">pos</span><span class="op" id="3412449">:</span><span class="ident" id="3412450">end</span><span class="op" id="3412453">]</span><span class="op" id="3412454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412464">if</span>&nbsp;<span class="ident" id="3412467">width</span>&nbsp;<span class="op" id="3412473">&gt;</span>&nbsp;<span class="num" id="3412475">0</span>&nbsp;<span class="op" id="3412477">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412483">pos</span>&nbsp;<span class="op" id="3412487">+=</span>&nbsp;<span class="ident" id="3412490">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412499">}</span>&nbsp;<span class="keyword" id="3412501">else</span>&nbsp;<span class="op" id="3412506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412512">pos</span>&nbsp;<span class="op" id="3412516">=</span>&nbsp;<span class="ident" id="3412518">end</span>&nbsp;<span class="op" id="3412522">+</span>&nbsp;<span class="num" id="3412524">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412533">}</span>&nbsp;<span class="keyword" id="3412535">else</span>&nbsp;<span class="op" id="3412540">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412545">pos</span>&nbsp;<span class="op" id="3412549">=</span>&nbsp;<span class="ident" id="3412551">matches</span><span class="op" id="3412558">[</span><span class="num" id="3412559">1</span><span class="op" id="3412560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412568">prevMatchEnd</span>&nbsp;<span class="op" id="3412581">=</span>&nbsp;<span class="ident" id="3412583">matches</span><span class="op" id="3412590">[</span><span class="num" id="3412591">1</span><span class="op" id="3412592">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412597">if</span>&nbsp;<span class="ident" id="3412600">accept</span>&nbsp;<span class="op" id="3412607">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412612">deliver</span><span class="op" id="3412619">(</span><span class="ident" id="3412620">re</span><span class="op" id="3412622">.</span><span class="ident" id="3412623">pad</span><span class="op" id="3412626">(</span><span class="ident" id="3412627">matches</span><span class="op" id="3412634">)</span><span class="op" id="3412635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412640">i</span><span class="op" id="3412641">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412649">}</span><br>
<span class="lineno"></span><span class="op" id="3412651">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="3412654">//&nbsp;Find&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="comment" id="3412749">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3412794">func</span>&nbsp;<span class="op" id="3412799">(</span><span class="ident" id="3412800">re</span>&nbsp;<span class="op" id="3412803">*</span><span class="ident" id="3412804">Regexp</span><span class="op" id="3412810">)</span>&nbsp;<span class="ident" id="3412812">Find</span><span class="op" id="3412816">(</span><span class="ident" id="3412817">b</span>&nbsp;<span class="op" id="3412819">[</span><span class="op" id="3412820">]</span><span class="builtintype" id="3412821">byte</span><span class="op" id="3412825">)</span>&nbsp;<span class="op" id="3412827">[</span><span class="op" id="3412828">]</span><span class="builtintype" id="3412829">byte</span>&nbsp;<span class="op" id="3412834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412837">a</span>&nbsp;<span class="op" id="3412839">:=</span>&nbsp;<span class="ident" id="3412842">re</span><span class="op" id="3412844">.</span><span class="ident" id="3412845">doExecute</span><span class="op" id="3412854">(</span><span class="ident" id="3412855">nil</span><span class="op" id="3412858">,</span>&nbsp;<span class="ident" id="3412860">b</span><span class="op" id="3412861">,</span>&nbsp;<span class="string" id="3412863">&#34;&#34;</span><span class="op" id="3412865">,</span>&nbsp;<span class="num" id="3412867">0</span><span class="op" id="3412868">,</span>&nbsp;<span class="num" id="3412870">2</span><span class="op" id="3412871">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412874">if</span>&nbsp;<span class="ident" id="3412877">a</span>&nbsp;<span class="op" id="3412879">==</span>&nbsp;<span class="ident" id="3412882">nil</span>&nbsp;<span class="op" id="3412886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412890">return</span>&nbsp;<span class="ident" id="3412897">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412905">return</span>&nbsp;<span class="ident" id="3412912">b</span><span class="op" id="3412913">[</span><span class="ident" id="3412914">a</span><span class="op" id="3412915">[</span><span class="num" id="3412916">0</span><span class="op" id="3412917">]</span><span class="op" id="3412918">:</span><span class="ident" id="3412919">a</span><span class="op" id="3412920">[</span><span class="num" id="3412921">1</span><span class="op" id="3412922">]</span><span class="op" id="3412923">]</span><br>
<span class="lineno"></span><span class="op" id="3412925">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="3412928">//&nbsp;FindIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the&nbsp;location&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3413006">//&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;b&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match&nbsp;itself&nbsp;is&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3413084">//&nbsp;b[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3413105">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">675</span><span class="keyword" id="3413150">func</span>&nbsp;<span class="op" id="3413155">(</span><span class="ident" id="3413156">re</span>&nbsp;<span class="op" id="3413159">*</span><span class="ident" id="3413160">Regexp</span><span class="op" id="3413166">)</span>&nbsp;<span class="ident" id="3413168">FindIndex</span><span class="op" id="3413177">(</span><span class="ident" id="3413178">b</span>&nbsp;<span class="op" id="3413180">[</span><span class="op" id="3413181">]</span><span class="builtintype" id="3413182">byte</span><span class="op" id="3413186">)</span>&nbsp;<span class="op" id="3413188">(</span><span class="ident" id="3413189">loc</span>&nbsp;<span class="op" id="3413193">[</span><span class="op" id="3413194">]</span><span class="builtintype" id="3413195">int</span><span class="op" id="3413198">)</span>&nbsp;<span class="op" id="3413200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413203">a</span>&nbsp;<span class="op" id="3413205">:=</span>&nbsp;<span class="ident" id="3413208">re</span><span class="op" id="3413210">.</span><span class="ident" id="3413211">doExecute</span><span class="op" id="3413220">(</span><span class="ident" id="3413221">nil</span><span class="op" id="3413224">,</span>&nbsp;<span class="ident" id="3413226">b</span><span class="op" id="3413227">,</span>&nbsp;<span class="string" id="3413229">&#34;&#34;</span><span class="op" id="3413231">,</span>&nbsp;<span class="num" id="3413233">0</span><span class="op" id="3413234">,</span>&nbsp;<span class="num" id="3413236">2</span><span class="op" id="3413237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413240">if</span>&nbsp;<span class="ident" id="3413243">a</span>&nbsp;<span class="op" id="3413245">==</span>&nbsp;<span class="ident" id="3413248">nil</span>&nbsp;<span class="op" id="3413252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413256">return</span>&nbsp;<span class="ident" id="3413263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413268">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413271">return</span>&nbsp;<span class="ident" id="3413278">a</span><span class="op" id="3413279">[</span><span class="num" id="3413280">0</span><span class="op" id="3413281">:</span><span class="num" id="3413282">2</span><span class="op" id="3413283">]</span><br>
<span class="lineno"></span><span class="op" id="3413285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3413288">//&nbsp;FindString&nbsp;returns&nbsp;a&nbsp;string&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular</span><br>
<span class="lineno"></span><span class="comment" id="3413378">//&nbsp;expression.&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;match,&nbsp;the&nbsp;return&nbsp;value&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,</span><br>
<span class="lineno">685</span><span class="comment" id="3413453">//&nbsp;but&nbsp;it&nbsp;will&nbsp;also&nbsp;be&nbsp;empty&nbsp;if&nbsp;the&nbsp;regular&nbsp;expression&nbsp;successfully&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="3413529">//&nbsp;an&nbsp;empty&nbsp;string.&nbsp;&nbsp;Use&nbsp;FindStringIndex&nbsp;or&nbsp;FindStringSubmatch&nbsp;if&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3413601">//&nbsp;necessary&nbsp;to&nbsp;distinguish&nbsp;these&nbsp;cases.</span><br>
<span class="lineno"></span><span class="keyword" id="3413642">func</span>&nbsp;<span class="op" id="3413647">(</span><span class="ident" id="3413648">re</span>&nbsp;<span class="op" id="3413651">*</span><span class="ident" id="3413652">Regexp</span><span class="op" id="3413658">)</span>&nbsp;<span class="ident" id="3413660">FindString</span><span class="op" id="3413670">(</span><span class="ident" id="3413671">s</span>&nbsp;<span class="builtintype" id="3413673">string</span><span class="op" id="3413679">)</span>&nbsp;<span class="builtintype" id="3413681">string</span>&nbsp;<span class="op" id="3413688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413691">a</span>&nbsp;<span class="op" id="3413693">:=</span>&nbsp;<span class="ident" id="3413696">re</span><span class="op" id="3413698">.</span><span class="ident" id="3413699">doExecute</span><span class="op" id="3413708">(</span><span class="ident" id="3413709">nil</span><span class="op" id="3413712">,</span>&nbsp;<span class="ident" id="3413714">nil</span><span class="op" id="3413717">,</span>&nbsp;<span class="ident" id="3413719">s</span><span class="op" id="3413720">,</span>&nbsp;<span class="num" id="3413722">0</span><span class="op" id="3413723">,</span>&nbsp;<span class="num" id="3413725">2</span><span class="op" id="3413726">)</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413729">if</span>&nbsp;<span class="ident" id="3413732">a</span>&nbsp;<span class="op" id="3413734">==</span>&nbsp;<span class="ident" id="3413737">nil</span>&nbsp;<span class="op" id="3413741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413745">return</span>&nbsp;<span class="string" id="3413752">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413759">return</span>&nbsp;<span class="ident" id="3413766">s</span><span class="op" id="3413767">[</span><span class="ident" id="3413768">a</span><span class="op" id="3413769">[</span><span class="num" id="3413770">0</span><span class="op" id="3413771">]</span><span class="op" id="3413772">:</span><span class="ident" id="3413773">a</span><span class="op" id="3413774">[</span><span class="num" id="3413775">1</span><span class="op" id="3413776">]</span><span class="op" id="3413777">]</span><br>
<span class="lineno"></span><span class="op" id="3413779">}</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span><span class="comment" id="3413782">//&nbsp;FindStringIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3413854">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression.&nbsp;&nbsp;The&nbsp;match</span><br>
<span class="lineno"></span><span class="comment" id="3413931">//&nbsp;itself&nbsp;is&nbsp;at&nbsp;s[loc[0]:loc[1]].</span><br>
<span class="lineno"></span><span class="comment" id="3413965">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">700</span><span class="keyword" id="3414010">func</span>&nbsp;<span class="op" id="3414015">(</span><span class="ident" id="3414016">re</span>&nbsp;<span class="op" id="3414019">*</span><span class="ident" id="3414020">Regexp</span><span class="op" id="3414026">)</span>&nbsp;<span class="ident" id="3414028">FindStringIndex</span><span class="op" id="3414043">(</span><span class="ident" id="3414044">s</span>&nbsp;<span class="builtintype" id="3414046">string</span><span class="op" id="3414052">)</span>&nbsp;<span class="op" id="3414054">(</span><span class="ident" id="3414055">loc</span>&nbsp;<span class="op" id="3414059">[</span><span class="op" id="3414060">]</span><span class="builtintype" id="3414061">int</span><span class="op" id="3414064">)</span>&nbsp;<span class="op" id="3414066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414069">a</span>&nbsp;<span class="op" id="3414071">:=</span>&nbsp;<span class="ident" id="3414074">re</span><span class="op" id="3414076">.</span><span class="ident" id="3414077">doExecute</span><span class="op" id="3414086">(</span><span class="ident" id="3414087">nil</span><span class="op" id="3414090">,</span>&nbsp;<span class="ident" id="3414092">nil</span><span class="op" id="3414095">,</span>&nbsp;<span class="ident" id="3414097">s</span><span class="op" id="3414098">,</span>&nbsp;<span class="num" id="3414100">0</span><span class="op" id="3414101">,</span>&nbsp;<span class="num" id="3414103">2</span><span class="op" id="3414104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414107">if</span>&nbsp;<span class="ident" id="3414110">a</span>&nbsp;<span class="op" id="3414112">==</span>&nbsp;<span class="ident" id="3414115">nil</span>&nbsp;<span class="op" id="3414119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414123">return</span>&nbsp;<span class="ident" id="3414130">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414135">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414138">return</span>&nbsp;<span class="ident" id="3414145">a</span><span class="op" id="3414146">[</span><span class="num" id="3414147">0</span><span class="op" id="3414148">:</span><span class="num" id="3414149">2</span><span class="op" id="3414150">]</span><br>
<span class="lineno"></span><span class="op" id="3414152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3414155">//&nbsp;FindReaderIndex&nbsp;returns&nbsp;a&nbsp;two-element&nbsp;slice&nbsp;of&nbsp;integers&nbsp;defining&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3414227">//&nbsp;location&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;text&nbsp;read&nbsp;from</span><br>
<span class="lineno">710</span><span class="comment" id="3414305">//&nbsp;the&nbsp;RuneReader.&nbsp;&nbsp;The&nbsp;match&nbsp;text&nbsp;was&nbsp;found&nbsp;in&nbsp;the&nbsp;input&nbsp;stream&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="3414373">//&nbsp;byte&nbsp;offset&nbsp;loc[0]&nbsp;through&nbsp;loc[1]-1.</span><br>
<span class="lineno"></span><span class="comment" id="3414413">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3414458">func</span>&nbsp;<span class="op" id="3414463">(</span><span class="ident" id="3414464">re</span>&nbsp;<span class="op" id="3414467">*</span><span class="ident" id="3414468">Regexp</span><span class="op" id="3414474">)</span>&nbsp;<span class="ident" id="3414476">FindReaderIndex</span><span class="op" id="3414491">(</span><span class="ident" id="3414492">r</span>&nbsp;<span class="ident" id="3414494">io</span><span class="op" id="3414496">.</span><span class="ident" id="3414497">RuneReader</span><span class="op" id="3414507">)</span>&nbsp;<span class="op" id="3414509">(</span><span class="ident" id="3414510">loc</span>&nbsp;<span class="op" id="3414514">[</span><span class="op" id="3414515">]</span><span class="builtintype" id="3414516">int</span><span class="op" id="3414519">)</span>&nbsp;<span class="op" id="3414521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414524">a</span>&nbsp;<span class="op" id="3414526">:=</span>&nbsp;<span class="ident" id="3414529">re</span><span class="op" id="3414531">.</span><span class="ident" id="3414532">doExecute</span><span class="op" id="3414541">(</span><span class="ident" id="3414542">r</span><span class="op" id="3414543">,</span>&nbsp;<span class="ident" id="3414545">nil</span><span class="op" id="3414548">,</span>&nbsp;<span class="string" id="3414550">&#34;&#34;</span><span class="op" id="3414552">,</span>&nbsp;<span class="num" id="3414554">0</span><span class="op" id="3414555">,</span>&nbsp;<span class="num" id="3414557">2</span><span class="op" id="3414558">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414561">if</span>&nbsp;<span class="ident" id="3414564">a</span>&nbsp;<span class="op" id="3414566">==</span>&nbsp;<span class="ident" id="3414569">nil</span>&nbsp;<span class="op" id="3414573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414577">return</span>&nbsp;<span class="ident" id="3414584">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414592">return</span>&nbsp;<span class="ident" id="3414599">a</span><span class="op" id="3414600">[</span><span class="num" id="3414601">0</span><span class="op" id="3414602">:</span><span class="num" id="3414603">2</span><span class="op" id="3414604">]</span><br>
<span class="lineno"></span><span class="op" id="3414606">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="comment" id="3414609">//&nbsp;FindSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;slices&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;leftmost</span><br>
<span class="lineno"></span><span class="comment" id="3414684">//&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3414756">//&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3414832">//&nbsp;comment.</span><br>
<span class="lineno">725</span><span class="comment" id="3414844">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3414889">func</span>&nbsp;<span class="op" id="3414894">(</span><span class="ident" id="3414895">re</span>&nbsp;<span class="op" id="3414898">*</span><span class="ident" id="3414899">Regexp</span><span class="op" id="3414905">)</span>&nbsp;<span class="ident" id="3414907">FindSubmatch</span><span class="op" id="3414919">(</span><span class="ident" id="3414920">b</span>&nbsp;<span class="op" id="3414922">[</span><span class="op" id="3414923">]</span><span class="builtintype" id="3414924">byte</span><span class="op" id="3414928">)</span>&nbsp;<span class="op" id="3414930">[</span><span class="op" id="3414931">]</span><span class="op" id="3414932">[</span><span class="op" id="3414933">]</span><span class="builtintype" id="3414934">byte</span>&nbsp;<span class="op" id="3414939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414942">a</span>&nbsp;<span class="op" id="3414944">:=</span>&nbsp;<span class="ident" id="3414947">re</span><span class="op" id="3414949">.</span><span class="ident" id="3414950">doExecute</span><span class="op" id="3414959">(</span><span class="ident" id="3414960">nil</span><span class="op" id="3414963">,</span>&nbsp;<span class="ident" id="3414965">b</span><span class="op" id="3414966">,</span>&nbsp;<span class="string" id="3414968">&#34;&#34;</span><span class="op" id="3414970">,</span>&nbsp;<span class="num" id="3414972">0</span><span class="op" id="3414973">,</span>&nbsp;<span class="ident" id="3414975">re</span><span class="op" id="3414977">.</span><span class="ident" id="3414978">prog</span><span class="op" id="3414982">.</span><span class="ident" id="3414983">NumCap</span><span class="op" id="3414989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414992">if</span>&nbsp;<span class="ident" id="3414995">a</span>&nbsp;<span class="op" id="3414997">==</span>&nbsp;<span class="ident" id="3415000">nil</span>&nbsp;<span class="op" id="3415004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415008">return</span>&nbsp;<span class="ident" id="3415015">nil</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415023">ret</span>&nbsp;<span class="op" id="3415027">:=</span>&nbsp;<span class="builtinfunc" id="3415030">make</span><span class="op" id="3415034">(</span><span class="op" id="3415035">[</span><span class="op" id="3415036">]</span><span class="op" id="3415037">[</span><span class="op" id="3415038">]</span><span class="builtintype" id="3415039">byte</span><span class="op" id="3415043">,</span>&nbsp;<span class="num" id="3415045">1</span><span class="op" id="3415046">+</span><span class="ident" id="3415047">re</span><span class="op" id="3415049">.</span><span class="ident" id="3415050">numSubexp</span><span class="op" id="3415059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415062">for</span>&nbsp;<span class="ident" id="3415066">i</span>&nbsp;<span class="op" id="3415068">:=</span>&nbsp;<span class="keyword" id="3415071">range</span>&nbsp;<span class="ident" id="3415077">ret</span>&nbsp;<span class="op" id="3415081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415085">if</span>&nbsp;<span class="num" id="3415088">2</span><span class="op" id="3415089">*</span><span class="ident" id="3415090">i</span>&nbsp;<span class="op" id="3415092">&lt;</span>&nbsp;<span class="builtinfunc" id="3415094">len</span><span class="op" id="3415097">(</span><span class="ident" id="3415098">a</span><span class="op" id="3415099">)</span>&nbsp;<span class="op" id="3415101">&amp;&amp;</span>&nbsp;<span class="ident" id="3415104">a</span><span class="op" id="3415105">[</span><span class="num" id="3415106">2</span><span class="op" id="3415107">*</span><span class="ident" id="3415108">i</span><span class="op" id="3415109">]</span>&nbsp;<span class="op" id="3415111">&gt;=</span>&nbsp;<span class="num" id="3415114">0</span>&nbsp;<span class="op" id="3415116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415121">ret</span><span class="op" id="3415124">[</span><span class="ident" id="3415125">i</span><span class="op" id="3415126">]</span>&nbsp;<span class="op" id="3415128">=</span>&nbsp;<span class="ident" id="3415130">b</span><span class="op" id="3415131">[</span><span class="ident" id="3415132">a</span><span class="op" id="3415133">[</span><span class="num" id="3415134">2</span><span class="op" id="3415135">*</span><span class="ident" id="3415136">i</span><span class="op" id="3415137">]</span><span class="op" id="3415138">:</span><span class="ident" id="3415139">a</span><span class="op" id="3415140">[</span><span class="num" id="3415141">2</span><span class="op" id="3415142">*</span><span class="ident" id="3415143">i</span><span class="op" id="3415144">+</span><span class="num" id="3415145">1</span><span class="op" id="3415146">]</span><span class="op" id="3415147">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415157">return</span>&nbsp;<span class="ident" id="3415164">ret</span><br>
<span class="lineno"></span><span class="op" id="3415168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="comment" id="3415171">//&nbsp;Expand&nbsp;appends&nbsp;template&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;result;&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3415240">//&nbsp;append,&nbsp;Expand&nbsp;replaces&nbsp;variables&nbsp;in&nbsp;the&nbsp;template&nbsp;with&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3415312">//&nbsp;matches&nbsp;drawn&nbsp;from&nbsp;src.&nbsp;&nbsp;The&nbsp;match&nbsp;slice&nbsp;should&nbsp;have&nbsp;been&nbsp;returned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3415385">//&nbsp;FindSubmatchIndex.</span><br>
<span class="lineno"></span><span class="comment" id="3415407">//</span><br>
<span class="lineno">745</span><span class="comment" id="3415410">//&nbsp;In&nbsp;the&nbsp;template,&nbsp;a&nbsp;variable&nbsp;is&nbsp;denoted&nbsp;by&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3415479">//&nbsp;$name&nbsp;or&nbsp;${name},&nbsp;where&nbsp;name&nbsp;is&nbsp;a&nbsp;non-empty&nbsp;sequence&nbsp;of&nbsp;letters,</span><br>
<span class="lineno"></span><span class="comment" id="3415547">//&nbsp;digits,&nbsp;and&nbsp;underscores.&nbsp;&nbsp;A&nbsp;purely&nbsp;numeric&nbsp;name&nbsp;like&nbsp;$1&nbsp;refers&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3415616">//&nbsp;the&nbsp;submatch&nbsp;with&nbsp;the&nbsp;corresponding&nbsp;index;&nbsp;other&nbsp;names&nbsp;refer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3415683">//&nbsp;capturing&nbsp;parentheses&nbsp;named&nbsp;with&nbsp;the&nbsp;(?P&lt;name&gt;...)&nbsp;syntax.&nbsp;&nbsp;A</span><br>
<span class="lineno">750</span><span class="comment" id="3415748">//&nbsp;reference&nbsp;to&nbsp;an&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;unmatched&nbsp;index&nbsp;or&nbsp;a&nbsp;name&nbsp;that&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3415821">//&nbsp;present&nbsp;in&nbsp;the&nbsp;regular&nbsp;expression&nbsp;is&nbsp;replaced&nbsp;with&nbsp;an&nbsp;empty&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="3415891">//</span><br>
<span class="lineno"></span><span class="comment" id="3415894">//&nbsp;In&nbsp;the&nbsp;$name&nbsp;form,&nbsp;name&nbsp;is&nbsp;taken&nbsp;to&nbsp;be&nbsp;as&nbsp;long&nbsp;as&nbsp;possible:&nbsp;$1x&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3415964">//&nbsp;equivalent&nbsp;to&nbsp;${1x},&nbsp;not&nbsp;${1}x,&nbsp;and,&nbsp;$10&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;${10},&nbsp;not&nbsp;${1}0.</span><br>
<span class="lineno">755</span><span class="comment" id="3416043">//</span><br>
<span class="lineno"></span><span class="comment" id="3416046">//&nbsp;To&nbsp;insert&nbsp;a&nbsp;literal&nbsp;$&nbsp;in&nbsp;the&nbsp;output,&nbsp;use&nbsp;$$&nbsp;in&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3416110">func</span>&nbsp;<span class="op" id="3416115">(</span><span class="ident" id="3416116">re</span>&nbsp;<span class="op" id="3416119">*</span><span class="ident" id="3416120">Regexp</span><span class="op" id="3416126">)</span>&nbsp;<span class="ident" id="3416128">Expand</span><span class="op" id="3416134">(</span><span class="ident" id="3416135">dst</span>&nbsp;<span class="op" id="3416139">[</span><span class="op" id="3416140">]</span><span class="builtintype" id="3416141">byte</span><span class="op" id="3416145">,</span>&nbsp;<span class="ident" id="3416147">template</span>&nbsp;<span class="op" id="3416156">[</span><span class="op" id="3416157">]</span><span class="builtintype" id="3416158">byte</span><span class="op" id="3416162">,</span>&nbsp;<span class="ident" id="3416164">src</span>&nbsp;<span class="op" id="3416168">[</span><span class="op" id="3416169">]</span><span class="builtintype" id="3416170">byte</span><span class="op" id="3416174">,</span>&nbsp;<span class="ident" id="3416176">match</span>&nbsp;<span class="op" id="3416182">[</span><span class="op" id="3416183">]</span><span class="builtintype" id="3416184">int</span><span class="op" id="3416187">)</span>&nbsp;<span class="op" id="3416189">[</span><span class="op" id="3416190">]</span><span class="builtintype" id="3416191">byte</span>&nbsp;<span class="op" id="3416196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416199">return</span>&nbsp;<span class="ident" id="3416206">re</span><span class="op" id="3416208">.</span><span class="ident" id="3416209">expand</span><span class="op" id="3416215">(</span><span class="ident" id="3416216">dst</span><span class="op" id="3416219">,</span>&nbsp;<span class="builtintype" id="3416221">string</span><span class="op" id="3416227">(</span><span class="ident" id="3416228">template</span><span class="op" id="3416236">)</span><span class="op" id="3416237">,</span>&nbsp;<span class="ident" id="3416239">src</span><span class="op" id="3416242">,</span>&nbsp;<span class="string" id="3416244">&#34;&#34;</span><span class="op" id="3416246">,</span>&nbsp;<span class="ident" id="3416248">match</span><span class="op" id="3416253">)</span><br>
<span class="lineno"></span><span class="op" id="3416255">}</span><br>
<span class="lineno">760</span><br>
<span class="lineno"></span><span class="comment" id="3416258">//&nbsp;ExpandString&nbsp;is&nbsp;like&nbsp;Expand&nbsp;but&nbsp;the&nbsp;template&nbsp;and&nbsp;source&nbsp;are&nbsp;strings.</span><br>
<span class="lineno"></span><span class="comment" id="3416330">//&nbsp;It&nbsp;appends&nbsp;to&nbsp;and&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;in&nbsp;order&nbsp;to&nbsp;give&nbsp;the&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="3416401">//&nbsp;code&nbsp;control&nbsp;over&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="3416434">func</span>&nbsp;<span class="op" id="3416439">(</span><span class="ident" id="3416440">re</span>&nbsp;<span class="op" id="3416443">*</span><span class="ident" id="3416444">Regexp</span><span class="op" id="3416450">)</span>&nbsp;<span class="ident" id="3416452">ExpandString</span><span class="op" id="3416464">(</span><span class="ident" id="3416465">dst</span>&nbsp;<span class="op" id="3416469">[</span><span class="op" id="3416470">]</span><span class="builtintype" id="3416471">byte</span><span class="op" id="3416475">,</span>&nbsp;<span class="ident" id="3416477">template</span>&nbsp;<span class="builtintype" id="3416486">string</span><span class="op" id="3416492">,</span>&nbsp;<span class="ident" id="3416494">src</span>&nbsp;<span class="builtintype" id="3416498">string</span><span class="op" id="3416504">,</span>&nbsp;<span class="ident" id="3416506">match</span>&nbsp;<span class="op" id="3416512">[</span><span class="op" id="3416513">]</span><span class="builtintype" id="3416514">int</span><span class="op" id="3416517">)</span>&nbsp;<span class="op" id="3416519">[</span><span class="op" id="3416520">]</span><span class="builtintype" id="3416521">byte</span>&nbsp;<span class="op" id="3416526">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416529">return</span>&nbsp;<span class="ident" id="3416536">re</span><span class="op" id="3416538">.</span><span class="ident" id="3416539">expand</span><span class="op" id="3416545">(</span><span class="ident" id="3416546">dst</span><span class="op" id="3416549">,</span>&nbsp;<span class="ident" id="3416551">template</span><span class="op" id="3416559">,</span>&nbsp;<span class="ident" id="3416561">nil</span><span class="op" id="3416564">,</span>&nbsp;<span class="ident" id="3416566">src</span><span class="op" id="3416569">,</span>&nbsp;<span class="ident" id="3416571">match</span><span class="op" id="3416576">)</span><br>
<span class="lineno"></span><span class="op" id="3416578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3416581">func</span>&nbsp;<span class="op" id="3416586">(</span><span class="ident" id="3416587">re</span>&nbsp;<span class="op" id="3416590">*</span><span class="ident" id="3416591">Regexp</span><span class="op" id="3416597">)</span>&nbsp;<span class="ident" id="3416599">expand</span><span class="op" id="3416605">(</span><span class="ident" id="3416606">dst</span>&nbsp;<span class="op" id="3416610">[</span><span class="op" id="3416611">]</span><span class="builtintype" id="3416612">byte</span><span class="op" id="3416616">,</span>&nbsp;<span class="ident" id="3416618">template</span>&nbsp;<span class="builtintype" id="3416627">string</span><span class="op" id="3416633">,</span>&nbsp;<span class="ident" id="3416635">bsrc</span>&nbsp;<span class="op" id="3416640">[</span><span class="op" id="3416641">]</span><span class="builtintype" id="3416642">byte</span><span class="op" id="3416646">,</span>&nbsp;<span class="ident" id="3416648">src</span>&nbsp;<span class="builtintype" id="3416652">string</span><span class="op" id="3416658">,</span>&nbsp;<span class="ident" id="3416660">match</span>&nbsp;<span class="op" id="3416666">[</span><span class="op" id="3416667">]</span><span class="builtintype" id="3416668">int</span><span class="op" id="3416671">)</span>&nbsp;<span class="op" id="3416673">[</span><span class="op" id="3416674">]</span><span class="builtintype" id="3416675">byte</span>&nbsp;<span class="op" id="3416680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416683">for</span>&nbsp;<span class="builtinfunc" id="3416687">len</span><span class="op" id="3416690">(</span><span class="ident" id="3416691">template</span><span class="op" id="3416699">)</span>&nbsp;<span class="op" id="3416701">&gt;</span>&nbsp;<span class="num" id="3416703">0</span>&nbsp;<span class="op" id="3416705">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416709">i</span>&nbsp;<span class="op" id="3416711">:=</span>&nbsp;<span class="ident" id="3416714">strings</span><span class="op" id="3416721">.</span><span class="ident" id="3416722">Index</span><span class="op" id="3416727">(</span><span class="ident" id="3416728">template</span><span class="op" id="3416736">,</span>&nbsp;<span class="string" id="3416738">&#34;$&#34;</span><span class="op" id="3416741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416745">if</span>&nbsp;<span class="ident" id="3416748">i</span>&nbsp;<span class="op" id="3416750">&lt;</span>&nbsp;<span class="num" id="3416752">0</span>&nbsp;<span class="op" id="3416754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416759">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416771">dst</span>&nbsp;<span class="op" id="3416775">=</span>&nbsp;<span class="builtinfunc" id="3416777">append</span><span class="op" id="3416783">(</span><span class="ident" id="3416784">dst</span><span class="op" id="3416787">,</span>&nbsp;<span class="ident" id="3416789">template</span><span class="op" id="3416797">[</span><span class="op" id="3416798">:</span><span class="ident" id="3416799">i</span><span class="op" id="3416800">]</span><span class="op" id="3416801">...</span><span class="op" id="3416804">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416808">template</span>&nbsp;<span class="op" id="3416817">=</span>&nbsp;<span class="ident" id="3416819">template</span><span class="op" id="3416827">[</span><span class="ident" id="3416828">i</span><span class="op" id="3416829">:</span><span class="op" id="3416830">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416834">if</span>&nbsp;<span class="builtinfunc" id="3416837">len</span><span class="op" id="3416840">(</span><span class="ident" id="3416841">template</span><span class="op" id="3416849">)</span>&nbsp;<span class="op" id="3416851">&gt;</span>&nbsp;<span class="num" id="3416853">1</span>&nbsp;<span class="op" id="3416855">&amp;&amp;</span>&nbsp;<span class="ident" id="3416858">template</span><span class="op" id="3416866">[</span><span class="num" id="3416867">1</span><span class="op" id="3416868">]</span>&nbsp;<span class="op" id="3416870">==</span>&nbsp;<span class="string" id="3416873">&#39;$&#39;</span>&nbsp;<span class="op" id="3416877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3416882">//&nbsp;Treat&nbsp;$$&nbsp;as&nbsp;$.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416903">dst</span>&nbsp;<span class="op" id="3416907">=</span>&nbsp;<span class="builtinfunc" id="3416909">append</span><span class="op" id="3416915">(</span><span class="ident" id="3416916">dst</span><span class="op" id="3416919">,</span>&nbsp;<span class="string" id="3416921">&#39;$&#39;</span><span class="op" id="3416924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416929">template</span>&nbsp;<span class="op" id="3416938">=</span>&nbsp;<span class="ident" id="3416940">template</span><span class="op" id="3416948">[</span><span class="num" id="3416949">2</span><span class="op" id="3416950">:</span><span class="op" id="3416951">]</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416956">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416971">name</span><span class="op" id="3416975">,</span>&nbsp;<span class="ident" id="3416977">num</span><span class="op" id="3416980">,</span>&nbsp;<span class="ident" id="3416982">rest</span><span class="op" id="3416986">,</span>&nbsp;<span class="ident" id="3416988">ok</span>&nbsp;<span class="op" id="3416991">:=</span>&nbsp;<span class="ident" id="3416994">extract</span><span class="op" id="3417001">(</span><span class="ident" id="3417002">template</span><span class="op" id="3417010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417014">if</span>&nbsp;<span class="op" id="3417017">!</span><span class="ident" id="3417018">ok</span>&nbsp;<span class="op" id="3417021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3417026">//&nbsp;Malformed;&nbsp;treat&nbsp;$&nbsp;as&nbsp;raw&nbsp;text.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417064">dst</span>&nbsp;<span class="op" id="3417068">=</span>&nbsp;<span class="builtinfunc" id="3417070">append</span><span class="op" id="3417076">(</span><span class="ident" id="3417077">dst</span><span class="op" id="3417080">,</span>&nbsp;<span class="string" id="3417082">&#39;$&#39;</span><span class="op" id="3417085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417090">template</span>&nbsp;<span class="op" id="3417099">=</span>&nbsp;<span class="ident" id="3417101">template</span><span class="op" id="3417109">[</span><span class="num" id="3417110">1</span><span class="op" id="3417111">:</span><span class="op" id="3417112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417117">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417132">template</span>&nbsp;<span class="op" id="3417141">=</span>&nbsp;<span class="ident" id="3417143">rest</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417150">if</span>&nbsp;<span class="ident" id="3417153">num</span>&nbsp;<span class="op" id="3417157">&gt;=</span>&nbsp;<span class="num" id="3417160">0</span>&nbsp;<span class="op" id="3417162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417167">if</span>&nbsp;<span class="num" id="3417170">2</span><span class="op" id="3417171">*</span><span class="ident" id="3417172">num</span><span class="op" id="3417175">+</span><span class="num" id="3417176">1</span>&nbsp;<span class="op" id="3417178">&lt;</span>&nbsp;<span class="builtinfunc" id="3417180">len</span><span class="op" id="3417183">(</span><span class="ident" id="3417184">match</span><span class="op" id="3417189">)</span>&nbsp;<span class="op" id="3417191">&amp;&amp;</span>&nbsp;<span class="ident" id="3417194">match</span><span class="op" id="3417199">[</span><span class="num" id="3417200">2</span><span class="op" id="3417201">*</span><span class="ident" id="3417202">num</span><span class="op" id="3417205">]</span>&nbsp;<span class="op" id="3417207">&gt;=</span>&nbsp;<span class="num" id="3417210">0</span>&nbsp;<span class="op" id="3417212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417218">if</span>&nbsp;<span class="ident" id="3417221">bsrc</span>&nbsp;<span class="op" id="3417226">!=</span>&nbsp;<span class="ident" id="3417229">nil</span>&nbsp;<span class="op" id="3417233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417240">dst</span>&nbsp;<span class="op" id="3417244">=</span>&nbsp;<span class="builtinfunc" id="3417246">append</span><span class="op" id="3417252">(</span><span class="ident" id="3417253">dst</span><span class="op" id="3417256">,</span>&nbsp;<span class="ident" id="3417258">bsrc</span><span class="op" id="3417262">[</span><span class="ident" id="3417263">match</span><span class="op" id="3417268">[</span><span class="num" id="3417269">2</span><span class="op" id="3417270">*</span><span class="ident" id="3417271">num</span><span class="op" id="3417274">]</span><span class="op" id="3417275">:</span><span class="ident" id="3417276">match</span><span class="op" id="3417281">[</span><span class="num" id="3417282">2</span><span class="op" id="3417283">*</span><span class="ident" id="3417284">num</span><span class="op" id="3417287">+</span><span class="num" id="3417288">1</span><span class="op" id="3417289">]</span><span class="op" id="3417290">]</span><span class="op" id="3417291">...</span><span class="op" id="3417294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417300">}</span>&nbsp;<span class="keyword" id="3417302">else</span>&nbsp;<span class="op" id="3417307">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417314">dst</span>&nbsp;<span class="op" id="3417318">=</span>&nbsp;<span class="builtinfunc" id="3417320">append</span><span class="op" id="3417326">(</span><span class="ident" id="3417327">dst</span><span class="op" id="3417330">,</span>&nbsp;<span class="ident" id="3417332">src</span><span class="op" id="3417335">[</span><span class="ident" id="3417336">match</span><span class="op" id="3417341">[</span><span class="num" id="3417342">2</span><span class="op" id="3417343">*</span><span class="ident" id="3417344">num</span><span class="op" id="3417347">]</span><span class="op" id="3417348">:</span><span class="ident" id="3417349">match</span><span class="op" id="3417354">[</span><span class="num" id="3417355">2</span><span class="op" id="3417356">*</span><span class="ident" id="3417357">num</span><span class="op" id="3417360">+</span><span class="num" id="3417361">1</span><span class="op" id="3417362">]</span><span class="op" id="3417363">]</span><span class="op" id="3417364">...</span><span class="op" id="3417367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417382">}</span>&nbsp;<span class="keyword" id="3417384">else</span>&nbsp;<span class="op" id="3417389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417394">for</span>&nbsp;<span class="ident" id="3417398">i</span><span class="op" id="3417399">,</span>&nbsp;<span class="ident" id="3417401">namei</span>&nbsp;<span class="op" id="3417407">:=</span>&nbsp;<span class="keyword" id="3417410">range</span>&nbsp;<span class="ident" id="3417416">re</span><span class="op" id="3417418">.</span><span class="ident" id="3417419">subexpNames</span>&nbsp;<span class="op" id="3417431">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417437">if</span>&nbsp;<span class="ident" id="3417440">name</span>&nbsp;<span class="op" id="3417445">==</span>&nbsp;<span class="ident" id="3417448">namei</span>&nbsp;<span class="op" id="3417454">&amp;&amp;</span>&nbsp;<span class="num" id="3417457">2</span><span class="op" id="3417458">*</span><span class="ident" id="3417459">i</span><span class="op" id="3417460">+</span><span class="num" id="3417461">1</span>&nbsp;<span class="op" id="3417463">&lt;</span>&nbsp;<span class="builtinfunc" id="3417465">len</span><span class="op" id="3417468">(</span><span class="ident" id="3417469">match</span><span class="op" id="3417474">)</span>&nbsp;<span class="op" id="3417476">&amp;&amp;</span>&nbsp;<span class="ident" id="3417479">match</span><span class="op" id="3417484">[</span><span class="num" id="3417485">2</span><span class="op" id="3417486">*</span><span class="ident" id="3417487">i</span><span class="op" id="3417488">]</span>&nbsp;<span class="op" id="3417490">&gt;=</span>&nbsp;<span class="num" id="3417493">0</span>&nbsp;<span class="op" id="3417495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417502">if</span>&nbsp;<span class="ident" id="3417505">bsrc</span>&nbsp;<span class="op" id="3417510">!=</span>&nbsp;<span class="ident" id="3417513">nil</span>&nbsp;<span class="op" id="3417517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417525">dst</span>&nbsp;<span class="op" id="3417529">=</span>&nbsp;<span class="builtinfunc" id="3417531">append</span><span class="op" id="3417537">(</span><span class="ident" id="3417538">dst</span><span class="op" id="3417541">,</span>&nbsp;<span class="ident" id="3417543">bsrc</span><span class="op" id="3417547">[</span><span class="ident" id="3417548">match</span><span class="op" id="3417553">[</span><span class="num" id="3417554">2</span><span class="op" id="3417555">*</span><span class="ident" id="3417556">i</span><span class="op" id="3417557">]</span><span class="op" id="3417558">:</span><span class="ident" id="3417559">match</span><span class="op" id="3417564">[</span><span class="num" id="3417565">2</span><span class="op" id="3417566">*</span><span class="ident" id="3417567">i</span><span class="op" id="3417568">+</span><span class="num" id="3417569">1</span><span class="op" id="3417570">]</span><span class="op" id="3417571">]</span><span class="op" id="3417572">...</span><span class="op" id="3417575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417582">}</span>&nbsp;<span class="keyword" id="3417584">else</span>&nbsp;<span class="op" id="3417589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417597">dst</span>&nbsp;<span class="op" id="3417601">=</span>&nbsp;<span class="builtinfunc" id="3417603">append</span><span class="op" id="3417609">(</span><span class="ident" id="3417610">dst</span><span class="op" id="3417613">,</span>&nbsp;<span class="ident" id="3417615">src</span><span class="op" id="3417618">[</span><span class="ident" id="3417619">match</span><span class="op" id="3417624">[</span><span class="num" id="3417625">2</span><span class="op" id="3417626">*</span><span class="ident" id="3417627">i</span><span class="op" id="3417628">]</span><span class="op" id="3417629">:</span><span class="ident" id="3417630">match</span><span class="op" id="3417635">[</span><span class="num" id="3417636">2</span><span class="op" id="3417637">*</span><span class="ident" id="3417638">i</span><span class="op" id="3417639">+</span><span class="num" id="3417640">1</span><span class="op" id="3417641">]</span><span class="op" id="3417642">]</span><span class="op" id="3417643">...</span><span class="op" id="3417646">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417660">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417679">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417685">dst</span>&nbsp;<span class="op" id="3417689">=</span>&nbsp;<span class="builtinfunc" id="3417691">append</span><span class="op" id="3417697">(</span><span class="ident" id="3417698">dst</span><span class="op" id="3417701">,</span>&nbsp;<span class="ident" id="3417703">template</span><span class="op" id="3417711">...</span><span class="op" id="3417714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417717">return</span>&nbsp;<span class="ident" id="3417724">dst</span><br>
<span class="lineno"></span><span class="op" id="3417728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span><span class="comment" id="3417731">//&nbsp;extract&nbsp;returns&nbsp;the&nbsp;name&nbsp;from&nbsp;a&nbsp;leading&nbsp;&#34;$name&#34;&nbsp;or&nbsp;&#34;${name}&#34;&nbsp;in&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="3417803">//&nbsp;If&nbsp;it&nbsp;is&nbsp;a&nbsp;number,&nbsp;extract&nbsp;returns&nbsp;num&nbsp;set&nbsp;to&nbsp;that&nbsp;number;&nbsp;otherwise&nbsp;num&nbsp;=&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="3417885">func</span>&nbsp;<span class="ident" id="3417890">extract</span><span class="op" id="3417897">(</span><span class="ident" id="3417898">str</span>&nbsp;<span class="builtintype" id="3417902">string</span><span class="op" id="3417908">)</span>&nbsp;<span class="op" id="3417910">(</span><span class="ident" id="3417911">name</span>&nbsp;<span class="builtintype" id="3417916">string</span><span class="op" id="3417922">,</span>&nbsp;<span class="ident" id="3417924">num</span>&nbsp;<span class="builtintype" id="3417928">int</span><span class="op" id="3417931">,</span>&nbsp;<span class="ident" id="3417933">rest</span>&nbsp;<span class="builtintype" id="3417938">string</span><span class="op" id="3417944">,</span>&nbsp;<span class="ident" id="3417946">ok</span>&nbsp;<span class="builtintype" id="3417949">bool</span><span class="op" id="3417953">)</span>&nbsp;<span class="op" id="3417955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417958">if</span>&nbsp;<span class="builtinfunc" id="3417961">len</span><span class="op" id="3417964">(</span><span class="ident" id="3417965">str</span><span class="op" id="3417968">)</span>&nbsp;<span class="op" id="3417970">&lt;</span>&nbsp;<span class="num" id="3417972">2</span>&nbsp;<span class="op" id="3417974">||</span>&nbsp;<span class="ident" id="3417977">str</span><span class="op" id="3417980">[</span><span class="num" id="3417981">0</span><span class="op" id="3417982">]</span>&nbsp;<span class="op" id="3417984">!=</span>&nbsp;<span class="string" id="3417987">&#39;$&#39;</span>&nbsp;<span class="op" id="3417991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417995">return</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418006">brace</span>&nbsp;<span class="op" id="3418012">:=</span>&nbsp;<span class="builtintype" id="3418015">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418022">if</span>&nbsp;<span class="ident" id="3418025">str</span><span class="op" id="3418028">[</span><span class="num" id="3418029">1</span><span class="op" id="3418030">]</span>&nbsp;<span class="op" id="3418032">==</span>&nbsp;<span class="string" id="3418035">&#39;{&#39;</span>&nbsp;<span class="op" id="3418039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418043">brace</span>&nbsp;<span class="op" id="3418049">=</span>&nbsp;<span class="builtintype" id="3418051">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418058">str</span>&nbsp;<span class="op" id="3418062">=</span>&nbsp;<span class="ident" id="3418064">str</span><span class="op" id="3418067">[</span><span class="num" id="3418068">2</span><span class="op" id="3418069">:</span><span class="op" id="3418070">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418073">}</span>&nbsp;<span class="keyword" id="3418075">else</span>&nbsp;<span class="op" id="3418080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418084">str</span>&nbsp;<span class="op" id="3418088">=</span>&nbsp;<span class="ident" id="3418090">str</span><span class="op" id="3418093">[</span><span class="num" id="3418094">1</span><span class="op" id="3418095">:</span><span class="op" id="3418096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418102">i</span>&nbsp;<span class="op" id="3418104">:=</span>&nbsp;<span class="num" id="3418107">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418110">for</span>&nbsp;<span class="ident" id="3418114">i</span>&nbsp;<span class="op" id="3418116">&lt;</span>&nbsp;<span class="builtinfunc" id="3418118">len</span><span class="op" id="3418121">(</span><span class="ident" id="3418122">str</span><span class="op" id="3418125">)</span>&nbsp;<span class="op" id="3418127">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3418131">rune</span><span class="op" id="3418135">,</span>&nbsp;<span class="ident" id="3418137">size</span>&nbsp;<span class="op" id="3418142">:=</span>&nbsp;<span class="ident" id="3418145">utf8</span><span class="op" id="3418149">.</span><span class="ident" id="3418150">DecodeRuneInString</span><span class="op" id="3418168">(</span><span class="ident" id="3418169">str</span><span class="op" id="3418172">[</span><span class="ident" id="3418173">i</span><span class="op" id="3418174">:</span><span class="op" id="3418175">]</span><span class="op" id="3418176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418180">if</span>&nbsp;<span class="op" id="3418183">!</span><span class="ident" id="3418184">unicode</span><span class="op" id="3418191">.</span><span class="ident" id="3418192">IsLetter</span><span class="op" id="3418200">(</span><span class="builtintype" id="3418201">rune</span><span class="op" id="3418205">)</span>&nbsp;<span class="op" id="3418207">&amp;&amp;</span>&nbsp;<span class="op" id="3418210">!</span><span class="ident" id="3418211">unicode</span><span class="op" id="3418218">.</span><span class="ident" id="3418219">IsDigit</span><span class="op" id="3418226">(</span><span class="builtintype" id="3418227">rune</span><span class="op" id="3418231">)</span>&nbsp;<span class="op" id="3418233">&amp;&amp;</span>&nbsp;<span class="builtintype" id="3418236">rune</span>&nbsp;<span class="op" id="3418241">!=</span>&nbsp;<span class="string" id="3418244">&#39;_&#39;</span>&nbsp;<span class="op" id="3418248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418253">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418265">i</span>&nbsp;<span class="op" id="3418267">+=</span>&nbsp;<span class="ident" id="3418270">size</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418279">if</span>&nbsp;<span class="ident" id="3418282">i</span>&nbsp;<span class="op" id="3418284">==</span>&nbsp;<span class="num" id="3418287">0</span>&nbsp;<span class="op" id="3418289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418293">//&nbsp;empty&nbsp;name&nbsp;is&nbsp;not&nbsp;okay</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418321">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418329">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418332">name</span>&nbsp;<span class="op" id="3418337">=</span>&nbsp;<span class="ident" id="3418339">str</span><span class="op" id="3418342">[</span><span class="op" id="3418343">:</span><span class="ident" id="3418344">i</span><span class="op" id="3418345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418348">if</span>&nbsp;<span class="ident" id="3418351">brace</span>&nbsp;<span class="op" id="3418357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418361">if</span>&nbsp;<span class="ident" id="3418364">i</span>&nbsp;<span class="op" id="3418366">&gt;=</span>&nbsp;<span class="builtinfunc" id="3418369">len</span><span class="op" id="3418372">(</span><span class="ident" id="3418373">str</span><span class="op" id="3418376">)</span>&nbsp;<span class="op" id="3418378">||</span>&nbsp;<span class="ident" id="3418381">str</span><span class="op" id="3418384">[</span><span class="ident" id="3418385">i</span><span class="op" id="3418386">]</span>&nbsp;<span class="op" id="3418388">!=</span>&nbsp;<span class="string" id="3418391">&#39;}&#39;</span>&nbsp;<span class="op" id="3418395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418400">//&nbsp;missing&nbsp;closing&nbsp;brace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418428">return</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418441">i</span><span class="op" id="3418442">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418450">//&nbsp;Parse&nbsp;number.</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418468">num</span>&nbsp;<span class="op" id="3418472">=</span>&nbsp;<span class="num" id="3418474">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418477">for</span>&nbsp;<span class="ident" id="3418481">i</span>&nbsp;<span class="op" id="3418483">:=</span>&nbsp;<span class="num" id="3418486">0</span><span class="op" id="3418487">;</span>&nbsp;<span class="ident" id="3418489">i</span>&nbsp;<span class="op" id="3418491">&lt;</span>&nbsp;<span class="builtinfunc" id="3418493">len</span><span class="op" id="3418496">(</span><span class="ident" id="3418497">name</span><span class="op" id="3418501">)</span><span class="op" id="3418502">;</span>&nbsp;<span class="ident" id="3418504">i</span><span class="op" id="3418505">++</span>&nbsp;<span class="op" id="3418508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418512">if</span>&nbsp;<span class="ident" id="3418515">name</span><span class="op" id="3418519">[</span><span class="ident" id="3418520">i</span><span class="op" id="3418521">]</span>&nbsp;<span class="op" id="3418523">&lt;</span>&nbsp;<span class="string" id="3418525">&#39;0&#39;</span>&nbsp;<span class="op" id="3418529">||</span>&nbsp;<span class="string" id="3418532">&#39;9&#39;</span>&nbsp;<span class="op" id="3418536">&lt;</span>&nbsp;<span class="ident" id="3418538">name</span><span class="op" id="3418542">[</span><span class="ident" id="3418543">i</span><span class="op" id="3418544">]</span>&nbsp;<span class="op" id="3418546">||</span>&nbsp;<span class="ident" id="3418549">num</span>&nbsp;<span class="op" id="3418553">&gt;=</span>&nbsp;<span class="num" id="3418556">1e8</span>&nbsp;<span class="op" id="3418560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418565">num</span>&nbsp;<span class="op" id="3418569">=</span>&nbsp;<span class="op" id="3418571">-</span><span class="num" id="3418572">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418577">break</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418589">num</span>&nbsp;<span class="op" id="3418593">=</span>&nbsp;<span class="ident" id="3418595">num</span><span class="op" id="3418598">*</span><span class="num" id="3418599">10</span>&nbsp;<span class="op" id="3418602">+</span>&nbsp;<span class="builtintype" id="3418604">int</span><span class="op" id="3418607">(</span><span class="ident" id="3418608">name</span><span class="op" id="3418612">[</span><span class="ident" id="3418613">i</span><span class="op" id="3418614">]</span><span class="op" id="3418615">)</span>&nbsp;<span class="op" id="3418617">-</span>&nbsp;<span class="string" id="3418619">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3418627">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418655">if</span>&nbsp;<span class="ident" id="3418658">name</span><span class="op" id="3418662">[</span><span class="num" id="3418663">0</span><span class="op" id="3418664">]</span>&nbsp;<span class="op" id="3418666">==</span>&nbsp;<span class="string" id="3418669">&#39;0&#39;</span>&nbsp;<span class="op" id="3418673">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3418676">len</span><span class="op" id="3418679">(</span><span class="ident" id="3418680">name</span><span class="op" id="3418684">)</span>&nbsp;<span class="op" id="3418686">&gt;</span>&nbsp;<span class="num" id="3418688">1</span>&nbsp;<span class="op" id="3418690">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418694">num</span>&nbsp;<span class="op" id="3418698">=</span>&nbsp;<span class="op" id="3418700">-</span><span class="num" id="3418701">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418708">rest</span>&nbsp;<span class="op" id="3418713">=</span>&nbsp;<span class="ident" id="3418715">str</span><span class="op" id="3418718">[</span><span class="ident" id="3418719">i</span><span class="op" id="3418720">:</span><span class="op" id="3418721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418724">ok</span>&nbsp;<span class="op" id="3418727">=</span>&nbsp;<span class="builtintype" id="3418729">true</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418735">return</span><br>
<span class="lineno"></span><span class="op" id="3418742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3418745">//&nbsp;FindSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs&nbsp;identifying&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3418822">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;b&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno">870</span><span class="comment" id="3418899">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions</span><br>
<span class="lineno"></span><span class="comment" id="3418976">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3419003">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3419048">func</span>&nbsp;<span class="op" id="3419053">(</span><span class="ident" id="3419054">re</span>&nbsp;<span class="op" id="3419057">*</span><span class="ident" id="3419058">Regexp</span><span class="op" id="3419064">)</span>&nbsp;<span class="ident" id="3419066">FindSubmatchIndex</span><span class="op" id="3419083">(</span><span class="ident" id="3419084">b</span>&nbsp;<span class="op" id="3419086">[</span><span class="op" id="3419087">]</span><span class="builtintype" id="3419088">byte</span><span class="op" id="3419092">)</span>&nbsp;<span class="op" id="3419094">[</span><span class="op" id="3419095">]</span><span class="builtintype" id="3419096">int</span>&nbsp;<span class="op" id="3419100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419103">return</span>&nbsp;<span class="ident" id="3419110">re</span><span class="op" id="3419112">.</span><span class="ident" id="3419113">pad</span><span class="op" id="3419116">(</span><span class="ident" id="3419117">re</span><span class="op" id="3419119">.</span><span class="ident" id="3419120">doExecute</span><span class="op" id="3419129">(</span><span class="ident" id="3419130">nil</span><span class="op" id="3419133">,</span>&nbsp;<span class="ident" id="3419135">b</span><span class="op" id="3419136">,</span>&nbsp;<span class="string" id="3419138">&#34;&#34;</span><span class="op" id="3419140">,</span>&nbsp;<span class="num" id="3419142">0</span><span class="op" id="3419143">,</span>&nbsp;<span class="ident" id="3419145">re</span><span class="op" id="3419147">.</span><span class="ident" id="3419148">prog</span><span class="op" id="3419152">.</span><span class="ident" id="3419153">NumCap</span><span class="op" id="3419159">)</span><span class="op" id="3419160">)</span><br>
<span class="lineno">875</span><span class="op" id="3419162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3419165">//&nbsp;FindStringSubmatch&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;holding&nbsp;the&nbsp;text&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3419238">//&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3419315">//&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno">880</span><span class="comment" id="3419386">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3419406">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3419451">func</span>&nbsp;<span class="op" id="3419456">(</span><span class="ident" id="3419457">re</span>&nbsp;<span class="op" id="3419460">*</span><span class="ident" id="3419461">Regexp</span><span class="op" id="3419467">)</span>&nbsp;<span class="ident" id="3419469">FindStringSubmatch</span><span class="op" id="3419487">(</span><span class="ident" id="3419488">s</span>&nbsp;<span class="builtintype" id="3419490">string</span><span class="op" id="3419496">)</span>&nbsp;<span class="op" id="3419498">[</span><span class="op" id="3419499">]</span><span class="builtintype" id="3419500">string</span>&nbsp;<span class="op" id="3419507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419510">a</span>&nbsp;<span class="op" id="3419512">:=</span>&nbsp;<span class="ident" id="3419515">re</span><span class="op" id="3419517">.</span><span class="ident" id="3419518">doExecute</span><span class="op" id="3419527">(</span><span class="ident" id="3419528">nil</span><span class="op" id="3419531">,</span>&nbsp;<span class="ident" id="3419533">nil</span><span class="op" id="3419536">,</span>&nbsp;<span class="ident" id="3419538">s</span><span class="op" id="3419539">,</span>&nbsp;<span class="num" id="3419541">0</span><span class="op" id="3419542">,</span>&nbsp;<span class="ident" id="3419544">re</span><span class="op" id="3419546">.</span><span class="ident" id="3419547">prog</span><span class="op" id="3419551">.</span><span class="ident" id="3419552">NumCap</span><span class="op" id="3419558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419561">if</span>&nbsp;<span class="ident" id="3419564">a</span>&nbsp;<span class="op" id="3419566">==</span>&nbsp;<span class="ident" id="3419569">nil</span>&nbsp;<span class="op" id="3419573">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419577">return</span>&nbsp;<span class="ident" id="3419584">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419592">ret</span>&nbsp;<span class="op" id="3419596">:=</span>&nbsp;<span class="builtinfunc" id="3419599">make</span><span class="op" id="3419603">(</span><span class="op" id="3419604">[</span><span class="op" id="3419605">]</span><span class="builtintype" id="3419606">string</span><span class="op" id="3419612">,</span>&nbsp;<span class="num" id="3419614">1</span><span class="op" id="3419615">+</span><span class="ident" id="3419616">re</span><span class="op" id="3419618">.</span><span class="ident" id="3419619">numSubexp</span><span class="op" id="3419628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419631">for</span>&nbsp;<span class="ident" id="3419635">i</span>&nbsp;<span class="op" id="3419637">:=</span>&nbsp;<span class="keyword" id="3419640">range</span>&nbsp;<span class="ident" id="3419646">ret</span>&nbsp;<span class="op" id="3419650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419654">if</span>&nbsp;<span class="num" id="3419657">2</span><span class="op" id="3419658">*</span><span class="ident" id="3419659">i</span>&nbsp;<span class="op" id="3419661">&lt;</span>&nbsp;<span class="builtinfunc" id="3419663">len</span><span class="op" id="3419666">(</span><span class="ident" id="3419667">a</span><span class="op" id="3419668">)</span>&nbsp;<span class="op" id="3419670">&amp;&amp;</span>&nbsp;<span class="ident" id="3419673">a</span><span class="op" id="3419674">[</span><span class="num" id="3419675">2</span><span class="op" id="3419676">*</span><span class="ident" id="3419677">i</span><span class="op" id="3419678">]</span>&nbsp;<span class="op" id="3419680">&gt;=</span>&nbsp;<span class="num" id="3419683">0</span>&nbsp;<span class="op" id="3419685">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419690">ret</span><span class="op" id="3419693">[</span><span class="ident" id="3419694">i</span><span class="op" id="3419695">]</span>&nbsp;<span class="op" id="3419697">=</span>&nbsp;<span class="ident" id="3419699">s</span><span class="op" id="3419700">[</span><span class="ident" id="3419701">a</span><span class="op" id="3419702">[</span><span class="num" id="3419703">2</span><span class="op" id="3419704">*</span><span class="ident" id="3419705">i</span><span class="op" id="3419706">]</span><span class="op" id="3419707">:</span><span class="ident" id="3419708">a</span><span class="op" id="3419709">[</span><span class="num" id="3419710">2</span><span class="op" id="3419711">*</span><span class="ident" id="3419712">i</span><span class="op" id="3419713">+</span><span class="num" id="3419714">1</span><span class="op" id="3419715">]</span><span class="op" id="3419716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419726">return</span>&nbsp;<span class="ident" id="3419733">ret</span><br>
<span class="lineno"></span><span class="op" id="3419737">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span><span class="comment" id="3419740">//&nbsp;FindStringSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3419807">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3419880">//&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3419956">//&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">900</span><span class="comment" id="3420004">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3420049">func</span>&nbsp;<span class="op" id="3420054">(</span><span class="ident" id="3420055">re</span>&nbsp;<span class="op" id="3420058">*</span><span class="ident" id="3420059">Regexp</span><span class="op" id="3420065">)</span>&nbsp;<span class="ident" id="3420067">FindStringSubmatchIndex</span><span class="op" id="3420090">(</span><span class="ident" id="3420091">s</span>&nbsp;<span class="builtintype" id="3420093">string</span><span class="op" id="3420099">)</span>&nbsp;<span class="op" id="3420101">[</span><span class="op" id="3420102">]</span><span class="builtintype" id="3420103">int</span>&nbsp;<span class="op" id="3420107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420110">return</span>&nbsp;<span class="ident" id="3420117">re</span><span class="op" id="3420119">.</span><span class="ident" id="3420120">pad</span><span class="op" id="3420123">(</span><span class="ident" id="3420124">re</span><span class="op" id="3420126">.</span><span class="ident" id="3420127">doExecute</span><span class="op" id="3420136">(</span><span class="ident" id="3420137">nil</span><span class="op" id="3420140">,</span>&nbsp;<span class="ident" id="3420142">nil</span><span class="op" id="3420145">,</span>&nbsp;<span class="ident" id="3420147">s</span><span class="op" id="3420148">,</span>&nbsp;<span class="num" id="3420150">0</span><span class="op" id="3420151">,</span>&nbsp;<span class="ident" id="3420153">re</span><span class="op" id="3420155">.</span><span class="ident" id="3420156">prog</span><span class="op" id="3420160">.</span><span class="ident" id="3420161">NumCap</span><span class="op" id="3420167">)</span><span class="op" id="3420168">)</span><br>
<span class="lineno"></span><span class="op" id="3420170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="3420173">//&nbsp;FindReaderSubmatchIndex&nbsp;returns&nbsp;a&nbsp;slice&nbsp;holding&nbsp;the&nbsp;index&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="3420240">//&nbsp;identifying&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;of&nbsp;the&nbsp;regular&nbsp;expression&nbsp;of&nbsp;text&nbsp;read&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3420316">//&nbsp;the&nbsp;RuneReader,&nbsp;and&nbsp;the&nbsp;matches,&nbsp;if&nbsp;any,&nbsp;of&nbsp;its&nbsp;subexpressions,&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="3420394">//&nbsp;by&nbsp;the&nbsp;&#39;Submatch&#39;&nbsp;and&nbsp;&#39;Index&#39;&nbsp;descriptions&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment" id="3420467">//&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">910</span><span class="keyword" id="3420510">func</span>&nbsp;<span class="op" id="3420515">(</span><span class="ident" id="3420516">re</span>&nbsp;<span class="op" id="3420519">*</span><span class="ident" id="3420520">Regexp</span><span class="op" id="3420526">)</span>&nbsp;<span class="ident" id="3420528">FindReaderSubmatchIndex</span><span class="op" id="3420551">(</span><span class="ident" id="3420552">r</span>&nbsp;<span class="ident" id="3420554">io</span><span class="op" id="3420556">.</span><span class="ident" id="3420557">RuneReader</span><span class="op" id="3420567">)</span>&nbsp;<span class="op" id="3420569">[</span><span class="op" id="3420570">]</span><span class="builtintype" id="3420571">int</span>&nbsp;<span class="op" id="3420575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420578">return</span>&nbsp;<span class="ident" id="3420585">re</span><span class="op" id="3420587">.</span><span class="ident" id="3420588">pad</span><span class="op" id="3420591">(</span><span class="ident" id="3420592">re</span><span class="op" id="3420594">.</span><span class="ident" id="3420595">doExecute</span><span class="op" id="3420604">(</span><span class="ident" id="3420605">r</span><span class="op" id="3420606">,</span>&nbsp;<span class="ident" id="3420608">nil</span><span class="op" id="3420611">,</span>&nbsp;<span class="string" id="3420613">&#34;&#34;</span><span class="op" id="3420615">,</span>&nbsp;<span class="num" id="3420617">0</span><span class="op" id="3420618">,</span>&nbsp;<span class="ident" id="3420620">re</span><span class="op" id="3420622">.</span><span class="ident" id="3420623">prog</span><span class="op" id="3420627">.</span><span class="ident" id="3420628">NumCap</span><span class="op" id="3420634">)</span><span class="op" id="3420635">)</span><br>
<span class="lineno"></span><span class="op" id="3420637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3420640">const</span>&nbsp;<span class="ident" id="3420646">startSize</span>&nbsp;<span class="op" id="3420656">=</span>&nbsp;<span class="num" id="3420658">10</span>&nbsp;<span class="comment" id="3420661">//&nbsp;The&nbsp;size&nbsp;at&nbsp;which&nbsp;to&nbsp;start&nbsp;a&nbsp;slice&nbsp;in&nbsp;the&nbsp;&#39;All&#39;&nbsp;routines.</span><br>
<span class="lineno">915</span><br>
<span class="lineno"></span><span class="comment" id="3420723">//&nbsp;FindAll&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;Find;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive</span><br>
<span class="lineno"></span><span class="comment" id="3420801">//&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3420874">//&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3420894">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno">920</span><span class="keyword" id="3420939">func</span>&nbsp;<span class="op" id="3420944">(</span><span class="ident" id="3420945">re</span>&nbsp;<span class="op" id="3420948">*</span><span class="ident" id="3420949">Regexp</span><span class="op" id="3420955">)</span>&nbsp;<span class="ident" id="3420957">FindAll</span><span class="op" id="3420964">(</span><span class="ident" id="3420965">b</span>&nbsp;<span class="op" id="3420967">[</span><span class="op" id="3420968">]</span><span class="builtintype" id="3420969">byte</span><span class="op" id="3420973">,</span>&nbsp;<span class="ident" id="3420975">n</span>&nbsp;<span class="builtintype" id="3420977">int</span><span class="op" id="3420980">)</span>&nbsp;<span class="op" id="3420982">[</span><span class="op" id="3420983">]</span><span class="op" id="3420984">[</span><span class="op" id="3420985">]</span><span class="builtintype" id="3420986">byte</span>&nbsp;<span class="op" id="3420991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3420994">if</span>&nbsp;<span class="ident" id="3420997">n</span>&nbsp;<span class="op" id="3420999">&lt;</span>&nbsp;<span class="num" id="3421001">0</span>&nbsp;<span class="op" id="3421003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421007">n</span>&nbsp;<span class="op" id="3421009">=</span>&nbsp;<span class="builtinfunc" id="3421011">len</span><span class="op" id="3421014">(</span><span class="ident" id="3421015">b</span><span class="op" id="3421016">)</span>&nbsp;<span class="op" id="3421018">+</span>&nbsp;<span class="num" id="3421020">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421026">result</span>&nbsp;<span class="op" id="3421033">:=</span>&nbsp;<span class="builtinfunc" id="3421036">make</span><span class="op" id="3421040">(</span><span class="op" id="3421041">[</span><span class="op" id="3421042">]</span><span class="op" id="3421043">[</span><span class="op" id="3421044">]</span><span class="builtintype" id="3421045">byte</span><span class="op" id="3421049">,</span>&nbsp;<span class="num" id="3421051">0</span><span class="op" id="3421052">,</span>&nbsp;<span class="ident" id="3421054">startSize</span><span class="op" id="3421063">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421066">re</span><span class="op" id="3421068">.</span><span class="ident" id="3421069">allMatches</span><span class="op" id="3421079">(</span><span class="string" id="3421080">&#34;&#34;</span><span class="op" id="3421082">,</span>&nbsp;<span class="ident" id="3421084">b</span><span class="op" id="3421085">,</span>&nbsp;<span class="ident" id="3421087">n</span><span class="op" id="3421088">,</span>&nbsp;<span class="keyword" id="3421090">func</span><span class="op" id="3421094">(</span><span class="ident" id="3421095">match</span>&nbsp;<span class="op" id="3421101">[</span><span class="op" id="3421102">]</span><span class="builtintype" id="3421103">int</span><span class="op" id="3421106">)</span>&nbsp;<span class="op" id="3421108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421112">result</span>&nbsp;<span class="op" id="3421119">=</span>&nbsp;<span class="builtinfunc" id="3421121">append</span><span class="op" id="3421127">(</span><span class="ident" id="3421128">result</span><span class="op" id="3421134">,</span>&nbsp;<span class="ident" id="3421136">b</span><span class="op" id="3421137">[</span><span class="ident" id="3421138">match</span><span class="op" id="3421143">[</span><span class="num" id="3421144">0</span><span class="op" id="3421145">]</span><span class="op" id="3421146">:</span><span class="ident" id="3421147">match</span><span class="op" id="3421152">[</span><span class="num" id="3421153">1</span><span class="op" id="3421154">]</span><span class="op" id="3421155">]</span><span class="op" id="3421156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421159">}</span><span class="op" id="3421160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421163">if</span>&nbsp;<span class="builtinfunc" id="3421166">len</span><span class="op" id="3421169">(</span><span class="ident" id="3421170">result</span><span class="op" id="3421176">)</span>&nbsp;<span class="op" id="3421178">==</span>&nbsp;<span class="num" id="3421181">0</span>&nbsp;<span class="op" id="3421183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421187">return</span>&nbsp;<span class="ident" id="3421194">nil</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421202">return</span>&nbsp;<span class="ident" id="3421209">result</span><br>
<span class="lineno"></span><span class="op" id="3421216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3421219">//&nbsp;FindAllIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno">935</span><span class="comment" id="3421296">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3421373">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3421400">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3421445">func</span>&nbsp;<span class="op" id="3421450">(</span><span class="ident" id="3421451">re</span>&nbsp;<span class="op" id="3421454">*</span><span class="ident" id="3421455">Regexp</span><span class="op" id="3421461">)</span>&nbsp;<span class="ident" id="3421463">FindAllIndex</span><span class="op" id="3421475">(</span><span class="ident" id="3421476">b</span>&nbsp;<span class="op" id="3421478">[</span><span class="op" id="3421479">]</span><span class="builtintype" id="3421480">byte</span><span class="op" id="3421484">,</span>&nbsp;<span class="ident" id="3421486">n</span>&nbsp;<span class="builtintype" id="3421488">int</span><span class="op" id="3421491">)</span>&nbsp;<span class="op" id="3421493">[</span><span class="op" id="3421494">]</span><span class="op" id="3421495">[</span><span class="op" id="3421496">]</span><span class="builtintype" id="3421497">int</span>&nbsp;<span class="op" id="3421501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421504">if</span>&nbsp;<span class="ident" id="3421507">n</span>&nbsp;<span class="op" id="3421509">&lt;</span>&nbsp;<span class="num" id="3421511">0</span>&nbsp;<span class="op" id="3421513">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421517">n</span>&nbsp;<span class="op" id="3421519">=</span>&nbsp;<span class="builtinfunc" id="3421521">len</span><span class="op" id="3421524">(</span><span class="ident" id="3421525">b</span><span class="op" id="3421526">)</span>&nbsp;<span class="op" id="3421528">+</span>&nbsp;<span class="num" id="3421530">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421536">result</span>&nbsp;<span class="op" id="3421543">:=</span>&nbsp;<span class="builtinfunc" id="3421546">make</span><span class="op" id="3421550">(</span><span class="op" id="3421551">[</span><span class="op" id="3421552">]</span><span class="op" id="3421553">[</span><span class="op" id="3421554">]</span><span class="builtintype" id="3421555">int</span><span class="op" id="3421558">,</span>&nbsp;<span class="num" id="3421560">0</span><span class="op" id="3421561">,</span>&nbsp;<span class="ident" id="3421563">startSize</span><span class="op" id="3421572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421575">re</span><span class="op" id="3421577">.</span><span class="ident" id="3421578">allMatches</span><span class="op" id="3421588">(</span><span class="string" id="3421589">&#34;&#34;</span><span class="op" id="3421591">,</span>&nbsp;<span class="ident" id="3421593">b</span><span class="op" id="3421594">,</span>&nbsp;<span class="ident" id="3421596">n</span><span class="op" id="3421597">,</span>&nbsp;<span class="keyword" id="3421599">func</span><span class="op" id="3421603">(</span><span class="ident" id="3421604">match</span>&nbsp;<span class="op" id="3421610">[</span><span class="op" id="3421611">]</span><span class="builtintype" id="3421612">int</span><span class="op" id="3421615">)</span>&nbsp;<span class="op" id="3421617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3421621">result</span>&nbsp;<span class="op" id="3421628">=</span>&nbsp;<span class="builtinfunc" id="3421630">append</span><span class="op" id="3421636">(</span><span class="ident" id="3421637">result</span><span class="op" id="3421643">,</span>&nbsp;<span class="ident" id="3421645">match</span><span class="op" id="3421650">[</span><span class="num" id="3421651">0</span><span class="op" id="3421652">:</span><span class="num" id="3421653">2</span><span class="op" id="3421654">]</span><span class="op" id="3421655">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421658">}</span><span class="op" id="3421659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421662">if</span>&nbsp;<span class="builtinfunc" id="3421665">len</span><span class="op" id="3421668">(</span><span class="ident" id="3421669">result</span><span class="op" id="3421675">)</span>&nbsp;<span class="op" id="3421677">==</span>&nbsp;<span class="num" id="3421680">0</span>&nbsp;<span class="op" id="3421682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421686">return</span>&nbsp;<span class="ident" id="3421693">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3421698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3421701">return</span>&nbsp;<span class="ident" id="3421708">result</span><br>
<span class="lineno">950</span><span class="op" id="3421715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3421718">//&nbsp;FindAllString&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindString;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3421797">//&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description</span><br>
<span class="lineno"></span><span class="comment" id="3421874">//&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">955</span><span class="comment" id="3421901">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3421946">func</span>&nbsp;<span class="op" id="3421951">(</span><span class="ident" id="3421952">re</span>&nbsp;<span class="op" id="3421955">*</span><span class="ident" id="3421956">Regexp</span><span class="op" id="3421962">)</span>&nbsp;<span class="ident" id="3421964">FindAllString</span><span class="op" id="3421977">(</span><span class="ident" id="3421978">s</span>&nbsp;<span class="builtintype" id="3421980">string</span><span class="op" id="3421986">,</span>&nbsp;<span class="ident" id="3421988">n</span>&nbsp;<span class="builtintype" id="3421990">int</span><span class="op" id="3421993">)</span>&nbsp;<span class="op" id="3421995">[</span><span class="op" id="3421996">]</span><span class="builtintype" id="3421997">string</span>&nbsp;<span class="op" id="3422004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422007">if</span>&nbsp;<span class="ident" id="3422010">n</span>&nbsp;<span class="op" id="3422012">&lt;</span>&nbsp;<span class="num" id="3422014">0</span>&nbsp;<span class="op" id="3422016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422020">n</span>&nbsp;<span class="op" id="3422022">=</span>&nbsp;<span class="builtinfunc" id="3422024">len</span><span class="op" id="3422027">(</span><span class="ident" id="3422028">s</span><span class="op" id="3422029">)</span>&nbsp;<span class="op" id="3422031">+</span>&nbsp;<span class="num" id="3422033">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422036">}</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422039">result</span>&nbsp;<span class="op" id="3422046">:=</span>&nbsp;<span class="builtinfunc" id="3422049">make</span><span class="op" id="3422053">(</span><span class="op" id="3422054">[</span><span class="op" id="3422055">]</span><span class="builtintype" id="3422056">string</span><span class="op" id="3422062">,</span>&nbsp;<span class="num" id="3422064">0</span><span class="op" id="3422065">,</span>&nbsp;<span class="ident" id="3422067">startSize</span><span class="op" id="3422076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422079">re</span><span class="op" id="3422081">.</span><span class="ident" id="3422082">allMatches</span><span class="op" id="3422092">(</span><span class="ident" id="3422093">s</span><span class="op" id="3422094">,</span>&nbsp;<span class="ident" id="3422096">nil</span><span class="op" id="3422099">,</span>&nbsp;<span class="ident" id="3422101">n</span><span class="op" id="3422102">,</span>&nbsp;<span class="keyword" id="3422104">func</span><span class="op" id="3422108">(</span><span class="ident" id="3422109">match</span>&nbsp;<span class="op" id="3422115">[</span><span class="op" id="3422116">]</span><span class="builtintype" id="3422117">int</span><span class="op" id="3422120">)</span>&nbsp;<span class="op" id="3422122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422126">result</span>&nbsp;<span class="op" id="3422133">=</span>&nbsp;<span class="builtinfunc" id="3422135">append</span><span class="op" id="3422141">(</span><span class="ident" id="3422142">result</span><span class="op" id="3422148">,</span>&nbsp;<span class="ident" id="3422150">s</span><span class="op" id="3422151">[</span><span class="ident" id="3422152">match</span><span class="op" id="3422157">[</span><span class="num" id="3422158">0</span><span class="op" id="3422159">]</span><span class="op" id="3422160">:</span><span class="ident" id="3422161">match</span><span class="op" id="3422166">[</span><span class="num" id="3422167">1</span><span class="op" id="3422168">]</span><span class="op" id="3422169">]</span><span class="op" id="3422170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422173">}</span><span class="op" id="3422174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422177">if</span>&nbsp;<span class="builtinfunc" id="3422180">len</span><span class="op" id="3422183">(</span><span class="ident" id="3422184">result</span><span class="op" id="3422190">)</span>&nbsp;<span class="op" id="3422192">==</span>&nbsp;<span class="num" id="3422195">0</span>&nbsp;<span class="op" id="3422197">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422201">return</span>&nbsp;<span class="ident" id="3422208">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422216">return</span>&nbsp;<span class="ident" id="3422223">result</span><br>
<span class="lineno"></span><span class="op" id="3422230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span><span class="comment" id="3422233">//&nbsp;FindAllStringIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringIndex;&nbsp;it&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3422309">//&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno"></span><span class="comment" id="3422387">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3422426">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3422471">func</span>&nbsp;<span class="op" id="3422476">(</span><span class="ident" id="3422477">re</span>&nbsp;<span class="op" id="3422480">*</span><span class="ident" id="3422481">Regexp</span><span class="op" id="3422487">)</span>&nbsp;<span class="ident" id="3422489">FindAllStringIndex</span><span class="op" id="3422507">(</span><span class="ident" id="3422508">s</span>&nbsp;<span class="builtintype" id="3422510">string</span><span class="op" id="3422516">,</span>&nbsp;<span class="ident" id="3422518">n</span>&nbsp;<span class="builtintype" id="3422520">int</span><span class="op" id="3422523">)</span>&nbsp;<span class="op" id="3422525">[</span><span class="op" id="3422526">]</span><span class="op" id="3422527">[</span><span class="op" id="3422528">]</span><span class="builtintype" id="3422529">int</span>&nbsp;<span class="op" id="3422533">{</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422536">if</span>&nbsp;<span class="ident" id="3422539">n</span>&nbsp;<span class="op" id="3422541">&lt;</span>&nbsp;<span class="num" id="3422543">0</span>&nbsp;<span class="op" id="3422545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422549">n</span>&nbsp;<span class="op" id="3422551">=</span>&nbsp;<span class="builtinfunc" id="3422553">len</span><span class="op" id="3422556">(</span><span class="ident" id="3422557">s</span><span class="op" id="3422558">)</span>&nbsp;<span class="op" id="3422560">+</span>&nbsp;<span class="num" id="3422562">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422568">result</span>&nbsp;<span class="op" id="3422575">:=</span>&nbsp;<span class="builtinfunc" id="3422578">make</span><span class="op" id="3422582">(</span><span class="op" id="3422583">[</span><span class="op" id="3422584">]</span><span class="op" id="3422585">[</span><span class="op" id="3422586">]</span><span class="builtintype" id="3422587">int</span><span class="op" id="3422590">,</span>&nbsp;<span class="num" id="3422592">0</span><span class="op" id="3422593">,</span>&nbsp;<span class="ident" id="3422595">startSize</span><span class="op" id="3422604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422607">re</span><span class="op" id="3422609">.</span><span class="ident" id="3422610">allMatches</span><span class="op" id="3422620">(</span><span class="ident" id="3422621">s</span><span class="op" id="3422622">,</span>&nbsp;<span class="ident" id="3422624">nil</span><span class="op" id="3422627">,</span>&nbsp;<span class="ident" id="3422629">n</span><span class="op" id="3422630">,</span>&nbsp;<span class="keyword" id="3422632">func</span><span class="op" id="3422636">(</span><span class="ident" id="3422637">match</span>&nbsp;<span class="op" id="3422643">[</span><span class="op" id="3422644">]</span><span class="builtintype" id="3422645">int</span><span class="op" id="3422648">)</span>&nbsp;<span class="op" id="3422650">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3422654">result</span>&nbsp;<span class="op" id="3422661">=</span>&nbsp;<span class="builtinfunc" id="3422663">append</span><span class="op" id="3422669">(</span><span class="ident" id="3422670">result</span><span class="op" id="3422676">,</span>&nbsp;<span class="ident" id="3422678">match</span><span class="op" id="3422683">[</span><span class="num" id="3422684">0</span><span class="op" id="3422685">:</span><span class="num" id="3422686">2</span><span class="op" id="3422687">]</span><span class="op" id="3422688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422691">}</span><span class="op" id="3422692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422695">if</span>&nbsp;<span class="builtinfunc" id="3422698">len</span><span class="op" id="3422701">(</span><span class="ident" id="3422702">result</span><span class="op" id="3422708">)</span>&nbsp;<span class="op" id="3422710">==</span>&nbsp;<span class="num" id="3422713">0</span>&nbsp;<span class="op" id="3422715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422719">return</span>&nbsp;<span class="ident" id="3422726">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3422731">}</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3422734">return</span>&nbsp;<span class="ident" id="3422741">result</span><br>
<span class="lineno"></span><span class="op" id="3422748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3422751">//&nbsp;FindAllSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatch;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3422827">//&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;</span><br>
<span class="lineno">990</span><span class="comment" id="3422899">//&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3422938">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3422983">func</span>&nbsp;<span class="op" id="3422988">(</span><span class="ident" id="3422989">re</span>&nbsp;<span class="op" id="3422992">*</span><span class="ident" id="3422993">Regexp</span><span class="op" id="3422999">)</span>&nbsp;<span class="ident" id="3423001">FindAllSubmatch</span><span class="op" id="3423016">(</span><span class="ident" id="3423017">b</span>&nbsp;<span class="op" id="3423019">[</span><span class="op" id="3423020">]</span><span class="builtintype" id="3423021">byte</span><span class="op" id="3423025">,</span>&nbsp;<span class="ident" id="3423027">n</span>&nbsp;<span class="builtintype" id="3423029">int</span><span class="op" id="3423032">)</span>&nbsp;<span class="op" id="3423034">[</span><span class="op" id="3423035">]</span><span class="op" id="3423036">[</span><span class="op" id="3423037">]</span><span class="op" id="3423038">[</span><span class="op" id="3423039">]</span><span class="builtintype" id="3423040">byte</span>&nbsp;<span class="op" id="3423045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423048">if</span>&nbsp;<span class="ident" id="3423051">n</span>&nbsp;<span class="op" id="3423053">&lt;</span>&nbsp;<span class="num" id="3423055">0</span>&nbsp;<span class="op" id="3423057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423061">n</span>&nbsp;<span class="op" id="3423063">=</span>&nbsp;<span class="builtinfunc" id="3423065">len</span><span class="op" id="3423068">(</span><span class="ident" id="3423069">b</span><span class="op" id="3423070">)</span>&nbsp;<span class="op" id="3423072">+</span>&nbsp;<span class="num" id="3423074">1</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423080">result</span>&nbsp;<span class="op" id="3423087">:=</span>&nbsp;<span class="builtinfunc" id="3423090">make</span><span class="op" id="3423094">(</span><span class="op" id="3423095">[</span><span class="op" id="3423096">]</span><span class="op" id="3423097">[</span><span class="op" id="3423098">]</span><span class="op" id="3423099">[</span><span class="op" id="3423100">]</span><span class="builtintype" id="3423101">byte</span><span class="op" id="3423105">,</span>&nbsp;<span class="num" id="3423107">0</span><span class="op" id="3423108">,</span>&nbsp;<span class="ident" id="3423110">startSize</span><span class="op" id="3423119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423122">re</span><span class="op" id="3423124">.</span><span class="ident" id="3423125">allMatches</span><span class="op" id="3423135">(</span><span class="string" id="3423136">&#34;&#34;</span><span class="op" id="3423138">,</span>&nbsp;<span class="ident" id="3423140">b</span><span class="op" id="3423141">,</span>&nbsp;<span class="ident" id="3423143">n</span><span class="op" id="3423144">,</span>&nbsp;<span class="keyword" id="3423146">func</span><span class="op" id="3423150">(</span><span class="ident" id="3423151">match</span>&nbsp;<span class="op" id="3423157">[</span><span class="op" id="3423158">]</span><span class="builtintype" id="3423159">int</span><span class="op" id="3423162">)</span>&nbsp;<span class="op" id="3423164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423168">slice</span>&nbsp;<span class="op" id="3423174">:=</span>&nbsp;<span class="builtinfunc" id="3423177">make</span><span class="op" id="3423181">(</span><span class="op" id="3423182">[</span><span class="op" id="3423183">]</span><span class="op" id="3423184">[</span><span class="op" id="3423185">]</span><span class="builtintype" id="3423186">byte</span><span class="op" id="3423190">,</span>&nbsp;<span class="builtinfunc" id="3423192">len</span><span class="op" id="3423195">(</span><span class="ident" id="3423196">match</span><span class="op" id="3423201">)</span><span class="op" id="3423202">/</span><span class="num" id="3423203">2</span><span class="op" id="3423204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423208">for</span>&nbsp;<span class="ident" id="3423212">j</span>&nbsp;<span class="op" id="3423214">:=</span>&nbsp;<span class="keyword" id="3423217">range</span>&nbsp;<span class="ident" id="3423223">slice</span>&nbsp;<span class="op" id="3423229">{</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423234">if</span>&nbsp;<span class="ident" id="3423237">match</span><span class="op" id="3423242">[</span><span class="num" id="3423243">2</span><span class="op" id="3423244">*</span><span class="ident" id="3423245">j</span><span class="op" id="3423246">]</span>&nbsp;<span class="op" id="3423248">&gt;=</span>&nbsp;<span class="num" id="3423251">0</span>&nbsp;<span class="op" id="3423253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423259">slice</span><span class="op" id="3423264">[</span><span class="ident" id="3423265">j</span><span class="op" id="3423266">]</span>&nbsp;<span class="op" id="3423268">=</span>&nbsp;<span class="ident" id="3423270">b</span><span class="op" id="3423271">[</span><span class="ident" id="3423272">match</span><span class="op" id="3423277">[</span><span class="num" id="3423278">2</span><span class="op" id="3423279">*</span><span class="ident" id="3423280">j</span><span class="op" id="3423281">]</span><span class="op" id="3423282">:</span><span class="ident" id="3423283">match</span><span class="op" id="3423288">[</span><span class="num" id="3423289">2</span><span class="op" id="3423290">*</span><span class="ident" id="3423291">j</span><span class="op" id="3423292">+</span><span class="num" id="3423293">1</span><span class="op" id="3423294">]</span><span class="op" id="3423295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423308">result</span>&nbsp;<span class="op" id="3423315">=</span>&nbsp;<span class="builtinfunc" id="3423317">append</span><span class="op" id="3423323">(</span><span class="ident" id="3423324">result</span><span class="op" id="3423330">,</span>&nbsp;<span class="ident" id="3423332">slice</span><span class="op" id="3423337">)</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423340">}</span><span class="op" id="3423341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423344">if</span>&nbsp;<span class="builtinfunc" id="3423347">len</span><span class="op" id="3423350">(</span><span class="ident" id="3423351">result</span><span class="op" id="3423357">)</span>&nbsp;<span class="op" id="3423359">==</span>&nbsp;<span class="num" id="3423362">0</span>&nbsp;<span class="op" id="3423364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423368">return</span>&nbsp;<span class="ident" id="3423375">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423383">return</span>&nbsp;<span class="ident" id="3423390">result</span><br>
<span class="lineno">1010</span><span class="op" id="3423397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3423400">//&nbsp;FindAllSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindSubmatchIndex;&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3423478">//&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3423552">//&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno">1015</span><span class="comment" id="3423597">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3423642">func</span>&nbsp;<span class="op" id="3423647">(</span><span class="ident" id="3423648">re</span>&nbsp;<span class="op" id="3423651">*</span><span class="ident" id="3423652">Regexp</span><span class="op" id="3423658">)</span>&nbsp;<span class="ident" id="3423660">FindAllSubmatchIndex</span><span class="op" id="3423680">(</span><span class="ident" id="3423681">b</span>&nbsp;<span class="op" id="3423683">[</span><span class="op" id="3423684">]</span><span class="builtintype" id="3423685">byte</span><span class="op" id="3423689">,</span>&nbsp;<span class="ident" id="3423691">n</span>&nbsp;<span class="builtintype" id="3423693">int</span><span class="op" id="3423696">)</span>&nbsp;<span class="op" id="3423698">[</span><span class="op" id="3423699">]</span><span class="op" id="3423700">[</span><span class="op" id="3423701">]</span><span class="builtintype" id="3423702">int</span>&nbsp;<span class="op" id="3423706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423709">if</span>&nbsp;<span class="ident" id="3423712">n</span>&nbsp;<span class="op" id="3423714">&lt;</span>&nbsp;<span class="num" id="3423716">0</span>&nbsp;<span class="op" id="3423718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423722">n</span>&nbsp;<span class="op" id="3423724">=</span>&nbsp;<span class="builtinfunc" id="3423726">len</span><span class="op" id="3423729">(</span><span class="ident" id="3423730">b</span><span class="op" id="3423731">)</span>&nbsp;<span class="op" id="3423733">+</span>&nbsp;<span class="num" id="3423735">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423738">}</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423741">result</span>&nbsp;<span class="op" id="3423748">:=</span>&nbsp;<span class="builtinfunc" id="3423751">make</span><span class="op" id="3423755">(</span><span class="op" id="3423756">[</span><span class="op" id="3423757">]</span><span class="op" id="3423758">[</span><span class="op" id="3423759">]</span><span class="builtintype" id="3423760">int</span><span class="op" id="3423763">,</span>&nbsp;<span class="num" id="3423765">0</span><span class="op" id="3423766">,</span>&nbsp;<span class="ident" id="3423768">startSize</span><span class="op" id="3423777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423780">re</span><span class="op" id="3423782">.</span><span class="ident" id="3423783">allMatches</span><span class="op" id="3423793">(</span><span class="string" id="3423794">&#34;&#34;</span><span class="op" id="3423796">,</span>&nbsp;<span class="ident" id="3423798">b</span><span class="op" id="3423799">,</span>&nbsp;<span class="ident" id="3423801">n</span><span class="op" id="3423802">,</span>&nbsp;<span class="keyword" id="3423804">func</span><span class="op" id="3423808">(</span><span class="ident" id="3423809">match</span>&nbsp;<span class="op" id="3423815">[</span><span class="op" id="3423816">]</span><span class="builtintype" id="3423817">int</span><span class="op" id="3423820">)</span>&nbsp;<span class="op" id="3423822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3423826">result</span>&nbsp;<span class="op" id="3423833">=</span>&nbsp;<span class="builtinfunc" id="3423835">append</span><span class="op" id="3423841">(</span><span class="ident" id="3423842">result</span><span class="op" id="3423848">,</span>&nbsp;<span class="ident" id="3423850">match</span><span class="op" id="3423855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423858">}</span><span class="op" id="3423859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423862">if</span>&nbsp;<span class="builtinfunc" id="3423865">len</span><span class="op" id="3423868">(</span><span class="ident" id="3423869">result</span><span class="op" id="3423875">)</span>&nbsp;<span class="op" id="3423877">==</span>&nbsp;<span class="num" id="3423880">0</span>&nbsp;<span class="op" id="3423882">{</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423886">return</span>&nbsp;<span class="ident" id="3423893">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3423898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3423901">return</span>&nbsp;<span class="ident" id="3423908">result</span><br>
<span class="lineno"></span><span class="op" id="3423915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1030</span><span class="comment" id="3423918">//&nbsp;FindAllStringSubmatch&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of&nbsp;FindStringSubmatch;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3423990">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3424068">//&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3424117">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3424162">func</span>&nbsp;<span class="op" id="3424167">(</span><span class="ident" id="3424168">re</span>&nbsp;<span class="op" id="3424171">*</span><span class="ident" id="3424172">Regexp</span><span class="op" id="3424178">)</span>&nbsp;<span class="ident" id="3424180">FindAllStringSubmatch</span><span class="op" id="3424201">(</span><span class="ident" id="3424202">s</span>&nbsp;<span class="builtintype" id="3424204">string</span><span class="op" id="3424210">,</span>&nbsp;<span class="ident" id="3424212">n</span>&nbsp;<span class="builtintype" id="3424214">int</span><span class="op" id="3424217">)</span>&nbsp;<span class="op" id="3424219">[</span><span class="op" id="3424220">]</span><span class="op" id="3424221">[</span><span class="op" id="3424222">]</span><span class="builtintype" id="3424223">string</span>&nbsp;<span class="op" id="3424230">{</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424233">if</span>&nbsp;<span class="ident" id="3424236">n</span>&nbsp;<span class="op" id="3424238">&lt;</span>&nbsp;<span class="num" id="3424240">0</span>&nbsp;<span class="op" id="3424242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424246">n</span>&nbsp;<span class="op" id="3424248">=</span>&nbsp;<span class="builtinfunc" id="3424250">len</span><span class="op" id="3424253">(</span><span class="ident" id="3424254">s</span><span class="op" id="3424255">)</span>&nbsp;<span class="op" id="3424257">+</span>&nbsp;<span class="num" id="3424259">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424265">result</span>&nbsp;<span class="op" id="3424272">:=</span>&nbsp;<span class="builtinfunc" id="3424275">make</span><span class="op" id="3424279">(</span><span class="op" id="3424280">[</span><span class="op" id="3424281">]</span><span class="op" id="3424282">[</span><span class="op" id="3424283">]</span><span class="builtintype" id="3424284">string</span><span class="op" id="3424290">,</span>&nbsp;<span class="num" id="3424292">0</span><span class="op" id="3424293">,</span>&nbsp;<span class="ident" id="3424295">startSize</span><span class="op" id="3424304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424307">re</span><span class="op" id="3424309">.</span><span class="ident" id="3424310">allMatches</span><span class="op" id="3424320">(</span><span class="ident" id="3424321">s</span><span class="op" id="3424322">,</span>&nbsp;<span class="ident" id="3424324">nil</span><span class="op" id="3424327">,</span>&nbsp;<span class="ident" id="3424329">n</span><span class="op" id="3424330">,</span>&nbsp;<span class="keyword" id="3424332">func</span><span class="op" id="3424336">(</span><span class="ident" id="3424337">match</span>&nbsp;<span class="op" id="3424343">[</span><span class="op" id="3424344">]</span><span class="builtintype" id="3424345">int</span><span class="op" id="3424348">)</span>&nbsp;<span class="op" id="3424350">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424354">slice</span>&nbsp;<span class="op" id="3424360">:=</span>&nbsp;<span class="builtinfunc" id="3424363">make</span><span class="op" id="3424367">(</span><span class="op" id="3424368">[</span><span class="op" id="3424369">]</span><span class="builtintype" id="3424370">string</span><span class="op" id="3424376">,</span>&nbsp;<span class="builtinfunc" id="3424378">len</span><span class="op" id="3424381">(</span><span class="ident" id="3424382">match</span><span class="op" id="3424387">)</span><span class="op" id="3424388">/</span><span class="num" id="3424389">2</span><span class="op" id="3424390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424394">for</span>&nbsp;<span class="ident" id="3424398">j</span>&nbsp;<span class="op" id="3424400">:=</span>&nbsp;<span class="keyword" id="3424403">range</span>&nbsp;<span class="ident" id="3424409">slice</span>&nbsp;<span class="op" id="3424415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424420">if</span>&nbsp;<span class="ident" id="3424423">match</span><span class="op" id="3424428">[</span><span class="num" id="3424429">2</span><span class="op" id="3424430">*</span><span class="ident" id="3424431">j</span><span class="op" id="3424432">]</span>&nbsp;<span class="op" id="3424434">&gt;=</span>&nbsp;<span class="num" id="3424437">0</span>&nbsp;<span class="op" id="3424439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424445">slice</span><span class="op" id="3424450">[</span><span class="ident" id="3424451">j</span><span class="op" id="3424452">]</span>&nbsp;<span class="op" id="3424454">=</span>&nbsp;<span class="ident" id="3424456">s</span><span class="op" id="3424457">[</span><span class="ident" id="3424458">match</span><span class="op" id="3424463">[</span><span class="num" id="3424464">2</span><span class="op" id="3424465">*</span><span class="ident" id="3424466">j</span><span class="op" id="3424467">]</span><span class="op" id="3424468">:</span><span class="ident" id="3424469">match</span><span class="op" id="3424474">[</span><span class="num" id="3424475">2</span><span class="op" id="3424476">*</span><span class="ident" id="3424477">j</span><span class="op" id="3424478">+</span><span class="num" id="3424479">1</span><span class="op" id="3424480">]</span><span class="op" id="3424481">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424486">}</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424494">result</span>&nbsp;<span class="op" id="3424501">=</span>&nbsp;<span class="builtinfunc" id="3424503">append</span><span class="op" id="3424509">(</span><span class="ident" id="3424510">result</span><span class="op" id="3424516">,</span>&nbsp;<span class="ident" id="3424518">slice</span><span class="op" id="3424523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424526">}</span><span class="op" id="3424527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424530">if</span>&nbsp;<span class="builtinfunc" id="3424533">len</span><span class="op" id="3424536">(</span><span class="ident" id="3424537">result</span><span class="op" id="3424543">)</span>&nbsp;<span class="op" id="3424545">==</span>&nbsp;<span class="num" id="3424548">0</span>&nbsp;<span class="op" id="3424550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424554">return</span>&nbsp;<span class="ident" id="3424561">nil</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424569">return</span>&nbsp;<span class="ident" id="3424576">result</span><br>
<span class="lineno"></span><span class="op" id="3424583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3424586">//&nbsp;FindAllStringSubmatchIndex&nbsp;is&nbsp;the&nbsp;&#39;All&#39;&nbsp;version&nbsp;of</span><br>
<span class="lineno">1055</span><span class="comment" id="3424640">//&nbsp;FindStringSubmatchIndex;&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;successive&nbsp;matches&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3424716">//&nbsp;the&nbsp;expression,&nbsp;as&nbsp;defined&nbsp;by&nbsp;the&nbsp;&#39;All&#39;&nbsp;description&nbsp;in&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3424786">//&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="3424798">//&nbsp;A&nbsp;return&nbsp;value&nbsp;of&nbsp;nil&nbsp;indicates&nbsp;no&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="3424843">func</span>&nbsp;<span class="op" id="3424848">(</span><span class="ident" id="3424849">re</span>&nbsp;<span class="op" id="3424852">*</span><span class="ident" id="3424853">Regexp</span><span class="op" id="3424859">)</span>&nbsp;<span class="ident" id="3424861">FindAllStringSubmatchIndex</span><span class="op" id="3424887">(</span><span class="ident" id="3424888">s</span>&nbsp;<span class="builtintype" id="3424890">string</span><span class="op" id="3424896">,</span>&nbsp;<span class="ident" id="3424898">n</span>&nbsp;<span class="builtintype" id="3424900">int</span><span class="op" id="3424903">)</span>&nbsp;<span class="op" id="3424905">[</span><span class="op" id="3424906">]</span><span class="op" id="3424907">[</span><span class="op" id="3424908">]</span><span class="builtintype" id="3424909">int</span>&nbsp;<span class="op" id="3424913">{</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3424916">if</span>&nbsp;<span class="ident" id="3424919">n</span>&nbsp;<span class="op" id="3424921">&lt;</span>&nbsp;<span class="num" id="3424923">0</span>&nbsp;<span class="op" id="3424925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424929">n</span>&nbsp;<span class="op" id="3424931">=</span>&nbsp;<span class="builtinfunc" id="3424933">len</span><span class="op" id="3424936">(</span><span class="ident" id="3424937">s</span><span class="op" id="3424938">)</span>&nbsp;<span class="op" id="3424940">+</span>&nbsp;<span class="num" id="3424942">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3424945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424948">result</span>&nbsp;<span class="op" id="3424955">:=</span>&nbsp;<span class="builtinfunc" id="3424958">make</span><span class="op" id="3424962">(</span><span class="op" id="3424963">[</span><span class="op" id="3424964">]</span><span class="op" id="3424965">[</span><span class="op" id="3424966">]</span><span class="builtintype" id="3424967">int</span><span class="op" id="3424970">,</span>&nbsp;<span class="num" id="3424972">0</span><span class="op" id="3424973">,</span>&nbsp;<span class="ident" id="3424975">startSize</span><span class="op" id="3424984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3424987">re</span><span class="op" id="3424989">.</span><span class="ident" id="3424990">allMatches</span><span class="op" id="3425000">(</span><span class="ident" id="3425001">s</span><span class="op" id="3425002">,</span>&nbsp;<span class="ident" id="3425004">nil</span><span class="op" id="3425007">,</span>&nbsp;<span class="ident" id="3425009">n</span><span class="op" id="3425010">,</span>&nbsp;<span class="keyword" id="3425012">func</span><span class="op" id="3425016">(</span><span class="ident" id="3425017">match</span>&nbsp;<span class="op" id="3425023">[</span><span class="op" id="3425024">]</span><span class="builtintype" id="3425025">int</span><span class="op" id="3425028">)</span>&nbsp;<span class="op" id="3425030">{</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425034">result</span>&nbsp;<span class="op" id="3425041">=</span>&nbsp;<span class="builtinfunc" id="3425043">append</span><span class="op" id="3425049">(</span><span class="ident" id="3425050">result</span><span class="op" id="3425056">,</span>&nbsp;<span class="ident" id="3425058">match</span><span class="op" id="3425063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425066">}</span><span class="op" id="3425067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425070">if</span>&nbsp;<span class="builtinfunc" id="3425073">len</span><span class="op" id="3425076">(</span><span class="ident" id="3425077">result</span><span class="op" id="3425083">)</span>&nbsp;<span class="op" id="3425085">==</span>&nbsp;<span class="num" id="3425088">0</span>&nbsp;<span class="op" id="3425090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425094">return</span>&nbsp;<span class="ident" id="3425101">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425106">}</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425109">return</span>&nbsp;<span class="ident" id="3425116">result</span><br>
<span class="lineno"></span><span class="op" id="3425123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3425126">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;substrings&nbsp;separated&nbsp;by&nbsp;the&nbsp;expression&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3425211">//&nbsp;the&nbsp;substrings&nbsp;between&nbsp;those&nbsp;expression&nbsp;matches.</span><br>
<span class="lineno">1075</span><span class="comment" id="3425263">//</span><br>
<span class="lineno"></span><span class="comment" id="3425266">//&nbsp;The&nbsp;slice&nbsp;returned&nbsp;by&nbsp;this&nbsp;method&nbsp;consists&nbsp;of&nbsp;all&nbsp;the&nbsp;substrings&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="3425339">//&nbsp;not&nbsp;contained&nbsp;in&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;FindAllString.&nbsp;When&nbsp;called&nbsp;on&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="3425425">//&nbsp;that&nbsp;contains&nbsp;no&nbsp;metacharacters,&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;strings.SplitN.</span><br>
<span class="lineno"></span><span class="comment" id="3425497">//</span><br>
<span class="lineno">1080</span><span class="comment" id="3425500">//&nbsp;Example:</span><br>
<span class="lineno"></span><span class="comment" id="3425512">//&nbsp;&nbsp;&nbsp;s&nbsp;:=&nbsp;regexp.MustCompile(&#34;a*&#34;).Split(&#34;abaabaccadaaae&#34;,&nbsp;5)</span><br>
<span class="lineno"></span><span class="comment" id="3425574">//&nbsp;&nbsp;&nbsp;//&nbsp;s:&nbsp;[&#34;&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;b&#34;,&nbsp;&#34;c&#34;,&nbsp;&#34;cadaaae&#34;]</span><br>
<span class="lineno"></span><span class="comment" id="3425616">//</span><br>
<span class="lineno"></span><span class="comment" id="3425619">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;substrings&nbsp;to&nbsp;return:</span><br>
<span class="lineno">1085</span><span class="comment" id="3425679">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;substrings;&nbsp;the&nbsp;last&nbsp;substring&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="3425763">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;substrings)</span><br>
<span class="lineno"></span><span class="comment" id="3425812">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;substrings</span><br>
<span class="lineno"></span><span class="keyword" id="3425839">func</span>&nbsp;<span class="op" id="3425844">(</span><span class="ident" id="3425845">re</span>&nbsp;<span class="op" id="3425848">*</span><span class="ident" id="3425849">Regexp</span><span class="op" id="3425855">)</span>&nbsp;<span class="ident" id="3425857">Split</span><span class="op" id="3425862">(</span><span class="ident" id="3425863">s</span>&nbsp;<span class="builtintype" id="3425865">string</span><span class="op" id="3425871">,</span>&nbsp;<span class="ident" id="3425873">n</span>&nbsp;<span class="builtintype" id="3425875">int</span><span class="op" id="3425878">)</span>&nbsp;<span class="op" id="3425880">[</span><span class="op" id="3425881">]</span><span class="builtintype" id="3425882">string</span>&nbsp;<span class="op" id="3425889">{</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425893">if</span>&nbsp;<span class="ident" id="3425896">n</span>&nbsp;<span class="op" id="3425898">==</span>&nbsp;<span class="num" id="3425901">0</span>&nbsp;<span class="op" id="3425903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425907">return</span>&nbsp;<span class="ident" id="3425914">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425923">if</span>&nbsp;<span class="builtinfunc" id="3425926">len</span><span class="op" id="3425929">(</span><span class="ident" id="3425930">re</span><span class="op" id="3425932">.</span><span class="ident" id="3425933">expr</span><span class="op" id="3425937">)</span>&nbsp;<span class="op" id="3425939">&gt;</span>&nbsp;<span class="num" id="3425941">0</span>&nbsp;<span class="op" id="3425943">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3425946">len</span><span class="op" id="3425949">(</span><span class="ident" id="3425950">s</span><span class="op" id="3425951">)</span>&nbsp;<span class="op" id="3425953">==</span>&nbsp;<span class="num" id="3425956">0</span>&nbsp;<span class="op" id="3425958">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3425962">return</span>&nbsp;<span class="op" id="3425969">[</span><span class="op" id="3425970">]</span><span class="builtintype" id="3425971">string</span><span class="op" id="3425977">{</span><span class="string" id="3425978">&#34;&#34;</span><span class="op" id="3425980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3425983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3425987">matches</span>&nbsp;<span class="op" id="3425995">:=</span>&nbsp;<span class="ident" id="3425998">re</span><span class="op" id="3426000">.</span><span class="ident" id="3426001">FindAllStringIndex</span><span class="op" id="3426019">(</span><span class="ident" id="3426020">s</span><span class="op" id="3426021">,</span>&nbsp;<span class="ident" id="3426023">n</span><span class="op" id="3426024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426027">strings</span>&nbsp;<span class="op" id="3426035">:=</span>&nbsp;<span class="builtinfunc" id="3426038">make</span><span class="op" id="3426042">(</span><span class="op" id="3426043">[</span><span class="op" id="3426044">]</span><span class="builtintype" id="3426045">string</span><span class="op" id="3426051">,</span>&nbsp;<span class="num" id="3426053">0</span><span class="op" id="3426054">,</span>&nbsp;<span class="builtinfunc" id="3426056">len</span><span class="op" id="3426059">(</span><span class="ident" id="3426060">matches</span><span class="op" id="3426067">)</span><span class="op" id="3426068">)</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426072">beg</span>&nbsp;<span class="op" id="3426076">:=</span>&nbsp;<span class="num" id="3426079">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426082">end</span>&nbsp;<span class="op" id="3426086">:=</span>&nbsp;<span class="num" id="3426089">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426092">for</span>&nbsp;<span class="ident" id="3426096">_</span><span class="op" id="3426097">,</span>&nbsp;<span class="ident" id="3426099">match</span>&nbsp;<span class="op" id="3426105">:=</span>&nbsp;<span class="keyword" id="3426108">range</span>&nbsp;<span class="ident" id="3426114">matches</span>&nbsp;<span class="op" id="3426122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426126">if</span>&nbsp;<span class="ident" id="3426129">n</span>&nbsp;<span class="op" id="3426131">&gt;</span>&nbsp;<span class="num" id="3426133">0</span>&nbsp;<span class="op" id="3426135">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3426138">len</span><span class="op" id="3426141">(</span><span class="ident" id="3426142">strings</span><span class="op" id="3426149">)</span>&nbsp;<span class="op" id="3426151">&gt;=</span>&nbsp;<span class="ident" id="3426154">n</span><span class="op" id="3426155">-</span><span class="num" id="3426156">1</span>&nbsp;<span class="op" id="3426158">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426163">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426176">end</span>&nbsp;<span class="op" id="3426180">=</span>&nbsp;<span class="ident" id="3426182">match</span><span class="op" id="3426187">[</span><span class="num" id="3426188">0</span><span class="op" id="3426189">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426193">if</span>&nbsp;<span class="ident" id="3426196">match</span><span class="op" id="3426201">[</span><span class="num" id="3426202">1</span><span class="op" id="3426203">]</span>&nbsp;<span class="op" id="3426205">!=</span>&nbsp;<span class="num" id="3426208">0</span>&nbsp;<span class="op" id="3426210">{</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426215">strings</span>&nbsp;<span class="op" id="3426223">=</span>&nbsp;<span class="builtinfunc" id="3426225">append</span><span class="op" id="3426231">(</span><span class="ident" id="3426232">strings</span><span class="op" id="3426239">,</span>&nbsp;<span class="ident" id="3426241">s</span><span class="op" id="3426242">[</span><span class="ident" id="3426243">beg</span><span class="op" id="3426246">:</span><span class="ident" id="3426247">end</span><span class="op" id="3426250">]</span><span class="op" id="3426251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426259">beg</span>&nbsp;<span class="op" id="3426263">=</span>&nbsp;<span class="ident" id="3426265">match</span><span class="op" id="3426270">[</span><span class="num" id="3426271">1</span><span class="op" id="3426272">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426279">if</span>&nbsp;<span class="ident" id="3426282">end</span>&nbsp;<span class="op" id="3426286">!=</span>&nbsp;<span class="builtinfunc" id="3426289">len</span><span class="op" id="3426292">(</span><span class="ident" id="3426293">s</span><span class="op" id="3426294">)</span>&nbsp;<span class="op" id="3426296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3426300">strings</span>&nbsp;<span class="op" id="3426308">=</span>&nbsp;<span class="builtinfunc" id="3426310">append</span><span class="op" id="3426316">(</span><span class="ident" id="3426317">strings</span><span class="op" id="3426324">,</span>&nbsp;<span class="ident" id="3426326">s</span><span class="op" id="3426327">[</span><span class="ident" id="3426328">beg</span><span class="op" id="3426331">:</span><span class="op" id="3426332">]</span><span class="op" id="3426333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3426336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3426340">return</span>&nbsp;<span class="ident" id="3426347">strings</span><br>
<span class="lineno">1120</span><span class="op" id="3426355">}</span>
</div>
</body>
</html>
