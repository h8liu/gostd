<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment">//&nbsp;Package&nbsp;dwarf&nbsp;provides&nbsp;access&nbsp;to&nbsp;DWARF&nbsp;debugging&nbsp;information&nbsp;loaded&nbsp;from</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;executable&nbsp;files,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;DWARF&nbsp;2.0&nbsp;Standard&nbsp;at</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;http://dwarfstd.org/doc/dwarf-2.0.0.pdf</span><br>
<span class="lineno"></span><span class="keyword">package</span>&nbsp;<span class="ident">dwarf</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword">import</span>&nbsp;<span class="string">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Data&nbsp;represents&nbsp;the&nbsp;DWARF&nbsp;debugging&nbsp;information</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;loaded&nbsp;from&nbsp;an&nbsp;executable&nbsp;file&nbsp;(for&nbsp;example,&nbsp;an&nbsp;ELF&nbsp;or&nbsp;Mach-O&nbsp;executable).</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">Data</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;raw&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abbrev</span>&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aranges</span>&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">frame</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">info</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pubnames</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ranges</span>&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">str</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;parsed&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abbrevCache</span>&nbsp;<span class="keyword">map</span><span class="op">[</span><span class="builtintype">uint32</span><span class="op">]</span><span class="ident">abbrevTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">order</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">ByteOrder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">typeCache</span>&nbsp;&nbsp;&nbsp;<span class="keyword">map</span><span class="op">[</span><span class="ident">Offset</span><span class="op">]</span><span class="ident">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">typeSigs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">map</span><span class="op">[</span><span class="ident">uint64</span><span class="op">]</span><span class="op">*</span><span class="ident">typeUnit</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">unit</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">unit</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;Data&nbsp;object&nbsp;initialized&nbsp;from&nbsp;the&nbsp;given&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Rather&nbsp;than&nbsp;calling&nbsp;this&nbsp;function&nbsp;directly,&nbsp;clients&nbsp;should&nbsp;typically&nbsp;use</span><br>
<span class="lineno">35</span><span class="comment">//&nbsp;the&nbsp;DWARF&nbsp;method&nbsp;of&nbsp;the&nbsp;File&nbsp;type&nbsp;of&nbsp;the&nbsp;appropriate&nbsp;package&nbsp;debug/elf,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;debug/macho,&nbsp;or&nbsp;debug/pe.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;[]byte&nbsp;arguments&nbsp;are&nbsp;the&nbsp;data&nbsp;from&nbsp;the&nbsp;corresponding&nbsp;debug&nbsp;section</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;in&nbsp;the&nbsp;object&nbsp;file;&nbsp;for&nbsp;example,&nbsp;for&nbsp;an&nbsp;ELF&nbsp;object,&nbsp;abbrev&nbsp;is&nbsp;the&nbsp;contents&nbsp;of</span><br>
<span class="lineno">40</span><span class="comment">//&nbsp;the&nbsp;&#34;.debug_abbrev&#34;&nbsp;section.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">New</span><span class="op">(</span><span class="ident">abbrev</span><span class="op">,</span>&nbsp;<span class="ident">aranges</span><span class="op">,</span>&nbsp;<span class="ident">frame</span><span class="op">,</span>&nbsp;<span class="ident">info</span><span class="op">,</span>&nbsp;<span class="ident">line</span><span class="op">,</span>&nbsp;<span class="ident">pubnames</span><span class="op">,</span>&nbsp;<span class="ident">ranges</span><span class="op">,</span>&nbsp;<span class="ident">str</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">Data</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">Data</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abbrev</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">abbrev</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aranges</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">aranges</span><span class="op">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">frame</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">frame</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">info</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">info</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">line</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pubnames</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">pubnames</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ranges</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">ranges</span><span class="op">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">str</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">str</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">abbrevCache</span><span class="op">:</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="keyword">map</span><span class="op">[</span><span class="builtintype">uint32</span><span class="op">]</span><span class="ident">abbrevTable</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">typeCache</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="keyword">map</span><span class="op">[</span><span class="ident">Offset</span><span class="op">]</span><span class="ident">Type</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">typeSigs</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="keyword">map</span><span class="op">[</span><span class="ident">uint64</span><span class="op">]</span><span class="op">*</span><span class="ident">typeUnit</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Sniff&nbsp;.debug_info&nbsp;to&nbsp;figure&nbsp;out&nbsp;byte&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;bytes&nbsp;4:6&nbsp;are&nbsp;the&nbsp;version,&nbsp;a&nbsp;tiny&nbsp;16-bit&nbsp;number&nbsp;(1,&nbsp;2,&nbsp;3).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">d</span><span class="op">.</span><span class="ident">info</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">6</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">DecodeError</span><span class="op">{</span><span class="string">&#34;info&#34;</span><span class="op">,</span>&nbsp;<span class="ident">Offset</span><span class="op">(</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">d</span><span class="op">.</span><span class="ident">info</span><span class="op">)</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="string">&#34;too&nbsp;short&#34;</span><span class="op">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">info</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">info</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">DecodeError</span><span class="op">{</span><span class="string">&#34;info&#34;</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">,</span>&nbsp;<span class="string">&#34;unsupported&nbsp;version&nbsp;0&#34;</span><span class="op">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">x</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">order</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">order</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">LittleEndian</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">DecodeError</span><span class="op">{</span><span class="string">&#34;info&#34;</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">,</span>&nbsp;<span class="string">&#34;cannot&nbsp;determine&nbsp;byte&nbsp;order&#34;</span><span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">u</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">parseUnits</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">d</span><span class="op">.</span><span class="ident">unit</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">u</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">d</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;AddTypes&nbsp;will&nbsp;add&nbsp;one&nbsp;.debug_types&nbsp;section&nbsp;to&nbsp;the&nbsp;DWARF&nbsp;data.&nbsp;&nbsp;A</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;typical&nbsp;object&nbsp;with&nbsp;DWARF&nbsp;version&nbsp;4&nbsp;debug&nbsp;info&nbsp;will&nbsp;have&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;.debug_types&nbsp;sections.&nbsp;&nbsp;The&nbsp;name&nbsp;is&nbsp;used&nbsp;for&nbsp;error&nbsp;reporting&nbsp;only,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;serves&nbsp;to&nbsp;distinguish&nbsp;one&nbsp;.debug_types&nbsp;section&nbsp;from&nbsp;another.</span><br>
<span class="lineno">85</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">d</span>&nbsp;<span class="op">*</span><span class="ident">Data</span><span class="op">)</span>&nbsp;<span class="ident">AddTypes</span><span class="op">(</span><span class="ident">name</span>&nbsp;<span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">types</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="builtintype">error</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">d</span><span class="op">.</span><span class="ident">parseTypes</span><span class="op">(</span><span class="ident">name</span><span class="op">,</span>&nbsp;<span class="ident">types</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
