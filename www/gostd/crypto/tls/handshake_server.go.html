<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html" class="current">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4538408">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4538463">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4538517">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4538568">package</span>&nbsp;<span class="ident" id="4538576">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4538581">import</span>&nbsp;<span class="op" id="4538588">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538591">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538601">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538617">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538631">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538648">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538663">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538680">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538690">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4538697">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4538702">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4538705">//&nbsp;serverHandshakeState&nbsp;contains&nbsp;details&nbsp;of&nbsp;a&nbsp;server&nbsp;handshake&nbsp;in&nbsp;progress.</span><br>
<span class="lineno">20</span><span class="comment" id="4538781">//&nbsp;It&#39;s&nbsp;discarded&nbsp;once&nbsp;the&nbsp;handshake&nbsp;has&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="4538833">type</span>&nbsp;<span class="ident" id="4538838">serverHandshakeState</span>&nbsp;<span class="keyword" id="4538859">struct</span>&nbsp;<span class="op" id="4538866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538869">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538885">*</span><span class="ident" id="4538886"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538892">clientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538908">*</span><span class="ident" id="4538909"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538925">hello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538941">*</span><span class="ident" id="4538942"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538958">suite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4538974">*</span><span class="ident" id="4538975"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434677">cipherSuite</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4538988">ellipticOk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4539004">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539010">ecdsaOk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4539026">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539032">sessionState</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539048">*</span><span class="ident" id="4539049"><a href="/gostd/crypto/tls/ticket.go.html#4579384">sessionState</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539063">finishedHash</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539079"><a href="/gostd/crypto/tls/prf.go.html#4575783">finishedHash</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539093">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539109">[</span><span class="op" id="4539110">]</span><span class="builtintype" id="4539111">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539117">certsFromClient</span>&nbsp;<span class="op" id="4539133">[</span><span class="op" id="4539134">]</span><span class="op" id="4539135">[</span><span class="op" id="4539136">]</span><span class="builtintype" id="4539137">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539143">cert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539159">*</span><span class="ident" id="4539160"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><br>
<span class="lineno"></span><span class="op" id="4539172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4539175">//&nbsp;serverHandshake&nbsp;performs&nbsp;a&nbsp;TLS&nbsp;handshake&nbsp;as&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="4539232">func</span>&nbsp;<span class="op" id="4539237">(</span><span class="ident" id="4539238">c</span>&nbsp;<span class="op" id="4539240">*</span><span class="ident" id="4539241"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4539245">)</span>&nbsp;<span class="ident" id="4539247">serverHandshake</span><span class="op" id="4539262">(</span><span class="op" id="4539263">)</span>&nbsp;<span class="builtintype" id="4539265">error</span>&nbsp;<span class="op" id="4539271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539274">config</span>&nbsp;<span class="op" id="4539281">:=</span>&nbsp;<span class="ident" id="4539284"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4539285">.</span><span class="ident" id="4539286"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4539295">//&nbsp;If&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake,&nbsp;we&nbsp;generate&nbsp;a&nbsp;random&nbsp;key&nbsp;to</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4539366">//&nbsp;encrypt&nbsp;the&nbsp;tickets&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539396"><a href="/gostd/crypto/tls/handshake_server.go.html#4539274">config</a></span><span class="op" id="4539402">.</span><span class="ident" id="4539403"><a href="/gostd/crypto/tls/common.go.html#4454687">serverInitOnce</a></span><span class="op" id="4539417">.</span><span class="ident" id="4539418"><a href="/gostd/sync/once.go.html#1447110">Do</a></span><span class="op" id="4539420">(</span><span class="ident" id="4539421"><a href="/gostd/crypto/tls/handshake_server.go.html#4539274">config</a></span><span class="op" id="4539427">.</span><span class="ident" id="4539428"><a href="/gostd/crypto/tls/common.go.html#4454771">serverInit</a></span><span class="op" id="4539438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539442">hs</span>&nbsp;<span class="op" id="4539445">:=</span>&nbsp;<span class="ident" id="4539448"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4539468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539472"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><span class="op" id="4539473">:</span>&nbsp;<span class="ident" id="4539475"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4539476">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4539482">isResume</span><span class="op" id="4539490">,</span>&nbsp;<span class="ident" id="4539492">err</span>&nbsp;<span class="op" id="4539496">:=</span>&nbsp;<span class="ident" id="4539499"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4539501">.</span><span class="ident" id="4539502"><a href="/gostd/crypto/tls/handshake_server.go.html#4540693">readClientHello</a></span><span class="op" id="4539517">(</span><span class="op" id="4539518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539521">if</span>&nbsp;<span class="ident" id="4539524"><a href="/gostd/crypto/tls/handshake_server.go.html#4539492">err</a></span>&nbsp;<span class="op" id="4539528">!=</span>&nbsp;<span class="builtintype" id="4539531">nil</span>&nbsp;<span class="op" id="4539535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539539">return</span>&nbsp;<span class="ident" id="4539546"><a href="/gostd/crypto/tls/handshake_server.go.html#4539492">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539551">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4539555">//&nbsp;For&nbsp;an&nbsp;overview&nbsp;of&nbsp;TLS&nbsp;handshaking,&nbsp;see&nbsp;https://tools.ietf.org/html/rfc5246#section-7.3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539647">if</span>&nbsp;<span class="ident" id="4539650"><a href="/gostd/crypto/tls/handshake_server.go.html#4539482">isResume</a></span>&nbsp;<span class="op" id="4539659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4539663">//&nbsp;The&nbsp;client&nbsp;has&nbsp;included&nbsp;a&nbsp;session&nbsp;ticket&nbsp;and&nbsp;so&nbsp;we&nbsp;do&nbsp;an&nbsp;abbreviated&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539748">if</span>&nbsp;<span class="ident" id="4539751">err</span>&nbsp;<span class="op" id="4539755">:=</span>&nbsp;<span class="ident" id="4539758"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4539760">.</span><span class="ident" id="4539761"><a href="/gostd/crypto/tls/handshake_server.go.html#4546382">doResumeHandshake</a></span><span class="op" id="4539778">(</span><span class="op" id="4539779">)</span><span class="op" id="4539780">;</span>&nbsp;<span class="ident" id="4539782"><a href="/gostd/crypto/tls/handshake_server.go.html#4539751">err</a></span>&nbsp;<span class="op" id="4539786">!=</span>&nbsp;<span class="builtintype" id="4539789">nil</span>&nbsp;<span class="op" id="4539793">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539798">return</span>&nbsp;<span class="ident" id="4539805"><a href="/gostd/crypto/tls/handshake_server.go.html#4539751">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539815">if</span>&nbsp;<span class="ident" id="4539818">err</span>&nbsp;<span class="op" id="4539822">:=</span>&nbsp;<span class="ident" id="4539825"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4539827">.</span><span class="ident" id="4539828"><a href="/gostd/crypto/tls/handshake_server.go.html#4552141">establishKeys</a></span><span class="op" id="4539841">(</span><span class="op" id="4539842">)</span><span class="op" id="4539843">;</span>&nbsp;<span class="ident" id="4539845"><a href="/gostd/crypto/tls/handshake_server.go.html#4539818">err</a></span>&nbsp;<span class="op" id="4539849">!=</span>&nbsp;<span class="builtintype" id="4539852">nil</span>&nbsp;<span class="op" id="4539856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539861">return</span>&nbsp;<span class="ident" id="4539868"><a href="/gostd/crypto/tls/handshake_server.go.html#4539818">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539874">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539878">if</span>&nbsp;<span class="ident" id="4539881">err</span>&nbsp;<span class="op" id="4539885">:=</span>&nbsp;<span class="ident" id="4539888"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4539890">.</span><span class="ident" id="4539891"><a href="/gostd/crypto/tls/handshake_server.go.html#4554603">sendFinished</a></span><span class="op" id="4539903">(</span><span class="ident" id="4539904"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4539905">.</span><span class="ident" id="4539906"><a href="/gostd/crypto/tls/conn.go.html#4462937">firstFinished</a></span><span class="op" id="4539919">[</span><span class="op" id="4539920">:</span><span class="op" id="4539921">]</span><span class="op" id="4539922">)</span><span class="op" id="4539923">;</span>&nbsp;<span class="ident" id="4539925"><a href="/gostd/crypto/tls/handshake_server.go.html#4539881">err</a></span>&nbsp;<span class="op" id="4539929">!=</span>&nbsp;<span class="builtintype" id="4539932">nil</span>&nbsp;<span class="op" id="4539936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539941">return</span>&nbsp;<span class="ident" id="4539948"><a href="/gostd/crypto/tls/handshake_server.go.html#4539881">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4539954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4539958">if</span>&nbsp;<span class="ident" id="4539961">err</span>&nbsp;<span class="op" id="4539965">:=</span>&nbsp;<span class="ident" id="4539968"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4539970">.</span><span class="ident" id="4539971"><a href="/gostd/crypto/tls/handshake_server.go.html#4553033">readFinished</a></span><span class="op" id="4539983">(</span><span class="builtintype" id="4539984">nil</span><span class="op" id="4539987">)</span><span class="op" id="4539988">;</span>&nbsp;<span class="ident" id="4539990"><a href="/gostd/crypto/tls/handshake_server.go.html#4539961">err</a></span>&nbsp;<span class="op" id="4539994">!=</span>&nbsp;<span class="builtintype" id="4539997">nil</span>&nbsp;<span class="op" id="4540001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540006">return</span>&nbsp;<span class="ident" id="4540013"><a href="/gostd/crypto/tls/handshake_server.go.html#4539961">err</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540023"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4540024">.</span><span class="ident" id="4540025"><a href="/gostd/crypto/tls/conn.go.html#4462367">didResume</a></span>&nbsp;<span class="op" id="4540035">=</span>&nbsp;<span class="builtintype" id="4540037">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540043">}</span>&nbsp;<span class="keyword" id="4540045">else</span>&nbsp;<span class="op" id="4540050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540054">//&nbsp;The&nbsp;client&nbsp;didn&#39;t&nbsp;include&nbsp;a&nbsp;session&nbsp;ticket,&nbsp;or&nbsp;it&nbsp;wasn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4540116">//&nbsp;valid&nbsp;so&nbsp;we&nbsp;do&nbsp;a&nbsp;full&nbsp;handshake.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540154">if</span>&nbsp;<span class="ident" id="4540157">err</span>&nbsp;<span class="op" id="4540161">:=</span>&nbsp;<span class="ident" id="4540164"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4540166">.</span><span class="ident" id="4540167"><a href="/gostd/crypto/tls/handshake_server.go.html#4546957">doFullHandshake</a></span><span class="op" id="4540182">(</span><span class="op" id="4540183">)</span><span class="op" id="4540184">;</span>&nbsp;<span class="ident" id="4540186"><a href="/gostd/crypto/tls/handshake_server.go.html#4540157">err</a></span>&nbsp;<span class="op" id="4540190">!=</span>&nbsp;<span class="builtintype" id="4540193">nil</span>&nbsp;<span class="op" id="4540197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540202">return</span>&nbsp;<span class="ident" id="4540209"><a href="/gostd/crypto/tls/handshake_server.go.html#4540157">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540219">if</span>&nbsp;<span class="ident" id="4540222">err</span>&nbsp;<span class="op" id="4540226">:=</span>&nbsp;<span class="ident" id="4540229"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4540231">.</span><span class="ident" id="4540232"><a href="/gostd/crypto/tls/handshake_server.go.html#4552141">establishKeys</a></span><span class="op" id="4540245">(</span><span class="op" id="4540246">)</span><span class="op" id="4540247">;</span>&nbsp;<span class="ident" id="4540249"><a href="/gostd/crypto/tls/handshake_server.go.html#4540222">err</a></span>&nbsp;<span class="op" id="4540253">!=</span>&nbsp;<span class="builtintype" id="4540256">nil</span>&nbsp;<span class="op" id="4540260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540265">return</span>&nbsp;<span class="ident" id="4540272"><a href="/gostd/crypto/tls/handshake_server.go.html#4540222">err</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540282">if</span>&nbsp;<span class="ident" id="4540285">err</span>&nbsp;<span class="op" id="4540289">:=</span>&nbsp;<span class="ident" id="4540292"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4540294">.</span><span class="ident" id="4540295"><a href="/gostd/crypto/tls/handshake_server.go.html#4553033">readFinished</a></span><span class="op" id="4540307">(</span><span class="ident" id="4540308"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4540309">.</span><span class="ident" id="4540310"><a href="/gostd/crypto/tls/conn.go.html#4462937">firstFinished</a></span><span class="op" id="4540323">[</span><span class="op" id="4540324">:</span><span class="op" id="4540325">]</span><span class="op" id="4540326">)</span><span class="op" id="4540327">;</span>&nbsp;<span class="ident" id="4540329"><a href="/gostd/crypto/tls/handshake_server.go.html#4540285">err</a></span>&nbsp;<span class="op" id="4540333">!=</span>&nbsp;<span class="builtintype" id="4540336">nil</span>&nbsp;<span class="op" id="4540340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540345">return</span>&nbsp;<span class="ident" id="4540352"><a href="/gostd/crypto/tls/handshake_server.go.html#4540285">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540362">if</span>&nbsp;<span class="ident" id="4540365">err</span>&nbsp;<span class="op" id="4540369">:=</span>&nbsp;<span class="ident" id="4540372"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4540374">.</span><span class="ident" id="4540375"><a href="/gostd/crypto/tls/handshake_server.go.html#4554111">sendSessionTicket</a></span><span class="op" id="4540392">(</span><span class="op" id="4540393">)</span><span class="op" id="4540394">;</span>&nbsp;<span class="ident" id="4540396"><a href="/gostd/crypto/tls/handshake_server.go.html#4540365">err</a></span>&nbsp;<span class="op" id="4540400">!=</span>&nbsp;<span class="builtintype" id="4540403">nil</span>&nbsp;<span class="op" id="4540407">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540412">return</span>&nbsp;<span class="ident" id="4540419"><a href="/gostd/crypto/tls/handshake_server.go.html#4540365">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540429">if</span>&nbsp;<span class="ident" id="4540432">err</span>&nbsp;<span class="op" id="4540436">:=</span>&nbsp;<span class="ident" id="4540439"><a href="/gostd/crypto/tls/handshake_server.go.html#4539442">hs</a></span><span class="op" id="4540441">.</span><span class="ident" id="4540442"><a href="/gostd/crypto/tls/handshake_server.go.html#4554603">sendFinished</a></span><span class="op" id="4540454">(</span><span class="builtintype" id="4540455">nil</span><span class="op" id="4540458">)</span><span class="op" id="4540459">;</span>&nbsp;<span class="ident" id="4540461"><a href="/gostd/crypto/tls/handshake_server.go.html#4540432">err</a></span>&nbsp;<span class="op" id="4540465">!=</span>&nbsp;<span class="builtintype" id="4540468">nil</span>&nbsp;<span class="op" id="4540472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540477">return</span>&nbsp;<span class="ident" id="4540484"><a href="/gostd/crypto/tls/handshake_server.go.html#4540432">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540490">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540496"><a href="/gostd/crypto/tls/handshake_server.go.html#4539238">c</a></span><span class="op" id="4540497">.</span><span class="ident" id="4540498"><a href="/gostd/crypto/tls/conn.go.html#4462343">handshakeComplete</a></span>&nbsp;<span class="op" id="4540516">=</span>&nbsp;<span class="builtintype" id="4540518">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540525">return</span>&nbsp;<span class="builtintype" id="4540532">nil</span><br>
<span class="lineno"></span><span class="op" id="4540536">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4540539">//&nbsp;readClientHello&nbsp;reads&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;from&nbsp;the&nbsp;client&nbsp;and&nbsp;decides</span><br>
<span class="lineno"></span><span class="comment" id="4540614">//&nbsp;whether&nbsp;we&nbsp;will&nbsp;perform&nbsp;session&nbsp;resumption.</span><br>
<span class="lineno"></span><span class="keyword" id="4540661">func</span>&nbsp;<span class="op" id="4540666">(</span><span class="ident" id="4540667">hs</span>&nbsp;<span class="op" id="4540670">*</span><span class="ident" id="4540671"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4540691">)</span>&nbsp;<span class="ident" id="4540693">readClientHello</span><span class="op" id="4540708">(</span><span class="op" id="4540709">)</span>&nbsp;<span class="op" id="4540711">(</span><span class="ident" id="4540712">isResume</span>&nbsp;<span class="builtintype" id="4540721">bool</span><span class="op" id="4540725">,</span>&nbsp;<span class="ident" id="4540727">err</span>&nbsp;<span class="builtintype" id="4540731">error</span><span class="op" id="4540736">)</span>&nbsp;<span class="op" id="4540738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540741">config</span>&nbsp;<span class="op" id="4540748">:=</span>&nbsp;<span class="ident" id="4540751"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4540753">.</span><span class="ident" id="4540754"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><span class="op" id="4540755">.</span><span class="ident" id="4540756"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540764">c</span>&nbsp;<span class="op" id="4540766">:=</span>&nbsp;<span class="ident" id="4540769"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4540771">.</span><span class="ident" id="4540772"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540776">msg</span><span class="op" id="4540779">,</span>&nbsp;<span class="ident" id="4540781"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4540785">:=</span>&nbsp;<span class="ident" id="4540788"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4540789">.</span><span class="ident" id="4540790"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4540803">(</span><span class="op" id="4540804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540807">if</span>&nbsp;<span class="ident" id="4540810"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4540814">!=</span>&nbsp;<span class="builtintype" id="4540817">nil</span>&nbsp;<span class="op" id="4540821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540825">return</span>&nbsp;<span class="builtintype" id="4540832">false</span><span class="op" id="4540837">,</span>&nbsp;<span class="ident" id="4540839"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4540844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540847">var</span>&nbsp;<span class="ident" id="4540851">ok</span>&nbsp;<span class="builtintype" id="4540854">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540860"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4540862">.</span><span class="ident" id="4540863"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4540874">,</span>&nbsp;<span class="ident" id="4540876"><a href="/gostd/crypto/tls/handshake_server.go.html#4540851">ok</a></span>&nbsp;<span class="op" id="4540879">=</span>&nbsp;<span class="ident" id="4540881"><a href="/gostd/crypto/tls/handshake_server.go.html#4540776">msg</a></span><span class="op" id="4540884">.</span><span class="op" id="4540885">(</span><span class="op" id="4540886">*</span><span class="ident" id="4540887"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4540901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540904">if</span>&nbsp;<span class="op" id="4540907">!</span><span class="ident" id="4540908"><a href="/gostd/crypto/tls/handshake_server.go.html#4540851">ok</a></span>&nbsp;<span class="op" id="4540911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4540915"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4540916">.</span><span class="ident" id="4540917"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4540926">(</span><span class="ident" id="4540927"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4540949">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4540953">return</span>&nbsp;<span class="builtintype" id="4540960">false</span><span class="op" id="4540965">,</span>&nbsp;<span class="ident" id="4540967"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4540989">(</span><span class="ident" id="4540990"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4540992">.</span><span class="ident" id="4540993"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541004">,</span>&nbsp;<span class="ident" id="4541006"><a href="/gostd/crypto/tls/handshake_server.go.html#4540776">msg</a></span><span class="op" id="4541009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541015"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4541016">.</span><span class="ident" id="4541017"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4541021">,</span>&nbsp;<span class="ident" id="4541023"><a href="/gostd/crypto/tls/handshake_server.go.html#4540851">ok</a></span>&nbsp;<span class="op" id="4541026">=</span>&nbsp;<span class="ident" id="4541028"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4541034">.</span><span class="ident" id="4541035"><a href="/gostd/crypto/tls/common.go.html#4455994">mutualVersion</a></span><span class="op" id="4541048">(</span><span class="ident" id="4541049"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541051">.</span><span class="ident" id="4541052"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541063">.</span><span class="ident" id="4541064"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="4541068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541071">if</span>&nbsp;<span class="op" id="4541074">!</span><span class="ident" id="4541075"><a href="/gostd/crypto/tls/handshake_server.go.html#4540851">ok</a></span>&nbsp;<span class="op" id="4541078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541082"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4541083">.</span><span class="ident" id="4541084"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4541093">(</span><span class="ident" id="4541094"><a href="/gostd/crypto/tls/alert.go.html#4430936">alertProtocolVersion</a></span><span class="op" id="4541114">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541118">return</span>&nbsp;<span class="builtintype" id="4541125">false</span><span class="op" id="4541130">,</span>&nbsp;<span class="ident" id="4541132"><a href="/gostd/crypto/tls/handshake_server.go.html#4538690">fmt</a></span><span class="op" id="4541135">.</span><span class="ident" id="4541136"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4541142">(</span><span class="string" id="4541143">&#34;tls:&nbsp;client&nbsp;offered&nbsp;an&nbsp;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&nbsp;of&nbsp;%x&#34;</span><span class="op" id="4541211">,</span>&nbsp;<span class="ident" id="4541213"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541215">.</span><span class="ident" id="4541216"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541227">.</span><span class="ident" id="4541228"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="4541232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541238"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4541239">.</span><span class="ident" id="4541240"><a href="/gostd/crypto/tls/conn.go.html#4462213">haveVers</a></span>&nbsp;<span class="op" id="4541249">=</span>&nbsp;<span class="builtintype" id="4541251">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541258"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541260">.</span><span class="ident" id="4541261"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span>&nbsp;<span class="op" id="4541274">=</span>&nbsp;<span class="ident" id="4541276"><a href="/gostd/crypto/tls/prf.go.html#4575432">newFinishedHash</a></span><span class="op" id="4541291">(</span><span class="ident" id="4541292"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4541293">.</span><span class="ident" id="4541294"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4541298">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541301"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541303">.</span><span class="ident" id="4541304"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4541316">.</span><span class="ident" id="4541317"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4541322">(</span><span class="ident" id="4541323"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541325">.</span><span class="ident" id="4541326"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541337">.</span><span class="ident" id="4541338"><a href="/gostd/crypto/tls/handshake_messages.go.html#4509641">marshal</a></span><span class="op" id="4541345">(</span><span class="op" id="4541346">)</span><span class="op" id="4541347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541351"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541353">.</span><span class="ident" id="4541354"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span>&nbsp;<span class="op" id="4541360">=</span>&nbsp;<span class="builtinfunc" id="4541362">new</span><span class="op" id="4541365">(</span><span class="ident" id="4541366"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4541380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541384">supportedCurve</span>&nbsp;<span class="op" id="4541399">:=</span>&nbsp;<span class="builtintype" id="4541402">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541409">preferredCurves</span>&nbsp;<span class="op" id="4541425">:=</span>&nbsp;<span class="ident" id="4541428"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4541434">.</span><span class="ident" id="4541435"><a href="/gostd/crypto/tls/common.go.html#4455735">curvePreferences</a></span><span class="op" id="4541451">(</span><span class="op" id="4541452">)</span><br>
<span class="lineno"></span><span class="ident" id="4541454">Curves</span><span class="op" id="4541460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541463">for</span>&nbsp;<span class="ident" id="4541467">_</span><span class="op" id="4541468">,</span>&nbsp;<span class="ident" id="4541470">curve</span>&nbsp;<span class="op" id="4541476">:=</span>&nbsp;<span class="keyword" id="4541479">range</span>&nbsp;<span class="ident" id="4541485"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541487">.</span><span class="ident" id="4541488"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541499">.</span><span class="ident" id="4541500"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508542">supportedCurves</a></span>&nbsp;<span class="op" id="4541516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541520">for</span>&nbsp;<span class="ident" id="4541524">_</span><span class="op" id="4541525">,</span>&nbsp;<span class="ident" id="4541527">supported</span>&nbsp;<span class="op" id="4541537">:=</span>&nbsp;<span class="keyword" id="4541540">range</span>&nbsp;<span class="ident" id="4541546"><a href="/gostd/crypto/tls/handshake_server.go.html#4541409">preferredCurves</a></span>&nbsp;<span class="op" id="4541562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541567">if</span>&nbsp;<span class="ident" id="4541570"><a href="/gostd/crypto/tls/handshake_server.go.html#4541527">supported</a></span>&nbsp;<span class="op" id="4541580">==</span>&nbsp;<span class="ident" id="4541583"><a href="/gostd/crypto/tls/handshake_server.go.html#4541470">curve</a></span>&nbsp;<span class="op" id="4541589">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541595"><a href="/gostd/crypto/tls/handshake_server.go.html#4541384">supportedCurve</a></span>&nbsp;<span class="op" id="4541610">=</span>&nbsp;<span class="builtintype" id="4541612">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541621">break</span>&nbsp;<span class="ident" id="4541627"><a href="/gostd/crypto/tls/handshake_server.go.html#4541454">Curves</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541644">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541648">supportedPointFormat</span>&nbsp;<span class="op" id="4541669">:=</span>&nbsp;<span class="builtintype" id="4541672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541679">for</span>&nbsp;<span class="ident" id="4541683">_</span><span class="op" id="4541684">,</span>&nbsp;<span class="ident" id="4541686">pointFormat</span>&nbsp;<span class="op" id="4541698">:=</span>&nbsp;<span class="keyword" id="4541701">range</span>&nbsp;<span class="ident" id="4541707"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541709">.</span><span class="ident" id="4541710"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4541721">.</span><span class="ident" id="4541722"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508573">supportedPoints</a></span>&nbsp;<span class="op" id="4541738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541742">if</span>&nbsp;<span class="ident" id="4541745"><a href="/gostd/crypto/tls/handshake_server.go.html#4541686">pointFormat</a></span>&nbsp;<span class="op" id="4541757">==</span>&nbsp;<span class="ident" id="4541760"><a href="/gostd/crypto/tls/common.go.html#4444571">pointFormatUncompressed</a></span>&nbsp;<span class="op" id="4541784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541789"><a href="/gostd/crypto/tls/handshake_server.go.html#4541648">supportedPointFormat</a></span>&nbsp;<span class="op" id="4541810">=</span>&nbsp;<span class="builtintype" id="4541812">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541820">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4541831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541834"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4541836">.</span><span class="ident" id="4541837"><a href="/gostd/crypto/tls/handshake_server.go.html#4538988">ellipticOk</a></span>&nbsp;<span class="op" id="4541848">=</span>&nbsp;<span class="ident" id="4541850"><a href="/gostd/crypto/tls/handshake_server.go.html#4541384">supportedCurve</a></span>&nbsp;<span class="op" id="4541865">&amp;&amp;</span>&nbsp;<span class="ident" id="4541868"><a href="/gostd/crypto/tls/handshake_server.go.html#4541648">supportedPointFormat</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4541891">foundCompression</span>&nbsp;<span class="op" id="4541908">:=</span>&nbsp;<span class="builtintype" id="4541911">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4541918">//&nbsp;We&nbsp;only&nbsp;support&nbsp;null&nbsp;compression,&nbsp;so&nbsp;check&nbsp;that&nbsp;the&nbsp;client&nbsp;offered&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4541993">for</span>&nbsp;<span class="ident" id="4541997">_</span><span class="op" id="4541998">,</span>&nbsp;<span class="ident" id="4542000">compression</span>&nbsp;<span class="op" id="4542012">:=</span>&nbsp;<span class="keyword" id="4542015">range</span>&nbsp;<span class="ident" id="4542021"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542023">.</span><span class="ident" id="4542024"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542035">.</span><span class="ident" id="4542036"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508433">compressionMethods</a></span>&nbsp;<span class="op" id="4542055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542059">if</span>&nbsp;<span class="ident" id="4542062"><a href="/gostd/crypto/tls/handshake_server.go.html#4542000">compression</a></span>&nbsp;<span class="op" id="4542074">==</span>&nbsp;<span class="ident" id="4542077"><a href="/gostd/crypto/tls/common.go.html#4443628">compressionNone</a></span>&nbsp;<span class="op" id="4542093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542098"><a href="/gostd/crypto/tls/handshake_server.go.html#4541891">foundCompression</a></span>&nbsp;<span class="op" id="4542115">=</span>&nbsp;<span class="builtintype" id="4542117">true</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542125">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542140">if</span>&nbsp;<span class="op" id="4542143">!</span><span class="ident" id="4542144"><a href="/gostd/crypto/tls/handshake_server.go.html#4541891">foundCompression</a></span>&nbsp;<span class="op" id="4542161">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542165"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542166">.</span><span class="ident" id="4542167"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4542176">(</span><span class="ident" id="4542177"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4542198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542202">return</span>&nbsp;<span class="builtintype" id="4542209">false</span><span class="op" id="4542214">,</span>&nbsp;<span class="ident" id="4542216"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4542222">.</span><span class="ident" id="4542223"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4542226">(</span><span class="string" id="4542227">&#34;tls:&nbsp;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="4542282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542289"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542291">.</span><span class="ident" id="4542292"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542297">.</span><span class="ident" id="4542298"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519435">vers</a></span>&nbsp;<span class="op" id="4542303">=</span>&nbsp;<span class="ident" id="4542305"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542306">.</span><span class="ident" id="4542307"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542313"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542315">.</span><span class="ident" id="4542316"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542321">.</span><span class="ident" id="4542322"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span>&nbsp;<span class="op" id="4542329">=</span>&nbsp;<span class="builtinfunc" id="4542331">make</span><span class="op" id="4542335">(</span><span class="op" id="4542336">[</span><span class="op" id="4542337">]</span><span class="builtintype" id="4542338">byte</span><span class="op" id="4542342">,</span>&nbsp;<span class="num" id="4542344">32</span><span class="op" id="4542346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542349">_</span><span class="op" id="4542350">,</span>&nbsp;<span class="ident" id="4542352"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4542356">=</span>&nbsp;<span class="ident" id="4542358"><a href="/gostd/crypto/tls/handshake_server.go.html#4538697">io</a></span><span class="op" id="4542360">.</span><span class="ident" id="4542361"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4542369">(</span><span class="ident" id="4542370"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4542376">.</span><span class="ident" id="4542377"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4542381">(</span><span class="op" id="4542382">)</span><span class="op" id="4542383">,</span>&nbsp;<span class="ident" id="4542385"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542387">.</span><span class="ident" id="4542388"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542393">.</span><span class="ident" id="4542394"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4542400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542403">if</span>&nbsp;<span class="ident" id="4542406"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4542410">!=</span>&nbsp;<span class="builtintype" id="4542413">nil</span>&nbsp;<span class="op" id="4542417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542421"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542422">.</span><span class="ident" id="4542423"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4542432">(</span><span class="ident" id="4542433"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4542451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542455">return</span>&nbsp;<span class="builtintype" id="4542462">false</span><span class="op" id="4542467">,</span>&nbsp;<span class="ident" id="4542469"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542477"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542479">.</span><span class="ident" id="4542480"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542485">.</span><span class="ident" id="4542486"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519682">secureRenegotiation</a></span>&nbsp;<span class="op" id="4542506">=</span>&nbsp;<span class="ident" id="4542508"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542510">.</span><span class="ident" id="4542511"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542522">.</span><span class="ident" id="4542523"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508697">secureRenegotiation</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542544"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542546">.</span><span class="ident" id="4542547"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542552">.</span><span class="ident" id="4542553"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519547">compressionMethod</a></span>&nbsp;<span class="op" id="4542571">=</span>&nbsp;<span class="ident" id="4542573"><a href="/gostd/crypto/tls/common.go.html#4443628">compressionNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542590">if</span>&nbsp;<span class="builtinfunc" id="4542593">len</span><span class="op" id="4542596">(</span><span class="ident" id="4542597"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542599">.</span><span class="ident" id="4542600"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542611">.</span><span class="ident" id="4542612"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508488">serverName</a></span><span class="op" id="4542622">)</span>&nbsp;<span class="op" id="4542624">&gt;</span>&nbsp;<span class="num" id="4542626">0</span>&nbsp;<span class="op" id="4542628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542632"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542633">.</span><span class="ident" id="4542634"><a href="/gostd/crypto/tls/conn.go.html#4462788">serverName</a></span>&nbsp;<span class="op" id="4542645">=</span>&nbsp;<span class="ident" id="4542647"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542649">.</span><span class="ident" id="4542650"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542661">.</span><span class="ident" id="4542662"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508488">serverName</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542678">if</span>&nbsp;<span class="builtinfunc" id="4542681">len</span><span class="op" id="4542684">(</span><span class="ident" id="4542685"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542687">.</span><span class="ident" id="4542688"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542699">.</span><span class="ident" id="4542700"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508723">alpnProtocols</a></span><span class="op" id="4542713">)</span>&nbsp;<span class="op" id="4542715">&gt;</span>&nbsp;<span class="num" id="4542717">0</span>&nbsp;<span class="op" id="4542719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4542723">if</span>&nbsp;<span class="ident" id="4542726">selectedProto</span><span class="op" id="4542739">,</span>&nbsp;<span class="ident" id="4542741">fallback</span>&nbsp;<span class="op" id="4542750">:=</span>&nbsp;<span class="ident" id="4542753"><a href="/gostd/crypto/tls/handshake_client.go.html#4507863">mutualProtocol</a></span><span class="op" id="4542767">(</span><span class="ident" id="4542768"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542770">.</span><span class="ident" id="4542771"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4542782">.</span><span class="ident" id="4542783"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508723">alpnProtocols</a></span><span class="op" id="4542796">,</span>&nbsp;<span class="ident" id="4542798"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542799">.</span><span class="ident" id="4542800"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4542806">.</span><span class="ident" id="4542807"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><span class="op" id="4542817">)</span><span class="op" id="4542818">;</span>&nbsp;<span class="op" id="4542820">!</span><span class="ident" id="4542821"><a href="/gostd/crypto/tls/handshake_server.go.html#4542741">fallback</a></span>&nbsp;<span class="op" id="4542830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542835"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4542837">.</span><span class="ident" id="4542838"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4542843">.</span><span class="ident" id="4542844"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519708">alpnProtocol</a></span>&nbsp;<span class="op" id="4542857">=</span>&nbsp;<span class="ident" id="4542859"><a href="/gostd/crypto/tls/handshake_server.go.html#4542726">selectedProto</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542876"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4542877">.</span><span class="ident" id="4542878"><a href="/gostd/crypto/tls/conn.go.html#4462962">clientProtocol</a></span>&nbsp;<span class="op" id="4542893">=</span>&nbsp;<span class="ident" id="4542895"><a href="/gostd/crypto/tls/handshake_server.go.html#4542726">selectedProto</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4542914">}</span>&nbsp;<span class="keyword" id="4542916">else</span>&nbsp;<span class="op" id="4542921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4542925">//&nbsp;Although&nbsp;sending&nbsp;an&nbsp;empty&nbsp;NPN&nbsp;extension&nbsp;is&nbsp;reasonable,&nbsp;Firefox&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4542997">//&nbsp;had&nbsp;a&nbsp;bug&nbsp;around&nbsp;this.&nbsp;Best&nbsp;to&nbsp;send&nbsp;nothing&nbsp;at&nbsp;all&nbsp;if</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543056">//&nbsp;config.NextProtos&nbsp;is&nbsp;empty.&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4543093">//&nbsp;https://code.google.com/p/go/issues/detail?id=5445.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543150">if</span>&nbsp;<span class="ident" id="4543153"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543155">.</span><span class="ident" id="4543156"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543167">.</span><span class="ident" id="4543168"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508462">nextProtoNeg</a></span>&nbsp;<span class="op" id="4543181">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4543184">len</span><span class="op" id="4543187">(</span><span class="ident" id="4543188"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4543194">.</span><span class="ident" id="4543195"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><span class="op" id="4543205">)</span>&nbsp;<span class="op" id="4543207">&gt;</span>&nbsp;<span class="num" id="4543209">0</span>&nbsp;<span class="op" id="4543211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543216"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543218">.</span><span class="ident" id="4543219"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4543224">.</span><span class="ident" id="4543225"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519574">nextProtoNeg</a></span>&nbsp;<span class="op" id="4543238">=</span>&nbsp;<span class="builtintype" id="4543240">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543248"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543250">.</span><span class="ident" id="4543251"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4543256">.</span><span class="ident" id="4543257"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519600">nextProtos</a></span>&nbsp;<span class="op" id="4543268">=</span>&nbsp;<span class="ident" id="4543270"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4543276">.</span><span class="ident" id="4543277"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543297">if</span>&nbsp;<span class="builtinfunc" id="4543300">len</span><span class="op" id="4543303">(</span><span class="ident" id="4543304"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4543310">.</span><span class="ident" id="4543311"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4543323">)</span>&nbsp;<span class="op" id="4543325">==</span>&nbsp;<span class="num" id="4543328">0</span>&nbsp;<span class="op" id="4543330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543334"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4543335">.</span><span class="ident" id="4543336"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4543345">(</span><span class="ident" id="4543346"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4543364">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543368">return</span>&nbsp;<span class="builtintype" id="4543375">false</span><span class="op" id="4543380">,</span>&nbsp;<span class="ident" id="4543382"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4543388">.</span><span class="ident" id="4543389"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4543392">(</span><span class="string" id="4543393">&#34;tls:&nbsp;no&nbsp;certificates&nbsp;configured&#34;</span><span class="op" id="4543426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543432"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543434">.</span><span class="ident" id="4543435"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span>&nbsp;<span class="op" id="4543440">=</span>&nbsp;<span class="op" id="4543442">&amp;</span><span class="ident" id="4543443"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4543449">.</span><span class="ident" id="4543450"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4543462">[</span><span class="num" id="4543463">0</span><span class="op" id="4543464">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543467">if</span>&nbsp;<span class="builtinfunc" id="4543470">len</span><span class="op" id="4543473">(</span><span class="ident" id="4543474"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543476">.</span><span class="ident" id="4543477"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543488">.</span><span class="ident" id="4543489"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508488">serverName</a></span><span class="op" id="4543499">)</span>&nbsp;<span class="op" id="4543501">&gt;</span>&nbsp;<span class="num" id="4543503">0</span>&nbsp;<span class="op" id="4543505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543509">chi</span>&nbsp;<span class="op" id="4543513">:=</span>&nbsp;<span class="op" id="4543516">&amp;</span><span class="ident" id="4543517"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="4543532">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543537"><a href="/gostd/crypto/tls/common.go.html#4449498">CipherSuites</a></span><span class="op" id="4543549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543554"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543556">.</span><span class="ident" id="4543557"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543568">.</span><span class="ident" id="4543569"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><span class="op" id="4543581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543586"><a href="/gostd/crypto/tls/common.go.html#4449747">ServerName</a></span><span class="op" id="4543596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543603"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543605">.</span><span class="ident" id="4543606"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543617">.</span><span class="ident" id="4543618"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508488">serverName</a></span><span class="op" id="4543628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543633"><a href="/gostd/crypto/tls/common.go.html#4449991">SupportedCurves</a></span><span class="op" id="4543648">:</span>&nbsp;<span class="ident" id="4543650"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543652">.</span><span class="ident" id="4543653"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543664">.</span><span class="ident" id="4543665"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508542">supportedCurves</a></span><span class="op" id="4543680">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543685"><a href="/gostd/crypto/tls/common.go.html#4450239">SupportedPoints</a></span><span class="op" id="4543700">:</span>&nbsp;<span class="ident" id="4543702"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543704">.</span><span class="ident" id="4543705"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4543716">.</span><span class="ident" id="4543717"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508573">supportedPoints</a></span><span class="op" id="4543732">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543736">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543740">if</span>&nbsp;<span class="ident" id="4543743"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543745">.</span><span class="ident" id="4543746"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4543750">,</span>&nbsp;<span class="ident" id="4543752"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4543756">=</span>&nbsp;<span class="ident" id="4543758"><a href="/gostd/crypto/tls/handshake_server.go.html#4540741">config</a></span><span class="op" id="4543764">.</span><span class="ident" id="4543765"><a href="/gostd/crypto/tls/common.go.html#4456362">getCertificate</a></span><span class="op" id="4543779">(</span><span class="ident" id="4543780"><a href="/gostd/crypto/tls/handshake_server.go.html#4543509">chi</a></span><span class="op" id="4543783">)</span><span class="op" id="4543784">;</span>&nbsp;<span class="ident" id="4543786"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span>&nbsp;<span class="op" id="4543790">!=</span>&nbsp;<span class="builtintype" id="4543793">nil</span>&nbsp;<span class="op" id="4543797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543802"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4543803">.</span><span class="ident" id="4543804"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4543813">(</span><span class="ident" id="4543814"><a href="/gostd/crypto/tls/alert.go.html#4431016">alertInternalError</a></span><span class="op" id="4543832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543837">return</span>&nbsp;<span class="builtintype" id="4543844">false</span><span class="op" id="4543849">,</span>&nbsp;<span class="ident" id="4543851"><a href="/gostd/crypto/tls/handshake_server.go.html#4540727">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543860">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543864">_</span><span class="op" id="4543865">,</span>&nbsp;<span class="ident" id="4543867"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543869">.</span><span class="ident" id="4543870"><a href="/gostd/crypto/tls/handshake_server.go.html#4539010">ecdsaOk</a></span>&nbsp;<span class="op" id="4543878">=</span>&nbsp;<span class="ident" id="4543880"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543882">.</span><span class="ident" id="4543883"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4543887">.</span><span class="ident" id="4543888"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4543898">.</span><span class="op" id="4543899">(</span><span class="op" id="4543900">*</span><span class="ident" id="4543901"><a href="/gostd/crypto/tls/handshake_server.go.html#4538601">ecdsa</a></span><span class="op" id="4543906">.</span><span class="ident" id="4543907"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="4543917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543921">if</span>&nbsp;<span class="ident" id="4543924"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4543926">.</span><span class="ident" id="4543927"><a href="/gostd/crypto/tls/handshake_server.go.html#4545097">checkForResumption</a></span><span class="op" id="4543945">(</span><span class="op" id="4543946">)</span>&nbsp;<span class="op" id="4543948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543952">return</span>&nbsp;<span class="builtintype" id="4543959">true</span><span class="op" id="4543963">,</span>&nbsp;<span class="builtintype" id="4543965">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543974">var</span>&nbsp;<span class="ident" id="4543978">preferenceList</span><span class="op" id="4543992">,</span>&nbsp;<span class="ident" id="4543994">supportedList</span>&nbsp;<span class="op" id="4544008">[</span><span class="op" id="4544009">]</span><span class="builtintype" id="4544010">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544018">if</span>&nbsp;<span class="ident" id="4544021"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544022">.</span><span class="ident" id="4544023"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4544029">.</span><span class="ident" id="4544030"><a href="/gostd/crypto/tls/common.go.html#4453426">PreferServerCipherSuites</a></span>&nbsp;<span class="op" id="4544055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544059"><a href="/gostd/crypto/tls/handshake_server.go.html#4543978">preferenceList</a></span>&nbsp;<span class="op" id="4544074">=</span>&nbsp;<span class="ident" id="4544076"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544077">.</span><span class="ident" id="4544078"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4544084">.</span><span class="ident" id="4544085"><a href="/gostd/crypto/tls/common.go.html#4455294">cipherSuites</a></span><span class="op" id="4544097">(</span><span class="op" id="4544098">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544102"><a href="/gostd/crypto/tls/handshake_server.go.html#4543994">supportedList</a></span>&nbsp;<span class="op" id="4544116">=</span>&nbsp;<span class="ident" id="4544118"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544120">.</span><span class="ident" id="4544121"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4544132">.</span><span class="ident" id="4544133"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544147">}</span>&nbsp;<span class="keyword" id="4544149">else</span>&nbsp;<span class="op" id="4544154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544158"><a href="/gostd/crypto/tls/handshake_server.go.html#4543978">preferenceList</a></span>&nbsp;<span class="op" id="4544173">=</span>&nbsp;<span class="ident" id="4544175"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544177">.</span><span class="ident" id="4544178"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4544189">.</span><span class="ident" id="4544190"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544205"><a href="/gostd/crypto/tls/handshake_server.go.html#4543994">supportedList</a></span>&nbsp;<span class="op" id="4544219">=</span>&nbsp;<span class="ident" id="4544221"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544222">.</span><span class="ident" id="4544223"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4544229">.</span><span class="ident" id="4544230"><a href="/gostd/crypto/tls/common.go.html#4455294">cipherSuites</a></span><span class="op" id="4544242">(</span><span class="op" id="4544243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544246">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544250">for</span>&nbsp;<span class="ident" id="4544254">_</span><span class="op" id="4544255">,</span>&nbsp;<span class="ident" id="4544257">id</span>&nbsp;<span class="op" id="4544260">:=</span>&nbsp;<span class="keyword" id="4544263">range</span>&nbsp;<span class="ident" id="4544269"><a href="/gostd/crypto/tls/handshake_server.go.html#4543978">preferenceList</a></span>&nbsp;<span class="op" id="4544284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544288">if</span>&nbsp;<span class="ident" id="4544291"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544293">.</span><span class="ident" id="4544294"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span>&nbsp;<span class="op" id="4544300">=</span>&nbsp;<span class="ident" id="4544302"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544303">.</span><span class="ident" id="4544304"><a href="/gostd/crypto/tls/handshake_server.go.html#4557043">tryCipherSuite</a></span><span class="op" id="4544318">(</span><span class="ident" id="4544319"><a href="/gostd/crypto/tls/handshake_server.go.html#4544257">id</a></span><span class="op" id="4544321">,</span>&nbsp;<span class="ident" id="4544323"><a href="/gostd/crypto/tls/handshake_server.go.html#4543994">supportedList</a></span><span class="op" id="4544336">,</span>&nbsp;<span class="ident" id="4544338"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544339">.</span><span class="ident" id="4544340"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4544344">,</span>&nbsp;<span class="ident" id="4544346"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544348">.</span><span class="ident" id="4544349"><a href="/gostd/crypto/tls/handshake_server.go.html#4538988">ellipticOk</a></span><span class="op" id="4544359">,</span>&nbsp;<span class="ident" id="4544361"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544363">.</span><span class="ident" id="4544364"><a href="/gostd/crypto/tls/handshake_server.go.html#4539010">ecdsaOk</a></span><span class="op" id="4544371">)</span><span class="op" id="4544372">;</span>&nbsp;<span class="ident" id="4544374"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544376">.</span><span class="ident" id="4544377"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span>&nbsp;<span class="op" id="4544383">!=</span>&nbsp;<span class="builtintype" id="4544386">nil</span>&nbsp;<span class="op" id="4544390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544395">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544403">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544410">if</span>&nbsp;<span class="ident" id="4544413"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544415">.</span><span class="ident" id="4544416"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span>&nbsp;<span class="op" id="4544422">==</span>&nbsp;<span class="builtintype" id="4544425">nil</span>&nbsp;<span class="op" id="4544429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544433"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544434">.</span><span class="ident" id="4544435"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4544444">(</span><span class="ident" id="4544445"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4544466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544470">return</span>&nbsp;<span class="builtintype" id="4544477">false</span><span class="op" id="4544482">,</span>&nbsp;<span class="ident" id="4544484"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4544490">.</span><span class="ident" id="4544491"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4544494">(</span><span class="string" id="4544495">&#34;tls:&nbsp;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="4544553">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4544560">//&nbsp;See&nbsp;https://tools.ietf.org/html/draft-ietf-tls-downgrade-scsv-00.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544630">for</span>&nbsp;<span class="ident" id="4544634">_</span><span class="op" id="4544635">,</span>&nbsp;<span class="ident" id="4544637">id</span>&nbsp;<span class="op" id="4544640">:=</span>&nbsp;<span class="keyword" id="4544643">range</span>&nbsp;<span class="ident" id="4544649"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544651">.</span><span class="ident" id="4544652"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4544663">.</span><span class="ident" id="4544664"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span>&nbsp;<span class="op" id="4544677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544681">if</span>&nbsp;<span class="ident" id="4544684"><a href="/gostd/crypto/tls/handshake_server.go.html#4544637">id</a></span>&nbsp;<span class="op" id="4544687">==</span>&nbsp;<span class="ident" id="4544690"><a href="/gostd/crypto/tls/cipher_suites.go.html#4442099">TLS_FALLBACK_SCSV</a></span>&nbsp;<span class="op" id="4544708">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4544713">//&nbsp;The&nbsp;client&nbsp;is&nbsp;doing&nbsp;a&nbsp;fallback&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544762">if</span>&nbsp;<span class="ident" id="4544765"><a href="/gostd/crypto/tls/handshake_server.go.html#4540667">hs</a></span><span class="op" id="4544767">.</span><span class="ident" id="4544768"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4544779">.</span><span class="ident" id="4544780"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span>&nbsp;<span class="op" id="4544785">&lt;</span>&nbsp;<span class="ident" id="4544787"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544788">.</span><span class="ident" id="4544789"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4544795">.</span><span class="ident" id="4544796"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span>&nbsp;<span class="op" id="4544807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544813"><a href="/gostd/crypto/tls/handshake_server.go.html#4540764">c</a></span><span class="op" id="4544814">.</span><span class="ident" id="4544815"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4544824">(</span><span class="ident" id="4544825"><a href="/gostd/crypto/tls/alert.go.html#4431056">alertInappropriateFallback</a></span><span class="op" id="4544851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544857">return</span>&nbsp;<span class="builtintype" id="4544864">false</span><span class="op" id="4544869">,</span>&nbsp;<span class="ident" id="4544871"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4544877">.</span><span class="ident" id="4544878"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4544881">(</span><span class="string" id="4544882">&#34;tls:&nbsp;client&nbsp;using&nbsp;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="4544932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544937">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544942">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544957">return</span>&nbsp;<span class="builtintype" id="4544964">false</span><span class="op" id="4544969">,</span>&nbsp;<span class="builtintype" id="4544971">nil</span><br>
<span class="lineno">240</span><span class="op" id="4544975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4544978">//&nbsp;checkForResumption&nbsp;returns&nbsp;true&nbsp;if&nbsp;we&nbsp;should&nbsp;perform&nbsp;resumption&nbsp;on&nbsp;this&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4545065">func</span>&nbsp;<span class="op" id="4545070">(</span><span class="ident" id="4545071">hs</span>&nbsp;<span class="op" id="4545074">*</span><span class="ident" id="4545075"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4545095">)</span>&nbsp;<span class="ident" id="4545097">checkForResumption</span><span class="op" id="4545115">(</span><span class="op" id="4545116">)</span>&nbsp;<span class="builtintype" id="4545118">bool</span>&nbsp;<span class="op" id="4545123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545126">c</span>&nbsp;<span class="op" id="4545128">:=</span>&nbsp;<span class="ident" id="4545131"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545133">.</span><span class="ident" id="4545134"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545138">if</span>&nbsp;<span class="ident" id="4545141"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4545142">.</span><span class="ident" id="4545143"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4545149">.</span><span class="ident" id="4545150"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span>&nbsp;<span class="op" id="4545173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545177">return</span>&nbsp;<span class="builtintype" id="4545184">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545195">var</span>&nbsp;<span class="ident" id="4545199">ok</span>&nbsp;<span class="builtintype" id="4545202">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545208">if</span>&nbsp;<span class="ident" id="4545211"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545213">.</span><span class="ident" id="4545214"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545226">,</span>&nbsp;<span class="ident" id="4545228"><a href="/gostd/crypto/tls/handshake_server.go.html#4545199">ok</a></span>&nbsp;<span class="op" id="4545231">=</span>&nbsp;<span class="ident" id="4545233"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4545234">.</span><span class="ident" id="4545235"><a href="/gostd/crypto/tls/ticket.go.html#4582366">decryptTicket</a></span><span class="op" id="4545248">(</span><span class="ident" id="4545249"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545251">.</span><span class="ident" id="4545252"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4545263">.</span><span class="ident" id="4545264"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508628">sessionTicket</a></span><span class="op" id="4545277">)</span><span class="op" id="4545278">;</span>&nbsp;<span class="op" id="4545280">!</span><span class="ident" id="4545281"><a href="/gostd/crypto/tls/handshake_server.go.html#4545199">ok</a></span>&nbsp;<span class="op" id="4545284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545288">return</span>&nbsp;<span class="builtintype" id="4545295">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545306">if</span>&nbsp;<span class="ident" id="4545309"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545311">.</span><span class="ident" id="4545312"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545324">.</span><span class="ident" id="4545325"><a href="/gostd/crypto/tls/ticket.go.html#4579407">vers</a></span>&nbsp;<span class="op" id="4545330">&gt;</span>&nbsp;<span class="ident" id="4545332"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545334">.</span><span class="ident" id="4545335"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4545346">.</span><span class="ident" id="4545347"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span>&nbsp;<span class="op" id="4545352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545356">return</span>&nbsp;<span class="builtintype" id="4545363">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545373">if</span>&nbsp;<span class="ident" id="4545376">vers</span><span class="op" id="4545380">,</span>&nbsp;<span class="ident" id="4545382">ok</span>&nbsp;<span class="op" id="4545385">:=</span>&nbsp;<span class="ident" id="4545388"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4545389">.</span><span class="ident" id="4545390"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4545396">.</span><span class="ident" id="4545397"><a href="/gostd/crypto/tls/common.go.html#4455994">mutualVersion</a></span><span class="op" id="4545410">(</span><span class="ident" id="4545411"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545413">.</span><span class="ident" id="4545414"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545426">.</span><span class="ident" id="4545427"><a href="/gostd/crypto/tls/ticket.go.html#4579407">vers</a></span><span class="op" id="4545431">)</span><span class="op" id="4545432">;</span>&nbsp;<span class="op" id="4545434">!</span><span class="ident" id="4545435"><a href="/gostd/crypto/tls/handshake_server.go.html#4545382">ok</a></span>&nbsp;<span class="op" id="4545438">||</span>&nbsp;<span class="ident" id="4545441"><a href="/gostd/crypto/tls/handshake_server.go.html#4545376">vers</a></span>&nbsp;<span class="op" id="4545446">!=</span>&nbsp;<span class="ident" id="4545449"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545451">.</span><span class="ident" id="4545452"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545464">.</span><span class="ident" id="4545465"><a href="/gostd/crypto/tls/ticket.go.html#4579407">vers</a></span>&nbsp;<span class="op" id="4545470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545474">return</span>&nbsp;<span class="builtintype" id="4545481">false</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545492">cipherSuiteOk</span>&nbsp;<span class="op" id="4545506">:=</span>&nbsp;<span class="builtintype" id="4545509">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545516">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;client&nbsp;is&nbsp;still&nbsp;offering&nbsp;the&nbsp;ciphersuite&nbsp;in&nbsp;the&nbsp;session.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545592">for</span>&nbsp;<span class="ident" id="4545596">_</span><span class="op" id="4545597">,</span>&nbsp;<span class="ident" id="4545599">id</span>&nbsp;<span class="op" id="4545602">:=</span>&nbsp;<span class="keyword" id="4545605">range</span>&nbsp;<span class="ident" id="4545611"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545613">.</span><span class="ident" id="4545614"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4545625">.</span><span class="ident" id="4545626"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span>&nbsp;<span class="op" id="4545639">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545643">if</span>&nbsp;<span class="ident" id="4545646"><a href="/gostd/crypto/tls/handshake_server.go.html#4545599">id</a></span>&nbsp;<span class="op" id="4545649">==</span>&nbsp;<span class="ident" id="4545652"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545654">.</span><span class="ident" id="4545655"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545667">.</span><span class="ident" id="4545668"><a href="/gostd/crypto/tls/ticket.go.html#4579428">cipherSuite</a></span>&nbsp;<span class="op" id="4545680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545685"><a href="/gostd/crypto/tls/handshake_server.go.html#4545492">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4545699">=</span>&nbsp;<span class="builtintype" id="4545701">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545709">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545720">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545723">if</span>&nbsp;<span class="op" id="4545726">!</span><span class="ident" id="4545727"><a href="/gostd/crypto/tls/handshake_server.go.html#4545492">cipherSuiteOk</a></span>&nbsp;<span class="op" id="4545741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545745">return</span>&nbsp;<span class="builtintype" id="4545752">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545763">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;also&nbsp;support&nbsp;the&nbsp;ciphersuite&nbsp;from&nbsp;the&nbsp;session.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545828"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545830">.</span><span class="ident" id="4545831"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span>&nbsp;<span class="op" id="4545837">=</span>&nbsp;<span class="ident" id="4545839"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4545840">.</span><span class="ident" id="4545841"><a href="/gostd/crypto/tls/handshake_server.go.html#4557043">tryCipherSuite</a></span><span class="op" id="4545855">(</span><span class="ident" id="4545856"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545858">.</span><span class="ident" id="4545859"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545871">.</span><span class="ident" id="4545872"><a href="/gostd/crypto/tls/ticket.go.html#4579428">cipherSuite</a></span><span class="op" id="4545883">,</span>&nbsp;<span class="ident" id="4545885"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4545886">.</span><span class="ident" id="4545887"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4545893">.</span><span class="ident" id="4545894"><a href="/gostd/crypto/tls/common.go.html#4455294">cipherSuites</a></span><span class="op" id="4545906">(</span><span class="op" id="4545907">)</span><span class="op" id="4545908">,</span>&nbsp;<span class="ident" id="4545910"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545912">.</span><span class="ident" id="4545913"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4545925">.</span><span class="ident" id="4545926"><a href="/gostd/crypto/tls/ticket.go.html#4579407">vers</a></span><span class="op" id="4545930">,</span>&nbsp;<span class="ident" id="4545932"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545934">.</span><span class="ident" id="4545935"><a href="/gostd/crypto/tls/handshake_server.go.html#4538988">ellipticOk</a></span><span class="op" id="4545945">,</span>&nbsp;<span class="ident" id="4545947"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545949">.</span><span class="ident" id="4545950"><a href="/gostd/crypto/tls/handshake_server.go.html#4539010">ecdsaOk</a></span><span class="op" id="4545957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545960">if</span>&nbsp;<span class="ident" id="4545963"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4545965">.</span><span class="ident" id="4545966"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span>&nbsp;<span class="op" id="4545972">==</span>&nbsp;<span class="builtintype" id="4545975">nil</span>&nbsp;<span class="op" id="4545979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545983">return</span>&nbsp;<span class="builtintype" id="4545990">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546001">sessionHasClientCerts</span>&nbsp;<span class="op" id="4546023">:=</span>&nbsp;<span class="builtinfunc" id="4546026">len</span><span class="op" id="4546029">(</span><span class="ident" id="4546030"><a href="/gostd/crypto/tls/handshake_server.go.html#4545071">hs</a></span><span class="op" id="4546032">.</span><span class="ident" id="4546033"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4546045">.</span><span class="ident" id="4546046"><a href="/gostd/crypto/tls/ticket.go.html#4579470">certificates</a></span><span class="op" id="4546058">)</span>&nbsp;<span class="op" id="4546060">!=</span>&nbsp;<span class="num" id="4546063">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546066">needClientCerts</span>&nbsp;<span class="op" id="4546082">:=</span>&nbsp;<span class="ident" id="4546085"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4546086">.</span><span class="ident" id="4546087"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4546093">.</span><span class="ident" id="4546094"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4546105">==</span>&nbsp;<span class="ident" id="4546108"><a href="/gostd/crypto/tls/common.go.html#4447991">RequireAnyClientCert</a></span>&nbsp;<span class="op" id="4546129">||</span>&nbsp;<span class="ident" id="4546132"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4546133">.</span><span class="ident" id="4546134"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4546140">.</span><span class="ident" id="4546141"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4546152">==</span>&nbsp;<span class="ident" id="4546155"><a href="/gostd/crypto/tls/common.go.html#4448038">RequireAndVerifyClientCert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546183">if</span>&nbsp;<span class="ident" id="4546186"><a href="/gostd/crypto/tls/handshake_server.go.html#4546066">needClientCerts</a></span>&nbsp;<span class="op" id="4546202">&amp;&amp;</span>&nbsp;<span class="op" id="4546205">!</span><span class="ident" id="4546206"><a href="/gostd/crypto/tls/handshake_server.go.html#4546001">sessionHasClientCerts</a></span>&nbsp;<span class="op" id="4546228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546232">return</span>&nbsp;<span class="builtintype" id="4546239">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546246">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546249">if</span>&nbsp;<span class="ident" id="4546252"><a href="/gostd/crypto/tls/handshake_server.go.html#4546001">sessionHasClientCerts</a></span>&nbsp;<span class="op" id="4546274">&amp;&amp;</span>&nbsp;<span class="ident" id="4546277"><a href="/gostd/crypto/tls/handshake_server.go.html#4545126">c</a></span><span class="op" id="4546278">.</span><span class="ident" id="4546279"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4546285">.</span><span class="ident" id="4546286"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4546297">==</span>&nbsp;<span class="ident" id="4546300"><a href="/gostd/crypto/tls/common.go.html#4447936">NoClientCert</a></span>&nbsp;<span class="op" id="4546313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546317">return</span>&nbsp;<span class="builtintype" id="4546324">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546335">return</span>&nbsp;<span class="builtintype" id="4546342">true</span><br>
<span class="lineno">290</span><span class="op" id="4546347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4546350">func</span>&nbsp;<span class="op" id="4546355">(</span><span class="ident" id="4546356">hs</span>&nbsp;<span class="op" id="4546359">*</span><span class="ident" id="4546360"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4546380">)</span>&nbsp;<span class="ident" id="4546382">doResumeHandshake</span><span class="op" id="4546399">(</span><span class="op" id="4546400">)</span>&nbsp;<span class="builtintype" id="4546402">error</span>&nbsp;<span class="op" id="4546408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546411">c</span>&nbsp;<span class="op" id="4546413">:=</span>&nbsp;<span class="ident" id="4546416"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546418">.</span><span class="ident" id="4546419"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546423"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546425">.</span><span class="ident" id="4546426"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4546431">.</span><span class="ident" id="4546432"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519519">cipherSuite</a></span>&nbsp;<span class="op" id="4546444">=</span>&nbsp;<span class="ident" id="4546446"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546448">.</span><span class="ident" id="4546449"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4546454">.</span><span class="ident" id="4546455"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4546459">//&nbsp;We&nbsp;echo&nbsp;the&nbsp;client&#39;s&nbsp;session&nbsp;ID&nbsp;in&nbsp;the&nbsp;ServerHello&nbsp;to&nbsp;let&nbsp;it&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4546529">//&nbsp;that&nbsp;we&#39;re&nbsp;doing&nbsp;a&nbsp;resumption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546564"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546566">.</span><span class="ident" id="4546567"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4546572">.</span><span class="ident" id="4546573"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519491">sessionId</a></span>&nbsp;<span class="op" id="4546583">=</span>&nbsp;<span class="ident" id="4546585"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546587">.</span><span class="ident" id="4546588"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4546599">.</span><span class="ident" id="4546600"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508375">sessionId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546611"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546613">.</span><span class="ident" id="4546614"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4546626">.</span><span class="ident" id="4546627"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4546632">(</span><span class="ident" id="4546633"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546635">.</span><span class="ident" id="4546636"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4546641">.</span><span class="ident" id="4546642"><a href="/gostd/crypto/tls/handshake_messages.go.html#4520364">marshal</a></span><span class="op" id="4546649">(</span><span class="op" id="4546650">)</span><span class="op" id="4546651">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546654"><a href="/gostd/crypto/tls/handshake_server.go.html#4546411">c</a></span><span class="op" id="4546655">.</span><span class="ident" id="4546656"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4546667">(</span><span class="ident" id="4546668"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4546687">,</span>&nbsp;<span class="ident" id="4546689"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546691">.</span><span class="ident" id="4546692"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4546697">.</span><span class="ident" id="4546698"><a href="/gostd/crypto/tls/handshake_messages.go.html#4520364">marshal</a></span><span class="op" id="4546705">(</span><span class="op" id="4546706">)</span><span class="op" id="4546707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546711">if</span>&nbsp;<span class="builtinfunc" id="4546714">len</span><span class="op" id="4546717">(</span><span class="ident" id="4546718"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546720">.</span><span class="ident" id="4546721"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4546733">.</span><span class="ident" id="4546734"><a href="/gostd/crypto/tls/ticket.go.html#4579470">certificates</a></span><span class="op" id="4546746">)</span>&nbsp;<span class="op" id="4546748">&gt;</span>&nbsp;<span class="num" id="4546750">0</span>&nbsp;<span class="op" id="4546752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546756">if</span>&nbsp;<span class="ident" id="4546759">_</span><span class="op" id="4546760">,</span>&nbsp;<span class="ident" id="4546762">err</span>&nbsp;<span class="op" id="4546766">:=</span>&nbsp;<span class="ident" id="4546769"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546771">.</span><span class="ident" id="4546772"><a href="/gostd/crypto/tls/handshake_server.go.html#4555205">processCertsFromClient</a></span><span class="op" id="4546794">(</span><span class="ident" id="4546795"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546797">.</span><span class="ident" id="4546798"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4546810">.</span><span class="ident" id="4546811"><a href="/gostd/crypto/tls/ticket.go.html#4579470">certificates</a></span><span class="op" id="4546823">)</span><span class="op" id="4546824">;</span>&nbsp;<span class="ident" id="4546826"><a href="/gostd/crypto/tls/handshake_server.go.html#4546762">err</a></span>&nbsp;<span class="op" id="4546830">!=</span>&nbsp;<span class="builtintype" id="4546833">nil</span>&nbsp;<span class="op" id="4546837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546842">return</span>&nbsp;<span class="ident" id="4546849"><a href="/gostd/crypto/tls/handshake_server.go.html#4546762">err</a></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546862"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546864">.</span><span class="ident" id="4546865"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span>&nbsp;<span class="op" id="4546878">=</span>&nbsp;<span class="ident" id="4546880"><a href="/gostd/crypto/tls/handshake_server.go.html#4546356">hs</a></span><span class="op" id="4546882">.</span><span class="ident" id="4546883"><a href="/gostd/crypto/tls/handshake_server.go.html#4539032">sessionState</a></span><span class="op" id="4546895">.</span><span class="ident" id="4546896"><a href="/gostd/crypto/tls/ticket.go.html#4579449">masterSecret</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546911">return</span>&nbsp;<span class="builtintype" id="4546918">nil</span><br>
<span class="lineno"></span><span class="op" id="4546922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4546925">func</span>&nbsp;<span class="op" id="4546930">(</span><span class="ident" id="4546931">hs</span>&nbsp;<span class="op" id="4546934">*</span><span class="ident" id="4546935"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4546955">)</span>&nbsp;<span class="ident" id="4546957">doFullHandshake</span><span class="op" id="4546972">(</span><span class="op" id="4546973">)</span>&nbsp;<span class="builtintype" id="4546975">error</span>&nbsp;<span class="op" id="4546981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546984">config</span>&nbsp;<span class="op" id="4546991">:=</span>&nbsp;<span class="ident" id="4546994"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4546996">.</span><span class="ident" id="4546997"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><span class="op" id="4546998">.</span><span class="ident" id="4546999"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547007">c</span>&nbsp;<span class="op" id="4547009">:=</span>&nbsp;<span class="ident" id="4547012"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547014">.</span><span class="ident" id="4547015"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547019">if</span>&nbsp;<span class="ident" id="4547022"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547024">.</span><span class="ident" id="4547025"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4547036">.</span><span class="ident" id="4547037"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508516">ocspStapling</a></span>&nbsp;<span class="op" id="4547050">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4547053">len</span><span class="op" id="4547056">(</span><span class="ident" id="4547057"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547059">.</span><span class="ident" id="4547060"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4547064">.</span><span class="ident" id="4547065"><a href="/gostd/crypto/tls/common.go.html#4458466">OCSPStaple</a></span><span class="op" id="4547075">)</span>&nbsp;<span class="op" id="4547077">&gt;</span>&nbsp;<span class="num" id="4547079">0</span>&nbsp;<span class="op" id="4547081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547085"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547087">.</span><span class="ident" id="4547088"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547093">.</span><span class="ident" id="4547094"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519630">ocspStapling</a></span>&nbsp;<span class="op" id="4547107">=</span>&nbsp;<span class="builtintype" id="4547109">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547115">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547119"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547121">.</span><span class="ident" id="4547122"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547127">.</span><span class="ident" id="4547128"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519656">ticketSupported</a></span>&nbsp;<span class="op" id="4547144">=</span>&nbsp;<span class="ident" id="4547146"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547148">.</span><span class="ident" id="4547149"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4547160">.</span><span class="ident" id="4547161"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508602">ticketSupported</a></span>&nbsp;<span class="op" id="4547177">&amp;&amp;</span>&nbsp;<span class="op" id="4547180">!</span><span class="ident" id="4547181"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4547187">.</span><span class="ident" id="4547188"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547212"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547214">.</span><span class="ident" id="4547215"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547220">.</span><span class="ident" id="4547221"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519519">cipherSuite</a></span>&nbsp;<span class="op" id="4547233">=</span>&nbsp;<span class="ident" id="4547235"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547237">.</span><span class="ident" id="4547238"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4547243">.</span><span class="ident" id="4547244"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547248"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547250">.</span><span class="ident" id="4547251"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4547263">.</span><span class="ident" id="4547264"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4547269">(</span><span class="ident" id="4547270"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547272">.</span><span class="ident" id="4547273"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547278">.</span><span class="ident" id="4547279"><a href="/gostd/crypto/tls/handshake_messages.go.html#4520364">marshal</a></span><span class="op" id="4547286">(</span><span class="op" id="4547287">)</span><span class="op" id="4547288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547291"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4547292">.</span><span class="ident" id="4547293"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4547304">(</span><span class="ident" id="4547305"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4547324">,</span>&nbsp;<span class="ident" id="4547326"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547328">.</span><span class="ident" id="4547329"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547334">.</span><span class="ident" id="4547335"><a href="/gostd/crypto/tls/handshake_messages.go.html#4520364">marshal</a></span><span class="op" id="4547342">(</span><span class="op" id="4547343">)</span><span class="op" id="4547344">)</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547348">certMsg</span>&nbsp;<span class="op" id="4547356">:=</span>&nbsp;<span class="builtinfunc" id="4547359">new</span><span class="op" id="4547362">(</span><span class="ident" id="4547363"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524760">certificateMsg</a></span><span class="op" id="4547377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547380"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4547387">.</span><span class="ident" id="4547388"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span>&nbsp;<span class="op" id="4547401">=</span>&nbsp;<span class="ident" id="4547403"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547405">.</span><span class="ident" id="4547406"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4547410">.</span><span class="ident" id="4547411"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547424"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547426">.</span><span class="ident" id="4547427"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4547439">.</span><span class="ident" id="4547440"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4547445">(</span><span class="ident" id="4547446"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4547453">.</span><span class="ident" id="4547454"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4547461">(</span><span class="op" id="4547462">)</span><span class="op" id="4547463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547466"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4547467">.</span><span class="ident" id="4547468"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4547479">(</span><span class="ident" id="4547480"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4547499">,</span>&nbsp;<span class="ident" id="4547501"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4547508">.</span><span class="ident" id="4547509"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4547516">(</span><span class="op" id="4547517">)</span><span class="op" id="4547518">)</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547522">if</span>&nbsp;<span class="ident" id="4547525"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547527">.</span><span class="ident" id="4547528"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547533">.</span><span class="ident" id="4547534"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519630">ocspStapling</a></span>&nbsp;<span class="op" id="4547547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547551">certStatus</span>&nbsp;<span class="op" id="4547562">:=</span>&nbsp;<span class="builtinfunc" id="4547565">new</span><span class="op" id="4547568">(</span><span class="ident" id="4547569"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527157">certificateStatusMsg</a></span><span class="op" id="4547589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547593"><a href="/gostd/crypto/tls/handshake_server.go.html#4547551">certStatus</a></span><span class="op" id="4547603">.</span><span class="ident" id="4547604"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527207">statusType</a></span>&nbsp;<span class="op" id="4547615">=</span>&nbsp;<span class="ident" id="4547617"><a href="/gostd/crypto/tls/common.go.html#4444657">statusTypeOCSP</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547634"><a href="/gostd/crypto/tls/handshake_server.go.html#4547551">certStatus</a></span><span class="op" id="4547644">.</span><span class="ident" id="4547645"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527225">response</a></span>&nbsp;<span class="op" id="4547654">=</span>&nbsp;<span class="ident" id="4547656"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547658">.</span><span class="ident" id="4547659"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4547663">.</span><span class="ident" id="4547664"><a href="/gostd/crypto/tls/common.go.html#4458466">OCSPStaple</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547677"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547679">.</span><span class="ident" id="4547680"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4547692">.</span><span class="ident" id="4547693"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4547698">(</span><span class="ident" id="4547699"><a href="/gostd/crypto/tls/handshake_server.go.html#4547551">certStatus</a></span><span class="op" id="4547709">.</span><span class="ident" id="4547710"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527517">marshal</a></span><span class="op" id="4547717">(</span><span class="op" id="4547718">)</span><span class="op" id="4547719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547723"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4547724">.</span><span class="ident" id="4547725"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4547736">(</span><span class="ident" id="4547737"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4547756">,</span>&nbsp;<span class="ident" id="4547758"><a href="/gostd/crypto/tls/handshake_server.go.html#4547551">certStatus</a></span><span class="op" id="4547768">.</span><span class="ident" id="4547769"><a href="/gostd/crypto/tls/handshake_messages.go.html#4527517">marshal</a></span><span class="op" id="4547776">(</span><span class="op" id="4547777">)</span><span class="op" id="4547778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547785">keyAgreement</span>&nbsp;<span class="op" id="4547798">:=</span>&nbsp;<span class="ident" id="4547801"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547803">.</span><span class="ident" id="4547804"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4547809">.</span><span class="ident" id="4547810"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434820">ka</a></span><span class="op" id="4547812">(</span><span class="ident" id="4547813"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4547814">.</span><span class="ident" id="4547815"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4547819">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547822">skx</span><span class="op" id="4547825">,</span>&nbsp;<span class="ident" id="4547827">err</span>&nbsp;<span class="op" id="4547831">:=</span>&nbsp;<span class="ident" id="4547834"><a href="/gostd/crypto/tls/handshake_server.go.html#4547785">keyAgreement</a></span><span class="op" id="4547846">.</span><span class="ident" id="4547847"><a href="/gostd/crypto/tls/cipher_suites.go.html#4433299">generateServerKeyExchange</a></span><span class="op" id="4547872">(</span><span class="ident" id="4547873"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4547879">,</span>&nbsp;<span class="ident" id="4547881"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547883">.</span><span class="ident" id="4547884"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4547888">,</span>&nbsp;<span class="ident" id="4547890"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547892">.</span><span class="ident" id="4547893"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4547904">,</span>&nbsp;<span class="ident" id="4547906"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4547908">.</span><span class="ident" id="4547909"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4547914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547917">if</span>&nbsp;<span class="ident" id="4547920"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4547924">!=</span>&nbsp;<span class="builtintype" id="4547927">nil</span>&nbsp;<span class="op" id="4547931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547935"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4547936">.</span><span class="ident" id="4547937"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4547946">(</span><span class="ident" id="4547947"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4547968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547972">return</span>&nbsp;<span class="ident" id="4547979"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547984">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547987">if</span>&nbsp;<span class="ident" id="4547990"><a href="/gostd/crypto/tls/handshake_server.go.html#4547822">skx</a></span>&nbsp;<span class="op" id="4547994">!=</span>&nbsp;<span class="builtintype" id="4547997">nil</span>&nbsp;<span class="op" id="4548001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548005"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4548007">.</span><span class="ident" id="4548008"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4548020">.</span><span class="ident" id="4548021"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4548026">(</span><span class="ident" id="4548027"><a href="/gostd/crypto/tls/handshake_server.go.html#4547822">skx</a></span><span class="op" id="4548030">.</span><span class="ident" id="4548031"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526746">marshal</a></span><span class="op" id="4548038">(</span><span class="op" id="4548039">)</span><span class="op" id="4548040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548044"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4548045">.</span><span class="ident" id="4548046"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4548057">(</span><span class="ident" id="4548058"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4548077">,</span>&nbsp;<span class="ident" id="4548079"><a href="/gostd/crypto/tls/handshake_server.go.html#4547822">skx</a></span><span class="op" id="4548082">.</span><span class="ident" id="4548083"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526746">marshal</a></span><span class="op" id="4548090">(</span><span class="op" id="4548091">)</span><span class="op" id="4548092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548099">if</span>&nbsp;<span class="ident" id="4548102"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4548108">.</span><span class="ident" id="4548109"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4548120">&gt;=</span>&nbsp;<span class="ident" id="4548123"><a href="/gostd/crypto/tls/common.go.html#4447972">RequestClientCert</a></span>&nbsp;<span class="op" id="4548141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548145">//&nbsp;Request&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548179">certReq</span>&nbsp;<span class="op" id="4548187">:=</span>&nbsp;<span class="builtinfunc" id="4548190">new</span><span class="op" id="4548193">(</span><span class="ident" id="4548194"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531305">certificateRequestMsg</a></span><span class="op" id="4548215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548219"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548226">.</span><span class="ident" id="4548227"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531529">certificateTypes</a></span>&nbsp;<span class="op" id="4548244">=</span>&nbsp;<span class="op" id="4548246">[</span><span class="op" id="4548247">]</span><span class="builtintype" id="4548248">byte</span><span class="op" id="4548252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4548257">byte</span><span class="op" id="4548261">(</span><span class="ident" id="4548262"><a href="/gostd/crypto/tls/common.go.html#4444743">certTypeRSASign</a></span><span class="op" id="4548277">)</span><span class="op" id="4548278">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4548283">byte</span><span class="op" id="4548287">(</span><span class="ident" id="4548288"><a href="/gostd/crypto/tls/common.go.html#4445041">certTypeECDSASign</a></span><span class="op" id="4548305">)</span><span class="op" id="4548306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548314">if</span>&nbsp;<span class="ident" id="4548317"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4548318">.</span><span class="ident" id="4548319"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span>&nbsp;<span class="op" id="4548324">&gt;=</span>&nbsp;<span class="ident" id="4548327"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4548340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548345"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548352">.</span><span class="ident" id="4548353"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531502">hasSignatureAndHash</a></span>&nbsp;<span class="op" id="4548373">=</span>&nbsp;<span class="builtintype" id="4548375">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548383"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548390">.</span><span class="ident" id="4548391"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531560">signatureAndHashes</a></span>&nbsp;<span class="op" id="4548410">=</span>&nbsp;<span class="ident" id="4548412"><a href="/gostd/crypto/tls/common.go.html#4446298">supportedClientCertSignatureAlgorithms</a></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548458">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;of&nbsp;certificateAuthorities&nbsp;signals&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548514">//&nbsp;the&nbsp;client&nbsp;that&nbsp;it&nbsp;may&nbsp;send&nbsp;any&nbsp;certificate&nbsp;in&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548575">//&nbsp;to&nbsp;our&nbsp;request.&nbsp;When&nbsp;we&nbsp;know&nbsp;the&nbsp;CAs&nbsp;we&nbsp;trust,&nbsp;then</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548632">//&nbsp;we&nbsp;can&nbsp;send&nbsp;them&nbsp;down,&nbsp;so&nbsp;that&nbsp;the&nbsp;client&nbsp;can&nbsp;choose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4548690">//&nbsp;an&nbsp;appropriate&nbsp;certificate&nbsp;to&nbsp;give&nbsp;to&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4548737">if</span>&nbsp;<span class="ident" id="4548740"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4548746">.</span><span class="ident" id="4548747"><a href="/gostd/crypto/tls/common.go.html#4452596">ClientCAs</a></span>&nbsp;<span class="op" id="4548757">!=</span>&nbsp;<span class="builtintype" id="4548760">nil</span>&nbsp;<span class="op" id="4548764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548769"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548776">.</span><span class="ident" id="4548777"><a href="/gostd/crypto/tls/handshake_messages.go.html#4531603">certificateAuthorities</a></span>&nbsp;<span class="op" id="4548800">=</span>&nbsp;<span class="ident" id="4548802"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4548808">.</span><span class="ident" id="4548809"><a href="/gostd/crypto/tls/common.go.html#4452596">ClientCAs</a></span><span class="op" id="4548818">.</span><span class="ident" id="4548819"><a href="/gostd/crypto/x509/cert_pool.go.html#4615850">Subjects</a></span><span class="op" id="4548827">(</span><span class="op" id="4548828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548832">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548836"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4548838">.</span><span class="ident" id="4548839"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4548851">.</span><span class="ident" id="4548852"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4548857">(</span><span class="ident" id="4548858"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548865">.</span><span class="ident" id="4548866"><a href="/gostd/crypto/tls/handshake_messages.go.html#4532035">marshal</a></span><span class="op" id="4548873">(</span><span class="op" id="4548874">)</span><span class="op" id="4548875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548879"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4548880">.</span><span class="ident" id="4548881"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4548892">(</span><span class="ident" id="4548893"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4548912">,</span>&nbsp;<span class="ident" id="4548914"><a href="/gostd/crypto/tls/handshake_server.go.html#4548179">certReq</a></span><span class="op" id="4548921">.</span><span class="ident" id="4548922"><a href="/gostd/crypto/tls/handshake_messages.go.html#4532035">marshal</a></span><span class="op" id="4548929">(</span><span class="op" id="4548930">)</span><span class="op" id="4548931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4548934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548938">helloDone</span>&nbsp;<span class="op" id="4548948">:=</span>&nbsp;<span class="builtinfunc" id="4548951">new</span><span class="op" id="4548954">(</span><span class="ident" id="4548955"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528418">serverHelloDoneMsg</a></span><span class="op" id="4548973">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4548976"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4548978">.</span><span class="ident" id="4548979"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4548991">.</span><span class="ident" id="4548992"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4548997">(</span><span class="ident" id="4548998"><a href="/gostd/crypto/tls/handshake_server.go.html#4548938">helloDone</a></span><span class="op" id="4549007">.</span><span class="ident" id="4549008"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528581">marshal</a></span><span class="op" id="4549015">(</span><span class="op" id="4549016">)</span><span class="op" id="4549017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549020"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4549021">.</span><span class="ident" id="4549022"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4549033">(</span><span class="ident" id="4549034"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4549053">,</span>&nbsp;<span class="ident" id="4549055"><a href="/gostd/crypto/tls/handshake_server.go.html#4548938">helloDone</a></span><span class="op" id="4549064">.</span><span class="ident" id="4549065"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528581">marshal</a></span><span class="op" id="4549072">(</span><span class="op" id="4549073">)</span><span class="op" id="4549074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549078">var</span>&nbsp;<span class="ident" id="4549082">pub</span>&nbsp;<span class="ident" id="4549086"><a href="/gostd/crypto/tls/handshake_server.go.html#4538591">crypto</a></span><span class="op" id="4549092">.</span><span class="ident" id="4549093"><a href="/gostd/crypto/crypto.go.html#3012471">PublicKey</a></span>&nbsp;<span class="comment" id="4549103">//&nbsp;public&nbsp;key&nbsp;for&nbsp;client&nbsp;auth,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549143">msg</span><span class="op" id="4549146">,</span>&nbsp;<span class="ident" id="4549148"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549152">:=</span>&nbsp;<span class="ident" id="4549155"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4549156">.</span><span class="ident" id="4549157"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4549170">(</span><span class="op" id="4549171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549174">if</span>&nbsp;<span class="ident" id="4549177"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549181">!=</span>&nbsp;<span class="builtintype" id="4549184">nil</span>&nbsp;<span class="op" id="4549188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549192">return</span>&nbsp;<span class="ident" id="4549199"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549208">var</span>&nbsp;<span class="ident" id="4549212">ok</span>&nbsp;<span class="builtintype" id="4549215">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549221">//&nbsp;If&nbsp;we&nbsp;requested&nbsp;a&nbsp;client&nbsp;certificate,&nbsp;then&nbsp;the&nbsp;client&nbsp;must&nbsp;send&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549291">//&nbsp;certificate&nbsp;message,&nbsp;even&nbsp;if&nbsp;it&#39;s&nbsp;empty.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549336">if</span>&nbsp;<span class="ident" id="4549339"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4549345">.</span><span class="ident" id="4549346"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4549357">&gt;=</span>&nbsp;<span class="ident" id="4549360"><a href="/gostd/crypto/tls/common.go.html#4447972">RequestClientCert</a></span>&nbsp;<span class="op" id="4549378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549382">if</span>&nbsp;<span class="ident" id="4549385"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4549392">,</span>&nbsp;<span class="ident" id="4549394"><a href="/gostd/crypto/tls/handshake_server.go.html#4549212">ok</a></span>&nbsp;<span class="op" id="4549397">=</span>&nbsp;<span class="ident" id="4549399"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4549402">.</span><span class="op" id="4549403">(</span><span class="op" id="4549404">*</span><span class="ident" id="4549405"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524760">certificateMsg</a></span><span class="op" id="4549419">)</span><span class="op" id="4549420">;</span>&nbsp;<span class="op" id="4549422">!</span><span class="ident" id="4549423"><a href="/gostd/crypto/tls/handshake_server.go.html#4549212">ok</a></span>&nbsp;<span class="op" id="4549426">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549431"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4549432">.</span><span class="ident" id="4549433"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4549442">(</span><span class="ident" id="4549443"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4549465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549470">return</span>&nbsp;<span class="ident" id="4549477"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4549499">(</span><span class="ident" id="4549500"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4549507">,</span>&nbsp;<span class="ident" id="4549509"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4549512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549520"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4549522">.</span><span class="ident" id="4549523"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4549535">.</span><span class="ident" id="4549536"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4549541">(</span><span class="ident" id="4549542"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4549549">.</span><span class="ident" id="4549550"><a href="/gostd/crypto/tls/handshake_messages.go.html#4525058">marshal</a></span><span class="op" id="4549557">(</span><span class="op" id="4549558">)</span><span class="op" id="4549559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549564">if</span>&nbsp;<span class="builtinfunc" id="4549567">len</span><span class="op" id="4549570">(</span><span class="ident" id="4549571"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4549578">.</span><span class="ident" id="4549579"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span><span class="op" id="4549591">)</span>&nbsp;<span class="op" id="4549593">==</span>&nbsp;<span class="num" id="4549596">0</span>&nbsp;<span class="op" id="4549598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4549603">//&nbsp;The&nbsp;client&nbsp;didn&#39;t&nbsp;actually&nbsp;send&nbsp;a&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549655">switch</span>&nbsp;<span class="ident" id="4549662"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4549668">.</span><span class="ident" id="4549669"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4549680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549685">case</span>&nbsp;<span class="ident" id="4549690"><a href="/gostd/crypto/tls/common.go.html#4447991">RequireAnyClientCert</a></span><span class="op" id="4549710">,</span>&nbsp;<span class="ident" id="4549712"><a href="/gostd/crypto/tls/common.go.html#4448038">RequireAndVerifyClientCert</a></span><span class="op" id="4549738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549744"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4549745">.</span><span class="ident" id="4549746"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4549755">(</span><span class="ident" id="4549756"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4549775">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549781">return</span>&nbsp;<span class="ident" id="4549788"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4549794">.</span><span class="ident" id="4549795"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4549798">(</span><span class="string" id="4549799">&#34;tls:&nbsp;client&nbsp;didn&#39;t&nbsp;provide&nbsp;a&nbsp;certificate&#34;</span><span class="op" id="4549841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549855"><a href="/gostd/crypto/tls/handshake_server.go.html#4549082">pub</a></span><span class="op" id="4549858">,</span>&nbsp;<span class="ident" id="4549860"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549864">=</span>&nbsp;<span class="ident" id="4549866"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4549868">.</span><span class="ident" id="4549869"><a href="/gostd/crypto/tls/handshake_server.go.html#4555205">processCertsFromClient</a></span><span class="op" id="4549891">(</span><span class="ident" id="4549892"><a href="/gostd/crypto/tls/handshake_server.go.html#4547348">certMsg</a></span><span class="op" id="4549899">.</span><span class="ident" id="4549900"><a href="/gostd/crypto/tls/handshake_messages.go.html#4524806">certificates</a></span><span class="op" id="4549912">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549916">if</span>&nbsp;<span class="ident" id="4549919"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549923">!=</span>&nbsp;<span class="builtintype" id="4549926">nil</span>&nbsp;<span class="op" id="4549930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549935">return</span>&nbsp;<span class="ident" id="4549942"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4549948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4549953"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4549956">,</span>&nbsp;<span class="ident" id="4549958"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549962">=</span>&nbsp;<span class="ident" id="4549964"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4549965">.</span><span class="ident" id="4549966"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4549979">(</span><span class="op" id="4549980">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4549984">if</span>&nbsp;<span class="ident" id="4549987"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4549991">!=</span>&nbsp;<span class="builtintype" id="4549994">nil</span>&nbsp;<span class="op" id="4549998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550003">return</span>&nbsp;<span class="ident" id="4550010"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550023">//&nbsp;Get&nbsp;client&nbsp;key&nbsp;exchange</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550051">ckx</span><span class="op" id="4550054">,</span>&nbsp;<span class="ident" id="4550056"><a href="/gostd/crypto/tls/handshake_server.go.html#4549212">ok</a></span>&nbsp;<span class="op" id="4550059">:=</span>&nbsp;<span class="ident" id="4550062"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4550065">.</span><span class="op" id="4550066">(</span><span class="op" id="4550067">*</span><span class="ident" id="4550068"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4550088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550091">if</span>&nbsp;<span class="op" id="4550094">!</span><span class="ident" id="4550095"><a href="/gostd/crypto/tls/handshake_server.go.html#4549212">ok</a></span>&nbsp;<span class="op" id="4550098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550102"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4550103">.</span><span class="ident" id="4550104"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4550113">(</span><span class="ident" id="4550114"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4550136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550140">return</span>&nbsp;<span class="ident" id="4550147"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4550169">(</span><span class="ident" id="4550170"><a href="/gostd/crypto/tls/handshake_server.go.html#4550051">ckx</a></span><span class="op" id="4550173">,</span>&nbsp;<span class="ident" id="4550175"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4550178">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550184"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4550186">.</span><span class="ident" id="4550187"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4550199">.</span><span class="ident" id="4550200"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4550205">(</span><span class="ident" id="4550206"><a href="/gostd/crypto/tls/handshake_server.go.html#4550051">ckx</a></span><span class="op" id="4550209">.</span><span class="ident" id="4550210"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529064">marshal</a></span><span class="op" id="4550217">(</span><span class="op" id="4550218">)</span><span class="op" id="4550219">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550223">//&nbsp;If&nbsp;we&nbsp;received&nbsp;a&nbsp;client&nbsp;cert&nbsp;in&nbsp;response&nbsp;to&nbsp;our&nbsp;certificate&nbsp;request&nbsp;message,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550304">//&nbsp;the&nbsp;client&nbsp;will&nbsp;send&nbsp;us&nbsp;a&nbsp;certificateVerifyMsg&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550377">//&nbsp;clientKeyExchangeMsg.&nbsp;&nbsp;This&nbsp;message&nbsp;is&nbsp;a&nbsp;digest&nbsp;of&nbsp;all&nbsp;preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550446">//&nbsp;handshake-layer&nbsp;messages&nbsp;that&nbsp;is&nbsp;signed&nbsp;using&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550526">//&nbsp;to&nbsp;the&nbsp;client&#39;s&nbsp;certificate.&nbsp;This&nbsp;allows&nbsp;us&nbsp;to&nbsp;verify&nbsp;that&nbsp;the&nbsp;client&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4550606">//&nbsp;possession&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;of&nbsp;the&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550660">if</span>&nbsp;<span class="builtinfunc" id="4550663">len</span><span class="op" id="4550666">(</span><span class="ident" id="4550667"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4550668">.</span><span class="ident" id="4550669"><a href="/gostd/crypto/tls/conn.go.html#4462520">peerCertificates</a></span><span class="op" id="4550685">)</span>&nbsp;<span class="op" id="4550687">&gt;</span>&nbsp;<span class="num" id="4550689">0</span>&nbsp;<span class="op" id="4550691">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550695"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4550698">,</span>&nbsp;<span class="ident" id="4550700"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4550704">=</span>&nbsp;<span class="ident" id="4550706"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4550707">.</span><span class="ident" id="4550708"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4550721">(</span><span class="op" id="4550722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550726">if</span>&nbsp;<span class="ident" id="4550729"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4550733">!=</span>&nbsp;<span class="builtintype" id="4550736">nil</span>&nbsp;<span class="op" id="4550740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550745">return</span>&nbsp;<span class="ident" id="4550752"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550762">certVerify</span><span class="op" id="4550772">,</span>&nbsp;<span class="ident" id="4550774">ok</span>&nbsp;<span class="op" id="4550777">:=</span>&nbsp;<span class="ident" id="4550780"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4550783">.</span><span class="op" id="4550784">(</span><span class="op" id="4550785">*</span><span class="ident" id="4550786"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534730">certificateVerifyMsg</a></span><span class="op" id="4550806">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550810">if</span>&nbsp;<span class="op" id="4550813">!</span><span class="ident" id="4550814"><a href="/gostd/crypto/tls/handshake_server.go.html#4550774">ok</a></span>&nbsp;<span class="op" id="4550817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550822"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4550823">.</span><span class="ident" id="4550824"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4550833">(</span><span class="ident" id="4550834"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4550856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550861">return</span>&nbsp;<span class="ident" id="4550868"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4550890">(</span><span class="ident" id="4550891"><a href="/gostd/crypto/tls/handshake_server.go.html#4550762">certVerify</a></span><span class="op" id="4550901">,</span>&nbsp;<span class="ident" id="4550903"><a href="/gostd/crypto/tls/handshake_server.go.html#4549143">msg</a></span><span class="op" id="4550906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4550910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550915">switch</span>&nbsp;<span class="ident" id="4550922">key</span>&nbsp;<span class="op" id="4550926">:=</span>&nbsp;<span class="ident" id="4550929"><a href="/gostd/crypto/tls/handshake_server.go.html#4549082">pub</a></span><span class="op" id="4550932">.</span><span class="op" id="4550933">(</span><span class="keyword" id="4550934">type</span><span class="op" id="4550938">)</span>&nbsp;<span class="op" id="4550940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4550944">case</span>&nbsp;<span class="op" id="4550949">*</span><span class="ident" id="4550950"><a href="/gostd/crypto/tls/handshake_server.go.html#4538601">ecdsa</a></span><span class="op" id="4550955">.</span><span class="ident" id="4550956"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4550965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4550970">ecdsaSig</span>&nbsp;<span class="op" id="4550979">:=</span>&nbsp;<span class="builtinfunc" id="4550982">new</span><span class="op" id="4550985">(</span><span class="ident" id="4550986"><a href="/gostd/crypto/tls/common.go.html#4460840">ecdsaSignature</a></span><span class="op" id="4551000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551005">if</span>&nbsp;<span class="ident" id="4551008">_</span><span class="op" id="4551009">,</span>&nbsp;<span class="ident" id="4551011"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551015">=</span>&nbsp;<span class="ident" id="4551017"><a href="/gostd/crypto/tls/handshake_server.go.html#4538663">asn1</a></span><span class="op" id="4551021">.</span><span class="ident" id="4551022"><a href="/gostd/encoding/asn1/asn1.go.html#3112967">Unmarshal</a></span><span class="op" id="4551031">(</span><span class="ident" id="4551032"><a href="/gostd/crypto/tls/handshake_server.go.html#4550762">certVerify</a></span><span class="op" id="4551042">.</span><span class="ident" id="4551043"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534853">signature</a></span><span class="op" id="4551052">,</span>&nbsp;<span class="ident" id="4551054"><a href="/gostd/crypto/tls/handshake_server.go.html#4550970">ecdsaSig</a></span><span class="op" id="4551062">)</span><span class="op" id="4551063">;</span>&nbsp;<span class="ident" id="4551065"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551069">!=</span>&nbsp;<span class="builtintype" id="4551072">nil</span>&nbsp;<span class="op" id="4551076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551082">break</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551096">if</span>&nbsp;<span class="ident" id="4551099"><a href="/gostd/crypto/tls/handshake_server.go.html#4550970">ecdsaSig</a></span><span class="op" id="4551107">.</span><span class="ident" id="4551108"><a href="/gostd/crypto/tls/common.go.html#4460818">R</a></span><span class="op" id="4551109">.</span><span class="ident" id="4551110"><a href="/gostd/math/big/int.go.html#2036181">Sign</a></span><span class="op" id="4551114">(</span><span class="op" id="4551115">)</span>&nbsp;<span class="op" id="4551117">&lt;=</span>&nbsp;<span class="num" id="4551120">0</span>&nbsp;<span class="op" id="4551122">||</span>&nbsp;<span class="ident" id="4551125"><a href="/gostd/crypto/tls/handshake_server.go.html#4550970">ecdsaSig</a></span><span class="op" id="4551133">.</span><span class="ident" id="4551134"><a href="/gostd/crypto/tls/common.go.html#4460821">S</a></span><span class="op" id="4551135">.</span><span class="ident" id="4551136"><a href="/gostd/math/big/int.go.html#2036181">Sign</a></span><span class="op" id="4551140">(</span><span class="op" id="4551141">)</span>&nbsp;<span class="op" id="4551143">&lt;=</span>&nbsp;<span class="num" id="4551146">0</span>&nbsp;<span class="op" id="4551148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551154"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551158">=</span>&nbsp;<span class="ident" id="4551160"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4551166">.</span><span class="ident" id="4551167"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4551170">(</span><span class="string" id="4551171">&#34;ECDSA&nbsp;signature&nbsp;contained&nbsp;zero&nbsp;or&nbsp;negative&nbsp;values&#34;</span><span class="op" id="4551222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551228">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551237">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551242">digest</span><span class="op" id="4551248">,</span>&nbsp;<span class="ident" id="4551250">_</span><span class="op" id="4551251">,</span>&nbsp;<span class="ident" id="4551253">_</span>&nbsp;<span class="op" id="4551255">:=</span>&nbsp;<span class="ident" id="4551258"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4551260">.</span><span class="ident" id="4551261"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4551273">.</span><span class="ident" id="4551274"><a href="/gostd/crypto/tls/prf.go.html#4578516">hashForClientCertificate</a></span><span class="op" id="4551298">(</span><span class="ident" id="4551299"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4551313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551318">if</span>&nbsp;<span class="op" id="4551321">!</span><span class="ident" id="4551322"><a href="/gostd/crypto/tls/handshake_server.go.html#4538601">ecdsa</a></span><span class="op" id="4551327">.</span><span class="ident" id="4551328"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3009119">Verify</a></span><span class="op" id="4551334">(</span><span class="ident" id="4551335"><a href="/gostd/crypto/tls/handshake_server.go.html#4550922">key</a></span><span class="op" id="4551338">,</span>&nbsp;<span class="ident" id="4551340"><a href="/gostd/crypto/tls/handshake_server.go.html#4551242">digest</a></span><span class="op" id="4551346">,</span>&nbsp;<span class="ident" id="4551348"><a href="/gostd/crypto/tls/handshake_server.go.html#4550970">ecdsaSig</a></span><span class="op" id="4551356">.</span><span class="ident" id="4551357"><a href="/gostd/crypto/tls/common.go.html#4460818">R</a></span><span class="op" id="4551358">,</span>&nbsp;<span class="ident" id="4551360"><a href="/gostd/crypto/tls/handshake_server.go.html#4550970">ecdsaSig</a></span><span class="op" id="4551368">.</span><span class="ident" id="4551369"><a href="/gostd/crypto/tls/common.go.html#4460821">S</a></span><span class="op" id="4551370">)</span>&nbsp;<span class="op" id="4551372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551378"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551382">=</span>&nbsp;<span class="ident" id="4551384"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4551390">.</span><span class="ident" id="4551391"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4551394">(</span><span class="string" id="4551395">&#34;ECDSA&nbsp;verification&nbsp;failure&#34;</span><span class="op" id="4551423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551429">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551438">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551442">case</span>&nbsp;<span class="op" id="4551447">*</span><span class="ident" id="4551448"><a href="/gostd/crypto/tls/handshake_server.go.html#4538617">rsa</a></span><span class="op" id="4551451">.</span><span class="ident" id="4551452"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4551461">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551466">digest</span><span class="op" id="4551472">,</span>&nbsp;<span class="ident" id="4551474">hashFunc</span><span class="op" id="4551482">,</span>&nbsp;<span class="ident" id="4551484">_</span>&nbsp;<span class="op" id="4551486">:=</span>&nbsp;<span class="ident" id="4551489"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4551491">.</span><span class="ident" id="4551492"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4551504">.</span><span class="ident" id="4551505"><a href="/gostd/crypto/tls/prf.go.html#4578516">hashForClientCertificate</a></span><span class="op" id="4551529">(</span><span class="ident" id="4551530"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4551542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551547"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551551">=</span>&nbsp;<span class="ident" id="4551553"><a href="/gostd/crypto/tls/handshake_server.go.html#4538617">rsa</a></span><span class="op" id="4551556">.</span><span class="ident" id="4551557"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732385">VerifyPKCS1v15</a></span><span class="op" id="4551571">(</span><span class="ident" id="4551572"><a href="/gostd/crypto/tls/handshake_server.go.html#4550922">key</a></span><span class="op" id="4551575">,</span>&nbsp;<span class="ident" id="4551577"><a href="/gostd/crypto/tls/handshake_server.go.html#4551474">hashFunc</a></span><span class="op" id="4551585">,</span>&nbsp;<span class="ident" id="4551587"><a href="/gostd/crypto/tls/handshake_server.go.html#4551466">digest</a></span><span class="op" id="4551593">,</span>&nbsp;<span class="ident" id="4551595"><a href="/gostd/crypto/tls/handshake_server.go.html#4550762">certVerify</a></span><span class="op" id="4551605">.</span><span class="ident" id="4551606"><a href="/gostd/crypto/tls/handshake_messages.go.html#4534853">signature</a></span><span class="op" id="4551615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551623">if</span>&nbsp;<span class="ident" id="4551626"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551630">!=</span>&nbsp;<span class="builtintype" id="4551633">nil</span>&nbsp;<span class="op" id="4551637">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551642"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4551643">.</span><span class="ident" id="4551644"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4551653">(</span><span class="ident" id="4551654"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4551673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551678">return</span>&nbsp;<span class="ident" id="4551685"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4551691">.</span><span class="ident" id="4551692"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4551695">(</span><span class="string" id="4551696">&#34;could&nbsp;not&nbsp;validate&nbsp;signature&nbsp;of&nbsp;connection&nbsp;nonces:&nbsp;&#34;</span>&nbsp;<span class="op" id="4551750">+</span>&nbsp;<span class="ident" id="4551752"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><span class="op" id="4551755">.</span><span class="ident" id="4551756">Error</span><span class="op" id="4551761">(</span><span class="op" id="4551762">)</span><span class="op" id="4551763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551772"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4551774">.</span><span class="ident" id="4551775"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4551787">.</span><span class="ident" id="4551788"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4551793">(</span><span class="ident" id="4551794"><a href="/gostd/crypto/tls/handshake_server.go.html#4550762">certVerify</a></span><span class="op" id="4551804">.</span><span class="ident" id="4551805"><a href="/gostd/crypto/tls/handshake_messages.go.html#4535298">marshal</a></span><span class="op" id="4551812">(</span><span class="op" id="4551813">)</span><span class="op" id="4551814">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551821">preMasterSecret</span><span class="op" id="4551836">,</span>&nbsp;<span class="ident" id="4551838"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551842">:=</span>&nbsp;<span class="ident" id="4551845"><a href="/gostd/crypto/tls/handshake_server.go.html#4547785">keyAgreement</a></span><span class="op" id="4551857">.</span><span class="ident" id="4551858"><a href="/gostd/crypto/tls/cipher_suites.go.html#4433414">processClientKeyExchange</a></span><span class="op" id="4551882">(</span><span class="ident" id="4551883"><a href="/gostd/crypto/tls/handshake_server.go.html#4546984">config</a></span><span class="op" id="4551889">,</span>&nbsp;<span class="ident" id="4551891"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4551893">.</span><span class="ident" id="4551894"><a href="/gostd/crypto/tls/handshake_server.go.html#4539143">cert</a></span><span class="op" id="4551898">,</span>&nbsp;<span class="ident" id="4551900"><a href="/gostd/crypto/tls/handshake_server.go.html#4550051">ckx</a></span><span class="op" id="4551903">,</span>&nbsp;<span class="ident" id="4551905"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4551906">.</span><span class="ident" id="4551907"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4551911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551914">if</span>&nbsp;<span class="ident" id="4551917"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span>&nbsp;<span class="op" id="4551921">!=</span>&nbsp;<span class="builtintype" id="4551924">nil</span>&nbsp;<span class="op" id="4551928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551932"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4551933">.</span><span class="ident" id="4551934"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4551943">(</span><span class="ident" id="4551944"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4551965">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4551969">return</span>&nbsp;<span class="ident" id="4551976"><a href="/gostd/crypto/tls/handshake_server.go.html#4547827">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4551981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4551984"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4551986">.</span><span class="ident" id="4551987"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span>&nbsp;<span class="op" id="4552000">=</span>&nbsp;<span class="ident" id="4552002"><a href="/gostd/crypto/tls/prf.go.html#4574003">masterFromPreMasterSecret</a></span><span class="op" id="4552027">(</span><span class="ident" id="4552028"><a href="/gostd/crypto/tls/handshake_server.go.html#4547007">c</a></span><span class="op" id="4552029">.</span><span class="ident" id="4552030"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552034">,</span>&nbsp;<span class="ident" id="4552036"><a href="/gostd/crypto/tls/handshake_server.go.html#4551821">preMasterSecret</a></span><span class="op" id="4552051">,</span>&nbsp;<span class="ident" id="4552053"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4552055">.</span><span class="ident" id="4552056"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4552067">.</span><span class="ident" id="4552068"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4552074">,</span>&nbsp;<span class="ident" id="4552076"><a href="/gostd/crypto/tls/handshake_server.go.html#4546931">hs</a></span><span class="op" id="4552078">.</span><span class="ident" id="4552079"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4552084">.</span><span class="ident" id="4552085"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4552091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552095">return</span>&nbsp;<span class="builtintype" id="4552102">nil</span><br>
<span class="lineno">475</span><span class="op" id="4552106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4552109">func</span>&nbsp;<span class="op" id="4552114">(</span><span class="ident" id="4552115">hs</span>&nbsp;<span class="op" id="4552118">*</span><span class="ident" id="4552119"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4552139">)</span>&nbsp;<span class="ident" id="4552141">establishKeys</span><span class="op" id="4552154">(</span><span class="op" id="4552155">)</span>&nbsp;<span class="builtintype" id="4552157">error</span>&nbsp;<span class="op" id="4552163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552166">c</span>&nbsp;<span class="op" id="4552168">:=</span>&nbsp;<span class="ident" id="4552171"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552173">.</span><span class="ident" id="4552174"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552178">clientMAC</span><span class="op" id="4552187">,</span>&nbsp;<span class="ident" id="4552189">serverMAC</span><span class="op" id="4552198">,</span>&nbsp;<span class="ident" id="4552200">clientKey</span><span class="op" id="4552209">,</span>&nbsp;<span class="ident" id="4552211">serverKey</span><span class="op" id="4552220">,</span>&nbsp;<span class="ident" id="4552222">clientIV</span><span class="op" id="4552230">,</span>&nbsp;<span class="ident" id="4552232">serverIV</span>&nbsp;<span class="op" id="4552241">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552246"><a href="/gostd/crypto/tls/prf.go.html#4574572">keysFromMasterSecret</a></span><span class="op" id="4552266">(</span><span class="ident" id="4552267"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552268">.</span><span class="ident" id="4552269"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552273">,</span>&nbsp;<span class="ident" id="4552275"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552277">.</span><span class="ident" id="4552278"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span><span class="op" id="4552290">,</span>&nbsp;<span class="ident" id="4552292"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552294">.</span><span class="ident" id="4552295"><a href="/gostd/crypto/tls/handshake_server.go.html#4538892">clientHello</a></span><span class="op" id="4552306">.</span><span class="ident" id="4552307"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4552313">,</span>&nbsp;<span class="ident" id="4552315"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552317">.</span><span class="ident" id="4552318"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4552323">.</span><span class="ident" id="4552324"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4552330">,</span>&nbsp;<span class="ident" id="4552332"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552334">.</span><span class="ident" id="4552335"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552340">.</span><span class="ident" id="4552341"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434796">macLen</a></span><span class="op" id="4552347">,</span>&nbsp;<span class="ident" id="4552349"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552351">.</span><span class="ident" id="4552352"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552357">.</span><span class="ident" id="4552358"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434784">keyLen</a></span><span class="op" id="4552364">,</span>&nbsp;<span class="ident" id="4552366"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552368">.</span><span class="ident" id="4552369"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552374">.</span><span class="ident" id="4552375"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434808">ivLen</a></span><span class="op" id="4552380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552384">var</span>&nbsp;<span class="ident" id="4552388">clientCipher</span><span class="op" id="4552400">,</span>&nbsp;<span class="ident" id="4552402">serverCipher</span>&nbsp;<span class="keyword" id="4552415">interface</span><span class="op" id="4552424">{</span><span class="op" id="4552425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552428">var</span>&nbsp;<span class="ident" id="4552432">clientHash</span><span class="op" id="4552442">,</span>&nbsp;<span class="ident" id="4552444">serverHash</span>&nbsp;<span class="ident" id="4552455"><a href="/gostd/crypto/tls/cipher_suites.go.html#4437372">macFunction</a></span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552469">if</span>&nbsp;<span class="ident" id="4552472"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552474">.</span><span class="ident" id="4552475"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552480">.</span><span class="ident" id="4552481"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435036">aead</a></span>&nbsp;<span class="op" id="4552486">==</span>&nbsp;<span class="builtintype" id="4552489">nil</span>&nbsp;<span class="op" id="4552493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552497"><a href="/gostd/crypto/tls/handshake_server.go.html#4552388">clientCipher</a></span>&nbsp;<span class="op" id="4552510">=</span>&nbsp;<span class="ident" id="4552512"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552514">.</span><span class="ident" id="4552515"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552520">.</span><span class="ident" id="4552521"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434926">cipher</a></span><span class="op" id="4552527">(</span><span class="ident" id="4552528"><a href="/gostd/crypto/tls/handshake_server.go.html#4552200">clientKey</a></span><span class="op" id="4552537">,</span>&nbsp;<span class="ident" id="4552539"><a href="/gostd/crypto/tls/handshake_server.go.html#4552222">clientIV</a></span><span class="op" id="4552547">,</span>&nbsp;<span class="builtintype" id="4552549">true</span>&nbsp;<span class="comment" id="4552554">/*&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4552571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552575"><a href="/gostd/crypto/tls/handshake_server.go.html#4552432">clientHash</a></span>&nbsp;<span class="op" id="4552586">=</span>&nbsp;<span class="ident" id="4552588"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552590">.</span><span class="ident" id="4552591"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552596">.</span><span class="ident" id="4552597"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434980">mac</a></span><span class="op" id="4552600">(</span><span class="ident" id="4552601"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552602">.</span><span class="ident" id="4552603"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552607">,</span>&nbsp;<span class="ident" id="4552609"><a href="/gostd/crypto/tls/handshake_server.go.html#4552178">clientMAC</a></span><span class="op" id="4552618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552622"><a href="/gostd/crypto/tls/handshake_server.go.html#4552402">serverCipher</a></span>&nbsp;<span class="op" id="4552635">=</span>&nbsp;<span class="ident" id="4552637"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552639">.</span><span class="ident" id="4552640"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552645">.</span><span class="ident" id="4552646"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434926">cipher</a></span><span class="op" id="4552652">(</span><span class="ident" id="4552653"><a href="/gostd/crypto/tls/handshake_server.go.html#4552211">serverKey</a></span><span class="op" id="4552662">,</span>&nbsp;<span class="ident" id="4552664"><a href="/gostd/crypto/tls/handshake_server.go.html#4552232">serverIV</a></span><span class="op" id="4552672">,</span>&nbsp;<span class="builtintype" id="4552674">false</span>&nbsp;<span class="comment" id="4552680">/*&nbsp;not&nbsp;for&nbsp;reading&nbsp;*/</span><span class="op" id="4552701">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552705"><a href="/gostd/crypto/tls/handshake_server.go.html#4552444">serverHash</a></span>&nbsp;<span class="op" id="4552716">=</span>&nbsp;<span class="ident" id="4552718"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552720">.</span><span class="ident" id="4552721"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552726">.</span><span class="ident" id="4552727"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434980">mac</a></span><span class="op" id="4552730">(</span><span class="ident" id="4552731"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552732">.</span><span class="ident" id="4552733"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552737">,</span>&nbsp;<span class="ident" id="4552739"><a href="/gostd/crypto/tls/handshake_server.go.html#4552189">serverMAC</a></span><span class="op" id="4552748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552751">}</span>&nbsp;<span class="keyword" id="4552753">else</span>&nbsp;<span class="op" id="4552758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552762"><a href="/gostd/crypto/tls/handshake_server.go.html#4552388">clientCipher</a></span>&nbsp;<span class="op" id="4552775">=</span>&nbsp;<span class="ident" id="4552777"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552779">.</span><span class="ident" id="4552780"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552785">.</span><span class="ident" id="4552786"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435036">aead</a></span><span class="op" id="4552790">(</span><span class="ident" id="4552791"><a href="/gostd/crypto/tls/handshake_server.go.html#4552200">clientKey</a></span><span class="op" id="4552800">,</span>&nbsp;<span class="ident" id="4552802"><a href="/gostd/crypto/tls/handshake_server.go.html#4552222">clientIV</a></span><span class="op" id="4552810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552814"><a href="/gostd/crypto/tls/handshake_server.go.html#4552402">serverCipher</a></span>&nbsp;<span class="op" id="4552827">=</span>&nbsp;<span class="ident" id="4552829"><a href="/gostd/crypto/tls/handshake_server.go.html#4552115">hs</a></span><span class="op" id="4552831">.</span><span class="ident" id="4552832"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4552837">.</span><span class="ident" id="4552838"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435036">aead</a></span><span class="op" id="4552842">(</span><span class="ident" id="4552843"><a href="/gostd/crypto/tls/handshake_server.go.html#4552211">serverKey</a></span><span class="op" id="4552852">,</span>&nbsp;<span class="ident" id="4552854"><a href="/gostd/crypto/tls/handshake_server.go.html#4552232">serverIV</a></span><span class="op" id="4552862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4552865">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552869"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552870">.</span><span class="ident" id="4552871"><a href="/gostd/crypto/tls/conn.go.html#4463040">in</a></span><span class="op" id="4552873">.</span><span class="ident" id="4552874"><a href="/gostd/crypto/tls/conn.go.html#4465357">prepareCipherSpec</a></span><span class="op" id="4552891">(</span><span class="ident" id="4552892"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552893">.</span><span class="ident" id="4552894"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552898">,</span>&nbsp;<span class="ident" id="4552900"><a href="/gostd/crypto/tls/handshake_server.go.html#4552388">clientCipher</a></span><span class="op" id="4552912">,</span>&nbsp;<span class="ident" id="4552914"><a href="/gostd/crypto/tls/handshake_server.go.html#4552432">clientHash</a></span><span class="op" id="4552924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4552927"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552928">.</span><span class="ident" id="4552929"><a href="/gostd/crypto/tls/conn.go.html#4463044">out</a></span><span class="op" id="4552932">.</span><span class="ident" id="4552933"><a href="/gostd/crypto/tls/conn.go.html#4465357">prepareCipherSpec</a></span><span class="op" id="4552950">(</span><span class="ident" id="4552951"><a href="/gostd/crypto/tls/handshake_server.go.html#4552166">c</a></span><span class="op" id="4552952">.</span><span class="ident" id="4552953"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4552957">,</span>&nbsp;<span class="ident" id="4552959"><a href="/gostd/crypto/tls/handshake_server.go.html#4552402">serverCipher</a></span><span class="op" id="4552971">,</span>&nbsp;<span class="ident" id="4552973"><a href="/gostd/crypto/tls/handshake_server.go.html#4552444">serverHash</a></span><span class="op" id="4552983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4552987">return</span>&nbsp;<span class="builtintype" id="4552994">nil</span><br>
<span class="lineno">500</span><span class="op" id="4552998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4553001">func</span>&nbsp;<span class="op" id="4553006">(</span><span class="ident" id="4553007">hs</span>&nbsp;<span class="op" id="4553010">*</span><span class="ident" id="4553011"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4553031">)</span>&nbsp;<span class="ident" id="4553033">readFinished</span><span class="op" id="4553045">(</span><span class="ident" id="4553046">out</span>&nbsp;<span class="op" id="4553050">[</span><span class="op" id="4553051">]</span><span class="builtintype" id="4553052">byte</span><span class="op" id="4553056">)</span>&nbsp;<span class="builtintype" id="4553058">error</span>&nbsp;<span class="op" id="4553064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553067">c</span>&nbsp;<span class="op" id="4553069">:=</span>&nbsp;<span class="ident" id="4553072"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553074">.</span><span class="ident" id="4553075"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553079"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553080">.</span><span class="ident" id="4553081"><a href="/gostd/crypto/tls/conn.go.html#4475709">readRecord</a></span><span class="op" id="4553091">(</span><span class="ident" id="4553092"><a href="/gostd/crypto/tls/common.go.html#4442934">recordTypeChangeCipherSpec</a></span><span class="op" id="4553118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553121">if</span>&nbsp;<span class="ident" id="4553124">err</span>&nbsp;<span class="op" id="4553128">:=</span>&nbsp;<span class="ident" id="4553131"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553132">.</span><span class="ident" id="4553133"><a href="/gostd/crypto/tls/conn.go.html#4463040">in</a></span><span class="op" id="4553135">.</span><span class="builtintype" id="4553136"><a href="/gostd/crypto/tls/conn.go.html#4465163">error</a></span><span class="op" id="4553141">(</span><span class="op" id="4553142">)</span><span class="op" id="4553143">;</span>&nbsp;<span class="ident" id="4553145"><a href="/gostd/crypto/tls/handshake_server.go.html#4553124">err</a></span>&nbsp;<span class="op" id="4553149">!=</span>&nbsp;<span class="builtintype" id="4553152">nil</span>&nbsp;<span class="op" id="4553156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553160">return</span>&nbsp;<span class="ident" id="4553167"><a href="/gostd/crypto/tls/handshake_server.go.html#4553124">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553176">if</span>&nbsp;<span class="ident" id="4553179"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553181">.</span><span class="ident" id="4553182"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4553187">.</span><span class="ident" id="4553188"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519574">nextProtoNeg</a></span>&nbsp;<span class="op" id="4553201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553205">msg</span><span class="op" id="4553208">,</span>&nbsp;<span class="ident" id="4553210">err</span>&nbsp;<span class="op" id="4553214">:=</span>&nbsp;<span class="ident" id="4553217"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553218">.</span><span class="ident" id="4553219"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4553232">(</span><span class="op" id="4553233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553237">if</span>&nbsp;<span class="ident" id="4553240"><a href="/gostd/crypto/tls/handshake_server.go.html#4553210">err</a></span>&nbsp;<span class="op" id="4553244">!=</span>&nbsp;<span class="builtintype" id="4553247">nil</span>&nbsp;<span class="op" id="4553251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553256">return</span>&nbsp;<span class="ident" id="4553263"><a href="/gostd/crypto/tls/handshake_server.go.html#4553210">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553269">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553273">nextProto</span><span class="op" id="4553282">,</span>&nbsp;<span class="ident" id="4553284">ok</span>&nbsp;<span class="op" id="4553287">:=</span>&nbsp;<span class="ident" id="4553290"><a href="/gostd/crypto/tls/handshake_server.go.html#4553205">msg</a></span><span class="op" id="4553293">.</span><span class="op" id="4553294">(</span><span class="op" id="4553295">*</span><span class="ident" id="4553296"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530220">nextProtoMsg</a></span><span class="op" id="4553308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553312">if</span>&nbsp;<span class="op" id="4553315">!</span><span class="ident" id="4553316"><a href="/gostd/crypto/tls/handshake_server.go.html#4553284">ok</a></span>&nbsp;<span class="op" id="4553319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553324"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553325">.</span><span class="ident" id="4553326"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4553335">(</span><span class="ident" id="4553336"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4553358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553363">return</span>&nbsp;<span class="ident" id="4553370"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4553392">(</span><span class="ident" id="4553393"><a href="/gostd/crypto/tls/handshake_server.go.html#4553273">nextProto</a></span><span class="op" id="4553402">,</span>&nbsp;<span class="ident" id="4553404"><a href="/gostd/crypto/tls/handshake_server.go.html#4553205">msg</a></span><span class="op" id="4553407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553411">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553415"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553417">.</span><span class="ident" id="4553418"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4553430">.</span><span class="ident" id="4553431"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4553436">(</span><span class="ident" id="4553437"><a href="/gostd/crypto/tls/handshake_server.go.html#4553273">nextProto</a></span><span class="op" id="4553446">.</span><span class="ident" id="4553447"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530468">marshal</a></span><span class="op" id="4553454">(</span><span class="op" id="4553455">)</span><span class="op" id="4553456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553460"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553461">.</span><span class="ident" id="4553462"><a href="/gostd/crypto/tls/conn.go.html#4462962">clientProtocol</a></span>&nbsp;<span class="op" id="4553477">=</span>&nbsp;<span class="ident" id="4553479"><a href="/gostd/crypto/tls/handshake_server.go.html#4553273">nextProto</a></span><span class="op" id="4553488">.</span><span class="ident" id="4553489"><a href="/gostd/crypto/tls/handshake_messages.go.html#4530257">proto</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553500">msg</span><span class="op" id="4553503">,</span>&nbsp;<span class="ident" id="4553505">err</span>&nbsp;<span class="op" id="4553509">:=</span>&nbsp;<span class="ident" id="4553512"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553513">.</span><span class="ident" id="4553514"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="4553527">(</span><span class="op" id="4553528">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553531">if</span>&nbsp;<span class="ident" id="4553534"><a href="/gostd/crypto/tls/handshake_server.go.html#4553505">err</a></span>&nbsp;<span class="op" id="4553538">!=</span>&nbsp;<span class="builtintype" id="4553541">nil</span>&nbsp;<span class="op" id="4553545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553549">return</span>&nbsp;<span class="ident" id="4553556"><a href="/gostd/crypto/tls/handshake_server.go.html#4553505">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553564">clientFinished</span><span class="op" id="4553578">,</span>&nbsp;<span class="ident" id="4553580">ok</span>&nbsp;<span class="op" id="4553583">:=</span>&nbsp;<span class="ident" id="4553586"><a href="/gostd/crypto/tls/handshake_server.go.html#4553500">msg</a></span><span class="op" id="4553589">.</span><span class="op" id="4553590">(</span><span class="op" id="4553591">*</span><span class="ident" id="4553592"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529593">finishedMsg</a></span><span class="op" id="4553603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553606">if</span>&nbsp;<span class="op" id="4553609">!</span><span class="ident" id="4553610"><a href="/gostd/crypto/tls/handshake_server.go.html#4553580">ok</a></span>&nbsp;<span class="op" id="4553613">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553617"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553618">.</span><span class="ident" id="4553619"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4553628">(</span><span class="ident" id="4553629"><a href="/gostd/crypto/tls/alert.go.html#4430296">alertUnexpectedMessage</a></span><span class="op" id="4553651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553655">return</span>&nbsp;<span class="ident" id="4553662"><a href="/gostd/crypto/tls/common.go.html#4461311">unexpectedMessageError</a></span><span class="op" id="4553684">(</span><span class="ident" id="4553685"><a href="/gostd/crypto/tls/handshake_server.go.html#4553564">clientFinished</a></span><span class="op" id="4553699">,</span>&nbsp;<span class="ident" id="4553701"><a href="/gostd/crypto/tls/handshake_server.go.html#4553500">msg</a></span><span class="op" id="4553704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553711">verify</span>&nbsp;<span class="op" id="4553718">:=</span>&nbsp;<span class="ident" id="4553721"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553723">.</span><span class="ident" id="4553724"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4553736">.</span><span class="ident" id="4553737"><a href="/gostd/crypto/tls/prf.go.html#4577233">clientSum</a></span><span class="op" id="4553746">(</span><span class="ident" id="4553747"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553749">.</span><span class="ident" id="4553750"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span><span class="op" id="4553762">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553765">if</span>&nbsp;<span class="builtinfunc" id="4553768">len</span><span class="op" id="4553771">(</span><span class="ident" id="4553772"><a href="/gostd/crypto/tls/handshake_server.go.html#4553711">verify</a></span><span class="op" id="4553778">)</span>&nbsp;<span class="op" id="4553780">!=</span>&nbsp;<span class="builtinfunc" id="4553783">len</span><span class="op" id="4553786">(</span><span class="ident" id="4553787"><a href="/gostd/crypto/tls/handshake_server.go.html#4553564">clientFinished</a></span><span class="op" id="4553801">.</span><span class="ident" id="4553802"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4553812">)</span>&nbsp;<span class="op" id="4553814">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553819"><a href="/gostd/crypto/tls/handshake_server.go.html#4538631">subtle</a></span><span class="op" id="4553825">.</span><span class="ident" id="4553826"><a href="/gostd/crypto/subtle/constant_time.go.html#4428560">ConstantTimeCompare</a></span><span class="op" id="4553845">(</span><span class="ident" id="4553846"><a href="/gostd/crypto/tls/handshake_server.go.html#4553711">verify</a></span><span class="op" id="4553852">,</span>&nbsp;<span class="ident" id="4553854"><a href="/gostd/crypto/tls/handshake_server.go.html#4553564">clientFinished</a></span><span class="op" id="4553868">.</span><span class="ident" id="4553869"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4553879">)</span>&nbsp;<span class="op" id="4553881">!=</span>&nbsp;<span class="num" id="4553884">1</span>&nbsp;<span class="op" id="4553886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553890"><a href="/gostd/crypto/tls/handshake_server.go.html#4553067">c</a></span><span class="op" id="4553891">.</span><span class="ident" id="4553892"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4553901">(</span><span class="ident" id="4553902"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4553923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4553927">return</span>&nbsp;<span class="ident" id="4553934"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4553940">.</span><span class="ident" id="4553941"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4553944">(</span><span class="string" id="4553945">&#34;tls:&nbsp;client&#39;s&nbsp;Finished&nbsp;message&nbsp;is&nbsp;incorrect&#34;</span><span class="op" id="4553990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4553993">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4553997"><a href="/gostd/crypto/tls/handshake_server.go.html#4553007">hs</a></span><span class="op" id="4553999">.</span><span class="ident" id="4554000"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4554012">.</span><span class="ident" id="4554013"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4554018">(</span><span class="ident" id="4554019"><a href="/gostd/crypto/tls/handshake_server.go.html#4553564">clientFinished</a></span><span class="op" id="4554033">.</span><span class="ident" id="4554034"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4554041">(</span><span class="op" id="4554042">)</span><span class="op" id="4554043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4554046">copy</span><span class="op" id="4554050">(</span><span class="ident" id="4554051"><a href="/gostd/crypto/tls/handshake_server.go.html#4553046">out</a></span><span class="op" id="4554054">,</span>&nbsp;<span class="ident" id="4554056"><a href="/gostd/crypto/tls/handshake_server.go.html#4553711">verify</a></span><span class="op" id="4554062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554065">return</span>&nbsp;<span class="builtintype" id="4554072">nil</span><br>
<span class="lineno"></span><span class="op" id="4554076">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="keyword" id="4554079">func</span>&nbsp;<span class="op" id="4554084">(</span><span class="ident" id="4554085">hs</span>&nbsp;<span class="op" id="4554088">*</span><span class="ident" id="4554089"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4554109">)</span>&nbsp;<span class="ident" id="4554111">sendSessionTicket</span><span class="op" id="4554128">(</span><span class="op" id="4554129">)</span>&nbsp;<span class="builtintype" id="4554131">error</span>&nbsp;<span class="op" id="4554137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554140">if</span>&nbsp;<span class="op" id="4554143">!</span><span class="ident" id="4554144"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554146">.</span><span class="ident" id="4554147"><a href="/gostd/crypto/tls/handshake_server.go.html#4538925">hello</a></span><span class="op" id="4554152">.</span><span class="ident" id="4554153"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519656">ticketSupported</a></span>&nbsp;<span class="op" id="4554169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554173">return</span>&nbsp;<span class="builtintype" id="4554180">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554185">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554189">c</span>&nbsp;<span class="op" id="4554191">:=</span>&nbsp;<span class="ident" id="4554194"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554196">.</span><span class="ident" id="4554197"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554200">m</span>&nbsp;<span class="op" id="4554202">:=</span>&nbsp;<span class="builtinfunc" id="4554205">new</span><span class="op" id="4554208">(</span><span class="ident" id="4554209"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536457">newSessionTicketMsg</a></span><span class="op" id="4554228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554232">var</span>&nbsp;<span class="ident" id="4554236">err</span>&nbsp;<span class="builtintype" id="4554240">error</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554247">state</span>&nbsp;<span class="op" id="4554253">:=</span>&nbsp;<span class="ident" id="4554256"><a href="/gostd/crypto/tls/ticket.go.html#4579384">sessionState</a></span><span class="op" id="4554268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554272"><a href="/gostd/crypto/tls/ticket.go.html#4579407">vers</a></span><span class="op" id="4554276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554286"><a href="/gostd/crypto/tls/handshake_server.go.html#4554189">c</a></span><span class="op" id="4554287">.</span><span class="ident" id="4554288"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span><span class="op" id="4554292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554296"><a href="/gostd/crypto/tls/ticket.go.html#4579428">cipherSuite</a></span><span class="op" id="4554307">:</span>&nbsp;&nbsp;<span class="ident" id="4554310"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554312">.</span><span class="ident" id="4554313"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4554318">.</span><span class="ident" id="4554319"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><span class="op" id="4554321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554325"><a href="/gostd/crypto/tls/ticket.go.html#4579449">masterSecret</a></span><span class="op" id="4554337">:</span>&nbsp;<span class="ident" id="4554339"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554341">.</span><span class="ident" id="4554342"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span><span class="op" id="4554354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554358"><a href="/gostd/crypto/tls/ticket.go.html#4579470">certificates</a></span><span class="op" id="4554370">:</span>&nbsp;<span class="ident" id="4554372"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554374">.</span><span class="ident" id="4554375"><a href="/gostd/crypto/tls/handshake_server.go.html#4539117">certsFromClient</a></span><span class="op" id="4554390">,</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554396"><a href="/gostd/crypto/tls/handshake_server.go.html#4554200">m</a></span><span class="op" id="4554397">.</span><span class="ident" id="4554398"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536502">ticket</a></span><span class="op" id="4554404">,</span>&nbsp;<span class="ident" id="4554406"><a href="/gostd/crypto/tls/handshake_server.go.html#4554236">err</a></span>&nbsp;<span class="op" id="4554410">=</span>&nbsp;<span class="ident" id="4554412"><a href="/gostd/crypto/tls/handshake_server.go.html#4554189">c</a></span><span class="op" id="4554413">.</span><span class="ident" id="4554414"><a href="/gostd/crypto/tls/ticket.go.html#4581608">encryptTicket</a></span><span class="op" id="4554427">(</span><span class="op" id="4554428">&amp;</span><span class="ident" id="4554429"><a href="/gostd/crypto/tls/handshake_server.go.html#4554247">state</a></span><span class="op" id="4554434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554437">if</span>&nbsp;<span class="ident" id="4554440"><a href="/gostd/crypto/tls/handshake_server.go.html#4554236">err</a></span>&nbsp;<span class="op" id="4554444">!=</span>&nbsp;<span class="builtintype" id="4554447">nil</span>&nbsp;<span class="op" id="4554451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554455">return</span>&nbsp;<span class="ident" id="4554462"><a href="/gostd/crypto/tls/handshake_server.go.html#4554236">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4554467">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554471"><a href="/gostd/crypto/tls/handshake_server.go.html#4554085">hs</a></span><span class="op" id="4554473">.</span><span class="ident" id="4554474"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4554486">.</span><span class="ident" id="4554487"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4554492">(</span><span class="ident" id="4554493"><a href="/gostd/crypto/tls/handshake_server.go.html#4554200">m</a></span><span class="op" id="4554494">.</span><span class="ident" id="4554495"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536748">marshal</a></span><span class="op" id="4554502">(</span><span class="op" id="4554503">)</span><span class="op" id="4554504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554507"><a href="/gostd/crypto/tls/handshake_server.go.html#4554189">c</a></span><span class="op" id="4554508">.</span><span class="ident" id="4554509"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4554520">(</span><span class="ident" id="4554521"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4554540">,</span>&nbsp;<span class="ident" id="4554542"><a href="/gostd/crypto/tls/handshake_server.go.html#4554200">m</a></span><span class="op" id="4554543">.</span><span class="ident" id="4554544"><a href="/gostd/crypto/tls/handshake_messages.go.html#4536748">marshal</a></span><span class="op" id="4554551">(</span><span class="op" id="4554552">)</span><span class="op" id="4554553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554557">return</span>&nbsp;<span class="builtintype" id="4554564">nil</span><br>
<span class="lineno">570</span><span class="op" id="4554568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4554571">func</span>&nbsp;<span class="op" id="4554576">(</span><span class="ident" id="4554577">hs</span>&nbsp;<span class="op" id="4554580">*</span><span class="ident" id="4554581"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4554601">)</span>&nbsp;<span class="ident" id="4554603">sendFinished</span><span class="op" id="4554615">(</span><span class="ident" id="4554616">out</span>&nbsp;<span class="op" id="4554620">[</span><span class="op" id="4554621">]</span><span class="builtintype" id="4554622">byte</span><span class="op" id="4554626">)</span>&nbsp;<span class="builtintype" id="4554628">error</span>&nbsp;<span class="op" id="4554634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554637">c</span>&nbsp;<span class="op" id="4554639">:=</span>&nbsp;<span class="ident" id="4554642"><a href="/gostd/crypto/tls/handshake_server.go.html#4554577">hs</a></span><span class="op" id="4554644">.</span><span class="ident" id="4554645"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554649"><a href="/gostd/crypto/tls/handshake_server.go.html#4554637">c</a></span><span class="op" id="4554650">.</span><span class="ident" id="4554651"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4554662">(</span><span class="ident" id="4554663"><a href="/gostd/crypto/tls/common.go.html#4442934">recordTypeChangeCipherSpec</a></span><span class="op" id="4554689">,</span>&nbsp;<span class="op" id="4554691">[</span><span class="op" id="4554692">]</span><span class="builtintype" id="4554693">byte</span><span class="op" id="4554697">{</span><span class="num" id="4554698">1</span><span class="op" id="4554699">}</span><span class="op" id="4554700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554704">finished</span>&nbsp;<span class="op" id="4554713">:=</span>&nbsp;<span class="builtinfunc" id="4554716">new</span><span class="op" id="4554719">(</span><span class="ident" id="4554720"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529593">finishedMsg</a></span><span class="op" id="4554731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554734"><a href="/gostd/crypto/tls/handshake_server.go.html#4554704">finished</a></span><span class="op" id="4554742">.</span><span class="ident" id="4554743"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span>&nbsp;<span class="op" id="4554754">=</span>&nbsp;<span class="ident" id="4554756"><a href="/gostd/crypto/tls/handshake_server.go.html#4554577">hs</a></span><span class="op" id="4554758">.</span><span class="ident" id="4554759"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4554771">.</span><span class="ident" id="4554772"><a href="/gostd/crypto/tls/prf.go.html#4577855">serverSum</a></span><span class="op" id="4554781">(</span><span class="ident" id="4554782"><a href="/gostd/crypto/tls/handshake_server.go.html#4554577">hs</a></span><span class="op" id="4554784">.</span><span class="ident" id="4554785"><a href="/gostd/crypto/tls/handshake_server.go.html#4539093">masterSecret</a></span><span class="op" id="4554797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554800"><a href="/gostd/crypto/tls/handshake_server.go.html#4554577">hs</a></span><span class="op" id="4554802">.</span><span class="ident" id="4554803"><a href="/gostd/crypto/tls/handshake_server.go.html#4539063">finishedHash</a></span><span class="op" id="4554815">.</span><span class="ident" id="4554816"><a href="/gostd/crypto/tls/prf.go.html#4575984">Write</a></span><span class="op" id="4554821">(</span><span class="ident" id="4554822"><a href="/gostd/crypto/tls/handshake_server.go.html#4554704">finished</a></span><span class="op" id="4554830">.</span><span class="ident" id="4554831"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4554838">(</span><span class="op" id="4554839">)</span><span class="op" id="4554840">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554843"><a href="/gostd/crypto/tls/handshake_server.go.html#4554637">c</a></span><span class="op" id="4554844">.</span><span class="ident" id="4554845"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="4554856">(</span><span class="ident" id="4554857"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="4554876">,</span>&nbsp;<span class="ident" id="4554878"><a href="/gostd/crypto/tls/handshake_server.go.html#4554704">finished</a></span><span class="op" id="4554886">.</span><span class="ident" id="4554887"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529868">marshal</a></span><span class="op" id="4554894">(</span><span class="op" id="4554895">)</span><span class="op" id="4554896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4554900"><a href="/gostd/crypto/tls/handshake_server.go.html#4554637">c</a></span><span class="op" id="4554901">.</span><span class="ident" id="4554902"><a href="/gostd/crypto/tls/conn.go.html#4462443">cipherSuite</a></span>&nbsp;<span class="op" id="4554914">=</span>&nbsp;<span class="ident" id="4554916"><a href="/gostd/crypto/tls/handshake_server.go.html#4554577">hs</a></span><span class="op" id="4554918">.</span><span class="ident" id="4554919"><a href="/gostd/crypto/tls/handshake_server.go.html#4538958">suite</a></span><span class="op" id="4554924">.</span><span class="ident" id="4554925"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4554929">copy</span><span class="op" id="4554933">(</span><span class="ident" id="4554934"><a href="/gostd/crypto/tls/handshake_server.go.html#4554616">out</a></span><span class="op" id="4554937">,</span>&nbsp;<span class="ident" id="4554939"><a href="/gostd/crypto/tls/handshake_server.go.html#4554704">finished</a></span><span class="op" id="4554947">.</span><span class="ident" id="4554948"><a href="/gostd/crypto/tls/handshake_messages.go.html#4529634">verifyData</a></span><span class="op" id="4554958">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4554962">return</span>&nbsp;<span class="builtintype" id="4554969">nil</span><br>
<span class="lineno"></span><span class="op" id="4554973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4554976">//&nbsp;processCertsFromClient&nbsp;takes&nbsp;a&nbsp;chain&nbsp;of&nbsp;client&nbsp;certificates&nbsp;either&nbsp;from&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4555053">//&nbsp;Certificates&nbsp;message&nbsp;or&nbsp;from&nbsp;a&nbsp;sessionState&nbsp;and&nbsp;verifies&nbsp;them.&nbsp;It&nbsp;returns</span><br>
<span class="lineno">590</span><span class="comment" id="4555130">//&nbsp;the&nbsp;public&nbsp;key&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4555173">func</span>&nbsp;<span class="op" id="4555178">(</span><span class="ident" id="4555179">hs</span>&nbsp;<span class="op" id="4555182">*</span><span class="ident" id="4555183"><a href="/gostd/crypto/tls/handshake_server.go.html#4538838">serverHandshakeState</a></span><span class="op" id="4555203">)</span>&nbsp;<span class="ident" id="4555205">processCertsFromClient</span><span class="op" id="4555227">(</span><span class="ident" id="4555228">certificates</span>&nbsp;<span class="op" id="4555241">[</span><span class="op" id="4555242">]</span><span class="op" id="4555243">[</span><span class="op" id="4555244">]</span><span class="builtintype" id="4555245">byte</span><span class="op" id="4555249">)</span>&nbsp;<span class="op" id="4555251">(</span><span class="ident" id="4555252"><a href="/gostd/crypto/tls/handshake_server.go.html#4538591">crypto</a></span><span class="op" id="4555258">.</span><span class="ident" id="4555259"><a href="/gostd/crypto/crypto.go.html#3012471">PublicKey</a></span><span class="op" id="4555268">,</span>&nbsp;<span class="builtintype" id="4555270">error</span><span class="op" id="4555275">)</span>&nbsp;<span class="op" id="4555277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555280">c</span>&nbsp;<span class="op" id="4555282">:=</span>&nbsp;<span class="ident" id="4555285"><a href="/gostd/crypto/tls/handshake_server.go.html#4555179">hs</a></span><span class="op" id="4555287">.</span><span class="ident" id="4555288"><a href="/gostd/crypto/tls/handshake_server.go.html#4538869">c</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555292"><a href="/gostd/crypto/tls/handshake_server.go.html#4555179">hs</a></span><span class="op" id="4555294">.</span><span class="ident" id="4555295"><a href="/gostd/crypto/tls/handshake_server.go.html#4539117">certsFromClient</a></span>&nbsp;<span class="op" id="4555311">=</span>&nbsp;<span class="ident" id="4555313"><a href="/gostd/crypto/tls/handshake_server.go.html#4555228">certificates</a></span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555327">certs</span>&nbsp;<span class="op" id="4555333">:=</span>&nbsp;<span class="builtinfunc" id="4555336">make</span><span class="op" id="4555340">(</span><span class="op" id="4555341">[</span><span class="op" id="4555342">]</span><span class="op" id="4555343">*</span><span class="ident" id="4555344"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555348">.</span><span class="ident" id="4555349"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4555360">,</span>&nbsp;<span class="builtinfunc" id="4555362">len</span><span class="op" id="4555365">(</span><span class="ident" id="4555366"><a href="/gostd/crypto/tls/handshake_server.go.html#4555228">certificates</a></span><span class="op" id="4555378">)</span><span class="op" id="4555379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555382">var</span>&nbsp;<span class="ident" id="4555386">err</span>&nbsp;<span class="builtintype" id="4555390">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555397">for</span>&nbsp;<span class="ident" id="4555401">i</span><span class="op" id="4555402">,</span>&nbsp;<span class="ident" id="4555404">asn1Data</span>&nbsp;<span class="op" id="4555413">:=</span>&nbsp;<span class="keyword" id="4555416">range</span>&nbsp;<span class="ident" id="4555422"><a href="/gostd/crypto/tls/handshake_server.go.html#4555228">certificates</a></span>&nbsp;<span class="op" id="4555435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555439">if</span>&nbsp;<span class="ident" id="4555442"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4555447">[</span><span class="ident" id="4555448"><a href="/gostd/crypto/tls/handshake_server.go.html#4555401">i</a></span><span class="op" id="4555449">]</span><span class="op" id="4555450">,</span>&nbsp;<span class="ident" id="4555452"><a href="/gostd/crypto/tls/handshake_server.go.html#4555386">err</a></span>&nbsp;<span class="op" id="4555456">=</span>&nbsp;<span class="ident" id="4555458"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555462">.</span><span class="ident" id="4555463"><a href="/gostd/crypto/x509/x509.go.html#4679509">ParseCertificate</a></span><span class="op" id="4555479">(</span><span class="ident" id="4555480"><a href="/gostd/crypto/tls/handshake_server.go.html#4555404">asn1Data</a></span><span class="op" id="4555488">)</span><span class="op" id="4555489">;</span>&nbsp;<span class="ident" id="4555491"><a href="/gostd/crypto/tls/handshake_server.go.html#4555386">err</a></span>&nbsp;<span class="op" id="4555495">!=</span>&nbsp;<span class="builtintype" id="4555498">nil</span>&nbsp;<span class="op" id="4555502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555507"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4555508">.</span><span class="ident" id="4555509"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4555518">(</span><span class="ident" id="4555519"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4555538">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555543">return</span>&nbsp;<span class="builtintype" id="4555550">nil</span><span class="op" id="4555553">,</span>&nbsp;<span class="ident" id="4555555"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4555561">.</span><span class="ident" id="4555562"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4555565">(</span><span class="string" id="4555566">&#34;tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;client&nbsp;certificate:&nbsp;&#34;</span>&nbsp;<span class="op" id="4555610">+</span>&nbsp;<span class="ident" id="4555612"><a href="/gostd/crypto/tls/handshake_server.go.html#4555386">err</a></span><span class="op" id="4555615">.</span><span class="ident" id="4555616">Error</span><span class="op" id="4555621">(</span><span class="op" id="4555622">)</span><span class="op" id="4555623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555634">if</span>&nbsp;<span class="ident" id="4555637"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4555638">.</span><span class="ident" id="4555639"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4555645">.</span><span class="ident" id="4555646"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="4555657">&gt;=</span>&nbsp;<span class="ident" id="4555660"><a href="/gostd/crypto/tls/common.go.html#4448013">VerifyClientCertIfGiven</a></span>&nbsp;<span class="op" id="4555684">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4555687">len</span><span class="op" id="4555690">(</span><span class="ident" id="4555691"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4555696">)</span>&nbsp;<span class="op" id="4555698">&gt;</span>&nbsp;<span class="num" id="4555700">0</span>&nbsp;<span class="op" id="4555702">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555706">opts</span>&nbsp;<span class="op" id="4555711">:=</span>&nbsp;<span class="ident" id="4555714"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555718">.</span><span class="ident" id="4555719"><a href="/gostd/crypto/x509/verify.go.html#4635470">VerifyOptions</a></span><span class="op" id="4555732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555737"><a href="/gostd/crypto/x509/verify.go.html#4635541">Roots</a></span><span class="op" id="4555742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555752"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4555753">.</span><span class="ident" id="4555754"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4555760">.</span><span class="ident" id="4555761"><a href="/gostd/crypto/tls/common.go.html#4452596">ClientCAs</a></span><span class="op" id="4555770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555775"><a href="/gostd/crypto/x509/verify.go.html#4635603">CurrentTime</a></span><span class="op" id="4555786">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4555790"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4555791">.</span><span class="ident" id="4555792"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4555798">.</span><span class="ident" id="4555799"><a href="/gostd/crypto/tls/common.go.html#4455197">time</a></span><span class="op" id="4555803">(</span><span class="op" id="4555804">)</span><span class="op" id="4555805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555810"><a href="/gostd/crypto/x509/verify.go.html#4635516">Intermediates</a></span><span class="op" id="4555823">:</span>&nbsp;<span class="ident" id="4555825"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555829">.</span><span class="ident" id="4555830"><a href="/gostd/crypto/x509/cert_pool.go.html#4613595">NewCertPool</a></span><span class="op" id="4555841">(</span><span class="op" id="4555842">)</span><span class="op" id="4555843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555848"><a href="/gostd/crypto/x509/verify.go.html#4635953">KeyUsages</a></span><span class="op" id="4555857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555863">[</span><span class="op" id="4555864">]</span><span class="ident" id="4555865"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555869">.</span><span class="ident" id="4555870"><a href="/gostd/crypto/x509/x509.go.html#4658086">ExtKeyUsage</a></span><span class="op" id="4555881">{</span><span class="ident" id="4555882"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4555886">.</span><span class="ident" id="4555887"><a href="/gostd/crypto/x509/x509.go.html#4658170">ExtKeyUsageClientAuth</a></span><span class="op" id="4555908">}</span><span class="op" id="4555909">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4555918">for</span>&nbsp;<span class="ident" id="4555922">_</span><span class="op" id="4555923">,</span>&nbsp;<span class="ident" id="4555925">cert</span>&nbsp;<span class="op" id="4555930">:=</span>&nbsp;<span class="keyword" id="4555933">range</span>&nbsp;<span class="ident" id="4555939"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4555944">[</span><span class="num" id="4555945">1</span><span class="op" id="4555946">:</span><span class="op" id="4555947">]</span>&nbsp;<span class="op" id="4555949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555954"><a href="/gostd/crypto/tls/handshake_server.go.html#4555706">opts</a></span><span class="op" id="4555958">.</span><span class="ident" id="4555959"><a href="/gostd/crypto/x509/verify.go.html#4635516">Intermediates</a></span><span class="op" id="4555972">.</span><span class="ident" id="4555973"><a href="/gostd/crypto/x509/cert_pool.go.html#4614529">AddCert</a></span><span class="op" id="4555980">(</span><span class="ident" id="4555981"><a href="/gostd/crypto/tls/handshake_server.go.html#4555925">cert</a></span><span class="op" id="4555985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4555989">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4555994">chains</span><span class="op" id="4556000">,</span>&nbsp;<span class="ident" id="4556002">err</span>&nbsp;<span class="op" id="4556006">:=</span>&nbsp;<span class="ident" id="4556009"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4556014">[</span><span class="num" id="4556015">0</span><span class="op" id="4556016">]</span><span class="op" id="4556017">.</span><span class="ident" id="4556018"><a href="/gostd/crypto/x509/verify.go.html#4638730">Verify</a></span><span class="op" id="4556024">(</span><span class="ident" id="4556025"><a href="/gostd/crypto/tls/handshake_server.go.html#4555706">opts</a></span><span class="op" id="4556029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556033">if</span>&nbsp;<span class="ident" id="4556036"><a href="/gostd/crypto/tls/handshake_server.go.html#4556002">err</a></span>&nbsp;<span class="op" id="4556040">!=</span>&nbsp;<span class="builtintype" id="4556043">nil</span>&nbsp;<span class="op" id="4556047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556052"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4556053">.</span><span class="ident" id="4556054"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4556063">(</span><span class="ident" id="4556064"><a href="/gostd/crypto/tls/alert.go.html#4430536">alertBadCertificate</a></span><span class="op" id="4556083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556088">return</span>&nbsp;<span class="builtintype" id="4556095">nil</span><span class="op" id="4556098">,</span>&nbsp;<span class="ident" id="4556100"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4556106">.</span><span class="ident" id="4556107"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4556110">(</span><span class="string" id="4556111">&#34;tls:&nbsp;failed&nbsp;to&nbsp;verify&nbsp;client&#39;s&nbsp;certificate:&nbsp;&#34;</span>&nbsp;<span class="op" id="4556158">+</span>&nbsp;<span class="ident" id="4556160"><a href="/gostd/crypto/tls/handshake_server.go.html#4556002">err</a></span><span class="op" id="4556163">.</span><span class="ident" id="4556164">Error</span><span class="op" id="4556169">(</span><span class="op" id="4556170">)</span><span class="op" id="4556171">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556180">ok</span>&nbsp;<span class="op" id="4556183">:=</span>&nbsp;<span class="builtintype" id="4556186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556194">for</span>&nbsp;<span class="ident" id="4556198">_</span><span class="op" id="4556199">,</span>&nbsp;<span class="ident" id="4556201">ku</span>&nbsp;<span class="op" id="4556204">:=</span>&nbsp;<span class="keyword" id="4556207">range</span>&nbsp;<span class="ident" id="4556213"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4556218">[</span><span class="num" id="4556219">0</span><span class="op" id="4556220">]</span><span class="op" id="4556221">.</span><span class="ident" id="4556222"><a href="/gostd/crypto/x509/x509.go.html#4661099">ExtKeyUsage</a></span>&nbsp;<span class="op" id="4556234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556239">if</span>&nbsp;<span class="ident" id="4556242"><a href="/gostd/crypto/tls/handshake_server.go.html#4556201">ku</a></span>&nbsp;<span class="op" id="4556245">==</span>&nbsp;<span class="ident" id="4556248"><a href="/gostd/crypto/tls/handshake_server.go.html#4538648">x509</a></span><span class="op" id="4556252">.</span><span class="ident" id="4556253"><a href="/gostd/crypto/x509/x509.go.html#4658170">ExtKeyUsageClientAuth</a></span>&nbsp;<span class="op" id="4556275">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556281"><a href="/gostd/crypto/tls/handshake_server.go.html#4556180">ok</a></span>&nbsp;<span class="op" id="4556284">=</span>&nbsp;<span class="builtintype" id="4556286">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556295">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556312">if</span>&nbsp;<span class="op" id="4556315">!</span><span class="ident" id="4556316"><a href="/gostd/crypto/tls/handshake_server.go.html#4556180">ok</a></span>&nbsp;<span class="op" id="4556319">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556324"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4556325">.</span><span class="ident" id="4556326"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4556335">(</span><span class="ident" id="4556336"><a href="/gostd/crypto/tls/alert.go.html#4430496">alertHandshakeFailure</a></span><span class="op" id="4556357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556362">return</span>&nbsp;<span class="builtintype" id="4556369">nil</span><span class="op" id="4556372">,</span>&nbsp;<span class="ident" id="4556374"><a href="/gostd/crypto/tls/handshake_server.go.html#4538680">errors</a></span><span class="op" id="4556380">.</span><span class="ident" id="4556381"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4556384">(</span><span class="string" id="4556385">&#34;tls:&nbsp;client&#39;s&nbsp;certificate&#39;s&nbsp;extended&nbsp;key&nbsp;usage&nbsp;doesn&#39;t&nbsp;permit&nbsp;it&nbsp;to&nbsp;be&nbsp;used&nbsp;for&nbsp;client&nbsp;authentication&#34;</span><span class="op" id="4556488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556497"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4556498">.</span><span class="ident" id="4556499"><a href="/gostd/crypto/tls/conn.go.html#4462677">verifiedChains</a></span>&nbsp;<span class="op" id="4556514">=</span>&nbsp;<span class="ident" id="4556516"><a href="/gostd/crypto/tls/handshake_server.go.html#4555994">chains</a></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556528">if</span>&nbsp;<span class="builtinfunc" id="4556531">len</span><span class="op" id="4556534">(</span><span class="ident" id="4556535"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4556540">)</span>&nbsp;<span class="op" id="4556542">&gt;</span>&nbsp;<span class="num" id="4556544">0</span>&nbsp;<span class="op" id="4556546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556550">var</span>&nbsp;<span class="ident" id="4556554">pub</span>&nbsp;<span class="ident" id="4556558"><a href="/gostd/crypto/tls/handshake_server.go.html#4538591">crypto</a></span><span class="op" id="4556564">.</span><span class="ident" id="4556565"><a href="/gostd/crypto/crypto.go.html#3012471">PublicKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556577">switch</span>&nbsp;<span class="ident" id="4556584">key</span>&nbsp;<span class="op" id="4556588">:=</span>&nbsp;<span class="ident" id="4556591"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4556596">[</span><span class="num" id="4556597">0</span><span class="op" id="4556598">]</span><span class="op" id="4556599">.</span><span class="ident" id="4556600"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4556609">.</span><span class="op" id="4556610">(</span><span class="keyword" id="4556611">type</span><span class="op" id="4556615">)</span>&nbsp;<span class="op" id="4556617">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556621">case</span>&nbsp;<span class="op" id="4556626">*</span><span class="ident" id="4556627"><a href="/gostd/crypto/tls/handshake_server.go.html#4538601">ecdsa</a></span><span class="op" id="4556632">.</span><span class="ident" id="4556633"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4556642">,</span>&nbsp;<span class="op" id="4556644">*</span><span class="ident" id="4556645"><a href="/gostd/crypto/tls/handshake_server.go.html#4538617">rsa</a></span><span class="op" id="4556648">.</span><span class="ident" id="4556649"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4556658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556663"><a href="/gostd/crypto/tls/handshake_server.go.html#4556554">pub</a></span>&nbsp;<span class="op" id="4556667">=</span>&nbsp;<span class="ident" id="4556669"><a href="/gostd/crypto/tls/handshake_server.go.html#4556584">key</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556675">default</span><span class="op" id="4556682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556687"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4556688">.</span><span class="ident" id="4556689"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="4556698">(</span><span class="ident" id="4556699"><a href="/gostd/crypto/tls/alert.go.html#4430576">alertUnsupportedCertificate</a></span><span class="op" id="4556726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556731">return</span>&nbsp;<span class="builtintype" id="4556738">nil</span><span class="op" id="4556741">,</span>&nbsp;<span class="ident" id="4556743"><a href="/gostd/crypto/tls/handshake_server.go.html#4538690">fmt</a></span><span class="op" id="4556746">.</span><span class="ident" id="4556747"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4556753">(</span><span class="string" id="4556754">&#34;tls:&nbsp;client&#39;s&nbsp;certificate&nbsp;contains&nbsp;an&nbsp;unsupported&nbsp;public&nbsp;key&nbsp;of&nbsp;type&nbsp;%T&#34;</span><span class="op" id="4556827">,</span>&nbsp;<span class="ident" id="4556829"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><span class="op" id="4556834">[</span><span class="num" id="4556835">0</span><span class="op" id="4556836">]</span><span class="op" id="4556837">.</span><span class="ident" id="4556838"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4556847">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4556855"><a href="/gostd/crypto/tls/handshake_server.go.html#4555280">c</a></span><span class="op" id="4556856">.</span><span class="ident" id="4556857"><a href="/gostd/crypto/tls/conn.go.html#4462520">peerCertificates</a></span>&nbsp;<span class="op" id="4556874">=</span>&nbsp;<span class="ident" id="4556876"><a href="/gostd/crypto/tls/handshake_server.go.html#4555327">certs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556884">return</span>&nbsp;<span class="ident" id="4556891"><a href="/gostd/crypto/tls/handshake_server.go.html#4556554">pub</a></span><span class="op" id="4556894">,</span>&nbsp;<span class="builtintype" id="4556896">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4556901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4556905">return</span>&nbsp;<span class="builtintype" id="4556912">nil</span><span class="op" id="4556915">,</span>&nbsp;<span class="builtintype" id="4556917">nil</span><br>
<span class="lineno"></span><span class="op" id="4556921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4556924">//&nbsp;tryCipherSuite&nbsp;returns&nbsp;a&nbsp;cipherSuite&nbsp;with&nbsp;the&nbsp;given&nbsp;id&nbsp;if&nbsp;that&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span><span class="comment" id="4557003">//&nbsp;is&nbsp;acceptable&nbsp;to&nbsp;use.</span><br>
<span class="lineno">655</span><span class="keyword" id="4557028">func</span>&nbsp;<span class="op" id="4557033">(</span><span class="ident" id="4557034">c</span>&nbsp;<span class="op" id="4557036">*</span><span class="ident" id="4557037"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4557041">)</span>&nbsp;<span class="ident" id="4557043">tryCipherSuite</span><span class="op" id="4557057">(</span><span class="ident" id="4557058">id</span>&nbsp;<span class="builtintype" id="4557061">uint16</span><span class="op" id="4557067">,</span>&nbsp;<span class="ident" id="4557069">supportedCipherSuites</span>&nbsp;<span class="op" id="4557091">[</span><span class="op" id="4557092">]</span><span class="builtintype" id="4557093">uint16</span><span class="op" id="4557099">,</span>&nbsp;<span class="ident" id="4557101">version</span>&nbsp;<span class="builtintype" id="4557109">uint16</span><span class="op" id="4557115">,</span>&nbsp;<span class="ident" id="4557117">ellipticOk</span><span class="op" id="4557127">,</span>&nbsp;<span class="ident" id="4557129">ecdsaOk</span>&nbsp;<span class="builtintype" id="4557137">bool</span><span class="op" id="4557141">)</span>&nbsp;<span class="op" id="4557143">*</span><span class="ident" id="4557144"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434677">cipherSuite</a></span>&nbsp;<span class="op" id="4557156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557159">for</span>&nbsp;<span class="ident" id="4557163">_</span><span class="op" id="4557164">,</span>&nbsp;<span class="ident" id="4557166">supported</span>&nbsp;<span class="op" id="4557176">:=</span>&nbsp;<span class="keyword" id="4557179">range</span>&nbsp;<span class="ident" id="4557185"><a href="/gostd/crypto/tls/handshake_server.go.html#4557069">supportedCipherSuites</a></span>&nbsp;<span class="op" id="4557207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557211">if</span>&nbsp;<span class="ident" id="4557214"><a href="/gostd/crypto/tls/handshake_server.go.html#4557058">id</a></span>&nbsp;<span class="op" id="4557217">==</span>&nbsp;<span class="ident" id="4557220"><a href="/gostd/crypto/tls/handshake_server.go.html#4557166">supported</a></span>&nbsp;<span class="op" id="4557230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557235">var</span>&nbsp;<span class="ident" id="4557239">candidate</span>&nbsp;<span class="op" id="4557249">*</span><span class="ident" id="4557250"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434677">cipherSuite</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557266">for</span>&nbsp;<span class="ident" id="4557270">_</span><span class="op" id="4557271">,</span>&nbsp;<span class="ident" id="4557273">s</span>&nbsp;<span class="op" id="4557275">:=</span>&nbsp;<span class="keyword" id="4557278">range</span>&nbsp;<span class="ident" id="4557284"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435091">cipherSuites</a></span>&nbsp;<span class="op" id="4557297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557303">if</span>&nbsp;<span class="ident" id="4557306"><a href="/gostd/crypto/tls/handshake_server.go.html#4557273">s</a></span><span class="op" id="4557307">.</span><span class="ident" id="4557308"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span>&nbsp;<span class="op" id="4557311">==</span>&nbsp;<span class="ident" id="4557314"><a href="/gostd/crypto/tls/handshake_server.go.html#4557058">id</a></span>&nbsp;<span class="op" id="4557317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4557324"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span>&nbsp;<span class="op" id="4557334">=</span>&nbsp;<span class="ident" id="4557336"><a href="/gostd/crypto/tls/handshake_server.go.html#4557273">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557343">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557353">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557363">if</span>&nbsp;<span class="ident" id="4557366"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span>&nbsp;<span class="op" id="4557376">==</span>&nbsp;<span class="builtintype" id="4557379">nil</span>&nbsp;<span class="op" id="4557383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557389">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4557406">//&nbsp;Don&#39;t&nbsp;select&nbsp;a&nbsp;ciphersuite&nbsp;which&nbsp;we&nbsp;can&#39;t</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4557454">//&nbsp;support&nbsp;for&nbsp;this&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557485">if</span>&nbsp;<span class="op" id="4557488">(</span><span class="ident" id="4557489"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span><span class="op" id="4557498">.</span><span class="ident" id="4557499"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434914">flags</a></span><span class="op" id="4557504">&amp;</span><span class="ident" id="4557505"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434152">suiteECDHE</a></span>&nbsp;<span class="op" id="4557516">!=</span>&nbsp;<span class="num" id="4557519">0</span><span class="op" id="4557520">)</span>&nbsp;<span class="op" id="4557522">&amp;&amp;</span>&nbsp;<span class="op" id="4557525">!</span><span class="ident" id="4557526"><a href="/gostd/crypto/tls/handshake_server.go.html#4557117">ellipticOk</a></span>&nbsp;<span class="op" id="4557537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557543">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557560">if</span>&nbsp;<span class="op" id="4557563">(</span><span class="ident" id="4557564"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span><span class="op" id="4557573">.</span><span class="ident" id="4557574"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434914">flags</a></span><span class="op" id="4557579">&amp;</span><span class="ident" id="4557580"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434393">suiteECDSA</a></span>&nbsp;<span class="op" id="4557591">!=</span>&nbsp;<span class="num" id="4557594">0</span><span class="op" id="4557595">)</span>&nbsp;<span class="op" id="4557597">!=</span>&nbsp;<span class="ident" id="4557600"><a href="/gostd/crypto/tls/handshake_server.go.html#4557129">ecdsaOk</a></span>&nbsp;<span class="op" id="4557608">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557631">if</span>&nbsp;<span class="ident" id="4557634"><a href="/gostd/crypto/tls/handshake_server.go.html#4557101">version</a></span>&nbsp;<span class="op" id="4557642">&lt;</span>&nbsp;<span class="ident" id="4557644"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4557657">&amp;&amp;</span>&nbsp;<span class="ident" id="4557660"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span><span class="op" id="4557669">.</span><span class="ident" id="4557670"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434914">flags</a></span><span class="op" id="4557675">&amp;</span><span class="ident" id="4557676"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434515">suiteTLS12</a></span>&nbsp;<span class="op" id="4557687">!=</span>&nbsp;<span class="num" id="4557690">0</span>&nbsp;<span class="op" id="4557692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557698">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557710">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557715">return</span>&nbsp;<span class="ident" id="4557722"><a href="/gostd/crypto/tls/handshake_server.go.html#4557239">candidate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4557737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4557741">return</span>&nbsp;<span class="builtintype" id="4557748">nil</span><br>
<span class="lineno">685</span><span class="op" id="4557752">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
