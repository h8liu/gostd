<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">elliptic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;This&nbsp;is&nbsp;a&nbsp;constant-time,&nbsp;32-bit&nbsp;implementation&nbsp;of&nbsp;P224.&nbsp;See&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;section&nbsp;D.2.2.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">10</span><span class="comment">//&nbsp;See&nbsp;http://www.imperialviolet.org/2010/12/04/ecc.html&nbsp;([1])&nbsp;for&nbsp;background.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">p224</span>&nbsp;<span class="ident">p224Curve</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">p224Curve</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">CurveParams</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gx</span><span class="op">,</span>&nbsp;<span class="ident">gy</span><span class="op">,</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">initP224</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;D.2.2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">CurveParams</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">CurveParams</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">P</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetString</span><span class="op">(</span><span class="string">&#34;26959946667150639794667015087019630673557916260026308143510066298881&#34;</span><span class="op">,</span>&nbsp;<span class="num">10</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">N</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetString</span><span class="op">(</span><span class="string">&#34;26959946667150639794667015087019625940457807714424391721682722368061&#34;</span><span class="op">,</span>&nbsp;<span class="num">10</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">B</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetString</span><span class="op">(</span><span class="string">&#34;b4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4&#34;</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">Gx</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetString</span><span class="op">(</span><span class="string">&#34;b70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21&#34;</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">Gy</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetString</span><span class="op">(</span><span class="string">&#34;bd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34&#34;</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224</span><span class="op">.</span><span class="ident">BitSize</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">224</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">p224</span><span class="op">.</span><span class="ident">gx</span><span class="op">,</span>&nbsp;<span class="ident">p224</span><span class="op">.</span><span class="ident">Gx</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">p224</span><span class="op">.</span><span class="ident">gy</span><span class="op">,</span>&nbsp;<span class="ident">p224</span><span class="op">.</span><span class="ident">Gy</span><span class="op">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">p224</span><span class="op">.</span><span class="ident">b</span><span class="op">,</span>&nbsp;<span class="ident">p224</span><span class="op">.</span><span class="ident">B</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;P224&nbsp;returns&nbsp;a&nbsp;Curve&nbsp;which&nbsp;implements&nbsp;P-224&nbsp;(see&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;D.2.2)</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">P224</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="ident">Curve</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">initonce</span><span class="op">.</span><span class="ident">Do</span><span class="op">(</span><span class="ident">initAll</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">curve</span>&nbsp;<span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">Params</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">CurveParams</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">curve</span><span class="op">.</span><span class="ident">CurveParams</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">curve</span>&nbsp;<span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">IsOnCurve</span><span class="op">(</span><span class="ident">bigX</span><span class="op">,</span>&nbsp;<span class="ident">bigY</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">bigX</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y</span><span class="op">,</span>&nbsp;<span class="ident">bigY</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;y²&nbsp;=&nbsp;x³&nbsp;-&nbsp;3x&nbsp;+&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="ident">p224LargeFieldElement</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">x3</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">x</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">*=</span>&nbsp;<span class="num">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">curve</span><span class="op">.</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Contract</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Contract</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">y</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">x3</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">Add</span><span class="op">(</span><span class="ident">bigX1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span><span class="op">,</span>&nbsp;<span class="ident">bigX2</span><span class="op">,</span>&nbsp;<span class="ident">bigY2</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">bigX1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">bigX1</span><span class="op">.</span><span class="ident">Sign</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">bigY1</span><span class="op">.</span><span class="ident">Sign</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">bigX2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">bigY2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">bigX2</span><span class="op">.</span><span class="ident">Sign</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">bigY2</span><span class="op">.</span><span class="ident">Sign</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z2</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224AddJacobian</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224ToAffine</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z3</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">Double</span><span class="op">(</span><span class="ident">bigX1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">bigX1</span><span class="op">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224DoubleJacobian</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224ToAffine</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno">105</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">ScalarMult</span><span class="op">(</span><span class="ident">bigX1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">,</span>&nbsp;<span class="ident">scalar</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">bigX1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224FromBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">bigY1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224ScalarMult</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">scalar</span><span class="op">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224ToAffine</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">curve</span>&nbsp;<span class="ident">p224Curve</span><span class="op">)</span>&nbsp;<span class="ident">ScalarBaseMult</span><span class="op">(</span><span class="ident">scalar</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224ScalarMult</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">curve</span><span class="op">.</span><span class="ident">gx</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">curve</span><span class="op">.</span><span class="ident">gy</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">scalar</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224ToAffine</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Field&nbsp;element&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;field&nbsp;that&nbsp;we&#39;re&nbsp;dealing&nbsp;with&nbsp;is&nbsp;ℤ/pℤ&nbsp;where&nbsp;p&nbsp;=&nbsp;2**224&nbsp;-&nbsp;2**96&nbsp;+&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno">130</span><span class="comment">//&nbsp;Field&nbsp;elements&nbsp;are&nbsp;represented&nbsp;by&nbsp;a&nbsp;FieldElement,&nbsp;which&nbsp;is&nbsp;a&nbsp;typedef&nbsp;to&nbsp;an</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;array&nbsp;of&nbsp;8&nbsp;uint32&#39;s.&nbsp;The&nbsp;value&nbsp;of&nbsp;a&nbsp;FieldElement,&nbsp;a,&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;&nbsp;&nbsp;a[0]&nbsp;+&nbsp;2**28·a[1]&nbsp;+&nbsp;2**56·a[1]&nbsp;+&nbsp;...&nbsp;+&nbsp;2**196·a[7]</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Using&nbsp;28-bit&nbsp;limbs&nbsp;means&nbsp;that&nbsp;there&#39;s&nbsp;only&nbsp;4&nbsp;bits&nbsp;of&nbsp;headroom,&nbsp;which&nbsp;is&nbsp;less</span><br>
<span class="lineno">135</span><span class="comment">//&nbsp;than&nbsp;we&nbsp;would&nbsp;really&nbsp;like.&nbsp;But&nbsp;it&nbsp;has&nbsp;the&nbsp;useful&nbsp;feature&nbsp;that&nbsp;we&nbsp;hit&nbsp;2**224</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;exactly,&nbsp;making&nbsp;the&nbsp;reflections&nbsp;during&nbsp;a&nbsp;reduce&nbsp;much&nbsp;nicer.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">p224FieldElement</span>&nbsp;<span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="builtintype">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224P&nbsp;is&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;field,&nbsp;represented&nbsp;as&nbsp;a&nbsp;p224FieldElement.</span><br>
<span class="lineno">140</span><span class="keyword">var</span>&nbsp;<span class="ident">p224P</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">{</span><span class="num">1</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">0xffff000</span><span class="op">,</span>&nbsp;<span class="num">0xfffffff</span><span class="op">,</span>&nbsp;<span class="num">0xfffffff</span><span class="op">,</span>&nbsp;<span class="num">0xfffffff</span><span class="op">,</span>&nbsp;<span class="num">0xfffffff</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224IsZero&nbsp;returns&nbsp;1&nbsp;if&nbsp;a&nbsp;==&nbsp;0&nbsp;mod&nbsp;p&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno">145</span><span class="keyword">func</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="ident">a</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Since&nbsp;a&nbsp;p224FieldElement&nbsp;contains&nbsp;224&nbsp;bits&nbsp;there&nbsp;are&nbsp;two&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;representations&nbsp;of&nbsp;0:&nbsp;0&nbsp;and&nbsp;p.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">minimal</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Contract</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">minimal</span><span class="op">,</span>&nbsp;<span class="ident">a</span><span class="op">)</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">isZero</span><span class="op">,</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">minimal</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">p224P</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;either&nbsp;isZero&nbsp;or&nbsp;isP&nbsp;is&nbsp;0,&nbsp;then&nbsp;we&nbsp;should&nbsp;return&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">isP</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">isP</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;For&nbsp;isZero&nbsp;and&nbsp;isP,&nbsp;the&nbsp;LSB&nbsp;is&nbsp;0&nbsp;iff&nbsp;all&nbsp;the&nbsp;bits&nbsp;are&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">result</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">isZero</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">isP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">result</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">(</span><span class="op">^</span><span class="ident">result</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">result</span><br>
<span class="lineno">175</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224Add&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a+b</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a[i]&nbsp;+&nbsp;b[i]&nbsp;&lt;&nbsp;2**32</span><br>
<span class="lineno">180</span><span class="keyword">func</span>&nbsp;<span class="ident">p224Add</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">a</span><span class="op">,</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">two31p3</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">31</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">3</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">two31m3</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">31</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">3</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">two31m15m3</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">31</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">15</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">3</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment">//&nbsp;p224ZeroModP31&nbsp;is&nbsp;0&nbsp;mod&nbsp;p&nbsp;where&nbsp;bit&nbsp;31&nbsp;is&nbsp;set&nbsp;in&nbsp;all&nbsp;limbs&nbsp;so&nbsp;that&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;subtract&nbsp;smaller&nbsp;amounts&nbsp;without&nbsp;underflow.&nbsp;See&nbsp;the&nbsp;section&nbsp;&#34;Subtraction&#34;&nbsp;in</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;[1]&nbsp;for&nbsp;reasoning.</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">p224ZeroModP31</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">{</span><span class="ident">two31p3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m15m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">,</span>&nbsp;<span class="ident">two31m3</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment">//&nbsp;p224Sub&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a-b</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a[i],&nbsp;b[i]&nbsp;&lt;&nbsp;2**30</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;out[i]&nbsp;&lt;&nbsp;2**32</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">a</span><span class="op">,</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">p224ZeroModP31</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment">//&nbsp;LargeFieldElement&nbsp;also&nbsp;represents&nbsp;an&nbsp;element&nbsp;of&nbsp;the&nbsp;field.&nbsp;The&nbsp;limbs&nbsp;are</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;still&nbsp;spaced&nbsp;28-bits&nbsp;apart&nbsp;and&nbsp;in&nbsp;little-endian&nbsp;order.&nbsp;So&nbsp;the&nbsp;limbs&nbsp;are&nbsp;at</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;0,&nbsp;28,&nbsp;56,&nbsp;...,&nbsp;392&nbsp;bits,&nbsp;each&nbsp;64-bits&nbsp;wide.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">p224LargeFieldElement</span>&nbsp;<span class="op">[</span><span class="num">15</span><span class="op">]</span><span class="ident">uint64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword">const</span>&nbsp;<span class="ident">two63p35</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">63</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">35</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">two63m35</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">35</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">two63m35m19</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">63</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">35</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">19</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224ZeroModP63&nbsp;is&nbsp;0&nbsp;mod&nbsp;p&nbsp;where&nbsp;bit&nbsp;63&nbsp;is&nbsp;set&nbsp;in&nbsp;all&nbsp;limbs.&nbsp;See&nbsp;the&nbsp;section</span><br>
<span class="lineno">215</span><span class="comment">//&nbsp;&#34;Subtraction&#34;&nbsp;in&nbsp;[1]&nbsp;for&nbsp;why.</span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">p224ZeroModP63</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="ident">uint64</span><span class="op">{</span><span class="ident">two63p35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35m19</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">,</span>&nbsp;<span class="ident">two63m35</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">bottom12Bits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xfff</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">bottom28Bits</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xfffffff</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224Mul&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a*b</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a[i]&nbsp;&lt;&nbsp;2**29,&nbsp;b[i]&nbsp;&lt;&nbsp;2**30&nbsp;(or&nbsp;vice&nbsp;versa)</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;out[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno">225</span><span class="keyword">func</span>&nbsp;<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">a</span><span class="op">,</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="op">*</span><span class="ident">p224LargeFieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">15</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">b</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224ReduceLarge</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Square&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a*a</span><br>
<span class="lineno">240</span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;out[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224Square</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">a</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="op">*</span><span class="ident">p224LargeFieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">15</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">i</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">a</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">tmp</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">r</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224ReduceLarge</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno">260</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ReduceLarge&nbsp;converts&nbsp;a&nbsp;p224LargeFieldElement&nbsp;to&nbsp;a&nbsp;p224FieldElement.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;in[i]&nbsp;&lt;&nbsp;2**62</span><br>
<span class="lineno">265</span><span class="keyword">func</span>&nbsp;<span class="ident">p224ReduceLarge</span><span class="op">(</span><span class="ident">out</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">p224LargeFieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">p224ZeroModP63</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Eliminate&nbsp;the&nbsp;coefficients&nbsp;at&nbsp;2**224&nbsp;and&nbsp;greater.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">14</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">--</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">-</span><span class="num">8</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">-</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0xffff</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">-</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="num">8</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;in[0..8]&nbsp;&lt;&nbsp;2**64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;As&nbsp;the&nbsp;values&nbsp;become&nbsp;small&nbsp;enough,&nbsp;we&nbsp;start&nbsp;to&nbsp;store&nbsp;them&nbsp;in&nbsp;|out|</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;use&nbsp;32-bit&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">1</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">bottom28Bits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="num">8</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">8</span><span class="op">]</span><span class="op">&amp;</span><span class="num">0xffff</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">8</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;in[0]&nbsp;&lt;&nbsp;2**64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[3]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[4]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[1,2,5..7]&nbsp;&lt;&nbsp;2**28</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">bottom28Bits</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">bottom28Bits</span><span class="op">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">56</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[0]&nbsp;&lt;&nbsp;2**28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[1..4]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[5..7]&nbsp;&lt;&nbsp;2**28</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Reduce&nbsp;reduces&nbsp;the&nbsp;coefficients&nbsp;of&nbsp;a&nbsp;to&nbsp;smaller&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;On&nbsp;entry:&nbsp;a[i]&nbsp;&lt;&nbsp;2**31&nbsp;+&nbsp;2**30</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;On&nbsp;exit:&nbsp;a[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno">305</span><span class="keyword">func</span>&nbsp;<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">a</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">7</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">a</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;top&nbsp;&lt;&nbsp;2**4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">top</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mask</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">mask</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">31</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">mask</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Mask&nbsp;is&nbsp;all&nbsp;ones&nbsp;if&nbsp;top&nbsp;!=&nbsp;0,&nbsp;all&nbsp;zero&nbsp;otherwise</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">top</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">12</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;may&nbsp;have&nbsp;just&nbsp;made&nbsp;a[0]&nbsp;negative&nbsp;but,&nbsp;if&nbsp;we&nbsp;did,&nbsp;then&nbsp;we&nbsp;must</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;have&nbsp;added&nbsp;something&nbsp;to&nbsp;a[3],&nbsp;this&nbsp;it&#39;s&nbsp;&gt;&nbsp;2**12.&nbsp;Therefore&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;carry&nbsp;down&nbsp;to&nbsp;a[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">mask</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">28</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">mask</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span><span class="op">&lt;&lt;</span><span class="num">28</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">a</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">mask</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">28</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224Invert&nbsp;calculates&nbsp;*out&nbsp;=&nbsp;in**-1&nbsp;by&nbsp;computing&nbsp;in**(2**224&nbsp;-&nbsp;2**96&nbsp;-&nbsp;1),</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;i.e.&nbsp;Fermat&#39;s&nbsp;little&nbsp;theorem.</span><br>
<span class="lineno">335</span><span class="keyword">func</span>&nbsp;<span class="ident">p224Invert</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="ident">f4</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">c</span>&nbsp;<span class="ident">p224LargeFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="ident">in</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="ident">in</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**2&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**3&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="ident">in</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**3&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**4&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**5&nbsp;-&nbsp;4</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**6&nbsp;-&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**6&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**7&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">5</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**12&nbsp;-&nbsp;2**6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**12&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**13&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">11</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**24&nbsp;-&nbsp;2**12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**24&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**25&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">23</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**48&nbsp;-&nbsp;2**24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**48&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**49&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">47</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**96&nbsp;-&nbsp;2**48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**96&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**97&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">23</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**120&nbsp;-&nbsp;2**24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f4</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**120&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">6</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**126&nbsp;-&nbsp;2**6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**126&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;2**127&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="ident">in</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**127&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">97</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span>&nbsp;&nbsp;<span class="comment">//&nbsp;2**224&nbsp;-&nbsp;2**97</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">f3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span>&nbsp;<span class="comment">//&nbsp;2**224&nbsp;-&nbsp;2**96&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224Contract&nbsp;converts&nbsp;a&nbsp;FieldElement&nbsp;to&nbsp;its&nbsp;unique,&nbsp;minimal&nbsp;form.</span><br>
<span class="lineno">385</span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;On&nbsp;entry,&nbsp;in[i]&nbsp;&lt;&nbsp;2**29</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;On&nbsp;exit,&nbsp;in[i]&nbsp;&lt;&nbsp;2**28</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224Contract</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">out</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">7</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">top</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">12</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;may&nbsp;just&nbsp;have&nbsp;made&nbsp;out[i]&nbsp;negative.&nbsp;So&nbsp;we&nbsp;carry&nbsp;down.&nbsp;If&nbsp;we&nbsp;made</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;out[0]&nbsp;negative&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;out[3]&nbsp;is&nbsp;sufficiently&nbsp;positive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;because&nbsp;we&nbsp;just&nbsp;added&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">3</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">28</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;might&nbsp;have&nbsp;pushed&nbsp;out[3]&nbsp;over&nbsp;2**28&nbsp;so&nbsp;we&nbsp;perform&nbsp;another,&nbsp;partial,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;carry&nbsp;chain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">3</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">7</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Eliminate&nbsp;top&nbsp;while&nbsp;maintaining&nbsp;the&nbsp;same&nbsp;value&nbsp;mod&nbsp;p.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">top</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">12</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider&nbsp;for&nbsp;out[3]:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;1)&nbsp;The&nbsp;first&nbsp;time&nbsp;that&nbsp;we&nbsp;eliminated&nbsp;top,&nbsp;we&nbsp;didn&#39;t&nbsp;push&nbsp;out[3]&nbsp;over</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2**28.&nbsp;In&nbsp;this&nbsp;case,&nbsp;the&nbsp;partial&nbsp;carry&nbsp;chain&nbsp;didn&#39;t&nbsp;change&nbsp;any&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;top&nbsp;is&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;2)&nbsp;We&nbsp;did&nbsp;push&nbsp;out[3]&nbsp;over&nbsp;2**28&nbsp;the&nbsp;first&nbsp;time&nbsp;that&nbsp;we&nbsp;eliminated&nbsp;top.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;first&nbsp;value&nbsp;of&nbsp;top&nbsp;was&nbsp;in&nbsp;[0..16),&nbsp;therefore,&nbsp;prior&nbsp;to&nbsp;eliminating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;first&nbsp;top,&nbsp;0xfff1000&nbsp;&lt;=&nbsp;out[3]&nbsp;&lt;=&nbsp;0xfffffff.&nbsp;Therefore,&nbsp;after</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overflowing&nbsp;and&nbsp;being&nbsp;reduced&nbsp;by&nbsp;the&nbsp;second&nbsp;carry&nbsp;chain,&nbsp;out[3]&nbsp;&lt;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xf000.&nbsp;Thus&nbsp;it&nbsp;cannot&nbsp;have&nbsp;overflowed&nbsp;when&nbsp;we&nbsp;eliminated&nbsp;top&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;time.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Again,&nbsp;we&nbsp;may&nbsp;just&nbsp;have&nbsp;made&nbsp;out[0]&nbsp;negative,&nbsp;so&nbsp;do&nbsp;the&nbsp;same&nbsp;carry&nbsp;down.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;As&nbsp;before,&nbsp;if&nbsp;we&nbsp;made&nbsp;out[0]&nbsp;negative&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;out[3]&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;sufficiently&nbsp;positive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">3</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="op">(</span><span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">28</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Now&nbsp;we&nbsp;see&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;&gt;=&nbsp;p&nbsp;and,&nbsp;if&nbsp;so,&nbsp;subtract&nbsp;p.</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;First&nbsp;we&nbsp;build&nbsp;a&nbsp;mask&nbsp;from&nbsp;the&nbsp;top&nbsp;four&nbsp;limbs,&nbsp;which&nbsp;must&nbsp;all&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;equal&nbsp;to&nbsp;bottom28Bits&nbsp;if&nbsp;the&nbsp;whole&nbsp;value&nbsp;is&nbsp;&gt;=&nbsp;p.&nbsp;If&nbsp;top4AllOnes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;ends&nbsp;up&nbsp;with&nbsp;any&nbsp;zero&nbsp;bits&nbsp;in&nbsp;the&nbsp;bottom&nbsp;28&nbsp;bits,&nbsp;then&nbsp;this&nbsp;wasn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;true.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="num">0xffffffff</span><span class="op">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">4</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="num">0xf0000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Now&nbsp;we&nbsp;replicate&nbsp;any&nbsp;zero&nbsp;bits&nbsp;to&nbsp;all&nbsp;the&nbsp;bits&nbsp;in&nbsp;top4AllOnes.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">top4AllOnes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">top4AllOnes</span><span class="op">&lt;&lt;</span><span class="num">31</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Now&nbsp;we&nbsp;test&nbsp;whether&nbsp;the&nbsp;bottom&nbsp;three&nbsp;limbs&nbsp;are&nbsp;non-zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bottom3NonZero</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">bottom3NonZero</span><span class="op">&lt;&lt;</span><span class="num">31</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Everything&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;out[3].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;it&#39;s&nbsp;&gt;&nbsp;0xffff000&nbsp;and&nbsp;top4AllOnes&nbsp;!=&nbsp;0&nbsp;then&nbsp;the&nbsp;whole&nbsp;value&nbsp;is&nbsp;&gt;=&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;it&#39;s&nbsp;=&nbsp;0xffff000&nbsp;and&nbsp;top4AllOnes&nbsp;!=&nbsp;0&nbsp;and&nbsp;bottom3NonZero&nbsp;!=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;the&nbsp;whole&nbsp;value&nbsp;is&nbsp;&gt;=&nbsp;p</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;it&#39;s&nbsp;&lt;&nbsp;0xffff000,&nbsp;then&nbsp;the&nbsp;whole&nbsp;value&nbsp;is&nbsp;&lt;&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">0xffff000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">out3Equal</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">out3Equal</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">out3Equal</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">out3Equal</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="ident">out3Equal</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3Equal</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">^</span><span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">out3Equal</span><span class="op">&lt;&lt;</span><span class="num">31</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;out[3]&nbsp;&gt;&nbsp;0xffff000&nbsp;then&nbsp;n&#39;s&nbsp;MSB&nbsp;will&nbsp;be&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out3GT</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">^</span><span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">n</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mask</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">top4AllOnes</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="op">(</span><span class="op">(</span><span class="ident">out3Equal</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">bottom3NonZero</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">out3GT</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">0xffff000</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">0xfffffff</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">0xfffffff</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">0xfffffff</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="num">0xfffffff</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">mask</span><br>
<span class="lineno">495</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Group&nbsp;element&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;These&nbsp;functions&nbsp;deal&nbsp;with&nbsp;group&nbsp;elements.&nbsp;The&nbsp;group&nbsp;is&nbsp;an&nbsp;elliptic&nbsp;curve</span><br>
<span class="lineno">500</span><span class="comment">//&nbsp;group&nbsp;with&nbsp;a&nbsp;=&nbsp;-3&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;D.2.2.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224AddJacobian&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a+b&nbsp;where&nbsp;a&nbsp;!=&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224AddJacobian</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;See&nbsp;http://hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#addition-p224Add-2007-bl</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="ident">u1</span><span class="op">,</span>&nbsp;<span class="ident">u2</span><span class="op">,</span>&nbsp;<span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="ident">h</span><span class="op">,</span>&nbsp;<span class="ident">i</span><span class="op">,</span>&nbsp;<span class="ident">j</span><span class="op">,</span>&nbsp;<span class="ident">r</span><span class="op">,</span>&nbsp;<span class="ident">v</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">c</span>&nbsp;<span class="ident">p224LargeFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1IsZero</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="ident">z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z2IsZero</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Z1Z1&nbsp;=&nbsp;Z1²</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Z2Z2&nbsp;=&nbsp;Z2²</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;U1&nbsp;=&nbsp;X1*Z2Z2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">u1</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;U2&nbsp;=&nbsp;X2*Z1Z1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">u2</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;S1&nbsp;=&nbsp;Y1*Z2*Z2Z2</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;S2&nbsp;=&nbsp;Y2*Z1*Z1Z1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;H&nbsp;=&nbsp;U2-U1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">h</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">u2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">u1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">h</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">xEqual</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">h</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;I&nbsp;=&nbsp;(2*H)²</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">j</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">j</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">i</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">h</span><span class="op">[</span><span class="ident">j</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">i</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">i</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">i</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;J&nbsp;=&nbsp;H*I</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">j</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">h</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">i</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;r&nbsp;=&nbsp;2*(S2-S1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">yEqual</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">xEqual</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">yEqual</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">z1IsZero</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">z2IsZero</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224DoubleJacobian</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">r</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">r</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;V&nbsp;=&nbsp;U1*I</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">v</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">u1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">i</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Z3&nbsp;=&nbsp;((Z1+Z2)²-Z1Z1-Z2Z2)*H</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">z2</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z2z2</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">z3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">h</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;X3&nbsp;=&nbsp;r²-J-2*V</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">z1z1</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">v</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">j</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Y3&nbsp;=&nbsp;r*(V-X3)-2*S1*J</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s1</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">j</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">v</span><span class="op">,</span>&nbsp;<span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">r</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">z1z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">s1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">y3</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">x2</span><span class="op">,</span>&nbsp;<span class="ident">z1IsZero</span><span class="op">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">z2IsZero</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">y2</span><span class="op">,</span>&nbsp;<span class="ident">z1IsZero</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z2IsZero</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z2</span><span class="op">,</span>&nbsp;<span class="ident">z1IsZero</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="ident">z2IsZero</span><span class="op">)</span><br>
<span class="lineno">585</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224DoubleJacobian&nbsp;computes&nbsp;*out&nbsp;=&nbsp;a+a.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224DoubleJacobian</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">delta</span><span class="op">,</span>&nbsp;<span class="ident">gamma</span><span class="op">,</span>&nbsp;<span class="ident">beta</span><span class="op">,</span>&nbsp;<span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="ident">t</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">c</span>&nbsp;<span class="ident">p224LargeFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">delta</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">gamma</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">beta</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">gamma</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;alpha&nbsp;=&nbsp;3*(X1-delta)*(X1+delta)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">delta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">t</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">1</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">t</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="ident">x1</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">delta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">alpha</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">t</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Z3&nbsp;=&nbsp;(Y1+Z1)²-gamma-delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Add</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">y1</span><span class="op">,</span>&nbsp;<span class="ident">z1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">z3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">gamma</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">z3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="ident">z3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">delta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">z3</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;X3&nbsp;=&nbsp;alpha²-8*beta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">delta</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">beta</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="num">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">delta</span><span class="op">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="ident">x3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">delta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Y3&nbsp;=&nbsp;alpha*(4*beta-X3)-8*gamma²</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">beta</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">beta</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">beta</span><span class="op">,</span>&nbsp;<span class="ident">x3</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">beta</span><span class="op">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">gamma</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">gamma</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">gamma</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">gamma</span><span class="op">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">alpha</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">beta</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">c</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Sub</span><span class="op">(</span><span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="ident">y3</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">gamma</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Reduce</span><span class="op">(</span><span class="ident">y3</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span><span class="comment">//&nbsp;p224CopyConditional&nbsp;sets&nbsp;*out&nbsp;=&nbsp;*in&nbsp;iff&nbsp;the&nbsp;least-significant-bit&nbsp;of&nbsp;control</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;is&nbsp;true,&nbsp;and&nbsp;it&nbsp;runs&nbsp;in&nbsp;constant&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">control</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">control</span>&nbsp;<span class="op">&lt;&lt;=</span>&nbsp;<span class="num">31</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">control</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="builtintype">int32</span><span class="op">(</span><span class="ident">control</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">31</span><span class="op">)</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">^=</span>&nbsp;<span class="op">(</span><span class="ident">out</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">^</span>&nbsp;<span class="ident">in</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="ident">control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224ScalarMult</span><span class="op">(</span><span class="ident">outX</span><span class="op">,</span>&nbsp;<span class="ident">outY</span><span class="op">,</span>&nbsp;<span class="ident">outZ</span><span class="op">,</span>&nbsp;<span class="ident">inX</span><span class="op">,</span>&nbsp;<span class="ident">inY</span><span class="op">,</span>&nbsp;<span class="ident">inZ</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">scalar</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">xx</span><span class="op">,</span>&nbsp;<span class="ident">yy</span><span class="op">,</span>&nbsp;<span class="ident">zz</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">outX</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">outY</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">outZ</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="builtintype">byte</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">scalar</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">bitNum</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">bitNum</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">8</span><span class="op">;</span>&nbsp;<span class="ident">bitNum</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224DoubleJacobian</span><span class="op">(</span><span class="ident">outX</span><span class="op">,</span>&nbsp;<span class="ident">outY</span><span class="op">,</span>&nbsp;<span class="ident">outZ</span><span class="op">,</span>&nbsp;<span class="ident">outX</span><span class="op">,</span>&nbsp;<span class="ident">outY</span><span class="op">,</span>&nbsp;<span class="ident">outZ</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bit</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="op">(</span><span class="builtintype">byte</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="op">(</span><span class="num">7</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">bitNum</span><span class="op">)</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224AddJacobian</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">xx</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">yy</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zz</span><span class="op">,</span>&nbsp;<span class="ident">inX</span><span class="op">,</span>&nbsp;<span class="ident">inY</span><span class="op">,</span>&nbsp;<span class="ident">inZ</span><span class="op">,</span>&nbsp;<span class="ident">outX</span><span class="op">,</span>&nbsp;<span class="ident">outY</span><span class="op">,</span>&nbsp;<span class="ident">outZ</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">outX</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">xx</span><span class="op">,</span>&nbsp;<span class="ident">bit</span><span class="op">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">outY</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">yy</span><span class="op">,</span>&nbsp;<span class="ident">bit</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224CopyConditional</span><span class="op">(</span><span class="ident">outZ</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zz</span><span class="op">,</span>&nbsp;<span class="ident">bit</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224ToAffine&nbsp;converts&nbsp;from&nbsp;Jacobian&nbsp;to&nbsp;affine&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224ToAffine</span><span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">,</span>&nbsp;<span class="ident">z</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">zinv</span><span class="op">,</span>&nbsp;<span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="ident">outx</span><span class="op">,</span>&nbsp;<span class="ident">outy</span>&nbsp;<span class="ident">p224FieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">tmp</span>&nbsp;<span class="ident">p224LargeFieldElement</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">isPointAtInfinity</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p224IsZero</span><span class="op">(</span><span class="ident">z</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">isPointAtInfinity</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Invert</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">zinv</span><span class="op">,</span>&nbsp;<span class="ident">z</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Square</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zinv</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">x</span><span class="op">,</span>&nbsp;<span class="ident">x</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zinv</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Mul</span><span class="op">(</span><span class="ident">y</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">zinvsq</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">tmp</span><span class="op">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Contract</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">outx</span><span class="op">,</span>&nbsp;<span class="ident">x</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p224Contract</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">outy</span><span class="op">,</span>&nbsp;<span class="ident">y</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">p224ToBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">outx</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="ident">p224ToBig</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">outy</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;get28BitsFromEnd&nbsp;returns&nbsp;the&nbsp;least-significant&nbsp;28&nbsp;bits&nbsp;from&nbsp;buf&gt;&gt;shift,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;where&nbsp;buf&nbsp;is&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="builtintype">uint</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">ret</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">4</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">b</span>&nbsp;<span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">buf</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">l</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="ident">l</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;We&nbsp;don&#39;t&nbsp;remove&nbsp;the&nbsp;byte&nbsp;if&nbsp;we&#39;re&nbsp;about&nbsp;to&nbsp;return&nbsp;and&nbsp;we&#39;re&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;reading&nbsp;all&nbsp;of&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">3</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="ident">l</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ret</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="op">(</span><span class="num">8</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">i</span><span class="op">)</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ret</span>&nbsp;<span class="op">&amp;=</span>&nbsp;<span class="ident">bottom28Bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">ret</span><span class="op">,</span>&nbsp;<span class="ident">buf</span><br>
<span class="lineno">710</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;p224FromBig&nbsp;sets&nbsp;*out&nbsp;=&nbsp;*in.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224FromBig</span><span class="op">(</span><span class="ident">out</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">,</span>&nbsp;<span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">bytes</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">in</span><span class="op">.</span><span class="ident">Bytes</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">out</span><span class="op">[</span><span class="num">7</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">bytes</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">get28BitsFromEnd</span><span class="op">(</span><span class="ident">bytes</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span><span class="comment">//&nbsp;p224ToBig&nbsp;returns&nbsp;in&nbsp;as&nbsp;a&nbsp;big.Int.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">p224ToBig</span><span class="op">(</span><span class="ident">in</span>&nbsp;<span class="op">*</span><span class="ident">p224FieldElement</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">buf</span>&nbsp;<span class="op">[</span><span class="num">28</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">27</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">26</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">25</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">24</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">&lt;&lt;</span><span class="num">4</span><span class="op">)</span><span class="op">&amp;</span><span class="num">0xf0</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">23</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">22</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">21</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">20</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">20</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">19</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">18</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">17</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">&lt;&lt;</span><span class="num">4</span><span class="op">)</span><span class="op">&amp;</span><span class="num">0xf0</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">16</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">15</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">14</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">20</span><span class="op">)</span><br>
<span class="lineno">745</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">13</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">12</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">11</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">10</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">5</span><span class="op">]</span><span class="op">&lt;&lt;</span><span class="num">4</span><span class="op">)</span><span class="op">&amp;</span><span class="num">0xf0</span><span class="op">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">9</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">8</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">20</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">8</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">16</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">3</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">24</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x0f</span><span class="op">)</span>&nbsp;<span class="op">|</span>&nbsp;<span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">7</span><span class="op">]</span><span class="op">&lt;&lt;</span><span class="num">4</span><span class="op">)</span><span class="op">&amp;</span><span class="num">0xf0</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">2</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">4</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">1</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">buf</span><span class="op">[</span><span class="num">0</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">byte</span><span class="op">(</span><span class="ident">in</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">20</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtinfunc">new</span><span class="op">(</span><span class="ident">big</span><span class="op">.</span><span class="ident">Int</span><span class="op">)</span><span class="op">.</span><span class="ident">SetBytes</span><span class="op">(</span><span class="ident">buf</span><span class="op">[</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">765</span><span class="op">}</span>
</div>
</body>
</html>
