<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4533278">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4533333">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4533387">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4533438">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4533518">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4533547">package</span>&nbsp;<span class="ident" id="4533555">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4533561">import</span>&nbsp;<span class="op" id="4533568">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533571">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533580">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533598">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533608">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533616">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533630">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4533636">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4533643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4533646">const</span>&nbsp;<span class="op" id="4533652">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533655">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4533667">=</span>&nbsp;<span class="num" id="4533669">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533675">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4533687">=</span>&nbsp;<span class="num" id="4533689">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533695">gzipDeflate</span>&nbsp;<span class="op" id="4533707">=</span>&nbsp;<span class="num" id="4533709">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533712">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4533724">=</span>&nbsp;<span class="num" id="4533726">1</span>&nbsp;<span class="op" id="4533728">&lt;&lt;</span>&nbsp;<span class="num" id="4533731">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533734">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4533746">=</span>&nbsp;<span class="num" id="4533748">1</span>&nbsp;<span class="op" id="4533750">&lt;&lt;</span>&nbsp;<span class="num" id="4533753">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533756">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4533768">=</span>&nbsp;<span class="num" id="4533770">1</span>&nbsp;<span class="op" id="4533772">&lt;&lt;</span>&nbsp;<span class="num" id="4533775">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533778">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4533790">=</span>&nbsp;<span class="num" id="4533792">1</span>&nbsp;<span class="op" id="4533794">&lt;&lt;</span>&nbsp;<span class="num" id="4533797">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4533800">flagComment</span>&nbsp;<span class="op" id="4533812">=</span>&nbsp;<span class="num" id="4533814">1</span>&nbsp;<span class="op" id="4533816">&lt;&lt;</span>&nbsp;<span class="num" id="4533819">4</span><br>
<span class="lineno"></span><span class="op" id="4533821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4533824">func</span>&nbsp;<span class="ident" id="4533829">makeReader</span><span class="op" id="4533839">(</span><span class="ident" id="4533840">r</span>&nbsp;<span class="ident" id="4533842">io</span><span class="op" id="4533844">.</span><span class="ident" id="4533845">Reader</span><span class="op" id="4533851">)</span>&nbsp;<span class="ident" id="4533853">flate</span><span class="op" id="4533858">.</span><span class="ident" id="4533859">Reader</span>&nbsp;<span class="op" id="4533866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533869">if</span>&nbsp;<span class="ident" id="4533872">rr</span><span class="op" id="4533874">,</span>&nbsp;<span class="ident" id="4533876">ok</span>&nbsp;<span class="op" id="4533879">:=</span>&nbsp;<span class="ident" id="4533882">r</span><span class="op" id="4533883">.</span><span class="op" id="4533884">(</span><span class="ident" id="4533885">flate</span><span class="op" id="4533890">.</span><span class="ident" id="4533891">Reader</span><span class="op" id="4533897">)</span><span class="op" id="4533898">;</span>&nbsp;<span class="ident" id="4533900">ok</span>&nbsp;<span class="op" id="4533903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533907">return</span>&nbsp;<span class="ident" id="4533914">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4533918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4533921">return</span>&nbsp;<span class="ident" id="4533928">bufio</span><span class="op" id="4533933">.</span><span class="ident" id="4533934">NewReader</span><span class="op" id="4533943">(</span><span class="ident" id="4533944">r</span><span class="op" id="4533945">)</span><br>
<span class="lineno">35</span><span class="op" id="4533947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4533950">var</span>&nbsp;<span class="op" id="4533954">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4533957">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534038">ErrChecksum</span>&nbsp;<span class="op" id="4534050">=</span>&nbsp;<span class="ident" id="4534052">errors</span><span class="op" id="4534058">.</span><span class="ident" id="4534059">New</span><span class="op" id="4534062">(</span><span class="string" id="4534063">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4534087">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4534090">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534167">ErrHeader</span>&nbsp;<span class="op" id="4534177">=</span>&nbsp;<span class="ident" id="4534179">errors</span><span class="op" id="4534185">.</span><span class="ident" id="4534186">New</span><span class="op" id="4534189">(</span><span class="string" id="4534190">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4534212">)</span><br>
<span class="lineno"></span><span class="op" id="4534214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4534217">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4534293">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4534367">type</span>&nbsp;<span class="ident" id="4534372">Header</span>&nbsp;<span class="keyword" id="4534379">struct</span>&nbsp;<span class="op" id="4534386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534389">Comment</span>&nbsp;<span class="builtintype" id="4534397">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534407">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534419">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4534427">[</span><span class="op" id="4534428">]</span><span class="builtintype" id="4534429">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534437">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534454">ModTime</span>&nbsp;<span class="ident" id="4534462">time</span><span class="op" id="4534466">.</span><span class="ident" id="4534467">Time</span>&nbsp;<span class="comment" id="4534472">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534494">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4534502">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534512">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4534526">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4534534">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4534544">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4534569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4534572">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4534629">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4534686">//</span><br>
<span class="lineno"></span><span class="comment" id="4534689">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4534754">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4534806">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4534868">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4534927">//</span><br>
<span class="lineno"></span><span class="comment" id="4534930">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4534998">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4535048">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4535107">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4535175">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4535238">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4535270">type</span>&nbsp;<span class="ident" id="4535275">Reader</span>&nbsp;<span class="keyword" id="4535282">struct</span>&nbsp;<span class="op" id="4535289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535292">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535300">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535313">flate</span><span class="op" id="4535318">.</span><span class="ident" id="4535319">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535327">decompressor</span>&nbsp;<span class="ident" id="4535340">io</span><span class="op" id="4535342">.</span><span class="ident" id="4535343">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535355">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4535368">hash</span><span class="op" id="4535372">.</span><span class="ident" id="4535373">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535381">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4535394">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535402">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4535415">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535421">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4535434">[</span><span class="num" id="4535435">512</span><span class="op" id="4535438">]</span><span class="builtintype" id="4535439">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535445">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4535458">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535465">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4535478">bool</span><br>
<span class="lineno"></span><span class="op" id="4535483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4535486">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4535546">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4535593">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4535655">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4535731">func</span>&nbsp;<span class="ident" id="4535736">NewReader</span><span class="op" id="4535745">(</span><span class="ident" id="4535746">r</span>&nbsp;<span class="ident" id="4535748">io</span><span class="op" id="4535750">.</span><span class="ident" id="4535751">Reader</span><span class="op" id="4535757">)</span>&nbsp;<span class="op" id="4535759">(</span><span class="op" id="4535760">*</span><span class="ident" id="4535761">Reader</span><span class="op" id="4535767">,</span>&nbsp;<span class="builtintype" id="4535769">error</span><span class="op" id="4535774">)</span>&nbsp;<span class="op" id="4535776">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535779">z</span>&nbsp;<span class="op" id="4535781">:=</span>&nbsp;<span class="builtinfunc" id="4535784">new</span><span class="op" id="4535787">(</span><span class="ident" id="4535788">Reader</span><span class="op" id="4535794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535797">z</span><span class="op" id="4535798">.</span><span class="ident" id="4535799">r</span>&nbsp;<span class="op" id="4535801">=</span>&nbsp;<span class="ident" id="4535803">makeReader</span><span class="op" id="4535813">(</span><span class="ident" id="4535814">r</span><span class="op" id="4535815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535818">z</span><span class="op" id="4535819">.</span><span class="ident" id="4535820">multistream</span>&nbsp;<span class="op" id="4535832">=</span>&nbsp;<span class="builtintype" id="4535834">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4535840">z</span><span class="op" id="4535841">.</span><span class="ident" id="4535842">digest</span>&nbsp;<span class="op" id="4535849">=</span>&nbsp;<span class="ident" id="4535851">crc32</span><span class="op" id="4535856">.</span><span class="ident" id="4535857">NewIEEE</span><span class="op" id="4535864">(</span><span class="op" id="4535865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535868">if</span>&nbsp;<span class="ident" id="4535871">err</span>&nbsp;<span class="op" id="4535875">:=</span>&nbsp;<span class="ident" id="4535878">z</span><span class="op" id="4535879">.</span><span class="ident" id="4535880">readHeader</span><span class="op" id="4535890">(</span><span class="builtintype" id="4535891">true</span><span class="op" id="4535895">)</span><span class="op" id="4535896">;</span>&nbsp;<span class="ident" id="4535898">err</span>&nbsp;<span class="op" id="4535902">!=</span>&nbsp;<span class="ident" id="4535905">nil</span>&nbsp;<span class="op" id="4535909">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535913">return</span>&nbsp;<span class="ident" id="4535920">nil</span><span class="op" id="4535923">,</span>&nbsp;<span class="ident" id="4535925">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4535930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4535933">return</span>&nbsp;<span class="ident" id="4535940">z</span><span class="op" id="4535941">,</span>&nbsp;<span class="ident" id="4535943">nil</span><br>
<span class="lineno"></span><span class="op" id="4535947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4535950">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4536020">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4536096">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4536163">func</span>&nbsp;<span class="op" id="4536168">(</span><span class="ident" id="4536169">z</span>&nbsp;<span class="op" id="4536171">*</span><span class="ident" id="4536172">Reader</span><span class="op" id="4536178">)</span>&nbsp;<span class="ident" id="4536180">Reset</span><span class="op" id="4536185">(</span><span class="ident" id="4536186">r</span>&nbsp;<span class="ident" id="4536188">io</span><span class="op" id="4536190">.</span><span class="ident" id="4536191">Reader</span><span class="op" id="4536197">)</span>&nbsp;<span class="builtintype" id="4536199">error</span>&nbsp;<span class="op" id="4536205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536208">z</span><span class="op" id="4536209">.</span><span class="ident" id="4536210">r</span>&nbsp;<span class="op" id="4536212">=</span>&nbsp;<span class="ident" id="4536214">makeReader</span><span class="op" id="4536224">(</span><span class="ident" id="4536225">r</span><span class="op" id="4536226">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536229">if</span>&nbsp;<span class="ident" id="4536232">z</span><span class="op" id="4536233">.</span><span class="ident" id="4536234">digest</span>&nbsp;<span class="op" id="4536241">==</span>&nbsp;<span class="ident" id="4536244">nil</span>&nbsp;<span class="op" id="4536248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536252">z</span><span class="op" id="4536253">.</span><span class="ident" id="4536254">digest</span>&nbsp;<span class="op" id="4536261">=</span>&nbsp;<span class="ident" id="4536263">crc32</span><span class="op" id="4536268">.</span><span class="ident" id="4536269">NewIEEE</span><span class="op" id="4536276">(</span><span class="op" id="4536277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4536280">}</span>&nbsp;<span class="keyword" id="4536282">else</span>&nbsp;<span class="op" id="4536287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536291">z</span><span class="op" id="4536292">.</span><span class="ident" id="4536293">digest</span><span class="op" id="4536299">.</span><span class="ident" id="4536300">Reset</span><span class="op" id="4536305">(</span><span class="op" id="4536306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4536309">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536312">z</span><span class="op" id="4536313">.</span><span class="ident" id="4536314">size</span>&nbsp;<span class="op" id="4536319">=</span>&nbsp;<span class="num" id="4536321">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536324">z</span><span class="op" id="4536325">.</span><span class="ident" id="4536326">err</span>&nbsp;<span class="op" id="4536330">=</span>&nbsp;<span class="ident" id="4536332">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4536337">z</span><span class="op" id="4536338">.</span><span class="ident" id="4536339">multistream</span>&nbsp;<span class="op" id="4536351">=</span>&nbsp;<span class="builtintype" id="4536353">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4536359">return</span>&nbsp;<span class="ident" id="4536366">z</span><span class="op" id="4536367">.</span><span class="ident" id="4536368">readHeader</span><span class="op" id="4536378">(</span><span class="builtintype" id="4536379">true</span><span class="op" id="4536383">)</span><br>
<span class="lineno"></span><span class="op" id="4536385">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4536388">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4536459">//</span><br>
<span class="lineno"></span><span class="comment" id="4536462">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4536537">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4536607">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4536685">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4536763">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4536827">//</span><br>
<span class="lineno"></span><span class="comment" id="4536830">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4536907">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4536983">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4537049">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4537118">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4537193">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4537251">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4537330">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4537392">func</span>&nbsp;<span class="op" id="4537397">(</span><span class="ident" id="4537398">z</span>&nbsp;<span class="op" id="4537400">*</span><span class="ident" id="4537401">Reader</span><span class="op" id="4537407">)</span>&nbsp;<span class="ident" id="4537409">Multistream</span><span class="op" id="4537420">(</span><span class="ident" id="4537421">ok</span>&nbsp;<span class="builtintype" id="4537424">bool</span><span class="op" id="4537428">)</span>&nbsp;<span class="op" id="4537430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4537433">z</span><span class="op" id="4537434">.</span><span class="ident" id="4537435">multistream</span>&nbsp;<span class="op" id="4537447">=</span>&nbsp;<span class="ident" id="4537449">ok</span><br>
<span class="lineno"></span><span class="op" id="4537452">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4537455">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4537516">func</span>&nbsp;<span class="ident" id="4537521">get4</span><span class="op" id="4537525">(</span><span class="ident" id="4537526">p</span>&nbsp;<span class="op" id="4537528">[</span><span class="op" id="4537529">]</span><span class="builtintype" id="4537530">byte</span><span class="op" id="4537534">)</span>&nbsp;<span class="builtintype" id="4537536">uint32</span>&nbsp;<span class="op" id="4537543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537546">return</span>&nbsp;<span class="builtintype" id="4537553">uint32</span><span class="op" id="4537559">(</span><span class="ident" id="4537560">p</span><span class="op" id="4537561">[</span><span class="num" id="4537562">0</span><span class="op" id="4537563">]</span><span class="op" id="4537564">)</span>&nbsp;<span class="op" id="4537566">|</span>&nbsp;<span class="builtintype" id="4537568">uint32</span><span class="op" id="4537574">(</span><span class="ident" id="4537575">p</span><span class="op" id="4537576">[</span><span class="num" id="4537577">1</span><span class="op" id="4537578">]</span><span class="op" id="4537579">)</span><span class="op" id="4537580">&lt;&lt;</span><span class="num" id="4537582">8</span>&nbsp;<span class="op" id="4537584">|</span>&nbsp;<span class="builtintype" id="4537586">uint32</span><span class="op" id="4537592">(</span><span class="ident" id="4537593">p</span><span class="op" id="4537594">[</span><span class="num" id="4537595">2</span><span class="op" id="4537596">]</span><span class="op" id="4537597">)</span><span class="op" id="4537598">&lt;&lt;</span><span class="num" id="4537600">16</span>&nbsp;<span class="op" id="4537603">|</span>&nbsp;<span class="builtintype" id="4537605">uint32</span><span class="op" id="4537611">(</span><span class="ident" id="4537612">p</span><span class="op" id="4537613">[</span><span class="num" id="4537614">3</span><span class="op" id="4537615">]</span><span class="op" id="4537616">)</span><span class="op" id="4537617">&lt;&lt;</span><span class="num" id="4537619">24</span><br>
<span class="lineno"></span><span class="op" id="4537622">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4537625">func</span>&nbsp;<span class="op" id="4537630">(</span><span class="ident" id="4537631">z</span>&nbsp;<span class="op" id="4537633">*</span><span class="ident" id="4537634">Reader</span><span class="op" id="4537640">)</span>&nbsp;<span class="ident" id="4537642">readString</span><span class="op" id="4537652">(</span><span class="op" id="4537653">)</span>&nbsp;<span class="op" id="4537655">(</span><span class="builtintype" id="4537656">string</span><span class="op" id="4537662">,</span>&nbsp;<span class="builtintype" id="4537664">error</span><span class="op" id="4537669">)</span>&nbsp;<span class="op" id="4537671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537674">var</span>&nbsp;<span class="ident" id="4537678">err</span>&nbsp;<span class="builtintype" id="4537682">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4537689">needconv</span>&nbsp;<span class="op" id="4537698">:=</span>&nbsp;<span class="builtintype" id="4537701">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537708">for</span>&nbsp;<span class="ident" id="4537712">i</span>&nbsp;<span class="op" id="4537714">:=</span>&nbsp;<span class="num" id="4537717">0</span><span class="op" id="4537718">;</span>&nbsp;<span class="op" id="4537720">;</span>&nbsp;<span class="ident" id="4537722">i</span><span class="op" id="4537723">++</span>&nbsp;<span class="op" id="4537726">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537730">if</span>&nbsp;<span class="ident" id="4537733">i</span>&nbsp;<span class="op" id="4537735">&gt;=</span>&nbsp;<span class="builtinfunc" id="4537738">len</span><span class="op" id="4537741">(</span><span class="ident" id="4537742">z</span><span class="op" id="4537743">.</span><span class="ident" id="4537744">buf</span><span class="op" id="4537747">)</span>&nbsp;<span class="op" id="4537749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537754">return</span>&nbsp;<span class="string" id="4537761">&#34;&#34;</span><span class="op" id="4537763">,</span>&nbsp;<span class="ident" id="4537765">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4537777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4537781">z</span><span class="op" id="4537782">.</span><span class="ident" id="4537783">buf</span><span class="op" id="4537786">[</span><span class="ident" id="4537787">i</span><span class="op" id="4537788">]</span><span class="op" id="4537789">,</span>&nbsp;<span class="ident" id="4537791">err</span>&nbsp;<span class="op" id="4537795">=</span>&nbsp;<span class="ident" id="4537797">z</span><span class="op" id="4537798">.</span><span class="ident" id="4537799">r</span><span class="op" id="4537800">.</span><span class="ident" id="4537801">ReadByte</span><span class="op" id="4537809">(</span><span class="op" id="4537810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537814">if</span>&nbsp;<span class="ident" id="4537817">err</span>&nbsp;<span class="op" id="4537821">!=</span>&nbsp;<span class="ident" id="4537824">nil</span>&nbsp;<span class="op" id="4537828">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537833">return</span>&nbsp;<span class="string" id="4537840">&#34;&#34;</span><span class="op" id="4537842">,</span>&nbsp;<span class="ident" id="4537844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4537850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537854">if</span>&nbsp;<span class="ident" id="4537857">z</span><span class="op" id="4537858">.</span><span class="ident" id="4537859">buf</span><span class="op" id="4537862">[</span><span class="ident" id="4537863">i</span><span class="op" id="4537864">]</span>&nbsp;<span class="op" id="4537866">&gt;</span>&nbsp;<span class="num" id="4537868">0x7f</span>&nbsp;<span class="op" id="4537873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4537878">needconv</span>&nbsp;<span class="op" id="4537887">=</span>&nbsp;<span class="builtintype" id="4537889">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4537896">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4537900">if</span>&nbsp;<span class="ident" id="4537903">z</span><span class="op" id="4537904">.</span><span class="ident" id="4537905">buf</span><span class="op" id="4537908">[</span><span class="ident" id="4537909">i</span><span class="op" id="4537910">]</span>&nbsp;<span class="op" id="4537912">==</span>&nbsp;<span class="num" id="4537915">0</span>&nbsp;<span class="op" id="4537917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4537922">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538008">if</span>&nbsp;<span class="ident" id="4538011">needconv</span>&nbsp;<span class="op" id="4538020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538026">s</span>&nbsp;<span class="op" id="4538028">:=</span>&nbsp;<span class="builtinfunc" id="4538031">make</span><span class="op" id="4538035">(</span><span class="op" id="4538036">[</span><span class="op" id="4538037">]</span><span class="builtintype" id="4538038">rune</span><span class="op" id="4538042">,</span>&nbsp;<span class="num" id="4538044">0</span><span class="op" id="4538045">,</span>&nbsp;<span class="ident" id="4538047">i</span><span class="op" id="4538048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538054">for</span>&nbsp;<span class="ident" id="4538058">_</span><span class="op" id="4538059">,</span>&nbsp;<span class="ident" id="4538061">v</span>&nbsp;<span class="op" id="4538063">:=</span>&nbsp;<span class="keyword" id="4538066">range</span>&nbsp;<span class="ident" id="4538072">z</span><span class="op" id="4538073">.</span><span class="ident" id="4538074">buf</span><span class="op" id="4538077">[</span><span class="num" id="4538078">0</span><span class="op" id="4538079">:</span><span class="ident" id="4538080">i</span><span class="op" id="4538081">]</span>&nbsp;<span class="op" id="4538083">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538090">s</span>&nbsp;<span class="op" id="4538092">=</span>&nbsp;<span class="builtinfunc" id="4538094">append</span><span class="op" id="4538100">(</span><span class="ident" id="4538101">s</span><span class="op" id="4538102">,</span>&nbsp;<span class="builtintype" id="4538104">rune</span><span class="op" id="4538108">(</span><span class="ident" id="4538109">v</span><span class="op" id="4538110">)</span><span class="op" id="4538111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538123">return</span>&nbsp;<span class="builtintype" id="4538130">string</span><span class="op" id="4538136">(</span><span class="ident" id="4538137">s</span><span class="op" id="4538138">)</span><span class="op" id="4538139">,</span>&nbsp;<span class="ident" id="4538141">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538153">return</span>&nbsp;<span class="builtintype" id="4538160">string</span><span class="op" id="4538166">(</span><span class="ident" id="4538167">z</span><span class="op" id="4538168">.</span><span class="ident" id="4538169">buf</span><span class="op" id="4538172">[</span><span class="num" id="4538173">0</span><span class="op" id="4538174">:</span><span class="ident" id="4538175">i</span><span class="op" id="4538176">]</span><span class="op" id="4538177">)</span><span class="op" id="4538178">,</span>&nbsp;<span class="ident" id="4538180">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538189">}</span><br>
<span class="lineno"></span><span class="op" id="4538191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4538194">func</span>&nbsp;<span class="op" id="4538199">(</span><span class="ident" id="4538200">z</span>&nbsp;<span class="op" id="4538202">*</span><span class="ident" id="4538203">Reader</span><span class="op" id="4538209">)</span>&nbsp;<span class="ident" id="4538211">read2</span><span class="op" id="4538216">(</span><span class="op" id="4538217">)</span>&nbsp;<span class="op" id="4538219">(</span><span class="builtintype" id="4538220">uint32</span><span class="op" id="4538226">,</span>&nbsp;<span class="builtintype" id="4538228">error</span><span class="op" id="4538233">)</span>&nbsp;<span class="op" id="4538235">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538238">_</span><span class="op" id="4538239">,</span>&nbsp;<span class="ident" id="4538241">err</span>&nbsp;<span class="op" id="4538245">:=</span>&nbsp;<span class="ident" id="4538248">io</span><span class="op" id="4538250">.</span><span class="ident" id="4538251">ReadFull</span><span class="op" id="4538259">(</span><span class="ident" id="4538260">z</span><span class="op" id="4538261">.</span><span class="ident" id="4538262">r</span><span class="op" id="4538263">,</span>&nbsp;<span class="ident" id="4538265">z</span><span class="op" id="4538266">.</span><span class="ident" id="4538267">buf</span><span class="op" id="4538270">[</span><span class="num" id="4538271">0</span><span class="op" id="4538272">:</span><span class="num" id="4538273">2</span><span class="op" id="4538274">]</span><span class="op" id="4538275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538278">if</span>&nbsp;<span class="ident" id="4538281">err</span>&nbsp;<span class="op" id="4538285">!=</span>&nbsp;<span class="ident" id="4538288">nil</span>&nbsp;<span class="op" id="4538292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538296">return</span>&nbsp;<span class="num" id="4538303">0</span><span class="op" id="4538304">,</span>&nbsp;<span class="ident" id="4538306">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538314">return</span>&nbsp;<span class="builtintype" id="4538321">uint32</span><span class="op" id="4538327">(</span><span class="ident" id="4538328">z</span><span class="op" id="4538329">.</span><span class="ident" id="4538330">buf</span><span class="op" id="4538333">[</span><span class="num" id="4538334">0</span><span class="op" id="4538335">]</span><span class="op" id="4538336">)</span>&nbsp;<span class="op" id="4538338">|</span>&nbsp;<span class="builtintype" id="4538340">uint32</span><span class="op" id="4538346">(</span><span class="ident" id="4538347">z</span><span class="op" id="4538348">.</span><span class="ident" id="4538349">buf</span><span class="op" id="4538352">[</span><span class="num" id="4538353">1</span><span class="op" id="4538354">]</span><span class="op" id="4538355">)</span><span class="op" id="4538356">&lt;&lt;</span><span class="num" id="4538358">8</span><span class="op" id="4538359">,</span>&nbsp;<span class="ident" id="4538361">nil</span><br>
<span class="lineno">170</span><span class="op" id="4538365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4538368">func</span>&nbsp;<span class="op" id="4538373">(</span><span class="ident" id="4538374">z</span>&nbsp;<span class="op" id="4538376">*</span><span class="ident" id="4538377">Reader</span><span class="op" id="4538383">)</span>&nbsp;<span class="ident" id="4538385">readHeader</span><span class="op" id="4538395">(</span><span class="ident" id="4538396">save</span>&nbsp;<span class="builtintype" id="4538401">bool</span><span class="op" id="4538405">)</span>&nbsp;<span class="builtintype" id="4538407">error</span>&nbsp;<span class="op" id="4538413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538416">_</span><span class="op" id="4538417">,</span>&nbsp;<span class="ident" id="4538419">err</span>&nbsp;<span class="op" id="4538423">:=</span>&nbsp;<span class="ident" id="4538426">io</span><span class="op" id="4538428">.</span><span class="ident" id="4538429">ReadFull</span><span class="op" id="4538437">(</span><span class="ident" id="4538438">z</span><span class="op" id="4538439">.</span><span class="ident" id="4538440">r</span><span class="op" id="4538441">,</span>&nbsp;<span class="ident" id="4538443">z</span><span class="op" id="4538444">.</span><span class="ident" id="4538445">buf</span><span class="op" id="4538448">[</span><span class="num" id="4538449">0</span><span class="op" id="4538450">:</span><span class="num" id="4538451">10</span><span class="op" id="4538453">]</span><span class="op" id="4538454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538457">if</span>&nbsp;<span class="ident" id="4538460">err</span>&nbsp;<span class="op" id="4538464">!=</span>&nbsp;<span class="ident" id="4538467">nil</span>&nbsp;<span class="op" id="4538471">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538475">return</span>&nbsp;<span class="ident" id="4538482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538490">if</span>&nbsp;<span class="ident" id="4538493">z</span><span class="op" id="4538494">.</span><span class="ident" id="4538495">buf</span><span class="op" id="4538498">[</span><span class="num" id="4538499">0</span><span class="op" id="4538500">]</span>&nbsp;<span class="op" id="4538502">!=</span>&nbsp;<span class="ident" id="4538505">gzipID1</span>&nbsp;<span class="op" id="4538513">||</span>&nbsp;<span class="ident" id="4538516">z</span><span class="op" id="4538517">.</span><span class="ident" id="4538518">buf</span><span class="op" id="4538521">[</span><span class="num" id="4538522">1</span><span class="op" id="4538523">]</span>&nbsp;<span class="op" id="4538525">!=</span>&nbsp;<span class="ident" id="4538528">gzipID2</span>&nbsp;<span class="op" id="4538536">||</span>&nbsp;<span class="ident" id="4538539">z</span><span class="op" id="4538540">.</span><span class="ident" id="4538541">buf</span><span class="op" id="4538544">[</span><span class="num" id="4538545">2</span><span class="op" id="4538546">]</span>&nbsp;<span class="op" id="4538548">!=</span>&nbsp;<span class="ident" id="4538551">gzipDeflate</span>&nbsp;<span class="op" id="4538563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538567">return</span>&nbsp;<span class="ident" id="4538574">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538585">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538588">z</span><span class="op" id="4538589">.</span><span class="ident" id="4538590">flg</span>&nbsp;<span class="op" id="4538594">=</span>&nbsp;<span class="ident" id="4538596">z</span><span class="op" id="4538597">.</span><span class="ident" id="4538598">buf</span><span class="op" id="4538601">[</span><span class="num" id="4538602">3</span><span class="op" id="4538603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538606">if</span>&nbsp;<span class="ident" id="4538609">save</span>&nbsp;<span class="op" id="4538614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538618">z</span><span class="op" id="4538619">.</span><span class="ident" id="4538620">ModTime</span>&nbsp;<span class="op" id="4538628">=</span>&nbsp;<span class="ident" id="4538630">time</span><span class="op" id="4538634">.</span><span class="ident" id="4538635">Unix</span><span class="op" id="4538639">(</span><span class="ident" id="4538640">int64</span><span class="op" id="4538645">(</span><span class="ident" id="4538646">get4</span><span class="op" id="4538650">(</span><span class="ident" id="4538651">z</span><span class="op" id="4538652">.</span><span class="ident" id="4538653">buf</span><span class="op" id="4538656">[</span><span class="num" id="4538657">4</span><span class="op" id="4538658">:</span><span class="num" id="4538659">8</span><span class="op" id="4538660">]</span><span class="op" id="4538661">)</span><span class="op" id="4538662">)</span><span class="op" id="4538663">,</span>&nbsp;<span class="num" id="4538665">0</span><span class="op" id="4538666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4538670">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538700">z</span><span class="op" id="4538701">.</span><span class="ident" id="4538702">OS</span>&nbsp;<span class="op" id="4538705">=</span>&nbsp;<span class="ident" id="4538707">z</span><span class="op" id="4538708">.</span><span class="ident" id="4538709">buf</span><span class="op" id="4538712">[</span><span class="num" id="4538713">9</span><span class="op" id="4538714">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538720">z</span><span class="op" id="4538721">.</span><span class="ident" id="4538722">digest</span><span class="op" id="4538728">.</span><span class="ident" id="4538729">Reset</span><span class="op" id="4538734">(</span><span class="op" id="4538735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538738">z</span><span class="op" id="4538739">.</span><span class="ident" id="4538740">digest</span><span class="op" id="4538746">.</span><span class="ident" id="4538747">Write</span><span class="op" id="4538752">(</span><span class="ident" id="4538753">z</span><span class="op" id="4538754">.</span><span class="ident" id="4538755">buf</span><span class="op" id="4538758">[</span><span class="num" id="4538759">0</span><span class="op" id="4538760">:</span><span class="num" id="4538761">10</span><span class="op" id="4538763">]</span><span class="op" id="4538764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538768">if</span>&nbsp;<span class="ident" id="4538771">z</span><span class="op" id="4538772">.</span><span class="ident" id="4538773">flg</span><span class="op" id="4538776">&amp;</span><span class="ident" id="4538777">flagExtra</span>&nbsp;<span class="op" id="4538787">!=</span>&nbsp;<span class="num" id="4538790">0</span>&nbsp;<span class="op" id="4538792">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538796">n</span><span class="op" id="4538797">,</span>&nbsp;<span class="ident" id="4538799">err</span>&nbsp;<span class="op" id="4538803">:=</span>&nbsp;<span class="ident" id="4538806">z</span><span class="op" id="4538807">.</span><span class="ident" id="4538808">read2</span><span class="op" id="4538813">(</span><span class="op" id="4538814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538818">if</span>&nbsp;<span class="ident" id="4538821">err</span>&nbsp;<span class="op" id="4538825">!=</span>&nbsp;<span class="ident" id="4538828">nil</span>&nbsp;<span class="op" id="4538832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538837">return</span>&nbsp;<span class="ident" id="4538844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538854">data</span>&nbsp;<span class="op" id="4538859">:=</span>&nbsp;<span class="builtinfunc" id="4538862">make</span><span class="op" id="4538866">(</span><span class="op" id="4538867">[</span><span class="op" id="4538868">]</span><span class="builtintype" id="4538869">byte</span><span class="op" id="4538873">,</span>&nbsp;<span class="ident" id="4538875">n</span><span class="op" id="4538876">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538880">if</span>&nbsp;<span class="ident" id="4538883">_</span><span class="op" id="4538884">,</span>&nbsp;<span class="ident" id="4538886">err</span>&nbsp;<span class="op" id="4538890">=</span>&nbsp;<span class="ident" id="4538892">io</span><span class="op" id="4538894">.</span><span class="ident" id="4538895">ReadFull</span><span class="op" id="4538903">(</span><span class="ident" id="4538904">z</span><span class="op" id="4538905">.</span><span class="ident" id="4538906">r</span><span class="op" id="4538907">,</span>&nbsp;<span class="ident" id="4538909">data</span><span class="op" id="4538913">)</span><span class="op" id="4538914">;</span>&nbsp;<span class="ident" id="4538916">err</span>&nbsp;<span class="op" id="4538920">!=</span>&nbsp;<span class="ident" id="4538923">nil</span>&nbsp;<span class="op" id="4538927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538932">return</span>&nbsp;<span class="ident" id="4538939">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538949">if</span>&nbsp;<span class="ident" id="4538952">save</span>&nbsp;<span class="op" id="4538957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4538962">z</span><span class="op" id="4538963">.</span><span class="ident" id="4538964">Extra</span>&nbsp;<span class="op" id="4538970">=</span>&nbsp;<span class="ident" id="4538972">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4538982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4538986">var</span>&nbsp;<span class="ident" id="4538990">s</span>&nbsp;<span class="builtintype" id="4538992">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539000">if</span>&nbsp;<span class="ident" id="4539003">z</span><span class="op" id="4539004">.</span><span class="ident" id="4539005">flg</span><span class="op" id="4539008">&amp;</span><span class="ident" id="4539009">flagName</span>&nbsp;<span class="op" id="4539018">!=</span>&nbsp;<span class="num" id="4539021">0</span>&nbsp;<span class="op" id="4539023">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539027">if</span>&nbsp;<span class="ident" id="4539030">s</span><span class="op" id="4539031">,</span>&nbsp;<span class="ident" id="4539033">err</span>&nbsp;<span class="op" id="4539037">=</span>&nbsp;<span class="ident" id="4539039">z</span><span class="op" id="4539040">.</span><span class="ident" id="4539041">readString</span><span class="op" id="4539051">(</span><span class="op" id="4539052">)</span><span class="op" id="4539053">;</span>&nbsp;<span class="ident" id="4539055">err</span>&nbsp;<span class="op" id="4539059">!=</span>&nbsp;<span class="ident" id="4539062">nil</span>&nbsp;<span class="op" id="4539066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539071">return</span>&nbsp;<span class="ident" id="4539078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539088">if</span>&nbsp;<span class="ident" id="4539091">save</span>&nbsp;<span class="op" id="4539096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539101">z</span><span class="op" id="4539102">.</span><span class="ident" id="4539103">Name</span>&nbsp;<span class="op" id="4539108">=</span>&nbsp;<span class="ident" id="4539110">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539121">if</span>&nbsp;<span class="ident" id="4539124">z</span><span class="op" id="4539125">.</span><span class="ident" id="4539126">flg</span><span class="op" id="4539129">&amp;</span><span class="ident" id="4539130">flagComment</span>&nbsp;<span class="op" id="4539142">!=</span>&nbsp;<span class="num" id="4539145">0</span>&nbsp;<span class="op" id="4539147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539151">if</span>&nbsp;<span class="ident" id="4539154">s</span><span class="op" id="4539155">,</span>&nbsp;<span class="ident" id="4539157">err</span>&nbsp;<span class="op" id="4539161">=</span>&nbsp;<span class="ident" id="4539163">z</span><span class="op" id="4539164">.</span><span class="ident" id="4539165">readString</span><span class="op" id="4539175">(</span><span class="op" id="4539176">)</span><span class="op" id="4539177">;</span>&nbsp;<span class="ident" id="4539179">err</span>&nbsp;<span class="op" id="4539183">!=</span>&nbsp;<span class="ident" id="4539186">nil</span>&nbsp;<span class="op" id="4539190">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539195">return</span>&nbsp;<span class="ident" id="4539202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539212">if</span>&nbsp;<span class="ident" id="4539215">save</span>&nbsp;<span class="op" id="4539220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539225">z</span><span class="op" id="4539226">.</span><span class="ident" id="4539227">Comment</span>&nbsp;<span class="op" id="4539235">=</span>&nbsp;<span class="ident" id="4539237">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539241">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539248">if</span>&nbsp;<span class="ident" id="4539251">z</span><span class="op" id="4539252">.</span><span class="ident" id="4539253">flg</span><span class="op" id="4539256">&amp;</span><span class="ident" id="4539257">flagHdrCrc</span>&nbsp;<span class="op" id="4539268">!=</span>&nbsp;<span class="num" id="4539271">0</span>&nbsp;<span class="op" id="4539273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539277">n</span><span class="op" id="4539278">,</span>&nbsp;<span class="ident" id="4539280">err</span>&nbsp;<span class="op" id="4539284">:=</span>&nbsp;<span class="ident" id="4539287">z</span><span class="op" id="4539288">.</span><span class="ident" id="4539289">read2</span><span class="op" id="4539294">(</span><span class="op" id="4539295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539299">if</span>&nbsp;<span class="ident" id="4539302">err</span>&nbsp;<span class="op" id="4539306">!=</span>&nbsp;<span class="ident" id="4539309">nil</span>&nbsp;<span class="op" id="4539313">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539318">return</span>&nbsp;<span class="ident" id="4539325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539335">sum</span>&nbsp;<span class="op" id="4539339">:=</span>&nbsp;<span class="ident" id="4539342">z</span><span class="op" id="4539343">.</span><span class="ident" id="4539344">digest</span><span class="op" id="4539350">.</span><span class="ident" id="4539351">Sum32</span><span class="op" id="4539356">(</span><span class="op" id="4539357">)</span>&nbsp;<span class="op" id="4539359">&amp;</span>&nbsp;<span class="num" id="4539361">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539370">if</span>&nbsp;<span class="ident" id="4539373">n</span>&nbsp;<span class="op" id="4539375">!=</span>&nbsp;<span class="ident" id="4539378">sum</span>&nbsp;<span class="op" id="4539382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539387">return</span>&nbsp;<span class="ident" id="4539394">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539413">z</span><span class="op" id="4539414">.</span><span class="ident" id="4539415">digest</span><span class="op" id="4539421">.</span><span class="ident" id="4539422">Reset</span><span class="op" id="4539427">(</span><span class="op" id="4539428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539431">if</span>&nbsp;<span class="ident" id="4539434">z</span><span class="op" id="4539435">.</span><span class="ident" id="4539436">decompressor</span>&nbsp;<span class="op" id="4539449">==</span>&nbsp;<span class="ident" id="4539452">nil</span>&nbsp;<span class="op" id="4539456">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539460">z</span><span class="op" id="4539461">.</span><span class="ident" id="4539462">decompressor</span>&nbsp;<span class="op" id="4539475">=</span>&nbsp;<span class="ident" id="4539477">flate</span><span class="op" id="4539482">.</span><span class="ident" id="4539483">NewReader</span><span class="op" id="4539492">(</span><span class="ident" id="4539493">z</span><span class="op" id="4539494">.</span><span class="ident" id="4539495">r</span><span class="op" id="4539496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539499">}</span>&nbsp;<span class="keyword" id="4539501">else</span>&nbsp;<span class="op" id="4539506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539510">z</span><span class="op" id="4539511">.</span><span class="ident" id="4539512">decompressor</span><span class="op" id="4539524">.</span><span class="op" id="4539525">(</span><span class="ident" id="4539526">flate</span><span class="op" id="4539531">.</span><span class="ident" id="4539532">Resetter</span><span class="op" id="4539540">)</span><span class="op" id="4539541">.</span><span class="ident" id="4539542">Reset</span><span class="op" id="4539547">(</span><span class="ident" id="4539548">z</span><span class="op" id="4539549">.</span><span class="ident" id="4539550">r</span><span class="op" id="4539551">,</span>&nbsp;<span class="ident" id="4539553">nil</span><span class="op" id="4539556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539562">return</span>&nbsp;<span class="ident" id="4539569">nil</span><br>
<span class="lineno">240</span><span class="op" id="4539573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4539576">func</span>&nbsp;<span class="op" id="4539581">(</span><span class="ident" id="4539582">z</span>&nbsp;<span class="op" id="4539584">*</span><span class="ident" id="4539585">Reader</span><span class="op" id="4539591">)</span>&nbsp;<span class="ident" id="4539593">Read</span><span class="op" id="4539597">(</span><span class="ident" id="4539598">p</span>&nbsp;<span class="op" id="4539600">[</span><span class="op" id="4539601">]</span><span class="builtintype" id="4539602">byte</span><span class="op" id="4539606">)</span>&nbsp;<span class="op" id="4539608">(</span><span class="ident" id="4539609">n</span>&nbsp;<span class="builtintype" id="4539611">int</span><span class="op" id="4539614">,</span>&nbsp;<span class="ident" id="4539616">err</span>&nbsp;<span class="builtintype" id="4539620">error</span><span class="op" id="4539625">)</span>&nbsp;<span class="op" id="4539627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539630">if</span>&nbsp;<span class="ident" id="4539633">z</span><span class="op" id="4539634">.</span><span class="ident" id="4539635">err</span>&nbsp;<span class="op" id="4539639">!=</span>&nbsp;<span class="ident" id="4539642">nil</span>&nbsp;<span class="op" id="4539646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539650">return</span>&nbsp;<span class="num" id="4539657">0</span><span class="op" id="4539658">,</span>&nbsp;<span class="ident" id="4539660">z</span><span class="op" id="4539661">.</span><span class="ident" id="4539662">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539670">if</span>&nbsp;<span class="builtinfunc" id="4539673">len</span><span class="op" id="4539676">(</span><span class="ident" id="4539677">p</span><span class="op" id="4539678">)</span>&nbsp;<span class="op" id="4539680">==</span>&nbsp;<span class="num" id="4539683">0</span>&nbsp;<span class="op" id="4539685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539689">return</span>&nbsp;<span class="num" id="4539696">0</span><span class="op" id="4539697">,</span>&nbsp;<span class="ident" id="4539699">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539708">n</span><span class="op" id="4539709">,</span>&nbsp;<span class="ident" id="4539711">err</span>&nbsp;<span class="op" id="4539715">=</span>&nbsp;<span class="ident" id="4539717">z</span><span class="op" id="4539718">.</span><span class="ident" id="4539719">decompressor</span><span class="op" id="4539731">.</span><span class="ident" id="4539732">Read</span><span class="op" id="4539736">(</span><span class="ident" id="4539737">p</span><span class="op" id="4539738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539741">z</span><span class="op" id="4539742">.</span><span class="ident" id="4539743">digest</span><span class="op" id="4539749">.</span><span class="ident" id="4539750">Write</span><span class="op" id="4539755">(</span><span class="ident" id="4539756">p</span><span class="op" id="4539757">[</span><span class="num" id="4539758">0</span><span class="op" id="4539759">:</span><span class="ident" id="4539760">n</span><span class="op" id="4539761">]</span><span class="op" id="4539762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539765">z</span><span class="op" id="4539766">.</span><span class="ident" id="4539767">size</span>&nbsp;<span class="op" id="4539772">+=</span>&nbsp;<span class="builtintype" id="4539775">uint32</span><span class="op" id="4539781">(</span><span class="ident" id="4539782">n</span><span class="op" id="4539783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539786">if</span>&nbsp;<span class="ident" id="4539789">n</span>&nbsp;<span class="op" id="4539791">!=</span>&nbsp;<span class="num" id="4539794">0</span>&nbsp;<span class="op" id="4539796">||</span>&nbsp;<span class="ident" id="4539799">err</span>&nbsp;<span class="op" id="4539803">!=</span>&nbsp;<span class="ident" id="4539806">io</span><span class="op" id="4539808">.</span><span class="ident" id="4539809">EOF</span>&nbsp;<span class="op" id="4539813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539817">z</span><span class="op" id="4539818">.</span><span class="ident" id="4539819">err</span>&nbsp;<span class="op" id="4539823">=</span>&nbsp;<span class="ident" id="4539825">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4539843">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539885">if</span>&nbsp;<span class="ident" id="4539888">_</span><span class="op" id="4539889">,</span>&nbsp;<span class="ident" id="4539891">err</span>&nbsp;<span class="op" id="4539895">:=</span>&nbsp;<span class="ident" id="4539898">io</span><span class="op" id="4539900">.</span><span class="ident" id="4539901">ReadFull</span><span class="op" id="4539909">(</span><span class="ident" id="4539910">z</span><span class="op" id="4539911">.</span><span class="ident" id="4539912">r</span><span class="op" id="4539913">,</span>&nbsp;<span class="ident" id="4539915">z</span><span class="op" id="4539916">.</span><span class="ident" id="4539917">buf</span><span class="op" id="4539920">[</span><span class="num" id="4539921">0</span><span class="op" id="4539922">:</span><span class="num" id="4539923">8</span><span class="op" id="4539924">]</span><span class="op" id="4539925">)</span><span class="op" id="4539926">;</span>&nbsp;<span class="ident" id="4539928">err</span>&nbsp;<span class="op" id="4539932">!=</span>&nbsp;<span class="ident" id="4539935">nil</span>&nbsp;<span class="op" id="4539939">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539943">z</span><span class="op" id="4539944">.</span><span class="ident" id="4539945">err</span>&nbsp;<span class="op" id="4539949">=</span>&nbsp;<span class="ident" id="4539951">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4539957">return</span>&nbsp;<span class="num" id="4539964">0</span><span class="op" id="4539965">,</span>&nbsp;<span class="ident" id="4539967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4539972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4539975">crc32</span><span class="op" id="4539980">,</span>&nbsp;<span class="ident" id="4539982">isize</span>&nbsp;<span class="op" id="4539988">:=</span>&nbsp;<span class="ident" id="4539991">get4</span><span class="op" id="4539995">(</span><span class="ident" id="4539996">z</span><span class="op" id="4539997">.</span><span class="ident" id="4539998">buf</span><span class="op" id="4540001">[</span><span class="num" id="4540002">0</span><span class="op" id="4540003">:</span><span class="num" id="4540004">4</span><span class="op" id="4540005">]</span><span class="op" id="4540006">)</span><span class="op" id="4540007">,</span>&nbsp;<span class="ident" id="4540009">get4</span><span class="op" id="4540013">(</span><span class="ident" id="4540014">z</span><span class="op" id="4540015">.</span><span class="ident" id="4540016">buf</span><span class="op" id="4540019">[</span><span class="num" id="4540020">4</span><span class="op" id="4540021">:</span><span class="num" id="4540022">8</span><span class="op" id="4540023">]</span><span class="op" id="4540024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540027">sum</span>&nbsp;<span class="op" id="4540031">:=</span>&nbsp;<span class="ident" id="4540034">z</span><span class="op" id="4540035">.</span><span class="ident" id="4540036">digest</span><span class="op" id="4540042">.</span><span class="ident" id="4540043">Sum32</span><span class="op" id="4540048">(</span><span class="op" id="4540049">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540052">if</span>&nbsp;<span class="ident" id="4540055">sum</span>&nbsp;<span class="op" id="4540059">!=</span>&nbsp;<span class="ident" id="4540062">crc32</span>&nbsp;<span class="op" id="4540068">||</span>&nbsp;<span class="ident" id="4540071">isize</span>&nbsp;<span class="op" id="4540077">!=</span>&nbsp;<span class="ident" id="4540080">z</span><span class="op" id="4540081">.</span><span class="ident" id="4540082">size</span>&nbsp;<span class="op" id="4540087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540091">z</span><span class="op" id="4540092">.</span><span class="ident" id="4540093">err</span>&nbsp;<span class="op" id="4540097">=</span>&nbsp;<span class="ident" id="4540099">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540113">return</span>&nbsp;<span class="num" id="4540120">0</span><span class="op" id="4540121">,</span>&nbsp;<span class="ident" id="4540123">z</span><span class="op" id="4540124">.</span><span class="ident" id="4540125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4540130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4540134">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540168">if</span>&nbsp;<span class="op" id="4540171">!</span><span class="ident" id="4540172">z</span><span class="op" id="4540173">.</span><span class="ident" id="4540174">multistream</span>&nbsp;<span class="op" id="4540186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540190">return</span>&nbsp;<span class="num" id="4540197">0</span><span class="op" id="4540198">,</span>&nbsp;<span class="ident" id="4540200">io</span><span class="op" id="4540202">.</span><span class="ident" id="4540203">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4540208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540212">if</span>&nbsp;<span class="ident" id="4540215">err</span>&nbsp;<span class="op" id="4540219">=</span>&nbsp;<span class="ident" id="4540221">z</span><span class="op" id="4540222">.</span><span class="ident" id="4540223">readHeader</span><span class="op" id="4540233">(</span><span class="builtintype" id="4540234">false</span><span class="op" id="4540239">)</span><span class="op" id="4540240">;</span>&nbsp;<span class="ident" id="4540242">err</span>&nbsp;<span class="op" id="4540246">!=</span>&nbsp;<span class="ident" id="4540249">nil</span>&nbsp;<span class="op" id="4540253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540257">z</span><span class="op" id="4540258">.</span><span class="ident" id="4540259">err</span>&nbsp;<span class="op" id="4540263">=</span>&nbsp;<span class="ident" id="4540265">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540271">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4540279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4540283">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540317">z</span><span class="op" id="4540318">.</span><span class="ident" id="4540319">digest</span><span class="op" id="4540325">.</span><span class="ident" id="4540326">Reset</span><span class="op" id="4540331">(</span><span class="op" id="4540332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4540335">z</span><span class="op" id="4540336">.</span><span class="ident" id="4540337">size</span>&nbsp;<span class="op" id="4540342">=</span>&nbsp;<span class="num" id="4540344">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4540347">return</span>&nbsp;<span class="ident" id="4540354">z</span><span class="op" id="4540355">.</span><span class="ident" id="4540356">Read</span><span class="op" id="4540360">(</span><span class="ident" id="4540361">p</span><span class="op" id="4540362">)</span><br>
<span class="lineno"></span><span class="op" id="4540364">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4540367">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4540439">func</span>&nbsp;<span class="op" id="4540444">(</span><span class="ident" id="4540445">z</span>&nbsp;<span class="op" id="4540447">*</span><span class="ident" id="4540448">Reader</span><span class="op" id="4540454">)</span>&nbsp;<span class="ident" id="4540456">Close</span><span class="op" id="4540461">(</span><span class="op" id="4540462">)</span>&nbsp;<span class="builtintype" id="4540464">error</span>&nbsp;<span class="op" id="4540470">{</span>&nbsp;<span class="keyword" id="4540472">return</span>&nbsp;<span class="ident" id="4540479">z</span><span class="op" id="4540480">.</span><span class="ident" id="4540481">decompressor</span><span class="op" id="4540493">.</span><span class="ident" id="4540494">Close</span><span class="op" id="4540499">(</span><span class="op" id="4540500">)</span>&nbsp;<span class="op" id="4540502">}</span>
</div>
</body>
</html>
