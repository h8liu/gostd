<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7122307">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7122362">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7122416">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7122467">package</span>&nbsp;<span class="ident" id="7122475">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122482">import</span>&nbsp;<span class="op" id="7122489">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122492">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122499">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122512">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7122520">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7122530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7122533">func</span>&nbsp;<span class="ident" id="7122538">checkPos</span><span class="op" id="7122546">(</span><span class="ident" id="7122547">t</span>&nbsp;<span class="op" id="7122549">*</span><span class="ident" id="7122550">testing</span><span class="op" id="7122557">.</span><span class="ident" id="7122558">T</span><span class="op" id="7122559">,</span>&nbsp;<span class="ident" id="7122561">msg</span>&nbsp;<span class="builtintype" id="7122565">string</span><span class="op" id="7122571">,</span>&nbsp;<span class="ident" id="7122573">got</span><span class="op" id="7122576">,</span>&nbsp;<span class="ident" id="7122578">want</span>&nbsp;<span class="ident" id="7122583">Position</span><span class="op" id="7122591">)</span>&nbsp;<span class="op" id="7122593">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122596">if</span>&nbsp;<span class="ident" id="7122599">got</span><span class="op" id="7122602">.</span><span class="ident" id="7122603">Filename</span>&nbsp;<span class="op" id="7122612">!=</span>&nbsp;<span class="ident" id="7122615">want</span><span class="op" id="7122619">.</span><span class="ident" id="7122620">Filename</span>&nbsp;<span class="op" id="7122629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122633">t</span><span class="op" id="7122634">.</span><span class="ident" id="7122635">Errorf</span><span class="op" id="7122641">(</span><span class="string" id="7122642">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7122674">,</span>&nbsp;<span class="ident" id="7122676">msg</span><span class="op" id="7122679">,</span>&nbsp;<span class="ident" id="7122681">got</span><span class="op" id="7122684">.</span><span class="ident" id="7122685">Filename</span><span class="op" id="7122693">,</span>&nbsp;<span class="ident" id="7122695">want</span><span class="op" id="7122699">.</span><span class="ident" id="7122700">Filename</span><span class="op" id="7122708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122714">if</span>&nbsp;<span class="ident" id="7122717">got</span><span class="op" id="7122720">.</span><span class="ident" id="7122721">Offset</span>&nbsp;<span class="op" id="7122728">!=</span>&nbsp;<span class="ident" id="7122731">want</span><span class="op" id="7122735">.</span><span class="ident" id="7122736">Offset</span>&nbsp;<span class="op" id="7122743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122747">t</span><span class="op" id="7122748">.</span><span class="ident" id="7122749">Errorf</span><span class="op" id="7122755">(</span><span class="string" id="7122756">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7122786">,</span>&nbsp;<span class="ident" id="7122788">msg</span><span class="op" id="7122791">,</span>&nbsp;<span class="ident" id="7122793">got</span><span class="op" id="7122796">.</span><span class="ident" id="7122797">Offset</span><span class="op" id="7122803">,</span>&nbsp;<span class="ident" id="7122805">want</span><span class="op" id="7122809">.</span><span class="ident" id="7122810">Offset</span><span class="op" id="7122816">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122822">if</span>&nbsp;<span class="ident" id="7122825">got</span><span class="op" id="7122828">.</span><span class="ident" id="7122829">Line</span>&nbsp;<span class="op" id="7122834">!=</span>&nbsp;<span class="ident" id="7122837">want</span><span class="op" id="7122841">.</span><span class="ident" id="7122842">Line</span>&nbsp;<span class="op" id="7122847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122851">t</span><span class="op" id="7122852">.</span><span class="ident" id="7122853">Errorf</span><span class="op" id="7122859">(</span><span class="string" id="7122860">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7122888">,</span>&nbsp;<span class="ident" id="7122890">msg</span><span class="op" id="7122893">,</span>&nbsp;<span class="ident" id="7122895">got</span><span class="op" id="7122898">.</span><span class="ident" id="7122899">Line</span><span class="op" id="7122903">,</span>&nbsp;<span class="ident" id="7122905">want</span><span class="op" id="7122909">.</span><span class="ident" id="7122910">Line</span><span class="op" id="7122914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7122917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7122920">if</span>&nbsp;<span class="ident" id="7122923">got</span><span class="op" id="7122926">.</span><span class="ident" id="7122927">Column</span>&nbsp;<span class="op" id="7122934">!=</span>&nbsp;<span class="ident" id="7122937">want</span><span class="op" id="7122941">.</span><span class="ident" id="7122942">Column</span>&nbsp;<span class="op" id="7122949">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7122953">t</span><span class="op" id="7122954">.</span><span class="ident" id="7122955">Errorf</span><span class="op" id="7122961">(</span><span class="string" id="7122962">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7122992">,</span>&nbsp;<span class="ident" id="7122994">msg</span><span class="op" id="7122997">,</span>&nbsp;<span class="ident" id="7122999">got</span><span class="op" id="7123002">.</span><span class="ident" id="7123003">Column</span><span class="op" id="7123009">,</span>&nbsp;<span class="ident" id="7123011">want</span><span class="op" id="7123015">.</span><span class="ident" id="7123016">Column</span><span class="op" id="7123022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123025">}</span><br>
<span class="lineno"></span><span class="op" id="7123027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7123030">func</span>&nbsp;<span class="ident" id="7123035">TestNoPos</span><span class="op" id="7123044">(</span><span class="ident" id="7123045">t</span>&nbsp;<span class="op" id="7123047">*</span><span class="ident" id="7123048">testing</span><span class="op" id="7123055">.</span><span class="ident" id="7123056">T</span><span class="op" id="7123057">)</span>&nbsp;<span class="op" id="7123059">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123062">if</span>&nbsp;<span class="ident" id="7123065">NoPos</span><span class="op" id="7123070">.</span><span class="ident" id="7123071">IsValid</span><span class="op" id="7123078">(</span><span class="op" id="7123079">)</span>&nbsp;<span class="op" id="7123081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123085">t</span><span class="op" id="7123086">.</span><span class="ident" id="7123087">Errorf</span><span class="op" id="7123093">(</span><span class="string" id="7123094">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7123121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123127">var</span>&nbsp;<span class="ident" id="7123131">fset</span>&nbsp;<span class="op" id="7123136">*</span><span class="ident" id="7123137">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123146">checkPos</span><span class="op" id="7123154">(</span><span class="ident" id="7123155">t</span><span class="op" id="7123156">,</span>&nbsp;<span class="string" id="7123158">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7123169">,</span>&nbsp;<span class="ident" id="7123171">fset</span><span class="op" id="7123175">.</span><span class="ident" id="7123176">Position</span><span class="op" id="7123184">(</span><span class="ident" id="7123185">NoPos</span><span class="op" id="7123190">)</span><span class="op" id="7123191">,</span>&nbsp;<span class="ident" id="7123193">Position</span><span class="op" id="7123201">{</span><span class="op" id="7123202">}</span><span class="op" id="7123203">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123206">fset</span>&nbsp;<span class="op" id="7123211">=</span>&nbsp;<span class="ident" id="7123213">NewFileSet</span><span class="op" id="7123223">(</span><span class="op" id="7123224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123227">checkPos</span><span class="op" id="7123235">(</span><span class="ident" id="7123236">t</span><span class="op" id="7123237">,</span>&nbsp;<span class="string" id="7123239">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7123251">,</span>&nbsp;<span class="ident" id="7123253">fset</span><span class="op" id="7123257">.</span><span class="ident" id="7123258">Position</span><span class="op" id="7123266">(</span><span class="ident" id="7123267">NoPos</span><span class="op" id="7123272">)</span><span class="op" id="7123273">,</span>&nbsp;<span class="ident" id="7123275">Position</span><span class="op" id="7123283">{</span><span class="op" id="7123284">}</span><span class="op" id="7123285">)</span><br>
<span class="lineno"></span><span class="op" id="7123287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7123290">var</span>&nbsp;<span class="ident" id="7123294">tests</span>&nbsp;<span class="op" id="7123300">=</span>&nbsp;<span class="op" id="7123302">[</span><span class="op" id="7123303">]</span><span class="keyword" id="7123304">struct</span>&nbsp;<span class="op" id="7123311">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123314">filename</span>&nbsp;<span class="builtintype" id="7123323">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123331">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7123340">[</span><span class="op" id="7123341">]</span><span class="builtintype" id="7123342">byte</span>&nbsp;<span class="comment" id="7123347">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123362">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7123371">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123376">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7123385">[</span><span class="op" id="7123386">]</span><span class="builtintype" id="7123387">int</span><br>
<span class="lineno"></span><span class="op" id="7123391">}</span><span class="op" id="7123392">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123395">{</span><span class="string" id="7123396">&#34;a&#34;</span><span class="op" id="7123399">,</span>&nbsp;<span class="op" id="7123401">[</span><span class="op" id="7123402">]</span><span class="builtintype" id="7123403">byte</span><span class="op" id="7123407">{</span><span class="op" id="7123408">}</span><span class="op" id="7123409">,</span>&nbsp;<span class="num" id="7123411">0</span><span class="op" id="7123412">,</span>&nbsp;<span class="op" id="7123414">[</span><span class="op" id="7123415">]</span><span class="builtintype" id="7123416">int</span><span class="op" id="7123419">{</span><span class="op" id="7123420">}</span><span class="op" id="7123421">}</span><span class="op" id="7123422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123425">{</span><span class="string" id="7123426">&#34;b&#34;</span><span class="op" id="7123429">,</span>&nbsp;<span class="op" id="7123431">[</span><span class="op" id="7123432">]</span><span class="builtintype" id="7123433">byte</span><span class="op" id="7123437">(</span><span class="string" id="7123438">&#34;01234&#34;</span><span class="op" id="7123445">)</span><span class="op" id="7123446">,</span>&nbsp;<span class="num" id="7123448">5</span><span class="op" id="7123449">,</span>&nbsp;<span class="op" id="7123451">[</span><span class="op" id="7123452">]</span><span class="builtintype" id="7123453">int</span><span class="op" id="7123456">{</span><span class="num" id="7123457">0</span><span class="op" id="7123458">}</span><span class="op" id="7123459">}</span><span class="op" id="7123460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123463">{</span><span class="string" id="7123464">&#34;c&#34;</span><span class="op" id="7123467">,</span>&nbsp;<span class="op" id="7123469">[</span><span class="op" id="7123470">]</span><span class="builtintype" id="7123471">byte</span><span class="op" id="7123475">(</span><span class="string" id="7123476">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7123496">)</span><span class="op" id="7123497">,</span>&nbsp;<span class="num" id="7123499">9</span><span class="op" id="7123500">,</span>&nbsp;<span class="op" id="7123502">[</span><span class="op" id="7123503">]</span><span class="builtintype" id="7123504">int</span><span class="op" id="7123507">{</span><span class="num" id="7123508">0</span><span class="op" id="7123509">,</span>&nbsp;<span class="num" id="7123511">1</span><span class="op" id="7123512">,</span>&nbsp;<span class="num" id="7123514">2</span><span class="op" id="7123515">,</span>&nbsp;<span class="num" id="7123517">3</span><span class="op" id="7123518">,</span>&nbsp;<span class="num" id="7123520">4</span><span class="op" id="7123521">,</span>&nbsp;<span class="num" id="7123523">5</span><span class="op" id="7123524">,</span>&nbsp;<span class="num" id="7123526">6</span><span class="op" id="7123527">,</span>&nbsp;<span class="num" id="7123529">7</span><span class="op" id="7123530">,</span>&nbsp;<span class="num" id="7123532">8</span><span class="op" id="7123533">}</span><span class="op" id="7123534">}</span><span class="op" id="7123535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123538">{</span><span class="string" id="7123539">&#34;d&#34;</span><span class="op" id="7123542">,</span>&nbsp;<span class="ident" id="7123544">nil</span><span class="op" id="7123547">,</span>&nbsp;<span class="num" id="7123549">100</span><span class="op" id="7123552">,</span>&nbsp;<span class="op" id="7123554">[</span><span class="op" id="7123555">]</span><span class="builtintype" id="7123556">int</span><span class="op" id="7123559">{</span><span class="num" id="7123560">0</span><span class="op" id="7123561">,</span>&nbsp;<span class="num" id="7123563">5</span><span class="op" id="7123564">,</span>&nbsp;<span class="num" id="7123566">10</span><span class="op" id="7123568">,</span>&nbsp;<span class="num" id="7123570">20</span><span class="op" id="7123572">,</span>&nbsp;<span class="num" id="7123574">30</span><span class="op" id="7123576">,</span>&nbsp;<span class="num" id="7123578">70</span><span class="op" id="7123580">,</span>&nbsp;<span class="num" id="7123582">71</span><span class="op" id="7123584">,</span>&nbsp;<span class="num" id="7123586">72</span><span class="op" id="7123588">,</span>&nbsp;<span class="num" id="7123590">80</span><span class="op" id="7123592">,</span>&nbsp;<span class="num" id="7123594">85</span><span class="op" id="7123596">,</span>&nbsp;<span class="num" id="7123598">90</span><span class="op" id="7123600">,</span>&nbsp;<span class="num" id="7123602">99</span><span class="op" id="7123604">}</span><span class="op" id="7123605">}</span><span class="op" id="7123606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123609">{</span><span class="string" id="7123610">&#34;e&#34;</span><span class="op" id="7123613">,</span>&nbsp;<span class="ident" id="7123615">nil</span><span class="op" id="7123618">,</span>&nbsp;<span class="num" id="7123620">777</span><span class="op" id="7123623">,</span>&nbsp;<span class="op" id="7123625">[</span><span class="op" id="7123626">]</span><span class="builtintype" id="7123627">int</span><span class="op" id="7123630">{</span><span class="num" id="7123631">0</span><span class="op" id="7123632">,</span>&nbsp;<span class="num" id="7123634">80</span><span class="op" id="7123636">,</span>&nbsp;<span class="num" id="7123638">100</span><span class="op" id="7123641">,</span>&nbsp;<span class="num" id="7123643">120</span><span class="op" id="7123646">,</span>&nbsp;<span class="num" id="7123648">130</span><span class="op" id="7123651">,</span>&nbsp;<span class="num" id="7123653">180</span><span class="op" id="7123656">,</span>&nbsp;<span class="num" id="7123658">267</span><span class="op" id="7123661">,</span>&nbsp;<span class="num" id="7123663">455</span><span class="op" id="7123666">,</span>&nbsp;<span class="num" id="7123668">500</span><span class="op" id="7123671">,</span>&nbsp;<span class="num" id="7123673">567</span><span class="op" id="7123676">,</span>&nbsp;<span class="num" id="7123678">620</span><span class="op" id="7123681">}</span><span class="op" id="7123682">}</span><span class="op" id="7123683">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123686">{</span><span class="string" id="7123687">&#34;f&#34;</span><span class="op" id="7123690">,</span>&nbsp;<span class="op" id="7123692">[</span><span class="op" id="7123693">]</span><span class="builtintype" id="7123694">byte</span><span class="op" id="7123698">(</span><span class="string" id="7123699">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7123728">)</span><span class="op" id="7123729">,</span>&nbsp;<span class="num" id="7123731">23</span><span class="op" id="7123733">,</span>&nbsp;<span class="op" id="7123735">[</span><span class="op" id="7123736">]</span><span class="builtintype" id="7123737">int</span><span class="op" id="7123740">{</span><span class="num" id="7123741">0</span><span class="op" id="7123742">,</span>&nbsp;<span class="num" id="7123744">10</span><span class="op" id="7123746">,</span>&nbsp;<span class="num" id="7123748">11</span><span class="op" id="7123750">}</span><span class="op" id="7123751">}</span><span class="op" id="7123752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123755">{</span><span class="string" id="7123756">&#34;g&#34;</span><span class="op" id="7123759">,</span>&nbsp;<span class="op" id="7123761">[</span><span class="op" id="7123762">]</span><span class="builtintype" id="7123763">byte</span><span class="op" id="7123767">(</span><span class="string" id="7123768">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7123799">)</span><span class="op" id="7123800">,</span>&nbsp;<span class="num" id="7123802">24</span><span class="op" id="7123804">,</span>&nbsp;<span class="op" id="7123806">[</span><span class="op" id="7123807">]</span><span class="builtintype" id="7123808">int</span><span class="op" id="7123811">{</span><span class="num" id="7123812">0</span><span class="op" id="7123813">,</span>&nbsp;<span class="num" id="7123815">10</span><span class="op" id="7123817">,</span>&nbsp;<span class="num" id="7123819">11</span><span class="op" id="7123821">}</span><span class="op" id="7123822">}</span><span class="op" id="7123823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7123826">{</span><span class="string" id="7123827">&#34;h&#34;</span><span class="op" id="7123830">,</span>&nbsp;<span class="op" id="7123832">[</span><span class="op" id="7123833">]</span><span class="builtintype" id="7123834">byte</span><span class="op" id="7123838">(</span><span class="string" id="7123839">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7123871">)</span><span class="op" id="7123872">,</span>&nbsp;<span class="num" id="7123874">25</span><span class="op" id="7123876">,</span>&nbsp;<span class="op" id="7123878">[</span><span class="op" id="7123879">]</span><span class="builtintype" id="7123880">int</span><span class="op" id="7123883">{</span><span class="num" id="7123884">0</span><span class="op" id="7123885">,</span>&nbsp;<span class="num" id="7123887">10</span><span class="op" id="7123889">,</span>&nbsp;<span class="num" id="7123891">11</span><span class="op" id="7123893">,</span>&nbsp;<span class="num" id="7123895">24</span><span class="op" id="7123897">}</span><span class="op" id="7123898">}</span><span class="op" id="7123899">,</span><br>
<span class="lineno"></span><span class="op" id="7123901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7123904">func</span>&nbsp;<span class="ident" id="7123909">linecol</span><span class="op" id="7123916">(</span><span class="ident" id="7123917">lines</span>&nbsp;<span class="op" id="7123923">[</span><span class="op" id="7123924">]</span><span class="builtintype" id="7123925">int</span><span class="op" id="7123928">,</span>&nbsp;<span class="ident" id="7123930">offs</span>&nbsp;<span class="builtintype" id="7123935">int</span><span class="op" id="7123938">)</span>&nbsp;<span class="op" id="7123940">(</span><span class="builtintype" id="7123941">int</span><span class="op" id="7123944">,</span>&nbsp;<span class="builtintype" id="7123946">int</span><span class="op" id="7123949">)</span>&nbsp;<span class="op" id="7123951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7123954">prevLineOffs</span>&nbsp;<span class="op" id="7123967">:=</span>&nbsp;<span class="num" id="7123970">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7123973">for</span>&nbsp;<span class="ident" id="7123977">line</span><span class="op" id="7123981">,</span>&nbsp;<span class="ident" id="7123983">lineOffs</span>&nbsp;<span class="op" id="7123992">:=</span>&nbsp;<span class="keyword" id="7123995">range</span>&nbsp;<span class="ident" id="7124001">lines</span>&nbsp;<span class="op" id="7124007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124011">if</span>&nbsp;<span class="ident" id="7124014">offs</span>&nbsp;<span class="op" id="7124019">&lt;</span>&nbsp;<span class="ident" id="7124021">lineOffs</span>&nbsp;<span class="op" id="7124030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124035">return</span>&nbsp;<span class="ident" id="7124042">line</span><span class="op" id="7124046">,</span>&nbsp;<span class="ident" id="7124048">offs</span>&nbsp;<span class="op" id="7124053">-</span>&nbsp;<span class="ident" id="7124055">prevLineOffs</span>&nbsp;<span class="op" id="7124068">+</span>&nbsp;<span class="num" id="7124070">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124078">prevLineOffs</span>&nbsp;<span class="op" id="7124091">=</span>&nbsp;<span class="ident" id="7124093">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124106">return</span>&nbsp;<span class="builtinfunc" id="7124113">len</span><span class="op" id="7124116">(</span><span class="ident" id="7124117">lines</span><span class="op" id="7124122">)</span><span class="op" id="7124123">,</span>&nbsp;<span class="ident" id="7124125">offs</span>&nbsp;<span class="op" id="7124130">-</span>&nbsp;<span class="ident" id="7124132">prevLineOffs</span>&nbsp;<span class="op" id="7124145">+</span>&nbsp;<span class="num" id="7124147">1</span><br>
<span class="lineno"></span><span class="op" id="7124149">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7124152">func</span>&nbsp;<span class="ident" id="7124157">verifyPositions</span><span class="op" id="7124172">(</span><span class="ident" id="7124173">t</span>&nbsp;<span class="op" id="7124175">*</span><span class="ident" id="7124176">testing</span><span class="op" id="7124183">.</span><span class="ident" id="7124184">T</span><span class="op" id="7124185">,</span>&nbsp;<span class="ident" id="7124187">fset</span>&nbsp;<span class="op" id="7124192">*</span><span class="ident" id="7124193">FileSet</span><span class="op" id="7124200">,</span>&nbsp;<span class="ident" id="7124202">f</span>&nbsp;<span class="op" id="7124204">*</span><span class="ident" id="7124205">File</span><span class="op" id="7124209">,</span>&nbsp;<span class="ident" id="7124211">lines</span>&nbsp;<span class="op" id="7124217">[</span><span class="op" id="7124218">]</span><span class="builtintype" id="7124219">int</span><span class="op" id="7124222">)</span>&nbsp;<span class="op" id="7124224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124227">for</span>&nbsp;<span class="ident" id="7124231">offs</span>&nbsp;<span class="op" id="7124236">:=</span>&nbsp;<span class="num" id="7124239">0</span><span class="op" id="7124240">;</span>&nbsp;<span class="ident" id="7124242">offs</span>&nbsp;<span class="op" id="7124247">&lt;</span>&nbsp;<span class="ident" id="7124249">f</span><span class="op" id="7124250">.</span><span class="ident" id="7124251">Size</span><span class="op" id="7124255">(</span><span class="op" id="7124256">)</span><span class="op" id="7124257">;</span>&nbsp;<span class="ident" id="7124259">offs</span><span class="op" id="7124263">++</span>&nbsp;<span class="op" id="7124266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124270">p</span>&nbsp;<span class="op" id="7124272">:=</span>&nbsp;<span class="ident" id="7124275">f</span><span class="op" id="7124276">.</span><span class="ident" id="7124277">Pos</span><span class="op" id="7124280">(</span><span class="ident" id="7124281">offs</span><span class="op" id="7124285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124289">offs2</span>&nbsp;<span class="op" id="7124295">:=</span>&nbsp;<span class="ident" id="7124298">f</span><span class="op" id="7124299">.</span><span class="ident" id="7124300">Offset</span><span class="op" id="7124306">(</span><span class="ident" id="7124307">p</span><span class="op" id="7124308">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124312">if</span>&nbsp;<span class="ident" id="7124315">offs2</span>&nbsp;<span class="op" id="7124321">!=</span>&nbsp;<span class="ident" id="7124324">offs</span>&nbsp;<span class="op" id="7124329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124334">t</span><span class="op" id="7124335">.</span><span class="ident" id="7124336">Errorf</span><span class="op" id="7124342">(</span><span class="string" id="7124343">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7124379">,</span>&nbsp;<span class="ident" id="7124381">f</span><span class="op" id="7124382">.</span><span class="ident" id="7124383">Name</span><span class="op" id="7124387">(</span><span class="op" id="7124388">)</span><span class="op" id="7124389">,</span>&nbsp;<span class="ident" id="7124391">offs2</span><span class="op" id="7124396">,</span>&nbsp;<span class="ident" id="7124398">offs</span><span class="op" id="7124402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124410">line</span><span class="op" id="7124414">,</span>&nbsp;<span class="ident" id="7124416">col</span>&nbsp;<span class="op" id="7124420">:=</span>&nbsp;<span class="ident" id="7124423">linecol</span><span class="op" id="7124430">(</span><span class="ident" id="7124431">lines</span><span class="op" id="7124436">,</span>&nbsp;<span class="ident" id="7124438">offs</span><span class="op" id="7124442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124446">msg</span>&nbsp;<span class="op" id="7124450">:=</span>&nbsp;<span class="ident" id="7124453">fmt</span><span class="op" id="7124456">.</span><span class="ident" id="7124457">Sprintf</span><span class="op" id="7124464">(</span><span class="string" id="7124465">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7124489">,</span>&nbsp;<span class="ident" id="7124491">f</span><span class="op" id="7124492">.</span><span class="ident" id="7124493">Name</span><span class="op" id="7124497">(</span><span class="op" id="7124498">)</span><span class="op" id="7124499">,</span>&nbsp;<span class="ident" id="7124501">offs</span><span class="op" id="7124505">,</span>&nbsp;<span class="ident" id="7124507">p</span><span class="op" id="7124508">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124512">checkPos</span><span class="op" id="7124520">(</span><span class="ident" id="7124521">t</span><span class="op" id="7124522">,</span>&nbsp;<span class="ident" id="7124524">msg</span><span class="op" id="7124527">,</span>&nbsp;<span class="ident" id="7124529">f</span><span class="op" id="7124530">.</span><span class="ident" id="7124531">Position</span><span class="op" id="7124539">(</span><span class="ident" id="7124540">f</span><span class="op" id="7124541">.</span><span class="ident" id="7124542">Pos</span><span class="op" id="7124545">(</span><span class="ident" id="7124546">offs</span><span class="op" id="7124550">)</span><span class="op" id="7124551">)</span><span class="op" id="7124552">,</span>&nbsp;<span class="ident" id="7124554">Position</span><span class="op" id="7124562">{</span><span class="ident" id="7124563">f</span><span class="op" id="7124564">.</span><span class="ident" id="7124565">Name</span><span class="op" id="7124569">(</span><span class="op" id="7124570">)</span><span class="op" id="7124571">,</span>&nbsp;<span class="ident" id="7124573">offs</span><span class="op" id="7124577">,</span>&nbsp;<span class="ident" id="7124579">line</span><span class="op" id="7124583">,</span>&nbsp;<span class="ident" id="7124585">col</span><span class="op" id="7124588">}</span><span class="op" id="7124589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124593">checkPos</span><span class="op" id="7124601">(</span><span class="ident" id="7124602">t</span><span class="op" id="7124603">,</span>&nbsp;<span class="ident" id="7124605">msg</span><span class="op" id="7124608">,</span>&nbsp;<span class="ident" id="7124610">fset</span><span class="op" id="7124614">.</span><span class="ident" id="7124615">Position</span><span class="op" id="7124623">(</span><span class="ident" id="7124624">p</span><span class="op" id="7124625">)</span><span class="op" id="7124626">,</span>&nbsp;<span class="ident" id="7124628">Position</span><span class="op" id="7124636">{</span><span class="ident" id="7124637">f</span><span class="op" id="7124638">.</span><span class="ident" id="7124639">Name</span><span class="op" id="7124643">(</span><span class="op" id="7124644">)</span><span class="op" id="7124645">,</span>&nbsp;<span class="ident" id="7124647">offs</span><span class="op" id="7124651">,</span>&nbsp;<span class="ident" id="7124653">line</span><span class="op" id="7124657">,</span>&nbsp;<span class="ident" id="7124659">col</span><span class="op" id="7124662">}</span><span class="op" id="7124663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124666">}</span><br>
<span class="lineno"></span><span class="op" id="7124668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7124671">func</span>&nbsp;<span class="ident" id="7124676">makeTestSource</span><span class="op" id="7124690">(</span><span class="ident" id="7124691">size</span>&nbsp;<span class="builtintype" id="7124696">int</span><span class="op" id="7124699">,</span>&nbsp;<span class="ident" id="7124701">lines</span>&nbsp;<span class="op" id="7124707">[</span><span class="op" id="7124708">]</span><span class="builtintype" id="7124709">int</span><span class="op" id="7124712">)</span>&nbsp;<span class="op" id="7124714">[</span><span class="op" id="7124715">]</span><span class="builtintype" id="7124716">byte</span>&nbsp;<span class="op" id="7124721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124724">src</span>&nbsp;<span class="op" id="7124728">:=</span>&nbsp;<span class="builtinfunc" id="7124731">make</span><span class="op" id="7124735">(</span><span class="op" id="7124736">[</span><span class="op" id="7124737">]</span><span class="builtintype" id="7124738">byte</span><span class="op" id="7124742">,</span>&nbsp;<span class="ident" id="7124744">size</span><span class="op" id="7124748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124751">for</span>&nbsp;<span class="ident" id="7124755">_</span><span class="op" id="7124756">,</span>&nbsp;<span class="ident" id="7124758">offs</span>&nbsp;<span class="op" id="7124763">:=</span>&nbsp;<span class="keyword" id="7124766">range</span>&nbsp;<span class="ident" id="7124772">lines</span>&nbsp;<span class="op" id="7124778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124782">if</span>&nbsp;<span class="ident" id="7124785">offs</span>&nbsp;<span class="op" id="7124790">&gt;</span>&nbsp;<span class="num" id="7124792">0</span>&nbsp;<span class="op" id="7124794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124799">src</span><span class="op" id="7124802">[</span><span class="ident" id="7124803">offs</span><span class="op" id="7124807">-</span><span class="num" id="7124808">1</span><span class="op" id="7124809">]</span>&nbsp;<span class="op" id="7124811">=</span>&nbsp;<span class="string" id="7124813">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7124823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124826">return</span>&nbsp;<span class="ident" id="7124833">src</span><br>
<span class="lineno"></span><span class="op" id="7124837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7124840">func</span>&nbsp;<span class="ident" id="7124845">TestPositions</span><span class="op" id="7124858">(</span><span class="ident" id="7124859">t</span>&nbsp;<span class="op" id="7124861">*</span><span class="ident" id="7124862">testing</span><span class="op" id="7124869">.</span><span class="ident" id="7124870">T</span><span class="op" id="7124871">)</span>&nbsp;<span class="op" id="7124873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124876">const</span>&nbsp;<span class="ident" id="7124882">delta</span>&nbsp;<span class="op" id="7124888">=</span>&nbsp;<span class="num" id="7124890">7</span>&nbsp;<span class="comment" id="7124892">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7124929">fset</span>&nbsp;<span class="op" id="7124934">:=</span>&nbsp;<span class="ident" id="7124937">NewFileSet</span><span class="op" id="7124947">(</span><span class="op" id="7124948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7124951">for</span>&nbsp;<span class="ident" id="7124955">_</span><span class="op" id="7124956">,</span>&nbsp;<span class="ident" id="7124958">test</span>&nbsp;<span class="op" id="7124963">:=</span>&nbsp;<span class="keyword" id="7124966">range</span>&nbsp;<span class="ident" id="7124972">tests</span>&nbsp;<span class="op" id="7124978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7124982">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125019">if</span>&nbsp;<span class="ident" id="7125022">test</span><span class="op" id="7125026">.</span><span class="ident" id="7125027">source</span>&nbsp;<span class="op" id="7125034">!=</span>&nbsp;<span class="ident" id="7125037">nil</span>&nbsp;<span class="op" id="7125041">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7125044">len</span><span class="op" id="7125047">(</span><span class="ident" id="7125048">test</span><span class="op" id="7125052">.</span><span class="ident" id="7125053">source</span><span class="op" id="7125059">)</span>&nbsp;<span class="op" id="7125061">!=</span>&nbsp;<span class="ident" id="7125064">test</span><span class="op" id="7125068">.</span><span class="ident" id="7125069">size</span>&nbsp;<span class="op" id="7125074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125079">t</span><span class="op" id="7125080">.</span><span class="ident" id="7125081">Errorf</span><span class="op" id="7125087">(</span><span class="string" id="7125088">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7125143">,</span>&nbsp;<span class="ident" id="7125145">test</span><span class="op" id="7125149">.</span><span class="ident" id="7125150">filename</span><span class="op" id="7125158">,</span>&nbsp;<span class="builtinfunc" id="7125160">len</span><span class="op" id="7125163">(</span><span class="ident" id="7125164">test</span><span class="op" id="7125168">.</span><span class="ident" id="7125169">source</span><span class="op" id="7125175">)</span><span class="op" id="7125176">,</span>&nbsp;<span class="ident" id="7125178">test</span><span class="op" id="7125182">.</span><span class="ident" id="7125183">size</span><span class="op" id="7125187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7125196">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125235">f</span>&nbsp;<span class="op" id="7125237">:=</span>&nbsp;<span class="ident" id="7125240">fset</span><span class="op" id="7125244">.</span><span class="ident" id="7125245">AddFile</span><span class="op" id="7125252">(</span><span class="ident" id="7125253">test</span><span class="op" id="7125257">.</span><span class="ident" id="7125258">filename</span><span class="op" id="7125266">,</span>&nbsp;<span class="ident" id="7125268">fset</span><span class="op" id="7125272">.</span><span class="ident" id="7125273">Base</span><span class="op" id="7125277">(</span><span class="op" id="7125278">)</span><span class="op" id="7125279">+</span><span class="ident" id="7125280">delta</span><span class="op" id="7125285">,</span>&nbsp;<span class="ident" id="7125287">test</span><span class="op" id="7125291">.</span><span class="ident" id="7125292">size</span><span class="op" id="7125296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125300">if</span>&nbsp;<span class="ident" id="7125303">f</span><span class="op" id="7125304">.</span><span class="ident" id="7125305">Name</span><span class="op" id="7125309">(</span><span class="op" id="7125310">)</span>&nbsp;<span class="op" id="7125312">!=</span>&nbsp;<span class="ident" id="7125315">test</span><span class="op" id="7125319">.</span><span class="ident" id="7125320">filename</span>&nbsp;<span class="op" id="7125329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125334">t</span><span class="op" id="7125335">.</span><span class="ident" id="7125336">Errorf</span><span class="op" id="7125342">(</span><span class="string" id="7125343">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7125369">,</span>&nbsp;<span class="ident" id="7125371">f</span><span class="op" id="7125372">.</span><span class="ident" id="7125373">Name</span><span class="op" id="7125377">(</span><span class="op" id="7125378">)</span><span class="op" id="7125379">,</span>&nbsp;<span class="ident" id="7125381">test</span><span class="op" id="7125385">.</span><span class="ident" id="7125386">filename</span><span class="op" id="7125394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125402">if</span>&nbsp;<span class="ident" id="7125405">f</span><span class="op" id="7125406">.</span><span class="ident" id="7125407">Size</span><span class="op" id="7125411">(</span><span class="op" id="7125412">)</span>&nbsp;<span class="op" id="7125414">!=</span>&nbsp;<span class="ident" id="7125417">test</span><span class="op" id="7125421">.</span><span class="ident" id="7125422">size</span>&nbsp;<span class="op" id="7125427">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125432">t</span><span class="op" id="7125433">.</span><span class="ident" id="7125434">Errorf</span><span class="op" id="7125440">(</span><span class="string" id="7125441">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7125472">,</span>&nbsp;<span class="ident" id="7125474">f</span><span class="op" id="7125475">.</span><span class="ident" id="7125476">Name</span><span class="op" id="7125480">(</span><span class="op" id="7125481">)</span><span class="op" id="7125482">,</span>&nbsp;<span class="ident" id="7125484">f</span><span class="op" id="7125485">.</span><span class="ident" id="7125486">Size</span><span class="op" id="7125490">(</span><span class="op" id="7125491">)</span><span class="op" id="7125492">,</span>&nbsp;<span class="ident" id="7125494">test</span><span class="op" id="7125498">.</span><span class="ident" id="7125499">size</span><span class="op" id="7125503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125511">if</span>&nbsp;<span class="ident" id="7125514">fset</span><span class="op" id="7125518">.</span><span class="ident" id="7125519">File</span><span class="op" id="7125523">(</span><span class="ident" id="7125524">f</span><span class="op" id="7125525">.</span><span class="ident" id="7125526">Pos</span><span class="op" id="7125529">(</span><span class="num" id="7125530">0</span><span class="op" id="7125531">)</span><span class="op" id="7125532">)</span>&nbsp;<span class="op" id="7125534">!=</span>&nbsp;<span class="ident" id="7125537">f</span>&nbsp;<span class="op" id="7125539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125544">t</span><span class="op" id="7125545">.</span><span class="ident" id="7125546">Errorf</span><span class="op" id="7125552">(</span><span class="string" id="7125553">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7125586">,</span>&nbsp;<span class="ident" id="7125588">f</span><span class="op" id="7125589">.</span><span class="ident" id="7125590">Name</span><span class="op" id="7125594">(</span><span class="op" id="7125595">)</span><span class="op" id="7125596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125600">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7125605">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125658">for</span>&nbsp;<span class="ident" id="7125662">i</span><span class="op" id="7125663">,</span>&nbsp;<span class="ident" id="7125665">offset</span>&nbsp;<span class="op" id="7125672">:=</span>&nbsp;<span class="keyword" id="7125675">range</span>&nbsp;<span class="ident" id="7125681">test</span><span class="op" id="7125685">.</span><span class="ident" id="7125686">lines</span>&nbsp;<span class="op" id="7125692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125697">f</span><span class="op" id="7125698">.</span><span class="ident" id="7125699">AddLine</span><span class="op" id="7125706">(</span><span class="ident" id="7125707">offset</span><span class="op" id="7125713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125718">if</span>&nbsp;<span class="ident" id="7125721">f</span><span class="op" id="7125722">.</span><span class="ident" id="7125723">LineCount</span><span class="op" id="7125732">(</span><span class="op" id="7125733">)</span>&nbsp;<span class="op" id="7125735">!=</span>&nbsp;<span class="ident" id="7125738">i</span><span class="op" id="7125739">+</span><span class="num" id="7125740">1</span>&nbsp;<span class="op" id="7125742">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125748">t</span><span class="op" id="7125749">.</span><span class="ident" id="7125750">Errorf</span><span class="op" id="7125756">(</span><span class="string" id="7125757">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7125798">,</span>&nbsp;<span class="ident" id="7125800">f</span><span class="op" id="7125801">.</span><span class="ident" id="7125802">Name</span><span class="op" id="7125806">(</span><span class="op" id="7125807">)</span><span class="op" id="7125808">,</span>&nbsp;<span class="ident" id="7125810">f</span><span class="op" id="7125811">.</span><span class="ident" id="7125812">LineCount</span><span class="op" id="7125821">(</span><span class="op" id="7125822">)</span><span class="op" id="7125823">,</span>&nbsp;<span class="ident" id="7125825">i</span><span class="op" id="7125826">+</span><span class="num" id="7125827">1</span><span class="op" id="7125828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7125833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7125838">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125891">f</span><span class="op" id="7125892">.</span><span class="ident" id="7125893">AddLine</span><span class="op" id="7125900">(</span><span class="ident" id="7125901">offset</span><span class="op" id="7125907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7125912">if</span>&nbsp;<span class="ident" id="7125915">f</span><span class="op" id="7125916">.</span><span class="ident" id="7125917">LineCount</span><span class="op" id="7125926">(</span><span class="op" id="7125927">)</span>&nbsp;<span class="op" id="7125929">!=</span>&nbsp;<span class="ident" id="7125932">i</span><span class="op" id="7125933">+</span><span class="num" id="7125934">1</span>&nbsp;<span class="op" id="7125936">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7125942">t</span><span class="op" id="7125943">.</span><span class="ident" id="7125944">Errorf</span><span class="op" id="7125950">(</span><span class="string" id="7125951">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7126002">,</span>&nbsp;<span class="ident" id="7126004">f</span><span class="op" id="7126005">.</span><span class="ident" id="7126006">Name</span><span class="op" id="7126010">(</span><span class="op" id="7126011">)</span><span class="op" id="7126012">,</span>&nbsp;<span class="ident" id="7126014">f</span><span class="op" id="7126015">.</span><span class="ident" id="7126016">LineCount</span><span class="op" id="7126025">(</span><span class="op" id="7126026">)</span><span class="op" id="7126027">,</span>&nbsp;<span class="ident" id="7126029">i</span><span class="op" id="7126030">+</span><span class="num" id="7126031">1</span><span class="op" id="7126032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126042">verifyPositions</span><span class="op" id="7126057">(</span><span class="ident" id="7126058">t</span><span class="op" id="7126059">,</span>&nbsp;<span class="ident" id="7126061">fset</span><span class="op" id="7126065">,</span>&nbsp;<span class="ident" id="7126067">f</span><span class="op" id="7126068">,</span>&nbsp;<span class="ident" id="7126070">test</span><span class="op" id="7126074">.</span><span class="ident" id="7126075">lines</span><span class="op" id="7126080">[</span><span class="num" id="7126081">0</span><span class="op" id="7126082">:</span><span class="ident" id="7126083">i</span><span class="op" id="7126084">+</span><span class="num" id="7126085">1</span><span class="op" id="7126086">]</span><span class="op" id="7126087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126096">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126150">if</span>&nbsp;<span class="ident" id="7126153">ok</span>&nbsp;<span class="op" id="7126156">:=</span>&nbsp;<span class="ident" id="7126159">f</span><span class="op" id="7126160">.</span><span class="ident" id="7126161">SetLines</span><span class="op" id="7126169">(</span><span class="ident" id="7126170">test</span><span class="op" id="7126174">.</span><span class="ident" id="7126175">lines</span><span class="op" id="7126180">)</span><span class="op" id="7126181">;</span>&nbsp;<span class="op" id="7126183">!</span><span class="ident" id="7126184">ok</span>&nbsp;<span class="op" id="7126187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126192">t</span><span class="op" id="7126193">.</span><span class="ident" id="7126194">Errorf</span><span class="op" id="7126200">(</span><span class="string" id="7126201">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7126222">,</span>&nbsp;<span class="ident" id="7126224">f</span><span class="op" id="7126225">.</span><span class="ident" id="7126226">Name</span><span class="op" id="7126230">(</span><span class="op" id="7126231">)</span><span class="op" id="7126232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126240">if</span>&nbsp;<span class="ident" id="7126243">f</span><span class="op" id="7126244">.</span><span class="ident" id="7126245">LineCount</span><span class="op" id="7126254">(</span><span class="op" id="7126255">)</span>&nbsp;<span class="op" id="7126257">!=</span>&nbsp;<span class="builtinfunc" id="7126260">len</span><span class="op" id="7126263">(</span><span class="ident" id="7126264">test</span><span class="op" id="7126268">.</span><span class="ident" id="7126269">lines</span><span class="op" id="7126274">)</span>&nbsp;<span class="op" id="7126276">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126281">t</span><span class="op" id="7126282">.</span><span class="ident" id="7126283">Errorf</span><span class="op" id="7126289">(</span><span class="string" id="7126290">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7126332">,</span>&nbsp;<span class="ident" id="7126334">f</span><span class="op" id="7126335">.</span><span class="ident" id="7126336">Name</span><span class="op" id="7126340">(</span><span class="op" id="7126341">)</span><span class="op" id="7126342">,</span>&nbsp;<span class="ident" id="7126344">f</span><span class="op" id="7126345">.</span><span class="ident" id="7126346">LineCount</span><span class="op" id="7126355">(</span><span class="op" id="7126356">)</span><span class="op" id="7126357">,</span>&nbsp;<span class="builtinfunc" id="7126359">len</span><span class="op" id="7126362">(</span><span class="ident" id="7126363">test</span><span class="op" id="7126367">.</span><span class="ident" id="7126368">lines</span><span class="op" id="7126373">)</span><span class="op" id="7126374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126382">verifyPositions</span><span class="op" id="7126397">(</span><span class="ident" id="7126398">t</span><span class="op" id="7126399">,</span>&nbsp;<span class="ident" id="7126401">fset</span><span class="op" id="7126405">,</span>&nbsp;<span class="ident" id="7126407">f</span><span class="op" id="7126408">,</span>&nbsp;<span class="ident" id="7126410">test</span><span class="op" id="7126414">.</span><span class="ident" id="7126415">lines</span><span class="op" id="7126420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126425">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126489">src</span>&nbsp;<span class="op" id="7126493">:=</span>&nbsp;<span class="ident" id="7126496">test</span><span class="op" id="7126500">.</span><span class="ident" id="7126501">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126510">if</span>&nbsp;<span class="ident" id="7126513">src</span>&nbsp;<span class="op" id="7126517">==</span>&nbsp;<span class="ident" id="7126520">nil</span>&nbsp;<span class="op" id="7126524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7126529">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126586">src</span>&nbsp;<span class="op" id="7126590">=</span>&nbsp;<span class="ident" id="7126592">makeTestSource</span><span class="op" id="7126606">(</span><span class="ident" id="7126607">test</span><span class="op" id="7126611">.</span><span class="ident" id="7126612">size</span><span class="op" id="7126616">,</span>&nbsp;<span class="ident" id="7126618">test</span><span class="op" id="7126622">.</span><span class="ident" id="7126623">lines</span><span class="op" id="7126628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126632">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126636">f</span><span class="op" id="7126637">.</span><span class="ident" id="7126638">SetLinesForContent</span><span class="op" id="7126656">(</span><span class="ident" id="7126657">src</span><span class="op" id="7126660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7126664">if</span>&nbsp;<span class="ident" id="7126667">f</span><span class="op" id="7126668">.</span><span class="ident" id="7126669">LineCount</span><span class="op" id="7126678">(</span><span class="op" id="7126679">)</span>&nbsp;<span class="op" id="7126681">!=</span>&nbsp;<span class="builtinfunc" id="7126684">len</span><span class="op" id="7126687">(</span><span class="ident" id="7126688">test</span><span class="op" id="7126692">.</span><span class="ident" id="7126693">lines</span><span class="op" id="7126698">)</span>&nbsp;<span class="op" id="7126700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126705">t</span><span class="op" id="7126706">.</span><span class="ident" id="7126707">Errorf</span><span class="op" id="7126713">(</span><span class="string" id="7126714">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7126766">,</span>&nbsp;<span class="ident" id="7126768">f</span><span class="op" id="7126769">.</span><span class="ident" id="7126770">Name</span><span class="op" id="7126774">(</span><span class="op" id="7126775">)</span><span class="op" id="7126776">,</span>&nbsp;<span class="ident" id="7126778">f</span><span class="op" id="7126779">.</span><span class="ident" id="7126780">LineCount</span><span class="op" id="7126789">(</span><span class="op" id="7126790">)</span><span class="op" id="7126791">,</span>&nbsp;<span class="builtinfunc" id="7126793">len</span><span class="op" id="7126796">(</span><span class="ident" id="7126797">test</span><span class="op" id="7126801">.</span><span class="ident" id="7126802">lines</span><span class="op" id="7126807">)</span><span class="op" id="7126808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126816">verifyPositions</span><span class="op" id="7126831">(</span><span class="ident" id="7126832">t</span><span class="op" id="7126833">,</span>&nbsp;<span class="ident" id="7126835">fset</span><span class="op" id="7126839">,</span>&nbsp;<span class="ident" id="7126841">f</span><span class="op" id="7126842">,</span>&nbsp;<span class="ident" id="7126844">test</span><span class="op" id="7126848">.</span><span class="ident" id="7126849">lines</span><span class="op" id="7126854">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7126857">}</span><br>
<span class="lineno"></span><span class="op" id="7126859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7126862">func</span>&nbsp;<span class="ident" id="7126867">TestLineInfo</span><span class="op" id="7126879">(</span><span class="ident" id="7126880">t</span>&nbsp;<span class="op" id="7126882">*</span><span class="ident" id="7126883">testing</span><span class="op" id="7126890">.</span><span class="ident" id="7126891">T</span><span class="op" id="7126892">)</span>&nbsp;<span class="op" id="7126894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126897">fset</span>&nbsp;<span class="op" id="7126902">:=</span>&nbsp;<span class="ident" id="7126905">NewFileSet</span><span class="op" id="7126915">(</span><span class="op" id="7126916">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126919">f</span>&nbsp;<span class="op" id="7126921">:=</span>&nbsp;<span class="ident" id="7126924">fset</span><span class="op" id="7126928">.</span><span class="ident" id="7126929">AddFile</span><span class="op" id="7126936">(</span><span class="string" id="7126937">&#34;foo&#34;</span><span class="op" id="7126942">,</span>&nbsp;<span class="ident" id="7126944">fset</span><span class="op" id="7126948">.</span><span class="ident" id="7126949">Base</span><span class="op" id="7126953">(</span><span class="op" id="7126954">)</span><span class="op" id="7126955">,</span>&nbsp;<span class="num" id="7126957">500</span><span class="op" id="7126960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7126963">lines</span>&nbsp;<span class="op" id="7126969">:=</span>&nbsp;<span class="op" id="7126972">[</span><span class="op" id="7126973">]</span><span class="builtintype" id="7126974">int</span><span class="op" id="7126977">{</span><span class="num" id="7126978">0</span><span class="op" id="7126979">,</span>&nbsp;<span class="num" id="7126981">42</span><span class="op" id="7126983">,</span>&nbsp;<span class="num" id="7126985">77</span><span class="op" id="7126987">,</span>&nbsp;<span class="num" id="7126989">100</span><span class="op" id="7126992">,</span>&nbsp;<span class="num" id="7126994">210</span><span class="op" id="7126997">,</span>&nbsp;<span class="num" id="7126999">220</span><span class="op" id="7127002">,</span>&nbsp;<span class="num" id="7127004">277</span><span class="op" id="7127007">,</span>&nbsp;<span class="num" id="7127009">300</span><span class="op" id="7127012">,</span>&nbsp;<span class="num" id="7127014">333</span><span class="op" id="7127017">,</span>&nbsp;<span class="num" id="7127019">401</span><span class="op" id="7127022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127025">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127093">for</span>&nbsp;<span class="ident" id="7127097">_</span><span class="op" id="7127098">,</span>&nbsp;<span class="ident" id="7127100">offs</span>&nbsp;<span class="op" id="7127105">:=</span>&nbsp;<span class="keyword" id="7127108">range</span>&nbsp;<span class="ident" id="7127114">lines</span>&nbsp;<span class="op" id="7127120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127124">f</span><span class="op" id="7127125">.</span><span class="ident" id="7127126">AddLine</span><span class="op" id="7127133">(</span><span class="ident" id="7127134">offs</span><span class="op" id="7127138">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127142">f</span><span class="op" id="7127143">.</span><span class="ident" id="7127144">AddLineInfo</span><span class="op" id="7127155">(</span><span class="ident" id="7127156">offs</span><span class="op" id="7127160">,</span>&nbsp;<span class="string" id="7127162">&#34;bar&#34;</span><span class="op" id="7127167">,</span>&nbsp;<span class="num" id="7127169">42</span><span class="op" id="7127171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127177">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127214">for</span>&nbsp;<span class="ident" id="7127218">offs</span>&nbsp;<span class="op" id="7127223">:=</span>&nbsp;<span class="num" id="7127226">0</span><span class="op" id="7127227">;</span>&nbsp;<span class="ident" id="7127229">offs</span>&nbsp;<span class="op" id="7127234">&lt;=</span>&nbsp;<span class="ident" id="7127237">f</span><span class="op" id="7127238">.</span><span class="ident" id="7127239">Size</span><span class="op" id="7127243">(</span><span class="op" id="7127244">)</span><span class="op" id="7127245">;</span>&nbsp;<span class="ident" id="7127247">offs</span><span class="op" id="7127251">++</span>&nbsp;<span class="op" id="7127254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127258">p</span>&nbsp;<span class="op" id="7127260">:=</span>&nbsp;<span class="ident" id="7127263">f</span><span class="op" id="7127264">.</span><span class="ident" id="7127265">Pos</span><span class="op" id="7127268">(</span><span class="ident" id="7127269">offs</span><span class="op" id="7127273">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127277">_</span><span class="op" id="7127278">,</span>&nbsp;<span class="ident" id="7127280">col</span>&nbsp;<span class="op" id="7127284">:=</span>&nbsp;<span class="ident" id="7127287">linecol</span><span class="op" id="7127294">(</span><span class="ident" id="7127295">lines</span><span class="op" id="7127300">,</span>&nbsp;<span class="ident" id="7127302">offs</span><span class="op" id="7127306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127310">msg</span>&nbsp;<span class="op" id="7127314">:=</span>&nbsp;<span class="ident" id="7127317">fmt</span><span class="op" id="7127320">.</span><span class="ident" id="7127321">Sprintf</span><span class="op" id="7127328">(</span><span class="string" id="7127329">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7127353">,</span>&nbsp;<span class="ident" id="7127355">f</span><span class="op" id="7127356">.</span><span class="ident" id="7127357">Name</span><span class="op" id="7127361">(</span><span class="op" id="7127362">)</span><span class="op" id="7127363">,</span>&nbsp;<span class="ident" id="7127365">offs</span><span class="op" id="7127369">,</span>&nbsp;<span class="ident" id="7127371">p</span><span class="op" id="7127372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127376">checkPos</span><span class="op" id="7127384">(</span><span class="ident" id="7127385">t</span><span class="op" id="7127386">,</span>&nbsp;<span class="ident" id="7127388">msg</span><span class="op" id="7127391">,</span>&nbsp;<span class="ident" id="7127393">f</span><span class="op" id="7127394">.</span><span class="ident" id="7127395">Position</span><span class="op" id="7127403">(</span><span class="ident" id="7127404">f</span><span class="op" id="7127405">.</span><span class="ident" id="7127406">Pos</span><span class="op" id="7127409">(</span><span class="ident" id="7127410">offs</span><span class="op" id="7127414">)</span><span class="op" id="7127415">)</span><span class="op" id="7127416">,</span>&nbsp;<span class="ident" id="7127418">Position</span><span class="op" id="7127426">{</span><span class="string" id="7127427">&#34;bar&#34;</span><span class="op" id="7127432">,</span>&nbsp;<span class="ident" id="7127434">offs</span><span class="op" id="7127438">,</span>&nbsp;<span class="num" id="7127440">42</span><span class="op" id="7127442">,</span>&nbsp;<span class="ident" id="7127444">col</span><span class="op" id="7127447">}</span><span class="op" id="7127448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127452">checkPos</span><span class="op" id="7127460">(</span><span class="ident" id="7127461">t</span><span class="op" id="7127462">,</span>&nbsp;<span class="ident" id="7127464">msg</span><span class="op" id="7127467">,</span>&nbsp;<span class="ident" id="7127469">fset</span><span class="op" id="7127473">.</span><span class="ident" id="7127474">Position</span><span class="op" id="7127482">(</span><span class="ident" id="7127483">p</span><span class="op" id="7127484">)</span><span class="op" id="7127485">,</span>&nbsp;<span class="ident" id="7127487">Position</span><span class="op" id="7127495">{</span><span class="string" id="7127496">&#34;bar&#34;</span><span class="op" id="7127501">,</span>&nbsp;<span class="ident" id="7127503">offs</span><span class="op" id="7127507">,</span>&nbsp;<span class="num" id="7127509">42</span><span class="op" id="7127511">,</span>&nbsp;<span class="ident" id="7127513">col</span><span class="op" id="7127516">}</span><span class="op" id="7127517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127520">}</span><br>
<span class="lineno">165</span><span class="op" id="7127522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7127525">func</span>&nbsp;<span class="ident" id="7127530">TestFiles</span><span class="op" id="7127539">(</span><span class="ident" id="7127540">t</span>&nbsp;<span class="op" id="7127542">*</span><span class="ident" id="7127543">testing</span><span class="op" id="7127550">.</span><span class="ident" id="7127551">T</span><span class="op" id="7127552">)</span>&nbsp;<span class="op" id="7127554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127557">fset</span>&nbsp;<span class="op" id="7127562">:=</span>&nbsp;<span class="ident" id="7127565">NewFileSet</span><span class="op" id="7127575">(</span><span class="op" id="7127576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127579">for</span>&nbsp;<span class="ident" id="7127583">i</span><span class="op" id="7127584">,</span>&nbsp;<span class="ident" id="7127586">test</span>&nbsp;<span class="op" id="7127591">:=</span>&nbsp;<span class="keyword" id="7127594">range</span>&nbsp;<span class="ident" id="7127600">tests</span>&nbsp;<span class="op" id="7127606">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127610">base</span>&nbsp;<span class="op" id="7127615">:=</span>&nbsp;<span class="ident" id="7127618">fset</span><span class="op" id="7127622">.</span><span class="ident" id="7127623">Base</span><span class="op" id="7127627">(</span><span class="op" id="7127628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127632">if</span>&nbsp;<span class="ident" id="7127635">i</span><span class="op" id="7127636">%</span><span class="num" id="7127637">2</span>&nbsp;<span class="op" id="7127639">==</span>&nbsp;<span class="num" id="7127642">1</span>&nbsp;<span class="op" id="7127644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127649">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7127696">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127737">base</span>&nbsp;<span class="op" id="7127742">=</span>&nbsp;<span class="op" id="7127744">-</span><span class="num" id="7127745">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127753">fset</span><span class="op" id="7127757">.</span><span class="ident" id="7127758">AddFile</span><span class="op" id="7127765">(</span><span class="ident" id="7127766">test</span><span class="op" id="7127770">.</span><span class="ident" id="7127771">filename</span><span class="op" id="7127779">,</span>&nbsp;<span class="ident" id="7127781">base</span><span class="op" id="7127785">,</span>&nbsp;<span class="ident" id="7127787">test</span><span class="op" id="7127791">.</span><span class="ident" id="7127792">size</span><span class="op" id="7127796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127800">j</span>&nbsp;<span class="op" id="7127802">:=</span>&nbsp;<span class="num" id="7127805">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127809">fset</span><span class="op" id="7127813">.</span><span class="ident" id="7127814">Iterate</span><span class="op" id="7127821">(</span><span class="keyword" id="7127822">func</span><span class="op" id="7127826">(</span><span class="ident" id="7127827">f</span>&nbsp;<span class="op" id="7127829">*</span><span class="ident" id="7127830">File</span><span class="op" id="7127834">)</span>&nbsp;<span class="builtintype" id="7127836">bool</span>&nbsp;<span class="op" id="7127841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127846">if</span>&nbsp;<span class="ident" id="7127849">f</span><span class="op" id="7127850">.</span><span class="ident" id="7127851">Name</span><span class="op" id="7127855">(</span><span class="op" id="7127856">)</span>&nbsp;<span class="op" id="7127858">!=</span>&nbsp;<span class="ident" id="7127861">tests</span><span class="op" id="7127866">[</span><span class="ident" id="7127867">j</span><span class="op" id="7127868">]</span><span class="op" id="7127869">.</span><span class="ident" id="7127870">filename</span>&nbsp;<span class="op" id="7127879">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127885">t</span><span class="op" id="7127886">.</span><span class="ident" id="7127887">Errorf</span><span class="op" id="7127893">(</span><span class="string" id="7127894">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7127922">,</span>&nbsp;<span class="ident" id="7127924">f</span><span class="op" id="7127925">.</span><span class="ident" id="7127926">Name</span><span class="op" id="7127930">(</span><span class="op" id="7127931">)</span><span class="op" id="7127932">,</span>&nbsp;<span class="ident" id="7127934">tests</span><span class="op" id="7127939">[</span><span class="ident" id="7127940">j</span><span class="op" id="7127941">]</span><span class="op" id="7127942">.</span><span class="ident" id="7127943">filename</span><span class="op" id="7127951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7127961">j</span><span class="op" id="7127962">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127968">return</span>&nbsp;<span class="ident" id="7127975">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7127982">}</span><span class="op" id="7127983">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7127987">if</span>&nbsp;<span class="ident" id="7127990">j</span>&nbsp;<span class="op" id="7127992">!=</span>&nbsp;<span class="ident" id="7127995">i</span><span class="op" id="7127996">+</span><span class="num" id="7127997">1</span>&nbsp;<span class="op" id="7127999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128004">t</span><span class="op" id="7128005">.</span><span class="ident" id="7128006">Errorf</span><span class="op" id="7128012">(</span><span class="string" id="7128013">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7128036">,</span>&nbsp;<span class="ident" id="7128038">j</span><span class="op" id="7128039">,</span>&nbsp;<span class="ident" id="7128041">i</span><span class="op" id="7128042">+</span><span class="num" id="7128043">1</span><span class="op" id="7128044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128051">}</span><br>
<span class="lineno"></span><span class="op" id="7128053">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7128056">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7128129">func</span>&nbsp;<span class="ident" id="7128134">TestFileSetPastEnd</span><span class="op" id="7128152">(</span><span class="ident" id="7128153">t</span>&nbsp;<span class="op" id="7128155">*</span><span class="ident" id="7128156">testing</span><span class="op" id="7128163">.</span><span class="ident" id="7128164">T</span><span class="op" id="7128165">)</span>&nbsp;<span class="op" id="7128167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128170">fset</span>&nbsp;<span class="op" id="7128175">:=</span>&nbsp;<span class="ident" id="7128178">NewFileSet</span><span class="op" id="7128188">(</span><span class="op" id="7128189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128192">for</span>&nbsp;<span class="ident" id="7128196">_</span><span class="op" id="7128197">,</span>&nbsp;<span class="ident" id="7128199">test</span>&nbsp;<span class="op" id="7128204">:=</span>&nbsp;<span class="keyword" id="7128207">range</span>&nbsp;<span class="ident" id="7128213">tests</span>&nbsp;<span class="op" id="7128219">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128223">fset</span><span class="op" id="7128227">.</span><span class="ident" id="7128228">AddFile</span><span class="op" id="7128235">(</span><span class="ident" id="7128236">test</span><span class="op" id="7128240">.</span><span class="ident" id="7128241">filename</span><span class="op" id="7128249">,</span>&nbsp;<span class="ident" id="7128251">fset</span><span class="op" id="7128255">.</span><span class="ident" id="7128256">Base</span><span class="op" id="7128260">(</span><span class="op" id="7128261">)</span><span class="op" id="7128262">,</span>&nbsp;<span class="ident" id="7128264">test</span><span class="op" id="7128268">.</span><span class="ident" id="7128269">size</span><span class="op" id="7128273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128279">if</span>&nbsp;<span class="ident" id="7128282">f</span>&nbsp;<span class="op" id="7128284">:=</span>&nbsp;<span class="ident" id="7128287">fset</span><span class="op" id="7128291">.</span><span class="ident" id="7128292">File</span><span class="op" id="7128296">(</span><span class="ident" id="7128297">Pos</span><span class="op" id="7128300">(</span><span class="ident" id="7128301">fset</span><span class="op" id="7128305">.</span><span class="ident" id="7128306">Base</span><span class="op" id="7128310">(</span><span class="op" id="7128311">)</span><span class="op" id="7128312">)</span><span class="op" id="7128313">)</span><span class="op" id="7128314">;</span>&nbsp;<span class="ident" id="7128316">f</span>&nbsp;<span class="op" id="7128318">!=</span>&nbsp;<span class="ident" id="7128321">nil</span>&nbsp;<span class="op" id="7128325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128329">t</span><span class="op" id="7128330">.</span><span class="ident" id="7128331">Errorf</span><span class="op" id="7128337">(</span><span class="string" id="7128338">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7128356">,</span>&nbsp;<span class="ident" id="7128358">f</span><span class="op" id="7128359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128362">}</span><br>
<span class="lineno">200</span><span class="op" id="7128364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7128367">func</span>&nbsp;<span class="ident" id="7128372">TestFileSetCacheUnlikely</span><span class="op" id="7128396">(</span><span class="ident" id="7128397">t</span>&nbsp;<span class="op" id="7128399">*</span><span class="ident" id="7128400">testing</span><span class="op" id="7128407">.</span><span class="ident" id="7128408">T</span><span class="op" id="7128409">)</span>&nbsp;<span class="op" id="7128411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128414">fset</span>&nbsp;<span class="op" id="7128419">:=</span>&nbsp;<span class="ident" id="7128422">NewFileSet</span><span class="op" id="7128432">(</span><span class="op" id="7128433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128436">offsets</span>&nbsp;<span class="op" id="7128444">:=</span>&nbsp;<span class="builtinfunc" id="7128447">make</span><span class="op" id="7128451">(</span><span class="keyword" id="7128452">map</span><span class="op" id="7128455">[</span><span class="builtintype" id="7128456">string</span><span class="op" id="7128462">]</span><span class="builtintype" id="7128463">int</span><span class="op" id="7128466">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128469">for</span>&nbsp;<span class="ident" id="7128473">_</span><span class="op" id="7128474">,</span>&nbsp;<span class="ident" id="7128476">test</span>&nbsp;<span class="op" id="7128481">:=</span>&nbsp;<span class="keyword" id="7128484">range</span>&nbsp;<span class="ident" id="7128490">tests</span>&nbsp;<span class="op" id="7128496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128500">offsets</span><span class="op" id="7128507">[</span><span class="ident" id="7128508">test</span><span class="op" id="7128512">.</span><span class="ident" id="7128513">filename</span><span class="op" id="7128521">]</span>&nbsp;<span class="op" id="7128523">=</span>&nbsp;<span class="ident" id="7128525">fset</span><span class="op" id="7128529">.</span><span class="ident" id="7128530">Base</span><span class="op" id="7128534">(</span><span class="op" id="7128535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128539">fset</span><span class="op" id="7128543">.</span><span class="ident" id="7128544">AddFile</span><span class="op" id="7128551">(</span><span class="ident" id="7128552">test</span><span class="op" id="7128556">.</span><span class="ident" id="7128557">filename</span><span class="op" id="7128565">,</span>&nbsp;<span class="ident" id="7128567">fset</span><span class="op" id="7128571">.</span><span class="ident" id="7128572">Base</span><span class="op" id="7128576">(</span><span class="op" id="7128577">)</span><span class="op" id="7128578">,</span>&nbsp;<span class="ident" id="7128580">test</span><span class="op" id="7128584">.</span><span class="ident" id="7128585">size</span><span class="op" id="7128589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128595">for</span>&nbsp;<span class="ident" id="7128599">file</span><span class="op" id="7128603">,</span>&nbsp;<span class="ident" id="7128605">pos</span>&nbsp;<span class="op" id="7128609">:=</span>&nbsp;<span class="keyword" id="7128612">range</span>&nbsp;<span class="ident" id="7128618">offsets</span>&nbsp;<span class="op" id="7128626">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128630">f</span>&nbsp;<span class="op" id="7128632">:=</span>&nbsp;<span class="ident" id="7128635">fset</span><span class="op" id="7128639">.</span><span class="ident" id="7128640">File</span><span class="op" id="7128644">(</span><span class="ident" id="7128645">Pos</span><span class="op" id="7128648">(</span><span class="ident" id="7128649">pos</span><span class="op" id="7128652">)</span><span class="op" id="7128653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128657">if</span>&nbsp;<span class="ident" id="7128660">f</span><span class="op" id="7128661">.</span><span class="ident" id="7128662">Name</span><span class="op" id="7128666">(</span><span class="op" id="7128667">)</span>&nbsp;<span class="op" id="7128669">!=</span>&nbsp;<span class="ident" id="7128672">file</span>&nbsp;<span class="op" id="7128677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128682">t</span><span class="op" id="7128683">.</span><span class="ident" id="7128684">Errorf</span><span class="op" id="7128690">(</span><span class="string" id="7128691">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7128723">,</span>&nbsp;<span class="ident" id="7128725">f</span><span class="op" id="7128726">.</span><span class="ident" id="7128727">Name</span><span class="op" id="7128731">(</span><span class="op" id="7128732">)</span><span class="op" id="7128733">,</span>&nbsp;<span class="ident" id="7128735">pos</span><span class="op" id="7128738">,</span>&nbsp;<span class="ident" id="7128740">file</span><span class="op" id="7128744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7128751">}</span><br>
<span class="lineno">215</span><span class="op" id="7128753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7128756">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7128825">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7128864">func</span>&nbsp;<span class="ident" id="7128869">TestFileSetRace</span><span class="op" id="7128884">(</span><span class="ident" id="7128885">t</span>&nbsp;<span class="op" id="7128887">*</span><span class="ident" id="7128888">testing</span><span class="op" id="7128895">.</span><span class="ident" id="7128896">T</span><span class="op" id="7128897">)</span>&nbsp;<span class="op" id="7128899">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128902">fset</span>&nbsp;<span class="op" id="7128907">:=</span>&nbsp;<span class="ident" id="7128910">NewFileSet</span><span class="op" id="7128920">(</span><span class="op" id="7128921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7128924">for</span>&nbsp;<span class="ident" id="7128928">i</span>&nbsp;<span class="op" id="7128930">:=</span>&nbsp;<span class="num" id="7128933">0</span><span class="op" id="7128934">;</span>&nbsp;<span class="ident" id="7128936">i</span>&nbsp;<span class="op" id="7128938">&lt;</span>&nbsp;<span class="num" id="7128940">100</span><span class="op" id="7128943">;</span>&nbsp;<span class="ident" id="7128945">i</span><span class="op" id="7128946">++</span>&nbsp;<span class="op" id="7128949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7128953">fset</span><span class="op" id="7128957">.</span><span class="ident" id="7128958">AddFile</span><span class="op" id="7128965">(</span><span class="ident" id="7128966">fmt</span><span class="op" id="7128969">.</span><span class="ident" id="7128970">Sprintf</span><span class="op" id="7128977">(</span><span class="string" id="7128978">&#34;file-%d&#34;</span><span class="op" id="7128987">,</span>&nbsp;<span class="ident" id="7128989">i</span><span class="op" id="7128990">)</span><span class="op" id="7128991">,</span>&nbsp;<span class="ident" id="7128993">fset</span><span class="op" id="7128997">.</span><span class="ident" id="7128998">Base</span><span class="op" id="7129002">(</span><span class="op" id="7129003">)</span><span class="op" id="7129004">,</span>&nbsp;<span class="num" id="7129006">1031</span><span class="op" id="7129010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129016">max</span>&nbsp;<span class="op" id="7129020">:=</span>&nbsp;<span class="builtintype" id="7129023">int32</span><span class="op" id="7129028">(</span><span class="ident" id="7129029">fset</span><span class="op" id="7129033">.</span><span class="ident" id="7129034">Base</span><span class="op" id="7129038">(</span><span class="op" id="7129039">)</span><span class="op" id="7129040">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129043">var</span>&nbsp;<span class="ident" id="7129047">stop</span>&nbsp;<span class="ident" id="7129052">sync</span><span class="op" id="7129056">.</span><span class="ident" id="7129057">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129068">r</span>&nbsp;<span class="op" id="7129070">:=</span>&nbsp;<span class="ident" id="7129073">rand</span><span class="op" id="7129077">.</span><span class="ident" id="7129078">New</span><span class="op" id="7129081">(</span><span class="ident" id="7129082">rand</span><span class="op" id="7129086">.</span><span class="ident" id="7129087">NewSource</span><span class="op" id="7129096">(</span><span class="num" id="7129097">7</span><span class="op" id="7129098">)</span><span class="op" id="7129099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129102">for</span>&nbsp;<span class="ident" id="7129106">i</span>&nbsp;<span class="op" id="7129108">:=</span>&nbsp;<span class="num" id="7129111">0</span><span class="op" id="7129112">;</span>&nbsp;<span class="ident" id="7129114">i</span>&nbsp;<span class="op" id="7129116">&lt;</span>&nbsp;<span class="num" id="7129118">2</span><span class="op" id="7129119">;</span>&nbsp;<span class="ident" id="7129121">i</span><span class="op" id="7129122">++</span>&nbsp;<span class="op" id="7129125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129129">r</span>&nbsp;<span class="op" id="7129131">:=</span>&nbsp;<span class="ident" id="7129134">rand</span><span class="op" id="7129138">.</span><span class="ident" id="7129139">New</span><span class="op" id="7129142">(</span><span class="ident" id="7129143">rand</span><span class="op" id="7129147">.</span><span class="ident" id="7129148">NewSource</span><span class="op" id="7129157">(</span><span class="ident" id="7129158">r</span><span class="op" id="7129159">.</span><span class="ident" id="7129160">Int63</span><span class="op" id="7129165">(</span><span class="op" id="7129166">)</span><span class="op" id="7129167">)</span><span class="op" id="7129168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129172">stop</span><span class="op" id="7129176">.</span><span class="ident" id="7129177">Add</span><span class="op" id="7129180">(</span><span class="num" id="7129181">1</span><span class="op" id="7129182">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129186">go</span>&nbsp;<span class="keyword" id="7129189">func</span><span class="op" id="7129193">(</span><span class="op" id="7129194">)</span>&nbsp;<span class="op" id="7129196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129201">for</span>&nbsp;<span class="ident" id="7129205">i</span>&nbsp;<span class="op" id="7129207">:=</span>&nbsp;<span class="num" id="7129210">0</span><span class="op" id="7129211">;</span>&nbsp;<span class="ident" id="7129213">i</span>&nbsp;<span class="op" id="7129215">&lt;</span>&nbsp;<span class="num" id="7129217">1000</span><span class="op" id="7129221">;</span>&nbsp;<span class="ident" id="7129223">i</span><span class="op" id="7129224">++</span>&nbsp;<span class="op" id="7129227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129233">fset</span><span class="op" id="7129237">.</span><span class="ident" id="7129238">Position</span><span class="op" id="7129246">(</span><span class="ident" id="7129247">Pos</span><span class="op" id="7129250">(</span><span class="ident" id="7129251">r</span><span class="op" id="7129252">.</span><span class="ident" id="7129253">Int31n</span><span class="op" id="7129259">(</span><span class="ident" id="7129260">max</span><span class="op" id="7129263">)</span><span class="op" id="7129264">)</span><span class="op" id="7129265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129275">stop</span><span class="op" id="7129279">.</span><span class="ident" id="7129280">Done</span><span class="op" id="7129284">(</span><span class="op" id="7129285">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129289">}</span><span class="op" id="7129290">(</span><span class="op" id="7129291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129297">stop</span><span class="op" id="7129301">.</span><span class="ident" id="7129302">Wait</span><span class="op" id="7129306">(</span><span class="op" id="7129307">)</span><br>
<span class="lineno"></span><span class="op" id="7129309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7129312">func</span>&nbsp;<span class="ident" id="7129317">TestPositionFor</span><span class="op" id="7129332">(</span><span class="ident" id="7129333">t</span>&nbsp;<span class="op" id="7129335">*</span><span class="ident" id="7129336">testing</span><span class="op" id="7129343">.</span><span class="ident" id="7129344">T</span><span class="op" id="7129345">)</span>&nbsp;<span class="op" id="7129347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129350">src</span>&nbsp;<span class="op" id="7129354">:=</span>&nbsp;<span class="op" id="7129357">[</span><span class="op" id="7129358">]</span><span class="builtintype" id="7129359">byte</span><span class="op" id="7129363">(</span><span class="string" id="7129364">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7129413">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129417">const</span>&nbsp;<span class="ident" id="7129423">filename</span>&nbsp;<span class="op" id="7129432">=</span>&nbsp;<span class="string" id="7129434">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129441">fset</span>&nbsp;<span class="op" id="7129446">:=</span>&nbsp;<span class="ident" id="7129449">NewFileSet</span><span class="op" id="7129459">(</span><span class="op" id="7129460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129463">f</span>&nbsp;<span class="op" id="7129465">:=</span>&nbsp;<span class="ident" id="7129468">fset</span><span class="op" id="7129472">.</span><span class="ident" id="7129473">AddFile</span><span class="op" id="7129480">(</span><span class="ident" id="7129481">filename</span><span class="op" id="7129489">,</span>&nbsp;<span class="ident" id="7129491">fset</span><span class="op" id="7129495">.</span><span class="ident" id="7129496">Base</span><span class="op" id="7129500">(</span><span class="op" id="7129501">)</span><span class="op" id="7129502">,</span>&nbsp;<span class="builtinfunc" id="7129504">len</span><span class="op" id="7129507">(</span><span class="ident" id="7129508">src</span><span class="op" id="7129511">)</span><span class="op" id="7129512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129515">f</span><span class="op" id="7129516">.</span><span class="ident" id="7129517">SetLinesForContent</span><span class="op" id="7129535">(</span><span class="ident" id="7129536">src</span><span class="op" id="7129539">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7129543">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129568">for</span>&nbsp;<span class="ident" id="7129572">i</span><span class="op" id="7129573">,</span>&nbsp;<span class="ident" id="7129575">offs</span>&nbsp;<span class="op" id="7129580">:=</span>&nbsp;<span class="keyword" id="7129583">range</span>&nbsp;<span class="ident" id="7129589">f</span><span class="op" id="7129590">.</span><span class="ident" id="7129591">lines</span>&nbsp;<span class="op" id="7129597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129601">got1</span>&nbsp;<span class="op" id="7129606">:=</span>&nbsp;<span class="ident" id="7129609">f</span><span class="op" id="7129610">.</span><span class="ident" id="7129611">PositionFor</span><span class="op" id="7129622">(</span><span class="ident" id="7129623">f</span><span class="op" id="7129624">.</span><span class="ident" id="7129625">Pos</span><span class="op" id="7129628">(</span><span class="ident" id="7129629">offs</span><span class="op" id="7129633">)</span><span class="op" id="7129634">,</span>&nbsp;<span class="ident" id="7129636">false</span><span class="op" id="7129641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129645">got2</span>&nbsp;<span class="op" id="7129650">:=</span>&nbsp;<span class="ident" id="7129653">f</span><span class="op" id="7129654">.</span><span class="ident" id="7129655">PositionFor</span><span class="op" id="7129666">(</span><span class="ident" id="7129667">f</span><span class="op" id="7129668">.</span><span class="ident" id="7129669">Pos</span><span class="op" id="7129672">(</span><span class="ident" id="7129673">offs</span><span class="op" id="7129677">)</span><span class="op" id="7129678">,</span>&nbsp;<span class="ident" id="7129680">true</span><span class="op" id="7129684">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129688">got3</span>&nbsp;<span class="op" id="7129693">:=</span>&nbsp;<span class="ident" id="7129696">f</span><span class="op" id="7129697">.</span><span class="ident" id="7129698">Position</span><span class="op" id="7129706">(</span><span class="ident" id="7129707">f</span><span class="op" id="7129708">.</span><span class="ident" id="7129709">Pos</span><span class="op" id="7129712">(</span><span class="ident" id="7129713">offs</span><span class="op" id="7129717">)</span><span class="op" id="7129718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129722">want</span>&nbsp;<span class="op" id="7129727">:=</span>&nbsp;<span class="ident" id="7129730">Position</span><span class="op" id="7129738">{</span><span class="ident" id="7129739">filename</span><span class="op" id="7129747">,</span>&nbsp;<span class="ident" id="7129749">offs</span><span class="op" id="7129753">,</span>&nbsp;<span class="ident" id="7129755">i</span>&nbsp;<span class="op" id="7129757">+</span>&nbsp;<span class="num" id="7129759">1</span><span class="op" id="7129760">,</span>&nbsp;<span class="num" id="7129762">1</span><span class="op" id="7129763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129767">checkPos</span><span class="op" id="7129775">(</span><span class="ident" id="7129776">t</span><span class="op" id="7129777">,</span>&nbsp;<span class="string" id="7129779">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7129806">,</span>&nbsp;<span class="ident" id="7129808">got1</span><span class="op" id="7129812">,</span>&nbsp;<span class="ident" id="7129814">want</span><span class="op" id="7129818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129822">checkPos</span><span class="op" id="7129830">(</span><span class="ident" id="7129831">t</span><span class="op" id="7129832">,</span>&nbsp;<span class="string" id="7129834">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7129859">,</span>&nbsp;<span class="ident" id="7129861">got2</span><span class="op" id="7129865">,</span>&nbsp;<span class="ident" id="7129867">want</span><span class="op" id="7129871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129875">checkPos</span><span class="op" id="7129883">(</span><span class="ident" id="7129884">t</span><span class="op" id="7129885">,</span>&nbsp;<span class="string" id="7129887">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7129900">,</span>&nbsp;<span class="ident" id="7129902">got3</span><span class="op" id="7129906">,</span>&nbsp;<span class="ident" id="7129908">want</span><span class="op" id="7129912">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7129915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7129919">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7129964">const</span>&nbsp;<span class="ident" id="7129970">l1</span><span class="op" id="7129972">,</span>&nbsp;<span class="ident" id="7129974">l2</span>&nbsp;<span class="op" id="7129977">=</span>&nbsp;<span class="num" id="7129979">5</span><span class="op" id="7129980">,</span>&nbsp;<span class="num" id="7129982">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7129985">f</span><span class="op" id="7129986">.</span><span class="ident" id="7129987">AddLineInfo</span><span class="op" id="7129998">(</span><span class="ident" id="7129999">f</span><span class="op" id="7130000">.</span><span class="ident" id="7130001">lines</span><span class="op" id="7130006">[</span><span class="ident" id="7130007">l1</span><span class="op" id="7130009">-</span><span class="num" id="7130010">1</span><span class="op" id="7130011">]</span><span class="op" id="7130012">,</span>&nbsp;<span class="string" id="7130014">&#34;&#34;</span><span class="op" id="7130016">,</span>&nbsp;<span class="num" id="7130018">100</span><span class="op" id="7130021">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130024">f</span><span class="op" id="7130025">.</span><span class="ident" id="7130026">AddLineInfo</span><span class="op" id="7130037">(</span><span class="ident" id="7130038">f</span><span class="op" id="7130039">.</span><span class="ident" id="7130040">lines</span><span class="op" id="7130045">[</span><span class="ident" id="7130046">l2</span><span class="op" id="7130048">-</span><span class="num" id="7130049">1</span><span class="op" id="7130050">]</span><span class="op" id="7130051">,</span>&nbsp;<span class="string" id="7130053">&#34;bar&#34;</span><span class="op" id="7130058">,</span>&nbsp;<span class="num" id="7130060">3</span><span class="op" id="7130061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7130065">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130116">for</span>&nbsp;<span class="ident" id="7130120">i</span><span class="op" id="7130121">,</span>&nbsp;<span class="ident" id="7130123">offs</span>&nbsp;<span class="op" id="7130128">:=</span>&nbsp;<span class="keyword" id="7130131">range</span>&nbsp;<span class="ident" id="7130137">f</span><span class="op" id="7130138">.</span><span class="ident" id="7130139">lines</span>&nbsp;<span class="op" id="7130145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130149">got1</span>&nbsp;<span class="op" id="7130154">:=</span>&nbsp;<span class="ident" id="7130157">f</span><span class="op" id="7130158">.</span><span class="ident" id="7130159">PositionFor</span><span class="op" id="7130170">(</span><span class="ident" id="7130171">f</span><span class="op" id="7130172">.</span><span class="ident" id="7130173">Pos</span><span class="op" id="7130176">(</span><span class="ident" id="7130177">offs</span><span class="op" id="7130181">)</span><span class="op" id="7130182">,</span>&nbsp;<span class="ident" id="7130184">false</span><span class="op" id="7130189">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130193">want</span>&nbsp;<span class="op" id="7130198">:=</span>&nbsp;<span class="ident" id="7130201">Position</span><span class="op" id="7130209">{</span><span class="ident" id="7130210">filename</span><span class="op" id="7130218">,</span>&nbsp;<span class="ident" id="7130220">offs</span><span class="op" id="7130224">,</span>&nbsp;<span class="ident" id="7130226">i</span>&nbsp;<span class="op" id="7130228">+</span>&nbsp;<span class="num" id="7130230">1</span><span class="op" id="7130231">,</span>&nbsp;<span class="num" id="7130233">1</span><span class="op" id="7130234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130238">checkPos</span><span class="op" id="7130246">(</span><span class="ident" id="7130247">t</span><span class="op" id="7130248">,</span>&nbsp;<span class="string" id="7130250">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7130277">,</span>&nbsp;<span class="ident" id="7130279">got1</span><span class="op" id="7130283">,</span>&nbsp;<span class="ident" id="7130285">want</span><span class="op" id="7130289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7130296">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130343">for</span>&nbsp;<span class="ident" id="7130347">i</span><span class="op" id="7130348">,</span>&nbsp;<span class="ident" id="7130350">offs</span>&nbsp;<span class="op" id="7130355">:=</span>&nbsp;<span class="keyword" id="7130358">range</span>&nbsp;<span class="ident" id="7130364">f</span><span class="op" id="7130365">.</span><span class="ident" id="7130366">lines</span>&nbsp;<span class="op" id="7130372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130376">got2</span>&nbsp;<span class="op" id="7130381">:=</span>&nbsp;<span class="ident" id="7130384">f</span><span class="op" id="7130385">.</span><span class="ident" id="7130386">PositionFor</span><span class="op" id="7130397">(</span><span class="ident" id="7130398">f</span><span class="op" id="7130399">.</span><span class="ident" id="7130400">Pos</span><span class="op" id="7130403">(</span><span class="ident" id="7130404">offs</span><span class="op" id="7130408">)</span><span class="op" id="7130409">,</span>&nbsp;<span class="ident" id="7130411">true</span><span class="op" id="7130415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130419">got3</span>&nbsp;<span class="op" id="7130424">:=</span>&nbsp;<span class="ident" id="7130427">f</span><span class="op" id="7130428">.</span><span class="ident" id="7130429">Position</span><span class="op" id="7130437">(</span><span class="ident" id="7130438">f</span><span class="op" id="7130439">.</span><span class="ident" id="7130440">Pos</span><span class="op" id="7130443">(</span><span class="ident" id="7130444">offs</span><span class="op" id="7130448">)</span><span class="op" id="7130449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130453">want</span>&nbsp;<span class="op" id="7130458">:=</span>&nbsp;<span class="ident" id="7130461">Position</span><span class="op" id="7130469">{</span><span class="ident" id="7130470">filename</span><span class="op" id="7130478">,</span>&nbsp;<span class="ident" id="7130480">offs</span><span class="op" id="7130484">,</span>&nbsp;<span class="ident" id="7130486">i</span>&nbsp;<span class="op" id="7130488">+</span>&nbsp;<span class="num" id="7130490">1</span><span class="op" id="7130491">,</span>&nbsp;<span class="num" id="7130493">1</span><span class="op" id="7130494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7130498">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130545">line</span>&nbsp;<span class="op" id="7130550">:=</span>&nbsp;<span class="ident" id="7130553">want</span><span class="op" id="7130557">.</span><span class="ident" id="7130558">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130565">if</span>&nbsp;<span class="ident" id="7130568">i</span><span class="op" id="7130569">+</span><span class="num" id="7130570">1</span>&nbsp;<span class="op" id="7130572">&gt;=</span>&nbsp;<span class="ident" id="7130575">l1</span>&nbsp;<span class="op" id="7130578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130583">want</span><span class="op" id="7130587">.</span><span class="ident" id="7130588">Filename</span>&nbsp;<span class="op" id="7130597">=</span>&nbsp;<span class="string" id="7130599">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130605">want</span><span class="op" id="7130609">.</span><span class="ident" id="7130610">Line</span>&nbsp;<span class="op" id="7130615">=</span>&nbsp;<span class="ident" id="7130617">line</span>&nbsp;<span class="op" id="7130622">-</span>&nbsp;<span class="ident" id="7130624">l1</span>&nbsp;<span class="op" id="7130627">+</span>&nbsp;<span class="num" id="7130629">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130635">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7130639">if</span>&nbsp;<span class="ident" id="7130642">i</span><span class="op" id="7130643">+</span><span class="num" id="7130644">1</span>&nbsp;<span class="op" id="7130646">&gt;=</span>&nbsp;<span class="ident" id="7130649">l2</span>&nbsp;<span class="op" id="7130652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130657">want</span><span class="op" id="7130661">.</span><span class="ident" id="7130662">Filename</span>&nbsp;<span class="op" id="7130671">=</span>&nbsp;<span class="string" id="7130673">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130682">want</span><span class="op" id="7130686">.</span><span class="ident" id="7130687">Line</span>&nbsp;<span class="op" id="7130692">=</span>&nbsp;<span class="ident" id="7130694">line</span>&nbsp;<span class="op" id="7130699">-</span>&nbsp;<span class="ident" id="7130701">l2</span>&nbsp;<span class="op" id="7130704">+</span>&nbsp;<span class="num" id="7130706">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130714">checkPos</span><span class="op" id="7130722">(</span><span class="ident" id="7130723">t</span><span class="op" id="7130724">,</span>&nbsp;<span class="string" id="7130726">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7130751">,</span>&nbsp;<span class="ident" id="7130753">got2</span><span class="op" id="7130757">,</span>&nbsp;<span class="ident" id="7130759">want</span><span class="op" id="7130763">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7130767">checkPos</span><span class="op" id="7130775">(</span><span class="ident" id="7130776">t</span><span class="op" id="7130777">,</span>&nbsp;<span class="string" id="7130779">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7130792">,</span>&nbsp;<span class="ident" id="7130794">got3</span><span class="op" id="7130798">,</span>&nbsp;<span class="ident" id="7130800">want</span><span class="op" id="7130804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7130807">}</span><br>
<span class="lineno"></span><span class="op" id="7130809">}</span>
</div>
</body>
</html>
