<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html" class="current">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1583206">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1583261">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1583315">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1583366">package</span>&nbsp;<span class="ident" id="1583374">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1583383">import</span>&nbsp;<span class="string" id="1583390">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1583400">func</span>&nbsp;<span class="ident" id="1583405">newsysmon</span><span class="op" id="1583414">(</span><span class="op" id="1583415">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1583418">func</span>&nbsp;<span class="ident" id="1583423">runtime_init</span><span class="op" id="1583435">(</span><span class="op" id="1583436">)</span><br>
<span class="lineno"></span><span class="keyword" id="1583438">func</span>&nbsp;<span class="ident" id="1583443">main_init</span><span class="op" id="1583452">(</span><span class="op" id="1583453">)</span><br>
<span class="lineno"></span><span class="keyword" id="1583455">func</span>&nbsp;<span class="ident" id="1583460">main_main</span><span class="op" id="1583469">(</span><span class="op" id="1583470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1583473">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1583496">func</span>&nbsp;<span class="ident" id="1583501">main</span><span class="op" id="1583505">(</span><span class="op" id="1583506">)</span>&nbsp;<span class="op" id="1583508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1583511">g</span>&nbsp;<span class="op" id="1583513">:=</span>&nbsp;<span class="ident" id="1583516">getg</span><span class="op" id="1583520">(</span><span class="op" id="1583521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583525">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583597">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1583640">g</span><span class="op" id="1583641">.</span><span class="ident" id="1583642">m</span><span class="op" id="1583643">.</span><span class="ident" id="1583644">g0</span><span class="op" id="1583646">.</span><span class="ident" id="1583647">racectx</span>&nbsp;<span class="op" id="1583655">=</span>&nbsp;<span class="num" id="1583657">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583661">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583717">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583771">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1583830">if</span>&nbsp;<span class="ident" id="1583833">ptrSize</span>&nbsp;<span class="op" id="1583841">==</span>&nbsp;<span class="num" id="1583844">8</span>&nbsp;<span class="op" id="1583846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1583850">maxstacksize</span>&nbsp;<span class="op" id="1583863">=</span>&nbsp;<span class="num" id="1583865">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1583877">}</span>&nbsp;<span class="keyword" id="1583879">else</span>&nbsp;<span class="op" id="1583884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1583888">maxstacksize</span>&nbsp;<span class="op" id="1583901">=</span>&nbsp;<span class="num" id="1583903">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1583914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1583918">onM</span><span class="op" id="1583921">(</span><span class="ident" id="1583922">newsysmon</span><span class="op" id="1583931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583935">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1583994">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584058">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584118">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584180">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584238">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584264">lockOSThread</span><span class="op" id="1584276">(</span><span class="op" id="1584277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584281">if</span>&nbsp;<span class="ident" id="1584284">g</span><span class="op" id="1584285">.</span><span class="ident" id="1584286">m</span>&nbsp;<span class="op" id="1584288">!=</span>&nbsp;<span class="op" id="1584291">&amp;</span><span class="ident" id="1584292">m0</span>&nbsp;<span class="op" id="1584295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584299">gothrow</span><span class="op" id="1584306">(</span><span class="string" id="1584307">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1584331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1584334">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584338">runtime_init</span><span class="op" id="1584350">(</span><span class="op" id="1584351">)</span>&nbsp;<span class="comment" id="1584353">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584379">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584452">needUnlock</span>&nbsp;<span class="op" id="1584463">:=</span>&nbsp;<span class="builtintype" id="1584466">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584472">defer</span>&nbsp;<span class="keyword" id="1584478">func</span><span class="op" id="1584482">(</span><span class="op" id="1584483">)</span>&nbsp;<span class="op" id="1584485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584489">if</span>&nbsp;<span class="ident" id="1584492">needUnlock</span>&nbsp;<span class="op" id="1584503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584508">unlockOSThread</span><span class="op" id="1584522">(</span><span class="op" id="1584523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1584527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1584530">}</span><span class="op" id="1584531">(</span><span class="op" id="1584532">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584536">memstats</span><span class="op" id="1584544">.</span><span class="ident" id="1584545">enablegc</span>&nbsp;<span class="op" id="1584554">=</span>&nbsp;<span class="builtintype" id="1584556">true</span>&nbsp;<span class="comment" id="1584561">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584610">main_init</span><span class="op" id="1584619">(</span><span class="op" id="1584620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584624">needUnlock</span>&nbsp;<span class="op" id="1584635">=</span>&nbsp;<span class="builtintype" id="1584637">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584644">unlockOSThread</span><span class="op" id="1584658">(</span><span class="op" id="1584659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584663">main_main</span><span class="op" id="1584672">(</span><span class="op" id="1584673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584676">if</span>&nbsp;<span class="ident" id="1584679">raceenabled</span>&nbsp;<span class="op" id="1584691">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584695">racefini</span><span class="op" id="1584703">(</span><span class="op" id="1584704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1584707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584711">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584762">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584818">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1584879">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584927">if</span>&nbsp;<span class="ident" id="1584930">panicking</span>&nbsp;<span class="op" id="1584940">!=</span>&nbsp;<span class="num" id="1584943">0</span>&nbsp;<span class="op" id="1584945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584949">gopark</span><span class="op" id="1584955">(</span><span class="builtintype" id="1584956">nil</span><span class="op" id="1584959">,</span>&nbsp;<span class="builtintype" id="1584961">nil</span><span class="op" id="1584964">,</span>&nbsp;<span class="string" id="1584966">&#34;panicwait&#34;</span><span class="op" id="1584977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1584980">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1584984">exit</span><span class="op" id="1584988">(</span><span class="num" id="1584989">0</span><span class="op" id="1584990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1584993">for</span>&nbsp;<span class="op" id="1584997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585001">var</span>&nbsp;<span class="ident" id="1585005">x</span>&nbsp;<span class="op" id="1585007">*</span><span class="builtintype" id="1585008">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1585016">*</span><span class="ident" id="1585017">x</span>&nbsp;<span class="op" id="1585019">=</span>&nbsp;<span class="num" id="1585021">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1585024">}</span><br>
<span class="lineno"></span><span class="op" id="1585026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1585029">var</span>&nbsp;<span class="ident" id="1585033">parkunlock_c</span>&nbsp;<span class="builtintype" id="1585046">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1585052">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1585086">func</span>&nbsp;<span class="ident" id="1585091">init</span><span class="op" id="1585095">(</span><span class="op" id="1585096">)</span>&nbsp;<span class="op" id="1585098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585101">go</span>&nbsp;<span class="ident" id="1585104">forcegchelper</span><span class="op" id="1585117">(</span><span class="op" id="1585118">)</span><br>
<span class="lineno"></span><span class="op" id="1585120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1585123">func</span>&nbsp;<span class="ident" id="1585128">forcegchelper</span><span class="op" id="1585141">(</span><span class="op" id="1585142">)</span>&nbsp;<span class="op" id="1585144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585147">forcegc</span><span class="op" id="1585154">.</span><span class="ident" id="1585155">g</span>&nbsp;<span class="op" id="1585157">=</span>&nbsp;<span class="ident" id="1585159">getg</span><span class="op" id="1585163">(</span><span class="op" id="1585164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585167">forcegc</span><span class="op" id="1585174">.</span><span class="ident" id="1585175">g</span><span class="op" id="1585176">.</span><span class="ident" id="1585177">issystem</span>&nbsp;<span class="op" id="1585186">=</span>&nbsp;<span class="builtintype" id="1585188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585194">for</span>&nbsp;<span class="op" id="1585198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585202">lock</span><span class="op" id="1585206">(</span><span class="op" id="1585207">&amp;</span><span class="ident" id="1585208">forcegc</span><span class="op" id="1585215">.</span><span class="ident" id="1585216">lock</span><span class="op" id="1585220">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585224">if</span>&nbsp;<span class="ident" id="1585227">forcegc</span><span class="op" id="1585234">.</span><span class="ident" id="1585235">idle</span>&nbsp;<span class="op" id="1585240">!=</span>&nbsp;<span class="num" id="1585243">0</span>&nbsp;<span class="op" id="1585245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585250">gothrow</span><span class="op" id="1585257">(</span><span class="string" id="1585258">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1585280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1585284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585288">atomicstore</span><span class="op" id="1585299">(</span><span class="op" id="1585300">&amp;</span><span class="ident" id="1585301">forcegc</span><span class="op" id="1585308">.</span><span class="ident" id="1585309">idle</span><span class="op" id="1585313">,</span>&nbsp;<span class="num" id="1585315">1</span><span class="op" id="1585316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585320">goparkunlock</span><span class="op" id="1585332">(</span><span class="op" id="1585333">&amp;</span><span class="ident" id="1585334">forcegc</span><span class="op" id="1585341">.</span><span class="ident" id="1585342">lock</span><span class="op" id="1585346">,</span>&nbsp;<span class="string" id="1585348">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1585365">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1585369">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585421">if</span>&nbsp;<span class="ident" id="1585424">debug</span><span class="op" id="1585429">.</span><span class="ident" id="1585430">gctrace</span>&nbsp;<span class="op" id="1585438">&gt;</span>&nbsp;<span class="num" id="1585440">0</span>&nbsp;<span class="op" id="1585442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1585447">println</span><span class="op" id="1585454">(</span><span class="string" id="1585455">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1585466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1585470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585474">gogc</span><span class="op" id="1585478">(</span><span class="num" id="1585479">1</span><span class="op" id="1585480">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1585483">}</span><br>
<span class="lineno"></span><span class="op" id="1585485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1585488">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1585502">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1585582">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1585652">func</span>&nbsp;<span class="ident" id="1585657">Gosched</span><span class="op" id="1585664">(</span><span class="op" id="1585665">)</span>&nbsp;<span class="op" id="1585667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585670">mcall</span><span class="op" id="1585675">(</span><span class="ident" id="1585676">gosched_m</span><span class="op" id="1585685">)</span><br>
<span class="lineno"></span><span class="op" id="1585687">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1585690">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1585760">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1585815">func</span>&nbsp;<span class="ident" id="1585820">gopark</span><span class="op" id="1585826">(</span><span class="ident" id="1585827">unlockf</span>&nbsp;<span class="ident" id="1585835">unsafe</span><span class="op" id="1585841">.</span><span class="ident" id="1585842">Pointer</span><span class="op" id="1585849">,</span>&nbsp;<span class="ident" id="1585851">lock</span>&nbsp;<span class="ident" id="1585856">unsafe</span><span class="op" id="1585862">.</span><span class="ident" id="1585863">Pointer</span><span class="op" id="1585870">,</span>&nbsp;<span class="ident" id="1585872">reason</span>&nbsp;<span class="builtintype" id="1585879">string</span><span class="op" id="1585885">)</span>&nbsp;<span class="op" id="1585887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585890">mp</span>&nbsp;<span class="op" id="1585893">:=</span>&nbsp;<span class="ident" id="1585896">acquirem</span><span class="op" id="1585904">(</span><span class="op" id="1585905">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585908">gp</span>&nbsp;<span class="op" id="1585911">:=</span>&nbsp;<span class="ident" id="1585914">mp</span><span class="op" id="1585916">.</span><span class="ident" id="1585917">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1585923">status</span>&nbsp;<span class="op" id="1585930">:=</span>&nbsp;<span class="ident" id="1585933">readgstatus</span><span class="op" id="1585944">(</span><span class="ident" id="1585945">gp</span><span class="op" id="1585947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1585950">if</span>&nbsp;<span class="ident" id="1585953">status</span>&nbsp;<span class="op" id="1585960">!=</span>&nbsp;<span class="ident" id="1585963">_Grunning</span>&nbsp;<span class="op" id="1585973">&amp;&amp;</span>&nbsp;<span class="ident" id="1585976">status</span>&nbsp;<span class="op" id="1585983">!=</span>&nbsp;<span class="ident" id="1585986">_Gscanrunning</span>&nbsp;<span class="op" id="1586000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586004">gothrow</span><span class="op" id="1586011">(</span><span class="string" id="1586012">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1586034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1586037">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586040">mp</span><span class="op" id="1586042">.</span><span class="ident" id="1586043">waitlock</span>&nbsp;<span class="op" id="1586052">=</span>&nbsp;<span class="ident" id="1586054">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586060">mp</span><span class="op" id="1586062">.</span><span class="ident" id="1586063">waitunlockf</span>&nbsp;<span class="op" id="1586075">=</span>&nbsp;<span class="ident" id="1586077">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586086">gp</span><span class="op" id="1586088">.</span><span class="ident" id="1586089">waitreason</span>&nbsp;<span class="op" id="1586100">=</span>&nbsp;<span class="ident" id="1586102">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586110">releasem</span><span class="op" id="1586118">(</span><span class="ident" id="1586119">mp</span><span class="op" id="1586121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1586124">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586185">mcall</span><span class="op" id="1586190">(</span><span class="ident" id="1586191">park_m</span><span class="op" id="1586197">)</span><br>
<span class="lineno"></span><span class="op" id="1586199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1586202">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1586275">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1586343">func</span>&nbsp;<span class="ident" id="1586348">goparkunlock</span><span class="op" id="1586360">(</span><span class="ident" id="1586361">lock</span>&nbsp;<span class="op" id="1586366">*</span><span class="ident" id="1586367">mutex</span><span class="op" id="1586372">,</span>&nbsp;<span class="ident" id="1586374">reason</span>&nbsp;<span class="builtintype" id="1586381">string</span><span class="op" id="1586387">)</span>&nbsp;<span class="op" id="1586389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586392">gopark</span><span class="op" id="1586398">(</span><span class="ident" id="1586399">unsafe</span><span class="op" id="1586405">.</span><span class="ident" id="1586406">Pointer</span><span class="op" id="1586413">(</span><span class="op" id="1586414">&amp;</span><span class="ident" id="1586415">parkunlock_c</span><span class="op" id="1586427">)</span><span class="op" id="1586428">,</span>&nbsp;<span class="ident" id="1586430">unsafe</span><span class="op" id="1586436">.</span><span class="ident" id="1586437">Pointer</span><span class="op" id="1586444">(</span><span class="ident" id="1586445">lock</span><span class="op" id="1586449">)</span><span class="op" id="1586450">,</span>&nbsp;<span class="ident" id="1586452">reason</span><span class="op" id="1586458">)</span><br>
<span class="lineno"></span><span class="op" id="1586460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1586463">func</span>&nbsp;<span class="ident" id="1586468">goready</span><span class="op" id="1586475">(</span><span class="ident" id="1586476">gp</span>&nbsp;<span class="op" id="1586479">*</span><span class="ident" id="1586480">g</span><span class="op" id="1586481">)</span>&nbsp;<span class="op" id="1586483">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586486">mp</span>&nbsp;<span class="op" id="1586489">:=</span>&nbsp;<span class="ident" id="1586492">acquirem</span><span class="op" id="1586500">(</span><span class="op" id="1586501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586504">mp</span><span class="op" id="1586506">.</span><span class="ident" id="1586507">ptrarg</span><span class="op" id="1586513">[</span><span class="num" id="1586514">0</span><span class="op" id="1586515">]</span>&nbsp;<span class="op" id="1586517">=</span>&nbsp;<span class="ident" id="1586519">unsafe</span><span class="op" id="1586525">.</span><span class="ident" id="1586526">Pointer</span><span class="op" id="1586533">(</span><span class="ident" id="1586534">gp</span><span class="op" id="1586536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586539">onM</span><span class="op" id="1586542">(</span><span class="ident" id="1586543">ready_m</span><span class="op" id="1586550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586553">releasem</span><span class="op" id="1586561">(</span><span class="ident" id="1586562">mp</span><span class="op" id="1586564">)</span><br>
<span class="lineno"></span><span class="op" id="1586566">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1586569">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1586582">func</span>&nbsp;<span class="ident" id="1586587">acquireSudog</span><span class="op" id="1586599">(</span><span class="op" id="1586600">)</span>&nbsp;<span class="op" id="1586602">*</span><span class="ident" id="1586603">sudog</span>&nbsp;<span class="op" id="1586609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586612">c</span>&nbsp;<span class="op" id="1586614">:=</span>&nbsp;<span class="ident" id="1586617">gomcache</span><span class="op" id="1586625">(</span><span class="op" id="1586626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586629">s</span>&nbsp;<span class="op" id="1586631">:=</span>&nbsp;<span class="ident" id="1586634">c</span><span class="op" id="1586635">.</span><span class="ident" id="1586636">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1586648">if</span>&nbsp;<span class="ident" id="1586651">s</span>&nbsp;<span class="op" id="1586653">!=</span>&nbsp;<span class="builtintype" id="1586656">nil</span>&nbsp;<span class="op" id="1586660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1586664">if</span>&nbsp;<span class="ident" id="1586667">s</span><span class="op" id="1586668">.</span><span class="ident" id="1586669">elem</span>&nbsp;<span class="op" id="1586674">!=</span>&nbsp;<span class="builtintype" id="1586677">nil</span>&nbsp;<span class="op" id="1586681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586686">gothrow</span><span class="op" id="1586693">(</span><span class="string" id="1586694">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1586738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1586742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586746">c</span><span class="op" id="1586747">.</span><span class="ident" id="1586748">sudogcache</span>&nbsp;<span class="op" id="1586759">=</span>&nbsp;<span class="ident" id="1586761">s</span><span class="op" id="1586762">.</span><span class="ident" id="1586763">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1586770">s</span><span class="op" id="1586771">.</span><span class="ident" id="1586772">next</span>&nbsp;<span class="op" id="1586777">=</span>&nbsp;<span class="builtintype" id="1586779">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1586785">return</span>&nbsp;<span class="ident" id="1586792">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1586795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1586799">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1586854">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1586903">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1586964">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1587029">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1587050">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1587116">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1587180">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587238">mp</span>&nbsp;<span class="op" id="1587241">:=</span>&nbsp;<span class="ident" id="1587244">acquirem</span><span class="op" id="1587252">(</span><span class="op" id="1587253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587256">p</span>&nbsp;<span class="op" id="1587258">:=</span>&nbsp;<span class="builtinfunc" id="1587261">new</span><span class="op" id="1587264">(</span><span class="ident" id="1587265">sudog</span><span class="op" id="1587270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587273">releasem</span><span class="op" id="1587281">(</span><span class="ident" id="1587282">mp</span><span class="op" id="1587284">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587287">return</span>&nbsp;<span class="ident" id="1587294">p</span><br>
<span class="lineno"></span><span class="op" id="1587296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1587299">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1587312">func</span>&nbsp;<span class="ident" id="1587317">releaseSudog</span><span class="op" id="1587329">(</span><span class="ident" id="1587330">s</span>&nbsp;<span class="op" id="1587332">*</span><span class="ident" id="1587333">sudog</span><span class="op" id="1587338">)</span>&nbsp;<span class="op" id="1587340">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587343">if</span>&nbsp;<span class="ident" id="1587346">s</span><span class="op" id="1587347">.</span><span class="ident" id="1587348">elem</span>&nbsp;<span class="op" id="1587353">!=</span>&nbsp;<span class="builtintype" id="1587356">nil</span>&nbsp;<span class="op" id="1587360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587364">gothrow</span><span class="op" id="1587371">(</span><span class="string" id="1587372">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1587406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587412">if</span>&nbsp;<span class="ident" id="1587415">s</span><span class="op" id="1587416">.</span><span class="ident" id="1587417">selectdone</span>&nbsp;<span class="op" id="1587428">!=</span>&nbsp;<span class="builtintype" id="1587431">nil</span>&nbsp;<span class="op" id="1587435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587439">gothrow</span><span class="op" id="1587446">(</span><span class="string" id="1587447">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1587487">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587493">if</span>&nbsp;<span class="ident" id="1587496">s</span><span class="op" id="1587497">.</span><span class="ident" id="1587498">next</span>&nbsp;<span class="op" id="1587503">!=</span>&nbsp;<span class="builtintype" id="1587506">nil</span>&nbsp;<span class="op" id="1587510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587514">gothrow</span><span class="op" id="1587521">(</span><span class="string" id="1587522">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1587556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587562">if</span>&nbsp;<span class="ident" id="1587565">s</span><span class="op" id="1587566">.</span><span class="ident" id="1587567">prev</span>&nbsp;<span class="op" id="1587572">!=</span>&nbsp;<span class="builtintype" id="1587575">nil</span>&nbsp;<span class="op" id="1587579">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587583">gothrow</span><span class="op" id="1587590">(</span><span class="string" id="1587591">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1587625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587631">if</span>&nbsp;<span class="ident" id="1587634">s</span><span class="op" id="1587635">.</span><span class="ident" id="1587636">waitlink</span>&nbsp;<span class="op" id="1587645">!=</span>&nbsp;<span class="builtintype" id="1587648">nil</span>&nbsp;<span class="op" id="1587652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587656">gothrow</span><span class="op" id="1587663">(</span><span class="string" id="1587664">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1587702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587705">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587708">gp</span>&nbsp;<span class="op" id="1587711">:=</span>&nbsp;<span class="ident" id="1587714">getg</span><span class="op" id="1587718">(</span><span class="op" id="1587719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1587722">if</span>&nbsp;<span class="ident" id="1587725">gp</span><span class="op" id="1587727">.</span><span class="ident" id="1587728">param</span>&nbsp;<span class="op" id="1587734">!=</span>&nbsp;<span class="builtintype" id="1587737">nil</span>&nbsp;<span class="op" id="1587741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587745">gothrow</span><span class="op" id="1587752">(</span><span class="string" id="1587753">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1587798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1587801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587804">c</span>&nbsp;<span class="op" id="1587806">:=</span>&nbsp;<span class="ident" id="1587809">gomcache</span><span class="op" id="1587817">(</span><span class="op" id="1587818">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587821">s</span><span class="op" id="1587822">.</span><span class="ident" id="1587823">next</span>&nbsp;<span class="op" id="1587828">=</span>&nbsp;<span class="ident" id="1587830">c</span><span class="op" id="1587831">.</span><span class="ident" id="1587832">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1587844">c</span><span class="op" id="1587845">.</span><span class="ident" id="1587846">sudogcache</span>&nbsp;<span class="op" id="1587857">=</span>&nbsp;<span class="ident" id="1587859">s</span><br>
<span class="lineno"></span><span class="op" id="1587861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1587864">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1587914">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1587989">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1588002">func</span>&nbsp;<span class="ident" id="1588007">funcPC</span><span class="op" id="1588013">(</span><span class="ident" id="1588014">f</span>&nbsp;<span class="keyword" id="1588016">interface</span><span class="op" id="1588025">{</span><span class="op" id="1588026">}</span><span class="op" id="1588027">)</span>&nbsp;<span class="builtintype" id="1588029">uintptr</span>&nbsp;<span class="op" id="1588037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588040">return</span>&nbsp;<span class="op" id="1588047">*</span><span class="op" id="1588048">*</span><span class="op" id="1588049">(</span><span class="op" id="1588050">*</span><span class="op" id="1588051">*</span><span class="builtintype" id="1588052">uintptr</span><span class="op" id="1588059">)</span><span class="op" id="1588060">(</span><span class="ident" id="1588061">add</span><span class="op" id="1588064">(</span><span class="ident" id="1588065">unsafe</span><span class="op" id="1588071">.</span><span class="ident" id="1588072">Pointer</span><span class="op" id="1588079">(</span><span class="op" id="1588080">&amp;</span><span class="ident" id="1588081">f</span><span class="op" id="1588082">)</span><span class="op" id="1588083">,</span>&nbsp;<span class="ident" id="1588085">ptrSize</span><span class="op" id="1588092">)</span><span class="op" id="1588093">)</span><br>
<span class="lineno"></span><span class="op" id="1588095">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1588098">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1588122">func</span>&nbsp;<span class="ident" id="1588127">badmcall</span><span class="op" id="1588135">(</span><span class="ident" id="1588136">fn</span>&nbsp;<span class="keyword" id="1588139">func</span><span class="op" id="1588143">(</span><span class="op" id="1588144">*</span><span class="ident" id="1588145">g</span><span class="op" id="1588146">)</span><span class="op" id="1588147">)</span>&nbsp;<span class="op" id="1588149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588152">gothrow</span><span class="op" id="1588159">(</span><span class="string" id="1588160">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1588198">)</span><br>
<span class="lineno"></span><span class="op" id="1588200">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1588203">func</span>&nbsp;<span class="ident" id="1588208">badmcall2</span><span class="op" id="1588217">(</span><span class="ident" id="1588218">fn</span>&nbsp;<span class="keyword" id="1588221">func</span><span class="op" id="1588225">(</span><span class="op" id="1588226">*</span><span class="ident" id="1588227">g</span><span class="op" id="1588228">)</span><span class="op" id="1588229">)</span>&nbsp;<span class="op" id="1588231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588234">gothrow</span><span class="op" id="1588241">(</span><span class="string" id="1588242">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1588276">)</span><br>
<span class="lineno"></span><span class="op" id="1588278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1588281">func</span>&nbsp;<span class="ident" id="1588286">badreflectcall</span><span class="op" id="1588300">(</span><span class="op" id="1588301">)</span>&nbsp;<span class="op" id="1588303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1588306">panic</span><span class="op" id="1588311">(</span><span class="string" id="1588312">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1588361">)</span><br>
<span class="lineno"></span><span class="op" id="1588363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1588366">func</span>&nbsp;<span class="ident" id="1588371">lockedOSThread</span><span class="op" id="1588385">(</span><span class="op" id="1588386">)</span>&nbsp;<span class="builtintype" id="1588388">bool</span>&nbsp;<span class="op" id="1588393">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588396">gp</span>&nbsp;<span class="op" id="1588399">:=</span>&nbsp;<span class="ident" id="1588402">getg</span><span class="op" id="1588406">(</span><span class="op" id="1588407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588410">return</span>&nbsp;<span class="ident" id="1588417">gp</span><span class="op" id="1588419">.</span><span class="ident" id="1588420">lockedm</span>&nbsp;<span class="op" id="1588428">!=</span>&nbsp;<span class="builtintype" id="1588431">nil</span>&nbsp;<span class="op" id="1588435">&amp;&amp;</span>&nbsp;<span class="ident" id="1588438">gp</span><span class="op" id="1588440">.</span><span class="ident" id="1588441">m</span><span class="op" id="1588442">.</span><span class="ident" id="1588443">lockedg</span>&nbsp;<span class="op" id="1588451">!=</span>&nbsp;<span class="builtintype" id="1588454">nil</span><br>
<span class="lineno"></span><span class="op" id="1588458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1588461">func</span>&nbsp;<span class="ident" id="1588466">newP</span><span class="op" id="1588470">(</span><span class="op" id="1588471">)</span>&nbsp;<span class="op" id="1588473">*</span><span class="ident" id="1588474">p</span>&nbsp;<span class="op" id="1588476">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588479">return</span>&nbsp;<span class="builtinfunc" id="1588486">new</span><span class="op" id="1588489">(</span><span class="ident" id="1588490">p</span><span class="op" id="1588491">)</span><br>
<span class="lineno"></span><span class="op" id="1588493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1588496">func</span>&nbsp;<span class="ident" id="1588501">newM</span><span class="op" id="1588505">(</span><span class="op" id="1588506">)</span>&nbsp;<span class="op" id="1588508">*</span><span class="ident" id="1588509">m</span>&nbsp;<span class="op" id="1588511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588514">return</span>&nbsp;<span class="builtinfunc" id="1588521">new</span><span class="op" id="1588524">(</span><span class="ident" id="1588525">m</span><span class="op" id="1588526">)</span><br>
<span class="lineno">230</span><span class="op" id="1588528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1588531">func</span>&nbsp;<span class="ident" id="1588536">newG</span><span class="op" id="1588540">(</span><span class="op" id="1588541">)</span>&nbsp;<span class="op" id="1588543">*</span><span class="ident" id="1588544">g</span>&nbsp;<span class="op" id="1588546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588549">return</span>&nbsp;<span class="builtinfunc" id="1588556">new</span><span class="op" id="1588559">(</span><span class="ident" id="1588560">g</span><span class="op" id="1588561">)</span><br>
<span class="lineno"></span><span class="op" id="1588563">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1588566">func</span>&nbsp;<span class="ident" id="1588571">allgadd</span><span class="op" id="1588578">(</span><span class="ident" id="1588579">gp</span>&nbsp;<span class="op" id="1588582">*</span><span class="ident" id="1588583">g</span><span class="op" id="1588584">)</span>&nbsp;<span class="op" id="1588586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1588589">if</span>&nbsp;<span class="ident" id="1588592">readgstatus</span><span class="op" id="1588603">(</span><span class="ident" id="1588604">gp</span><span class="op" id="1588606">)</span>&nbsp;<span class="op" id="1588608">==</span>&nbsp;<span class="ident" id="1588611">_Gidle</span>&nbsp;<span class="op" id="1588618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588622">gothrow</span><span class="op" id="1588629">(</span><span class="string" id="1588630">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1588657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1588660">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588664">lock</span><span class="op" id="1588668">(</span><span class="op" id="1588669">&amp;</span><span class="ident" id="1588670">allglock</span><span class="op" id="1588678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588681">allgs</span>&nbsp;<span class="op" id="1588687">=</span>&nbsp;<span class="builtinfunc" id="1588689">append</span><span class="op" id="1588695">(</span><span class="ident" id="1588696">allgs</span><span class="op" id="1588701">,</span>&nbsp;<span class="ident" id="1588703">gp</span><span class="op" id="1588705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588708">allg</span>&nbsp;<span class="op" id="1588713">=</span>&nbsp;<span class="op" id="1588715">&amp;</span><span class="ident" id="1588716">allgs</span><span class="op" id="1588721">[</span><span class="num" id="1588722">0</span><span class="op" id="1588723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588726">allglen</span>&nbsp;<span class="op" id="1588734">=</span>&nbsp;<span class="builtintype" id="1588736">uintptr</span><span class="op" id="1588743">(</span><span class="builtinfunc" id="1588744">len</span><span class="op" id="1588747">(</span><span class="ident" id="1588748">allgs</span><span class="op" id="1588753">)</span><span class="op" id="1588754">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1588757">unlock</span><span class="op" id="1588763">(</span><span class="op" id="1588764">&amp;</span><span class="ident" id="1588765">allglock</span><span class="op" id="1588773">)</span><br>
<span class="lineno"></span><span class="op" id="1588775">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
