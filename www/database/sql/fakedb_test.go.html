<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7348295">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7348350">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7348404">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7348455">package</span>&nbsp;<span class="ident" id="7348463">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7348468">import</span>&nbsp;<span class="op" id="7348475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348478">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348501">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348511">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348518">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348524">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348531">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348539">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348550">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348561">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348569">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7348580">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7348587">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7348590">var</span>&nbsp;<span class="ident" id="7348594">_</span>&nbsp;<span class="op" id="7348596">=</span>&nbsp;<span class="ident" id="7348598"><a href="/database/sql/fakedb_test.go.html#7348524">log</a></span><span class="op" id="7348601">.</span><span class="ident" id="7348602">Printf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7348610">//&nbsp;fakeDriver&nbsp;is&nbsp;a&nbsp;fake&nbsp;database&nbsp;that&nbsp;implements&nbsp;Go&#39;s&nbsp;driver.Driver</span><br>
<span class="lineno"></span><span class="comment" id="7348678">//&nbsp;interface,&nbsp;just&nbsp;for&nbsp;testing.</span><br>
<span class="lineno">25</span><span class="comment" id="7348710">//</span><br>
<span class="lineno"></span><span class="comment" id="7348713">//&nbsp;It&nbsp;speaks&nbsp;a&nbsp;query&nbsp;language&nbsp;that&#39;s&nbsp;semantically&nbsp;similar&nbsp;to&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="7348778">//&nbsp;syntactically&nbsp;different&nbsp;and&nbsp;simpler&nbsp;than&nbsp;SQL.&nbsp;&nbsp;The&nbsp;syntax&nbsp;is&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="7348845">//&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="7348857">//</span><br>
<span class="lineno">30</span><span class="comment" id="7348860">//&nbsp;&nbsp;&nbsp;WIPE</span><br>
<span class="lineno"></span><span class="comment" id="7348870">//&nbsp;&nbsp;&nbsp;CREATE|&lt;tablename&gt;|&lt;col&gt;=&lt;type&gt;,&lt;col&gt;=&lt;type&gt;,...</span><br>
<span class="lineno"></span><span class="comment" id="7348924">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;types&nbsp;are:&nbsp;&#34;string&#34;,&nbsp;[u]int{8,16,32,64},&nbsp;&#34;bool&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7348985">//&nbsp;&nbsp;&nbsp;INSERT|&lt;tablename&gt;|col=val,col2=val2,col3=?</span><br>
<span class="lineno"></span><span class="comment" id="7349034">//&nbsp;&nbsp;&nbsp;SELECT|&lt;tablename&gt;|projectcol1,projectcol2|filtercol=?,filtercol2=?</span><br>
<span class="lineno">35</span><span class="comment" id="7349107">//</span><br>
<span class="lineno"></span><span class="comment" id="7349110">//&nbsp;When&nbsp;opening&nbsp;a&nbsp;fakeDriver&#39;s&nbsp;database,&nbsp;it&nbsp;starts&nbsp;empty&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7349175">//&nbsp;tables.&nbsp;&nbsp;All&nbsp;tables&nbsp;and&nbsp;data&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="7349234">type</span>&nbsp;<span class="ident" id="7349239">fakeDriver</span>&nbsp;<span class="keyword" id="7349250">struct</span>&nbsp;<span class="op" id="7349257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349260">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7349271"><a href="/database/sql/fakedb_test.go.html#7348561">sync</a></span><span class="op" id="7349275">.</span><span class="ident" id="7349276">Mutex</span>&nbsp;<span class="comment" id="7349282">//&nbsp;guards&nbsp;3&nbsp;following&nbsp;fields</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349312">openCount</span>&nbsp;&nbsp;<span class="builtintype" id="7349323">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7349334">//&nbsp;conn&nbsp;opens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349349">closeCount</span>&nbsp;<span class="builtintype" id="7349360">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7349371">//&nbsp;conn&nbsp;closes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349387">waitCh</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7349398">chan</span>&nbsp;<span class="keyword" id="7349403">struct</span><span class="op" id="7349409">{</span><span class="op" id="7349410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349413">waitingCh</span>&nbsp;&nbsp;<span class="keyword" id="7349424">chan</span>&nbsp;<span class="keyword" id="7349429">struct</span><span class="op" id="7349435">{</span><span class="op" id="7349436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349439">dbs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7349450">map</span><span class="op" id="7349453">[</span><span class="builtintype" id="7349454">string</span><span class="op" id="7349460">]</span><span class="op" id="7349461">*</span><span class="ident" id="7349462"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><br>
<span class="lineno">45</span><span class="op" id="7349469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7349472">type</span>&nbsp;<span class="ident" id="7349477">fakeDB</span>&nbsp;<span class="keyword" id="7349484">struct</span>&nbsp;<span class="op" id="7349491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349494">name</span>&nbsp;<span class="builtintype" id="7349499">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349508">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7349516"><a href="/database/sql/fakedb_test.go.html#7348561">sync</a></span><span class="op" id="7349520">.</span><span class="ident" id="7349521">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349528">free</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7349536">[</span><span class="op" id="7349537">]</span><span class="op" id="7349538">*</span><span class="ident" id="7349539"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349549">tables</span>&nbsp;&nbsp;<span class="keyword" id="7349557">map</span><span class="op" id="7349560">[</span><span class="builtintype" id="7349561">string</span><span class="op" id="7349567">]</span><span class="op" id="7349568">*</span><span class="ident" id="7349569"><a href="/database/sql/fakedb_test.go.html#7349597">table</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349576">badConn</span>&nbsp;<span class="builtintype" id="7349584">bool</span><br>
<span class="lineno"></span><span class="op" id="7349589">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="7349592">type</span>&nbsp;<span class="ident" id="7349597">table</span>&nbsp;<span class="keyword" id="7349603">struct</span>&nbsp;<span class="op" id="7349610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349613">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7349621"><a href="/database/sql/fakedb_test.go.html#7348561">sync</a></span><span class="op" id="7349625">.</span><span class="ident" id="7349626">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349633">colname</span>&nbsp;<span class="op" id="7349641">[</span><span class="op" id="7349642">]</span><span class="builtintype" id="7349643">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349651">coltype</span>&nbsp;<span class="op" id="7349659">[</span><span class="op" id="7349660">]</span><span class="builtintype" id="7349661">string</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349669">rows</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7349677">[</span><span class="op" id="7349678">]</span><span class="op" id="7349679">*</span><span class="ident" id="7349680"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><br>
<span class="lineno"></span><span class="op" id="7349684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7349687">func</span>&nbsp;<span class="op" id="7349692">(</span><span class="ident" id="7349693">t</span>&nbsp;<span class="op" id="7349695">*</span><span class="ident" id="7349696"><a href="/database/sql/fakedb_test.go.html#7349597">table</a></span><span class="op" id="7349701">)</span>&nbsp;<span class="ident" id="7349703">columnIndex</span><span class="op" id="7349714">(</span><span class="ident" id="7349715">name</span>&nbsp;<span class="builtintype" id="7349720">string</span><span class="op" id="7349726">)</span>&nbsp;<span class="builtintype" id="7349728">int</span>&nbsp;<span class="op" id="7349732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349735">for</span>&nbsp;<span class="ident" id="7349739">n</span><span class="op" id="7349740">,</span>&nbsp;<span class="ident" id="7349742">nname</span>&nbsp;<span class="op" id="7349748">:=</span>&nbsp;<span class="keyword" id="7349751">range</span>&nbsp;<span class="ident" id="7349757"><a href="/database/sql/fakedb_test.go.html#7349693">t</a></span><span class="op" id="7349758">.</span><span class="ident" id="7349759">colname</span>&nbsp;<span class="op" id="7349767">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349771">if</span>&nbsp;<span class="ident" id="7349774"><a href="/database/sql/fakedb_test.go.html#7349715">name</a></span>&nbsp;<span class="op" id="7349779">==</span>&nbsp;<span class="ident" id="7349782"><a href="/database/sql/fakedb_test.go.html#7349742">nname</a></span>&nbsp;<span class="op" id="7349788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349793">return</span>&nbsp;<span class="ident" id="7349800"><a href="/database/sql/fakedb_test.go.html#7349739">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7349807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7349810">return</span>&nbsp;<span class="op" id="7349817">-</span><span class="num" id="7349818">1</span><br>
<span class="lineno">70</span><span class="op" id="7349820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7349823">type</span>&nbsp;<span class="ident" id="7349828">row</span>&nbsp;<span class="keyword" id="7349832">struct</span>&nbsp;<span class="op" id="7349839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349842">cols</span>&nbsp;<span class="op" id="7349847">[</span><span class="op" id="7349848">]</span><span class="keyword" id="7349849">interface</span><span class="op" id="7349858">{</span><span class="op" id="7349859">}</span>&nbsp;<span class="comment" id="7349861">//&nbsp;must&nbsp;be&nbsp;same&nbsp;size&nbsp;as&nbsp;its&nbsp;table&nbsp;colname&nbsp;+&nbsp;coltype</span><br>
<span class="lineno"></span><span class="op" id="7349913">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7349916">func</span>&nbsp;<span class="op" id="7349921">(</span><span class="ident" id="7349922">r</span>&nbsp;<span class="op" id="7349924">*</span><span class="ident" id="7349925"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><span class="op" id="7349928">)</span>&nbsp;<span class="ident" id="7349930">clone</span><span class="op" id="7349935">(</span><span class="op" id="7349936">)</span>&nbsp;<span class="op" id="7349938">*</span><span class="ident" id="7349939"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span>&nbsp;<span class="op" id="7349943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7349946">nrow</span>&nbsp;<span class="op" id="7349951">:=</span>&nbsp;<span class="op" id="7349954">&amp;</span><span class="ident" id="7349955"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><span class="op" id="7349958">{</span><span class="ident" id="7349959">cols</span><span class="op" id="7349963">:</span>&nbsp;<span class="builtinfunc" id="7349965">make</span><span class="op" id="7349969">(</span><span class="op" id="7349970">[</span><span class="op" id="7349971">]</span><span class="keyword" id="7349972">interface</span><span class="op" id="7349981">{</span><span class="op" id="7349982">}</span><span class="op" id="7349983">,</span>&nbsp;<span class="builtinfunc" id="7349985">len</span><span class="op" id="7349988">(</span><span class="ident" id="7349989"><a href="/database/sql/fakedb_test.go.html#7349922">r</a></span><span class="op" id="7349990">.</span><span class="ident" id="7349991">cols</span><span class="op" id="7349995">)</span><span class="op" id="7349996">)</span><span class="op" id="7349997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7350000">copy</span><span class="op" id="7350004">(</span><span class="ident" id="7350005"><a href="/database/sql/fakedb_test.go.html#7349946">nrow</a></span><span class="op" id="7350009">.</span><span class="ident" id="7350010">cols</span><span class="op" id="7350014">,</span>&nbsp;<span class="ident" id="7350016"><a href="/database/sql/fakedb_test.go.html#7349922">r</a></span><span class="op" id="7350017">.</span><span class="ident" id="7350018">cols</span><span class="op" id="7350022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7350025">return</span>&nbsp;<span class="ident" id="7350032"><a href="/database/sql/fakedb_test.go.html#7349946">nrow</a></span><br>
<span class="lineno">80</span><span class="op" id="7350037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7350040">type</span>&nbsp;<span class="ident" id="7350045">fakeConn</span>&nbsp;<span class="keyword" id="7350054">struct</span>&nbsp;<span class="op" id="7350061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350064">db</span>&nbsp;<span class="op" id="7350067">*</span><span class="ident" id="7350068"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span>&nbsp;<span class="comment" id="7350075">//&nbsp;where&nbsp;to&nbsp;return&nbsp;ourselves&nbsp;to</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350109">currTx</span>&nbsp;<span class="op" id="7350116">*</span><span class="ident" id="7350117"><a href="/database/sql/fakedb_test.go.html#7350322">fakeTx</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7350126">//&nbsp;Stats&nbsp;for&nbsp;tests:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350147">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7350159"><a href="/database/sql/fakedb_test.go.html#7348561">sync</a></span><span class="op" id="7350163">.</span><span class="ident" id="7350164">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350171">stmtsMade</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7350183">int</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350188">stmtsClosed</span>&nbsp;<span class="builtintype" id="7350200">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350205">numPrepare</span>&nbsp;&nbsp;<span class="builtintype" id="7350217">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350222">bad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7350234">bool</span><br>
<span class="lineno"></span><span class="op" id="7350239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7350242">func</span>&nbsp;<span class="op" id="7350247">(</span><span class="ident" id="7350248">c</span>&nbsp;<span class="op" id="7350250">*</span><span class="ident" id="7350251"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7350259">)</span>&nbsp;<span class="ident" id="7350261">incrStat</span><span class="op" id="7350269">(</span><span class="ident" id="7350270">v</span>&nbsp;<span class="op" id="7350272">*</span><span class="builtintype" id="7350273">int</span><span class="op" id="7350276">)</span>&nbsp;<span class="op" id="7350278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350281"><a href="/database/sql/fakedb_test.go.html#7350248">c</a></span><span class="op" id="7350282">.</span><span class="ident" id="7350283">mu</span><span class="op" id="7350285">.</span><span class="ident" id="7350286">Lock</span><span class="op" id="7350290">(</span><span class="op" id="7350291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7350294">*</span><span class="ident" id="7350295"><a href="/database/sql/fakedb_test.go.html#7350270">v</a></span><span class="op" id="7350296">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350300"><a href="/database/sql/fakedb_test.go.html#7350248">c</a></span><span class="op" id="7350301">.</span><span class="ident" id="7350302">mu</span><span class="op" id="7350304">.</span><span class="ident" id="7350305">Unlock</span><span class="op" id="7350311">(</span><span class="op" id="7350312">)</span><br>
<span class="lineno"></span><span class="op" id="7350314">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="7350317">type</span>&nbsp;<span class="ident" id="7350322">fakeTx</span>&nbsp;<span class="keyword" id="7350329">struct</span>&nbsp;<span class="op" id="7350336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350339">c</span>&nbsp;<span class="op" id="7350341">*</span><span class="ident" id="7350342"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><br>
<span class="lineno"></span><span class="op" id="7350351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="7350354">type</span>&nbsp;<span class="ident" id="7350359">fakeStmt</span>&nbsp;<span class="keyword" id="7350368">struct</span>&nbsp;<span class="op" id="7350375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350378">c</span>&nbsp;<span class="op" id="7350380">*</span><span class="ident" id="7350381"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350391">q</span>&nbsp;<span class="builtintype" id="7350393">string</span>&nbsp;<span class="comment" id="7350400">//&nbsp;just&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350424">cmd</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7350430">string</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350438">table</span>&nbsp;<span class="builtintype" id="7350444">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350453">closed</span>&nbsp;<span class="builtintype" id="7350460">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350467">colName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7350480">[</span><span class="op" id="7350481">]</span><span class="builtintype" id="7350482">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7350494">//&nbsp;used&nbsp;by&nbsp;CREATE,&nbsp;INSERT,&nbsp;SELECT&nbsp;(selected&nbsp;columns)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350548">colType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7350561">[</span><span class="op" id="7350562">]</span><span class="builtintype" id="7350563">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7350575">//&nbsp;used&nbsp;by&nbsp;CREATE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350594">colValue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7350607">[</span><span class="op" id="7350608">]</span><span class="keyword" id="7350609">interface</span><span class="op" id="7350618">{</span><span class="op" id="7350619">}</span>&nbsp;<span class="comment" id="7350621">//&nbsp;used&nbsp;by&nbsp;INSERT&nbsp;(mix&nbsp;of&nbsp;strings&nbsp;and&nbsp;&#34;?&#34;&nbsp;for&nbsp;bound&nbsp;params)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350682">placeholders</span>&nbsp;<span class="builtintype" id="7350695">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7350709">//&nbsp;used&nbsp;by&nbsp;INSERT/SELECT:&nbsp;number&nbsp;of&nbsp;?&nbsp;params</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350756">whereCol</span>&nbsp;<span class="op" id="7350765">[</span><span class="op" id="7350766">]</span><span class="builtintype" id="7350767">string</span>&nbsp;<span class="comment" id="7350774">//&nbsp;used&nbsp;by&nbsp;SELECT&nbsp;(all&nbsp;placeholders)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350813">placeholderConverter</span>&nbsp;<span class="op" id="7350834">[</span><span class="op" id="7350835">]</span><span class="ident" id="7350836"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7350842">.</span><span class="ident" id="7350843">ValueConverter</span>&nbsp;<span class="comment" id="7350858">//&nbsp;used&nbsp;by&nbsp;INSERT</span><br>
<span class="lineno"></span><span class="op" id="7350876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7350879">var</span>&nbsp;<span class="ident" id="7350883">fdriver</span>&nbsp;<span class="ident" id="7350891"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7350897">.</span><span class="ident" id="7350898">Driver</span>&nbsp;<span class="op" id="7350905">=</span>&nbsp;<span class="op" id="7350907">&amp;</span><span class="ident" id="7350908"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7350918">{</span><span class="op" id="7350919">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7350922">func</span>&nbsp;<span class="ident" id="7350927">init</span><span class="op" id="7350931">(</span><span class="op" id="7350932">)</span>&nbsp;<span class="op" id="7350934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7350937"><a href="/database/sql/sql.go.html#6349367">Register</a></span><span class="op" id="7350945">(</span><span class="string" id="7350946">&#34;test&#34;</span><span class="op" id="7350952">,</span>&nbsp;<span class="ident" id="7350954"><a href="/database/sql/fakedb_test.go.html#7350883">fdriver</a></span><span class="op" id="7350961">)</span><br>
<span class="lineno"></span><span class="op" id="7350963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="7350966">func</span>&nbsp;<span class="ident" id="7350971">contains</span><span class="op" id="7350979">(</span><span class="ident" id="7350980">list</span>&nbsp;<span class="op" id="7350985">[</span><span class="op" id="7350986">]</span><span class="builtintype" id="7350987">string</span><span class="op" id="7350993">,</span>&nbsp;<span class="ident" id="7350995">y</span>&nbsp;<span class="builtintype" id="7350997">string</span><span class="op" id="7351003">)</span>&nbsp;<span class="builtintype" id="7351005">bool</span>&nbsp;<span class="op" id="7351010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351013">for</span>&nbsp;<span class="ident" id="7351017">_</span><span class="op" id="7351018">,</span>&nbsp;<span class="ident" id="7351020">x</span>&nbsp;<span class="op" id="7351022">:=</span>&nbsp;<span class="keyword" id="7351025">range</span>&nbsp;<span class="ident" id="7351031"><a href="/database/sql/fakedb_test.go.html#7350980">list</a></span>&nbsp;<span class="op" id="7351036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351040">if</span>&nbsp;<span class="ident" id="7351043"><a href="/database/sql/fakedb_test.go.html#7351020">x</a></span>&nbsp;<span class="op" id="7351045">==</span>&nbsp;<span class="ident" id="7351048"><a href="/database/sql/fakedb_test.go.html#7350995">y</a></span>&nbsp;<span class="op" id="7351050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351055">return</span>&nbsp;<span class="builtintype" id="7351062">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351069">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351075">return</span>&nbsp;<span class="builtintype" id="7351082">false</span><br>
<span class="lineno"></span><span class="op" id="7351088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7351091">type</span>&nbsp;<span class="ident" id="7351096">Dummy</span>&nbsp;<span class="keyword" id="7351102">struct</span>&nbsp;<span class="op" id="7351109">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351112"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7351118">.</span><span class="ident" id="7351119">Driver</span><br>
<span class="lineno"></span><span class="op" id="7351126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7351129">func</span>&nbsp;<span class="ident" id="7351134">TestDrivers</span><span class="op" id="7351145">(</span><span class="ident" id="7351146">t</span>&nbsp;<span class="op" id="7351148">*</span><span class="ident" id="7351149"><a href="/database/sql/fakedb_test.go.html#7348569">testing</a></span><span class="op" id="7351156">.</span><span class="ident" id="7351157">T</span><span class="op" id="7351158">)</span>&nbsp;<span class="op" id="7351160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351163"><a href="/database/sql/sql.go.html#6349602">unregisterAllDrivers</a></span><span class="op" id="7351183">(</span><span class="op" id="7351184">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351187"><a href="/database/sql/sql.go.html#6349367">Register</a></span><span class="op" id="7351195">(</span><span class="string" id="7351196">&#34;test&#34;</span><span class="op" id="7351202">,</span>&nbsp;<span class="ident" id="7351204"><a href="/database/sql/fakedb_test.go.html#7350883">fdriver</a></span><span class="op" id="7351211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351214"><a href="/database/sql/sql.go.html#6349367">Register</a></span><span class="op" id="7351222">(</span><span class="string" id="7351223">&#34;invalid&#34;</span><span class="op" id="7351232">,</span>&nbsp;<span class="ident" id="7351234"><a href="/database/sql/fakedb_test.go.html#7351096">Dummy</a></span><span class="op" id="7351239">{</span><span class="op" id="7351240">}</span><span class="op" id="7351241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351244">all</span>&nbsp;<span class="op" id="7351248">:=</span>&nbsp;<span class="ident" id="7351251"><a href="/database/sql/sql.go.html#6349765">Drivers</a></span><span class="op" id="7351258">(</span><span class="op" id="7351259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351262">if</span>&nbsp;<span class="builtinfunc" id="7351265">len</span><span class="op" id="7351268">(</span><span class="ident" id="7351269"><a href="/database/sql/fakedb_test.go.html#7351244">all</a></span><span class="op" id="7351272">)</span>&nbsp;<span class="op" id="7351274">&lt;</span>&nbsp;<span class="num" id="7351276">2</span>&nbsp;<span class="op" id="7351278">||</span>&nbsp;<span class="op" id="7351281">!</span><span class="ident" id="7351282"><a href="/database/sql/fakedb_test.go.html#7348531">sort</a></span><span class="op" id="7351286">.</span><span class="ident" id="7351287">StringsAreSorted</span><span class="op" id="7351303">(</span><span class="ident" id="7351304"><a href="/database/sql/fakedb_test.go.html#7351244">all</a></span><span class="op" id="7351307">)</span>&nbsp;<span class="op" id="7351309">||</span>&nbsp;<span class="op" id="7351312">!</span><span class="ident" id="7351313"><a href="/database/sql/fakedb_test.go.html#7350971">contains</a></span><span class="op" id="7351321">(</span><span class="ident" id="7351322"><a href="/database/sql/fakedb_test.go.html#7351244">all</a></span><span class="op" id="7351325">,</span>&nbsp;<span class="string" id="7351327">&#34;test&#34;</span><span class="op" id="7351333">)</span>&nbsp;<span class="op" id="7351335">||</span>&nbsp;<span class="op" id="7351338">!</span><span class="ident" id="7351339"><a href="/database/sql/fakedb_test.go.html#7350971">contains</a></span><span class="op" id="7351347">(</span><span class="ident" id="7351348"><a href="/database/sql/fakedb_test.go.html#7351244">all</a></span><span class="op" id="7351351">,</span>&nbsp;<span class="string" id="7351353">&#34;invalid&#34;</span><span class="op" id="7351362">)</span>&nbsp;<span class="op" id="7351364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351368"><a href="/database/sql/fakedb_test.go.html#7351146">t</a></span><span class="op" id="7351369">.</span><span class="ident" id="7351370">Fatalf</span><span class="op" id="7351376">(</span><span class="string" id="7351377">&#34;Drivers&nbsp;=&nbsp;%v,&nbsp;want&nbsp;sorted&nbsp;list&nbsp;with&nbsp;at&nbsp;least&nbsp;[invalid,&nbsp;test]&#34;</span><span class="op" id="7351439">,</span>&nbsp;<span class="ident" id="7351441"><a href="/database/sql/fakedb_test.go.html#7351244">all</a></span><span class="op" id="7351444">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351447">}</span><br>
<span class="lineno"></span><span class="op" id="7351449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7351452">//&nbsp;Supports&nbsp;dsn&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="7351475">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;</span><br>
<span class="lineno">155</span><span class="comment" id="7351490">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;dbname&gt;;&lt;opts&gt;&nbsp;&nbsp;(only&nbsp;currently&nbsp;supported&nbsp;option&nbsp;is&nbsp;`badConn`,</span><br>
<span class="lineno"></span><span class="comment" id="7351560">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;causes&nbsp;driver.ErrBadConn&nbsp;to&nbsp;be&nbsp;returned&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="7351633">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;every&nbsp;other&nbsp;conn.Begin())</span><br>
<span class="lineno"></span><span class="keyword" id="7351683">func</span>&nbsp;<span class="op" id="7351688">(</span><span class="ident" id="7351689">d</span>&nbsp;<span class="op" id="7351691">*</span><span class="ident" id="7351692"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7351702">)</span>&nbsp;<span class="ident" id="7351704">Open</span><span class="op" id="7351708">(</span><span class="ident" id="7351709">dsn</span>&nbsp;<span class="builtintype" id="7351713">string</span><span class="op" id="7351719">)</span>&nbsp;<span class="op" id="7351721">(</span><span class="ident" id="7351722"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7351728">.</span><span class="ident" id="7351729">Conn</span><span class="op" id="7351733">,</span>&nbsp;<span class="builtintype" id="7351735">error</span><span class="op" id="7351740">)</span>&nbsp;<span class="op" id="7351742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351745">parts</span>&nbsp;<span class="op" id="7351751">:=</span>&nbsp;<span class="ident" id="7351754"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7351761">.</span><span class="ident" id="7351762">Split</span><span class="op" id="7351767">(</span><span class="ident" id="7351768"><a href="/database/sql/fakedb_test.go.html#7351709">dsn</a></span><span class="op" id="7351771">,</span>&nbsp;<span class="string" id="7351773">&#34;;&#34;</span><span class="op" id="7351776">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351779">if</span>&nbsp;<span class="builtinfunc" id="7351782">len</span><span class="op" id="7351785">(</span><span class="ident" id="7351786"><a href="/database/sql/fakedb_test.go.html#7351745">parts</a></span><span class="op" id="7351791">)</span>&nbsp;<span class="op" id="7351793">&lt;</span>&nbsp;<span class="num" id="7351795">1</span>&nbsp;<span class="op" id="7351797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351801">return</span>&nbsp;<span class="ident" id="7351808">nil</span><span class="op" id="7351811">,</span>&nbsp;<span class="ident" id="7351813"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7351819">.</span><span class="ident" id="7351820">New</span><span class="op" id="7351823">(</span><span class="string" id="7351824">&#34;fakedb:&nbsp;no&nbsp;database&nbsp;name&#34;</span><span class="op" id="7351850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7351853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351856">name</span>&nbsp;<span class="op" id="7351861">:=</span>&nbsp;<span class="ident" id="7351864"><a href="/database/sql/fakedb_test.go.html#7351745">parts</a></span><span class="op" id="7351869">[</span><span class="num" id="7351870">0</span><span class="op" id="7351871">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351875">db</span>&nbsp;<span class="op" id="7351878">:=</span>&nbsp;<span class="ident" id="7351881"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7351882">.</span><span class="ident" id="7351883">getDB</span><span class="op" id="7351888">(</span><span class="ident" id="7351889"><a href="/database/sql/fakedb_test.go.html#7351856">name</a></span><span class="op" id="7351893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351897"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7351898">.</span><span class="ident" id="7351899">mu</span><span class="op" id="7351901">.</span><span class="ident" id="7351902">Lock</span><span class="op" id="7351906">(</span><span class="op" id="7351907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351910"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7351911">.</span><span class="ident" id="7351912">openCount</span><span class="op" id="7351921">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351925"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7351926">.</span><span class="ident" id="7351927">mu</span><span class="op" id="7351929">.</span><span class="ident" id="7351930">Unlock</span><span class="op" id="7351936">(</span><span class="op" id="7351937">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7351940">conn</span>&nbsp;<span class="op" id="7351945">:=</span>&nbsp;<span class="op" id="7351948">&amp;</span><span class="ident" id="7351949"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7351957">{</span><span class="ident" id="7351958">db</span><span class="op" id="7351960">:</span>&nbsp;<span class="ident" id="7351962"><a href="/database/sql/fakedb_test.go.html#7351875">db</a></span><span class="op" id="7351964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7351968">if</span>&nbsp;<span class="builtinfunc" id="7351971">len</span><span class="op" id="7351974">(</span><span class="ident" id="7351975"><a href="/database/sql/fakedb_test.go.html#7351745">parts</a></span><span class="op" id="7351980">)</span>&nbsp;<span class="op" id="7351982">&gt;=</span>&nbsp;<span class="num" id="7351985">2</span>&nbsp;<span class="op" id="7351987">&amp;&amp;</span>&nbsp;<span class="ident" id="7351990"><a href="/database/sql/fakedb_test.go.html#7351745">parts</a></span><span class="op" id="7351995">[</span><span class="num" id="7351996">1</span><span class="op" id="7351997">]</span>&nbsp;<span class="op" id="7351999">==</span>&nbsp;<span class="string" id="7352002">&#34;badConn&#34;</span>&nbsp;<span class="op" id="7352012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352016"><a href="/database/sql/fakedb_test.go.html#7351940">conn</a></span><span class="op" id="7352020">.</span><span class="ident" id="7352021">bad</span>&nbsp;<span class="op" id="7352025">=</span>&nbsp;<span class="builtintype" id="7352027">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352033">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352036">if</span>&nbsp;<span class="ident" id="7352039"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7352040">.</span><span class="ident" id="7352041">waitCh</span>&nbsp;<span class="op" id="7352048">!=</span>&nbsp;<span class="ident" id="7352051">nil</span>&nbsp;<span class="op" id="7352055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352059"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7352060">.</span><span class="ident" id="7352061">waitingCh</span>&nbsp;<span class="op" id="7352071">&lt;-</span>&nbsp;<span class="keyword" id="7352074">struct</span><span class="op" id="7352080">{</span><span class="op" id="7352081">}</span><span class="op" id="7352082">{</span><span class="op" id="7352083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352087">&lt;-</span><span class="ident" id="7352089"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7352090">.</span><span class="ident" id="7352091">waitCh</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352100"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7352101">.</span><span class="ident" id="7352102">waitCh</span>&nbsp;<span class="op" id="7352109">=</span>&nbsp;<span class="ident" id="7352111">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352117"><a href="/database/sql/fakedb_test.go.html#7351689">d</a></span><span class="op" id="7352118">.</span><span class="ident" id="7352119">waitingCh</span>&nbsp;<span class="op" id="7352129">=</span>&nbsp;<span class="ident" id="7352131">nil</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352139">return</span>&nbsp;<span class="ident" id="7352146"><a href="/database/sql/fakedb_test.go.html#7351940">conn</a></span><span class="op" id="7352150">,</span>&nbsp;<span class="ident" id="7352152">nil</span><br>
<span class="lineno"></span><span class="op" id="7352156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7352159">func</span>&nbsp;<span class="op" id="7352164">(</span><span class="ident" id="7352165">d</span>&nbsp;<span class="op" id="7352167">*</span><span class="ident" id="7352168"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7352178">)</span>&nbsp;<span class="ident" id="7352180">getDB</span><span class="op" id="7352185">(</span><span class="ident" id="7352186">name</span>&nbsp;<span class="builtintype" id="7352191">string</span><span class="op" id="7352197">)</span>&nbsp;<span class="op" id="7352199">*</span><span class="ident" id="7352200"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span>&nbsp;<span class="op" id="7352207">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352210"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352211">.</span><span class="ident" id="7352212">mu</span><span class="op" id="7352214">.</span><span class="ident" id="7352215">Lock</span><span class="op" id="7352219">(</span><span class="op" id="7352220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352223">defer</span>&nbsp;<span class="ident" id="7352229"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352230">.</span><span class="ident" id="7352231">mu</span><span class="op" id="7352233">.</span><span class="ident" id="7352234">Unlock</span><span class="op" id="7352240">(</span><span class="op" id="7352241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352244">if</span>&nbsp;<span class="ident" id="7352247"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352248">.</span><span class="ident" id="7352249">dbs</span>&nbsp;<span class="op" id="7352253">==</span>&nbsp;<span class="ident" id="7352256">nil</span>&nbsp;<span class="op" id="7352260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352264"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352265">.</span><span class="ident" id="7352266">dbs</span>&nbsp;<span class="op" id="7352270">=</span>&nbsp;<span class="builtinfunc" id="7352272">make</span><span class="op" id="7352276">(</span><span class="keyword" id="7352277">map</span><span class="op" id="7352280">[</span><span class="builtintype" id="7352281">string</span><span class="op" id="7352287">]</span><span class="op" id="7352288">*</span><span class="ident" id="7352289"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7352295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352298">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352301">db</span><span class="op" id="7352303">,</span>&nbsp;<span class="ident" id="7352305">ok</span>&nbsp;<span class="op" id="7352308">:=</span>&nbsp;<span class="ident" id="7352311"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352312">.</span><span class="ident" id="7352313">dbs</span><span class="op" id="7352316">[</span><span class="ident" id="7352317"><a href="/database/sql/fakedb_test.go.html#7352186">name</a></span><span class="op" id="7352321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352324">if</span>&nbsp;<span class="op" id="7352327">!</span><span class="ident" id="7352328"><a href="/database/sql/fakedb_test.go.html#7352305">ok</a></span>&nbsp;<span class="op" id="7352331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352335"><a href="/database/sql/fakedb_test.go.html#7352301">db</a></span>&nbsp;<span class="op" id="7352338">=</span>&nbsp;<span class="op" id="7352340">&amp;</span><span class="ident" id="7352341"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7352347">{</span><span class="ident" id="7352348">name</span><span class="op" id="7352352">:</span>&nbsp;<span class="ident" id="7352354"><a href="/database/sql/fakedb_test.go.html#7352186">name</a></span><span class="op" id="7352358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352362"><a href="/database/sql/fakedb_test.go.html#7352165">d</a></span><span class="op" id="7352363">.</span><span class="ident" id="7352364">dbs</span><span class="op" id="7352367">[</span><span class="ident" id="7352368"><a href="/database/sql/fakedb_test.go.html#7352186">name</a></span><span class="op" id="7352372">]</span>&nbsp;<span class="op" id="7352374">=</span>&nbsp;<span class="ident" id="7352376"><a href="/database/sql/fakedb_test.go.html#7352301">db</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352380">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352383">return</span>&nbsp;<span class="ident" id="7352390"><a href="/database/sql/fakedb_test.go.html#7352301">db</a></span><br>
<span class="lineno"></span><span class="op" id="7352393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7352396">func</span>&nbsp;<span class="op" id="7352401">(</span><span class="ident" id="7352402">db</span>&nbsp;<span class="op" id="7352405">*</span><span class="ident" id="7352406"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7352412">)</span>&nbsp;<span class="ident" id="7352414">wipe</span><span class="op" id="7352418">(</span><span class="op" id="7352419">)</span>&nbsp;<span class="op" id="7352421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352424"><a href="/database/sql/fakedb_test.go.html#7352402">db</a></span><span class="op" id="7352426">.</span><span class="ident" id="7352427">mu</span><span class="op" id="7352429">.</span><span class="ident" id="7352430">Lock</span><span class="op" id="7352434">(</span><span class="op" id="7352435">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352438">defer</span>&nbsp;<span class="ident" id="7352444"><a href="/database/sql/fakedb_test.go.html#7352402">db</a></span><span class="op" id="7352446">.</span><span class="ident" id="7352447">mu</span><span class="op" id="7352449">.</span><span class="ident" id="7352450">Unlock</span><span class="op" id="7352456">(</span><span class="op" id="7352457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352460"><a href="/database/sql/fakedb_test.go.html#7352402">db</a></span><span class="op" id="7352462">.</span><span class="ident" id="7352463">tables</span>&nbsp;<span class="op" id="7352470">=</span>&nbsp;<span class="ident" id="7352472">nil</span><br>
<span class="lineno"></span><span class="op" id="7352476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7352479">func</span>&nbsp;<span class="op" id="7352484">(</span><span class="ident" id="7352485">db</span>&nbsp;<span class="op" id="7352488">*</span><span class="ident" id="7352489"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7352495">)</span>&nbsp;<span class="ident" id="7352497">createTable</span><span class="op" id="7352508">(</span><span class="ident" id="7352509">name</span>&nbsp;<span class="builtintype" id="7352514">string</span><span class="op" id="7352520">,</span>&nbsp;<span class="ident" id="7352522">columnNames</span><span class="op" id="7352533">,</span>&nbsp;<span class="ident" id="7352535">columnTypes</span>&nbsp;<span class="op" id="7352547">[</span><span class="op" id="7352548">]</span><span class="builtintype" id="7352549">string</span><span class="op" id="7352555">)</span>&nbsp;<span class="builtintype" id="7352557">error</span>&nbsp;<span class="op" id="7352563">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352566"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352568">.</span><span class="ident" id="7352569">mu</span><span class="op" id="7352571">.</span><span class="ident" id="7352572">Lock</span><span class="op" id="7352576">(</span><span class="op" id="7352577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352580">defer</span>&nbsp;<span class="ident" id="7352586"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352588">.</span><span class="ident" id="7352589">mu</span><span class="op" id="7352591">.</span><span class="ident" id="7352592">Unlock</span><span class="op" id="7352598">(</span><span class="op" id="7352599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352602">if</span>&nbsp;<span class="ident" id="7352605"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352607">.</span><span class="ident" id="7352608">tables</span>&nbsp;<span class="op" id="7352615">==</span>&nbsp;<span class="ident" id="7352618">nil</span>&nbsp;<span class="op" id="7352622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352626"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352628">.</span><span class="ident" id="7352629">tables</span>&nbsp;<span class="op" id="7352636">=</span>&nbsp;<span class="builtinfunc" id="7352638">make</span><span class="op" id="7352642">(</span><span class="keyword" id="7352643">map</span><span class="op" id="7352646">[</span><span class="builtintype" id="7352647">string</span><span class="op" id="7352653">]</span><span class="op" id="7352654">*</span><span class="ident" id="7352655"><a href="/database/sql/fakedb_test.go.html#7349597">table</a></span><span class="op" id="7352660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352663">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352666">if</span>&nbsp;<span class="ident" id="7352669">_</span><span class="op" id="7352670">,</span>&nbsp;<span class="ident" id="7352672">exist</span>&nbsp;<span class="op" id="7352678">:=</span>&nbsp;<span class="ident" id="7352681"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352683">.</span><span class="ident" id="7352684">tables</span><span class="op" id="7352690">[</span><span class="ident" id="7352691"><a href="/database/sql/fakedb_test.go.html#7352509">name</a></span><span class="op" id="7352695">]</span><span class="op" id="7352696">;</span>&nbsp;<span class="ident" id="7352698"><a href="/database/sql/fakedb_test.go.html#7352672">exist</a></span>&nbsp;<span class="op" id="7352704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352708">return</span>&nbsp;<span class="ident" id="7352715"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7352718">.</span><span class="ident" id="7352719">Errorf</span><span class="op" id="7352725">(</span><span class="string" id="7352726">&#34;table&nbsp;%q&nbsp;already&nbsp;exists&#34;</span><span class="op" id="7352751">,</span>&nbsp;<span class="ident" id="7352753"><a href="/database/sql/fakedb_test.go.html#7352509">name</a></span><span class="op" id="7352757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352763">if</span>&nbsp;<span class="builtinfunc" id="7352766">len</span><span class="op" id="7352769">(</span><span class="ident" id="7352770"><a href="/database/sql/fakedb_test.go.html#7352522">columnNames</a></span><span class="op" id="7352781">)</span>&nbsp;<span class="op" id="7352783">!=</span>&nbsp;<span class="builtinfunc" id="7352786">len</span><span class="op" id="7352789">(</span><span class="ident" id="7352790"><a href="/database/sql/fakedb_test.go.html#7352535">columnTypes</a></span><span class="op" id="7352801">)</span>&nbsp;<span class="op" id="7352803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7352807">return</span>&nbsp;<span class="ident" id="7352814"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7352817">.</span><span class="ident" id="7352818">Errorf</span><span class="op" id="7352824">(</span><span class="string" id="7352825">&#34;create&nbsp;table&nbsp;of&nbsp;%q&nbsp;len(names)&nbsp;!=&nbsp;len(types):&nbsp;%d&nbsp;vs&nbsp;%d&#34;</span><span class="op" id="7352880">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352885"><a href="/database/sql/fakedb_test.go.html#7352509">name</a></span><span class="op" id="7352889">,</span>&nbsp;<span class="builtinfunc" id="7352891">len</span><span class="op" id="7352894">(</span><span class="ident" id="7352895"><a href="/database/sql/fakedb_test.go.html#7352522">columnNames</a></span><span class="op" id="7352906">)</span><span class="op" id="7352907">,</span>&nbsp;<span class="builtinfunc" id="7352909">len</span><span class="op" id="7352912">(</span><span class="ident" id="7352913"><a href="/database/sql/fakedb_test.go.html#7352535">columnTypes</a></span><span class="op" id="7352924">)</span><span class="op" id="7352925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7352928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7352931"><a href="/database/sql/fakedb_test.go.html#7352485">db</a></span><span class="op" id="7352933">.</span><span class="ident" id="7352934">tables</span><span class="op" id="7352940">[</span><span class="ident" id="7352941"><a href="/database/sql/fakedb_test.go.html#7352509">name</a></span><span class="op" id="7352945">]</span>&nbsp;<span class="op" id="7352947">=</span>&nbsp;<span class="op" id="7352949">&amp;</span><span class="ident" id="7352950"><a href="/database/sql/fakedb_test.go.html#7349597">table</a></span><span class="op" id="7352955">{</span><span class="ident" id="7352956">colname</span><span class="op" id="7352963">:</span>&nbsp;<span class="ident" id="7352965"><a href="/database/sql/fakedb_test.go.html#7352522">columnNames</a></span><span class="op" id="7352976">,</span>&nbsp;<span class="ident" id="7352978">coltype</span><span class="op" id="7352985">:</span>&nbsp;<span class="ident" id="7352987"><a href="/database/sql/fakedb_test.go.html#7352535">columnTypes</a></span><span class="op" id="7352998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353001">return</span>&nbsp;<span class="ident" id="7353008">nil</span><br>
<span class="lineno"></span><span class="op" id="7353012">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="7353015">//&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;db.mu&nbsp;lock&nbsp;held</span><br>
<span class="lineno"></span><span class="keyword" id="7353054">func</span>&nbsp;<span class="op" id="7353059">(</span><span class="ident" id="7353060">db</span>&nbsp;<span class="op" id="7353063">*</span><span class="ident" id="7353064"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7353070">)</span>&nbsp;<span class="ident" id="7353072">table</span><span class="op" id="7353077">(</span><span class="ident" id="7353078">table</span>&nbsp;<span class="builtintype" id="7353084">string</span><span class="op" id="7353090">)</span>&nbsp;<span class="op" id="7353092">(</span><span class="op" id="7353093">*</span><span class="ident" id="7353094"><a href="/database/sql/fakedb_test.go.html#7349597">table</a></span><span class="op" id="7353099">,</span>&nbsp;<span class="builtintype" id="7353101">bool</span><span class="op" id="7353105">)</span>&nbsp;<span class="op" id="7353107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353110">if</span>&nbsp;<span class="ident" id="7353113"><a href="/database/sql/fakedb_test.go.html#7353060">db</a></span><span class="op" id="7353115">.</span><span class="ident" id="7353116">tables</span>&nbsp;<span class="op" id="7353123">==</span>&nbsp;<span class="ident" id="7353126">nil</span>&nbsp;<span class="op" id="7353130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353134">return</span>&nbsp;<span class="ident" id="7353141">nil</span><span class="op" id="7353144">,</span>&nbsp;<span class="builtintype" id="7353146">false</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353156">t</span><span class="op" id="7353157">,</span>&nbsp;<span class="ident" id="7353159">ok</span>&nbsp;<span class="op" id="7353162">:=</span>&nbsp;<span class="ident" id="7353165"><a href="/database/sql/fakedb_test.go.html#7353060">db</a></span><span class="op" id="7353167">.</span><span class="ident" id="7353168">tables</span><span class="op" id="7353174">[</span><span class="ident" id="7353175"><a href="/database/sql/fakedb_test.go.html#7353078">table</a></span><span class="op" id="7353180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353183">return</span>&nbsp;<span class="ident" id="7353190"><a href="/database/sql/fakedb_test.go.html#7353156">t</a></span><span class="op" id="7353191">,</span>&nbsp;<span class="ident" id="7353193"><a href="/database/sql/fakedb_test.go.html#7353159">ok</a></span><br>
<span class="lineno"></span><span class="op" id="7353196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7353199">func</span>&nbsp;<span class="op" id="7353204">(</span><span class="ident" id="7353205">db</span>&nbsp;<span class="op" id="7353208">*</span><span class="ident" id="7353209"><a href="/database/sql/fakedb_test.go.html#7349477">fakeDB</a></span><span class="op" id="7353215">)</span>&nbsp;<span class="ident" id="7353217">columnType</span><span class="op" id="7353227">(</span><span class="ident" id="7353228">table</span><span class="op" id="7353233">,</span>&nbsp;<span class="ident" id="7353235">column</span>&nbsp;<span class="builtintype" id="7353242">string</span><span class="op" id="7353248">)</span>&nbsp;<span class="op" id="7353250">(</span><span class="ident" id="7353251">typ</span>&nbsp;<span class="builtintype" id="7353255">string</span><span class="op" id="7353261">,</span>&nbsp;<span class="ident" id="7353263">ok</span>&nbsp;<span class="builtintype" id="7353266">bool</span><span class="op" id="7353270">)</span>&nbsp;<span class="op" id="7353272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353275"><a href="/database/sql/fakedb_test.go.html#7353205">db</a></span><span class="op" id="7353277">.</span><span class="ident" id="7353278">mu</span><span class="op" id="7353280">.</span><span class="ident" id="7353281">Lock</span><span class="op" id="7353285">(</span><span class="op" id="7353286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353289">defer</span>&nbsp;<span class="ident" id="7353295"><a href="/database/sql/fakedb_test.go.html#7353205">db</a></span><span class="op" id="7353297">.</span><span class="ident" id="7353298">mu</span><span class="op" id="7353300">.</span><span class="ident" id="7353301">Unlock</span><span class="op" id="7353307">(</span><span class="op" id="7353308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353311">t</span><span class="op" id="7353312">,</span>&nbsp;<span class="ident" id="7353314"><a href="/database/sql/fakedb_test.go.html#7353263">ok</a></span>&nbsp;<span class="op" id="7353317">:=</span>&nbsp;<span class="ident" id="7353320"><a href="/database/sql/fakedb_test.go.html#7353205">db</a></span><span class="op" id="7353322">.</span><span class="ident" id="7353323">table</span><span class="op" id="7353328">(</span><span class="ident" id="7353329"><a href="/database/sql/fakedb_test.go.html#7353228">table</a></span><span class="op" id="7353334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353337">if</span>&nbsp;<span class="op" id="7353340">!</span><span class="ident" id="7353341"><a href="/database/sql/fakedb_test.go.html#7353263">ok</a></span>&nbsp;<span class="op" id="7353344">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353348">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353359">for</span>&nbsp;<span class="ident" id="7353363">n</span><span class="op" id="7353364">,</span>&nbsp;<span class="ident" id="7353366">cname</span>&nbsp;<span class="op" id="7353372">:=</span>&nbsp;<span class="keyword" id="7353375">range</span>&nbsp;<span class="ident" id="7353381"><a href="/database/sql/fakedb_test.go.html#7353311">t</a></span><span class="op" id="7353382">.</span><span class="ident" id="7353383">colname</span>&nbsp;<span class="op" id="7353391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353395">if</span>&nbsp;<span class="ident" id="7353398"><a href="/database/sql/fakedb_test.go.html#7353366">cname</a></span>&nbsp;<span class="op" id="7353404">==</span>&nbsp;<span class="ident" id="7353407"><a href="/database/sql/fakedb_test.go.html#7353235">column</a></span>&nbsp;<span class="op" id="7353414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353419">return</span>&nbsp;<span class="ident" id="7353426"><a href="/database/sql/fakedb_test.go.html#7353311">t</a></span><span class="op" id="7353427">.</span><span class="ident" id="7353428">coltype</span><span class="op" id="7353435">[</span><span class="ident" id="7353436"><a href="/database/sql/fakedb_test.go.html#7353363">n</a></span><span class="op" id="7353437">]</span><span class="op" id="7353438">,</span>&nbsp;<span class="builtintype" id="7353440">true</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353453">return</span>&nbsp;<span class="string" id="7353460">&#34;&#34;</span><span class="op" id="7353462">,</span>&nbsp;<span class="builtintype" id="7353464">false</span><br>
<span class="lineno"></span><span class="op" id="7353470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="7353473">func</span>&nbsp;<span class="op" id="7353478">(</span><span class="ident" id="7353479">c</span>&nbsp;<span class="op" id="7353481">*</span><span class="ident" id="7353482"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7353490">)</span>&nbsp;<span class="ident" id="7353492">isBad</span><span class="op" id="7353497">(</span><span class="op" id="7353498">)</span>&nbsp;<span class="builtintype" id="7353500">bool</span>&nbsp;<span class="op" id="7353505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7353508">//&nbsp;if&nbsp;not&nbsp;simulating&nbsp;bad&nbsp;conn,&nbsp;do&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353551">if</span>&nbsp;<span class="op" id="7353554">!</span><span class="ident" id="7353555"><a href="/database/sql/fakedb_test.go.html#7353479">c</a></span><span class="op" id="7353556">.</span><span class="ident" id="7353557">bad</span>&nbsp;<span class="op" id="7353561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353565">return</span>&nbsp;<span class="builtintype" id="7353572">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353579">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7353582">//&nbsp;alternate&nbsp;between&nbsp;bad&nbsp;conn&nbsp;and&nbsp;not&nbsp;bad&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353630"><a href="/database/sql/fakedb_test.go.html#7353479">c</a></span><span class="op" id="7353631">.</span><span class="ident" id="7353632">db</span><span class="op" id="7353634">.</span><span class="ident" id="7353635">badConn</span>&nbsp;<span class="op" id="7353643">=</span>&nbsp;<span class="op" id="7353645">!</span><span class="ident" id="7353646"><a href="/database/sql/fakedb_test.go.html#7353479">c</a></span><span class="op" id="7353647">.</span><span class="ident" id="7353648">db</span><span class="op" id="7353650">.</span><span class="ident" id="7353651">badConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353660">return</span>&nbsp;<span class="ident" id="7353667"><a href="/database/sql/fakedb_test.go.html#7353479">c</a></span><span class="op" id="7353668">.</span><span class="ident" id="7353669">db</span><span class="op" id="7353671">.</span><span class="ident" id="7353672">badConn</span><br>
<span class="lineno"></span><span class="op" id="7353680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7353683">func</span>&nbsp;<span class="op" id="7353688">(</span><span class="ident" id="7353689">c</span>&nbsp;<span class="op" id="7353691">*</span><span class="ident" id="7353692"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7353700">)</span>&nbsp;<span class="ident" id="7353702">Begin</span><span class="op" id="7353707">(</span><span class="op" id="7353708">)</span>&nbsp;<span class="op" id="7353710">(</span><span class="ident" id="7353711"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7353717">.</span><span class="ident" id="7353718">Tx</span><span class="op" id="7353720">,</span>&nbsp;<span class="builtintype" id="7353722">error</span><span class="op" id="7353727">)</span>&nbsp;<span class="op" id="7353729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353732">if</span>&nbsp;<span class="ident" id="7353735"><a href="/database/sql/fakedb_test.go.html#7353689">c</a></span><span class="op" id="7353736">.</span><span class="ident" id="7353737">isBad</span><span class="op" id="7353742">(</span><span class="op" id="7353743">)</span>&nbsp;<span class="op" id="7353745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353749">return</span>&nbsp;<span class="ident" id="7353756">nil</span><span class="op" id="7353759">,</span>&nbsp;<span class="ident" id="7353761"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7353767">.</span><span class="ident" id="7353768">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353783">if</span>&nbsp;<span class="ident" id="7353786"><a href="/database/sql/fakedb_test.go.html#7353689">c</a></span><span class="op" id="7353787">.</span><span class="ident" id="7353788">currTx</span>&nbsp;<span class="op" id="7353795">!=</span>&nbsp;<span class="ident" id="7353798">nil</span>&nbsp;<span class="op" id="7353802">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353806">return</span>&nbsp;<span class="ident" id="7353813">nil</span><span class="op" id="7353816">,</span>&nbsp;<span class="ident" id="7353818"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7353824">.</span><span class="ident" id="7353825">New</span><span class="op" id="7353828">(</span><span class="string" id="7353829">&#34;already&nbsp;in&nbsp;a&nbsp;transaction&#34;</span><span class="op" id="7353855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7353858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353861"><a href="/database/sql/fakedb_test.go.html#7353689">c</a></span><span class="op" id="7353862">.</span><span class="ident" id="7353863">currTx</span>&nbsp;<span class="op" id="7353870">=</span>&nbsp;<span class="op" id="7353872">&amp;</span><span class="ident" id="7353873"><a href="/database/sql/fakedb_test.go.html#7350322">fakeTx</a></span><span class="op" id="7353879">{</span><span class="ident" id="7353880">c</span><span class="op" id="7353881">:</span>&nbsp;<span class="ident" id="7353883"><a href="/database/sql/fakedb_test.go.html#7353689">c</a></span><span class="op" id="7353884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7353887">return</span>&nbsp;<span class="ident" id="7353894"><a href="/database/sql/fakedb_test.go.html#7353689">c</a></span><span class="op" id="7353895">.</span><span class="ident" id="7353896">currTx</span><span class="op" id="7353902">,</span>&nbsp;<span class="ident" id="7353904">nil</span><br>
<span class="lineno"></span><span class="op" id="7353908">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="7353911">var</span>&nbsp;<span class="ident" id="7353915">hookPostCloseConn</span>&nbsp;<span class="keyword" id="7353933">struct</span>&nbsp;<span class="op" id="7353940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353943"><a href="/database/sql/fakedb_test.go.html#7348561">sync</a></span><span class="op" id="7353947">.</span><span class="ident" id="7353948">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7353955">fn</span>&nbsp;<span class="keyword" id="7353958">func</span><span class="op" id="7353962">(</span><span class="op" id="7353963">*</span><span class="ident" id="7353964"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7353972">,</span>&nbsp;<span class="builtintype" id="7353974">error</span><span class="op" id="7353979">)</span><br>
<span class="lineno"></span><span class="op" id="7353981">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7353984">func</span>&nbsp;<span class="ident" id="7353989">setHookpostCloseConn</span><span class="op" id="7354009">(</span><span class="ident" id="7354010">fn</span>&nbsp;<span class="keyword" id="7354013">func</span><span class="op" id="7354017">(</span><span class="op" id="7354018">*</span><span class="ident" id="7354019"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7354027">,</span>&nbsp;<span class="builtintype" id="7354029">error</span><span class="op" id="7354034">)</span><span class="op" id="7354035">)</span>&nbsp;<span class="op" id="7354037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354040"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354057">.</span><span class="ident" id="7354058">Lock</span><span class="op" id="7354062">(</span><span class="op" id="7354063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354066">defer</span>&nbsp;<span class="ident" id="7354072"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354089">.</span><span class="ident" id="7354090">Unlock</span><span class="op" id="7354096">(</span><span class="op" id="7354097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354100"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354117">.</span><span class="ident" id="7354118">fn</span>&nbsp;<span class="op" id="7354121">=</span>&nbsp;<span class="ident" id="7354123"><a href="/database/sql/fakedb_test.go.html#7354010">fn</a></span><br>
<span class="lineno">275</span><span class="op" id="7354126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7354129">var</span>&nbsp;<span class="ident" id="7354133">testStrictClose</span>&nbsp;<span class="op" id="7354149">*</span><span class="ident" id="7354150"><a href="/database/sql/fakedb_test.go.html#7348569">testing</a></span><span class="op" id="7354157">.</span><span class="ident" id="7354158">T</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7354161">//&nbsp;setStrictFakeConnClose&nbsp;sets&nbsp;the&nbsp;t&nbsp;to&nbsp;Errorf&nbsp;on&nbsp;when&nbsp;fakeConn.Close</span><br>
<span class="lineno">280</span><span class="comment" id="7354231">//&nbsp;fails&nbsp;to&nbsp;close.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;check&nbsp;is&nbsp;disabled.</span><br>
<span class="lineno"></span><span class="keyword" id="7354281">func</span>&nbsp;<span class="ident" id="7354286">setStrictFakeConnClose</span><span class="op" id="7354308">(</span><span class="ident" id="7354309">t</span>&nbsp;<span class="op" id="7354311">*</span><span class="ident" id="7354312"><a href="/database/sql/fakedb_test.go.html#7348569">testing</a></span><span class="op" id="7354319">.</span><span class="ident" id="7354320">T</span><span class="op" id="7354321">)</span>&nbsp;<span class="op" id="7354323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354326"><a href="/database/sql/fakedb_test.go.html#7354133">testStrictClose</a></span>&nbsp;<span class="op" id="7354342">=</span>&nbsp;<span class="ident" id="7354344"><a href="/database/sql/fakedb_test.go.html#7354309">t</a></span><br>
<span class="lineno"></span><span class="op" id="7354346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="7354349">func</span>&nbsp;<span class="op" id="7354354">(</span><span class="ident" id="7354355">c</span>&nbsp;<span class="op" id="7354357">*</span><span class="ident" id="7354358"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7354366">)</span>&nbsp;<span class="ident" id="7354368">Close</span><span class="op" id="7354373">(</span><span class="op" id="7354374">)</span>&nbsp;<span class="op" id="7354376">(</span><span class="ident" id="7354377">err</span>&nbsp;<span class="builtintype" id="7354381">error</span><span class="op" id="7354386">)</span>&nbsp;<span class="op" id="7354388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354391">drv</span>&nbsp;<span class="op" id="7354395">:=</span>&nbsp;<span class="ident" id="7354398"><a href="/database/sql/fakedb_test.go.html#7350883">fdriver</a></span><span class="op" id="7354405">.</span><span class="op" id="7354406">(</span><span class="op" id="7354407">*</span><span class="ident" id="7354408"><a href="/database/sql/fakedb_test.go.html#7349239">fakeDriver</a></span><span class="op" id="7354418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354421">defer</span>&nbsp;<span class="keyword" id="7354427">func</span><span class="op" id="7354431">(</span><span class="op" id="7354432">)</span>&nbsp;<span class="op" id="7354434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354438">if</span>&nbsp;<span class="ident" id="7354441"><a href="/database/sql/fakedb_test.go.html#7354377">err</a></span>&nbsp;<span class="op" id="7354445">!=</span>&nbsp;<span class="ident" id="7354448">nil</span>&nbsp;<span class="op" id="7354452">&amp;&amp;</span>&nbsp;<span class="ident" id="7354455"><a href="/database/sql/fakedb_test.go.html#7354133">testStrictClose</a></span>&nbsp;<span class="op" id="7354471">!=</span>&nbsp;<span class="ident" id="7354474">nil</span>&nbsp;<span class="op" id="7354478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354483"><a href="/database/sql/fakedb_test.go.html#7354133">testStrictClose</a></span><span class="op" id="7354498">.</span><span class="ident" id="7354499">Errorf</span><span class="op" id="7354505">(</span><span class="string" id="7354506">&#34;failed&nbsp;to&nbsp;close&nbsp;a&nbsp;test&nbsp;fakeConn:&nbsp;%v&#34;</span><span class="op" id="7354543">,</span>&nbsp;<span class="ident" id="7354545"><a href="/database/sql/fakedb_test.go.html#7354377">err</a></span><span class="op" id="7354548">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354556"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354573">.</span><span class="ident" id="7354574">Lock</span><span class="op" id="7354578">(</span><span class="op" id="7354579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354583">fn</span>&nbsp;<span class="op" id="7354586">:=</span>&nbsp;<span class="ident" id="7354589"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354606">.</span><span class="ident" id="7354607">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354612"><a href="/database/sql/fakedb_test.go.html#7353915">hookPostCloseConn</a></span><span class="op" id="7354629">.</span><span class="ident" id="7354630">Unlock</span><span class="op" id="7354636">(</span><span class="op" id="7354637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354641">if</span>&nbsp;<span class="ident" id="7354644"><a href="/database/sql/fakedb_test.go.html#7354583">fn</a></span>&nbsp;<span class="op" id="7354647">!=</span>&nbsp;<span class="ident" id="7354650">nil</span>&nbsp;<span class="op" id="7354654">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354659"><a href="/database/sql/fakedb_test.go.html#7354583">fn</a></span><span class="op" id="7354661">(</span><span class="ident" id="7354662"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7354663">,</span>&nbsp;<span class="ident" id="7354665"><a href="/database/sql/fakedb_test.go.html#7354377">err</a></span><span class="op" id="7354668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354676">if</span>&nbsp;<span class="ident" id="7354679"><a href="/database/sql/fakedb_test.go.html#7354377">err</a></span>&nbsp;<span class="op" id="7354683">==</span>&nbsp;<span class="ident" id="7354686">nil</span>&nbsp;<span class="op" id="7354690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354695"><a href="/database/sql/fakedb_test.go.html#7354391">drv</a></span><span class="op" id="7354698">.</span><span class="ident" id="7354699">mu</span><span class="op" id="7354701">.</span><span class="ident" id="7354702">Lock</span><span class="op" id="7354706">(</span><span class="op" id="7354707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354712"><a href="/database/sql/fakedb_test.go.html#7354391">drv</a></span><span class="op" id="7354715">.</span><span class="ident" id="7354716">closeCount</span><span class="op" id="7354726">++</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7354732"><a href="/database/sql/fakedb_test.go.html#7354391">drv</a></span><span class="op" id="7354735">.</span><span class="ident" id="7354736">mu</span><span class="op" id="7354738">.</span><span class="ident" id="7354739">Unlock</span><span class="op" id="7354745">(</span><span class="op" id="7354746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354753">}</span><span class="op" id="7354754">(</span><span class="op" id="7354755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354758">if</span>&nbsp;<span class="ident" id="7354761"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7354762">.</span><span class="ident" id="7354763">currTx</span>&nbsp;<span class="op" id="7354770">!=</span>&nbsp;<span class="ident" id="7354773">nil</span>&nbsp;<span class="op" id="7354777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354781">return</span>&nbsp;<span class="ident" id="7354788"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7354794">.</span><span class="ident" id="7354795">New</span><span class="op" id="7354798">(</span><span class="string" id="7354799">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;in&nbsp;a&nbsp;Transaction&#34;</span><span class="op" id="7354839">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354845">if</span>&nbsp;<span class="ident" id="7354848"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7354849">.</span><span class="ident" id="7354850">db</span>&nbsp;<span class="op" id="7354853">==</span>&nbsp;<span class="ident" id="7354856">nil</span>&nbsp;<span class="op" id="7354860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354864">return</span>&nbsp;<span class="ident" id="7354871"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7354877">.</span><span class="ident" id="7354878">New</span><span class="op" id="7354881">(</span><span class="string" id="7354882">&#34;can&#39;t&nbsp;close&nbsp;fakeConn;&nbsp;already&nbsp;closed&#34;</span><span class="op" id="7354920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7354923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354926">if</span>&nbsp;<span class="ident" id="7354929"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7354930">.</span><span class="ident" id="7354931">stmtsMade</span>&nbsp;<span class="op" id="7354941">&gt;</span>&nbsp;<span class="ident" id="7354943"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7354944">.</span><span class="ident" id="7354945">stmtsClosed</span>&nbsp;<span class="op" id="7354957">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7354961">return</span>&nbsp;<span class="ident" id="7354968"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7354974">.</span><span class="ident" id="7354975">New</span><span class="op" id="7354978">(</span><span class="string" id="7354979">&#34;can&#39;t&nbsp;close;&nbsp;dangling&nbsp;statement(s)&#34;</span><span class="op" id="7355015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7355018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7355021"><a href="/database/sql/fakedb_test.go.html#7354355">c</a></span><span class="op" id="7355022">.</span><span class="ident" id="7355023">db</span>&nbsp;<span class="op" id="7355026">=</span>&nbsp;<span class="ident" id="7355028">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355033">return</span>&nbsp;<span class="ident" id="7355040">nil</span><br>
<span class="lineno"></span><span class="op" id="7355044">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="7355047">func</span>&nbsp;<span class="ident" id="7355052">checkSubsetTypes</span><span class="op" id="7355068">(</span><span class="ident" id="7355069">args</span>&nbsp;<span class="op" id="7355074">[</span><span class="op" id="7355075">]</span><span class="ident" id="7355076"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355082">.</span><span class="ident" id="7355083">Value</span><span class="op" id="7355088">)</span>&nbsp;<span class="builtintype" id="7355090">error</span>&nbsp;<span class="op" id="7355096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355099">for</span>&nbsp;<span class="ident" id="7355103">n</span><span class="op" id="7355104">,</span>&nbsp;<span class="ident" id="7355106">arg</span>&nbsp;<span class="op" id="7355110">:=</span>&nbsp;<span class="keyword" id="7355113">range</span>&nbsp;<span class="ident" id="7355119"><a href="/database/sql/fakedb_test.go.html#7355069">args</a></span>&nbsp;<span class="op" id="7355124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355128">switch</span>&nbsp;<span class="ident" id="7355135"><a href="/database/sql/fakedb_test.go.html#7355106">arg</a></span><span class="op" id="7355138">.</span><span class="op" id="7355139">(</span><span class="keyword" id="7355140">type</span><span class="op" id="7355144">)</span>&nbsp;<span class="op" id="7355146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355150">case</span>&nbsp;<span class="ident" id="7355155">int64</span><span class="op" id="7355160">,</span>&nbsp;<span class="builtintype" id="7355162">float64</span><span class="op" id="7355169">,</span>&nbsp;<span class="builtintype" id="7355171">bool</span><span class="op" id="7355175">,</span>&nbsp;<span class="ident" id="7355177">nil</span><span class="op" id="7355180">,</span>&nbsp;<span class="op" id="7355182">[</span><span class="op" id="7355183">]</span><span class="builtintype" id="7355184">byte</span><span class="op" id="7355188">,</span>&nbsp;<span class="builtintype" id="7355190">string</span><span class="op" id="7355196">,</span>&nbsp;<span class="ident" id="7355198"><a href="/database/sql/fakedb_test.go.html#7348580">time</a></span><span class="op" id="7355202">.</span><span class="ident" id="7355203">Time</span><span class="op" id="7355207">:</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355211">default</span><span class="op" id="7355218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355223">return</span>&nbsp;<span class="ident" id="7355230"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7355233">.</span><span class="ident" id="7355234">Errorf</span><span class="op" id="7355240">(</span><span class="string" id="7355241">&#34;fakedb_test:&nbsp;invalid&nbsp;argument&nbsp;#%d:&nbsp;%v,&nbsp;type&nbsp;%T&#34;</span><span class="op" id="7355289">,</span>&nbsp;<span class="ident" id="7355291"><a href="/database/sql/fakedb_test.go.html#7355103">n</a></span><span class="op" id="7355292">+</span><span class="num" id="7355293">1</span><span class="op" id="7355294">,</span>&nbsp;<span class="ident" id="7355296"><a href="/database/sql/fakedb_test.go.html#7355106">arg</a></span><span class="op" id="7355299">,</span>&nbsp;<span class="ident" id="7355301"><a href="/database/sql/fakedb_test.go.html#7355106">arg</a></span><span class="op" id="7355304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7355308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7355311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355314">return</span>&nbsp;<span class="ident" id="7355321">nil</span><br>
<span class="lineno">325</span><span class="op" id="7355325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7355328">func</span>&nbsp;<span class="op" id="7355333">(</span><span class="ident" id="7355334">c</span>&nbsp;<span class="op" id="7355336">*</span><span class="ident" id="7355337"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7355345">)</span>&nbsp;<span class="ident" id="7355347">Exec</span><span class="op" id="7355351">(</span><span class="ident" id="7355352">query</span>&nbsp;<span class="builtintype" id="7355358">string</span><span class="op" id="7355364">,</span>&nbsp;<span class="ident" id="7355366">args</span>&nbsp;<span class="op" id="7355371">[</span><span class="op" id="7355372">]</span><span class="ident" id="7355373"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355379">.</span><span class="ident" id="7355380">Value</span><span class="op" id="7355385">)</span>&nbsp;<span class="op" id="7355387">(</span><span class="ident" id="7355388"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355394">.</span><span class="ident" id="7355395">Result</span><span class="op" id="7355401">,</span>&nbsp;<span class="builtintype" id="7355403">error</span><span class="op" id="7355408">)</span>&nbsp;<span class="op" id="7355410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355413">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355474">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355535">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355594">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7355621">err</span>&nbsp;<span class="op" id="7355625">:=</span>&nbsp;<span class="ident" id="7355628"><a href="/database/sql/fakedb_test.go.html#7355052">checkSubsetTypes</a></span><span class="op" id="7355644">(</span><span class="ident" id="7355645"><a href="/database/sql/fakedb_test.go.html#7355366">args</a></span><span class="op" id="7355649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355652">if</span>&nbsp;<span class="ident" id="7355655"><a href="/database/sql/fakedb_test.go.html#7355621">err</a></span>&nbsp;<span class="op" id="7355659">!=</span>&nbsp;<span class="ident" id="7355662">nil</span>&nbsp;<span class="op" id="7355666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355670">return</span>&nbsp;<span class="ident" id="7355677">nil</span><span class="op" id="7355680">,</span>&nbsp;<span class="ident" id="7355682"><a href="/database/sql/fakedb_test.go.html#7355621">err</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7355687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7355690">return</span>&nbsp;<span class="ident" id="7355697">nil</span><span class="op" id="7355700">,</span>&nbsp;<span class="ident" id="7355702"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355708">.</span><span class="ident" id="7355709">ErrSkip</span><br>
<span class="lineno"></span><span class="op" id="7355717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7355720">func</span>&nbsp;<span class="op" id="7355725">(</span><span class="ident" id="7355726">c</span>&nbsp;<span class="op" id="7355728">*</span><span class="ident" id="7355729"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7355737">)</span>&nbsp;<span class="ident" id="7355739">Query</span><span class="op" id="7355744">(</span><span class="ident" id="7355745">query</span>&nbsp;<span class="builtintype" id="7355751">string</span><span class="op" id="7355757">,</span>&nbsp;<span class="ident" id="7355759">args</span>&nbsp;<span class="op" id="7355764">[</span><span class="op" id="7355765">]</span><span class="ident" id="7355766"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355772">.</span><span class="ident" id="7355773">Value</span><span class="op" id="7355778">)</span>&nbsp;<span class="op" id="7355780">(</span><span class="ident" id="7355781"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7355787">.</span><span class="ident" id="7355788">Rows</span><span class="op" id="7355792">,</span>&nbsp;<span class="builtintype" id="7355794">error</span><span class="op" id="7355799">)</span>&nbsp;<span class="op" id="7355801">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355804">//&nbsp;This&nbsp;is&nbsp;an&nbsp;optional&nbsp;interface,&nbsp;but&nbsp;it&#39;s&nbsp;implemented&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355865">//&nbsp;just&nbsp;to&nbsp;check&nbsp;that&nbsp;all&nbsp;the&nbsp;args&nbsp;are&nbsp;of&nbsp;the&nbsp;proper&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355926">//&nbsp;ErrSkip&nbsp;is&nbsp;returned&nbsp;so&nbsp;the&nbsp;caller&nbsp;acts&nbsp;as&nbsp;if&nbsp;we&nbsp;didn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7355985">//&nbsp;implement&nbsp;this&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356012">err</span>&nbsp;<span class="op" id="7356016">:=</span>&nbsp;<span class="ident" id="7356019"><a href="/database/sql/fakedb_test.go.html#7355052">checkSubsetTypes</a></span><span class="op" id="7356035">(</span><span class="ident" id="7356036"><a href="/database/sql/fakedb_test.go.html#7355759">args</a></span><span class="op" id="7356040">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356043">if</span>&nbsp;<span class="ident" id="7356046"><a href="/database/sql/fakedb_test.go.html#7356012">err</a></span>&nbsp;<span class="op" id="7356050">!=</span>&nbsp;<span class="ident" id="7356053">nil</span>&nbsp;<span class="op" id="7356057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356061">return</span>&nbsp;<span class="ident" id="7356068">nil</span><span class="op" id="7356071">,</span>&nbsp;<span class="ident" id="7356073"><a href="/database/sql/fakedb_test.go.html#7356012">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7356078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356081">return</span>&nbsp;<span class="ident" id="7356088">nil</span><span class="op" id="7356091">,</span>&nbsp;<span class="ident" id="7356093"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7356099">.</span><span class="ident" id="7356100">ErrSkip</span><br>
<span class="lineno"></span><span class="op" id="7356108">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span><span class="keyword" id="7356111">func</span>&nbsp;<span class="ident" id="7356116">errf</span><span class="op" id="7356120">(</span><span class="ident" id="7356121">msg</span>&nbsp;<span class="builtintype" id="7356125">string</span><span class="op" id="7356131">,</span>&nbsp;<span class="ident" id="7356133">args</span>&nbsp;<span class="op" id="7356138">...</span><span class="keyword" id="7356141">interface</span><span class="op" id="7356150">{</span><span class="op" id="7356151">}</span><span class="op" id="7356152">)</span>&nbsp;<span class="builtintype" id="7356154">error</span>&nbsp;<span class="op" id="7356160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356163">return</span>&nbsp;<span class="ident" id="7356170"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7356176">.</span><span class="ident" id="7356177">New</span><span class="op" id="7356180">(</span><span class="string" id="7356181">&#34;fakedb:&nbsp;&#34;</span>&nbsp;<span class="op" id="7356192">+</span>&nbsp;<span class="ident" id="7356194"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7356197">.</span><span class="ident" id="7356198">Sprintf</span><span class="op" id="7356205">(</span><span class="ident" id="7356206"><a href="/database/sql/fakedb_test.go.html#7356121">msg</a></span><span class="op" id="7356209">,</span>&nbsp;<span class="ident" id="7356211"><a href="/database/sql/fakedb_test.go.html#7356133">args</a></span><span class="op" id="7356215">...</span><span class="op" id="7356218">)</span><span class="op" id="7356219">)</span><br>
<span class="lineno"></span><span class="op" id="7356221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="7356224">//&nbsp;parts&nbsp;are&nbsp;table|selectCol1,selectCol2|whereCol=?,whereCol2=?</span><br>
<span class="lineno"></span><span class="comment" id="7356288">//&nbsp;(note&nbsp;that&nbsp;where&nbsp;columns&nbsp;must&nbsp;always&nbsp;contain&nbsp;?&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="7356345">//&nbsp;&nbsp;just&nbsp;a&nbsp;limitation&nbsp;for&nbsp;fakedb)</span><br>
<span class="lineno"></span><span class="keyword" id="7356379">func</span>&nbsp;<span class="op" id="7356384">(</span><span class="ident" id="7356385">c</span>&nbsp;<span class="op" id="7356387">*</span><span class="ident" id="7356388"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7356396">)</span>&nbsp;<span class="ident" id="7356398">prepareSelect</span><span class="op" id="7356411">(</span><span class="ident" id="7356412">stmt</span>&nbsp;<span class="op" id="7356417">*</span><span class="ident" id="7356418"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7356426">,</span>&nbsp;<span class="ident" id="7356428">parts</span>&nbsp;<span class="op" id="7356434">[</span><span class="op" id="7356435">]</span><span class="builtintype" id="7356436">string</span><span class="op" id="7356442">)</span>&nbsp;<span class="op" id="7356444">(</span><span class="ident" id="7356445"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7356451">.</span><span class="ident" id="7356452">Stmt</span><span class="op" id="7356456">,</span>&nbsp;<span class="builtintype" id="7356458">error</span><span class="op" id="7356463">)</span>&nbsp;<span class="op" id="7356465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356468">if</span>&nbsp;<span class="builtinfunc" id="7356471">len</span><span class="op" id="7356474">(</span><span class="ident" id="7356475"><a href="/database/sql/fakedb_test.go.html#7356428">parts</a></span><span class="op" id="7356480">)</span>&nbsp;<span class="op" id="7356482">!=</span>&nbsp;<span class="num" id="7356485">3</span>&nbsp;<span class="op" id="7356487">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356491"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7356495">.</span><span class="ident" id="7356496">Close</span><span class="op" id="7356501">(</span><span class="op" id="7356502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356506">return</span>&nbsp;<span class="ident" id="7356513">nil</span><span class="op" id="7356516">,</span>&nbsp;<span class="ident" id="7356518"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7356522">(</span><span class="string" id="7356523">&#34;invalid&nbsp;SELECT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;3&#34;</span><span class="op" id="7356568">,</span>&nbsp;<span class="builtinfunc" id="7356570">len</span><span class="op" id="7356573">(</span><span class="ident" id="7356574"><a href="/database/sql/fakedb_test.go.html#7356428">parts</a></span><span class="op" id="7356579">)</span><span class="op" id="7356580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7356583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356586"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7356590">.</span><span class="ident" id="7356591">table</span>&nbsp;<span class="op" id="7356597">=</span>&nbsp;<span class="ident" id="7356599"><a href="/database/sql/fakedb_test.go.html#7356428">parts</a></span><span class="op" id="7356604">[</span><span class="num" id="7356605">0</span><span class="op" id="7356606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356609"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7356613">.</span><span class="ident" id="7356614">colName</span>&nbsp;<span class="op" id="7356622">=</span>&nbsp;<span class="ident" id="7356624"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7356631">.</span><span class="ident" id="7356632">Split</span><span class="op" id="7356637">(</span><span class="ident" id="7356638"><a href="/database/sql/fakedb_test.go.html#7356428">parts</a></span><span class="op" id="7356643">[</span><span class="num" id="7356644">1</span><span class="op" id="7356645">]</span><span class="op" id="7356646">,</span>&nbsp;<span class="string" id="7356648">&#34;,&#34;</span><span class="op" id="7356651">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356654">for</span>&nbsp;<span class="ident" id="7356658">n</span><span class="op" id="7356659">,</span>&nbsp;<span class="ident" id="7356661">colspec</span>&nbsp;<span class="op" id="7356669">:=</span>&nbsp;<span class="keyword" id="7356672">range</span>&nbsp;<span class="ident" id="7356678"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7356685">.</span><span class="ident" id="7356686">Split</span><span class="op" id="7356691">(</span><span class="ident" id="7356692"><a href="/database/sql/fakedb_test.go.html#7356428">parts</a></span><span class="op" id="7356697">[</span><span class="num" id="7356698">2</span><span class="op" id="7356699">]</span><span class="op" id="7356700">,</span>&nbsp;<span class="string" id="7356702">&#34;,&#34;</span><span class="op" id="7356705">)</span>&nbsp;<span class="op" id="7356707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356711">if</span>&nbsp;<span class="ident" id="7356714"><a href="/database/sql/fakedb_test.go.html#7356661">colspec</a></span>&nbsp;<span class="op" id="7356722">==</span>&nbsp;<span class="string" id="7356725">&#34;&#34;</span>&nbsp;<span class="op" id="7356728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356733">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7356744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356748">nameVal</span>&nbsp;<span class="op" id="7356756">:=</span>&nbsp;<span class="ident" id="7356759"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7356766">.</span><span class="ident" id="7356767">Split</span><span class="op" id="7356772">(</span><span class="ident" id="7356773"><a href="/database/sql/fakedb_test.go.html#7356661">colspec</a></span><span class="op" id="7356780">,</span>&nbsp;<span class="string" id="7356782">&#34;=&#34;</span><span class="op" id="7356785">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356789">if</span>&nbsp;<span class="builtinfunc" id="7356792">len</span><span class="op" id="7356795">(</span><span class="ident" id="7356796"><a href="/database/sql/fakedb_test.go.html#7356748">nameVal</a></span><span class="op" id="7356803">)</span>&nbsp;<span class="op" id="7356805">!=</span>&nbsp;<span class="num" id="7356808">2</span>&nbsp;<span class="op" id="7356810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356815"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7356819">.</span><span class="ident" id="7356820">Close</span><span class="op" id="7356825">(</span><span class="op" id="7356826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7356831">return</span>&nbsp;<span class="ident" id="7356838">nil</span><span class="op" id="7356841">,</span>&nbsp;<span class="ident" id="7356843"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7356847">(</span><span class="string" id="7356848">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7356909">,</span>&nbsp;<span class="ident" id="7356911"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7356915">.</span><span class="ident" id="7356916">table</span><span class="op" id="7356921">,</span>&nbsp;<span class="ident" id="7356923"><a href="/database/sql/fakedb_test.go.html#7356661">colspec</a></span><span class="op" id="7356930">,</span>&nbsp;<span class="ident" id="7356932"><a href="/database/sql/fakedb_test.go.html#7356658">n</a></span><span class="op" id="7356933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7356937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356941">column</span><span class="op" id="7356947">,</span>&nbsp;<span class="ident" id="7356949">value</span>&nbsp;<span class="op" id="7356955">:=</span>&nbsp;<span class="ident" id="7356958"><a href="/database/sql/fakedb_test.go.html#7356748">nameVal</a></span><span class="op" id="7356965">[</span><span class="num" id="7356966">0</span><span class="op" id="7356967">]</span><span class="op" id="7356968">,</span>&nbsp;<span class="ident" id="7356970"><a href="/database/sql/fakedb_test.go.html#7356748">nameVal</a></span><span class="op" id="7356977">[</span><span class="num" id="7356978">1</span><span class="op" id="7356979">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7356983">_</span><span class="op" id="7356984">,</span>&nbsp;<span class="ident" id="7356986">ok</span>&nbsp;<span class="op" id="7356989">:=</span>&nbsp;<span class="ident" id="7356992"><a href="/database/sql/fakedb_test.go.html#7356385">c</a></span><span class="op" id="7356993">.</span><span class="ident" id="7356994">db</span><span class="op" id="7356996">.</span><span class="ident" id="7356997">columnType</span><span class="op" id="7357007">(</span><span class="ident" id="7357008"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357012">.</span><span class="ident" id="7357013">table</span><span class="op" id="7357018">,</span>&nbsp;<span class="ident" id="7357020"><a href="/database/sql/fakedb_test.go.html#7356941">column</a></span><span class="op" id="7357026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357030">if</span>&nbsp;<span class="op" id="7357033">!</span><span class="ident" id="7357034"><a href="/database/sql/fakedb_test.go.html#7356986">ok</a></span>&nbsp;<span class="op" id="7357037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357042"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357046">.</span><span class="ident" id="7357047">Close</span><span class="op" id="7357052">(</span><span class="op" id="7357053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357058">return</span>&nbsp;<span class="ident" id="7357065">nil</span><span class="op" id="7357068">,</span>&nbsp;<span class="ident" id="7357070"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7357074">(</span><span class="string" id="7357075">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7357129">,</span>&nbsp;<span class="ident" id="7357131"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357135">.</span><span class="ident" id="7357136">table</span><span class="op" id="7357141">,</span>&nbsp;<span class="ident" id="7357143"><a href="/database/sql/fakedb_test.go.html#7356941">column</a></span><span class="op" id="7357149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357153">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357157">if</span>&nbsp;<span class="ident" id="7357160"><a href="/database/sql/fakedb_test.go.html#7356949">value</a></span>&nbsp;<span class="op" id="7357166">!=</span>&nbsp;<span class="string" id="7357169">&#34;?&#34;</span>&nbsp;<span class="op" id="7357173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357178"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357182">.</span><span class="ident" id="7357183">Close</span><span class="op" id="7357188">(</span><span class="op" id="7357189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357194">return</span>&nbsp;<span class="ident" id="7357201">nil</span><span class="op" id="7357204">,</span>&nbsp;<span class="ident" id="7357206"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7357210">(</span><span class="string" id="7357211">&#34;SELECT&nbsp;on&nbsp;table&nbsp;%q&nbsp;has&nbsp;pre-bound&nbsp;value&nbsp;for&nbsp;where&nbsp;column&nbsp;%q;&nbsp;need&nbsp;a&nbsp;question&nbsp;mark&#34;</span><span class="op" id="7357293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357299"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357303">.</span><span class="ident" id="7357304">table</span><span class="op" id="7357309">,</span>&nbsp;<span class="ident" id="7357311"><a href="/database/sql/fakedb_test.go.html#7356941">column</a></span><span class="op" id="7357317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357321">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357325"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357329">.</span><span class="ident" id="7357330">whereCol</span>&nbsp;<span class="op" id="7357339">=</span>&nbsp;<span class="builtinfunc" id="7357341">append</span><span class="op" id="7357347">(</span><span class="ident" id="7357348"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357352">.</span><span class="ident" id="7357353">whereCol</span><span class="op" id="7357361">,</span>&nbsp;<span class="ident" id="7357363"><a href="/database/sql/fakedb_test.go.html#7356941">column</a></span><span class="op" id="7357369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357373"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357377">.</span><span class="ident" id="7357378">placeholders</span><span class="op" id="7357390">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357397">return</span>&nbsp;<span class="ident" id="7357404"><a href="/database/sql/fakedb_test.go.html#7356412">stmt</a></span><span class="op" id="7357408">,</span>&nbsp;<span class="ident" id="7357410">nil</span><br>
<span class="lineno"></span><span class="op" id="7357414">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="7357417">//&nbsp;parts&nbsp;are&nbsp;table|col=type,col2=type2</span><br>
<span class="lineno"></span><span class="keyword" id="7357456">func</span>&nbsp;<span class="op" id="7357461">(</span><span class="ident" id="7357462">c</span>&nbsp;<span class="op" id="7357464">*</span><span class="ident" id="7357465"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7357473">)</span>&nbsp;<span class="ident" id="7357475">prepareCreate</span><span class="op" id="7357488">(</span><span class="ident" id="7357489">stmt</span>&nbsp;<span class="op" id="7357494">*</span><span class="ident" id="7357495"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7357503">,</span>&nbsp;<span class="ident" id="7357505">parts</span>&nbsp;<span class="op" id="7357511">[</span><span class="op" id="7357512">]</span><span class="builtintype" id="7357513">string</span><span class="op" id="7357519">)</span>&nbsp;<span class="op" id="7357521">(</span><span class="ident" id="7357522"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7357528">.</span><span class="ident" id="7357529">Stmt</span><span class="op" id="7357533">,</span>&nbsp;<span class="builtintype" id="7357535">error</span><span class="op" id="7357540">)</span>&nbsp;<span class="op" id="7357542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357545">if</span>&nbsp;<span class="builtinfunc" id="7357548">len</span><span class="op" id="7357551">(</span><span class="ident" id="7357552"><a href="/database/sql/fakedb_test.go.html#7357505">parts</a></span><span class="op" id="7357557">)</span>&nbsp;<span class="op" id="7357559">!=</span>&nbsp;<span class="num" id="7357562">2</span>&nbsp;<span class="op" id="7357564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357568"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357572">.</span><span class="ident" id="7357573">Close</span><span class="op" id="7357578">(</span><span class="op" id="7357579">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357583">return</span>&nbsp;<span class="ident" id="7357590">nil</span><span class="op" id="7357593">,</span>&nbsp;<span class="ident" id="7357595"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7357599">(</span><span class="string" id="7357600">&#34;invalid&nbsp;CREATE&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7357645">,</span>&nbsp;<span class="builtinfunc" id="7357647">len</span><span class="op" id="7357650">(</span><span class="ident" id="7357651"><a href="/database/sql/fakedb_test.go.html#7357505">parts</a></span><span class="op" id="7357656">)</span><span class="op" id="7357657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357663"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357667">.</span><span class="ident" id="7357668">table</span>&nbsp;<span class="op" id="7357674">=</span>&nbsp;<span class="ident" id="7357676"><a href="/database/sql/fakedb_test.go.html#7357505">parts</a></span><span class="op" id="7357681">[</span><span class="num" id="7357682">0</span><span class="op" id="7357683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357686">for</span>&nbsp;<span class="ident" id="7357690">n</span><span class="op" id="7357691">,</span>&nbsp;<span class="ident" id="7357693">colspec</span>&nbsp;<span class="op" id="7357701">:=</span>&nbsp;<span class="keyword" id="7357704">range</span>&nbsp;<span class="ident" id="7357710"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7357717">.</span><span class="ident" id="7357718">Split</span><span class="op" id="7357723">(</span><span class="ident" id="7357724"><a href="/database/sql/fakedb_test.go.html#7357505">parts</a></span><span class="op" id="7357729">[</span><span class="num" id="7357730">1</span><span class="op" id="7357731">]</span><span class="op" id="7357732">,</span>&nbsp;<span class="string" id="7357734">&#34;,&#34;</span><span class="op" id="7357737">)</span>&nbsp;<span class="op" id="7357739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357743">nameType</span>&nbsp;<span class="op" id="7357752">:=</span>&nbsp;<span class="ident" id="7357755"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7357762">.</span><span class="ident" id="7357763">Split</span><span class="op" id="7357768">(</span><span class="ident" id="7357769"><a href="/database/sql/fakedb_test.go.html#7357693">colspec</a></span><span class="op" id="7357776">,</span>&nbsp;<span class="string" id="7357778">&#34;=&#34;</span><span class="op" id="7357781">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357785">if</span>&nbsp;<span class="builtinfunc" id="7357788">len</span><span class="op" id="7357791">(</span><span class="ident" id="7357792"><a href="/database/sql/fakedb_test.go.html#7357743">nameType</a></span><span class="op" id="7357800">)</span>&nbsp;<span class="op" id="7357802">!=</span>&nbsp;<span class="num" id="7357805">2</span>&nbsp;<span class="op" id="7357807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357812"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357816">.</span><span class="ident" id="7357817">Close</span><span class="op" id="7357822">(</span><span class="op" id="7357823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7357828">return</span>&nbsp;<span class="ident" id="7357835">nil</span><span class="op" id="7357838">,</span>&nbsp;<span class="ident" id="7357840"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7357844">(</span><span class="string" id="7357845">&#34;CREATE&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7357903">,</span>&nbsp;<span class="ident" id="7357905"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357909">.</span><span class="ident" id="7357910">table</span><span class="op" id="7357915">,</span>&nbsp;<span class="ident" id="7357917"><a href="/database/sql/fakedb_test.go.html#7357693">colspec</a></span><span class="op" id="7357924">,</span>&nbsp;<span class="ident" id="7357926"><a href="/database/sql/fakedb_test.go.html#7357690">n</a></span><span class="op" id="7357927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7357931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357935"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357939">.</span><span class="ident" id="7357940">colName</span>&nbsp;<span class="op" id="7357948">=</span>&nbsp;<span class="builtinfunc" id="7357950">append</span><span class="op" id="7357956">(</span><span class="ident" id="7357957"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357961">.</span><span class="ident" id="7357962">colName</span><span class="op" id="7357969">,</span>&nbsp;<span class="ident" id="7357971"><a href="/database/sql/fakedb_test.go.html#7357743">nameType</a></span><span class="op" id="7357979">[</span><span class="num" id="7357980">0</span><span class="op" id="7357981">]</span><span class="op" id="7357982">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7357986"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7357990">.</span><span class="ident" id="7357991">colType</span>&nbsp;<span class="op" id="7357999">=</span>&nbsp;<span class="builtinfunc" id="7358001">append</span><span class="op" id="7358007">(</span><span class="ident" id="7358008"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7358012">.</span><span class="ident" id="7358013">colType</span><span class="op" id="7358020">,</span>&nbsp;<span class="ident" id="7358022"><a href="/database/sql/fakedb_test.go.html#7357743">nameType</a></span><span class="op" id="7358030">[</span><span class="num" id="7358031">1</span><span class="op" id="7358032">]</span><span class="op" id="7358033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358039">return</span>&nbsp;<span class="ident" id="7358046"><a href="/database/sql/fakedb_test.go.html#7357489">stmt</a></span><span class="op" id="7358050">,</span>&nbsp;<span class="ident" id="7358052">nil</span><br>
<span class="lineno"></span><span class="op" id="7358056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="7358059">//&nbsp;parts&nbsp;are&nbsp;table|col=?,col2=val</span><br>
<span class="lineno"></span><span class="keyword" id="7358093">func</span>&nbsp;<span class="op" id="7358098">(</span><span class="ident" id="7358099">c</span>&nbsp;<span class="op" id="7358101">*</span><span class="ident" id="7358102"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7358110">)</span>&nbsp;<span class="ident" id="7358112">prepareInsert</span><span class="op" id="7358125">(</span><span class="ident" id="7358126">stmt</span>&nbsp;<span class="op" id="7358131">*</span><span class="ident" id="7358132"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7358140">,</span>&nbsp;<span class="ident" id="7358142">parts</span>&nbsp;<span class="op" id="7358148">[</span><span class="op" id="7358149">]</span><span class="builtintype" id="7358150">string</span><span class="op" id="7358156">)</span>&nbsp;<span class="op" id="7358158">(</span><span class="ident" id="7358159"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7358165">.</span><span class="ident" id="7358166">Stmt</span><span class="op" id="7358170">,</span>&nbsp;<span class="builtintype" id="7358172">error</span><span class="op" id="7358177">)</span>&nbsp;<span class="op" id="7358179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358182">if</span>&nbsp;<span class="builtinfunc" id="7358185">len</span><span class="op" id="7358188">(</span><span class="ident" id="7358189"><a href="/database/sql/fakedb_test.go.html#7358142">parts</a></span><span class="op" id="7358194">)</span>&nbsp;<span class="op" id="7358196">!=</span>&nbsp;<span class="num" id="7358199">2</span>&nbsp;<span class="op" id="7358201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358205"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358209">.</span><span class="ident" id="7358210">Close</span><span class="op" id="7358215">(</span><span class="op" id="7358216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358220">return</span>&nbsp;<span class="ident" id="7358227">nil</span><span class="op" id="7358230">,</span>&nbsp;<span class="ident" id="7358232"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7358236">(</span><span class="string" id="7358237">&#34;invalid&nbsp;INSERT&nbsp;syntax&nbsp;with&nbsp;%d&nbsp;parts;&nbsp;want&nbsp;2&#34;</span><span class="op" id="7358282">,</span>&nbsp;<span class="builtinfunc" id="7358284">len</span><span class="op" id="7358287">(</span><span class="ident" id="7358288"><a href="/database/sql/fakedb_test.go.html#7358142">parts</a></span><span class="op" id="7358293">)</span><span class="op" id="7358294">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358300"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358304">.</span><span class="ident" id="7358305">table</span>&nbsp;<span class="op" id="7358311">=</span>&nbsp;<span class="ident" id="7358313"><a href="/database/sql/fakedb_test.go.html#7358142">parts</a></span><span class="op" id="7358318">[</span><span class="num" id="7358319">0</span><span class="op" id="7358320">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358323">for</span>&nbsp;<span class="ident" id="7358327">n</span><span class="op" id="7358328">,</span>&nbsp;<span class="ident" id="7358330">colspec</span>&nbsp;<span class="op" id="7358338">:=</span>&nbsp;<span class="keyword" id="7358341">range</span>&nbsp;<span class="ident" id="7358347"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7358354">.</span><span class="ident" id="7358355">Split</span><span class="op" id="7358360">(</span><span class="ident" id="7358361"><a href="/database/sql/fakedb_test.go.html#7358142">parts</a></span><span class="op" id="7358366">[</span><span class="num" id="7358367">1</span><span class="op" id="7358368">]</span><span class="op" id="7358369">,</span>&nbsp;<span class="string" id="7358371">&#34;,&#34;</span><span class="op" id="7358374">)</span>&nbsp;<span class="op" id="7358376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358380">nameVal</span>&nbsp;<span class="op" id="7358388">:=</span>&nbsp;<span class="ident" id="7358391"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7358398">.</span><span class="ident" id="7358399">Split</span><span class="op" id="7358404">(</span><span class="ident" id="7358405"><a href="/database/sql/fakedb_test.go.html#7358330">colspec</a></span><span class="op" id="7358412">,</span>&nbsp;<span class="string" id="7358414">&#34;=&#34;</span><span class="op" id="7358417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358421">if</span>&nbsp;<span class="builtinfunc" id="7358424">len</span><span class="op" id="7358427">(</span><span class="ident" id="7358428"><a href="/database/sql/fakedb_test.go.html#7358380">nameVal</a></span><span class="op" id="7358435">)</span>&nbsp;<span class="op" id="7358437">!=</span>&nbsp;<span class="num" id="7358440">2</span>&nbsp;<span class="op" id="7358442">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358447"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358451">.</span><span class="ident" id="7358452">Close</span><span class="op" id="7358457">(</span><span class="op" id="7358458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358463">return</span>&nbsp;<span class="ident" id="7358470">nil</span><span class="op" id="7358473">,</span>&nbsp;<span class="ident" id="7358475"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7358479">(</span><span class="string" id="7358480">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;has&nbsp;invalid&nbsp;column&nbsp;spec&nbsp;of&nbsp;%q&nbsp;(index&nbsp;%d)&#34;</span><span class="op" id="7358538">,</span>&nbsp;<span class="ident" id="7358540"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358544">.</span><span class="ident" id="7358545">table</span><span class="op" id="7358550">,</span>&nbsp;<span class="ident" id="7358552"><a href="/database/sql/fakedb_test.go.html#7358330">colspec</a></span><span class="op" id="7358559">,</span>&nbsp;<span class="ident" id="7358561"><a href="/database/sql/fakedb_test.go.html#7358327">n</a></span><span class="op" id="7358562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358570">column</span><span class="op" id="7358576">,</span>&nbsp;<span class="ident" id="7358578">value</span>&nbsp;<span class="op" id="7358584">:=</span>&nbsp;<span class="ident" id="7358587"><a href="/database/sql/fakedb_test.go.html#7358380">nameVal</a></span><span class="op" id="7358594">[</span><span class="num" id="7358595">0</span><span class="op" id="7358596">]</span><span class="op" id="7358597">,</span>&nbsp;<span class="ident" id="7358599"><a href="/database/sql/fakedb_test.go.html#7358380">nameVal</a></span><span class="op" id="7358606">[</span><span class="num" id="7358607">1</span><span class="op" id="7358608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358612">ctype</span><span class="op" id="7358617">,</span>&nbsp;<span class="ident" id="7358619">ok</span>&nbsp;<span class="op" id="7358622">:=</span>&nbsp;<span class="ident" id="7358625"><a href="/database/sql/fakedb_test.go.html#7358099">c</a></span><span class="op" id="7358626">.</span><span class="ident" id="7358627">db</span><span class="op" id="7358629">.</span><span class="ident" id="7358630">columnType</span><span class="op" id="7358640">(</span><span class="ident" id="7358641"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358645">.</span><span class="ident" id="7358646">table</span><span class="op" id="7358651">,</span>&nbsp;<span class="ident" id="7358653"><a href="/database/sql/fakedb_test.go.html#7358570">column</a></span><span class="op" id="7358659">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358663">if</span>&nbsp;<span class="op" id="7358666">!</span><span class="ident" id="7358667"><a href="/database/sql/fakedb_test.go.html#7358619">ok</a></span>&nbsp;<span class="op" id="7358670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358675"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358679">.</span><span class="ident" id="7358680">Close</span><span class="op" id="7358685">(</span><span class="op" id="7358686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358691">return</span>&nbsp;<span class="ident" id="7358698">nil</span><span class="op" id="7358701">,</span>&nbsp;<span class="ident" id="7358703"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7358707">(</span><span class="string" id="7358708">&#34;INSERT&nbsp;table&nbsp;%q&nbsp;references&nbsp;non-existent&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7358759">,</span>&nbsp;<span class="ident" id="7358761"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358765">.</span><span class="ident" id="7358766">table</span><span class="op" id="7358771">,</span>&nbsp;<span class="ident" id="7358773"><a href="/database/sql/fakedb_test.go.html#7358570">column</a></span><span class="op" id="7358779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7358783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358787"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358791">.</span><span class="ident" id="7358792">colName</span>&nbsp;<span class="op" id="7358800">=</span>&nbsp;<span class="builtinfunc" id="7358802">append</span><span class="op" id="7358808">(</span><span class="ident" id="7358809"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7358813">.</span><span class="ident" id="7358814">colName</span><span class="op" id="7358821">,</span>&nbsp;<span class="ident" id="7358823"><a href="/database/sql/fakedb_test.go.html#7358570">column</a></span><span class="op" id="7358829">)</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358834">if</span>&nbsp;<span class="ident" id="7358837"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span>&nbsp;<span class="op" id="7358843">!=</span>&nbsp;<span class="string" id="7358846">&#34;?&#34;</span>&nbsp;<span class="op" id="7358850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358855">var</span>&nbsp;<span class="ident" id="7358859">subsetVal</span>&nbsp;<span class="keyword" id="7358869">interface</span><span class="op" id="7358878">{</span><span class="op" id="7358879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7358884">//&nbsp;Convert&nbsp;to&nbsp;driver&nbsp;subset&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358920">switch</span>&nbsp;<span class="ident" id="7358927"><a href="/database/sql/fakedb_test.go.html#7358612">ctype</a></span>&nbsp;<span class="op" id="7358933">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358938">case</span>&nbsp;<span class="string" id="7358943">&#34;string&#34;</span><span class="op" id="7358951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7358957"><a href="/database/sql/fakedb_test.go.html#7358859">subsetVal</a></span>&nbsp;<span class="op" id="7358967">=</span>&nbsp;<span class="op" id="7358969">[</span><span class="op" id="7358970">]</span><span class="builtintype" id="7358971">byte</span><span class="op" id="7358975">(</span><span class="ident" id="7358976"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span><span class="op" id="7358981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7358986">case</span>&nbsp;<span class="string" id="7358991">&#34;blob&#34;</span><span class="op" id="7358997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359003"><a href="/database/sql/fakedb_test.go.html#7358859">subsetVal</a></span>&nbsp;<span class="op" id="7359013">=</span>&nbsp;<span class="op" id="7359015">[</span><span class="op" id="7359016">]</span><span class="builtintype" id="7359017">byte</span><span class="op" id="7359021">(</span><span class="ident" id="7359022"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span><span class="op" id="7359027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359032">case</span>&nbsp;<span class="string" id="7359037">&#34;int32&#34;</span><span class="op" id="7359044">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359050">i</span><span class="op" id="7359051">,</span>&nbsp;<span class="ident" id="7359053">err</span>&nbsp;<span class="op" id="7359057">:=</span>&nbsp;<span class="ident" id="7359060"><a href="/database/sql/fakedb_test.go.html#7348539">strconv</a></span><span class="op" id="7359067">.</span><span class="ident" id="7359068">Atoi</span><span class="op" id="7359072">(</span><span class="ident" id="7359073"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span><span class="op" id="7359078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359084">if</span>&nbsp;<span class="ident" id="7359087"><a href="/database/sql/fakedb_test.go.html#7359053">err</a></span>&nbsp;<span class="op" id="7359091">!=</span>&nbsp;<span class="ident" id="7359094">nil</span>&nbsp;<span class="op" id="7359098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359105"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359109">.</span><span class="ident" id="7359110">Close</span><span class="op" id="7359115">(</span><span class="op" id="7359116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359123">return</span>&nbsp;<span class="ident" id="7359130">nil</span><span class="op" id="7359133">,</span>&nbsp;<span class="ident" id="7359135"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7359139">(</span><span class="string" id="7359140">&#34;invalid&nbsp;conversion&nbsp;to&nbsp;int32&nbsp;from&nbsp;%q&#34;</span><span class="op" id="7359177">,</span>&nbsp;<span class="ident" id="7359179"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span><span class="op" id="7359184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359190">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359196"><a href="/database/sql/fakedb_test.go.html#7358859">subsetVal</a></span>&nbsp;<span class="op" id="7359206">=</span>&nbsp;<span class="ident" id="7359208">int64</span><span class="op" id="7359213">(</span><span class="ident" id="7359214"><a href="/database/sql/fakedb_test.go.html#7359050">i</a></span><span class="op" id="7359215">)</span>&nbsp;<span class="comment" id="7359217">//&nbsp;int64&nbsp;is&nbsp;a&nbsp;subset&nbsp;type,&nbsp;but&nbsp;not&nbsp;int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359261">default</span><span class="op" id="7359268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359274"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359278">.</span><span class="ident" id="7359279">Close</span><span class="op" id="7359284">(</span><span class="op" id="7359285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359291">return</span>&nbsp;<span class="ident" id="7359298">nil</span><span class="op" id="7359301">,</span>&nbsp;<span class="ident" id="7359303"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7359307">(</span><span class="string" id="7359308">&#34;unsupported&nbsp;conversion&nbsp;for&nbsp;pre-bound&nbsp;parameter&nbsp;%q&nbsp;to&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7359370">,</span>&nbsp;<span class="ident" id="7359372"><a href="/database/sql/fakedb_test.go.html#7358578">value</a></span><span class="op" id="7359377">,</span>&nbsp;<span class="ident" id="7359379"><a href="/database/sql/fakedb_test.go.html#7358612">ctype</a></span><span class="op" id="7359384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359389">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359394"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359398">.</span><span class="ident" id="7359399">colValue</span>&nbsp;<span class="op" id="7359408">=</span>&nbsp;<span class="builtinfunc" id="7359410">append</span><span class="op" id="7359416">(</span><span class="ident" id="7359417"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359421">.</span><span class="ident" id="7359422">colValue</span><span class="op" id="7359430">,</span>&nbsp;<span class="ident" id="7359432"><a href="/database/sql/fakedb_test.go.html#7358859">subsetVal</a></span><span class="op" id="7359441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359445">}</span>&nbsp;<span class="keyword" id="7359447">else</span>&nbsp;<span class="op" id="7359452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359457"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359461">.</span><span class="ident" id="7359462">placeholders</span><span class="op" id="7359474">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359480"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359484">.</span><span class="ident" id="7359485">placeholderConverter</span>&nbsp;<span class="op" id="7359506">=</span>&nbsp;<span class="builtinfunc" id="7359508">append</span><span class="op" id="7359514">(</span><span class="ident" id="7359515"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359519">.</span><span class="ident" id="7359520">placeholderConverter</span><span class="op" id="7359540">,</span>&nbsp;<span class="ident" id="7359542"><a href="/database/sql/fakedb_test.go.html#7367707">converterForType</a></span><span class="op" id="7359558">(</span><span class="ident" id="7359559"><a href="/database/sql/fakedb_test.go.html#7358612">ctype</a></span><span class="op" id="7359564">)</span><span class="op" id="7359565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359570"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359574">.</span><span class="ident" id="7359575">colValue</span>&nbsp;<span class="op" id="7359584">=</span>&nbsp;<span class="builtinfunc" id="7359586">append</span><span class="op" id="7359592">(</span><span class="ident" id="7359593"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359597">.</span><span class="ident" id="7359598">colValue</span><span class="op" id="7359606">,</span>&nbsp;<span class="string" id="7359608">&#34;?&#34;</span><span class="op" id="7359611">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359621">return</span>&nbsp;<span class="ident" id="7359628"><a href="/database/sql/fakedb_test.go.html#7358126">stmt</a></span><span class="op" id="7359632">,</span>&nbsp;<span class="ident" id="7359634">nil</span><br>
<span class="lineno"></span><span class="op" id="7359638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7359641">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7359680">var</span>&nbsp;<span class="ident" id="7359684">hookPrepareBadConn</span>&nbsp;<span class="keyword" id="7359703">func</span><span class="op" id="7359707">(</span><span class="op" id="7359708">)</span>&nbsp;<span class="builtintype" id="7359710">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7359716">func</span>&nbsp;<span class="op" id="7359721">(</span><span class="ident" id="7359722">c</span>&nbsp;<span class="op" id="7359724">*</span><span class="ident" id="7359725"><a href="/database/sql/fakedb_test.go.html#7350045">fakeConn</a></span><span class="op" id="7359733">)</span>&nbsp;<span class="ident" id="7359735">Prepare</span><span class="op" id="7359742">(</span><span class="ident" id="7359743">query</span>&nbsp;<span class="builtintype" id="7359749">string</span><span class="op" id="7359755">)</span>&nbsp;<span class="op" id="7359757">(</span><span class="ident" id="7359758"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7359764">.</span><span class="ident" id="7359765">Stmt</span><span class="op" id="7359769">,</span>&nbsp;<span class="builtintype" id="7359771">error</span><span class="op" id="7359776">)</span>&nbsp;<span class="op" id="7359778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359781"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7359782">.</span><span class="ident" id="7359783">numPrepare</span><span class="op" id="7359793">++</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359797">if</span>&nbsp;<span class="ident" id="7359800"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7359801">.</span><span class="ident" id="7359802">db</span>&nbsp;<span class="op" id="7359805">==</span>&nbsp;<span class="ident" id="7359808">nil</span>&nbsp;<span class="op" id="7359812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7359816">panic</span><span class="op" id="7359821">(</span><span class="string" id="7359822">&#34;nil&nbsp;c.db;&nbsp;conn&nbsp;=&nbsp;&#34;</span>&nbsp;<span class="op" id="7359842">+</span>&nbsp;<span class="ident" id="7359844"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7359847">.</span><span class="ident" id="7359848">Sprintf</span><span class="op" id="7359855">(</span><span class="string" id="7359856">&#34;%#v&#34;</span><span class="op" id="7359861">,</span>&nbsp;<span class="ident" id="7359863"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7359864">)</span><span class="op" id="7359865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359872">if</span>&nbsp;<span class="ident" id="7359875"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span>&nbsp;<span class="op" id="7359894">!=</span>&nbsp;<span class="ident" id="7359897">nil</span>&nbsp;<span class="op" id="7359901">&amp;&amp;</span>&nbsp;<span class="ident" id="7359904"><a href="/database/sql/fakedb_test.go.html#7359684">hookPrepareBadConn</a></span><span class="op" id="7359922">(</span><span class="op" id="7359923">)</span>&nbsp;<span class="op" id="7359925">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7359929">return</span>&nbsp;<span class="ident" id="7359936">nil</span><span class="op" id="7359939">,</span>&nbsp;<span class="ident" id="7359941"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7359947">.</span><span class="ident" id="7359948">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7359960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7359964">parts</span>&nbsp;<span class="op" id="7359970">:=</span>&nbsp;<span class="ident" id="7359973"><a href="/database/sql/fakedb_test.go.html#7348550">strings</a></span><span class="op" id="7359980">.</span><span class="ident" id="7359981">Split</span><span class="op" id="7359986">(</span><span class="ident" id="7359987"><a href="/database/sql/fakedb_test.go.html#7359743">query</a></span><span class="op" id="7359992">,</span>&nbsp;<span class="string" id="7359994">&#34;|&#34;</span><span class="op" id="7359997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360000">if</span>&nbsp;<span class="builtinfunc" id="7360003">len</span><span class="op" id="7360006">(</span><span class="ident" id="7360007"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360012">)</span>&nbsp;<span class="op" id="7360014">&lt;</span>&nbsp;<span class="num" id="7360016">1</span>&nbsp;<span class="op" id="7360018">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360022">return</span>&nbsp;<span class="ident" id="7360029">nil</span><span class="op" id="7360032">,</span>&nbsp;<span class="ident" id="7360034"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7360038">(</span><span class="string" id="7360039">&#34;empty&nbsp;query&#34;</span><span class="op" id="7360052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360058">cmd</span>&nbsp;<span class="op" id="7360062">:=</span>&nbsp;<span class="ident" id="7360065"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360070">[</span><span class="num" id="7360071">0</span><span class="op" id="7360072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360075"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span>&nbsp;<span class="op" id="7360081">=</span>&nbsp;<span class="ident" id="7360083"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360088">[</span><span class="num" id="7360089">1</span><span class="op" id="7360090">:</span><span class="op" id="7360091">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360094">stmt</span>&nbsp;<span class="op" id="7360099">:=</span>&nbsp;<span class="op" id="7360102">&amp;</span><span class="ident" id="7360103"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7360111">{</span><span class="ident" id="7360112">q</span><span class="op" id="7360113">:</span>&nbsp;<span class="ident" id="7360115"><a href="/database/sql/fakedb_test.go.html#7359743">query</a></span><span class="op" id="7360120">,</span>&nbsp;<span class="ident" id="7360122">c</span><span class="op" id="7360123">:</span>&nbsp;<span class="ident" id="7360125"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360126">,</span>&nbsp;<span class="ident" id="7360128">cmd</span><span class="op" id="7360131">:</span>&nbsp;<span class="ident" id="7360133"><a href="/database/sql/fakedb_test.go.html#7360058">cmd</a></span><span class="op" id="7360136">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360139"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360140">.</span><span class="ident" id="7360141">incrStat</span><span class="op" id="7360149">(</span><span class="op" id="7360150">&amp;</span><span class="ident" id="7360151"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360152">.</span><span class="ident" id="7360153">stmtsMade</span><span class="op" id="7360162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360165">switch</span>&nbsp;<span class="ident" id="7360172"><a href="/database/sql/fakedb_test.go.html#7360058">cmd</a></span>&nbsp;<span class="op" id="7360176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360179">case</span>&nbsp;<span class="string" id="7360184">&#34;WIPE&#34;</span><span class="op" id="7360190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360194">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360206">case</span>&nbsp;<span class="string" id="7360211">&#34;SELECT&#34;</span><span class="op" id="7360219">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360223">return</span>&nbsp;<span class="ident" id="7360230"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360231">.</span><span class="ident" id="7360232">prepareSelect</span><span class="op" id="7360245">(</span><span class="ident" id="7360246"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360250">,</span>&nbsp;<span class="ident" id="7360252"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360260">case</span>&nbsp;<span class="string" id="7360265">&#34;CREATE&#34;</span><span class="op" id="7360273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360277">return</span>&nbsp;<span class="ident" id="7360284"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360285">.</span><span class="ident" id="7360286">prepareCreate</span><span class="op" id="7360299">(</span><span class="ident" id="7360300"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360304">,</span>&nbsp;<span class="ident" id="7360306"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360314">case</span>&nbsp;<span class="string" id="7360319">&#34;INSERT&#34;</span><span class="op" id="7360327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360331">return</span>&nbsp;<span class="ident" id="7360338"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360339">.</span><span class="ident" id="7360340">prepareInsert</span><span class="op" id="7360353">(</span><span class="ident" id="7360354"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360358">,</span>&nbsp;<span class="ident" id="7360360"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360365">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360368">case</span>&nbsp;<span class="string" id="7360373">&#34;NOSERT&#34;</span><span class="op" id="7360381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360385">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7360465">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360509">return</span>&nbsp;<span class="ident" id="7360516"><a href="/database/sql/fakedb_test.go.html#7359722">c</a></span><span class="op" id="7360517">.</span><span class="ident" id="7360518">prepareInsert</span><span class="op" id="7360531">(</span><span class="ident" id="7360532"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360536">,</span>&nbsp;<span class="ident" id="7360538"><a href="/database/sql/fakedb_test.go.html#7359964">parts</a></span><span class="op" id="7360543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360546">default</span><span class="op" id="7360553">:</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7360557"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360561">.</span><span class="ident" id="7360562">Close</span><span class="op" id="7360567">(</span><span class="op" id="7360568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360572">return</span>&nbsp;<span class="ident" id="7360579">nil</span><span class="op" id="7360582">,</span>&nbsp;<span class="ident" id="7360584"><a href="/database/sql/fakedb_test.go.html#7356116">errf</a></span><span class="op" id="7360588">(</span><span class="string" id="7360589">&#34;unsupported&nbsp;command&nbsp;type&nbsp;%q&#34;</span><span class="op" id="7360618">,</span>&nbsp;<span class="ident" id="7360620"><a href="/database/sql/fakedb_test.go.html#7360058">cmd</a></span><span class="op" id="7360623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360629">return</span>&nbsp;<span class="ident" id="7360636"><a href="/database/sql/fakedb_test.go.html#7360094">stmt</a></span><span class="op" id="7360640">,</span>&nbsp;<span class="ident" id="7360642">nil</span><br>
<span class="lineno"></span><span class="op" id="7360646">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="7360649">func</span>&nbsp;<span class="op" id="7360654">(</span><span class="ident" id="7360655">s</span>&nbsp;<span class="op" id="7360657">*</span><span class="ident" id="7360658"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7360666">)</span>&nbsp;<span class="ident" id="7360668">ColumnConverter</span><span class="op" id="7360683">(</span><span class="ident" id="7360684">idx</span>&nbsp;<span class="builtintype" id="7360688">int</span><span class="op" id="7360691">)</span>&nbsp;<span class="ident" id="7360693"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7360699">.</span><span class="ident" id="7360700">ValueConverter</span>&nbsp;<span class="op" id="7360715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360718">if</span>&nbsp;<span class="builtinfunc" id="7360721">len</span><span class="op" id="7360724">(</span><span class="ident" id="7360725"><a href="/database/sql/fakedb_test.go.html#7360655">s</a></span><span class="op" id="7360726">.</span><span class="ident" id="7360727">placeholderConverter</span><span class="op" id="7360747">)</span>&nbsp;<span class="op" id="7360749">==</span>&nbsp;<span class="num" id="7360752">0</span>&nbsp;<span class="op" id="7360754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360758">return</span>&nbsp;<span class="ident" id="7360765"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7360771">.</span><span class="ident" id="7360772">DefaultParameterConverter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360799">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360802">return</span>&nbsp;<span class="ident" id="7360809"><a href="/database/sql/fakedb_test.go.html#7360655">s</a></span><span class="op" id="7360810">.</span><span class="ident" id="7360811">placeholderConverter</span><span class="op" id="7360831">[</span><span class="ident" id="7360832"><a href="/database/sql/fakedb_test.go.html#7360684">idx</a></span><span class="op" id="7360835">]</span><br>
<span class="lineno"></span><span class="op" id="7360837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7360840">func</span>&nbsp;<span class="op" id="7360845">(</span><span class="ident" id="7360846">s</span>&nbsp;<span class="op" id="7360848">*</span><span class="ident" id="7360849"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7360857">)</span>&nbsp;<span class="ident" id="7360859">Close</span><span class="op" id="7360864">(</span><span class="op" id="7360865">)</span>&nbsp;<span class="builtintype" id="7360867">error</span>&nbsp;<span class="op" id="7360873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360876">if</span>&nbsp;<span class="ident" id="7360879"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7360880">.</span><span class="ident" id="7360881">c</span>&nbsp;<span class="op" id="7360883">==</span>&nbsp;<span class="ident" id="7360886">nil</span>&nbsp;<span class="op" id="7360890">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7360894">panic</span><span class="op" id="7360899">(</span><span class="string" id="7360900">&#34;nil&nbsp;conn&nbsp;in&nbsp;fakeStmt.Close&#34;</span><span class="op" id="7360928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7360931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7360934">if</span>&nbsp;<span class="ident" id="7360937"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7360938">.</span><span class="ident" id="7360939">c</span><span class="op" id="7360940">.</span><span class="ident" id="7360941">db</span>&nbsp;<span class="op" id="7360944">==</span>&nbsp;<span class="ident" id="7360947">nil</span>&nbsp;<span class="op" id="7360951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7360955">panic</span><span class="op" id="7360960">(</span><span class="string" id="7360961">&#34;in&nbsp;fakeStmt.Close,&nbsp;conn&#39;s&nbsp;db&nbsp;is&nbsp;nil&nbsp;(already&nbsp;closed)&#34;</span><span class="op" id="7361015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361018">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361021">if</span>&nbsp;<span class="op" id="7361024">!</span><span class="ident" id="7361025"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7361026">.</span><span class="ident" id="7361027">closed</span>&nbsp;<span class="op" id="7361034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361038"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7361039">.</span><span class="ident" id="7361040">c</span><span class="op" id="7361041">.</span><span class="ident" id="7361042">incrStat</span><span class="op" id="7361050">(</span><span class="op" id="7361051">&amp;</span><span class="ident" id="7361052"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7361053">.</span><span class="ident" id="7361054">c</span><span class="op" id="7361055">.</span><span class="ident" id="7361056">stmtsClosed</span><span class="op" id="7361067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361071"><a href="/database/sql/fakedb_test.go.html#7360846">s</a></span><span class="op" id="7361072">.</span><span class="ident" id="7361073">closed</span>&nbsp;<span class="op" id="7361080">=</span>&nbsp;<span class="builtintype" id="7361082">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361091">return</span>&nbsp;<span class="ident" id="7361098">nil</span><br>
<span class="lineno">520</span><span class="op" id="7361102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7361105">var</span>&nbsp;<span class="ident" id="7361109">errClosed</span>&nbsp;<span class="op" id="7361119">=</span>&nbsp;<span class="ident" id="7361121"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7361127">.</span><span class="ident" id="7361128">New</span><span class="op" id="7361131">(</span><span class="string" id="7361132">&#34;fakedb:&nbsp;statement&nbsp;has&nbsp;been&nbsp;closed&#34;</span><span class="op" id="7361167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7361170">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno">525</span><span class="keyword" id="7361209">var</span>&nbsp;<span class="ident" id="7361213">hookExecBadConn</span>&nbsp;<span class="keyword" id="7361229">func</span><span class="op" id="7361233">(</span><span class="op" id="7361234">)</span>&nbsp;<span class="builtintype" id="7361236">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7361242">func</span>&nbsp;<span class="op" id="7361247">(</span><span class="ident" id="7361248">s</span>&nbsp;<span class="op" id="7361250">*</span><span class="ident" id="7361251"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7361259">)</span>&nbsp;<span class="ident" id="7361261">Exec</span><span class="op" id="7361265">(</span><span class="ident" id="7361266">args</span>&nbsp;<span class="op" id="7361271">[</span><span class="op" id="7361272">]</span><span class="ident" id="7361273"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7361279">.</span><span class="ident" id="7361280">Value</span><span class="op" id="7361285">)</span>&nbsp;<span class="op" id="7361287">(</span><span class="ident" id="7361288"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7361294">.</span><span class="ident" id="7361295">Result</span><span class="op" id="7361301">,</span>&nbsp;<span class="builtintype" id="7361303">error</span><span class="op" id="7361308">)</span>&nbsp;<span class="op" id="7361310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361313">if</span>&nbsp;<span class="ident" id="7361316"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361317">.</span><span class="ident" id="7361318">closed</span>&nbsp;<span class="op" id="7361325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361329">return</span>&nbsp;<span class="ident" id="7361336">nil</span><span class="op" id="7361339">,</span>&nbsp;<span class="ident" id="7361341"><a href="/database/sql/fakedb_test.go.html#7361109">errClosed</a></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361356">if</span>&nbsp;<span class="ident" id="7361359"><a href="/database/sql/fakedb_test.go.html#7361213">hookExecBadConn</a></span>&nbsp;<span class="op" id="7361375">!=</span>&nbsp;<span class="ident" id="7361378">nil</span>&nbsp;<span class="op" id="7361382">&amp;&amp;</span>&nbsp;<span class="ident" id="7361385"><a href="/database/sql/fakedb_test.go.html#7361213">hookExecBadConn</a></span><span class="op" id="7361400">(</span><span class="op" id="7361401">)</span>&nbsp;<span class="op" id="7361403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361407">return</span>&nbsp;<span class="ident" id="7361414">nil</span><span class="op" id="7361417">,</span>&nbsp;<span class="ident" id="7361419"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7361425">.</span><span class="ident" id="7361426">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361438">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361442">err</span>&nbsp;<span class="op" id="7361446">:=</span>&nbsp;<span class="ident" id="7361449"><a href="/database/sql/fakedb_test.go.html#7355052">checkSubsetTypes</a></span><span class="op" id="7361465">(</span><span class="ident" id="7361466"><a href="/database/sql/fakedb_test.go.html#7361266">args</a></span><span class="op" id="7361470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361473">if</span>&nbsp;<span class="ident" id="7361476"><a href="/database/sql/fakedb_test.go.html#7361442">err</a></span>&nbsp;<span class="op" id="7361480">!=</span>&nbsp;<span class="ident" id="7361483">nil</span>&nbsp;<span class="op" id="7361487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361491">return</span>&nbsp;<span class="ident" id="7361498">nil</span><span class="op" id="7361501">,</span>&nbsp;<span class="ident" id="7361503"><a href="/database/sql/fakedb_test.go.html#7361442">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361508">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361512">db</span>&nbsp;<span class="op" id="7361515">:=</span>&nbsp;<span class="ident" id="7361518"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361519">.</span><span class="ident" id="7361520">c</span><span class="op" id="7361521">.</span><span class="ident" id="7361522">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361526">switch</span>&nbsp;<span class="ident" id="7361533"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361534">.</span><span class="ident" id="7361535">cmd</span>&nbsp;<span class="op" id="7361539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361542">case</span>&nbsp;<span class="string" id="7361547">&#34;WIPE&#34;</span><span class="op" id="7361553">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361557"><a href="/database/sql/fakedb_test.go.html#7361512">db</a></span><span class="op" id="7361559">.</span><span class="ident" id="7361560">wipe</span><span class="op" id="7361564">(</span><span class="op" id="7361565">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361569">return</span>&nbsp;<span class="ident" id="7361576"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7361582">.</span><span class="ident" id="7361583">ResultNoRows</span><span class="op" id="7361595">,</span>&nbsp;<span class="ident" id="7361597">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361602">case</span>&nbsp;<span class="string" id="7361607">&#34;CREATE&#34;</span><span class="op" id="7361615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361619">if</span>&nbsp;<span class="ident" id="7361622">err</span>&nbsp;<span class="op" id="7361626">:=</span>&nbsp;<span class="ident" id="7361629"><a href="/database/sql/fakedb_test.go.html#7361512">db</a></span><span class="op" id="7361631">.</span><span class="ident" id="7361632">createTable</span><span class="op" id="7361643">(</span><span class="ident" id="7361644"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361645">.</span><span class="ident" id="7361646">table</span><span class="op" id="7361651">,</span>&nbsp;<span class="ident" id="7361653"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361654">.</span><span class="ident" id="7361655">colName</span><span class="op" id="7361662">,</span>&nbsp;<span class="ident" id="7361664"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361665">.</span><span class="ident" id="7361666">colType</span><span class="op" id="7361673">)</span><span class="op" id="7361674">;</span>&nbsp;<span class="ident" id="7361676"><a href="/database/sql/fakedb_test.go.html#7361622">err</a></span>&nbsp;<span class="op" id="7361680">!=</span>&nbsp;<span class="ident" id="7361683">nil</span>&nbsp;<span class="op" id="7361687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361692">return</span>&nbsp;<span class="ident" id="7361699">nil</span><span class="op" id="7361702">,</span>&nbsp;<span class="ident" id="7361704"><a href="/database/sql/fakedb_test.go.html#7361622">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361710">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361714">return</span>&nbsp;<span class="ident" id="7361721"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7361727">.</span><span class="ident" id="7361728">ResultNoRows</span><span class="op" id="7361740">,</span>&nbsp;<span class="ident" id="7361742">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361747">case</span>&nbsp;<span class="string" id="7361752">&#34;INSERT&#34;</span><span class="op" id="7361760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361764">return</span>&nbsp;<span class="ident" id="7361771"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361772">.</span><span class="ident" id="7361773">execInsert</span><span class="op" id="7361783">(</span><span class="ident" id="7361784"><a href="/database/sql/fakedb_test.go.html#7361266">args</a></span><span class="op" id="7361788">,</span>&nbsp;<span class="builtintype" id="7361790">true</span><span class="op" id="7361794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361797">case</span>&nbsp;<span class="string" id="7361802">&#34;NOSERT&#34;</span><span class="op" id="7361810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7361814">//&nbsp;Do&nbsp;all&nbsp;the&nbsp;prep-work&nbsp;like&nbsp;for&nbsp;an&nbsp;INSERT&nbsp;but&nbsp;don&#39;t&nbsp;actually&nbsp;insert&nbsp;the&nbsp;row.</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7361894">//&nbsp;Used&nbsp;for&nbsp;some&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7361938">return</span>&nbsp;<span class="ident" id="7361945"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7361946">.</span><span class="ident" id="7361947">execInsert</span><span class="op" id="7361957">(</span><span class="ident" id="7361958"><a href="/database/sql/fakedb_test.go.html#7361266">args</a></span><span class="op" id="7361962">,</span>&nbsp;<span class="builtintype" id="7361964">false</span><span class="op" id="7361969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7361972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7361975"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7361978">.</span><span class="ident" id="7361979">Printf</span><span class="op" id="7361985">(</span><span class="string" id="7361986">&#34;EXEC&nbsp;statement,&nbsp;cmd=%q:&nbsp;%#v\n&#34;</span><span class="op" id="7362017">,</span>&nbsp;<span class="ident" id="7362019"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7362020">.</span><span class="ident" id="7362021">cmd</span><span class="op" id="7362024">,</span>&nbsp;<span class="ident" id="7362026"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7362027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362030">return</span>&nbsp;<span class="ident" id="7362037">nil</span><span class="op" id="7362040">,</span>&nbsp;<span class="ident" id="7362042"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7362045">.</span><span class="ident" id="7362046">Errorf</span><span class="op" id="7362052">(</span><span class="string" id="7362053">&#34;unimplemented&nbsp;statement&nbsp;Exec&nbsp;command&nbsp;type&nbsp;of&nbsp;%q&#34;</span><span class="op" id="7362102">,</span>&nbsp;<span class="ident" id="7362104"><a href="/database/sql/fakedb_test.go.html#7361248">s</a></span><span class="op" id="7362105">.</span><span class="ident" id="7362106">cmd</span><span class="op" id="7362109">)</span><br>
<span class="lineno">560</span><span class="op" id="7362111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7362114">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;true,&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="7362166">//&nbsp;When&nbsp;doInsert&nbsp;is&nbsp;false&nbsp;do&nbsp;prep-work&nbsp;and&nbsp;error&nbsp;checking,&nbsp;but&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="7362235">//&nbsp;actually&nbsp;add&nbsp;the&nbsp;row&nbsp;to&nbsp;the&nbsp;table.</span><br>
<span class="lineno">565</span><span class="keyword" id="7362273">func</span>&nbsp;<span class="op" id="7362278">(</span><span class="ident" id="7362279">s</span>&nbsp;<span class="op" id="7362281">*</span><span class="ident" id="7362282"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7362290">)</span>&nbsp;<span class="ident" id="7362292">execInsert</span><span class="op" id="7362302">(</span><span class="ident" id="7362303">args</span>&nbsp;<span class="op" id="7362308">[</span><span class="op" id="7362309">]</span><span class="ident" id="7362310"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7362316">.</span><span class="ident" id="7362317">Value</span><span class="op" id="7362322">,</span>&nbsp;<span class="ident" id="7362324">doInsert</span>&nbsp;<span class="builtintype" id="7362333">bool</span><span class="op" id="7362337">)</span>&nbsp;<span class="op" id="7362339">(</span><span class="ident" id="7362340"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7362346">.</span><span class="ident" id="7362347">Result</span><span class="op" id="7362353">,</span>&nbsp;<span class="builtintype" id="7362355">error</span><span class="op" id="7362360">)</span>&nbsp;<span class="op" id="7362362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362365">db</span>&nbsp;<span class="op" id="7362368">:=</span>&nbsp;<span class="ident" id="7362371"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7362372">.</span><span class="ident" id="7362373">c</span><span class="op" id="7362374">.</span><span class="ident" id="7362375">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362379">if</span>&nbsp;<span class="builtinfunc" id="7362382">len</span><span class="op" id="7362385">(</span><span class="ident" id="7362386"><a href="/database/sql/fakedb_test.go.html#7362303">args</a></span><span class="op" id="7362390">)</span>&nbsp;<span class="op" id="7362392">!=</span>&nbsp;<span class="ident" id="7362395"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7362396">.</span><span class="ident" id="7362397">placeholders</span>&nbsp;<span class="op" id="7362410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7362414">panic</span><span class="op" id="7362419">(</span><span class="string" id="7362420">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7362478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362481">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362484"><a href="/database/sql/fakedb_test.go.html#7362365">db</a></span><span class="op" id="7362486">.</span><span class="ident" id="7362487">mu</span><span class="op" id="7362489">.</span><span class="ident" id="7362490">Lock</span><span class="op" id="7362494">(</span><span class="op" id="7362495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362498">t</span><span class="op" id="7362499">,</span>&nbsp;<span class="ident" id="7362501">ok</span>&nbsp;<span class="op" id="7362504">:=</span>&nbsp;<span class="ident" id="7362507"><a href="/database/sql/fakedb_test.go.html#7362365">db</a></span><span class="op" id="7362509">.</span><span class="ident" id="7362510">table</span><span class="op" id="7362515">(</span><span class="ident" id="7362516"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7362517">.</span><span class="ident" id="7362518">table</span><span class="op" id="7362523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362526"><a href="/database/sql/fakedb_test.go.html#7362365">db</a></span><span class="op" id="7362528">.</span><span class="ident" id="7362529">mu</span><span class="op" id="7362531">.</span><span class="ident" id="7362532">Unlock</span><span class="op" id="7362538">(</span><span class="op" id="7362539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362542">if</span>&nbsp;<span class="op" id="7362545">!</span><span class="ident" id="7362546"><a href="/database/sql/fakedb_test.go.html#7362501">ok</a></span>&nbsp;<span class="op" id="7362549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362553">return</span>&nbsp;<span class="ident" id="7362560">nil</span><span class="op" id="7362563">,</span>&nbsp;<span class="ident" id="7362565"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7362568">.</span><span class="ident" id="7362569">Errorf</span><span class="op" id="7362575">(</span><span class="string" id="7362576">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7362608">,</span>&nbsp;<span class="ident" id="7362610"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7362611">.</span><span class="ident" id="7362612">table</span><span class="op" id="7362617">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362624"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7362625">.</span><span class="ident" id="7362626">mu</span><span class="op" id="7362628">.</span><span class="ident" id="7362629">Lock</span><span class="op" id="7362633">(</span><span class="op" id="7362634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362637">defer</span>&nbsp;<span class="ident" id="7362643"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7362644">.</span><span class="ident" id="7362645">mu</span><span class="op" id="7362647">.</span><span class="ident" id="7362648">Unlock</span><span class="op" id="7362654">(</span><span class="op" id="7362655">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362659">var</span>&nbsp;<span class="ident" id="7362663">cols</span>&nbsp;<span class="op" id="7362668">[</span><span class="op" id="7362669">]</span><span class="keyword" id="7362670">interface</span><span class="op" id="7362679">{</span><span class="op" id="7362680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362683">if</span>&nbsp;<span class="ident" id="7362686"><a href="/database/sql/fakedb_test.go.html#7362324">doInsert</a></span>&nbsp;<span class="op" id="7362695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362699"><a href="/database/sql/fakedb_test.go.html#7362663">cols</a></span>&nbsp;<span class="op" id="7362704">=</span>&nbsp;<span class="builtinfunc" id="7362706">make</span><span class="op" id="7362710">(</span><span class="op" id="7362711">[</span><span class="op" id="7362712">]</span><span class="keyword" id="7362713">interface</span><span class="op" id="7362722">{</span><span class="op" id="7362723">}</span><span class="op" id="7362724">,</span>&nbsp;<span class="builtinfunc" id="7362726">len</span><span class="op" id="7362729">(</span><span class="ident" id="7362730"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7362731">.</span><span class="ident" id="7362732">colname</span><span class="op" id="7362739">)</span><span class="op" id="7362740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362746">argPos</span>&nbsp;<span class="op" id="7362753">:=</span>&nbsp;<span class="num" id="7362756">0</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362759">for</span>&nbsp;<span class="ident" id="7362763">n</span><span class="op" id="7362764">,</span>&nbsp;<span class="ident" id="7362766">colname</span>&nbsp;<span class="op" id="7362774">:=</span>&nbsp;<span class="keyword" id="7362777">range</span>&nbsp;<span class="ident" id="7362783"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7362784">.</span><span class="ident" id="7362785">colName</span>&nbsp;<span class="op" id="7362793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7362797">colidx</span>&nbsp;<span class="op" id="7362804">:=</span>&nbsp;<span class="ident" id="7362807"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7362808">.</span><span class="ident" id="7362809">columnIndex</span><span class="op" id="7362820">(</span><span class="ident" id="7362821"><a href="/database/sql/fakedb_test.go.html#7362766">colname</a></span><span class="op" id="7362828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362832">if</span>&nbsp;<span class="ident" id="7362835"><a href="/database/sql/fakedb_test.go.html#7362797">colidx</a></span>&nbsp;<span class="op" id="7362842">==</span>&nbsp;<span class="op" id="7362845">-</span><span class="num" id="7362846">1</span>&nbsp;<span class="op" id="7362848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362853">return</span>&nbsp;<span class="ident" id="7362860">nil</span><span class="op" id="7362863">,</span>&nbsp;<span class="ident" id="7362865"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7362868">.</span><span class="ident" id="7362869">Errorf</span><span class="op" id="7362875">(</span><span class="string" id="7362876">&#34;fakedb:&nbsp;column&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&nbsp;or&nbsp;dropped&nbsp;since&nbsp;prepared&nbsp;statement&nbsp;was&nbsp;created&#34;</span><span class="op" id="7362957">,</span>&nbsp;<span class="ident" id="7362959"><a href="/database/sql/fakedb_test.go.html#7362766">colname</a></span><span class="op" id="7362966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7362970">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362974">var</span>&nbsp;<span class="ident" id="7362978">val</span>&nbsp;<span class="keyword" id="7362982">interface</span><span class="op" id="7362991">{</span><span class="op" id="7362992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7362996">if</span>&nbsp;<span class="ident" id="7362999">strvalue</span><span class="op" id="7363007">,</span>&nbsp;<span class="ident" id="7363009">ok</span>&nbsp;<span class="op" id="7363012">:=</span>&nbsp;<span class="ident" id="7363015"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7363016">.</span><span class="ident" id="7363017">colValue</span><span class="op" id="7363025">[</span><span class="ident" id="7363026"><a href="/database/sql/fakedb_test.go.html#7362763">n</a></span><span class="op" id="7363027">]</span><span class="op" id="7363028">.</span><span class="op" id="7363029">(</span><span class="builtintype" id="7363030">string</span><span class="op" id="7363036">)</span><span class="op" id="7363037">;</span>&nbsp;<span class="ident" id="7363039"><a href="/database/sql/fakedb_test.go.html#7363009">ok</a></span>&nbsp;<span class="op" id="7363042">&amp;&amp;</span>&nbsp;<span class="ident" id="7363045"><a href="/database/sql/fakedb_test.go.html#7362999">strvalue</a></span>&nbsp;<span class="op" id="7363054">==</span>&nbsp;<span class="string" id="7363057">&#34;?&#34;</span>&nbsp;<span class="op" id="7363061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363066"><a href="/database/sql/fakedb_test.go.html#7362978">val</a></span>&nbsp;<span class="op" id="7363070">=</span>&nbsp;<span class="ident" id="7363072"><a href="/database/sql/fakedb_test.go.html#7362303">args</a></span><span class="op" id="7363076">[</span><span class="ident" id="7363077"><a href="/database/sql/fakedb_test.go.html#7362746">argPos</a></span><span class="op" id="7363083">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363088"><a href="/database/sql/fakedb_test.go.html#7362746">argPos</a></span><span class="op" id="7363094">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363099">}</span>&nbsp;<span class="keyword" id="7363101">else</span>&nbsp;<span class="op" id="7363106">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363111"><a href="/database/sql/fakedb_test.go.html#7362978">val</a></span>&nbsp;<span class="op" id="7363115">=</span>&nbsp;<span class="ident" id="7363117"><a href="/database/sql/fakedb_test.go.html#7362279">s</a></span><span class="op" id="7363118">.</span><span class="ident" id="7363119">colValue</span><span class="op" id="7363127">[</span><span class="ident" id="7363128"><a href="/database/sql/fakedb_test.go.html#7362763">n</a></span><span class="op" id="7363129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363137">if</span>&nbsp;<span class="ident" id="7363140"><a href="/database/sql/fakedb_test.go.html#7362324">doInsert</a></span>&nbsp;<span class="op" id="7363149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363154"><a href="/database/sql/fakedb_test.go.html#7362663">cols</a></span><span class="op" id="7363158">[</span><span class="ident" id="7363159"><a href="/database/sql/fakedb_test.go.html#7362797">colidx</a></span><span class="op" id="7363165">]</span>&nbsp;<span class="op" id="7363167">=</span>&nbsp;<span class="ident" id="7363169"><a href="/database/sql/fakedb_test.go.html#7362978">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363175">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363182">if</span>&nbsp;<span class="ident" id="7363185"><a href="/database/sql/fakedb_test.go.html#7362324">doInsert</a></span>&nbsp;<span class="op" id="7363194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363198"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7363199">.</span><span class="ident" id="7363200">rows</span>&nbsp;<span class="op" id="7363205">=</span>&nbsp;<span class="builtinfunc" id="7363207">append</span><span class="op" id="7363213">(</span><span class="ident" id="7363214"><a href="/database/sql/fakedb_test.go.html#7362498">t</a></span><span class="op" id="7363215">.</span><span class="ident" id="7363216">rows</span><span class="op" id="7363220">,</span>&nbsp;<span class="op" id="7363222">&amp;</span><span class="ident" id="7363223"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><span class="op" id="7363226">{</span><span class="ident" id="7363227">cols</span><span class="op" id="7363231">:</span>&nbsp;<span class="ident" id="7363233"><a href="/database/sql/fakedb_test.go.html#7362663">cols</a></span><span class="op" id="7363237">}</span><span class="op" id="7363238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363241">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363244">return</span>&nbsp;<span class="ident" id="7363251"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7363257">.</span><span class="ident" id="7363258">RowsAffected</span><span class="op" id="7363270">(</span><span class="num" id="7363271">1</span><span class="op" id="7363272">)</span><span class="op" id="7363273">,</span>&nbsp;<span class="ident" id="7363275">nil</span><br>
<span class="lineno"></span><span class="op" id="7363279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7363282">//&nbsp;hook&nbsp;to&nbsp;simulate&nbsp;broken&nbsp;connections</span><br>
<span class="lineno"></span><span class="keyword" id="7363321">var</span>&nbsp;<span class="ident" id="7363325">hookQueryBadConn</span>&nbsp;<span class="keyword" id="7363342">func</span><span class="op" id="7363346">(</span><span class="op" id="7363347">)</span>&nbsp;<span class="builtintype" id="7363349">bool</span><br>
<span class="lineno">610</span><br>
<span class="lineno"></span><span class="keyword" id="7363355">func</span>&nbsp;<span class="op" id="7363360">(</span><span class="ident" id="7363361">s</span>&nbsp;<span class="op" id="7363363">*</span><span class="ident" id="7363364"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7363372">)</span>&nbsp;<span class="ident" id="7363374">Query</span><span class="op" id="7363379">(</span><span class="ident" id="7363380">args</span>&nbsp;<span class="op" id="7363385">[</span><span class="op" id="7363386">]</span><span class="ident" id="7363387"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7363393">.</span><span class="ident" id="7363394">Value</span><span class="op" id="7363399">)</span>&nbsp;<span class="op" id="7363401">(</span><span class="ident" id="7363402"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7363408">.</span><span class="ident" id="7363409">Rows</span><span class="op" id="7363413">,</span>&nbsp;<span class="builtintype" id="7363415">error</span><span class="op" id="7363420">)</span>&nbsp;<span class="op" id="7363422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363425">if</span>&nbsp;<span class="ident" id="7363428"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363429">.</span><span class="ident" id="7363430">closed</span>&nbsp;<span class="op" id="7363437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363441">return</span>&nbsp;<span class="ident" id="7363448">nil</span><span class="op" id="7363451">,</span>&nbsp;<span class="ident" id="7363453"><a href="/database/sql/fakedb_test.go.html#7361109">errClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363464">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363468">if</span>&nbsp;<span class="ident" id="7363471"><a href="/database/sql/fakedb_test.go.html#7363325">hookQueryBadConn</a></span>&nbsp;<span class="op" id="7363488">!=</span>&nbsp;<span class="ident" id="7363491">nil</span>&nbsp;<span class="op" id="7363495">&amp;&amp;</span>&nbsp;<span class="ident" id="7363498"><a href="/database/sql/fakedb_test.go.html#7363325">hookQueryBadConn</a></span><span class="op" id="7363514">(</span><span class="op" id="7363515">)</span>&nbsp;<span class="op" id="7363517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363521">return</span>&nbsp;<span class="ident" id="7363528">nil</span><span class="op" id="7363531">,</span>&nbsp;<span class="ident" id="7363533"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7363539">.</span><span class="ident" id="7363540">ErrBadConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363556">err</span>&nbsp;<span class="op" id="7363560">:=</span>&nbsp;<span class="ident" id="7363563"><a href="/database/sql/fakedb_test.go.html#7355052">checkSubsetTypes</a></span><span class="op" id="7363579">(</span><span class="ident" id="7363580"><a href="/database/sql/fakedb_test.go.html#7363380">args</a></span><span class="op" id="7363584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363587">if</span>&nbsp;<span class="ident" id="7363590"><a href="/database/sql/fakedb_test.go.html#7363556">err</a></span>&nbsp;<span class="op" id="7363594">!=</span>&nbsp;<span class="ident" id="7363597">nil</span>&nbsp;<span class="op" id="7363601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363605">return</span>&nbsp;<span class="ident" id="7363612">nil</span><span class="op" id="7363615">,</span>&nbsp;<span class="ident" id="7363617"><a href="/database/sql/fakedb_test.go.html#7363556">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363626">db</span>&nbsp;<span class="op" id="7363629">:=</span>&nbsp;<span class="ident" id="7363632"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363633">.</span><span class="ident" id="7363634">c</span><span class="op" id="7363635">.</span><span class="ident" id="7363636">db</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363640">if</span>&nbsp;<span class="builtinfunc" id="7363643">len</span><span class="op" id="7363646">(</span><span class="ident" id="7363647"><a href="/database/sql/fakedb_test.go.html#7363380">args</a></span><span class="op" id="7363651">)</span>&nbsp;<span class="op" id="7363653">!=</span>&nbsp;<span class="ident" id="7363656"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363657">.</span><span class="ident" id="7363658">placeholders</span>&nbsp;<span class="op" id="7363671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7363675">panic</span><span class="op" id="7363680">(</span><span class="string" id="7363681">&#34;error&nbsp;in&nbsp;pkg&nbsp;db;&nbsp;should&nbsp;only&nbsp;get&nbsp;here&nbsp;if&nbsp;size&nbsp;is&nbsp;correct&#34;</span><span class="op" id="7363739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363746"><a href="/database/sql/fakedb_test.go.html#7363626">db</a></span><span class="op" id="7363748">.</span><span class="ident" id="7363749">mu</span><span class="op" id="7363751">.</span><span class="ident" id="7363752">Lock</span><span class="op" id="7363756">(</span><span class="op" id="7363757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363760">t</span><span class="op" id="7363761">,</span>&nbsp;<span class="ident" id="7363763">ok</span>&nbsp;<span class="op" id="7363766">:=</span>&nbsp;<span class="ident" id="7363769"><a href="/database/sql/fakedb_test.go.html#7363626">db</a></span><span class="op" id="7363771">.</span><span class="ident" id="7363772">table</span><span class="op" id="7363777">(</span><span class="ident" id="7363778"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363779">.</span><span class="ident" id="7363780">table</span><span class="op" id="7363785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7363788"><a href="/database/sql/fakedb_test.go.html#7363626">db</a></span><span class="op" id="7363790">.</span><span class="ident" id="7363791">mu</span><span class="op" id="7363793">.</span><span class="ident" id="7363794">Unlock</span><span class="op" id="7363800">(</span><span class="op" id="7363801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363804">if</span>&nbsp;<span class="op" id="7363807">!</span><span class="ident" id="7363808"><a href="/database/sql/fakedb_test.go.html#7363763">ok</a></span>&nbsp;<span class="op" id="7363811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363815">return</span>&nbsp;<span class="ident" id="7363822">nil</span><span class="op" id="7363825">,</span>&nbsp;<span class="ident" id="7363827"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7363830">.</span><span class="ident" id="7363831">Errorf</span><span class="op" id="7363837">(</span><span class="string" id="7363838">&#34;fakedb:&nbsp;table&nbsp;%q&nbsp;doesn&#39;t&nbsp;exist&#34;</span><span class="op" id="7363870">,</span>&nbsp;<span class="ident" id="7363872"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363873">.</span><span class="ident" id="7363874">table</span><span class="op" id="7363879">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7363882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363886">if</span>&nbsp;<span class="ident" id="7363889"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363890">.</span><span class="ident" id="7363891">table</span>&nbsp;<span class="op" id="7363897">==</span>&nbsp;<span class="string" id="7363900">&#34;magicquery&#34;</span>&nbsp;<span class="op" id="7363913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7363917">if</span>&nbsp;<span class="builtinfunc" id="7363920">len</span><span class="op" id="7363923">(</span><span class="ident" id="7363924"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363925">.</span><span class="ident" id="7363926">whereCol</span><span class="op" id="7363934">)</span>&nbsp;<span class="op" id="7363936">==</span>&nbsp;<span class="num" id="7363939">2</span>&nbsp;<span class="op" id="7363941">&amp;&amp;</span>&nbsp;<span class="ident" id="7363944"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363945">.</span><span class="ident" id="7363946">whereCol</span><span class="op" id="7363954">[</span><span class="num" id="7363955">0</span><span class="op" id="7363956">]</span>&nbsp;<span class="op" id="7363958">==</span>&nbsp;<span class="string" id="7363961">&#34;op&#34;</span>&nbsp;<span class="op" id="7363966">&amp;&amp;</span>&nbsp;<span class="ident" id="7363969"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7363970">.</span><span class="ident" id="7363971">whereCol</span><span class="op" id="7363979">[</span><span class="num" id="7363980">1</span><span class="op" id="7363981">]</span>&nbsp;<span class="op" id="7363983">==</span>&nbsp;<span class="string" id="7363986">&#34;millis&#34;</span>&nbsp;<span class="op" id="7363995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364000">if</span>&nbsp;<span class="ident" id="7364003"><a href="/database/sql/fakedb_test.go.html#7363380">args</a></span><span class="op" id="7364007">[</span><span class="num" id="7364008">0</span><span class="op" id="7364009">]</span>&nbsp;<span class="op" id="7364011">==</span>&nbsp;<span class="string" id="7364014">&#34;sleep&#34;</span>&nbsp;<span class="op" id="7364022">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364028"><a href="/database/sql/fakedb_test.go.html#7348580">time</a></span><span class="op" id="7364032">.</span><span class="ident" id="7364033">Sleep</span><span class="op" id="7364038">(</span><span class="ident" id="7364039"><a href="/database/sql/fakedb_test.go.html#7348580">time</a></span><span class="op" id="7364043">.</span><span class="ident" id="7364044">Duration</span><span class="op" id="7364052">(</span><span class="ident" id="7364053"><a href="/database/sql/fakedb_test.go.html#7363380">args</a></span><span class="op" id="7364057">[</span><span class="num" id="7364058">1</span><span class="op" id="7364059">]</span><span class="op" id="7364060">.</span><span class="op" id="7364061">(</span><span class="ident" id="7364062">int64</span><span class="op" id="7364067">)</span><span class="op" id="7364068">)</span>&nbsp;<span class="op" id="7364070">*</span>&nbsp;<span class="ident" id="7364072"><a href="/database/sql/fakedb_test.go.html#7348580">time</a></span><span class="op" id="7364076">.</span><span class="ident" id="7364077">Millisecond</span><span class="op" id="7364088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364104"><a href="/database/sql/fakedb_test.go.html#7363760">t</a></span><span class="op" id="7364105">.</span><span class="ident" id="7364106">mu</span><span class="op" id="7364108">.</span><span class="ident" id="7364109">Lock</span><span class="op" id="7364113">(</span><span class="op" id="7364114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364117">defer</span>&nbsp;<span class="ident" id="7364123"><a href="/database/sql/fakedb_test.go.html#7363760">t</a></span><span class="op" id="7364124">.</span><span class="ident" id="7364125">mu</span><span class="op" id="7364127">.</span><span class="ident" id="7364128">Unlock</span><span class="op" id="7364134">(</span><span class="op" id="7364135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364139">colIdx</span>&nbsp;<span class="op" id="7364146">:=</span>&nbsp;<span class="builtinfunc" id="7364149">make</span><span class="op" id="7364153">(</span><span class="keyword" id="7364154">map</span><span class="op" id="7364157">[</span><span class="builtintype" id="7364158">string</span><span class="op" id="7364164">]</span><span class="builtintype" id="7364165">int</span><span class="op" id="7364168">)</span>&nbsp;<span class="comment" id="7364170">//&nbsp;select&nbsp;column&nbsp;name&nbsp;-&gt;&nbsp;column&nbsp;index&nbsp;in&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364218">for</span>&nbsp;<span class="ident" id="7364222">_</span><span class="op" id="7364223">,</span>&nbsp;<span class="ident" id="7364225">name</span>&nbsp;<span class="op" id="7364230">:=</span>&nbsp;<span class="keyword" id="7364233">range</span>&nbsp;<span class="ident" id="7364239"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7364240">.</span><span class="ident" id="7364241">colName</span>&nbsp;<span class="op" id="7364249">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364253">idx</span>&nbsp;<span class="op" id="7364257">:=</span>&nbsp;<span class="ident" id="7364260"><a href="/database/sql/fakedb_test.go.html#7363760">t</a></span><span class="op" id="7364261">.</span><span class="ident" id="7364262">columnIndex</span><span class="op" id="7364273">(</span><span class="ident" id="7364274"><a href="/database/sql/fakedb_test.go.html#7364225">name</a></span><span class="op" id="7364278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364282">if</span>&nbsp;<span class="ident" id="7364285"><a href="/database/sql/fakedb_test.go.html#7364253">idx</a></span>&nbsp;<span class="op" id="7364289">==</span>&nbsp;<span class="op" id="7364292">-</span><span class="num" id="7364293">1</span>&nbsp;<span class="op" id="7364295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364300">return</span>&nbsp;<span class="ident" id="7364307">nil</span><span class="op" id="7364310">,</span>&nbsp;<span class="ident" id="7364312"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7364315">.</span><span class="ident" id="7364316">Errorf</span><span class="op" id="7364322">(</span><span class="string" id="7364323">&#34;fakedb:&nbsp;unknown&nbsp;column&nbsp;name&nbsp;%q&#34;</span><span class="op" id="7364355">,</span>&nbsp;<span class="ident" id="7364357"><a href="/database/sql/fakedb_test.go.html#7364225">name</a></span><span class="op" id="7364361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364369"><a href="/database/sql/fakedb_test.go.html#7364139">colIdx</a></span><span class="op" id="7364375">[</span><span class="ident" id="7364376"><a href="/database/sql/fakedb_test.go.html#7364225">name</a></span><span class="op" id="7364380">]</span>&nbsp;<span class="op" id="7364382">=</span>&nbsp;<span class="ident" id="7364384"><a href="/database/sql/fakedb_test.go.html#7364253">idx</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364393">mrows</span>&nbsp;<span class="op" id="7364399">:=</span>&nbsp;<span class="op" id="7364402">[</span><span class="op" id="7364403">]</span><span class="op" id="7364404">*</span><span class="ident" id="7364405"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><span class="op" id="7364408">{</span><span class="op" id="7364409">}</span><br>
<span class="lineno"></span><span class="ident" id="7364411">rows</span><span class="op" id="7364415">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364418">for</span>&nbsp;<span class="ident" id="7364422">_</span><span class="op" id="7364423">,</span>&nbsp;<span class="ident" id="7364425">trow</span>&nbsp;<span class="op" id="7364430">:=</span>&nbsp;<span class="keyword" id="7364433">range</span>&nbsp;<span class="ident" id="7364439"><a href="/database/sql/fakedb_test.go.html#7363760">t</a></span><span class="op" id="7364440">.</span><span class="ident" id="7364441">rows</span>&nbsp;<span class="op" id="7364446">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7364450">//&nbsp;Process&nbsp;the&nbsp;where&nbsp;clause,&nbsp;skipping&nbsp;non-match&nbsp;rows.&nbsp;This&nbsp;is&nbsp;lazy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7364519">//&nbsp;and&nbsp;just&nbsp;uses&nbsp;fmt.Sprintf(&#34;%v&#34;)&nbsp;to&nbsp;test&nbsp;equality.&nbsp;&nbsp;Good&nbsp;enough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7364587">//&nbsp;for&nbsp;test&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364607">for</span>&nbsp;<span class="ident" id="7364611">widx</span><span class="op" id="7364615">,</span>&nbsp;<span class="ident" id="7364617">wcol</span>&nbsp;<span class="op" id="7364622">:=</span>&nbsp;<span class="keyword" id="7364625">range</span>&nbsp;<span class="ident" id="7364631"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7364632">.</span><span class="ident" id="7364633">whereCol</span>&nbsp;<span class="op" id="7364642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364647">idx</span>&nbsp;<span class="op" id="7364651">:=</span>&nbsp;<span class="ident" id="7364654"><a href="/database/sql/fakedb_test.go.html#7363760">t</a></span><span class="op" id="7364655">.</span><span class="ident" id="7364656">columnIndex</span><span class="op" id="7364667">(</span><span class="ident" id="7364668"><a href="/database/sql/fakedb_test.go.html#7364617">wcol</a></span><span class="op" id="7364672">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364677">if</span>&nbsp;<span class="ident" id="7364680"><a href="/database/sql/fakedb_test.go.html#7364647">idx</a></span>&nbsp;<span class="op" id="7364684">==</span>&nbsp;<span class="op" id="7364687">-</span><span class="num" id="7364688">1</span>&nbsp;<span class="op" id="7364690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364696">return</span>&nbsp;<span class="ident" id="7364703">nil</span><span class="op" id="7364706">,</span>&nbsp;<span class="ident" id="7364708"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7364711">.</span><span class="ident" id="7364712">Errorf</span><span class="op" id="7364718">(</span><span class="string" id="7364719">&#34;db:&nbsp;invalid&nbsp;where&nbsp;clause&nbsp;column&nbsp;%q&#34;</span><span class="op" id="7364755">,</span>&nbsp;<span class="ident" id="7364757"><a href="/database/sql/fakedb_test.go.html#7364617">wcol</a></span><span class="op" id="7364761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364771">tcol</span>&nbsp;<span class="op" id="7364776">:=</span>&nbsp;<span class="ident" id="7364779"><a href="/database/sql/fakedb_test.go.html#7364425">trow</a></span><span class="op" id="7364783">.</span><span class="ident" id="7364784">cols</span><span class="op" id="7364788">[</span><span class="ident" id="7364789"><a href="/database/sql/fakedb_test.go.html#7364647">idx</a></span><span class="op" id="7364792">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364797">if</span>&nbsp;<span class="ident" id="7364800">bs</span><span class="op" id="7364802">,</span>&nbsp;<span class="ident" id="7364804">ok</span>&nbsp;<span class="op" id="7364807">:=</span>&nbsp;<span class="ident" id="7364810"><a href="/database/sql/fakedb_test.go.html#7364771">tcol</a></span><span class="op" id="7364814">.</span><span class="op" id="7364815">(</span><span class="op" id="7364816">[</span><span class="op" id="7364817">]</span><span class="builtintype" id="7364818">byte</span><span class="op" id="7364822">)</span><span class="op" id="7364823">;</span>&nbsp;<span class="ident" id="7364825"><a href="/database/sql/fakedb_test.go.html#7364804">ok</a></span>&nbsp;<span class="op" id="7364828">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7364834">//&nbsp;lazy&nbsp;hack&nbsp;to&nbsp;avoid&nbsp;sprintf&nbsp;%v&nbsp;on&nbsp;a&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7364883"><a href="/database/sql/fakedb_test.go.html#7364771">tcol</a></span>&nbsp;<span class="op" id="7364888">=</span>&nbsp;<span class="builtintype" id="7364890">string</span><span class="op" id="7364896">(</span><span class="ident" id="7364897"><a href="/database/sql/fakedb_test.go.html#7364800">bs</a></span><span class="op" id="7364899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364909">if</span>&nbsp;<span class="ident" id="7364912"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7364915">.</span><span class="ident" id="7364916">Sprintf</span><span class="op" id="7364923">(</span><span class="string" id="7364924">&#34;%v&#34;</span><span class="op" id="7364928">,</span>&nbsp;<span class="ident" id="7364930"><a href="/database/sql/fakedb_test.go.html#7364771">tcol</a></span><span class="op" id="7364934">)</span>&nbsp;<span class="op" id="7364936">!=</span>&nbsp;<span class="ident" id="7364939"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7364942">.</span><span class="ident" id="7364943">Sprintf</span><span class="op" id="7364950">(</span><span class="string" id="7364951">&#34;%v&#34;</span><span class="op" id="7364955">,</span>&nbsp;<span class="ident" id="7364957"><a href="/database/sql/fakedb_test.go.html#7363380">args</a></span><span class="op" id="7364961">[</span><span class="ident" id="7364962"><a href="/database/sql/fakedb_test.go.html#7364611">widx</a></span><span class="op" id="7364966">]</span><span class="op" id="7364967">)</span>&nbsp;<span class="op" id="7364969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7364975">continue</span>&nbsp;<span class="ident" id="7364984">rows</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7364996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365000">mrow</span>&nbsp;<span class="op" id="7365005">:=</span>&nbsp;<span class="op" id="7365008">&amp;</span><span class="ident" id="7365009"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><span class="op" id="7365012">{</span><span class="ident" id="7365013">cols</span><span class="op" id="7365017">:</span>&nbsp;<span class="builtinfunc" id="7365019">make</span><span class="op" id="7365023">(</span><span class="op" id="7365024">[</span><span class="op" id="7365025">]</span><span class="keyword" id="7365026">interface</span><span class="op" id="7365035">{</span><span class="op" id="7365036">}</span><span class="op" id="7365037">,</span>&nbsp;<span class="builtinfunc" id="7365039">len</span><span class="op" id="7365042">(</span><span class="ident" id="7365043"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7365044">.</span><span class="ident" id="7365045">colName</span><span class="op" id="7365052">)</span><span class="op" id="7365053">)</span><span class="op" id="7365054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365058">for</span>&nbsp;<span class="ident" id="7365062">seli</span><span class="op" id="7365066">,</span>&nbsp;<span class="ident" id="7365068">name</span>&nbsp;<span class="op" id="7365073">:=</span>&nbsp;<span class="keyword" id="7365076">range</span>&nbsp;<span class="ident" id="7365082"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7365083">.</span><span class="ident" id="7365084">colName</span>&nbsp;<span class="op" id="7365092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365097"><a href="/database/sql/fakedb_test.go.html#7365000">mrow</a></span><span class="op" id="7365101">.</span><span class="ident" id="7365102">cols</span><span class="op" id="7365106">[</span><span class="ident" id="7365107"><a href="/database/sql/fakedb_test.go.html#7365062">seli</a></span><span class="op" id="7365111">]</span>&nbsp;<span class="op" id="7365113">=</span>&nbsp;<span class="ident" id="7365115"><a href="/database/sql/fakedb_test.go.html#7364425">trow</a></span><span class="op" id="7365119">.</span><span class="ident" id="7365120">cols</span><span class="op" id="7365124">[</span><span class="ident" id="7365125"><a href="/database/sql/fakedb_test.go.html#7364139">colIdx</a></span><span class="op" id="7365131">[</span><span class="ident" id="7365132"><a href="/database/sql/fakedb_test.go.html#7365068">name</a></span><span class="op" id="7365136">]</span><span class="op" id="7365137">]</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365145"><a href="/database/sql/fakedb_test.go.html#7364393">mrows</a></span>&nbsp;<span class="op" id="7365151">=</span>&nbsp;<span class="builtinfunc" id="7365153">append</span><span class="op" id="7365159">(</span><span class="ident" id="7365160"><a href="/database/sql/fakedb_test.go.html#7364393">mrows</a></span><span class="op" id="7365165">,</span>&nbsp;<span class="ident" id="7365167"><a href="/database/sql/fakedb_test.go.html#7365000">mrow</a></span><span class="op" id="7365171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365178">cursor</span>&nbsp;<span class="op" id="7365185">:=</span>&nbsp;<span class="op" id="7365188">&amp;</span><span class="ident" id="7365189"><a href="/database/sql/fakedb_test.go.html#7365500">rowsCursor</a></span><span class="op" id="7365199">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365203">pos</span><span class="op" id="7365206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7365211">-</span><span class="num" id="7365212">1</span><span class="op" id="7365213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365217">rows</span><span class="op" id="7365221">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7365225"><a href="/database/sql/fakedb_test.go.html#7364393">mrows</a></span><span class="op" id="7365230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365234">cols</span><span class="op" id="7365238">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7365242"><a href="/database/sql/fakedb_test.go.html#7363361">s</a></span><span class="op" id="7365243">.</span><span class="ident" id="7365244">colName</span><span class="op" id="7365251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365255">errPos</span><span class="op" id="7365261">:</span>&nbsp;<span class="op" id="7365263">-</span><span class="num" id="7365264">1</span><span class="op" id="7365265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7365268">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365271">return</span>&nbsp;<span class="ident" id="7365278"><a href="/database/sql/fakedb_test.go.html#7365178">cursor</a></span><span class="op" id="7365284">,</span>&nbsp;<span class="ident" id="7365286">nil</span><br>
<span class="lineno"></span><span class="op" id="7365290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365293">func</span>&nbsp;<span class="op" id="7365298">(</span><span class="ident" id="7365299">s</span>&nbsp;<span class="op" id="7365301">*</span><span class="ident" id="7365302"><a href="/database/sql/fakedb_test.go.html#7350359">fakeStmt</a></span><span class="op" id="7365310">)</span>&nbsp;<span class="ident" id="7365312">NumInput</span><span class="op" id="7365320">(</span><span class="op" id="7365321">)</span>&nbsp;<span class="builtintype" id="7365323">int</span>&nbsp;<span class="op" id="7365327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365330">return</span>&nbsp;<span class="ident" id="7365337"><a href="/database/sql/fakedb_test.go.html#7365299">s</a></span><span class="op" id="7365338">.</span><span class="ident" id="7365339">placeholders</span><br>
<span class="lineno">695</span><span class="op" id="7365352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365355">func</span>&nbsp;<span class="op" id="7365360">(</span><span class="ident" id="7365361">tx</span>&nbsp;<span class="op" id="7365364">*</span><span class="ident" id="7365365"><a href="/database/sql/fakedb_test.go.html#7350322">fakeTx</a></span><span class="op" id="7365371">)</span>&nbsp;<span class="ident" id="7365373">Commit</span><span class="op" id="7365379">(</span><span class="op" id="7365380">)</span>&nbsp;<span class="builtintype" id="7365382">error</span>&nbsp;<span class="op" id="7365388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365391"><a href="/database/sql/fakedb_test.go.html#7365361">tx</a></span><span class="op" id="7365393">.</span><span class="ident" id="7365394">c</span><span class="op" id="7365395">.</span><span class="ident" id="7365396">currTx</span>&nbsp;<span class="op" id="7365403">=</span>&nbsp;<span class="ident" id="7365405">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365410">return</span>&nbsp;<span class="ident" id="7365417">nil</span><br>
<span class="lineno">700</span><span class="op" id="7365421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365424">func</span>&nbsp;<span class="op" id="7365429">(</span><span class="ident" id="7365430">tx</span>&nbsp;<span class="op" id="7365433">*</span><span class="ident" id="7365434"><a href="/database/sql/fakedb_test.go.html#7350322">fakeTx</a></span><span class="op" id="7365440">)</span>&nbsp;<span class="ident" id="7365442">Rollback</span><span class="op" id="7365450">(</span><span class="op" id="7365451">)</span>&nbsp;<span class="builtintype" id="7365453">error</span>&nbsp;<span class="op" id="7365459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365462"><a href="/database/sql/fakedb_test.go.html#7365430">tx</a></span><span class="op" id="7365464">.</span><span class="ident" id="7365465">c</span><span class="op" id="7365466">.</span><span class="ident" id="7365467">currTx</span>&nbsp;<span class="op" id="7365474">=</span>&nbsp;<span class="ident" id="7365476">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365481">return</span>&nbsp;<span class="ident" id="7365488">nil</span><br>
<span class="lineno">705</span><span class="op" id="7365492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365495">type</span>&nbsp;<span class="ident" id="7365500">rowsCursor</span>&nbsp;<span class="keyword" id="7365511">struct</span>&nbsp;<span class="op" id="7365518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365521">cols</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7365528">[</span><span class="op" id="7365529">]</span><span class="builtintype" id="7365530">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365538">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7365545">int</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365550">rows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7365557">[</span><span class="op" id="7365558">]</span><span class="op" id="7365559">*</span><span class="ident" id="7365560"><a href="/database/sql/fakedb_test.go.html#7349828">row</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365565">closed</span>&nbsp;<span class="builtintype" id="7365572">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365579">//&nbsp;errPos&nbsp;and&nbsp;err&nbsp;are&nbsp;for&nbsp;making&nbsp;Next&nbsp;return&nbsp;early&nbsp;with&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365643">errPos</span>&nbsp;<span class="builtintype" id="7365650">int</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365655">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7365662">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365670">//&nbsp;a&nbsp;clone&nbsp;of&nbsp;slices&nbsp;to&nbsp;give&nbsp;out&nbsp;to&nbsp;clients,&nbsp;indexed&nbsp;by&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365731">//&nbsp;the&nbsp;original&nbsp;slice&#39;s&nbsp;first&nbsp;byte&nbsp;address.&nbsp;&nbsp;we&nbsp;clone&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7365791">//&nbsp;just&nbsp;so&nbsp;we&#39;re&nbsp;able&nbsp;to&nbsp;corrupt&nbsp;them&nbsp;on&nbsp;close.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365840">bytesClone</span>&nbsp;<span class="keyword" id="7365851">map</span><span class="op" id="7365854">[</span><span class="op" id="7365855">*</span><span class="builtintype" id="7365856">byte</span><span class="op" id="7365860">]</span><span class="op" id="7365861">[</span><span class="op" id="7365862">]</span><span class="builtintype" id="7365863">byte</span><br>
<span class="lineno"></span><span class="op" id="7365868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7365871">func</span>&nbsp;<span class="op" id="7365876">(</span><span class="ident" id="7365877">rc</span>&nbsp;<span class="op" id="7365880">*</span><span class="ident" id="7365881"><a href="/database/sql/fakedb_test.go.html#7365500">rowsCursor</a></span><span class="op" id="7365891">)</span>&nbsp;<span class="ident" id="7365893">Close</span><span class="op" id="7365898">(</span><span class="op" id="7365899">)</span>&nbsp;<span class="builtintype" id="7365901">error</span>&nbsp;<span class="op" id="7365907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365910">if</span>&nbsp;<span class="op" id="7365913">!</span><span class="ident" id="7365914"><a href="/database/sql/fakedb_test.go.html#7365877">rc</a></span><span class="op" id="7365916">.</span><span class="ident" id="7365917">closed</span>&nbsp;<span class="op" id="7365924">{</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7365928">for</span>&nbsp;<span class="ident" id="7365932">_</span><span class="op" id="7365933">,</span>&nbsp;<span class="ident" id="7365935">bs</span>&nbsp;<span class="op" id="7365938">:=</span>&nbsp;<span class="keyword" id="7365941">range</span>&nbsp;<span class="ident" id="7365947"><a href="/database/sql/fakedb_test.go.html#7365877">rc</a></span><span class="op" id="7365949">.</span><span class="ident" id="7365950">bytesClone</span>&nbsp;<span class="op" id="7365961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7365966"><a href="/database/sql/fakedb_test.go.html#7365935">bs</a></span><span class="op" id="7365968">[</span><span class="num" id="7365969">0</span><span class="op" id="7365970">]</span>&nbsp;<span class="op" id="7365972">=</span>&nbsp;<span class="num" id="7365974">255</span>&nbsp;<span class="comment" id="7365978">//&nbsp;first&nbsp;byte&nbsp;corrupted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366010"><a href="/database/sql/fakedb_test.go.html#7365877">rc</a></span><span class="op" id="7366012">.</span><span class="ident" id="7366013">closed</span>&nbsp;<span class="op" id="7366020">=</span>&nbsp;<span class="builtintype" id="7366022">true</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366028">return</span>&nbsp;<span class="ident" id="7366035">nil</span><br>
<span class="lineno"></span><span class="op" id="7366039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7366042">func</span>&nbsp;<span class="op" id="7366047">(</span><span class="ident" id="7366048">rc</span>&nbsp;<span class="op" id="7366051">*</span><span class="ident" id="7366052"><a href="/database/sql/fakedb_test.go.html#7365500">rowsCursor</a></span><span class="op" id="7366062">)</span>&nbsp;<span class="ident" id="7366064">Columns</span><span class="op" id="7366071">(</span><span class="op" id="7366072">)</span>&nbsp;<span class="op" id="7366074">[</span><span class="op" id="7366075">]</span><span class="builtintype" id="7366076">string</span>&nbsp;<span class="op" id="7366083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366086">return</span>&nbsp;<span class="ident" id="7366093"><a href="/database/sql/fakedb_test.go.html#7366048">rc</a></span><span class="op" id="7366095">.</span><span class="ident" id="7366096">cols</span><br>
<span class="lineno">735</span><span class="op" id="7366101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7366104">var</span>&nbsp;<span class="ident" id="7366108">rowsCursorNextHook</span>&nbsp;<span class="keyword" id="7366127">func</span><span class="op" id="7366131">(</span><span class="ident" id="7366132">dest</span>&nbsp;<span class="op" id="7366137">[</span><span class="op" id="7366138">]</span><span class="ident" id="7366139"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7366145">.</span><span class="ident" id="7366146">Value</span><span class="op" id="7366151">)</span>&nbsp;<span class="builtintype" id="7366153">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7366160">func</span>&nbsp;<span class="op" id="7366165">(</span><span class="ident" id="7366166">rc</span>&nbsp;<span class="op" id="7366169">*</span><span class="ident" id="7366170"><a href="/database/sql/fakedb_test.go.html#7365500">rowsCursor</a></span><span class="op" id="7366180">)</span>&nbsp;<span class="ident" id="7366182">Next</span><span class="op" id="7366186">(</span><span class="ident" id="7366187">dest</span>&nbsp;<span class="op" id="7366192">[</span><span class="op" id="7366193">]</span><span class="ident" id="7366194"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7366200">.</span><span class="ident" id="7366201">Value</span><span class="op" id="7366206">)</span>&nbsp;<span class="builtintype" id="7366208">error</span>&nbsp;<span class="op" id="7366214">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366217">if</span>&nbsp;<span class="ident" id="7366220"><a href="/database/sql/fakedb_test.go.html#7366108">rowsCursorNextHook</a></span>&nbsp;<span class="op" id="7366239">!=</span>&nbsp;<span class="ident" id="7366242">nil</span>&nbsp;<span class="op" id="7366246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366250">return</span>&nbsp;<span class="ident" id="7366257"><a href="/database/sql/fakedb_test.go.html#7366108">rowsCursorNextHook</a></span><span class="op" id="7366275">(</span><span class="ident" id="7366276"><a href="/database/sql/fakedb_test.go.html#7366187">dest</a></span><span class="op" id="7366280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366287">if</span>&nbsp;<span class="ident" id="7366290"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366292">.</span><span class="ident" id="7366293">closed</span>&nbsp;<span class="op" id="7366300">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366304">return</span>&nbsp;<span class="ident" id="7366311"><a href="/database/sql/fakedb_test.go.html#7348501">errors</a></span><span class="op" id="7366317">.</span><span class="ident" id="7366318">New</span><span class="op" id="7366321">(</span><span class="string" id="7366322">&#34;fakedb:&nbsp;cursor&nbsp;is&nbsp;closed&#34;</span><span class="op" id="7366348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366354"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366356">.</span><span class="ident" id="7366357">pos</span><span class="op" id="7366360">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366364">if</span>&nbsp;<span class="ident" id="7366367"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366369">.</span><span class="ident" id="7366370">pos</span>&nbsp;<span class="op" id="7366374">==</span>&nbsp;<span class="ident" id="7366377"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366379">.</span><span class="ident" id="7366380">errPos</span>&nbsp;<span class="op" id="7366387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366391">return</span>&nbsp;<span class="ident" id="7366398"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366400">.</span><span class="ident" id="7366401">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366409">if</span>&nbsp;<span class="ident" id="7366412"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366414">.</span><span class="ident" id="7366415">pos</span>&nbsp;<span class="op" id="7366419">&gt;=</span>&nbsp;<span class="builtinfunc" id="7366422">len</span><span class="op" id="7366425">(</span><span class="ident" id="7366426"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366428">.</span><span class="ident" id="7366429">rows</span><span class="op" id="7366433">)</span>&nbsp;<span class="op" id="7366435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366439">return</span>&nbsp;<span class="ident" id="7366446"><a href="/database/sql/fakedb_test.go.html#7348518">io</a></span><span class="op" id="7366448">.</span><span class="ident" id="7366449">EOF</span>&nbsp;<span class="comment" id="7366453">//&nbsp;per&nbsp;interface&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366479">for</span>&nbsp;<span class="ident" id="7366483">i</span><span class="op" id="7366484">,</span>&nbsp;<span class="ident" id="7366486">v</span>&nbsp;<span class="op" id="7366488">:=</span>&nbsp;<span class="keyword" id="7366491">range</span>&nbsp;<span class="ident" id="7366497"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366499">.</span><span class="ident" id="7366500">rows</span><span class="op" id="7366504">[</span><span class="ident" id="7366505"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366507">.</span><span class="ident" id="7366508">pos</span><span class="op" id="7366511">]</span><span class="op" id="7366512">.</span><span class="ident" id="7366513">cols</span>&nbsp;<span class="op" id="7366518">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366522">//&nbsp;TODO(bradfitz):&nbsp;convert&nbsp;to&nbsp;subset&nbsp;types?&nbsp;naah,&nbsp;I</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366576">//&nbsp;think&nbsp;the&nbsp;subset&nbsp;types&nbsp;should&nbsp;only&nbsp;be&nbsp;input&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366628">//&nbsp;driver,&nbsp;but&nbsp;the&nbsp;sql&nbsp;package&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;handle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366686">//&nbsp;a&nbsp;wider&nbsp;range&nbsp;of&nbsp;types&nbsp;coming&nbsp;out&nbsp;of&nbsp;drivers.&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366741">//&nbsp;for&nbsp;ease&nbsp;of&nbsp;drivers,&nbsp;and&nbsp;to&nbsp;prevent&nbsp;drivers&nbsp;from</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7366795">//&nbsp;messing&nbsp;up&nbsp;conversions&nbsp;or&nbsp;doing&nbsp;them&nbsp;differently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366850"><a href="/database/sql/fakedb_test.go.html#7366187">dest</a></span><span class="op" id="7366854">[</span><span class="ident" id="7366855"><a href="/database/sql/fakedb_test.go.html#7366483">i</a></span><span class="op" id="7366856">]</span>&nbsp;<span class="op" id="7366858">=</span>&nbsp;<span class="ident" id="7366860"><a href="/database/sql/fakedb_test.go.html#7366486">v</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366865">if</span>&nbsp;<span class="ident" id="7366868">bs</span><span class="op" id="7366870">,</span>&nbsp;<span class="ident" id="7366872">ok</span>&nbsp;<span class="op" id="7366875">:=</span>&nbsp;<span class="ident" id="7366878"><a href="/database/sql/fakedb_test.go.html#7366486">v</a></span><span class="op" id="7366879">.</span><span class="op" id="7366880">(</span><span class="op" id="7366881">[</span><span class="op" id="7366882">]</span><span class="builtintype" id="7366883">byte</span><span class="op" id="7366887">)</span><span class="op" id="7366888">;</span>&nbsp;<span class="ident" id="7366890"><a href="/database/sql/fakedb_test.go.html#7366872">ok</a></span>&nbsp;<span class="op" id="7366893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7366898">if</span>&nbsp;<span class="ident" id="7366901"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366903">.</span><span class="ident" id="7366904">bytesClone</span>&nbsp;<span class="op" id="7366915">==</span>&nbsp;<span class="ident" id="7366918">nil</span>&nbsp;<span class="op" id="7366922">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366928"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366930">.</span><span class="ident" id="7366931">bytesClone</span>&nbsp;<span class="op" id="7366942">=</span>&nbsp;<span class="builtinfunc" id="7366944">make</span><span class="op" id="7366948">(</span><span class="keyword" id="7366949">map</span><span class="op" id="7366952">[</span><span class="op" id="7366953">*</span><span class="builtintype" id="7366954">byte</span><span class="op" id="7366958">]</span><span class="op" id="7366959">[</span><span class="op" id="7366960">]</span><span class="builtintype" id="7366961">byte</span><span class="op" id="7366965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7366970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7366975">clone</span><span class="op" id="7366980">,</span>&nbsp;<span class="ident" id="7366982">ok</span>&nbsp;<span class="op" id="7366985">:=</span>&nbsp;<span class="ident" id="7366988"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7366990">.</span><span class="ident" id="7366991">bytesClone</span><span class="op" id="7367001">[</span><span class="op" id="7367002">&amp;</span><span class="ident" id="7367003"><a href="/database/sql/fakedb_test.go.html#7366868">bs</a></span><span class="op" id="7367005">[</span><span class="num" id="7367006">0</span><span class="op" id="7367007">]</span><span class="op" id="7367008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367013">if</span>&nbsp;<span class="op" id="7367016">!</span><span class="ident" id="7367017"><a href="/database/sql/fakedb_test.go.html#7366982">ok</a></span>&nbsp;<span class="op" id="7367020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367026"><a href="/database/sql/fakedb_test.go.html#7366975">clone</a></span>&nbsp;<span class="op" id="7367032">=</span>&nbsp;<span class="builtinfunc" id="7367034">make</span><span class="op" id="7367038">(</span><span class="op" id="7367039">[</span><span class="op" id="7367040">]</span><span class="builtintype" id="7367041">byte</span><span class="op" id="7367045">,</span>&nbsp;<span class="builtinfunc" id="7367047">len</span><span class="op" id="7367050">(</span><span class="ident" id="7367051"><a href="/database/sql/fakedb_test.go.html#7366868">bs</a></span><span class="op" id="7367053">)</span><span class="op" id="7367054">)</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7367060">copy</span><span class="op" id="7367064">(</span><span class="ident" id="7367065"><a href="/database/sql/fakedb_test.go.html#7366975">clone</a></span><span class="op" id="7367070">,</span>&nbsp;<span class="ident" id="7367072"><a href="/database/sql/fakedb_test.go.html#7366868">bs</a></span><span class="op" id="7367074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367080"><a href="/database/sql/fakedb_test.go.html#7366166">rc</a></span><span class="op" id="7367082">.</span><span class="ident" id="7367083">bytesClone</span><span class="op" id="7367093">[</span><span class="op" id="7367094">&amp;</span><span class="ident" id="7367095"><a href="/database/sql/fakedb_test.go.html#7366868">bs</a></span><span class="op" id="7367097">[</span><span class="num" id="7367098">0</span><span class="op" id="7367099">]</span><span class="op" id="7367100">]</span>&nbsp;<span class="op" id="7367102">=</span>&nbsp;<span class="ident" id="7367104"><a href="/database/sql/fakedb_test.go.html#7366975">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7367118"><a href="/database/sql/fakedb_test.go.html#7366187">dest</a></span><span class="op" id="7367122">[</span><span class="ident" id="7367123"><a href="/database/sql/fakedb_test.go.html#7366483">i</a></span><span class="op" id="7367124">]</span>&nbsp;<span class="op" id="7367126">=</span>&nbsp;<span class="ident" id="7367128"><a href="/database/sql/fakedb_test.go.html#7366975">clone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367136">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367142">return</span>&nbsp;<span class="ident" id="7367149">nil</span><br>
<span class="lineno"></span><span class="op" id="7367153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7367156">//&nbsp;fakeDriverString&nbsp;is&nbsp;like&nbsp;driver.String,&nbsp;but&nbsp;indirects&nbsp;pointers&nbsp;like</span><br>
<span class="lineno">780</span><span class="comment" id="7367227">//&nbsp;DefaultValueConverter.</span><br>
<span class="lineno"></span><span class="comment" id="7367253">//</span><br>
<span class="lineno"></span><span class="comment" id="7367256">//&nbsp;This&nbsp;could&nbsp;be&nbsp;surprising&nbsp;behavior&nbsp;to&nbsp;retroactively&nbsp;apply&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="7367319">//&nbsp;driver.String&nbsp;now&nbsp;that&nbsp;Go1&nbsp;is&nbsp;out,&nbsp;but&nbsp;this&nbsp;is&nbsp;convenient&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="7367384">//&nbsp;our&nbsp;TestPointerParamsAndScans.</span><br>
<span class="lineno">785</span><span class="comment" id="7367418">//</span><br>
<span class="lineno"></span><span class="keyword" id="7367421">type</span>&nbsp;<span class="ident" id="7367426">fakeDriverString</span>&nbsp;<span class="keyword" id="7367443">struct</span><span class="op" id="7367449">{</span><span class="op" id="7367450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7367453">func</span>&nbsp;<span class="op" id="7367458">(</span><span class="ident" id="7367459"><a href="/database/sql/fakedb_test.go.html#7367426">fakeDriverString</a></span><span class="op" id="7367475">)</span>&nbsp;<span class="ident" id="7367477">ConvertValue</span><span class="op" id="7367489">(</span><span class="ident" id="7367490">v</span>&nbsp;<span class="keyword" id="7367492">interface</span><span class="op" id="7367501">{</span><span class="op" id="7367502">}</span><span class="op" id="7367503">)</span>&nbsp;<span class="op" id="7367505">(</span><span class="ident" id="7367506"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367512">.</span><span class="ident" id="7367513">Value</span><span class="op" id="7367518">,</span>&nbsp;<span class="builtintype" id="7367520">error</span><span class="op" id="7367525">)</span>&nbsp;<span class="op" id="7367527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367530">switch</span>&nbsp;<span class="ident" id="7367537">c</span>&nbsp;<span class="op" id="7367539">:=</span>&nbsp;<span class="ident" id="7367542"><a href="/database/sql/fakedb_test.go.html#7367490">v</a></span><span class="op" id="7367543">.</span><span class="op" id="7367544">(</span><span class="keyword" id="7367545">type</span><span class="op" id="7367549">)</span>&nbsp;<span class="op" id="7367551">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367554">case</span>&nbsp;<span class="builtintype" id="7367559">string</span><span class="op" id="7367565">,</span>&nbsp;<span class="op" id="7367567">[</span><span class="op" id="7367568">]</span><span class="builtintype" id="7367569">byte</span><span class="op" id="7367573">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367577">return</span>&nbsp;<span class="ident" id="7367584"><a href="/database/sql/fakedb_test.go.html#7367490">v</a></span><span class="op" id="7367585">,</span>&nbsp;<span class="ident" id="7367587">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367592">case</span>&nbsp;<span class="op" id="7367597">*</span><span class="builtintype" id="7367598">string</span><span class="op" id="7367604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367608">if</span>&nbsp;<span class="ident" id="7367611"><a href="/database/sql/fakedb_test.go.html#7367537">c</a></span>&nbsp;<span class="op" id="7367613">==</span>&nbsp;<span class="ident" id="7367616">nil</span>&nbsp;<span class="op" id="7367620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367625">return</span>&nbsp;<span class="ident" id="7367632">nil</span><span class="op" id="7367635">,</span>&nbsp;<span class="ident" id="7367637">nil</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367647">return</span>&nbsp;<span class="op" id="7367654">*</span><span class="ident" id="7367655"><a href="/database/sql/fakedb_test.go.html#7367537">c</a></span><span class="op" id="7367656">,</span>&nbsp;<span class="ident" id="7367658">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7367663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367666">return</span>&nbsp;<span class="ident" id="7367673"><a href="/database/sql/fakedb_test.go.html#7348511">fmt</a></span><span class="op" id="7367676">.</span><span class="ident" id="7367677">Sprintf</span><span class="op" id="7367684">(</span><span class="string" id="7367685">&#34;%v&#34;</span><span class="op" id="7367689">,</span>&nbsp;<span class="ident" id="7367691"><a href="/database/sql/fakedb_test.go.html#7367490">v</a></span><span class="op" id="7367692">)</span><span class="op" id="7367693">,</span>&nbsp;<span class="ident" id="7367695">nil</span><br>
<span class="lineno"></span><span class="op" id="7367699">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="keyword" id="7367702">func</span>&nbsp;<span class="ident" id="7367707">converterForType</span><span class="op" id="7367723">(</span><span class="ident" id="7367724">typ</span>&nbsp;<span class="builtintype" id="7367728">string</span><span class="op" id="7367734">)</span>&nbsp;<span class="ident" id="7367736"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367742">.</span><span class="ident" id="7367743">ValueConverter</span>&nbsp;<span class="op" id="7367758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367761">switch</span>&nbsp;<span class="ident" id="7367768"><a href="/database/sql/fakedb_test.go.html#7367724">typ</a></span>&nbsp;<span class="op" id="7367772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367775">case</span>&nbsp;<span class="string" id="7367780">&#34;bool&#34;</span><span class="op" id="7367786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367790">return</span>&nbsp;<span class="ident" id="7367797"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367803">.</span><span class="ident" id="7367804">Bool</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367810">case</span>&nbsp;<span class="string" id="7367815">&#34;nullbool&#34;</span><span class="op" id="7367825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367829">return</span>&nbsp;<span class="ident" id="7367836"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367842">.</span><span class="ident" id="7367843">Null</span><span class="op" id="7367847">{</span><span class="ident" id="7367848">Converter</span><span class="op" id="7367857">:</span>&nbsp;<span class="ident" id="7367859"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367865">.</span><span class="ident" id="7367866">Bool</span><span class="op" id="7367870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367873">case</span>&nbsp;<span class="string" id="7367878">&#34;int32&#34;</span><span class="op" id="7367885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367889">return</span>&nbsp;<span class="ident" id="7367896"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367902">.</span><span class="ident" id="7367903">Int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367910">case</span>&nbsp;<span class="string" id="7367915">&#34;string&#34;</span><span class="op" id="7367923">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367927">return</span>&nbsp;<span class="ident" id="7367934"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7367940">.</span><span class="ident" id="7367941">NotNull</span><span class="op" id="7367948">{</span><span class="ident" id="7367949">Converter</span><span class="op" id="7367958">:</span>&nbsp;<span class="ident" id="7367960"><a href="/database/sql/fakedb_test.go.html#7367426">fakeDriverString</a></span><span class="op" id="7367976">{</span><span class="op" id="7367977">}</span><span class="op" id="7367978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7367981">case</span>&nbsp;<span class="string" id="7367986">&#34;nullstring&#34;</span><span class="op" id="7367998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368002">return</span>&nbsp;<span class="ident" id="7368009"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368015">.</span><span class="ident" id="7368016">Null</span><span class="op" id="7368020">{</span><span class="ident" id="7368021">Converter</span><span class="op" id="7368030">:</span>&nbsp;<span class="ident" id="7368032"><a href="/database/sql/fakedb_test.go.html#7367426">fakeDriverString</a></span><span class="op" id="7368048">{</span><span class="op" id="7368049">}</span><span class="op" id="7368050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368053">case</span>&nbsp;<span class="string" id="7368058">&#34;int64&#34;</span><span class="op" id="7368065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368069">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368121">return</span>&nbsp;<span class="ident" id="7368128"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368134">.</span><span class="ident" id="7368135">NotNull</span><span class="op" id="7368142">{</span><span class="ident" id="7368143">Converter</span><span class="op" id="7368152">:</span>&nbsp;<span class="ident" id="7368154"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368160">.</span><span class="ident" id="7368161">DefaultParameterConverter</span><span class="op" id="7368186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368189">case</span>&nbsp;<span class="string" id="7368194">&#34;nullint64&#34;</span><span class="op" id="7368205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368209">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368261">return</span>&nbsp;<span class="ident" id="7368268"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368274">.</span><span class="ident" id="7368275">Null</span><span class="op" id="7368279">{</span><span class="ident" id="7368280">Converter</span><span class="op" id="7368289">:</span>&nbsp;<span class="ident" id="7368291"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368297">.</span><span class="ident" id="7368298">DefaultParameterConverter</span><span class="op" id="7368323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368326">case</span>&nbsp;<span class="string" id="7368331">&#34;float64&#34;</span><span class="op" id="7368340">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368344">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368396">return</span>&nbsp;<span class="ident" id="7368403"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368409">.</span><span class="ident" id="7368410">NotNull</span><span class="op" id="7368417">{</span><span class="ident" id="7368418">Converter</span><span class="op" id="7368427">:</span>&nbsp;<span class="ident" id="7368429"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368435">.</span><span class="ident" id="7368436">DefaultParameterConverter</span><span class="op" id="7368461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368464">case</span>&nbsp;<span class="string" id="7368469">&#34;nullfloat64&#34;</span><span class="op" id="7368482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7368486">//&nbsp;TODO(coopernurse):&nbsp;add&nbsp;type-specific&nbsp;converter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368538">return</span>&nbsp;<span class="ident" id="7368545"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368551">.</span><span class="ident" id="7368552">Null</span><span class="op" id="7368556">{</span><span class="ident" id="7368557">Converter</span><span class="op" id="7368566">:</span>&nbsp;<span class="ident" id="7368568"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368574">.</span><span class="ident" id="7368575">DefaultParameterConverter</span><span class="op" id="7368600">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368603">case</span>&nbsp;<span class="string" id="7368608">&#34;datetime&#34;</span><span class="op" id="7368618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7368622">return</span>&nbsp;<span class="ident" id="7368629"><a href="/database/sql/fakedb_test.go.html#7348478">driver</a></span><span class="op" id="7368635">.</span><span class="ident" id="7368636">DefaultParameterConverter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7368663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7368666">panic</span><span class="op" id="7368671">(</span><span class="string" id="7368672">&#34;invalid&nbsp;fakedb&nbsp;column&nbsp;type&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="7368705">+</span>&nbsp;<span class="ident" id="7368707"><a href="/database/sql/fakedb_test.go.html#7367724">typ</a></span><span class="op" id="7368710">)</span><br>
<span class="lineno"></span><span class="op" id="7368712">}</span>
</div>
</body>
</html>
