<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2248941">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2248997">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2249051">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2249102">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2249172">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2249204">package</span>&nbsp;<span class="ident" id="2249212">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2249221">import</span>&nbsp;<span class="string" id="2249228">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2249236">var</span>&nbsp;<span class="op" id="2249240">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249243">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249310">envOnce</span>&nbsp;<span class="ident" id="2249318">sync</span><span class="op" id="2249322">.</span><span class="ident" id="2249323">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249330">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249363">envLock</span>&nbsp;<span class="ident" id="2249371">sync</span><span class="op" id="2249375">.</span><span class="ident" id="2249376">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249386">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249461">env</span>&nbsp;<span class="keyword" id="2249465">map</span><span class="op" id="2249468">[</span><span class="builtintype" id="2249469">string</span><span class="op" id="2249475">]</span><span class="builtintype" id="2249476">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249482">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249544">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249606">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249642">envs</span>&nbsp;<span class="op" id="2249647">[</span><span class="op" id="2249648">]</span><span class="builtintype" id="2249649">string</span>&nbsp;<span class="op" id="2249656">=</span>&nbsp;<span class="ident" id="2249658">runtime_envs</span><span class="op" id="2249670">(</span><span class="op" id="2249671">)</span><br>
<span class="lineno"></span><span class="op" id="2249673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2249676">func</span>&nbsp;<span class="ident" id="2249681">runtime_envs</span><span class="op" id="2249693">(</span><span class="op" id="2249694">)</span>&nbsp;<span class="op" id="2249696">[</span><span class="op" id="2249697">]</span><span class="builtintype" id="2249698">string</span>&nbsp;<span class="comment" id="2249705">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2249728">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2249798">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2249822">func</span>&nbsp;<span class="ident" id="2249827">setenv_c</span><span class="op" id="2249835">(</span><span class="ident" id="2249836">k</span><span class="op" id="2249837">,</span>&nbsp;<span class="ident" id="2249839">v</span>&nbsp;<span class="builtintype" id="2249841">string</span><span class="op" id="2249847">)</span><br>
<span class="lineno"></span><span class="keyword" id="2249849">func</span>&nbsp;<span class="ident" id="2249854">unsetenv_c</span><span class="op" id="2249864">(</span><span class="ident" id="2249865">k</span>&nbsp;<span class="builtintype" id="2249867">string</span><span class="op" id="2249873">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2249876">func</span>&nbsp;<span class="ident" id="2249881">copyenv</span><span class="op" id="2249888">(</span><span class="op" id="2249889">)</span>&nbsp;<span class="op" id="2249891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249894">env</span>&nbsp;<span class="op" id="2249898">=</span>&nbsp;<span class="builtinfunc" id="2249900">make</span><span class="op" id="2249904">(</span><span class="keyword" id="2249905">map</span><span class="op" id="2249908">[</span><span class="builtintype" id="2249909">string</span><span class="op" id="2249915">]</span><span class="builtintype" id="2249916">int</span><span class="op" id="2249919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249922">for</span>&nbsp;<span class="ident" id="2249926">i</span><span class="op" id="2249927">,</span>&nbsp;<span class="ident" id="2249929">s</span>&nbsp;<span class="op" id="2249931">:=</span>&nbsp;<span class="keyword" id="2249934">range</span>&nbsp;<span class="ident" id="2249940">envs</span>&nbsp;<span class="op" id="2249945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249949">for</span>&nbsp;<span class="ident" id="2249953">j</span>&nbsp;<span class="op" id="2249955">:=</span>&nbsp;<span class="num" id="2249958">0</span><span class="op" id="2249959">;</span>&nbsp;<span class="ident" id="2249961">j</span>&nbsp;<span class="op" id="2249963">&lt;</span>&nbsp;<span class="builtinfunc" id="2249965">len</span><span class="op" id="2249968">(</span><span class="ident" id="2249969">s</span><span class="op" id="2249970">)</span><span class="op" id="2249971">;</span>&nbsp;<span class="ident" id="2249973">j</span><span class="op" id="2249974">++</span>&nbsp;<span class="op" id="2249977">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249982">if</span>&nbsp;<span class="ident" id="2249985">s</span><span class="op" id="2249986">[</span><span class="ident" id="2249987">j</span><span class="op" id="2249988">]</span>&nbsp;<span class="op" id="2249990">==</span>&nbsp;<span class="string" id="2249993">&#39;=&#39;</span>&nbsp;<span class="op" id="2249997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250003">key</span>&nbsp;<span class="op" id="2250007">:=</span>&nbsp;<span class="ident" id="2250010">s</span><span class="op" id="2250011">[</span><span class="op" id="2250012">:</span><span class="ident" id="2250013">j</span><span class="op" id="2250014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250020">if</span>&nbsp;<span class="ident" id="2250023">_</span><span class="op" id="2250024">,</span>&nbsp;<span class="ident" id="2250026">ok</span>&nbsp;<span class="op" id="2250029">:=</span>&nbsp;<span class="ident" id="2250032">env</span><span class="op" id="2250035">[</span><span class="ident" id="2250036">key</span><span class="op" id="2250039">]</span><span class="op" id="2250040">;</span>&nbsp;<span class="op" id="2250042">!</span><span class="ident" id="2250043">ok</span>&nbsp;<span class="op" id="2250046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250053">env</span><span class="op" id="2250056">[</span><span class="ident" id="2250057">key</span><span class="op" id="2250060">]</span>&nbsp;<span class="op" id="2250062">=</span>&nbsp;<span class="ident" id="2250064">i</span>&nbsp;<span class="comment" id="2250066">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250094">}</span>&nbsp;<span class="keyword" id="2250096">else</span>&nbsp;<span class="op" id="2250101">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250108">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250163">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250213">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250261">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250304">envs</span><span class="op" id="2250308">[</span><span class="ident" id="2250309">i</span><span class="op" id="2250310">]</span>&nbsp;<span class="op" id="2250312">=</span>&nbsp;<span class="string" id="2250314">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250327">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250343">}</span><br>
<span class="lineno">55</span><span class="op" id="2250345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2250348">func</span>&nbsp;<span class="ident" id="2250353">Unsetenv</span><span class="op" id="2250361">(</span><span class="ident" id="2250362">key</span>&nbsp;<span class="builtintype" id="2250366">string</span><span class="op" id="2250372">)</span>&nbsp;<span class="builtintype" id="2250374">error</span>&nbsp;<span class="op" id="2250380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250383">envOnce</span><span class="op" id="2250390">.</span><span class="ident" id="2250391">Do</span><span class="op" id="2250393">(</span><span class="ident" id="2250394">copyenv</span><span class="op" id="2250401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250405">envLock</span><span class="op" id="2250412">.</span><span class="ident" id="2250413">Lock</span><span class="op" id="2250417">(</span><span class="op" id="2250418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250421">defer</span>&nbsp;<span class="ident" id="2250427">envLock</span><span class="op" id="2250434">.</span><span class="ident" id="2250435">Unlock</span><span class="op" id="2250441">(</span><span class="op" id="2250442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250446">if</span>&nbsp;<span class="ident" id="2250449">i</span><span class="op" id="2250450">,</span>&nbsp;<span class="ident" id="2250452">ok</span>&nbsp;<span class="op" id="2250455">:=</span>&nbsp;<span class="ident" id="2250458">env</span><span class="op" id="2250461">[</span><span class="ident" id="2250462">key</span><span class="op" id="2250465">]</span><span class="op" id="2250466">;</span>&nbsp;<span class="ident" id="2250468">ok</span>&nbsp;<span class="op" id="2250471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250475">envs</span><span class="op" id="2250479">[</span><span class="ident" id="2250480">i</span><span class="op" id="2250481">]</span>&nbsp;<span class="op" id="2250483">=</span>&nbsp;<span class="string" id="2250485">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2250490">delete</span><span class="op" id="2250496">(</span><span class="ident" id="2250497">env</span><span class="op" id="2250500">,</span>&nbsp;<span class="ident" id="2250502">key</span><span class="op" id="2250505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250511">unsetenv_c</span><span class="op" id="2250521">(</span><span class="ident" id="2250522">key</span><span class="op" id="2250525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250528">return</span>&nbsp;<span class="ident" id="2250535">nil</span><br>
<span class="lineno"></span><span class="op" id="2250539">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2250542">func</span>&nbsp;<span class="ident" id="2250547">Getenv</span><span class="op" id="2250553">(</span><span class="ident" id="2250554">key</span>&nbsp;<span class="builtintype" id="2250558">string</span><span class="op" id="2250564">)</span>&nbsp;<span class="op" id="2250566">(</span><span class="ident" id="2250567">value</span>&nbsp;<span class="builtintype" id="2250573">string</span><span class="op" id="2250579">,</span>&nbsp;<span class="ident" id="2250581">found</span>&nbsp;<span class="builtintype" id="2250587">bool</span><span class="op" id="2250591">)</span>&nbsp;<span class="op" id="2250593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250596">envOnce</span><span class="op" id="2250603">.</span><span class="ident" id="2250604">Do</span><span class="op" id="2250606">(</span><span class="ident" id="2250607">copyenv</span><span class="op" id="2250614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250617">if</span>&nbsp;<span class="builtinfunc" id="2250620">len</span><span class="op" id="2250623">(</span><span class="ident" id="2250624">key</span><span class="op" id="2250627">)</span>&nbsp;<span class="op" id="2250629">==</span>&nbsp;<span class="num" id="2250632">0</span>&nbsp;<span class="op" id="2250634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250638">return</span>&nbsp;<span class="string" id="2250645">&#34;&#34;</span><span class="op" id="2250647">,</span>&nbsp;<span class="ident" id="2250649">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250660">envLock</span><span class="op" id="2250667">.</span><span class="ident" id="2250668">RLock</span><span class="op" id="2250673">(</span><span class="op" id="2250674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250677">defer</span>&nbsp;<span class="ident" id="2250683">envLock</span><span class="op" id="2250690">.</span><span class="ident" id="2250691">RUnlock</span><span class="op" id="2250698">(</span><span class="op" id="2250699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250703">i</span><span class="op" id="2250704">,</span>&nbsp;<span class="ident" id="2250706">ok</span>&nbsp;<span class="op" id="2250709">:=</span>&nbsp;<span class="ident" id="2250712">env</span><span class="op" id="2250715">[</span><span class="ident" id="2250716">key</span><span class="op" id="2250719">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250722">if</span>&nbsp;<span class="op" id="2250725">!</span><span class="ident" id="2250726">ok</span>&nbsp;<span class="op" id="2250729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250733">return</span>&nbsp;<span class="string" id="2250740">&#34;&#34;</span><span class="op" id="2250742">,</span>&nbsp;<span class="ident" id="2250744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250754">s</span>&nbsp;<span class="op" id="2250756">:=</span>&nbsp;<span class="ident" id="2250759">envs</span><span class="op" id="2250763">[</span><span class="ident" id="2250764">i</span><span class="op" id="2250765">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250768">for</span>&nbsp;<span class="ident" id="2250772">i</span>&nbsp;<span class="op" id="2250774">:=</span>&nbsp;<span class="num" id="2250777">0</span><span class="op" id="2250778">;</span>&nbsp;<span class="ident" id="2250780">i</span>&nbsp;<span class="op" id="2250782">&lt;</span>&nbsp;<span class="builtinfunc" id="2250784">len</span><span class="op" id="2250787">(</span><span class="ident" id="2250788">s</span><span class="op" id="2250789">)</span><span class="op" id="2250790">;</span>&nbsp;<span class="ident" id="2250792">i</span><span class="op" id="2250793">++</span>&nbsp;<span class="op" id="2250796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250800">if</span>&nbsp;<span class="ident" id="2250803">s</span><span class="op" id="2250804">[</span><span class="ident" id="2250805">i</span><span class="op" id="2250806">]</span>&nbsp;<span class="op" id="2250808">==</span>&nbsp;<span class="string" id="2250811">&#39;=&#39;</span>&nbsp;<span class="op" id="2250815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250820">return</span>&nbsp;<span class="ident" id="2250827">s</span><span class="op" id="2250828">[</span><span class="ident" id="2250829">i</span><span class="op" id="2250830">+</span><span class="num" id="2250831">1</span><span class="op" id="2250832">:</span><span class="op" id="2250833">]</span><span class="op" id="2250834">,</span>&nbsp;<span class="ident" id="2250836">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250846">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250849">return</span>&nbsp;<span class="string" id="2250856">&#34;&#34;</span><span class="op" id="2250858">,</span>&nbsp;<span class="ident" id="2250860">false</span><br>
<span class="lineno"></span><span class="op" id="2250866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2250869">func</span>&nbsp;<span class="ident" id="2250874">Setenv</span><span class="op" id="2250880">(</span><span class="ident" id="2250881">key</span><span class="op" id="2250884">,</span>&nbsp;<span class="ident" id="2250886">value</span>&nbsp;<span class="builtintype" id="2250892">string</span><span class="op" id="2250898">)</span>&nbsp;<span class="builtintype" id="2250900">error</span>&nbsp;<span class="op" id="2250906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250909">envOnce</span><span class="op" id="2250916">.</span><span class="ident" id="2250917">Do</span><span class="op" id="2250919">(</span><span class="ident" id="2250920">copyenv</span><span class="op" id="2250927">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250930">if</span>&nbsp;<span class="builtinfunc" id="2250933">len</span><span class="op" id="2250936">(</span><span class="ident" id="2250937">key</span><span class="op" id="2250940">)</span>&nbsp;<span class="op" id="2250942">==</span>&nbsp;<span class="num" id="2250945">0</span>&nbsp;<span class="op" id="2250947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250951">return</span>&nbsp;<span class="ident" id="2250958">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250969">for</span>&nbsp;<span class="ident" id="2250973">i</span>&nbsp;<span class="op" id="2250975">:=</span>&nbsp;<span class="num" id="2250978">0</span><span class="op" id="2250979">;</span>&nbsp;<span class="ident" id="2250981">i</span>&nbsp;<span class="op" id="2250983">&lt;</span>&nbsp;<span class="builtinfunc" id="2250985">len</span><span class="op" id="2250988">(</span><span class="ident" id="2250989">key</span><span class="op" id="2250992">)</span><span class="op" id="2250993">;</span>&nbsp;<span class="ident" id="2250995">i</span><span class="op" id="2250996">++</span>&nbsp;<span class="op" id="2250999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251003">if</span>&nbsp;<span class="ident" id="2251006">key</span><span class="op" id="2251009">[</span><span class="ident" id="2251010">i</span><span class="op" id="2251011">]</span>&nbsp;<span class="op" id="2251013">==</span>&nbsp;<span class="string" id="2251016">&#39;=&#39;</span>&nbsp;<span class="op" id="2251020">||</span>&nbsp;<span class="ident" id="2251023">key</span><span class="op" id="2251026">[</span><span class="ident" id="2251027">i</span><span class="op" id="2251028">]</span>&nbsp;<span class="op" id="2251030">==</span>&nbsp;<span class="num" id="2251033">0</span>&nbsp;<span class="op" id="2251035">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251040">return</span>&nbsp;<span class="ident" id="2251047">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251062">for</span>&nbsp;<span class="ident" id="2251066">i</span>&nbsp;<span class="op" id="2251068">:=</span>&nbsp;<span class="num" id="2251071">0</span><span class="op" id="2251072">;</span>&nbsp;<span class="ident" id="2251074">i</span>&nbsp;<span class="op" id="2251076">&lt;</span>&nbsp;<span class="builtinfunc" id="2251078">len</span><span class="op" id="2251081">(</span><span class="ident" id="2251082">value</span><span class="op" id="2251087">)</span><span class="op" id="2251088">;</span>&nbsp;<span class="ident" id="2251090">i</span><span class="op" id="2251091">++</span>&nbsp;<span class="op" id="2251094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251098">if</span>&nbsp;<span class="ident" id="2251101">value</span><span class="op" id="2251106">[</span><span class="ident" id="2251107">i</span><span class="op" id="2251108">]</span>&nbsp;<span class="op" id="2251110">==</span>&nbsp;<span class="num" id="2251113">0</span>&nbsp;<span class="op" id="2251115">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251120">return</span>&nbsp;<span class="ident" id="2251127">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251143">envLock</span><span class="op" id="2251150">.</span><span class="ident" id="2251151">Lock</span><span class="op" id="2251155">(</span><span class="op" id="2251156">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251159">defer</span>&nbsp;<span class="ident" id="2251165">envLock</span><span class="op" id="2251172">.</span><span class="ident" id="2251173">Unlock</span><span class="op" id="2251179">(</span><span class="op" id="2251180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251184">i</span><span class="op" id="2251185">,</span>&nbsp;<span class="ident" id="2251187">ok</span>&nbsp;<span class="op" id="2251190">:=</span>&nbsp;<span class="ident" id="2251193">env</span><span class="op" id="2251196">[</span><span class="ident" id="2251197">key</span><span class="op" id="2251200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251203">kv</span>&nbsp;<span class="op" id="2251206">:=</span>&nbsp;<span class="ident" id="2251209">key</span>&nbsp;<span class="op" id="2251213">+</span>&nbsp;<span class="string" id="2251215">&#34;=&#34;</span>&nbsp;<span class="op" id="2251219">+</span>&nbsp;<span class="ident" id="2251221">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251228">if</span>&nbsp;<span class="ident" id="2251231">ok</span>&nbsp;<span class="op" id="2251234">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251238">envs</span><span class="op" id="2251242">[</span><span class="ident" id="2251243">i</span><span class="op" id="2251244">]</span>&nbsp;<span class="op" id="2251246">=</span>&nbsp;<span class="ident" id="2251248">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251252">}</span>&nbsp;<span class="keyword" id="2251254">else</span>&nbsp;<span class="op" id="2251259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251263">i</span>&nbsp;<span class="op" id="2251265">=</span>&nbsp;<span class="builtinfunc" id="2251267">len</span><span class="op" id="2251270">(</span><span class="ident" id="2251271">envs</span><span class="op" id="2251275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251279">envs</span>&nbsp;<span class="op" id="2251284">=</span>&nbsp;<span class="builtinfunc" id="2251286">append</span><span class="op" id="2251292">(</span><span class="ident" id="2251293">envs</span><span class="op" id="2251297">,</span>&nbsp;<span class="ident" id="2251299">kv</span><span class="op" id="2251301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251304">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251307">env</span><span class="op" id="2251310">[</span><span class="ident" id="2251311">key</span><span class="op" id="2251314">]</span>&nbsp;<span class="op" id="2251316">=</span>&nbsp;<span class="ident" id="2251318">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251321">setenv_c</span><span class="op" id="2251329">(</span><span class="ident" id="2251330">key</span><span class="op" id="2251333">,</span>&nbsp;<span class="ident" id="2251335">value</span><span class="op" id="2251340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251343">return</span>&nbsp;<span class="ident" id="2251350">nil</span><br>
<span class="lineno"></span><span class="op" id="2251354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2251357">func</span>&nbsp;<span class="ident" id="2251362">Clearenv</span><span class="op" id="2251370">(</span><span class="op" id="2251371">)</span>&nbsp;<span class="op" id="2251373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251376">envOnce</span><span class="op" id="2251383">.</span><span class="ident" id="2251384">Do</span><span class="op" id="2251386">(</span><span class="ident" id="2251387">copyenv</span><span class="op" id="2251394">)</span>&nbsp;<span class="comment" id="2251396">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251434">envLock</span><span class="op" id="2251441">.</span><span class="ident" id="2251442">Lock</span><span class="op" id="2251446">(</span><span class="op" id="2251447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251450">defer</span>&nbsp;<span class="ident" id="2251456">envLock</span><span class="op" id="2251463">.</span><span class="ident" id="2251464">Unlock</span><span class="op" id="2251470">(</span><span class="op" id="2251471">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251475">for</span>&nbsp;<span class="ident" id="2251479">k</span>&nbsp;<span class="op" id="2251481">:=</span>&nbsp;<span class="keyword" id="2251484">range</span>&nbsp;<span class="ident" id="2251490">env</span>&nbsp;<span class="op" id="2251494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251498">unsetenv_c</span><span class="op" id="2251508">(</span><span class="ident" id="2251509">k</span><span class="op" id="2251510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251516">env</span>&nbsp;<span class="op" id="2251520">=</span>&nbsp;<span class="builtinfunc" id="2251522">make</span><span class="op" id="2251526">(</span><span class="keyword" id="2251527">map</span><span class="op" id="2251530">[</span><span class="builtintype" id="2251531">string</span><span class="op" id="2251537">]</span><span class="builtintype" id="2251538">int</span><span class="op" id="2251541">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251544">envs</span>&nbsp;<span class="op" id="2251549">=</span>&nbsp;<span class="op" id="2251551">[</span><span class="op" id="2251552">]</span><span class="builtintype" id="2251553">string</span><span class="op" id="2251559">{</span><span class="op" id="2251560">}</span><br>
<span class="lineno"></span><span class="op" id="2251562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2251565">func</span>&nbsp;<span class="ident" id="2251570">Environ</span><span class="op" id="2251577">(</span><span class="op" id="2251578">)</span>&nbsp;<span class="op" id="2251580">[</span><span class="op" id="2251581">]</span><span class="builtintype" id="2251582">string</span>&nbsp;<span class="op" id="2251589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251592">envOnce</span><span class="op" id="2251599">.</span><span class="ident" id="2251600">Do</span><span class="op" id="2251602">(</span><span class="ident" id="2251603">copyenv</span><span class="op" id="2251610">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251613">envLock</span><span class="op" id="2251620">.</span><span class="ident" id="2251621">RLock</span><span class="op" id="2251626">(</span><span class="op" id="2251627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251630">defer</span>&nbsp;<span class="ident" id="2251636">envLock</span><span class="op" id="2251643">.</span><span class="ident" id="2251644">RUnlock</span><span class="op" id="2251651">(</span><span class="op" id="2251652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251655">a</span>&nbsp;<span class="op" id="2251657">:=</span>&nbsp;<span class="builtinfunc" id="2251660">make</span><span class="op" id="2251664">(</span><span class="op" id="2251665">[</span><span class="op" id="2251666">]</span><span class="builtintype" id="2251667">string</span><span class="op" id="2251673">,</span>&nbsp;<span class="num" id="2251675">0</span><span class="op" id="2251676">,</span>&nbsp;<span class="builtinfunc" id="2251678">len</span><span class="op" id="2251681">(</span><span class="ident" id="2251682">envs</span><span class="op" id="2251686">)</span><span class="op" id="2251687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251690">for</span>&nbsp;<span class="ident" id="2251694">_</span><span class="op" id="2251695">,</span>&nbsp;<span class="ident" id="2251697">env</span>&nbsp;<span class="op" id="2251701">:=</span>&nbsp;<span class="keyword" id="2251704">range</span>&nbsp;<span class="ident" id="2251710">envs</span>&nbsp;<span class="op" id="2251715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251719">if</span>&nbsp;<span class="ident" id="2251722">env</span>&nbsp;<span class="op" id="2251726">!=</span>&nbsp;<span class="string" id="2251729">&#34;&#34;</span>&nbsp;<span class="op" id="2251732">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251737">a</span>&nbsp;<span class="op" id="2251739">=</span>&nbsp;<span class="builtinfunc" id="2251741">append</span><span class="op" id="2251747">(</span><span class="ident" id="2251748">a</span><span class="op" id="2251749">,</span>&nbsp;<span class="ident" id="2251751">env</span><span class="op" id="2251754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251764">return</span>&nbsp;<span class="ident" id="2251771">a</span><br>
<span class="lineno"></span><span class="op" id="2251773">}</span>
</div>
</body>
</html>
