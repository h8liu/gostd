<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5663545">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5663600">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5663654">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5663705">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5663777">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5663851">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5663926">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5663984">//</span><br>
<span class="lineno">10</span><span class="keyword" id="5663987">package</span>&nbsp;<span class="ident" id="5663995">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5664003">import</span>&nbsp;<span class="op" id="5664010">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664013">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664020">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664030">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664044">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664056">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664067">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5664078">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5664088">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5664091">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5664150">type</span>&nbsp;<span class="ident" id="5664155">parser</span>&nbsp;<span class="keyword" id="5664162">struct</span>&nbsp;<span class="op" id="5664169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664172">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664180">*</span><span class="ident" id="5664181">token</span><span class="op" id="5664186">.</span><span class="ident" id="5664187">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664193">errors</span>&nbsp;&nbsp;<span class="ident" id="5664201">scanner</span><span class="op" id="5664208">.</span><span class="ident" id="5664209">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664220">scanner</span>&nbsp;<span class="ident" id="5664228">scanner</span><span class="op" id="5664235">.</span><span class="ident" id="5664236">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664246">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664268">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5664275">Mode</span>&nbsp;<span class="comment" id="5664280">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664297">trace</span>&nbsp;&nbsp;<span class="builtintype" id="5664304">bool</span>&nbsp;<span class="comment" id="5664309">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664336">indent</span>&nbsp;<span class="builtintype" id="5664343">int</span>&nbsp;&nbsp;<span class="comment" id="5664348">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664389">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664402">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5664414">[</span><span class="op" id="5664415">]</span><span class="op" id="5664416">*</span><span class="ident" id="5664417">ast</span><span class="op" id="5664420">.</span><span class="ident" id="5664421">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664435">leadComment</span>&nbsp;<span class="op" id="5664447">*</span><span class="ident" id="5664448">ast</span><span class="op" id="5664451">.</span><span class="ident" id="5664452">CommentGroup</span>&nbsp;<span class="comment" id="5664465">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664487">lineComment</span>&nbsp;<span class="op" id="5664499">*</span><span class="ident" id="5664500">ast</span><span class="op" id="5664503">.</span><span class="ident" id="5664504">CommentGroup</span>&nbsp;<span class="comment" id="5664517">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664540">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664555">pos</span>&nbsp;<span class="ident" id="5664559">token</span><span class="op" id="5664564">.</span><span class="ident" id="5664565">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5664571">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664590">tok</span>&nbsp;<span class="ident" id="5664594">token</span><span class="op" id="5664599">.</span><span class="ident" id="5664600">Token</span>&nbsp;<span class="comment" id="5664606">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664631">lit</span>&nbsp;<span class="builtintype" id="5664635">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664647">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664666">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664685">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664745">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664805">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664871">syncPos</span>&nbsp;<span class="ident" id="5664879">token</span><span class="op" id="5664884">.</span><span class="ident" id="5664885">Pos</span>&nbsp;<span class="comment" id="5664889">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5664923">syncCnt</span>&nbsp;<span class="builtintype" id="5664931">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5664941">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5664990">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665023">exprLev</span>&nbsp;<span class="builtintype" id="5665031">int</span>&nbsp;&nbsp;<span class="comment" id="5665036">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665084">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5665092">bool</span>&nbsp;<span class="comment" id="5665097">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665149">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665180">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5665191">*</span><span class="ident" id="5665192">ast</span><span class="op" id="5665195">.</span><span class="ident" id="5665196">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665209">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665235">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5665246">*</span><span class="ident" id="5665247">ast</span><span class="op" id="5665250">.</span><span class="ident" id="5665251">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665264">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665300">unresolved</span>&nbsp;<span class="op" id="5665311">[</span><span class="op" id="5665312">]</span><span class="op" id="5665313">*</span><span class="ident" id="5665314">ast</span><span class="op" id="5665317">.</span><span class="ident" id="5665318">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665329">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665356">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5665367">[</span><span class="op" id="5665368">]</span><span class="op" id="5665369">*</span><span class="ident" id="5665370">ast</span><span class="op" id="5665373">.</span><span class="ident" id="5665374">ImportSpec</span>&nbsp;<span class="comment" id="5665385">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665406">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5665423">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665465">labelScope</span>&nbsp;&nbsp;<span class="op" id="5665477">*</span><span class="ident" id="5665478">ast</span><span class="op" id="5665481">.</span><span class="ident" id="5665482">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5665492">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665529">targetStack</span>&nbsp;<span class="op" id="5665541">[</span><span class="op" id="5665542">]</span><span class="op" id="5665543">[</span><span class="op" id="5665544">]</span><span class="op" id="5665545">*</span><span class="ident" id="5665546">ast</span><span class="op" id="5665549">.</span><span class="ident" id="5665550">Ident</span>&nbsp;<span class="comment" id="5665556">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="5665586">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5665589">func</span>&nbsp;<span class="op" id="5665594">(</span><span class="ident" id="5665595">p</span>&nbsp;<span class="op" id="5665597">*</span><span class="ident" id="5665598">parser</span><span class="op" id="5665604">)</span>&nbsp;<span class="ident" id="5665606">init</span><span class="op" id="5665610">(</span><span class="ident" id="5665611">fset</span>&nbsp;<span class="op" id="5665616">*</span><span class="ident" id="5665617">token</span><span class="op" id="5665622">.</span><span class="ident" id="5665623">FileSet</span><span class="op" id="5665630">,</span>&nbsp;<span class="ident" id="5665632">filename</span>&nbsp;<span class="builtintype" id="5665641">string</span><span class="op" id="5665647">,</span>&nbsp;<span class="ident" id="5665649">src</span>&nbsp;<span class="op" id="5665653">[</span><span class="op" id="5665654">]</span><span class="builtintype" id="5665655">byte</span><span class="op" id="5665659">,</span>&nbsp;<span class="ident" id="5665661">mode</span>&nbsp;<span class="ident" id="5665666">Mode</span><span class="op" id="5665670">)</span>&nbsp;<span class="op" id="5665672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665675">p</span><span class="op" id="5665676">.</span><span class="ident" id="5665677">file</span>&nbsp;<span class="op" id="5665682">=</span>&nbsp;<span class="ident" id="5665684">fset</span><span class="op" id="5665688">.</span><span class="ident" id="5665689">AddFile</span><span class="op" id="5665696">(</span><span class="ident" id="5665697">filename</span><span class="op" id="5665705">,</span>&nbsp;<span class="op" id="5665707">-</span><span class="num" id="5665708">1</span><span class="op" id="5665709">,</span>&nbsp;<span class="builtinfunc" id="5665711">len</span><span class="op" id="5665714">(</span><span class="ident" id="5665715">src</span><span class="op" id="5665718">)</span><span class="op" id="5665719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665722">var</span>&nbsp;<span class="ident" id="5665726">m</span>&nbsp;<span class="ident" id="5665728">scanner</span><span class="op" id="5665735">.</span><span class="ident" id="5665736">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5665742">if</span>&nbsp;<span class="ident" id="5665745">mode</span><span class="op" id="5665749">&amp;</span><span class="ident" id="5665750">ParseComments</span>&nbsp;<span class="op" id="5665764">!=</span>&nbsp;<span class="num" id="5665767">0</span>&nbsp;<span class="op" id="5665769">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665773">m</span>&nbsp;<span class="op" id="5665775">=</span>&nbsp;<span class="ident" id="5665777">scanner</span><span class="op" id="5665784">.</span><span class="ident" id="5665785">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5665799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665802">eh</span>&nbsp;<span class="op" id="5665805">:=</span>&nbsp;<span class="keyword" id="5665808">func</span><span class="op" id="5665812">(</span><span class="ident" id="5665813">pos</span>&nbsp;<span class="ident" id="5665817">token</span><span class="op" id="5665822">.</span><span class="ident" id="5665823">Position</span><span class="op" id="5665831">,</span>&nbsp;<span class="ident" id="5665833">msg</span>&nbsp;<span class="builtintype" id="5665837">string</span><span class="op" id="5665843">)</span>&nbsp;<span class="op" id="5665845">{</span>&nbsp;<span class="ident" id="5665847">p</span><span class="op" id="5665848">.</span><span class="ident" id="5665849">errors</span><span class="op" id="5665855">.</span><span class="ident" id="5665856">Add</span><span class="op" id="5665859">(</span><span class="ident" id="5665860">pos</span><span class="op" id="5665863">,</span>&nbsp;<span class="ident" id="5665865">msg</span><span class="op" id="5665868">)</span>&nbsp;<span class="op" id="5665870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665873">p</span><span class="op" id="5665874">.</span><span class="ident" id="5665875">scanner</span><span class="op" id="5665882">.</span><span class="ident" id="5665883">Init</span><span class="op" id="5665887">(</span><span class="ident" id="5665888">p</span><span class="op" id="5665889">.</span><span class="ident" id="5665890">file</span><span class="op" id="5665894">,</span>&nbsp;<span class="ident" id="5665896">src</span><span class="op" id="5665899">,</span>&nbsp;<span class="ident" id="5665901">eh</span><span class="op" id="5665903">,</span>&nbsp;<span class="ident" id="5665905">m</span><span class="op" id="5665906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665910">p</span><span class="op" id="5665911">.</span><span class="ident" id="5665912">mode</span>&nbsp;<span class="op" id="5665917">=</span>&nbsp;<span class="ident" id="5665919">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5665925">p</span><span class="op" id="5665926">.</span><span class="ident" id="5665927">trace</span>&nbsp;<span class="op" id="5665933">=</span>&nbsp;<span class="ident" id="5665935">mode</span><span class="op" id="5665939">&amp;</span><span class="ident" id="5665940">Trace</span>&nbsp;<span class="op" id="5665946">!=</span>&nbsp;<span class="num" id="5665949">0</span>&nbsp;<span class="comment" id="5665951">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666001">p</span><span class="op" id="5666002">.</span><span class="ident" id="5666003">next</span><span class="op" id="5666007">(</span><span class="op" id="5666008">)</span><br>
<span class="lineno"></span><span class="op" id="5666010">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5666013">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5666093">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666113">func</span>&nbsp;<span class="op" id="5666118">(</span><span class="ident" id="5666119">p</span>&nbsp;<span class="op" id="5666121">*</span><span class="ident" id="5666122">parser</span><span class="op" id="5666128">)</span>&nbsp;<span class="ident" id="5666130">openScope</span><span class="op" id="5666139">(</span><span class="op" id="5666140">)</span>&nbsp;<span class="op" id="5666142">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666145">p</span><span class="op" id="5666146">.</span><span class="ident" id="5666147">topScope</span>&nbsp;<span class="op" id="5666156">=</span>&nbsp;<span class="ident" id="5666158">ast</span><span class="op" id="5666161">.</span><span class="ident" id="5666162">NewScope</span><span class="op" id="5666170">(</span><span class="ident" id="5666171">p</span><span class="op" id="5666172">.</span><span class="ident" id="5666173">topScope</span><span class="op" id="5666181">)</span><br>
<span class="lineno"></span><span class="op" id="5666183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666186">func</span>&nbsp;<span class="op" id="5666191">(</span><span class="ident" id="5666192">p</span>&nbsp;<span class="op" id="5666194">*</span><span class="ident" id="5666195">parser</span><span class="op" id="5666201">)</span>&nbsp;<span class="ident" id="5666203">closeScope</span><span class="op" id="5666213">(</span><span class="op" id="5666214">)</span>&nbsp;<span class="op" id="5666216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666219">p</span><span class="op" id="5666220">.</span><span class="ident" id="5666221">topScope</span>&nbsp;<span class="op" id="5666230">=</span>&nbsp;<span class="ident" id="5666232">p</span><span class="op" id="5666233">.</span><span class="ident" id="5666234">topScope</span><span class="op" id="5666242">.</span><span class="ident" id="5666243">Outer</span><br>
<span class="lineno">90</span><span class="op" id="5666249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666252">func</span>&nbsp;<span class="op" id="5666257">(</span><span class="ident" id="5666258">p</span>&nbsp;<span class="op" id="5666260">*</span><span class="ident" id="5666261">parser</span><span class="op" id="5666267">)</span>&nbsp;<span class="ident" id="5666269">openLabelScope</span><span class="op" id="5666283">(</span><span class="op" id="5666284">)</span>&nbsp;<span class="op" id="5666286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666289">p</span><span class="op" id="5666290">.</span><span class="ident" id="5666291">labelScope</span>&nbsp;<span class="op" id="5666302">=</span>&nbsp;<span class="ident" id="5666304">ast</span><span class="op" id="5666307">.</span><span class="ident" id="5666308">NewScope</span><span class="op" id="5666316">(</span><span class="ident" id="5666317">p</span><span class="op" id="5666318">.</span><span class="ident" id="5666319">labelScope</span><span class="op" id="5666329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666332">p</span><span class="op" id="5666333">.</span><span class="ident" id="5666334">targetStack</span>&nbsp;<span class="op" id="5666346">=</span>&nbsp;<span class="builtinfunc" id="5666348">append</span><span class="op" id="5666354">(</span><span class="ident" id="5666355">p</span><span class="op" id="5666356">.</span><span class="ident" id="5666357">targetStack</span><span class="op" id="5666368">,</span>&nbsp;<span class="ident" id="5666370">nil</span><span class="op" id="5666373">)</span><br>
<span class="lineno">95</span><span class="op" id="5666375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666378">func</span>&nbsp;<span class="op" id="5666383">(</span><span class="ident" id="5666384">p</span>&nbsp;<span class="op" id="5666386">*</span><span class="ident" id="5666387">parser</span><span class="op" id="5666393">)</span>&nbsp;<span class="ident" id="5666395">closeLabelScope</span><span class="op" id="5666410">(</span><span class="op" id="5666411">)</span>&nbsp;<span class="op" id="5666413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666416">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666435">n</span>&nbsp;<span class="op" id="5666437">:=</span>&nbsp;<span class="builtinfunc" id="5666440">len</span><span class="op" id="5666443">(</span><span class="ident" id="5666444">p</span><span class="op" id="5666445">.</span><span class="ident" id="5666446">targetStack</span><span class="op" id="5666457">)</span>&nbsp;<span class="op" id="5666459">-</span>&nbsp;<span class="num" id="5666461">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666464">scope</span>&nbsp;<span class="op" id="5666470">:=</span>&nbsp;<span class="ident" id="5666473">p</span><span class="op" id="5666474">.</span><span class="ident" id="5666475">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666487">for</span>&nbsp;<span class="ident" id="5666491">_</span><span class="op" id="5666492">,</span>&nbsp;<span class="ident" id="5666494">ident</span>&nbsp;<span class="op" id="5666500">:=</span>&nbsp;<span class="keyword" id="5666503">range</span>&nbsp;<span class="ident" id="5666509">p</span><span class="op" id="5666510">.</span><span class="ident" id="5666511">targetStack</span><span class="op" id="5666522">[</span><span class="ident" id="5666523">n</span><span class="op" id="5666524">]</span>&nbsp;<span class="op" id="5666526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666530">ident</span><span class="op" id="5666535">.</span><span class="ident" id="5666536">Obj</span>&nbsp;<span class="op" id="5666540">=</span>&nbsp;<span class="ident" id="5666542">scope</span><span class="op" id="5666547">.</span><span class="ident" id="5666548">Lookup</span><span class="op" id="5666554">(</span><span class="ident" id="5666555">ident</span><span class="op" id="5666560">.</span><span class="ident" id="5666561">Name</span><span class="op" id="5666565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666569">if</span>&nbsp;<span class="ident" id="5666572">ident</span><span class="op" id="5666577">.</span><span class="ident" id="5666578">Obj</span>&nbsp;<span class="op" id="5666582">==</span>&nbsp;<span class="ident" id="5666585">nil</span>&nbsp;<span class="op" id="5666589">&amp;&amp;</span>&nbsp;<span class="ident" id="5666592">p</span><span class="op" id="5666593">.</span><span class="ident" id="5666594">mode</span><span class="op" id="5666598">&amp;</span><span class="ident" id="5666599">DeclarationErrors</span>&nbsp;<span class="op" id="5666617">!=</span>&nbsp;<span class="num" id="5666620">0</span>&nbsp;<span class="op" id="5666622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666627">p</span><span class="op" id="5666628">.</span><span class="builtintype" id="5666629">error</span><span class="op" id="5666634">(</span><span class="ident" id="5666635">ident</span><span class="op" id="5666640">.</span><span class="ident" id="5666641">Pos</span><span class="op" id="5666644">(</span><span class="op" id="5666645">)</span><span class="op" id="5666646">,</span>&nbsp;<span class="ident" id="5666648">fmt</span><span class="op" id="5666651">.</span><span class="ident" id="5666652">Sprintf</span><span class="op" id="5666659">(</span><span class="string" id="5666660">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="5666680">,</span>&nbsp;<span class="ident" id="5666682">ident</span><span class="op" id="5666687">.</span><span class="ident" id="5666688">Name</span><span class="op" id="5666692">)</span><span class="op" id="5666693">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5666700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5666703">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666723">p</span><span class="op" id="5666724">.</span><span class="ident" id="5666725">targetStack</span>&nbsp;<span class="op" id="5666737">=</span>&nbsp;<span class="ident" id="5666739">p</span><span class="op" id="5666740">.</span><span class="ident" id="5666741">targetStack</span><span class="op" id="5666752">[</span><span class="num" id="5666753">0</span><span class="op" id="5666754">:</span><span class="ident" id="5666755">n</span><span class="op" id="5666756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666759">p</span><span class="op" id="5666760">.</span><span class="ident" id="5666761">labelScope</span>&nbsp;<span class="op" id="5666772">=</span>&nbsp;<span class="ident" id="5666774">p</span><span class="op" id="5666775">.</span><span class="ident" id="5666776">labelScope</span><span class="op" id="5666786">.</span><span class="ident" id="5666787">Outer</span><br>
<span class="lineno">110</span><span class="op" id="5666793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5666796">func</span>&nbsp;<span class="op" id="5666801">(</span><span class="ident" id="5666802">p</span>&nbsp;<span class="op" id="5666804">*</span><span class="ident" id="5666805">parser</span><span class="op" id="5666811">)</span>&nbsp;<span class="ident" id="5666813">declare</span><span class="op" id="5666820">(</span><span class="ident" id="5666821">decl</span><span class="op" id="5666825">,</span>&nbsp;<span class="ident" id="5666827">data</span>&nbsp;<span class="keyword" id="5666832">interface</span><span class="op" id="5666841">{</span><span class="op" id="5666842">}</span><span class="op" id="5666843">,</span>&nbsp;<span class="ident" id="5666845">scope</span>&nbsp;<span class="op" id="5666851">*</span><span class="ident" id="5666852">ast</span><span class="op" id="5666855">.</span><span class="ident" id="5666856">Scope</span><span class="op" id="5666861">,</span>&nbsp;<span class="ident" id="5666863">kind</span>&nbsp;<span class="ident" id="5666868">ast</span><span class="op" id="5666871">.</span><span class="ident" id="5666872">ObjKind</span><span class="op" id="5666879">,</span>&nbsp;<span class="ident" id="5666881">idents</span>&nbsp;<span class="op" id="5666888">...</span><span class="op" id="5666891">*</span><span class="ident" id="5666892">ast</span><span class="op" id="5666895">.</span><span class="ident" id="5666896">Ident</span><span class="op" id="5666901">)</span>&nbsp;<span class="op" id="5666903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5666906">for</span>&nbsp;<span class="ident" id="5666910">_</span><span class="op" id="5666911">,</span>&nbsp;<span class="ident" id="5666913">ident</span>&nbsp;<span class="op" id="5666919">:=</span>&nbsp;<span class="keyword" id="5666922">range</span>&nbsp;<span class="ident" id="5666928">idents</span>&nbsp;<span class="op" id="5666935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5666939">assert</span><span class="op" id="5666945">(</span><span class="ident" id="5666946">ident</span><span class="op" id="5666951">.</span><span class="ident" id="5666952">Obj</span>&nbsp;<span class="op" id="5666956">==</span>&nbsp;<span class="ident" id="5666959">nil</span><span class="op" id="5666962">,</span>&nbsp;<span class="string" id="5666964">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5667005">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667009">obj</span>&nbsp;<span class="op" id="5667013">:=</span>&nbsp;<span class="ident" id="5667016">ast</span><span class="op" id="5667019">.</span><span class="ident" id="5667020">NewObj</span><span class="op" id="5667026">(</span><span class="ident" id="5667027">kind</span><span class="op" id="5667031">,</span>&nbsp;<span class="ident" id="5667033">ident</span><span class="op" id="5667038">.</span><span class="ident" id="5667039">Name</span><span class="op" id="5667043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667047">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667109">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667171">obj</span><span class="op" id="5667174">.</span><span class="ident" id="5667175">Decl</span>&nbsp;<span class="op" id="5667180">=</span>&nbsp;<span class="ident" id="5667182">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667189">obj</span><span class="op" id="5667192">.</span><span class="ident" id="5667193">Data</span>&nbsp;<span class="op" id="5667198">=</span>&nbsp;<span class="ident" id="5667200">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667207">ident</span><span class="op" id="5667212">.</span><span class="ident" id="5667213">Obj</span>&nbsp;<span class="op" id="5667217">=</span>&nbsp;<span class="ident" id="5667219">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667225">if</span>&nbsp;<span class="ident" id="5667228">ident</span><span class="op" id="5667233">.</span><span class="ident" id="5667234">Name</span>&nbsp;<span class="op" id="5667239">!=</span>&nbsp;<span class="string" id="5667242">&#34;_&#34;</span>&nbsp;<span class="op" id="5667246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667251">if</span>&nbsp;<span class="ident" id="5667254">alt</span>&nbsp;<span class="op" id="5667258">:=</span>&nbsp;<span class="ident" id="5667261">scope</span><span class="op" id="5667266">.</span><span class="ident" id="5667267">Insert</span><span class="op" id="5667273">(</span><span class="ident" id="5667274">obj</span><span class="op" id="5667277">)</span><span class="op" id="5667278">;</span>&nbsp;<span class="ident" id="5667280">alt</span>&nbsp;<span class="op" id="5667284">!=</span>&nbsp;<span class="ident" id="5667287">nil</span>&nbsp;<span class="op" id="5667291">&amp;&amp;</span>&nbsp;<span class="ident" id="5667294">p</span><span class="op" id="5667295">.</span><span class="ident" id="5667296">mode</span><span class="op" id="5667300">&amp;</span><span class="ident" id="5667301">DeclarationErrors</span>&nbsp;<span class="op" id="5667319">!=</span>&nbsp;<span class="num" id="5667322">0</span>&nbsp;<span class="op" id="5667324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667330">prevDecl</span>&nbsp;<span class="op" id="5667339">:=</span>&nbsp;<span class="string" id="5667342">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667349">if</span>&nbsp;<span class="ident" id="5667352">pos</span>&nbsp;<span class="op" id="5667356">:=</span>&nbsp;<span class="ident" id="5667359">alt</span><span class="op" id="5667362">.</span><span class="ident" id="5667363">Pos</span><span class="op" id="5667366">(</span><span class="op" id="5667367">)</span><span class="op" id="5667368">;</span>&nbsp;<span class="ident" id="5667370">pos</span><span class="op" id="5667373">.</span><span class="ident" id="5667374">IsValid</span><span class="op" id="5667381">(</span><span class="op" id="5667382">)</span>&nbsp;<span class="op" id="5667384">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667391">prevDecl</span>&nbsp;<span class="op" id="5667400">=</span>&nbsp;<span class="ident" id="5667402">fmt</span><span class="op" id="5667405">.</span><span class="ident" id="5667406">Sprintf</span><span class="op" id="5667413">(</span><span class="string" id="5667414">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5667446">,</span>&nbsp;<span class="ident" id="5667448">p</span><span class="op" id="5667449">.</span><span class="ident" id="5667450">file</span><span class="op" id="5667454">.</span><span class="ident" id="5667455">Position</span><span class="op" id="5667463">(</span><span class="ident" id="5667464">pos</span><span class="op" id="5667467">)</span><span class="op" id="5667468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667480">p</span><span class="op" id="5667481">.</span><span class="builtintype" id="5667482">error</span><span class="op" id="5667487">(</span><span class="ident" id="5667488">ident</span><span class="op" id="5667493">.</span><span class="ident" id="5667494">Pos</span><span class="op" id="5667497">(</span><span class="op" id="5667498">)</span><span class="op" id="5667499">,</span>&nbsp;<span class="ident" id="5667501">fmt</span><span class="op" id="5667504">.</span><span class="ident" id="5667505">Sprintf</span><span class="op" id="5667512">(</span><span class="string" id="5667513">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5667544">,</span>&nbsp;<span class="ident" id="5667546">ident</span><span class="op" id="5667551">.</span><span class="ident" id="5667552">Name</span><span class="op" id="5667556">,</span>&nbsp;<span class="ident" id="5667558">prevDecl</span><span class="op" id="5667566">)</span><span class="op" id="5667567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667576">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5667579">}</span><br>
<span class="lineno"></span><span class="op" id="5667581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5667584">func</span>&nbsp;<span class="op" id="5667589">(</span><span class="ident" id="5667590">p</span>&nbsp;<span class="op" id="5667592">*</span><span class="ident" id="5667593">parser</span><span class="op" id="5667599">)</span>&nbsp;<span class="ident" id="5667601">shortVarDecl</span><span class="op" id="5667613">(</span><span class="ident" id="5667614">decl</span>&nbsp;<span class="op" id="5667619">*</span><span class="ident" id="5667620">ast</span><span class="op" id="5667623">.</span><span class="ident" id="5667624">AssignStmt</span><span class="op" id="5667634">,</span>&nbsp;<span class="ident" id="5667636">list</span>&nbsp;<span class="op" id="5667641">[</span><span class="op" id="5667642">]</span><span class="ident" id="5667643">ast</span><span class="op" id="5667646">.</span><span class="ident" id="5667647">Expr</span><span class="op" id="5667651">)</span>&nbsp;<span class="op" id="5667653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667656">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667722">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5667788">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667859">n</span>&nbsp;<span class="op" id="5667861">:=</span>&nbsp;<span class="num" id="5667864">0</span>&nbsp;<span class="comment" id="5667866">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667894">for</span>&nbsp;<span class="ident" id="5667898">_</span><span class="op" id="5667899">,</span>&nbsp;<span class="ident" id="5667901">x</span>&nbsp;<span class="op" id="5667903">:=</span>&nbsp;<span class="keyword" id="5667906">range</span>&nbsp;<span class="ident" id="5667912">list</span>&nbsp;<span class="op" id="5667917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5667921">if</span>&nbsp;<span class="ident" id="5667924">ident</span><span class="op" id="5667929">,</span>&nbsp;<span class="ident" id="5667931">isIdent</span>&nbsp;<span class="op" id="5667939">:=</span>&nbsp;<span class="ident" id="5667942">x</span><span class="op" id="5667943">.</span><span class="op" id="5667944">(</span><span class="op" id="5667945">*</span><span class="ident" id="5667946">ast</span><span class="op" id="5667949">.</span><span class="ident" id="5667950">Ident</span><span class="op" id="5667955">)</span><span class="op" id="5667956">;</span>&nbsp;<span class="ident" id="5667958">isIdent</span>&nbsp;<span class="op" id="5667966">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5667971">assert</span><span class="op" id="5667977">(</span><span class="ident" id="5667978">ident</span><span class="op" id="5667983">.</span><span class="ident" id="5667984">Obj</span>&nbsp;<span class="op" id="5667988">==</span>&nbsp;<span class="ident" id="5667991">nil</span><span class="op" id="5667994">,</span>&nbsp;<span class="string" id="5667996">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5668037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668042">obj</span>&nbsp;<span class="op" id="5668046">:=</span>&nbsp;<span class="ident" id="5668049">ast</span><span class="op" id="5668052">.</span><span class="ident" id="5668053">NewObj</span><span class="op" id="5668059">(</span><span class="ident" id="5668060">ast</span><span class="op" id="5668063">.</span><span class="ident" id="5668064">Var</span><span class="op" id="5668067">,</span>&nbsp;<span class="ident" id="5668069">ident</span><span class="op" id="5668074">.</span><span class="ident" id="5668075">Name</span><span class="op" id="5668079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5668084">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668140">obj</span><span class="op" id="5668143">.</span><span class="ident" id="5668144">Decl</span>&nbsp;<span class="op" id="5668149">=</span>&nbsp;<span class="ident" id="5668151">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668159">ident</span><span class="op" id="5668164">.</span><span class="ident" id="5668165">Obj</span>&nbsp;<span class="op" id="5668169">=</span>&nbsp;<span class="ident" id="5668171">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668178">if</span>&nbsp;<span class="ident" id="5668181">ident</span><span class="op" id="5668186">.</span><span class="ident" id="5668187">Name</span>&nbsp;<span class="op" id="5668192">!=</span>&nbsp;<span class="string" id="5668195">&#34;_&#34;</span>&nbsp;<span class="op" id="5668199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668205">if</span>&nbsp;<span class="ident" id="5668208">alt</span>&nbsp;<span class="op" id="5668212">:=</span>&nbsp;<span class="ident" id="5668215">p</span><span class="op" id="5668216">.</span><span class="ident" id="5668217">topScope</span><span class="op" id="5668225">.</span><span class="ident" id="5668226">Insert</span><span class="op" id="5668232">(</span><span class="ident" id="5668233">obj</span><span class="op" id="5668236">)</span><span class="op" id="5668237">;</span>&nbsp;<span class="ident" id="5668239">alt</span>&nbsp;<span class="op" id="5668243">!=</span>&nbsp;<span class="ident" id="5668246">nil</span>&nbsp;<span class="op" id="5668250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668257">ident</span><span class="op" id="5668262">.</span><span class="ident" id="5668263">Obj</span>&nbsp;<span class="op" id="5668267">=</span>&nbsp;<span class="ident" id="5668269">alt</span>&nbsp;<span class="comment" id="5668273">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668294">}</span>&nbsp;<span class="keyword" id="5668296">else</span>&nbsp;<span class="op" id="5668301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668308">n</span><span class="op" id="5668309">++</span>&nbsp;<span class="comment" id="5668312">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668344">}</span>&nbsp;<span class="keyword" id="5668346">else</span>&nbsp;<span class="op" id="5668351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668356">p</span><span class="op" id="5668357">.</span><span class="ident" id="5668358">errorExpected</span><span class="op" id="5668371">(</span><span class="ident" id="5668372">x</span><span class="op" id="5668373">.</span><span class="ident" id="5668374">Pos</span><span class="op" id="5668377">(</span><span class="op" id="5668378">)</span><span class="op" id="5668379">,</span>&nbsp;<span class="string" id="5668381">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5668412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668416">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5668422">if</span>&nbsp;<span class="ident" id="5668425">n</span>&nbsp;<span class="op" id="5668427">==</span>&nbsp;<span class="num" id="5668430">0</span>&nbsp;<span class="op" id="5668432">&amp;&amp;</span>&nbsp;<span class="ident" id="5668435">p</span><span class="op" id="5668436">.</span><span class="ident" id="5668437">mode</span><span class="op" id="5668441">&amp;</span><span class="ident" id="5668442">DeclarationErrors</span>&nbsp;<span class="op" id="5668460">!=</span>&nbsp;<span class="num" id="5668463">0</span>&nbsp;<span class="op" id="5668465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5668469">p</span><span class="op" id="5668470">.</span><span class="builtintype" id="5668471">error</span><span class="op" id="5668476">(</span><span class="ident" id="5668477">list</span><span class="op" id="5668481">[</span><span class="num" id="5668482">0</span><span class="op" id="5668483">]</span><span class="op" id="5668484">.</span><span class="ident" id="5668485">Pos</span><span class="op" id="5668488">(</span><span class="op" id="5668489">)</span><span class="op" id="5668490">,</span>&nbsp;<span class="string" id="5668492">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5668529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5668532">}</span><br>
<span class="lineno"></span><span class="op" id="5668534">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="5668537">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5668617">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="5668699">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="5668724">var</span>&nbsp;<span class="ident" id="5668728">unresolved</span>&nbsp;<span class="op" id="5668739">=</span>&nbsp;<span class="builtinfunc" id="5668741">new</span><span class="op" id="5668744">(</span><span class="ident" id="5668745">ast</span><span class="op" id="5668748">.</span><span class="ident" id="5668749">Object</span><span class="op" id="5668755">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5668758">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5668831">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5668904">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="5668978">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="5668994">//</span><br>
<span class="lineno"></span><span class="keyword" id="5668997">func</span>&nbsp;<span class="op" id="5669002">(</span><span class="ident" id="5669003">p</span>&nbsp;<span class="op" id="5669005">*</span><span class="ident" id="5669006">parser</span><span class="op" id="5669012">)</span>&nbsp;<span class="ident" id="5669014">tryResolve</span><span class="op" id="5669024">(</span><span class="ident" id="5669025">x</span>&nbsp;<span class="ident" id="5669027">ast</span><span class="op" id="5669030">.</span><span class="ident" id="5669031">Expr</span><span class="op" id="5669035">,</span>&nbsp;<span class="ident" id="5669037">collectUnresolved</span>&nbsp;<span class="builtintype" id="5669055">bool</span><span class="op" id="5669059">)</span>&nbsp;<span class="op" id="5669061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669064">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669132">ident</span><span class="op" id="5669137">,</span>&nbsp;<span class="ident" id="5669139">_</span>&nbsp;<span class="op" id="5669141">:=</span>&nbsp;<span class="ident" id="5669144">x</span><span class="op" id="5669145">.</span><span class="op" id="5669146">(</span><span class="op" id="5669147">*</span><span class="ident" id="5669148">ast</span><span class="op" id="5669151">.</span><span class="ident" id="5669152">Ident</span><span class="op" id="5669157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669160">if</span>&nbsp;<span class="ident" id="5669163">ident</span>&nbsp;<span class="op" id="5669169">==</span>&nbsp;<span class="ident" id="5669172">nil</span>&nbsp;<span class="op" id="5669176">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669180">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669191">assert</span><span class="op" id="5669197">(</span><span class="ident" id="5669198">ident</span><span class="op" id="5669203">.</span><span class="ident" id="5669204">Obj</span>&nbsp;<span class="op" id="5669208">==</span>&nbsp;<span class="ident" id="5669211">nil</span><span class="op" id="5669214">,</span>&nbsp;<span class="string" id="5669216">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5669257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669260">if</span>&nbsp;<span class="ident" id="5669263">ident</span><span class="op" id="5669268">.</span><span class="ident" id="5669269">Name</span>&nbsp;<span class="op" id="5669274">==</span>&nbsp;<span class="string" id="5669277">&#34;_&#34;</span>&nbsp;<span class="op" id="5669281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669285">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669296">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669330">for</span>&nbsp;<span class="ident" id="5669334">s</span>&nbsp;<span class="op" id="5669336">:=</span>&nbsp;<span class="ident" id="5669339">p</span><span class="op" id="5669340">.</span><span class="ident" id="5669341">topScope</span><span class="op" id="5669349">;</span>&nbsp;<span class="ident" id="5669351">s</span>&nbsp;<span class="op" id="5669353">!=</span>&nbsp;<span class="ident" id="5669356">nil</span><span class="op" id="5669359">;</span>&nbsp;<span class="ident" id="5669361">s</span>&nbsp;<span class="op" id="5669363">=</span>&nbsp;<span class="ident" id="5669365">s</span><span class="op" id="5669366">.</span><span class="ident" id="5669367">Outer</span>&nbsp;<span class="op" id="5669373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669377">if</span>&nbsp;<span class="ident" id="5669380">obj</span>&nbsp;<span class="op" id="5669384">:=</span>&nbsp;<span class="ident" id="5669387">s</span><span class="op" id="5669388">.</span><span class="ident" id="5669389">Lookup</span><span class="op" id="5669395">(</span><span class="ident" id="5669396">ident</span><span class="op" id="5669401">.</span><span class="ident" id="5669402">Name</span><span class="op" id="5669406">)</span><span class="op" id="5669407">;</span>&nbsp;<span class="ident" id="5669409">obj</span>&nbsp;<span class="op" id="5669413">!=</span>&nbsp;<span class="ident" id="5669416">nil</span>&nbsp;<span class="op" id="5669420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669425">ident</span><span class="op" id="5669430">.</span><span class="ident" id="5669431">Obj</span>&nbsp;<span class="op" id="5669435">=</span>&nbsp;<span class="ident" id="5669437">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669444">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669459">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669520">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669578">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5669639">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669683">if</span>&nbsp;<span class="ident" id="5669686">collectUnresolved</span>&nbsp;<span class="op" id="5669704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669708">ident</span><span class="op" id="5669713">.</span><span class="ident" id="5669714">Obj</span>&nbsp;<span class="op" id="5669718">=</span>&nbsp;<span class="ident" id="5669720">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669733">p</span><span class="op" id="5669734">.</span><span class="ident" id="5669735">unresolved</span>&nbsp;<span class="op" id="5669746">=</span>&nbsp;<span class="builtinfunc" id="5669748">append</span><span class="op" id="5669754">(</span><span class="ident" id="5669755">p</span><span class="op" id="5669756">.</span><span class="ident" id="5669757">unresolved</span><span class="op" id="5669767">,</span>&nbsp;<span class="ident" id="5669769">ident</span><span class="op" id="5669774">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5669777">}</span><br>
<span class="lineno"></span><span class="op" id="5669779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5669782">func</span>&nbsp;<span class="op" id="5669787">(</span><span class="ident" id="5669788">p</span>&nbsp;<span class="op" id="5669790">*</span><span class="ident" id="5669791">parser</span><span class="op" id="5669797">)</span>&nbsp;<span class="ident" id="5669799">resolve</span><span class="op" id="5669806">(</span><span class="ident" id="5669807">x</span>&nbsp;<span class="ident" id="5669809">ast</span><span class="op" id="5669812">.</span><span class="ident" id="5669813">Expr</span><span class="op" id="5669817">)</span>&nbsp;<span class="op" id="5669819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5669822">p</span><span class="op" id="5669823">.</span><span class="ident" id="5669824">tryResolve</span><span class="op" id="5669834">(</span><span class="ident" id="5669835">x</span><span class="op" id="5669836">,</span>&nbsp;<span class="builtintype" id="5669838">true</span><span class="op" id="5669842">)</span><br>
<span class="lineno">200</span><span class="op" id="5669844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5669847">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5669927">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5669947">func</span>&nbsp;<span class="op" id="5669952">(</span><span class="ident" id="5669953">p</span>&nbsp;<span class="op" id="5669955">*</span><span class="ident" id="5669956">parser</span><span class="op" id="5669962">)</span>&nbsp;<span class="ident" id="5669964">printTrace</span><span class="op" id="5669974">(</span><span class="ident" id="5669975">a</span>&nbsp;<span class="op" id="5669977">...</span><span class="keyword" id="5669980">interface</span><span class="op" id="5669989">{</span><span class="op" id="5669990">}</span><span class="op" id="5669991">)</span>&nbsp;<span class="op" id="5669993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5669996">const</span>&nbsp;<span class="ident" id="5670002">dots</span>&nbsp;<span class="op" id="5670007">=</span>&nbsp;<span class="string" id="5670009">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670077">const</span>&nbsp;<span class="ident" id="5670083">n</span>&nbsp;<span class="op" id="5670085">=</span>&nbsp;<span class="builtinfunc" id="5670087">len</span><span class="op" id="5670090">(</span><span class="ident" id="5670091">dots</span><span class="op" id="5670095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670098">pos</span>&nbsp;<span class="op" id="5670102">:=</span>&nbsp;<span class="ident" id="5670105">p</span><span class="op" id="5670106">.</span><span class="ident" id="5670107">file</span><span class="op" id="5670111">.</span><span class="ident" id="5670112">Position</span><span class="op" id="5670120">(</span><span class="ident" id="5670121">p</span><span class="op" id="5670122">.</span><span class="ident" id="5670123">pos</span><span class="op" id="5670126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670129">fmt</span><span class="op" id="5670132">.</span><span class="ident" id="5670133">Printf</span><span class="op" id="5670139">(</span><span class="string" id="5670140">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="5670151">,</span>&nbsp;<span class="ident" id="5670153">pos</span><span class="op" id="5670156">.</span><span class="ident" id="5670157">Line</span><span class="op" id="5670161">,</span>&nbsp;<span class="ident" id="5670163">pos</span><span class="op" id="5670166">.</span><span class="ident" id="5670167">Column</span><span class="op" id="5670173">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670176">i</span>&nbsp;<span class="op" id="5670178">:=</span>&nbsp;<span class="num" id="5670181">2</span>&nbsp;<span class="op" id="5670183">*</span>&nbsp;<span class="ident" id="5670185">p</span><span class="op" id="5670186">.</span><span class="ident" id="5670187">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670195">for</span>&nbsp;<span class="ident" id="5670199">i</span>&nbsp;<span class="op" id="5670201">&gt;</span>&nbsp;<span class="ident" id="5670203">n</span>&nbsp;<span class="op" id="5670205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670209">fmt</span><span class="op" id="5670212">.</span><span class="ident" id="5670213">Print</span><span class="op" id="5670218">(</span><span class="ident" id="5670219">dots</span><span class="op" id="5670223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670227">i</span>&nbsp;<span class="op" id="5670229">-=</span>&nbsp;<span class="ident" id="5670232">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670235">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670238">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670249">fmt</span><span class="op" id="5670252">.</span><span class="ident" id="5670253">Print</span><span class="op" id="5670258">(</span><span class="ident" id="5670259">dots</span><span class="op" id="5670263">[</span><span class="num" id="5670264">0</span><span class="op" id="5670265">:</span><span class="ident" id="5670266">i</span><span class="op" id="5670267">]</span><span class="op" id="5670268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670271">fmt</span><span class="op" id="5670274">.</span><span class="ident" id="5670275">Println</span><span class="op" id="5670282">(</span><span class="ident" id="5670283">a</span><span class="op" id="5670284">...</span><span class="op" id="5670287">)</span><br>
<span class="lineno"></span><span class="op" id="5670289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="5670292">func</span>&nbsp;<span class="ident" id="5670297">trace</span><span class="op" id="5670302">(</span><span class="ident" id="5670303">p</span>&nbsp;<span class="op" id="5670305">*</span><span class="ident" id="5670306">parser</span><span class="op" id="5670312">,</span>&nbsp;<span class="ident" id="5670314">msg</span>&nbsp;<span class="builtintype" id="5670318">string</span><span class="op" id="5670324">)</span>&nbsp;<span class="op" id="5670326">*</span><span class="ident" id="5670327">parser</span>&nbsp;<span class="op" id="5670334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670337">p</span><span class="op" id="5670338">.</span><span class="ident" id="5670339">printTrace</span><span class="op" id="5670349">(</span><span class="ident" id="5670350">msg</span><span class="op" id="5670353">,</span>&nbsp;<span class="string" id="5670355">&#34;(&#34;</span><span class="op" id="5670358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670361">p</span><span class="op" id="5670362">.</span><span class="ident" id="5670363">indent</span><span class="op" id="5670369">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670373">return</span>&nbsp;<span class="ident" id="5670380">p</span><br>
<span class="lineno"></span><span class="op" id="5670382">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5670385">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="5670429">func</span>&nbsp;<span class="ident" id="5670434">un</span><span class="op" id="5670436">(</span><span class="ident" id="5670437">p</span>&nbsp;<span class="op" id="5670439">*</span><span class="ident" id="5670440">parser</span><span class="op" id="5670446">)</span>&nbsp;<span class="op" id="5670448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670451">p</span><span class="op" id="5670452">.</span><span class="ident" id="5670453">indent</span><span class="op" id="5670459">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670463">p</span><span class="op" id="5670464">.</span><span class="ident" id="5670465">printTrace</span><span class="op" id="5670475">(</span><span class="string" id="5670476">&#34;)&#34;</span><span class="op" id="5670479">)</span><br>
<span class="lineno">230</span><span class="op" id="5670481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5670484">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="5670514">func</span>&nbsp;<span class="op" id="5670519">(</span><span class="ident" id="5670520">p</span>&nbsp;<span class="op" id="5670522">*</span><span class="ident" id="5670523">parser</span><span class="op" id="5670529">)</span>&nbsp;<span class="ident" id="5670531">next0</span><span class="op" id="5670536">(</span><span class="op" id="5670537">)</span>&nbsp;<span class="op" id="5670539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670542">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670604">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670664">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5670723">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670770">if</span>&nbsp;<span class="ident" id="5670773">p</span><span class="op" id="5670774">.</span><span class="ident" id="5670775">trace</span>&nbsp;<span class="op" id="5670781">&amp;&amp;</span>&nbsp;<span class="ident" id="5670784">p</span><span class="op" id="5670785">.</span><span class="ident" id="5670786">pos</span><span class="op" id="5670789">.</span><span class="ident" id="5670790">IsValid</span><span class="op" id="5670797">(</span><span class="op" id="5670798">)</span>&nbsp;<span class="op" id="5670800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670804">s</span>&nbsp;<span class="op" id="5670806">:=</span>&nbsp;<span class="ident" id="5670809">p</span><span class="op" id="5670810">.</span><span class="ident" id="5670811">tok</span><span class="op" id="5670814">.</span><span class="ident" id="5670815">String</span><span class="op" id="5670821">(</span><span class="op" id="5670822">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670826">switch</span>&nbsp;<span class="op" id="5670833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670837">case</span>&nbsp;<span class="ident" id="5670842">p</span><span class="op" id="5670843">.</span><span class="ident" id="5670844">tok</span><span class="op" id="5670847">.</span><span class="ident" id="5670848">IsLiteral</span><span class="op" id="5670857">(</span><span class="op" id="5670858">)</span><span class="op" id="5670859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670864">p</span><span class="op" id="5670865">.</span><span class="ident" id="5670866">printTrace</span><span class="op" id="5670876">(</span><span class="ident" id="5670877">s</span><span class="op" id="5670878">,</span>&nbsp;<span class="ident" id="5670880">p</span><span class="op" id="5670881">.</span><span class="ident" id="5670882">lit</span><span class="op" id="5670885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670889">case</span>&nbsp;<span class="ident" id="5670894">p</span><span class="op" id="5670895">.</span><span class="ident" id="5670896">tok</span><span class="op" id="5670899">.</span><span class="ident" id="5670900">IsOperator</span><span class="op" id="5670910">(</span><span class="op" id="5670911">)</span><span class="op" id="5670912">,</span>&nbsp;<span class="ident" id="5670914">p</span><span class="op" id="5670915">.</span><span class="ident" id="5670916">tok</span><span class="op" id="5670919">.</span><span class="ident" id="5670920">IsKeyword</span><span class="op" id="5670929">(</span><span class="op" id="5670930">)</span><span class="op" id="5670931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670936">p</span><span class="op" id="5670937">.</span><span class="ident" id="5670938">printTrace</span><span class="op" id="5670948">(</span><span class="string" id="5670949">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="5670954">+</span>&nbsp;<span class="ident" id="5670956">s</span>&nbsp;<span class="op" id="5670958">+</span>&nbsp;<span class="string" id="5670960">&#34;\&#34;&#34;</span><span class="op" id="5670964">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5670968">default</span><span class="op" id="5670975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5670980">p</span><span class="op" id="5670981">.</span><span class="ident" id="5670982">printTrace</span><span class="op" id="5670992">(</span><span class="ident" id="5670993">s</span><span class="op" id="5670994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5670998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671005">p</span><span class="op" id="5671006">.</span><span class="ident" id="5671007">pos</span><span class="op" id="5671010">,</span>&nbsp;<span class="ident" id="5671012">p</span><span class="op" id="5671013">.</span><span class="ident" id="5671014">tok</span><span class="op" id="5671017">,</span>&nbsp;<span class="ident" id="5671019">p</span><span class="op" id="5671020">.</span><span class="ident" id="5671021">lit</span>&nbsp;<span class="op" id="5671025">=</span>&nbsp;<span class="ident" id="5671027">p</span><span class="op" id="5671028">.</span><span class="ident" id="5671029">scanner</span><span class="op" id="5671036">.</span><span class="ident" id="5671037">Scan</span><span class="op" id="5671041">(</span><span class="op" id="5671042">)</span><br>
<span class="lineno"></span><span class="op" id="5671044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671047">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="5671113">func</span>&nbsp;<span class="op" id="5671118">(</span><span class="ident" id="5671119">p</span>&nbsp;<span class="op" id="5671121">*</span><span class="ident" id="5671122">parser</span><span class="op" id="5671128">)</span>&nbsp;<span class="ident" id="5671130">consumeComment</span><span class="op" id="5671144">(</span><span class="op" id="5671145">)</span>&nbsp;<span class="op" id="5671147">(</span><span class="ident" id="5671148">comment</span>&nbsp;<span class="op" id="5671156">*</span><span class="ident" id="5671157">ast</span><span class="op" id="5671160">.</span><span class="ident" id="5671161">Comment</span><span class="op" id="5671168">,</span>&nbsp;<span class="ident" id="5671170">endline</span>&nbsp;<span class="builtintype" id="5671178">int</span><span class="op" id="5671181">)</span>&nbsp;<span class="op" id="5671183">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671186">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671259">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671327">endline</span>&nbsp;<span class="op" id="5671335">=</span>&nbsp;<span class="ident" id="5671337">p</span><span class="op" id="5671338">.</span><span class="ident" id="5671339">file</span><span class="op" id="5671343">.</span><span class="ident" id="5671344">Line</span><span class="op" id="5671348">(</span><span class="ident" id="5671349">p</span><span class="op" id="5671350">.</span><span class="ident" id="5671351">pos</span><span class="op" id="5671354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671357">if</span>&nbsp;<span class="ident" id="5671360">p</span><span class="op" id="5671361">.</span><span class="ident" id="5671362">lit</span><span class="op" id="5671365">[</span><span class="num" id="5671366">1</span><span class="op" id="5671367">]</span>&nbsp;<span class="op" id="5671369">==</span>&nbsp;<span class="string" id="5671372">&#39;*&#39;</span>&nbsp;<span class="op" id="5671376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5671380">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671446">for</span>&nbsp;<span class="ident" id="5671450">i</span>&nbsp;<span class="op" id="5671452">:=</span>&nbsp;<span class="num" id="5671455">0</span><span class="op" id="5671456">;</span>&nbsp;<span class="ident" id="5671458">i</span>&nbsp;<span class="op" id="5671460">&lt;</span>&nbsp;<span class="builtinfunc" id="5671462">len</span><span class="op" id="5671465">(</span><span class="ident" id="5671466">p</span><span class="op" id="5671467">.</span><span class="ident" id="5671468">lit</span><span class="op" id="5671471">)</span><span class="op" id="5671472">;</span>&nbsp;<span class="ident" id="5671474">i</span><span class="op" id="5671475">++</span>&nbsp;<span class="op" id="5671478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671483">if</span>&nbsp;<span class="ident" id="5671486">p</span><span class="op" id="5671487">.</span><span class="ident" id="5671488">lit</span><span class="op" id="5671491">[</span><span class="ident" id="5671492">i</span><span class="op" id="5671493">]</span>&nbsp;<span class="op" id="5671495">==</span>&nbsp;<span class="string" id="5671498">&#39;\n&#39;</span>&nbsp;<span class="op" id="5671503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671509">endline</span><span class="op" id="5671516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671526">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5671529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671533">comment</span>&nbsp;<span class="op" id="5671541">=</span>&nbsp;<span class="op" id="5671543">&amp;</span><span class="ident" id="5671544">ast</span><span class="op" id="5671547">.</span><span class="ident" id="5671548">Comment</span><span class="op" id="5671555">{</span><span class="ident" id="5671556">Slash</span><span class="op" id="5671561">:</span>&nbsp;<span class="ident" id="5671563">p</span><span class="op" id="5671564">.</span><span class="ident" id="5671565">pos</span><span class="op" id="5671568">,</span>&nbsp;<span class="ident" id="5671570">Text</span><span class="op" id="5671574">:</span>&nbsp;<span class="ident" id="5671576">p</span><span class="op" id="5671577">.</span><span class="ident" id="5671578">lit</span><span class="op" id="5671581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671584">p</span><span class="op" id="5671585">.</span><span class="ident" id="5671586">next0</span><span class="op" id="5671591">(</span><span class="op" id="5671592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671596">return</span><br>
<span class="lineno"></span><span class="op" id="5671603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5671606">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5671670">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="5671734">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5671798">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5671840">//</span><br>
<span class="lineno"></span><span class="keyword" id="5671843">func</span>&nbsp;<span class="op" id="5671848">(</span><span class="ident" id="5671849">p</span>&nbsp;<span class="op" id="5671851">*</span><span class="ident" id="5671852">parser</span><span class="op" id="5671858">)</span>&nbsp;<span class="ident" id="5671860">consumeCommentGroup</span><span class="op" id="5671879">(</span><span class="ident" id="5671880">n</span>&nbsp;<span class="builtintype" id="5671882">int</span><span class="op" id="5671885">)</span>&nbsp;<span class="op" id="5671887">(</span><span class="ident" id="5671888">comments</span>&nbsp;<span class="op" id="5671897">*</span><span class="ident" id="5671898">ast</span><span class="op" id="5671901">.</span><span class="ident" id="5671902">CommentGroup</span><span class="op" id="5671914">,</span>&nbsp;<span class="ident" id="5671916">endline</span>&nbsp;<span class="builtintype" id="5671924">int</span><span class="op" id="5671927">)</span>&nbsp;<span class="op" id="5671929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671932">var</span>&nbsp;<span class="ident" id="5671936">list</span>&nbsp;<span class="op" id="5671941">[</span><span class="op" id="5671942">]</span><span class="op" id="5671943">*</span><span class="ident" id="5671944">ast</span><span class="op" id="5671947">.</span><span class="ident" id="5671948">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5671957">endline</span>&nbsp;<span class="op" id="5671965">=</span>&nbsp;<span class="ident" id="5671967">p</span><span class="op" id="5671968">.</span><span class="ident" id="5671969">file</span><span class="op" id="5671973">.</span><span class="ident" id="5671974">Line</span><span class="op" id="5671978">(</span><span class="ident" id="5671979">p</span><span class="op" id="5671980">.</span><span class="ident" id="5671981">pos</span><span class="op" id="5671984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5671987">for</span>&nbsp;<span class="ident" id="5671991">p</span><span class="op" id="5671992">.</span><span class="ident" id="5671993">tok</span>&nbsp;<span class="op" id="5671997">==</span>&nbsp;<span class="ident" id="5672000">token</span><span class="op" id="5672005">.</span><span class="ident" id="5672006">COMMENT</span>&nbsp;<span class="op" id="5672014">&amp;&amp;</span>&nbsp;<span class="ident" id="5672017">p</span><span class="op" id="5672018">.</span><span class="ident" id="5672019">file</span><span class="op" id="5672023">.</span><span class="ident" id="5672024">Line</span><span class="op" id="5672028">(</span><span class="ident" id="5672029">p</span><span class="op" id="5672030">.</span><span class="ident" id="5672031">pos</span><span class="op" id="5672034">)</span>&nbsp;<span class="op" id="5672036">&lt;=</span>&nbsp;<span class="ident" id="5672039">endline</span><span class="op" id="5672046">+</span><span class="ident" id="5672047">n</span>&nbsp;<span class="op" id="5672049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672053">var</span>&nbsp;<span class="ident" id="5672057">comment</span>&nbsp;<span class="op" id="5672065">*</span><span class="ident" id="5672066">ast</span><span class="op" id="5672069">.</span><span class="ident" id="5672070">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672080">comment</span><span class="op" id="5672087">,</span>&nbsp;<span class="ident" id="5672089">endline</span>&nbsp;<span class="op" id="5672097">=</span>&nbsp;<span class="ident" id="5672099">p</span><span class="op" id="5672100">.</span><span class="ident" id="5672101">consumeComment</span><span class="op" id="5672115">(</span><span class="op" id="5672116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672120">list</span>&nbsp;<span class="op" id="5672125">=</span>&nbsp;<span class="builtinfunc" id="5672127">append</span><span class="op" id="5672133">(</span><span class="ident" id="5672134">list</span><span class="op" id="5672138">,</span>&nbsp;<span class="ident" id="5672140">comment</span><span class="op" id="5672147">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5672150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5672154">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672197">comments</span>&nbsp;<span class="op" id="5672206">=</span>&nbsp;<span class="op" id="5672208">&amp;</span><span class="ident" id="5672209">ast</span><span class="op" id="5672212">.</span><span class="ident" id="5672213">CommentGroup</span><span class="op" id="5672225">{</span><span class="ident" id="5672226">List</span><span class="op" id="5672230">:</span>&nbsp;<span class="ident" id="5672232">list</span><span class="op" id="5672236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672239">p</span><span class="op" id="5672240">.</span><span class="ident" id="5672241">comments</span>&nbsp;<span class="op" id="5672250">=</span>&nbsp;<span class="builtinfunc" id="5672252">append</span><span class="op" id="5672258">(</span><span class="ident" id="5672259">p</span><span class="op" id="5672260">.</span><span class="ident" id="5672261">comments</span><span class="op" id="5672269">,</span>&nbsp;<span class="ident" id="5672271">comments</span><span class="op" id="5672279">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672283">return</span><br>
<span class="lineno"></span><span class="op" id="5672290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5672293">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="5672359">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5672425">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5672447">//</span><br>
<span class="lineno"></span><span class="comment" id="5672450">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5672513">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="5672584">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5672642">//</span><br>
<span class="lineno"></span><span class="comment" id="5672645">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="5672709">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5672780">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="5672798">//</span><br>
<span class="lineno"></span><span class="comment" id="5672801">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5672867">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5672889">//</span><br>
<span class="lineno"></span><span class="keyword" id="5672892">func</span>&nbsp;<span class="op" id="5672897">(</span><span class="ident" id="5672898">p</span>&nbsp;<span class="op" id="5672900">*</span><span class="ident" id="5672901">parser</span><span class="op" id="5672907">)</span>&nbsp;<span class="ident" id="5672909">next</span><span class="op" id="5672913">(</span><span class="op" id="5672914">)</span>&nbsp;<span class="op" id="5672916">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672919">p</span><span class="op" id="5672920">.</span><span class="ident" id="5672921">leadComment</span>&nbsp;<span class="op" id="5672933">=</span>&nbsp;<span class="ident" id="5672935">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672940">p</span><span class="op" id="5672941">.</span><span class="ident" id="5672942">lineComment</span>&nbsp;<span class="op" id="5672954">=</span>&nbsp;<span class="ident" id="5672956">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672961">prev</span>&nbsp;<span class="op" id="5672966">:=</span>&nbsp;<span class="ident" id="5672969">p</span><span class="op" id="5672970">.</span><span class="ident" id="5672971">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5672976">p</span><span class="op" id="5672977">.</span><span class="ident" id="5672978">next0</span><span class="op" id="5672983">(</span><span class="op" id="5672984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5672988">if</span>&nbsp;<span class="ident" id="5672991">p</span><span class="op" id="5672992">.</span><span class="ident" id="5672993">tok</span>&nbsp;<span class="op" id="5672997">==</span>&nbsp;<span class="ident" id="5673000">token</span><span class="op" id="5673005">.</span><span class="ident" id="5673006">COMMENT</span>&nbsp;<span class="op" id="5673014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673018">var</span>&nbsp;<span class="ident" id="5673022">comment</span>&nbsp;<span class="op" id="5673030">*</span><span class="ident" id="5673031">ast</span><span class="op" id="5673034">.</span><span class="ident" id="5673035">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673050">var</span>&nbsp;<span class="ident" id="5673054">endline</span>&nbsp;<span class="builtintype" id="5673062">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673069">if</span>&nbsp;<span class="ident" id="5673072">p</span><span class="op" id="5673073">.</span><span class="ident" id="5673074">file</span><span class="op" id="5673078">.</span><span class="ident" id="5673079">Line</span><span class="op" id="5673083">(</span><span class="ident" id="5673084">p</span><span class="op" id="5673085">.</span><span class="ident" id="5673086">pos</span><span class="op" id="5673089">)</span>&nbsp;<span class="op" id="5673091">==</span>&nbsp;<span class="ident" id="5673094">p</span><span class="op" id="5673095">.</span><span class="ident" id="5673096">file</span><span class="op" id="5673100">.</span><span class="ident" id="5673101">Line</span><span class="op" id="5673105">(</span><span class="ident" id="5673106">prev</span><span class="op" id="5673110">)</span>&nbsp;<span class="op" id="5673112">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673117">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673177">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673235">comment</span><span class="op" id="5673242">,</span>&nbsp;<span class="ident" id="5673244">endline</span>&nbsp;<span class="op" id="5673252">=</span>&nbsp;<span class="ident" id="5673254">p</span><span class="op" id="5673255">.</span><span class="ident" id="5673256">consumeCommentGroup</span><span class="op" id="5673275">(</span><span class="num" id="5673276">0</span><span class="op" id="5673277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673282">if</span>&nbsp;<span class="ident" id="5673285">p</span><span class="op" id="5673286">.</span><span class="ident" id="5673287">file</span><span class="op" id="5673291">.</span><span class="ident" id="5673292">Line</span><span class="op" id="5673296">(</span><span class="ident" id="5673297">p</span><span class="op" id="5673298">.</span><span class="ident" id="5673299">pos</span><span class="op" id="5673302">)</span>&nbsp;<span class="op" id="5673304">!=</span>&nbsp;<span class="ident" id="5673307">endline</span>&nbsp;<span class="op" id="5673315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673321">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673372">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673421">p</span><span class="op" id="5673422">.</span><span class="ident" id="5673423">lineComment</span>&nbsp;<span class="op" id="5673435">=</span>&nbsp;<span class="ident" id="5673437">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673457">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673497">endline</span>&nbsp;<span class="op" id="5673505">=</span>&nbsp;<span class="op" id="5673507">-</span><span class="num" id="5673508">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673512">for</span>&nbsp;<span class="ident" id="5673516">p</span><span class="op" id="5673517">.</span><span class="ident" id="5673518">tok</span>&nbsp;<span class="op" id="5673522">==</span>&nbsp;<span class="ident" id="5673525">token</span><span class="op" id="5673530">.</span><span class="ident" id="5673531">COMMENT</span>&nbsp;<span class="op" id="5673539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673544">comment</span><span class="op" id="5673551">,</span>&nbsp;<span class="ident" id="5673553">endline</span>&nbsp;<span class="op" id="5673561">=</span>&nbsp;<span class="ident" id="5673563">p</span><span class="op" id="5673564">.</span><span class="ident" id="5673565">consumeCommentGroup</span><span class="op" id="5673584">(</span><span class="num" id="5673585">1</span><span class="op" id="5673586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673590">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5673595">if</span>&nbsp;<span class="ident" id="5673598">endline</span><span class="op" id="5673605">+</span><span class="num" id="5673606">1</span>&nbsp;<span class="op" id="5673608">==</span>&nbsp;<span class="ident" id="5673611">p</span><span class="op" id="5673612">.</span><span class="ident" id="5673613">file</span><span class="op" id="5673617">.</span><span class="ident" id="5673618">Line</span><span class="op" id="5673622">(</span><span class="ident" id="5673623">p</span><span class="op" id="5673624">.</span><span class="ident" id="5673625">pos</span><span class="op" id="5673628">)</span>&nbsp;<span class="op" id="5673630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673635">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673703">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673771">p</span><span class="op" id="5673772">.</span><span class="ident" id="5673773">leadComment</span>&nbsp;<span class="op" id="5673785">=</span>&nbsp;<span class="ident" id="5673787">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5673800">}</span><br>
<span class="lineno"></span><span class="op" id="5673802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5673805">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="5673865">type</span>&nbsp;<span class="ident" id="5673870">bailout</span>&nbsp;<span class="keyword" id="5673878">struct</span><span class="op" id="5673884">{</span><span class="op" id="5673885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5673888">func</span>&nbsp;<span class="op" id="5673893">(</span><span class="ident" id="5673894">p</span>&nbsp;<span class="op" id="5673896">*</span><span class="ident" id="5673897">parser</span><span class="op" id="5673903">)</span>&nbsp;<span class="builtintype" id="5673905">error</span><span class="op" id="5673910">(</span><span class="ident" id="5673911">pos</span>&nbsp;<span class="ident" id="5673915">token</span><span class="op" id="5673920">.</span><span class="ident" id="5673921">Pos</span><span class="op" id="5673924">,</span>&nbsp;<span class="ident" id="5673926">msg</span>&nbsp;<span class="builtintype" id="5673930">string</span><span class="op" id="5673936">)</span>&nbsp;<span class="op" id="5673938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5673941">epos</span>&nbsp;<span class="op" id="5673946">:=</span>&nbsp;<span class="ident" id="5673949">p</span><span class="op" id="5673950">.</span><span class="ident" id="5673951">file</span><span class="op" id="5673955">.</span><span class="ident" id="5673956">Position</span><span class="op" id="5673964">(</span><span class="ident" id="5673965">pos</span><span class="op" id="5673968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5673972">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674042">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674113">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674128">if</span>&nbsp;<span class="ident" id="5674131">p</span><span class="op" id="5674132">.</span><span class="ident" id="5674133">mode</span><span class="op" id="5674137">&amp;</span><span class="ident" id="5674138">AllErrors</span>&nbsp;<span class="op" id="5674148">==</span>&nbsp;<span class="num" id="5674151">0</span>&nbsp;<span class="op" id="5674153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674157">n</span>&nbsp;<span class="op" id="5674159">:=</span>&nbsp;<span class="builtinfunc" id="5674162">len</span><span class="op" id="5674165">(</span><span class="ident" id="5674166">p</span><span class="op" id="5674167">.</span><span class="ident" id="5674168">errors</span><span class="op" id="5674174">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674178">if</span>&nbsp;<span class="ident" id="5674181">n</span>&nbsp;<span class="op" id="5674183">&gt;</span>&nbsp;<span class="num" id="5674185">0</span>&nbsp;<span class="op" id="5674187">&amp;&amp;</span>&nbsp;<span class="ident" id="5674190">p</span><span class="op" id="5674191">.</span><span class="ident" id="5674192">errors</span><span class="op" id="5674198">[</span><span class="ident" id="5674199">n</span><span class="op" id="5674200">-</span><span class="num" id="5674201">1</span><span class="op" id="5674202">]</span><span class="op" id="5674203">.</span><span class="ident" id="5674204">Pos</span><span class="op" id="5674207">.</span><span class="ident" id="5674208">Line</span>&nbsp;<span class="op" id="5674213">==</span>&nbsp;<span class="ident" id="5674216">epos</span><span class="op" id="5674220">.</span><span class="ident" id="5674221">Line</span>&nbsp;<span class="op" id="5674226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674231">return</span>&nbsp;<span class="comment" id="5674238">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674281">if</span>&nbsp;<span class="ident" id="5674284">n</span>&nbsp;<span class="op" id="5674286">&gt;</span>&nbsp;<span class="num" id="5674288">10</span>&nbsp;<span class="op" id="5674291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5674296">panic</span><span class="op" id="5674301">(</span><span class="ident" id="5674302">bailout</span><span class="op" id="5674309">{</span><span class="op" id="5674310">}</span><span class="op" id="5674311">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674322">p</span><span class="op" id="5674323">.</span><span class="ident" id="5674324">errors</span><span class="op" id="5674330">.</span><span class="ident" id="5674331">Add</span><span class="op" id="5674334">(</span><span class="ident" id="5674335">epos</span><span class="op" id="5674339">,</span>&nbsp;<span class="ident" id="5674341">msg</span><span class="op" id="5674344">)</span><br>
<span class="lineno"></span><span class="op" id="5674346">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="5674349">func</span>&nbsp;<span class="op" id="5674354">(</span><span class="ident" id="5674355">p</span>&nbsp;<span class="op" id="5674357">*</span><span class="ident" id="5674358">parser</span><span class="op" id="5674364">)</span>&nbsp;<span class="ident" id="5674366">errorExpected</span><span class="op" id="5674379">(</span><span class="ident" id="5674380">pos</span>&nbsp;<span class="ident" id="5674384">token</span><span class="op" id="5674389">.</span><span class="ident" id="5674390">Pos</span><span class="op" id="5674393">,</span>&nbsp;<span class="ident" id="5674395">msg</span>&nbsp;<span class="builtintype" id="5674399">string</span><span class="op" id="5674405">)</span>&nbsp;<span class="op" id="5674407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674410">msg</span>&nbsp;<span class="op" id="5674414">=</span>&nbsp;<span class="string" id="5674416">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="5674428">+</span>&nbsp;<span class="ident" id="5674430">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674435">if</span>&nbsp;<span class="ident" id="5674438">pos</span>&nbsp;<span class="op" id="5674442">==</span>&nbsp;<span class="ident" id="5674445">p</span><span class="op" id="5674446">.</span><span class="ident" id="5674447">pos</span>&nbsp;<span class="op" id="5674451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674455">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5674504">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674546">if</span>&nbsp;<span class="ident" id="5674549">p</span><span class="op" id="5674550">.</span><span class="ident" id="5674551">tok</span>&nbsp;<span class="op" id="5674555">==</span>&nbsp;<span class="ident" id="5674558">token</span><span class="op" id="5674563">.</span><span class="ident" id="5674564">SEMICOLON</span>&nbsp;<span class="op" id="5674574">&amp;&amp;</span>&nbsp;<span class="ident" id="5674577">p</span><span class="op" id="5674578">.</span><span class="ident" id="5674579">lit</span>&nbsp;<span class="op" id="5674583">==</span>&nbsp;<span class="string" id="5674586">&#34;\n&#34;</span>&nbsp;<span class="op" id="5674591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674596">msg</span>&nbsp;<span class="op" id="5674600">+=</span>&nbsp;<span class="string" id="5674603">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674623">}</span>&nbsp;<span class="keyword" id="5674625">else</span>&nbsp;<span class="op" id="5674630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674635">msg</span>&nbsp;<span class="op" id="5674639">+=</span>&nbsp;<span class="string" id="5674642">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="5674654">+</span>&nbsp;<span class="ident" id="5674656">p</span><span class="op" id="5674657">.</span><span class="ident" id="5674658">tok</span><span class="op" id="5674661">.</span><span class="ident" id="5674662">String</span><span class="op" id="5674668">(</span><span class="op" id="5674669">)</span>&nbsp;<span class="op" id="5674671">+</span>&nbsp;<span class="string" id="5674673">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674680">if</span>&nbsp;<span class="ident" id="5674683">p</span><span class="op" id="5674684">.</span><span class="ident" id="5674685">tok</span><span class="op" id="5674688">.</span><span class="ident" id="5674689">IsLiteral</span><span class="op" id="5674698">(</span><span class="op" id="5674699">)</span>&nbsp;<span class="op" id="5674701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674707">msg</span>&nbsp;<span class="op" id="5674711">+=</span>&nbsp;<span class="string" id="5674714">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5674718">+</span>&nbsp;<span class="ident" id="5674720">p</span><span class="op" id="5674721">.</span><span class="ident" id="5674722">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674736">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674739">p</span><span class="op" id="5674740">.</span><span class="builtintype" id="5674741">error</span><span class="op" id="5674746">(</span><span class="ident" id="5674747">pos</span><span class="op" id="5674750">,</span>&nbsp;<span class="ident" id="5674752">msg</span><span class="op" id="5674755">)</span><br>
<span class="lineno"></span><span class="op" id="5674757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5674760">func</span>&nbsp;<span class="op" id="5674765">(</span><span class="ident" id="5674766">p</span>&nbsp;<span class="op" id="5674768">*</span><span class="ident" id="5674769">parser</span><span class="op" id="5674775">)</span>&nbsp;<span class="ident" id="5674777">expect</span><span class="op" id="5674783">(</span><span class="ident" id="5674784">tok</span>&nbsp;<span class="ident" id="5674788">token</span><span class="op" id="5674793">.</span><span class="ident" id="5674794">Token</span><span class="op" id="5674799">)</span>&nbsp;<span class="ident" id="5674801">token</span><span class="op" id="5674806">.</span><span class="ident" id="5674807">Pos</span>&nbsp;<span class="op" id="5674811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674814">pos</span>&nbsp;<span class="op" id="5674818">:=</span>&nbsp;<span class="ident" id="5674821">p</span><span class="op" id="5674822">.</span><span class="ident" id="5674823">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674828">if</span>&nbsp;<span class="ident" id="5674831">p</span><span class="op" id="5674832">.</span><span class="ident" id="5674833">tok</span>&nbsp;<span class="op" id="5674837">!=</span>&nbsp;<span class="ident" id="5674840">tok</span>&nbsp;<span class="op" id="5674844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674848">p</span><span class="op" id="5674849">.</span><span class="ident" id="5674850">errorExpected</span><span class="op" id="5674863">(</span><span class="ident" id="5674864">pos</span><span class="op" id="5674867">,</span>&nbsp;<span class="string" id="5674869">&#34;&#39;&#34;</span><span class="op" id="5674872">+</span><span class="ident" id="5674873">tok</span><span class="op" id="5674876">.</span><span class="ident" id="5674877">String</span><span class="op" id="5674883">(</span><span class="op" id="5674884">)</span><span class="op" id="5674885">+</span><span class="string" id="5674886">&#34;&#39;&#34;</span><span class="op" id="5674889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5674892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5674895">p</span><span class="op" id="5674896">.</span><span class="ident" id="5674897">next</span><span class="op" id="5674901">(</span><span class="op" id="5674902">)</span>&nbsp;<span class="comment" id="5674904">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5674922">return</span>&nbsp;<span class="ident" id="5674929">pos</span><br>
<span class="lineno">390</span><span class="op" id="5674933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5674936">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5675004">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="5675064">//</span><br>
<span class="lineno">395</span><span class="keyword" id="5675067">func</span>&nbsp;<span class="op" id="5675072">(</span><span class="ident" id="5675073">p</span>&nbsp;<span class="op" id="5675075">*</span><span class="ident" id="5675076">parser</span><span class="op" id="5675082">)</span>&nbsp;<span class="ident" id="5675084">expectClosing</span><span class="op" id="5675097">(</span><span class="ident" id="5675098">tok</span>&nbsp;<span class="ident" id="5675102">token</span><span class="op" id="5675107">.</span><span class="ident" id="5675108">Token</span><span class="op" id="5675113">,</span>&nbsp;<span class="ident" id="5675115">context</span>&nbsp;<span class="builtintype" id="5675123">string</span><span class="op" id="5675129">)</span>&nbsp;<span class="ident" id="5675131">token</span><span class="op" id="5675136">.</span><span class="ident" id="5675137">Pos</span>&nbsp;<span class="op" id="5675141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675144">if</span>&nbsp;<span class="ident" id="5675147">p</span><span class="op" id="5675148">.</span><span class="ident" id="5675149">tok</span>&nbsp;<span class="op" id="5675153">!=</span>&nbsp;<span class="ident" id="5675156">tok</span>&nbsp;<span class="op" id="5675160">&amp;&amp;</span>&nbsp;<span class="ident" id="5675163">p</span><span class="op" id="5675164">.</span><span class="ident" id="5675165">tok</span>&nbsp;<span class="op" id="5675169">==</span>&nbsp;<span class="ident" id="5675172">token</span><span class="op" id="5675177">.</span><span class="ident" id="5675178">SEMICOLON</span>&nbsp;<span class="op" id="5675188">&amp;&amp;</span>&nbsp;<span class="ident" id="5675191">p</span><span class="op" id="5675192">.</span><span class="ident" id="5675193">lit</span>&nbsp;<span class="op" id="5675197">==</span>&nbsp;<span class="string" id="5675200">&#34;\n&#34;</span>&nbsp;<span class="op" id="5675205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675209">p</span><span class="op" id="5675210">.</span><span class="builtintype" id="5675211">error</span><span class="op" id="5675216">(</span><span class="ident" id="5675217">p</span><span class="op" id="5675218">.</span><span class="ident" id="5675219">pos</span><span class="op" id="5675222">,</span>&nbsp;<span class="string" id="5675224">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5675256">+</span><span class="ident" id="5675257">context</span><span class="op" id="5675264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675268">p</span><span class="op" id="5675269">.</span><span class="ident" id="5675270">next</span><span class="op" id="5675274">(</span><span class="op" id="5675275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675278">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675281">return</span>&nbsp;<span class="ident" id="5675288">p</span><span class="op" id="5675289">.</span><span class="ident" id="5675290">expect</span><span class="op" id="5675296">(</span><span class="ident" id="5675297">tok</span><span class="op" id="5675300">)</span><br>
<span class="lineno"></span><span class="op" id="5675302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5675305">func</span>&nbsp;<span class="op" id="5675310">(</span><span class="ident" id="5675311">p</span>&nbsp;<span class="op" id="5675313">*</span><span class="ident" id="5675314">parser</span><span class="op" id="5675320">)</span>&nbsp;<span class="ident" id="5675322">expectSemi</span><span class="op" id="5675332">(</span><span class="op" id="5675333">)</span>&nbsp;<span class="op" id="5675335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5675338">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675392">if</span>&nbsp;<span class="ident" id="5675395">p</span><span class="op" id="5675396">.</span><span class="ident" id="5675397">tok</span>&nbsp;<span class="op" id="5675401">!=</span>&nbsp;<span class="ident" id="5675404">token</span><span class="op" id="5675409">.</span><span class="ident" id="5675410">RPAREN</span>&nbsp;<span class="op" id="5675417">&amp;&amp;</span>&nbsp;<span class="ident" id="5675420">p</span><span class="op" id="5675421">.</span><span class="ident" id="5675422">tok</span>&nbsp;<span class="op" id="5675426">!=</span>&nbsp;<span class="ident" id="5675429">token</span><span class="op" id="5675434">.</span><span class="ident" id="5675435">RBRACE</span>&nbsp;<span class="op" id="5675442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675446">if</span>&nbsp;<span class="ident" id="5675449">p</span><span class="op" id="5675450">.</span><span class="ident" id="5675451">tok</span>&nbsp;<span class="op" id="5675455">==</span>&nbsp;<span class="ident" id="5675458">token</span><span class="op" id="5675463">.</span><span class="ident" id="5675464">SEMICOLON</span>&nbsp;<span class="op" id="5675474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675479">p</span><span class="op" id="5675480">.</span><span class="ident" id="5675481">next</span><span class="op" id="5675485">(</span><span class="op" id="5675486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675490">}</span>&nbsp;<span class="keyword" id="5675492">else</span>&nbsp;<span class="op" id="5675497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675502">p</span><span class="op" id="5675503">.</span><span class="ident" id="5675504">errorExpected</span><span class="op" id="5675517">(</span><span class="ident" id="5675518">p</span><span class="op" id="5675519">.</span><span class="ident" id="5675520">pos</span><span class="op" id="5675523">,</span>&nbsp;<span class="string" id="5675525">&#34;&#39;;&#39;&#34;</span><span class="op" id="5675530">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675535">syncStmt</span><span class="op" id="5675543">(</span><span class="ident" id="5675544">p</span><span class="op" id="5675545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675552">}</span><br>
<span class="lineno"></span><span class="op" id="5675554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="5675557">func</span>&nbsp;<span class="op" id="5675562">(</span><span class="ident" id="5675563">p</span>&nbsp;<span class="op" id="5675565">*</span><span class="ident" id="5675566">parser</span><span class="op" id="5675572">)</span>&nbsp;<span class="ident" id="5675574">atComma</span><span class="op" id="5675581">(</span><span class="ident" id="5675582">context</span>&nbsp;<span class="builtintype" id="5675590">string</span><span class="op" id="5675596">)</span>&nbsp;<span class="builtintype" id="5675598">bool</span>&nbsp;<span class="op" id="5675603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675606">if</span>&nbsp;<span class="ident" id="5675609">p</span><span class="op" id="5675610">.</span><span class="ident" id="5675611">tok</span>&nbsp;<span class="op" id="5675615">==</span>&nbsp;<span class="ident" id="5675618">token</span><span class="op" id="5675623">.</span><span class="ident" id="5675624">COMMA</span>&nbsp;<span class="op" id="5675630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675634">return</span>&nbsp;<span class="builtintype" id="5675641">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675650">if</span>&nbsp;<span class="ident" id="5675653">p</span><span class="op" id="5675654">.</span><span class="ident" id="5675655">tok</span>&nbsp;<span class="op" id="5675659">==</span>&nbsp;<span class="ident" id="5675662">token</span><span class="op" id="5675667">.</span><span class="ident" id="5675668">SEMICOLON</span>&nbsp;<span class="op" id="5675678">&amp;&amp;</span>&nbsp;<span class="ident" id="5675681">p</span><span class="op" id="5675682">.</span><span class="ident" id="5675683">lit</span>&nbsp;<span class="op" id="5675687">==</span>&nbsp;<span class="string" id="5675690">&#34;\n&#34;</span>&nbsp;<span class="op" id="5675695">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5675699">p</span><span class="op" id="5675700">.</span><span class="builtintype" id="5675701">error</span><span class="op" id="5675706">(</span><span class="ident" id="5675707">p</span><span class="op" id="5675708">.</span><span class="ident" id="5675709">pos</span><span class="op" id="5675712">,</span>&nbsp;<span class="string" id="5675714">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5675746">+</span><span class="ident" id="5675747">context</span><span class="op" id="5675754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675758">return</span>&nbsp;<span class="builtintype" id="5675765">true</span>&nbsp;<span class="comment" id="5675770">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675810">return</span>&nbsp;<span class="builtintype" id="5675817">false</span><br>
<span class="lineno">425</span><span class="op" id="5675823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5675826">func</span>&nbsp;<span class="ident" id="5675831">assert</span><span class="op" id="5675837">(</span><span class="ident" id="5675838">cond</span>&nbsp;<span class="builtintype" id="5675843">bool</span><span class="op" id="5675847">,</span>&nbsp;<span class="ident" id="5675849">msg</span>&nbsp;<span class="builtintype" id="5675853">string</span><span class="op" id="5675859">)</span>&nbsp;<span class="op" id="5675861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5675864">if</span>&nbsp;<span class="op" id="5675867">!</span><span class="ident" id="5675868">cond</span>&nbsp;<span class="op" id="5675873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5675877">panic</span><span class="op" id="5675882">(</span><span class="string" id="5675883">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5675912">+</span>&nbsp;<span class="ident" id="5675914">msg</span><span class="op" id="5675917">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5675920">}</span><br>
<span class="lineno"></span><span class="op" id="5675922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5675925">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5675969">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="5676013">//</span><br>
<span class="lineno"></span><span class="keyword" id="5676016">func</span>&nbsp;<span class="ident" id="5676021">syncStmt</span><span class="op" id="5676029">(</span><span class="ident" id="5676030">p</span>&nbsp;<span class="op" id="5676032">*</span><span class="ident" id="5676033">parser</span><span class="op" id="5676039">)</span>&nbsp;<span class="op" id="5676041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676044">for</span>&nbsp;<span class="op" id="5676048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676052">switch</span>&nbsp;<span class="ident" id="5676059">p</span><span class="op" id="5676060">.</span><span class="ident" id="5676061">tok</span>&nbsp;<span class="op" id="5676065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676069">case</span>&nbsp;<span class="ident" id="5676074">token</span><span class="op" id="5676079">.</span><span class="ident" id="5676080">BREAK</span><span class="op" id="5676085">,</span>&nbsp;<span class="ident" id="5676087">token</span><span class="op" id="5676092">.</span><span class="ident" id="5676093">CONST</span><span class="op" id="5676098">,</span>&nbsp;<span class="ident" id="5676100">token</span><span class="op" id="5676105">.</span><span class="ident" id="5676106">CONTINUE</span><span class="op" id="5676114">,</span>&nbsp;<span class="ident" id="5676116">token</span><span class="op" id="5676121">.</span><span class="ident" id="5676122">DEFER</span><span class="op" id="5676127">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676132">token</span><span class="op" id="5676137">.</span><span class="ident" id="5676138">FALLTHROUGH</span><span class="op" id="5676149">,</span>&nbsp;<span class="ident" id="5676151">token</span><span class="op" id="5676156">.</span><span class="ident" id="5676157">FOR</span><span class="op" id="5676160">,</span>&nbsp;<span class="ident" id="5676162">token</span><span class="op" id="5676167">.</span><span class="ident" id="5676168">GO</span><span class="op" id="5676170">,</span>&nbsp;<span class="ident" id="5676172">token</span><span class="op" id="5676177">.</span><span class="ident" id="5676178">GOTO</span><span class="op" id="5676182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676187">token</span><span class="op" id="5676192">.</span><span class="ident" id="5676193">IF</span><span class="op" id="5676195">,</span>&nbsp;<span class="ident" id="5676197">token</span><span class="op" id="5676202">.</span><span class="ident" id="5676203">RETURN</span><span class="op" id="5676209">,</span>&nbsp;<span class="ident" id="5676211">token</span><span class="op" id="5676216">.</span><span class="ident" id="5676217">SELECT</span><span class="op" id="5676223">,</span>&nbsp;<span class="ident" id="5676225">token</span><span class="op" id="5676230">.</span><span class="ident" id="5676231">SWITCH</span><span class="op" id="5676237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676242">token</span><span class="op" id="5676247">.</span><span class="ident" id="5676248">TYPE</span><span class="op" id="5676252">,</span>&nbsp;<span class="ident" id="5676254">token</span><span class="op" id="5676259">.</span><span class="ident" id="5676260">VAR</span><span class="op" id="5676263">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676268">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676326">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676384">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676440">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676496">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676552">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676606">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676641">if</span>&nbsp;<span class="ident" id="5676644">p</span><span class="op" id="5676645">.</span><span class="ident" id="5676646">pos</span>&nbsp;<span class="op" id="5676650">==</span>&nbsp;<span class="ident" id="5676653">p</span><span class="op" id="5676654">.</span><span class="ident" id="5676655">syncPos</span>&nbsp;<span class="op" id="5676663">&amp;&amp;</span>&nbsp;<span class="ident" id="5676666">p</span><span class="op" id="5676667">.</span><span class="ident" id="5676668">syncCnt</span>&nbsp;<span class="op" id="5676676">&lt;</span>&nbsp;<span class="num" id="5676678">10</span>&nbsp;<span class="op" id="5676681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676687">p</span><span class="op" id="5676688">.</span><span class="ident" id="5676689">syncCnt</span><span class="op" id="5676696">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676703">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676718">if</span>&nbsp;<span class="ident" id="5676721">p</span><span class="op" id="5676722">.</span><span class="ident" id="5676723">pos</span>&nbsp;<span class="op" id="5676727">&gt;</span>&nbsp;<span class="ident" id="5676729">p</span><span class="op" id="5676730">.</span><span class="ident" id="5676731">syncPos</span>&nbsp;<span class="op" id="5676739">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676745">p</span><span class="op" id="5676746">.</span><span class="ident" id="5676747">syncPos</span>&nbsp;<span class="op" id="5676755">=</span>&nbsp;<span class="ident" id="5676757">p</span><span class="op" id="5676758">.</span><span class="ident" id="5676759">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5676767">p</span><span class="op" id="5676768">.</span><span class="ident" id="5676769">syncCnt</span>&nbsp;<span class="op" id="5676777">=</span>&nbsp;<span class="num" id="5676779">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5676785">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5676795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676800">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676854">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676911">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5676965">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677020">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677055">case</span>&nbsp;<span class="ident" id="5677060">token</span><span class="op" id="5677065">.</span><span class="ident" id="5677066">EOF</span><span class="op" id="5677069">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677074">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677087">p</span><span class="op" id="5677088">.</span><span class="ident" id="5677089">next</span><span class="op" id="5677093">(</span><span class="op" id="5677094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677097">}</span><br>
<span class="lineno"></span><span class="op" id="5677099">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5677102">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="5677148">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5677192">//</span><br>
<span class="lineno"></span><span class="keyword" id="5677195">func</span>&nbsp;<span class="ident" id="5677200">syncDecl</span><span class="op" id="5677208">(</span><span class="ident" id="5677209">p</span>&nbsp;<span class="op" id="5677211">*</span><span class="ident" id="5677212">parser</span><span class="op" id="5677218">)</span>&nbsp;<span class="op" id="5677220">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677223">for</span>&nbsp;<span class="op" id="5677227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677231">switch</span>&nbsp;<span class="ident" id="5677238">p</span><span class="op" id="5677239">.</span><span class="ident" id="5677240">tok</span>&nbsp;<span class="op" id="5677244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677248">case</span>&nbsp;<span class="ident" id="5677253">token</span><span class="op" id="5677258">.</span><span class="ident" id="5677259">CONST</span><span class="op" id="5677264">,</span>&nbsp;<span class="ident" id="5677266">token</span><span class="op" id="5677271">.</span><span class="ident" id="5677272">TYPE</span><span class="op" id="5677276">,</span>&nbsp;<span class="ident" id="5677278">token</span><span class="op" id="5677283">.</span><span class="ident" id="5677284">VAR</span><span class="op" id="5677287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5677292">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677323">if</span>&nbsp;<span class="ident" id="5677326">p</span><span class="op" id="5677327">.</span><span class="ident" id="5677328">pos</span>&nbsp;<span class="op" id="5677332">==</span>&nbsp;<span class="ident" id="5677335">p</span><span class="op" id="5677336">.</span><span class="ident" id="5677337">syncPos</span>&nbsp;<span class="op" id="5677345">&amp;&amp;</span>&nbsp;<span class="ident" id="5677348">p</span><span class="op" id="5677349">.</span><span class="ident" id="5677350">syncCnt</span>&nbsp;<span class="op" id="5677358">&lt;</span>&nbsp;<span class="num" id="5677360">10</span>&nbsp;<span class="op" id="5677363">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677369">p</span><span class="op" id="5677370">.</span><span class="ident" id="5677371">syncCnt</span><span class="op" id="5677378">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677385">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677400">if</span>&nbsp;<span class="ident" id="5677403">p</span><span class="op" id="5677404">.</span><span class="ident" id="5677405">pos</span>&nbsp;<span class="op" id="5677409">&gt;</span>&nbsp;<span class="ident" id="5677411">p</span><span class="op" id="5677412">.</span><span class="ident" id="5677413">syncPos</span>&nbsp;<span class="op" id="5677421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677427">p</span><span class="op" id="5677428">.</span><span class="ident" id="5677429">syncPos</span>&nbsp;<span class="op" id="5677437">=</span>&nbsp;<span class="ident" id="5677439">p</span><span class="op" id="5677440">.</span><span class="ident" id="5677441">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677449">p</span><span class="op" id="5677450">.</span><span class="ident" id="5677451">syncCnt</span>&nbsp;<span class="op" id="5677459">=</span>&nbsp;<span class="num" id="5677461">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677467">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677481">case</span>&nbsp;<span class="ident" id="5677486">token</span><span class="op" id="5677491">.</span><span class="ident" id="5677492">EOF</span><span class="op" id="5677495">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5677500">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5677513">p</span><span class="op" id="5677514">.</span><span class="ident" id="5677515">next</span><span class="op" id="5677519">(</span><span class="op" id="5677520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5677523">}</span><br>
<span class="lineno"></span><span class="op" id="5677525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5677528">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5677598">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="5677670">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5677707">//</span><br>
<span class="lineno"></span><span class="comment" id="5677710">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="5677785">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5677859">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5677938">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5678013">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="5678026">//</span><br>
<span class="lineno">505</span><span class="keyword" id="5678029">func</span>&nbsp;<span class="op" id="5678034">(</span><span class="ident" id="5678035">p</span>&nbsp;<span class="op" id="5678037">*</span><span class="ident" id="5678038">parser</span><span class="op" id="5678044">)</span>&nbsp;<span class="ident" id="5678046">safePos</span><span class="op" id="5678053">(</span><span class="ident" id="5678054">pos</span>&nbsp;<span class="ident" id="5678058">token</span><span class="op" id="5678063">.</span><span class="ident" id="5678064">Pos</span><span class="op" id="5678067">)</span>&nbsp;<span class="op" id="5678069">(</span><span class="ident" id="5678070">res</span>&nbsp;<span class="ident" id="5678074">token</span><span class="op" id="5678079">.</span><span class="ident" id="5678080">Pos</span><span class="op" id="5678083">)</span>&nbsp;<span class="op" id="5678085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678088">defer</span>&nbsp;<span class="keyword" id="5678094">func</span><span class="op" id="5678098">(</span><span class="op" id="5678099">)</span>&nbsp;<span class="op" id="5678101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678105">if</span>&nbsp;<span class="builtinfunc" id="5678108">recover</span><span class="op" id="5678115">(</span><span class="op" id="5678116">)</span>&nbsp;<span class="op" id="5678118">!=</span>&nbsp;<span class="ident" id="5678121">nil</span>&nbsp;<span class="op" id="5678125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678130">res</span>&nbsp;<span class="op" id="5678134">=</span>&nbsp;<span class="ident" id="5678136">token</span><span class="op" id="5678141">.</span><span class="ident" id="5678142">Pos</span><span class="op" id="5678145">(</span><span class="ident" id="5678146">p</span><span class="op" id="5678147">.</span><span class="ident" id="5678148">file</span><span class="op" id="5678152">.</span><span class="ident" id="5678153">Base</span><span class="op" id="5678157">(</span><span class="op" id="5678158">)</span>&nbsp;<span class="op" id="5678160">+</span>&nbsp;<span class="ident" id="5678162">p</span><span class="op" id="5678163">.</span><span class="ident" id="5678164">file</span><span class="op" id="5678168">.</span><span class="ident" id="5678169">Size</span><span class="op" id="5678173">(</span><span class="op" id="5678174">)</span><span class="op" id="5678175">)</span>&nbsp;<span class="comment" id="5678177">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678195">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678198">}</span><span class="op" id="5678199">(</span><span class="op" id="5678200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678203">_</span>&nbsp;<span class="op" id="5678205">=</span>&nbsp;<span class="ident" id="5678207">p</span><span class="op" id="5678208">.</span><span class="ident" id="5678209">file</span><span class="op" id="5678213">.</span><span class="ident" id="5678214">Offset</span><span class="op" id="5678220">(</span><span class="ident" id="5678221">pos</span><span class="op" id="5678224">)</span>&nbsp;<span class="comment" id="5678226">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678274">return</span>&nbsp;<span class="ident" id="5678281">pos</span><br>
<span class="lineno"></span><span class="op" id="5678285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="5678288">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5678368">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5678384">func</span>&nbsp;<span class="op" id="5678389">(</span><span class="ident" id="5678390">p</span>&nbsp;<span class="op" id="5678392">*</span><span class="ident" id="5678393">parser</span><span class="op" id="5678399">)</span>&nbsp;<span class="ident" id="5678401">parseIdent</span><span class="op" id="5678411">(</span><span class="op" id="5678412">)</span>&nbsp;<span class="op" id="5678414">*</span><span class="ident" id="5678415">ast</span><span class="op" id="5678418">.</span><span class="ident" id="5678419">Ident</span>&nbsp;<span class="op" id="5678425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678428">pos</span>&nbsp;<span class="op" id="5678432">:=</span>&nbsp;<span class="ident" id="5678435">p</span><span class="op" id="5678436">.</span><span class="ident" id="5678437">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678442">name</span>&nbsp;<span class="op" id="5678447">:=</span>&nbsp;<span class="string" id="5678450">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678455">if</span>&nbsp;<span class="ident" id="5678458">p</span><span class="op" id="5678459">.</span><span class="ident" id="5678460">tok</span>&nbsp;<span class="op" id="5678464">==</span>&nbsp;<span class="ident" id="5678467">token</span><span class="op" id="5678472">.</span><span class="ident" id="5678473">IDENT</span>&nbsp;<span class="op" id="5678479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678483">name</span>&nbsp;<span class="op" id="5678488">=</span>&nbsp;<span class="ident" id="5678490">p</span><span class="op" id="5678491">.</span><span class="ident" id="5678492">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678498">p</span><span class="op" id="5678499">.</span><span class="ident" id="5678500">next</span><span class="op" id="5678504">(</span><span class="op" id="5678505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678508">}</span>&nbsp;<span class="keyword" id="5678510">else</span>&nbsp;<span class="op" id="5678515">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678519">p</span><span class="op" id="5678520">.</span><span class="ident" id="5678521">expect</span><span class="op" id="5678527">(</span><span class="ident" id="5678528">token</span><span class="op" id="5678533">.</span><span class="ident" id="5678534">IDENT</span><span class="op" id="5678539">)</span>&nbsp;<span class="comment" id="5678541">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678576">return</span>&nbsp;<span class="op" id="5678583">&amp;</span><span class="ident" id="5678584">ast</span><span class="op" id="5678587">.</span><span class="ident" id="5678588">Ident</span><span class="op" id="5678593">{</span><span class="ident" id="5678594">NamePos</span><span class="op" id="5678601">:</span>&nbsp;<span class="ident" id="5678603">pos</span><span class="op" id="5678606">,</span>&nbsp;<span class="ident" id="5678608">Name</span><span class="op" id="5678612">:</span>&nbsp;<span class="ident" id="5678614">name</span><span class="op" id="5678618">}</span><br>
<span class="lineno"></span><span class="op" id="5678620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="5678623">func</span>&nbsp;<span class="op" id="5678628">(</span><span class="ident" id="5678629">p</span>&nbsp;<span class="op" id="5678631">*</span><span class="ident" id="5678632">parser</span><span class="op" id="5678638">)</span>&nbsp;<span class="ident" id="5678640">parseIdentList</span><span class="op" id="5678654">(</span><span class="op" id="5678655">)</span>&nbsp;<span class="op" id="5678657">(</span><span class="ident" id="5678658">list</span>&nbsp;<span class="op" id="5678663">[</span><span class="op" id="5678664">]</span><span class="op" id="5678665">*</span><span class="ident" id="5678666">ast</span><span class="op" id="5678669">.</span><span class="ident" id="5678670">Ident</span><span class="op" id="5678675">)</span>&nbsp;<span class="op" id="5678677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678680">if</span>&nbsp;<span class="ident" id="5678683">p</span><span class="op" id="5678684">.</span><span class="ident" id="5678685">trace</span>&nbsp;<span class="op" id="5678691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678695">defer</span>&nbsp;<span class="ident" id="5678701">un</span><span class="op" id="5678703">(</span><span class="ident" id="5678704">trace</span><span class="op" id="5678709">(</span><span class="ident" id="5678710">p</span><span class="op" id="5678711">,</span>&nbsp;<span class="string" id="5678713">&#34;IdentList&#34;</span><span class="op" id="5678724">)</span><span class="op" id="5678725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678732">list</span>&nbsp;<span class="op" id="5678737">=</span>&nbsp;<span class="builtinfunc" id="5678739">append</span><span class="op" id="5678745">(</span><span class="ident" id="5678746">list</span><span class="op" id="5678750">,</span>&nbsp;<span class="ident" id="5678752">p</span><span class="op" id="5678753">.</span><span class="ident" id="5678754">parseIdent</span><span class="op" id="5678764">(</span><span class="op" id="5678765">)</span><span class="op" id="5678766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678769">for</span>&nbsp;<span class="ident" id="5678773">p</span><span class="op" id="5678774">.</span><span class="ident" id="5678775">tok</span>&nbsp;<span class="op" id="5678779">==</span>&nbsp;<span class="ident" id="5678782">token</span><span class="op" id="5678787">.</span><span class="ident" id="5678788">COMMA</span>&nbsp;<span class="op" id="5678794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678798">p</span><span class="op" id="5678799">.</span><span class="ident" id="5678800">next</span><span class="op" id="5678804">(</span><span class="op" id="5678805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5678809">list</span>&nbsp;<span class="op" id="5678814">=</span>&nbsp;<span class="builtinfunc" id="5678816">append</span><span class="op" id="5678822">(</span><span class="ident" id="5678823">list</span><span class="op" id="5678827">,</span>&nbsp;<span class="ident" id="5678829">p</span><span class="op" id="5678830">.</span><span class="ident" id="5678831">parseIdent</span><span class="op" id="5678841">(</span><span class="op" id="5678842">)</span><span class="op" id="5678843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5678846">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5678850">return</span><br>
<span class="lineno"></span><span class="op" id="5678857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5678860">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="5678940">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5678963">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5679042">func</span>&nbsp;<span class="op" id="5679047">(</span><span class="ident" id="5679048">p</span>&nbsp;<span class="op" id="5679050">*</span><span class="ident" id="5679051">parser</span><span class="op" id="5679057">)</span>&nbsp;<span class="ident" id="5679059">parseExprList</span><span class="op" id="5679072">(</span><span class="ident" id="5679073">lhs</span>&nbsp;<span class="builtintype" id="5679077">bool</span><span class="op" id="5679081">)</span>&nbsp;<span class="op" id="5679083">(</span><span class="ident" id="5679084">list</span>&nbsp;<span class="op" id="5679089">[</span><span class="op" id="5679090">]</span><span class="ident" id="5679091">ast</span><span class="op" id="5679094">.</span><span class="ident" id="5679095">Expr</span><span class="op" id="5679099">)</span>&nbsp;<span class="op" id="5679101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679104">if</span>&nbsp;<span class="ident" id="5679107">p</span><span class="op" id="5679108">.</span><span class="ident" id="5679109">trace</span>&nbsp;<span class="op" id="5679115">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679119">defer</span>&nbsp;<span class="ident" id="5679125">un</span><span class="op" id="5679127">(</span><span class="ident" id="5679128">trace</span><span class="op" id="5679133">(</span><span class="ident" id="5679134">p</span><span class="op" id="5679135">,</span>&nbsp;<span class="string" id="5679137">&#34;ExpressionList&#34;</span><span class="op" id="5679153">)</span><span class="op" id="5679154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679161">list</span>&nbsp;<span class="op" id="5679166">=</span>&nbsp;<span class="builtinfunc" id="5679168">append</span><span class="op" id="5679174">(</span><span class="ident" id="5679175">list</span><span class="op" id="5679179">,</span>&nbsp;<span class="ident" id="5679181">p</span><span class="op" id="5679182">.</span><span class="ident" id="5679183">checkExpr</span><span class="op" id="5679192">(</span><span class="ident" id="5679193">p</span><span class="op" id="5679194">.</span><span class="ident" id="5679195">parseExpr</span><span class="op" id="5679204">(</span><span class="ident" id="5679205">lhs</span><span class="op" id="5679208">)</span><span class="op" id="5679209">)</span><span class="op" id="5679210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679213">for</span>&nbsp;<span class="ident" id="5679217">p</span><span class="op" id="5679218">.</span><span class="ident" id="5679219">tok</span>&nbsp;<span class="op" id="5679223">==</span>&nbsp;<span class="ident" id="5679226">token</span><span class="op" id="5679231">.</span><span class="ident" id="5679232">COMMA</span>&nbsp;<span class="op" id="5679238">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679242">p</span><span class="op" id="5679243">.</span><span class="ident" id="5679244">next</span><span class="op" id="5679248">(</span><span class="op" id="5679249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679253">list</span>&nbsp;<span class="op" id="5679258">=</span>&nbsp;<span class="builtinfunc" id="5679260">append</span><span class="op" id="5679266">(</span><span class="ident" id="5679267">list</span><span class="op" id="5679271">,</span>&nbsp;<span class="ident" id="5679273">p</span><span class="op" id="5679274">.</span><span class="ident" id="5679275">checkExpr</span><span class="op" id="5679284">(</span><span class="ident" id="5679285">p</span><span class="op" id="5679286">.</span><span class="ident" id="5679287">parseExpr</span><span class="op" id="5679296">(</span><span class="ident" id="5679297">lhs</span><span class="op" id="5679300">)</span><span class="op" id="5679301">)</span><span class="op" id="5679302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5679305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679309">return</span><br>
<span class="lineno">560</span><span class="op" id="5679316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5679319">func</span>&nbsp;<span class="op" id="5679324">(</span><span class="ident" id="5679325">p</span>&nbsp;<span class="op" id="5679327">*</span><span class="ident" id="5679328">parser</span><span class="op" id="5679334">)</span>&nbsp;<span class="ident" id="5679336">parseLhsList</span><span class="op" id="5679348">(</span><span class="op" id="5679349">)</span>&nbsp;<span class="op" id="5679351">[</span><span class="op" id="5679352">]</span><span class="ident" id="5679353">ast</span><span class="op" id="5679356">.</span><span class="ident" id="5679357">Expr</span>&nbsp;<span class="op" id="5679362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679365">old</span>&nbsp;<span class="op" id="5679369">:=</span>&nbsp;<span class="ident" id="5679372">p</span><span class="op" id="5679373">.</span><span class="ident" id="5679374">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679381">p</span><span class="op" id="5679382">.</span><span class="ident" id="5679383">inRhs</span>&nbsp;<span class="op" id="5679389">=</span>&nbsp;<span class="builtintype" id="5679391">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5679398">list</span>&nbsp;<span class="op" id="5679403">:=</span>&nbsp;<span class="ident" id="5679406">p</span><span class="op" id="5679407">.</span><span class="ident" id="5679408">parseExprList</span><span class="op" id="5679421">(</span><span class="builtintype" id="5679422">true</span><span class="op" id="5679426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679429">switch</span>&nbsp;<span class="ident" id="5679436">p</span><span class="op" id="5679437">.</span><span class="ident" id="5679438">tok</span>&nbsp;<span class="op" id="5679442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679445">case</span>&nbsp;<span class="ident" id="5679450">token</span><span class="op" id="5679455">.</span><span class="ident" id="5679456">DEFINE</span><span class="op" id="5679462">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679466">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679507">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679549">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679609">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5679634">case</span>&nbsp;<span class="ident" id="5679639">token</span><span class="op" id="5679644">.</span><span class="ident" id="5679645">COLON</span><span class="op" id="5679650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679654">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679724">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679796">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679825">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679882">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5679953">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680022">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680067">default</span><span class="op" id="5680074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680078">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680122">for</span>&nbsp;<span class="ident" id="5680126">_</span><span class="op" id="5680127">,</span>&nbsp;<span class="ident" id="5680129">x</span>&nbsp;<span class="op" id="5680131">:=</span>&nbsp;<span class="keyword" id="5680134">range</span>&nbsp;<span class="ident" id="5680140">list</span>&nbsp;<span class="op" id="5680145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680150">p</span><span class="op" id="5680151">.</span><span class="ident" id="5680152">resolve</span><span class="op" id="5680159">(</span><span class="ident" id="5680160">x</span><span class="op" id="5680161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680165">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680171">p</span><span class="op" id="5680172">.</span><span class="ident" id="5680173">inRhs</span>&nbsp;<span class="op" id="5680179">=</span>&nbsp;<span class="ident" id="5680181">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680186">return</span>&nbsp;<span class="ident" id="5680193">list</span><br>
<span class="lineno"></span><span class="op" id="5680198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="5680201">func</span>&nbsp;<span class="op" id="5680206">(</span><span class="ident" id="5680207">p</span>&nbsp;<span class="op" id="5680209">*</span><span class="ident" id="5680210">parser</span><span class="op" id="5680216">)</span>&nbsp;<span class="ident" id="5680218">parseRhsList</span><span class="op" id="5680230">(</span><span class="op" id="5680231">)</span>&nbsp;<span class="op" id="5680233">[</span><span class="op" id="5680234">]</span><span class="ident" id="5680235">ast</span><span class="op" id="5680238">.</span><span class="ident" id="5680239">Expr</span>&nbsp;<span class="op" id="5680244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680247">old</span>&nbsp;<span class="op" id="5680251">:=</span>&nbsp;<span class="ident" id="5680254">p</span><span class="op" id="5680255">.</span><span class="ident" id="5680256">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680263">p</span><span class="op" id="5680264">.</span><span class="ident" id="5680265">inRhs</span>&nbsp;<span class="op" id="5680271">=</span>&nbsp;<span class="builtintype" id="5680273">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680279">list</span>&nbsp;<span class="op" id="5680284">:=</span>&nbsp;<span class="ident" id="5680287">p</span><span class="op" id="5680288">.</span><span class="ident" id="5680289">parseExprList</span><span class="op" id="5680302">(</span><span class="builtintype" id="5680303">false</span><span class="op" id="5680308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680311">p</span><span class="op" id="5680312">.</span><span class="ident" id="5680313">inRhs</span>&nbsp;<span class="op" id="5680319">=</span>&nbsp;<span class="ident" id="5680321">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680326">return</span>&nbsp;<span class="ident" id="5680333">list</span><br>
<span class="lineno"></span><span class="op" id="5680338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5680341">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5680421">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5680431">func</span>&nbsp;<span class="op" id="5680436">(</span><span class="ident" id="5680437">p</span>&nbsp;<span class="op" id="5680439">*</span><span class="ident" id="5680440">parser</span><span class="op" id="5680446">)</span>&nbsp;<span class="ident" id="5680448">parseType</span><span class="op" id="5680457">(</span><span class="op" id="5680458">)</span>&nbsp;<span class="ident" id="5680460">ast</span><span class="op" id="5680463">.</span><span class="ident" id="5680464">Expr</span>&nbsp;<span class="op" id="5680469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680472">if</span>&nbsp;<span class="ident" id="5680475">p</span><span class="op" id="5680476">.</span><span class="ident" id="5680477">trace</span>&nbsp;<span class="op" id="5680483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680487">defer</span>&nbsp;<span class="ident" id="5680493">un</span><span class="op" id="5680495">(</span><span class="ident" id="5680496">trace</span><span class="op" id="5680501">(</span><span class="ident" id="5680502">p</span><span class="op" id="5680503">,</span>&nbsp;<span class="string" id="5680505">&#34;Type&#34;</span><span class="op" id="5680511">)</span><span class="op" id="5680512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680515">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680519">typ</span>&nbsp;<span class="op" id="5680523">:=</span>&nbsp;<span class="ident" id="5680526">p</span><span class="op" id="5680527">.</span><span class="ident" id="5680528">tryType</span><span class="op" id="5680535">(</span><span class="op" id="5680536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680540">if</span>&nbsp;<span class="ident" id="5680543">typ</span>&nbsp;<span class="op" id="5680547">==</span>&nbsp;<span class="ident" id="5680550">nil</span>&nbsp;<span class="op" id="5680554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680558">pos</span>&nbsp;<span class="op" id="5680562">:=</span>&nbsp;<span class="ident" id="5680565">p</span><span class="op" id="5680566">.</span><span class="ident" id="5680567">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680573">p</span><span class="op" id="5680574">.</span><span class="ident" id="5680575">errorExpected</span><span class="op" id="5680588">(</span><span class="ident" id="5680589">pos</span><span class="op" id="5680592">,</span>&nbsp;<span class="string" id="5680594">&#34;type&#34;</span><span class="op" id="5680600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680604">p</span><span class="op" id="5680605">.</span><span class="ident" id="5680606">next</span><span class="op" id="5680610">(</span><span class="op" id="5680611">)</span>&nbsp;<span class="comment" id="5680613">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680632">return</span>&nbsp;<span class="op" id="5680639">&amp;</span><span class="ident" id="5680640">ast</span><span class="op" id="5680643">.</span><span class="ident" id="5680644">BadExpr</span><span class="op" id="5680651">{</span><span class="ident" id="5680652">From</span><span class="op" id="5680656">:</span>&nbsp;<span class="ident" id="5680658">pos</span><span class="op" id="5680661">,</span>&nbsp;<span class="ident" id="5680663">To</span><span class="op" id="5680665">:</span>&nbsp;<span class="ident" id="5680667">p</span><span class="op" id="5680668">.</span><span class="ident" id="5680669">pos</span><span class="op" id="5680672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680679">return</span>&nbsp;<span class="ident" id="5680686">typ</span><br>
<span class="lineno"></span><span class="op" id="5680690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5680693">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5680748">func</span>&nbsp;<span class="op" id="5680753">(</span><span class="ident" id="5680754">p</span>&nbsp;<span class="op" id="5680756">*</span><span class="ident" id="5680757">parser</span><span class="op" id="5680763">)</span>&nbsp;<span class="ident" id="5680765">parseTypeName</span><span class="op" id="5680778">(</span><span class="op" id="5680779">)</span>&nbsp;<span class="ident" id="5680781">ast</span><span class="op" id="5680784">.</span><span class="ident" id="5680785">Expr</span>&nbsp;<span class="op" id="5680790">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680793">if</span>&nbsp;<span class="ident" id="5680796">p</span><span class="op" id="5680797">.</span><span class="ident" id="5680798">trace</span>&nbsp;<span class="op" id="5680804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680808">defer</span>&nbsp;<span class="ident" id="5680814">un</span><span class="op" id="5680816">(</span><span class="ident" id="5680817">trace</span><span class="op" id="5680822">(</span><span class="ident" id="5680823">p</span><span class="op" id="5680824">,</span>&nbsp;<span class="string" id="5680826">&#34;TypeName&#34;</span><span class="op" id="5680836">)</span><span class="op" id="5680837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5680840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680844">ident</span>&nbsp;<span class="op" id="5680850">:=</span>&nbsp;<span class="ident" id="5680853">p</span><span class="op" id="5680854">.</span><span class="ident" id="5680855">parseIdent</span><span class="op" id="5680865">(</span><span class="op" id="5680866">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680869">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5680936">if</span>&nbsp;<span class="ident" id="5680939">p</span><span class="op" id="5680940">.</span><span class="ident" id="5680941">tok</span>&nbsp;<span class="op" id="5680945">==</span>&nbsp;<span class="ident" id="5680948">token</span><span class="op" id="5680953">.</span><span class="ident" id="5680954">PERIOD</span>&nbsp;<span class="op" id="5680961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5680965">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5680994">p</span><span class="op" id="5680995">.</span><span class="ident" id="5680996">next</span><span class="op" id="5681000">(</span><span class="op" id="5681001">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681005">p</span><span class="op" id="5681006">.</span><span class="ident" id="5681007">resolve</span><span class="op" id="5681014">(</span><span class="ident" id="5681015">ident</span><span class="op" id="5681020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681024">sel</span>&nbsp;<span class="op" id="5681028">:=</span>&nbsp;<span class="ident" id="5681031">p</span><span class="op" id="5681032">.</span><span class="ident" id="5681033">parseIdent</span><span class="op" id="5681043">(</span><span class="op" id="5681044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681048">return</span>&nbsp;<span class="op" id="5681055">&amp;</span><span class="ident" id="5681056">ast</span><span class="op" id="5681059">.</span><span class="ident" id="5681060">SelectorExpr</span><span class="op" id="5681072">{</span><span class="ident" id="5681073">X</span><span class="op" id="5681074">:</span>&nbsp;<span class="ident" id="5681076">ident</span><span class="op" id="5681081">,</span>&nbsp;<span class="ident" id="5681083">Sel</span><span class="op" id="5681086">:</span>&nbsp;<span class="ident" id="5681088">sel</span><span class="op" id="5681091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681098">return</span>&nbsp;<span class="ident" id="5681105">ident</span><br>
<span class="lineno"></span><span class="op" id="5681111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5681114">func</span>&nbsp;<span class="op" id="5681119">(</span><span class="ident" id="5681120">p</span>&nbsp;<span class="op" id="5681122">*</span><span class="ident" id="5681123">parser</span><span class="op" id="5681129">)</span>&nbsp;<span class="ident" id="5681131">parseArrayType</span><span class="op" id="5681145">(</span><span class="op" id="5681146">)</span>&nbsp;<span class="ident" id="5681148">ast</span><span class="op" id="5681151">.</span><span class="ident" id="5681152">Expr</span>&nbsp;<span class="op" id="5681157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681160">if</span>&nbsp;<span class="ident" id="5681163">p</span><span class="op" id="5681164">.</span><span class="ident" id="5681165">trace</span>&nbsp;<span class="op" id="5681171">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681175">defer</span>&nbsp;<span class="ident" id="5681181">un</span><span class="op" id="5681183">(</span><span class="ident" id="5681184">trace</span><span class="op" id="5681189">(</span><span class="ident" id="5681190">p</span><span class="op" id="5681191">,</span>&nbsp;<span class="string" id="5681193">&#34;ArrayType&#34;</span><span class="op" id="5681204">)</span><span class="op" id="5681205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681212">lbrack</span>&nbsp;<span class="op" id="5681219">:=</span>&nbsp;<span class="ident" id="5681222">p</span><span class="op" id="5681223">.</span><span class="ident" id="5681224">expect</span><span class="op" id="5681230">(</span><span class="ident" id="5681231">token</span><span class="op" id="5681236">.</span><span class="ident" id="5681237">LBRACK</span><span class="op" id="5681243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681246">p</span><span class="op" id="5681247">.</span><span class="ident" id="5681248">exprLev</span><span class="op" id="5681255">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681259">var</span>&nbsp;<span class="builtinfunc" id="5681263">len</span>&nbsp;<span class="ident" id="5681267">ast</span><span class="op" id="5681270">.</span><span class="ident" id="5681271">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681277">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681336">if</span>&nbsp;<span class="ident" id="5681339">p</span><span class="op" id="5681340">.</span><span class="ident" id="5681341">tok</span>&nbsp;<span class="op" id="5681345">==</span>&nbsp;<span class="ident" id="5681348">token</span><span class="op" id="5681353">.</span><span class="ident" id="5681354">ELLIPSIS</span>&nbsp;<span class="op" id="5681363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5681367">len</span>&nbsp;<span class="op" id="5681371">=</span>&nbsp;<span class="op" id="5681373">&amp;</span><span class="ident" id="5681374">ast</span><span class="op" id="5681377">.</span><span class="ident" id="5681378">Ellipsis</span><span class="op" id="5681386">{</span><span class="ident" id="5681387">Ellipsis</span><span class="op" id="5681395">:</span>&nbsp;<span class="ident" id="5681397">p</span><span class="op" id="5681398">.</span><span class="ident" id="5681399">pos</span><span class="op" id="5681402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681406">p</span><span class="op" id="5681407">.</span><span class="ident" id="5681408">next</span><span class="op" id="5681412">(</span><span class="op" id="5681413">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681416">}</span>&nbsp;<span class="keyword" id="5681418">else</span>&nbsp;<span class="keyword" id="5681423">if</span>&nbsp;<span class="ident" id="5681426">p</span><span class="op" id="5681427">.</span><span class="ident" id="5681428">tok</span>&nbsp;<span class="op" id="5681432">!=</span>&nbsp;<span class="ident" id="5681435">token</span><span class="op" id="5681440">.</span><span class="ident" id="5681441">RBRACK</span>&nbsp;<span class="op" id="5681448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5681452">len</span>&nbsp;<span class="op" id="5681456">=</span>&nbsp;<span class="ident" id="5681458">p</span><span class="op" id="5681459">.</span><span class="ident" id="5681460">parseRhs</span><span class="op" id="5681468">(</span><span class="op" id="5681469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681475">p</span><span class="op" id="5681476">.</span><span class="ident" id="5681477">exprLev</span><span class="op" id="5681484">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681488">p</span><span class="op" id="5681489">.</span><span class="ident" id="5681490">expect</span><span class="op" id="5681496">(</span><span class="ident" id="5681497">token</span><span class="op" id="5681502">.</span><span class="ident" id="5681503">RBRACK</span><span class="op" id="5681509">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681512">elt</span>&nbsp;<span class="op" id="5681516">:=</span>&nbsp;<span class="ident" id="5681519">p</span><span class="op" id="5681520">.</span><span class="ident" id="5681521">parseType</span><span class="op" id="5681530">(</span><span class="op" id="5681531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681535">return</span>&nbsp;<span class="op" id="5681542">&amp;</span><span class="ident" id="5681543">ast</span><span class="op" id="5681546">.</span><span class="ident" id="5681547">ArrayType</span><span class="op" id="5681556">{</span><span class="ident" id="5681557">Lbrack</span><span class="op" id="5681563">:</span>&nbsp;<span class="ident" id="5681565">lbrack</span><span class="op" id="5681571">,</span>&nbsp;<span class="ident" id="5681573">Len</span><span class="op" id="5681576">:</span>&nbsp;<span class="builtinfunc" id="5681578">len</span><span class="op" id="5681581">,</span>&nbsp;<span class="ident" id="5681583">Elt</span><span class="op" id="5681586">:</span>&nbsp;<span class="ident" id="5681588">elt</span><span class="op" id="5681591">}</span><br>
<span class="lineno"></span><span class="op" id="5681593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="5681596">func</span>&nbsp;<span class="op" id="5681601">(</span><span class="ident" id="5681602">p</span>&nbsp;<span class="op" id="5681604">*</span><span class="ident" id="5681605">parser</span><span class="op" id="5681611">)</span>&nbsp;<span class="ident" id="5681613">makeIdentList</span><span class="op" id="5681626">(</span><span class="ident" id="5681627">list</span>&nbsp;<span class="op" id="5681632">[</span><span class="op" id="5681633">]</span><span class="ident" id="5681634">ast</span><span class="op" id="5681637">.</span><span class="ident" id="5681638">Expr</span><span class="op" id="5681642">)</span>&nbsp;<span class="op" id="5681644">[</span><span class="op" id="5681645">]</span><span class="op" id="5681646">*</span><span class="ident" id="5681647">ast</span><span class="op" id="5681650">.</span><span class="ident" id="5681651">Ident</span>&nbsp;<span class="op" id="5681657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681660">idents</span>&nbsp;<span class="op" id="5681667">:=</span>&nbsp;<span class="builtinfunc" id="5681670">make</span><span class="op" id="5681674">(</span><span class="op" id="5681675">[</span><span class="op" id="5681676">]</span><span class="op" id="5681677">*</span><span class="ident" id="5681678">ast</span><span class="op" id="5681681">.</span><span class="ident" id="5681682">Ident</span><span class="op" id="5681687">,</span>&nbsp;<span class="builtinfunc" id="5681689">len</span><span class="op" id="5681692">(</span><span class="ident" id="5681693">list</span><span class="op" id="5681697">)</span><span class="op" id="5681698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681701">for</span>&nbsp;<span class="ident" id="5681705">i</span><span class="op" id="5681706">,</span>&nbsp;<span class="ident" id="5681708">x</span>&nbsp;<span class="op" id="5681710">:=</span>&nbsp;<span class="keyword" id="5681713">range</span>&nbsp;<span class="ident" id="5681719">list</span>&nbsp;<span class="op" id="5681724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681728">ident</span><span class="op" id="5681733">,</span>&nbsp;<span class="ident" id="5681735">isIdent</span>&nbsp;<span class="op" id="5681743">:=</span>&nbsp;<span class="ident" id="5681746">x</span><span class="op" id="5681747">.</span><span class="op" id="5681748">(</span><span class="op" id="5681749">*</span><span class="ident" id="5681750">ast</span><span class="op" id="5681753">.</span><span class="ident" id="5681754">Ident</span><span class="op" id="5681759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681763">if</span>&nbsp;<span class="op" id="5681766">!</span><span class="ident" id="5681767">isIdent</span>&nbsp;<span class="op" id="5681775">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681780">if</span>&nbsp;<span class="ident" id="5681783">_</span><span class="op" id="5681784">,</span>&nbsp;<span class="ident" id="5681786">isBad</span>&nbsp;<span class="op" id="5681792">:=</span>&nbsp;<span class="ident" id="5681795">x</span><span class="op" id="5681796">.</span><span class="op" id="5681797">(</span><span class="op" id="5681798">*</span><span class="ident" id="5681799">ast</span><span class="op" id="5681802">.</span><span class="ident" id="5681803">BadExpr</span><span class="op" id="5681810">)</span><span class="op" id="5681811">;</span>&nbsp;<span class="op" id="5681813">!</span><span class="ident" id="5681814">isBad</span>&nbsp;<span class="op" id="5681820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5681826">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681869">p</span><span class="op" id="5681870">.</span><span class="ident" id="5681871">errorExpected</span><span class="op" id="5681884">(</span><span class="ident" id="5681885">x</span><span class="op" id="5681886">.</span><span class="ident" id="5681887">Pos</span><span class="op" id="5681890">(</span><span class="op" id="5681891">)</span><span class="op" id="5681892">,</span>&nbsp;<span class="string" id="5681894">&#34;identifier&#34;</span><span class="op" id="5681906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681916">ident</span>&nbsp;<span class="op" id="5681922">=</span>&nbsp;<span class="op" id="5681924">&amp;</span><span class="ident" id="5681925">ast</span><span class="op" id="5681928">.</span><span class="ident" id="5681929">Ident</span><span class="op" id="5681934">{</span><span class="ident" id="5681935">NamePos</span><span class="op" id="5681942">:</span>&nbsp;<span class="ident" id="5681944">x</span><span class="op" id="5681945">.</span><span class="ident" id="5681946">Pos</span><span class="op" id="5681949">(</span><span class="op" id="5681950">)</span><span class="op" id="5681951">,</span>&nbsp;<span class="ident" id="5681953">Name</span><span class="op" id="5681957">:</span>&nbsp;<span class="string" id="5681959">&#34;_&#34;</span><span class="op" id="5681962">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5681970">idents</span><span class="op" id="5681976">[</span><span class="ident" id="5681977">i</span><span class="op" id="5681978">]</span>&nbsp;<span class="op" id="5681980">=</span>&nbsp;<span class="ident" id="5681982">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5681989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5681992">return</span>&nbsp;<span class="ident" id="5681999">idents</span><br>
<span class="lineno"></span><span class="op" id="5682006">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5682009">func</span>&nbsp;<span class="op" id="5682014">(</span><span class="ident" id="5682015">p</span>&nbsp;<span class="op" id="5682017">*</span><span class="ident" id="5682018">parser</span><span class="op" id="5682024">)</span>&nbsp;<span class="ident" id="5682026">parseFieldDecl</span><span class="op" id="5682040">(</span><span class="ident" id="5682041">scope</span>&nbsp;<span class="op" id="5682047">*</span><span class="ident" id="5682048">ast</span><span class="op" id="5682051">.</span><span class="ident" id="5682052">Scope</span><span class="op" id="5682057">)</span>&nbsp;<span class="op" id="5682059">*</span><span class="ident" id="5682060">ast</span><span class="op" id="5682063">.</span><span class="ident" id="5682064">Field</span>&nbsp;<span class="op" id="5682070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682073">if</span>&nbsp;<span class="ident" id="5682076">p</span><span class="op" id="5682077">.</span><span class="ident" id="5682078">trace</span>&nbsp;<span class="op" id="5682084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682088">defer</span>&nbsp;<span class="ident" id="5682094">un</span><span class="op" id="5682096">(</span><span class="ident" id="5682097">trace</span><span class="op" id="5682102">(</span><span class="ident" id="5682103">p</span><span class="op" id="5682104">,</span>&nbsp;<span class="string" id="5682106">&#34;FieldDecl&#34;</span><span class="op" id="5682117">)</span><span class="op" id="5682118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682121">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682125">doc</span>&nbsp;<span class="op" id="5682129">:=</span>&nbsp;<span class="ident" id="5682132">p</span><span class="op" id="5682133">.</span><span class="ident" id="5682134">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682148">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682162">list</span><span class="op" id="5682166">,</span>&nbsp;<span class="ident" id="5682168">typ</span>&nbsp;<span class="op" id="5682172">:=</span>&nbsp;<span class="ident" id="5682175">p</span><span class="op" id="5682176">.</span><span class="ident" id="5682177">parseVarList</span><span class="op" id="5682189">(</span><span class="builtintype" id="5682190">false</span><span class="op" id="5682195">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682199">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682207">var</span>&nbsp;<span class="ident" id="5682211">tag</span>&nbsp;<span class="op" id="5682215">*</span><span class="ident" id="5682216">ast</span><span class="op" id="5682219">.</span><span class="ident" id="5682220">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682230">if</span>&nbsp;<span class="ident" id="5682233">p</span><span class="op" id="5682234">.</span><span class="ident" id="5682235">tok</span>&nbsp;<span class="op" id="5682239">==</span>&nbsp;<span class="ident" id="5682242">token</span><span class="op" id="5682247">.</span><span class="ident" id="5682248">STRING</span>&nbsp;<span class="op" id="5682255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682259">tag</span>&nbsp;<span class="op" id="5682263">=</span>&nbsp;<span class="op" id="5682265">&amp;</span><span class="ident" id="5682266">ast</span><span class="op" id="5682269">.</span><span class="ident" id="5682270">BasicLit</span><span class="op" id="5682278">{</span><span class="ident" id="5682279">ValuePos</span><span class="op" id="5682287">:</span>&nbsp;<span class="ident" id="5682289">p</span><span class="op" id="5682290">.</span><span class="ident" id="5682291">pos</span><span class="op" id="5682294">,</span>&nbsp;<span class="ident" id="5682296">Kind</span><span class="op" id="5682300">:</span>&nbsp;<span class="ident" id="5682302">p</span><span class="op" id="5682303">.</span><span class="ident" id="5682304">tok</span><span class="op" id="5682307">,</span>&nbsp;<span class="ident" id="5682309">Value</span><span class="op" id="5682314">:</span>&nbsp;<span class="ident" id="5682316">p</span><span class="op" id="5682317">.</span><span class="ident" id="5682318">lit</span><span class="op" id="5682321">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682325">p</span><span class="op" id="5682326">.</span><span class="ident" id="5682327">next</span><span class="op" id="5682331">(</span><span class="op" id="5682332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682339">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682356">var</span>&nbsp;<span class="ident" id="5682360">idents</span>&nbsp;<span class="op" id="5682367">[</span><span class="op" id="5682368">]</span><span class="op" id="5682369">*</span><span class="ident" id="5682370">ast</span><span class="op" id="5682373">.</span><span class="ident" id="5682374">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682381">if</span>&nbsp;<span class="ident" id="5682384">typ</span>&nbsp;<span class="op" id="5682388">!=</span>&nbsp;<span class="ident" id="5682391">nil</span>&nbsp;<span class="op" id="5682395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682399">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682424">idents</span>&nbsp;<span class="op" id="5682431">=</span>&nbsp;<span class="ident" id="5682433">p</span><span class="op" id="5682434">.</span><span class="ident" id="5682435">makeIdentList</span><span class="op" id="5682448">(</span><span class="ident" id="5682449">list</span><span class="op" id="5682453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682456">}</span>&nbsp;<span class="keyword" id="5682458">else</span>&nbsp;<span class="op" id="5682463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5682467">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682504">typ</span>&nbsp;<span class="op" id="5682508">=</span>&nbsp;<span class="ident" id="5682510">list</span><span class="op" id="5682514">[</span><span class="num" id="5682515">0</span><span class="op" id="5682516">]</span>&nbsp;<span class="comment" id="5682518">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682559">if</span>&nbsp;<span class="ident" id="5682562">n</span>&nbsp;<span class="op" id="5682564">:=</span>&nbsp;<span class="builtinfunc" id="5682567">len</span><span class="op" id="5682570">(</span><span class="ident" id="5682571">list</span><span class="op" id="5682575">)</span><span class="op" id="5682576">;</span>&nbsp;<span class="ident" id="5682578">n</span>&nbsp;<span class="op" id="5682580">&gt;</span>&nbsp;<span class="num" id="5682582">1</span>&nbsp;<span class="op" id="5682584">||</span>&nbsp;<span class="op" id="5682587">!</span><span class="ident" id="5682588">isTypeName</span><span class="op" id="5682598">(</span><span class="ident" id="5682599">deref</span><span class="op" id="5682604">(</span><span class="ident" id="5682605">typ</span><span class="op" id="5682608">)</span><span class="op" id="5682609">)</span>&nbsp;<span class="op" id="5682611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682616">pos</span>&nbsp;<span class="op" id="5682620">:=</span>&nbsp;<span class="ident" id="5682623">typ</span><span class="op" id="5682626">.</span><span class="ident" id="5682627">Pos</span><span class="op" id="5682630">(</span><span class="op" id="5682631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682636">p</span><span class="op" id="5682637">.</span><span class="ident" id="5682638">errorExpected</span><span class="op" id="5682651">(</span><span class="ident" id="5682652">pos</span><span class="op" id="5682655">,</span>&nbsp;<span class="string" id="5682657">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="5682674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682679">typ</span>&nbsp;<span class="op" id="5682683">=</span>&nbsp;<span class="op" id="5682685">&amp;</span><span class="ident" id="5682686">ast</span><span class="op" id="5682689">.</span><span class="ident" id="5682690">BadExpr</span><span class="op" id="5682697">{</span><span class="ident" id="5682698">From</span><span class="op" id="5682702">:</span>&nbsp;<span class="ident" id="5682704">pos</span><span class="op" id="5682707">,</span>&nbsp;<span class="ident" id="5682709">To</span><span class="op" id="5682711">:</span>&nbsp;<span class="ident" id="5682713">p</span><span class="op" id="5682714">.</span><span class="ident" id="5682715">safePos</span><span class="op" id="5682722">(</span><span class="ident" id="5682723">list</span><span class="op" id="5682727">[</span><span class="ident" id="5682728">n</span><span class="op" id="5682729">-</span><span class="num" id="5682730">1</span><span class="op" id="5682731">]</span><span class="op" id="5682732">.</span><span class="ident" id="5682733">End</span><span class="op" id="5682736">(</span><span class="op" id="5682737">)</span><span class="op" id="5682738">)</span><span class="op" id="5682739">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5682746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682750">p</span><span class="op" id="5682751">.</span><span class="ident" id="5682752">expectSemi</span><span class="op" id="5682762">(</span><span class="op" id="5682763">)</span>&nbsp;<span class="comment" id="5682765">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682806">field</span>&nbsp;<span class="op" id="5682812">:=</span>&nbsp;<span class="op" id="5682815">&amp;</span><span class="ident" id="5682816">ast</span><span class="op" id="5682819">.</span><span class="ident" id="5682820">Field</span><span class="op" id="5682825">{</span><span class="ident" id="5682826">Doc</span><span class="op" id="5682829">:</span>&nbsp;<span class="ident" id="5682831">doc</span><span class="op" id="5682834">,</span>&nbsp;<span class="ident" id="5682836">Names</span><span class="op" id="5682841">:</span>&nbsp;<span class="ident" id="5682843">idents</span><span class="op" id="5682849">,</span>&nbsp;<span class="ident" id="5682851">Type</span><span class="op" id="5682855">:</span>&nbsp;<span class="ident" id="5682857">typ</span><span class="op" id="5682860">,</span>&nbsp;<span class="ident" id="5682862">Tag</span><span class="op" id="5682865">:</span>&nbsp;<span class="ident" id="5682867">tag</span><span class="op" id="5682870">,</span>&nbsp;<span class="ident" id="5682872">Comment</span><span class="op" id="5682879">:</span>&nbsp;<span class="ident" id="5682881">p</span><span class="op" id="5682882">.</span><span class="ident" id="5682883">lineComment</span><span class="op" id="5682894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682897">p</span><span class="op" id="5682898">.</span><span class="ident" id="5682899">declare</span><span class="op" id="5682906">(</span><span class="ident" id="5682907">field</span><span class="op" id="5682912">,</span>&nbsp;<span class="ident" id="5682914">nil</span><span class="op" id="5682917">,</span>&nbsp;<span class="ident" id="5682919">scope</span><span class="op" id="5682924">,</span>&nbsp;<span class="ident" id="5682926">ast</span><span class="op" id="5682929">.</span><span class="ident" id="5682930">Var</span><span class="op" id="5682933">,</span>&nbsp;<span class="ident" id="5682935">idents</span><span class="op" id="5682941">...</span><span class="op" id="5682944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5682947">p</span><span class="op" id="5682948">.</span><span class="ident" id="5682949">resolve</span><span class="op" id="5682956">(</span><span class="ident" id="5682957">typ</span><span class="op" id="5682960">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5682964">return</span>&nbsp;<span class="ident" id="5682971">field</span><br>
<span class="lineno">715</span><span class="op" id="5682977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5682980">func</span>&nbsp;<span class="op" id="5682985">(</span><span class="ident" id="5682986">p</span>&nbsp;<span class="op" id="5682988">*</span><span class="ident" id="5682989">parser</span><span class="op" id="5682995">)</span>&nbsp;<span class="ident" id="5682997">parseStructType</span><span class="op" id="5683012">(</span><span class="op" id="5683013">)</span>&nbsp;<span class="op" id="5683015">*</span><span class="ident" id="5683016">ast</span><span class="op" id="5683019">.</span><span class="ident" id="5683020">StructType</span>&nbsp;<span class="op" id="5683031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683034">if</span>&nbsp;<span class="ident" id="5683037">p</span><span class="op" id="5683038">.</span><span class="ident" id="5683039">trace</span>&nbsp;<span class="op" id="5683045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683049">defer</span>&nbsp;<span class="ident" id="5683055">un</span><span class="op" id="5683057">(</span><span class="ident" id="5683058">trace</span><span class="op" id="5683063">(</span><span class="ident" id="5683064">p</span><span class="op" id="5683065">,</span>&nbsp;<span class="string" id="5683067">&#34;StructType&#34;</span><span class="op" id="5683079">)</span><span class="op" id="5683080">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683087">pos</span>&nbsp;<span class="op" id="5683091">:=</span>&nbsp;<span class="ident" id="5683094">p</span><span class="op" id="5683095">.</span><span class="ident" id="5683096">expect</span><span class="op" id="5683102">(</span><span class="ident" id="5683103">token</span><span class="op" id="5683108">.</span><span class="ident" id="5683109">STRUCT</span><span class="op" id="5683115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683118">lbrace</span>&nbsp;<span class="op" id="5683125">:=</span>&nbsp;<span class="ident" id="5683128">p</span><span class="op" id="5683129">.</span><span class="ident" id="5683130">expect</span><span class="op" id="5683136">(</span><span class="ident" id="5683137">token</span><span class="op" id="5683142">.</span><span class="ident" id="5683143">LBRACE</span><span class="op" id="5683149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683152">scope</span>&nbsp;<span class="op" id="5683158">:=</span>&nbsp;<span class="ident" id="5683161">ast</span><span class="op" id="5683164">.</span><span class="ident" id="5683165">NewScope</span><span class="op" id="5683173">(</span><span class="ident" id="5683174">nil</span><span class="op" id="5683177">)</span>&nbsp;<span class="comment" id="5683179">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683196">var</span>&nbsp;<span class="ident" id="5683200">list</span>&nbsp;<span class="op" id="5683205">[</span><span class="op" id="5683206">]</span><span class="op" id="5683207">*</span><span class="ident" id="5683208">ast</span><span class="op" id="5683211">.</span><span class="ident" id="5683212">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683219">for</span>&nbsp;<span class="ident" id="5683223">p</span><span class="op" id="5683224">.</span><span class="ident" id="5683225">tok</span>&nbsp;<span class="op" id="5683229">==</span>&nbsp;<span class="ident" id="5683232">token</span><span class="op" id="5683237">.</span><span class="ident" id="5683238">IDENT</span>&nbsp;<span class="op" id="5683244">||</span>&nbsp;<span class="ident" id="5683247">p</span><span class="op" id="5683248">.</span><span class="ident" id="5683249">tok</span>&nbsp;<span class="op" id="5683253">==</span>&nbsp;<span class="ident" id="5683256">token</span><span class="op" id="5683261">.</span><span class="ident" id="5683262">MUL</span>&nbsp;<span class="op" id="5683266">||</span>&nbsp;<span class="ident" id="5683269">p</span><span class="op" id="5683270">.</span><span class="ident" id="5683271">tok</span>&nbsp;<span class="op" id="5683275">==</span>&nbsp;<span class="ident" id="5683278">token</span><span class="op" id="5683283">.</span><span class="ident" id="5683284">LPAREN</span>&nbsp;<span class="op" id="5683291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683295">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683358">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5683421">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683480">list</span>&nbsp;<span class="op" id="5683485">=</span>&nbsp;<span class="builtinfunc" id="5683487">append</span><span class="op" id="5683493">(</span><span class="ident" id="5683494">list</span><span class="op" id="5683498">,</span>&nbsp;<span class="ident" id="5683500">p</span><span class="op" id="5683501">.</span><span class="ident" id="5683502">parseFieldDecl</span><span class="op" id="5683516">(</span><span class="ident" id="5683517">scope</span><span class="op" id="5683522">)</span><span class="op" id="5683523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683529">rbrace</span>&nbsp;<span class="op" id="5683536">:=</span>&nbsp;<span class="ident" id="5683539">p</span><span class="op" id="5683540">.</span><span class="ident" id="5683541">expect</span><span class="op" id="5683547">(</span><span class="ident" id="5683548">token</span><span class="op" id="5683553">.</span><span class="ident" id="5683554">RBRACE</span><span class="op" id="5683560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683564">return</span>&nbsp;<span class="op" id="5683571">&amp;</span><span class="ident" id="5683572">ast</span><span class="op" id="5683575">.</span><span class="ident" id="5683576">StructType</span><span class="op" id="5683586">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683590">Struct</span><span class="op" id="5683596">:</span>&nbsp;<span class="ident" id="5683598">pos</span><span class="op" id="5683601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683605">Fields</span><span class="op" id="5683611">:</span>&nbsp;<span class="op" id="5683613">&amp;</span><span class="ident" id="5683614">ast</span><span class="op" id="5683617">.</span><span class="ident" id="5683618">FieldList</span><span class="op" id="5683627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683632">Opening</span><span class="op" id="5683639">:</span>&nbsp;<span class="ident" id="5683641">lbrace</span><span class="op" id="5683647">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683652">List</span><span class="op" id="5683656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5683661">list</span><span class="op" id="5683665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683670">Closing</span><span class="op" id="5683677">:</span>&nbsp;<span class="ident" id="5683679">rbrace</span><span class="op" id="5683685">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683689">}</span><span class="op" id="5683690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683693">}</span><br>
<span class="lineno"></span><span class="op" id="5683695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5683698">func</span>&nbsp;<span class="op" id="5683703">(</span><span class="ident" id="5683704">p</span>&nbsp;<span class="op" id="5683706">*</span><span class="ident" id="5683707">parser</span><span class="op" id="5683713">)</span>&nbsp;<span class="ident" id="5683715">parsePointerType</span><span class="op" id="5683731">(</span><span class="op" id="5683732">)</span>&nbsp;<span class="op" id="5683734">*</span><span class="ident" id="5683735">ast</span><span class="op" id="5683738">.</span><span class="ident" id="5683739">StarExpr</span>&nbsp;<span class="op" id="5683748">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683751">if</span>&nbsp;<span class="ident" id="5683754">p</span><span class="op" id="5683755">.</span><span class="ident" id="5683756">trace</span>&nbsp;<span class="op" id="5683762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683766">defer</span>&nbsp;<span class="ident" id="5683772">un</span><span class="op" id="5683774">(</span><span class="ident" id="5683775">trace</span><span class="op" id="5683780">(</span><span class="ident" id="5683781">p</span><span class="op" id="5683782">,</span>&nbsp;<span class="string" id="5683784">&#34;PointerType&#34;</span><span class="op" id="5683797">)</span><span class="op" id="5683798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5683801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683805">star</span>&nbsp;<span class="op" id="5683810">:=</span>&nbsp;<span class="ident" id="5683813">p</span><span class="op" id="5683814">.</span><span class="ident" id="5683815">expect</span><span class="op" id="5683821">(</span><span class="ident" id="5683822">token</span><span class="op" id="5683827">.</span><span class="ident" id="5683828">MUL</span><span class="op" id="5683831">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5683834">base</span>&nbsp;<span class="op" id="5683839">:=</span>&nbsp;<span class="ident" id="5683842">p</span><span class="op" id="5683843">.</span><span class="ident" id="5683844">parseType</span><span class="op" id="5683853">(</span><span class="op" id="5683854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5683858">return</span>&nbsp;<span class="op" id="5683865">&amp;</span><span class="ident" id="5683866">ast</span><span class="op" id="5683869">.</span><span class="ident" id="5683870">StarExpr</span><span class="op" id="5683878">{</span><span class="ident" id="5683879">Star</span><span class="op" id="5683883">:</span>&nbsp;<span class="ident" id="5683885">star</span><span class="op" id="5683889">,</span>&nbsp;<span class="ident" id="5683891">X</span><span class="op" id="5683892">:</span>&nbsp;<span class="ident" id="5683894">base</span><span class="op" id="5683898">}</span><br>
<span class="lineno"></span><span class="op" id="5683900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5683903">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5683958">func</span>&nbsp;<span class="op" id="5683963">(</span><span class="ident" id="5683964">p</span>&nbsp;<span class="op" id="5683966">*</span><span class="ident" id="5683967">parser</span><span class="op" id="5683973">)</span>&nbsp;<span class="ident" id="5683975">tryVarType</span><span class="op" id="5683985">(</span><span class="ident" id="5683986">isParam</span>&nbsp;<span class="builtintype" id="5683994">bool</span><span class="op" id="5683998">)</span>&nbsp;<span class="ident" id="5684000">ast</span><span class="op" id="5684003">.</span><span class="ident" id="5684004">Expr</span>&nbsp;<span class="op" id="5684009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684012">if</span>&nbsp;<span class="ident" id="5684015">isParam</span>&nbsp;<span class="op" id="5684023">&amp;&amp;</span>&nbsp;<span class="ident" id="5684026">p</span><span class="op" id="5684027">.</span><span class="ident" id="5684028">tok</span>&nbsp;<span class="op" id="5684032">==</span>&nbsp;<span class="ident" id="5684035">token</span><span class="op" id="5684040">.</span><span class="ident" id="5684041">ELLIPSIS</span>&nbsp;<span class="op" id="5684050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684054">pos</span>&nbsp;<span class="op" id="5684058">:=</span>&nbsp;<span class="ident" id="5684061">p</span><span class="op" id="5684062">.</span><span class="ident" id="5684063">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684069">p</span><span class="op" id="5684070">.</span><span class="ident" id="5684071">next</span><span class="op" id="5684075">(</span><span class="op" id="5684076">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684080">typ</span>&nbsp;<span class="op" id="5684084">:=</span>&nbsp;<span class="ident" id="5684087">p</span><span class="op" id="5684088">.</span><span class="ident" id="5684089">tryIdentOrType</span><span class="op" id="5684103">(</span><span class="op" id="5684104">)</span>&nbsp;<span class="comment" id="5684106">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684170">if</span>&nbsp;<span class="ident" id="5684173">typ</span>&nbsp;<span class="op" id="5684177">!=</span>&nbsp;<span class="ident" id="5684180">nil</span>&nbsp;<span class="op" id="5684184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684189">p</span><span class="op" id="5684190">.</span><span class="ident" id="5684191">resolve</span><span class="op" id="5684198">(</span><span class="ident" id="5684199">typ</span><span class="op" id="5684202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684206">}</span>&nbsp;<span class="keyword" id="5684208">else</span>&nbsp;<span class="op" id="5684213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684218">p</span><span class="op" id="5684219">.</span><span class="builtintype" id="5684220">error</span><span class="op" id="5684225">(</span><span class="ident" id="5684226">pos</span><span class="op" id="5684229">,</span>&nbsp;<span class="string" id="5684231">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="5684264">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684269">typ</span>&nbsp;<span class="op" id="5684273">=</span>&nbsp;<span class="op" id="5684275">&amp;</span><span class="ident" id="5684276">ast</span><span class="op" id="5684279">.</span><span class="ident" id="5684280">BadExpr</span><span class="op" id="5684287">{</span><span class="ident" id="5684288">From</span><span class="op" id="5684292">:</span>&nbsp;<span class="ident" id="5684294">pos</span><span class="op" id="5684297">,</span>&nbsp;<span class="ident" id="5684299">To</span><span class="op" id="5684301">:</span>&nbsp;<span class="ident" id="5684303">p</span><span class="op" id="5684304">.</span><span class="ident" id="5684305">pos</span><span class="op" id="5684308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684316">return</span>&nbsp;<span class="op" id="5684323">&amp;</span><span class="ident" id="5684324">ast</span><span class="op" id="5684327">.</span><span class="ident" id="5684328">Ellipsis</span><span class="op" id="5684336">{</span><span class="ident" id="5684337">Ellipsis</span><span class="op" id="5684345">:</span>&nbsp;<span class="ident" id="5684347">pos</span><span class="op" id="5684350">,</span>&nbsp;<span class="ident" id="5684352">Elt</span><span class="op" id="5684355">:</span>&nbsp;<span class="ident" id="5684357">typ</span><span class="op" id="5684360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684366">return</span>&nbsp;<span class="ident" id="5684373">p</span><span class="op" id="5684374">.</span><span class="ident" id="5684375">tryIdentOrType</span><span class="op" id="5684389">(</span><span class="op" id="5684390">)</span><br>
<span class="lineno">770</span><span class="op" id="5684392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5684395">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5684450">func</span>&nbsp;<span class="op" id="5684455">(</span><span class="ident" id="5684456">p</span>&nbsp;<span class="op" id="5684458">*</span><span class="ident" id="5684459">parser</span><span class="op" id="5684465">)</span>&nbsp;<span class="ident" id="5684467">parseVarType</span><span class="op" id="5684479">(</span><span class="ident" id="5684480">isParam</span>&nbsp;<span class="builtintype" id="5684488">bool</span><span class="op" id="5684492">)</span>&nbsp;<span class="ident" id="5684494">ast</span><span class="op" id="5684497">.</span><span class="ident" id="5684498">Expr</span>&nbsp;<span class="op" id="5684503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684506">typ</span>&nbsp;<span class="op" id="5684510">:=</span>&nbsp;<span class="ident" id="5684513">p</span><span class="op" id="5684514">.</span><span class="ident" id="5684515">tryVarType</span><span class="op" id="5684525">(</span><span class="ident" id="5684526">isParam</span><span class="op" id="5684533">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684536">if</span>&nbsp;<span class="ident" id="5684539">typ</span>&nbsp;<span class="op" id="5684543">==</span>&nbsp;<span class="ident" id="5684546">nil</span>&nbsp;<span class="op" id="5684550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684554">pos</span>&nbsp;<span class="op" id="5684558">:=</span>&nbsp;<span class="ident" id="5684561">p</span><span class="op" id="5684562">.</span><span class="ident" id="5684563">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684569">p</span><span class="op" id="5684570">.</span><span class="ident" id="5684571">errorExpected</span><span class="op" id="5684584">(</span><span class="ident" id="5684585">pos</span><span class="op" id="5684588">,</span>&nbsp;<span class="string" id="5684590">&#34;type&#34;</span><span class="op" id="5684596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684600">p</span><span class="op" id="5684601">.</span><span class="ident" id="5684602">next</span><span class="op" id="5684606">(</span><span class="op" id="5684607">)</span>&nbsp;<span class="comment" id="5684609">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5684628">typ</span>&nbsp;<span class="op" id="5684632">=</span>&nbsp;<span class="op" id="5684634">&amp;</span><span class="ident" id="5684635">ast</span><span class="op" id="5684638">.</span><span class="ident" id="5684639">BadExpr</span><span class="op" id="5684646">{</span><span class="ident" id="5684647">From</span><span class="op" id="5684651">:</span>&nbsp;<span class="ident" id="5684653">pos</span><span class="op" id="5684656">,</span>&nbsp;<span class="ident" id="5684658">To</span><span class="op" id="5684660">:</span>&nbsp;<span class="ident" id="5684662">p</span><span class="op" id="5684663">.</span><span class="ident" id="5684664">pos</span><span class="op" id="5684667">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684673">return</span>&nbsp;<span class="ident" id="5684680">typ</span><br>
<span class="lineno"></span><span class="op" id="5684684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5684687">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="5684752">func</span>&nbsp;<span class="op" id="5684757">(</span><span class="ident" id="5684758">p</span>&nbsp;<span class="op" id="5684760">*</span><span class="ident" id="5684761">parser</span><span class="op" id="5684767">)</span>&nbsp;<span class="ident" id="5684769">parseVarList</span><span class="op" id="5684781">(</span><span class="ident" id="5684782">isParam</span>&nbsp;<span class="builtintype" id="5684790">bool</span><span class="op" id="5684794">)</span>&nbsp;<span class="op" id="5684796">(</span><span class="ident" id="5684797">list</span>&nbsp;<span class="op" id="5684802">[</span><span class="op" id="5684803">]</span><span class="ident" id="5684804">ast</span><span class="op" id="5684807">.</span><span class="ident" id="5684808">Expr</span><span class="op" id="5684812">,</span>&nbsp;<span class="ident" id="5684814">typ</span>&nbsp;<span class="ident" id="5684818">ast</span><span class="op" id="5684821">.</span><span class="ident" id="5684822">Expr</span><span class="op" id="5684826">)</span>&nbsp;<span class="op" id="5684828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684831">if</span>&nbsp;<span class="ident" id="5684834">p</span><span class="op" id="5684835">.</span><span class="ident" id="5684836">trace</span>&nbsp;<span class="op" id="5684842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5684846">defer</span>&nbsp;<span class="ident" id="5684852">un</span><span class="op" id="5684854">(</span><span class="ident" id="5684855">trace</span><span class="op" id="5684860">(</span><span class="ident" id="5684861">p</span><span class="op" id="5684862">,</span>&nbsp;<span class="string" id="5684864">&#34;VarList&#34;</span><span class="op" id="5684873">)</span><span class="op" id="5684874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5684877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684881">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684939">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5684943">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685006">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685069">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685132">for</span>&nbsp;<span class="ident" id="5685136">typ</span>&nbsp;<span class="op" id="5685140">:=</span>&nbsp;<span class="ident" id="5685143">p</span><span class="op" id="5685144">.</span><span class="ident" id="5685145">parseVarType</span><span class="op" id="5685157">(</span><span class="ident" id="5685158">isParam</span><span class="op" id="5685165">)</span><span class="op" id="5685166">;</span>&nbsp;<span class="ident" id="5685168">typ</span>&nbsp;<span class="op" id="5685172">!=</span>&nbsp;<span class="ident" id="5685175">nil</span><span class="op" id="5685178">;</span>&nbsp;<span class="op" id="5685180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685184">list</span>&nbsp;<span class="op" id="5685189">=</span>&nbsp;<span class="builtinfunc" id="5685191">append</span><span class="op" id="5685197">(</span><span class="ident" id="5685198">list</span><span class="op" id="5685202">,</span>&nbsp;<span class="ident" id="5685204">typ</span><span class="op" id="5685207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685211">if</span>&nbsp;<span class="ident" id="5685214">p</span><span class="op" id="5685215">.</span><span class="ident" id="5685216">tok</span>&nbsp;<span class="op" id="5685220">!=</span>&nbsp;<span class="ident" id="5685223">token</span><span class="op" id="5685228">.</span><span class="ident" id="5685229">COMMA</span>&nbsp;<span class="op" id="5685235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685240">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685248">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685252">p</span><span class="op" id="5685253">.</span><span class="ident" id="5685254">next</span><span class="op" id="5685258">(</span><span class="op" id="5685259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685263">typ</span>&nbsp;<span class="op" id="5685267">=</span>&nbsp;<span class="ident" id="5685269">p</span><span class="op" id="5685270">.</span><span class="ident" id="5685271">tryVarType</span><span class="op" id="5685281">(</span><span class="ident" id="5685282">isParam</span><span class="op" id="5685289">)</span>&nbsp;<span class="comment" id="5685291">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685332">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685399">typ</span>&nbsp;<span class="op" id="5685403">=</span>&nbsp;<span class="ident" id="5685405">p</span><span class="op" id="5685406">.</span><span class="ident" id="5685407">tryVarType</span><span class="op" id="5685417">(</span><span class="ident" id="5685418">isParam</span><span class="op" id="5685425">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685429">return</span><br>
<span class="lineno"></span><span class="op" id="5685436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5685439">func</span>&nbsp;<span class="op" id="5685444">(</span><span class="ident" id="5685445">p</span>&nbsp;<span class="op" id="5685447">*</span><span class="ident" id="5685448">parser</span><span class="op" id="5685454">)</span>&nbsp;<span class="ident" id="5685456">parseParameterList</span><span class="op" id="5685474">(</span><span class="ident" id="5685475">scope</span>&nbsp;<span class="op" id="5685481">*</span><span class="ident" id="5685482">ast</span><span class="op" id="5685485">.</span><span class="ident" id="5685486">Scope</span><span class="op" id="5685491">,</span>&nbsp;<span class="ident" id="5685493">ellipsisOk</span>&nbsp;<span class="builtintype" id="5685504">bool</span><span class="op" id="5685508">)</span>&nbsp;<span class="op" id="5685510">(</span><span class="ident" id="5685511">params</span>&nbsp;<span class="op" id="5685518">[</span><span class="op" id="5685519">]</span><span class="op" id="5685520">*</span><span class="ident" id="5685521">ast</span><span class="op" id="5685524">.</span><span class="ident" id="5685525">Field</span><span class="op" id="5685530">)</span>&nbsp;<span class="op" id="5685532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685535">if</span>&nbsp;<span class="ident" id="5685538">p</span><span class="op" id="5685539">.</span><span class="ident" id="5685540">trace</span>&nbsp;<span class="op" id="5685546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685550">defer</span>&nbsp;<span class="ident" id="5685556">un</span><span class="op" id="5685558">(</span><span class="ident" id="5685559">trace</span><span class="op" id="5685564">(</span><span class="ident" id="5685565">p</span><span class="op" id="5685566">,</span>&nbsp;<span class="string" id="5685568">&#34;ParameterList&#34;</span><span class="op" id="5685583">)</span><span class="op" id="5685584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5685587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685591">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685609">list</span><span class="op" id="5685613">,</span>&nbsp;<span class="ident" id="5685615">typ</span>&nbsp;<span class="op" id="5685619">:=</span>&nbsp;<span class="ident" id="5685622">p</span><span class="op" id="5685623">.</span><span class="ident" id="5685624">parseVarList</span><span class="op" id="5685636">(</span><span class="ident" id="5685637">ellipsisOk</span><span class="op" id="5685647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685651">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5685668">if</span>&nbsp;<span class="ident" id="5685671">typ</span>&nbsp;<span class="op" id="5685675">!=</span>&nbsp;<span class="ident" id="5685678">nil</span>&nbsp;<span class="op" id="5685682">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685686">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685711">idents</span>&nbsp;<span class="op" id="5685718">:=</span>&nbsp;<span class="ident" id="5685721">p</span><span class="op" id="5685722">.</span><span class="ident" id="5685723">makeIdentList</span><span class="op" id="5685736">(</span><span class="ident" id="5685737">list</span><span class="op" id="5685741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685745">field</span>&nbsp;<span class="op" id="5685751">:=</span>&nbsp;<span class="op" id="5685754">&amp;</span><span class="ident" id="5685755">ast</span><span class="op" id="5685758">.</span><span class="ident" id="5685759">Field</span><span class="op" id="5685764">{</span><span class="ident" id="5685765">Names</span><span class="op" id="5685770">:</span>&nbsp;<span class="ident" id="5685772">idents</span><span class="op" id="5685778">,</span>&nbsp;<span class="ident" id="5685780">Type</span><span class="op" id="5685784">:</span>&nbsp;<span class="ident" id="5685786">typ</span><span class="op" id="5685789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685793">params</span>&nbsp;<span class="op" id="5685800">=</span>&nbsp;<span class="builtinfunc" id="5685802">append</span><span class="op" id="5685808">(</span><span class="ident" id="5685809">params</span><span class="op" id="5685815">,</span>&nbsp;<span class="ident" id="5685817">field</span><span class="op" id="5685822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685826">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5685887">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685943">p</span><span class="op" id="5685944">.</span><span class="ident" id="5685945">declare</span><span class="op" id="5685952">(</span><span class="ident" id="5685953">field</span><span class="op" id="5685958">,</span>&nbsp;<span class="ident" id="5685960">nil</span><span class="op" id="5685963">,</span>&nbsp;<span class="ident" id="5685965">scope</span><span class="op" id="5685970">,</span>&nbsp;<span class="ident" id="5685972">ast</span><span class="op" id="5685975">.</span><span class="ident" id="5685976">Var</span><span class="op" id="5685979">,</span>&nbsp;<span class="ident" id="5685981">idents</span><span class="op" id="5685987">...</span><span class="op" id="5685990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5685994">p</span><span class="op" id="5685995">.</span><span class="ident" id="5685996">resolve</span><span class="op" id="5686003">(</span><span class="ident" id="5686004">typ</span><span class="op" id="5686007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686011">if</span>&nbsp;<span class="op" id="5686014">!</span><span class="ident" id="5686015">p</span><span class="op" id="5686016">.</span><span class="ident" id="5686017">atComma</span><span class="op" id="5686024">(</span><span class="string" id="5686025">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5686041">)</span>&nbsp;<span class="op" id="5686043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686048">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686061">p</span><span class="op" id="5686062">.</span><span class="ident" id="5686063">next</span><span class="op" id="5686067">(</span><span class="op" id="5686068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686072">for</span>&nbsp;<span class="ident" id="5686076">p</span><span class="op" id="5686077">.</span><span class="ident" id="5686078">tok</span>&nbsp;<span class="op" id="5686082">!=</span>&nbsp;<span class="ident" id="5686085">token</span><span class="op" id="5686090">.</span><span class="ident" id="5686091">RPAREN</span>&nbsp;<span class="op" id="5686098">&amp;&amp;</span>&nbsp;<span class="ident" id="5686101">p</span><span class="op" id="5686102">.</span><span class="ident" id="5686103">tok</span>&nbsp;<span class="op" id="5686107">!=</span>&nbsp;<span class="ident" id="5686110">token</span><span class="op" id="5686115">.</span><span class="ident" id="5686116">EOF</span>&nbsp;<span class="op" id="5686120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686125">idents</span>&nbsp;<span class="op" id="5686132">:=</span>&nbsp;<span class="ident" id="5686135">p</span><span class="op" id="5686136">.</span><span class="ident" id="5686137">parseIdentList</span><span class="op" id="5686151">(</span><span class="op" id="5686152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686157">typ</span>&nbsp;<span class="op" id="5686161">:=</span>&nbsp;<span class="ident" id="5686164">p</span><span class="op" id="5686165">.</span><span class="ident" id="5686166">parseVarType</span><span class="op" id="5686178">(</span><span class="ident" id="5686179">ellipsisOk</span><span class="op" id="5686189">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686194">field</span>&nbsp;<span class="op" id="5686200">:=</span>&nbsp;<span class="op" id="5686203">&amp;</span><span class="ident" id="5686204">ast</span><span class="op" id="5686207">.</span><span class="ident" id="5686208">Field</span><span class="op" id="5686213">{</span><span class="ident" id="5686214">Names</span><span class="op" id="5686219">:</span>&nbsp;<span class="ident" id="5686221">idents</span><span class="op" id="5686227">,</span>&nbsp;<span class="ident" id="5686229">Type</span><span class="op" id="5686233">:</span>&nbsp;<span class="ident" id="5686235">typ</span><span class="op" id="5686238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686243">params</span>&nbsp;<span class="op" id="5686250">=</span>&nbsp;<span class="builtinfunc" id="5686252">append</span><span class="op" id="5686258">(</span><span class="ident" id="5686259">params</span><span class="op" id="5686265">,</span>&nbsp;<span class="ident" id="5686267">field</span><span class="op" id="5686272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686277">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686339">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686396">p</span><span class="op" id="5686397">.</span><span class="ident" id="5686398">declare</span><span class="op" id="5686405">(</span><span class="ident" id="5686406">field</span><span class="op" id="5686411">,</span>&nbsp;<span class="ident" id="5686413">nil</span><span class="op" id="5686416">,</span>&nbsp;<span class="ident" id="5686418">scope</span><span class="op" id="5686423">,</span>&nbsp;<span class="ident" id="5686425">ast</span><span class="op" id="5686428">.</span><span class="ident" id="5686429">Var</span><span class="op" id="5686432">,</span>&nbsp;<span class="ident" id="5686434">idents</span><span class="op" id="5686440">...</span><span class="op" id="5686443">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686448">p</span><span class="op" id="5686449">.</span><span class="ident" id="5686450">resolve</span><span class="op" id="5686457">(</span><span class="ident" id="5686458">typ</span><span class="op" id="5686461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686466">if</span>&nbsp;<span class="op" id="5686469">!</span><span class="ident" id="5686470">p</span><span class="op" id="5686471">.</span><span class="ident" id="5686472">atComma</span><span class="op" id="5686479">(</span><span class="string" id="5686480">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5686496">)</span>&nbsp;<span class="op" id="5686498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686504">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686518">p</span><span class="op" id="5686519">.</span><span class="ident" id="5686520">next</span><span class="op" id="5686524">(</span><span class="op" id="5686525">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686533">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5686545">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686590">params</span>&nbsp;<span class="op" id="5686597">=</span>&nbsp;<span class="builtinfunc" id="5686599">make</span><span class="op" id="5686603">(</span><span class="op" id="5686604">[</span><span class="op" id="5686605">]</span><span class="op" id="5686606">*</span><span class="ident" id="5686607">ast</span><span class="op" id="5686610">.</span><span class="ident" id="5686611">Field</span><span class="op" id="5686616">,</span>&nbsp;<span class="builtinfunc" id="5686618">len</span><span class="op" id="5686621">(</span><span class="ident" id="5686622">list</span><span class="op" id="5686626">)</span><span class="op" id="5686627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686630">for</span>&nbsp;<span class="ident" id="5686634">i</span><span class="op" id="5686635">,</span>&nbsp;<span class="ident" id="5686637">typ</span>&nbsp;<span class="op" id="5686641">:=</span>&nbsp;<span class="keyword" id="5686644">range</span>&nbsp;<span class="ident" id="5686650">list</span>&nbsp;<span class="op" id="5686655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686659">p</span><span class="op" id="5686660">.</span><span class="ident" id="5686661">resolve</span><span class="op" id="5686668">(</span><span class="ident" id="5686669">typ</span><span class="op" id="5686672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686676">params</span><span class="op" id="5686682">[</span><span class="ident" id="5686683">i</span><span class="op" id="5686684">]</span>&nbsp;<span class="op" id="5686686">=</span>&nbsp;<span class="op" id="5686688">&amp;</span><span class="ident" id="5686689">ast</span><span class="op" id="5686692">.</span><span class="ident" id="5686693">Field</span><span class="op" id="5686698">{</span><span class="ident" id="5686699">Type</span><span class="op" id="5686703">:</span>&nbsp;<span class="ident" id="5686705">typ</span><span class="op" id="5686708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686711">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686714">return</span><br>
<span class="lineno"></span><span class="op" id="5686721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5686724">func</span>&nbsp;<span class="op" id="5686729">(</span><span class="ident" id="5686730">p</span>&nbsp;<span class="op" id="5686732">*</span><span class="ident" id="5686733">parser</span><span class="op" id="5686739">)</span>&nbsp;<span class="ident" id="5686741">parseParameters</span><span class="op" id="5686756">(</span><span class="ident" id="5686757">scope</span>&nbsp;<span class="op" id="5686763">*</span><span class="ident" id="5686764">ast</span><span class="op" id="5686767">.</span><span class="ident" id="5686768">Scope</span><span class="op" id="5686773">,</span>&nbsp;<span class="ident" id="5686775">ellipsisOk</span>&nbsp;<span class="builtintype" id="5686786">bool</span><span class="op" id="5686790">)</span>&nbsp;<span class="op" id="5686792">*</span><span class="ident" id="5686793">ast</span><span class="op" id="5686796">.</span><span class="ident" id="5686797">FieldList</span>&nbsp;<span class="op" id="5686807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686810">if</span>&nbsp;<span class="ident" id="5686813">p</span><span class="op" id="5686814">.</span><span class="ident" id="5686815">trace</span>&nbsp;<span class="op" id="5686821">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686825">defer</span>&nbsp;<span class="ident" id="5686831">un</span><span class="op" id="5686833">(</span><span class="ident" id="5686834">trace</span><span class="op" id="5686839">(</span><span class="ident" id="5686840">p</span><span class="op" id="5686841">,</span>&nbsp;<span class="string" id="5686843">&#34;Parameters&#34;</span><span class="op" id="5686855">)</span><span class="op" id="5686856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5686859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686863">var</span>&nbsp;<span class="ident" id="5686867">params</span>&nbsp;<span class="op" id="5686874">[</span><span class="op" id="5686875">]</span><span class="op" id="5686876">*</span><span class="ident" id="5686877">ast</span><span class="op" id="5686880">.</span><span class="ident" id="5686881">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686888">lparen</span>&nbsp;<span class="op" id="5686895">:=</span>&nbsp;<span class="ident" id="5686898">p</span><span class="op" id="5686899">.</span><span class="ident" id="5686900">expect</span><span class="op" id="5686906">(</span><span class="ident" id="5686907">token</span><span class="op" id="5686912">.</span><span class="ident" id="5686913">LPAREN</span><span class="op" id="5686919">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5686922">if</span>&nbsp;<span class="ident" id="5686925">p</span><span class="op" id="5686926">.</span><span class="ident" id="5686927">tok</span>&nbsp;<span class="op" id="5686931">!=</span>&nbsp;<span class="ident" id="5686934">token</span><span class="op" id="5686939">.</span><span class="ident" id="5686940">RPAREN</span>&nbsp;<span class="op" id="5686947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5686951">params</span>&nbsp;<span class="op" id="5686958">=</span>&nbsp;<span class="ident" id="5686960">p</span><span class="op" id="5686961">.</span><span class="ident" id="5686962">parseParameterList</span><span class="op" id="5686980">(</span><span class="ident" id="5686981">scope</span><span class="op" id="5686986">,</span>&nbsp;<span class="ident" id="5686988">ellipsisOk</span><span class="op" id="5686998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687004">rparen</span>&nbsp;<span class="op" id="5687011">:=</span>&nbsp;<span class="ident" id="5687014">p</span><span class="op" id="5687015">.</span><span class="ident" id="5687016">expect</span><span class="op" id="5687022">(</span><span class="ident" id="5687023">token</span><span class="op" id="5687028">.</span><span class="ident" id="5687029">RPAREN</span><span class="op" id="5687035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687039">return</span>&nbsp;<span class="op" id="5687046">&amp;</span><span class="ident" id="5687047">ast</span><span class="op" id="5687050">.</span><span class="ident" id="5687051">FieldList</span><span class="op" id="5687060">{</span><span class="ident" id="5687061">Opening</span><span class="op" id="5687068">:</span>&nbsp;<span class="ident" id="5687070">lparen</span><span class="op" id="5687076">,</span>&nbsp;<span class="ident" id="5687078">List</span><span class="op" id="5687082">:</span>&nbsp;<span class="ident" id="5687084">params</span><span class="op" id="5687090">,</span>&nbsp;<span class="ident" id="5687092">Closing</span><span class="op" id="5687099">:</span>&nbsp;<span class="ident" id="5687101">rparen</span><span class="op" id="5687107">}</span><br>
<span class="lineno"></span><span class="op" id="5687109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5687112">func</span>&nbsp;<span class="op" id="5687117">(</span><span class="ident" id="5687118">p</span>&nbsp;<span class="op" id="5687120">*</span><span class="ident" id="5687121">parser</span><span class="op" id="5687127">)</span>&nbsp;<span class="ident" id="5687129">parseResult</span><span class="op" id="5687140">(</span><span class="ident" id="5687141">scope</span>&nbsp;<span class="op" id="5687147">*</span><span class="ident" id="5687148">ast</span><span class="op" id="5687151">.</span><span class="ident" id="5687152">Scope</span><span class="op" id="5687157">)</span>&nbsp;<span class="op" id="5687159">*</span><span class="ident" id="5687160">ast</span><span class="op" id="5687163">.</span><span class="ident" id="5687164">FieldList</span>&nbsp;<span class="op" id="5687174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687177">if</span>&nbsp;<span class="ident" id="5687180">p</span><span class="op" id="5687181">.</span><span class="ident" id="5687182">trace</span>&nbsp;<span class="op" id="5687188">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687192">defer</span>&nbsp;<span class="ident" id="5687198">un</span><span class="op" id="5687200">(</span><span class="ident" id="5687201">trace</span><span class="op" id="5687206">(</span><span class="ident" id="5687207">p</span><span class="op" id="5687208">,</span>&nbsp;<span class="string" id="5687210">&#34;Result&#34;</span><span class="op" id="5687218">)</span><span class="op" id="5687219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687226">if</span>&nbsp;<span class="ident" id="5687229">p</span><span class="op" id="5687230">.</span><span class="ident" id="5687231">tok</span>&nbsp;<span class="op" id="5687235">==</span>&nbsp;<span class="ident" id="5687238">token</span><span class="op" id="5687243">.</span><span class="ident" id="5687244">LPAREN</span>&nbsp;<span class="op" id="5687251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687255">return</span>&nbsp;<span class="ident" id="5687262">p</span><span class="op" id="5687263">.</span><span class="ident" id="5687264">parseParameters</span><span class="op" id="5687279">(</span><span class="ident" id="5687280">scope</span><span class="op" id="5687285">,</span>&nbsp;<span class="builtintype" id="5687287">false</span><span class="op" id="5687292">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687299">typ</span>&nbsp;<span class="op" id="5687303">:=</span>&nbsp;<span class="ident" id="5687306">p</span><span class="op" id="5687307">.</span><span class="ident" id="5687308">tryType</span><span class="op" id="5687315">(</span><span class="op" id="5687316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687319">if</span>&nbsp;<span class="ident" id="5687322">typ</span>&nbsp;<span class="op" id="5687326">!=</span>&nbsp;<span class="ident" id="5687329">nil</span>&nbsp;<span class="op" id="5687333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687337">list</span>&nbsp;<span class="op" id="5687342">:=</span>&nbsp;<span class="builtinfunc" id="5687345">make</span><span class="op" id="5687349">(</span><span class="op" id="5687350">[</span><span class="op" id="5687351">]</span><span class="op" id="5687352">*</span><span class="ident" id="5687353">ast</span><span class="op" id="5687356">.</span><span class="ident" id="5687357">Field</span><span class="op" id="5687362">,</span>&nbsp;<span class="num" id="5687364">1</span><span class="op" id="5687365">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687369">list</span><span class="op" id="5687373">[</span><span class="num" id="5687374">0</span><span class="op" id="5687375">]</span>&nbsp;<span class="op" id="5687377">=</span>&nbsp;<span class="op" id="5687379">&amp;</span><span class="ident" id="5687380">ast</span><span class="op" id="5687383">.</span><span class="ident" id="5687384">Field</span><span class="op" id="5687389">{</span><span class="ident" id="5687390">Type</span><span class="op" id="5687394">:</span>&nbsp;<span class="ident" id="5687396">typ</span><span class="op" id="5687399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687403">return</span>&nbsp;<span class="op" id="5687410">&amp;</span><span class="ident" id="5687411">ast</span><span class="op" id="5687414">.</span><span class="ident" id="5687415">FieldList</span><span class="op" id="5687424">{</span><span class="ident" id="5687425">List</span><span class="op" id="5687429">:</span>&nbsp;<span class="ident" id="5687431">list</span><span class="op" id="5687435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687442">return</span>&nbsp;<span class="ident" id="5687449">nil</span><br>
<span class="lineno">890</span><span class="op" id="5687453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5687456">func</span>&nbsp;<span class="op" id="5687461">(</span><span class="ident" id="5687462">p</span>&nbsp;<span class="op" id="5687464">*</span><span class="ident" id="5687465">parser</span><span class="op" id="5687471">)</span>&nbsp;<span class="ident" id="5687473">parseSignature</span><span class="op" id="5687487">(</span><span class="ident" id="5687488">scope</span>&nbsp;<span class="op" id="5687494">*</span><span class="ident" id="5687495">ast</span><span class="op" id="5687498">.</span><span class="ident" id="5687499">Scope</span><span class="op" id="5687504">)</span>&nbsp;<span class="op" id="5687506">(</span><span class="ident" id="5687507">params</span><span class="op" id="5687513">,</span>&nbsp;<span class="ident" id="5687515">results</span>&nbsp;<span class="op" id="5687523">*</span><span class="ident" id="5687524">ast</span><span class="op" id="5687527">.</span><span class="ident" id="5687528">FieldList</span><span class="op" id="5687537">)</span>&nbsp;<span class="op" id="5687539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687542">if</span>&nbsp;<span class="ident" id="5687545">p</span><span class="op" id="5687546">.</span><span class="ident" id="5687547">trace</span>&nbsp;<span class="op" id="5687553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687557">defer</span>&nbsp;<span class="ident" id="5687563">un</span><span class="op" id="5687565">(</span><span class="ident" id="5687566">trace</span><span class="op" id="5687571">(</span><span class="ident" id="5687572">p</span><span class="op" id="5687573">,</span>&nbsp;<span class="string" id="5687575">&#34;Signature&#34;</span><span class="op" id="5687586">)</span><span class="op" id="5687587">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687594">params</span>&nbsp;<span class="op" id="5687601">=</span>&nbsp;<span class="ident" id="5687603">p</span><span class="op" id="5687604">.</span><span class="ident" id="5687605">parseParameters</span><span class="op" id="5687620">(</span><span class="ident" id="5687621">scope</span><span class="op" id="5687626">,</span>&nbsp;<span class="builtintype" id="5687628">true</span><span class="op" id="5687632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687635">results</span>&nbsp;<span class="op" id="5687643">=</span>&nbsp;<span class="ident" id="5687645">p</span><span class="op" id="5687646">.</span><span class="ident" id="5687647">parseResult</span><span class="op" id="5687658">(</span><span class="ident" id="5687659">scope</span><span class="op" id="5687664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687668">return</span><br>
<span class="lineno"></span><span class="op" id="5687675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5687678">func</span>&nbsp;<span class="op" id="5687683">(</span><span class="ident" id="5687684">p</span>&nbsp;<span class="op" id="5687686">*</span><span class="ident" id="5687687">parser</span><span class="op" id="5687693">)</span>&nbsp;<span class="ident" id="5687695">parseFuncType</span><span class="op" id="5687708">(</span><span class="op" id="5687709">)</span>&nbsp;<span class="op" id="5687711">(</span><span class="op" id="5687712">*</span><span class="ident" id="5687713">ast</span><span class="op" id="5687716">.</span><span class="ident" id="5687717">FuncType</span><span class="op" id="5687725">,</span>&nbsp;<span class="op" id="5687727">*</span><span class="ident" id="5687728">ast</span><span class="op" id="5687731">.</span><span class="ident" id="5687732">Scope</span><span class="op" id="5687737">)</span>&nbsp;<span class="op" id="5687739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687742">if</span>&nbsp;<span class="ident" id="5687745">p</span><span class="op" id="5687746">.</span><span class="ident" id="5687747">trace</span>&nbsp;<span class="op" id="5687753">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687757">defer</span>&nbsp;<span class="ident" id="5687763">un</span><span class="op" id="5687765">(</span><span class="ident" id="5687766">trace</span><span class="op" id="5687771">(</span><span class="ident" id="5687772">p</span><span class="op" id="5687773">,</span>&nbsp;<span class="string" id="5687775">&#34;FuncType&#34;</span><span class="op" id="5687785">)</span><span class="op" id="5687786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5687789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687793">pos</span>&nbsp;<span class="op" id="5687797">:=</span>&nbsp;<span class="ident" id="5687800">p</span><span class="op" id="5687801">.</span><span class="ident" id="5687802">expect</span><span class="op" id="5687808">(</span><span class="ident" id="5687809">token</span><span class="op" id="5687814">.</span><span class="ident" id="5687815">FUNC</span><span class="op" id="5687819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687822">scope</span>&nbsp;<span class="op" id="5687828">:=</span>&nbsp;<span class="ident" id="5687831">ast</span><span class="op" id="5687834">.</span><span class="ident" id="5687835">NewScope</span><span class="op" id="5687843">(</span><span class="ident" id="5687844">p</span><span class="op" id="5687845">.</span><span class="ident" id="5687846">topScope</span><span class="op" id="5687854">)</span>&nbsp;<span class="comment" id="5687856">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5687875">params</span><span class="op" id="5687881">,</span>&nbsp;<span class="ident" id="5687883">results</span>&nbsp;<span class="op" id="5687891">:=</span>&nbsp;<span class="ident" id="5687894">p</span><span class="op" id="5687895">.</span><span class="ident" id="5687896">parseSignature</span><span class="op" id="5687910">(</span><span class="ident" id="5687911">scope</span><span class="op" id="5687916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5687920">return</span>&nbsp;<span class="op" id="5687927">&amp;</span><span class="ident" id="5687928">ast</span><span class="op" id="5687931">.</span><span class="ident" id="5687932">FuncType</span><span class="op" id="5687940">{</span><span class="ident" id="5687941">Func</span><span class="op" id="5687945">:</span>&nbsp;<span class="ident" id="5687947">pos</span><span class="op" id="5687950">,</span>&nbsp;<span class="ident" id="5687952">Params</span><span class="op" id="5687958">:</span>&nbsp;<span class="ident" id="5687960">params</span><span class="op" id="5687966">,</span>&nbsp;<span class="ident" id="5687968">Results</span><span class="op" id="5687975">:</span>&nbsp;<span class="ident" id="5687977">results</span><span class="op" id="5687984">}</span><span class="op" id="5687985">,</span>&nbsp;<span class="ident" id="5687987">scope</span><br>
<span class="lineno"></span><span class="op" id="5687993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="5687996">func</span>&nbsp;<span class="op" id="5688001">(</span><span class="ident" id="5688002">p</span>&nbsp;<span class="op" id="5688004">*</span><span class="ident" id="5688005">parser</span><span class="op" id="5688011">)</span>&nbsp;<span class="ident" id="5688013">parseMethodSpec</span><span class="op" id="5688028">(</span><span class="ident" id="5688029">scope</span>&nbsp;<span class="op" id="5688035">*</span><span class="ident" id="5688036">ast</span><span class="op" id="5688039">.</span><span class="ident" id="5688040">Scope</span><span class="op" id="5688045">)</span>&nbsp;<span class="op" id="5688047">*</span><span class="ident" id="5688048">ast</span><span class="op" id="5688051">.</span><span class="ident" id="5688052">Field</span>&nbsp;<span class="op" id="5688058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688061">if</span>&nbsp;<span class="ident" id="5688064">p</span><span class="op" id="5688065">.</span><span class="ident" id="5688066">trace</span>&nbsp;<span class="op" id="5688072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688076">defer</span>&nbsp;<span class="ident" id="5688082">un</span><span class="op" id="5688084">(</span><span class="ident" id="5688085">trace</span><span class="op" id="5688090">(</span><span class="ident" id="5688091">p</span><span class="op" id="5688092">,</span>&nbsp;<span class="string" id="5688094">&#34;MethodSpec&#34;</span><span class="op" id="5688106">)</span><span class="op" id="5688107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688114">doc</span>&nbsp;<span class="op" id="5688118">:=</span>&nbsp;<span class="ident" id="5688121">p</span><span class="op" id="5688122">.</span><span class="ident" id="5688123">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688136">var</span>&nbsp;<span class="ident" id="5688140">idents</span>&nbsp;<span class="op" id="5688147">[</span><span class="op" id="5688148">]</span><span class="op" id="5688149">*</span><span class="ident" id="5688150">ast</span><span class="op" id="5688153">.</span><span class="ident" id="5688154">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688161">var</span>&nbsp;<span class="ident" id="5688165">typ</span>&nbsp;<span class="ident" id="5688169">ast</span><span class="op" id="5688172">.</span><span class="ident" id="5688173">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688179">x</span>&nbsp;<span class="op" id="5688181">:=</span>&nbsp;<span class="ident" id="5688184">p</span><span class="op" id="5688185">.</span><span class="ident" id="5688186">parseTypeName</span><span class="op" id="5688199">(</span><span class="op" id="5688200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688203">if</span>&nbsp;<span class="ident" id="5688206">ident</span><span class="op" id="5688211">,</span>&nbsp;<span class="ident" id="5688213">isIdent</span>&nbsp;<span class="op" id="5688221">:=</span>&nbsp;<span class="ident" id="5688224">x</span><span class="op" id="5688225">.</span><span class="op" id="5688226">(</span><span class="op" id="5688227">*</span><span class="ident" id="5688228">ast</span><span class="op" id="5688231">.</span><span class="ident" id="5688232">Ident</span><span class="op" id="5688237">)</span><span class="op" id="5688238">;</span>&nbsp;<span class="ident" id="5688240">isIdent</span>&nbsp;<span class="op" id="5688248">&amp;&amp;</span>&nbsp;<span class="ident" id="5688251">p</span><span class="op" id="5688252">.</span><span class="ident" id="5688253">tok</span>&nbsp;<span class="op" id="5688257">==</span>&nbsp;<span class="ident" id="5688260">token</span><span class="op" id="5688265">.</span><span class="ident" id="5688266">LPAREN</span>&nbsp;<span class="op" id="5688273">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688277">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688289">idents</span>&nbsp;<span class="op" id="5688296">=</span>&nbsp;<span class="op" id="5688298">[</span><span class="op" id="5688299">]</span><span class="op" id="5688300">*</span><span class="ident" id="5688301">ast</span><span class="op" id="5688304">.</span><span class="ident" id="5688305">Ident</span><span class="op" id="5688310">{</span><span class="ident" id="5688311">ident</span><span class="op" id="5688316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688320">scope</span>&nbsp;<span class="op" id="5688326">:=</span>&nbsp;<span class="ident" id="5688329">ast</span><span class="op" id="5688332">.</span><span class="ident" id="5688333">NewScope</span><span class="op" id="5688341">(</span><span class="ident" id="5688342">nil</span><span class="op" id="5688345">)</span>&nbsp;<span class="comment" id="5688347">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688365">params</span><span class="op" id="5688371">,</span>&nbsp;<span class="ident" id="5688373">results</span>&nbsp;<span class="op" id="5688381">:=</span>&nbsp;<span class="ident" id="5688384">p</span><span class="op" id="5688385">.</span><span class="ident" id="5688386">parseSignature</span><span class="op" id="5688400">(</span><span class="ident" id="5688401">scope</span><span class="op" id="5688406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688410">typ</span>&nbsp;<span class="op" id="5688414">=</span>&nbsp;<span class="op" id="5688416">&amp;</span><span class="ident" id="5688417">ast</span><span class="op" id="5688420">.</span><span class="ident" id="5688421">FuncType</span><span class="op" id="5688429">{</span><span class="ident" id="5688430">Func</span><span class="op" id="5688434">:</span>&nbsp;<span class="ident" id="5688436">token</span><span class="op" id="5688441">.</span><span class="ident" id="5688442">NoPos</span><span class="op" id="5688447">,</span>&nbsp;<span class="ident" id="5688449">Params</span><span class="op" id="5688455">:</span>&nbsp;<span class="ident" id="5688457">params</span><span class="op" id="5688463">,</span>&nbsp;<span class="ident" id="5688465">Results</span><span class="op" id="5688472">:</span>&nbsp;<span class="ident" id="5688474">results</span><span class="op" id="5688481">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688484">}</span>&nbsp;<span class="keyword" id="5688486">else</span>&nbsp;<span class="op" id="5688491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5688495">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688519">typ</span>&nbsp;<span class="op" id="5688523">=</span>&nbsp;<span class="ident" id="5688525">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688529">p</span><span class="op" id="5688530">.</span><span class="ident" id="5688531">resolve</span><span class="op" id="5688538">(</span><span class="ident" id="5688539">typ</span><span class="op" id="5688542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688545">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688548">p</span><span class="op" id="5688549">.</span><span class="ident" id="5688550">expectSemi</span><span class="op" id="5688560">(</span><span class="op" id="5688561">)</span>&nbsp;<span class="comment" id="5688563">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688604">spec</span>&nbsp;<span class="op" id="5688609">:=</span>&nbsp;<span class="op" id="5688612">&amp;</span><span class="ident" id="5688613">ast</span><span class="op" id="5688616">.</span><span class="ident" id="5688617">Field</span><span class="op" id="5688622">{</span><span class="ident" id="5688623">Doc</span><span class="op" id="5688626">:</span>&nbsp;<span class="ident" id="5688628">doc</span><span class="op" id="5688631">,</span>&nbsp;<span class="ident" id="5688633">Names</span><span class="op" id="5688638">:</span>&nbsp;<span class="ident" id="5688640">idents</span><span class="op" id="5688646">,</span>&nbsp;<span class="ident" id="5688648">Type</span><span class="op" id="5688652">:</span>&nbsp;<span class="ident" id="5688654">typ</span><span class="op" id="5688657">,</span>&nbsp;<span class="ident" id="5688659">Comment</span><span class="op" id="5688666">:</span>&nbsp;<span class="ident" id="5688668">p</span><span class="op" id="5688669">.</span><span class="ident" id="5688670">lineComment</span><span class="op" id="5688681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688684">p</span><span class="op" id="5688685">.</span><span class="ident" id="5688686">declare</span><span class="op" id="5688693">(</span><span class="ident" id="5688694">spec</span><span class="op" id="5688698">,</span>&nbsp;<span class="ident" id="5688700">nil</span><span class="op" id="5688703">,</span>&nbsp;<span class="ident" id="5688705">scope</span><span class="op" id="5688710">,</span>&nbsp;<span class="ident" id="5688712">ast</span><span class="op" id="5688715">.</span><span class="ident" id="5688716">Fun</span><span class="op" id="5688719">,</span>&nbsp;<span class="ident" id="5688721">idents</span><span class="op" id="5688727">...</span><span class="op" id="5688730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688734">return</span>&nbsp;<span class="ident" id="5688741">spec</span><br>
<span class="lineno"></span><span class="op" id="5688746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5688749">func</span>&nbsp;<span class="op" id="5688754">(</span><span class="ident" id="5688755">p</span>&nbsp;<span class="op" id="5688757">*</span><span class="ident" id="5688758">parser</span><span class="op" id="5688764">)</span>&nbsp;<span class="ident" id="5688766">parseInterfaceType</span><span class="op" id="5688784">(</span><span class="op" id="5688785">)</span>&nbsp;<span class="op" id="5688787">*</span><span class="ident" id="5688788">ast</span><span class="op" id="5688791">.</span><span class="ident" id="5688792">InterfaceType</span>&nbsp;<span class="op" id="5688806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688809">if</span>&nbsp;<span class="ident" id="5688812">p</span><span class="op" id="5688813">.</span><span class="ident" id="5688814">trace</span>&nbsp;<span class="op" id="5688820">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688824">defer</span>&nbsp;<span class="ident" id="5688830">un</span><span class="op" id="5688832">(</span><span class="ident" id="5688833">trace</span><span class="op" id="5688838">(</span><span class="ident" id="5688839">p</span><span class="op" id="5688840">,</span>&nbsp;<span class="string" id="5688842">&#34;InterfaceType&#34;</span><span class="op" id="5688857">)</span><span class="op" id="5688858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5688861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688865">pos</span>&nbsp;<span class="op" id="5688869">:=</span>&nbsp;<span class="ident" id="5688872">p</span><span class="op" id="5688873">.</span><span class="ident" id="5688874">expect</span><span class="op" id="5688880">(</span><span class="ident" id="5688881">token</span><span class="op" id="5688886">.</span><span class="ident" id="5688887">INTERFACE</span><span class="op" id="5688896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688899">lbrace</span>&nbsp;<span class="op" id="5688906">:=</span>&nbsp;<span class="ident" id="5688909">p</span><span class="op" id="5688910">.</span><span class="ident" id="5688911">expect</span><span class="op" id="5688917">(</span><span class="ident" id="5688918">token</span><span class="op" id="5688923">.</span><span class="ident" id="5688924">LBRACE</span><span class="op" id="5688930">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5688933">scope</span>&nbsp;<span class="op" id="5688939">:=</span>&nbsp;<span class="ident" id="5688942">ast</span><span class="op" id="5688945">.</span><span class="ident" id="5688946">NewScope</span><span class="op" id="5688954">(</span><span class="ident" id="5688955">nil</span><span class="op" id="5688958">)</span>&nbsp;<span class="comment" id="5688960">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5688980">var</span>&nbsp;<span class="ident" id="5688984">list</span>&nbsp;<span class="op" id="5688989">[</span><span class="op" id="5688990">]</span><span class="op" id="5688991">*</span><span class="ident" id="5688992">ast</span><span class="op" id="5688995">.</span><span class="ident" id="5688996">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689003">for</span>&nbsp;<span class="ident" id="5689007">p</span><span class="op" id="5689008">.</span><span class="ident" id="5689009">tok</span>&nbsp;<span class="op" id="5689013">==</span>&nbsp;<span class="ident" id="5689016">token</span><span class="op" id="5689021">.</span><span class="ident" id="5689022">IDENT</span>&nbsp;<span class="op" id="5689028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689032">list</span>&nbsp;<span class="op" id="5689037">=</span>&nbsp;<span class="builtinfunc" id="5689039">append</span><span class="op" id="5689045">(</span><span class="ident" id="5689046">list</span><span class="op" id="5689050">,</span>&nbsp;<span class="ident" id="5689052">p</span><span class="op" id="5689053">.</span><span class="ident" id="5689054">parseMethodSpec</span><span class="op" id="5689069">(</span><span class="ident" id="5689070">scope</span><span class="op" id="5689075">)</span><span class="op" id="5689076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689079">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689082">rbrace</span>&nbsp;<span class="op" id="5689089">:=</span>&nbsp;<span class="ident" id="5689092">p</span><span class="op" id="5689093">.</span><span class="ident" id="5689094">expect</span><span class="op" id="5689100">(</span><span class="ident" id="5689101">token</span><span class="op" id="5689106">.</span><span class="ident" id="5689107">RBRACE</span><span class="op" id="5689113">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689117">return</span>&nbsp;<span class="op" id="5689124">&amp;</span><span class="ident" id="5689125">ast</span><span class="op" id="5689128">.</span><span class="ident" id="5689129">InterfaceType</span><span class="op" id="5689142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689146">Interface</span><span class="op" id="5689155">:</span>&nbsp;<span class="ident" id="5689157">pos</span><span class="op" id="5689160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689164">Methods</span><span class="op" id="5689171">:</span>&nbsp;<span class="op" id="5689173">&amp;</span><span class="ident" id="5689174">ast</span><span class="op" id="5689177">.</span><span class="ident" id="5689178">FieldList</span><span class="op" id="5689187">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689192">Opening</span><span class="op" id="5689199">:</span>&nbsp;<span class="ident" id="5689201">lbrace</span><span class="op" id="5689207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689212">List</span><span class="op" id="5689216">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5689221">list</span><span class="op" id="5689225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689230">Closing</span><span class="op" id="5689237">:</span>&nbsp;<span class="ident" id="5689239">rbrace</span><span class="op" id="5689245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689249">}</span><span class="op" id="5689250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689253">}</span><br>
<span class="lineno">965</span><span class="op" id="5689255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5689258">func</span>&nbsp;<span class="op" id="5689263">(</span><span class="ident" id="5689264">p</span>&nbsp;<span class="op" id="5689266">*</span><span class="ident" id="5689267">parser</span><span class="op" id="5689273">)</span>&nbsp;<span class="ident" id="5689275">parseMapType</span><span class="op" id="5689287">(</span><span class="op" id="5689288">)</span>&nbsp;<span class="op" id="5689290">*</span><span class="ident" id="5689291">ast</span><span class="op" id="5689294">.</span><span class="ident" id="5689295">MapType</span>&nbsp;<span class="op" id="5689303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689306">if</span>&nbsp;<span class="ident" id="5689309">p</span><span class="op" id="5689310">.</span><span class="ident" id="5689311">trace</span>&nbsp;<span class="op" id="5689317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689321">defer</span>&nbsp;<span class="ident" id="5689327">un</span><span class="op" id="5689329">(</span><span class="ident" id="5689330">trace</span><span class="op" id="5689335">(</span><span class="ident" id="5689336">p</span><span class="op" id="5689337">,</span>&nbsp;<span class="string" id="5689339">&#34;MapType&#34;</span><span class="op" id="5689348">)</span><span class="op" id="5689349">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689356">pos</span>&nbsp;<span class="op" id="5689360">:=</span>&nbsp;<span class="ident" id="5689363">p</span><span class="op" id="5689364">.</span><span class="ident" id="5689365">expect</span><span class="op" id="5689371">(</span><span class="ident" id="5689372">token</span><span class="op" id="5689377">.</span><span class="ident" id="5689378">MAP</span><span class="op" id="5689381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689384">p</span><span class="op" id="5689385">.</span><span class="ident" id="5689386">expect</span><span class="op" id="5689392">(</span><span class="ident" id="5689393">token</span><span class="op" id="5689398">.</span><span class="ident" id="5689399">LBRACK</span><span class="op" id="5689405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689408">key</span>&nbsp;<span class="op" id="5689412">:=</span>&nbsp;<span class="ident" id="5689415">p</span><span class="op" id="5689416">.</span><span class="ident" id="5689417">parseType</span><span class="op" id="5689426">(</span><span class="op" id="5689427">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689430">p</span><span class="op" id="5689431">.</span><span class="ident" id="5689432">expect</span><span class="op" id="5689438">(</span><span class="ident" id="5689439">token</span><span class="op" id="5689444">.</span><span class="ident" id="5689445">RBRACK</span><span class="op" id="5689451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689454">value</span>&nbsp;<span class="op" id="5689460">:=</span>&nbsp;<span class="ident" id="5689463">p</span><span class="op" id="5689464">.</span><span class="ident" id="5689465">parseType</span><span class="op" id="5689474">(</span><span class="op" id="5689475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689479">return</span>&nbsp;<span class="op" id="5689486">&amp;</span><span class="ident" id="5689487">ast</span><span class="op" id="5689490">.</span><span class="ident" id="5689491">MapType</span><span class="op" id="5689498">{</span><span class="ident" id="5689499">Map</span><span class="op" id="5689502">:</span>&nbsp;<span class="ident" id="5689504">pos</span><span class="op" id="5689507">,</span>&nbsp;<span class="ident" id="5689509">Key</span><span class="op" id="5689512">:</span>&nbsp;<span class="ident" id="5689514">key</span><span class="op" id="5689517">,</span>&nbsp;<span class="ident" id="5689519">Value</span><span class="op" id="5689524">:</span>&nbsp;<span class="ident" id="5689526">value</span><span class="op" id="5689531">}</span><br>
<span class="lineno"></span><span class="op" id="5689533">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="5689536">func</span>&nbsp;<span class="op" id="5689541">(</span><span class="ident" id="5689542">p</span>&nbsp;<span class="op" id="5689544">*</span><span class="ident" id="5689545">parser</span><span class="op" id="5689551">)</span>&nbsp;<span class="ident" id="5689553">parseChanType</span><span class="op" id="5689566">(</span><span class="op" id="5689567">)</span>&nbsp;<span class="op" id="5689569">*</span><span class="ident" id="5689570">ast</span><span class="op" id="5689573">.</span><span class="ident" id="5689574">ChanType</span>&nbsp;<span class="op" id="5689583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689586">if</span>&nbsp;<span class="ident" id="5689589">p</span><span class="op" id="5689590">.</span><span class="ident" id="5689591">trace</span>&nbsp;<span class="op" id="5689597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689601">defer</span>&nbsp;<span class="ident" id="5689607">un</span><span class="op" id="5689609">(</span><span class="ident" id="5689610">trace</span><span class="op" id="5689615">(</span><span class="ident" id="5689616">p</span><span class="op" id="5689617">,</span>&nbsp;<span class="string" id="5689619">&#34;ChanType&#34;</span><span class="op" id="5689629">)</span><span class="op" id="5689630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689633">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689637">pos</span>&nbsp;<span class="op" id="5689641">:=</span>&nbsp;<span class="ident" id="5689644">p</span><span class="op" id="5689645">.</span><span class="ident" id="5689646">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689651">dir</span>&nbsp;<span class="op" id="5689655">:=</span>&nbsp;<span class="ident" id="5689658">ast</span><span class="op" id="5689661">.</span><span class="ident" id="5689662">SEND</span>&nbsp;<span class="op" id="5689667">|</span>&nbsp;<span class="ident" id="5689669">ast</span><span class="op" id="5689672">.</span><span class="ident" id="5689673">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689679">var</span>&nbsp;<span class="ident" id="5689683">arrow</span>&nbsp;<span class="ident" id="5689689">token</span><span class="op" id="5689694">.</span><span class="ident" id="5689695">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689700">if</span>&nbsp;<span class="ident" id="5689703">p</span><span class="op" id="5689704">.</span><span class="ident" id="5689705">tok</span>&nbsp;<span class="op" id="5689709">==</span>&nbsp;<span class="ident" id="5689712">token</span><span class="op" id="5689717">.</span><span class="ident" id="5689718">CHAN</span>&nbsp;<span class="op" id="5689723">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689727">p</span><span class="op" id="5689728">.</span><span class="ident" id="5689729">next</span><span class="op" id="5689733">(</span><span class="op" id="5689734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689738">if</span>&nbsp;<span class="ident" id="5689741">p</span><span class="op" id="5689742">.</span><span class="ident" id="5689743">tok</span>&nbsp;<span class="op" id="5689747">==</span>&nbsp;<span class="ident" id="5689750">token</span><span class="op" id="5689755">.</span><span class="ident" id="5689756">ARROW</span>&nbsp;<span class="op" id="5689762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689767">arrow</span>&nbsp;<span class="op" id="5689773">=</span>&nbsp;<span class="ident" id="5689775">p</span><span class="op" id="5689776">.</span><span class="ident" id="5689777">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689784">p</span><span class="op" id="5689785">.</span><span class="ident" id="5689786">next</span><span class="op" id="5689790">(</span><span class="op" id="5689791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689796">dir</span>&nbsp;<span class="op" id="5689800">=</span>&nbsp;<span class="ident" id="5689802">ast</span><span class="op" id="5689805">.</span><span class="ident" id="5689806">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689816">}</span>&nbsp;<span class="keyword" id="5689818">else</span>&nbsp;<span class="op" id="5689823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689827">arrow</span>&nbsp;<span class="op" id="5689833">=</span>&nbsp;<span class="ident" id="5689835">p</span><span class="op" id="5689836">.</span><span class="ident" id="5689837">expect</span><span class="op" id="5689843">(</span><span class="ident" id="5689844">token</span><span class="op" id="5689849">.</span><span class="ident" id="5689850">ARROW</span><span class="op" id="5689855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689859">p</span><span class="op" id="5689860">.</span><span class="ident" id="5689861">expect</span><span class="op" id="5689867">(</span><span class="ident" id="5689868">token</span><span class="op" id="5689873">.</span><span class="ident" id="5689874">CHAN</span><span class="op" id="5689878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689882">dir</span>&nbsp;<span class="op" id="5689886">=</span>&nbsp;<span class="ident" id="5689888">ast</span><span class="op" id="5689891">.</span><span class="ident" id="5689892">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5689898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5689901">value</span>&nbsp;<span class="op" id="5689907">:=</span>&nbsp;<span class="ident" id="5689910">p</span><span class="op" id="5689911">.</span><span class="ident" id="5689912">parseType</span><span class="op" id="5689921">(</span><span class="op" id="5689922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5689926">return</span>&nbsp;<span class="op" id="5689933">&amp;</span><span class="ident" id="5689934">ast</span><span class="op" id="5689937">.</span><span class="ident" id="5689938">ChanType</span><span class="op" id="5689946">{</span><span class="ident" id="5689947">Begin</span><span class="op" id="5689952">:</span>&nbsp;<span class="ident" id="5689954">pos</span><span class="op" id="5689957">,</span>&nbsp;<span class="ident" id="5689959">Arrow</span><span class="op" id="5689964">:</span>&nbsp;<span class="ident" id="5689966">arrow</span><span class="op" id="5689971">,</span>&nbsp;<span class="ident" id="5689973">Dir</span><span class="op" id="5689976">:</span>&nbsp;<span class="ident" id="5689978">dir</span><span class="op" id="5689981">,</span>&nbsp;<span class="ident" id="5689983">Value</span><span class="op" id="5689988">:</span>&nbsp;<span class="ident" id="5689990">value</span><span class="op" id="5689995">}</span><br>
<span class="lineno"></span><span class="op" id="5689997">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5690000">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5690055">func</span>&nbsp;<span class="op" id="5690060">(</span><span class="ident" id="5690061">p</span>&nbsp;<span class="op" id="5690063">*</span><span class="ident" id="5690064">parser</span><span class="op" id="5690070">)</span>&nbsp;<span class="ident" id="5690072">tryIdentOrType</span><span class="op" id="5690086">(</span><span class="op" id="5690087">)</span>&nbsp;<span class="ident" id="5690089">ast</span><span class="op" id="5690092">.</span><span class="ident" id="5690093">Expr</span>&nbsp;<span class="op" id="5690098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690101">switch</span>&nbsp;<span class="ident" id="5690108">p</span><span class="op" id="5690109">.</span><span class="ident" id="5690110">tok</span>&nbsp;<span class="op" id="5690114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690117">case</span>&nbsp;<span class="ident" id="5690122">token</span><span class="op" id="5690127">.</span><span class="ident" id="5690128">IDENT</span><span class="op" id="5690133">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690137">return</span>&nbsp;<span class="ident" id="5690144">p</span><span class="op" id="5690145">.</span><span class="ident" id="5690146">parseTypeName</span><span class="op" id="5690159">(</span><span class="op" id="5690160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690163">case</span>&nbsp;<span class="ident" id="5690168">token</span><span class="op" id="5690173">.</span><span class="ident" id="5690174">LBRACK</span><span class="op" id="5690180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690184">return</span>&nbsp;<span class="ident" id="5690191">p</span><span class="op" id="5690192">.</span><span class="ident" id="5690193">parseArrayType</span><span class="op" id="5690207">(</span><span class="op" id="5690208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690211">case</span>&nbsp;<span class="ident" id="5690216">token</span><span class="op" id="5690221">.</span><span class="ident" id="5690222">STRUCT</span><span class="op" id="5690228">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690232">return</span>&nbsp;<span class="ident" id="5690239">p</span><span class="op" id="5690240">.</span><span class="ident" id="5690241">parseStructType</span><span class="op" id="5690256">(</span><span class="op" id="5690257">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690260">case</span>&nbsp;<span class="ident" id="5690265">token</span><span class="op" id="5690270">.</span><span class="ident" id="5690271">MUL</span><span class="op" id="5690274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690278">return</span>&nbsp;<span class="ident" id="5690285">p</span><span class="op" id="5690286">.</span><span class="ident" id="5690287">parsePointerType</span><span class="op" id="5690303">(</span><span class="op" id="5690304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690307">case</span>&nbsp;<span class="ident" id="5690312">token</span><span class="op" id="5690317">.</span><span class="ident" id="5690318">FUNC</span><span class="op" id="5690322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690326">typ</span><span class="op" id="5690329">,</span>&nbsp;<span class="ident" id="5690331">_</span>&nbsp;<span class="op" id="5690333">:=</span>&nbsp;<span class="ident" id="5690336">p</span><span class="op" id="5690337">.</span><span class="ident" id="5690338">parseFuncType</span><span class="op" id="5690351">(</span><span class="op" id="5690352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690356">return</span>&nbsp;<span class="ident" id="5690363">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690368">case</span>&nbsp;<span class="ident" id="5690373">token</span><span class="op" id="5690378">.</span><span class="ident" id="5690379">INTERFACE</span><span class="op" id="5690388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690392">return</span>&nbsp;<span class="ident" id="5690399">p</span><span class="op" id="5690400">.</span><span class="ident" id="5690401">parseInterfaceType</span><span class="op" id="5690419">(</span><span class="op" id="5690420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690423">case</span>&nbsp;<span class="ident" id="5690428">token</span><span class="op" id="5690433">.</span><span class="ident" id="5690434">MAP</span><span class="op" id="5690437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690441">return</span>&nbsp;<span class="ident" id="5690448">p</span><span class="op" id="5690449">.</span><span class="ident" id="5690450">parseMapType</span><span class="op" id="5690462">(</span><span class="op" id="5690463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690466">case</span>&nbsp;<span class="ident" id="5690471">token</span><span class="op" id="5690476">.</span><span class="ident" id="5690477">CHAN</span><span class="op" id="5690481">,</span>&nbsp;<span class="ident" id="5690483">token</span><span class="op" id="5690488">.</span><span class="ident" id="5690489">ARROW</span><span class="op" id="5690494">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690498">return</span>&nbsp;<span class="ident" id="5690505">p</span><span class="op" id="5690506">.</span><span class="ident" id="5690507">parseChanType</span><span class="op" id="5690520">(</span><span class="op" id="5690521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690524">case</span>&nbsp;<span class="ident" id="5690529">token</span><span class="op" id="5690534">.</span><span class="ident" id="5690535">LPAREN</span><span class="op" id="5690541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690545">lparen</span>&nbsp;<span class="op" id="5690552">:=</span>&nbsp;<span class="ident" id="5690555">p</span><span class="op" id="5690556">.</span><span class="ident" id="5690557">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690563">p</span><span class="op" id="5690564">.</span><span class="ident" id="5690565">next</span><span class="op" id="5690569">(</span><span class="op" id="5690570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690574">typ</span>&nbsp;<span class="op" id="5690578">:=</span>&nbsp;<span class="ident" id="5690581">p</span><span class="op" id="5690582">.</span><span class="ident" id="5690583">parseType</span><span class="op" id="5690592">(</span><span class="op" id="5690593">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690597">rparen</span>&nbsp;<span class="op" id="5690604">:=</span>&nbsp;<span class="ident" id="5690607">p</span><span class="op" id="5690608">.</span><span class="ident" id="5690609">expect</span><span class="op" id="5690615">(</span><span class="ident" id="5690616">token</span><span class="op" id="5690621">.</span><span class="ident" id="5690622">RPAREN</span><span class="op" id="5690628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690632">return</span>&nbsp;<span class="op" id="5690639">&amp;</span><span class="ident" id="5690640">ast</span><span class="op" id="5690643">.</span><span class="ident" id="5690644">ParenExpr</span><span class="op" id="5690653">{</span><span class="ident" id="5690654">Lparen</span><span class="op" id="5690660">:</span>&nbsp;<span class="ident" id="5690662">lparen</span><span class="op" id="5690668">,</span>&nbsp;<span class="ident" id="5690670">X</span><span class="op" id="5690671">:</span>&nbsp;<span class="ident" id="5690673">typ</span><span class="op" id="5690676">,</span>&nbsp;<span class="ident" id="5690678">Rparen</span><span class="op" id="5690684">:</span>&nbsp;<span class="ident" id="5690686">rparen</span><span class="op" id="5690692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5690699">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690717">return</span>&nbsp;<span class="ident" id="5690724">nil</span><br>
<span class="lineno"></span><span class="op" id="5690728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5690731">func</span>&nbsp;<span class="op" id="5690736">(</span><span class="ident" id="5690737">p</span>&nbsp;<span class="op" id="5690739">*</span><span class="ident" id="5690740">parser</span><span class="op" id="5690746">)</span>&nbsp;<span class="ident" id="5690748">tryType</span><span class="op" id="5690755">(</span><span class="op" id="5690756">)</span>&nbsp;<span class="ident" id="5690758">ast</span><span class="op" id="5690761">.</span><span class="ident" id="5690762">Expr</span>&nbsp;<span class="op" id="5690767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690770">typ</span>&nbsp;<span class="op" id="5690774">:=</span>&nbsp;<span class="ident" id="5690777">p</span><span class="op" id="5690778">.</span><span class="ident" id="5690779">tryIdentOrType</span><span class="op" id="5690793">(</span><span class="op" id="5690794">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690797">if</span>&nbsp;<span class="ident" id="5690800">typ</span>&nbsp;<span class="op" id="5690804">!=</span>&nbsp;<span class="ident" id="5690807">nil</span>&nbsp;<span class="op" id="5690811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5690815">p</span><span class="op" id="5690816">.</span><span class="ident" id="5690817">resolve</span><span class="op" id="5690824">(</span><span class="ident" id="5690825">typ</span><span class="op" id="5690828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5690831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690834">return</span>&nbsp;<span class="ident" id="5690841">typ</span><br>
<span class="lineno"></span><span class="op" id="5690845">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="5690848">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5690928">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5690939">func</span>&nbsp;<span class="op" id="5690944">(</span><span class="ident" id="5690945">p</span>&nbsp;<span class="op" id="5690947">*</span><span class="ident" id="5690948">parser</span><span class="op" id="5690954">)</span>&nbsp;<span class="ident" id="5690956">parseStmtList</span><span class="op" id="5690969">(</span><span class="op" id="5690970">)</span>&nbsp;<span class="op" id="5690972">(</span><span class="ident" id="5690973">list</span>&nbsp;<span class="op" id="5690978">[</span><span class="op" id="5690979">]</span><span class="ident" id="5690980">ast</span><span class="op" id="5690983">.</span><span class="ident" id="5690984">Stmt</span><span class="op" id="5690988">)</span>&nbsp;<span class="op" id="5690990">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5690993">if</span>&nbsp;<span class="ident" id="5690996">p</span><span class="op" id="5690997">.</span><span class="ident" id="5690998">trace</span>&nbsp;<span class="op" id="5691004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691008">defer</span>&nbsp;<span class="ident" id="5691014">un</span><span class="op" id="5691016">(</span><span class="ident" id="5691017">trace</span><span class="op" id="5691022">(</span><span class="ident" id="5691023">p</span><span class="op" id="5691024">,</span>&nbsp;<span class="string" id="5691026">&#34;StatementList&#34;</span><span class="op" id="5691041">)</span><span class="op" id="5691042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691049">for</span>&nbsp;<span class="ident" id="5691053">p</span><span class="op" id="5691054">.</span><span class="ident" id="5691055">tok</span>&nbsp;<span class="op" id="5691059">!=</span>&nbsp;<span class="ident" id="5691062">token</span><span class="op" id="5691067">.</span><span class="ident" id="5691068">CASE</span>&nbsp;<span class="op" id="5691073">&amp;&amp;</span>&nbsp;<span class="ident" id="5691076">p</span><span class="op" id="5691077">.</span><span class="ident" id="5691078">tok</span>&nbsp;<span class="op" id="5691082">!=</span>&nbsp;<span class="ident" id="5691085">token</span><span class="op" id="5691090">.</span><span class="ident" id="5691091">DEFAULT</span>&nbsp;<span class="op" id="5691099">&amp;&amp;</span>&nbsp;<span class="ident" id="5691102">p</span><span class="op" id="5691103">.</span><span class="ident" id="5691104">tok</span>&nbsp;<span class="op" id="5691108">!=</span>&nbsp;<span class="ident" id="5691111">token</span><span class="op" id="5691116">.</span><span class="ident" id="5691117">RBRACE</span>&nbsp;<span class="op" id="5691124">&amp;&amp;</span>&nbsp;<span class="ident" id="5691127">p</span><span class="op" id="5691128">.</span><span class="ident" id="5691129">tok</span>&nbsp;<span class="op" id="5691133">!=</span>&nbsp;<span class="ident" id="5691136">token</span><span class="op" id="5691141">.</span><span class="ident" id="5691142">EOF</span>&nbsp;<span class="op" id="5691146">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691150">list</span>&nbsp;<span class="op" id="5691155">=</span>&nbsp;<span class="builtinfunc" id="5691157">append</span><span class="op" id="5691163">(</span><span class="ident" id="5691164">list</span><span class="op" id="5691168">,</span>&nbsp;<span class="ident" id="5691170">p</span><span class="op" id="5691171">.</span><span class="ident" id="5691172">parseStmt</span><span class="op" id="5691181">(</span><span class="op" id="5691182">)</span><span class="op" id="5691183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691190">return</span><br>
<span class="lineno"></span><span class="op" id="5691197">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="5691200">func</span>&nbsp;<span class="op" id="5691205">(</span><span class="ident" id="5691206">p</span>&nbsp;<span class="op" id="5691208">*</span><span class="ident" id="5691209">parser</span><span class="op" id="5691215">)</span>&nbsp;<span class="ident" id="5691217">parseBody</span><span class="op" id="5691226">(</span><span class="ident" id="5691227">scope</span>&nbsp;<span class="op" id="5691233">*</span><span class="ident" id="5691234">ast</span><span class="op" id="5691237">.</span><span class="ident" id="5691238">Scope</span><span class="op" id="5691243">)</span>&nbsp;<span class="op" id="5691245">*</span><span class="ident" id="5691246">ast</span><span class="op" id="5691249">.</span><span class="ident" id="5691250">BlockStmt</span>&nbsp;<span class="op" id="5691260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691263">if</span>&nbsp;<span class="ident" id="5691266">p</span><span class="op" id="5691267">.</span><span class="ident" id="5691268">trace</span>&nbsp;<span class="op" id="5691274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691278">defer</span>&nbsp;<span class="ident" id="5691284">un</span><span class="op" id="5691286">(</span><span class="ident" id="5691287">trace</span><span class="op" id="5691292">(</span><span class="ident" id="5691293">p</span><span class="op" id="5691294">,</span>&nbsp;<span class="string" id="5691296">&#34;Body&#34;</span><span class="op" id="5691302">)</span><span class="op" id="5691303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691306">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691310">lbrace</span>&nbsp;<span class="op" id="5691317">:=</span>&nbsp;<span class="ident" id="5691320">p</span><span class="op" id="5691321">.</span><span class="ident" id="5691322">expect</span><span class="op" id="5691328">(</span><span class="ident" id="5691329">token</span><span class="op" id="5691334">.</span><span class="ident" id="5691335">LBRACE</span><span class="op" id="5691341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691344">p</span><span class="op" id="5691345">.</span><span class="ident" id="5691346">topScope</span>&nbsp;<span class="op" id="5691355">=</span>&nbsp;<span class="ident" id="5691357">scope</span>&nbsp;<span class="comment" id="5691363">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691387">p</span><span class="op" id="5691388">.</span><span class="ident" id="5691389">openLabelScope</span><span class="op" id="5691403">(</span><span class="op" id="5691404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691407">list</span>&nbsp;<span class="op" id="5691412">:=</span>&nbsp;<span class="ident" id="5691415">p</span><span class="op" id="5691416">.</span><span class="ident" id="5691417">parseStmtList</span><span class="op" id="5691430">(</span><span class="op" id="5691431">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691434">p</span><span class="op" id="5691435">.</span><span class="ident" id="5691436">closeLabelScope</span><span class="op" id="5691451">(</span><span class="op" id="5691452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691455">p</span><span class="op" id="5691456">.</span><span class="ident" id="5691457">closeScope</span><span class="op" id="5691467">(</span><span class="op" id="5691468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691471">rbrace</span>&nbsp;<span class="op" id="5691478">:=</span>&nbsp;<span class="ident" id="5691481">p</span><span class="op" id="5691482">.</span><span class="ident" id="5691483">expect</span><span class="op" id="5691489">(</span><span class="ident" id="5691490">token</span><span class="op" id="5691495">.</span><span class="ident" id="5691496">RBRACE</span><span class="op" id="5691502">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691506">return</span>&nbsp;<span class="op" id="5691513">&amp;</span><span class="ident" id="5691514">ast</span><span class="op" id="5691517">.</span><span class="ident" id="5691518">BlockStmt</span><span class="op" id="5691527">{</span><span class="ident" id="5691528">Lbrace</span><span class="op" id="5691534">:</span>&nbsp;<span class="ident" id="5691536">lbrace</span><span class="op" id="5691542">,</span>&nbsp;<span class="ident" id="5691544">List</span><span class="op" id="5691548">:</span>&nbsp;<span class="ident" id="5691550">list</span><span class="op" id="5691554">,</span>&nbsp;<span class="ident" id="5691556">Rbrace</span><span class="op" id="5691562">:</span>&nbsp;<span class="ident" id="5691564">rbrace</span><span class="op" id="5691570">}</span><br>
<span class="lineno">1075</span><span class="op" id="5691572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5691575">func</span>&nbsp;<span class="op" id="5691580">(</span><span class="ident" id="5691581">p</span>&nbsp;<span class="op" id="5691583">*</span><span class="ident" id="5691584">parser</span><span class="op" id="5691590">)</span>&nbsp;<span class="ident" id="5691592">parseBlockStmt</span><span class="op" id="5691606">(</span><span class="op" id="5691607">)</span>&nbsp;<span class="op" id="5691609">*</span><span class="ident" id="5691610">ast</span><span class="op" id="5691613">.</span><span class="ident" id="5691614">BlockStmt</span>&nbsp;<span class="op" id="5691624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691627">if</span>&nbsp;<span class="ident" id="5691630">p</span><span class="op" id="5691631">.</span><span class="ident" id="5691632">trace</span>&nbsp;<span class="op" id="5691638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691642">defer</span>&nbsp;<span class="ident" id="5691648">un</span><span class="op" id="5691650">(</span><span class="ident" id="5691651">trace</span><span class="op" id="5691656">(</span><span class="ident" id="5691657">p</span><span class="op" id="5691658">,</span>&nbsp;<span class="string" id="5691660">&#34;BlockStmt&#34;</span><span class="op" id="5691671">)</span><span class="op" id="5691672">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5691675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691679">lbrace</span>&nbsp;<span class="op" id="5691686">:=</span>&nbsp;<span class="ident" id="5691689">p</span><span class="op" id="5691690">.</span><span class="ident" id="5691691">expect</span><span class="op" id="5691697">(</span><span class="ident" id="5691698">token</span><span class="op" id="5691703">.</span><span class="ident" id="5691704">LBRACE</span><span class="op" id="5691710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691713">p</span><span class="op" id="5691714">.</span><span class="ident" id="5691715">openScope</span><span class="op" id="5691724">(</span><span class="op" id="5691725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691728">list</span>&nbsp;<span class="op" id="5691733">:=</span>&nbsp;<span class="ident" id="5691736">p</span><span class="op" id="5691737">.</span><span class="ident" id="5691738">parseStmtList</span><span class="op" id="5691751">(</span><span class="op" id="5691752">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691755">p</span><span class="op" id="5691756">.</span><span class="ident" id="5691757">closeScope</span><span class="op" id="5691767">(</span><span class="op" id="5691768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5691771">rbrace</span>&nbsp;<span class="op" id="5691778">:=</span>&nbsp;<span class="ident" id="5691781">p</span><span class="op" id="5691782">.</span><span class="ident" id="5691783">expect</span><span class="op" id="5691789">(</span><span class="ident" id="5691790">token</span><span class="op" id="5691795">.</span><span class="ident" id="5691796">RBRACE</span><span class="op" id="5691802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5691806">return</span>&nbsp;<span class="op" id="5691813">&amp;</span><span class="ident" id="5691814">ast</span><span class="op" id="5691817">.</span><span class="ident" id="5691818">BlockStmt</span><span class="op" id="5691827">{</span><span class="ident" id="5691828">Lbrace</span><span class="op" id="5691834">:</span>&nbsp;<span class="ident" id="5691836">lbrace</span><span class="op" id="5691842">,</span>&nbsp;<span class="ident" id="5691844">List</span><span class="op" id="5691848">:</span>&nbsp;<span class="ident" id="5691850">list</span><span class="op" id="5691854">,</span>&nbsp;<span class="ident" id="5691856">Rbrace</span><span class="op" id="5691862">:</span>&nbsp;<span class="ident" id="5691864">rbrace</span><span class="op" id="5691870">}</span><br>
<span class="lineno"></span><span class="op" id="5691872">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="5691875">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5691955">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5691971">func</span>&nbsp;<span class="op" id="5691976">(</span><span class="ident" id="5691977">p</span>&nbsp;<span class="op" id="5691979">*</span><span class="ident" id="5691980">parser</span><span class="op" id="5691986">)</span>&nbsp;<span class="ident" id="5691988">parseFuncTypeOrLit</span><span class="op" id="5692006">(</span><span class="op" id="5692007">)</span>&nbsp;<span class="ident" id="5692009">ast</span><span class="op" id="5692012">.</span><span class="ident" id="5692013">Expr</span>&nbsp;<span class="op" id="5692018">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692021">if</span>&nbsp;<span class="ident" id="5692024">p</span><span class="op" id="5692025">.</span><span class="ident" id="5692026">trace</span>&nbsp;<span class="op" id="5692032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692036">defer</span>&nbsp;<span class="ident" id="5692042">un</span><span class="op" id="5692044">(</span><span class="ident" id="5692045">trace</span><span class="op" id="5692050">(</span><span class="ident" id="5692051">p</span><span class="op" id="5692052">,</span>&nbsp;<span class="string" id="5692054">&#34;FuncTypeOrLit&#34;</span><span class="op" id="5692069">)</span><span class="op" id="5692070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692077">typ</span><span class="op" id="5692080">,</span>&nbsp;<span class="ident" id="5692082">scope</span>&nbsp;<span class="op" id="5692088">:=</span>&nbsp;<span class="ident" id="5692091">p</span><span class="op" id="5692092">.</span><span class="ident" id="5692093">parseFuncType</span><span class="op" id="5692106">(</span><span class="op" id="5692107">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692110">if</span>&nbsp;<span class="ident" id="5692113">p</span><span class="op" id="5692114">.</span><span class="ident" id="5692115">tok</span>&nbsp;<span class="op" id="5692119">!=</span>&nbsp;<span class="ident" id="5692122">token</span><span class="op" id="5692127">.</span><span class="ident" id="5692128">LBRACE</span>&nbsp;<span class="op" id="5692135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5692139">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692163">return</span>&nbsp;<span class="ident" id="5692170">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692179">p</span><span class="op" id="5692180">.</span><span class="ident" id="5692181">exprLev</span><span class="op" id="5692188">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692192">body</span>&nbsp;<span class="op" id="5692197">:=</span>&nbsp;<span class="ident" id="5692200">p</span><span class="op" id="5692201">.</span><span class="ident" id="5692202">parseBody</span><span class="op" id="5692211">(</span><span class="ident" id="5692212">scope</span><span class="op" id="5692217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692220">p</span><span class="op" id="5692221">.</span><span class="ident" id="5692222">exprLev</span><span class="op" id="5692229">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692234">return</span>&nbsp;<span class="op" id="5692241">&amp;</span><span class="ident" id="5692242">ast</span><span class="op" id="5692245">.</span><span class="ident" id="5692246">FuncLit</span><span class="op" id="5692253">{</span><span class="ident" id="5692254">Type</span><span class="op" id="5692258">:</span>&nbsp;<span class="ident" id="5692260">typ</span><span class="op" id="5692263">,</span>&nbsp;<span class="ident" id="5692265">Body</span><span class="op" id="5692269">:</span>&nbsp;<span class="ident" id="5692271">body</span><span class="op" id="5692275">}</span><br>
<span class="lineno">1110</span><span class="op" id="5692277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5692280">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="5692348">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="5692409">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="5692479">//</span><br>
<span class="lineno"></span><span class="keyword" id="5692482">func</span>&nbsp;<span class="op" id="5692487">(</span><span class="ident" id="5692488">p</span>&nbsp;<span class="op" id="5692490">*</span><span class="ident" id="5692491">parser</span><span class="op" id="5692497">)</span>&nbsp;<span class="ident" id="5692499">parseOperand</span><span class="op" id="5692511">(</span><span class="ident" id="5692512">lhs</span>&nbsp;<span class="builtintype" id="5692516">bool</span><span class="op" id="5692520">)</span>&nbsp;<span class="ident" id="5692522">ast</span><span class="op" id="5692525">.</span><span class="ident" id="5692526">Expr</span>&nbsp;<span class="op" id="5692531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692534">if</span>&nbsp;<span class="ident" id="5692537">p</span><span class="op" id="5692538">.</span><span class="ident" id="5692539">trace</span>&nbsp;<span class="op" id="5692545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692549">defer</span>&nbsp;<span class="ident" id="5692555">un</span><span class="op" id="5692557">(</span><span class="ident" id="5692558">trace</span><span class="op" id="5692563">(</span><span class="ident" id="5692564">p</span><span class="op" id="5692565">,</span>&nbsp;<span class="string" id="5692567">&#34;Operand&#34;</span><span class="op" id="5692576">)</span><span class="op" id="5692577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692580">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692584">switch</span>&nbsp;<span class="ident" id="5692591">p</span><span class="op" id="5692592">.</span><span class="ident" id="5692593">tok</span>&nbsp;<span class="op" id="5692597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692600">case</span>&nbsp;<span class="ident" id="5692605">token</span><span class="op" id="5692610">.</span><span class="ident" id="5692611">IDENT</span><span class="op" id="5692616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692620">x</span>&nbsp;<span class="op" id="5692622">:=</span>&nbsp;<span class="ident" id="5692625">p</span><span class="op" id="5692626">.</span><span class="ident" id="5692627">parseIdent</span><span class="op" id="5692637">(</span><span class="op" id="5692638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692642">if</span>&nbsp;<span class="op" id="5692645">!</span><span class="ident" id="5692646">lhs</span>&nbsp;<span class="op" id="5692650">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692655">p</span><span class="op" id="5692656">.</span><span class="ident" id="5692657">resolve</span><span class="op" id="5692664">(</span><span class="ident" id="5692665">x</span><span class="op" id="5692666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5692670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692674">return</span>&nbsp;<span class="ident" id="5692681">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692685">case</span>&nbsp;<span class="ident" id="5692690">token</span><span class="op" id="5692695">.</span><span class="ident" id="5692696">INT</span><span class="op" id="5692699">,</span>&nbsp;<span class="ident" id="5692701">token</span><span class="op" id="5692706">.</span><span class="ident" id="5692707">FLOAT</span><span class="op" id="5692712">,</span>&nbsp;<span class="ident" id="5692714">token</span><span class="op" id="5692719">.</span><span class="ident" id="5692720">IMAG</span><span class="op" id="5692724">,</span>&nbsp;<span class="ident" id="5692726">token</span><span class="op" id="5692731">.</span><span class="ident" id="5692732">CHAR</span><span class="op" id="5692736">,</span>&nbsp;<span class="ident" id="5692738">token</span><span class="op" id="5692743">.</span><span class="ident" id="5692744">STRING</span><span class="op" id="5692750">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692754">x</span>&nbsp;<span class="op" id="5692756">:=</span>&nbsp;<span class="op" id="5692759">&amp;</span><span class="ident" id="5692760">ast</span><span class="op" id="5692763">.</span><span class="ident" id="5692764">BasicLit</span><span class="op" id="5692772">{</span><span class="ident" id="5692773">ValuePos</span><span class="op" id="5692781">:</span>&nbsp;<span class="ident" id="5692783">p</span><span class="op" id="5692784">.</span><span class="ident" id="5692785">pos</span><span class="op" id="5692788">,</span>&nbsp;<span class="ident" id="5692790">Kind</span><span class="op" id="5692794">:</span>&nbsp;<span class="ident" id="5692796">p</span><span class="op" id="5692797">.</span><span class="ident" id="5692798">tok</span><span class="op" id="5692801">,</span>&nbsp;<span class="ident" id="5692803">Value</span><span class="op" id="5692808">:</span>&nbsp;<span class="ident" id="5692810">p</span><span class="op" id="5692811">.</span><span class="ident" id="5692812">lit</span><span class="op" id="5692815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692819">p</span><span class="op" id="5692820">.</span><span class="ident" id="5692821">next</span><span class="op" id="5692825">(</span><span class="op" id="5692826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692830">return</span>&nbsp;<span class="ident" id="5692837">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5692841">case</span>&nbsp;<span class="ident" id="5692846">token</span><span class="op" id="5692851">.</span><span class="ident" id="5692852">LPAREN</span><span class="op" id="5692858">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692862">lparen</span>&nbsp;<span class="op" id="5692869">:=</span>&nbsp;<span class="ident" id="5692872">p</span><span class="op" id="5692873">.</span><span class="ident" id="5692874">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692880">p</span><span class="op" id="5692881">.</span><span class="ident" id="5692882">next</span><span class="op" id="5692886">(</span><span class="op" id="5692887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692891">p</span><span class="op" id="5692892">.</span><span class="ident" id="5692893">exprLev</span><span class="op" id="5692900">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692905">x</span>&nbsp;<span class="op" id="5692907">:=</span>&nbsp;<span class="ident" id="5692910">p</span><span class="op" id="5692911">.</span><span class="ident" id="5692912">parseRhsOrType</span><span class="op" id="5692926">(</span><span class="op" id="5692927">)</span>&nbsp;<span class="comment" id="5692929">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692974">p</span><span class="op" id="5692975">.</span><span class="ident" id="5692976">exprLev</span><span class="op" id="5692983">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5692988">rparen</span>&nbsp;<span class="op" id="5692995">:=</span>&nbsp;<span class="ident" id="5692998">p</span><span class="op" id="5692999">.</span><span class="ident" id="5693000">expect</span><span class="op" id="5693006">(</span><span class="ident" id="5693007">token</span><span class="op" id="5693012">.</span><span class="ident" id="5693013">RPAREN</span><span class="op" id="5693019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693023">return</span>&nbsp;<span class="op" id="5693030">&amp;</span><span class="ident" id="5693031">ast</span><span class="op" id="5693034">.</span><span class="ident" id="5693035">ParenExpr</span><span class="op" id="5693044">{</span><span class="ident" id="5693045">Lparen</span><span class="op" id="5693051">:</span>&nbsp;<span class="ident" id="5693053">lparen</span><span class="op" id="5693059">,</span>&nbsp;<span class="ident" id="5693061">X</span><span class="op" id="5693062">:</span>&nbsp;<span class="ident" id="5693064">x</span><span class="op" id="5693065">,</span>&nbsp;<span class="ident" id="5693067">Rparen</span><span class="op" id="5693073">:</span>&nbsp;<span class="ident" id="5693075">rparen</span><span class="op" id="5693081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693085">case</span>&nbsp;<span class="ident" id="5693090">token</span><span class="op" id="5693095">.</span><span class="ident" id="5693096">FUNC</span><span class="op" id="5693100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693104">return</span>&nbsp;<span class="ident" id="5693111">p</span><span class="op" id="5693112">.</span><span class="ident" id="5693113">parseFuncTypeOrLit</span><span class="op" id="5693131">(</span><span class="op" id="5693132">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693139">if</span>&nbsp;<span class="ident" id="5693142">typ</span>&nbsp;<span class="op" id="5693146">:=</span>&nbsp;<span class="ident" id="5693149">p</span><span class="op" id="5693150">.</span><span class="ident" id="5693151">tryIdentOrType</span><span class="op" id="5693165">(</span><span class="op" id="5693166">)</span><span class="op" id="5693167">;</span>&nbsp;<span class="ident" id="5693169">typ</span>&nbsp;<span class="op" id="5693173">!=</span>&nbsp;<span class="ident" id="5693176">nil</span>&nbsp;<span class="op" id="5693180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693184">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693239">_</span><span class="op" id="5693240">,</span>&nbsp;<span class="ident" id="5693242">isIdent</span>&nbsp;<span class="op" id="5693250">:=</span>&nbsp;<span class="ident" id="5693253">typ</span><span class="op" id="5693256">.</span><span class="op" id="5693257">(</span><span class="op" id="5693258">*</span><span class="ident" id="5693259">ast</span><span class="op" id="5693262">.</span><span class="ident" id="5693263">Ident</span><span class="op" id="5693268">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693272">assert</span><span class="op" id="5693278">(</span><span class="op" id="5693279">!</span><span class="ident" id="5693280">isIdent</span><span class="op" id="5693287">,</span>&nbsp;<span class="string" id="5693289">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="5693316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693320">return</span>&nbsp;<span class="ident" id="5693327">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693336">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693357">pos</span>&nbsp;<span class="op" id="5693361">:=</span>&nbsp;<span class="ident" id="5693364">p</span><span class="op" id="5693365">.</span><span class="ident" id="5693366">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693371">p</span><span class="op" id="5693372">.</span><span class="ident" id="5693373">errorExpected</span><span class="op" id="5693386">(</span><span class="ident" id="5693387">pos</span><span class="op" id="5693390">,</span>&nbsp;<span class="string" id="5693392">&#34;operand&#34;</span><span class="op" id="5693401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693404">syncStmt</span><span class="op" id="5693412">(</span><span class="ident" id="5693413">p</span><span class="op" id="5693414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693417">return</span>&nbsp;<span class="op" id="5693424">&amp;</span><span class="ident" id="5693425">ast</span><span class="op" id="5693428">.</span><span class="ident" id="5693429">BadExpr</span><span class="op" id="5693436">{</span><span class="ident" id="5693437">From</span><span class="op" id="5693441">:</span>&nbsp;<span class="ident" id="5693443">pos</span><span class="op" id="5693446">,</span>&nbsp;<span class="ident" id="5693448">To</span><span class="op" id="5693450">:</span>&nbsp;<span class="ident" id="5693452">p</span><span class="op" id="5693453">.</span><span class="ident" id="5693454">pos</span><span class="op" id="5693457">}</span><br>
<span class="lineno"></span><span class="op" id="5693459">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="5693462">func</span>&nbsp;<span class="op" id="5693467">(</span><span class="ident" id="5693468">p</span>&nbsp;<span class="op" id="5693470">*</span><span class="ident" id="5693471">parser</span><span class="op" id="5693477">)</span>&nbsp;<span class="ident" id="5693479">parseSelector</span><span class="op" id="5693492">(</span><span class="ident" id="5693493">x</span>&nbsp;<span class="ident" id="5693495">ast</span><span class="op" id="5693498">.</span><span class="ident" id="5693499">Expr</span><span class="op" id="5693503">)</span>&nbsp;<span class="ident" id="5693505">ast</span><span class="op" id="5693508">.</span><span class="ident" id="5693509">Expr</span>&nbsp;<span class="op" id="5693514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693517">if</span>&nbsp;<span class="ident" id="5693520">p</span><span class="op" id="5693521">.</span><span class="ident" id="5693522">trace</span>&nbsp;<span class="op" id="5693528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693532">defer</span>&nbsp;<span class="ident" id="5693538">un</span><span class="op" id="5693540">(</span><span class="ident" id="5693541">trace</span><span class="op" id="5693546">(</span><span class="ident" id="5693547">p</span><span class="op" id="5693548">,</span>&nbsp;<span class="string" id="5693550">&#34;Selector&#34;</span><span class="op" id="5693560">)</span><span class="op" id="5693561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693564">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693568">sel</span>&nbsp;<span class="op" id="5693572">:=</span>&nbsp;<span class="ident" id="5693575">p</span><span class="op" id="5693576">.</span><span class="ident" id="5693577">parseIdent</span><span class="op" id="5693587">(</span><span class="op" id="5693588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693592">return</span>&nbsp;<span class="op" id="5693599">&amp;</span><span class="ident" id="5693600">ast</span><span class="op" id="5693603">.</span><span class="ident" id="5693604">SelectorExpr</span><span class="op" id="5693616">{</span><span class="ident" id="5693617">X</span><span class="op" id="5693618">:</span>&nbsp;<span class="ident" id="5693620">x</span><span class="op" id="5693621">,</span>&nbsp;<span class="ident" id="5693623">Sel</span><span class="op" id="5693626">:</span>&nbsp;<span class="ident" id="5693628">sel</span><span class="op" id="5693631">}</span><br>
<span class="lineno"></span><span class="op" id="5693633">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="5693636">func</span>&nbsp;<span class="op" id="5693641">(</span><span class="ident" id="5693642">p</span>&nbsp;<span class="op" id="5693644">*</span><span class="ident" id="5693645">parser</span><span class="op" id="5693651">)</span>&nbsp;<span class="ident" id="5693653">parseTypeAssertion</span><span class="op" id="5693671">(</span><span class="ident" id="5693672">x</span>&nbsp;<span class="ident" id="5693674">ast</span><span class="op" id="5693677">.</span><span class="ident" id="5693678">Expr</span><span class="op" id="5693682">)</span>&nbsp;<span class="ident" id="5693684">ast</span><span class="op" id="5693687">.</span><span class="ident" id="5693688">Expr</span>&nbsp;<span class="op" id="5693693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693696">if</span>&nbsp;<span class="ident" id="5693699">p</span><span class="op" id="5693700">.</span><span class="ident" id="5693701">trace</span>&nbsp;<span class="op" id="5693707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693711">defer</span>&nbsp;<span class="ident" id="5693717">un</span><span class="op" id="5693719">(</span><span class="ident" id="5693720">trace</span><span class="op" id="5693725">(</span><span class="ident" id="5693726">p</span><span class="op" id="5693727">,</span>&nbsp;<span class="string" id="5693729">&#34;TypeAssertion&#34;</span><span class="op" id="5693744">)</span><span class="op" id="5693745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693748">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693752">lparen</span>&nbsp;<span class="op" id="5693759">:=</span>&nbsp;<span class="ident" id="5693762">p</span><span class="op" id="5693763">.</span><span class="ident" id="5693764">expect</span><span class="op" id="5693770">(</span><span class="ident" id="5693771">token</span><span class="op" id="5693776">.</span><span class="ident" id="5693777">LPAREN</span><span class="op" id="5693783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693786">var</span>&nbsp;<span class="ident" id="5693790">typ</span>&nbsp;<span class="ident" id="5693794">ast</span><span class="op" id="5693797">.</span><span class="ident" id="5693798">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693804">if</span>&nbsp;<span class="ident" id="5693807">p</span><span class="op" id="5693808">.</span><span class="ident" id="5693809">tok</span>&nbsp;<span class="op" id="5693813">==</span>&nbsp;<span class="ident" id="5693816">token</span><span class="op" id="5693821">.</span><span class="ident" id="5693822">TYPE</span>&nbsp;<span class="op" id="5693827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5693831">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693860">p</span><span class="op" id="5693861">.</span><span class="ident" id="5693862">next</span><span class="op" id="5693866">(</span><span class="op" id="5693867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693870">}</span>&nbsp;<span class="keyword" id="5693872">else</span>&nbsp;<span class="op" id="5693877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693881">typ</span>&nbsp;<span class="op" id="5693885">=</span>&nbsp;<span class="ident" id="5693887">p</span><span class="op" id="5693888">.</span><span class="ident" id="5693889">parseType</span><span class="op" id="5693898">(</span><span class="op" id="5693899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5693902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5693905">rparen</span>&nbsp;<span class="op" id="5693912">:=</span>&nbsp;<span class="ident" id="5693915">p</span><span class="op" id="5693916">.</span><span class="ident" id="5693917">expect</span><span class="op" id="5693923">(</span><span class="ident" id="5693924">token</span><span class="op" id="5693929">.</span><span class="ident" id="5693930">RPAREN</span><span class="op" id="5693936">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5693940">return</span>&nbsp;<span class="op" id="5693947">&amp;</span><span class="ident" id="5693948">ast</span><span class="op" id="5693951">.</span><span class="ident" id="5693952">TypeAssertExpr</span><span class="op" id="5693966">{</span><span class="ident" id="5693967">X</span><span class="op" id="5693968">:</span>&nbsp;<span class="ident" id="5693970">x</span><span class="op" id="5693971">,</span>&nbsp;<span class="ident" id="5693973">Type</span><span class="op" id="5693977">:</span>&nbsp;<span class="ident" id="5693979">typ</span><span class="op" id="5693982">,</span>&nbsp;<span class="ident" id="5693984">Lparen</span><span class="op" id="5693990">:</span>&nbsp;<span class="ident" id="5693992">lparen</span><span class="op" id="5693998">,</span>&nbsp;<span class="ident" id="5694000">Rparen</span><span class="op" id="5694006">:</span>&nbsp;<span class="ident" id="5694008">rparen</span><span class="op" id="5694014">}</span><br>
<span class="lineno"></span><span class="op" id="5694016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5694019">func</span>&nbsp;<span class="op" id="5694024">(</span><span class="ident" id="5694025">p</span>&nbsp;<span class="op" id="5694027">*</span><span class="ident" id="5694028">parser</span><span class="op" id="5694034">)</span>&nbsp;<span class="ident" id="5694036">parseIndexOrSlice</span><span class="op" id="5694053">(</span><span class="ident" id="5694054">x</span>&nbsp;<span class="ident" id="5694056">ast</span><span class="op" id="5694059">.</span><span class="ident" id="5694060">Expr</span><span class="op" id="5694064">)</span>&nbsp;<span class="ident" id="5694066">ast</span><span class="op" id="5694069">.</span><span class="ident" id="5694070">Expr</span>&nbsp;<span class="op" id="5694075">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694078">if</span>&nbsp;<span class="ident" id="5694081">p</span><span class="op" id="5694082">.</span><span class="ident" id="5694083">trace</span>&nbsp;<span class="op" id="5694089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694093">defer</span>&nbsp;<span class="ident" id="5694099">un</span><span class="op" id="5694101">(</span><span class="ident" id="5694102">trace</span><span class="op" id="5694107">(</span><span class="ident" id="5694108">p</span><span class="op" id="5694109">,</span>&nbsp;<span class="string" id="5694111">&#34;IndexOrSlice&#34;</span><span class="op" id="5694125">)</span><span class="op" id="5694126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694133">const</span>&nbsp;<span class="ident" id="5694139">N</span>&nbsp;<span class="op" id="5694141">=</span>&nbsp;<span class="num" id="5694143">3</span>&nbsp;<span class="comment" id="5694145">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694193">lbrack</span>&nbsp;<span class="op" id="5694200">:=</span>&nbsp;<span class="ident" id="5694203">p</span><span class="op" id="5694204">.</span><span class="ident" id="5694205">expect</span><span class="op" id="5694211">(</span><span class="ident" id="5694212">token</span><span class="op" id="5694217">.</span><span class="ident" id="5694218">LBRACK</span><span class="op" id="5694224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694227">p</span><span class="op" id="5694228">.</span><span class="ident" id="5694229">exprLev</span><span class="op" id="5694236">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694240">var</span>&nbsp;<span class="ident" id="5694244">index</span>&nbsp;<span class="op" id="5694250">[</span><span class="ident" id="5694251">N</span><span class="op" id="5694252">]</span><span class="ident" id="5694253">ast</span><span class="op" id="5694256">.</span><span class="ident" id="5694257">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694263">var</span>&nbsp;<span class="ident" id="5694267">colons</span>&nbsp;<span class="op" id="5694274">[</span><span class="ident" id="5694275">N</span>&nbsp;<span class="op" id="5694277">-</span>&nbsp;<span class="num" id="5694279">1</span><span class="op" id="5694280">]</span><span class="ident" id="5694281">token</span><span class="op" id="5694286">.</span><span class="ident" id="5694287">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694292">if</span>&nbsp;<span class="ident" id="5694295">p</span><span class="op" id="5694296">.</span><span class="ident" id="5694297">tok</span>&nbsp;<span class="op" id="5694301">!=</span>&nbsp;<span class="ident" id="5694304">token</span><span class="op" id="5694309">.</span><span class="ident" id="5694310">COLON</span>&nbsp;<span class="op" id="5694316">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694320">index</span><span class="op" id="5694325">[</span><span class="num" id="5694326">0</span><span class="op" id="5694327">]</span>&nbsp;<span class="op" id="5694329">=</span>&nbsp;<span class="ident" id="5694331">p</span><span class="op" id="5694332">.</span><span class="ident" id="5694333">parseRhs</span><span class="op" id="5694341">(</span><span class="op" id="5694342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694348">ncolons</span>&nbsp;<span class="op" id="5694356">:=</span>&nbsp;<span class="num" id="5694359">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694362">for</span>&nbsp;<span class="ident" id="5694366">p</span><span class="op" id="5694367">.</span><span class="ident" id="5694368">tok</span>&nbsp;<span class="op" id="5694372">==</span>&nbsp;<span class="ident" id="5694375">token</span><span class="op" id="5694380">.</span><span class="ident" id="5694381">COLON</span>&nbsp;<span class="op" id="5694387">&amp;&amp;</span>&nbsp;<span class="ident" id="5694390">ncolons</span>&nbsp;<span class="op" id="5694398">&lt;</span>&nbsp;<span class="builtinfunc" id="5694400">len</span><span class="op" id="5694403">(</span><span class="ident" id="5694404">colons</span><span class="op" id="5694410">)</span>&nbsp;<span class="op" id="5694412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694416">colons</span><span class="op" id="5694422">[</span><span class="ident" id="5694423">ncolons</span><span class="op" id="5694430">]</span>&nbsp;<span class="op" id="5694432">=</span>&nbsp;<span class="ident" id="5694434">p</span><span class="op" id="5694435">.</span><span class="ident" id="5694436">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694442">ncolons</span><span class="op" id="5694449">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694454">p</span><span class="op" id="5694455">.</span><span class="ident" id="5694456">next</span><span class="op" id="5694460">(</span><span class="op" id="5694461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694465">if</span>&nbsp;<span class="ident" id="5694468">p</span><span class="op" id="5694469">.</span><span class="ident" id="5694470">tok</span>&nbsp;<span class="op" id="5694474">!=</span>&nbsp;<span class="ident" id="5694477">token</span><span class="op" id="5694482">.</span><span class="ident" id="5694483">COLON</span>&nbsp;<span class="op" id="5694489">&amp;&amp;</span>&nbsp;<span class="ident" id="5694492">p</span><span class="op" id="5694493">.</span><span class="ident" id="5694494">tok</span>&nbsp;<span class="op" id="5694498">!=</span>&nbsp;<span class="ident" id="5694501">token</span><span class="op" id="5694506">.</span><span class="ident" id="5694507">RBRACK</span>&nbsp;<span class="op" id="5694514">&amp;&amp;</span>&nbsp;<span class="ident" id="5694517">p</span><span class="op" id="5694518">.</span><span class="ident" id="5694519">tok</span>&nbsp;<span class="op" id="5694523">!=</span>&nbsp;<span class="ident" id="5694526">token</span><span class="op" id="5694531">.</span><span class="ident" id="5694532">EOF</span>&nbsp;<span class="op" id="5694536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694541">index</span><span class="op" id="5694546">[</span><span class="ident" id="5694547">ncolons</span><span class="op" id="5694554">]</span>&nbsp;<span class="op" id="5694556">=</span>&nbsp;<span class="ident" id="5694558">p</span><span class="op" id="5694559">.</span><span class="ident" id="5694560">parseRhs</span><span class="op" id="5694568">(</span><span class="op" id="5694569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694573">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5694576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694579">p</span><span class="op" id="5694580">.</span><span class="ident" id="5694581">exprLev</span><span class="op" id="5694588">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694592">rbrack</span>&nbsp;<span class="op" id="5694599">:=</span>&nbsp;<span class="ident" id="5694602">p</span><span class="op" id="5694603">.</span><span class="ident" id="5694604">expect</span><span class="op" id="5694610">(</span><span class="ident" id="5694611">token</span><span class="op" id="5694616">.</span><span class="ident" id="5694617">RBRACK</span><span class="op" id="5694623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694627">if</span>&nbsp;<span class="ident" id="5694630">ncolons</span>&nbsp;<span class="op" id="5694638">&gt;</span>&nbsp;<span class="num" id="5694640">0</span>&nbsp;<span class="op" id="5694642">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5694646">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694668">slice3</span>&nbsp;<span class="op" id="5694675">:=</span>&nbsp;<span class="builtintype" id="5694678">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694686">if</span>&nbsp;<span class="ident" id="5694689">ncolons</span>&nbsp;<span class="op" id="5694697">==</span>&nbsp;<span class="num" id="5694700">2</span>&nbsp;<span class="op" id="5694702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694707">slice3</span>&nbsp;<span class="op" id="5694714">=</span>&nbsp;<span class="builtintype" id="5694716">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5694724">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5694804">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5694885">if</span>&nbsp;<span class="ident" id="5694888">index</span><span class="op" id="5694893">[</span><span class="num" id="5694894">1</span><span class="op" id="5694895">]</span>&nbsp;<span class="op" id="5694897">==</span>&nbsp;<span class="ident" id="5694900">nil</span>&nbsp;<span class="op" id="5694904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694910">p</span><span class="op" id="5694911">.</span><span class="builtintype" id="5694912">error</span><span class="op" id="5694917">(</span><span class="ident" id="5694918">colons</span><span class="op" id="5694924">[</span><span class="num" id="5694925">0</span><span class="op" id="5694926">]</span><span class="op" id="5694927">,</span>&nbsp;<span class="string" id="5694929">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5694966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5694972">index</span><span class="op" id="5694977">[</span><span class="num" id="5694978">1</span><span class="op" id="5694979">]</span>&nbsp;<span class="op" id="5694981">=</span>&nbsp;<span class="op" id="5694983">&amp;</span><span class="ident" id="5694984">ast</span><span class="op" id="5694987">.</span><span class="ident" id="5694988">BadExpr</span><span class="op" id="5694995">{</span><span class="ident" id="5694996">From</span><span class="op" id="5695000">:</span>&nbsp;<span class="ident" id="5695002">colons</span><span class="op" id="5695008">[</span><span class="num" id="5695009">0</span><span class="op" id="5695010">]</span>&nbsp;<span class="op" id="5695012">+</span>&nbsp;<span class="num" id="5695014">1</span><span class="op" id="5695015">,</span>&nbsp;<span class="ident" id="5695017">To</span><span class="op" id="5695019">:</span>&nbsp;<span class="ident" id="5695021">colons</span><span class="op" id="5695027">[</span><span class="num" id="5695028">1</span><span class="op" id="5695029">]</span><span class="op" id="5695030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695035">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695040">if</span>&nbsp;<span class="ident" id="5695043">index</span><span class="op" id="5695048">[</span><span class="num" id="5695049">2</span><span class="op" id="5695050">]</span>&nbsp;<span class="op" id="5695052">==</span>&nbsp;<span class="ident" id="5695055">nil</span>&nbsp;<span class="op" id="5695059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695065">p</span><span class="op" id="5695066">.</span><span class="builtintype" id="5695067">error</span><span class="op" id="5695072">(</span><span class="ident" id="5695073">colons</span><span class="op" id="5695079">[</span><span class="num" id="5695080">1</span><span class="op" id="5695081">]</span><span class="op" id="5695082">,</span>&nbsp;<span class="string" id="5695084">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5695121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695127">index</span><span class="op" id="5695132">[</span><span class="num" id="5695133">2</span><span class="op" id="5695134">]</span>&nbsp;<span class="op" id="5695136">=</span>&nbsp;<span class="op" id="5695138">&amp;</span><span class="ident" id="5695139">ast</span><span class="op" id="5695142">.</span><span class="ident" id="5695143">BadExpr</span><span class="op" id="5695150">{</span><span class="ident" id="5695151">From</span><span class="op" id="5695155">:</span>&nbsp;<span class="ident" id="5695157">colons</span><span class="op" id="5695163">[</span><span class="num" id="5695164">1</span><span class="op" id="5695165">]</span>&nbsp;<span class="op" id="5695167">+</span>&nbsp;<span class="num" id="5695169">1</span><span class="op" id="5695170">,</span>&nbsp;<span class="ident" id="5695172">To</span><span class="op" id="5695174">:</span>&nbsp;<span class="ident" id="5695176">rbrack</span><span class="op" id="5695182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695191">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695195">return</span>&nbsp;<span class="op" id="5695202">&amp;</span><span class="ident" id="5695203">ast</span><span class="op" id="5695206">.</span><span class="ident" id="5695207">SliceExpr</span><span class="op" id="5695216">{</span><span class="ident" id="5695217">X</span><span class="op" id="5695218">:</span>&nbsp;<span class="ident" id="5695220">x</span><span class="op" id="5695221">,</span>&nbsp;<span class="ident" id="5695223">Lbrack</span><span class="op" id="5695229">:</span>&nbsp;<span class="ident" id="5695231">lbrack</span><span class="op" id="5695237">,</span>&nbsp;<span class="ident" id="5695239">Low</span><span class="op" id="5695242">:</span>&nbsp;<span class="ident" id="5695244">index</span><span class="op" id="5695249">[</span><span class="num" id="5695250">0</span><span class="op" id="5695251">]</span><span class="op" id="5695252">,</span>&nbsp;<span class="ident" id="5695254">High</span><span class="op" id="5695258">:</span>&nbsp;<span class="ident" id="5695260">index</span><span class="op" id="5695265">[</span><span class="num" id="5695266">1</span><span class="op" id="5695267">]</span><span class="op" id="5695268">,</span>&nbsp;<span class="ident" id="5695270">Max</span><span class="op" id="5695273">:</span>&nbsp;<span class="ident" id="5695275">index</span><span class="op" id="5695280">[</span><span class="num" id="5695281">2</span><span class="op" id="5695282">]</span><span class="op" id="5695283">,</span>&nbsp;<span class="ident" id="5695285">Slice3</span><span class="op" id="5695291">:</span>&nbsp;<span class="ident" id="5695293">slice3</span><span class="op" id="5695299">,</span>&nbsp;<span class="ident" id="5695301">Rbrack</span><span class="op" id="5695307">:</span>&nbsp;<span class="ident" id="5695309">rbrack</span><span class="op" id="5695315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695322">return</span>&nbsp;<span class="op" id="5695329">&amp;</span><span class="ident" id="5695330">ast</span><span class="op" id="5695333">.</span><span class="ident" id="5695334">IndexExpr</span><span class="op" id="5695343">{</span><span class="ident" id="5695344">X</span><span class="op" id="5695345">:</span>&nbsp;<span class="ident" id="5695347">x</span><span class="op" id="5695348">,</span>&nbsp;<span class="ident" id="5695350">Lbrack</span><span class="op" id="5695356">:</span>&nbsp;<span class="ident" id="5695358">lbrack</span><span class="op" id="5695364">,</span>&nbsp;<span class="ident" id="5695366">Index</span><span class="op" id="5695371">:</span>&nbsp;<span class="ident" id="5695373">index</span><span class="op" id="5695378">[</span><span class="num" id="5695379">0</span><span class="op" id="5695380">]</span><span class="op" id="5695381">,</span>&nbsp;<span class="ident" id="5695383">Rbrack</span><span class="op" id="5695389">:</span>&nbsp;<span class="ident" id="5695391">rbrack</span><span class="op" id="5695397">}</span><br>
<span class="lineno"></span><span class="op" id="5695399">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="5695402">func</span>&nbsp;<span class="op" id="5695407">(</span><span class="ident" id="5695408">p</span>&nbsp;<span class="op" id="5695410">*</span><span class="ident" id="5695411">parser</span><span class="op" id="5695417">)</span>&nbsp;<span class="ident" id="5695419">parseCallOrConversion</span><span class="op" id="5695440">(</span><span class="ident" id="5695441">fun</span>&nbsp;<span class="ident" id="5695445">ast</span><span class="op" id="5695448">.</span><span class="ident" id="5695449">Expr</span><span class="op" id="5695453">)</span>&nbsp;<span class="op" id="5695455">*</span><span class="ident" id="5695456">ast</span><span class="op" id="5695459">.</span><span class="ident" id="5695460">CallExpr</span>&nbsp;<span class="op" id="5695469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695472">if</span>&nbsp;<span class="ident" id="5695475">p</span><span class="op" id="5695476">.</span><span class="ident" id="5695477">trace</span>&nbsp;<span class="op" id="5695483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695487">defer</span>&nbsp;<span class="ident" id="5695493">un</span><span class="op" id="5695495">(</span><span class="ident" id="5695496">trace</span><span class="op" id="5695501">(</span><span class="ident" id="5695502">p</span><span class="op" id="5695503">,</span>&nbsp;<span class="string" id="5695505">&#34;CallOrConversion&#34;</span><span class="op" id="5695523">)</span><span class="op" id="5695524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695527">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695531">lparen</span>&nbsp;<span class="op" id="5695538">:=</span>&nbsp;<span class="ident" id="5695541">p</span><span class="op" id="5695542">.</span><span class="ident" id="5695543">expect</span><span class="op" id="5695549">(</span><span class="ident" id="5695550">token</span><span class="op" id="5695555">.</span><span class="ident" id="5695556">LPAREN</span><span class="op" id="5695562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695565">p</span><span class="op" id="5695566">.</span><span class="ident" id="5695567">exprLev</span><span class="op" id="5695574">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695578">var</span>&nbsp;<span class="ident" id="5695582">list</span>&nbsp;<span class="op" id="5695587">[</span><span class="op" id="5695588">]</span><span class="ident" id="5695589">ast</span><span class="op" id="5695592">.</span><span class="ident" id="5695593">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695599">var</span>&nbsp;<span class="ident" id="5695603">ellipsis</span>&nbsp;<span class="ident" id="5695612">token</span><span class="op" id="5695617">.</span><span class="ident" id="5695618">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695623">for</span>&nbsp;<span class="ident" id="5695627">p</span><span class="op" id="5695628">.</span><span class="ident" id="5695629">tok</span>&nbsp;<span class="op" id="5695633">!=</span>&nbsp;<span class="ident" id="5695636">token</span><span class="op" id="5695641">.</span><span class="ident" id="5695642">RPAREN</span>&nbsp;<span class="op" id="5695649">&amp;&amp;</span>&nbsp;<span class="ident" id="5695652">p</span><span class="op" id="5695653">.</span><span class="ident" id="5695654">tok</span>&nbsp;<span class="op" id="5695658">!=</span>&nbsp;<span class="ident" id="5695661">token</span><span class="op" id="5695666">.</span><span class="ident" id="5695667">EOF</span>&nbsp;<span class="op" id="5695671">&amp;&amp;</span>&nbsp;<span class="op" id="5695674">!</span><span class="ident" id="5695675">ellipsis</span><span class="op" id="5695683">.</span><span class="ident" id="5695684">IsValid</span><span class="op" id="5695691">(</span><span class="op" id="5695692">)</span>&nbsp;<span class="op" id="5695694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695698">list</span>&nbsp;<span class="op" id="5695703">=</span>&nbsp;<span class="builtinfunc" id="5695705">append</span><span class="op" id="5695711">(</span><span class="ident" id="5695712">list</span><span class="op" id="5695716">,</span>&nbsp;<span class="ident" id="5695718">p</span><span class="op" id="5695719">.</span><span class="ident" id="5695720">parseRhsOrType</span><span class="op" id="5695734">(</span><span class="op" id="5695735">)</span><span class="op" id="5695736">)</span>&nbsp;<span class="comment" id="5695738">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695792">if</span>&nbsp;<span class="ident" id="5695795">p</span><span class="op" id="5695796">.</span><span class="ident" id="5695797">tok</span>&nbsp;<span class="op" id="5695801">==</span>&nbsp;<span class="ident" id="5695804">token</span><span class="op" id="5695809">.</span><span class="ident" id="5695810">ELLIPSIS</span>&nbsp;<span class="op" id="5695819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695824">ellipsis</span>&nbsp;<span class="op" id="5695833">=</span>&nbsp;<span class="ident" id="5695835">p</span><span class="op" id="5695836">.</span><span class="ident" id="5695837">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695844">p</span><span class="op" id="5695845">.</span><span class="ident" id="5695846">next</span><span class="op" id="5695850">(</span><span class="op" id="5695851">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695859">if</span>&nbsp;<span class="op" id="5695862">!</span><span class="ident" id="5695863">p</span><span class="op" id="5695864">.</span><span class="ident" id="5695865">atComma</span><span class="op" id="5695872">(</span><span class="string" id="5695873">&#34;argument&nbsp;list&#34;</span><span class="op" id="5695888">)</span>&nbsp;<span class="op" id="5695890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695895">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695907">p</span><span class="op" id="5695908">.</span><span class="ident" id="5695909">next</span><span class="op" id="5695913">(</span><span class="op" id="5695914">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5695917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695920">p</span><span class="op" id="5695921">.</span><span class="ident" id="5695922">exprLev</span><span class="op" id="5695929">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5695933">rparen</span>&nbsp;<span class="op" id="5695940">:=</span>&nbsp;<span class="ident" id="5695943">p</span><span class="op" id="5695944">.</span><span class="ident" id="5695945">expectClosing</span><span class="op" id="5695958">(</span><span class="ident" id="5695959">token</span><span class="op" id="5695964">.</span><span class="ident" id="5695965">RPAREN</span><span class="op" id="5695971">,</span>&nbsp;<span class="string" id="5695973">&#34;argument&nbsp;list&#34;</span><span class="op" id="5695988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5695992">return</span>&nbsp;<span class="op" id="5695999">&amp;</span><span class="ident" id="5696000">ast</span><span class="op" id="5696003">.</span><span class="ident" id="5696004">CallExpr</span><span class="op" id="5696012">{</span><span class="ident" id="5696013">Fun</span><span class="op" id="5696016">:</span>&nbsp;<span class="ident" id="5696018">fun</span><span class="op" id="5696021">,</span>&nbsp;<span class="ident" id="5696023">Lparen</span><span class="op" id="5696029">:</span>&nbsp;<span class="ident" id="5696031">lparen</span><span class="op" id="5696037">,</span>&nbsp;<span class="ident" id="5696039">Args</span><span class="op" id="5696043">:</span>&nbsp;<span class="ident" id="5696045">list</span><span class="op" id="5696049">,</span>&nbsp;<span class="ident" id="5696051">Ellipsis</span><span class="op" id="5696059">:</span>&nbsp;<span class="ident" id="5696061">ellipsis</span><span class="op" id="5696069">,</span>&nbsp;<span class="ident" id="5696071">Rparen</span><span class="op" id="5696077">:</span>&nbsp;<span class="ident" id="5696079">rparen</span><span class="op" id="5696085">}</span><br>
<span class="lineno">1260</span><span class="op" id="5696087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5696090">func</span>&nbsp;<span class="op" id="5696095">(</span><span class="ident" id="5696096">p</span>&nbsp;<span class="op" id="5696098">*</span><span class="ident" id="5696099">parser</span><span class="op" id="5696105">)</span>&nbsp;<span class="ident" id="5696107">parseElement</span><span class="op" id="5696119">(</span><span class="ident" id="5696120">keyOk</span>&nbsp;<span class="builtintype" id="5696126">bool</span><span class="op" id="5696130">)</span>&nbsp;<span class="ident" id="5696132">ast</span><span class="op" id="5696135">.</span><span class="ident" id="5696136">Expr</span>&nbsp;<span class="op" id="5696141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696144">if</span>&nbsp;<span class="ident" id="5696147">p</span><span class="op" id="5696148">.</span><span class="ident" id="5696149">trace</span>&nbsp;<span class="op" id="5696155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696159">defer</span>&nbsp;<span class="ident" id="5696165">un</span><span class="op" id="5696167">(</span><span class="ident" id="5696168">trace</span><span class="op" id="5696173">(</span><span class="ident" id="5696174">p</span><span class="op" id="5696175">,</span>&nbsp;<span class="string" id="5696177">&#34;Element&#34;</span><span class="op" id="5696186">)</span><span class="op" id="5696187">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696194">if</span>&nbsp;<span class="ident" id="5696197">p</span><span class="op" id="5696198">.</span><span class="ident" id="5696199">tok</span>&nbsp;<span class="op" id="5696203">==</span>&nbsp;<span class="ident" id="5696206">token</span><span class="op" id="5696211">.</span><span class="ident" id="5696212">LBRACE</span>&nbsp;<span class="op" id="5696219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5696223">return</span>&nbsp;<span class="ident" id="5696230">p</span><span class="op" id="5696231">.</span><span class="ident" id="5696232">parseLiteralValue</span><span class="op" id="5696249">(</span><span class="ident" id="5696250">nil</span><span class="op" id="5696253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5696256">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696260">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696334">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696406">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696476">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696490">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696494">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696564">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696633">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696704">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696772">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696839">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696843">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696909">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5696982">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697055">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697128">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697157">x</span>&nbsp;<span class="op" id="5697159">:=</span>&nbsp;<span class="ident" id="5697162">p</span><span class="op" id="5697163">.</span><span class="ident" id="5697164">checkExpr</span><span class="op" id="5697173">(</span><span class="ident" id="5697174">p</span><span class="op" id="5697175">.</span><span class="ident" id="5697176">parseExpr</span><span class="op" id="5697185">(</span><span class="ident" id="5697186">keyOk</span><span class="op" id="5697191">)</span><span class="op" id="5697192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697195">if</span>&nbsp;<span class="ident" id="5697198">keyOk</span>&nbsp;<span class="op" id="5697204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697208">if</span>&nbsp;<span class="ident" id="5697211">p</span><span class="op" id="5697212">.</span><span class="ident" id="5697213">tok</span>&nbsp;<span class="op" id="5697217">==</span>&nbsp;<span class="ident" id="5697220">token</span><span class="op" id="5697225">.</span><span class="ident" id="5697226">COLON</span>&nbsp;<span class="op" id="5697232">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697237">colon</span>&nbsp;<span class="op" id="5697243">:=</span>&nbsp;<span class="ident" id="5697246">p</span><span class="op" id="5697247">.</span><span class="ident" id="5697248">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697255">p</span><span class="op" id="5697256">.</span><span class="ident" id="5697257">next</span><span class="op" id="5697261">(</span><span class="op" id="5697262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697267">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697317">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697368">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5697417">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697441">p</span><span class="op" id="5697442">.</span><span class="ident" id="5697443">tryResolve</span><span class="op" id="5697453">(</span><span class="ident" id="5697454">x</span><span class="op" id="5697455">,</span>&nbsp;<span class="builtintype" id="5697457">false</span><span class="op" id="5697462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697467">return</span>&nbsp;<span class="op" id="5697474">&amp;</span><span class="ident" id="5697475">ast</span><span class="op" id="5697478">.</span><span class="ident" id="5697479">KeyValueExpr</span><span class="op" id="5697491">{</span><span class="ident" id="5697492">Key</span><span class="op" id="5697495">:</span>&nbsp;<span class="ident" id="5697497">x</span><span class="op" id="5697498">,</span>&nbsp;<span class="ident" id="5697500">Colon</span><span class="op" id="5697505">:</span>&nbsp;<span class="ident" id="5697507">colon</span><span class="op" id="5697512">,</span>&nbsp;<span class="ident" id="5697514">Value</span><span class="op" id="5697519">:</span>&nbsp;<span class="ident" id="5697521">p</span><span class="op" id="5697522">.</span><span class="ident" id="5697523">parseElement</span><span class="op" id="5697535">(</span><span class="builtintype" id="5697536">false</span><span class="op" id="5697541">)</span><span class="op" id="5697542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697550">p</span><span class="op" id="5697551">.</span><span class="ident" id="5697552">resolve</span><span class="op" id="5697559">(</span><span class="ident" id="5697560">x</span><span class="op" id="5697561">)</span>&nbsp;<span class="comment" id="5697563">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697581">return</span>&nbsp;<span class="ident" id="5697588">x</span><br>
<span class="lineno"></span><span class="op" id="5697590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="5697593">func</span>&nbsp;<span class="op" id="5697598">(</span><span class="ident" id="5697599">p</span>&nbsp;<span class="op" id="5697601">*</span><span class="ident" id="5697602">parser</span><span class="op" id="5697608">)</span>&nbsp;<span class="ident" id="5697610">parseElementList</span><span class="op" id="5697626">(</span><span class="op" id="5697627">)</span>&nbsp;<span class="op" id="5697629">(</span><span class="ident" id="5697630">list</span>&nbsp;<span class="op" id="5697635">[</span><span class="op" id="5697636">]</span><span class="ident" id="5697637">ast</span><span class="op" id="5697640">.</span><span class="ident" id="5697641">Expr</span><span class="op" id="5697645">)</span>&nbsp;<span class="op" id="5697647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697650">if</span>&nbsp;<span class="ident" id="5697653">p</span><span class="op" id="5697654">.</span><span class="ident" id="5697655">trace</span>&nbsp;<span class="op" id="5697661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697665">defer</span>&nbsp;<span class="ident" id="5697671">un</span><span class="op" id="5697673">(</span><span class="ident" id="5697674">trace</span><span class="op" id="5697679">(</span><span class="ident" id="5697680">p</span><span class="op" id="5697681">,</span>&nbsp;<span class="string" id="5697683">&#34;ElementList&#34;</span><span class="op" id="5697696">)</span><span class="op" id="5697697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697704">for</span>&nbsp;<span class="ident" id="5697708">p</span><span class="op" id="5697709">.</span><span class="ident" id="5697710">tok</span>&nbsp;<span class="op" id="5697714">!=</span>&nbsp;<span class="ident" id="5697717">token</span><span class="op" id="5697722">.</span><span class="ident" id="5697723">RBRACE</span>&nbsp;<span class="op" id="5697730">&amp;&amp;</span>&nbsp;<span class="ident" id="5697733">p</span><span class="op" id="5697734">.</span><span class="ident" id="5697735">tok</span>&nbsp;<span class="op" id="5697739">!=</span>&nbsp;<span class="ident" id="5697742">token</span><span class="op" id="5697747">.</span><span class="ident" id="5697748">EOF</span>&nbsp;<span class="op" id="5697752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697756">list</span>&nbsp;<span class="op" id="5697761">=</span>&nbsp;<span class="builtinfunc" id="5697763">append</span><span class="op" id="5697769">(</span><span class="ident" id="5697770">list</span><span class="op" id="5697774">,</span>&nbsp;<span class="ident" id="5697776">p</span><span class="op" id="5697777">.</span><span class="ident" id="5697778">parseElement</span><span class="op" id="5697790">(</span><span class="builtintype" id="5697791">true</span><span class="op" id="5697795">)</span><span class="op" id="5697796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697800">if</span>&nbsp;<span class="op" id="5697803">!</span><span class="ident" id="5697804">p</span><span class="op" id="5697805">.</span><span class="ident" id="5697806">atComma</span><span class="op" id="5697813">(</span><span class="string" id="5697814">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5697833">)</span>&nbsp;<span class="op" id="5697835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697840">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697848">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697852">p</span><span class="op" id="5697853">.</span><span class="ident" id="5697854">next</span><span class="op" id="5697858">(</span><span class="op" id="5697859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697866">return</span><br>
<span class="lineno"></span><span class="op" id="5697873">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="5697876">func</span>&nbsp;<span class="op" id="5697881">(</span><span class="ident" id="5697882">p</span>&nbsp;<span class="op" id="5697884">*</span><span class="ident" id="5697885">parser</span><span class="op" id="5697891">)</span>&nbsp;<span class="ident" id="5697893">parseLiteralValue</span><span class="op" id="5697910">(</span><span class="ident" id="5697911">typ</span>&nbsp;<span class="ident" id="5697915">ast</span><span class="op" id="5697918">.</span><span class="ident" id="5697919">Expr</span><span class="op" id="5697923">)</span>&nbsp;<span class="ident" id="5697925">ast</span><span class="op" id="5697928">.</span><span class="ident" id="5697929">Expr</span>&nbsp;<span class="op" id="5697934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697937">if</span>&nbsp;<span class="ident" id="5697940">p</span><span class="op" id="5697941">.</span><span class="ident" id="5697942">trace</span>&nbsp;<span class="op" id="5697948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5697952">defer</span>&nbsp;<span class="ident" id="5697958">un</span><span class="op" id="5697960">(</span><span class="ident" id="5697961">trace</span><span class="op" id="5697966">(</span><span class="ident" id="5697967">p</span><span class="op" id="5697968">,</span>&nbsp;<span class="string" id="5697970">&#34;LiteralValue&#34;</span><span class="op" id="5697984">)</span><span class="op" id="5697985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5697988">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5697992">lbrace</span>&nbsp;<span class="op" id="5697999">:=</span>&nbsp;<span class="ident" id="5698002">p</span><span class="op" id="5698003">.</span><span class="ident" id="5698004">expect</span><span class="op" id="5698010">(</span><span class="ident" id="5698011">token</span><span class="op" id="5698016">.</span><span class="ident" id="5698017">LBRACE</span><span class="op" id="5698023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698026">var</span>&nbsp;<span class="ident" id="5698030">elts</span>&nbsp;<span class="op" id="5698035">[</span><span class="op" id="5698036">]</span><span class="ident" id="5698037">ast</span><span class="op" id="5698040">.</span><span class="ident" id="5698041">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698047">p</span><span class="op" id="5698048">.</span><span class="ident" id="5698049">exprLev</span><span class="op" id="5698056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698060">if</span>&nbsp;<span class="ident" id="5698063">p</span><span class="op" id="5698064">.</span><span class="ident" id="5698065">tok</span>&nbsp;<span class="op" id="5698069">!=</span>&nbsp;<span class="ident" id="5698072">token</span><span class="op" id="5698077">.</span><span class="ident" id="5698078">RBRACE</span>&nbsp;<span class="op" id="5698085">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698089">elts</span>&nbsp;<span class="op" id="5698094">=</span>&nbsp;<span class="ident" id="5698096">p</span><span class="op" id="5698097">.</span><span class="ident" id="5698098">parseElementList</span><span class="op" id="5698114">(</span><span class="op" id="5698115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5698118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698121">p</span><span class="op" id="5698122">.</span><span class="ident" id="5698123">exprLev</span><span class="op" id="5698130">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5698134">rbrace</span>&nbsp;<span class="op" id="5698141">:=</span>&nbsp;<span class="ident" id="5698144">p</span><span class="op" id="5698145">.</span><span class="ident" id="5698146">expectClosing</span><span class="op" id="5698159">(</span><span class="ident" id="5698160">token</span><span class="op" id="5698165">.</span><span class="ident" id="5698166">RBRACE</span><span class="op" id="5698172">,</span>&nbsp;<span class="string" id="5698174">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5698193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698196">return</span>&nbsp;<span class="op" id="5698203">&amp;</span><span class="ident" id="5698204">ast</span><span class="op" id="5698207">.</span><span class="ident" id="5698208">CompositeLit</span><span class="op" id="5698220">{</span><span class="ident" id="5698221">Type</span><span class="op" id="5698225">:</span>&nbsp;<span class="ident" id="5698227">typ</span><span class="op" id="5698230">,</span>&nbsp;<span class="ident" id="5698232">Lbrace</span><span class="op" id="5698238">:</span>&nbsp;<span class="ident" id="5698240">lbrace</span><span class="op" id="5698246">,</span>&nbsp;<span class="ident" id="5698248">Elts</span><span class="op" id="5698252">:</span>&nbsp;<span class="ident" id="5698254">elts</span><span class="op" id="5698258">,</span>&nbsp;<span class="ident" id="5698260">Rbrace</span><span class="op" id="5698266">:</span>&nbsp;<span class="ident" id="5698268">rbrace</span><span class="op" id="5698274">}</span><br>
<span class="lineno">1335</span><span class="op" id="5698276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5698279">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5698341">func</span>&nbsp;<span class="op" id="5698346">(</span><span class="ident" id="5698347">p</span>&nbsp;<span class="op" id="5698349">*</span><span class="ident" id="5698350">parser</span><span class="op" id="5698356">)</span>&nbsp;<span class="ident" id="5698358">checkExpr</span><span class="op" id="5698367">(</span><span class="ident" id="5698368">x</span>&nbsp;<span class="ident" id="5698370">ast</span><span class="op" id="5698373">.</span><span class="ident" id="5698374">Expr</span><span class="op" id="5698378">)</span>&nbsp;<span class="ident" id="5698380">ast</span><span class="op" id="5698383">.</span><span class="ident" id="5698384">Expr</span>&nbsp;<span class="op" id="5698389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698392">switch</span>&nbsp;<span class="ident" id="5698399">unparen</span><span class="op" id="5698406">(</span><span class="ident" id="5698407">x</span><span class="op" id="5698408">)</span><span class="op" id="5698409">.</span><span class="op" id="5698410">(</span><span class="keyword" id="5698411">type</span><span class="op" id="5698415">)</span>&nbsp;<span class="op" id="5698417">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698420">case</span>&nbsp;<span class="op" id="5698425">*</span><span class="ident" id="5698426">ast</span><span class="op" id="5698429">.</span><span class="ident" id="5698430">BadExpr</span><span class="op" id="5698437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698440">case</span>&nbsp;<span class="op" id="5698445">*</span><span class="ident" id="5698446">ast</span><span class="op" id="5698449">.</span><span class="ident" id="5698450">Ident</span><span class="op" id="5698455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698458">case</span>&nbsp;<span class="op" id="5698463">*</span><span class="ident" id="5698464">ast</span><span class="op" id="5698467">.</span><span class="ident" id="5698468">BasicLit</span><span class="op" id="5698476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698479">case</span>&nbsp;<span class="op" id="5698484">*</span><span class="ident" id="5698485">ast</span><span class="op" id="5698488">.</span><span class="ident" id="5698489">FuncLit</span><span class="op" id="5698496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698499">case</span>&nbsp;<span class="op" id="5698504">*</span><span class="ident" id="5698505">ast</span><span class="op" id="5698508">.</span><span class="ident" id="5698509">CompositeLit</span><span class="op" id="5698521">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698524">case</span>&nbsp;<span class="op" id="5698529">*</span><span class="ident" id="5698530">ast</span><span class="op" id="5698533">.</span><span class="ident" id="5698534">ParenExpr</span><span class="op" id="5698543">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5698547">panic</span><span class="op" id="5698552">(</span><span class="string" id="5698553">&#34;unreachable&#34;</span><span class="op" id="5698566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698569">case</span>&nbsp;<span class="op" id="5698574">*</span><span class="ident" id="5698575">ast</span><span class="op" id="5698578">.</span><span class="ident" id="5698579">SelectorExpr</span><span class="op" id="5698591">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698594">case</span>&nbsp;<span class="op" id="5698599">*</span><span class="ident" id="5698600">ast</span><span class="op" id="5698603">.</span><span class="ident" id="5698604">IndexExpr</span><span class="op" id="5698613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698616">case</span>&nbsp;<span class="op" id="5698621">*</span><span class="ident" id="5698622">ast</span><span class="op" id="5698625">.</span><span class="ident" id="5698626">SliceExpr</span><span class="op" id="5698635">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698638">case</span>&nbsp;<span class="op" id="5698643">*</span><span class="ident" id="5698644">ast</span><span class="op" id="5698647">.</span><span class="ident" id="5698648">TypeAssertExpr</span><span class="op" id="5698662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698666">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698725">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698790">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698855">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5698920">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698933">case</span>&nbsp;<span class="op" id="5698938">*</span><span class="ident" id="5698939">ast</span><span class="op" id="5698942">.</span><span class="ident" id="5698943">CallExpr</span><span class="op" id="5698951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698954">case</span>&nbsp;<span class="op" id="5698959">*</span><span class="ident" id="5698960">ast</span><span class="op" id="5698963">.</span><span class="ident" id="5698964">StarExpr</span><span class="op" id="5698972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698975">case</span>&nbsp;<span class="op" id="5698980">*</span><span class="ident" id="5698981">ast</span><span class="op" id="5698984">.</span><span class="ident" id="5698985">UnaryExpr</span><span class="op" id="5698994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5698997">case</span>&nbsp;<span class="op" id="5699002">*</span><span class="ident" id="5699003">ast</span><span class="op" id="5699006">.</span><span class="ident" id="5699007">BinaryExpr</span><span class="op" id="5699017">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699020">default</span><span class="op" id="5699027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5699031">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699079">p</span><span class="op" id="5699080">.</span><span class="ident" id="5699081">errorExpected</span><span class="op" id="5699094">(</span><span class="ident" id="5699095">x</span><span class="op" id="5699096">.</span><span class="ident" id="5699097">Pos</span><span class="op" id="5699100">(</span><span class="op" id="5699101">)</span><span class="op" id="5699102">,</span>&nbsp;<span class="string" id="5699104">&#34;expression&#34;</span><span class="op" id="5699116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699120">x</span>&nbsp;<span class="op" id="5699122">=</span>&nbsp;<span class="op" id="5699124">&amp;</span><span class="ident" id="5699125">ast</span><span class="op" id="5699128">.</span><span class="ident" id="5699129">BadExpr</span><span class="op" id="5699136">{</span><span class="ident" id="5699137">From</span><span class="op" id="5699141">:</span>&nbsp;<span class="ident" id="5699143">x</span><span class="op" id="5699144">.</span><span class="ident" id="5699145">Pos</span><span class="op" id="5699148">(</span><span class="op" id="5699149">)</span><span class="op" id="5699150">,</span>&nbsp;<span class="ident" id="5699152">To</span><span class="op" id="5699154">:</span>&nbsp;<span class="ident" id="5699156">p</span><span class="op" id="5699157">.</span><span class="ident" id="5699158">safePos</span><span class="op" id="5699165">(</span><span class="ident" id="5699166">x</span><span class="op" id="5699167">.</span><span class="ident" id="5699168">End</span><span class="op" id="5699171">(</span><span class="op" id="5699172">)</span><span class="op" id="5699173">)</span><span class="op" id="5699174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699177">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699180">return</span>&nbsp;<span class="ident" id="5699187">x</span><br>
<span class="lineno"></span><span class="op" id="5699189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5699192">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5699252">func</span>&nbsp;<span class="ident" id="5699257">isTypeName</span><span class="op" id="5699267">(</span><span class="ident" id="5699268">x</span>&nbsp;<span class="ident" id="5699270">ast</span><span class="op" id="5699273">.</span><span class="ident" id="5699274">Expr</span><span class="op" id="5699278">)</span>&nbsp;<span class="builtintype" id="5699280">bool</span>&nbsp;<span class="op" id="5699285">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699288">switch</span>&nbsp;<span class="ident" id="5699295">t</span>&nbsp;<span class="op" id="5699297">:=</span>&nbsp;<span class="ident" id="5699300">x</span><span class="op" id="5699301">.</span><span class="op" id="5699302">(</span><span class="keyword" id="5699303">type</span><span class="op" id="5699307">)</span>&nbsp;<span class="op" id="5699309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699312">case</span>&nbsp;<span class="op" id="5699317">*</span><span class="ident" id="5699318">ast</span><span class="op" id="5699321">.</span><span class="ident" id="5699322">BadExpr</span><span class="op" id="5699329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699332">case</span>&nbsp;<span class="op" id="5699337">*</span><span class="ident" id="5699338">ast</span><span class="op" id="5699341">.</span><span class="ident" id="5699342">Ident</span><span class="op" id="5699347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699350">case</span>&nbsp;<span class="op" id="5699355">*</span><span class="ident" id="5699356">ast</span><span class="op" id="5699359">.</span><span class="ident" id="5699360">SelectorExpr</span><span class="op" id="5699372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699376">_</span><span class="op" id="5699377">,</span>&nbsp;<span class="ident" id="5699379">isIdent</span>&nbsp;<span class="op" id="5699387">:=</span>&nbsp;<span class="ident" id="5699390">t</span><span class="op" id="5699391">.</span><span class="ident" id="5699392">X</span><span class="op" id="5699393">.</span><span class="op" id="5699394">(</span><span class="op" id="5699395">*</span><span class="ident" id="5699396">ast</span><span class="op" id="5699399">.</span><span class="ident" id="5699400">Ident</span><span class="op" id="5699405">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699409">return</span>&nbsp;<span class="ident" id="5699416">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699425">default</span><span class="op" id="5699432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699436">return</span>&nbsp;<span class="builtintype" id="5699443">false</span>&nbsp;<span class="comment" id="5699449">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699491">return</span>&nbsp;<span class="builtintype" id="5699498">true</span><br>
<span class="lineno">1380</span><span class="op" id="5699503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5699506">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5699577">func</span>&nbsp;<span class="ident" id="5699582">isLiteralType</span><span class="op" id="5699595">(</span><span class="ident" id="5699596">x</span>&nbsp;<span class="ident" id="5699598">ast</span><span class="op" id="5699601">.</span><span class="ident" id="5699602">Expr</span><span class="op" id="5699606">)</span>&nbsp;<span class="builtintype" id="5699608">bool</span>&nbsp;<span class="op" id="5699613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699616">switch</span>&nbsp;<span class="ident" id="5699623">t</span>&nbsp;<span class="op" id="5699625">:=</span>&nbsp;<span class="ident" id="5699628">x</span><span class="op" id="5699629">.</span><span class="op" id="5699630">(</span><span class="keyword" id="5699631">type</span><span class="op" id="5699635">)</span>&nbsp;<span class="op" id="5699637">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699640">case</span>&nbsp;<span class="op" id="5699645">*</span><span class="ident" id="5699646">ast</span><span class="op" id="5699649">.</span><span class="ident" id="5699650">BadExpr</span><span class="op" id="5699657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699660">case</span>&nbsp;<span class="op" id="5699665">*</span><span class="ident" id="5699666">ast</span><span class="op" id="5699669">.</span><span class="ident" id="5699670">Ident</span><span class="op" id="5699675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699678">case</span>&nbsp;<span class="op" id="5699683">*</span><span class="ident" id="5699684">ast</span><span class="op" id="5699687">.</span><span class="ident" id="5699688">SelectorExpr</span><span class="op" id="5699700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5699704">_</span><span class="op" id="5699705">,</span>&nbsp;<span class="ident" id="5699707">isIdent</span>&nbsp;<span class="op" id="5699715">:=</span>&nbsp;<span class="ident" id="5699718">t</span><span class="op" id="5699719">.</span><span class="ident" id="5699720">X</span><span class="op" id="5699721">.</span><span class="op" id="5699722">(</span><span class="op" id="5699723">*</span><span class="ident" id="5699724">ast</span><span class="op" id="5699727">.</span><span class="ident" id="5699728">Ident</span><span class="op" id="5699733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699737">return</span>&nbsp;<span class="ident" id="5699744">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699753">case</span>&nbsp;<span class="op" id="5699758">*</span><span class="ident" id="5699759">ast</span><span class="op" id="5699762">.</span><span class="ident" id="5699763">ArrayType</span><span class="op" id="5699772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699775">case</span>&nbsp;<span class="op" id="5699780">*</span><span class="ident" id="5699781">ast</span><span class="op" id="5699784">.</span><span class="ident" id="5699785">StructType</span><span class="op" id="5699795">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699798">case</span>&nbsp;<span class="op" id="5699803">*</span><span class="ident" id="5699804">ast</span><span class="op" id="5699807">.</span><span class="ident" id="5699808">MapType</span><span class="op" id="5699815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699818">default</span><span class="op" id="5699825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699829">return</span>&nbsp;<span class="builtintype" id="5699836">false</span>&nbsp;<span class="comment" id="5699842">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5699900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5699903">return</span>&nbsp;<span class="builtintype" id="5699910">true</span><br>
<span class="lineno"></span><span class="op" id="5699915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5699918">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5699986">func</span>&nbsp;<span class="ident" id="5699991">deref</span><span class="op" id="5699996">(</span><span class="ident" id="5699997">x</span>&nbsp;<span class="ident" id="5699999">ast</span><span class="op" id="5700002">.</span><span class="ident" id="5700003">Expr</span><span class="op" id="5700007">)</span>&nbsp;<span class="ident" id="5700009">ast</span><span class="op" id="5700012">.</span><span class="ident" id="5700013">Expr</span>&nbsp;<span class="op" id="5700018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700021">if</span>&nbsp;<span class="ident" id="5700024">p</span><span class="op" id="5700025">,</span>&nbsp;<span class="ident" id="5700027">isPtr</span>&nbsp;<span class="op" id="5700033">:=</span>&nbsp;<span class="ident" id="5700036">x</span><span class="op" id="5700037">.</span><span class="op" id="5700038">(</span><span class="op" id="5700039">*</span><span class="ident" id="5700040">ast</span><span class="op" id="5700043">.</span><span class="ident" id="5700044">StarExpr</span><span class="op" id="5700052">)</span><span class="op" id="5700053">;</span>&nbsp;<span class="ident" id="5700055">isPtr</span>&nbsp;<span class="op" id="5700061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700065">x</span>&nbsp;<span class="op" id="5700067">=</span>&nbsp;<span class="ident" id="5700069">p</span><span class="op" id="5700070">.</span><span class="ident" id="5700071">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700077">return</span>&nbsp;<span class="ident" id="5700084">x</span><br>
<span class="lineno">1405</span><span class="op" id="5700086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700089">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5700169">func</span>&nbsp;<span class="ident" id="5700174">unparen</span><span class="op" id="5700181">(</span><span class="ident" id="5700182">x</span>&nbsp;<span class="ident" id="5700184">ast</span><span class="op" id="5700187">.</span><span class="ident" id="5700188">Expr</span><span class="op" id="5700192">)</span>&nbsp;<span class="ident" id="5700194">ast</span><span class="op" id="5700197">.</span><span class="ident" id="5700198">Expr</span>&nbsp;<span class="op" id="5700203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700206">if</span>&nbsp;<span class="ident" id="5700209">p</span><span class="op" id="5700210">,</span>&nbsp;<span class="ident" id="5700212">isParen</span>&nbsp;<span class="op" id="5700220">:=</span>&nbsp;<span class="ident" id="5700223">x</span><span class="op" id="5700224">.</span><span class="op" id="5700225">(</span><span class="op" id="5700226">*</span><span class="ident" id="5700227">ast</span><span class="op" id="5700230">.</span><span class="ident" id="5700231">ParenExpr</span><span class="op" id="5700240">)</span><span class="op" id="5700241">;</span>&nbsp;<span class="ident" id="5700243">isParen</span>&nbsp;<span class="op" id="5700251">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700255">x</span>&nbsp;<span class="op" id="5700257">=</span>&nbsp;<span class="ident" id="5700259">unparen</span><span class="op" id="5700266">(</span><span class="ident" id="5700267">p</span><span class="op" id="5700268">.</span><span class="ident" id="5700269">X</span><span class="op" id="5700270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700276">return</span>&nbsp;<span class="ident" id="5700283">x</span><br>
<span class="lineno"></span><span class="op" id="5700285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5700288">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5700348">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5700388">//</span><br>
<span class="lineno"></span><span class="keyword" id="5700391">func</span>&nbsp;<span class="op" id="5700396">(</span><span class="ident" id="5700397">p</span>&nbsp;<span class="op" id="5700399">*</span><span class="ident" id="5700400">parser</span><span class="op" id="5700406">)</span>&nbsp;<span class="ident" id="5700408">checkExprOrType</span><span class="op" id="5700423">(</span><span class="ident" id="5700424">x</span>&nbsp;<span class="ident" id="5700426">ast</span><span class="op" id="5700429">.</span><span class="ident" id="5700430">Expr</span><span class="op" id="5700434">)</span>&nbsp;<span class="ident" id="5700436">ast</span><span class="op" id="5700439">.</span><span class="ident" id="5700440">Expr</span>&nbsp;<span class="op" id="5700445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700448">switch</span>&nbsp;<span class="ident" id="5700455">t</span>&nbsp;<span class="op" id="5700457">:=</span>&nbsp;<span class="ident" id="5700460">unparen</span><span class="op" id="5700467">(</span><span class="ident" id="5700468">x</span><span class="op" id="5700469">)</span><span class="op" id="5700470">.</span><span class="op" id="5700471">(</span><span class="keyword" id="5700472">type</span><span class="op" id="5700476">)</span>&nbsp;<span class="op" id="5700478">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700481">case</span>&nbsp;<span class="op" id="5700486">*</span><span class="ident" id="5700487">ast</span><span class="op" id="5700490">.</span><span class="ident" id="5700491">ParenExpr</span><span class="op" id="5700500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5700504">panic</span><span class="op" id="5700509">(</span><span class="string" id="5700510">&#34;unreachable&#34;</span><span class="op" id="5700523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700526">case</span>&nbsp;<span class="op" id="5700531">*</span><span class="ident" id="5700532">ast</span><span class="op" id="5700535">.</span><span class="ident" id="5700536">UnaryExpr</span><span class="op" id="5700545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700548">case</span>&nbsp;<span class="op" id="5700553">*</span><span class="ident" id="5700554">ast</span><span class="op" id="5700557">.</span><span class="ident" id="5700558">ArrayType</span><span class="op" id="5700567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700571">if</span>&nbsp;<span class="builtinfunc" id="5700574">len</span><span class="op" id="5700577">,</span>&nbsp;<span class="ident" id="5700579">isEllipsis</span>&nbsp;<span class="op" id="5700590">:=</span>&nbsp;<span class="ident" id="5700593">t</span><span class="op" id="5700594">.</span><span class="ident" id="5700595">Len</span><span class="op" id="5700598">.</span><span class="op" id="5700599">(</span><span class="op" id="5700600">*</span><span class="ident" id="5700601">ast</span><span class="op" id="5700604">.</span><span class="ident" id="5700605">Ellipsis</span><span class="op" id="5700613">)</span><span class="op" id="5700614">;</span>&nbsp;<span class="ident" id="5700616">isEllipsis</span>&nbsp;<span class="op" id="5700627">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700632">p</span><span class="op" id="5700633">.</span><span class="builtintype" id="5700634">error</span><span class="op" id="5700639">(</span><span class="builtinfunc" id="5700640">len</span><span class="op" id="5700643">.</span><span class="ident" id="5700644">Pos</span><span class="op" id="5700647">(</span><span class="op" id="5700648">)</span><span class="op" id="5700649">,</span>&nbsp;<span class="string" id="5700651">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5700687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700692">x</span>&nbsp;<span class="op" id="5700694">=</span>&nbsp;<span class="op" id="5700696">&amp;</span><span class="ident" id="5700697">ast</span><span class="op" id="5700700">.</span><span class="ident" id="5700701">BadExpr</span><span class="op" id="5700708">{</span><span class="ident" id="5700709">From</span><span class="op" id="5700713">:</span>&nbsp;<span class="ident" id="5700715">x</span><span class="op" id="5700716">.</span><span class="ident" id="5700717">Pos</span><span class="op" id="5700720">(</span><span class="op" id="5700721">)</span><span class="op" id="5700722">,</span>&nbsp;<span class="ident" id="5700724">To</span><span class="op" id="5700726">:</span>&nbsp;<span class="ident" id="5700728">p</span><span class="op" id="5700729">.</span><span class="ident" id="5700730">safePos</span><span class="op" id="5700737">(</span><span class="ident" id="5700738">x</span><span class="op" id="5700739">.</span><span class="ident" id="5700740">End</span><span class="op" id="5700743">(</span><span class="op" id="5700744">)</span><span class="op" id="5700745">)</span><span class="op" id="5700746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5700757">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700802">return</span>&nbsp;<span class="ident" id="5700809">x</span><br>
<span class="lineno"></span><span class="op" id="5700811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5700814">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5700884">func</span>&nbsp;<span class="op" id="5700889">(</span><span class="ident" id="5700890">p</span>&nbsp;<span class="op" id="5700892">*</span><span class="ident" id="5700893">parser</span><span class="op" id="5700899">)</span>&nbsp;<span class="ident" id="5700901">parsePrimaryExpr</span><span class="op" id="5700917">(</span><span class="ident" id="5700918">lhs</span>&nbsp;<span class="builtintype" id="5700922">bool</span><span class="op" id="5700926">)</span>&nbsp;<span class="ident" id="5700928">ast</span><span class="op" id="5700931">.</span><span class="ident" id="5700932">Expr</span>&nbsp;<span class="op" id="5700937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700940">if</span>&nbsp;<span class="ident" id="5700943">p</span><span class="op" id="5700944">.</span><span class="ident" id="5700945">trace</span>&nbsp;<span class="op" id="5700951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5700955">defer</span>&nbsp;<span class="ident" id="5700961">un</span><span class="op" id="5700963">(</span><span class="ident" id="5700964">trace</span><span class="op" id="5700969">(</span><span class="ident" id="5700970">p</span><span class="op" id="5700971">,</span>&nbsp;<span class="string" id="5700973">&#34;PrimaryExpr&#34;</span><span class="op" id="5700986">)</span><span class="op" id="5700987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5700990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5700994">x</span>&nbsp;<span class="op" id="5700996">:=</span>&nbsp;<span class="ident" id="5700999">p</span><span class="op" id="5701000">.</span><span class="ident" id="5701001">parseOperand</span><span class="op" id="5701013">(</span><span class="ident" id="5701014">lhs</span><span class="op" id="5701017">)</span><br>
<span class="lineno"></span><span class="ident" id="5701019">L</span><span class="op" id="5701020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701023">for</span>&nbsp;<span class="op" id="5701027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701031">switch</span>&nbsp;<span class="ident" id="5701038">p</span><span class="op" id="5701039">.</span><span class="ident" id="5701040">tok</span>&nbsp;<span class="op" id="5701044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701048">case</span>&nbsp;<span class="ident" id="5701053">token</span><span class="op" id="5701058">.</span><span class="ident" id="5701059">PERIOD</span><span class="op" id="5701065">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701070">p</span><span class="op" id="5701071">.</span><span class="ident" id="5701072">next</span><span class="op" id="5701076">(</span><span class="op" id="5701077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701082">if</span>&nbsp;<span class="ident" id="5701085">lhs</span>&nbsp;<span class="op" id="5701089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701095">p</span><span class="op" id="5701096">.</span><span class="ident" id="5701097">resolve</span><span class="op" id="5701104">(</span><span class="ident" id="5701105">x</span><span class="op" id="5701106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701116">switch</span>&nbsp;<span class="ident" id="5701123">p</span><span class="op" id="5701124">.</span><span class="ident" id="5701125">tok</span>&nbsp;<span class="op" id="5701129">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701134">case</span>&nbsp;<span class="ident" id="5701139">token</span><span class="op" id="5701144">.</span><span class="ident" id="5701145">IDENT</span><span class="op" id="5701150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701156">x</span>&nbsp;<span class="op" id="5701158">=</span>&nbsp;<span class="ident" id="5701160">p</span><span class="op" id="5701161">.</span><span class="ident" id="5701162">parseSelector</span><span class="op" id="5701175">(</span><span class="ident" id="5701176">p</span><span class="op" id="5701177">.</span><span class="ident" id="5701178">checkExprOrType</span><span class="op" id="5701193">(</span><span class="ident" id="5701194">x</span><span class="op" id="5701195">)</span><span class="op" id="5701196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701201">case</span>&nbsp;<span class="ident" id="5701206">token</span><span class="op" id="5701211">.</span><span class="ident" id="5701212">LPAREN</span><span class="op" id="5701218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701224">x</span>&nbsp;<span class="op" id="5701226">=</span>&nbsp;<span class="ident" id="5701228">p</span><span class="op" id="5701229">.</span><span class="ident" id="5701230">parseTypeAssertion</span><span class="op" id="5701248">(</span><span class="ident" id="5701249">p</span><span class="op" id="5701250">.</span><span class="ident" id="5701251">checkExpr</span><span class="op" id="5701260">(</span><span class="ident" id="5701261">x</span><span class="op" id="5701262">)</span><span class="op" id="5701263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701268">default</span><span class="op" id="5701275">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701281">pos</span>&nbsp;<span class="op" id="5701285">:=</span>&nbsp;<span class="ident" id="5701288">p</span><span class="op" id="5701289">.</span><span class="ident" id="5701290">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701298">p</span><span class="op" id="5701299">.</span><span class="ident" id="5701300">errorExpected</span><span class="op" id="5701313">(</span><span class="ident" id="5701314">pos</span><span class="op" id="5701317">,</span>&nbsp;<span class="string" id="5701319">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5701347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701353">p</span><span class="op" id="5701354">.</span><span class="ident" id="5701355">next</span><span class="op" id="5701359">(</span><span class="op" id="5701360">)</span>&nbsp;<span class="comment" id="5701362">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701383">x</span>&nbsp;<span class="op" id="5701385">=</span>&nbsp;<span class="op" id="5701387">&amp;</span><span class="ident" id="5701388">ast</span><span class="op" id="5701391">.</span><span class="ident" id="5701392">BadExpr</span><span class="op" id="5701399">{</span><span class="ident" id="5701400">From</span><span class="op" id="5701404">:</span>&nbsp;<span class="ident" id="5701406">pos</span><span class="op" id="5701409">,</span>&nbsp;<span class="ident" id="5701411">To</span><span class="op" id="5701413">:</span>&nbsp;<span class="ident" id="5701415">p</span><span class="op" id="5701416">.</span><span class="ident" id="5701417">pos</span><span class="op" id="5701420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701425">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701429">case</span>&nbsp;<span class="ident" id="5701434">token</span><span class="op" id="5701439">.</span><span class="ident" id="5701440">LBRACK</span><span class="op" id="5701446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701451">if</span>&nbsp;<span class="ident" id="5701454">lhs</span>&nbsp;<span class="op" id="5701458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701464">p</span><span class="op" id="5701465">.</span><span class="ident" id="5701466">resolve</span><span class="op" id="5701473">(</span><span class="ident" id="5701474">x</span><span class="op" id="5701475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701485">x</span>&nbsp;<span class="op" id="5701487">=</span>&nbsp;<span class="ident" id="5701489">p</span><span class="op" id="5701490">.</span><span class="ident" id="5701491">parseIndexOrSlice</span><span class="op" id="5701508">(</span><span class="ident" id="5701509">p</span><span class="op" id="5701510">.</span><span class="ident" id="5701511">checkExpr</span><span class="op" id="5701520">(</span><span class="ident" id="5701521">x</span><span class="op" id="5701522">)</span><span class="op" id="5701523">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701527">case</span>&nbsp;<span class="ident" id="5701532">token</span><span class="op" id="5701537">.</span><span class="ident" id="5701538">LPAREN</span><span class="op" id="5701544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701549">if</span>&nbsp;<span class="ident" id="5701552">lhs</span>&nbsp;<span class="op" id="5701556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701562">p</span><span class="op" id="5701563">.</span><span class="ident" id="5701564">resolve</span><span class="op" id="5701571">(</span><span class="ident" id="5701572">x</span><span class="op" id="5701573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701583">x</span>&nbsp;<span class="op" id="5701585">=</span>&nbsp;<span class="ident" id="5701587">p</span><span class="op" id="5701588">.</span><span class="ident" id="5701589">parseCallOrConversion</span><span class="op" id="5701610">(</span><span class="ident" id="5701611">p</span><span class="op" id="5701612">.</span><span class="ident" id="5701613">checkExprOrType</span><span class="op" id="5701628">(</span><span class="ident" id="5701629">x</span><span class="op" id="5701630">)</span><span class="op" id="5701631">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701635">case</span>&nbsp;<span class="ident" id="5701640">token</span><span class="op" id="5701645">.</span><span class="ident" id="5701646">LBRACE</span><span class="op" id="5701652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701657">if</span>&nbsp;<span class="ident" id="5701660">isLiteralType</span><span class="op" id="5701673">(</span><span class="ident" id="5701674">x</span><span class="op" id="5701675">)</span>&nbsp;<span class="op" id="5701677">&amp;&amp;</span>&nbsp;<span class="op" id="5701680">(</span><span class="ident" id="5701681">p</span><span class="op" id="5701682">.</span><span class="ident" id="5701683">exprLev</span>&nbsp;<span class="op" id="5701691">&gt;=</span>&nbsp;<span class="num" id="5701694">0</span>&nbsp;<span class="op" id="5701696">||</span>&nbsp;<span class="op" id="5701699">!</span><span class="ident" id="5701700">isTypeName</span><span class="op" id="5701710">(</span><span class="ident" id="5701711">x</span><span class="op" id="5701712">)</span><span class="op" id="5701713">)</span>&nbsp;<span class="op" id="5701715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701721">if</span>&nbsp;<span class="ident" id="5701724">lhs</span>&nbsp;<span class="op" id="5701728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701735">p</span><span class="op" id="5701736">.</span><span class="ident" id="5701737">resolve</span><span class="op" id="5701744">(</span><span class="ident" id="5701745">x</span><span class="op" id="5701746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701752">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701758">x</span>&nbsp;<span class="op" id="5701760">=</span>&nbsp;<span class="ident" id="5701762">p</span><span class="op" id="5701763">.</span><span class="ident" id="5701764">parseLiteralValue</span><span class="op" id="5701781">(</span><span class="ident" id="5701782">x</span><span class="op" id="5701783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701788">}</span>&nbsp;<span class="keyword" id="5701790">else</span>&nbsp;<span class="op" id="5701795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701801">break</span>&nbsp;<span class="ident" id="5701807">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701816">default</span><span class="op" id="5701823">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701828">break</span>&nbsp;<span class="ident" id="5701834">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5701842">lhs</span>&nbsp;<span class="op" id="5701846">=</span>&nbsp;<span class="builtintype" id="5701848">false</span>&nbsp;<span class="comment" id="5701854">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5701890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5701894">return</span>&nbsp;<span class="ident" id="5701901">x</span><br>
<span class="lineno"></span><span class="op" id="5701903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5701906">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5701976">func</span>&nbsp;<span class="op" id="5701981">(</span><span class="ident" id="5701982">p</span>&nbsp;<span class="op" id="5701984">*</span><span class="ident" id="5701985">parser</span><span class="op" id="5701991">)</span>&nbsp;<span class="ident" id="5701993">parseUnaryExpr</span><span class="op" id="5702007">(</span><span class="ident" id="5702008">lhs</span>&nbsp;<span class="builtintype" id="5702012">bool</span><span class="op" id="5702016">)</span>&nbsp;<span class="ident" id="5702018">ast</span><span class="op" id="5702021">.</span><span class="ident" id="5702022">Expr</span>&nbsp;<span class="op" id="5702027">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702030">if</span>&nbsp;<span class="ident" id="5702033">p</span><span class="op" id="5702034">.</span><span class="ident" id="5702035">trace</span>&nbsp;<span class="op" id="5702041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702045">defer</span>&nbsp;<span class="ident" id="5702051">un</span><span class="op" id="5702053">(</span><span class="ident" id="5702054">trace</span><span class="op" id="5702059">(</span><span class="ident" id="5702060">p</span><span class="op" id="5702061">,</span>&nbsp;<span class="string" id="5702063">&#34;UnaryExpr&#34;</span><span class="op" id="5702074">)</span><span class="op" id="5702075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5702078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702082">switch</span>&nbsp;<span class="ident" id="5702089">p</span><span class="op" id="5702090">.</span><span class="ident" id="5702091">tok</span>&nbsp;<span class="op" id="5702095">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702098">case</span>&nbsp;<span class="ident" id="5702103">token</span><span class="op" id="5702108">.</span><span class="ident" id="5702109">ADD</span><span class="op" id="5702112">,</span>&nbsp;<span class="ident" id="5702114">token</span><span class="op" id="5702119">.</span><span class="ident" id="5702120">SUB</span><span class="op" id="5702123">,</span>&nbsp;<span class="ident" id="5702125">token</span><span class="op" id="5702130">.</span><span class="ident" id="5702131">NOT</span><span class="op" id="5702134">,</span>&nbsp;<span class="ident" id="5702136">token</span><span class="op" id="5702141">.</span><span class="ident" id="5702142">XOR</span><span class="op" id="5702145">,</span>&nbsp;<span class="ident" id="5702147">token</span><span class="op" id="5702152">.</span><span class="ident" id="5702153">AND</span><span class="op" id="5702156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702160">pos</span><span class="op" id="5702163">,</span>&nbsp;<span class="ident" id="5702165">op</span>&nbsp;<span class="op" id="5702168">:=</span>&nbsp;<span class="ident" id="5702171">p</span><span class="op" id="5702172">.</span><span class="ident" id="5702173">pos</span><span class="op" id="5702176">,</span>&nbsp;<span class="ident" id="5702178">p</span><span class="op" id="5702179">.</span><span class="ident" id="5702180">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702186">p</span><span class="op" id="5702187">.</span><span class="ident" id="5702188">next</span><span class="op" id="5702192">(</span><span class="op" id="5702193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702197">x</span>&nbsp;<span class="op" id="5702199">:=</span>&nbsp;<span class="ident" id="5702202">p</span><span class="op" id="5702203">.</span><span class="ident" id="5702204">parseUnaryExpr</span><span class="op" id="5702218">(</span><span class="builtintype" id="5702219">false</span><span class="op" id="5702224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702228">return</span>&nbsp;<span class="op" id="5702235">&amp;</span><span class="ident" id="5702236">ast</span><span class="op" id="5702239">.</span><span class="ident" id="5702240">UnaryExpr</span><span class="op" id="5702249">{</span><span class="ident" id="5702250">OpPos</span><span class="op" id="5702255">:</span>&nbsp;<span class="ident" id="5702257">pos</span><span class="op" id="5702260">,</span>&nbsp;<span class="ident" id="5702262">Op</span><span class="op" id="5702264">:</span>&nbsp;<span class="ident" id="5702266">op</span><span class="op" id="5702268">,</span>&nbsp;<span class="ident" id="5702270">X</span><span class="op" id="5702271">:</span>&nbsp;<span class="ident" id="5702273">p</span><span class="op" id="5702274">.</span><span class="ident" id="5702275">checkExpr</span><span class="op" id="5702284">(</span><span class="ident" id="5702285">x</span><span class="op" id="5702286">)</span><span class="op" id="5702287">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702291">case</span>&nbsp;<span class="ident" id="5702296">token</span><span class="op" id="5702301">.</span><span class="ident" id="5702302">ARROW</span><span class="op" id="5702307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702311">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702351">arrow</span>&nbsp;<span class="op" id="5702357">:=</span>&nbsp;<span class="ident" id="5702360">p</span><span class="op" id="5702361">.</span><span class="ident" id="5702362">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702368">p</span><span class="op" id="5702369">.</span><span class="ident" id="5702370">next</span><span class="op" id="5702374">(</span><span class="op" id="5702375">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702380">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702443">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702504">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702567">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702587">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702592">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702641">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702701">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702706">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702767">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702805">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702810">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702853">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5702901">x</span>&nbsp;<span class="op" id="5702903">:=</span>&nbsp;<span class="ident" id="5702906">p</span><span class="op" id="5702907">.</span><span class="ident" id="5702908">parseUnaryExpr</span><span class="op" id="5702922">(</span><span class="builtintype" id="5702923">false</span><span class="op" id="5702928">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5702933">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5702967">if</span>&nbsp;<span class="ident" id="5702970">typ</span><span class="op" id="5702973">,</span>&nbsp;<span class="ident" id="5702975">ok</span>&nbsp;<span class="op" id="5702978">:=</span>&nbsp;<span class="ident" id="5702981">x</span><span class="op" id="5702982">.</span><span class="op" id="5702983">(</span><span class="op" id="5702984">*</span><span class="ident" id="5702985">ast</span><span class="op" id="5702988">.</span><span class="ident" id="5702989">ChanType</span><span class="op" id="5702997">)</span><span class="op" id="5702998">;</span>&nbsp;<span class="ident" id="5703000">ok</span>&nbsp;<span class="op" id="5703003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703008">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703024">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703064">dir</span>&nbsp;<span class="op" id="5703068">:=</span>&nbsp;<span class="ident" id="5703071">ast</span><span class="op" id="5703074">.</span><span class="ident" id="5703075">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703083">for</span>&nbsp;<span class="ident" id="5703087">ok</span>&nbsp;<span class="op" id="5703090">&amp;&amp;</span>&nbsp;<span class="ident" id="5703093">dir</span>&nbsp;<span class="op" id="5703097">==</span>&nbsp;<span class="ident" id="5703100">ast</span><span class="op" id="5703103">.</span><span class="ident" id="5703104">SEND</span>&nbsp;<span class="op" id="5703109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703115">if</span>&nbsp;<span class="ident" id="5703118">typ</span><span class="op" id="5703121">.</span><span class="ident" id="5703122">Dir</span>&nbsp;<span class="op" id="5703126">==</span>&nbsp;<span class="ident" id="5703129">ast</span><span class="op" id="5703132">.</span><span class="ident" id="5703133">RECV</span>&nbsp;<span class="op" id="5703138">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703145">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703187">p</span><span class="op" id="5703188">.</span><span class="ident" id="5703189">errorExpected</span><span class="op" id="5703202">(</span><span class="ident" id="5703203">typ</span><span class="op" id="5703206">.</span><span class="ident" id="5703207">Arrow</span><span class="op" id="5703212">,</span>&nbsp;<span class="string" id="5703214">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5703222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703234">arrow</span><span class="op" id="5703239">,</span>&nbsp;<span class="ident" id="5703241">typ</span><span class="op" id="5703244">.</span><span class="ident" id="5703245">Begin</span><span class="op" id="5703250">,</span>&nbsp;<span class="ident" id="5703252">typ</span><span class="op" id="5703255">.</span><span class="ident" id="5703256">Arrow</span>&nbsp;<span class="op" id="5703262">=</span>&nbsp;<span class="ident" id="5703264">typ</span><span class="op" id="5703267">.</span><span class="ident" id="5703268">Arrow</span><span class="op" id="5703273">,</span>&nbsp;<span class="ident" id="5703275">arrow</span><span class="op" id="5703280">,</span>&nbsp;<span class="ident" id="5703282">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703292">dir</span><span class="op" id="5703295">,</span>&nbsp;<span class="ident" id="5703297">typ</span><span class="op" id="5703300">.</span><span class="ident" id="5703301">Dir</span>&nbsp;<span class="op" id="5703305">=</span>&nbsp;<span class="ident" id="5703307">typ</span><span class="op" id="5703310">.</span><span class="ident" id="5703311">Dir</span><span class="op" id="5703314">,</span>&nbsp;<span class="ident" id="5703316">ast</span><span class="op" id="5703319">.</span><span class="ident" id="5703320">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703329">typ</span><span class="op" id="5703332">,</span>&nbsp;<span class="ident" id="5703334">ok</span>&nbsp;<span class="op" id="5703337">=</span>&nbsp;<span class="ident" id="5703339">typ</span><span class="op" id="5703342">.</span><span class="ident" id="5703343">Value</span><span class="op" id="5703348">.</span><span class="op" id="5703349">(</span><span class="op" id="5703350">*</span><span class="ident" id="5703351">ast</span><span class="op" id="5703354">.</span><span class="ident" id="5703355">ChanType</span><span class="op" id="5703363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703373">if</span>&nbsp;<span class="ident" id="5703376">dir</span>&nbsp;<span class="op" id="5703380">==</span>&nbsp;<span class="ident" id="5703383">ast</span><span class="op" id="5703386">.</span><span class="ident" id="5703387">SEND</span>&nbsp;<span class="op" id="5703392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703398">p</span><span class="op" id="5703399">.</span><span class="ident" id="5703400">errorExpected</span><span class="op" id="5703413">(</span><span class="ident" id="5703414">arrow</span><span class="op" id="5703419">,</span>&nbsp;<span class="string" id="5703421">&#34;channel&nbsp;type&#34;</span><span class="op" id="5703435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703440">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703446">return</span>&nbsp;<span class="ident" id="5703453">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703462">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703476">return</span>&nbsp;<span class="op" id="5703483">&amp;</span><span class="ident" id="5703484">ast</span><span class="op" id="5703487">.</span><span class="ident" id="5703488">UnaryExpr</span><span class="op" id="5703497">{</span><span class="ident" id="5703498">OpPos</span><span class="op" id="5703503">:</span>&nbsp;<span class="ident" id="5703505">arrow</span><span class="op" id="5703510">,</span>&nbsp;<span class="ident" id="5703512">Op</span><span class="op" id="5703514">:</span>&nbsp;<span class="ident" id="5703516">token</span><span class="op" id="5703521">.</span><span class="ident" id="5703522">ARROW</span><span class="op" id="5703527">,</span>&nbsp;<span class="ident" id="5703529">X</span><span class="op" id="5703530">:</span>&nbsp;<span class="ident" id="5703532">p</span><span class="op" id="5703533">.</span><span class="ident" id="5703534">checkExpr</span><span class="op" id="5703543">(</span><span class="ident" id="5703544">x</span><span class="op" id="5703545">)</span><span class="op" id="5703546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703550">case</span>&nbsp;<span class="ident" id="5703555">token</span><span class="op" id="5703560">.</span><span class="ident" id="5703561">MUL</span><span class="op" id="5703564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5703568">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703610">pos</span>&nbsp;<span class="op" id="5703614">:=</span>&nbsp;<span class="ident" id="5703617">p</span><span class="op" id="5703618">.</span><span class="ident" id="5703619">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703625">p</span><span class="op" id="5703626">.</span><span class="ident" id="5703627">next</span><span class="op" id="5703631">(</span><span class="op" id="5703632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703636">x</span>&nbsp;<span class="op" id="5703638">:=</span>&nbsp;<span class="ident" id="5703641">p</span><span class="op" id="5703642">.</span><span class="ident" id="5703643">parseUnaryExpr</span><span class="op" id="5703657">(</span><span class="builtintype" id="5703658">false</span><span class="op" id="5703663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703667">return</span>&nbsp;<span class="op" id="5703674">&amp;</span><span class="ident" id="5703675">ast</span><span class="op" id="5703678">.</span><span class="ident" id="5703679">StarExpr</span><span class="op" id="5703687">{</span><span class="ident" id="5703688">Star</span><span class="op" id="5703692">:</span>&nbsp;<span class="ident" id="5703694">pos</span><span class="op" id="5703697">,</span>&nbsp;<span class="ident" id="5703699">X</span><span class="op" id="5703700">:</span>&nbsp;<span class="ident" id="5703702">p</span><span class="op" id="5703703">.</span><span class="ident" id="5703704">checkExprOrType</span><span class="op" id="5703719">(</span><span class="ident" id="5703720">x</span><span class="op" id="5703721">)</span><span class="op" id="5703722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703729">return</span>&nbsp;<span class="ident" id="5703736">p</span><span class="op" id="5703737">.</span><span class="ident" id="5703738">parsePrimaryExpr</span><span class="op" id="5703754">(</span><span class="ident" id="5703755">lhs</span><span class="op" id="5703758">)</span><br>
<span class="lineno"></span><span class="op" id="5703760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5703763">func</span>&nbsp;<span class="op" id="5703768">(</span><span class="ident" id="5703769">p</span>&nbsp;<span class="op" id="5703771">*</span><span class="ident" id="5703772">parser</span><span class="op" id="5703778">)</span>&nbsp;<span class="ident" id="5703780">tokPrec</span><span class="op" id="5703787">(</span><span class="op" id="5703788">)</span>&nbsp;<span class="op" id="5703790">(</span><span class="ident" id="5703791">token</span><span class="op" id="5703796">.</span><span class="ident" id="5703797">Token</span><span class="op" id="5703802">,</span>&nbsp;<span class="builtintype" id="5703804">int</span><span class="op" id="5703807">)</span>&nbsp;<span class="op" id="5703809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703812">tok</span>&nbsp;<span class="op" id="5703816">:=</span>&nbsp;<span class="ident" id="5703819">p</span><span class="op" id="5703820">.</span><span class="ident" id="5703821">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703826">if</span>&nbsp;<span class="ident" id="5703829">p</span><span class="op" id="5703830">.</span><span class="ident" id="5703831">inRhs</span>&nbsp;<span class="op" id="5703837">&amp;&amp;</span>&nbsp;<span class="ident" id="5703840">tok</span>&nbsp;<span class="op" id="5703844">==</span>&nbsp;<span class="ident" id="5703847">token</span><span class="op" id="5703852">.</span><span class="ident" id="5703853">ASSIGN</span>&nbsp;<span class="op" id="5703860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5703864">tok</span>&nbsp;<span class="op" id="5703868">=</span>&nbsp;<span class="ident" id="5703870">token</span><span class="op" id="5703875">.</span><span class="ident" id="5703876">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5703881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5703884">return</span>&nbsp;<span class="ident" id="5703891">tok</span><span class="op" id="5703894">,</span>&nbsp;<span class="ident" id="5703896">tok</span><span class="op" id="5703899">.</span><span class="ident" id="5703900">Precedence</span><span class="op" id="5703910">(</span><span class="op" id="5703911">)</span><br>
<span class="lineno"></span><span class="op" id="5703913">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5703916">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5703986">func</span>&nbsp;<span class="op" id="5703991">(</span><span class="ident" id="5703992">p</span>&nbsp;<span class="op" id="5703994">*</span><span class="ident" id="5703995">parser</span><span class="op" id="5704001">)</span>&nbsp;<span class="ident" id="5704003">parseBinaryExpr</span><span class="op" id="5704018">(</span><span class="ident" id="5704019">lhs</span>&nbsp;<span class="builtintype" id="5704023">bool</span><span class="op" id="5704027">,</span>&nbsp;<span class="ident" id="5704029">prec1</span>&nbsp;<span class="builtintype" id="5704035">int</span><span class="op" id="5704038">)</span>&nbsp;<span class="ident" id="5704040">ast</span><span class="op" id="5704043">.</span><span class="ident" id="5704044">Expr</span>&nbsp;<span class="op" id="5704049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704052">if</span>&nbsp;<span class="ident" id="5704055">p</span><span class="op" id="5704056">.</span><span class="ident" id="5704057">trace</span>&nbsp;<span class="op" id="5704063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704067">defer</span>&nbsp;<span class="ident" id="5704073">un</span><span class="op" id="5704075">(</span><span class="ident" id="5704076">trace</span><span class="op" id="5704081">(</span><span class="ident" id="5704082">p</span><span class="op" id="5704083">,</span>&nbsp;<span class="string" id="5704085">&#34;BinaryExpr&#34;</span><span class="op" id="5704097">)</span><span class="op" id="5704098">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704105">x</span>&nbsp;<span class="op" id="5704107">:=</span>&nbsp;<span class="ident" id="5704110">p</span><span class="op" id="5704111">.</span><span class="ident" id="5704112">parseUnaryExpr</span><span class="op" id="5704126">(</span><span class="ident" id="5704127">lhs</span><span class="op" id="5704130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704133">for</span>&nbsp;<span class="ident" id="5704137">_</span><span class="op" id="5704138">,</span>&nbsp;<span class="ident" id="5704140">prec</span>&nbsp;<span class="op" id="5704145">:=</span>&nbsp;<span class="ident" id="5704148">p</span><span class="op" id="5704149">.</span><span class="ident" id="5704150">tokPrec</span><span class="op" id="5704157">(</span><span class="op" id="5704158">)</span><span class="op" id="5704159">;</span>&nbsp;<span class="ident" id="5704161">prec</span>&nbsp;<span class="op" id="5704166">&gt;=</span>&nbsp;<span class="ident" id="5704169">prec1</span><span class="op" id="5704174">;</span>&nbsp;<span class="ident" id="5704176">prec</span><span class="op" id="5704180">--</span>&nbsp;<span class="op" id="5704183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704187">for</span>&nbsp;<span class="op" id="5704191">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704196">op</span><span class="op" id="5704198">,</span>&nbsp;<span class="ident" id="5704200">oprec</span>&nbsp;<span class="op" id="5704206">:=</span>&nbsp;<span class="ident" id="5704209">p</span><span class="op" id="5704210">.</span><span class="ident" id="5704211">tokPrec</span><span class="op" id="5704218">(</span><span class="op" id="5704219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704224">if</span>&nbsp;<span class="ident" id="5704227">oprec</span>&nbsp;<span class="op" id="5704233">!=</span>&nbsp;<span class="ident" id="5704236">prec</span>&nbsp;<span class="op" id="5704241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704247">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704261">pos</span>&nbsp;<span class="op" id="5704265">:=</span>&nbsp;<span class="ident" id="5704268">p</span><span class="op" id="5704269">.</span><span class="ident" id="5704270">expect</span><span class="op" id="5704276">(</span><span class="ident" id="5704277">op</span><span class="op" id="5704279">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704284">if</span>&nbsp;<span class="ident" id="5704287">lhs</span>&nbsp;<span class="op" id="5704291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704297">p</span><span class="op" id="5704298">.</span><span class="ident" id="5704299">resolve</span><span class="op" id="5704306">(</span><span class="ident" id="5704307">x</span><span class="op" id="5704308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704314">lhs</span>&nbsp;<span class="op" id="5704318">=</span>&nbsp;<span class="builtintype" id="5704320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704334">y</span>&nbsp;<span class="op" id="5704336">:=</span>&nbsp;<span class="ident" id="5704339">p</span><span class="op" id="5704340">.</span><span class="ident" id="5704341">parseBinaryExpr</span><span class="op" id="5704356">(</span><span class="builtintype" id="5704357">false</span><span class="op" id="5704362">,</span>&nbsp;<span class="ident" id="5704364">prec</span><span class="op" id="5704368">+</span><span class="num" id="5704369">1</span><span class="op" id="5704370">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704375">x</span>&nbsp;<span class="op" id="5704377">=</span>&nbsp;<span class="op" id="5704379">&amp;</span><span class="ident" id="5704380">ast</span><span class="op" id="5704383">.</span><span class="ident" id="5704384">BinaryExpr</span><span class="op" id="5704394">{</span><span class="ident" id="5704395">X</span><span class="op" id="5704396">:</span>&nbsp;<span class="ident" id="5704398">p</span><span class="op" id="5704399">.</span><span class="ident" id="5704400">checkExpr</span><span class="op" id="5704409">(</span><span class="ident" id="5704410">x</span><span class="op" id="5704411">)</span><span class="op" id="5704412">,</span>&nbsp;<span class="ident" id="5704414">OpPos</span><span class="op" id="5704419">:</span>&nbsp;<span class="ident" id="5704421">pos</span><span class="op" id="5704424">,</span>&nbsp;<span class="ident" id="5704426">Op</span><span class="op" id="5704428">:</span>&nbsp;<span class="ident" id="5704430">op</span><span class="op" id="5704432">,</span>&nbsp;<span class="ident" id="5704434">Y</span><span class="op" id="5704435">:</span>&nbsp;<span class="ident" id="5704437">p</span><span class="op" id="5704438">.</span><span class="ident" id="5704439">checkExpr</span><span class="op" id="5704448">(</span><span class="ident" id="5704449">y</span><span class="op" id="5704450">)</span><span class="op" id="5704451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704462">return</span>&nbsp;<span class="ident" id="5704469">x</span><br>
<span class="lineno">1590</span><span class="op" id="5704471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5704474">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5704544">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5704616">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5704687">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5704699">func</span>&nbsp;<span class="op" id="5704704">(</span><span class="ident" id="5704705">p</span>&nbsp;<span class="op" id="5704707">*</span><span class="ident" id="5704708">parser</span><span class="op" id="5704714">)</span>&nbsp;<span class="ident" id="5704716">parseExpr</span><span class="op" id="5704725">(</span><span class="ident" id="5704726">lhs</span>&nbsp;<span class="builtintype" id="5704730">bool</span><span class="op" id="5704734">)</span>&nbsp;<span class="ident" id="5704736">ast</span><span class="op" id="5704739">.</span><span class="ident" id="5704740">Expr</span>&nbsp;<span class="op" id="5704745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704748">if</span>&nbsp;<span class="ident" id="5704751">p</span><span class="op" id="5704752">.</span><span class="ident" id="5704753">trace</span>&nbsp;<span class="op" id="5704759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704763">defer</span>&nbsp;<span class="ident" id="5704769">un</span><span class="op" id="5704771">(</span><span class="ident" id="5704772">trace</span><span class="op" id="5704777">(</span><span class="ident" id="5704778">p</span><span class="op" id="5704779">,</span>&nbsp;<span class="string" id="5704781">&#34;Expression&#34;</span><span class="op" id="5704793">)</span><span class="op" id="5704794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5704797">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704801">return</span>&nbsp;<span class="ident" id="5704808">p</span><span class="op" id="5704809">.</span><span class="ident" id="5704810">parseBinaryExpr</span><span class="op" id="5704825">(</span><span class="ident" id="5704826">lhs</span><span class="op" id="5704829">,</span>&nbsp;<span class="ident" id="5704831">token</span><span class="op" id="5704836">.</span><span class="ident" id="5704837">LowestPrec</span><span class="op" id="5704847">+</span><span class="num" id="5704848">1</span><span class="op" id="5704849">)</span><br>
<span class="lineno"></span><span class="op" id="5704851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5704854">func</span>&nbsp;<span class="op" id="5704859">(</span><span class="ident" id="5704860">p</span>&nbsp;<span class="op" id="5704862">*</span><span class="ident" id="5704863">parser</span><span class="op" id="5704869">)</span>&nbsp;<span class="ident" id="5704871">parseRhs</span><span class="op" id="5704879">(</span><span class="op" id="5704880">)</span>&nbsp;<span class="ident" id="5704882">ast</span><span class="op" id="5704885">.</span><span class="ident" id="5704886">Expr</span>&nbsp;<span class="op" id="5704891">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704894">old</span>&nbsp;<span class="op" id="5704898">:=</span>&nbsp;<span class="ident" id="5704901">p</span><span class="op" id="5704902">.</span><span class="ident" id="5704903">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704910">p</span><span class="op" id="5704911">.</span><span class="ident" id="5704912">inRhs</span>&nbsp;<span class="op" id="5704918">=</span>&nbsp;<span class="builtintype" id="5704920">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704926">x</span>&nbsp;<span class="op" id="5704928">:=</span>&nbsp;<span class="ident" id="5704931">p</span><span class="op" id="5704932">.</span><span class="ident" id="5704933">checkExpr</span><span class="op" id="5704942">(</span><span class="ident" id="5704943">p</span><span class="op" id="5704944">.</span><span class="ident" id="5704945">parseExpr</span><span class="op" id="5704954">(</span><span class="builtintype" id="5704955">false</span><span class="op" id="5704960">)</span><span class="op" id="5704961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5704964">p</span><span class="op" id="5704965">.</span><span class="ident" id="5704966">inRhs</span>&nbsp;<span class="op" id="5704972">=</span>&nbsp;<span class="ident" id="5704974">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5704979">return</span>&nbsp;<span class="ident" id="5704986">x</span><br>
<span class="lineno">1610</span><span class="op" id="5704988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5704991">func</span>&nbsp;<span class="op" id="5704996">(</span><span class="ident" id="5704997">p</span>&nbsp;<span class="op" id="5704999">*</span><span class="ident" id="5705000">parser</span><span class="op" id="5705006">)</span>&nbsp;<span class="ident" id="5705008">parseRhsOrType</span><span class="op" id="5705022">(</span><span class="op" id="5705023">)</span>&nbsp;<span class="ident" id="5705025">ast</span><span class="op" id="5705028">.</span><span class="ident" id="5705029">Expr</span>&nbsp;<span class="op" id="5705034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705037">old</span>&nbsp;<span class="op" id="5705041">:=</span>&nbsp;<span class="ident" id="5705044">p</span><span class="op" id="5705045">.</span><span class="ident" id="5705046">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705053">p</span><span class="op" id="5705054">.</span><span class="ident" id="5705055">inRhs</span>&nbsp;<span class="op" id="5705061">=</span>&nbsp;<span class="builtintype" id="5705063">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705069">x</span>&nbsp;<span class="op" id="5705071">:=</span>&nbsp;<span class="ident" id="5705074">p</span><span class="op" id="5705075">.</span><span class="ident" id="5705076">checkExprOrType</span><span class="op" id="5705091">(</span><span class="ident" id="5705092">p</span><span class="op" id="5705093">.</span><span class="ident" id="5705094">parseExpr</span><span class="op" id="5705103">(</span><span class="builtintype" id="5705104">false</span><span class="op" id="5705109">)</span><span class="op" id="5705110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705113">p</span><span class="op" id="5705114">.</span><span class="ident" id="5705115">inRhs</span>&nbsp;<span class="op" id="5705121">=</span>&nbsp;<span class="ident" id="5705123">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705128">return</span>&nbsp;<span class="ident" id="5705135">x</span><br>
<span class="lineno"></span><span class="op" id="5705137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5705140">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5705220">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5705235">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5705273">const</span>&nbsp;<span class="op" id="5705279">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705282">basic</span>&nbsp;<span class="op" id="5705288">=</span>&nbsp;<span class="ident" id="5705290">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705296">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705305">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5705313">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5705316">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5705390">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5705464">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5705538">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5705609">func</span>&nbsp;<span class="op" id="5705614">(</span><span class="ident" id="5705615">p</span>&nbsp;<span class="op" id="5705617">*</span><span class="ident" id="5705618">parser</span><span class="op" id="5705624">)</span>&nbsp;<span class="ident" id="5705626">parseSimpleStmt</span><span class="op" id="5705641">(</span><span class="ident" id="5705642">mode</span>&nbsp;<span class="builtintype" id="5705647">int</span><span class="op" id="5705650">)</span>&nbsp;<span class="op" id="5705652">(</span><span class="ident" id="5705653">ast</span><span class="op" id="5705656">.</span><span class="ident" id="5705657">Stmt</span><span class="op" id="5705661">,</span>&nbsp;<span class="builtintype" id="5705663">bool</span><span class="op" id="5705667">)</span>&nbsp;<span class="op" id="5705669">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705672">if</span>&nbsp;<span class="ident" id="5705675">p</span><span class="op" id="5705676">.</span><span class="ident" id="5705677">trace</span>&nbsp;<span class="op" id="5705683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705687">defer</span>&nbsp;<span class="ident" id="5705693">un</span><span class="op" id="5705695">(</span><span class="ident" id="5705696">trace</span><span class="op" id="5705701">(</span><span class="ident" id="5705702">p</span><span class="op" id="5705703">,</span>&nbsp;<span class="string" id="5705705">&#34;SimpleStmt&#34;</span><span class="op" id="5705717">)</span><span class="op" id="5705718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5705721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705725">x</span>&nbsp;<span class="op" id="5705727">:=</span>&nbsp;<span class="ident" id="5705730">p</span><span class="op" id="5705731">.</span><span class="ident" id="5705732">parseLhsList</span><span class="op" id="5705744">(</span><span class="op" id="5705745">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705749">switch</span>&nbsp;<span class="ident" id="5705756">p</span><span class="op" id="5705757">.</span><span class="ident" id="5705758">tok</span>&nbsp;<span class="op" id="5705762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5705765">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705772">token</span><span class="op" id="5705777">.</span><span class="ident" id="5705778">DEFINE</span><span class="op" id="5705784">,</span>&nbsp;<span class="ident" id="5705786">token</span><span class="op" id="5705791">.</span><span class="ident" id="5705792">ASSIGN</span><span class="op" id="5705798">,</span>&nbsp;<span class="ident" id="5705800">token</span><span class="op" id="5705805">.</span><span class="ident" id="5705806">ADD_ASSIGN</span><span class="op" id="5705816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705820">token</span><span class="op" id="5705825">.</span><span class="ident" id="5705826">SUB_ASSIGN</span><span class="op" id="5705836">,</span>&nbsp;<span class="ident" id="5705838">token</span><span class="op" id="5705843">.</span><span class="ident" id="5705844">MUL_ASSIGN</span><span class="op" id="5705854">,</span>&nbsp;<span class="ident" id="5705856">token</span><span class="op" id="5705861">.</span><span class="ident" id="5705862">QUO_ASSIGN</span><span class="op" id="5705872">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705876">token</span><span class="op" id="5705881">.</span><span class="ident" id="5705882">REM_ASSIGN</span><span class="op" id="5705892">,</span>&nbsp;<span class="ident" id="5705894">token</span><span class="op" id="5705899">.</span><span class="ident" id="5705900">AND_ASSIGN</span><span class="op" id="5705910">,</span>&nbsp;<span class="ident" id="5705912">token</span><span class="op" id="5705917">.</span><span class="ident" id="5705918">OR_ASSIGN</span><span class="op" id="5705927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5705931">token</span><span class="op" id="5705936">.</span><span class="ident" id="5705937">XOR_ASSIGN</span><span class="op" id="5705947">,</span>&nbsp;<span class="ident" id="5705949">token</span><span class="op" id="5705954">.</span><span class="ident" id="5705955">SHL_ASSIGN</span><span class="op" id="5705965">,</span>&nbsp;<span class="ident" id="5705967">token</span><span class="op" id="5705972">.</span><span class="ident" id="5705973">SHR_ASSIGN</span><span class="op" id="5705983">,</span>&nbsp;<span class="ident" id="5705985">token</span><span class="op" id="5705990">.</span><span class="ident" id="5705991">AND_NOT_ASSIGN</span><span class="op" id="5706005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706009">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706068">pos</span><span class="op" id="5706071">,</span>&nbsp;<span class="ident" id="5706073">tok</span>&nbsp;<span class="op" id="5706077">:=</span>&nbsp;<span class="ident" id="5706080">p</span><span class="op" id="5706081">.</span><span class="ident" id="5706082">pos</span><span class="op" id="5706085">,</span>&nbsp;<span class="ident" id="5706087">p</span><span class="op" id="5706088">.</span><span class="ident" id="5706089">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706095">p</span><span class="op" id="5706096">.</span><span class="ident" id="5706097">next</span><span class="op" id="5706101">(</span><span class="op" id="5706102">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706106">var</span>&nbsp;<span class="ident" id="5706110">y</span>&nbsp;<span class="op" id="5706112">[</span><span class="op" id="5706113">]</span><span class="ident" id="5706114">ast</span><span class="op" id="5706117">.</span><span class="ident" id="5706118">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706125">isRange</span>&nbsp;<span class="op" id="5706133">:=</span>&nbsp;<span class="builtintype" id="5706136">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706144">if</span>&nbsp;<span class="ident" id="5706147">mode</span>&nbsp;<span class="op" id="5706152">==</span>&nbsp;<span class="ident" id="5706155">rangeOk</span>&nbsp;<span class="op" id="5706163">&amp;&amp;</span>&nbsp;<span class="ident" id="5706166">p</span><span class="op" id="5706167">.</span><span class="ident" id="5706168">tok</span>&nbsp;<span class="op" id="5706172">==</span>&nbsp;<span class="ident" id="5706175">token</span><span class="op" id="5706180">.</span><span class="ident" id="5706181">RANGE</span>&nbsp;<span class="op" id="5706187">&amp;&amp;</span>&nbsp;<span class="op" id="5706190">(</span><span class="ident" id="5706191">tok</span>&nbsp;<span class="op" id="5706195">==</span>&nbsp;<span class="ident" id="5706198">token</span><span class="op" id="5706203">.</span><span class="ident" id="5706204">DEFINE</span>&nbsp;<span class="op" id="5706211">||</span>&nbsp;<span class="ident" id="5706214">tok</span>&nbsp;<span class="op" id="5706218">==</span>&nbsp;<span class="ident" id="5706221">token</span><span class="op" id="5706226">.</span><span class="ident" id="5706227">ASSIGN</span><span class="op" id="5706233">)</span>&nbsp;<span class="op" id="5706235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706240">pos</span>&nbsp;<span class="op" id="5706244">:=</span>&nbsp;<span class="ident" id="5706247">p</span><span class="op" id="5706248">.</span><span class="ident" id="5706249">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706256">p</span><span class="op" id="5706257">.</span><span class="ident" id="5706258">next</span><span class="op" id="5706262">(</span><span class="op" id="5706263">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706268">y</span>&nbsp;<span class="op" id="5706270">=</span>&nbsp;<span class="op" id="5706272">[</span><span class="op" id="5706273">]</span><span class="ident" id="5706274">ast</span><span class="op" id="5706277">.</span><span class="ident" id="5706278">Expr</span><span class="op" id="5706282">{</span><span class="op" id="5706283">&amp;</span><span class="ident" id="5706284">ast</span><span class="op" id="5706287">.</span><span class="ident" id="5706288">UnaryExpr</span><span class="op" id="5706297">{</span><span class="ident" id="5706298">OpPos</span><span class="op" id="5706303">:</span>&nbsp;<span class="ident" id="5706305">pos</span><span class="op" id="5706308">,</span>&nbsp;<span class="ident" id="5706310">Op</span><span class="op" id="5706312">:</span>&nbsp;<span class="ident" id="5706314">token</span><span class="op" id="5706319">.</span><span class="ident" id="5706320">RANGE</span><span class="op" id="5706325">,</span>&nbsp;<span class="ident" id="5706327">X</span><span class="op" id="5706328">:</span>&nbsp;<span class="ident" id="5706330">p</span><span class="op" id="5706331">.</span><span class="ident" id="5706332">parseRhs</span><span class="op" id="5706340">(</span><span class="op" id="5706341">)</span><span class="op" id="5706342">}</span><span class="op" id="5706343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706348">isRange</span>&nbsp;<span class="op" id="5706356">=</span>&nbsp;<span class="builtintype" id="5706358">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706365">}</span>&nbsp;<span class="keyword" id="5706367">else</span>&nbsp;<span class="op" id="5706372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706377">y</span>&nbsp;<span class="op" id="5706379">=</span>&nbsp;<span class="ident" id="5706381">p</span><span class="op" id="5706382">.</span><span class="ident" id="5706383">parseRhsList</span><span class="op" id="5706395">(</span><span class="op" id="5706396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706400">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706404">as</span>&nbsp;<span class="op" id="5706407">:=</span>&nbsp;<span class="op" id="5706410">&amp;</span><span class="ident" id="5706411">ast</span><span class="op" id="5706414">.</span><span class="ident" id="5706415">AssignStmt</span><span class="op" id="5706425">{</span><span class="ident" id="5706426">Lhs</span><span class="op" id="5706429">:</span>&nbsp;<span class="ident" id="5706431">x</span><span class="op" id="5706432">,</span>&nbsp;<span class="ident" id="5706434">TokPos</span><span class="op" id="5706440">:</span>&nbsp;<span class="ident" id="5706442">pos</span><span class="op" id="5706445">,</span>&nbsp;<span class="ident" id="5706447">Tok</span><span class="op" id="5706450">:</span>&nbsp;<span class="ident" id="5706452">tok</span><span class="op" id="5706455">,</span>&nbsp;<span class="ident" id="5706457">Rhs</span><span class="op" id="5706460">:</span>&nbsp;<span class="ident" id="5706462">y</span><span class="op" id="5706463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706467">if</span>&nbsp;<span class="ident" id="5706470">tok</span>&nbsp;<span class="op" id="5706474">==</span>&nbsp;<span class="ident" id="5706477">token</span><span class="op" id="5706482">.</span><span class="ident" id="5706483">DEFINE</span>&nbsp;<span class="op" id="5706490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706495">p</span><span class="op" id="5706496">.</span><span class="ident" id="5706497">shortVarDecl</span><span class="op" id="5706509">(</span><span class="ident" id="5706510">as</span><span class="op" id="5706512">,</span>&nbsp;<span class="ident" id="5706514">x</span><span class="op" id="5706515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706523">return</span>&nbsp;<span class="ident" id="5706530">as</span><span class="op" id="5706532">,</span>&nbsp;<span class="ident" id="5706534">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706547">if</span>&nbsp;<span class="builtinfunc" id="5706550">len</span><span class="op" id="5706553">(</span><span class="ident" id="5706554">x</span><span class="op" id="5706555">)</span>&nbsp;<span class="op" id="5706557">&gt;</span>&nbsp;<span class="num" id="5706559">1</span>&nbsp;<span class="op" id="5706561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706565">p</span><span class="op" id="5706566">.</span><span class="ident" id="5706567">errorExpected</span><span class="op" id="5706580">(</span><span class="ident" id="5706581">x</span><span class="op" id="5706582">[</span><span class="num" id="5706583">0</span><span class="op" id="5706584">]</span><span class="op" id="5706585">.</span><span class="ident" id="5706586">Pos</span><span class="op" id="5706589">(</span><span class="op" id="5706590">)</span><span class="op" id="5706591">,</span>&nbsp;<span class="string" id="5706593">&#34;1&nbsp;expression&#34;</span><span class="op" id="5706607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706611">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5706646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706650">switch</span>&nbsp;<span class="ident" id="5706657">p</span><span class="op" id="5706658">.</span><span class="ident" id="5706659">tok</span>&nbsp;<span class="op" id="5706663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706666">case</span>&nbsp;<span class="ident" id="5706671">token</span><span class="op" id="5706676">.</span><span class="ident" id="5706677">COLON</span><span class="op" id="5706682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706686">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706709">colon</span>&nbsp;<span class="op" id="5706715">:=</span>&nbsp;<span class="ident" id="5706718">p</span><span class="op" id="5706719">.</span><span class="ident" id="5706720">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706726">p</span><span class="op" id="5706727">.</span><span class="ident" id="5706728">next</span><span class="op" id="5706732">(</span><span class="op" id="5706733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5706737">if</span>&nbsp;<span class="ident" id="5706740">label</span><span class="op" id="5706745">,</span>&nbsp;<span class="ident" id="5706747">isIdent</span>&nbsp;<span class="op" id="5706755">:=</span>&nbsp;<span class="ident" id="5706758">x</span><span class="op" id="5706759">[</span><span class="num" id="5706760">0</span><span class="op" id="5706761">]</span><span class="op" id="5706762">.</span><span class="op" id="5706763">(</span><span class="op" id="5706764">*</span><span class="ident" id="5706765">ast</span><span class="op" id="5706768">.</span><span class="ident" id="5706769">Ident</span><span class="op" id="5706774">)</span><span class="op" id="5706775">;</span>&nbsp;<span class="ident" id="5706777">mode</span>&nbsp;<span class="op" id="5706782">==</span>&nbsp;<span class="ident" id="5706785">labelOk</span>&nbsp;<span class="op" id="5706793">&amp;&amp;</span>&nbsp;<span class="ident" id="5706796">isIdent</span>&nbsp;<span class="op" id="5706804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706809">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706873">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5706939">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5706955">stmt</span>&nbsp;<span class="op" id="5706960">:=</span>&nbsp;<span class="op" id="5706963">&amp;</span><span class="ident" id="5706964">ast</span><span class="op" id="5706967">.</span><span class="ident" id="5706968">LabeledStmt</span><span class="op" id="5706979">{</span><span class="ident" id="5706980">Label</span><span class="op" id="5706985">:</span>&nbsp;<span class="ident" id="5706987">label</span><span class="op" id="5706992">,</span>&nbsp;<span class="ident" id="5706994">Colon</span><span class="op" id="5706999">:</span>&nbsp;<span class="ident" id="5707001">colon</span><span class="op" id="5707006">,</span>&nbsp;<span class="ident" id="5707008">Stmt</span><span class="op" id="5707012">:</span>&nbsp;<span class="ident" id="5707014">p</span><span class="op" id="5707015">.</span><span class="ident" id="5707016">parseStmt</span><span class="op" id="5707025">(</span><span class="op" id="5707026">)</span><span class="op" id="5707027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707032">p</span><span class="op" id="5707033">.</span><span class="ident" id="5707034">declare</span><span class="op" id="5707041">(</span><span class="ident" id="5707042">stmt</span><span class="op" id="5707046">,</span>&nbsp;<span class="ident" id="5707048">nil</span><span class="op" id="5707051">,</span>&nbsp;<span class="ident" id="5707053">p</span><span class="op" id="5707054">.</span><span class="ident" id="5707055">labelScope</span><span class="op" id="5707065">,</span>&nbsp;<span class="ident" id="5707067">ast</span><span class="op" id="5707070">.</span><span class="ident" id="5707071">Lbl</span><span class="op" id="5707074">,</span>&nbsp;<span class="ident" id="5707076">label</span><span class="op" id="5707081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707086">return</span>&nbsp;<span class="ident" id="5707093">stmt</span><span class="op" id="5707097">,</span>&nbsp;<span class="builtintype" id="5707099">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707107">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707111">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707184">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707258">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707331">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707404">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707478">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707513">p</span><span class="op" id="5707514">.</span><span class="builtintype" id="5707515">error</span><span class="op" id="5707520">(</span><span class="ident" id="5707521">colon</span><span class="op" id="5707526">,</span>&nbsp;<span class="string" id="5707528">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5707555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707559">return</span>&nbsp;<span class="op" id="5707566">&amp;</span><span class="ident" id="5707567">ast</span><span class="op" id="5707570">.</span><span class="ident" id="5707571">BadStmt</span><span class="op" id="5707578">{</span><span class="ident" id="5707579">From</span><span class="op" id="5707583">:</span>&nbsp;<span class="ident" id="5707585">x</span><span class="op" id="5707586">[</span><span class="num" id="5707587">0</span><span class="op" id="5707588">]</span><span class="op" id="5707589">.</span><span class="ident" id="5707590">Pos</span><span class="op" id="5707593">(</span><span class="op" id="5707594">)</span><span class="op" id="5707595">,</span>&nbsp;<span class="ident" id="5707597">To</span><span class="op" id="5707599">:</span>&nbsp;<span class="ident" id="5707601">colon</span>&nbsp;<span class="op" id="5707607">+</span>&nbsp;<span class="num" id="5707609">1</span><span class="op" id="5707610">}</span><span class="op" id="5707611">,</span>&nbsp;<span class="builtintype" id="5707613">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707621">case</span>&nbsp;<span class="ident" id="5707626">token</span><span class="op" id="5707631">.</span><span class="ident" id="5707632">ARROW</span><span class="op" id="5707637">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707641">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707661">arrow</span>&nbsp;<span class="op" id="5707667">:=</span>&nbsp;<span class="ident" id="5707670">p</span><span class="op" id="5707671">.</span><span class="ident" id="5707672">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707678">p</span><span class="op" id="5707679">.</span><span class="ident" id="5707680">next</span><span class="op" id="5707684">(</span><span class="op" id="5707685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707689">y</span>&nbsp;<span class="op" id="5707691">:=</span>&nbsp;<span class="ident" id="5707694">p</span><span class="op" id="5707695">.</span><span class="ident" id="5707696">parseRhs</span><span class="op" id="5707704">(</span><span class="op" id="5707705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707709">return</span>&nbsp;<span class="op" id="5707716">&amp;</span><span class="ident" id="5707717">ast</span><span class="op" id="5707720">.</span><span class="ident" id="5707721">SendStmt</span><span class="op" id="5707729">{</span><span class="ident" id="5707730">Chan</span><span class="op" id="5707734">:</span>&nbsp;<span class="ident" id="5707736">x</span><span class="op" id="5707737">[</span><span class="num" id="5707738">0</span><span class="op" id="5707739">]</span><span class="op" id="5707740">,</span>&nbsp;<span class="ident" id="5707742">Arrow</span><span class="op" id="5707747">:</span>&nbsp;<span class="ident" id="5707749">arrow</span><span class="op" id="5707754">,</span>&nbsp;<span class="ident" id="5707756">Value</span><span class="op" id="5707761">:</span>&nbsp;<span class="ident" id="5707763">y</span><span class="op" id="5707764">}</span><span class="op" id="5707765">,</span>&nbsp;<span class="builtintype" id="5707767">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707775">case</span>&nbsp;<span class="ident" id="5707780">token</span><span class="op" id="5707785">.</span><span class="ident" id="5707786">INC</span><span class="op" id="5707789">,</span>&nbsp;<span class="ident" id="5707791">token</span><span class="op" id="5707796">.</span><span class="ident" id="5707797">DEC</span><span class="op" id="5707800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707804">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707832">s</span>&nbsp;<span class="op" id="5707834">:=</span>&nbsp;<span class="op" id="5707837">&amp;</span><span class="ident" id="5707838">ast</span><span class="op" id="5707841">.</span><span class="ident" id="5707842">IncDecStmt</span><span class="op" id="5707852">{</span><span class="ident" id="5707853">X</span><span class="op" id="5707854">:</span>&nbsp;<span class="ident" id="5707856">x</span><span class="op" id="5707857">[</span><span class="num" id="5707858">0</span><span class="op" id="5707859">]</span><span class="op" id="5707860">,</span>&nbsp;<span class="ident" id="5707862">TokPos</span><span class="op" id="5707868">:</span>&nbsp;<span class="ident" id="5707870">p</span><span class="op" id="5707871">.</span><span class="ident" id="5707872">pos</span><span class="op" id="5707875">,</span>&nbsp;<span class="ident" id="5707877">Tok</span><span class="op" id="5707880">:</span>&nbsp;<span class="ident" id="5707882">p</span><span class="op" id="5707883">.</span><span class="ident" id="5707884">tok</span><span class="op" id="5707887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5707891">p</span><span class="op" id="5707892">.</span><span class="ident" id="5707893">next</span><span class="op" id="5707897">(</span><span class="op" id="5707898">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707902">return</span>&nbsp;<span class="ident" id="5707909">s</span><span class="op" id="5707910">,</span>&nbsp;<span class="builtintype" id="5707912">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5707919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5707923">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5707938">return</span>&nbsp;<span class="op" id="5707945">&amp;</span><span class="ident" id="5707946">ast</span><span class="op" id="5707949">.</span><span class="ident" id="5707950">ExprStmt</span><span class="op" id="5707958">{</span><span class="ident" id="5707959">X</span><span class="op" id="5707960">:</span>&nbsp;<span class="ident" id="5707962">x</span><span class="op" id="5707963">[</span><span class="num" id="5707964">0</span><span class="op" id="5707965">]</span><span class="op" id="5707966">}</span><span class="op" id="5707967">,</span>&nbsp;<span class="builtintype" id="5707969">false</span><br>
<span class="lineno">1710</span><span class="op" id="5707975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5707978">func</span>&nbsp;<span class="op" id="5707983">(</span><span class="ident" id="5707984">p</span>&nbsp;<span class="op" id="5707986">*</span><span class="ident" id="5707987">parser</span><span class="op" id="5707993">)</span>&nbsp;<span class="ident" id="5707995">parseCallExpr</span><span class="op" id="5708008">(</span><span class="ident" id="5708009">callType</span>&nbsp;<span class="builtintype" id="5708018">string</span><span class="op" id="5708024">)</span>&nbsp;<span class="op" id="5708026">*</span><span class="ident" id="5708027">ast</span><span class="op" id="5708030">.</span><span class="ident" id="5708031">CallExpr</span>&nbsp;<span class="op" id="5708040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708043">x</span>&nbsp;<span class="op" id="5708045">:=</span>&nbsp;<span class="ident" id="5708048">p</span><span class="op" id="5708049">.</span><span class="ident" id="5708050">parseRhsOrType</span><span class="op" id="5708064">(</span><span class="op" id="5708065">)</span>&nbsp;<span class="comment" id="5708067">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708109">if</span>&nbsp;<span class="ident" id="5708112">call</span><span class="op" id="5708116">,</span>&nbsp;<span class="ident" id="5708118">isCall</span>&nbsp;<span class="op" id="5708125">:=</span>&nbsp;<span class="ident" id="5708128">x</span><span class="op" id="5708129">.</span><span class="op" id="5708130">(</span><span class="op" id="5708131">*</span><span class="ident" id="5708132">ast</span><span class="op" id="5708135">.</span><span class="ident" id="5708136">CallExpr</span><span class="op" id="5708144">)</span><span class="op" id="5708145">;</span>&nbsp;<span class="ident" id="5708147">isCall</span>&nbsp;<span class="op" id="5708154">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708158">return</span>&nbsp;<span class="ident" id="5708165">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708174">if</span>&nbsp;<span class="ident" id="5708177">_</span><span class="op" id="5708178">,</span>&nbsp;<span class="ident" id="5708180">isBad</span>&nbsp;<span class="op" id="5708186">:=</span>&nbsp;<span class="ident" id="5708189">x</span><span class="op" id="5708190">.</span><span class="op" id="5708191">(</span><span class="op" id="5708192">*</span><span class="ident" id="5708193">ast</span><span class="op" id="5708196">.</span><span class="ident" id="5708197">BadExpr</span><span class="op" id="5708204">)</span><span class="op" id="5708205">;</span>&nbsp;<span class="op" id="5708207">!</span><span class="ident" id="5708208">isBad</span>&nbsp;<span class="op" id="5708214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5708218">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708259">p</span><span class="op" id="5708260">.</span><span class="builtintype" id="5708261">error</span><span class="op" id="5708266">(</span><span class="ident" id="5708267">p</span><span class="op" id="5708268">.</span><span class="ident" id="5708269">safePos</span><span class="op" id="5708276">(</span><span class="ident" id="5708277">x</span><span class="op" id="5708278">.</span><span class="ident" id="5708279">End</span><span class="op" id="5708282">(</span><span class="op" id="5708283">)</span><span class="op" id="5708284">)</span><span class="op" id="5708285">,</span>&nbsp;<span class="ident" id="5708287">fmt</span><span class="op" id="5708290">.</span><span class="ident" id="5708291">Sprintf</span><span class="op" id="5708298">(</span><span class="string" id="5708299">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5708341">,</span>&nbsp;<span class="ident" id="5708343">callType</span><span class="op" id="5708351">)</span><span class="op" id="5708352">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708358">return</span>&nbsp;<span class="ident" id="5708365">nil</span><br>
<span class="lineno"></span><span class="op" id="5708369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5708372">func</span>&nbsp;<span class="op" id="5708377">(</span><span class="ident" id="5708378">p</span>&nbsp;<span class="op" id="5708380">*</span><span class="ident" id="5708381">parser</span><span class="op" id="5708387">)</span>&nbsp;<span class="ident" id="5708389">parseGoStmt</span><span class="op" id="5708400">(</span><span class="op" id="5708401">)</span>&nbsp;<span class="ident" id="5708403">ast</span><span class="op" id="5708406">.</span><span class="ident" id="5708407">Stmt</span>&nbsp;<span class="op" id="5708412">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708415">if</span>&nbsp;<span class="ident" id="5708418">p</span><span class="op" id="5708419">.</span><span class="ident" id="5708420">trace</span>&nbsp;<span class="op" id="5708426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708430">defer</span>&nbsp;<span class="ident" id="5708436">un</span><span class="op" id="5708438">(</span><span class="ident" id="5708439">trace</span><span class="op" id="5708444">(</span><span class="ident" id="5708445">p</span><span class="op" id="5708446">,</span>&nbsp;<span class="string" id="5708448">&#34;GoStmt&#34;</span><span class="op" id="5708456">)</span><span class="op" id="5708457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708464">pos</span>&nbsp;<span class="op" id="5708468">:=</span>&nbsp;<span class="ident" id="5708471">p</span><span class="op" id="5708472">.</span><span class="ident" id="5708473">expect</span><span class="op" id="5708479">(</span><span class="ident" id="5708480">token</span><span class="op" id="5708485">.</span><span class="ident" id="5708486">GO</span><span class="op" id="5708488">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708491">call</span>&nbsp;<span class="op" id="5708496">:=</span>&nbsp;<span class="ident" id="5708499">p</span><span class="op" id="5708500">.</span><span class="ident" id="5708501">parseCallExpr</span><span class="op" id="5708514">(</span><span class="string" id="5708515">&#34;go&#34;</span><span class="op" id="5708519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708522">p</span><span class="op" id="5708523">.</span><span class="ident" id="5708524">expectSemi</span><span class="op" id="5708534">(</span><span class="op" id="5708535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708538">if</span>&nbsp;<span class="ident" id="5708541">call</span>&nbsp;<span class="op" id="5708546">==</span>&nbsp;<span class="ident" id="5708549">nil</span>&nbsp;<span class="op" id="5708553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708557">return</span>&nbsp;<span class="op" id="5708564">&amp;</span><span class="ident" id="5708565">ast</span><span class="op" id="5708568">.</span><span class="ident" id="5708569">BadStmt</span><span class="op" id="5708576">{</span><span class="ident" id="5708577">From</span><span class="op" id="5708581">:</span>&nbsp;<span class="ident" id="5708583">pos</span><span class="op" id="5708586">,</span>&nbsp;<span class="ident" id="5708588">To</span><span class="op" id="5708590">:</span>&nbsp;<span class="ident" id="5708592">pos</span>&nbsp;<span class="op" id="5708596">+</span>&nbsp;<span class="num" id="5708598">2</span><span class="op" id="5708599">}</span>&nbsp;<span class="comment" id="5708601">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708615">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708619">return</span>&nbsp;<span class="op" id="5708626">&amp;</span><span class="ident" id="5708627">ast</span><span class="op" id="5708630">.</span><span class="ident" id="5708631">GoStmt</span><span class="op" id="5708637">{</span><span class="ident" id="5708638">Go</span><span class="op" id="5708640">:</span>&nbsp;<span class="ident" id="5708642">pos</span><span class="op" id="5708645">,</span>&nbsp;<span class="ident" id="5708647">Call</span><span class="op" id="5708651">:</span>&nbsp;<span class="ident" id="5708653">call</span><span class="op" id="5708657">}</span><br>
<span class="lineno"></span><span class="op" id="5708659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5708662">func</span>&nbsp;<span class="op" id="5708667">(</span><span class="ident" id="5708668">p</span>&nbsp;<span class="op" id="5708670">*</span><span class="ident" id="5708671">parser</span><span class="op" id="5708677">)</span>&nbsp;<span class="ident" id="5708679">parseDeferStmt</span><span class="op" id="5708693">(</span><span class="op" id="5708694">)</span>&nbsp;<span class="ident" id="5708696">ast</span><span class="op" id="5708699">.</span><span class="ident" id="5708700">Stmt</span>&nbsp;<span class="op" id="5708705">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708708">if</span>&nbsp;<span class="ident" id="5708711">p</span><span class="op" id="5708712">.</span><span class="ident" id="5708713">trace</span>&nbsp;<span class="op" id="5708719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708723">defer</span>&nbsp;<span class="ident" id="5708729">un</span><span class="op" id="5708731">(</span><span class="ident" id="5708732">trace</span><span class="op" id="5708737">(</span><span class="ident" id="5708738">p</span><span class="op" id="5708739">,</span>&nbsp;<span class="string" id="5708741">&#34;DeferStmt&#34;</span><span class="op" id="5708752">)</span><span class="op" id="5708753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708760">pos</span>&nbsp;<span class="op" id="5708764">:=</span>&nbsp;<span class="ident" id="5708767">p</span><span class="op" id="5708768">.</span><span class="ident" id="5708769">expect</span><span class="op" id="5708775">(</span><span class="ident" id="5708776">token</span><span class="op" id="5708781">.</span><span class="ident" id="5708782">DEFER</span><span class="op" id="5708787">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708790">call</span>&nbsp;<span class="op" id="5708795">:=</span>&nbsp;<span class="ident" id="5708798">p</span><span class="op" id="5708799">.</span><span class="ident" id="5708800">parseCallExpr</span><span class="op" id="5708813">(</span><span class="string" id="5708814">&#34;defer&#34;</span><span class="op" id="5708821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5708824">p</span><span class="op" id="5708825">.</span><span class="ident" id="5708826">expectSemi</span><span class="op" id="5708836">(</span><span class="op" id="5708837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708840">if</span>&nbsp;<span class="ident" id="5708843">call</span>&nbsp;<span class="op" id="5708848">==</span>&nbsp;<span class="ident" id="5708851">nil</span>&nbsp;<span class="op" id="5708855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708859">return</span>&nbsp;<span class="op" id="5708866">&amp;</span><span class="ident" id="5708867">ast</span><span class="op" id="5708870">.</span><span class="ident" id="5708871">BadStmt</span><span class="op" id="5708878">{</span><span class="ident" id="5708879">From</span><span class="op" id="5708883">:</span>&nbsp;<span class="ident" id="5708885">pos</span><span class="op" id="5708888">,</span>&nbsp;<span class="ident" id="5708890">To</span><span class="op" id="5708892">:</span>&nbsp;<span class="ident" id="5708894">pos</span>&nbsp;<span class="op" id="5708898">+</span>&nbsp;<span class="num" id="5708900">5</span><span class="op" id="5708901">}</span>&nbsp;<span class="comment" id="5708903">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5708920">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5708924">return</span>&nbsp;<span class="op" id="5708931">&amp;</span><span class="ident" id="5708932">ast</span><span class="op" id="5708935">.</span><span class="ident" id="5708936">DeferStmt</span><span class="op" id="5708945">{</span><span class="ident" id="5708946">Defer</span><span class="op" id="5708951">:</span>&nbsp;<span class="ident" id="5708953">pos</span><span class="op" id="5708956">,</span>&nbsp;<span class="ident" id="5708958">Call</span><span class="op" id="5708962">:</span>&nbsp;<span class="ident" id="5708964">call</span><span class="op" id="5708968">}</span><br>
<span class="lineno"></span><span class="op" id="5708970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5708973">func</span>&nbsp;<span class="op" id="5708978">(</span><span class="ident" id="5708979">p</span>&nbsp;<span class="op" id="5708981">*</span><span class="ident" id="5708982">parser</span><span class="op" id="5708988">)</span>&nbsp;<span class="ident" id="5708990">parseReturnStmt</span><span class="op" id="5709005">(</span><span class="op" id="5709006">)</span>&nbsp;<span class="op" id="5709008">*</span><span class="ident" id="5709009">ast</span><span class="op" id="5709012">.</span><span class="ident" id="5709013">ReturnStmt</span>&nbsp;<span class="op" id="5709024">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709027">if</span>&nbsp;<span class="ident" id="5709030">p</span><span class="op" id="5709031">.</span><span class="ident" id="5709032">trace</span>&nbsp;<span class="op" id="5709038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709042">defer</span>&nbsp;<span class="ident" id="5709048">un</span><span class="op" id="5709050">(</span><span class="ident" id="5709051">trace</span><span class="op" id="5709056">(</span><span class="ident" id="5709057">p</span><span class="op" id="5709058">,</span>&nbsp;<span class="string" id="5709060">&#34;ReturnStmt&#34;</span><span class="op" id="5709072">)</span><span class="op" id="5709073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709080">pos</span>&nbsp;<span class="op" id="5709084">:=</span>&nbsp;<span class="ident" id="5709087">p</span><span class="op" id="5709088">.</span><span class="ident" id="5709089">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709094">p</span><span class="op" id="5709095">.</span><span class="ident" id="5709096">expect</span><span class="op" id="5709102">(</span><span class="ident" id="5709103">token</span><span class="op" id="5709108">.</span><span class="ident" id="5709109">RETURN</span><span class="op" id="5709115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709118">var</span>&nbsp;<span class="ident" id="5709122">x</span>&nbsp;<span class="op" id="5709124">[</span><span class="op" id="5709125">]</span><span class="ident" id="5709126">ast</span><span class="op" id="5709129">.</span><span class="ident" id="5709130">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709136">if</span>&nbsp;<span class="ident" id="5709139">p</span><span class="op" id="5709140">.</span><span class="ident" id="5709141">tok</span>&nbsp;<span class="op" id="5709145">!=</span>&nbsp;<span class="ident" id="5709148">token</span><span class="op" id="5709153">.</span><span class="ident" id="5709154">SEMICOLON</span>&nbsp;<span class="op" id="5709164">&amp;&amp;</span>&nbsp;<span class="ident" id="5709167">p</span><span class="op" id="5709168">.</span><span class="ident" id="5709169">tok</span>&nbsp;<span class="op" id="5709173">!=</span>&nbsp;<span class="ident" id="5709176">token</span><span class="op" id="5709181">.</span><span class="ident" id="5709182">RBRACE</span>&nbsp;<span class="op" id="5709189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709193">x</span>&nbsp;<span class="op" id="5709195">=</span>&nbsp;<span class="ident" id="5709197">p</span><span class="op" id="5709198">.</span><span class="ident" id="5709199">parseRhsList</span><span class="op" id="5709211">(</span><span class="op" id="5709212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709215">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709218">p</span><span class="op" id="5709219">.</span><span class="ident" id="5709220">expectSemi</span><span class="op" id="5709230">(</span><span class="op" id="5709231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709235">return</span>&nbsp;<span class="op" id="5709242">&amp;</span><span class="ident" id="5709243">ast</span><span class="op" id="5709246">.</span><span class="ident" id="5709247">ReturnStmt</span><span class="op" id="5709257">{</span><span class="ident" id="5709258">Return</span><span class="op" id="5709264">:</span>&nbsp;<span class="ident" id="5709266">pos</span><span class="op" id="5709269">,</span>&nbsp;<span class="ident" id="5709271">Results</span><span class="op" id="5709278">:</span>&nbsp;<span class="ident" id="5709280">x</span><span class="op" id="5709281">}</span><br>
<span class="lineno"></span><span class="op" id="5709283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5709286">func</span>&nbsp;<span class="op" id="5709291">(</span><span class="ident" id="5709292">p</span>&nbsp;<span class="op" id="5709294">*</span><span class="ident" id="5709295">parser</span><span class="op" id="5709301">)</span>&nbsp;<span class="ident" id="5709303">parseBranchStmt</span><span class="op" id="5709318">(</span><span class="ident" id="5709319">tok</span>&nbsp;<span class="ident" id="5709323">token</span><span class="op" id="5709328">.</span><span class="ident" id="5709329">Token</span><span class="op" id="5709334">)</span>&nbsp;<span class="op" id="5709336">*</span><span class="ident" id="5709337">ast</span><span class="op" id="5709340">.</span><span class="ident" id="5709341">BranchStmt</span>&nbsp;<span class="op" id="5709352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709355">if</span>&nbsp;<span class="ident" id="5709358">p</span><span class="op" id="5709359">.</span><span class="ident" id="5709360">trace</span>&nbsp;<span class="op" id="5709366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709370">defer</span>&nbsp;<span class="ident" id="5709376">un</span><span class="op" id="5709378">(</span><span class="ident" id="5709379">trace</span><span class="op" id="5709384">(</span><span class="ident" id="5709385">p</span><span class="op" id="5709386">,</span>&nbsp;<span class="string" id="5709388">&#34;BranchStmt&#34;</span><span class="op" id="5709400">)</span><span class="op" id="5709401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709408">pos</span>&nbsp;<span class="op" id="5709412">:=</span>&nbsp;<span class="ident" id="5709415">p</span><span class="op" id="5709416">.</span><span class="ident" id="5709417">expect</span><span class="op" id="5709423">(</span><span class="ident" id="5709424">tok</span><span class="op" id="5709427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709430">var</span>&nbsp;<span class="ident" id="5709434">label</span>&nbsp;<span class="op" id="5709440">*</span><span class="ident" id="5709441">ast</span><span class="op" id="5709444">.</span><span class="ident" id="5709445">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709452">if</span>&nbsp;<span class="ident" id="5709455">tok</span>&nbsp;<span class="op" id="5709459">!=</span>&nbsp;<span class="ident" id="5709462">token</span><span class="op" id="5709467">.</span><span class="ident" id="5709468">FALLTHROUGH</span>&nbsp;<span class="op" id="5709480">&amp;&amp;</span>&nbsp;<span class="ident" id="5709483">p</span><span class="op" id="5709484">.</span><span class="ident" id="5709485">tok</span>&nbsp;<span class="op" id="5709489">==</span>&nbsp;<span class="ident" id="5709492">token</span><span class="op" id="5709497">.</span><span class="ident" id="5709498">IDENT</span>&nbsp;<span class="op" id="5709504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709508">label</span>&nbsp;<span class="op" id="5709514">=</span>&nbsp;<span class="ident" id="5709516">p</span><span class="op" id="5709517">.</span><span class="ident" id="5709518">parseIdent</span><span class="op" id="5709528">(</span><span class="op" id="5709529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5709533">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709572">n</span>&nbsp;<span class="op" id="5709574">:=</span>&nbsp;<span class="builtinfunc" id="5709577">len</span><span class="op" id="5709580">(</span><span class="ident" id="5709581">p</span><span class="op" id="5709582">.</span><span class="ident" id="5709583">targetStack</span><span class="op" id="5709594">)</span>&nbsp;<span class="op" id="5709596">-</span>&nbsp;<span class="num" id="5709598">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709602">p</span><span class="op" id="5709603">.</span><span class="ident" id="5709604">targetStack</span><span class="op" id="5709615">[</span><span class="ident" id="5709616">n</span><span class="op" id="5709617">]</span>&nbsp;<span class="op" id="5709619">=</span>&nbsp;<span class="builtinfunc" id="5709621">append</span><span class="op" id="5709627">(</span><span class="ident" id="5709628">p</span><span class="op" id="5709629">.</span><span class="ident" id="5709630">targetStack</span><span class="op" id="5709641">[</span><span class="ident" id="5709642">n</span><span class="op" id="5709643">]</span><span class="op" id="5709644">,</span>&nbsp;<span class="ident" id="5709646">label</span><span class="op" id="5709651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709657">p</span><span class="op" id="5709658">.</span><span class="ident" id="5709659">expectSemi</span><span class="op" id="5709669">(</span><span class="op" id="5709670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709674">return</span>&nbsp;<span class="op" id="5709681">&amp;</span><span class="ident" id="5709682">ast</span><span class="op" id="5709685">.</span><span class="ident" id="5709686">BranchStmt</span><span class="op" id="5709696">{</span><span class="ident" id="5709697">TokPos</span><span class="op" id="5709703">:</span>&nbsp;<span class="ident" id="5709705">pos</span><span class="op" id="5709708">,</span>&nbsp;<span class="ident" id="5709710">Tok</span><span class="op" id="5709713">:</span>&nbsp;<span class="ident" id="5709715">tok</span><span class="op" id="5709718">,</span>&nbsp;<span class="ident" id="5709720">Label</span><span class="op" id="5709725">:</span>&nbsp;<span class="ident" id="5709727">label</span><span class="op" id="5709732">}</span><br>
<span class="lineno"></span><span class="op" id="5709734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5709737">func</span>&nbsp;<span class="op" id="5709742">(</span><span class="ident" id="5709743">p</span>&nbsp;<span class="op" id="5709745">*</span><span class="ident" id="5709746">parser</span><span class="op" id="5709752">)</span>&nbsp;<span class="ident" id="5709754">makeExpr</span><span class="op" id="5709762">(</span><span class="ident" id="5709763">s</span>&nbsp;<span class="ident" id="5709765">ast</span><span class="op" id="5709768">.</span><span class="ident" id="5709769">Stmt</span><span class="op" id="5709773">,</span>&nbsp;<span class="ident" id="5709775">kind</span>&nbsp;<span class="builtintype" id="5709780">string</span><span class="op" id="5709786">)</span>&nbsp;<span class="ident" id="5709788">ast</span><span class="op" id="5709791">.</span><span class="ident" id="5709792">Expr</span>&nbsp;<span class="op" id="5709797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709800">if</span>&nbsp;<span class="ident" id="5709803">s</span>&nbsp;<span class="op" id="5709805">==</span>&nbsp;<span class="ident" id="5709808">nil</span>&nbsp;<span class="op" id="5709812">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709816">return</span>&nbsp;<span class="ident" id="5709823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709831">if</span>&nbsp;<span class="ident" id="5709834">es</span><span class="op" id="5709836">,</span>&nbsp;<span class="ident" id="5709838">isExpr</span>&nbsp;<span class="op" id="5709845">:=</span>&nbsp;<span class="ident" id="5709848">s</span><span class="op" id="5709849">.</span><span class="op" id="5709850">(</span><span class="op" id="5709851">*</span><span class="ident" id="5709852">ast</span><span class="op" id="5709855">.</span><span class="ident" id="5709856">ExprStmt</span><span class="op" id="5709864">)</span><span class="op" id="5709865">;</span>&nbsp;<span class="ident" id="5709867">isExpr</span>&nbsp;<span class="op" id="5709874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5709878">return</span>&nbsp;<span class="ident" id="5709885">p</span><span class="op" id="5709886">.</span><span class="ident" id="5709887">checkExpr</span><span class="op" id="5709896">(</span><span class="ident" id="5709897">es</span><span class="op" id="5709899">.</span><span class="ident" id="5709900">X</span><span class="op" id="5709901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5709904">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5709907">p</span><span class="op" id="5709908">.</span><span class="builtintype" id="5709909">error</span><span class="op" id="5709914">(</span><span class="ident" id="5709915">s</span><span class="op" id="5709916">.</span><span class="ident" id="5709917">Pos</span><span class="op" id="5709920">(</span><span class="op" id="5709921">)</span><span class="op" id="5709922">,</span>&nbsp;<span class="ident" id="5709924">fmt</span><span class="op" id="5709927">.</span><span class="ident" id="5709928">Sprintf</span><span class="op" id="5709935">(</span><span class="string" id="5709936">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5710021">,</span>&nbsp;<span class="ident" id="5710023">kind</span><span class="op" id="5710027">)</span><span class="op" id="5710028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710031">return</span>&nbsp;<span class="op" id="5710038">&amp;</span><span class="ident" id="5710039">ast</span><span class="op" id="5710042">.</span><span class="ident" id="5710043">BadExpr</span><span class="op" id="5710050">{</span><span class="ident" id="5710051">From</span><span class="op" id="5710055">:</span>&nbsp;<span class="ident" id="5710057">s</span><span class="op" id="5710058">.</span><span class="ident" id="5710059">Pos</span><span class="op" id="5710062">(</span><span class="op" id="5710063">)</span><span class="op" id="5710064">,</span>&nbsp;<span class="ident" id="5710066">To</span><span class="op" id="5710068">:</span>&nbsp;<span class="ident" id="5710070">p</span><span class="op" id="5710071">.</span><span class="ident" id="5710072">safePos</span><span class="op" id="5710079">(</span><span class="ident" id="5710080">s</span><span class="op" id="5710081">.</span><span class="ident" id="5710082">End</span><span class="op" id="5710085">(</span><span class="op" id="5710086">)</span><span class="op" id="5710087">)</span><span class="op" id="5710088">}</span><br>
<span class="lineno"></span><span class="op" id="5710090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5710093">func</span>&nbsp;<span class="op" id="5710098">(</span><span class="ident" id="5710099">p</span>&nbsp;<span class="op" id="5710101">*</span><span class="ident" id="5710102">parser</span><span class="op" id="5710108">)</span>&nbsp;<span class="ident" id="5710110">parseIfStmt</span><span class="op" id="5710121">(</span><span class="op" id="5710122">)</span>&nbsp;<span class="op" id="5710124">*</span><span class="ident" id="5710125">ast</span><span class="op" id="5710128">.</span><span class="ident" id="5710129">IfStmt</span>&nbsp;<span class="op" id="5710136">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710139">if</span>&nbsp;<span class="ident" id="5710142">p</span><span class="op" id="5710143">.</span><span class="ident" id="5710144">trace</span>&nbsp;<span class="op" id="5710150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710154">defer</span>&nbsp;<span class="ident" id="5710160">un</span><span class="op" id="5710162">(</span><span class="ident" id="5710163">trace</span><span class="op" id="5710168">(</span><span class="ident" id="5710169">p</span><span class="op" id="5710170">,</span>&nbsp;<span class="string" id="5710172">&#34;IfStmt&#34;</span><span class="op" id="5710180">)</span><span class="op" id="5710181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710188">pos</span>&nbsp;<span class="op" id="5710192">:=</span>&nbsp;<span class="ident" id="5710195">p</span><span class="op" id="5710196">.</span><span class="ident" id="5710197">expect</span><span class="op" id="5710203">(</span><span class="ident" id="5710204">token</span><span class="op" id="5710209">.</span><span class="ident" id="5710210">IF</span><span class="op" id="5710212">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710215">p</span><span class="op" id="5710216">.</span><span class="ident" id="5710217">openScope</span><span class="op" id="5710226">(</span><span class="op" id="5710227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710230">defer</span>&nbsp;<span class="ident" id="5710236">p</span><span class="op" id="5710237">.</span><span class="ident" id="5710238">closeScope</span><span class="op" id="5710248">(</span><span class="op" id="5710249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710253">var</span>&nbsp;<span class="ident" id="5710257">s</span>&nbsp;<span class="ident" id="5710259">ast</span><span class="op" id="5710262">.</span><span class="ident" id="5710263">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710269">var</span>&nbsp;<span class="ident" id="5710273">x</span>&nbsp;<span class="ident" id="5710275">ast</span><span class="op" id="5710278">.</span><span class="ident" id="5710279">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710289">prevLev</span>&nbsp;<span class="op" id="5710297">:=</span>&nbsp;<span class="ident" id="5710300">p</span><span class="op" id="5710301">.</span><span class="ident" id="5710302">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710312">p</span><span class="op" id="5710313">.</span><span class="ident" id="5710314">exprLev</span>&nbsp;<span class="op" id="5710322">=</span>&nbsp;<span class="op" id="5710324">-</span><span class="num" id="5710325">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710329">if</span>&nbsp;<span class="ident" id="5710332">p</span><span class="op" id="5710333">.</span><span class="ident" id="5710334">tok</span>&nbsp;<span class="op" id="5710338">==</span>&nbsp;<span class="ident" id="5710341">token</span><span class="op" id="5710346">.</span><span class="ident" id="5710347">SEMICOLON</span>&nbsp;<span class="op" id="5710357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710362">p</span><span class="op" id="5710363">.</span><span class="ident" id="5710364">next</span><span class="op" id="5710368">(</span><span class="op" id="5710369">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710374">x</span>&nbsp;<span class="op" id="5710376">=</span>&nbsp;<span class="ident" id="5710378">p</span><span class="op" id="5710379">.</span><span class="ident" id="5710380">parseRhs</span><span class="op" id="5710388">(</span><span class="op" id="5710389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710393">}</span>&nbsp;<span class="keyword" id="5710395">else</span>&nbsp;<span class="op" id="5710400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710405">s</span><span class="op" id="5710406">,</span>&nbsp;<span class="ident" id="5710408">_</span>&nbsp;<span class="op" id="5710410">=</span>&nbsp;<span class="ident" id="5710412">p</span><span class="op" id="5710413">.</span><span class="ident" id="5710414">parseSimpleStmt</span><span class="op" id="5710429">(</span><span class="ident" id="5710430">basic</span><span class="op" id="5710435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710440">if</span>&nbsp;<span class="ident" id="5710443">p</span><span class="op" id="5710444">.</span><span class="ident" id="5710445">tok</span>&nbsp;<span class="op" id="5710449">==</span>&nbsp;<span class="ident" id="5710452">token</span><span class="op" id="5710457">.</span><span class="ident" id="5710458">SEMICOLON</span>&nbsp;<span class="op" id="5710468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710474">p</span><span class="op" id="5710475">.</span><span class="ident" id="5710476">next</span><span class="op" id="5710480">(</span><span class="op" id="5710481">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710487">x</span>&nbsp;<span class="op" id="5710489">=</span>&nbsp;<span class="ident" id="5710491">p</span><span class="op" id="5710492">.</span><span class="ident" id="5710493">parseRhs</span><span class="op" id="5710501">(</span><span class="op" id="5710502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710507">}</span>&nbsp;<span class="keyword" id="5710509">else</span>&nbsp;<span class="op" id="5710514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710520">x</span>&nbsp;<span class="op" id="5710522">=</span>&nbsp;<span class="ident" id="5710524">p</span><span class="op" id="5710525">.</span><span class="ident" id="5710526">makeExpr</span><span class="op" id="5710534">(</span><span class="ident" id="5710535">s</span><span class="op" id="5710536">,</span>&nbsp;<span class="string" id="5710538">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5710558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710564">s</span>&nbsp;<span class="op" id="5710566">=</span>&nbsp;<span class="ident" id="5710568">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710575">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710583">p</span><span class="op" id="5710584">.</span><span class="ident" id="5710585">exprLev</span>&nbsp;<span class="op" id="5710593">=</span>&nbsp;<span class="ident" id="5710595">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710608">body</span>&nbsp;<span class="op" id="5710613">:=</span>&nbsp;<span class="ident" id="5710616">p</span><span class="op" id="5710617">.</span><span class="ident" id="5710618">parseBlockStmt</span><span class="op" id="5710632">(</span><span class="op" id="5710633">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710636">var</span>&nbsp;<span class="ident" id="5710640">else_</span>&nbsp;<span class="ident" id="5710646">ast</span><span class="op" id="5710649">.</span><span class="ident" id="5710650">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710656">if</span>&nbsp;<span class="ident" id="5710659">p</span><span class="op" id="5710660">.</span><span class="ident" id="5710661">tok</span>&nbsp;<span class="op" id="5710665">==</span>&nbsp;<span class="ident" id="5710668">token</span><span class="op" id="5710673">.</span><span class="ident" id="5710674">ELSE</span>&nbsp;<span class="op" id="5710679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710683">p</span><span class="op" id="5710684">.</span><span class="ident" id="5710685">next</span><span class="op" id="5710689">(</span><span class="op" id="5710690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710694">else_</span>&nbsp;<span class="op" id="5710700">=</span>&nbsp;<span class="ident" id="5710702">p</span><span class="op" id="5710703">.</span><span class="ident" id="5710704">parseStmt</span><span class="op" id="5710713">(</span><span class="op" id="5710714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710717">}</span>&nbsp;<span class="keyword" id="5710719">else</span>&nbsp;<span class="op" id="5710724">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710728">p</span><span class="op" id="5710729">.</span><span class="ident" id="5710730">expectSemi</span><span class="op" id="5710740">(</span><span class="op" id="5710741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710748">return</span>&nbsp;<span class="op" id="5710755">&amp;</span><span class="ident" id="5710756">ast</span><span class="op" id="5710759">.</span><span class="ident" id="5710760">IfStmt</span><span class="op" id="5710766">{</span><span class="ident" id="5710767">If</span><span class="op" id="5710769">:</span>&nbsp;<span class="ident" id="5710771">pos</span><span class="op" id="5710774">,</span>&nbsp;<span class="ident" id="5710776">Init</span><span class="op" id="5710780">:</span>&nbsp;<span class="ident" id="5710782">s</span><span class="op" id="5710783">,</span>&nbsp;<span class="ident" id="5710785">Cond</span><span class="op" id="5710789">:</span>&nbsp;<span class="ident" id="5710791">x</span><span class="op" id="5710792">,</span>&nbsp;<span class="ident" id="5710794">Body</span><span class="op" id="5710798">:</span>&nbsp;<span class="ident" id="5710800">body</span><span class="op" id="5710804">,</span>&nbsp;<span class="ident" id="5710806">Else</span><span class="op" id="5710810">:</span>&nbsp;<span class="ident" id="5710812">else_</span><span class="op" id="5710817">}</span><br>
<span class="lineno"></span><span class="op" id="5710819">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5710822">func</span>&nbsp;<span class="op" id="5710827">(</span><span class="ident" id="5710828">p</span>&nbsp;<span class="op" id="5710830">*</span><span class="ident" id="5710831">parser</span><span class="op" id="5710837">)</span>&nbsp;<span class="ident" id="5710839">parseTypeList</span><span class="op" id="5710852">(</span><span class="op" id="5710853">)</span>&nbsp;<span class="op" id="5710855">(</span><span class="ident" id="5710856">list</span>&nbsp;<span class="op" id="5710861">[</span><span class="op" id="5710862">]</span><span class="ident" id="5710863">ast</span><span class="op" id="5710866">.</span><span class="ident" id="5710867">Expr</span><span class="op" id="5710871">)</span>&nbsp;<span class="op" id="5710873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710876">if</span>&nbsp;<span class="ident" id="5710879">p</span><span class="op" id="5710880">.</span><span class="ident" id="5710881">trace</span>&nbsp;<span class="op" id="5710887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710891">defer</span>&nbsp;<span class="ident" id="5710897">un</span><span class="op" id="5710899">(</span><span class="ident" id="5710900">trace</span><span class="op" id="5710905">(</span><span class="ident" id="5710906">p</span><span class="op" id="5710907">,</span>&nbsp;<span class="string" id="5710909">&#34;TypeList&#34;</span><span class="op" id="5710919">)</span><span class="op" id="5710920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5710923">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710927">list</span>&nbsp;<span class="op" id="5710932">=</span>&nbsp;<span class="builtinfunc" id="5710934">append</span><span class="op" id="5710940">(</span><span class="ident" id="5710941">list</span><span class="op" id="5710945">,</span>&nbsp;<span class="ident" id="5710947">p</span><span class="op" id="5710948">.</span><span class="ident" id="5710949">parseType</span><span class="op" id="5710958">(</span><span class="op" id="5710959">)</span><span class="op" id="5710960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5710963">for</span>&nbsp;<span class="ident" id="5710967">p</span><span class="op" id="5710968">.</span><span class="ident" id="5710969">tok</span>&nbsp;<span class="op" id="5710973">==</span>&nbsp;<span class="ident" id="5710976">token</span><span class="op" id="5710981">.</span><span class="ident" id="5710982">COMMA</span>&nbsp;<span class="op" id="5710988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5710992">p</span><span class="op" id="5710993">.</span><span class="ident" id="5710994">next</span><span class="op" id="5710998">(</span><span class="op" id="5710999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711003">list</span>&nbsp;<span class="op" id="5711008">=</span>&nbsp;<span class="builtinfunc" id="5711010">append</span><span class="op" id="5711016">(</span><span class="ident" id="5711017">list</span><span class="op" id="5711021">,</span>&nbsp;<span class="ident" id="5711023">p</span><span class="op" id="5711024">.</span><span class="ident" id="5711025">parseType</span><span class="op" id="5711034">(</span><span class="op" id="5711035">)</span><span class="op" id="5711036">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711043">return</span><br>
<span class="lineno"></span><span class="op" id="5711050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5711053">func</span>&nbsp;<span class="op" id="5711058">(</span><span class="ident" id="5711059">p</span>&nbsp;<span class="op" id="5711061">*</span><span class="ident" id="5711062">parser</span><span class="op" id="5711068">)</span>&nbsp;<span class="ident" id="5711070">parseCaseClause</span><span class="op" id="5711085">(</span><span class="ident" id="5711086">typeSwitch</span>&nbsp;<span class="builtintype" id="5711097">bool</span><span class="op" id="5711101">)</span>&nbsp;<span class="op" id="5711103">*</span><span class="ident" id="5711104">ast</span><span class="op" id="5711107">.</span><span class="ident" id="5711108">CaseClause</span>&nbsp;<span class="op" id="5711119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711122">if</span>&nbsp;<span class="ident" id="5711125">p</span><span class="op" id="5711126">.</span><span class="ident" id="5711127">trace</span>&nbsp;<span class="op" id="5711133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711137">defer</span>&nbsp;<span class="ident" id="5711143">un</span><span class="op" id="5711145">(</span><span class="ident" id="5711146">trace</span><span class="op" id="5711151">(</span><span class="ident" id="5711152">p</span><span class="op" id="5711153">,</span>&nbsp;<span class="string" id="5711155">&#34;CaseClause&#34;</span><span class="op" id="5711167">)</span><span class="op" id="5711168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711175">pos</span>&nbsp;<span class="op" id="5711179">:=</span>&nbsp;<span class="ident" id="5711182">p</span><span class="op" id="5711183">.</span><span class="ident" id="5711184">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711189">var</span>&nbsp;<span class="ident" id="5711193">list</span>&nbsp;<span class="op" id="5711198">[</span><span class="op" id="5711199">]</span><span class="ident" id="5711200">ast</span><span class="op" id="5711203">.</span><span class="ident" id="5711204">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711210">if</span>&nbsp;<span class="ident" id="5711213">p</span><span class="op" id="5711214">.</span><span class="ident" id="5711215">tok</span>&nbsp;<span class="op" id="5711219">==</span>&nbsp;<span class="ident" id="5711222">token</span><span class="op" id="5711227">.</span><span class="ident" id="5711228">CASE</span>&nbsp;<span class="op" id="5711233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711237">p</span><span class="op" id="5711238">.</span><span class="ident" id="5711239">next</span><span class="op" id="5711243">(</span><span class="op" id="5711244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711248">if</span>&nbsp;<span class="ident" id="5711251">typeSwitch</span>&nbsp;<span class="op" id="5711262">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711267">list</span>&nbsp;<span class="op" id="5711272">=</span>&nbsp;<span class="ident" id="5711274">p</span><span class="op" id="5711275">.</span><span class="ident" id="5711276">parseTypeList</span><span class="op" id="5711289">(</span><span class="op" id="5711290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711294">}</span>&nbsp;<span class="keyword" id="5711296">else</span>&nbsp;<span class="op" id="5711301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711306">list</span>&nbsp;<span class="op" id="5711311">=</span>&nbsp;<span class="ident" id="5711313">p</span><span class="op" id="5711314">.</span><span class="ident" id="5711315">parseRhsList</span><span class="op" id="5711327">(</span><span class="op" id="5711328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711335">}</span>&nbsp;<span class="keyword" id="5711337">else</span>&nbsp;<span class="op" id="5711342">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711346">p</span><span class="op" id="5711347">.</span><span class="ident" id="5711348">expect</span><span class="op" id="5711354">(</span><span class="ident" id="5711355">token</span><span class="op" id="5711360">.</span><span class="ident" id="5711361">DEFAULT</span><span class="op" id="5711368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711375">colon</span>&nbsp;<span class="op" id="5711381">:=</span>&nbsp;<span class="ident" id="5711384">p</span><span class="op" id="5711385">.</span><span class="ident" id="5711386">expect</span><span class="op" id="5711392">(</span><span class="ident" id="5711393">token</span><span class="op" id="5711398">.</span><span class="ident" id="5711399">COLON</span><span class="op" id="5711404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711407">p</span><span class="op" id="5711408">.</span><span class="ident" id="5711409">openScope</span><span class="op" id="5711418">(</span><span class="op" id="5711419">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711422">body</span>&nbsp;<span class="op" id="5711427">:=</span>&nbsp;<span class="ident" id="5711430">p</span><span class="op" id="5711431">.</span><span class="ident" id="5711432">parseStmtList</span><span class="op" id="5711445">(</span><span class="op" id="5711446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711449">p</span><span class="op" id="5711450">.</span><span class="ident" id="5711451">closeScope</span><span class="op" id="5711461">(</span><span class="op" id="5711462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711466">return</span>&nbsp;<span class="op" id="5711473">&amp;</span><span class="ident" id="5711474">ast</span><span class="op" id="5711477">.</span><span class="ident" id="5711478">CaseClause</span><span class="op" id="5711488">{</span><span class="ident" id="5711489">Case</span><span class="op" id="5711493">:</span>&nbsp;<span class="ident" id="5711495">pos</span><span class="op" id="5711498">,</span>&nbsp;<span class="ident" id="5711500">List</span><span class="op" id="5711504">:</span>&nbsp;<span class="ident" id="5711506">list</span><span class="op" id="5711510">,</span>&nbsp;<span class="ident" id="5711512">Colon</span><span class="op" id="5711517">:</span>&nbsp;<span class="ident" id="5711519">colon</span><span class="op" id="5711524">,</span>&nbsp;<span class="ident" id="5711526">Body</span><span class="op" id="5711530">:</span>&nbsp;<span class="ident" id="5711532">body</span><span class="op" id="5711536">}</span><br>
<span class="lineno"></span><span class="op" id="5711538">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5711541">func</span>&nbsp;<span class="ident" id="5711546">isTypeSwitchAssert</span><span class="op" id="5711564">(</span><span class="ident" id="5711565">x</span>&nbsp;<span class="ident" id="5711567">ast</span><span class="op" id="5711570">.</span><span class="ident" id="5711571">Expr</span><span class="op" id="5711575">)</span>&nbsp;<span class="builtintype" id="5711577">bool</span>&nbsp;<span class="op" id="5711582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5711585">a</span><span class="op" id="5711586">,</span>&nbsp;<span class="ident" id="5711588">ok</span>&nbsp;<span class="op" id="5711591">:=</span>&nbsp;<span class="ident" id="5711594">x</span><span class="op" id="5711595">.</span><span class="op" id="5711596">(</span><span class="op" id="5711597">*</span><span class="ident" id="5711598">ast</span><span class="op" id="5711601">.</span><span class="ident" id="5711602">TypeAssertExpr</span><span class="op" id="5711616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711619">return</span>&nbsp;<span class="ident" id="5711626">ok</span>&nbsp;<span class="op" id="5711629">&amp;&amp;</span>&nbsp;<span class="ident" id="5711632">a</span><span class="op" id="5711633">.</span><span class="ident" id="5711634">Type</span>&nbsp;<span class="op" id="5711639">==</span>&nbsp;<span class="ident" id="5711642">nil</span><br>
<span class="lineno"></span><span class="op" id="5711646">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5711649">func</span>&nbsp;<span class="ident" id="5711654">isTypeSwitchGuard</span><span class="op" id="5711671">(</span><span class="ident" id="5711672">s</span>&nbsp;<span class="ident" id="5711674">ast</span><span class="op" id="5711677">.</span><span class="ident" id="5711678">Stmt</span><span class="op" id="5711682">)</span>&nbsp;<span class="builtintype" id="5711684">bool</span>&nbsp;<span class="op" id="5711689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711692">switch</span>&nbsp;<span class="ident" id="5711699">t</span>&nbsp;<span class="op" id="5711701">:=</span>&nbsp;<span class="ident" id="5711704">s</span><span class="op" id="5711705">.</span><span class="op" id="5711706">(</span><span class="keyword" id="5711707">type</span><span class="op" id="5711711">)</span>&nbsp;<span class="op" id="5711713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711716">case</span>&nbsp;<span class="op" id="5711721">*</span><span class="ident" id="5711722">ast</span><span class="op" id="5711725">.</span><span class="ident" id="5711726">ExprStmt</span><span class="op" id="5711734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5711738">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711751">return</span>&nbsp;<span class="ident" id="5711758">isTypeSwitchAssert</span><span class="op" id="5711776">(</span><span class="ident" id="5711777">t</span><span class="op" id="5711778">.</span><span class="ident" id="5711779">X</span><span class="op" id="5711780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711783">case</span>&nbsp;<span class="op" id="5711788">*</span><span class="ident" id="5711789">ast</span><span class="op" id="5711792">.</span><span class="ident" id="5711793">AssignStmt</span><span class="op" id="5711803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5711807">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711825">return</span>&nbsp;<span class="builtinfunc" id="5711832">len</span><span class="op" id="5711835">(</span><span class="ident" id="5711836">t</span><span class="op" id="5711837">.</span><span class="ident" id="5711838">Lhs</span><span class="op" id="5711841">)</span>&nbsp;<span class="op" id="5711843">==</span>&nbsp;<span class="num" id="5711846">1</span>&nbsp;<span class="op" id="5711848">&amp;&amp;</span>&nbsp;<span class="ident" id="5711851">t</span><span class="op" id="5711852">.</span><span class="ident" id="5711853">Tok</span>&nbsp;<span class="op" id="5711857">==</span>&nbsp;<span class="ident" id="5711860">token</span><span class="op" id="5711865">.</span><span class="ident" id="5711866">DEFINE</span>&nbsp;<span class="op" id="5711873">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5711876">len</span><span class="op" id="5711879">(</span><span class="ident" id="5711880">t</span><span class="op" id="5711881">.</span><span class="ident" id="5711882">Rhs</span><span class="op" id="5711885">)</span>&nbsp;<span class="op" id="5711887">==</span>&nbsp;<span class="num" id="5711890">1</span>&nbsp;<span class="op" id="5711892">&amp;&amp;</span>&nbsp;<span class="ident" id="5711895">isTypeSwitchAssert</span><span class="op" id="5711913">(</span><span class="ident" id="5711914">t</span><span class="op" id="5711915">.</span><span class="ident" id="5711916">Rhs</span><span class="op" id="5711919">[</span><span class="num" id="5711920">0</span><span class="op" id="5711921">]</span><span class="op" id="5711922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5711925">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711928">return</span>&nbsp;<span class="builtintype" id="5711935">false</span><br>
<span class="lineno"></span><span class="op" id="5711941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5711944">func</span>&nbsp;<span class="op" id="5711949">(</span><span class="ident" id="5711950">p</span>&nbsp;<span class="op" id="5711952">*</span><span class="ident" id="5711953">parser</span><span class="op" id="5711959">)</span>&nbsp;<span class="ident" id="5711961">parseSwitchStmt</span><span class="op" id="5711976">(</span><span class="op" id="5711977">)</span>&nbsp;<span class="ident" id="5711979">ast</span><span class="op" id="5711982">.</span><span class="ident" id="5711983">Stmt</span>&nbsp;<span class="op" id="5711988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5711991">if</span>&nbsp;<span class="ident" id="5711994">p</span><span class="op" id="5711995">.</span><span class="ident" id="5711996">trace</span>&nbsp;<span class="op" id="5712002">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712006">defer</span>&nbsp;<span class="ident" id="5712012">un</span><span class="op" id="5712014">(</span><span class="ident" id="5712015">trace</span><span class="op" id="5712020">(</span><span class="ident" id="5712021">p</span><span class="op" id="5712022">,</span>&nbsp;<span class="string" id="5712024">&#34;SwitchStmt&#34;</span><span class="op" id="5712036">)</span><span class="op" id="5712037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5712040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712044">pos</span>&nbsp;<span class="op" id="5712048">:=</span>&nbsp;<span class="ident" id="5712051">p</span><span class="op" id="5712052">.</span><span class="ident" id="5712053">expect</span><span class="op" id="5712059">(</span><span class="ident" id="5712060">token</span><span class="op" id="5712065">.</span><span class="ident" id="5712066">SWITCH</span><span class="op" id="5712072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712075">p</span><span class="op" id="5712076">.</span><span class="ident" id="5712077">openScope</span><span class="op" id="5712086">(</span><span class="op" id="5712087">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712090">defer</span>&nbsp;<span class="ident" id="5712096">p</span><span class="op" id="5712097">.</span><span class="ident" id="5712098">closeScope</span><span class="op" id="5712108">(</span><span class="op" id="5712109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712113">var</span>&nbsp;<span class="ident" id="5712117">s1</span><span class="op" id="5712119">,</span>&nbsp;<span class="ident" id="5712121">s2</span>&nbsp;<span class="ident" id="5712124">ast</span><span class="op" id="5712127">.</span><span class="ident" id="5712128">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712134">if</span>&nbsp;<span class="ident" id="5712137">p</span><span class="op" id="5712138">.</span><span class="ident" id="5712139">tok</span>&nbsp;<span class="op" id="5712143">!=</span>&nbsp;<span class="ident" id="5712146">token</span><span class="op" id="5712151">.</span><span class="ident" id="5712152">LBRACE</span>&nbsp;<span class="op" id="5712159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712163">prevLev</span>&nbsp;<span class="op" id="5712171">:=</span>&nbsp;<span class="ident" id="5712174">p</span><span class="op" id="5712175">.</span><span class="ident" id="5712176">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712186">p</span><span class="op" id="5712187">.</span><span class="ident" id="5712188">exprLev</span>&nbsp;<span class="op" id="5712196">=</span>&nbsp;<span class="op" id="5712198">-</span><span class="num" id="5712199">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712203">if</span>&nbsp;<span class="ident" id="5712206">p</span><span class="op" id="5712207">.</span><span class="ident" id="5712208">tok</span>&nbsp;<span class="op" id="5712212">!=</span>&nbsp;<span class="ident" id="5712215">token</span><span class="op" id="5712220">.</span><span class="ident" id="5712221">SEMICOLON</span>&nbsp;<span class="op" id="5712231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712236">s2</span><span class="op" id="5712238">,</span>&nbsp;<span class="ident" id="5712240">_</span>&nbsp;<span class="op" id="5712242">=</span>&nbsp;<span class="ident" id="5712244">p</span><span class="op" id="5712245">.</span><span class="ident" id="5712246">parseSimpleStmt</span><span class="op" id="5712261">(</span><span class="ident" id="5712262">basic</span><span class="op" id="5712267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5712271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712275">if</span>&nbsp;<span class="ident" id="5712278">p</span><span class="op" id="5712279">.</span><span class="ident" id="5712280">tok</span>&nbsp;<span class="op" id="5712284">==</span>&nbsp;<span class="ident" id="5712287">token</span><span class="op" id="5712292">.</span><span class="ident" id="5712293">SEMICOLON</span>&nbsp;<span class="op" id="5712303">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712308">p</span><span class="op" id="5712309">.</span><span class="ident" id="5712310">next</span><span class="op" id="5712314">(</span><span class="op" id="5712315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712320">s1</span>&nbsp;<span class="op" id="5712323">=</span>&nbsp;<span class="ident" id="5712325">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712331">s2</span>&nbsp;<span class="op" id="5712334">=</span>&nbsp;<span class="ident" id="5712336">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712343">if</span>&nbsp;<span class="ident" id="5712346">p</span><span class="op" id="5712347">.</span><span class="ident" id="5712348">tok</span>&nbsp;<span class="op" id="5712352">!=</span>&nbsp;<span class="ident" id="5712355">token</span><span class="op" id="5712360">.</span><span class="ident" id="5712361">LBRACE</span>&nbsp;<span class="op" id="5712368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712374">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712434">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712493">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712553">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712560">//&nbsp;&nbsp;&nbsp;&nbspswitch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712601">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712608">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712662">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712722">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712777">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712784">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5712849">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712913">p</span><span class="op" id="5712914">.</span><span class="ident" id="5712915">openScope</span><span class="op" id="5712924">(</span><span class="op" id="5712925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5712931">defer</span>&nbsp;<span class="ident" id="5712937">p</span><span class="op" id="5712938">.</span><span class="ident" id="5712939">closeScope</span><span class="op" id="5712949">(</span><span class="op" id="5712950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5712956">s2</span><span class="op" id="5712958">,</span>&nbsp;<span class="ident" id="5712960">_</span>&nbsp;<span class="op" id="5712962">=</span>&nbsp;<span class="ident" id="5712964">p</span><span class="op" id="5712965">.</span><span class="ident" id="5712966">parseSimpleStmt</span><span class="op" id="5712981">(</span><span class="ident" id="5712982">basic</span><span class="op" id="5712987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5712992">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5712996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713000">p</span><span class="op" id="5713001">.</span><span class="ident" id="5713002">exprLev</span>&nbsp;<span class="op" id="5713010">=</span>&nbsp;<span class="ident" id="5713012">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713025">typeSwitch</span>&nbsp;<span class="op" id="5713036">:=</span>&nbsp;<span class="ident" id="5713039">isTypeSwitchGuard</span><span class="op" id="5713056">(</span><span class="ident" id="5713057">s2</span><span class="op" id="5713059">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713062">lbrace</span>&nbsp;<span class="op" id="5713069">:=</span>&nbsp;<span class="ident" id="5713072">p</span><span class="op" id="5713073">.</span><span class="ident" id="5713074">expect</span><span class="op" id="5713080">(</span><span class="ident" id="5713081">token</span><span class="op" id="5713086">.</span><span class="ident" id="5713087">LBRACE</span><span class="op" id="5713093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713096">var</span>&nbsp;<span class="ident" id="5713100">list</span>&nbsp;<span class="op" id="5713105">[</span><span class="op" id="5713106">]</span><span class="ident" id="5713107">ast</span><span class="op" id="5713110">.</span><span class="ident" id="5713111">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713117">for</span>&nbsp;<span class="ident" id="5713121">p</span><span class="op" id="5713122">.</span><span class="ident" id="5713123">tok</span>&nbsp;<span class="op" id="5713127">==</span>&nbsp;<span class="ident" id="5713130">token</span><span class="op" id="5713135">.</span><span class="ident" id="5713136">CASE</span>&nbsp;<span class="op" id="5713141">||</span>&nbsp;<span class="ident" id="5713144">p</span><span class="op" id="5713145">.</span><span class="ident" id="5713146">tok</span>&nbsp;<span class="op" id="5713150">==</span>&nbsp;<span class="ident" id="5713153">token</span><span class="op" id="5713158">.</span><span class="ident" id="5713159">DEFAULT</span>&nbsp;<span class="op" id="5713167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713171">list</span>&nbsp;<span class="op" id="5713176">=</span>&nbsp;<span class="builtinfunc" id="5713178">append</span><span class="op" id="5713184">(</span><span class="ident" id="5713185">list</span><span class="op" id="5713189">,</span>&nbsp;<span class="ident" id="5713191">p</span><span class="op" id="5713192">.</span><span class="ident" id="5713193">parseCaseClause</span><span class="op" id="5713208">(</span><span class="ident" id="5713209">typeSwitch</span><span class="op" id="5713219">)</span><span class="op" id="5713220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713223">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713226">rbrace</span>&nbsp;<span class="op" id="5713233">:=</span>&nbsp;<span class="ident" id="5713236">p</span><span class="op" id="5713237">.</span><span class="ident" id="5713238">expect</span><span class="op" id="5713244">(</span><span class="ident" id="5713245">token</span><span class="op" id="5713250">.</span><span class="ident" id="5713251">RBRACE</span><span class="op" id="5713257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713260">p</span><span class="op" id="5713261">.</span><span class="ident" id="5713262">expectSemi</span><span class="op" id="5713272">(</span><span class="op" id="5713273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713276">body</span>&nbsp;<span class="op" id="5713281">:=</span>&nbsp;<span class="op" id="5713284">&amp;</span><span class="ident" id="5713285">ast</span><span class="op" id="5713288">.</span><span class="ident" id="5713289">BlockStmt</span><span class="op" id="5713298">{</span><span class="ident" id="5713299">Lbrace</span><span class="op" id="5713305">:</span>&nbsp;<span class="ident" id="5713307">lbrace</span><span class="op" id="5713313">,</span>&nbsp;<span class="ident" id="5713315">List</span><span class="op" id="5713319">:</span>&nbsp;<span class="ident" id="5713321">list</span><span class="op" id="5713325">,</span>&nbsp;<span class="ident" id="5713327">Rbrace</span><span class="op" id="5713333">:</span>&nbsp;<span class="ident" id="5713335">rbrace</span><span class="op" id="5713341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713345">if</span>&nbsp;<span class="ident" id="5713348">typeSwitch</span>&nbsp;<span class="op" id="5713359">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713363">return</span>&nbsp;<span class="op" id="5713370">&amp;</span><span class="ident" id="5713371">ast</span><span class="op" id="5713374">.</span><span class="ident" id="5713375">TypeSwitchStmt</span><span class="op" id="5713389">{</span><span class="ident" id="5713390">Switch</span><span class="op" id="5713396">:</span>&nbsp;<span class="ident" id="5713398">pos</span><span class="op" id="5713401">,</span>&nbsp;<span class="ident" id="5713403">Init</span><span class="op" id="5713407">:</span>&nbsp;<span class="ident" id="5713409">s1</span><span class="op" id="5713411">,</span>&nbsp;<span class="ident" id="5713413">Assign</span><span class="op" id="5713419">:</span>&nbsp;<span class="ident" id="5713421">s2</span><span class="op" id="5713423">,</span>&nbsp;<span class="ident" id="5713425">Body</span><span class="op" id="5713429">:</span>&nbsp;<span class="ident" id="5713431">body</span><span class="op" id="5713435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713442">return</span>&nbsp;<span class="op" id="5713449">&amp;</span><span class="ident" id="5713450">ast</span><span class="op" id="5713453">.</span><span class="ident" id="5713454">SwitchStmt</span><span class="op" id="5713464">{</span><span class="ident" id="5713465">Switch</span><span class="op" id="5713471">:</span>&nbsp;<span class="ident" id="5713473">pos</span><span class="op" id="5713476">,</span>&nbsp;<span class="ident" id="5713478">Init</span><span class="op" id="5713482">:</span>&nbsp;<span class="ident" id="5713484">s1</span><span class="op" id="5713486">,</span>&nbsp;<span class="ident" id="5713488">Tag</span><span class="op" id="5713491">:</span>&nbsp;<span class="ident" id="5713493">p</span><span class="op" id="5713494">.</span><span class="ident" id="5713495">makeExpr</span><span class="op" id="5713503">(</span><span class="ident" id="5713504">s2</span><span class="op" id="5713506">,</span>&nbsp;<span class="string" id="5713508">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5713527">)</span><span class="op" id="5713528">,</span>&nbsp;<span class="ident" id="5713530">Body</span><span class="op" id="5713534">:</span>&nbsp;<span class="ident" id="5713536">body</span><span class="op" id="5713540">}</span><br>
<span class="lineno"></span><span class="op" id="5713542">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5713545">func</span>&nbsp;<span class="op" id="5713550">(</span><span class="ident" id="5713551">p</span>&nbsp;<span class="op" id="5713553">*</span><span class="ident" id="5713554">parser</span><span class="op" id="5713560">)</span>&nbsp;<span class="ident" id="5713562">parseCommClause</span><span class="op" id="5713577">(</span><span class="op" id="5713578">)</span>&nbsp;<span class="op" id="5713580">*</span><span class="ident" id="5713581">ast</span><span class="op" id="5713584">.</span><span class="ident" id="5713585">CommClause</span>&nbsp;<span class="op" id="5713596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713599">if</span>&nbsp;<span class="ident" id="5713602">p</span><span class="op" id="5713603">.</span><span class="ident" id="5713604">trace</span>&nbsp;<span class="op" id="5713610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713614">defer</span>&nbsp;<span class="ident" id="5713620">un</span><span class="op" id="5713622">(</span><span class="ident" id="5713623">trace</span><span class="op" id="5713628">(</span><span class="ident" id="5713629">p</span><span class="op" id="5713630">,</span>&nbsp;<span class="string" id="5713632">&#34;CommClause&#34;</span><span class="op" id="5713644">)</span><span class="op" id="5713645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713648">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713652">p</span><span class="op" id="5713653">.</span><span class="ident" id="5713654">openScope</span><span class="op" id="5713663">(</span><span class="op" id="5713664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713667">pos</span>&nbsp;<span class="op" id="5713671">:=</span>&nbsp;<span class="ident" id="5713674">p</span><span class="op" id="5713675">.</span><span class="ident" id="5713676">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713681">var</span>&nbsp;<span class="ident" id="5713685">comm</span>&nbsp;<span class="ident" id="5713690">ast</span><span class="op" id="5713693">.</span><span class="ident" id="5713694">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713700">if</span>&nbsp;<span class="ident" id="5713703">p</span><span class="op" id="5713704">.</span><span class="ident" id="5713705">tok</span>&nbsp;<span class="op" id="5713709">==</span>&nbsp;<span class="ident" id="5713712">token</span><span class="op" id="5713717">.</span><span class="ident" id="5713718">CASE</span>&nbsp;<span class="op" id="5713723">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713727">p</span><span class="op" id="5713728">.</span><span class="ident" id="5713729">next</span><span class="op" id="5713733">(</span><span class="op" id="5713734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713738">lhs</span>&nbsp;<span class="op" id="5713742">:=</span>&nbsp;<span class="ident" id="5713745">p</span><span class="op" id="5713746">.</span><span class="ident" id="5713747">parseLhsList</span><span class="op" id="5713759">(</span><span class="op" id="5713760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713764">if</span>&nbsp;<span class="ident" id="5713767">p</span><span class="op" id="5713768">.</span><span class="ident" id="5713769">tok</span>&nbsp;<span class="op" id="5713773">==</span>&nbsp;<span class="ident" id="5713776">token</span><span class="op" id="5713781">.</span><span class="ident" id="5713782">ARROW</span>&nbsp;<span class="op" id="5713788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5713793">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5713808">if</span>&nbsp;<span class="builtinfunc" id="5713811">len</span><span class="op" id="5713814">(</span><span class="ident" id="5713815">lhs</span><span class="op" id="5713818">)</span>&nbsp;<span class="op" id="5713820">&gt;</span>&nbsp;<span class="num" id="5713822">1</span>&nbsp;<span class="op" id="5713824">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713830">p</span><span class="op" id="5713831">.</span><span class="ident" id="5713832">errorExpected</span><span class="op" id="5713845">(</span><span class="ident" id="5713846">lhs</span><span class="op" id="5713849">[</span><span class="num" id="5713850">0</span><span class="op" id="5713851">]</span><span class="op" id="5713852">.</span><span class="ident" id="5713853">Pos</span><span class="op" id="5713856">(</span><span class="op" id="5713857">)</span><span class="op" id="5713858">,</span>&nbsp;<span class="string" id="5713860">&#34;1&nbsp;expression&#34;</span><span class="op" id="5713874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5713880">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5713917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713922">arrow</span>&nbsp;<span class="op" id="5713928">:=</span>&nbsp;<span class="ident" id="5713931">p</span><span class="op" id="5713932">.</span><span class="ident" id="5713933">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713940">p</span><span class="op" id="5713941">.</span><span class="ident" id="5713942">next</span><span class="op" id="5713946">(</span><span class="op" id="5713947">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713952">rhs</span>&nbsp;<span class="op" id="5713956">:=</span>&nbsp;<span class="ident" id="5713959">p</span><span class="op" id="5713960">.</span><span class="ident" id="5713961">parseRhs</span><span class="op" id="5713969">(</span><span class="op" id="5713970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5713975">comm</span>&nbsp;<span class="op" id="5713980">=</span>&nbsp;<span class="op" id="5713982">&amp;</span><span class="ident" id="5713983">ast</span><span class="op" id="5713986">.</span><span class="ident" id="5713987">SendStmt</span><span class="op" id="5713995">{</span><span class="ident" id="5713996">Chan</span><span class="op" id="5714000">:</span>&nbsp;<span class="ident" id="5714002">lhs</span><span class="op" id="5714005">[</span><span class="num" id="5714006">0</span><span class="op" id="5714007">]</span><span class="op" id="5714008">,</span>&nbsp;<span class="ident" id="5714010">Arrow</span><span class="op" id="5714015">:</span>&nbsp;<span class="ident" id="5714017">arrow</span><span class="op" id="5714022">,</span>&nbsp;<span class="ident" id="5714024">Value</span><span class="op" id="5714029">:</span>&nbsp;<span class="ident" id="5714031">rhs</span><span class="op" id="5714034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714038">}</span>&nbsp;<span class="keyword" id="5714040">else</span>&nbsp;<span class="op" id="5714045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5714050">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714065">if</span>&nbsp;<span class="ident" id="5714068">tok</span>&nbsp;<span class="op" id="5714072">:=</span>&nbsp;<span class="ident" id="5714075">p</span><span class="op" id="5714076">.</span><span class="ident" id="5714077">tok</span><span class="op" id="5714080">;</span>&nbsp;<span class="ident" id="5714082">tok</span>&nbsp;<span class="op" id="5714086">==</span>&nbsp;<span class="ident" id="5714089">token</span><span class="op" id="5714094">.</span><span class="ident" id="5714095">ASSIGN</span>&nbsp;<span class="op" id="5714102">||</span>&nbsp;<span class="ident" id="5714105">tok</span>&nbsp;<span class="op" id="5714109">==</span>&nbsp;<span class="ident" id="5714112">token</span><span class="op" id="5714117">.</span><span class="ident" id="5714118">DEFINE</span>&nbsp;<span class="op" id="5714125">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5714131">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714163">if</span>&nbsp;<span class="builtinfunc" id="5714166">len</span><span class="op" id="5714169">(</span><span class="ident" id="5714170">lhs</span><span class="op" id="5714173">)</span>&nbsp;<span class="op" id="5714175">&gt;</span>&nbsp;<span class="num" id="5714177">2</span>&nbsp;<span class="op" id="5714179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714186">p</span><span class="op" id="5714187">.</span><span class="ident" id="5714188">errorExpected</span><span class="op" id="5714201">(</span><span class="ident" id="5714202">lhs</span><span class="op" id="5714205">[</span><span class="num" id="5714206">0</span><span class="op" id="5714207">]</span><span class="op" id="5714208">.</span><span class="ident" id="5714209">Pos</span><span class="op" id="5714212">(</span><span class="op" id="5714213">)</span><span class="op" id="5714214">,</span>&nbsp;<span class="string" id="5714216">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5714236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5714243">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714287">lhs</span>&nbsp;<span class="op" id="5714291">=</span>&nbsp;<span class="ident" id="5714293">lhs</span><span class="op" id="5714296">[</span><span class="num" id="5714297">0</span><span class="op" id="5714298">:</span><span class="num" id="5714299">2</span><span class="op" id="5714300">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714312">pos</span>&nbsp;<span class="op" id="5714316">:=</span>&nbsp;<span class="ident" id="5714319">p</span><span class="op" id="5714320">.</span><span class="ident" id="5714321">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714329">p</span><span class="op" id="5714330">.</span><span class="ident" id="5714331">next</span><span class="op" id="5714335">(</span><span class="op" id="5714336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714342">rhs</span>&nbsp;<span class="op" id="5714346">:=</span>&nbsp;<span class="ident" id="5714349">p</span><span class="op" id="5714350">.</span><span class="ident" id="5714351">parseRhs</span><span class="op" id="5714359">(</span><span class="op" id="5714360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714366">as</span>&nbsp;<span class="op" id="5714369">:=</span>&nbsp;<span class="op" id="5714372">&amp;</span><span class="ident" id="5714373">ast</span><span class="op" id="5714376">.</span><span class="ident" id="5714377">AssignStmt</span><span class="op" id="5714387">{</span><span class="ident" id="5714388">Lhs</span><span class="op" id="5714391">:</span>&nbsp;<span class="ident" id="5714393">lhs</span><span class="op" id="5714396">,</span>&nbsp;<span class="ident" id="5714398">TokPos</span><span class="op" id="5714404">:</span>&nbsp;<span class="ident" id="5714406">pos</span><span class="op" id="5714409">,</span>&nbsp;<span class="ident" id="5714411">Tok</span><span class="op" id="5714414">:</span>&nbsp;<span class="ident" id="5714416">tok</span><span class="op" id="5714419">,</span>&nbsp;<span class="ident" id="5714421">Rhs</span><span class="op" id="5714424">:</span>&nbsp;<span class="op" id="5714426">[</span><span class="op" id="5714427">]</span><span class="ident" id="5714428">ast</span><span class="op" id="5714431">.</span><span class="ident" id="5714432">Expr</span><span class="op" id="5714436">{</span><span class="ident" id="5714437">rhs</span><span class="op" id="5714440">}</span><span class="op" id="5714441">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714447">if</span>&nbsp;<span class="ident" id="5714450">tok</span>&nbsp;<span class="op" id="5714454">==</span>&nbsp;<span class="ident" id="5714457">token</span><span class="op" id="5714462">.</span><span class="ident" id="5714463">DEFINE</span>&nbsp;<span class="op" id="5714470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714477">p</span><span class="op" id="5714478">.</span><span class="ident" id="5714479">shortVarDecl</span><span class="op" id="5714491">(</span><span class="ident" id="5714492">as</span><span class="op" id="5714494">,</span>&nbsp;<span class="ident" id="5714496">lhs</span><span class="op" id="5714499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714511">comm</span>&nbsp;<span class="op" id="5714516">=</span>&nbsp;<span class="ident" id="5714518">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714524">}</span>&nbsp;<span class="keyword" id="5714526">else</span>&nbsp;<span class="op" id="5714531">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5714537">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714581">if</span>&nbsp;<span class="builtinfunc" id="5714584">len</span><span class="op" id="5714587">(</span><span class="ident" id="5714588">lhs</span><span class="op" id="5714591">)</span>&nbsp;<span class="op" id="5714593">&gt;</span>&nbsp;<span class="num" id="5714595">1</span>&nbsp;<span class="op" id="5714597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714604">p</span><span class="op" id="5714605">.</span><span class="ident" id="5714606">errorExpected</span><span class="op" id="5714619">(</span><span class="ident" id="5714620">lhs</span><span class="op" id="5714623">[</span><span class="num" id="5714624">0</span><span class="op" id="5714625">]</span><span class="op" id="5714626">.</span><span class="ident" id="5714627">Pos</span><span class="op" id="5714630">(</span><span class="op" id="5714631">)</span><span class="op" id="5714632">,</span>&nbsp;<span class="string" id="5714634">&#34;1&nbsp;expression&#34;</span><span class="op" id="5714648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5714655">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714693">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714699">comm</span>&nbsp;<span class="op" id="5714704">=</span>&nbsp;<span class="op" id="5714706">&amp;</span><span class="ident" id="5714707">ast</span><span class="op" id="5714710">.</span><span class="ident" id="5714711">ExprStmt</span><span class="op" id="5714719">{</span><span class="ident" id="5714720">X</span><span class="op" id="5714721">:</span>&nbsp;<span class="ident" id="5714723">lhs</span><span class="op" id="5714726">[</span><span class="num" id="5714727">0</span><span class="op" id="5714728">]</span><span class="op" id="5714729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714741">}</span>&nbsp;<span class="keyword" id="5714743">else</span>&nbsp;<span class="op" id="5714748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714752">p</span><span class="op" id="5714753">.</span><span class="ident" id="5714754">expect</span><span class="op" id="5714760">(</span><span class="ident" id="5714761">token</span><span class="op" id="5714766">.</span><span class="ident" id="5714767">DEFAULT</span><span class="op" id="5714774">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5714777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714781">colon</span>&nbsp;<span class="op" id="5714787">:=</span>&nbsp;<span class="ident" id="5714790">p</span><span class="op" id="5714791">.</span><span class="ident" id="5714792">expect</span><span class="op" id="5714798">(</span><span class="ident" id="5714799">token</span><span class="op" id="5714804">.</span><span class="ident" id="5714805">COLON</span><span class="op" id="5714810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714813">body</span>&nbsp;<span class="op" id="5714818">:=</span>&nbsp;<span class="ident" id="5714821">p</span><span class="op" id="5714822">.</span><span class="ident" id="5714823">parseStmtList</span><span class="op" id="5714836">(</span><span class="op" id="5714837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5714840">p</span><span class="op" id="5714841">.</span><span class="ident" id="5714842">closeScope</span><span class="op" id="5714852">(</span><span class="op" id="5714853">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714857">return</span>&nbsp;<span class="op" id="5714864">&amp;</span><span class="ident" id="5714865">ast</span><span class="op" id="5714868">.</span><span class="ident" id="5714869">CommClause</span><span class="op" id="5714879">{</span><span class="ident" id="5714880">Case</span><span class="op" id="5714884">:</span>&nbsp;<span class="ident" id="5714886">pos</span><span class="op" id="5714889">,</span>&nbsp;<span class="ident" id="5714891">Comm</span><span class="op" id="5714895">:</span>&nbsp;<span class="ident" id="5714897">comm</span><span class="op" id="5714901">,</span>&nbsp;<span class="ident" id="5714903">Colon</span><span class="op" id="5714908">:</span>&nbsp;<span class="ident" id="5714910">colon</span><span class="op" id="5714915">,</span>&nbsp;<span class="ident" id="5714917">Body</span><span class="op" id="5714921">:</span>&nbsp;<span class="ident" id="5714923">body</span><span class="op" id="5714927">}</span><br>
<span class="lineno"></span><span class="op" id="5714929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5714932">func</span>&nbsp;<span class="op" id="5714937">(</span><span class="ident" id="5714938">p</span>&nbsp;<span class="op" id="5714940">*</span><span class="ident" id="5714941">parser</span><span class="op" id="5714947">)</span>&nbsp;<span class="ident" id="5714949">parseSelectStmt</span><span class="op" id="5714964">(</span><span class="op" id="5714965">)</span>&nbsp;<span class="op" id="5714967">*</span><span class="ident" id="5714968">ast</span><span class="op" id="5714971">.</span><span class="ident" id="5714972">SelectStmt</span>&nbsp;<span class="op" id="5714983">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5714986">if</span>&nbsp;<span class="ident" id="5714989">p</span><span class="op" id="5714990">.</span><span class="ident" id="5714991">trace</span>&nbsp;<span class="op" id="5714997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715001">defer</span>&nbsp;<span class="ident" id="5715007">un</span><span class="op" id="5715009">(</span><span class="ident" id="5715010">trace</span><span class="op" id="5715015">(</span><span class="ident" id="5715016">p</span><span class="op" id="5715017">,</span>&nbsp;<span class="string" id="5715019">&#34;SelectStmt&#34;</span><span class="op" id="5715031">)</span><span class="op" id="5715032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715039">pos</span>&nbsp;<span class="op" id="5715043">:=</span>&nbsp;<span class="ident" id="5715046">p</span><span class="op" id="5715047">.</span><span class="ident" id="5715048">expect</span><span class="op" id="5715054">(</span><span class="ident" id="5715055">token</span><span class="op" id="5715060">.</span><span class="ident" id="5715061">SELECT</span><span class="op" id="5715067">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715070">lbrace</span>&nbsp;<span class="op" id="5715077">:=</span>&nbsp;<span class="ident" id="5715080">p</span><span class="op" id="5715081">.</span><span class="ident" id="5715082">expect</span><span class="op" id="5715088">(</span><span class="ident" id="5715089">token</span><span class="op" id="5715094">.</span><span class="ident" id="5715095">LBRACE</span><span class="op" id="5715101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715104">var</span>&nbsp;<span class="ident" id="5715108">list</span>&nbsp;<span class="op" id="5715113">[</span><span class="op" id="5715114">]</span><span class="ident" id="5715115">ast</span><span class="op" id="5715118">.</span><span class="ident" id="5715119">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715125">for</span>&nbsp;<span class="ident" id="5715129">p</span><span class="op" id="5715130">.</span><span class="ident" id="5715131">tok</span>&nbsp;<span class="op" id="5715135">==</span>&nbsp;<span class="ident" id="5715138">token</span><span class="op" id="5715143">.</span><span class="ident" id="5715144">CASE</span>&nbsp;<span class="op" id="5715149">||</span>&nbsp;<span class="ident" id="5715152">p</span><span class="op" id="5715153">.</span><span class="ident" id="5715154">tok</span>&nbsp;<span class="op" id="5715158">==</span>&nbsp;<span class="ident" id="5715161">token</span><span class="op" id="5715166">.</span><span class="ident" id="5715167">DEFAULT</span>&nbsp;<span class="op" id="5715175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715179">list</span>&nbsp;<span class="op" id="5715184">=</span>&nbsp;<span class="builtinfunc" id="5715186">append</span><span class="op" id="5715192">(</span><span class="ident" id="5715193">list</span><span class="op" id="5715197">,</span>&nbsp;<span class="ident" id="5715199">p</span><span class="op" id="5715200">.</span><span class="ident" id="5715201">parseCommClause</span><span class="op" id="5715216">(</span><span class="op" id="5715217">)</span><span class="op" id="5715218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715221">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715224">rbrace</span>&nbsp;<span class="op" id="5715231">:=</span>&nbsp;<span class="ident" id="5715234">p</span><span class="op" id="5715235">.</span><span class="ident" id="5715236">expect</span><span class="op" id="5715242">(</span><span class="ident" id="5715243">token</span><span class="op" id="5715248">.</span><span class="ident" id="5715249">RBRACE</span><span class="op" id="5715255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715258">p</span><span class="op" id="5715259">.</span><span class="ident" id="5715260">expectSemi</span><span class="op" id="5715270">(</span><span class="op" id="5715271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715274">body</span>&nbsp;<span class="op" id="5715279">:=</span>&nbsp;<span class="op" id="5715282">&amp;</span><span class="ident" id="5715283">ast</span><span class="op" id="5715286">.</span><span class="ident" id="5715287">BlockStmt</span><span class="op" id="5715296">{</span><span class="ident" id="5715297">Lbrace</span><span class="op" id="5715303">:</span>&nbsp;<span class="ident" id="5715305">lbrace</span><span class="op" id="5715311">,</span>&nbsp;<span class="ident" id="5715313">List</span><span class="op" id="5715317">:</span>&nbsp;<span class="ident" id="5715319">list</span><span class="op" id="5715323">,</span>&nbsp;<span class="ident" id="5715325">Rbrace</span><span class="op" id="5715331">:</span>&nbsp;<span class="ident" id="5715333">rbrace</span><span class="op" id="5715339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715343">return</span>&nbsp;<span class="op" id="5715350">&amp;</span><span class="ident" id="5715351">ast</span><span class="op" id="5715354">.</span><span class="ident" id="5715355">SelectStmt</span><span class="op" id="5715365">{</span><span class="ident" id="5715366">Select</span><span class="op" id="5715372">:</span>&nbsp;<span class="ident" id="5715374">pos</span><span class="op" id="5715377">,</span>&nbsp;<span class="ident" id="5715379">Body</span><span class="op" id="5715383">:</span>&nbsp;<span class="ident" id="5715385">body</span><span class="op" id="5715389">}</span><br>
<span class="lineno">2030</span><span class="op" id="5715391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5715394">func</span>&nbsp;<span class="op" id="5715399">(</span><span class="ident" id="5715400">p</span>&nbsp;<span class="op" id="5715402">*</span><span class="ident" id="5715403">parser</span><span class="op" id="5715409">)</span>&nbsp;<span class="ident" id="5715411">parseForStmt</span><span class="op" id="5715423">(</span><span class="op" id="5715424">)</span>&nbsp;<span class="ident" id="5715426">ast</span><span class="op" id="5715429">.</span><span class="ident" id="5715430">Stmt</span>&nbsp;<span class="op" id="5715435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715438">if</span>&nbsp;<span class="ident" id="5715441">p</span><span class="op" id="5715442">.</span><span class="ident" id="5715443">trace</span>&nbsp;<span class="op" id="5715449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715453">defer</span>&nbsp;<span class="ident" id="5715459">un</span><span class="op" id="5715461">(</span><span class="ident" id="5715462">trace</span><span class="op" id="5715467">(</span><span class="ident" id="5715468">p</span><span class="op" id="5715469">,</span>&nbsp;<span class="string" id="5715471">&#34;ForStmt&#34;</span><span class="op" id="5715480">)</span><span class="op" id="5715481">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715488">pos</span>&nbsp;<span class="op" id="5715492">:=</span>&nbsp;<span class="ident" id="5715495">p</span><span class="op" id="5715496">.</span><span class="ident" id="5715497">expect</span><span class="op" id="5715503">(</span><span class="ident" id="5715504">token</span><span class="op" id="5715509">.</span><span class="ident" id="5715510">FOR</span><span class="op" id="5715513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715516">p</span><span class="op" id="5715517">.</span><span class="ident" id="5715518">openScope</span><span class="op" id="5715527">(</span><span class="op" id="5715528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715531">defer</span>&nbsp;<span class="ident" id="5715537">p</span><span class="op" id="5715538">.</span><span class="ident" id="5715539">closeScope</span><span class="op" id="5715549">(</span><span class="op" id="5715550">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715554">var</span>&nbsp;<span class="ident" id="5715558">s1</span><span class="op" id="5715560">,</span>&nbsp;<span class="ident" id="5715562">s2</span><span class="op" id="5715564">,</span>&nbsp;<span class="ident" id="5715566">s3</span>&nbsp;<span class="ident" id="5715569">ast</span><span class="op" id="5715572">.</span><span class="ident" id="5715573">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715579">var</span>&nbsp;<span class="ident" id="5715583">isRange</span>&nbsp;<span class="builtintype" id="5715591">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715597">if</span>&nbsp;<span class="ident" id="5715600">p</span><span class="op" id="5715601">.</span><span class="ident" id="5715602">tok</span>&nbsp;<span class="op" id="5715606">!=</span>&nbsp;<span class="ident" id="5715609">token</span><span class="op" id="5715614">.</span><span class="ident" id="5715615">LBRACE</span>&nbsp;<span class="op" id="5715622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715626">prevLev</span>&nbsp;<span class="op" id="5715634">:=</span>&nbsp;<span class="ident" id="5715637">p</span><span class="op" id="5715638">.</span><span class="ident" id="5715639">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715649">p</span><span class="op" id="5715650">.</span><span class="ident" id="5715651">exprLev</span>&nbsp;<span class="op" id="5715659">=</span>&nbsp;<span class="op" id="5715661">-</span><span class="num" id="5715662">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715666">if</span>&nbsp;<span class="ident" id="5715669">p</span><span class="op" id="5715670">.</span><span class="ident" id="5715671">tok</span>&nbsp;<span class="op" id="5715675">!=</span>&nbsp;<span class="ident" id="5715678">token</span><span class="op" id="5715683">.</span><span class="ident" id="5715684">SEMICOLON</span>&nbsp;<span class="op" id="5715694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5715699">if</span>&nbsp;<span class="ident" id="5715702">p</span><span class="op" id="5715703">.</span><span class="ident" id="5715704">tok</span>&nbsp;<span class="op" id="5715708">==</span>&nbsp;<span class="ident" id="5715711">token</span><span class="op" id="5715716">.</span><span class="ident" id="5715717">RANGE</span>&nbsp;<span class="op" id="5715723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5715729">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715774">pos</span>&nbsp;<span class="op" id="5715778">:=</span>&nbsp;<span class="ident" id="5715781">p</span><span class="op" id="5715782">.</span><span class="ident" id="5715783">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715791">p</span><span class="op" id="5715792">.</span><span class="ident" id="5715793">next</span><span class="op" id="5715797">(</span><span class="op" id="5715798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715804">y</span>&nbsp;<span class="op" id="5715806">:=</span>&nbsp;<span class="op" id="5715809">[</span><span class="op" id="5715810">]</span><span class="ident" id="5715811">ast</span><span class="op" id="5715814">.</span><span class="ident" id="5715815">Expr</span><span class="op" id="5715819">{</span><span class="op" id="5715820">&amp;</span><span class="ident" id="5715821">ast</span><span class="op" id="5715824">.</span><span class="ident" id="5715825">UnaryExpr</span><span class="op" id="5715834">{</span><span class="ident" id="5715835">OpPos</span><span class="op" id="5715840">:</span>&nbsp;<span class="ident" id="5715842">pos</span><span class="op" id="5715845">,</span>&nbsp;<span class="ident" id="5715847">Op</span><span class="op" id="5715849">:</span>&nbsp;<span class="ident" id="5715851">token</span><span class="op" id="5715856">.</span><span class="ident" id="5715857">RANGE</span><span class="op" id="5715862">,</span>&nbsp;<span class="ident" id="5715864">X</span><span class="op" id="5715865">:</span>&nbsp;<span class="ident" id="5715867">p</span><span class="op" id="5715868">.</span><span class="ident" id="5715869">parseRhs</span><span class="op" id="5715877">(</span><span class="op" id="5715878">)</span><span class="op" id="5715879">}</span><span class="op" id="5715880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715886">s2</span>&nbsp;<span class="op" id="5715889">=</span>&nbsp;<span class="op" id="5715891">&amp;</span><span class="ident" id="5715892">ast</span><span class="op" id="5715895">.</span><span class="ident" id="5715896">AssignStmt</span><span class="op" id="5715906">{</span><span class="ident" id="5715907">Rhs</span><span class="op" id="5715910">:</span>&nbsp;<span class="ident" id="5715912">y</span><span class="op" id="5715913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715919">isRange</span>&nbsp;<span class="op" id="5715927">=</span>&nbsp;<span class="builtintype" id="5715929">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715937">}</span>&nbsp;<span class="keyword" id="5715939">else</span>&nbsp;<span class="op" id="5715944">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5715950">s2</span><span class="op" id="5715952">,</span>&nbsp;<span class="ident" id="5715954">isRange</span>&nbsp;<span class="op" id="5715962">=</span>&nbsp;<span class="ident" id="5715964">p</span><span class="op" id="5715965">.</span><span class="ident" id="5715966">parseSimpleStmt</span><span class="op" id="5715981">(</span><span class="ident" id="5715982">rangeOk</span><span class="op" id="5715989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5715998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716002">if</span>&nbsp;<span class="op" id="5716005">!</span><span class="ident" id="5716006">isRange</span>&nbsp;<span class="op" id="5716014">&amp;&amp;</span>&nbsp;<span class="ident" id="5716017">p</span><span class="op" id="5716018">.</span><span class="ident" id="5716019">tok</span>&nbsp;<span class="op" id="5716023">==</span>&nbsp;<span class="ident" id="5716026">token</span><span class="op" id="5716031">.</span><span class="ident" id="5716032">SEMICOLON</span>&nbsp;<span class="op" id="5716042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716047">p</span><span class="op" id="5716048">.</span><span class="ident" id="5716049">next</span><span class="op" id="5716053">(</span><span class="op" id="5716054">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716059">s1</span>&nbsp;<span class="op" id="5716062">=</span>&nbsp;<span class="ident" id="5716064">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716070">s2</span>&nbsp;<span class="op" id="5716073">=</span>&nbsp;<span class="ident" id="5716075">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716082">if</span>&nbsp;<span class="ident" id="5716085">p</span><span class="op" id="5716086">.</span><span class="ident" id="5716087">tok</span>&nbsp;<span class="op" id="5716091">!=</span>&nbsp;<span class="ident" id="5716094">token</span><span class="op" id="5716099">.</span><span class="ident" id="5716100">SEMICOLON</span>&nbsp;<span class="op" id="5716110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716116">s2</span><span class="op" id="5716118">,</span>&nbsp;<span class="ident" id="5716120">_</span>&nbsp;<span class="op" id="5716122">=</span>&nbsp;<span class="ident" id="5716124">p</span><span class="op" id="5716125">.</span><span class="ident" id="5716126">parseSimpleStmt</span><span class="op" id="5716141">(</span><span class="ident" id="5716142">basic</span><span class="op" id="5716147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716152">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716157">p</span><span class="op" id="5716158">.</span><span class="ident" id="5716159">expectSemi</span><span class="op" id="5716169">(</span><span class="op" id="5716170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716175">if</span>&nbsp;<span class="ident" id="5716178">p</span><span class="op" id="5716179">.</span><span class="ident" id="5716180">tok</span>&nbsp;<span class="op" id="5716184">!=</span>&nbsp;<span class="ident" id="5716187">token</span><span class="op" id="5716192">.</span><span class="ident" id="5716193">LBRACE</span>&nbsp;<span class="op" id="5716200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716206">s3</span><span class="op" id="5716208">,</span>&nbsp;<span class="ident" id="5716210">_</span>&nbsp;<span class="op" id="5716212">=</span>&nbsp;<span class="ident" id="5716214">p</span><span class="op" id="5716215">.</span><span class="ident" id="5716216">parseSimpleStmt</span><span class="op" id="5716231">(</span><span class="ident" id="5716232">basic</span><span class="op" id="5716237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716246">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716250">p</span><span class="op" id="5716251">.</span><span class="ident" id="5716252">exprLev</span>&nbsp;<span class="op" id="5716260">=</span>&nbsp;<span class="ident" id="5716262">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716275">body</span>&nbsp;<span class="op" id="5716280">:=</span>&nbsp;<span class="ident" id="5716283">p</span><span class="op" id="5716284">.</span><span class="ident" id="5716285">parseBlockStmt</span><span class="op" id="5716299">(</span><span class="op" id="5716300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716303">p</span><span class="op" id="5716304">.</span><span class="ident" id="5716305">expectSemi</span><span class="op" id="5716315">(</span><span class="op" id="5716316">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716320">if</span>&nbsp;<span class="ident" id="5716323">isRange</span>&nbsp;<span class="op" id="5716331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716335">as</span>&nbsp;<span class="op" id="5716338">:=</span>&nbsp;<span class="ident" id="5716341">s2</span><span class="op" id="5716343">.</span><span class="op" id="5716344">(</span><span class="op" id="5716345">*</span><span class="ident" id="5716346">ast</span><span class="op" id="5716349">.</span><span class="ident" id="5716350">AssignStmt</span><span class="op" id="5716360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5716364">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716379">var</span>&nbsp;<span class="ident" id="5716383">key</span><span class="op" id="5716386">,</span>&nbsp;<span class="ident" id="5716388">value</span>&nbsp;<span class="ident" id="5716394">ast</span><span class="op" id="5716397">.</span><span class="ident" id="5716398">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716405">switch</span>&nbsp;<span class="builtinfunc" id="5716412">len</span><span class="op" id="5716415">(</span><span class="ident" id="5716416">as</span><span class="op" id="5716418">.</span><span class="ident" id="5716419">Lhs</span><span class="op" id="5716422">)</span>&nbsp;<span class="op" id="5716424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716428">case</span>&nbsp;<span class="num" id="5716433">0</span><span class="op" id="5716434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5716439">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716458">case</span>&nbsp;<span class="num" id="5716463">1</span><span class="op" id="5716464">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716469">key</span>&nbsp;<span class="op" id="5716473">=</span>&nbsp;<span class="ident" id="5716475">as</span><span class="op" id="5716477">.</span><span class="ident" id="5716478">Lhs</span><span class="op" id="5716481">[</span><span class="num" id="5716482">0</span><span class="op" id="5716483">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716487">case</span>&nbsp;<span class="num" id="5716492">2</span><span class="op" id="5716493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716498">key</span><span class="op" id="5716501">,</span>&nbsp;<span class="ident" id="5716503">value</span>&nbsp;<span class="op" id="5716509">=</span>&nbsp;<span class="ident" id="5716511">as</span><span class="op" id="5716513">.</span><span class="ident" id="5716514">Lhs</span><span class="op" id="5716517">[</span><span class="num" id="5716518">0</span><span class="op" id="5716519">]</span><span class="op" id="5716520">,</span>&nbsp;<span class="ident" id="5716522">as</span><span class="op" id="5716524">.</span><span class="ident" id="5716525">Lhs</span><span class="op" id="5716528">[</span><span class="num" id="5716529">1</span><span class="op" id="5716530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716534">default</span><span class="op" id="5716541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716546">p</span><span class="op" id="5716547">.</span><span class="ident" id="5716548">errorExpected</span><span class="op" id="5716561">(</span><span class="ident" id="5716562">as</span><span class="op" id="5716564">.</span><span class="ident" id="5716565">Lhs</span><span class="op" id="5716568">[</span><span class="builtinfunc" id="5716569">len</span><span class="op" id="5716572">(</span><span class="ident" id="5716573">as</span><span class="op" id="5716575">.</span><span class="ident" id="5716576">Lhs</span><span class="op" id="5716579">)</span><span class="op" id="5716580">-</span><span class="num" id="5716581">1</span><span class="op" id="5716582">]</span><span class="op" id="5716583">.</span><span class="ident" id="5716584">Pos</span><span class="op" id="5716587">(</span><span class="op" id="5716588">)</span><span class="op" id="5716589">,</span>&nbsp;<span class="string" id="5716591">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5716614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716619">return</span>&nbsp;<span class="op" id="5716626">&amp;</span><span class="ident" id="5716627">ast</span><span class="op" id="5716630">.</span><span class="ident" id="5716631">BadStmt</span><span class="op" id="5716638">{</span><span class="ident" id="5716639">From</span><span class="op" id="5716643">:</span>&nbsp;<span class="ident" id="5716645">pos</span><span class="op" id="5716648">,</span>&nbsp;<span class="ident" id="5716650">To</span><span class="op" id="5716652">:</span>&nbsp;<span class="ident" id="5716654">p</span><span class="op" id="5716655">.</span><span class="ident" id="5716656">safePos</span><span class="op" id="5716663">(</span><span class="ident" id="5716664">body</span><span class="op" id="5716668">.</span><span class="ident" id="5716669">End</span><span class="op" id="5716672">(</span><span class="op" id="5716673">)</span><span class="op" id="5716674">)</span><span class="op" id="5716675">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5716683">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5716736">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716792">x</span>&nbsp;<span class="op" id="5716794">:=</span>&nbsp;<span class="ident" id="5716797">as</span><span class="op" id="5716799">.</span><span class="ident" id="5716800">Rhs</span><span class="op" id="5716803">[</span><span class="num" id="5716804">0</span><span class="op" id="5716805">]</span><span class="op" id="5716806">.</span><span class="op" id="5716807">(</span><span class="op" id="5716808">*</span><span class="ident" id="5716809">ast</span><span class="op" id="5716812">.</span><span class="ident" id="5716813">UnaryExpr</span><span class="op" id="5716822">)</span><span class="op" id="5716823">.</span><span class="ident" id="5716824">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5716828">return</span>&nbsp;<span class="op" id="5716835">&amp;</span><span class="ident" id="5716836">ast</span><span class="op" id="5716839">.</span><span class="ident" id="5716840">RangeStmt</span><span class="op" id="5716849">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716854">For</span><span class="op" id="5716857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5716862">pos</span><span class="op" id="5716865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716870">Key</span><span class="op" id="5716873">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5716878">key</span><span class="op" id="5716881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716886">Value</span><span class="op" id="5716891">:</span>&nbsp;&nbsp;<span class="ident" id="5716894">value</span><span class="op" id="5716899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716904">TokPos</span><span class="op" id="5716910">:</span>&nbsp;<span class="ident" id="5716912">as</span><span class="op" id="5716914">.</span><span class="ident" id="5716915">TokPos</span><span class="op" id="5716921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716926">Tok</span><span class="op" id="5716929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5716934">as</span><span class="op" id="5716936">.</span><span class="ident" id="5716937">Tok</span><span class="op" id="5716940">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716945">X</span><span class="op" id="5716946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5716953">x</span><span class="op" id="5716954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5716959">Body</span><span class="op" id="5716963">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5716967">body</span><span class="op" id="5716971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5716978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5716982">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717008">return</span>&nbsp;<span class="op" id="5717015">&amp;</span><span class="ident" id="5717016">ast</span><span class="op" id="5717019">.</span><span class="ident" id="5717020">ForStmt</span><span class="op" id="5717027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717031">For</span><span class="op" id="5717034">:</span>&nbsp;&nbsp;<span class="ident" id="5717037">pos</span><span class="op" id="5717040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717044">Init</span><span class="op" id="5717048">:</span>&nbsp;<span class="ident" id="5717050">s1</span><span class="op" id="5717052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717056">Cond</span><span class="op" id="5717060">:</span>&nbsp;<span class="ident" id="5717062">p</span><span class="op" id="5717063">.</span><span class="ident" id="5717064">makeExpr</span><span class="op" id="5717072">(</span><span class="ident" id="5717073">s2</span><span class="op" id="5717075">,</span>&nbsp;<span class="string" id="5717077">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5717106">)</span><span class="op" id="5717107">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717111">Post</span><span class="op" id="5717115">:</span>&nbsp;<span class="ident" id="5717117">s3</span><span class="op" id="5717119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717123">Body</span><span class="op" id="5717127">:</span>&nbsp;<span class="ident" id="5717129">body</span><span class="op" id="5717133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5717136">}</span><br>
<span class="lineno"></span><span class="op" id="5717138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="5717141">func</span>&nbsp;<span class="op" id="5717146">(</span><span class="ident" id="5717147">p</span>&nbsp;<span class="op" id="5717149">*</span><span class="ident" id="5717150">parser</span><span class="op" id="5717156">)</span>&nbsp;<span class="ident" id="5717158">parseStmt</span><span class="op" id="5717167">(</span><span class="op" id="5717168">)</span>&nbsp;<span class="op" id="5717170">(</span><span class="ident" id="5717171">s</span>&nbsp;<span class="ident" id="5717173">ast</span><span class="op" id="5717176">.</span><span class="ident" id="5717177">Stmt</span><span class="op" id="5717181">)</span>&nbsp;<span class="op" id="5717183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717186">if</span>&nbsp;<span class="ident" id="5717189">p</span><span class="op" id="5717190">.</span><span class="ident" id="5717191">trace</span>&nbsp;<span class="op" id="5717197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717201">defer</span>&nbsp;<span class="ident" id="5717207">un</span><span class="op" id="5717209">(</span><span class="ident" id="5717210">trace</span><span class="op" id="5717215">(</span><span class="ident" id="5717216">p</span><span class="op" id="5717217">,</span>&nbsp;<span class="string" id="5717219">&#34;Statement&#34;</span><span class="op" id="5717230">)</span><span class="op" id="5717231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5717234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717238">switch</span>&nbsp;<span class="ident" id="5717245">p</span><span class="op" id="5717246">.</span><span class="ident" id="5717247">tok</span>&nbsp;<span class="op" id="5717251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717254">case</span>&nbsp;<span class="ident" id="5717259">token</span><span class="op" id="5717264">.</span><span class="ident" id="5717265">CONST</span><span class="op" id="5717270">,</span>&nbsp;<span class="ident" id="5717272">token</span><span class="op" id="5717277">.</span><span class="ident" id="5717278">TYPE</span><span class="op" id="5717282">,</span>&nbsp;<span class="ident" id="5717284">token</span><span class="op" id="5717289">.</span><span class="ident" id="5717290">VAR</span><span class="op" id="5717293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717297">s</span>&nbsp;<span class="op" id="5717299">=</span>&nbsp;<span class="op" id="5717301">&amp;</span><span class="ident" id="5717302">ast</span><span class="op" id="5717305">.</span><span class="ident" id="5717306">DeclStmt</span><span class="op" id="5717314">{</span><span class="ident" id="5717315">Decl</span><span class="op" id="5717319">:</span>&nbsp;<span class="ident" id="5717321">p</span><span class="op" id="5717322">.</span><span class="ident" id="5717323">parseDecl</span><span class="op" id="5717332">(</span><span class="ident" id="5717333">syncStmt</span><span class="op" id="5717341">)</span><span class="op" id="5717342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717345">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5717352">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717393">token</span><span class="op" id="5717398">.</span><span class="ident" id="5717399">IDENT</span><span class="op" id="5717404">,</span>&nbsp;<span class="ident" id="5717406">token</span><span class="op" id="5717411">.</span><span class="ident" id="5717412">INT</span><span class="op" id="5717415">,</span>&nbsp;<span class="ident" id="5717417">token</span><span class="op" id="5717422">.</span><span class="ident" id="5717423">FLOAT</span><span class="op" id="5717428">,</span>&nbsp;<span class="ident" id="5717430">token</span><span class="op" id="5717435">.</span><span class="ident" id="5717436">IMAG</span><span class="op" id="5717440">,</span>&nbsp;<span class="ident" id="5717442">token</span><span class="op" id="5717447">.</span><span class="ident" id="5717448">CHAR</span><span class="op" id="5717452">,</span>&nbsp;<span class="ident" id="5717454">token</span><span class="op" id="5717459">.</span><span class="ident" id="5717460">STRING</span><span class="op" id="5717466">,</span>&nbsp;<span class="ident" id="5717468">token</span><span class="op" id="5717473">.</span><span class="ident" id="5717474">FUNC</span><span class="op" id="5717478">,</span>&nbsp;<span class="ident" id="5717480">token</span><span class="op" id="5717485">.</span><span class="ident" id="5717486">LPAREN</span><span class="op" id="5717492">,</span>&nbsp;<span class="comment" id="5717494">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717508">token</span><span class="op" id="5717513">.</span><span class="ident" id="5717514">LBRACK</span><span class="op" id="5717520">,</span>&nbsp;<span class="ident" id="5717522">token</span><span class="op" id="5717527">.</span><span class="ident" id="5717528">STRUCT</span><span class="op" id="5717534">,</span>&nbsp;<span class="comment" id="5717536">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717557">token</span><span class="op" id="5717562">.</span><span class="ident" id="5717563">ADD</span><span class="op" id="5717566">,</span>&nbsp;<span class="ident" id="5717568">token</span><span class="op" id="5717573">.</span><span class="ident" id="5717574">SUB</span><span class="op" id="5717577">,</span>&nbsp;<span class="ident" id="5717579">token</span><span class="op" id="5717584">.</span><span class="ident" id="5717585">MUL</span><span class="op" id="5717588">,</span>&nbsp;<span class="ident" id="5717590">token</span><span class="op" id="5717595">.</span><span class="ident" id="5717596">AND</span><span class="op" id="5717599">,</span>&nbsp;<span class="ident" id="5717601">token</span><span class="op" id="5717606">.</span><span class="ident" id="5717607">XOR</span><span class="op" id="5717610">,</span>&nbsp;<span class="ident" id="5717612">token</span><span class="op" id="5717617">.</span><span class="ident" id="5717618">ARROW</span><span class="op" id="5717623">,</span>&nbsp;<span class="ident" id="5717625">token</span><span class="op" id="5717630">.</span><span class="ident" id="5717631">NOT</span><span class="op" id="5717634">:</span>&nbsp;<span class="comment" id="5717636">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717657">s</span><span class="op" id="5717658">,</span>&nbsp;<span class="ident" id="5717660">_</span>&nbsp;<span class="op" id="5717662">=</span>&nbsp;<span class="ident" id="5717664">p</span><span class="op" id="5717665">.</span><span class="ident" id="5717666">parseSimpleStmt</span><span class="op" id="5717681">(</span><span class="ident" id="5717682">labelOk</span><span class="op" id="5717689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5717693">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5717757">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5717821">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717831">if</span>&nbsp;<span class="ident" id="5717834">_</span><span class="op" id="5717835">,</span>&nbsp;<span class="ident" id="5717837">isLabeledStmt</span>&nbsp;<span class="op" id="5717851">:=</span>&nbsp;<span class="ident" id="5717854">s</span><span class="op" id="5717855">.</span><span class="op" id="5717856">(</span><span class="op" id="5717857">*</span><span class="ident" id="5717858">ast</span><span class="op" id="5717861">.</span><span class="ident" id="5717862">LabeledStmt</span><span class="op" id="5717873">)</span><span class="op" id="5717874">;</span>&nbsp;<span class="op" id="5717876">!</span><span class="ident" id="5717877">isLabeledStmt</span>&nbsp;<span class="op" id="5717891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717896">p</span><span class="op" id="5717897">.</span><span class="ident" id="5717898">expectSemi</span><span class="op" id="5717908">(</span><span class="op" id="5717909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5717913">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717916">case</span>&nbsp;<span class="ident" id="5717921">token</span><span class="op" id="5717926">.</span><span class="ident" id="5717927">GO</span><span class="op" id="5717929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717933">s</span>&nbsp;<span class="op" id="5717935">=</span>&nbsp;<span class="ident" id="5717937">p</span><span class="op" id="5717938">.</span><span class="ident" id="5717939">parseGoStmt</span><span class="op" id="5717950">(</span><span class="op" id="5717951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717954">case</span>&nbsp;<span class="ident" id="5717959">token</span><span class="op" id="5717964">.</span><span class="ident" id="5717965">DEFER</span><span class="op" id="5717970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5717974">s</span>&nbsp;<span class="op" id="5717976">=</span>&nbsp;<span class="ident" id="5717978">p</span><span class="op" id="5717979">.</span><span class="ident" id="5717980">parseDeferStmt</span><span class="op" id="5717994">(</span><span class="op" id="5717995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5717998">case</span>&nbsp;<span class="ident" id="5718003">token</span><span class="op" id="5718008">.</span><span class="ident" id="5718009">RETURN</span><span class="op" id="5718015">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718019">s</span>&nbsp;<span class="op" id="5718021">=</span>&nbsp;<span class="ident" id="5718023">p</span><span class="op" id="5718024">.</span><span class="ident" id="5718025">parseReturnStmt</span><span class="op" id="5718040">(</span><span class="op" id="5718041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718044">case</span>&nbsp;<span class="ident" id="5718049">token</span><span class="op" id="5718054">.</span><span class="ident" id="5718055">BREAK</span><span class="op" id="5718060">,</span>&nbsp;<span class="ident" id="5718062">token</span><span class="op" id="5718067">.</span><span class="ident" id="5718068">CONTINUE</span><span class="op" id="5718076">,</span>&nbsp;<span class="ident" id="5718078">token</span><span class="op" id="5718083">.</span><span class="ident" id="5718084">GOTO</span><span class="op" id="5718088">,</span>&nbsp;<span class="ident" id="5718090">token</span><span class="op" id="5718095">.</span><span class="ident" id="5718096">FALLTHROUGH</span><span class="op" id="5718107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718111">s</span>&nbsp;<span class="op" id="5718113">=</span>&nbsp;<span class="ident" id="5718115">p</span><span class="op" id="5718116">.</span><span class="ident" id="5718117">parseBranchStmt</span><span class="op" id="5718132">(</span><span class="ident" id="5718133">p</span><span class="op" id="5718134">.</span><span class="ident" id="5718135">tok</span><span class="op" id="5718138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718141">case</span>&nbsp;<span class="ident" id="5718146">token</span><span class="op" id="5718151">.</span><span class="ident" id="5718152">LBRACE</span><span class="op" id="5718158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718162">s</span>&nbsp;<span class="op" id="5718164">=</span>&nbsp;<span class="ident" id="5718166">p</span><span class="op" id="5718167">.</span><span class="ident" id="5718168">parseBlockStmt</span><span class="op" id="5718182">(</span><span class="op" id="5718183">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718187">p</span><span class="op" id="5718188">.</span><span class="ident" id="5718189">expectSemi</span><span class="op" id="5718199">(</span><span class="op" id="5718200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718203">case</span>&nbsp;<span class="ident" id="5718208">token</span><span class="op" id="5718213">.</span><span class="ident" id="5718214">IF</span><span class="op" id="5718216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718220">s</span>&nbsp;<span class="op" id="5718222">=</span>&nbsp;<span class="ident" id="5718224">p</span><span class="op" id="5718225">.</span><span class="ident" id="5718226">parseIfStmt</span><span class="op" id="5718237">(</span><span class="op" id="5718238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718241">case</span>&nbsp;<span class="ident" id="5718246">token</span><span class="op" id="5718251">.</span><span class="ident" id="5718252">SWITCH</span><span class="op" id="5718258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718262">s</span>&nbsp;<span class="op" id="5718264">=</span>&nbsp;<span class="ident" id="5718266">p</span><span class="op" id="5718267">.</span><span class="ident" id="5718268">parseSwitchStmt</span><span class="op" id="5718283">(</span><span class="op" id="5718284">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718287">case</span>&nbsp;<span class="ident" id="5718292">token</span><span class="op" id="5718297">.</span><span class="ident" id="5718298">SELECT</span><span class="op" id="5718304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718308">s</span>&nbsp;<span class="op" id="5718310">=</span>&nbsp;<span class="ident" id="5718312">p</span><span class="op" id="5718313">.</span><span class="ident" id="5718314">parseSelectStmt</span><span class="op" id="5718329">(</span><span class="op" id="5718330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718333">case</span>&nbsp;<span class="ident" id="5718338">token</span><span class="op" id="5718343">.</span><span class="ident" id="5718344">FOR</span><span class="op" id="5718347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718351">s</span>&nbsp;<span class="op" id="5718353">=</span>&nbsp;<span class="ident" id="5718355">p</span><span class="op" id="5718356">.</span><span class="ident" id="5718357">parseForStmt</span><span class="op" id="5718369">(</span><span class="op" id="5718370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718373">case</span>&nbsp;<span class="ident" id="5718378">token</span><span class="op" id="5718383">.</span><span class="ident" id="5718384">SEMICOLON</span><span class="op" id="5718393">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718397">s</span>&nbsp;<span class="op" id="5718399">=</span>&nbsp;<span class="op" id="5718401">&amp;</span><span class="ident" id="5718402">ast</span><span class="op" id="5718405">.</span><span class="ident" id="5718406">EmptyStmt</span><span class="op" id="5718415">{</span><span class="ident" id="5718416">Semicolon</span><span class="op" id="5718425">:</span>&nbsp;<span class="ident" id="5718427">p</span><span class="op" id="5718428">.</span><span class="ident" id="5718429">pos</span><span class="op" id="5718432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718436">p</span><span class="op" id="5718437">.</span><span class="ident" id="5718438">next</span><span class="op" id="5718442">(</span><span class="op" id="5718443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718446">case</span>&nbsp;<span class="ident" id="5718451">token</span><span class="op" id="5718456">.</span><span class="ident" id="5718457">RBRACE</span><span class="op" id="5718463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5718467">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718520">s</span>&nbsp;<span class="op" id="5718522">=</span>&nbsp;<span class="op" id="5718524">&amp;</span><span class="ident" id="5718525">ast</span><span class="op" id="5718528">.</span><span class="ident" id="5718529">EmptyStmt</span><span class="op" id="5718538">{</span><span class="ident" id="5718539">Semicolon</span><span class="op" id="5718548">:</span>&nbsp;<span class="ident" id="5718550">p</span><span class="op" id="5718551">.</span><span class="ident" id="5718552">pos</span><span class="op" id="5718555">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718558">default</span><span class="op" id="5718565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5718569">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718593">pos</span>&nbsp;<span class="op" id="5718597">:=</span>&nbsp;<span class="ident" id="5718600">p</span><span class="op" id="5718601">.</span><span class="ident" id="5718602">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718608">p</span><span class="op" id="5718609">.</span><span class="ident" id="5718610">errorExpected</span><span class="op" id="5718623">(</span><span class="ident" id="5718624">pos</span><span class="op" id="5718627">,</span>&nbsp;<span class="string" id="5718629">&#34;statement&#34;</span><span class="op" id="5718640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718644">syncStmt</span><span class="op" id="5718652">(</span><span class="ident" id="5718653">p</span><span class="op" id="5718654">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5718658">s</span>&nbsp;<span class="op" id="5718660">=</span>&nbsp;<span class="op" id="5718662">&amp;</span><span class="ident" id="5718663">ast</span><span class="op" id="5718666">.</span><span class="ident" id="5718667">BadStmt</span><span class="op" id="5718674">{</span><span class="ident" id="5718675">From</span><span class="op" id="5718679">:</span>&nbsp;<span class="ident" id="5718681">pos</span><span class="op" id="5718684">,</span>&nbsp;<span class="ident" id="5718686">To</span><span class="op" id="5718688">:</span>&nbsp;<span class="ident" id="5718690">p</span><span class="op" id="5718691">.</span><span class="ident" id="5718692">pos</span><span class="op" id="5718695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5718698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718702">return</span><br>
<span class="lineno"></span><span class="op" id="5718709">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="5718712">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5718792">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5718809">type</span>&nbsp;<span class="ident" id="5718814">parseSpecFunction</span>&nbsp;<span class="keyword" id="5718832">func</span><span class="op" id="5718836">(</span><span class="ident" id="5718837">doc</span>&nbsp;<span class="op" id="5718841">*</span><span class="ident" id="5718842">ast</span><span class="op" id="5718845">.</span><span class="ident" id="5718846">CommentGroup</span><span class="op" id="5718858">,</span>&nbsp;<span class="ident" id="5718860">keyword</span>&nbsp;<span class="ident" id="5718868">token</span><span class="op" id="5718873">.</span><span class="ident" id="5718874">Token</span><span class="op" id="5718879">,</span>&nbsp;<span class="ident" id="5718881">iota</span>&nbsp;<span class="builtintype" id="5718886">int</span><span class="op" id="5718889">)</span>&nbsp;<span class="ident" id="5718891">ast</span><span class="op" id="5718894">.</span><span class="ident" id="5718895">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="5718901">func</span>&nbsp;<span class="ident" id="5718906">isValidImport</span><span class="op" id="5718919">(</span><span class="ident" id="5718920">lit</span>&nbsp;<span class="builtintype" id="5718924">string</span><span class="op" id="5718930">)</span>&nbsp;<span class="builtintype" id="5718932">bool</span>&nbsp;<span class="op" id="5718937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5718940">const</span>&nbsp;<span class="ident" id="5718946">illegalChars</span>&nbsp;<span class="op" id="5718959">=</span>&nbsp;<span class="string" id="5718961">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="5718988">+</span>&nbsp;<span class="string" id="5718990">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719001">s</span><span class="op" id="5719002">,</span>&nbsp;<span class="ident" id="5719004">_</span>&nbsp;<span class="op" id="5719006">:=</span>&nbsp;<span class="ident" id="5719009">strconv</span><span class="op" id="5719016">.</span><span class="ident" id="5719017">Unquote</span><span class="op" id="5719024">(</span><span class="ident" id="5719025">lit</span><span class="op" id="5719028">)</span>&nbsp;<span class="comment" id="5719030">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719076">for</span>&nbsp;<span class="ident" id="5719080">_</span><span class="op" id="5719081">,</span>&nbsp;<span class="ident" id="5719083">r</span>&nbsp;<span class="op" id="5719085">:=</span>&nbsp;<span class="keyword" id="5719088">range</span>&nbsp;<span class="ident" id="5719094">s</span>&nbsp;<span class="op" id="5719096">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719100">if</span>&nbsp;<span class="op" id="5719103">!</span><span class="ident" id="5719104">unicode</span><span class="op" id="5719111">.</span><span class="ident" id="5719112">IsGraphic</span><span class="op" id="5719121">(</span><span class="ident" id="5719122">r</span><span class="op" id="5719123">)</span>&nbsp;<span class="op" id="5719125">||</span>&nbsp;<span class="ident" id="5719128">unicode</span><span class="op" id="5719135">.</span><span class="ident" id="5719136">IsSpace</span><span class="op" id="5719143">(</span><span class="ident" id="5719144">r</span><span class="op" id="5719145">)</span>&nbsp;<span class="op" id="5719147">||</span>&nbsp;<span class="ident" id="5719150">strings</span><span class="op" id="5719157">.</span><span class="ident" id="5719158">ContainsRune</span><span class="op" id="5719170">(</span><span class="ident" id="5719171">illegalChars</span><span class="op" id="5719183">,</span>&nbsp;<span class="ident" id="5719185">r</span><span class="op" id="5719186">)</span>&nbsp;<span class="op" id="5719188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719193">return</span>&nbsp;<span class="builtintype" id="5719200">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719214">return</span>&nbsp;<span class="ident" id="5719221">s</span>&nbsp;<span class="op" id="5719223">!=</span>&nbsp;<span class="string" id="5719226">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="5719229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5719232">func</span>&nbsp;<span class="op" id="5719237">(</span><span class="ident" id="5719238">p</span>&nbsp;<span class="op" id="5719240">*</span><span class="ident" id="5719241">parser</span><span class="op" id="5719247">)</span>&nbsp;<span class="ident" id="5719249">parseImportSpec</span><span class="op" id="5719264">(</span><span class="ident" id="5719265">doc</span>&nbsp;<span class="op" id="5719269">*</span><span class="ident" id="5719270">ast</span><span class="op" id="5719273">.</span><span class="ident" id="5719274">CommentGroup</span><span class="op" id="5719286">,</span>&nbsp;<span class="ident" id="5719288">_</span>&nbsp;<span class="ident" id="5719290">token</span><span class="op" id="5719295">.</span><span class="ident" id="5719296">Token</span><span class="op" id="5719301">,</span>&nbsp;<span class="ident" id="5719303">_</span>&nbsp;<span class="builtintype" id="5719305">int</span><span class="op" id="5719308">)</span>&nbsp;<span class="ident" id="5719310">ast</span><span class="op" id="5719313">.</span><span class="ident" id="5719314">Spec</span>&nbsp;<span class="op" id="5719319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719322">if</span>&nbsp;<span class="ident" id="5719325">p</span><span class="op" id="5719326">.</span><span class="ident" id="5719327">trace</span>&nbsp;<span class="op" id="5719333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719337">defer</span>&nbsp;<span class="ident" id="5719343">un</span><span class="op" id="5719345">(</span><span class="ident" id="5719346">trace</span><span class="op" id="5719351">(</span><span class="ident" id="5719352">p</span><span class="op" id="5719353">,</span>&nbsp;<span class="string" id="5719355">&#34;ImportSpec&#34;</span><span class="op" id="5719367">)</span><span class="op" id="5719368">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719375">var</span>&nbsp;<span class="ident" id="5719379">ident</span>&nbsp;<span class="op" id="5719385">*</span><span class="ident" id="5719386">ast</span><span class="op" id="5719389">.</span><span class="ident" id="5719390">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719397">switch</span>&nbsp;<span class="ident" id="5719404">p</span><span class="op" id="5719405">.</span><span class="ident" id="5719406">tok</span>&nbsp;<span class="op" id="5719410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719413">case</span>&nbsp;<span class="ident" id="5719418">token</span><span class="op" id="5719423">.</span><span class="ident" id="5719424">PERIOD</span><span class="op" id="5719430">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719434">ident</span>&nbsp;<span class="op" id="5719440">=</span>&nbsp;<span class="op" id="5719442">&amp;</span><span class="ident" id="5719443">ast</span><span class="op" id="5719446">.</span><span class="ident" id="5719447">Ident</span><span class="op" id="5719452">{</span><span class="ident" id="5719453">NamePos</span><span class="op" id="5719460">:</span>&nbsp;<span class="ident" id="5719462">p</span><span class="op" id="5719463">.</span><span class="ident" id="5719464">pos</span><span class="op" id="5719467">,</span>&nbsp;<span class="ident" id="5719469">Name</span><span class="op" id="5719473">:</span>&nbsp;<span class="string" id="5719475">&#34;.&#34;</span><span class="op" id="5719478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719482">p</span><span class="op" id="5719483">.</span><span class="ident" id="5719484">next</span><span class="op" id="5719488">(</span><span class="op" id="5719489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719492">case</span>&nbsp;<span class="ident" id="5719497">token</span><span class="op" id="5719502">.</span><span class="ident" id="5719503">IDENT</span><span class="op" id="5719508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719512">ident</span>&nbsp;<span class="op" id="5719518">=</span>&nbsp;<span class="ident" id="5719520">p</span><span class="op" id="5719521">.</span><span class="ident" id="5719522">parseIdent</span><span class="op" id="5719532">(</span><span class="op" id="5719533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719536">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719540">pos</span>&nbsp;<span class="op" id="5719544">:=</span>&nbsp;<span class="ident" id="5719547">p</span><span class="op" id="5719548">.</span><span class="ident" id="5719549">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719554">var</span>&nbsp;<span class="ident" id="5719558">path</span>&nbsp;<span class="builtintype" id="5719563">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719571">if</span>&nbsp;<span class="ident" id="5719574">p</span><span class="op" id="5719575">.</span><span class="ident" id="5719576">tok</span>&nbsp;<span class="op" id="5719580">==</span>&nbsp;<span class="ident" id="5719583">token</span><span class="op" id="5719588">.</span><span class="ident" id="5719589">STRING</span>&nbsp;<span class="op" id="5719596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719600">path</span>&nbsp;<span class="op" id="5719605">=</span>&nbsp;<span class="ident" id="5719607">p</span><span class="op" id="5719608">.</span><span class="ident" id="5719609">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5719615">if</span>&nbsp;<span class="op" id="5719618">!</span><span class="ident" id="5719619">isValidImport</span><span class="op" id="5719632">(</span><span class="ident" id="5719633">path</span><span class="op" id="5719637">)</span>&nbsp;<span class="op" id="5719639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719644">p</span><span class="op" id="5719645">.</span><span class="builtintype" id="5719646">error</span><span class="op" id="5719651">(</span><span class="ident" id="5719652">pos</span><span class="op" id="5719655">,</span>&nbsp;<span class="string" id="5719657">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="5719680">+</span><span class="ident" id="5719681">path</span><span class="op" id="5719685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719693">p</span><span class="op" id="5719694">.</span><span class="ident" id="5719695">next</span><span class="op" id="5719699">(</span><span class="op" id="5719700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719703">}</span>&nbsp;<span class="keyword" id="5719705">else</span>&nbsp;<span class="op" id="5719710">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719714">p</span><span class="op" id="5719715">.</span><span class="ident" id="5719716">expect</span><span class="op" id="5719722">(</span><span class="ident" id="5719723">token</span><span class="op" id="5719728">.</span><span class="ident" id="5719729">STRING</span><span class="op" id="5719735">)</span>&nbsp;<span class="comment" id="5719737">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5719769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719772">p</span><span class="op" id="5719773">.</span><span class="ident" id="5719774">expectSemi</span><span class="op" id="5719784">(</span><span class="op" id="5719785">)</span>&nbsp;<span class="comment" id="5719787">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5719828">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719848">spec</span>&nbsp;<span class="op" id="5719853">:=</span>&nbsp;<span class="op" id="5719856">&amp;</span><span class="ident" id="5719857">ast</span><span class="op" id="5719860">.</span><span class="ident" id="5719861">ImportSpec</span><span class="op" id="5719871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719875">Doc</span><span class="op" id="5719878">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5719884">doc</span><span class="op" id="5719887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719891">Name</span><span class="op" id="5719895">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5719900">ident</span><span class="op" id="5719905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719909">Path</span><span class="op" id="5719913">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5719918">&amp;</span><span class="ident" id="5719919">ast</span><span class="op" id="5719922">.</span><span class="ident" id="5719923">BasicLit</span><span class="op" id="5719931">{</span><span class="ident" id="5719932">ValuePos</span><span class="op" id="5719940">:</span>&nbsp;<span class="ident" id="5719942">pos</span><span class="op" id="5719945">,</span>&nbsp;<span class="ident" id="5719947">Kind</span><span class="op" id="5719951">:</span>&nbsp;<span class="ident" id="5719953">token</span><span class="op" id="5719958">.</span><span class="ident" id="5719959">STRING</span><span class="op" id="5719965">,</span>&nbsp;<span class="ident" id="5719967">Value</span><span class="op" id="5719972">:</span>&nbsp;<span class="ident" id="5719974">path</span><span class="op" id="5719978">}</span><span class="op" id="5719979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5719983">Comment</span><span class="op" id="5719990">:</span>&nbsp;<span class="ident" id="5719992">p</span><span class="op" id="5719993">.</span><span class="ident" id="5719994">lineComment</span><span class="op" id="5720005">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720011">p</span><span class="op" id="5720012">.</span><span class="ident" id="5720013">imports</span>&nbsp;<span class="op" id="5720021">=</span>&nbsp;<span class="builtinfunc" id="5720023">append</span><span class="op" id="5720029">(</span><span class="ident" id="5720030">p</span><span class="op" id="5720031">.</span><span class="ident" id="5720032">imports</span><span class="op" id="5720039">,</span>&nbsp;<span class="ident" id="5720041">spec</span><span class="op" id="5720045">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720049">return</span>&nbsp;<span class="ident" id="5720056">spec</span><br>
<span class="lineno"></span><span class="op" id="5720061">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="5720064">func</span>&nbsp;<span class="op" id="5720069">(</span><span class="ident" id="5720070">p</span>&nbsp;<span class="op" id="5720072">*</span><span class="ident" id="5720073">parser</span><span class="op" id="5720079">)</span>&nbsp;<span class="ident" id="5720081">parseValueSpec</span><span class="op" id="5720095">(</span><span class="ident" id="5720096">doc</span>&nbsp;<span class="op" id="5720100">*</span><span class="ident" id="5720101">ast</span><span class="op" id="5720104">.</span><span class="ident" id="5720105">CommentGroup</span><span class="op" id="5720117">,</span>&nbsp;<span class="ident" id="5720119">keyword</span>&nbsp;<span class="ident" id="5720127">token</span><span class="op" id="5720132">.</span><span class="ident" id="5720133">Token</span><span class="op" id="5720138">,</span>&nbsp;<span class="ident" id="5720140">iota</span>&nbsp;<span class="builtintype" id="5720145">int</span><span class="op" id="5720148">)</span>&nbsp;<span class="ident" id="5720150">ast</span><span class="op" id="5720153">.</span><span class="ident" id="5720154">Spec</span>&nbsp;<span class="op" id="5720159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720162">if</span>&nbsp;<span class="ident" id="5720165">p</span><span class="op" id="5720166">.</span><span class="ident" id="5720167">trace</span>&nbsp;<span class="op" id="5720173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720177">defer</span>&nbsp;<span class="ident" id="5720183">un</span><span class="op" id="5720185">(</span><span class="ident" id="5720186">trace</span><span class="op" id="5720191">(</span><span class="ident" id="5720192">p</span><span class="op" id="5720193">,</span>&nbsp;<span class="ident" id="5720195">keyword</span><span class="op" id="5720202">.</span><span class="ident" id="5720203">String</span><span class="op" id="5720209">(</span><span class="op" id="5720210">)</span><span class="op" id="5720211">+</span><span class="string" id="5720212">&#34;Spec&#34;</span><span class="op" id="5720218">)</span><span class="op" id="5720219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720222">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720226">idents</span>&nbsp;<span class="op" id="5720233">:=</span>&nbsp;<span class="ident" id="5720236">p</span><span class="op" id="5720237">.</span><span class="ident" id="5720238">parseIdentList</span><span class="op" id="5720252">(</span><span class="op" id="5720253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720256">typ</span>&nbsp;<span class="op" id="5720260">:=</span>&nbsp;<span class="ident" id="5720263">p</span><span class="op" id="5720264">.</span><span class="ident" id="5720265">tryType</span><span class="op" id="5720272">(</span><span class="op" id="5720273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720276">var</span>&nbsp;<span class="ident" id="5720280">values</span>&nbsp;<span class="op" id="5720287">[</span><span class="op" id="5720288">]</span><span class="ident" id="5720289">ast</span><span class="op" id="5720292">.</span><span class="ident" id="5720293">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720299">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720367">if</span>&nbsp;<span class="ident" id="5720370">p</span><span class="op" id="5720371">.</span><span class="ident" id="5720372">tok</span>&nbsp;<span class="op" id="5720376">==</span>&nbsp;<span class="ident" id="5720379">token</span><span class="op" id="5720384">.</span><span class="ident" id="5720385">ASSIGN</span>&nbsp;<span class="op" id="5720392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720396">p</span><span class="op" id="5720397">.</span><span class="ident" id="5720398">next</span><span class="op" id="5720402">(</span><span class="op" id="5720403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720407">values</span>&nbsp;<span class="op" id="5720414">=</span>&nbsp;<span class="ident" id="5720416">p</span><span class="op" id="5720417">.</span><span class="ident" id="5720418">parseRhsList</span><span class="op" id="5720430">(</span><span class="op" id="5720431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720437">p</span><span class="op" id="5720438">.</span><span class="ident" id="5720439">expectSemi</span><span class="op" id="5720449">(</span><span class="op" id="5720450">)</span>&nbsp;<span class="comment" id="5720452">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720493">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720569">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720642">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5720689">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720762">spec</span>&nbsp;<span class="op" id="5720767">:=</span>&nbsp;<span class="op" id="5720770">&amp;</span><span class="ident" id="5720771">ast</span><span class="op" id="5720774">.</span><span class="ident" id="5720775">ValueSpec</span><span class="op" id="5720784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720788">Doc</span><span class="op" id="5720791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5720797">doc</span><span class="op" id="5720800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720804">Names</span><span class="op" id="5720809">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5720813">idents</span><span class="op" id="5720819">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720823">Type</span><span class="op" id="5720827">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5720832">typ</span><span class="op" id="5720835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720839">Values</span><span class="op" id="5720845">:</span>&nbsp;&nbsp;<span class="ident" id="5720848">values</span><span class="op" id="5720854">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720858">Comment</span><span class="op" id="5720865">:</span>&nbsp;<span class="ident" id="5720867">p</span><span class="op" id="5720868">.</span><span class="ident" id="5720869">lineComment</span><span class="op" id="5720880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720886">kind</span>&nbsp;<span class="op" id="5720891">:=</span>&nbsp;<span class="ident" id="5720894">ast</span><span class="op" id="5720897">.</span><span class="ident" id="5720898">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5720903">if</span>&nbsp;<span class="ident" id="5720906">keyword</span>&nbsp;<span class="op" id="5720914">==</span>&nbsp;<span class="ident" id="5720917">token</span><span class="op" id="5720922">.</span><span class="ident" id="5720923">VAR</span>&nbsp;<span class="op" id="5720927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720931">kind</span>&nbsp;<span class="op" id="5720936">=</span>&nbsp;<span class="ident" id="5720938">ast</span><span class="op" id="5720941">.</span><span class="ident" id="5720942">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5720947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5720950">p</span><span class="op" id="5720951">.</span><span class="ident" id="5720952">declare</span><span class="op" id="5720959">(</span><span class="ident" id="5720960">spec</span><span class="op" id="5720964">,</span>&nbsp;<span class="ident" id="5720966">iota</span><span class="op" id="5720970">,</span>&nbsp;<span class="ident" id="5720972">p</span><span class="op" id="5720973">.</span><span class="ident" id="5720974">topScope</span><span class="op" id="5720982">,</span>&nbsp;<span class="ident" id="5720984">kind</span><span class="op" id="5720988">,</span>&nbsp;<span class="ident" id="5720990">idents</span><span class="op" id="5720996">...</span><span class="op" id="5720999">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721003">return</span>&nbsp;<span class="ident" id="5721010">spec</span><br>
<span class="lineno"></span><span class="op" id="5721015">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="5721018">func</span>&nbsp;<span class="op" id="5721023">(</span><span class="ident" id="5721024">p</span>&nbsp;<span class="op" id="5721026">*</span><span class="ident" id="5721027">parser</span><span class="op" id="5721033">)</span>&nbsp;<span class="ident" id="5721035">parseTypeSpec</span><span class="op" id="5721048">(</span><span class="ident" id="5721049">doc</span>&nbsp;<span class="op" id="5721053">*</span><span class="ident" id="5721054">ast</span><span class="op" id="5721057">.</span><span class="ident" id="5721058">CommentGroup</span><span class="op" id="5721070">,</span>&nbsp;<span class="ident" id="5721072">_</span>&nbsp;<span class="ident" id="5721074">token</span><span class="op" id="5721079">.</span><span class="ident" id="5721080">Token</span><span class="op" id="5721085">,</span>&nbsp;<span class="ident" id="5721087">_</span>&nbsp;<span class="builtintype" id="5721089">int</span><span class="op" id="5721092">)</span>&nbsp;<span class="ident" id="5721094">ast</span><span class="op" id="5721097">.</span><span class="ident" id="5721098">Spec</span>&nbsp;<span class="op" id="5721103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721106">if</span>&nbsp;<span class="ident" id="5721109">p</span><span class="op" id="5721110">.</span><span class="ident" id="5721111">trace</span>&nbsp;<span class="op" id="5721117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721121">defer</span>&nbsp;<span class="ident" id="5721127">un</span><span class="op" id="5721129">(</span><span class="ident" id="5721130">trace</span><span class="op" id="5721135">(</span><span class="ident" id="5721136">p</span><span class="op" id="5721137">,</span>&nbsp;<span class="string" id="5721139">&#34;TypeSpec&#34;</span><span class="op" id="5721149">)</span><span class="op" id="5721150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721153">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721157">ident</span>&nbsp;<span class="op" id="5721163">:=</span>&nbsp;<span class="ident" id="5721166">p</span><span class="op" id="5721167">.</span><span class="ident" id="5721168">parseIdent</span><span class="op" id="5721178">(</span><span class="op" id="5721179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721183">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721261">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721336">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5721358">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721431">spec</span>&nbsp;<span class="op" id="5721436">:=</span>&nbsp;<span class="op" id="5721439">&amp;</span><span class="ident" id="5721440">ast</span><span class="op" id="5721443">.</span><span class="ident" id="5721444">TypeSpec</span><span class="op" id="5721452">{</span><span class="ident" id="5721453">Doc</span><span class="op" id="5721456">:</span>&nbsp;<span class="ident" id="5721458">doc</span><span class="op" id="5721461">,</span>&nbsp;<span class="ident" id="5721463">Name</span><span class="op" id="5721467">:</span>&nbsp;<span class="ident" id="5721469">ident</span><span class="op" id="5721474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721477">p</span><span class="op" id="5721478">.</span><span class="ident" id="5721479">declare</span><span class="op" id="5721486">(</span><span class="ident" id="5721487">spec</span><span class="op" id="5721491">,</span>&nbsp;<span class="ident" id="5721493">nil</span><span class="op" id="5721496">,</span>&nbsp;<span class="ident" id="5721498">p</span><span class="op" id="5721499">.</span><span class="ident" id="5721500">topScope</span><span class="op" id="5721508">,</span>&nbsp;<span class="ident" id="5721510">ast</span><span class="op" id="5721513">.</span><span class="ident" id="5721514">Typ</span><span class="op" id="5721517">,</span>&nbsp;<span class="ident" id="5721519">ident</span><span class="op" id="5721524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721528">spec</span><span class="op" id="5721532">.</span><span class="ident" id="5721533">Type</span>&nbsp;<span class="op" id="5721538">=</span>&nbsp;<span class="ident" id="5721540">p</span><span class="op" id="5721541">.</span><span class="ident" id="5721542">parseType</span><span class="op" id="5721551">(</span><span class="op" id="5721552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721555">p</span><span class="op" id="5721556">.</span><span class="ident" id="5721557">expectSemi</span><span class="op" id="5721567">(</span><span class="op" id="5721568">)</span>&nbsp;<span class="comment" id="5721570">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721610">spec</span><span class="op" id="5721614">.</span><span class="ident" id="5721615">Comment</span>&nbsp;<span class="op" id="5721623">=</span>&nbsp;<span class="ident" id="5721625">p</span><span class="op" id="5721626">.</span><span class="ident" id="5721627">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721641">return</span>&nbsp;<span class="ident" id="5721648">spec</span><br>
<span class="lineno">2280</span><span class="op" id="5721653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5721656">func</span>&nbsp;<span class="op" id="5721661">(</span><span class="ident" id="5721662">p</span>&nbsp;<span class="op" id="5721664">*</span><span class="ident" id="5721665">parser</span><span class="op" id="5721671">)</span>&nbsp;<span class="ident" id="5721673">parseGenDecl</span><span class="op" id="5721685">(</span><span class="ident" id="5721686">keyword</span>&nbsp;<span class="ident" id="5721694">token</span><span class="op" id="5721699">.</span><span class="ident" id="5721700">Token</span><span class="op" id="5721705">,</span>&nbsp;<span class="ident" id="5721707">f</span>&nbsp;<span class="ident" id="5721709">parseSpecFunction</span><span class="op" id="5721726">)</span>&nbsp;<span class="op" id="5721728">*</span><span class="ident" id="5721729">ast</span><span class="op" id="5721732">.</span><span class="ident" id="5721733">GenDecl</span>&nbsp;<span class="op" id="5721741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721744">if</span>&nbsp;<span class="ident" id="5721747">p</span><span class="op" id="5721748">.</span><span class="ident" id="5721749">trace</span>&nbsp;<span class="op" id="5721755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721759">defer</span>&nbsp;<span class="ident" id="5721765">un</span><span class="op" id="5721767">(</span><span class="ident" id="5721768">trace</span><span class="op" id="5721773">(</span><span class="ident" id="5721774">p</span><span class="op" id="5721775">,</span>&nbsp;<span class="string" id="5721777">&#34;GenDecl(&#34;</span><span class="op" id="5721787">+</span><span class="ident" id="5721788">keyword</span><span class="op" id="5721795">.</span><span class="ident" id="5721796">String</span><span class="op" id="5721802">(</span><span class="op" id="5721803">)</span><span class="op" id="5721804">+</span><span class="string" id="5721805">&#34;)&#34;</span><span class="op" id="5721808">)</span><span class="op" id="5721809">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5721812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721816">doc</span>&nbsp;<span class="op" id="5721820">:=</span>&nbsp;<span class="ident" id="5721823">p</span><span class="op" id="5721824">.</span><span class="ident" id="5721825">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721838">pos</span>&nbsp;<span class="op" id="5721842">:=</span>&nbsp;<span class="ident" id="5721845">p</span><span class="op" id="5721846">.</span><span class="ident" id="5721847">expect</span><span class="op" id="5721853">(</span><span class="ident" id="5721854">keyword</span><span class="op" id="5721861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721864">var</span>&nbsp;<span class="ident" id="5721868">lparen</span><span class="op" id="5721874">,</span>&nbsp;<span class="ident" id="5721876">rparen</span>&nbsp;<span class="ident" id="5721883">token</span><span class="op" id="5721888">.</span><span class="ident" id="5721889">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721894">var</span>&nbsp;<span class="ident" id="5721898">list</span>&nbsp;<span class="op" id="5721903">[</span><span class="op" id="5721904">]</span><span class="ident" id="5721905">ast</span><span class="op" id="5721908">.</span><span class="ident" id="5721909">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721915">if</span>&nbsp;<span class="ident" id="5721918">p</span><span class="op" id="5721919">.</span><span class="ident" id="5721920">tok</span>&nbsp;<span class="op" id="5721924">==</span>&nbsp;<span class="ident" id="5721927">token</span><span class="op" id="5721932">.</span><span class="ident" id="5721933">LPAREN</span>&nbsp;<span class="op" id="5721940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721944">lparen</span>&nbsp;<span class="op" id="5721951">=</span>&nbsp;<span class="ident" id="5721953">p</span><span class="op" id="5721954">.</span><span class="ident" id="5721955">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5721961">p</span><span class="op" id="5721962">.</span><span class="ident" id="5721963">next</span><span class="op" id="5721967">(</span><span class="op" id="5721968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5721972">for</span>&nbsp;<span class="ident" id="5721976">iota</span>&nbsp;<span class="op" id="5721981">:=</span>&nbsp;<span class="num" id="5721984">0</span><span class="op" id="5721985">;</span>&nbsp;<span class="ident" id="5721987">p</span><span class="op" id="5721988">.</span><span class="ident" id="5721989">tok</span>&nbsp;<span class="op" id="5721993">!=</span>&nbsp;<span class="ident" id="5721996">token</span><span class="op" id="5722001">.</span><span class="ident" id="5722002">RPAREN</span>&nbsp;<span class="op" id="5722009">&amp;&amp;</span>&nbsp;<span class="ident" id="5722012">p</span><span class="op" id="5722013">.</span><span class="ident" id="5722014">tok</span>&nbsp;<span class="op" id="5722018">!=</span>&nbsp;<span class="ident" id="5722021">token</span><span class="op" id="5722026">.</span><span class="ident" id="5722027">EOF</span><span class="op" id="5722030">;</span>&nbsp;<span class="ident" id="5722032">iota</span><span class="op" id="5722036">++</span>&nbsp;<span class="op" id="5722039">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722044">list</span>&nbsp;<span class="op" id="5722049">=</span>&nbsp;<span class="builtinfunc" id="5722051">append</span><span class="op" id="5722057">(</span><span class="ident" id="5722058">list</span><span class="op" id="5722062">,</span>&nbsp;<span class="ident" id="5722064">f</span><span class="op" id="5722065">(</span><span class="ident" id="5722066">p</span><span class="op" id="5722067">.</span><span class="ident" id="5722068">leadComment</span><span class="op" id="5722079">,</span>&nbsp;<span class="ident" id="5722081">keyword</span><span class="op" id="5722088">,</span>&nbsp;<span class="ident" id="5722090">iota</span><span class="op" id="5722094">)</span><span class="op" id="5722095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722103">rparen</span>&nbsp;<span class="op" id="5722110">=</span>&nbsp;<span class="ident" id="5722112">p</span><span class="op" id="5722113">.</span><span class="ident" id="5722114">expect</span><span class="op" id="5722120">(</span><span class="ident" id="5722121">token</span><span class="op" id="5722126">.</span><span class="ident" id="5722127">RPAREN</span><span class="op" id="5722133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722137">p</span><span class="op" id="5722138">.</span><span class="ident" id="5722139">expectSemi</span><span class="op" id="5722149">(</span><span class="op" id="5722150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722153">}</span>&nbsp;<span class="keyword" id="5722155">else</span>&nbsp;<span class="op" id="5722160">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722164">list</span>&nbsp;<span class="op" id="5722169">=</span>&nbsp;<span class="builtinfunc" id="5722171">append</span><span class="op" id="5722177">(</span><span class="ident" id="5722178">list</span><span class="op" id="5722182">,</span>&nbsp;<span class="ident" id="5722184">f</span><span class="op" id="5722185">(</span><span class="ident" id="5722186">nil</span><span class="op" id="5722189">,</span>&nbsp;<span class="ident" id="5722191">keyword</span><span class="op" id="5722198">,</span>&nbsp;<span class="num" id="5722200">0</span><span class="op" id="5722201">)</span><span class="op" id="5722202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722209">return</span>&nbsp;<span class="op" id="5722216">&amp;</span><span class="ident" id="5722217">ast</span><span class="op" id="5722220">.</span><span class="ident" id="5722221">GenDecl</span><span class="op" id="5722228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722232">Doc</span><span class="op" id="5722235">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5722240">doc</span><span class="op" id="5722243">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722247">TokPos</span><span class="op" id="5722253">:</span>&nbsp;<span class="ident" id="5722255">pos</span><span class="op" id="5722258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722262">Tok</span><span class="op" id="5722265">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5722270">keyword</span><span class="op" id="5722277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722281">Lparen</span><span class="op" id="5722287">:</span>&nbsp;<span class="ident" id="5722289">lparen</span><span class="op" id="5722295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722299">Specs</span><span class="op" id="5722304">:</span>&nbsp;&nbsp;<span class="ident" id="5722307">list</span><span class="op" id="5722311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722315">Rparen</span><span class="op" id="5722321">:</span>&nbsp;<span class="ident" id="5722323">rparen</span><span class="op" id="5722329">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722332">}</span><br>
<span class="lineno"></span><span class="op" id="5722334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5722337">func</span>&nbsp;<span class="op" id="5722342">(</span><span class="ident" id="5722343">p</span>&nbsp;<span class="op" id="5722345">*</span><span class="ident" id="5722346">parser</span><span class="op" id="5722352">)</span>&nbsp;<span class="ident" id="5722354">parseFuncDecl</span><span class="op" id="5722367">(</span><span class="op" id="5722368">)</span>&nbsp;<span class="op" id="5722370">*</span><span class="ident" id="5722371">ast</span><span class="op" id="5722374">.</span><span class="ident" id="5722375">FuncDecl</span>&nbsp;<span class="op" id="5722384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722387">if</span>&nbsp;<span class="ident" id="5722390">p</span><span class="op" id="5722391">.</span><span class="ident" id="5722392">trace</span>&nbsp;<span class="op" id="5722398">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722402">defer</span>&nbsp;<span class="ident" id="5722408">un</span><span class="op" id="5722410">(</span><span class="ident" id="5722411">trace</span><span class="op" id="5722416">(</span><span class="ident" id="5722417">p</span><span class="op" id="5722418">,</span>&nbsp;<span class="string" id="5722420">&#34;FunctionDecl&#34;</span><span class="op" id="5722434">)</span><span class="op" id="5722435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722442">doc</span>&nbsp;<span class="op" id="5722446">:=</span>&nbsp;<span class="ident" id="5722449">p</span><span class="op" id="5722450">.</span><span class="ident" id="5722451">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722464">pos</span>&nbsp;<span class="op" id="5722468">:=</span>&nbsp;<span class="ident" id="5722471">p</span><span class="op" id="5722472">.</span><span class="ident" id="5722473">expect</span><span class="op" id="5722479">(</span><span class="ident" id="5722480">token</span><span class="op" id="5722485">.</span><span class="ident" id="5722486">FUNC</span><span class="op" id="5722490">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722493">scope</span>&nbsp;<span class="op" id="5722499">:=</span>&nbsp;<span class="ident" id="5722502">ast</span><span class="op" id="5722505">.</span><span class="ident" id="5722506">NewScope</span><span class="op" id="5722514">(</span><span class="ident" id="5722515">p</span><span class="op" id="5722516">.</span><span class="ident" id="5722517">topScope</span><span class="op" id="5722525">)</span>&nbsp;<span class="comment" id="5722527">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722547">var</span>&nbsp;<span class="ident" id="5722551">recv</span>&nbsp;<span class="op" id="5722556">*</span><span class="ident" id="5722557">ast</span><span class="op" id="5722560">.</span><span class="ident" id="5722561">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722572">if</span>&nbsp;<span class="ident" id="5722575">p</span><span class="op" id="5722576">.</span><span class="ident" id="5722577">tok</span>&nbsp;<span class="op" id="5722581">==</span>&nbsp;<span class="ident" id="5722584">token</span><span class="op" id="5722589">.</span><span class="ident" id="5722590">LPAREN</span>&nbsp;<span class="op" id="5722597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722601">recv</span>&nbsp;<span class="op" id="5722606">=</span>&nbsp;<span class="ident" id="5722608">p</span><span class="op" id="5722609">.</span><span class="ident" id="5722610">parseParameters</span><span class="op" id="5722625">(</span><span class="ident" id="5722626">scope</span><span class="op" id="5722631">,</span>&nbsp;<span class="builtintype" id="5722633">false</span><span class="op" id="5722638">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722645">ident</span>&nbsp;<span class="op" id="5722651">:=</span>&nbsp;<span class="ident" id="5722654">p</span><span class="op" id="5722655">.</span><span class="ident" id="5722656">parseIdent</span><span class="op" id="5722666">(</span><span class="op" id="5722667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722671">params</span><span class="op" id="5722677">,</span>&nbsp;<span class="ident" id="5722679">results</span>&nbsp;<span class="op" id="5722687">:=</span>&nbsp;<span class="ident" id="5722690">p</span><span class="op" id="5722691">.</span><span class="ident" id="5722692">parseSignature</span><span class="op" id="5722706">(</span><span class="ident" id="5722707">scope</span><span class="op" id="5722712">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722716">var</span>&nbsp;<span class="ident" id="5722720">body</span>&nbsp;<span class="op" id="5722725">*</span><span class="ident" id="5722726">ast</span><span class="op" id="5722729">.</span><span class="ident" id="5722730">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722741">if</span>&nbsp;<span class="ident" id="5722744">p</span><span class="op" id="5722745">.</span><span class="ident" id="5722746">tok</span>&nbsp;<span class="op" id="5722750">==</span>&nbsp;<span class="ident" id="5722753">token</span><span class="op" id="5722758">.</span><span class="ident" id="5722759">LBRACE</span>&nbsp;<span class="op" id="5722766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722770">body</span>&nbsp;<span class="op" id="5722775">=</span>&nbsp;<span class="ident" id="5722777">p</span><span class="op" id="5722778">.</span><span class="ident" id="5722779">parseBody</span><span class="op" id="5722788">(</span><span class="ident" id="5722789">scope</span><span class="op" id="5722794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722797">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722800">p</span><span class="op" id="5722801">.</span><span class="ident" id="5722802">expectSemi</span><span class="op" id="5722812">(</span><span class="op" id="5722813">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722817">decl</span>&nbsp;<span class="op" id="5722822">:=</span>&nbsp;<span class="op" id="5722825">&amp;</span><span class="ident" id="5722826">ast</span><span class="op" id="5722829">.</span><span class="ident" id="5722830">FuncDecl</span><span class="op" id="5722838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722842">Doc</span><span class="op" id="5722845">:</span>&nbsp;&nbsp;<span class="ident" id="5722848">doc</span><span class="op" id="5722851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722855">Recv</span><span class="op" id="5722859">:</span>&nbsp;<span class="ident" id="5722861">recv</span><span class="op" id="5722865">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722869">Name</span><span class="op" id="5722873">:</span>&nbsp;<span class="ident" id="5722875">ident</span><span class="op" id="5722880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722884">Type</span><span class="op" id="5722888">:</span>&nbsp;<span class="op" id="5722890">&amp;</span><span class="ident" id="5722891">ast</span><span class="op" id="5722894">.</span><span class="ident" id="5722895">FuncType</span><span class="op" id="5722903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722908">Func</span><span class="op" id="5722912">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5722917">pos</span><span class="op" id="5722920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722925">Params</span><span class="op" id="5722931">:</span>&nbsp;&nbsp;<span class="ident" id="5722934">params</span><span class="op" id="5722940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722945">Results</span><span class="op" id="5722952">:</span>&nbsp;<span class="ident" id="5722954">results</span><span class="op" id="5722961">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722965">}</span><span class="op" id="5722966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5722970">Body</span><span class="op" id="5722974">:</span>&nbsp;<span class="ident" id="5722976">body</span><span class="op" id="5722980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5722983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5722986">if</span>&nbsp;<span class="ident" id="5722989">recv</span>&nbsp;<span class="op" id="5722994">==</span>&nbsp;<span class="ident" id="5722997">nil</span>&nbsp;<span class="op" id="5723001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723005">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723073">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723139">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723189">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723194">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5723252">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723307">if</span>&nbsp;<span class="ident" id="5723310">ident</span><span class="op" id="5723315">.</span><span class="ident" id="5723316">Name</span>&nbsp;<span class="op" id="5723321">!=</span>&nbsp;<span class="string" id="5723324">&#34;init&#34;</span>&nbsp;<span class="op" id="5723331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723336">p</span><span class="op" id="5723337">.</span><span class="ident" id="5723338">declare</span><span class="op" id="5723345">(</span><span class="ident" id="5723346">decl</span><span class="op" id="5723350">,</span>&nbsp;<span class="ident" id="5723352">nil</span><span class="op" id="5723355">,</span>&nbsp;<span class="ident" id="5723357">p</span><span class="op" id="5723358">.</span><span class="ident" id="5723359">pkgScope</span><span class="op" id="5723367">,</span>&nbsp;<span class="ident" id="5723369">ast</span><span class="op" id="5723372">.</span><span class="ident" id="5723373">Fun</span><span class="op" id="5723376">,</span>&nbsp;<span class="ident" id="5723378">ident</span><span class="op" id="5723383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723394">return</span>&nbsp;<span class="ident" id="5723401">decl</span><br>
<span class="lineno"></span><span class="op" id="5723406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5723409">func</span>&nbsp;<span class="op" id="5723414">(</span><span class="ident" id="5723415">p</span>&nbsp;<span class="op" id="5723417">*</span><span class="ident" id="5723418">parser</span><span class="op" id="5723424">)</span>&nbsp;<span class="ident" id="5723426">parseDecl</span><span class="op" id="5723435">(</span><span class="ident" id="5723436">sync</span>&nbsp;<span class="keyword" id="5723441">func</span><span class="op" id="5723445">(</span><span class="op" id="5723446">*</span><span class="ident" id="5723447">parser</span><span class="op" id="5723453">)</span><span class="op" id="5723454">)</span>&nbsp;<span class="ident" id="5723456">ast</span><span class="op" id="5723459">.</span><span class="ident" id="5723460">Decl</span>&nbsp;<span class="op" id="5723465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723468">if</span>&nbsp;<span class="ident" id="5723471">p</span><span class="op" id="5723472">.</span><span class="ident" id="5723473">trace</span>&nbsp;<span class="op" id="5723479">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723483">defer</span>&nbsp;<span class="ident" id="5723489">un</span><span class="op" id="5723491">(</span><span class="ident" id="5723492">trace</span><span class="op" id="5723497">(</span><span class="ident" id="5723498">p</span><span class="op" id="5723499">,</span>&nbsp;<span class="string" id="5723501">&#34;Declaration&#34;</span><span class="op" id="5723514">)</span><span class="op" id="5723515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723522">var</span>&nbsp;<span class="ident" id="5723526">f</span>&nbsp;<span class="ident" id="5723528">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723547">switch</span>&nbsp;<span class="ident" id="5723554">p</span><span class="op" id="5723555">.</span><span class="ident" id="5723556">tok</span>&nbsp;<span class="op" id="5723560">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723563">case</span>&nbsp;<span class="ident" id="5723568">token</span><span class="op" id="5723573">.</span><span class="ident" id="5723574">CONST</span><span class="op" id="5723579">,</span>&nbsp;<span class="ident" id="5723581">token</span><span class="op" id="5723586">.</span><span class="ident" id="5723587">VAR</span><span class="op" id="5723590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723594">f</span>&nbsp;<span class="op" id="5723596">=</span>&nbsp;<span class="ident" id="5723598">p</span><span class="op" id="5723599">.</span><span class="ident" id="5723600">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723617">case</span>&nbsp;<span class="ident" id="5723622">token</span><span class="op" id="5723627">.</span><span class="ident" id="5723628">TYPE</span><span class="op" id="5723632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723636">f</span>&nbsp;<span class="op" id="5723638">=</span>&nbsp;<span class="ident" id="5723640">p</span><span class="op" id="5723641">.</span><span class="ident" id="5723642">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723658">case</span>&nbsp;<span class="ident" id="5723663">token</span><span class="op" id="5723668">.</span><span class="ident" id="5723669">FUNC</span><span class="op" id="5723673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723677">return</span>&nbsp;<span class="ident" id="5723684">p</span><span class="op" id="5723685">.</span><span class="ident" id="5723686">parseFuncDecl</span><span class="op" id="5723699">(</span><span class="op" id="5723700">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723704">default</span><span class="op" id="5723711">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723715">pos</span>&nbsp;<span class="op" id="5723719">:=</span>&nbsp;<span class="ident" id="5723722">p</span><span class="op" id="5723723">.</span><span class="ident" id="5723724">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723730">p</span><span class="op" id="5723731">.</span><span class="ident" id="5723732">errorExpected</span><span class="op" id="5723745">(</span><span class="ident" id="5723746">pos</span><span class="op" id="5723749">,</span>&nbsp;<span class="string" id="5723751">&#34;declaration&#34;</span><span class="op" id="5723764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5723768">sync</span><span class="op" id="5723772">(</span><span class="ident" id="5723773">p</span><span class="op" id="5723774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723778">return</span>&nbsp;<span class="op" id="5723785">&amp;</span><span class="ident" id="5723786">ast</span><span class="op" id="5723789">.</span><span class="ident" id="5723790">BadDecl</span><span class="op" id="5723797">{</span><span class="ident" id="5723798">From</span><span class="op" id="5723802">:</span>&nbsp;<span class="ident" id="5723804">pos</span><span class="op" id="5723807">,</span>&nbsp;<span class="ident" id="5723809">To</span><span class="op" id="5723811">:</span>&nbsp;<span class="ident" id="5723813">p</span><span class="op" id="5723814">.</span><span class="ident" id="5723815">pos</span><span class="op" id="5723818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5723821">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723825">return</span>&nbsp;<span class="ident" id="5723832">p</span><span class="op" id="5723833">.</span><span class="ident" id="5723834">parseGenDecl</span><span class="op" id="5723846">(</span><span class="ident" id="5723847">p</span><span class="op" id="5723848">.</span><span class="ident" id="5723849">tok</span><span class="op" id="5723852">,</span>&nbsp;<span class="ident" id="5723854">f</span><span class="op" id="5723855">)</span><br>
<span class="lineno"></span><span class="op" id="5723857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5723860">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="5723940">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5723957">func</span>&nbsp;<span class="op" id="5723962">(</span><span class="ident" id="5723963">p</span>&nbsp;<span class="op" id="5723965">*</span><span class="ident" id="5723966">parser</span><span class="op" id="5723972">)</span>&nbsp;<span class="ident" id="5723974">parseFile</span><span class="op" id="5723983">(</span><span class="op" id="5723984">)</span>&nbsp;<span class="op" id="5723986">*</span><span class="ident" id="5723987">ast</span><span class="op" id="5723990">.</span><span class="ident" id="5723991">File</span>&nbsp;<span class="op" id="5723996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5723999">if</span>&nbsp;<span class="ident" id="5724002">p</span><span class="op" id="5724003">.</span><span class="ident" id="5724004">trace</span>&nbsp;<span class="op" id="5724010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724014">defer</span>&nbsp;<span class="ident" id="5724020">un</span><span class="op" id="5724022">(</span><span class="ident" id="5724023">trace</span><span class="op" id="5724028">(</span><span class="ident" id="5724029">p</span><span class="op" id="5724030">,</span>&nbsp;<span class="string" id="5724032">&#34;File&#34;</span><span class="op" id="5724038">)</span><span class="op" id="5724039">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724046">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724123">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724163">if</span>&nbsp;<span class="ident" id="5724166">p</span><span class="op" id="5724167">.</span><span class="ident" id="5724168">errors</span><span class="op" id="5724174">.</span><span class="ident" id="5724175">Len</span><span class="op" id="5724178">(</span><span class="op" id="5724179">)</span>&nbsp;<span class="op" id="5724181">!=</span>&nbsp;<span class="num" id="5724184">0</span>&nbsp;<span class="op" id="5724186">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724190">return</span>&nbsp;<span class="ident" id="5724197">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724206">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724225">doc</span>&nbsp;<span class="op" id="5724229">:=</span>&nbsp;<span class="ident" id="5724232">p</span><span class="op" id="5724233">.</span><span class="ident" id="5724234">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724247">pos</span>&nbsp;<span class="op" id="5724251">:=</span>&nbsp;<span class="ident" id="5724254">p</span><span class="op" id="5724255">.</span><span class="ident" id="5724256">expect</span><span class="op" id="5724262">(</span><span class="ident" id="5724263">token</span><span class="op" id="5724268">.</span><span class="ident" id="5724269">PACKAGE</span><span class="op" id="5724276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724279">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724333">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724384">ident</span>&nbsp;<span class="op" id="5724390">:=</span>&nbsp;<span class="ident" id="5724393">p</span><span class="op" id="5724394">.</span><span class="ident" id="5724395">parseIdent</span><span class="op" id="5724405">(</span><span class="op" id="5724406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724409">if</span>&nbsp;<span class="ident" id="5724412">ident</span><span class="op" id="5724417">.</span><span class="ident" id="5724418">Name</span>&nbsp;<span class="op" id="5724423">==</span>&nbsp;<span class="string" id="5724426">&#34;_&#34;</span>&nbsp;<span class="op" id="5724430">&amp;&amp;</span>&nbsp;<span class="ident" id="5724433">p</span><span class="op" id="5724434">.</span><span class="ident" id="5724435">mode</span><span class="op" id="5724439">&amp;</span><span class="ident" id="5724440">DeclarationErrors</span>&nbsp;<span class="op" id="5724458">!=</span>&nbsp;<span class="num" id="5724461">0</span>&nbsp;<span class="op" id="5724463">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724467">p</span><span class="op" id="5724468">.</span><span class="builtintype" id="5724469">error</span><span class="op" id="5724474">(</span><span class="ident" id="5724475">p</span><span class="op" id="5724476">.</span><span class="ident" id="5724477">pos</span><span class="op" id="5724480">,</span>&nbsp;<span class="string" id="5724482">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="5724506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724512">p</span><span class="op" id="5724513">.</span><span class="ident" id="5724514">expectSemi</span><span class="op" id="5724524">(</span><span class="op" id="5724525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724529">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724608">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724648">if</span>&nbsp;<span class="ident" id="5724651">p</span><span class="op" id="5724652">.</span><span class="ident" id="5724653">errors</span><span class="op" id="5724659">.</span><span class="ident" id="5724660">Len</span><span class="op" id="5724663">(</span><span class="op" id="5724664">)</span>&nbsp;<span class="op" id="5724666">!=</span>&nbsp;<span class="num" id="5724669">0</span>&nbsp;<span class="op" id="5724671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724675">return</span>&nbsp;<span class="ident" id="5724682">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724691">p</span><span class="op" id="5724692">.</span><span class="ident" id="5724693">openScope</span><span class="op" id="5724702">(</span><span class="op" id="5724703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724706">p</span><span class="op" id="5724707">.</span><span class="ident" id="5724708">pkgScope</span>&nbsp;<span class="op" id="5724717">=</span>&nbsp;<span class="ident" id="5724719">p</span><span class="op" id="5724720">.</span><span class="ident" id="5724721">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724731">var</span>&nbsp;<span class="ident" id="5724735">decls</span>&nbsp;<span class="op" id="5724741">[</span><span class="op" id="5724742">]</span><span class="ident" id="5724743">ast</span><span class="op" id="5724746">.</span><span class="ident" id="5724747">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724753">if</span>&nbsp;<span class="ident" id="5724756">p</span><span class="op" id="5724757">.</span><span class="ident" id="5724758">mode</span><span class="op" id="5724762">&amp;</span><span class="ident" id="5724763">PackageClauseOnly</span>&nbsp;<span class="op" id="5724781">==</span>&nbsp;<span class="num" id="5724784">0</span>&nbsp;<span class="op" id="5724786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724790">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724808">for</span>&nbsp;<span class="ident" id="5724812">p</span><span class="op" id="5724813">.</span><span class="ident" id="5724814">tok</span>&nbsp;<span class="op" id="5724818">==</span>&nbsp;<span class="ident" id="5724821">token</span><span class="op" id="5724826">.</span><span class="ident" id="5724827">IMPORT</span>&nbsp;<span class="op" id="5724834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5724839">decls</span>&nbsp;<span class="op" id="5724845">=</span>&nbsp;<span class="builtinfunc" id="5724847">append</span><span class="op" id="5724853">(</span><span class="ident" id="5724854">decls</span><span class="op" id="5724859">,</span>&nbsp;<span class="ident" id="5724861">p</span><span class="op" id="5724862">.</span><span class="ident" id="5724863">parseGenDecl</span><span class="op" id="5724875">(</span><span class="ident" id="5724876">token</span><span class="op" id="5724881">.</span><span class="ident" id="5724882">IMPORT</span><span class="op" id="5724888">,</span>&nbsp;<span class="ident" id="5724890">p</span><span class="op" id="5724891">.</span><span class="ident" id="5724892">parseImportSpec</span><span class="op" id="5724907">)</span><span class="op" id="5724908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5724912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724917">if</span>&nbsp;<span class="ident" id="5724920">p</span><span class="op" id="5724921">.</span><span class="ident" id="5724922">mode</span><span class="op" id="5724926">&amp;</span><span class="ident" id="5724927">ImportsOnly</span>&nbsp;<span class="op" id="5724939">==</span>&nbsp;<span class="num" id="5724942">0</span>&nbsp;<span class="op" id="5724944">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5724949">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5724976">for</span>&nbsp;<span class="ident" id="5724980">p</span><span class="op" id="5724981">.</span><span class="ident" id="5724982">tok</span>&nbsp;<span class="op" id="5724986">!=</span>&nbsp;<span class="ident" id="5724989">token</span><span class="op" id="5724994">.</span><span class="ident" id="5724995">EOF</span>&nbsp;<span class="op" id="5724999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725005">decls</span>&nbsp;<span class="op" id="5725011">=</span>&nbsp;<span class="builtinfunc" id="5725013">append</span><span class="op" id="5725019">(</span><span class="ident" id="5725020">decls</span><span class="op" id="5725025">,</span>&nbsp;<span class="ident" id="5725027">p</span><span class="op" id="5725028">.</span><span class="ident" id="5725029">parseDecl</span><span class="op" id="5725038">(</span><span class="ident" id="5725039">syncDecl</span><span class="op" id="5725047">)</span><span class="op" id="5725048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725057">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725063">p</span><span class="op" id="5725064">.</span><span class="ident" id="5725065">closeScope</span><span class="op" id="5725075">(</span><span class="op" id="5725076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725079">assert</span><span class="op" id="5725085">(</span><span class="ident" id="5725086">p</span><span class="op" id="5725087">.</span><span class="ident" id="5725088">topScope</span>&nbsp;<span class="op" id="5725097">==</span>&nbsp;<span class="ident" id="5725100">nil</span><span class="op" id="5725103">,</span>&nbsp;<span class="string" id="5725105">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5725124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725127">assert</span><span class="op" id="5725133">(</span><span class="ident" id="5725134">p</span><span class="op" id="5725135">.</span><span class="ident" id="5725136">labelScope</span>&nbsp;<span class="op" id="5725147">==</span>&nbsp;<span class="ident" id="5725150">nil</span><span class="op" id="5725153">,</span>&nbsp;<span class="string" id="5725155">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="5725180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725184">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725236">i</span>&nbsp;<span class="op" id="5725238">:=</span>&nbsp;<span class="num" id="5725241">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725244">for</span>&nbsp;<span class="ident" id="5725248">_</span><span class="op" id="5725249">,</span>&nbsp;<span class="ident" id="5725251">ident</span>&nbsp;<span class="op" id="5725257">:=</span>&nbsp;<span class="keyword" id="5725260">range</span>&nbsp;<span class="ident" id="5725266">p</span><span class="op" id="5725267">.</span><span class="ident" id="5725268">unresolved</span>&nbsp;<span class="op" id="5725279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5725283">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725317">assert</span><span class="op" id="5725323">(</span><span class="ident" id="5725324">ident</span><span class="op" id="5725329">.</span><span class="ident" id="5725330">Obj</span>&nbsp;<span class="op" id="5725334">==</span>&nbsp;<span class="ident" id="5725337">unresolved</span><span class="op" id="5725347">,</span>&nbsp;<span class="string" id="5725349">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="5725374">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725378">ident</span><span class="op" id="5725383">.</span><span class="ident" id="5725384">Obj</span>&nbsp;<span class="op" id="5725388">=</span>&nbsp;<span class="ident" id="5725390">p</span><span class="op" id="5725391">.</span><span class="ident" id="5725392">pkgScope</span><span class="op" id="5725400">.</span><span class="ident" id="5725401">Lookup</span><span class="op" id="5725407">(</span><span class="ident" id="5725408">ident</span><span class="op" id="5725413">.</span><span class="ident" id="5725414">Name</span><span class="op" id="5725418">)</span>&nbsp;<span class="comment" id="5725420">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725458">if</span>&nbsp;<span class="ident" id="5725461">ident</span><span class="op" id="5725466">.</span><span class="ident" id="5725467">Obj</span>&nbsp;<span class="op" id="5725471">==</span>&nbsp;<span class="ident" id="5725474">nil</span>&nbsp;<span class="op" id="5725478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725483">p</span><span class="op" id="5725484">.</span><span class="ident" id="5725485">unresolved</span><span class="op" id="5725495">[</span><span class="ident" id="5725496">i</span><span class="op" id="5725497">]</span>&nbsp;<span class="op" id="5725499">=</span>&nbsp;<span class="ident" id="5725501">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725510">i</span><span class="op" id="5725511">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725516">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5725523">return</span>&nbsp;<span class="op" id="5725530">&amp;</span><span class="ident" id="5725531">ast</span><span class="op" id="5725534">.</span><span class="ident" id="5725535">File</span><span class="op" id="5725539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725543">Doc</span><span class="op" id="5725546">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725555">doc</span><span class="op" id="5725558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725562">Package</span><span class="op" id="5725569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725574">pos</span><span class="op" id="5725577">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725581">Name</span><span class="op" id="5725585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725593">ident</span><span class="op" id="5725598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725602">Decls</span><span class="op" id="5725607">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725614">decls</span><span class="op" id="5725619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725623">Scope</span><span class="op" id="5725628">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725635">p</span><span class="op" id="5725636">.</span><span class="ident" id="5725637">pkgScope</span><span class="op" id="5725645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725649">Imports</span><span class="op" id="5725656">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5725661">p</span><span class="op" id="5725662">.</span><span class="ident" id="5725663">imports</span><span class="op" id="5725670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725674">Unresolved</span><span class="op" id="5725684">:</span>&nbsp;<span class="ident" id="5725686">p</span><span class="op" id="5725687">.</span><span class="ident" id="5725688">unresolved</span><span class="op" id="5725698">[</span><span class="num" id="5725699">0</span><span class="op" id="5725700">:</span><span class="ident" id="5725701">i</span><span class="op" id="5725702">]</span><span class="op" id="5725703">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5725707">Comments</span><span class="op" id="5725715">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5725719">p</span><span class="op" id="5725720">.</span><span class="ident" id="5725721">comments</span><span class="op" id="5725729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5725732">}</span><br>
<span class="lineno"></span><span class="op" id="5725734">}</span>
</div>
</body>
</html>
