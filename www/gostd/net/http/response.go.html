<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5086816">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5086871">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5086925">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5086976">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087015">package</span>&nbsp;<span class="ident" id="5087023">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5087029">import</span>&nbsp;<span class="op" id="5087036">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087039">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087048">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087057">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087071">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087081">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087087">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087104">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087115">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087126">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5087136">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5087139">var</span>&nbsp;<span class="ident" id="5087143">respExcludeHeader</span>&nbsp;<span class="op" id="5087161">=</span>&nbsp;<span class="keyword" id="5087163">map</span><span class="op" id="5087166">[</span><span class="builtintype" id="5087167">string</span><span class="op" id="5087173">]</span><span class="builtintype" id="5087174">bool</span><span class="op" id="5087178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087181">&#34;Content-Length&#34;</span><span class="op" id="5087197">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5087202">true</span><span class="op" id="5087206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087209">&#34;Transfer-Encoding&#34;</span><span class="op" id="5087228">:</span>&nbsp;<span class="builtintype" id="5087230">true</span><span class="op" id="5087234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5087237">&#34;Trailer&#34;</span><span class="op" id="5087246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5087258">true</span><span class="op" id="5087262">,</span><br>
<span class="lineno">25</span><span class="op" id="5087264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5087267">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5087325">//</span><br>
<span class="lineno"></span><span class="keyword" id="5087328">type</span>&nbsp;<span class="ident" id="5087333">Response</span>&nbsp;<span class="keyword" id="5087342">struct</span>&nbsp;<span class="op" id="5087349">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087352">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5087363">string</span>&nbsp;<span class="comment" id="5087370">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087388">StatusCode</span>&nbsp;<span class="builtintype" id="5087399">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087406">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087419">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5087430">string</span>&nbsp;<span class="comment" id="5087437">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087457">ProtoMajor</span>&nbsp;<span class="builtintype" id="5087468">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087475">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087486">ProtoMinor</span>&nbsp;<span class="builtintype" id="5087497">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5087504">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087516">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087585">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087653">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087726">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087796">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087868">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087893">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087897">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5087961">Header</span>&nbsp;<span class="ident" id="5087968">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5087977">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088016">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088020">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088084">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088148">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088209">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088225">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088229">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088291">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088331">Body</span>&nbsp;<span class="ident" id="5088336">io</span><span class="op" id="5088338">.</span><span class="ident" id="5088339">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088352">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088421">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088495">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088566">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088589">ContentLength</span>&nbsp;<span class="ident" id="5088603">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088611">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088683">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088732">TransferEncoding</span>&nbsp;<span class="op" id="5088749">[</span><span class="op" id="5088750">]</span><span class="builtintype" id="5088751">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088760">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088829">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088902">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5088964">Close</span>&nbsp;<span class="builtintype" id="5088970">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5088977">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089030">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089056">Trailer</span>&nbsp;<span class="ident" id="5089064">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089073">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089128">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089186">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089234">Request</span>&nbsp;<span class="op" id="5089242">*</span><span class="ident" id="5089243">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089253">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089320">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089384">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5089446">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089460">TLS</span>&nbsp;<span class="op" id="5089464">*</span><span class="ident" id="5089465">tls</span><span class="op" id="5089468">.</span><span class="ident" id="5089469">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="5089485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5089488">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5089561">func</span>&nbsp;<span class="op" id="5089566">(</span><span class="ident" id="5089567">r</span>&nbsp;<span class="op" id="5089569">*</span><span class="ident" id="5089570">Response</span><span class="op" id="5089578">)</span>&nbsp;<span class="ident" id="5089580">Cookies</span><span class="op" id="5089587">(</span><span class="op" id="5089588">)</span>&nbsp;<span class="op" id="5089590">[</span><span class="op" id="5089591">]</span><span class="op" id="5089592">*</span><span class="ident" id="5089593">Cookie</span>&nbsp;<span class="op" id="5089600">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5089603">return</span>&nbsp;<span class="ident" id="5089610">readSetCookies</span><span class="op" id="5089624">(</span><span class="ident" id="5089625">r</span><span class="op" id="5089626">.</span><span class="ident" id="5089627">Header</span><span class="op" id="5089633">)</span><br>
<span class="lineno"></span><span class="op" id="5089635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5089638">var</span>&nbsp;<span class="ident" id="5089642">ErrNoLocation</span>&nbsp;<span class="op" id="5089656">=</span>&nbsp;<span class="ident" id="5089658">errors</span><span class="op" id="5089664">.</span><span class="ident" id="5089665">New</span><span class="op" id="5089668">(</span><span class="string" id="5089669">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="5089707">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5089710">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5089775">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5089835">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5089895">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="5089926">func</span>&nbsp;<span class="op" id="5089931">(</span><span class="ident" id="5089932">r</span>&nbsp;<span class="op" id="5089934">*</span><span class="ident" id="5089935">Response</span><span class="op" id="5089943">)</span>&nbsp;<span class="ident" id="5089945">Location</span><span class="op" id="5089953">(</span><span class="op" id="5089954">)</span>&nbsp;<span class="op" id="5089956">(</span><span class="op" id="5089957">*</span><span class="ident" id="5089958">url</span><span class="op" id="5089961">.</span><span class="ident" id="5089962">URL</span><span class="op" id="5089965">,</span>&nbsp;<span class="builtintype" id="5089967">error</span><span class="op" id="5089972">)</span>&nbsp;<span class="op" id="5089974">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5089977">lv</span>&nbsp;<span class="op" id="5089980">:=</span>&nbsp;<span class="ident" id="5089983">r</span><span class="op" id="5089984">.</span><span class="ident" id="5089985">Header</span><span class="op" id="5089991">.</span><span class="ident" id="5089992">Get</span><span class="op" id="5089995">(</span><span class="string" id="5089996">&#34;Location&#34;</span><span class="op" id="5090006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090009">if</span>&nbsp;<span class="ident" id="5090012">lv</span>&nbsp;<span class="op" id="5090015">==</span>&nbsp;<span class="string" id="5090018">&#34;&#34;</span>&nbsp;<span class="op" id="5090021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090025">return</span>&nbsp;<span class="ident" id="5090032">nil</span><span class="op" id="5090035">,</span>&nbsp;<span class="ident" id="5090037">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090055">if</span>&nbsp;<span class="ident" id="5090058">r</span><span class="op" id="5090059">.</span><span class="ident" id="5090060">Request</span>&nbsp;<span class="op" id="5090068">!=</span>&nbsp;<span class="ident" id="5090071">nil</span>&nbsp;<span class="op" id="5090075">&amp;&amp;</span>&nbsp;<span class="ident" id="5090078">r</span><span class="op" id="5090079">.</span><span class="ident" id="5090080">Request</span><span class="op" id="5090087">.</span><span class="ident" id="5090088">URL</span>&nbsp;<span class="op" id="5090092">!=</span>&nbsp;<span class="ident" id="5090095">nil</span>&nbsp;<span class="op" id="5090099">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090103">return</span>&nbsp;<span class="ident" id="5090110">r</span><span class="op" id="5090111">.</span><span class="ident" id="5090112">Request</span><span class="op" id="5090119">.</span><span class="ident" id="5090120">URL</span><span class="op" id="5090123">.</span><span class="ident" id="5090124">Parse</span><span class="op" id="5090129">(</span><span class="ident" id="5090130">lv</span><span class="op" id="5090132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090138">return</span>&nbsp;<span class="ident" id="5090145">url</span><span class="op" id="5090148">.</span><span class="ident" id="5090149">Parse</span><span class="op" id="5090154">(</span><span class="ident" id="5090155">lv</span><span class="op" id="5090157">)</span><br>
<span class="lineno"></span><span class="op" id="5090159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5090162">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5090221">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5090292">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="5090347">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5090417">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="5090488">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="5090531">func</span>&nbsp;<span class="ident" id="5090536">ReadResponse</span><span class="op" id="5090548">(</span><span class="ident" id="5090549">r</span>&nbsp;<span class="op" id="5090551">*</span><span class="ident" id="5090552">bufio</span><span class="op" id="5090557">.</span><span class="ident" id="5090558">Reader</span><span class="op" id="5090564">,</span>&nbsp;<span class="ident" id="5090566">req</span>&nbsp;<span class="op" id="5090570">*</span><span class="ident" id="5090571">Request</span><span class="op" id="5090578">)</span>&nbsp;<span class="op" id="5090580">(</span><span class="op" id="5090581">*</span><span class="ident" id="5090582">Response</span><span class="op" id="5090590">,</span>&nbsp;<span class="builtintype" id="5090592">error</span><span class="op" id="5090597">)</span>&nbsp;<span class="op" id="5090599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090602">tp</span>&nbsp;<span class="op" id="5090605">:=</span>&nbsp;<span class="ident" id="5090608">textproto</span><span class="op" id="5090617">.</span><span class="ident" id="5090618">NewReader</span><span class="op" id="5090627">(</span><span class="ident" id="5090628">r</span><span class="op" id="5090629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090632">resp</span>&nbsp;<span class="op" id="5090637">:=</span>&nbsp;<span class="op" id="5090640">&amp;</span><span class="ident" id="5090641">Response</span><span class="op" id="5090649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090653">Request</span><span class="op" id="5090660">:</span>&nbsp;<span class="ident" id="5090662">req</span><span class="op" id="5090665">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5090672">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090714">line</span><span class="op" id="5090718">,</span>&nbsp;<span class="ident" id="5090720">err</span>&nbsp;<span class="op" id="5090724">:=</span>&nbsp;<span class="ident" id="5090727">tp</span><span class="op" id="5090729">.</span><span class="ident" id="5090730">ReadLine</span><span class="op" id="5090738">(</span><span class="op" id="5090739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090742">if</span>&nbsp;<span class="ident" id="5090745">err</span>&nbsp;<span class="op" id="5090749">!=</span>&nbsp;<span class="ident" id="5090752">nil</span>&nbsp;<span class="op" id="5090756">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090760">if</span>&nbsp;<span class="ident" id="5090763">err</span>&nbsp;<span class="op" id="5090767">==</span>&nbsp;<span class="ident" id="5090770">io</span><span class="op" id="5090772">.</span><span class="ident" id="5090773">EOF</span>&nbsp;<span class="op" id="5090777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090782">err</span>&nbsp;<span class="op" id="5090786">=</span>&nbsp;<span class="ident" id="5090788">io</span><span class="op" id="5090790">.</span><span class="ident" id="5090791">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090814">return</span>&nbsp;<span class="ident" id="5090821">nil</span><span class="op" id="5090824">,</span>&nbsp;<span class="ident" id="5090826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090831">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090834">f</span>&nbsp;<span class="op" id="5090836">:=</span>&nbsp;<span class="ident" id="5090839">strings</span><span class="op" id="5090846">.</span><span class="ident" id="5090847">SplitN</span><span class="op" id="5090853">(</span><span class="ident" id="5090854">line</span><span class="op" id="5090858">,</span>&nbsp;<span class="string" id="5090860">&#34;&nbsp;&#34;</span><span class="op" id="5090863">,</span>&nbsp;<span class="num" id="5090865">3</span><span class="op" id="5090866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090869">if</span>&nbsp;<span class="builtinfunc" id="5090872">len</span><span class="op" id="5090875">(</span><span class="ident" id="5090876">f</span><span class="op" id="5090877">)</span>&nbsp;<span class="op" id="5090879">&lt;</span>&nbsp;<span class="num" id="5090881">2</span>&nbsp;<span class="op" id="5090883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090887">return</span>&nbsp;<span class="ident" id="5090894">nil</span><span class="op" id="5090897">,</span>&nbsp;<span class="op" id="5090899">&amp;</span><span class="ident" id="5090900">badStringError</span><span class="op" id="5090914">{</span><span class="string" id="5090915">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="5090940">,</span>&nbsp;<span class="ident" id="5090942">line</span><span class="op" id="5090946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5090949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090952">reasonPhrase</span>&nbsp;<span class="op" id="5090965">:=</span>&nbsp;<span class="string" id="5090968">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5090972">if</span>&nbsp;<span class="builtinfunc" id="5090975">len</span><span class="op" id="5090978">(</span><span class="ident" id="5090979">f</span><span class="op" id="5090980">)</span>&nbsp;<span class="op" id="5090982">&gt;</span>&nbsp;<span class="num" id="5090984">2</span>&nbsp;<span class="op" id="5090986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5090990">reasonPhrase</span>&nbsp;<span class="op" id="5091003">=</span>&nbsp;<span class="ident" id="5091005">f</span><span class="op" id="5091006">[</span><span class="num" id="5091007">2</span><span class="op" id="5091008">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091014">resp</span><span class="op" id="5091018">.</span><span class="ident" id="5091019">Status</span>&nbsp;<span class="op" id="5091026">=</span>&nbsp;<span class="ident" id="5091028">f</span><span class="op" id="5091029">[</span><span class="num" id="5091030">1</span><span class="op" id="5091031">]</span>&nbsp;<span class="op" id="5091033">+</span>&nbsp;<span class="string" id="5091035">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5091039">+</span>&nbsp;<span class="ident" id="5091041">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091055">resp</span><span class="op" id="5091059">.</span><span class="ident" id="5091060">StatusCode</span><span class="op" id="5091070">,</span>&nbsp;<span class="ident" id="5091072">err</span>&nbsp;<span class="op" id="5091076">=</span>&nbsp;<span class="ident" id="5091078">strconv</span><span class="op" id="5091085">.</span><span class="ident" id="5091086">Atoi</span><span class="op" id="5091090">(</span><span class="ident" id="5091091">f</span><span class="op" id="5091092">[</span><span class="num" id="5091093">1</span><span class="op" id="5091094">]</span><span class="op" id="5091095">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091098">if</span>&nbsp;<span class="ident" id="5091101">err</span>&nbsp;<span class="op" id="5091105">!=</span>&nbsp;<span class="ident" id="5091108">nil</span>&nbsp;<span class="op" id="5091112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091116">return</span>&nbsp;<span class="ident" id="5091123">nil</span><span class="op" id="5091126">,</span>&nbsp;<span class="op" id="5091128">&amp;</span><span class="ident" id="5091129">badStringError</span><span class="op" id="5091143">{</span><span class="string" id="5091144">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="5091172">,</span>&nbsp;<span class="ident" id="5091174">f</span><span class="op" id="5091175">[</span><span class="num" id="5091176">1</span><span class="op" id="5091177">]</span><span class="op" id="5091178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091185">resp</span><span class="op" id="5091189">.</span><span class="ident" id="5091190">Proto</span>&nbsp;<span class="op" id="5091196">=</span>&nbsp;<span class="ident" id="5091198">f</span><span class="op" id="5091199">[</span><span class="num" id="5091200">0</span><span class="op" id="5091201">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091204">var</span>&nbsp;<span class="ident" id="5091208">ok</span>&nbsp;<span class="builtintype" id="5091211">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091217">if</span>&nbsp;<span class="ident" id="5091220">resp</span><span class="op" id="5091224">.</span><span class="ident" id="5091225">ProtoMajor</span><span class="op" id="5091235">,</span>&nbsp;<span class="ident" id="5091237">resp</span><span class="op" id="5091241">.</span><span class="ident" id="5091242">ProtoMinor</span><span class="op" id="5091252">,</span>&nbsp;<span class="ident" id="5091254">ok</span>&nbsp;<span class="op" id="5091257">=</span>&nbsp;<span class="ident" id="5091259">ParseHTTPVersion</span><span class="op" id="5091275">(</span><span class="ident" id="5091276">resp</span><span class="op" id="5091280">.</span><span class="ident" id="5091281">Proto</span><span class="op" id="5091286">)</span><span class="op" id="5091287">;</span>&nbsp;<span class="op" id="5091289">!</span><span class="ident" id="5091290">ok</span>&nbsp;<span class="op" id="5091293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091297">return</span>&nbsp;<span class="ident" id="5091304">nil</span><span class="op" id="5091307">,</span>&nbsp;<span class="op" id="5091309">&amp;</span><span class="ident" id="5091310">badStringError</span><span class="op" id="5091324">{</span><span class="string" id="5091325">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="5091349">,</span>&nbsp;<span class="ident" id="5091351">resp</span><span class="op" id="5091355">.</span><span class="ident" id="5091356">Proto</span><span class="op" id="5091361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5091368">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091400">mimeHeader</span><span class="op" id="5091410">,</span>&nbsp;<span class="ident" id="5091412">err</span>&nbsp;<span class="op" id="5091416">:=</span>&nbsp;<span class="ident" id="5091419">tp</span><span class="op" id="5091421">.</span><span class="ident" id="5091422">ReadMIMEHeader</span><span class="op" id="5091436">(</span><span class="op" id="5091437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091440">if</span>&nbsp;<span class="ident" id="5091443">err</span>&nbsp;<span class="op" id="5091447">!=</span>&nbsp;<span class="ident" id="5091450">nil</span>&nbsp;<span class="op" id="5091454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091458">if</span>&nbsp;<span class="ident" id="5091461">err</span>&nbsp;<span class="op" id="5091465">==</span>&nbsp;<span class="ident" id="5091468">io</span><span class="op" id="5091470">.</span><span class="ident" id="5091471">EOF</span>&nbsp;<span class="op" id="5091475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091480">err</span>&nbsp;<span class="op" id="5091484">=</span>&nbsp;<span class="ident" id="5091486">io</span><span class="op" id="5091488">.</span><span class="ident" id="5091489">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091512">return</span>&nbsp;<span class="ident" id="5091519">nil</span><span class="op" id="5091522">,</span>&nbsp;<span class="ident" id="5091524">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091532">resp</span><span class="op" id="5091536">.</span><span class="ident" id="5091537">Header</span>&nbsp;<span class="op" id="5091544">=</span>&nbsp;<span class="ident" id="5091546">Header</span><span class="op" id="5091552">(</span><span class="ident" id="5091553">mimeHeader</span><span class="op" id="5091563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091567">fixPragmaCacheControl</span><span class="op" id="5091588">(</span><span class="ident" id="5091589">resp</span><span class="op" id="5091593">.</span><span class="ident" id="5091594">Header</span><span class="op" id="5091600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091604">err</span>&nbsp;<span class="op" id="5091608">=</span>&nbsp;<span class="ident" id="5091610">readTransfer</span><span class="op" id="5091622">(</span><span class="ident" id="5091623">resp</span><span class="op" id="5091627">,</span>&nbsp;<span class="ident" id="5091629">r</span><span class="op" id="5091630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091633">if</span>&nbsp;<span class="ident" id="5091636">err</span>&nbsp;<span class="op" id="5091640">!=</span>&nbsp;<span class="ident" id="5091643">nil</span>&nbsp;<span class="op" id="5091647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091651">return</span>&nbsp;<span class="ident" id="5091658">nil</span><span class="op" id="5091661">,</span>&nbsp;<span class="ident" id="5091663">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5091668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091672">return</span>&nbsp;<span class="ident" id="5091679">resp</span><span class="op" id="5091683">,</span>&nbsp;<span class="ident" id="5091685">nil</span><br>
<span class="lineno"></span><span class="op" id="5091689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5091692">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="5091717">//&nbsp;&nbsp;&nbsp;&nbspPragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="5091737">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="5091745">//&nbsp;&nbsp;&nbsp;&nbspCache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="5091772">func</span>&nbsp;<span class="ident" id="5091777">fixPragmaCacheControl</span><span class="op" id="5091798">(</span><span class="ident" id="5091799">header</span>&nbsp;<span class="ident" id="5091806">Header</span><span class="op" id="5091812">)</span>&nbsp;<span class="op" id="5091814">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091817">if</span>&nbsp;<span class="ident" id="5091820">hp</span><span class="op" id="5091822">,</span>&nbsp;<span class="ident" id="5091824">ok</span>&nbsp;<span class="op" id="5091827">:=</span>&nbsp;<span class="ident" id="5091830">header</span><span class="op" id="5091836">[</span><span class="string" id="5091837">&#34;Pragma&#34;</span><span class="op" id="5091845">]</span><span class="op" id="5091846">;</span>&nbsp;<span class="ident" id="5091848">ok</span>&nbsp;<span class="op" id="5091851">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5091854">len</span><span class="op" id="5091857">(</span><span class="ident" id="5091858">hp</span><span class="op" id="5091860">)</span>&nbsp;<span class="op" id="5091862">&gt;</span>&nbsp;<span class="num" id="5091864">0</span>&nbsp;<span class="op" id="5091866">&amp;&amp;</span>&nbsp;<span class="ident" id="5091869">hp</span><span class="op" id="5091871">[</span><span class="num" id="5091872">0</span><span class="op" id="5091873">]</span>&nbsp;<span class="op" id="5091875">==</span>&nbsp;<span class="string" id="5091878">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="5091889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5091893">if</span>&nbsp;<span class="ident" id="5091896">_</span><span class="op" id="5091897">,</span>&nbsp;<span class="ident" id="5091899">presentcc</span>&nbsp;<span class="op" id="5091909">:=</span>&nbsp;<span class="ident" id="5091912">header</span><span class="op" id="5091918">[</span><span class="string" id="5091919">&#34;Cache-Control&#34;</span><span class="op" id="5091934">]</span><span class="op" id="5091935">;</span>&nbsp;<span class="op" id="5091937">!</span><span class="ident" id="5091938">presentcc</span>&nbsp;<span class="op" id="5091948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5091953">header</span><span class="op" id="5091959">[</span><span class="string" id="5091960">&#34;Cache-Control&#34;</span><span class="op" id="5091975">]</span>&nbsp;<span class="op" id="5091977">=</span>&nbsp;<span class="op" id="5091979">[</span><span class="op" id="5091980">]</span><span class="builtintype" id="5091981">string</span><span class="op" id="5091987">{</span><span class="string" id="5091988">&#34;no-cache&#34;</span><span class="op" id="5091998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092005">}</span><br>
<span class="lineno">180</span><span class="op" id="5092007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092010">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5092065">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="5092109">func</span>&nbsp;<span class="op" id="5092114">(</span><span class="ident" id="5092115">r</span>&nbsp;<span class="op" id="5092117">*</span><span class="ident" id="5092118">Response</span><span class="op" id="5092126">)</span>&nbsp;<span class="ident" id="5092128">ProtoAtLeast</span><span class="op" id="5092140">(</span><span class="ident" id="5092141">major</span><span class="op" id="5092146">,</span>&nbsp;<span class="ident" id="5092148">minor</span>&nbsp;<span class="builtintype" id="5092154">int</span><span class="op" id="5092157">)</span>&nbsp;<span class="builtintype" id="5092159">bool</span>&nbsp;<span class="op" id="5092164">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092167">return</span>&nbsp;<span class="ident" id="5092174">r</span><span class="op" id="5092175">.</span><span class="ident" id="5092176">ProtoMajor</span>&nbsp;<span class="op" id="5092187">&gt;</span>&nbsp;<span class="ident" id="5092189">major</span>&nbsp;<span class="op" id="5092195">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092200">r</span><span class="op" id="5092201">.</span><span class="ident" id="5092202">ProtoMajor</span>&nbsp;<span class="op" id="5092213">==</span>&nbsp;<span class="ident" id="5092216">major</span>&nbsp;<span class="op" id="5092222">&amp;&amp;</span>&nbsp;<span class="ident" id="5092225">r</span><span class="op" id="5092226">.</span><span class="ident" id="5092227">ProtoMinor</span>&nbsp;<span class="op" id="5092238">&gt;=</span>&nbsp;<span class="ident" id="5092241">minor</span><br>
<span class="lineno"></span><span class="op" id="5092247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5092250">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="5092328">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="5092378">//</span><br>
<span class="lineno"></span><span class="comment" id="5092381">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="5092396">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="5092411">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="5092426">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="5092445">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="5092466">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="5092478">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="5092487">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="5092505">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="5092580">//</span><br>
<span class="lineno"></span><span class="comment" id="5092583">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5092619">func</span>&nbsp;<span class="op" id="5092624">(</span><span class="ident" id="5092625">r</span>&nbsp;<span class="op" id="5092627">*</span><span class="ident" id="5092628">Response</span><span class="op" id="5092636">)</span>&nbsp;<span class="ident" id="5092638">Write</span><span class="op" id="5092643">(</span><span class="ident" id="5092644">w</span>&nbsp;<span class="ident" id="5092646">io</span><span class="op" id="5092648">.</span><span class="ident" id="5092649">Writer</span><span class="op" id="5092655">)</span>&nbsp;<span class="builtintype" id="5092657">error</span>&nbsp;<span class="op" id="5092663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5092666">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092682">text</span>&nbsp;<span class="op" id="5092687">:=</span>&nbsp;<span class="ident" id="5092690">r</span><span class="op" id="5092691">.</span><span class="ident" id="5092692">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092700">if</span>&nbsp;<span class="ident" id="5092703">text</span>&nbsp;<span class="op" id="5092708">==</span>&nbsp;<span class="string" id="5092711">&#34;&#34;</span>&nbsp;<span class="op" id="5092714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092718">var</span>&nbsp;<span class="ident" id="5092722">ok</span>&nbsp;<span class="builtintype" id="5092725">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092732">text</span><span class="op" id="5092736">,</span>&nbsp;<span class="ident" id="5092738">ok</span>&nbsp;<span class="op" id="5092741">=</span>&nbsp;<span class="ident" id="5092743">statusText</span><span class="op" id="5092753">[</span><span class="ident" id="5092754">r</span><span class="op" id="5092755">.</span><span class="ident" id="5092756">StatusCode</span><span class="op" id="5092766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5092770">if</span>&nbsp;<span class="op" id="5092773">!</span><span class="ident" id="5092774">ok</span>&nbsp;<span class="op" id="5092777">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092782">text</span>&nbsp;<span class="op" id="5092787">=</span>&nbsp;<span class="string" id="5092789">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="5092804">+</span>&nbsp;<span class="ident" id="5092806">strconv</span><span class="op" id="5092813">.</span><span class="ident" id="5092814">Itoa</span><span class="op" id="5092818">(</span><span class="ident" id="5092819">r</span><span class="op" id="5092820">.</span><span class="ident" id="5092821">StatusCode</span><span class="op" id="5092831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5092838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092841">protoMajor</span><span class="op" id="5092851">,</span>&nbsp;<span class="ident" id="5092853">protoMinor</span>&nbsp;<span class="op" id="5092864">:=</span>&nbsp;<span class="ident" id="5092867">strconv</span><span class="op" id="5092874">.</span><span class="ident" id="5092875">Itoa</span><span class="op" id="5092879">(</span><span class="ident" id="5092880">r</span><span class="op" id="5092881">.</span><span class="ident" id="5092882">ProtoMajor</span><span class="op" id="5092892">)</span><span class="op" id="5092893">,</span>&nbsp;<span class="ident" id="5092895">strconv</span><span class="op" id="5092902">.</span><span class="ident" id="5092903">Itoa</span><span class="op" id="5092907">(</span><span class="ident" id="5092908">r</span><span class="op" id="5092909">.</span><span class="ident" id="5092910">ProtoMinor</span><span class="op" id="5092920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092923">statusCode</span>&nbsp;<span class="op" id="5092934">:=</span>&nbsp;<span class="ident" id="5092937">strconv</span><span class="op" id="5092944">.</span><span class="ident" id="5092945">Itoa</span><span class="op" id="5092949">(</span><span class="ident" id="5092950">r</span><span class="op" id="5092951">.</span><span class="ident" id="5092952">StatusCode</span><span class="op" id="5092962">)</span>&nbsp;<span class="op" id="5092964">+</span>&nbsp;<span class="string" id="5092966">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5092971">text</span>&nbsp;<span class="op" id="5092976">=</span>&nbsp;<span class="ident" id="5092978">strings</span><span class="op" id="5092985">.</span><span class="ident" id="5092986">TrimPrefix</span><span class="op" id="5092996">(</span><span class="ident" id="5092997">text</span><span class="op" id="5093001">,</span>&nbsp;<span class="ident" id="5093003">statusCode</span><span class="op" id="5093013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093016">if</span>&nbsp;<span class="ident" id="5093019">_</span><span class="op" id="5093020">,</span>&nbsp;<span class="ident" id="5093022">err</span>&nbsp;<span class="op" id="5093026">:=</span>&nbsp;<span class="ident" id="5093029">io</span><span class="op" id="5093031">.</span><span class="ident" id="5093032">WriteString</span><span class="op" id="5093043">(</span><span class="ident" id="5093044">w</span><span class="op" id="5093045">,</span>&nbsp;<span class="string" id="5093047">&#34;HTTP/&#34;</span><span class="op" id="5093054">+</span><span class="ident" id="5093055">protoMajor</span><span class="op" id="5093065">+</span><span class="string" id="5093066">&#34;.&#34;</span><span class="op" id="5093069">+</span><span class="ident" id="5093070">protoMinor</span><span class="op" id="5093080">+</span><span class="string" id="5093081">&#34;&nbsp;&#34;</span><span class="op" id="5093084">+</span><span class="ident" id="5093085">statusCode</span><span class="op" id="5093095">+</span><span class="ident" id="5093096">text</span><span class="op" id="5093100">+</span><span class="string" id="5093101">&#34;\r\n&#34;</span><span class="op" id="5093107">)</span><span class="op" id="5093108">;</span>&nbsp;<span class="ident" id="5093110">err</span>&nbsp;<span class="op" id="5093114">!=</span>&nbsp;<span class="ident" id="5093117">nil</span>&nbsp;<span class="op" id="5093121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093125">return</span>&nbsp;<span class="ident" id="5093132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093141">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093186">r1</span>&nbsp;<span class="op" id="5093189">:=</span>&nbsp;<span class="builtinfunc" id="5093192">new</span><span class="op" id="5093195">(</span><span class="ident" id="5093196">Response</span><span class="op" id="5093204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093207">*</span><span class="ident" id="5093208">r1</span>&nbsp;<span class="op" id="5093211">=</span>&nbsp;<span class="op" id="5093213">*</span><span class="ident" id="5093214">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093217">if</span>&nbsp;<span class="ident" id="5093220">r1</span><span class="op" id="5093222">.</span><span class="ident" id="5093223">ContentLength</span>&nbsp;<span class="op" id="5093237">==</span>&nbsp;<span class="num" id="5093240">0</span>&nbsp;<span class="op" id="5093242">&amp;&amp;</span>&nbsp;<span class="ident" id="5093245">r1</span><span class="op" id="5093247">.</span><span class="ident" id="5093248">Body</span>&nbsp;<span class="op" id="5093253">!=</span>&nbsp;<span class="ident" id="5093256">nil</span>&nbsp;<span class="op" id="5093260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093264">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093311">var</span>&nbsp;<span class="ident" id="5093315">buf</span>&nbsp;<span class="op" id="5093319">[</span><span class="num" id="5093320">1</span><span class="op" id="5093321">]</span><span class="builtintype" id="5093322">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093329">n</span><span class="op" id="5093330">,</span>&nbsp;<span class="ident" id="5093332">err</span>&nbsp;<span class="op" id="5093336">:=</span>&nbsp;<span class="ident" id="5093339">r1</span><span class="op" id="5093341">.</span><span class="ident" id="5093342">Body</span><span class="op" id="5093346">.</span><span class="ident" id="5093347">Read</span><span class="op" id="5093351">(</span><span class="ident" id="5093352">buf</span><span class="op" id="5093355">[</span><span class="op" id="5093356">:</span><span class="op" id="5093357">]</span><span class="op" id="5093358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093362">if</span>&nbsp;<span class="ident" id="5093365">err</span>&nbsp;<span class="op" id="5093369">!=</span>&nbsp;<span class="ident" id="5093372">nil</span>&nbsp;<span class="op" id="5093376">&amp;&amp;</span>&nbsp;<span class="ident" id="5093379">err</span>&nbsp;<span class="op" id="5093383">!=</span>&nbsp;<span class="ident" id="5093386">io</span><span class="op" id="5093388">.</span><span class="ident" id="5093389">EOF</span>&nbsp;<span class="op" id="5093393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093398">return</span>&nbsp;<span class="ident" id="5093405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093411">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093415">if</span>&nbsp;<span class="ident" id="5093418">n</span>&nbsp;<span class="op" id="5093420">==</span>&nbsp;<span class="num" id="5093423">0</span>&nbsp;<span class="op" id="5093425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093430">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093492">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093532">r1</span><span class="op" id="5093534">.</span><span class="ident" id="5093535">Body</span>&nbsp;<span class="op" id="5093540">=</span>&nbsp;<span class="ident" id="5093542">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093554">}</span>&nbsp;<span class="keyword" id="5093556">else</span>&nbsp;<span class="op" id="5093561">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093566">r1</span><span class="op" id="5093568">.</span><span class="ident" id="5093569">ContentLength</span>&nbsp;<span class="op" id="5093583">=</span>&nbsp;<span class="op" id="5093585">-</span><span class="num" id="5093586">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093591">r1</span><span class="op" id="5093593">.</span><span class="ident" id="5093594">Body</span>&nbsp;<span class="op" id="5093599">=</span>&nbsp;<span class="keyword" id="5093601">struct</span>&nbsp;<span class="op" id="5093608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093614">io</span><span class="op" id="5093616">.</span><span class="ident" id="5093617">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093628">io</span><span class="op" id="5093630">.</span><span class="ident" id="5093631">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093641">}</span><span class="op" id="5093642">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093648">io</span><span class="op" id="5093650">.</span><span class="ident" id="5093651">MultiReader</span><span class="op" id="5093662">(</span><span class="ident" id="5093663">bytes</span><span class="op" id="5093668">.</span><span class="ident" id="5093669">NewReader</span><span class="op" id="5093678">(</span><span class="ident" id="5093679">buf</span><span class="op" id="5093682">[</span><span class="op" id="5093683">:</span><span class="num" id="5093684">1</span><span class="op" id="5093685">]</span><span class="op" id="5093686">)</span><span class="op" id="5093687">,</span>&nbsp;<span class="ident" id="5093689">r</span><span class="op" id="5093690">.</span><span class="ident" id="5093691">Body</span><span class="op" id="5093695">)</span><span class="op" id="5093696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5093702">r</span><span class="op" id="5093703">.</span><span class="ident" id="5093704">Body</span><span class="op" id="5093708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5093720">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093723">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093786">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093850">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5093913">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5093931">if</span>&nbsp;<span class="ident" id="5093934">r1</span><span class="op" id="5093936">.</span><span class="ident" id="5093937">ContentLength</span>&nbsp;<span class="op" id="5093951">==</span>&nbsp;<span class="op" id="5093954">-</span><span class="num" id="5093955">1</span>&nbsp;<span class="op" id="5093957">&amp;&amp;</span>&nbsp;<span class="op" id="5093960">!</span><span class="ident" id="5093961">r1</span><span class="op" id="5093963">.</span><span class="ident" id="5093964">Close</span>&nbsp;<span class="op" id="5093970">&amp;&amp;</span>&nbsp;<span class="ident" id="5093973">r1</span><span class="op" id="5093975">.</span><span class="ident" id="5093976">ProtoAtLeast</span><span class="op" id="5093988">(</span><span class="num" id="5093989">1</span><span class="op" id="5093990">,</span>&nbsp;<span class="num" id="5093992">1</span><span class="op" id="5093993">)</span>&nbsp;<span class="op" id="5093995">&amp;&amp;</span>&nbsp;<span class="op" id="5093998">!</span><span class="ident" id="5093999">chunked</span><span class="op" id="5094006">(</span><span class="ident" id="5094007">r1</span><span class="op" id="5094009">.</span><span class="ident" id="5094010">TransferEncoding</span><span class="op" id="5094026">)</span>&nbsp;<span class="op" id="5094028">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094032">r1</span><span class="op" id="5094034">.</span><span class="ident" id="5094035">Close</span>&nbsp;<span class="op" id="5094041">=</span>&nbsp;<span class="builtintype" id="5094043">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094053">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094098">tw</span><span class="op" id="5094100">,</span>&nbsp;<span class="ident" id="5094102">err</span>&nbsp;<span class="op" id="5094106">:=</span>&nbsp;<span class="ident" id="5094109">newTransferWriter</span><span class="op" id="5094126">(</span><span class="ident" id="5094127">r1</span><span class="op" id="5094129">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094132">if</span>&nbsp;<span class="ident" id="5094135">err</span>&nbsp;<span class="op" id="5094139">!=</span>&nbsp;<span class="ident" id="5094142">nil</span>&nbsp;<span class="op" id="5094146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094150">return</span>&nbsp;<span class="ident" id="5094157">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094165">err</span>&nbsp;<span class="op" id="5094169">=</span>&nbsp;<span class="ident" id="5094171">tw</span><span class="op" id="5094173">.</span><span class="ident" id="5094174">WriteHeader</span><span class="op" id="5094185">(</span><span class="ident" id="5094186">w</span><span class="op" id="5094187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094190">if</span>&nbsp;<span class="ident" id="5094193">err</span>&nbsp;<span class="op" id="5094197">!=</span>&nbsp;<span class="ident" id="5094200">nil</span>&nbsp;<span class="op" id="5094204">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094208">return</span>&nbsp;<span class="ident" id="5094215">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094224">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094243">err</span>&nbsp;<span class="op" id="5094247">=</span>&nbsp;<span class="ident" id="5094249">r</span><span class="op" id="5094250">.</span><span class="ident" id="5094251">Header</span><span class="op" id="5094257">.</span><span class="ident" id="5094258">WriteSubset</span><span class="op" id="5094269">(</span><span class="ident" id="5094270">w</span><span class="op" id="5094271">,</span>&nbsp;<span class="ident" id="5094273">respExcludeHeader</span><span class="op" id="5094290">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094293">if</span>&nbsp;<span class="ident" id="5094296">err</span>&nbsp;<span class="op" id="5094300">!=</span>&nbsp;<span class="ident" id="5094303">nil</span>&nbsp;<span class="op" id="5094307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094311">return</span>&nbsp;<span class="ident" id="5094318">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094327">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094387">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094447">contentLengthAlreadySent</span>&nbsp;<span class="op" id="5094472">:=</span>&nbsp;<span class="ident" id="5094475">tw</span><span class="op" id="5094477">.</span><span class="ident" id="5094478">shouldSendContentLength</span><span class="op" id="5094501">(</span><span class="op" id="5094502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094505">if</span>&nbsp;<span class="ident" id="5094508">r1</span><span class="op" id="5094510">.</span><span class="ident" id="5094511">ContentLength</span>&nbsp;<span class="op" id="5094525">==</span>&nbsp;<span class="num" id="5094528">0</span>&nbsp;<span class="op" id="5094530">&amp;&amp;</span>&nbsp;<span class="op" id="5094533">!</span><span class="ident" id="5094534">chunked</span><span class="op" id="5094541">(</span><span class="ident" id="5094542">r1</span><span class="op" id="5094544">.</span><span class="ident" id="5094545">TransferEncoding</span><span class="op" id="5094561">)</span>&nbsp;<span class="op" id="5094563">&amp;&amp;</span>&nbsp;<span class="op" id="5094566">!</span><span class="ident" id="5094567">contentLengthAlreadySent</span>&nbsp;<span class="op" id="5094592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094596">if</span>&nbsp;<span class="ident" id="5094599">_</span><span class="op" id="5094600">,</span>&nbsp;<span class="ident" id="5094602">err</span>&nbsp;<span class="op" id="5094606">:=</span>&nbsp;<span class="ident" id="5094609">io</span><span class="op" id="5094611">.</span><span class="ident" id="5094612">WriteString</span><span class="op" id="5094623">(</span><span class="ident" id="5094624">w</span><span class="op" id="5094625">,</span>&nbsp;<span class="string" id="5094627">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="5094650">)</span><span class="op" id="5094651">;</span>&nbsp;<span class="ident" id="5094653">err</span>&nbsp;<span class="op" id="5094657">!=</span>&nbsp;<span class="ident" id="5094660">nil</span>&nbsp;<span class="op" id="5094664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094669">return</span>&nbsp;<span class="ident" id="5094676">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094689">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094707">if</span>&nbsp;<span class="ident" id="5094710">_</span><span class="op" id="5094711">,</span>&nbsp;<span class="ident" id="5094713">err</span>&nbsp;<span class="op" id="5094717">:=</span>&nbsp;<span class="ident" id="5094720">io</span><span class="op" id="5094722">.</span><span class="ident" id="5094723">WriteString</span><span class="op" id="5094734">(</span><span class="ident" id="5094735">w</span><span class="op" id="5094736">,</span>&nbsp;<span class="string" id="5094738">&#34;\r\n&#34;</span><span class="op" id="5094744">)</span><span class="op" id="5094745">;</span>&nbsp;<span class="ident" id="5094747">err</span>&nbsp;<span class="op" id="5094751">!=</span>&nbsp;<span class="ident" id="5094754">nil</span>&nbsp;<span class="op" id="5094758">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094762">return</span>&nbsp;<span class="ident" id="5094769">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094778">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5094805">err</span>&nbsp;<span class="op" id="5094809">=</span>&nbsp;<span class="ident" id="5094811">tw</span><span class="op" id="5094813">.</span><span class="ident" id="5094814">WriteBody</span><span class="op" id="5094823">(</span><span class="ident" id="5094824">w</span><span class="op" id="5094825">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094828">if</span>&nbsp;<span class="ident" id="5094831">err</span>&nbsp;<span class="op" id="5094835">!=</span>&nbsp;<span class="ident" id="5094838">nil</span>&nbsp;<span class="op" id="5094842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094846">return</span>&nbsp;<span class="ident" id="5094853">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5094858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5094862">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5094874">return</span>&nbsp;<span class="ident" id="5094881">nil</span><br>
<span class="lineno"></span><span class="op" id="5094885">}</span>
</div>
</body>
</html>
