<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8521537">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8521592">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8521646">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8521697">package</span>&nbsp;<span class="ident" id="8521705">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8521710">import</span>&nbsp;<span class="op" id="8521717">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521720">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521729">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521736">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521745">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521760">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521766">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521779">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521785">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521796">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8521806">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8521809">var</span>&nbsp;<span class="ident" id="8521813">filenames</span>&nbsp;<span class="op" id="8521823">=</span>&nbsp;<span class="op" id="8521825">[</span><span class="op" id="8521826">]</span><span class="builtintype" id="8521827">string</span><span class="op" id="8521833">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521836">&#34;basn0g01&#34;</span><span class="op" id="8521846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521849">&#34;basn0g01-30&#34;</span><span class="op" id="8521862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521865">&#34;basn0g02&#34;</span><span class="op" id="8521875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521878">&#34;basn0g02-29&#34;</span><span class="op" id="8521891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521894">&#34;basn0g04&#34;</span><span class="op" id="8521904">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521907">&#34;basn0g04-31&#34;</span><span class="op" id="8521920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521923">&#34;basn0g08&#34;</span><span class="op" id="8521933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521936">&#34;basn0g16&#34;</span><span class="op" id="8521946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521949">&#34;basn2c08&#34;</span><span class="op" id="8521959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521962">&#34;basn2c16&#34;</span><span class="op" id="8521972">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521975">&#34;basn3p01&#34;</span><span class="op" id="8521985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8521988">&#34;basn3p02&#34;</span><span class="op" id="8521998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522001">&#34;basn3p04&#34;</span><span class="op" id="8522011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522014">&#34;basn3p04-31i&#34;</span><span class="op" id="8522028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522031">&#34;basn3p08&#34;</span><span class="op" id="8522041">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522044">&#34;basn3p08-trns&#34;</span><span class="op" id="8522059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522062">&#34;basn4a08&#34;</span><span class="op" id="8522072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522075">&#34;basn4a16&#34;</span><span class="op" id="8522085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522088">&#34;basn6a08&#34;</span><span class="op" id="8522098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522101">&#34;basn6a16&#34;</span><span class="op" id="8522111">,</span><br>
<span class="lineno">40</span><span class="op" id="8522113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8522116">var</span>&nbsp;<span class="ident" id="8522120">filenamesPaletted</span>&nbsp;<span class="op" id="8522138">=</span>&nbsp;<span class="op" id="8522140">[</span><span class="op" id="8522141">]</span><span class="builtintype" id="8522142">string</span><span class="op" id="8522148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522151">&#34;basn3p01&#34;</span><span class="op" id="8522161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522164">&#34;basn3p02&#34;</span><span class="op" id="8522174">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522177">&#34;basn3p04&#34;</span><span class="op" id="8522187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522190">&#34;basn3p08&#34;</span><span class="op" id="8522200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522203">&#34;basn3p08-trns&#34;</span><span class="op" id="8522218">,</span><br>
<span class="lineno"></span><span class="op" id="8522220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8522223">var</span>&nbsp;<span class="ident" id="8522227">filenamesShort</span>&nbsp;<span class="op" id="8522242">=</span>&nbsp;<span class="op" id="8522244">[</span><span class="op" id="8522245">]</span><span class="builtintype" id="8522246">string</span><span class="op" id="8522252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522255">&#34;basn0g01&#34;</span><span class="op" id="8522265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522268">&#34;basn0g04-31&#34;</span><span class="op" id="8522281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8522284">&#34;basn6a16&#34;</span><span class="op" id="8522294">,</span><br>
<span class="lineno"></span><span class="op" id="8522296">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8522299">func</span>&nbsp;<span class="ident" id="8522304">readPNG</span><span class="op" id="8522311">(</span><span class="ident" id="8522312">filename</span>&nbsp;<span class="builtintype" id="8522321">string</span><span class="op" id="8522327">)</span>&nbsp;<span class="op" id="8522329">(</span><span class="ident" id="8522330">image</span><span class="op" id="8522335">.</span><span class="ident" id="8522336">Image</span><span class="op" id="8522341">,</span>&nbsp;<span class="builtintype" id="8522343">error</span><span class="op" id="8522348">)</span>&nbsp;<span class="op" id="8522350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522353">f</span><span class="op" id="8522354">,</span>&nbsp;<span class="ident" id="8522356">err</span>&nbsp;<span class="op" id="8522360">:=</span>&nbsp;<span class="ident" id="8522363">os</span><span class="op" id="8522365">.</span><span class="ident" id="8522366">Open</span><span class="op" id="8522370">(</span><span class="ident" id="8522371">filename</span><span class="op" id="8522379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522382">if</span>&nbsp;<span class="ident" id="8522385">err</span>&nbsp;<span class="op" id="8522389">!=</span>&nbsp;<span class="builtintype" id="8522392">nil</span>&nbsp;<span class="op" id="8522396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522400">return</span>&nbsp;<span class="builtintype" id="8522407">nil</span><span class="op" id="8522410">,</span>&nbsp;<span class="ident" id="8522412">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522420">defer</span>&nbsp;<span class="ident" id="8522426">f</span><span class="op" id="8522427">.</span><span class="ident" id="8522428">Close</span><span class="op" id="8522433">(</span><span class="op" id="8522434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522437">return</span>&nbsp;<span class="ident" id="8522444">Decode</span><span class="op" id="8522450">(</span><span class="ident" id="8522451">f</span><span class="op" id="8522452">)</span><br>
<span class="lineno"></span><span class="op" id="8522454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="8522457">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="8522507">func</span>&nbsp;<span class="ident" id="8522512">sng</span><span class="op" id="8522515">(</span><span class="ident" id="8522516">w</span>&nbsp;<span class="ident" id="8522518">io</span><span class="op" id="8522520">.</span><span class="ident" id="8522521">WriteCloser</span><span class="op" id="8522532">,</span>&nbsp;<span class="ident" id="8522534">filename</span>&nbsp;<span class="builtintype" id="8522543">string</span><span class="op" id="8522549">,</span>&nbsp;<span class="ident" id="8522551">png</span>&nbsp;<span class="ident" id="8522555">image</span><span class="op" id="8522560">.</span><span class="ident" id="8522561">Image</span><span class="op" id="8522566">)</span>&nbsp;<span class="op" id="8522568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522571">defer</span>&nbsp;<span class="ident" id="8522577">w</span><span class="op" id="8522578">.</span><span class="ident" id="8522579">Close</span><span class="op" id="8522584">(</span><span class="op" id="8522585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522588">bounds</span>&nbsp;<span class="op" id="8522595">:=</span>&nbsp;<span class="ident" id="8522598">png</span><span class="op" id="8522601">.</span><span class="ident" id="8522602">Bounds</span><span class="op" id="8522608">(</span><span class="op" id="8522609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522612">cm</span>&nbsp;<span class="op" id="8522615">:=</span>&nbsp;<span class="ident" id="8522618">png</span><span class="op" id="8522621">.</span><span class="ident" id="8522622">ColorModel</span><span class="op" id="8522632">(</span><span class="op" id="8522633">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522636">var</span>&nbsp;<span class="ident" id="8522640">bitdepth</span>&nbsp;<span class="builtintype" id="8522649">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522654">switch</span>&nbsp;<span class="ident" id="8522661">cm</span>&nbsp;<span class="op" id="8522664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522667">case</span>&nbsp;<span class="ident" id="8522672">color</span><span class="op" id="8522677">.</span><span class="ident" id="8522678">RGBAModel</span><span class="op" id="8522687">,</span>&nbsp;<span class="ident" id="8522689">color</span><span class="op" id="8522694">.</span><span class="ident" id="8522695">NRGBAModel</span><span class="op" id="8522705">,</span>&nbsp;<span class="ident" id="8522707">color</span><span class="op" id="8522712">.</span><span class="ident" id="8522713">AlphaModel</span><span class="op" id="8522723">,</span>&nbsp;<span class="ident" id="8522725">color</span><span class="op" id="8522730">.</span><span class="ident" id="8522731">GrayModel</span><span class="op" id="8522740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522744">bitdepth</span>&nbsp;<span class="op" id="8522753">=</span>&nbsp;<span class="num" id="8522755">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522758">default</span><span class="op" id="8522765">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522769">bitdepth</span>&nbsp;<span class="op" id="8522778">=</span>&nbsp;<span class="num" id="8522780">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8522784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522787">cpm</span><span class="op" id="8522790">,</span>&nbsp;<span class="ident" id="8522792">_</span>&nbsp;<span class="op" id="8522794">:=</span>&nbsp;<span class="ident" id="8522797">cm</span><span class="op" id="8522799">.</span><span class="op" id="8522800">(</span><span class="ident" id="8522801">color</span><span class="op" id="8522806">.</span><span class="ident" id="8522807">Palette</span><span class="op" id="8522814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522817">var</span>&nbsp;<span class="ident" id="8522821">paletted</span>&nbsp;<span class="op" id="8522830">*</span><span class="ident" id="8522831">image</span><span class="op" id="8522836">.</span><span class="ident" id="8522837">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522847">if</span>&nbsp;<span class="ident" id="8522850">cpm</span>&nbsp;<span class="op" id="8522854">!=</span>&nbsp;<span class="builtintype" id="8522857">nil</span>&nbsp;<span class="op" id="8522861">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522865">switch</span>&nbsp;<span class="op" id="8522872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522876">case</span>&nbsp;<span class="builtinfunc" id="8522881">len</span><span class="op" id="8522884">(</span><span class="ident" id="8522885">cpm</span><span class="op" id="8522888">)</span>&nbsp;<span class="op" id="8522890">&lt;=</span>&nbsp;<span class="num" id="8522893">2</span><span class="op" id="8522894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522899">bitdepth</span>&nbsp;<span class="op" id="8522908">=</span>&nbsp;<span class="num" id="8522910">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522914">case</span>&nbsp;<span class="builtinfunc" id="8522919">len</span><span class="op" id="8522922">(</span><span class="ident" id="8522923">cpm</span><span class="op" id="8522926">)</span>&nbsp;<span class="op" id="8522928">&lt;=</span>&nbsp;<span class="num" id="8522931">4</span><span class="op" id="8522932">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522937">bitdepth</span>&nbsp;<span class="op" id="8522946">=</span>&nbsp;<span class="num" id="8522948">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522952">case</span>&nbsp;<span class="builtinfunc" id="8522957">len</span><span class="op" id="8522960">(</span><span class="ident" id="8522961">cpm</span><span class="op" id="8522964">)</span>&nbsp;<span class="op" id="8522966">&lt;=</span>&nbsp;<span class="num" id="8522969">16</span><span class="op" id="8522971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8522976">bitdepth</span>&nbsp;<span class="op" id="8522985">=</span>&nbsp;<span class="num" id="8522987">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8522991">default</span><span class="op" id="8522998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523003">bitdepth</span>&nbsp;<span class="op" id="8523012">=</span>&nbsp;<span class="num" id="8523014">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523018">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523022">paletted</span>&nbsp;<span class="op" id="8523031">=</span>&nbsp;<span class="ident" id="8523033">png</span><span class="op" id="8523036">.</span><span class="op" id="8523037">(</span><span class="op" id="8523038">*</span><span class="ident" id="8523039">image</span><span class="op" id="8523044">.</span><span class="ident" id="8523045">Paletted</span><span class="op" id="8523053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8523060">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523093">io</span><span class="op" id="8523095">.</span><span class="ident" id="8523096">WriteString</span><span class="op" id="8523107">(</span><span class="ident" id="8523108">w</span><span class="op" id="8523109">,</span>&nbsp;<span class="string" id="8523111">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="8523124">+</span><span class="ident" id="8523125">filename</span><span class="op" id="8523133">+</span><span class="string" id="8523134">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="8523150">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523153">fmt</span><span class="op" id="8523156">.</span><span class="ident" id="8523157">Fprintf</span><span class="op" id="8523164">(</span><span class="ident" id="8523165">w</span><span class="op" id="8523166">,</span>&nbsp;<span class="string" id="8523168">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="8523212">,</span>&nbsp;<span class="ident" id="8523214">bounds</span><span class="op" id="8523220">.</span><span class="ident" id="8523221">Dx</span><span class="op" id="8523223">(</span><span class="op" id="8523224">)</span><span class="op" id="8523225">,</span>&nbsp;<span class="ident" id="8523227">bounds</span><span class="op" id="8523233">.</span><span class="ident" id="8523234">Dy</span><span class="op" id="8523236">(</span><span class="op" id="8523237">)</span><span class="op" id="8523238">,</span>&nbsp;<span class="ident" id="8523240">bitdepth</span><span class="op" id="8523248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523251">switch</span>&nbsp;<span class="op" id="8523258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523261">case</span>&nbsp;<span class="ident" id="8523266">cm</span>&nbsp;<span class="op" id="8523269">==</span>&nbsp;<span class="ident" id="8523272">color</span><span class="op" id="8523277">.</span><span class="ident" id="8523278">RGBAModel</span><span class="op" id="8523287">,</span>&nbsp;<span class="ident" id="8523289">cm</span>&nbsp;<span class="op" id="8523292">==</span>&nbsp;<span class="ident" id="8523295">color</span><span class="op" id="8523300">.</span><span class="ident" id="8523301">RGBA64Model</span><span class="op" id="8523312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523316">io</span><span class="op" id="8523318">.</span><span class="ident" id="8523319">WriteString</span><span class="op" id="8523330">(</span><span class="ident" id="8523331">w</span><span class="op" id="8523332">,</span>&nbsp;<span class="string" id="8523334">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="8523354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523357">case</span>&nbsp;<span class="ident" id="8523362">cm</span>&nbsp;<span class="op" id="8523365">==</span>&nbsp;<span class="ident" id="8523368">color</span><span class="op" id="8523373">.</span><span class="ident" id="8523374">NRGBAModel</span><span class="op" id="8523384">,</span>&nbsp;<span class="ident" id="8523386">cm</span>&nbsp;<span class="op" id="8523389">==</span>&nbsp;<span class="ident" id="8523392">color</span><span class="op" id="8523397">.</span><span class="ident" id="8523398">NRGBA64Model</span><span class="op" id="8523410">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523414">io</span><span class="op" id="8523416">.</span><span class="ident" id="8523417">WriteString</span><span class="op" id="8523428">(</span><span class="ident" id="8523429">w</span><span class="op" id="8523430">,</span>&nbsp;<span class="string" id="8523432">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="8523458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523461">case</span>&nbsp;<span class="ident" id="8523466">cm</span>&nbsp;<span class="op" id="8523469">==</span>&nbsp;<span class="ident" id="8523472">color</span><span class="op" id="8523477">.</span><span class="ident" id="8523478">GrayModel</span><span class="op" id="8523487">,</span>&nbsp;<span class="ident" id="8523489">cm</span>&nbsp;<span class="op" id="8523492">==</span>&nbsp;<span class="ident" id="8523495">color</span><span class="op" id="8523500">.</span><span class="ident" id="8523501">Gray16Model</span><span class="op" id="8523512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523516">io</span><span class="op" id="8523518">.</span><span class="ident" id="8523519">WriteString</span><span class="op" id="8523530">(</span><span class="ident" id="8523531">w</span><span class="op" id="8523532">,</span>&nbsp;<span class="string" id="8523534">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="8523558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523561">case</span>&nbsp;<span class="ident" id="8523566">cpm</span>&nbsp;<span class="op" id="8523570">!=</span>&nbsp;<span class="builtintype" id="8523573">nil</span><span class="op" id="8523576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523580">io</span><span class="op" id="8523582">.</span><span class="ident" id="8523583">WriteString</span><span class="op" id="8523594">(</span><span class="ident" id="8523595">w</span><span class="op" id="8523596">,</span>&nbsp;<span class="string" id="8523598">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="8523626">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523629">default</span><span class="op" id="8523636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523640">io</span><span class="op" id="8523642">.</span><span class="ident" id="8523643">WriteString</span><span class="op" id="8523654">(</span><span class="ident" id="8523655">w</span><span class="op" id="8523656">,</span>&nbsp;<span class="string" id="8523658">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="8523693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8523696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523699">io</span><span class="op" id="8523701">.</span><span class="ident" id="8523702">WriteString</span><span class="op" id="8523713">(</span><span class="ident" id="8523714">w</span><span class="op" id="8523715">,</span>&nbsp;<span class="string" id="8523717">&#34;}\n&#34;</span><span class="op" id="8523722">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8523726">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8523819">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8523904">io</span><span class="op" id="8523906">.</span><span class="ident" id="8523907">WriteString</span><span class="op" id="8523918">(</span><span class="ident" id="8523919">w</span><span class="op" id="8523920">,</span>&nbsp;<span class="string" id="8523922">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="8523939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8523943">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8523988">if</span>&nbsp;<span class="ident" id="8523991">cpm</span>&nbsp;<span class="op" id="8523995">!=</span>&nbsp;<span class="builtintype" id="8523998">nil</span>&nbsp;<span class="op" id="8524002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524006">lastAlpha</span>&nbsp;<span class="op" id="8524016">:=</span>&nbsp;<span class="op" id="8524019">-</span><span class="num" id="8524020">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524024">io</span><span class="op" id="8524026">.</span><span class="ident" id="8524027">WriteString</span><span class="op" id="8524038">(</span><span class="ident" id="8524039">w</span><span class="op" id="8524040">,</span>&nbsp;<span class="string" id="8524042">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="8524052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524056">for</span>&nbsp;<span class="ident" id="8524060">i</span><span class="op" id="8524061">,</span>&nbsp;<span class="ident" id="8524063">c</span>&nbsp;<span class="op" id="8524065">:=</span>&nbsp;<span class="keyword" id="8524068">range</span>&nbsp;<span class="ident" id="8524074">cpm</span>&nbsp;<span class="op" id="8524078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524083">var</span>&nbsp;<span class="ident" id="8524087">r</span><span class="op" id="8524088">,</span>&nbsp;<span class="ident" id="8524090">g</span><span class="op" id="8524091">,</span>&nbsp;<span class="ident" id="8524093">b</span><span class="op" id="8524094">,</span>&nbsp;<span class="ident" id="8524096">a</span>&nbsp;<span class="builtintype" id="8524098">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524107">switch</span>&nbsp;<span class="ident" id="8524114">c</span>&nbsp;<span class="op" id="8524116">:=</span>&nbsp;<span class="ident" id="8524119">c</span><span class="op" id="8524120">.</span><span class="op" id="8524121">(</span><span class="keyword" id="8524122">type</span><span class="op" id="8524126">)</span>&nbsp;<span class="op" id="8524128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524133">case</span>&nbsp;<span class="ident" id="8524138">color</span><span class="op" id="8524143">.</span><span class="ident" id="8524144">RGBA</span><span class="op" id="8524148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524154">r</span><span class="op" id="8524155">,</span>&nbsp;<span class="ident" id="8524157">g</span><span class="op" id="8524158">,</span>&nbsp;<span class="ident" id="8524160">b</span><span class="op" id="8524161">,</span>&nbsp;<span class="ident" id="8524163">a</span>&nbsp;<span class="op" id="8524165">=</span>&nbsp;<span class="ident" id="8524167">c</span><span class="op" id="8524168">.</span><span class="ident" id="8524169">R</span><span class="op" id="8524170">,</span>&nbsp;<span class="ident" id="8524172">c</span><span class="op" id="8524173">.</span><span class="ident" id="8524174">G</span><span class="op" id="8524175">,</span>&nbsp;<span class="ident" id="8524177">c</span><span class="op" id="8524178">.</span><span class="ident" id="8524179">B</span><span class="op" id="8524180">,</span>&nbsp;<span class="num" id="8524182">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524190">case</span>&nbsp;<span class="ident" id="8524195">color</span><span class="op" id="8524200">.</span><span class="ident" id="8524201">NRGBA</span><span class="op" id="8524206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524212">r</span><span class="op" id="8524213">,</span>&nbsp;<span class="ident" id="8524215">g</span><span class="op" id="8524216">,</span>&nbsp;<span class="ident" id="8524218">b</span><span class="op" id="8524219">,</span>&nbsp;<span class="ident" id="8524221">a</span>&nbsp;<span class="op" id="8524223">=</span>&nbsp;<span class="ident" id="8524225">c</span><span class="op" id="8524226">.</span><span class="ident" id="8524227">R</span><span class="op" id="8524228">,</span>&nbsp;<span class="ident" id="8524230">c</span><span class="op" id="8524231">.</span><span class="ident" id="8524232">G</span><span class="op" id="8524233">,</span>&nbsp;<span class="ident" id="8524235">c</span><span class="op" id="8524236">.</span><span class="ident" id="8524237">B</span><span class="op" id="8524238">,</span>&nbsp;<span class="ident" id="8524240">c</span><span class="op" id="8524241">.</span><span class="ident" id="8524242">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524247">default</span><span class="op" id="8524254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8524260">panic</span><span class="op" id="8524265">(</span><span class="string" id="8524266">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="8524294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524304">if</span>&nbsp;<span class="ident" id="8524307">a</span>&nbsp;<span class="op" id="8524309">!=</span>&nbsp;<span class="num" id="8524312">0xff</span>&nbsp;<span class="op" id="8524317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524323">lastAlpha</span>&nbsp;<span class="op" id="8524333">=</span>&nbsp;<span class="ident" id="8524335">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524345">fmt</span><span class="op" id="8524348">.</span><span class="ident" id="8524349">Fprintf</span><span class="op" id="8524356">(</span><span class="ident" id="8524357">w</span><span class="op" id="8524358">,</span>&nbsp;<span class="string" id="8524360">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="8524416">,</span>&nbsp;<span class="ident" id="8524418">r</span><span class="op" id="8524419">,</span>&nbsp;<span class="ident" id="8524421">g</span><span class="op" id="8524422">,</span>&nbsp;<span class="ident" id="8524424">b</span><span class="op" id="8524425">,</span>&nbsp;<span class="ident" id="8524427">r</span><span class="op" id="8524428">,</span>&nbsp;<span class="ident" id="8524430">g</span><span class="op" id="8524431">,</span>&nbsp;<span class="ident" id="8524433">b</span><span class="op" id="8524434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524442">io</span><span class="op" id="8524444">.</span><span class="ident" id="8524445">WriteString</span><span class="op" id="8524456">(</span><span class="ident" id="8524457">w</span><span class="op" id="8524458">,</span>&nbsp;<span class="string" id="8524460">&#34;}\n&#34;</span><span class="op" id="8524465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524469">if</span>&nbsp;<span class="ident" id="8524472">lastAlpha</span>&nbsp;<span class="op" id="8524482">!=</span>&nbsp;<span class="op" id="8524485">-</span><span class="num" id="8524486">1</span>&nbsp;<span class="op" id="8524488">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524493">io</span><span class="op" id="8524495">.</span><span class="ident" id="8524496">WriteString</span><span class="op" id="8524507">(</span><span class="ident" id="8524508">w</span><span class="op" id="8524509">,</span>&nbsp;<span class="string" id="8524511">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="8524521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524526">for</span>&nbsp;<span class="ident" id="8524530">i</span>&nbsp;<span class="op" id="8524532">:=</span>&nbsp;<span class="num" id="8524535">0</span><span class="op" id="8524536">;</span>&nbsp;<span class="ident" id="8524538">i</span>&nbsp;<span class="op" id="8524540">&lt;=</span>&nbsp;<span class="ident" id="8524543">lastAlpha</span><span class="op" id="8524552">;</span>&nbsp;<span class="ident" id="8524554">i</span><span class="op" id="8524555">++</span>&nbsp;<span class="op" id="8524558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524564">_</span><span class="op" id="8524565">,</span>&nbsp;<span class="ident" id="8524567">_</span><span class="op" id="8524568">,</span>&nbsp;<span class="ident" id="8524570">_</span><span class="op" id="8524571">,</span>&nbsp;<span class="ident" id="8524573">a</span>&nbsp;<span class="op" id="8524575">:=</span>&nbsp;<span class="ident" id="8524578">cpm</span><span class="op" id="8524581">[</span><span class="ident" id="8524582">i</span><span class="op" id="8524583">]</span><span class="op" id="8524584">.</span><span class="ident" id="8524585">RGBA</span><span class="op" id="8524589">(</span><span class="op" id="8524590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524596">a</span>&nbsp;<span class="op" id="8524598">&gt;&gt;=</span>&nbsp;<span class="num" id="8524602">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524608">fmt</span><span class="op" id="8524611">.</span><span class="ident" id="8524612">Fprintf</span><span class="op" id="8524619">(</span><span class="ident" id="8524620">w</span><span class="op" id="8524621">,</span>&nbsp;<span class="string" id="8524623">&#34;&nbsp;%d&#34;</span><span class="op" id="8524628">,</span>&nbsp;<span class="ident" id="8524630">a</span><span class="op" id="8524631">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524641">io</span><span class="op" id="8524643">.</span><span class="ident" id="8524644">WriteString</span><span class="op" id="8524655">(</span><span class="ident" id="8524656">w</span><span class="op" id="8524657">,</span>&nbsp;<span class="string" id="8524659">&#34;}\n&#34;</span><span class="op" id="8524664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8524675">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524696">io</span><span class="op" id="8524698">.</span><span class="ident" id="8524699">WriteString</span><span class="op" id="8524710">(</span><span class="ident" id="8524711">w</span><span class="op" id="8524712">,</span>&nbsp;<span class="string" id="8524714">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="8524741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524744">for</span>&nbsp;<span class="ident" id="8524748">y</span>&nbsp;<span class="op" id="8524750">:=</span>&nbsp;<span class="ident" id="8524753">bounds</span><span class="op" id="8524759">.</span><span class="ident" id="8524760">Min</span><span class="op" id="8524763">.</span><span class="ident" id="8524764">Y</span><span class="op" id="8524765">;</span>&nbsp;<span class="ident" id="8524767">y</span>&nbsp;<span class="op" id="8524769">&lt;</span>&nbsp;<span class="ident" id="8524771">bounds</span><span class="op" id="8524777">.</span><span class="ident" id="8524778">Max</span><span class="op" id="8524781">.</span><span class="ident" id="8524782">Y</span><span class="op" id="8524783">;</span>&nbsp;<span class="ident" id="8524785">y</span><span class="op" id="8524786">++</span>&nbsp;<span class="op" id="8524789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524793">switch</span>&nbsp;<span class="op" id="8524800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524804">case</span>&nbsp;<span class="ident" id="8524809">cm</span>&nbsp;<span class="op" id="8524812">==</span>&nbsp;<span class="ident" id="8524815">color</span><span class="op" id="8524820">.</span><span class="ident" id="8524821">GrayModel</span><span class="op" id="8524830">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524835">for</span>&nbsp;<span class="ident" id="8524839">x</span>&nbsp;<span class="op" id="8524841">:=</span>&nbsp;<span class="ident" id="8524844">bounds</span><span class="op" id="8524850">.</span><span class="ident" id="8524851">Min</span><span class="op" id="8524854">.</span><span class="ident" id="8524855">X</span><span class="op" id="8524856">;</span>&nbsp;<span class="ident" id="8524858">x</span>&nbsp;<span class="op" id="8524860">&lt;</span>&nbsp;<span class="ident" id="8524862">bounds</span><span class="op" id="8524868">.</span><span class="ident" id="8524869">Max</span><span class="op" id="8524872">.</span><span class="ident" id="8524873">X</span><span class="op" id="8524874">;</span>&nbsp;<span class="ident" id="8524876">x</span><span class="op" id="8524877">++</span>&nbsp;<span class="op" id="8524880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524886">gray</span>&nbsp;<span class="op" id="8524891">:=</span>&nbsp;<span class="ident" id="8524894">png</span><span class="op" id="8524897">.</span><span class="ident" id="8524898">At</span><span class="op" id="8524900">(</span><span class="ident" id="8524901">x</span><span class="op" id="8524902">,</span>&nbsp;<span class="ident" id="8524904">y</span><span class="op" id="8524905">)</span><span class="op" id="8524906">.</span><span class="op" id="8524907">(</span><span class="ident" id="8524908">color</span><span class="op" id="8524913">.</span><span class="ident" id="8524914">Gray</span><span class="op" id="8524918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8524924">fmt</span><span class="op" id="8524927">.</span><span class="ident" id="8524928">Fprintf</span><span class="op" id="8524935">(</span><span class="ident" id="8524936">w</span><span class="op" id="8524937">,</span>&nbsp;<span class="string" id="8524939">&#34;%02x&#34;</span><span class="op" id="8524945">,</span>&nbsp;<span class="ident" id="8524947">gray</span><span class="op" id="8524951">.</span><span class="ident" id="8524952">Y</span><span class="op" id="8524953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8524958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524962">case</span>&nbsp;<span class="ident" id="8524967">cm</span>&nbsp;<span class="op" id="8524970">==</span>&nbsp;<span class="ident" id="8524973">color</span><span class="op" id="8524978">.</span><span class="ident" id="8524979">Gray16Model</span><span class="op" id="8524990">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8524995">for</span>&nbsp;<span class="ident" id="8524999">x</span>&nbsp;<span class="op" id="8525001">:=</span>&nbsp;<span class="ident" id="8525004">bounds</span><span class="op" id="8525010">.</span><span class="ident" id="8525011">Min</span><span class="op" id="8525014">.</span><span class="ident" id="8525015">X</span><span class="op" id="8525016">;</span>&nbsp;<span class="ident" id="8525018">x</span>&nbsp;<span class="op" id="8525020">&lt;</span>&nbsp;<span class="ident" id="8525022">bounds</span><span class="op" id="8525028">.</span><span class="ident" id="8525029">Max</span><span class="op" id="8525032">.</span><span class="ident" id="8525033">X</span><span class="op" id="8525034">;</span>&nbsp;<span class="ident" id="8525036">x</span><span class="op" id="8525037">++</span>&nbsp;<span class="op" id="8525040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525046">gray16</span>&nbsp;<span class="op" id="8525053">:=</span>&nbsp;<span class="ident" id="8525056">png</span><span class="op" id="8525059">.</span><span class="ident" id="8525060">At</span><span class="op" id="8525062">(</span><span class="ident" id="8525063">x</span><span class="op" id="8525064">,</span>&nbsp;<span class="ident" id="8525066">y</span><span class="op" id="8525067">)</span><span class="op" id="8525068">.</span><span class="op" id="8525069">(</span><span class="ident" id="8525070">color</span><span class="op" id="8525075">.</span><span class="ident" id="8525076">Gray16</span><span class="op" id="8525082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525088">fmt</span><span class="op" id="8525091">.</span><span class="ident" id="8525092">Fprintf</span><span class="op" id="8525099">(</span><span class="ident" id="8525100">w</span><span class="op" id="8525101">,</span>&nbsp;<span class="string" id="8525103">&#34;%04x&nbsp;&#34;</span><span class="op" id="8525110">,</span>&nbsp;<span class="ident" id="8525112">gray16</span><span class="op" id="8525118">.</span><span class="ident" id="8525119">Y</span><span class="op" id="8525120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525129">case</span>&nbsp;<span class="ident" id="8525134">cm</span>&nbsp;<span class="op" id="8525137">==</span>&nbsp;<span class="ident" id="8525140">color</span><span class="op" id="8525145">.</span><span class="ident" id="8525146">RGBAModel</span><span class="op" id="8525155">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525160">for</span>&nbsp;<span class="ident" id="8525164">x</span>&nbsp;<span class="op" id="8525166">:=</span>&nbsp;<span class="ident" id="8525169">bounds</span><span class="op" id="8525175">.</span><span class="ident" id="8525176">Min</span><span class="op" id="8525179">.</span><span class="ident" id="8525180">X</span><span class="op" id="8525181">;</span>&nbsp;<span class="ident" id="8525183">x</span>&nbsp;<span class="op" id="8525185">&lt;</span>&nbsp;<span class="ident" id="8525187">bounds</span><span class="op" id="8525193">.</span><span class="ident" id="8525194">Max</span><span class="op" id="8525197">.</span><span class="ident" id="8525198">X</span><span class="op" id="8525199">;</span>&nbsp;<span class="ident" id="8525201">x</span><span class="op" id="8525202">++</span>&nbsp;<span class="op" id="8525205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525211">rgba</span>&nbsp;<span class="op" id="8525216">:=</span>&nbsp;<span class="ident" id="8525219">png</span><span class="op" id="8525222">.</span><span class="ident" id="8525223">At</span><span class="op" id="8525225">(</span><span class="ident" id="8525226">x</span><span class="op" id="8525227">,</span>&nbsp;<span class="ident" id="8525229">y</span><span class="op" id="8525230">)</span><span class="op" id="8525231">.</span><span class="op" id="8525232">(</span><span class="ident" id="8525233">color</span><span class="op" id="8525238">.</span><span class="ident" id="8525239">RGBA</span><span class="op" id="8525243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525249">fmt</span><span class="op" id="8525252">.</span><span class="ident" id="8525253">Fprintf</span><span class="op" id="8525260">(</span><span class="ident" id="8525261">w</span><span class="op" id="8525262">,</span>&nbsp;<span class="string" id="8525264">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8525279">,</span>&nbsp;<span class="ident" id="8525281">rgba</span><span class="op" id="8525285">.</span><span class="ident" id="8525286">R</span><span class="op" id="8525287">,</span>&nbsp;<span class="ident" id="8525289">rgba</span><span class="op" id="8525293">.</span><span class="ident" id="8525294">G</span><span class="op" id="8525295">,</span>&nbsp;<span class="ident" id="8525297">rgba</span><span class="op" id="8525301">.</span><span class="ident" id="8525302">B</span><span class="op" id="8525303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525312">case</span>&nbsp;<span class="ident" id="8525317">cm</span>&nbsp;<span class="op" id="8525320">==</span>&nbsp;<span class="ident" id="8525323">color</span><span class="op" id="8525328">.</span><span class="ident" id="8525329">RGBA64Model</span><span class="op" id="8525340">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525345">for</span>&nbsp;<span class="ident" id="8525349">x</span>&nbsp;<span class="op" id="8525351">:=</span>&nbsp;<span class="ident" id="8525354">bounds</span><span class="op" id="8525360">.</span><span class="ident" id="8525361">Min</span><span class="op" id="8525364">.</span><span class="ident" id="8525365">X</span><span class="op" id="8525366">;</span>&nbsp;<span class="ident" id="8525368">x</span>&nbsp;<span class="op" id="8525370">&lt;</span>&nbsp;<span class="ident" id="8525372">bounds</span><span class="op" id="8525378">.</span><span class="ident" id="8525379">Max</span><span class="op" id="8525382">.</span><span class="ident" id="8525383">X</span><span class="op" id="8525384">;</span>&nbsp;<span class="ident" id="8525386">x</span><span class="op" id="8525387">++</span>&nbsp;<span class="op" id="8525390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525396">rgba64</span>&nbsp;<span class="op" id="8525403">:=</span>&nbsp;<span class="ident" id="8525406">png</span><span class="op" id="8525409">.</span><span class="ident" id="8525410">At</span><span class="op" id="8525412">(</span><span class="ident" id="8525413">x</span><span class="op" id="8525414">,</span>&nbsp;<span class="ident" id="8525416">y</span><span class="op" id="8525417">)</span><span class="op" id="8525418">.</span><span class="op" id="8525419">(</span><span class="ident" id="8525420">color</span><span class="op" id="8525425">.</span><span class="ident" id="8525426">RGBA64</span><span class="op" id="8525432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525438">fmt</span><span class="op" id="8525441">.</span><span class="ident" id="8525442">Fprintf</span><span class="op" id="8525449">(</span><span class="ident" id="8525450">w</span><span class="op" id="8525451">,</span>&nbsp;<span class="string" id="8525453">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8525468">,</span>&nbsp;<span class="ident" id="8525470">rgba64</span><span class="op" id="8525476">.</span><span class="ident" id="8525477">R</span><span class="op" id="8525478">,</span>&nbsp;<span class="ident" id="8525480">rgba64</span><span class="op" id="8525486">.</span><span class="ident" id="8525487">G</span><span class="op" id="8525488">,</span>&nbsp;<span class="ident" id="8525490">rgba64</span><span class="op" id="8525496">.</span><span class="ident" id="8525497">B</span><span class="op" id="8525498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525507">case</span>&nbsp;<span class="ident" id="8525512">cm</span>&nbsp;<span class="op" id="8525515">==</span>&nbsp;<span class="ident" id="8525518">color</span><span class="op" id="8525523">.</span><span class="ident" id="8525524">NRGBAModel</span><span class="op" id="8525534">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525539">for</span>&nbsp;<span class="ident" id="8525543">x</span>&nbsp;<span class="op" id="8525545">:=</span>&nbsp;<span class="ident" id="8525548">bounds</span><span class="op" id="8525554">.</span><span class="ident" id="8525555">Min</span><span class="op" id="8525558">.</span><span class="ident" id="8525559">X</span><span class="op" id="8525560">;</span>&nbsp;<span class="ident" id="8525562">x</span>&nbsp;<span class="op" id="8525564">&lt;</span>&nbsp;<span class="ident" id="8525566">bounds</span><span class="op" id="8525572">.</span><span class="ident" id="8525573">Max</span><span class="op" id="8525576">.</span><span class="ident" id="8525577">X</span><span class="op" id="8525578">;</span>&nbsp;<span class="ident" id="8525580">x</span><span class="op" id="8525581">++</span>&nbsp;<span class="op" id="8525584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525590">nrgba</span>&nbsp;<span class="op" id="8525596">:=</span>&nbsp;<span class="ident" id="8525599">png</span><span class="op" id="8525602">.</span><span class="ident" id="8525603">At</span><span class="op" id="8525605">(</span><span class="ident" id="8525606">x</span><span class="op" id="8525607">,</span>&nbsp;<span class="ident" id="8525609">y</span><span class="op" id="8525610">)</span><span class="op" id="8525611">.</span><span class="op" id="8525612">(</span><span class="ident" id="8525613">color</span><span class="op" id="8525618">.</span><span class="ident" id="8525619">NRGBA</span><span class="op" id="8525624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525630">fmt</span><span class="op" id="8525633">.</span><span class="ident" id="8525634">Fprintf</span><span class="op" id="8525641">(</span><span class="ident" id="8525642">w</span><span class="op" id="8525643">,</span>&nbsp;<span class="string" id="8525645">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="8525664">,</span>&nbsp;<span class="ident" id="8525666">nrgba</span><span class="op" id="8525671">.</span><span class="ident" id="8525672">R</span><span class="op" id="8525673">,</span>&nbsp;<span class="ident" id="8525675">nrgba</span><span class="op" id="8525680">.</span><span class="ident" id="8525681">G</span><span class="op" id="8525682">,</span>&nbsp;<span class="ident" id="8525684">nrgba</span><span class="op" id="8525689">.</span><span class="ident" id="8525690">B</span><span class="op" id="8525691">,</span>&nbsp;<span class="ident" id="8525693">nrgba</span><span class="op" id="8525698">.</span><span class="ident" id="8525699">A</span><span class="op" id="8525700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525709">case</span>&nbsp;<span class="ident" id="8525714">cm</span>&nbsp;<span class="op" id="8525717">==</span>&nbsp;<span class="ident" id="8525720">color</span><span class="op" id="8525725">.</span><span class="ident" id="8525726">NRGBA64Model</span><span class="op" id="8525738">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525743">for</span>&nbsp;<span class="ident" id="8525747">x</span>&nbsp;<span class="op" id="8525749">:=</span>&nbsp;<span class="ident" id="8525752">bounds</span><span class="op" id="8525758">.</span><span class="ident" id="8525759">Min</span><span class="op" id="8525762">.</span><span class="ident" id="8525763">X</span><span class="op" id="8525764">;</span>&nbsp;<span class="ident" id="8525766">x</span>&nbsp;<span class="op" id="8525768">&lt;</span>&nbsp;<span class="ident" id="8525770">bounds</span><span class="op" id="8525776">.</span><span class="ident" id="8525777">Max</span><span class="op" id="8525780">.</span><span class="ident" id="8525781">X</span><span class="op" id="8525782">;</span>&nbsp;<span class="ident" id="8525784">x</span><span class="op" id="8525785">++</span>&nbsp;<span class="op" id="8525788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525794">nrgba64</span>&nbsp;<span class="op" id="8525802">:=</span>&nbsp;<span class="ident" id="8525805">png</span><span class="op" id="8525808">.</span><span class="ident" id="8525809">At</span><span class="op" id="8525811">(</span><span class="ident" id="8525812">x</span><span class="op" id="8525813">,</span>&nbsp;<span class="ident" id="8525815">y</span><span class="op" id="8525816">)</span><span class="op" id="8525817">.</span><span class="op" id="8525818">(</span><span class="ident" id="8525819">color</span><span class="op" id="8525824">.</span><span class="ident" id="8525825">NRGBA64</span><span class="op" id="8525832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8525838">fmt</span><span class="op" id="8525841">.</span><span class="ident" id="8525842">Fprintf</span><span class="op" id="8525849">(</span><span class="ident" id="8525850">w</span><span class="op" id="8525851">,</span>&nbsp;<span class="string" id="8525853">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="8525872">,</span>&nbsp;<span class="ident" id="8525874">nrgba64</span><span class="op" id="8525881">.</span><span class="ident" id="8525882">R</span><span class="op" id="8525883">,</span>&nbsp;<span class="ident" id="8525885">nrgba64</span><span class="op" id="8525892">.</span><span class="ident" id="8525893">G</span><span class="op" id="8525894">,</span>&nbsp;<span class="ident" id="8525896">nrgba64</span><span class="op" id="8525903">.</span><span class="ident" id="8525904">B</span><span class="op" id="8525905">,</span>&nbsp;<span class="ident" id="8525907">nrgba64</span><span class="op" id="8525914">.</span><span class="ident" id="8525915">A</span><span class="op" id="8525916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8525921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525925">case</span>&nbsp;<span class="ident" id="8525930">cpm</span>&nbsp;<span class="op" id="8525934">!=</span>&nbsp;<span class="builtintype" id="8525937">nil</span><span class="op" id="8525940">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525945">var</span>&nbsp;<span class="ident" id="8525949">b</span><span class="op" id="8525950">,</span>&nbsp;<span class="ident" id="8525952">c</span>&nbsp;<span class="builtintype" id="8525954">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8525961">for</span>&nbsp;<span class="ident" id="8525965">x</span>&nbsp;<span class="op" id="8525967">:=</span>&nbsp;<span class="ident" id="8525970">bounds</span><span class="op" id="8525976">.</span><span class="ident" id="8525977">Min</span><span class="op" id="8525980">.</span><span class="ident" id="8525981">X</span><span class="op" id="8525982">;</span>&nbsp;<span class="ident" id="8525984">x</span>&nbsp;<span class="op" id="8525986">&lt;</span>&nbsp;<span class="ident" id="8525988">bounds</span><span class="op" id="8525994">.</span><span class="ident" id="8525995">Max</span><span class="op" id="8525998">.</span><span class="ident" id="8525999">X</span><span class="op" id="8526000">;</span>&nbsp;<span class="ident" id="8526002">x</span><span class="op" id="8526003">++</span>&nbsp;<span class="op" id="8526006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526012">b</span>&nbsp;<span class="op" id="8526014">=</span>&nbsp;<span class="ident" id="8526016">b</span><span class="op" id="8526017">&lt;&lt;</span><span class="builtintype" id="8526019">uint</span><span class="op" id="8526023">(</span><span class="ident" id="8526024">bitdepth</span><span class="op" id="8526032">)</span>&nbsp;<span class="op" id="8526034">|</span>&nbsp;<span class="builtintype" id="8526036">int</span><span class="op" id="8526039">(</span><span class="ident" id="8526040">paletted</span><span class="op" id="8526048">.</span><span class="ident" id="8526049">ColorIndexAt</span><span class="op" id="8526061">(</span><span class="ident" id="8526062">x</span><span class="op" id="8526063">,</span>&nbsp;<span class="ident" id="8526065">y</span><span class="op" id="8526066">)</span><span class="op" id="8526067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526073">c</span><span class="op" id="8526074">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526081">if</span>&nbsp;<span class="ident" id="8526084">c</span>&nbsp;<span class="op" id="8526086">==</span>&nbsp;<span class="num" id="8526089">8</span><span class="op" id="8526090">/</span><span class="ident" id="8526091">bitdepth</span>&nbsp;<span class="op" id="8526100">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526107">fmt</span><span class="op" id="8526110">.</span><span class="ident" id="8526111">Fprintf</span><span class="op" id="8526118">(</span><span class="ident" id="8526119">w</span><span class="op" id="8526120">,</span>&nbsp;<span class="string" id="8526122">&#34;%02x&#34;</span><span class="op" id="8526128">,</span>&nbsp;<span class="ident" id="8526130">b</span><span class="op" id="8526131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526138">b</span>&nbsp;<span class="op" id="8526140">=</span>&nbsp;<span class="num" id="8526142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526149">c</span>&nbsp;<span class="op" id="8526151">=</span>&nbsp;<span class="num" id="8526153">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526164">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526169">if</span>&nbsp;<span class="ident" id="8526172">c</span>&nbsp;<span class="op" id="8526174">!=</span>&nbsp;<span class="num" id="8526177">0</span>&nbsp;<span class="op" id="8526179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526185">for</span>&nbsp;<span class="ident" id="8526189">c</span>&nbsp;<span class="op" id="8526191">!=</span>&nbsp;<span class="num" id="8526194">8</span><span class="op" id="8526195">/</span><span class="ident" id="8526196">bitdepth</span>&nbsp;<span class="op" id="8526205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526212">b</span>&nbsp;<span class="op" id="8526214">=</span>&nbsp;<span class="ident" id="8526216">b</span>&nbsp;<span class="op" id="8526218">&lt;&lt;</span>&nbsp;<span class="builtintype" id="8526221">uint</span><span class="op" id="8526225">(</span><span class="ident" id="8526226">bitdepth</span><span class="op" id="8526234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526241">c</span><span class="op" id="8526242">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526249">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526255">fmt</span><span class="op" id="8526258">.</span><span class="ident" id="8526259">Fprintf</span><span class="op" id="8526266">(</span><span class="ident" id="8526267">w</span><span class="op" id="8526268">,</span>&nbsp;<span class="string" id="8526270">&#34;%02x&#34;</span><span class="op" id="8526276">,</span>&nbsp;<span class="ident" id="8526278">b</span><span class="op" id="8526279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526292">io</span><span class="op" id="8526294">.</span><span class="ident" id="8526295">WriteString</span><span class="op" id="8526306">(</span><span class="ident" id="8526307">w</span><span class="op" id="8526308">,</span>&nbsp;<span class="string" id="8526310">&#34;\n&#34;</span><span class="op" id="8526314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526317">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526320">io</span><span class="op" id="8526322">.</span><span class="ident" id="8526323">WriteString</span><span class="op" id="8526334">(</span><span class="ident" id="8526335">w</span><span class="op" id="8526336">,</span>&nbsp;<span class="string" id="8526338">&#34;}\n&#34;</span><span class="op" id="8526343">)</span><br>
<span class="lineno"></span><span class="op" id="8526345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8526348">func</span>&nbsp;<span class="ident" id="8526353">TestReader</span><span class="op" id="8526363">(</span><span class="ident" id="8526364">t</span>&nbsp;<span class="op" id="8526366">*</span><span class="ident" id="8526367">testing</span><span class="op" id="8526374">.</span><span class="ident" id="8526375">T</span><span class="op" id="8526376">)</span>&nbsp;<span class="op" id="8526378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526381">names</span>&nbsp;<span class="op" id="8526387">:=</span>&nbsp;<span class="ident" id="8526390">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526401">if</span>&nbsp;<span class="ident" id="8526404">testing</span><span class="op" id="8526411">.</span><span class="ident" id="8526412">Short</span><span class="op" id="8526417">(</span><span class="op" id="8526418">)</span>&nbsp;<span class="op" id="8526420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526424">names</span>&nbsp;<span class="op" id="8526430">=</span>&nbsp;<span class="ident" id="8526432">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526451">for</span>&nbsp;<span class="ident" id="8526455">_</span><span class="op" id="8526456">,</span>&nbsp;<span class="ident" id="8526458">fn</span>&nbsp;<span class="op" id="8526461">:=</span>&nbsp;<span class="keyword" id="8526464">range</span>&nbsp;<span class="ident" id="8526470">names</span>&nbsp;<span class="op" id="8526476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8526480">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526505">img</span><span class="op" id="8526508">,</span>&nbsp;<span class="ident" id="8526510">err</span>&nbsp;<span class="op" id="8526514">:=</span>&nbsp;<span class="ident" id="8526517">readPNG</span><span class="op" id="8526524">(</span><span class="string" id="8526525">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8526546">+</span>&nbsp;<span class="ident" id="8526548">fn</span>&nbsp;<span class="op" id="8526551">+</span>&nbsp;<span class="string" id="8526553">&#34;.png&#34;</span><span class="op" id="8526559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526563">if</span>&nbsp;<span class="ident" id="8526566">err</span>&nbsp;<span class="op" id="8526570">!=</span>&nbsp;<span class="builtintype" id="8526573">nil</span>&nbsp;<span class="op" id="8526577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526582">t</span><span class="op" id="8526583">.</span><span class="ident" id="8526584">Error</span><span class="op" id="8526589">(</span><span class="ident" id="8526590">fn</span><span class="op" id="8526592">,</span>&nbsp;<span class="ident" id="8526594">err</span><span class="op" id="8526597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526613">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526618">if</span>&nbsp;<span class="ident" id="8526621">fn</span>&nbsp;<span class="op" id="8526624">==</span>&nbsp;<span class="string" id="8526627">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="8526638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8526643">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8526720">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526766">c</span>&nbsp;<span class="op" id="8526768">:=</span>&nbsp;<span class="ident" id="8526771">img</span><span class="op" id="8526774">.</span><span class="ident" id="8526775">At</span><span class="op" id="8526777">(</span><span class="num" id="8526778">2</span><span class="op" id="8526779">,</span>&nbsp;<span class="num" id="8526781">1</span><span class="op" id="8526782">)</span><span class="op" id="8526783">.</span><span class="op" id="8526784">(</span><span class="ident" id="8526785">color</span><span class="op" id="8526790">.</span><span class="ident" id="8526791">NRGBA64</span><span class="op" id="8526798">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526803">if</span>&nbsp;<span class="ident" id="8526806">c</span><span class="op" id="8526807">.</span><span class="ident" id="8526808">R</span>&nbsp;<span class="op" id="8526810">!=</span>&nbsp;<span class="num" id="8526813">0x11a7</span>&nbsp;<span class="op" id="8526820">||</span>&nbsp;<span class="ident" id="8526823">c</span><span class="op" id="8526824">.</span><span class="ident" id="8526825">G</span>&nbsp;<span class="op" id="8526827">!=</span>&nbsp;<span class="num" id="8526830">0x11a7</span>&nbsp;<span class="op" id="8526837">||</span>&nbsp;<span class="ident" id="8526840">c</span><span class="op" id="8526841">.</span><span class="ident" id="8526842">B</span>&nbsp;<span class="op" id="8526844">!=</span>&nbsp;<span class="num" id="8526847">0x11a7</span>&nbsp;<span class="op" id="8526854">||</span>&nbsp;<span class="ident" id="8526857">c</span><span class="op" id="8526858">.</span><span class="ident" id="8526859">A</span>&nbsp;<span class="op" id="8526861">!=</span>&nbsp;<span class="num" id="8526864">0x1085</span>&nbsp;<span class="op" id="8526871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526877">t</span><span class="op" id="8526878">.</span><span class="ident" id="8526879">Error</span><span class="op" id="8526884">(</span><span class="ident" id="8526885">fn</span><span class="op" id="8526887">,</span>&nbsp;<span class="ident" id="8526889">fmt</span><span class="op" id="8526892">.</span><span class="ident" id="8526893">Errorf</span><span class="op" id="8526899">(</span><span class="string" id="8526900">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="8526933">,</span>&nbsp;<span class="ident" id="8526935">c</span><span class="op" id="8526936">)</span><span class="op" id="8526937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8526947">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8526958">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526963">piper</span><span class="op" id="8526968">,</span>&nbsp;<span class="ident" id="8526970">pipew</span>&nbsp;<span class="op" id="8526976">:=</span>&nbsp;<span class="ident" id="8526979">io</span><span class="op" id="8526981">.</span><span class="ident" id="8526982">Pipe</span><span class="op" id="8526986">(</span><span class="op" id="8526987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8526991">pb</span>&nbsp;<span class="op" id="8526994">:=</span>&nbsp;<span class="ident" id="8526997">bufio</span><span class="op" id="8527002">.</span><span class="ident" id="8527003">NewScanner</span><span class="op" id="8527013">(</span><span class="ident" id="8527014">piper</span><span class="op" id="8527019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527023">go</span>&nbsp;<span class="ident" id="8527026">sng</span><span class="op" id="8527029">(</span><span class="ident" id="8527030">pipew</span><span class="op" id="8527035">,</span>&nbsp;<span class="ident" id="8527037">fn</span><span class="op" id="8527039">,</span>&nbsp;<span class="ident" id="8527041">img</span><span class="op" id="8527044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527048">defer</span>&nbsp;<span class="ident" id="8527054">piper</span><span class="op" id="8527059">.</span><span class="ident" id="8527060">Close</span><span class="op" id="8527065">(</span><span class="op" id="8527066">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8527071">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527096">sf</span><span class="op" id="8527098">,</span>&nbsp;<span class="ident" id="8527100">err</span>&nbsp;<span class="op" id="8527104">:=</span>&nbsp;<span class="ident" id="8527107">os</span><span class="op" id="8527109">.</span><span class="ident" id="8527110">Open</span><span class="op" id="8527114">(</span><span class="string" id="8527115">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8527136">+</span>&nbsp;<span class="ident" id="8527138">fn</span>&nbsp;<span class="op" id="8527141">+</span>&nbsp;<span class="string" id="8527143">&#34;.sng&#34;</span><span class="op" id="8527149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527153">if</span>&nbsp;<span class="ident" id="8527156">err</span>&nbsp;<span class="op" id="8527160">!=</span>&nbsp;<span class="builtintype" id="8527163">nil</span>&nbsp;<span class="op" id="8527167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527172">t</span><span class="op" id="8527173">.</span><span class="ident" id="8527174">Error</span><span class="op" id="8527179">(</span><span class="ident" id="8527180">fn</span><span class="op" id="8527182">,</span>&nbsp;<span class="ident" id="8527184">err</span><span class="op" id="8527187">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527207">defer</span>&nbsp;<span class="ident" id="8527213">sf</span><span class="op" id="8527215">.</span><span class="ident" id="8527216">Close</span><span class="op" id="8527221">(</span><span class="op" id="8527222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527226">sb</span>&nbsp;<span class="op" id="8527229">:=</span>&nbsp;<span class="ident" id="8527232">bufio</span><span class="op" id="8527237">.</span><span class="ident" id="8527238">NewScanner</span><span class="op" id="8527248">(</span><span class="ident" id="8527249">sf</span><span class="op" id="8527251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527255">if</span>&nbsp;<span class="ident" id="8527258">err</span>&nbsp;<span class="op" id="8527262">!=</span>&nbsp;<span class="builtintype" id="8527265">nil</span>&nbsp;<span class="op" id="8527269">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527274">t</span><span class="op" id="8527275">.</span><span class="ident" id="8527276">Error</span><span class="op" id="8527281">(</span><span class="ident" id="8527282">fn</span><span class="op" id="8527284">,</span>&nbsp;<span class="ident" id="8527286">err</span><span class="op" id="8527289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527294">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8527310">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527361">for</span>&nbsp;<span class="op" id="8527365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527370">pdone</span>&nbsp;<span class="op" id="8527376">:=</span>&nbsp;<span class="op" id="8527379">!</span><span class="ident" id="8527380">pb</span><span class="op" id="8527382">.</span><span class="ident" id="8527383">Scan</span><span class="op" id="8527387">(</span><span class="op" id="8527388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527393">sdone</span>&nbsp;<span class="op" id="8527399">:=</span>&nbsp;<span class="op" id="8527402">!</span><span class="ident" id="8527403">sb</span><span class="op" id="8527405">.</span><span class="ident" id="8527406">Scan</span><span class="op" id="8527410">(</span><span class="op" id="8527411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527416">if</span>&nbsp;<span class="ident" id="8527419">pdone</span>&nbsp;<span class="op" id="8527425">&amp;&amp;</span>&nbsp;<span class="ident" id="8527428">sdone</span>&nbsp;<span class="op" id="8527434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527440">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527454">if</span>&nbsp;<span class="ident" id="8527457">pdone</span>&nbsp;<span class="op" id="8527463">||</span>&nbsp;<span class="ident" id="8527466">sdone</span>&nbsp;<span class="op" id="8527472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527478">t</span><span class="op" id="8527479">.</span><span class="ident" id="8527480">Errorf</span><span class="op" id="8527486">(</span><span class="string" id="8527487">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="8527508">,</span>&nbsp;<span class="ident" id="8527510">fn</span><span class="op" id="8527512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527518">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527527">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527532">ps</span>&nbsp;<span class="op" id="8527535">:=</span>&nbsp;<span class="ident" id="8527538">pb</span><span class="op" id="8527540">.</span><span class="ident" id="8527541">Text</span><span class="op" id="8527545">(</span><span class="op" id="8527546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527551">ss</span>&nbsp;<span class="op" id="8527554">:=</span>&nbsp;<span class="ident" id="8527557">sb</span><span class="op" id="8527559">.</span><span class="ident" id="8527560">Text</span><span class="op" id="8527564">(</span><span class="op" id="8527565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527570">if</span>&nbsp;<span class="ident" id="8527573">ps</span>&nbsp;<span class="op" id="8527576">!=</span>&nbsp;<span class="ident" id="8527579">ss</span>&nbsp;<span class="op" id="8527582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527588">t</span><span class="op" id="8527589">.</span><span class="ident" id="8527590">Errorf</span><span class="op" id="8527596">(</span><span class="string" id="8527597">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="8527627">,</span>&nbsp;<span class="ident" id="8527629">fn</span><span class="op" id="8527631">,</span>&nbsp;<span class="ident" id="8527633">ps</span><span class="op" id="8527635">,</span>&nbsp;<span class="ident" id="8527637">ss</span><span class="op" id="8527639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527645">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527662">if</span>&nbsp;<span class="ident" id="8527665">pb</span><span class="op" id="8527667">.</span><span class="ident" id="8527668">Err</span><span class="op" id="8527671">(</span><span class="op" id="8527672">)</span>&nbsp;<span class="op" id="8527674">!=</span>&nbsp;<span class="builtintype" id="8527677">nil</span>&nbsp;<span class="op" id="8527681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527686">t</span><span class="op" id="8527687">.</span><span class="ident" id="8527688">Error</span><span class="op" id="8527693">(</span><span class="ident" id="8527694">fn</span><span class="op" id="8527696">,</span>&nbsp;<span class="ident" id="8527698">pb</span><span class="op" id="8527700">.</span><span class="ident" id="8527701">Err</span><span class="op" id="8527704">(</span><span class="op" id="8527705">)</span><span class="op" id="8527706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527710">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8527714">if</span>&nbsp;<span class="ident" id="8527717">sb</span><span class="op" id="8527719">.</span><span class="ident" id="8527720">Err</span><span class="op" id="8527723">(</span><span class="op" id="8527724">)</span>&nbsp;<span class="op" id="8527726">!=</span>&nbsp;<span class="builtintype" id="8527729">nil</span>&nbsp;<span class="op" id="8527733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527738">t</span><span class="op" id="8527739">.</span><span class="ident" id="8527740">Error</span><span class="op" id="8527745">(</span><span class="ident" id="8527746">fn</span><span class="op" id="8527748">,</span>&nbsp;<span class="ident" id="8527750">sb</span><span class="op" id="8527752">.</span><span class="ident" id="8527753">Err</span><span class="op" id="8527756">(</span><span class="op" id="8527757">)</span><span class="op" id="8527758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527765">}</span><br>
<span class="lineno"></span><span class="op" id="8527767">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8527770">var</span>&nbsp;<span class="ident" id="8527774">readerErrors</span>&nbsp;<span class="op" id="8527787">=</span>&nbsp;<span class="op" id="8527789">[</span><span class="op" id="8527790">]</span><span class="keyword" id="8527791">struct</span>&nbsp;<span class="op" id="8527798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527801">file</span>&nbsp;<span class="builtintype" id="8527806">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8527814">err</span>&nbsp;&nbsp;<span class="builtintype" id="8527819">string</span><br>
<span class="lineno"></span><span class="op" id="8527826">}</span><span class="op" id="8527827">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527830">{</span><span class="string" id="8527831">&#34;invalid-zlib.png&#34;</span><span class="op" id="8527849">,</span>&nbsp;<span class="string" id="8527851">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="8527875">}</span><span class="op" id="8527876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527879">{</span><span class="string" id="8527880">&#34;invalid-crc32.png&#34;</span><span class="op" id="8527899">,</span>&nbsp;<span class="string" id="8527901">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="8527919">}</span><span class="op" id="8527920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527923">{</span><span class="string" id="8527924">&#34;invalid-noend.png&#34;</span><span class="op" id="8527943">,</span>&nbsp;<span class="string" id="8527945">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8527961">}</span><span class="op" id="8527962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8527965">{</span><span class="string" id="8527966">&#34;invalid-trunc.png&#34;</span><span class="op" id="8527985">,</span>&nbsp;<span class="string" id="8527987">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="8528003">}</span><span class="op" id="8528004">,</span><br>
<span class="lineno"></span><span class="op" id="8528006">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8528009">func</span>&nbsp;<span class="ident" id="8528014">TestReaderError</span><span class="op" id="8528029">(</span><span class="ident" id="8528030">t</span>&nbsp;<span class="op" id="8528032">*</span><span class="ident" id="8528033">testing</span><span class="op" id="8528040">.</span><span class="ident" id="8528041">T</span><span class="op" id="8528042">)</span>&nbsp;<span class="op" id="8528044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528047">for</span>&nbsp;<span class="ident" id="8528051">_</span><span class="op" id="8528052">,</span>&nbsp;<span class="ident" id="8528054">tt</span>&nbsp;<span class="op" id="8528057">:=</span>&nbsp;<span class="keyword" id="8528060">range</span>&nbsp;<span class="ident" id="8528066">readerErrors</span>&nbsp;<span class="op" id="8528079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528083">img</span><span class="op" id="8528086">,</span>&nbsp;<span class="ident" id="8528088">err</span>&nbsp;<span class="op" id="8528092">:=</span>&nbsp;<span class="ident" id="8528095">readPNG</span><span class="op" id="8528102">(</span><span class="string" id="8528103">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="8528115">+</span>&nbsp;<span class="ident" id="8528117">tt</span><span class="op" id="8528119">.</span><span class="ident" id="8528120">file</span><span class="op" id="8528124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528128">if</span>&nbsp;<span class="ident" id="8528131">err</span>&nbsp;<span class="op" id="8528135">==</span>&nbsp;<span class="builtintype" id="8528138">nil</span>&nbsp;<span class="op" id="8528142">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528147">t</span><span class="op" id="8528148">.</span><span class="ident" id="8528149">Errorf</span><span class="op" id="8528155">(</span><span class="string" id="8528156">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="8528184">,</span>&nbsp;<span class="ident" id="8528186">tt</span><span class="op" id="8528188">.</span><span class="ident" id="8528189">file</span><span class="op" id="8528193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528198">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528213">if</span>&nbsp;<span class="op" id="8528216">!</span><span class="ident" id="8528217">strings</span><span class="op" id="8528224">.</span><span class="ident" id="8528225">Contains</span><span class="op" id="8528233">(</span><span class="ident" id="8528234">err</span><span class="op" id="8528237">.</span><span class="ident" id="8528238">Error</span><span class="op" id="8528243">(</span><span class="op" id="8528244">)</span><span class="op" id="8528245">,</span>&nbsp;<span class="ident" id="8528247">tt</span><span class="op" id="8528249">.</span><span class="ident" id="8528250">err</span><span class="op" id="8528253">)</span>&nbsp;<span class="op" id="8528255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528260">t</span><span class="op" id="8528261">.</span><span class="ident" id="8528262">Errorf</span><span class="op" id="8528268">(</span><span class="string" id="8528269">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8528295">,</span>&nbsp;<span class="ident" id="8528297">tt</span><span class="op" id="8528299">.</span><span class="ident" id="8528300">file</span><span class="op" id="8528304">,</span>&nbsp;<span class="ident" id="8528306">err</span><span class="op" id="8528309">,</span>&nbsp;<span class="ident" id="8528311">tt</span><span class="op" id="8528313">.</span><span class="ident" id="8528314">err</span><span class="op" id="8528317">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528325">if</span>&nbsp;<span class="ident" id="8528328">img</span>&nbsp;<span class="op" id="8528332">!=</span>&nbsp;<span class="builtintype" id="8528335">nil</span>&nbsp;<span class="op" id="8528339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528344">t</span><span class="op" id="8528345">.</span><span class="ident" id="8528346">Errorf</span><span class="op" id="8528352">(</span><span class="string" id="8528353">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="8528386">,</span>&nbsp;<span class="ident" id="8528388">tt</span><span class="op" id="8528390">.</span><span class="ident" id="8528391">file</span><span class="op" id="8528395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528402">}</span><br>
<span class="lineno">295</span><span class="op" id="8528404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8528407">func</span>&nbsp;<span class="ident" id="8528412">TestPalettedDecodeConfig</span><span class="op" id="8528436">(</span><span class="ident" id="8528437">t</span>&nbsp;<span class="op" id="8528439">*</span><span class="ident" id="8528440">testing</span><span class="op" id="8528447">.</span><span class="ident" id="8528448">T</span><span class="op" id="8528449">)</span>&nbsp;<span class="op" id="8528451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528454">for</span>&nbsp;<span class="ident" id="8528458">_</span><span class="op" id="8528459">,</span>&nbsp;<span class="ident" id="8528461">fn</span>&nbsp;<span class="op" id="8528464">:=</span>&nbsp;<span class="keyword" id="8528467">range</span>&nbsp;<span class="ident" id="8528473">filenamesPaletted</span>&nbsp;<span class="op" id="8528491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528495">f</span><span class="op" id="8528496">,</span>&nbsp;<span class="ident" id="8528498">err</span>&nbsp;<span class="op" id="8528502">:=</span>&nbsp;<span class="ident" id="8528505">os</span><span class="op" id="8528507">.</span><span class="ident" id="8528508">Open</span><span class="op" id="8528512">(</span><span class="string" id="8528513">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8528534">+</span>&nbsp;<span class="ident" id="8528536">fn</span>&nbsp;<span class="op" id="8528539">+</span>&nbsp;<span class="string" id="8528541">&#34;.png&#34;</span><span class="op" id="8528547">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528551">if</span>&nbsp;<span class="ident" id="8528554">err</span>&nbsp;<span class="op" id="8528558">!=</span>&nbsp;<span class="builtintype" id="8528561">nil</span>&nbsp;<span class="op" id="8528565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528570">t</span><span class="op" id="8528571">.</span><span class="ident" id="8528572">Errorf</span><span class="op" id="8528578">(</span><span class="string" id="8528579">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8528600">,</span>&nbsp;<span class="ident" id="8528602">fn</span><span class="op" id="8528604">,</span>&nbsp;<span class="ident" id="8528606">err</span><span class="op" id="8528609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528614">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528629">defer</span>&nbsp;<span class="ident" id="8528635">f</span><span class="op" id="8528636">.</span><span class="ident" id="8528637">Close</span><span class="op" id="8528642">(</span><span class="op" id="8528643">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528647">cfg</span><span class="op" id="8528650">,</span>&nbsp;<span class="ident" id="8528652">err</span>&nbsp;<span class="op" id="8528656">:=</span>&nbsp;<span class="ident" id="8528659">DecodeConfig</span><span class="op" id="8528671">(</span><span class="ident" id="8528672">f</span><span class="op" id="8528673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528677">if</span>&nbsp;<span class="ident" id="8528680">err</span>&nbsp;<span class="op" id="8528684">!=</span>&nbsp;<span class="builtintype" id="8528687">nil</span>&nbsp;<span class="op" id="8528691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528696">t</span><span class="op" id="8528697">.</span><span class="ident" id="8528698">Errorf</span><span class="op" id="8528704">(</span><span class="string" id="8528705">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="8528713">,</span>&nbsp;<span class="ident" id="8528715">fn</span><span class="op" id="8528717">,</span>&nbsp;<span class="ident" id="8528719">err</span><span class="op" id="8528722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528727">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528738">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528742">pal</span><span class="op" id="8528745">,</span>&nbsp;<span class="ident" id="8528747">ok</span>&nbsp;<span class="op" id="8528750">:=</span>&nbsp;<span class="ident" id="8528753">cfg</span><span class="op" id="8528756">.</span><span class="ident" id="8528757">ColorModel</span><span class="op" id="8528767">.</span><span class="op" id="8528768">(</span><span class="ident" id="8528769">color</span><span class="op" id="8528774">.</span><span class="ident" id="8528775">Palette</span><span class="op" id="8528782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528786">if</span>&nbsp;<span class="op" id="8528789">!</span><span class="ident" id="8528790">ok</span>&nbsp;<span class="op" id="8528793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528798">t</span><span class="op" id="8528799">.</span><span class="ident" id="8528800">Errorf</span><span class="op" id="8528806">(</span><span class="string" id="8528807">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="8528842">,</span>&nbsp;<span class="ident" id="8528844">fn</span><span class="op" id="8528846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528851">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528862">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528866">if</span>&nbsp;<span class="ident" id="8528869">pal</span>&nbsp;<span class="op" id="8528873">==</span>&nbsp;<span class="builtintype" id="8528876">nil</span>&nbsp;<span class="op" id="8528880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8528885">t</span><span class="op" id="8528886">.</span><span class="ident" id="8528887">Errorf</span><span class="op" id="8528893">(</span><span class="string" id="8528894">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="8528923">,</span>&nbsp;<span class="ident" id="8528925">fn</span><span class="op" id="8528927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8528932">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8528946">}</span><br>
<span class="lineno">320</span><span class="op" id="8528948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8528951">func</span>&nbsp;<span class="ident" id="8528956">benchmarkDecode</span><span class="op" id="8528971">(</span><span class="ident" id="8528972">b</span>&nbsp;<span class="op" id="8528974">*</span><span class="ident" id="8528975">testing</span><span class="op" id="8528982">.</span><span class="ident" id="8528983">B</span><span class="op" id="8528984">,</span>&nbsp;<span class="ident" id="8528986">filename</span>&nbsp;<span class="builtintype" id="8528995">string</span><span class="op" id="8529001">,</span>&nbsp;<span class="ident" id="8529003">bytesPerPixel</span>&nbsp;<span class="builtintype" id="8529017">int</span><span class="op" id="8529020">)</span>&nbsp;<span class="op" id="8529022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529025">b</span><span class="op" id="8529026">.</span><span class="ident" id="8529027">StopTimer</span><span class="op" id="8529036">(</span><span class="op" id="8529037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529040">data</span><span class="op" id="8529044">,</span>&nbsp;<span class="ident" id="8529046">err</span>&nbsp;<span class="op" id="8529050">:=</span>&nbsp;<span class="ident" id="8529053">ioutil</span><span class="op" id="8529059">.</span><span class="ident" id="8529060">ReadFile</span><span class="op" id="8529068">(</span><span class="ident" id="8529069">filename</span><span class="op" id="8529077">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8529080">if</span>&nbsp;<span class="ident" id="8529083">err</span>&nbsp;<span class="op" id="8529087">!=</span>&nbsp;<span class="builtintype" id="8529090">nil</span>&nbsp;<span class="op" id="8529094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529098">b</span><span class="op" id="8529099">.</span><span class="ident" id="8529100">Fatal</span><span class="op" id="8529105">(</span><span class="ident" id="8529106">err</span><span class="op" id="8529109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8529112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529115">s</span>&nbsp;<span class="op" id="8529117">:=</span>&nbsp;<span class="builtintype" id="8529120">string</span><span class="op" id="8529126">(</span><span class="ident" id="8529127">data</span><span class="op" id="8529131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529134">cfg</span><span class="op" id="8529137">,</span>&nbsp;<span class="ident" id="8529139">err</span>&nbsp;<span class="op" id="8529143">:=</span>&nbsp;<span class="ident" id="8529146">DecodeConfig</span><span class="op" id="8529158">(</span><span class="ident" id="8529159">strings</span><span class="op" id="8529166">.</span><span class="ident" id="8529167">NewReader</span><span class="op" id="8529176">(</span><span class="ident" id="8529177">s</span><span class="op" id="8529178">)</span><span class="op" id="8529179">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8529182">if</span>&nbsp;<span class="ident" id="8529185">err</span>&nbsp;<span class="op" id="8529189">!=</span>&nbsp;<span class="builtintype" id="8529192">nil</span>&nbsp;<span class="op" id="8529196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529200">b</span><span class="op" id="8529201">.</span><span class="ident" id="8529202">Fatal</span><span class="op" id="8529207">(</span><span class="ident" id="8529208">err</span><span class="op" id="8529211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8529214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529217">b</span><span class="op" id="8529218">.</span><span class="ident" id="8529219">SetBytes</span><span class="op" id="8529227">(</span><span class="ident" id="8529228">int64</span><span class="op" id="8529233">(</span><span class="ident" id="8529234">cfg</span><span class="op" id="8529237">.</span><span class="ident" id="8529238">Width</span>&nbsp;<span class="op" id="8529244">*</span>&nbsp;<span class="ident" id="8529246">cfg</span><span class="op" id="8529249">.</span><span class="ident" id="8529250">Height</span>&nbsp;<span class="op" id="8529257">*</span>&nbsp;<span class="ident" id="8529259">bytesPerPixel</span><span class="op" id="8529272">)</span><span class="op" id="8529273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529276">b</span><span class="op" id="8529277">.</span><span class="ident" id="8529278">StartTimer</span><span class="op" id="8529288">(</span><span class="op" id="8529289">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8529292">for</span>&nbsp;<span class="ident" id="8529296">i</span>&nbsp;<span class="op" id="8529298">:=</span>&nbsp;<span class="num" id="8529301">0</span><span class="op" id="8529302">;</span>&nbsp;<span class="ident" id="8529304">i</span>&nbsp;<span class="op" id="8529306">&lt;</span>&nbsp;<span class="ident" id="8529308">b</span><span class="op" id="8529309">.</span><span class="ident" id="8529310">N</span><span class="op" id="8529311">;</span>&nbsp;<span class="ident" id="8529313">i</span><span class="op" id="8529314">++</span>&nbsp;<span class="op" id="8529317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529321">Decode</span><span class="op" id="8529327">(</span><span class="ident" id="8529328">strings</span><span class="op" id="8529335">.</span><span class="ident" id="8529336">NewReader</span><span class="op" id="8529345">(</span><span class="ident" id="8529346">s</span><span class="op" id="8529347">)</span><span class="op" id="8529348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8529351">}</span><br>
<span class="lineno"></span><span class="op" id="8529353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8529356">func</span>&nbsp;<span class="ident" id="8529361">BenchmarkDecodeGray</span><span class="op" id="8529380">(</span><span class="ident" id="8529381">b</span>&nbsp;<span class="op" id="8529383">*</span><span class="ident" id="8529384">testing</span><span class="op" id="8529391">.</span><span class="ident" id="8529392">B</span><span class="op" id="8529393">)</span>&nbsp;<span class="op" id="8529395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529398">benchmarkDecode</span><span class="op" id="8529413">(</span><span class="ident" id="8529414">b</span><span class="op" id="8529415">,</span>&nbsp;<span class="string" id="8529417">&#34;testdata/benchGray.png&#34;</span><span class="op" id="8529441">,</span>&nbsp;<span class="num" id="8529443">1</span><span class="op" id="8529444">)</span><br>
<span class="lineno"></span><span class="op" id="8529446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8529449">func</span>&nbsp;<span class="ident" id="8529454">BenchmarkDecodeNRGBAGradient</span><span class="op" id="8529482">(</span><span class="ident" id="8529483">b</span>&nbsp;<span class="op" id="8529485">*</span><span class="ident" id="8529486">testing</span><span class="op" id="8529493">.</span><span class="ident" id="8529494">B</span><span class="op" id="8529495">)</span>&nbsp;<span class="op" id="8529497">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529500">benchmarkDecode</span><span class="op" id="8529515">(</span><span class="ident" id="8529516">b</span><span class="op" id="8529517">,</span>&nbsp;<span class="string" id="8529519">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="8529553">,</span>&nbsp;<span class="num" id="8529555">4</span><span class="op" id="8529556">)</span><br>
<span class="lineno"></span><span class="op" id="8529558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8529561">func</span>&nbsp;<span class="ident" id="8529566">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="8529592">(</span><span class="ident" id="8529593">b</span>&nbsp;<span class="op" id="8529595">*</span><span class="ident" id="8529596">testing</span><span class="op" id="8529603">.</span><span class="ident" id="8529604">B</span><span class="op" id="8529605">)</span>&nbsp;<span class="op" id="8529607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529610">benchmarkDecode</span><span class="op" id="8529625">(</span><span class="ident" id="8529626">b</span><span class="op" id="8529627">,</span>&nbsp;<span class="string" id="8529629">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="8529661">,</span>&nbsp;<span class="num" id="8529663">4</span><span class="op" id="8529664">)</span><br>
<span class="lineno">350</span><span class="op" id="8529666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8529669">func</span>&nbsp;<span class="ident" id="8529674">BenchmarkDecodePaletted</span><span class="op" id="8529697">(</span><span class="ident" id="8529698">b</span>&nbsp;<span class="op" id="8529700">*</span><span class="ident" id="8529701">testing</span><span class="op" id="8529708">.</span><span class="ident" id="8529709">B</span><span class="op" id="8529710">)</span>&nbsp;<span class="op" id="8529712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529715">benchmarkDecode</span><span class="op" id="8529730">(</span><span class="ident" id="8529731">b</span><span class="op" id="8529732">,</span>&nbsp;<span class="string" id="8529734">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="8529762">,</span>&nbsp;<span class="num" id="8529764">1</span><span class="op" id="8529765">)</span><br>
<span class="lineno"></span><span class="op" id="8529767">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8529770">func</span>&nbsp;<span class="ident" id="8529775">BenchmarkDecodeRGB</span><span class="op" id="8529793">(</span><span class="ident" id="8529794">b</span>&nbsp;<span class="op" id="8529796">*</span><span class="ident" id="8529797">testing</span><span class="op" id="8529804">.</span><span class="ident" id="8529805">B</span><span class="op" id="8529806">)</span>&nbsp;<span class="op" id="8529808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529811">benchmarkDecode</span><span class="op" id="8529826">(</span><span class="ident" id="8529827">b</span><span class="op" id="8529828">,</span>&nbsp;<span class="string" id="8529830">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="8529853">,</span>&nbsp;<span class="num" id="8529855">4</span><span class="op" id="8529856">)</span><br>
<span class="lineno"></span><span class="op" id="8529858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="8529861">func</span>&nbsp;<span class="ident" id="8529866">BenchmarkDecodeInterlacing</span><span class="op" id="8529892">(</span><span class="ident" id="8529893">b</span>&nbsp;<span class="op" id="8529895">*</span><span class="ident" id="8529896">testing</span><span class="op" id="8529903">.</span><span class="ident" id="8529904">B</span><span class="op" id="8529905">)</span>&nbsp;<span class="op" id="8529907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8529910">benchmarkDecode</span><span class="op" id="8529925">(</span><span class="ident" id="8529926">b</span><span class="op" id="8529927">,</span>&nbsp;<span class="string" id="8529929">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="8529962">,</span>&nbsp;<span class="num" id="8529964">4</span><span class="op" id="8529965">)</span><br>
<span class="lineno"></span><span class="op" id="8529967">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
