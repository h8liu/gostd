<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4318739">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4318794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4318848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4318899">package</span>&nbsp;<span class="ident" id="4318907">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4318914">import</span>&nbsp;<span class="op" id="4318921">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4318924">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4318930">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4318937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4318940">const</span>&nbsp;<span class="op" id="4318946">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4318949">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4318978">offsetCodeCount</span>&nbsp;<span class="op" id="4318994">=</span>&nbsp;<span class="num" id="4318996">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319001">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319055">endBlockMarker</span>&nbsp;<span class="op" id="4319070">=</span>&nbsp;<span class="num" id="4319072">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319078">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319105">lengthCodesStart</span>&nbsp;<span class="op" id="4319122">=</span>&nbsp;<span class="num" id="4319124">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319130">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319163">codegenCodeCount</span>&nbsp;<span class="op" id="4319180">=</span>&nbsp;<span class="num" id="4319182">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4319186">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4319203">=</span>&nbsp;<span class="num" id="4319205">255</span><br>
<span class="lineno">25</span><span class="op" id="4319209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4319212">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4319286">var</span>&nbsp;<span class="ident" id="4319290">lengthExtraBits</span>&nbsp;<span class="op" id="4319306">=</span>&nbsp;<span class="op" id="4319308">[</span><span class="op" id="4319309">]</span><span class="builtintype" id="4319310">int8</span><span class="op" id="4319314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319317">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4319327">0</span><span class="op" id="4319328">,</span>&nbsp;<span class="num" id="4319330">0</span><span class="op" id="4319331">,</span>&nbsp;<span class="num" id="4319333">0</span><span class="op" id="4319334">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319337">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4319347">0</span><span class="op" id="4319348">,</span>&nbsp;<span class="num" id="4319350">0</span><span class="op" id="4319351">,</span>&nbsp;<span class="num" id="4319353">0</span><span class="op" id="4319354">,</span>&nbsp;<span class="num" id="4319356">0</span><span class="op" id="4319357">,</span>&nbsp;<span class="num" id="4319359">0</span><span class="op" id="4319360">,</span>&nbsp;<span class="num" id="4319362">1</span><span class="op" id="4319363">,</span>&nbsp;<span class="num" id="4319365">1</span><span class="op" id="4319366">,</span>&nbsp;<span class="num" id="4319368">1</span><span class="op" id="4319369">,</span>&nbsp;<span class="num" id="4319371">1</span><span class="op" id="4319372">,</span>&nbsp;<span class="num" id="4319374">2</span><span class="op" id="4319375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319378">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4319388">2</span><span class="op" id="4319389">,</span>&nbsp;<span class="num" id="4319391">2</span><span class="op" id="4319392">,</span>&nbsp;<span class="num" id="4319394">2</span><span class="op" id="4319395">,</span>&nbsp;<span class="num" id="4319397">3</span><span class="op" id="4319398">,</span>&nbsp;<span class="num" id="4319400">3</span><span class="op" id="4319401">,</span>&nbsp;<span class="num" id="4319403">3</span><span class="op" id="4319404">,</span>&nbsp;<span class="num" id="4319406">3</span><span class="op" id="4319407">,</span>&nbsp;<span class="num" id="4319409">4</span><span class="op" id="4319410">,</span>&nbsp;<span class="num" id="4319412">4</span><span class="op" id="4319413">,</span>&nbsp;<span class="num" id="4319415">4</span><span class="op" id="4319416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319419">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4319429">4</span><span class="op" id="4319430">,</span>&nbsp;<span class="num" id="4319432">5</span><span class="op" id="4319433">,</span>&nbsp;<span class="num" id="4319435">5</span><span class="op" id="4319436">,</span>&nbsp;<span class="num" id="4319438">5</span><span class="op" id="4319439">,</span>&nbsp;<span class="num" id="4319441">5</span><span class="op" id="4319442">,</span>&nbsp;<span class="num" id="4319444">0</span><span class="op" id="4319445">,</span><br>
<span class="lineno"></span><span class="op" id="4319447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4319450">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4319513">var</span>&nbsp;<span class="ident" id="4319517">lengthBase</span>&nbsp;<span class="op" id="4319528">=</span>&nbsp;<span class="op" id="4319530">[</span><span class="op" id="4319531">]</span><span class="builtintype" id="4319532">uint32</span><span class="op" id="4319538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319541">0</span><span class="op" id="4319542">,</span>&nbsp;<span class="num" id="4319544">1</span><span class="op" id="4319545">,</span>&nbsp;<span class="num" id="4319547">2</span><span class="op" id="4319548">,</span>&nbsp;<span class="num" id="4319550">3</span><span class="op" id="4319551">,</span>&nbsp;<span class="num" id="4319553">4</span><span class="op" id="4319554">,</span>&nbsp;<span class="num" id="4319556">5</span><span class="op" id="4319557">,</span>&nbsp;<span class="num" id="4319559">6</span><span class="op" id="4319560">,</span>&nbsp;<span class="num" id="4319562">7</span><span class="op" id="4319563">,</span>&nbsp;<span class="num" id="4319565">8</span><span class="op" id="4319566">,</span>&nbsp;<span class="num" id="4319568">10</span><span class="op" id="4319570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319573">12</span><span class="op" id="4319575">,</span>&nbsp;<span class="num" id="4319577">14</span><span class="op" id="4319579">,</span>&nbsp;<span class="num" id="4319581">16</span><span class="op" id="4319583">,</span>&nbsp;<span class="num" id="4319585">20</span><span class="op" id="4319587">,</span>&nbsp;<span class="num" id="4319589">24</span><span class="op" id="4319591">,</span>&nbsp;<span class="num" id="4319593">28</span><span class="op" id="4319595">,</span>&nbsp;<span class="num" id="4319597">32</span><span class="op" id="4319599">,</span>&nbsp;<span class="num" id="4319601">40</span><span class="op" id="4319603">,</span>&nbsp;<span class="num" id="4319605">48</span><span class="op" id="4319607">,</span>&nbsp;<span class="num" id="4319609">56</span><span class="op" id="4319611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319614">64</span><span class="op" id="4319616">,</span>&nbsp;<span class="num" id="4319618">80</span><span class="op" id="4319620">,</span>&nbsp;<span class="num" id="4319622">96</span><span class="op" id="4319624">,</span>&nbsp;<span class="num" id="4319626">112</span><span class="op" id="4319629">,</span>&nbsp;<span class="num" id="4319631">128</span><span class="op" id="4319634">,</span>&nbsp;<span class="num" id="4319636">160</span><span class="op" id="4319639">,</span>&nbsp;<span class="num" id="4319641">192</span><span class="op" id="4319644">,</span>&nbsp;<span class="num" id="4319646">224</span><span class="op" id="4319649">,</span>&nbsp;<span class="num" id="4319651">255</span><span class="op" id="4319654">,</span><br>
<span class="lineno">40</span><span class="op" id="4319656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4319659">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4319691">var</span>&nbsp;<span class="ident" id="4319695">offsetExtraBits</span>&nbsp;<span class="op" id="4319711">=</span>&nbsp;<span class="op" id="4319713">[</span><span class="op" id="4319714">]</span><span class="builtintype" id="4319715">int8</span><span class="op" id="4319719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319722">0</span><span class="op" id="4319723">,</span>&nbsp;<span class="num" id="4319725">0</span><span class="op" id="4319726">,</span>&nbsp;<span class="num" id="4319728">0</span><span class="op" id="4319729">,</span>&nbsp;<span class="num" id="4319731">0</span><span class="op" id="4319732">,</span>&nbsp;<span class="num" id="4319734">1</span><span class="op" id="4319735">,</span>&nbsp;<span class="num" id="4319737">1</span><span class="op" id="4319738">,</span>&nbsp;<span class="num" id="4319740">2</span><span class="op" id="4319741">,</span>&nbsp;<span class="num" id="4319743">2</span><span class="op" id="4319744">,</span>&nbsp;<span class="num" id="4319746">3</span><span class="op" id="4319747">,</span>&nbsp;<span class="num" id="4319749">3</span><span class="op" id="4319750">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319753">4</span><span class="op" id="4319754">,</span>&nbsp;<span class="num" id="4319756">4</span><span class="op" id="4319757">,</span>&nbsp;<span class="num" id="4319759">5</span><span class="op" id="4319760">,</span>&nbsp;<span class="num" id="4319762">5</span><span class="op" id="4319763">,</span>&nbsp;<span class="num" id="4319765">6</span><span class="op" id="4319766">,</span>&nbsp;<span class="num" id="4319768">6</span><span class="op" id="4319769">,</span>&nbsp;<span class="num" id="4319771">7</span><span class="op" id="4319772">,</span>&nbsp;<span class="num" id="4319774">7</span><span class="op" id="4319775">,</span>&nbsp;<span class="num" id="4319777">8</span><span class="op" id="4319778">,</span>&nbsp;<span class="num" id="4319780">8</span><span class="op" id="4319781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319784">9</span><span class="op" id="4319785">,</span>&nbsp;<span class="num" id="4319787">9</span><span class="op" id="4319788">,</span>&nbsp;<span class="num" id="4319790">10</span><span class="op" id="4319792">,</span>&nbsp;<span class="num" id="4319794">10</span><span class="op" id="4319796">,</span>&nbsp;<span class="num" id="4319798">11</span><span class="op" id="4319800">,</span>&nbsp;<span class="num" id="4319802">11</span><span class="op" id="4319804">,</span>&nbsp;<span class="num" id="4319806">12</span><span class="op" id="4319808">,</span>&nbsp;<span class="num" id="4319810">12</span><span class="op" id="4319812">,</span>&nbsp;<span class="num" id="4319814">13</span><span class="op" id="4319816">,</span>&nbsp;<span class="num" id="4319818">13</span><span class="op" id="4319820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319823">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319846">14</span><span class="op" id="4319848">,</span>&nbsp;<span class="num" id="4319850">14</span><span class="op" id="4319852">,</span>&nbsp;<span class="num" id="4319854">15</span><span class="op" id="4319856">,</span>&nbsp;<span class="num" id="4319858">15</span><span class="op" id="4319860">,</span>&nbsp;<span class="num" id="4319862">16</span><span class="op" id="4319864">,</span>&nbsp;<span class="num" id="4319866">16</span><span class="op" id="4319868">,</span>&nbsp;<span class="num" id="4319870">17</span><span class="op" id="4319872">,</span>&nbsp;<span class="num" id="4319874">17</span><span class="op" id="4319876">,</span>&nbsp;<span class="num" id="4319878">18</span><span class="op" id="4319880">,</span>&nbsp;<span class="num" id="4319882">18</span><span class="op" id="4319884">,</span>&nbsp;<span class="num" id="4319886">19</span><span class="op" id="4319888">,</span>&nbsp;<span class="num" id="4319890">19</span><span class="op" id="4319892">,</span>&nbsp;<span class="num" id="4319894">20</span><span class="op" id="4319896">,</span>&nbsp;<span class="num" id="4319898">20</span><span class="op" id="4319900">,</span><br>
<span class="lineno"></span><span class="op" id="4319902">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4319905">var</span>&nbsp;<span class="ident" id="4319909">offsetBase</span>&nbsp;<span class="op" id="4319920">=</span>&nbsp;<span class="op" id="4319922">[</span><span class="op" id="4319923">]</span><span class="builtintype" id="4319924">uint32</span><span class="op" id="4319930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4319933">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4319955">0x000000</span><span class="op" id="4319963">,</span>&nbsp;<span class="num" id="4319965">0x000001</span><span class="op" id="4319973">,</span>&nbsp;<span class="num" id="4319975">0x000002</span><span class="op" id="4319983">,</span>&nbsp;<span class="num" id="4319985">0x000003</span><span class="op" id="4319993">,</span>&nbsp;<span class="num" id="4319995">0x000004</span><span class="op" id="4320003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320006">0x000006</span><span class="op" id="4320014">,</span>&nbsp;<span class="num" id="4320016">0x000008</span><span class="op" id="4320024">,</span>&nbsp;<span class="num" id="4320026">0x00000c</span><span class="op" id="4320034">,</span>&nbsp;<span class="num" id="4320036">0x000010</span><span class="op" id="4320044">,</span>&nbsp;<span class="num" id="4320046">0x000018</span><span class="op" id="4320054">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320057">0x000020</span><span class="op" id="4320065">,</span>&nbsp;<span class="num" id="4320067">0x000030</span><span class="op" id="4320075">,</span>&nbsp;<span class="num" id="4320077">0x000040</span><span class="op" id="4320085">,</span>&nbsp;<span class="num" id="4320087">0x000060</span><span class="op" id="4320095">,</span>&nbsp;<span class="num" id="4320097">0x000080</span><span class="op" id="4320105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320108">0x0000c0</span><span class="op" id="4320116">,</span>&nbsp;<span class="num" id="4320118">0x000100</span><span class="op" id="4320126">,</span>&nbsp;<span class="num" id="4320128">0x000180</span><span class="op" id="4320136">,</span>&nbsp;<span class="num" id="4320138">0x000200</span><span class="op" id="4320146">,</span>&nbsp;<span class="num" id="4320148">0x000300</span><span class="op" id="4320156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320159">0x000400</span><span class="op" id="4320167">,</span>&nbsp;<span class="num" id="4320169">0x000600</span><span class="op" id="4320177">,</span>&nbsp;<span class="num" id="4320179">0x000800</span><span class="op" id="4320187">,</span>&nbsp;<span class="num" id="4320189">0x000c00</span><span class="op" id="4320197">,</span>&nbsp;<span class="num" id="4320199">0x001000</span><span class="op" id="4320207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320210">0x001800</span><span class="op" id="4320218">,</span>&nbsp;<span class="num" id="4320220">0x002000</span><span class="op" id="4320228">,</span>&nbsp;<span class="num" id="4320230">0x003000</span><span class="op" id="4320238">,</span>&nbsp;<span class="num" id="4320240">0x004000</span><span class="op" id="4320248">,</span>&nbsp;<span class="num" id="4320250">0x006000</span><span class="op" id="4320258">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320262">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320285">0x008000</span><span class="op" id="4320293">,</span>&nbsp;<span class="num" id="4320295">0x00c000</span><span class="op" id="4320303">,</span>&nbsp;<span class="num" id="4320305">0x010000</span><span class="op" id="4320313">,</span>&nbsp;<span class="num" id="4320315">0x018000</span><span class="op" id="4320323">,</span>&nbsp;<span class="num" id="4320325">0x020000</span><span class="op" id="4320333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320336">0x030000</span><span class="op" id="4320344">,</span>&nbsp;<span class="num" id="4320346">0x040000</span><span class="op" id="4320354">,</span>&nbsp;<span class="num" id="4320356">0x060000</span><span class="op" id="4320364">,</span>&nbsp;<span class="num" id="4320366">0x080000</span><span class="op" id="4320374">,</span>&nbsp;<span class="num" id="4320376">0x0c0000</span><span class="op" id="4320384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4320387">0x100000</span><span class="op" id="4320395">,</span>&nbsp;<span class="num" id="4320397">0x180000</span><span class="op" id="4320405">,</span>&nbsp;<span class="num" id="4320407">0x200000</span><span class="op" id="4320415">,</span>&nbsp;<span class="num" id="4320417">0x300000</span><span class="op" id="4320425">,</span><br>
<span class="lineno"></span><span class="op" id="4320427">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4320430">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4320492">var</span>&nbsp;<span class="ident" id="4320496">codegenOrder</span>&nbsp;<span class="op" id="4320509">=</span>&nbsp;<span class="op" id="4320511">[</span><span class="op" id="4320512">]</span><span class="builtintype" id="4320513">uint32</span><span class="op" id="4320519">{</span><span class="num" id="4320520">16</span><span class="op" id="4320522">,</span>&nbsp;<span class="num" id="4320524">17</span><span class="op" id="4320526">,</span>&nbsp;<span class="num" id="4320528">18</span><span class="op" id="4320530">,</span>&nbsp;<span class="num" id="4320532">0</span><span class="op" id="4320533">,</span>&nbsp;<span class="num" id="4320535">8</span><span class="op" id="4320536">,</span>&nbsp;<span class="num" id="4320538">7</span><span class="op" id="4320539">,</span>&nbsp;<span class="num" id="4320541">9</span><span class="op" id="4320542">,</span>&nbsp;<span class="num" id="4320544">6</span><span class="op" id="4320545">,</span>&nbsp;<span class="num" id="4320547">10</span><span class="op" id="4320549">,</span>&nbsp;<span class="num" id="4320551">5</span><span class="op" id="4320552">,</span>&nbsp;<span class="num" id="4320554">11</span><span class="op" id="4320556">,</span>&nbsp;<span class="num" id="4320558">4</span><span class="op" id="4320559">,</span>&nbsp;<span class="num" id="4320561">12</span><span class="op" id="4320563">,</span>&nbsp;<span class="num" id="4320565">3</span><span class="op" id="4320566">,</span>&nbsp;<span class="num" id="4320568">13</span><span class="op" id="4320570">,</span>&nbsp;<span class="num" id="4320572">2</span><span class="op" id="4320573">,</span>&nbsp;<span class="num" id="4320575">14</span><span class="op" id="4320577">,</span>&nbsp;<span class="num" id="4320579">1</span><span class="op" id="4320580">,</span>&nbsp;<span class="num" id="4320582">15</span><span class="op" id="4320584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4320587">type</span>&nbsp;<span class="ident" id="4320592">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4320609">struct</span>&nbsp;<span class="op" id="4320616">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320619">w</span>&nbsp;<span class="ident" id="4320621">io</span><span class="op" id="4320623">.</span><span class="ident" id="4320624">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320632">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4320682">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320718">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4320734">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320742">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4320758">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320766">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4320782">[</span><span class="num" id="4320783">64</span><span class="op" id="4320785">]</span><span class="builtintype" id="4320786">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320792">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4320808">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320813">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4320829">[</span><span class="op" id="4320830">]</span><span class="builtintype" id="4320831">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320838">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4320854">[</span><span class="op" id="4320855">]</span><span class="builtintype" id="4320856">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320863">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4320879">[</span><span class="op" id="4320880">]</span><span class="builtintype" id="4320881">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320888">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4320904">[</span><span class="op" id="4320905">]</span><span class="builtintype" id="4320906">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320913">literalEncoding</span>&nbsp;<span class="op" id="4320929">*</span><span class="ident" id="4320930">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320946">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4320962">*</span><span class="ident" id="4320963">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4320979">codegenEncoding</span>&nbsp;<span class="op" id="4320995">*</span><span class="ident" id="4320996">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321012">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4321028">error</span><br>
<span class="lineno">85</span><span class="op" id="4321034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4321037">func</span>&nbsp;<span class="ident" id="4321042">newHuffmanBitWriter</span><span class="op" id="4321061">(</span><span class="ident" id="4321062">w</span>&nbsp;<span class="ident" id="4321064">io</span><span class="op" id="4321066">.</span><span class="ident" id="4321067">Writer</span><span class="op" id="4321073">)</span>&nbsp;<span class="op" id="4321075">*</span><span class="ident" id="4321076">huffmanBitWriter</span>&nbsp;<span class="op" id="4321093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321096">return</span>&nbsp;<span class="op" id="4321103">&amp;</span><span class="ident" id="4321104">huffmanBitWriter</span><span class="op" id="4321120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321124">w</span><span class="op" id="4321125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4321141">w</span><span class="op" id="4321142">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321146">literalFreq</span><span class="op" id="4321157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4321163">make</span><span class="op" id="4321167">(</span><span class="op" id="4321168">[</span><span class="op" id="4321169">]</span><span class="builtintype" id="4321170">int32</span><span class="op" id="4321175">,</span>&nbsp;<span class="ident" id="4321177">maxLit</span><span class="op" id="4321183">)</span><span class="op" id="4321184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321188">offsetFreq</span><span class="op" id="4321198">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4321205">make</span><span class="op" id="4321209">(</span><span class="op" id="4321210">[</span><span class="op" id="4321211">]</span><span class="builtintype" id="4321212">int32</span><span class="op" id="4321217">,</span>&nbsp;<span class="ident" id="4321219">offsetCodeCount</span><span class="op" id="4321234">)</span><span class="op" id="4321235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321239">codegen</span><span class="op" id="4321246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4321256">make</span><span class="op" id="4321260">(</span><span class="op" id="4321261">[</span><span class="op" id="4321262">]</span><span class="builtintype" id="4321263">uint8</span><span class="op" id="4321268">,</span>&nbsp;<span class="ident" id="4321270">maxLit</span><span class="op" id="4321276">+</span><span class="ident" id="4321277">offsetCodeCount</span><span class="op" id="4321292">+</span><span class="num" id="4321293">1</span><span class="op" id="4321294">)</span><span class="op" id="4321295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321299">codegenFreq</span><span class="op" id="4321310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4321316">make</span><span class="op" id="4321320">(</span><span class="op" id="4321321">[</span><span class="op" id="4321322">]</span><span class="builtintype" id="4321323">int32</span><span class="op" id="4321328">,</span>&nbsp;<span class="ident" id="4321330">codegenCodeCount</span><span class="op" id="4321346">)</span><span class="op" id="4321347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321351">literalEncoding</span><span class="op" id="4321366">:</span>&nbsp;<span class="ident" id="4321368">newHuffmanEncoder</span><span class="op" id="4321385">(</span><span class="ident" id="4321386">maxLit</span><span class="op" id="4321392">)</span><span class="op" id="4321393">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321397">offsetEncoding</span><span class="op" id="4321411">:</span>&nbsp;&nbsp;<span class="ident" id="4321414">newHuffmanEncoder</span><span class="op" id="4321431">(</span><span class="ident" id="4321432">offsetCodeCount</span><span class="op" id="4321447">)</span><span class="op" id="4321448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321452">codegenEncoding</span><span class="op" id="4321467">:</span>&nbsp;<span class="ident" id="4321469">newHuffmanEncoder</span><span class="op" id="4321486">(</span><span class="ident" id="4321487">codegenCodeCount</span><span class="op" id="4321503">)</span><span class="op" id="4321504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321507">}</span><br>
<span class="lineno"></span><span class="op" id="4321509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4321512">func</span>&nbsp;<span class="op" id="4321517">(</span><span class="ident" id="4321518">w</span>&nbsp;<span class="op" id="4321520">*</span><span class="ident" id="4321521">huffmanBitWriter</span><span class="op" id="4321537">)</span>&nbsp;<span class="ident" id="4321539">reset</span><span class="op" id="4321544">(</span><span class="ident" id="4321545">writer</span>&nbsp;<span class="ident" id="4321552">io</span><span class="op" id="4321554">.</span><span class="ident" id="4321555">Writer</span><span class="op" id="4321561">)</span>&nbsp;<span class="op" id="4321563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321566">w</span><span class="op" id="4321567">.</span><span class="ident" id="4321568">w</span>&nbsp;<span class="op" id="4321570">=</span>&nbsp;<span class="ident" id="4321572">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321580">w</span><span class="op" id="4321581">.</span><span class="ident" id="4321582">bits</span><span class="op" id="4321586">,</span>&nbsp;<span class="ident" id="4321588">w</span><span class="op" id="4321589">.</span><span class="ident" id="4321590">nbits</span><span class="op" id="4321595">,</span>&nbsp;<span class="ident" id="4321597">w</span><span class="op" id="4321598">.</span><span class="ident" id="4321599">nbytes</span><span class="op" id="4321605">,</span>&nbsp;<span class="ident" id="4321607">w</span><span class="op" id="4321608">.</span><span class="ident" id="4321609">err</span>&nbsp;<span class="op" id="4321613">=</span>&nbsp;<span class="num" id="4321615">0</span><span class="op" id="4321616">,</span>&nbsp;<span class="num" id="4321618">0</span><span class="op" id="4321619">,</span>&nbsp;<span class="num" id="4321621">0</span><span class="op" id="4321622">,</span>&nbsp;<span class="ident" id="4321624">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321629">w</span><span class="op" id="4321630">.</span><span class="ident" id="4321631">bytes</span>&nbsp;<span class="op" id="4321637">=</span>&nbsp;<span class="op" id="4321639">[</span><span class="num" id="4321640">64</span><span class="op" id="4321642">]</span><span class="builtintype" id="4321643">byte</span><span class="op" id="4321647">{</span><span class="op" id="4321648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321651">for</span>&nbsp;<span class="ident" id="4321655">i</span>&nbsp;<span class="op" id="4321657">:=</span>&nbsp;<span class="keyword" id="4321660">range</span>&nbsp;<span class="ident" id="4321666">w</span><span class="op" id="4321667">.</span><span class="ident" id="4321668">codegen</span>&nbsp;<span class="op" id="4321676">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321680">w</span><span class="op" id="4321681">.</span><span class="ident" id="4321682">codegen</span><span class="op" id="4321689">[</span><span class="ident" id="4321690">i</span><span class="op" id="4321691">]</span>&nbsp;<span class="op" id="4321693">=</span>&nbsp;<span class="num" id="4321695">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321701">for</span>&nbsp;<span class="ident" id="4321705">_</span><span class="op" id="4321706">,</span>&nbsp;<span class="ident" id="4321708">s</span>&nbsp;<span class="op" id="4321710">:=</span>&nbsp;<span class="keyword" id="4321713">range</span>&nbsp;<span class="op" id="4321719">[</span><span class="op" id="4321720">...</span><span class="op" id="4321723">]</span><span class="op" id="4321724">[</span><span class="op" id="4321725">]</span><span class="builtintype" id="4321726">int32</span><span class="op" id="4321731">{</span><span class="ident" id="4321732">w</span><span class="op" id="4321733">.</span><span class="ident" id="4321734">literalFreq</span><span class="op" id="4321745">,</span>&nbsp;<span class="ident" id="4321747">w</span><span class="op" id="4321748">.</span><span class="ident" id="4321749">offsetFreq</span><span class="op" id="4321759">,</span>&nbsp;<span class="ident" id="4321761">w</span><span class="op" id="4321762">.</span><span class="ident" id="4321763">codegenFreq</span><span class="op" id="4321774">}</span>&nbsp;<span class="op" id="4321776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321780">for</span>&nbsp;<span class="ident" id="4321784">i</span>&nbsp;<span class="op" id="4321786">:=</span>&nbsp;<span class="keyword" id="4321789">range</span>&nbsp;<span class="ident" id="4321795">s</span>&nbsp;<span class="op" id="4321797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321802">s</span><span class="op" id="4321803">[</span><span class="ident" id="4321804">i</span><span class="op" id="4321805">]</span>&nbsp;<span class="op" id="4321807">=</span>&nbsp;<span class="num" id="4321809">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321819">for</span>&nbsp;<span class="ident" id="4321823">_</span><span class="op" id="4321824">,</span>&nbsp;<span class="ident" id="4321826">enc</span>&nbsp;<span class="op" id="4321830">:=</span>&nbsp;<span class="keyword" id="4321833">range</span>&nbsp;<span class="op" id="4321839">[</span><span class="op" id="4321840">...</span><span class="op" id="4321843">]</span><span class="op" id="4321844">*</span><span class="ident" id="4321845">huffmanEncoder</span><span class="op" id="4321859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321863">w</span><span class="op" id="4321864">.</span><span class="ident" id="4321865">literalEncoding</span><span class="op" id="4321880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321884">w</span><span class="op" id="4321885">.</span><span class="ident" id="4321886">offsetEncoding</span><span class="op" id="4321900">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321904">w</span><span class="op" id="4321905">.</span><span class="ident" id="4321906">codegenEncoding</span><span class="op" id="4321921">}</span>&nbsp;<span class="op" id="4321923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321927">for</span>&nbsp;<span class="ident" id="4321931">i</span>&nbsp;<span class="op" id="4321933">:=</span>&nbsp;<span class="keyword" id="4321936">range</span>&nbsp;<span class="ident" id="4321942">enc</span><span class="op" id="4321945">.</span><span class="ident" id="4321946">code</span>&nbsp;<span class="op" id="4321951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4321956">enc</span><span class="op" id="4321959">.</span><span class="ident" id="4321960">code</span><span class="op" id="4321964">[</span><span class="ident" id="4321965">i</span><span class="op" id="4321966">]</span>&nbsp;<span class="op" id="4321968">=</span>&nbsp;<span class="num" id="4321970">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4321974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4321978">for</span>&nbsp;<span class="ident" id="4321982">i</span>&nbsp;<span class="op" id="4321984">:=</span>&nbsp;<span class="keyword" id="4321987">range</span>&nbsp;<span class="ident" id="4321993">enc</span><span class="op" id="4321996">.</span><span class="ident" id="4321997">codeBits</span>&nbsp;<span class="op" id="4322006">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322011">enc</span><span class="op" id="4322014">.</span><span class="ident" id="4322015">codeBits</span><span class="op" id="4322023">[</span><span class="ident" id="4322024">i</span><span class="op" id="4322025">]</span>&nbsp;<span class="op" id="4322027">=</span>&nbsp;<span class="num" id="4322029">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322036">}</span><br>
<span class="lineno"></span><span class="op" id="4322038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4322041">func</span>&nbsp;<span class="op" id="4322046">(</span><span class="ident" id="4322047">w</span>&nbsp;<span class="op" id="4322049">*</span><span class="ident" id="4322050">huffmanBitWriter</span><span class="op" id="4322066">)</span>&nbsp;<span class="ident" id="4322068">flushBits</span><span class="op" id="4322077">(</span><span class="op" id="4322078">)</span>&nbsp;<span class="op" id="4322080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322083">if</span>&nbsp;<span class="ident" id="4322086">w</span><span class="op" id="4322087">.</span><span class="ident" id="4322088">err</span>&nbsp;<span class="op" id="4322092">!=</span>&nbsp;<span class="ident" id="4322095">nil</span>&nbsp;<span class="op" id="4322099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322103">w</span><span class="op" id="4322104">.</span><span class="ident" id="4322105">nbits</span>&nbsp;<span class="op" id="4322111">=</span>&nbsp;<span class="num" id="4322113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322125">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322128">bits</span>&nbsp;<span class="op" id="4322133">:=</span>&nbsp;<span class="ident" id="4322136">w</span><span class="op" id="4322137">.</span><span class="ident" id="4322138">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322144">w</span><span class="op" id="4322145">.</span><span class="ident" id="4322146">bits</span>&nbsp;<span class="op" id="4322151">&gt;&gt;=</span>&nbsp;<span class="num" id="4322155">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322159">w</span><span class="op" id="4322160">.</span><span class="ident" id="4322161">nbits</span>&nbsp;<span class="op" id="4322167">-=</span>&nbsp;<span class="num" id="4322170">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322174">n</span>&nbsp;<span class="op" id="4322176">:=</span>&nbsp;<span class="ident" id="4322179">w</span><span class="op" id="4322180">.</span><span class="ident" id="4322181">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322189">w</span><span class="op" id="4322190">.</span><span class="ident" id="4322191">bytes</span><span class="op" id="4322196">[</span><span class="ident" id="4322197">n</span><span class="op" id="4322198">]</span>&nbsp;<span class="op" id="4322200">=</span>&nbsp;<span class="builtintype" id="4322202">byte</span><span class="op" id="4322206">(</span><span class="ident" id="4322207">bits</span><span class="op" id="4322211">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322214">w</span><span class="op" id="4322215">.</span><span class="ident" id="4322216">bytes</span><span class="op" id="4322221">[</span><span class="ident" id="4322222">n</span><span class="op" id="4322223">+</span><span class="num" id="4322224">1</span><span class="op" id="4322225">]</span>&nbsp;<span class="op" id="4322227">=</span>&nbsp;<span class="builtintype" id="4322229">byte</span><span class="op" id="4322233">(</span><span class="ident" id="4322234">bits</span>&nbsp;<span class="op" id="4322239">&gt;&gt;</span>&nbsp;<span class="num" id="4322242">8</span><span class="op" id="4322243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322246">if</span>&nbsp;<span class="ident" id="4322249">n</span>&nbsp;<span class="op" id="4322251">+=</span>&nbsp;<span class="num" id="4322254">2</span><span class="op" id="4322255">;</span>&nbsp;<span class="ident" id="4322257">n</span>&nbsp;<span class="op" id="4322259">&gt;=</span>&nbsp;<span class="builtinfunc" id="4322262">len</span><span class="op" id="4322265">(</span><span class="ident" id="4322266">w</span><span class="op" id="4322267">.</span><span class="ident" id="4322268">bytes</span><span class="op" id="4322273">)</span>&nbsp;<span class="op" id="4322275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322279">_</span><span class="op" id="4322280">,</span>&nbsp;<span class="ident" id="4322282">w</span><span class="op" id="4322283">.</span><span class="ident" id="4322284">err</span>&nbsp;<span class="op" id="4322288">=</span>&nbsp;<span class="ident" id="4322290">w</span><span class="op" id="4322291">.</span><span class="ident" id="4322292">w</span><span class="op" id="4322293">.</span><span class="ident" id="4322294">Write</span><span class="op" id="4322299">(</span><span class="ident" id="4322300">w</span><span class="op" id="4322301">.</span><span class="ident" id="4322302">bytes</span><span class="op" id="4322307">[</span><span class="num" id="4322308">0</span><span class="op" id="4322309">:</span><span class="op" id="4322310">]</span><span class="op" id="4322311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322315">n</span>&nbsp;<span class="op" id="4322317">=</span>&nbsp;<span class="num" id="4322319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322322">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322325">w</span><span class="op" id="4322326">.</span><span class="ident" id="4322327">nbytes</span>&nbsp;<span class="op" id="4322334">=</span>&nbsp;<span class="ident" id="4322336">n</span><br>
<span class="lineno"></span><span class="op" id="4322338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4322341">func</span>&nbsp;<span class="op" id="4322346">(</span><span class="ident" id="4322347">w</span>&nbsp;<span class="op" id="4322349">*</span><span class="ident" id="4322350">huffmanBitWriter</span><span class="op" id="4322366">)</span>&nbsp;<span class="ident" id="4322368">flush</span><span class="op" id="4322373">(</span><span class="op" id="4322374">)</span>&nbsp;<span class="op" id="4322376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322379">if</span>&nbsp;<span class="ident" id="4322382">w</span><span class="op" id="4322383">.</span><span class="ident" id="4322384">err</span>&nbsp;<span class="op" id="4322388">!=</span>&nbsp;<span class="ident" id="4322391">nil</span>&nbsp;<span class="op" id="4322395">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322399">w</span><span class="op" id="4322400">.</span><span class="ident" id="4322401">nbits</span>&nbsp;<span class="op" id="4322407">=</span>&nbsp;<span class="num" id="4322409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322424">n</span>&nbsp;<span class="op" id="4322426">:=</span>&nbsp;<span class="ident" id="4322429">w</span><span class="op" id="4322430">.</span><span class="ident" id="4322431">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322439">if</span>&nbsp;<span class="ident" id="4322442">w</span><span class="op" id="4322443">.</span><span class="ident" id="4322444">nbits</span>&nbsp;<span class="op" id="4322450">&gt;</span>&nbsp;<span class="num" id="4322452">8</span>&nbsp;<span class="op" id="4322454">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322458">w</span><span class="op" id="4322459">.</span><span class="ident" id="4322460">bytes</span><span class="op" id="4322465">[</span><span class="ident" id="4322466">n</span><span class="op" id="4322467">]</span>&nbsp;<span class="op" id="4322469">=</span>&nbsp;<span class="builtintype" id="4322471">byte</span><span class="op" id="4322475">(</span><span class="ident" id="4322476">w</span><span class="op" id="4322477">.</span><span class="ident" id="4322478">bits</span><span class="op" id="4322482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322486">w</span><span class="op" id="4322487">.</span><span class="ident" id="4322488">bits</span>&nbsp;<span class="op" id="4322493">&gt;&gt;=</span>&nbsp;<span class="num" id="4322497">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322501">w</span><span class="op" id="4322502">.</span><span class="ident" id="4322503">nbits</span>&nbsp;<span class="op" id="4322509">-=</span>&nbsp;<span class="num" id="4322512">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322516">n</span><span class="op" id="4322517">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322521">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322524">if</span>&nbsp;<span class="ident" id="4322527">w</span><span class="op" id="4322528">.</span><span class="ident" id="4322529">nbits</span>&nbsp;<span class="op" id="4322535">&gt;</span>&nbsp;<span class="num" id="4322537">0</span>&nbsp;<span class="op" id="4322539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322543">w</span><span class="op" id="4322544">.</span><span class="ident" id="4322545">bytes</span><span class="op" id="4322550">[</span><span class="ident" id="4322551">n</span><span class="op" id="4322552">]</span>&nbsp;<span class="op" id="4322554">=</span>&nbsp;<span class="builtintype" id="4322556">byte</span><span class="op" id="4322560">(</span><span class="ident" id="4322561">w</span><span class="op" id="4322562">.</span><span class="ident" id="4322563">bits</span><span class="op" id="4322567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322571">w</span><span class="op" id="4322572">.</span><span class="ident" id="4322573">nbits</span>&nbsp;<span class="op" id="4322579">=</span>&nbsp;<span class="num" id="4322581">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322585">n</span><span class="op" id="4322586">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322590">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322593">w</span><span class="op" id="4322594">.</span><span class="ident" id="4322595">bits</span>&nbsp;<span class="op" id="4322600">=</span>&nbsp;<span class="num" id="4322602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322605">_</span><span class="op" id="4322606">,</span>&nbsp;<span class="ident" id="4322608">w</span><span class="op" id="4322609">.</span><span class="ident" id="4322610">err</span>&nbsp;<span class="op" id="4322614">=</span>&nbsp;<span class="ident" id="4322616">w</span><span class="op" id="4322617">.</span><span class="ident" id="4322618">w</span><span class="op" id="4322619">.</span><span class="ident" id="4322620">Write</span><span class="op" id="4322625">(</span><span class="ident" id="4322626">w</span><span class="op" id="4322627">.</span><span class="ident" id="4322628">bytes</span><span class="op" id="4322633">[</span><span class="num" id="4322634">0</span><span class="op" id="4322635">:</span><span class="ident" id="4322636">n</span><span class="op" id="4322637">]</span><span class="op" id="4322638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322641">w</span><span class="op" id="4322642">.</span><span class="ident" id="4322643">nbytes</span>&nbsp;<span class="op" id="4322650">=</span>&nbsp;<span class="num" id="4322652">0</span><br>
<span class="lineno"></span><span class="op" id="4322654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4322657">func</span>&nbsp;<span class="op" id="4322662">(</span><span class="ident" id="4322663">w</span>&nbsp;<span class="op" id="4322665">*</span><span class="ident" id="4322666">huffmanBitWriter</span><span class="op" id="4322682">)</span>&nbsp;<span class="ident" id="4322684">writeBits</span><span class="op" id="4322693">(</span><span class="ident" id="4322694">b</span><span class="op" id="4322695">,</span>&nbsp;<span class="ident" id="4322697">nb</span>&nbsp;<span class="builtintype" id="4322700">int32</span><span class="op" id="4322705">)</span>&nbsp;<span class="op" id="4322707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322710">w</span><span class="op" id="4322711">.</span><span class="ident" id="4322712">bits</span>&nbsp;<span class="op" id="4322717">|=</span>&nbsp;<span class="builtintype" id="4322720">uint32</span><span class="op" id="4322726">(</span><span class="ident" id="4322727">b</span><span class="op" id="4322728">)</span>&nbsp;<span class="op" id="4322730">&lt;&lt;</span>&nbsp;<span class="ident" id="4322733">w</span><span class="op" id="4322734">.</span><span class="ident" id="4322735">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322742">if</span>&nbsp;<span class="ident" id="4322745">w</span><span class="op" id="4322746">.</span><span class="ident" id="4322747">nbits</span>&nbsp;<span class="op" id="4322753">+=</span>&nbsp;<span class="builtintype" id="4322756">uint32</span><span class="op" id="4322762">(</span><span class="ident" id="4322763">nb</span><span class="op" id="4322765">)</span><span class="op" id="4322766">;</span>&nbsp;<span class="ident" id="4322768">w</span><span class="op" id="4322769">.</span><span class="ident" id="4322770">nbits</span>&nbsp;<span class="op" id="4322776">&gt;=</span>&nbsp;<span class="num" id="4322779">16</span>&nbsp;<span class="op" id="4322782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322786">w</span><span class="op" id="4322787">.</span><span class="ident" id="4322788">flushBits</span><span class="op" id="4322797">(</span><span class="op" id="4322798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322801">}</span><br>
<span class="lineno">170</span><span class="op" id="4322803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4322806">func</span>&nbsp;<span class="op" id="4322811">(</span><span class="ident" id="4322812">w</span>&nbsp;<span class="op" id="4322814">*</span><span class="ident" id="4322815">huffmanBitWriter</span><span class="op" id="4322831">)</span>&nbsp;<span class="ident" id="4322833">writeBytes</span><span class="op" id="4322843">(</span><span class="ident" id="4322844">bytes</span>&nbsp;<span class="op" id="4322850">[</span><span class="op" id="4322851">]</span><span class="builtintype" id="4322852">byte</span><span class="op" id="4322856">)</span>&nbsp;<span class="op" id="4322858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322861">if</span>&nbsp;<span class="ident" id="4322864">w</span><span class="op" id="4322865">.</span><span class="ident" id="4322866">err</span>&nbsp;<span class="op" id="4322870">!=</span>&nbsp;<span class="ident" id="4322873">nil</span>&nbsp;<span class="op" id="4322877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322881">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322892">n</span>&nbsp;<span class="op" id="4322894">:=</span>&nbsp;<span class="ident" id="4322897">w</span><span class="op" id="4322898">.</span><span class="ident" id="4322899">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322907">if</span>&nbsp;<span class="ident" id="4322910">w</span><span class="op" id="4322911">.</span><span class="ident" id="4322912">nbits</span>&nbsp;<span class="op" id="4322918">==</span>&nbsp;<span class="num" id="4322921">8</span>&nbsp;<span class="op" id="4322923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322927">w</span><span class="op" id="4322928">.</span><span class="ident" id="4322929">bytes</span><span class="op" id="4322934">[</span><span class="ident" id="4322935">n</span><span class="op" id="4322936">]</span>&nbsp;<span class="op" id="4322938">=</span>&nbsp;<span class="builtintype" id="4322940">byte</span><span class="op" id="4322944">(</span><span class="ident" id="4322945">w</span><span class="op" id="4322946">.</span><span class="ident" id="4322947">bits</span><span class="op" id="4322951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322955">w</span><span class="op" id="4322956">.</span><span class="ident" id="4322957">nbits</span>&nbsp;<span class="op" id="4322963">=</span>&nbsp;<span class="num" id="4322965">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322969">n</span><span class="op" id="4322970">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4322974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4322977">if</span>&nbsp;<span class="ident" id="4322980">w</span><span class="op" id="4322981">.</span><span class="ident" id="4322982">nbits</span>&nbsp;<span class="op" id="4322988">!=</span>&nbsp;<span class="num" id="4322991">0</span>&nbsp;<span class="op" id="4322993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4322997">w</span><span class="op" id="4322998">.</span><span class="ident" id="4322999">err</span>&nbsp;<span class="op" id="4323003">=</span>&nbsp;<span class="ident" id="4323005">InternalError</span><span class="op" id="4323018">(</span><span class="string" id="4323019">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4323052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323056">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323067">if</span>&nbsp;<span class="ident" id="4323070">n</span>&nbsp;<span class="op" id="4323072">!=</span>&nbsp;<span class="num" id="4323075">0</span>&nbsp;<span class="op" id="4323077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323081">_</span><span class="op" id="4323082">,</span>&nbsp;<span class="ident" id="4323084">w</span><span class="op" id="4323085">.</span><span class="ident" id="4323086">err</span>&nbsp;<span class="op" id="4323090">=</span>&nbsp;<span class="ident" id="4323092">w</span><span class="op" id="4323093">.</span><span class="ident" id="4323094">w</span><span class="op" id="4323095">.</span><span class="ident" id="4323096">Write</span><span class="op" id="4323101">(</span><span class="ident" id="4323102">w</span><span class="op" id="4323103">.</span><span class="ident" id="4323104">bytes</span><span class="op" id="4323109">[</span><span class="num" id="4323110">0</span><span class="op" id="4323111">:</span><span class="ident" id="4323112">n</span><span class="op" id="4323113">]</span><span class="op" id="4323114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323118">if</span>&nbsp;<span class="ident" id="4323121">w</span><span class="op" id="4323122">.</span><span class="ident" id="4323123">err</span>&nbsp;<span class="op" id="4323127">!=</span>&nbsp;<span class="ident" id="4323130">nil</span>&nbsp;<span class="op" id="4323134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323139">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323154">w</span><span class="op" id="4323155">.</span><span class="ident" id="4323156">nbytes</span>&nbsp;<span class="op" id="4323163">=</span>&nbsp;<span class="num" id="4323165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323168">_</span><span class="op" id="4323169">,</span>&nbsp;<span class="ident" id="4323171">w</span><span class="op" id="4323172">.</span><span class="ident" id="4323173">err</span>&nbsp;<span class="op" id="4323177">=</span>&nbsp;<span class="ident" id="4323179">w</span><span class="op" id="4323180">.</span><span class="ident" id="4323181">w</span><span class="op" id="4323182">.</span><span class="ident" id="4323183">Write</span><span class="op" id="4323188">(</span><span class="ident" id="4323189">bytes</span><span class="op" id="4323194">)</span><br>
<span class="lineno"></span><span class="op" id="4323196">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4323199">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4323272">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4323351">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4323411">//</span><br>
<span class="lineno">200</span><span class="comment" id="4323414">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4323483">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4323538">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4323614">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4323661">//</span><br>
<span class="lineno">205</span><span class="comment" id="4323664">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4323727">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4323788">func</span>&nbsp;<span class="op" id="4323793">(</span><span class="ident" id="4323794">w</span>&nbsp;<span class="op" id="4323796">*</span><span class="ident" id="4323797">huffmanBitWriter</span><span class="op" id="4323813">)</span>&nbsp;<span class="ident" id="4323815">generateCodegen</span><span class="op" id="4323830">(</span><span class="ident" id="4323831">numLiterals</span>&nbsp;<span class="builtintype" id="4323843">int</span><span class="op" id="4323846">,</span>&nbsp;<span class="ident" id="4323848">numOffsets</span>&nbsp;<span class="builtintype" id="4323859">int</span><span class="op" id="4323862">)</span>&nbsp;<span class="op" id="4323864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4323867">for</span>&nbsp;<span class="ident" id="4323871">i</span>&nbsp;<span class="op" id="4323873">:=</span>&nbsp;<span class="keyword" id="4323876">range</span>&nbsp;<span class="ident" id="4323882">w</span><span class="op" id="4323883">.</span><span class="ident" id="4323884">codegenFreq</span>&nbsp;<span class="op" id="4323896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4323900">w</span><span class="op" id="4323901">.</span><span class="ident" id="4323902">codegenFreq</span><span class="op" id="4323913">[</span><span class="ident" id="4323914">i</span><span class="op" id="4323915">]</span>&nbsp;<span class="op" id="4323917">=</span>&nbsp;<span class="num" id="4323919">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4323922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4323925">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324001">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324074">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324148">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324160">codegen</span>&nbsp;<span class="op" id="4324168">:=</span>&nbsp;<span class="ident" id="4324171">w</span><span class="op" id="4324172">.</span><span class="ident" id="4324173">codegen</span>&nbsp;<span class="comment" id="4324181">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324191">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4324266">copy</span><span class="op" id="4324270">(</span><span class="ident" id="4324271">codegen</span><span class="op" id="4324278">[</span><span class="num" id="4324279">0</span><span class="op" id="4324280">:</span><span class="ident" id="4324281">numLiterals</span><span class="op" id="4324292">]</span><span class="op" id="4324293">,</span>&nbsp;<span class="ident" id="4324295">w</span><span class="op" id="4324296">.</span><span class="ident" id="4324297">literalEncoding</span><span class="op" id="4324312">.</span><span class="ident" id="4324313">codeBits</span><span class="op" id="4324321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4324324">copy</span><span class="op" id="4324328">(</span><span class="ident" id="4324329">codegen</span><span class="op" id="4324336">[</span><span class="ident" id="4324337">numLiterals</span><span class="op" id="4324348">:</span><span class="ident" id="4324349">numLiterals</span><span class="op" id="4324360">+</span><span class="ident" id="4324361">numOffsets</span><span class="op" id="4324371">]</span><span class="op" id="4324372">,</span>&nbsp;<span class="ident" id="4324374">w</span><span class="op" id="4324375">.</span><span class="ident" id="4324376">offsetEncoding</span><span class="op" id="4324390">.</span><span class="ident" id="4324391">codeBits</span><span class="op" id="4324399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324402">codegen</span><span class="op" id="4324409">[</span><span class="ident" id="4324410">numLiterals</span><span class="op" id="4324421">+</span><span class="ident" id="4324422">numOffsets</span><span class="op" id="4324432">]</span>&nbsp;<span class="op" id="4324434">=</span>&nbsp;<span class="ident" id="4324436">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324446">size</span>&nbsp;<span class="op" id="4324451">:=</span>&nbsp;<span class="ident" id="4324454">codegen</span><span class="op" id="4324461">[</span><span class="num" id="4324462">0</span><span class="op" id="4324463">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324466">count</span>&nbsp;<span class="op" id="4324472">:=</span>&nbsp;<span class="num" id="4324475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324478">outIndex</span>&nbsp;<span class="op" id="4324487">:=</span>&nbsp;<span class="num" id="4324490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324493">for</span>&nbsp;<span class="ident" id="4324497">inIndex</span>&nbsp;<span class="op" id="4324505">:=</span>&nbsp;<span class="num" id="4324508">1</span><span class="op" id="4324509">;</span>&nbsp;<span class="ident" id="4324511">size</span>&nbsp;<span class="op" id="4324516">!=</span>&nbsp;<span class="ident" id="4324519">badCode</span><span class="op" id="4324526">;</span>&nbsp;<span class="ident" id="4324528">inIndex</span><span class="op" id="4324535">++</span>&nbsp;<span class="op" id="4324538">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324542">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324612">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324648">nextSize</span>&nbsp;<span class="op" id="4324657">:=</span>&nbsp;<span class="ident" id="4324660">codegen</span><span class="op" id="4324667">[</span><span class="ident" id="4324668">inIndex</span><span class="op" id="4324675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324679">if</span>&nbsp;<span class="ident" id="4324682">nextSize</span>&nbsp;<span class="op" id="4324691">==</span>&nbsp;<span class="ident" id="4324694">size</span>&nbsp;<span class="op" id="4324699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324704">count</span><span class="op" id="4324709">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324715">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4324726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4324730">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324791">if</span>&nbsp;<span class="ident" id="4324794">size</span>&nbsp;<span class="op" id="4324799">!=</span>&nbsp;<span class="num" id="4324802">0</span>&nbsp;<span class="op" id="4324804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324809">codegen</span><span class="op" id="4324816">[</span><span class="ident" id="4324817">outIndex</span><span class="op" id="4324825">]</span>&nbsp;<span class="op" id="4324827">=</span>&nbsp;<span class="ident" id="4324829">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324837">outIndex</span><span class="op" id="4324845">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324851">w</span><span class="op" id="4324852">.</span><span class="ident" id="4324853">codegenFreq</span><span class="op" id="4324864">[</span><span class="ident" id="4324865">size</span><span class="op" id="4324869">]</span><span class="op" id="4324870">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324876">count</span><span class="op" id="4324881">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324887">for</span>&nbsp;<span class="ident" id="4324891">count</span>&nbsp;<span class="op" id="4324897">&gt;=</span>&nbsp;<span class="num" id="4324900">3</span>&nbsp;<span class="op" id="4324902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324908">n</span>&nbsp;<span class="op" id="4324910">:=</span>&nbsp;<span class="num" id="4324913">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4324919">if</span>&nbsp;<span class="ident" id="4324922">n</span>&nbsp;<span class="op" id="4324924">&gt;</span>&nbsp;<span class="ident" id="4324926">count</span>&nbsp;<span class="op" id="4324932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324939">n</span>&nbsp;<span class="op" id="4324941">=</span>&nbsp;<span class="ident" id="4324943">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4324953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324959">codegen</span><span class="op" id="4324966">[</span><span class="ident" id="4324967">outIndex</span><span class="op" id="4324975">]</span>&nbsp;<span class="op" id="4324977">=</span>&nbsp;<span class="num" id="4324979">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4324986">outIndex</span><span class="op" id="4324994">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325001">codegen</span><span class="op" id="4325008">[</span><span class="ident" id="4325009">outIndex</span><span class="op" id="4325017">]</span>&nbsp;<span class="op" id="4325019">=</span>&nbsp;<span class="builtintype" id="4325021">uint8</span><span class="op" id="4325026">(</span><span class="ident" id="4325027">n</span>&nbsp;<span class="op" id="4325029">-</span>&nbsp;<span class="num" id="4325031">3</span><span class="op" id="4325032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325038">outIndex</span><span class="op" id="4325046">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325053">w</span><span class="op" id="4325054">.</span><span class="ident" id="4325055">codegenFreq</span><span class="op" id="4325066">[</span><span class="num" id="4325067">16</span><span class="op" id="4325069">]</span><span class="op" id="4325070">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325077">count</span>&nbsp;<span class="op" id="4325083">-=</span>&nbsp;<span class="ident" id="4325086">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325091">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325095">}</span>&nbsp;<span class="keyword" id="4325097">else</span>&nbsp;<span class="op" id="4325102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325107">for</span>&nbsp;<span class="ident" id="4325111">count</span>&nbsp;<span class="op" id="4325117">&gt;=</span>&nbsp;<span class="num" id="4325120">11</span>&nbsp;<span class="op" id="4325123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325129">n</span>&nbsp;<span class="op" id="4325131">:=</span>&nbsp;<span class="num" id="4325134">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325142">if</span>&nbsp;<span class="ident" id="4325145">n</span>&nbsp;<span class="op" id="4325147">&gt;</span>&nbsp;<span class="ident" id="4325149">count</span>&nbsp;<span class="op" id="4325155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325162">n</span>&nbsp;<span class="op" id="4325164">=</span>&nbsp;<span class="ident" id="4325166">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325182">codegen</span><span class="op" id="4325189">[</span><span class="ident" id="4325190">outIndex</span><span class="op" id="4325198">]</span>&nbsp;<span class="op" id="4325200">=</span>&nbsp;<span class="num" id="4325202">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325209">outIndex</span><span class="op" id="4325217">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325224">codegen</span><span class="op" id="4325231">[</span><span class="ident" id="4325232">outIndex</span><span class="op" id="4325240">]</span>&nbsp;<span class="op" id="4325242">=</span>&nbsp;<span class="builtintype" id="4325244">uint8</span><span class="op" id="4325249">(</span><span class="ident" id="4325250">n</span>&nbsp;<span class="op" id="4325252">-</span>&nbsp;<span class="num" id="4325254">11</span><span class="op" id="4325256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325262">outIndex</span><span class="op" id="4325270">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325277">w</span><span class="op" id="4325278">.</span><span class="ident" id="4325279">codegenFreq</span><span class="op" id="4325290">[</span><span class="num" id="4325291">18</span><span class="op" id="4325293">]</span><span class="op" id="4325294">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325301">count</span>&nbsp;<span class="op" id="4325307">-=</span>&nbsp;<span class="ident" id="4325310">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325320">if</span>&nbsp;<span class="ident" id="4325323">count</span>&nbsp;<span class="op" id="4325329">&gt;=</span>&nbsp;<span class="num" id="4325332">3</span>&nbsp;<span class="op" id="4325334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4325340">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325373">codegen</span><span class="op" id="4325380">[</span><span class="ident" id="4325381">outIndex</span><span class="op" id="4325389">]</span>&nbsp;<span class="op" id="4325391">=</span>&nbsp;<span class="num" id="4325393">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325400">outIndex</span><span class="op" id="4325408">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325415">codegen</span><span class="op" id="4325422">[</span><span class="ident" id="4325423">outIndex</span><span class="op" id="4325431">]</span>&nbsp;<span class="op" id="4325433">=</span>&nbsp;<span class="builtintype" id="4325435">uint8</span><span class="op" id="4325440">(</span><span class="ident" id="4325441">count</span>&nbsp;<span class="op" id="4325447">-</span>&nbsp;<span class="num" id="4325449">3</span><span class="op" id="4325450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325456">outIndex</span><span class="op" id="4325464">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325471">w</span><span class="op" id="4325472">.</span><span class="ident" id="4325473">codegenFreq</span><span class="op" id="4325484">[</span><span class="num" id="4325485">17</span><span class="op" id="4325487">]</span><span class="op" id="4325488">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325495">count</span>&nbsp;<span class="op" id="4325501">=</span>&nbsp;<span class="num" id="4325503">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325516">count</span><span class="op" id="4325521">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325526">for</span>&nbsp;<span class="op" id="4325530">;</span>&nbsp;<span class="ident" id="4325532">count</span>&nbsp;<span class="op" id="4325538">&gt;=</span>&nbsp;<span class="num" id="4325541">0</span><span class="op" id="4325542">;</span>&nbsp;<span class="ident" id="4325544">count</span><span class="op" id="4325549">--</span>&nbsp;<span class="op" id="4325552">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325557">codegen</span><span class="op" id="4325564">[</span><span class="ident" id="4325565">outIndex</span><span class="op" id="4325573">]</span>&nbsp;<span class="op" id="4325575">=</span>&nbsp;<span class="ident" id="4325577">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325585">outIndex</span><span class="op" id="4325593">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325599">w</span><span class="op" id="4325600">.</span><span class="ident" id="4325601">codegenFreq</span><span class="op" id="4325612">[</span><span class="ident" id="4325613">size</span><span class="op" id="4325617">]</span><span class="op" id="4325618">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4325627">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325681">size</span>&nbsp;<span class="op" id="4325686">=</span>&nbsp;<span class="ident" id="4325688">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325699">count</span>&nbsp;<span class="op" id="4325705">=</span>&nbsp;<span class="num" id="4325707">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4325713">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325759">codegen</span><span class="op" id="4325766">[</span><span class="ident" id="4325767">outIndex</span><span class="op" id="4325775">]</span>&nbsp;<span class="op" id="4325777">=</span>&nbsp;<span class="ident" id="4325779">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4325787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4325790">func</span>&nbsp;<span class="op" id="4325795">(</span><span class="ident" id="4325796">w</span>&nbsp;<span class="op" id="4325798">*</span><span class="ident" id="4325799">huffmanBitWriter</span><span class="op" id="4325815">)</span>&nbsp;<span class="ident" id="4325817">writeCode</span><span class="op" id="4325826">(</span><span class="ident" id="4325827">code</span>&nbsp;<span class="op" id="4325832">*</span><span class="ident" id="4325833">huffmanEncoder</span><span class="op" id="4325847">,</span>&nbsp;<span class="ident" id="4325849">literal</span>&nbsp;<span class="builtintype" id="4325857">uint32</span><span class="op" id="4325863">)</span>&nbsp;<span class="op" id="4325865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325868">if</span>&nbsp;<span class="ident" id="4325871">w</span><span class="op" id="4325872">.</span><span class="ident" id="4325873">err</span>&nbsp;<span class="op" id="4325877">!=</span>&nbsp;<span class="ident" id="4325880">nil</span>&nbsp;<span class="op" id="4325884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4325888">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4325896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4325899">w</span><span class="op" id="4325900">.</span><span class="ident" id="4325901">writeBits</span><span class="op" id="4325910">(</span><span class="builtintype" id="4325911">int32</span><span class="op" id="4325916">(</span><span class="ident" id="4325917">code</span><span class="op" id="4325921">.</span><span class="ident" id="4325922">code</span><span class="op" id="4325926">[</span><span class="ident" id="4325927">literal</span><span class="op" id="4325934">]</span><span class="op" id="4325935">)</span><span class="op" id="4325936">,</span>&nbsp;<span class="builtintype" id="4325938">int32</span><span class="op" id="4325943">(</span><span class="ident" id="4325944">code</span><span class="op" id="4325948">.</span><span class="ident" id="4325949">codeBits</span><span class="op" id="4325957">[</span><span class="ident" id="4325958">literal</span><span class="op" id="4325965">]</span><span class="op" id="4325966">)</span><span class="op" id="4325967">)</span><br>
<span class="lineno"></span><span class="op" id="4325969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4325972">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4326041">//</span><br>
<span class="lineno"></span><span class="comment" id="4326044">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4326105">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4326165">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4326221">func</span>&nbsp;<span class="op" id="4326226">(</span><span class="ident" id="4326227">w</span>&nbsp;<span class="op" id="4326229">*</span><span class="ident" id="4326230">huffmanBitWriter</span><span class="op" id="4326246">)</span>&nbsp;<span class="ident" id="4326248">writeDynamicHeader</span><span class="op" id="4326266">(</span><span class="ident" id="4326267">numLiterals</span>&nbsp;<span class="builtintype" id="4326279">int</span><span class="op" id="4326282">,</span>&nbsp;<span class="ident" id="4326284">numOffsets</span>&nbsp;<span class="builtintype" id="4326295">int</span><span class="op" id="4326298">,</span>&nbsp;<span class="ident" id="4326300">numCodegens</span>&nbsp;<span class="builtintype" id="4326312">int</span><span class="op" id="4326315">,</span>&nbsp;<span class="ident" id="4326317">isEof</span>&nbsp;<span class="builtintype" id="4326323">bool</span><span class="op" id="4326327">)</span>&nbsp;<span class="op" id="4326329">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326332">if</span>&nbsp;<span class="ident" id="4326335">w</span><span class="op" id="4326336">.</span><span class="ident" id="4326337">err</span>&nbsp;<span class="op" id="4326341">!=</span>&nbsp;<span class="ident" id="4326344">nil</span>&nbsp;<span class="op" id="4326348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326352">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4326360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326363">var</span>&nbsp;<span class="ident" id="4326367">firstBits</span>&nbsp;<span class="builtintype" id="4326377">int32</span>&nbsp;<span class="op" id="4326383">=</span>&nbsp;<span class="num" id="4326385">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326388">if</span>&nbsp;<span class="ident" id="4326391">isEof</span>&nbsp;<span class="op" id="4326397">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326401">firstBits</span>&nbsp;<span class="op" id="4326411">=</span>&nbsp;<span class="num" id="4326413">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4326416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326419">w</span><span class="op" id="4326420">.</span><span class="ident" id="4326421">writeBits</span><span class="op" id="4326430">(</span><span class="ident" id="4326431">firstBits</span><span class="op" id="4326440">,</span>&nbsp;<span class="num" id="4326442">3</span><span class="op" id="4326443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326446">w</span><span class="op" id="4326447">.</span><span class="ident" id="4326448">writeBits</span><span class="op" id="4326457">(</span><span class="builtintype" id="4326458">int32</span><span class="op" id="4326463">(</span><span class="ident" id="4326464">numLiterals</span><span class="op" id="4326475">-</span><span class="num" id="4326476">257</span><span class="op" id="4326479">)</span><span class="op" id="4326480">,</span>&nbsp;<span class="num" id="4326482">5</span><span class="op" id="4326483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326486">w</span><span class="op" id="4326487">.</span><span class="ident" id="4326488">writeBits</span><span class="op" id="4326497">(</span><span class="builtintype" id="4326498">int32</span><span class="op" id="4326503">(</span><span class="ident" id="4326504">numOffsets</span><span class="op" id="4326514">-</span><span class="num" id="4326515">1</span><span class="op" id="4326516">)</span><span class="op" id="4326517">,</span>&nbsp;<span class="num" id="4326519">5</span><span class="op" id="4326520">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326523">w</span><span class="op" id="4326524">.</span><span class="ident" id="4326525">writeBits</span><span class="op" id="4326534">(</span><span class="builtintype" id="4326535">int32</span><span class="op" id="4326540">(</span><span class="ident" id="4326541">numCodegens</span><span class="op" id="4326552">-</span><span class="num" id="4326553">4</span><span class="op" id="4326554">)</span><span class="op" id="4326555">,</span>&nbsp;<span class="num" id="4326557">4</span><span class="op" id="4326558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326562">for</span>&nbsp;<span class="ident" id="4326566">i</span>&nbsp;<span class="op" id="4326568">:=</span>&nbsp;<span class="num" id="4326571">0</span><span class="op" id="4326572">;</span>&nbsp;<span class="ident" id="4326574">i</span>&nbsp;<span class="op" id="4326576">&lt;</span>&nbsp;<span class="ident" id="4326578">numCodegens</span><span class="op" id="4326589">;</span>&nbsp;<span class="ident" id="4326591">i</span><span class="op" id="4326592">++</span>&nbsp;<span class="op" id="4326595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326599">value</span>&nbsp;<span class="op" id="4326605">:=</span>&nbsp;<span class="ident" id="4326608">w</span><span class="op" id="4326609">.</span><span class="ident" id="4326610">codegenEncoding</span><span class="op" id="4326625">.</span><span class="ident" id="4326626">codeBits</span><span class="op" id="4326634">[</span><span class="ident" id="4326635">codegenOrder</span><span class="op" id="4326647">[</span><span class="ident" id="4326648">i</span><span class="op" id="4326649">]</span><span class="op" id="4326650">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326654">w</span><span class="op" id="4326655">.</span><span class="ident" id="4326656">writeBits</span><span class="op" id="4326665">(</span><span class="builtintype" id="4326666">int32</span><span class="op" id="4326671">(</span><span class="ident" id="4326672">value</span><span class="op" id="4326677">)</span><span class="op" id="4326678">,</span>&nbsp;<span class="num" id="4326680">3</span><span class="op" id="4326681">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4326684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326688">i</span>&nbsp;<span class="op" id="4326690">:=</span>&nbsp;<span class="num" id="4326693">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326696">for</span>&nbsp;<span class="op" id="4326700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326704">var</span>&nbsp;<span class="ident" id="4326708">codeWord</span>&nbsp;<span class="builtintype" id="4326717">int</span>&nbsp;<span class="op" id="4326721">=</span>&nbsp;<span class="builtintype" id="4326723">int</span><span class="op" id="4326726">(</span><span class="ident" id="4326727">w</span><span class="op" id="4326728">.</span><span class="ident" id="4326729">codegen</span><span class="op" id="4326736">[</span><span class="ident" id="4326737">i</span><span class="op" id="4326738">]</span><span class="op" id="4326739">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326743">i</span><span class="op" id="4326744">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326749">if</span>&nbsp;<span class="ident" id="4326752">codeWord</span>&nbsp;<span class="op" id="4326761">==</span>&nbsp;<span class="ident" id="4326764">badCode</span>&nbsp;<span class="op" id="4326772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326777">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4326785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4326789">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326845">w</span><span class="op" id="4326846">.</span><span class="ident" id="4326847">writeCode</span><span class="op" id="4326856">(</span><span class="ident" id="4326857">w</span><span class="op" id="4326858">.</span><span class="ident" id="4326859">codegenEncoding</span><span class="op" id="4326874">,</span>&nbsp;<span class="builtintype" id="4326876">uint32</span><span class="op" id="4326882">(</span><span class="ident" id="4326883">codeWord</span><span class="op" id="4326891">)</span><span class="op" id="4326892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326897">switch</span>&nbsp;<span class="ident" id="4326904">codeWord</span>&nbsp;<span class="op" id="4326913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326917">case</span>&nbsp;<span class="num" id="4326922">16</span><span class="op" id="4326924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326929">w</span><span class="op" id="4326930">.</span><span class="ident" id="4326931">writeBits</span><span class="op" id="4326940">(</span><span class="builtintype" id="4326941">int32</span><span class="op" id="4326946">(</span><span class="ident" id="4326947">w</span><span class="op" id="4326948">.</span><span class="ident" id="4326949">codegen</span><span class="op" id="4326956">[</span><span class="ident" id="4326957">i</span><span class="op" id="4326958">]</span><span class="op" id="4326959">)</span><span class="op" id="4326960">,</span>&nbsp;<span class="num" id="4326962">2</span><span class="op" id="4326963">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326968">i</span><span class="op" id="4326969">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326975">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4326983">case</span>&nbsp;<span class="num" id="4326988">17</span><span class="op" id="4326990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4326995">w</span><span class="op" id="4326996">.</span><span class="ident" id="4326997">writeBits</span><span class="op" id="4327006">(</span><span class="builtintype" id="4327007">int32</span><span class="op" id="4327012">(</span><span class="ident" id="4327013">w</span><span class="op" id="4327014">.</span><span class="ident" id="4327015">codegen</span><span class="op" id="4327022">[</span><span class="ident" id="4327023">i</span><span class="op" id="4327024">]</span><span class="op" id="4327025">)</span><span class="op" id="4327026">,</span>&nbsp;<span class="num" id="4327028">3</span><span class="op" id="4327029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327034">i</span><span class="op" id="4327035">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327041">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327049">case</span>&nbsp;<span class="num" id="4327054">18</span><span class="op" id="4327056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327061">w</span><span class="op" id="4327062">.</span><span class="ident" id="4327063">writeBits</span><span class="op" id="4327072">(</span><span class="builtintype" id="4327073">int32</span><span class="op" id="4327078">(</span><span class="ident" id="4327079">w</span><span class="op" id="4327080">.</span><span class="ident" id="4327081">codegen</span><span class="op" id="4327088">[</span><span class="ident" id="4327089">i</span><span class="op" id="4327090">]</span><span class="op" id="4327091">)</span><span class="op" id="4327092">,</span>&nbsp;<span class="num" id="4327094">7</span><span class="op" id="4327095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327100">i</span><span class="op" id="4327101">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327107">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327118">}</span><br>
<span class="lineno"></span><span class="op" id="4327120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4327123">func</span>&nbsp;<span class="op" id="4327128">(</span><span class="ident" id="4327129">w</span>&nbsp;<span class="op" id="4327131">*</span><span class="ident" id="4327132">huffmanBitWriter</span><span class="op" id="4327148">)</span>&nbsp;<span class="ident" id="4327150">writeStoredHeader</span><span class="op" id="4327167">(</span><span class="ident" id="4327168">length</span>&nbsp;<span class="builtintype" id="4327175">int</span><span class="op" id="4327178">,</span>&nbsp;<span class="ident" id="4327180">isEof</span>&nbsp;<span class="builtintype" id="4327186">bool</span><span class="op" id="4327190">)</span>&nbsp;<span class="op" id="4327192">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327195">if</span>&nbsp;<span class="ident" id="4327198">w</span><span class="op" id="4327199">.</span><span class="ident" id="4327200">err</span>&nbsp;<span class="op" id="4327204">!=</span>&nbsp;<span class="ident" id="4327207">nil</span>&nbsp;<span class="op" id="4327211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327215">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327226">var</span>&nbsp;<span class="ident" id="4327230">flag</span>&nbsp;<span class="builtintype" id="4327235">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327242">if</span>&nbsp;<span class="ident" id="4327245">isEof</span>&nbsp;<span class="op" id="4327251">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327255">flag</span>&nbsp;<span class="op" id="4327260">=</span>&nbsp;<span class="num" id="4327262">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327268">w</span><span class="op" id="4327269">.</span><span class="ident" id="4327270">writeBits</span><span class="op" id="4327279">(</span><span class="ident" id="4327280">flag</span><span class="op" id="4327284">,</span>&nbsp;<span class="num" id="4327286">3</span><span class="op" id="4327287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327290">w</span><span class="op" id="4327291">.</span><span class="ident" id="4327292">flush</span><span class="op" id="4327297">(</span><span class="op" id="4327298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327301">w</span><span class="op" id="4327302">.</span><span class="ident" id="4327303">writeBits</span><span class="op" id="4327312">(</span><span class="builtintype" id="4327313">int32</span><span class="op" id="4327318">(</span><span class="ident" id="4327319">length</span><span class="op" id="4327325">)</span><span class="op" id="4327326">,</span>&nbsp;<span class="num" id="4327328">16</span><span class="op" id="4327330">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327333">w</span><span class="op" id="4327334">.</span><span class="ident" id="4327335">writeBits</span><span class="op" id="4327344">(</span><span class="builtintype" id="4327345">int32</span><span class="op" id="4327350">(</span><span class="op" id="4327351">^</span><span class="builtintype" id="4327352">uint16</span><span class="op" id="4327358">(</span><span class="ident" id="4327359">length</span><span class="op" id="4327365">)</span><span class="op" id="4327366">)</span><span class="op" id="4327367">,</span>&nbsp;<span class="num" id="4327369">16</span><span class="op" id="4327371">)</span><br>
<span class="lineno"></span><span class="op" id="4327373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4327376">func</span>&nbsp;<span class="op" id="4327381">(</span><span class="ident" id="4327382">w</span>&nbsp;<span class="op" id="4327384">*</span><span class="ident" id="4327385">huffmanBitWriter</span><span class="op" id="4327401">)</span>&nbsp;<span class="ident" id="4327403">writeFixedHeader</span><span class="op" id="4327419">(</span><span class="ident" id="4327420">isEof</span>&nbsp;<span class="builtintype" id="4327426">bool</span><span class="op" id="4327430">)</span>&nbsp;<span class="op" id="4327432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327435">if</span>&nbsp;<span class="ident" id="4327438">w</span><span class="op" id="4327439">.</span><span class="ident" id="4327440">err</span>&nbsp;<span class="op" id="4327444">!=</span>&nbsp;<span class="ident" id="4327447">nil</span>&nbsp;<span class="op" id="4327451">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327455">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4327466">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327513">var</span>&nbsp;<span class="ident" id="4327517">value</span>&nbsp;<span class="builtintype" id="4327523">int32</span>&nbsp;<span class="op" id="4327529">=</span>&nbsp;<span class="num" id="4327531">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327534">if</span>&nbsp;<span class="ident" id="4327537">isEof</span>&nbsp;<span class="op" id="4327543">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327547">value</span>&nbsp;<span class="op" id="4327553">=</span>&nbsp;<span class="num" id="4327555">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327561">w</span><span class="op" id="4327562">.</span><span class="ident" id="4327563">writeBits</span><span class="op" id="4327572">(</span><span class="ident" id="4327573">value</span><span class="op" id="4327578">,</span>&nbsp;<span class="num" id="4327580">3</span><span class="op" id="4327581">)</span><br>
<span class="lineno"></span><span class="op" id="4327583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4327586">func</span>&nbsp;<span class="op" id="4327591">(</span><span class="ident" id="4327592">w</span>&nbsp;<span class="op" id="4327594">*</span><span class="ident" id="4327595">huffmanBitWriter</span><span class="op" id="4327611">)</span>&nbsp;<span class="ident" id="4327613">writeBlock</span><span class="op" id="4327623">(</span><span class="ident" id="4327624">tokens</span>&nbsp;<span class="op" id="4327631">[</span><span class="op" id="4327632">]</span><span class="ident" id="4327633">token</span><span class="op" id="4327638">,</span>&nbsp;<span class="ident" id="4327640">eof</span>&nbsp;<span class="builtintype" id="4327644">bool</span><span class="op" id="4327648">,</span>&nbsp;<span class="ident" id="4327650">input</span>&nbsp;<span class="op" id="4327656">[</span><span class="op" id="4327657">]</span><span class="builtintype" id="4327658">byte</span><span class="op" id="4327662">)</span>&nbsp;<span class="op" id="4327664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327667">if</span>&nbsp;<span class="ident" id="4327670">w</span><span class="op" id="4327671">.</span><span class="ident" id="4327672">err</span>&nbsp;<span class="op" id="4327676">!=</span>&nbsp;<span class="ident" id="4327679">nil</span>&nbsp;<span class="op" id="4327683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327698">for</span>&nbsp;<span class="ident" id="4327702">i</span>&nbsp;<span class="op" id="4327704">:=</span>&nbsp;<span class="keyword" id="4327707">range</span>&nbsp;<span class="ident" id="4327713">w</span><span class="op" id="4327714">.</span><span class="ident" id="4327715">literalFreq</span>&nbsp;<span class="op" id="4327727">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327731">w</span><span class="op" id="4327732">.</span><span class="ident" id="4327733">literalFreq</span><span class="op" id="4327744">[</span><span class="ident" id="4327745">i</span><span class="op" id="4327746">]</span>&nbsp;<span class="op" id="4327748">=</span>&nbsp;<span class="num" id="4327750">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327756">for</span>&nbsp;<span class="ident" id="4327760">i</span>&nbsp;<span class="op" id="4327762">:=</span>&nbsp;<span class="keyword" id="4327765">range</span>&nbsp;<span class="ident" id="4327771">w</span><span class="op" id="4327772">.</span><span class="ident" id="4327773">offsetFreq</span>&nbsp;<span class="op" id="4327784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327788">w</span><span class="op" id="4327789">.</span><span class="ident" id="4327790">offsetFreq</span><span class="op" id="4327800">[</span><span class="ident" id="4327801">i</span><span class="op" id="4327802">]</span>&nbsp;<span class="op" id="4327804">=</span>&nbsp;<span class="num" id="4327806">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4327809">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327813">n</span>&nbsp;<span class="op" id="4327815">:=</span>&nbsp;<span class="builtinfunc" id="4327818">len</span><span class="op" id="4327821">(</span><span class="ident" id="4327822">tokens</span><span class="op" id="4327828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327831">tokens</span>&nbsp;<span class="op" id="4327838">=</span>&nbsp;<span class="ident" id="4327840">tokens</span><span class="op" id="4327846">[</span><span class="num" id="4327847">0</span>&nbsp;<span class="op" id="4327849">:</span>&nbsp;<span class="ident" id="4327851">n</span><span class="op" id="4327852">+</span><span class="num" id="4327853">1</span><span class="op" id="4327854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327857">tokens</span><span class="op" id="4327863">[</span><span class="ident" id="4327864">n</span><span class="op" id="4327865">]</span>&nbsp;<span class="op" id="4327867">=</span>&nbsp;<span class="ident" id="4327869">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327886">for</span>&nbsp;<span class="ident" id="4327890">_</span><span class="op" id="4327891">,</span>&nbsp;<span class="ident" id="4327893">t</span>&nbsp;<span class="op" id="4327895">:=</span>&nbsp;<span class="keyword" id="4327898">range</span>&nbsp;<span class="ident" id="4327904">tokens</span>&nbsp;<span class="op" id="4327911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327915">switch</span>&nbsp;<span class="ident" id="4327922">t</span><span class="op" id="4327923">.</span><span class="ident" id="4327924">typ</span><span class="op" id="4327927">(</span><span class="op" id="4327928">)</span>&nbsp;<span class="op" id="4327930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327934">case</span>&nbsp;<span class="ident" id="4327939">literalType</span><span class="op" id="4327950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4327955">w</span><span class="op" id="4327956">.</span><span class="ident" id="4327957">literalFreq</span><span class="op" id="4327968">[</span><span class="ident" id="4327969">t</span><span class="op" id="4327970">.</span><span class="ident" id="4327971">literal</span><span class="op" id="4327978">(</span><span class="op" id="4327979">)</span><span class="op" id="4327980">]</span><span class="op" id="4327981">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4327986">case</span>&nbsp;<span class="ident" id="4327991">matchType</span><span class="op" id="4328000">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328005">length</span>&nbsp;<span class="op" id="4328012">:=</span>&nbsp;<span class="ident" id="4328015">t</span><span class="op" id="4328016">.</span><span class="ident" id="4328017">length</span><span class="op" id="4328023">(</span><span class="op" id="4328024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328029">offset</span>&nbsp;<span class="op" id="4328036">:=</span>&nbsp;<span class="ident" id="4328039">t</span><span class="op" id="4328040">.</span><span class="ident" id="4328041">offset</span><span class="op" id="4328047">(</span><span class="op" id="4328048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328053">w</span><span class="op" id="4328054">.</span><span class="ident" id="4328055">literalFreq</span><span class="op" id="4328066">[</span><span class="ident" id="4328067">lengthCodesStart</span><span class="op" id="4328083">+</span><span class="ident" id="4328084">lengthCode</span><span class="op" id="4328094">(</span><span class="ident" id="4328095">length</span><span class="op" id="4328101">)</span><span class="op" id="4328102">]</span><span class="op" id="4328103">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328109">w</span><span class="op" id="4328110">.</span><span class="ident" id="4328111">offsetFreq</span><span class="op" id="4328121">[</span><span class="ident" id="4328122">offsetCode</span><span class="op" id="4328132">(</span><span class="ident" id="4328133">offset</span><span class="op" id="4328139">)</span><span class="op" id="4328140">]</span><span class="op" id="4328141">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328146">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4328153">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328184">numLiterals</span>&nbsp;<span class="op" id="4328196">:=</span>&nbsp;<span class="builtinfunc" id="4328199">len</span><span class="op" id="4328202">(</span><span class="ident" id="4328203">w</span><span class="op" id="4328204">.</span><span class="ident" id="4328205">literalFreq</span><span class="op" id="4328216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328219">for</span>&nbsp;<span class="ident" id="4328223">w</span><span class="op" id="4328224">.</span><span class="ident" id="4328225">literalFreq</span><span class="op" id="4328236">[</span><span class="ident" id="4328237">numLiterals</span><span class="op" id="4328248">-</span><span class="num" id="4328249">1</span><span class="op" id="4328250">]</span>&nbsp;<span class="op" id="4328252">==</span>&nbsp;<span class="num" id="4328255">0</span>&nbsp;<span class="op" id="4328257">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328261">numLiterals</span><span class="op" id="4328272">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4328279">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328309">numOffsets</span>&nbsp;<span class="op" id="4328320">:=</span>&nbsp;<span class="builtinfunc" id="4328323">len</span><span class="op" id="4328326">(</span><span class="ident" id="4328327">w</span><span class="op" id="4328328">.</span><span class="ident" id="4328329">offsetFreq</span><span class="op" id="4328339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328342">for</span>&nbsp;<span class="ident" id="4328346">numOffsets</span>&nbsp;<span class="op" id="4328357">&gt;</span>&nbsp;<span class="num" id="4328359">0</span>&nbsp;<span class="op" id="4328361">&amp;&amp;</span>&nbsp;<span class="ident" id="4328364">w</span><span class="op" id="4328365">.</span><span class="ident" id="4328366">offsetFreq</span><span class="op" id="4328376">[</span><span class="ident" id="4328377">numOffsets</span><span class="op" id="4328387">-</span><span class="num" id="4328388">1</span><span class="op" id="4328389">]</span>&nbsp;<span class="op" id="4328391">==</span>&nbsp;<span class="num" id="4328394">0</span>&nbsp;<span class="op" id="4328396">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328400">numOffsets</span><span class="op" id="4328410">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328417">if</span>&nbsp;<span class="ident" id="4328420">numOffsets</span>&nbsp;<span class="op" id="4328431">==</span>&nbsp;<span class="num" id="4328434">0</span>&nbsp;<span class="op" id="4328436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4328440">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4328522">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328621">w</span><span class="op" id="4328622">.</span><span class="ident" id="4328623">offsetFreq</span><span class="op" id="4328633">[</span><span class="num" id="4328634">0</span><span class="op" id="4328635">]</span>&nbsp;<span class="op" id="4328637">=</span>&nbsp;<span class="num" id="4328639">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328643">numOffsets</span>&nbsp;<span class="op" id="4328654">=</span>&nbsp;<span class="num" id="4328656">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328663">w</span><span class="op" id="4328664">.</span><span class="ident" id="4328665">literalEncoding</span><span class="op" id="4328680">.</span><span class="ident" id="4328681">generate</span><span class="op" id="4328689">(</span><span class="ident" id="4328690">w</span><span class="op" id="4328691">.</span><span class="ident" id="4328692">literalFreq</span><span class="op" id="4328703">,</span>&nbsp;<span class="num" id="4328705">15</span><span class="op" id="4328707">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328710">w</span><span class="op" id="4328711">.</span><span class="ident" id="4328712">offsetEncoding</span><span class="op" id="4328726">.</span><span class="ident" id="4328727">generate</span><span class="op" id="4328735">(</span><span class="ident" id="4328736">w</span><span class="op" id="4328737">.</span><span class="ident" id="4328738">offsetFreq</span><span class="op" id="4328748">,</span>&nbsp;<span class="num" id="4328750">15</span><span class="op" id="4328752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328756">storedBytes</span>&nbsp;<span class="op" id="4328768">:=</span>&nbsp;<span class="num" id="4328771">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328774">if</span>&nbsp;<span class="ident" id="4328777">input</span>&nbsp;<span class="op" id="4328783">!=</span>&nbsp;<span class="ident" id="4328786">nil</span>&nbsp;<span class="op" id="4328790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328794">storedBytes</span>&nbsp;<span class="op" id="4328806">=</span>&nbsp;<span class="builtinfunc" id="4328808">len</span><span class="op" id="4328811">(</span><span class="ident" id="4328812">input</span><span class="op" id="4328817">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4328820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328823">var</span>&nbsp;<span class="ident" id="4328827">extraBits</span>&nbsp;<span class="ident" id="4328837">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328844">var</span>&nbsp;<span class="ident" id="4328848">storedSize</span>&nbsp;<span class="ident" id="4328859">int64</span>&nbsp;<span class="op" id="4328865">=</span>&nbsp;<span class="ident" id="4328867">math</span><span class="op" id="4328871">.</span><span class="ident" id="4328872">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4328882">if</span>&nbsp;<span class="ident" id="4328885">storedBytes</span>&nbsp;<span class="op" id="4328897">&lt;=</span>&nbsp;<span class="ident" id="4328900">maxStoreBlockSize</span>&nbsp;<span class="op" id="4328918">&amp;&amp;</span>&nbsp;<span class="ident" id="4328921">input</span>&nbsp;<span class="op" id="4328927">!=</span>&nbsp;<span class="ident" id="4328930">nil</span>&nbsp;<span class="op" id="4328934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4328938">storedSize</span>&nbsp;<span class="op" id="4328949">=</span>&nbsp;<span class="ident" id="4328951">int64</span><span class="op" id="4328956">(</span><span class="op" id="4328957">(</span><span class="ident" id="4328958">storedBytes</span>&nbsp;<span class="op" id="4328970">+</span>&nbsp;<span class="num" id="4328972">5</span><span class="op" id="4328973">)</span>&nbsp;<span class="op" id="4328975">*</span>&nbsp;<span class="num" id="4328977">8</span><span class="op" id="4328978">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4328982">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329054">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329126">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329196">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329226">for</span>&nbsp;<span class="ident" id="4329230">lengthCode</span>&nbsp;<span class="op" id="4329241">:=</span>&nbsp;<span class="ident" id="4329244">lengthCodesStart</span>&nbsp;<span class="op" id="4329261">+</span>&nbsp;<span class="num" id="4329263">8</span><span class="op" id="4329264">;</span>&nbsp;<span class="ident" id="4329266">lengthCode</span>&nbsp;<span class="op" id="4329277">&lt;</span>&nbsp;<span class="ident" id="4329279">numLiterals</span><span class="op" id="4329290">;</span>&nbsp;<span class="ident" id="4329292">lengthCode</span><span class="op" id="4329302">++</span>&nbsp;<span class="op" id="4329305">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329310">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4329362">extraBits</span>&nbsp;<span class="op" id="4329372">+=</span>&nbsp;<span class="ident" id="4329375">int64</span><span class="op" id="4329380">(</span><span class="ident" id="4329381">w</span><span class="op" id="4329382">.</span><span class="ident" id="4329383">literalFreq</span><span class="op" id="4329394">[</span><span class="ident" id="4329395">lengthCode</span><span class="op" id="4329405">]</span><span class="op" id="4329406">)</span>&nbsp;<span class="op" id="4329408">*</span>&nbsp;<span class="ident" id="4329410">int64</span><span class="op" id="4329415">(</span><span class="ident" id="4329416">lengthExtraBits</span><span class="op" id="4329431">[</span><span class="ident" id="4329432">lengthCode</span><span class="op" id="4329442">-</span><span class="ident" id="4329443">lengthCodesStart</span><span class="op" id="4329459">]</span><span class="op" id="4329460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4329464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329468">for</span>&nbsp;<span class="ident" id="4329472">offsetCode</span>&nbsp;<span class="op" id="4329483">:=</span>&nbsp;<span class="num" id="4329486">4</span><span class="op" id="4329487">;</span>&nbsp;<span class="ident" id="4329489">offsetCode</span>&nbsp;<span class="op" id="4329500">&lt;</span>&nbsp;<span class="ident" id="4329502">numOffsets</span><span class="op" id="4329512">;</span>&nbsp;<span class="ident" id="4329514">offsetCode</span><span class="op" id="4329524">++</span>&nbsp;<span class="op" id="4329527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329532">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4329583">extraBits</span>&nbsp;<span class="op" id="4329593">+=</span>&nbsp;<span class="ident" id="4329596">int64</span><span class="op" id="4329601">(</span><span class="ident" id="4329602">w</span><span class="op" id="4329603">.</span><span class="ident" id="4329604">offsetFreq</span><span class="op" id="4329614">[</span><span class="ident" id="4329615">offsetCode</span><span class="op" id="4329625">]</span><span class="op" id="4329626">)</span>&nbsp;<span class="op" id="4329628">*</span>&nbsp;<span class="ident" id="4329630">int64</span><span class="op" id="4329635">(</span><span class="ident" id="4329636">offsetExtraBits</span><span class="op" id="4329651">[</span><span class="ident" id="4329652">offsetCode</span><span class="op" id="4329662">]</span><span class="op" id="4329663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4329667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4329670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329674">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329704">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329732">var</span>&nbsp;<span class="ident" id="4329736">size</span>&nbsp;<span class="op" id="4329741">=</span>&nbsp;<span class="ident" id="4329743">int64</span><span class="op" id="4329748">(</span><span class="num" id="4329749">3</span><span class="op" id="4329750">)</span>&nbsp;<span class="op" id="4329752">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4329756">fixedLiteralEncoding</span><span class="op" id="4329776">.</span><span class="ident" id="4329777">bitLength</span><span class="op" id="4329786">(</span><span class="ident" id="4329787">w</span><span class="op" id="4329788">.</span><span class="ident" id="4329789">literalFreq</span><span class="op" id="4329800">)</span>&nbsp;<span class="op" id="4329802">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4329806">fixedOffsetEncoding</span><span class="op" id="4329825">.</span><span class="ident" id="4329826">bitLength</span><span class="op" id="4329835">(</span><span class="ident" id="4329836">w</span><span class="op" id="4329837">.</span><span class="ident" id="4329838">offsetFreq</span><span class="op" id="4329848">)</span>&nbsp;<span class="op" id="4329850">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4329854">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329865">var</span>&nbsp;<span class="ident" id="4329869">literalEncoding</span>&nbsp;<span class="op" id="4329885">=</span>&nbsp;<span class="ident" id="4329887">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329909">var</span>&nbsp;<span class="ident" id="4329913">offsetEncoding</span>&nbsp;<span class="op" id="4329928">=</span>&nbsp;<span class="ident" id="4329930">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329952">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4329973">var</span>&nbsp;<span class="ident" id="4329977">numCodegens</span>&nbsp;<span class="builtintype" id="4329989">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4329995">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4330070">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330118">w</span><span class="op" id="4330119">.</span><span class="ident" id="4330120">generateCodegen</span><span class="op" id="4330135">(</span><span class="ident" id="4330136">numLiterals</span><span class="op" id="4330147">,</span>&nbsp;<span class="ident" id="4330149">numOffsets</span><span class="op" id="4330159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330162">w</span><span class="op" id="4330163">.</span><span class="ident" id="4330164">codegenEncoding</span><span class="op" id="4330179">.</span><span class="ident" id="4330180">generate</span><span class="op" id="4330188">(</span><span class="ident" id="4330189">w</span><span class="op" id="4330190">.</span><span class="ident" id="4330191">codegenFreq</span><span class="op" id="4330202">,</span>&nbsp;<span class="num" id="4330204">7</span><span class="op" id="4330205">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330208">numCodegens</span>&nbsp;<span class="op" id="4330220">=</span>&nbsp;<span class="builtinfunc" id="4330222">len</span><span class="op" id="4330225">(</span><span class="ident" id="4330226">w</span><span class="op" id="4330227">.</span><span class="ident" id="4330228">codegenFreq</span><span class="op" id="4330239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4330242">for</span>&nbsp;<span class="ident" id="4330246">numCodegens</span>&nbsp;<span class="op" id="4330258">&gt;</span>&nbsp;<span class="num" id="4330260">4</span>&nbsp;<span class="op" id="4330262">&amp;&amp;</span>&nbsp;<span class="ident" id="4330265">w</span><span class="op" id="4330266">.</span><span class="ident" id="4330267">codegenFreq</span><span class="op" id="4330278">[</span><span class="ident" id="4330279">codegenOrder</span><span class="op" id="4330291">[</span><span class="ident" id="4330292">numCodegens</span><span class="op" id="4330303">-</span><span class="num" id="4330304">1</span><span class="op" id="4330305">]</span><span class="op" id="4330306">]</span>&nbsp;<span class="op" id="4330308">==</span>&nbsp;<span class="num" id="4330311">0</span>&nbsp;<span class="op" id="4330313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330317">numCodegens</span><span class="op" id="4330328">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4330332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330335">dynamicHeader</span>&nbsp;<span class="op" id="4330349">:=</span>&nbsp;<span class="ident" id="4330352">int64</span><span class="op" id="4330357">(</span><span class="num" id="4330358">3</span><span class="op" id="4330359">+</span><span class="num" id="4330360">5</span><span class="op" id="4330361">+</span><span class="num" id="4330362">5</span><span class="op" id="4330363">+</span><span class="num" id="4330364">4</span><span class="op" id="4330365">+</span><span class="op" id="4330366">(</span><span class="num" id="4330367">3</span><span class="op" id="4330368">*</span><span class="ident" id="4330369">numCodegens</span><span class="op" id="4330380">)</span><span class="op" id="4330381">)</span>&nbsp;<span class="op" id="4330383">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330387">w</span><span class="op" id="4330388">.</span><span class="ident" id="4330389">codegenEncoding</span><span class="op" id="4330404">.</span><span class="ident" id="4330405">bitLength</span><span class="op" id="4330414">(</span><span class="ident" id="4330415">w</span><span class="op" id="4330416">.</span><span class="ident" id="4330417">codegenFreq</span><span class="op" id="4330428">)</span>&nbsp;<span class="op" id="4330430">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330434">int64</span><span class="op" id="4330439">(</span><span class="ident" id="4330440">extraBits</span><span class="op" id="4330449">)</span>&nbsp;<span class="op" id="4330451">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330455">int64</span><span class="op" id="4330460">(</span><span class="ident" id="4330461">w</span><span class="op" id="4330462">.</span><span class="ident" id="4330463">codegenFreq</span><span class="op" id="4330474">[</span><span class="num" id="4330475">16</span><span class="op" id="4330477">]</span><span class="op" id="4330478">*</span><span class="num" id="4330479">2</span><span class="op" id="4330480">)</span>&nbsp;<span class="op" id="4330482">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330486">int64</span><span class="op" id="4330491">(</span><span class="ident" id="4330492">w</span><span class="op" id="4330493">.</span><span class="ident" id="4330494">codegenFreq</span><span class="op" id="4330505">[</span><span class="num" id="4330506">17</span><span class="op" id="4330508">]</span><span class="op" id="4330509">*</span><span class="num" id="4330510">3</span><span class="op" id="4330511">)</span>&nbsp;<span class="op" id="4330513">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330517">int64</span><span class="op" id="4330522">(</span><span class="ident" id="4330523">w</span><span class="op" id="4330524">.</span><span class="ident" id="4330525">codegenFreq</span><span class="op" id="4330536">[</span><span class="num" id="4330537">18</span><span class="op" id="4330539">]</span><span class="op" id="4330540">*</span><span class="num" id="4330541">7</span><span class="op" id="4330542">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330545">dynamicSize</span>&nbsp;<span class="op" id="4330557">:=</span>&nbsp;<span class="ident" id="4330560">dynamicHeader</span>&nbsp;<span class="op" id="4330574">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330578">w</span><span class="op" id="4330579">.</span><span class="ident" id="4330580">literalEncoding</span><span class="op" id="4330595">.</span><span class="ident" id="4330596">bitLength</span><span class="op" id="4330605">(</span><span class="ident" id="4330606">w</span><span class="op" id="4330607">.</span><span class="ident" id="4330608">literalFreq</span><span class="op" id="4330619">)</span>&nbsp;<span class="op" id="4330621">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330625">w</span><span class="op" id="4330626">.</span><span class="ident" id="4330627">offsetEncoding</span><span class="op" id="4330641">.</span><span class="ident" id="4330642">bitLength</span><span class="op" id="4330651">(</span><span class="ident" id="4330652">w</span><span class="op" id="4330653">.</span><span class="ident" id="4330654">offsetFreq</span><span class="op" id="4330664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4330668">if</span>&nbsp;<span class="ident" id="4330671">dynamicSize</span>&nbsp;<span class="op" id="4330683">&lt;</span>&nbsp;<span class="ident" id="4330685">size</span>&nbsp;<span class="op" id="4330690">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330694">size</span>&nbsp;<span class="op" id="4330699">=</span>&nbsp;<span class="ident" id="4330701">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330715">literalEncoding</span>&nbsp;<span class="op" id="4330731">=</span>&nbsp;<span class="ident" id="4330733">w</span><span class="op" id="4330734">.</span><span class="ident" id="4330735">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330753">offsetEncoding</span>&nbsp;<span class="op" id="4330768">=</span>&nbsp;<span class="ident" id="4330770">w</span><span class="op" id="4330771">.</span><span class="ident" id="4330772">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4330788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4330792">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4330810">if</span>&nbsp;<span class="ident" id="4330813">storedSize</span>&nbsp;<span class="op" id="4330824">&lt;</span>&nbsp;<span class="ident" id="4330826">size</span>&nbsp;<span class="op" id="4330831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330835">w</span><span class="op" id="4330836">.</span><span class="ident" id="4330837">writeStoredHeader</span><span class="op" id="4330854">(</span><span class="ident" id="4330855">storedBytes</span><span class="op" id="4330866">,</span>&nbsp;<span class="ident" id="4330868">eof</span><span class="op" id="4330871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330875">w</span><span class="op" id="4330876">.</span><span class="ident" id="4330877">writeBytes</span><span class="op" id="4330887">(</span><span class="ident" id="4330888">input</span><span class="op" id="4330893">[</span><span class="num" id="4330894">0</span><span class="op" id="4330895">:</span><span class="ident" id="4330896">storedBytes</span><span class="op" id="4330907">]</span><span class="op" id="4330908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4330912">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4330920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4330924">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4330937">if</span>&nbsp;<span class="ident" id="4330940">literalEncoding</span>&nbsp;<span class="op" id="4330956">==</span>&nbsp;<span class="ident" id="4330959">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4330980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330984">w</span><span class="op" id="4330985">.</span><span class="ident" id="4330986">writeFixedHeader</span><span class="op" id="4331002">(</span><span class="ident" id="4331003">eof</span><span class="op" id="4331006">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331009">}</span>&nbsp;<span class="keyword" id="4331011">else</span>&nbsp;<span class="op" id="4331016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331020">w</span><span class="op" id="4331021">.</span><span class="ident" id="4331022">writeDynamicHeader</span><span class="op" id="4331040">(</span><span class="ident" id="4331041">numLiterals</span><span class="op" id="4331052">,</span>&nbsp;<span class="ident" id="4331054">numOffsets</span><span class="op" id="4331064">,</span>&nbsp;<span class="ident" id="4331066">numCodegens</span><span class="op" id="4331077">,</span>&nbsp;<span class="ident" id="4331079">eof</span><span class="op" id="4331082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331088">for</span>&nbsp;<span class="ident" id="4331092">_</span><span class="op" id="4331093">,</span>&nbsp;<span class="ident" id="4331095">t</span>&nbsp;<span class="op" id="4331097">:=</span>&nbsp;<span class="keyword" id="4331100">range</span>&nbsp;<span class="ident" id="4331106">tokens</span>&nbsp;<span class="op" id="4331113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331117">switch</span>&nbsp;<span class="ident" id="4331124">t</span><span class="op" id="4331125">.</span><span class="ident" id="4331126">typ</span><span class="op" id="4331129">(</span><span class="op" id="4331130">)</span>&nbsp;<span class="op" id="4331132">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331136">case</span>&nbsp;<span class="ident" id="4331141">literalType</span><span class="op" id="4331152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331157">w</span><span class="op" id="4331158">.</span><span class="ident" id="4331159">writeCode</span><span class="op" id="4331168">(</span><span class="ident" id="4331169">literalEncoding</span><span class="op" id="4331184">,</span>&nbsp;<span class="ident" id="4331186">t</span><span class="op" id="4331187">.</span><span class="ident" id="4331188">literal</span><span class="op" id="4331195">(</span><span class="op" id="4331196">)</span><span class="op" id="4331197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331202">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331210">case</span>&nbsp;<span class="ident" id="4331215">matchType</span><span class="op" id="4331224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4331229">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331252">length</span>&nbsp;<span class="op" id="4331259">:=</span>&nbsp;<span class="ident" id="4331262">t</span><span class="op" id="4331263">.</span><span class="ident" id="4331264">length</span><span class="op" id="4331270">(</span><span class="op" id="4331271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331276">lengthCode</span>&nbsp;<span class="op" id="4331287">:=</span>&nbsp;<span class="ident" id="4331290">lengthCode</span><span class="op" id="4331300">(</span><span class="ident" id="4331301">length</span><span class="op" id="4331307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331312">w</span><span class="op" id="4331313">.</span><span class="ident" id="4331314">writeCode</span><span class="op" id="4331323">(</span><span class="ident" id="4331324">literalEncoding</span><span class="op" id="4331339">,</span>&nbsp;<span class="ident" id="4331341">lengthCode</span><span class="op" id="4331351">+</span><span class="ident" id="4331352">lengthCodesStart</span><span class="op" id="4331368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331373">extraLengthBits</span>&nbsp;<span class="op" id="4331389">:=</span>&nbsp;<span class="builtintype" id="4331392">int32</span><span class="op" id="4331397">(</span><span class="ident" id="4331398">lengthExtraBits</span><span class="op" id="4331413">[</span><span class="ident" id="4331414">lengthCode</span><span class="op" id="4331424">]</span><span class="op" id="4331425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331430">if</span>&nbsp;<span class="ident" id="4331433">extraLengthBits</span>&nbsp;<span class="op" id="4331449">&gt;</span>&nbsp;<span class="num" id="4331451">0</span>&nbsp;<span class="op" id="4331453">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331459">extraLength</span>&nbsp;<span class="op" id="4331471">:=</span>&nbsp;<span class="builtintype" id="4331474">int32</span><span class="op" id="4331479">(</span><span class="ident" id="4331480">length</span>&nbsp;<span class="op" id="4331487">-</span>&nbsp;<span class="ident" id="4331489">lengthBase</span><span class="op" id="4331499">[</span><span class="ident" id="4331500">lengthCode</span><span class="op" id="4331510">]</span><span class="op" id="4331511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331517">w</span><span class="op" id="4331518">.</span><span class="ident" id="4331519">writeBits</span><span class="op" id="4331528">(</span><span class="ident" id="4331529">extraLength</span><span class="op" id="4331540">,</span>&nbsp;<span class="ident" id="4331542">extraLengthBits</span><span class="op" id="4331557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4331567">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331590">offset</span>&nbsp;<span class="op" id="4331597">:=</span>&nbsp;<span class="ident" id="4331600">t</span><span class="op" id="4331601">.</span><span class="ident" id="4331602">offset</span><span class="op" id="4331608">(</span><span class="op" id="4331609">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331614">offsetCode</span>&nbsp;<span class="op" id="4331625">:=</span>&nbsp;<span class="ident" id="4331628">offsetCode</span><span class="op" id="4331638">(</span><span class="ident" id="4331639">offset</span><span class="op" id="4331645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331650">w</span><span class="op" id="4331651">.</span><span class="ident" id="4331652">writeCode</span><span class="op" id="4331661">(</span><span class="ident" id="4331662">offsetEncoding</span><span class="op" id="4331676">,</span>&nbsp;<span class="ident" id="4331678">offsetCode</span><span class="op" id="4331688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331693">extraOffsetBits</span>&nbsp;<span class="op" id="4331709">:=</span>&nbsp;<span class="builtintype" id="4331712">int32</span><span class="op" id="4331717">(</span><span class="ident" id="4331718">offsetExtraBits</span><span class="op" id="4331733">[</span><span class="ident" id="4331734">offsetCode</span><span class="op" id="4331744">]</span><span class="op" id="4331745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331750">if</span>&nbsp;<span class="ident" id="4331753">extraOffsetBits</span>&nbsp;<span class="op" id="4331769">&gt;</span>&nbsp;<span class="num" id="4331771">0</span>&nbsp;<span class="op" id="4331773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331779">extraOffset</span>&nbsp;<span class="op" id="4331791">:=</span>&nbsp;<span class="builtintype" id="4331794">int32</span><span class="op" id="4331799">(</span><span class="ident" id="4331800">offset</span>&nbsp;<span class="op" id="4331807">-</span>&nbsp;<span class="ident" id="4331809">offsetBase</span><span class="op" id="4331819">[</span><span class="ident" id="4331820">offsetCode</span><span class="op" id="4331830">]</span><span class="op" id="4331831">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331837">w</span><span class="op" id="4331838">.</span><span class="ident" id="4331839">writeBits</span><span class="op" id="4331848">(</span><span class="ident" id="4331849">extraOffset</span><span class="op" id="4331860">,</span>&nbsp;<span class="ident" id="4331862">extraOffsetBits</span><span class="op" id="4331877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331887">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331895">default</span><span class="op" id="4331902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4331907">panic</span><span class="op" id="4331912">(</span><span class="string" id="4331913">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4331936">+</span>&nbsp;<span class="builtintype" id="4331938">string</span><span class="op" id="4331944">(</span><span class="ident" id="4331945">t</span><span class="op" id="4331946">)</span><span class="op" id="4331947">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331954">}</span><br>
<span class="lineno"></span><span class="op" id="4331956">}</span>
</div>
</body>
</html>
