<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6718956">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6719012">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6719066">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6719117">package</span>&nbsp;<span class="ident" id="6719125">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6719136">import</span>&nbsp;<span class="op" id="6719143">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719146">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719155">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719164">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719170">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719181">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6719192">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6719202">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6719205">type</span>&nbsp;<span class="ident" id="6719210">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="6719233">struct</span>&nbsp;<span class="op" id="6719240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6719243">in</span><span class="op" id="6719245">,</span>&nbsp;<span class="ident" id="6719247">out</span>&nbsp;<span class="builtintype" id="6719251">string</span><br>
<span class="lineno"></span><span class="op" id="6719258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6719261">var</span>&nbsp;<span class="ident" id="6719265">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="6719289">=</span>&nbsp;<span class="op" id="6719291">[</span><span class="op" id="6719292">]</span><span class="ident" id="6719293">canonicalHeaderKeyTest</span><span class="op" id="6719315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719318">{</span><span class="string" id="6719319">&#34;a-b-c&#34;</span><span class="op" id="6719326">,</span>&nbsp;<span class="string" id="6719328">&#34;A-B-C&#34;</span><span class="op" id="6719335">}</span><span class="op" id="6719336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719339">{</span><span class="string" id="6719340">&#34;a-1-c&#34;</span><span class="op" id="6719347">,</span>&nbsp;<span class="string" id="6719349">&#34;A-1-C&#34;</span><span class="op" id="6719356">}</span><span class="op" id="6719357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719360">{</span><span class="string" id="6719361">&#34;User-Agent&#34;</span><span class="op" id="6719373">,</span>&nbsp;<span class="string" id="6719375">&#34;User-Agent&#34;</span><span class="op" id="6719387">}</span><span class="op" id="6719388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719391">{</span><span class="string" id="6719392">&#34;uSER-aGENT&#34;</span><span class="op" id="6719404">,</span>&nbsp;<span class="string" id="6719406">&#34;User-Agent&#34;</span><span class="op" id="6719418">}</span><span class="op" id="6719419">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719422">{</span><span class="string" id="6719423">&#34;user-agent&#34;</span><span class="op" id="6719435">,</span>&nbsp;<span class="string" id="6719437">&#34;User-Agent&#34;</span><span class="op" id="6719449">}</span><span class="op" id="6719450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719453">{</span><span class="string" id="6719454">&#34;USER-AGENT&#34;</span><span class="op" id="6719466">,</span>&nbsp;<span class="string" id="6719468">&#34;User-Agent&#34;</span><span class="op" id="6719480">}</span><span class="op" id="6719481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719484">{</span><span class="string" id="6719485">&#34;üser-agenT&#34;</span><span class="op" id="6719498">,</span>&nbsp;<span class="string" id="6719500">&#34;üser-Agent&#34;</span><span class="op" id="6719513">}</span><span class="op" id="6719514">,</span>&nbsp;<span class="comment" id="6719516">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6719541">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719596">{</span><span class="string" id="6719597">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="6719625">,</span>&nbsp;<span class="string" id="6719627">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="6719655">}</span><span class="op" id="6719656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719659">{</span><span class="string" id="6719660">&#34;foo&nbsp;bar&#34;</span><span class="op" id="6719669">,</span>&nbsp;<span class="string" id="6719671">&#34;Foo-Bar&#34;</span><span class="op" id="6719680">}</span><span class="op" id="6719681">,</span><br>
<span class="lineno"></span><span class="op" id="6719683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6719686">func</span>&nbsp;<span class="ident" id="6719691">TestCanonicalMIMEHeaderKey</span><span class="op" id="6719717">(</span><span class="ident" id="6719718">t</span>&nbsp;<span class="op" id="6719720">*</span><span class="ident" id="6719721">testing</span><span class="op" id="6719728">.</span><span class="ident" id="6719729">T</span><span class="op" id="6719730">)</span>&nbsp;<span class="op" id="6719732">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6719735">for</span>&nbsp;<span class="ident" id="6719739">_</span><span class="op" id="6719740">,</span>&nbsp;<span class="ident" id="6719742">tt</span>&nbsp;<span class="op" id="6719745">:=</span>&nbsp;<span class="keyword" id="6719748">range</span>&nbsp;<span class="ident" id="6719754">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="6719778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6719782">if</span>&nbsp;<span class="ident" id="6719785">s</span>&nbsp;<span class="op" id="6719787">:=</span>&nbsp;<span class="ident" id="6719790">CanonicalMIMEHeaderKey</span><span class="op" id="6719812">(</span><span class="ident" id="6719813">tt</span><span class="op" id="6719815">.</span><span class="ident" id="6719816">in</span><span class="op" id="6719818">)</span><span class="op" id="6719819">;</span>&nbsp;<span class="ident" id="6719821">s</span>&nbsp;<span class="op" id="6719823">!=</span>&nbsp;<span class="ident" id="6719826">tt</span><span class="op" id="6719828">.</span><span class="ident" id="6719829">out</span>&nbsp;<span class="op" id="6719833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6719838">t</span><span class="op" id="6719839">.</span><span class="ident" id="6719840">Errorf</span><span class="op" id="6719846">(</span><span class="string" id="6719847">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6719889">,</span>&nbsp;<span class="ident" id="6719891">tt</span><span class="op" id="6719893">.</span><span class="ident" id="6719894">in</span><span class="op" id="6719896">,</span>&nbsp;<span class="ident" id="6719898">s</span><span class="op" id="6719899">,</span>&nbsp;<span class="ident" id="6719901">tt</span><span class="op" id="6719903">.</span><span class="ident" id="6719904">out</span><span class="op" id="6719907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6719914">}</span><br>
<span class="lineno">40</span><span class="op" id="6719916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6719919">func</span>&nbsp;<span class="ident" id="6719924">reader</span><span class="op" id="6719930">(</span><span class="ident" id="6719931">s</span>&nbsp;<span class="builtintype" id="6719933">string</span><span class="op" id="6719939">)</span>&nbsp;<span class="op" id="6719941">*</span><span class="ident" id="6719942">Reader</span>&nbsp;<span class="op" id="6719949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6719952">return</span>&nbsp;<span class="ident" id="6719959">NewReader</span><span class="op" id="6719968">(</span><span class="ident" id="6719969">bufio</span><span class="op" id="6719974">.</span><span class="ident" id="6719975">NewReader</span><span class="op" id="6719984">(</span><span class="ident" id="6719985">strings</span><span class="op" id="6719992">.</span><span class="ident" id="6719993">NewReader</span><span class="op" id="6720002">(</span><span class="ident" id="6720003">s</span><span class="op" id="6720004">)</span><span class="op" id="6720005">)</span><span class="op" id="6720006">)</span><br>
<span class="lineno"></span><span class="op" id="6720008">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6720011">func</span>&nbsp;<span class="ident" id="6720016">TestReadLine</span><span class="op" id="6720028">(</span><span class="ident" id="6720029">t</span>&nbsp;<span class="op" id="6720031">*</span><span class="ident" id="6720032">testing</span><span class="op" id="6720039">.</span><span class="ident" id="6720040">T</span><span class="op" id="6720041">)</span>&nbsp;<span class="op" id="6720043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720046">r</span>&nbsp;<span class="op" id="6720048">:=</span>&nbsp;<span class="ident" id="6720051">reader</span><span class="op" id="6720057">(</span><span class="string" id="6720058">&#34;line1\nline2\n&#34;</span><span class="op" id="6720074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720077">s</span><span class="op" id="6720078">,</span>&nbsp;<span class="ident" id="6720080">err</span>&nbsp;<span class="op" id="6720084">:=</span>&nbsp;<span class="ident" id="6720087">r</span><span class="op" id="6720088">.</span><span class="ident" id="6720089">ReadLine</span><span class="op" id="6720097">(</span><span class="op" id="6720098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720101">if</span>&nbsp;<span class="ident" id="6720104">s</span>&nbsp;<span class="op" id="6720106">!=</span>&nbsp;<span class="string" id="6720109">&#34;line1&#34;</span>&nbsp;<span class="op" id="6720117">||</span>&nbsp;<span class="ident" id="6720120">err</span>&nbsp;<span class="op" id="6720124">!=</span>&nbsp;<span class="builtintype" id="6720127">nil</span>&nbsp;<span class="op" id="6720131">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720135">t</span><span class="op" id="6720136">.</span><span class="ident" id="6720137">Fatalf</span><span class="op" id="6720143">(</span><span class="string" id="6720144">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720160">,</span>&nbsp;<span class="ident" id="6720162">s</span><span class="op" id="6720163">,</span>&nbsp;<span class="ident" id="6720165">err</span><span class="op" id="6720168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720174">s</span><span class="op" id="6720175">,</span>&nbsp;<span class="ident" id="6720177">err</span>&nbsp;<span class="op" id="6720181">=</span>&nbsp;<span class="ident" id="6720183">r</span><span class="op" id="6720184">.</span><span class="ident" id="6720185">ReadLine</span><span class="op" id="6720193">(</span><span class="op" id="6720194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720197">if</span>&nbsp;<span class="ident" id="6720200">s</span>&nbsp;<span class="op" id="6720202">!=</span>&nbsp;<span class="string" id="6720205">&#34;line2&#34;</span>&nbsp;<span class="op" id="6720213">||</span>&nbsp;<span class="ident" id="6720216">err</span>&nbsp;<span class="op" id="6720220">!=</span>&nbsp;<span class="builtintype" id="6720223">nil</span>&nbsp;<span class="op" id="6720227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720231">t</span><span class="op" id="6720232">.</span><span class="ident" id="6720233">Fatalf</span><span class="op" id="6720239">(</span><span class="string" id="6720240">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720256">,</span>&nbsp;<span class="ident" id="6720258">s</span><span class="op" id="6720259">,</span>&nbsp;<span class="ident" id="6720261">err</span><span class="op" id="6720264">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720270">s</span><span class="op" id="6720271">,</span>&nbsp;<span class="ident" id="6720273">err</span>&nbsp;<span class="op" id="6720277">=</span>&nbsp;<span class="ident" id="6720279">r</span><span class="op" id="6720280">.</span><span class="ident" id="6720281">ReadLine</span><span class="op" id="6720289">(</span><span class="op" id="6720290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720293">if</span>&nbsp;<span class="ident" id="6720296">s</span>&nbsp;<span class="op" id="6720298">!=</span>&nbsp;<span class="string" id="6720301">&#34;&#34;</span>&nbsp;<span class="op" id="6720304">||</span>&nbsp;<span class="ident" id="6720307">err</span>&nbsp;<span class="op" id="6720311">!=</span>&nbsp;<span class="ident" id="6720314">io</span><span class="op" id="6720316">.</span><span class="ident" id="6720317">EOF</span>&nbsp;<span class="op" id="6720321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720325">t</span><span class="op" id="6720326">.</span><span class="ident" id="6720327">Fatalf</span><span class="op" id="6720333">(</span><span class="string" id="6720334">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720347">,</span>&nbsp;<span class="ident" id="6720349">s</span><span class="op" id="6720350">,</span>&nbsp;<span class="ident" id="6720352">err</span><span class="op" id="6720355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720358">}</span><br>
<span class="lineno">60</span><span class="op" id="6720360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6720363">func</span>&nbsp;<span class="ident" id="6720368">TestReadContinuedLine</span><span class="op" id="6720389">(</span><span class="ident" id="6720390">t</span>&nbsp;<span class="op" id="6720392">*</span><span class="ident" id="6720393">testing</span><span class="op" id="6720400">.</span><span class="ident" id="6720401">T</span><span class="op" id="6720402">)</span>&nbsp;<span class="op" id="6720404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720407">r</span>&nbsp;<span class="op" id="6720409">:=</span>&nbsp;<span class="ident" id="6720412">reader</span><span class="op" id="6720418">(</span><span class="string" id="6720419">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="6720445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720448">s</span><span class="op" id="6720449">,</span>&nbsp;<span class="ident" id="6720451">err</span>&nbsp;<span class="op" id="6720455">:=</span>&nbsp;<span class="ident" id="6720458">r</span><span class="op" id="6720459">.</span><span class="ident" id="6720460">ReadContinuedLine</span><span class="op" id="6720477">(</span><span class="op" id="6720478">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720481">if</span>&nbsp;<span class="ident" id="6720484">s</span>&nbsp;<span class="op" id="6720486">!=</span>&nbsp;<span class="string" id="6720489">&#34;line1&#34;</span>&nbsp;<span class="op" id="6720497">||</span>&nbsp;<span class="ident" id="6720500">err</span>&nbsp;<span class="op" id="6720504">!=</span>&nbsp;<span class="builtintype" id="6720507">nil</span>&nbsp;<span class="op" id="6720511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720515">t</span><span class="op" id="6720516">.</span><span class="ident" id="6720517">Fatalf</span><span class="op" id="6720523">(</span><span class="string" id="6720524">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720540">,</span>&nbsp;<span class="ident" id="6720542">s</span><span class="op" id="6720543">,</span>&nbsp;<span class="ident" id="6720545">err</span><span class="op" id="6720548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720554">s</span><span class="op" id="6720555">,</span>&nbsp;<span class="ident" id="6720557">err</span>&nbsp;<span class="op" id="6720561">=</span>&nbsp;<span class="ident" id="6720563">r</span><span class="op" id="6720564">.</span><span class="ident" id="6720565">ReadContinuedLine</span><span class="op" id="6720582">(</span><span class="op" id="6720583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720586">if</span>&nbsp;<span class="ident" id="6720589">s</span>&nbsp;<span class="op" id="6720591">!=</span>&nbsp;<span class="string" id="6720594">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="6720603">||</span>&nbsp;<span class="ident" id="6720606">err</span>&nbsp;<span class="op" id="6720610">!=</span>&nbsp;<span class="builtintype" id="6720613">nil</span>&nbsp;<span class="op" id="6720617">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720621">t</span><span class="op" id="6720622">.</span><span class="ident" id="6720623">Fatalf</span><span class="op" id="6720629">(</span><span class="string" id="6720630">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720646">,</span>&nbsp;<span class="ident" id="6720648">s</span><span class="op" id="6720649">,</span>&nbsp;<span class="ident" id="6720651">err</span><span class="op" id="6720654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720660">s</span><span class="op" id="6720661">,</span>&nbsp;<span class="ident" id="6720663">err</span>&nbsp;<span class="op" id="6720667">=</span>&nbsp;<span class="ident" id="6720669">r</span><span class="op" id="6720670">.</span><span class="ident" id="6720671">ReadContinuedLine</span><span class="op" id="6720688">(</span><span class="op" id="6720689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720692">if</span>&nbsp;<span class="ident" id="6720695">s</span>&nbsp;<span class="op" id="6720697">!=</span>&nbsp;<span class="string" id="6720700">&#34;line3&#34;</span>&nbsp;<span class="op" id="6720708">||</span>&nbsp;<span class="ident" id="6720711">err</span>&nbsp;<span class="op" id="6720715">!=</span>&nbsp;<span class="builtintype" id="6720718">nil</span>&nbsp;<span class="op" id="6720722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720726">t</span><span class="op" id="6720727">.</span><span class="ident" id="6720728">Fatalf</span><span class="op" id="6720734">(</span><span class="string" id="6720735">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720751">,</span>&nbsp;<span class="ident" id="6720753">s</span><span class="op" id="6720754">,</span>&nbsp;<span class="ident" id="6720756">err</span><span class="op" id="6720759">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720765">s</span><span class="op" id="6720766">,</span>&nbsp;<span class="ident" id="6720768">err</span>&nbsp;<span class="op" id="6720772">=</span>&nbsp;<span class="ident" id="6720774">r</span><span class="op" id="6720775">.</span><span class="ident" id="6720776">ReadContinuedLine</span><span class="op" id="6720793">(</span><span class="op" id="6720794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720797">if</span>&nbsp;<span class="ident" id="6720800">s</span>&nbsp;<span class="op" id="6720802">!=</span>&nbsp;<span class="string" id="6720805">&#34;&#34;</span>&nbsp;<span class="op" id="6720808">||</span>&nbsp;<span class="ident" id="6720811">err</span>&nbsp;<span class="op" id="6720815">!=</span>&nbsp;<span class="ident" id="6720818">io</span><span class="op" id="6720820">.</span><span class="ident" id="6720821">EOF</span>&nbsp;<span class="op" id="6720825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720829">t</span><span class="op" id="6720830">.</span><span class="ident" id="6720831">Fatalf</span><span class="op" id="6720837">(</span><span class="string" id="6720838">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6720851">,</span>&nbsp;<span class="ident" id="6720853">s</span><span class="op" id="6720854">,</span>&nbsp;<span class="ident" id="6720856">err</span><span class="op" id="6720859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6720862">}</span><br>
<span class="lineno">80</span><span class="op" id="6720864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6720867">func</span>&nbsp;<span class="ident" id="6720872">TestReadCodeLine</span><span class="op" id="6720888">(</span><span class="ident" id="6720889">t</span>&nbsp;<span class="op" id="6720891">*</span><span class="ident" id="6720892">testing</span><span class="op" id="6720899">.</span><span class="ident" id="6720900">T</span><span class="op" id="6720901">)</span>&nbsp;<span class="op" id="6720903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720906">r</span>&nbsp;<span class="op" id="6720908">:=</span>&nbsp;<span class="ident" id="6720911">reader</span><span class="op" id="6720917">(</span><span class="string" id="6720918">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="6720949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6720952">code</span><span class="op" id="6720956">,</span>&nbsp;<span class="ident" id="6720958">msg</span><span class="op" id="6720961">,</span>&nbsp;<span class="ident" id="6720963">err</span>&nbsp;<span class="op" id="6720967">:=</span>&nbsp;<span class="ident" id="6720970">r</span><span class="op" id="6720971">.</span><span class="ident" id="6720972">ReadCodeLine</span><span class="op" id="6720984">(</span><span class="num" id="6720985">0</span><span class="op" id="6720986">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6720989">if</span>&nbsp;<span class="ident" id="6720992">code</span>&nbsp;<span class="op" id="6720997">!=</span>&nbsp;<span class="num" id="6721000">123</span>&nbsp;<span class="op" id="6721004">||</span>&nbsp;<span class="ident" id="6721007">msg</span>&nbsp;<span class="op" id="6721011">!=</span>&nbsp;<span class="string" id="6721014">&#34;hi&#34;</span>&nbsp;<span class="op" id="6721019">||</span>&nbsp;<span class="ident" id="6721022">err</span>&nbsp;<span class="op" id="6721026">!=</span>&nbsp;<span class="builtintype" id="6721029">nil</span>&nbsp;<span class="op" id="6721033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721037">t</span><span class="op" id="6721038">.</span><span class="ident" id="6721039">Fatalf</span><span class="op" id="6721045">(</span><span class="string" id="6721046">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6721066">,</span>&nbsp;<span class="ident" id="6721068">code</span><span class="op" id="6721072">,</span>&nbsp;<span class="ident" id="6721074">msg</span><span class="op" id="6721077">,</span>&nbsp;<span class="ident" id="6721079">err</span><span class="op" id="6721082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721088">code</span><span class="op" id="6721092">,</span>&nbsp;<span class="ident" id="6721094">msg</span><span class="op" id="6721097">,</span>&nbsp;<span class="ident" id="6721099">err</span>&nbsp;<span class="op" id="6721103">=</span>&nbsp;<span class="ident" id="6721105">r</span><span class="op" id="6721106">.</span><span class="ident" id="6721107">ReadCodeLine</span><span class="op" id="6721119">(</span><span class="num" id="6721120">23</span><span class="op" id="6721122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721125">if</span>&nbsp;<span class="ident" id="6721128">code</span>&nbsp;<span class="op" id="6721133">!=</span>&nbsp;<span class="num" id="6721136">234</span>&nbsp;<span class="op" id="6721140">||</span>&nbsp;<span class="ident" id="6721143">msg</span>&nbsp;<span class="op" id="6721147">!=</span>&nbsp;<span class="string" id="6721150">&#34;bye&#34;</span>&nbsp;<span class="op" id="6721156">||</span>&nbsp;<span class="ident" id="6721159">err</span>&nbsp;<span class="op" id="6721163">!=</span>&nbsp;<span class="builtintype" id="6721166">nil</span>&nbsp;<span class="op" id="6721170">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721174">t</span><span class="op" id="6721175">.</span><span class="ident" id="6721176">Fatalf</span><span class="op" id="6721182">(</span><span class="string" id="6721183">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6721203">,</span>&nbsp;<span class="ident" id="6721205">code</span><span class="op" id="6721209">,</span>&nbsp;<span class="ident" id="6721211">msg</span><span class="op" id="6721214">,</span>&nbsp;<span class="ident" id="6721216">err</span><span class="op" id="6721219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721225">code</span><span class="op" id="6721229">,</span>&nbsp;<span class="ident" id="6721231">msg</span><span class="op" id="6721234">,</span>&nbsp;<span class="ident" id="6721236">err</span>&nbsp;<span class="op" id="6721240">=</span>&nbsp;<span class="ident" id="6721242">r</span><span class="op" id="6721243">.</span><span class="ident" id="6721244">ReadCodeLine</span><span class="op" id="6721256">(</span><span class="num" id="6721257">346</span><span class="op" id="6721260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721263">if</span>&nbsp;<span class="ident" id="6721266">code</span>&nbsp;<span class="op" id="6721271">!=</span>&nbsp;<span class="num" id="6721274">345</span>&nbsp;<span class="op" id="6721278">||</span>&nbsp;<span class="ident" id="6721281">msg</span>&nbsp;<span class="op" id="6721285">!=</span>&nbsp;<span class="string" id="6721288">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="6721297">||</span>&nbsp;<span class="ident" id="6721300">err</span>&nbsp;<span class="op" id="6721304">==</span>&nbsp;<span class="builtintype" id="6721307">nil</span>&nbsp;<span class="op" id="6721311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721315">t</span><span class="op" id="6721316">.</span><span class="ident" id="6721317">Fatalf</span><span class="op" id="6721323">(</span><span class="string" id="6721324">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6721344">,</span>&nbsp;<span class="ident" id="6721346">code</span><span class="op" id="6721350">,</span>&nbsp;<span class="ident" id="6721352">msg</span><span class="op" id="6721355">,</span>&nbsp;<span class="ident" id="6721357">err</span><span class="op" id="6721360">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721366">if</span>&nbsp;<span class="ident" id="6721369">e</span><span class="op" id="6721370">,</span>&nbsp;<span class="ident" id="6721372">ok</span>&nbsp;<span class="op" id="6721375">:=</span>&nbsp;<span class="ident" id="6721378">err</span><span class="op" id="6721381">.</span><span class="op" id="6721382">(</span><span class="op" id="6721383">*</span><span class="ident" id="6721384">Error</span><span class="op" id="6721389">)</span><span class="op" id="6721390">;</span>&nbsp;<span class="op" id="6721392">!</span><span class="ident" id="6721393">ok</span>&nbsp;<span class="op" id="6721396">||</span>&nbsp;<span class="ident" id="6721399">e</span><span class="op" id="6721400">.</span><span class="ident" id="6721401">Code</span>&nbsp;<span class="op" id="6721406">!=</span>&nbsp;<span class="ident" id="6721409">code</span>&nbsp;<span class="op" id="6721414">||</span>&nbsp;<span class="ident" id="6721417">e</span><span class="op" id="6721418">.</span><span class="ident" id="6721419">Msg</span>&nbsp;<span class="op" id="6721423">!=</span>&nbsp;<span class="ident" id="6721426">msg</span>&nbsp;<span class="op" id="6721430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721434">t</span><span class="op" id="6721435">.</span><span class="ident" id="6721436">Fatalf</span><span class="op" id="6721442">(</span><span class="string" id="6721443">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="6721469">,</span>&nbsp;<span class="ident" id="6721471">err</span><span class="op" id="6721474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721480">code</span><span class="op" id="6721484">,</span>&nbsp;<span class="ident" id="6721486">msg</span><span class="op" id="6721489">,</span>&nbsp;<span class="ident" id="6721491">err</span>&nbsp;<span class="op" id="6721495">=</span>&nbsp;<span class="ident" id="6721497">r</span><span class="op" id="6721498">.</span><span class="ident" id="6721499">ReadCodeLine</span><span class="op" id="6721511">(</span><span class="num" id="6721512">1</span><span class="op" id="6721513">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721516">if</span>&nbsp;<span class="ident" id="6721519">code</span>&nbsp;<span class="op" id="6721524">!=</span>&nbsp;<span class="num" id="6721527">0</span>&nbsp;<span class="op" id="6721529">||</span>&nbsp;<span class="ident" id="6721532">msg</span>&nbsp;<span class="op" id="6721536">!=</span>&nbsp;<span class="string" id="6721539">&#34;&#34;</span>&nbsp;<span class="op" id="6721542">||</span>&nbsp;<span class="ident" id="6721545">err</span>&nbsp;<span class="op" id="6721549">!=</span>&nbsp;<span class="ident" id="6721552">io</span><span class="op" id="6721554">.</span><span class="ident" id="6721555">EOF</span>&nbsp;<span class="op" id="6721559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721563">t</span><span class="op" id="6721564">.</span><span class="ident" id="6721565">Fatalf</span><span class="op" id="6721571">(</span><span class="string" id="6721572">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="6721589">,</span>&nbsp;<span class="ident" id="6721591">code</span><span class="op" id="6721595">,</span>&nbsp;<span class="ident" id="6721597">msg</span><span class="op" id="6721600">,</span>&nbsp;<span class="ident" id="6721602">err</span><span class="op" id="6721605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721608">}</span><br>
<span class="lineno"></span><span class="op" id="6721610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6721613">func</span>&nbsp;<span class="ident" id="6721618">TestReadDotLines</span><span class="op" id="6721634">(</span><span class="ident" id="6721635">t</span>&nbsp;<span class="op" id="6721637">*</span><span class="ident" id="6721638">testing</span><span class="op" id="6721645">.</span><span class="ident" id="6721646">T</span><span class="op" id="6721647">)</span>&nbsp;<span class="op" id="6721649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721652">r</span>&nbsp;<span class="op" id="6721654">:=</span>&nbsp;<span class="ident" id="6721657">reader</span><span class="op" id="6721663">(</span><span class="string" id="6721664">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="6721727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721730">s</span><span class="op" id="6721731">,</span>&nbsp;<span class="ident" id="6721733">err</span>&nbsp;<span class="op" id="6721737">:=</span>&nbsp;<span class="ident" id="6721740">r</span><span class="op" id="6721741">.</span><span class="ident" id="6721742">ReadDotLines</span><span class="op" id="6721754">(</span><span class="op" id="6721755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721758">want</span>&nbsp;<span class="op" id="6721763">:=</span>&nbsp;<span class="op" id="6721766">[</span><span class="op" id="6721767">]</span><span class="builtintype" id="6721768">string</span><span class="op" id="6721774">{</span><span class="string" id="6721775">&#34;dotlines&#34;</span><span class="op" id="6721785">,</span>&nbsp;<span class="string" id="6721787">&#34;foo&#34;</span><span class="op" id="6721792">,</span>&nbsp;<span class="string" id="6721794">&#34;.bar&#34;</span><span class="op" id="6721800">,</span>&nbsp;<span class="string" id="6721802">&#34;..baz&#34;</span><span class="op" id="6721809">,</span>&nbsp;<span class="string" id="6721811">&#34;quux&#34;</span><span class="op" id="6721817">,</span>&nbsp;<span class="string" id="6721819">&#34;&#34;</span><span class="op" id="6721821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721824">if</span>&nbsp;<span class="op" id="6721827">!</span><span class="ident" id="6721828">reflect</span><span class="op" id="6721835">.</span><span class="ident" id="6721836">DeepEqual</span><span class="op" id="6721845">(</span><span class="ident" id="6721846">s</span><span class="op" id="6721847">,</span>&nbsp;<span class="ident" id="6721849">want</span><span class="op" id="6721853">)</span>&nbsp;<span class="op" id="6721855">||</span>&nbsp;<span class="ident" id="6721858">err</span>&nbsp;<span class="op" id="6721862">!=</span>&nbsp;<span class="builtintype" id="6721865">nil</span>&nbsp;<span class="op" id="6721869">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721873">t</span><span class="op" id="6721874">.</span><span class="ident" id="6721875">Fatalf</span><span class="op" id="6721881">(</span><span class="string" id="6721882">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6721904">,</span>&nbsp;<span class="ident" id="6721906">s</span><span class="op" id="6721907">,</span>&nbsp;<span class="ident" id="6721909">err</span><span class="op" id="6721912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6721915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721919">s</span><span class="op" id="6721920">,</span>&nbsp;<span class="ident" id="6721922">err</span>&nbsp;<span class="op" id="6721926">=</span>&nbsp;<span class="ident" id="6721928">r</span><span class="op" id="6721929">.</span><span class="ident" id="6721930">ReadDotLines</span><span class="op" id="6721942">(</span><span class="op" id="6721943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6721946">want</span>&nbsp;<span class="op" id="6721951">=</span>&nbsp;<span class="op" id="6721953">[</span><span class="op" id="6721954">]</span><span class="builtintype" id="6721955">string</span><span class="op" id="6721961">{</span><span class="string" id="6721962">&#34;another&#34;</span><span class="op" id="6721971">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6721974">if</span>&nbsp;<span class="op" id="6721977">!</span><span class="ident" id="6721978">reflect</span><span class="op" id="6721985">.</span><span class="ident" id="6721986">DeepEqual</span><span class="op" id="6721995">(</span><span class="ident" id="6721996">s</span><span class="op" id="6721997">,</span>&nbsp;<span class="ident" id="6721999">want</span><span class="op" id="6722003">)</span>&nbsp;<span class="op" id="6722005">||</span>&nbsp;<span class="ident" id="6722008">err</span>&nbsp;<span class="op" id="6722012">!=</span>&nbsp;<span class="ident" id="6722015">io</span><span class="op" id="6722017">.</span><span class="ident" id="6722018">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6722035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722039">t</span><span class="op" id="6722040">.</span><span class="ident" id="6722041">Fatalf</span><span class="op" id="6722047">(</span><span class="string" id="6722048">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6722071">,</span>&nbsp;<span class="ident" id="6722073">s</span><span class="op" id="6722074">,</span>&nbsp;<span class="ident" id="6722076">err</span><span class="op" id="6722079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6722082">}</span><br>
<span class="lineno"></span><span class="op" id="6722084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6722087">func</span>&nbsp;<span class="ident" id="6722092">TestReadDotBytes</span><span class="op" id="6722108">(</span><span class="ident" id="6722109">t</span>&nbsp;<span class="op" id="6722111">*</span><span class="ident" id="6722112">testing</span><span class="op" id="6722119">.</span><span class="ident" id="6722120">T</span><span class="op" id="6722121">)</span>&nbsp;<span class="op" id="6722123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722126">r</span>&nbsp;<span class="op" id="6722128">:=</span>&nbsp;<span class="ident" id="6722131">reader</span><span class="op" id="6722137">(</span><span class="string" id="6722138">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="6722204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722207">b</span><span class="op" id="6722208">,</span>&nbsp;<span class="ident" id="6722210">err</span>&nbsp;<span class="op" id="6722214">:=</span>&nbsp;<span class="ident" id="6722217">r</span><span class="op" id="6722218">.</span><span class="ident" id="6722219">ReadDotBytes</span><span class="op" id="6722231">(</span><span class="op" id="6722232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722235">want</span>&nbsp;<span class="op" id="6722240">:=</span>&nbsp;<span class="op" id="6722243">[</span><span class="op" id="6722244">]</span><span class="builtintype" id="6722245">byte</span><span class="op" id="6722249">(</span><span class="string" id="6722250">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="6722288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6722291">if</span>&nbsp;<span class="op" id="6722294">!</span><span class="ident" id="6722295">reflect</span><span class="op" id="6722302">.</span><span class="ident" id="6722303">DeepEqual</span><span class="op" id="6722312">(</span><span class="ident" id="6722313">b</span><span class="op" id="6722314">,</span>&nbsp;<span class="ident" id="6722316">want</span><span class="op" id="6722320">)</span>&nbsp;<span class="op" id="6722322">||</span>&nbsp;<span class="ident" id="6722325">err</span>&nbsp;<span class="op" id="6722329">!=</span>&nbsp;<span class="builtintype" id="6722332">nil</span>&nbsp;<span class="op" id="6722336">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722340">t</span><span class="op" id="6722341">.</span><span class="ident" id="6722342">Fatalf</span><span class="op" id="6722348">(</span><span class="string" id="6722349">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6722371">,</span>&nbsp;<span class="ident" id="6722373">b</span><span class="op" id="6722374">,</span>&nbsp;<span class="ident" id="6722376">err</span><span class="op" id="6722379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6722382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722386">b</span><span class="op" id="6722387">,</span>&nbsp;<span class="ident" id="6722389">err</span>&nbsp;<span class="op" id="6722393">=</span>&nbsp;<span class="ident" id="6722395">r</span><span class="op" id="6722396">.</span><span class="ident" id="6722397">ReadDotBytes</span><span class="op" id="6722409">(</span><span class="op" id="6722410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722413">want</span>&nbsp;<span class="op" id="6722418">=</span>&nbsp;<span class="op" id="6722420">[</span><span class="op" id="6722421">]</span><span class="builtintype" id="6722422">byte</span><span class="op" id="6722426">(</span><span class="string" id="6722427">&#34;anot.her\n&#34;</span><span class="op" id="6722439">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6722442">if</span>&nbsp;<span class="op" id="6722445">!</span><span class="ident" id="6722446">reflect</span><span class="op" id="6722453">.</span><span class="ident" id="6722454">DeepEqual</span><span class="op" id="6722463">(</span><span class="ident" id="6722464">b</span><span class="op" id="6722465">,</span>&nbsp;<span class="ident" id="6722467">want</span><span class="op" id="6722471">)</span>&nbsp;<span class="op" id="6722473">||</span>&nbsp;<span class="ident" id="6722476">err</span>&nbsp;<span class="op" id="6722480">!=</span>&nbsp;<span class="ident" id="6722483">io</span><span class="op" id="6722485">.</span><span class="ident" id="6722486">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6722503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722507">t</span><span class="op" id="6722508">.</span><span class="ident" id="6722509">Fatalf</span><span class="op" id="6722515">(</span><span class="string" id="6722516">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6722539">,</span>&nbsp;<span class="ident" id="6722541">b</span><span class="op" id="6722542">,</span>&nbsp;<span class="ident" id="6722544">err</span><span class="op" id="6722547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6722550">}</span><br>
<span class="lineno"></span><span class="op" id="6722552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6722555">func</span>&nbsp;<span class="ident" id="6722560">TestReadMIMEHeader</span><span class="op" id="6722578">(</span><span class="ident" id="6722579">t</span>&nbsp;<span class="op" id="6722581">*</span><span class="ident" id="6722582">testing</span><span class="op" id="6722589">.</span><span class="ident" id="6722590">T</span><span class="op" id="6722591">)</span>&nbsp;<span class="op" id="6722593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722596">r</span>&nbsp;<span class="op" id="6722598">:=</span>&nbsp;<span class="ident" id="6722601">reader</span><span class="op" id="6722607">(</span><span class="string" id="6722608">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="6722686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722689">m</span><span class="op" id="6722690">,</span>&nbsp;<span class="ident" id="6722692">err</span>&nbsp;<span class="op" id="6722696">:=</span>&nbsp;<span class="ident" id="6722699">r</span><span class="op" id="6722700">.</span><span class="ident" id="6722701">ReadMIMEHeader</span><span class="op" id="6722715">(</span><span class="op" id="6722716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722719">want</span>&nbsp;<span class="op" id="6722724">:=</span>&nbsp;<span class="ident" id="6722727">MIMEHeader</span><span class="op" id="6722737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6722741">&#34;My-Key&#34;</span><span class="op" id="6722749">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6722753">{</span><span class="string" id="6722754">&#34;Value&nbsp;1&#34;</span><span class="op" id="6722763">,</span>&nbsp;<span class="string" id="6722765">&#34;Value&nbsp;2&#34;</span><span class="op" id="6722774">}</span><span class="op" id="6722775">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6722779">&#34;Long-Key&#34;</span><span class="op" id="6722789">:</span>&nbsp;<span class="op" id="6722791">{</span><span class="string" id="6722792">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="6722811">}</span><span class="op" id="6722812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6722815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6722818">if</span>&nbsp;<span class="op" id="6722821">!</span><span class="ident" id="6722822">reflect</span><span class="op" id="6722829">.</span><span class="ident" id="6722830">DeepEqual</span><span class="op" id="6722839">(</span><span class="ident" id="6722840">m</span><span class="op" id="6722841">,</span>&nbsp;<span class="ident" id="6722843">want</span><span class="op" id="6722847">)</span>&nbsp;<span class="op" id="6722849">||</span>&nbsp;<span class="ident" id="6722852">err</span>&nbsp;<span class="op" id="6722856">!=</span>&nbsp;<span class="builtintype" id="6722859">nil</span>&nbsp;<span class="op" id="6722863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722867">t</span><span class="op" id="6722868">.</span><span class="ident" id="6722869">Fatalf</span><span class="op" id="6722875">(</span><span class="string" id="6722876">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6722909">,</span>&nbsp;<span class="ident" id="6722911">m</span><span class="op" id="6722912">,</span>&nbsp;<span class="ident" id="6722914">err</span><span class="op" id="6722917">,</span>&nbsp;<span class="ident" id="6722919">want</span><span class="op" id="6722923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6722926">}</span><br>
<span class="lineno">145</span><span class="op" id="6722928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6722931">func</span>&nbsp;<span class="ident" id="6722936">TestReadMIMEHeaderSingle</span><span class="op" id="6722960">(</span><span class="ident" id="6722961">t</span>&nbsp;<span class="op" id="6722963">*</span><span class="ident" id="6722964">testing</span><span class="op" id="6722971">.</span><span class="ident" id="6722972">T</span><span class="op" id="6722973">)</span>&nbsp;<span class="op" id="6722975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6722978">r</span>&nbsp;<span class="op" id="6722980">:=</span>&nbsp;<span class="ident" id="6722983">reader</span><span class="op" id="6722989">(</span><span class="string" id="6722990">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="6723004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723007">m</span><span class="op" id="6723008">,</span>&nbsp;<span class="ident" id="6723010">err</span>&nbsp;<span class="op" id="6723014">:=</span>&nbsp;<span class="ident" id="6723017">r</span><span class="op" id="6723018">.</span><span class="ident" id="6723019">ReadMIMEHeader</span><span class="op" id="6723033">(</span><span class="op" id="6723034">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723037">want</span>&nbsp;<span class="op" id="6723042">:=</span>&nbsp;<span class="ident" id="6723045">MIMEHeader</span><span class="op" id="6723055">{</span><span class="string" id="6723056">&#34;Foo&#34;</span><span class="op" id="6723061">:</span>&nbsp;<span class="op" id="6723063">{</span><span class="string" id="6723064">&#34;bar&#34;</span><span class="op" id="6723069">}</span><span class="op" id="6723070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723073">if</span>&nbsp;<span class="op" id="6723076">!</span><span class="ident" id="6723077">reflect</span><span class="op" id="6723084">.</span><span class="ident" id="6723085">DeepEqual</span><span class="op" id="6723094">(</span><span class="ident" id="6723095">m</span><span class="op" id="6723096">,</span>&nbsp;<span class="ident" id="6723098">want</span><span class="op" id="6723102">)</span>&nbsp;<span class="op" id="6723104">||</span>&nbsp;<span class="ident" id="6723107">err</span>&nbsp;<span class="op" id="6723111">!=</span>&nbsp;<span class="builtintype" id="6723114">nil</span>&nbsp;<span class="op" id="6723118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723122">t</span><span class="op" id="6723123">.</span><span class="ident" id="6723124">Fatalf</span><span class="op" id="6723130">(</span><span class="string" id="6723131">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6723164">,</span>&nbsp;<span class="ident" id="6723166">m</span><span class="op" id="6723167">,</span>&nbsp;<span class="ident" id="6723169">err</span><span class="op" id="6723172">,</span>&nbsp;<span class="ident" id="6723174">want</span><span class="op" id="6723178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6723181">}</span><br>
<span class="lineno"></span><span class="op" id="6723183">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="6723186">func</span>&nbsp;<span class="ident" id="6723191">TestLargeReadMIMEHeader</span><span class="op" id="6723214">(</span><span class="ident" id="6723215">t</span>&nbsp;<span class="op" id="6723217">*</span><span class="ident" id="6723218">testing</span><span class="op" id="6723225">.</span><span class="ident" id="6723226">T</span><span class="op" id="6723227">)</span>&nbsp;<span class="op" id="6723229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723232">data</span>&nbsp;<span class="op" id="6723237">:=</span>&nbsp;<span class="builtinfunc" id="6723240">make</span><span class="op" id="6723244">(</span><span class="op" id="6723245">[</span><span class="op" id="6723246">]</span><span class="builtintype" id="6723247">byte</span><span class="op" id="6723251">,</span>&nbsp;<span class="num" id="6723253">16</span><span class="op" id="6723255">*</span><span class="num" id="6723256">1024</span><span class="op" id="6723260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723263">for</span>&nbsp;<span class="ident" id="6723267">i</span>&nbsp;<span class="op" id="6723269">:=</span>&nbsp;<span class="num" id="6723272">0</span><span class="op" id="6723273">;</span>&nbsp;<span class="ident" id="6723275">i</span>&nbsp;<span class="op" id="6723277">&lt;</span>&nbsp;<span class="builtinfunc" id="6723279">len</span><span class="op" id="6723282">(</span><span class="ident" id="6723283">data</span><span class="op" id="6723287">)</span><span class="op" id="6723288">;</span>&nbsp;<span class="ident" id="6723290">i</span><span class="op" id="6723291">++</span>&nbsp;<span class="op" id="6723294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723298">data</span><span class="op" id="6723302">[</span><span class="ident" id="6723303">i</span><span class="op" id="6723304">]</span>&nbsp;<span class="op" id="6723306">=</span>&nbsp;<span class="string" id="6723308">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6723313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723316">sdata</span>&nbsp;<span class="op" id="6723322">:=</span>&nbsp;<span class="builtintype" id="6723325">string</span><span class="op" id="6723331">(</span><span class="ident" id="6723332">data</span><span class="op" id="6723336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723339">r</span>&nbsp;<span class="op" id="6723341">:=</span>&nbsp;<span class="ident" id="6723344">reader</span><span class="op" id="6723350">(</span><span class="string" id="6723351">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="6723362">+</span>&nbsp;<span class="ident" id="6723364">sdata</span>&nbsp;<span class="op" id="6723370">+</span>&nbsp;<span class="string" id="6723372">&#34;\r\n\n&#34;</span><span class="op" id="6723380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723383">m</span><span class="op" id="6723384">,</span>&nbsp;<span class="ident" id="6723386">err</span>&nbsp;<span class="op" id="6723390">:=</span>&nbsp;<span class="ident" id="6723393">r</span><span class="op" id="6723394">.</span><span class="ident" id="6723395">ReadMIMEHeader</span><span class="op" id="6723409">(</span><span class="op" id="6723410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723413">if</span>&nbsp;<span class="ident" id="6723416">err</span>&nbsp;<span class="op" id="6723420">!=</span>&nbsp;<span class="builtintype" id="6723423">nil</span>&nbsp;<span class="op" id="6723427">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723431">t</span><span class="op" id="6723432">.</span><span class="ident" id="6723433">Fatalf</span><span class="op" id="6723439">(</span><span class="string" id="6723440">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="6723460">,</span>&nbsp;<span class="ident" id="6723462">err</span><span class="op" id="6723465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6723468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723471">cookie</span>&nbsp;<span class="op" id="6723478">:=</span>&nbsp;<span class="ident" id="6723481">m</span><span class="op" id="6723482">.</span><span class="ident" id="6723483">Get</span><span class="op" id="6723486">(</span><span class="string" id="6723487">&#34;Cookie&#34;</span><span class="op" id="6723495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723498">if</span>&nbsp;<span class="ident" id="6723501">cookie</span>&nbsp;<span class="op" id="6723508">!=</span>&nbsp;<span class="ident" id="6723511">sdata</span>&nbsp;<span class="op" id="6723517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723521">t</span><span class="op" id="6723522">.</span><span class="ident" id="6723523">Fatalf</span><span class="op" id="6723529">(</span><span class="string" id="6723530">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="6723571">,</span>&nbsp;<span class="builtinfunc" id="6723573">len</span><span class="op" id="6723576">(</span><span class="ident" id="6723577">cookie</span><span class="op" id="6723583">)</span><span class="op" id="6723584">,</span>&nbsp;<span class="builtinfunc" id="6723586">len</span><span class="op" id="6723589">(</span><span class="ident" id="6723590">sdata</span><span class="op" id="6723595">)</span><span class="op" id="6723596">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6723599">}</span><br>
<span class="lineno"></span><span class="op" id="6723601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6723604">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="6723671">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="6723721">func</span>&nbsp;<span class="ident" id="6723726">TestReadMIMEHeaderNonCompliant</span><span class="op" id="6723756">(</span><span class="ident" id="6723757">t</span>&nbsp;<span class="op" id="6723759">*</span><span class="ident" id="6723760">testing</span><span class="op" id="6723767">.</span><span class="ident" id="6723768">T</span><span class="op" id="6723769">)</span>&nbsp;<span class="op" id="6723771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6723774">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6723835">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6723900">r</span>&nbsp;<span class="op" id="6723902">:=</span>&nbsp;<span class="ident" id="6723905">reader</span><span class="op" id="6723911">(</span><span class="string" id="6723912">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="6723927">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6723931">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="6723958">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6723962">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="6723976">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6723980">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="6724004">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724008">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="6724033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724036">m</span><span class="op" id="6724037">,</span>&nbsp;<span class="ident" id="6724039">err</span>&nbsp;<span class="op" id="6724043">:=</span>&nbsp;<span class="ident" id="6724046">r</span><span class="op" id="6724047">.</span><span class="ident" id="6724048">ReadMIMEHeader</span><span class="op" id="6724062">(</span><span class="op" id="6724063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724066">want</span>&nbsp;<span class="op" id="6724071">:=</span>&nbsp;<span class="ident" id="6724074">MIMEHeader</span><span class="op" id="6724084">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724088">&#34;Foo&#34;</span><span class="op" id="6724093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724108">{</span><span class="string" id="6724109">&#34;bar&#34;</span><span class="op" id="6724114">}</span><span class="op" id="6724115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724119">&#34;Content-Language&#34;</span><span class="op" id="6724137">:</span>&nbsp;<span class="op" id="6724139">{</span><span class="string" id="6724140">&#34;en&#34;</span><span class="op" id="6724144">}</span><span class="op" id="6724145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724149">&#34;Sid&#34;</span><span class="op" id="6724154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724169">{</span><span class="string" id="6724170">&#34;0&#34;</span><span class="op" id="6724173">}</span><span class="op" id="6724174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724178">&#34;Audio-Mode&#34;</span><span class="op" id="6724190">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724198">{</span><span class="string" id="6724199">&#34;None&#34;</span><span class="op" id="6724205">}</span><span class="op" id="6724206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724210">&#34;Privilege&#34;</span><span class="op" id="6724221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724230">{</span><span class="string" id="6724231">&#34;127&#34;</span><span class="op" id="6724236">}</span><span class="op" id="6724237">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6724243">if</span>&nbsp;<span class="op" id="6724246">!</span><span class="ident" id="6724247">reflect</span><span class="op" id="6724254">.</span><span class="ident" id="6724255">DeepEqual</span><span class="op" id="6724264">(</span><span class="ident" id="6724265">m</span><span class="op" id="6724266">,</span>&nbsp;<span class="ident" id="6724268">want</span><span class="op" id="6724272">)</span>&nbsp;<span class="op" id="6724274">||</span>&nbsp;<span class="ident" id="6724277">err</span>&nbsp;<span class="op" id="6724281">!=</span>&nbsp;<span class="builtintype" id="6724284">nil</span>&nbsp;<span class="op" id="6724288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724292">t</span><span class="op" id="6724293">.</span><span class="ident" id="6724294">Fatalf</span><span class="op" id="6724300">(</span><span class="string" id="6724301">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="6724338">,</span>&nbsp;<span class="ident" id="6724340">m</span><span class="op" id="6724341">,</span>&nbsp;<span class="ident" id="6724343">err</span><span class="op" id="6724346">,</span>&nbsp;<span class="ident" id="6724348">want</span><span class="op" id="6724352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724355">}</span><br>
<span class="lineno"></span><span class="op" id="6724357">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="6724360">type</span>&nbsp;<span class="ident" id="6724365">readResponseTest</span>&nbsp;<span class="keyword" id="6724382">struct</span>&nbsp;<span class="op" id="6724389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724392">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6724401">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724409">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6724418">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724423">wantCode</span>&nbsp;<span class="builtintype" id="6724432">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6724437">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="6724446">string</span><br>
<span class="lineno"></span><span class="op" id="6724453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6724456">var</span>&nbsp;<span class="ident" id="6724460">readResponseTests</span>&nbsp;<span class="op" id="6724478">=</span>&nbsp;<span class="op" id="6724480">[</span><span class="op" id="6724481">]</span><span class="ident" id="6724482">readResponseTest</span><span class="op" id="6724498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724501">{</span><span class="string" id="6724502">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="6724555">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724559">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="6724589">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724593">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="6724606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724610">23</span><span class="op" id="6724612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724616">230</span><span class="op" id="6724619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724623">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="6724705">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724708">}</span><span class="op" id="6724709">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724713">{</span><span class="string" id="6724714">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="6724766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724770">23</span><span class="op" id="6724772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724776">230</span><span class="op" id="6724779">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724783">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="6724829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724832">}</span><span class="op" id="6724833">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724837">{</span><span class="string" id="6724838">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="6724859">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724863">4</span><span class="op" id="6724864">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724868">400</span><span class="op" id="6724871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724875">&#34;A\nB\nC&#34;</span><span class="op" id="6724884">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724887">}</span><span class="op" id="6724888">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724892">{</span><span class="string" id="6724893">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="6724922">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724926">4</span><span class="op" id="6724927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6724931">400</span><span class="op" id="6724934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6724938">&#34;A\nB\nC&#34;</span><span class="op" id="6724947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6724950">}</span><span class="op" id="6724951">,</span><br>
<span class="lineno"></span><span class="op" id="6724953">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="6724956">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="6725007">func</span>&nbsp;<span class="ident" id="6725012">TestRFC959Lines</span><span class="op" id="6725027">(</span><span class="ident" id="6725028">t</span>&nbsp;<span class="op" id="6725030">*</span><span class="ident" id="6725031">testing</span><span class="op" id="6725038">.</span><span class="ident" id="6725039">T</span><span class="op" id="6725040">)</span>&nbsp;<span class="op" id="6725042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725045">for</span>&nbsp;<span class="ident" id="6725049">i</span><span class="op" id="6725050">,</span>&nbsp;<span class="ident" id="6725052">tt</span>&nbsp;<span class="op" id="6725055">:=</span>&nbsp;<span class="keyword" id="6725058">range</span>&nbsp;<span class="ident" id="6725064">readResponseTests</span>&nbsp;<span class="op" id="6725082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725086">r</span>&nbsp;<span class="op" id="6725088">:=</span>&nbsp;<span class="ident" id="6725091">reader</span><span class="op" id="6725097">(</span><span class="ident" id="6725098">tt</span><span class="op" id="6725100">.</span><span class="ident" id="6725101">in</span>&nbsp;<span class="op" id="6725104">+</span>&nbsp;<span class="string" id="6725106">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="6725124">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725128">code</span><span class="op" id="6725132">,</span>&nbsp;<span class="ident" id="6725134">msg</span><span class="op" id="6725137">,</span>&nbsp;<span class="ident" id="6725139">err</span>&nbsp;<span class="op" id="6725143">:=</span>&nbsp;<span class="ident" id="6725146">r</span><span class="op" id="6725147">.</span><span class="ident" id="6725148">ReadResponse</span><span class="op" id="6725160">(</span><span class="ident" id="6725161">tt</span><span class="op" id="6725163">.</span><span class="ident" id="6725164">inCode</span><span class="op" id="6725170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725174">if</span>&nbsp;<span class="ident" id="6725177">err</span>&nbsp;<span class="op" id="6725181">!=</span>&nbsp;<span class="builtintype" id="6725184">nil</span>&nbsp;<span class="op" id="6725188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725193">t</span><span class="op" id="6725194">.</span><span class="ident" id="6725195">Errorf</span><span class="op" id="6725201">(</span><span class="string" id="6725202">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="6725225">,</span>&nbsp;<span class="ident" id="6725227">i</span><span class="op" id="6725228">,</span>&nbsp;<span class="ident" id="6725230">err</span><span class="op" id="6725233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725238">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725249">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725253">if</span>&nbsp;<span class="ident" id="6725256">code</span>&nbsp;<span class="op" id="6725261">!=</span>&nbsp;<span class="ident" id="6725264">tt</span><span class="op" id="6725266">.</span><span class="ident" id="6725267">wantCode</span>&nbsp;<span class="op" id="6725276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725281">t</span><span class="op" id="6725282">.</span><span class="ident" id="6725283">Errorf</span><span class="op" id="6725289">(</span><span class="string" id="6725290">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6725313">,</span>&nbsp;<span class="ident" id="6725315">i</span><span class="op" id="6725316">,</span>&nbsp;<span class="ident" id="6725318">code</span><span class="op" id="6725322">,</span>&nbsp;<span class="ident" id="6725324">tt</span><span class="op" id="6725326">.</span><span class="ident" id="6725327">wantCode</span><span class="op" id="6725335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725343">if</span>&nbsp;<span class="ident" id="6725346">msg</span>&nbsp;<span class="op" id="6725350">!=</span>&nbsp;<span class="ident" id="6725353">tt</span><span class="op" id="6725355">.</span><span class="ident" id="6725356">wantMsg</span>&nbsp;<span class="op" id="6725364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725369">t</span><span class="op" id="6725370">.</span><span class="ident" id="6725371">Errorf</span><span class="op" id="6725377">(</span><span class="string" id="6725378">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6725400">,</span>&nbsp;<span class="ident" id="6725402">i</span><span class="op" id="6725403">,</span>&nbsp;<span class="ident" id="6725405">msg</span><span class="op" id="6725408">,</span>&nbsp;<span class="ident" id="6725410">tt</span><span class="op" id="6725412">.</span><span class="ident" id="6725413">wantMsg</span><span class="op" id="6725420">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725427">}</span><br>
<span class="lineno"></span><span class="op" id="6725429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6725432">func</span>&nbsp;<span class="ident" id="6725437">TestCommonHeaders</span><span class="op" id="6725454">(</span><span class="ident" id="6725455">t</span>&nbsp;<span class="op" id="6725457">*</span><span class="ident" id="6725458">testing</span><span class="op" id="6725465">.</span><span class="ident" id="6725466">T</span><span class="op" id="6725467">)</span>&nbsp;<span class="op" id="6725469">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725472">for</span>&nbsp;<span class="ident" id="6725476">h</span>&nbsp;<span class="op" id="6725478">:=</span>&nbsp;<span class="keyword" id="6725481">range</span>&nbsp;<span class="ident" id="6725487">commonHeader</span>&nbsp;<span class="op" id="6725500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725504">if</span>&nbsp;<span class="ident" id="6725507">h</span>&nbsp;<span class="op" id="6725509">!=</span>&nbsp;<span class="ident" id="6725512">CanonicalMIMEHeaderKey</span><span class="op" id="6725534">(</span><span class="ident" id="6725535">h</span><span class="op" id="6725536">)</span>&nbsp;<span class="op" id="6725538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725543">t</span><span class="op" id="6725544">.</span><span class="ident" id="6725545">Errorf</span><span class="op" id="6725551">(</span><span class="string" id="6725552">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="6725593">,</span>&nbsp;<span class="ident" id="6725595">h</span><span class="op" id="6725596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725603">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725606">b</span>&nbsp;<span class="op" id="6725608">:=</span>&nbsp;<span class="op" id="6725611">[</span><span class="op" id="6725612">]</span><span class="builtintype" id="6725613">byte</span><span class="op" id="6725617">(</span><span class="string" id="6725618">&#34;content-Length&#34;</span><span class="op" id="6725634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725637">want</span>&nbsp;<span class="op" id="6725642">:=</span>&nbsp;<span class="string" id="6725645">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725663">n</span>&nbsp;<span class="op" id="6725665">:=</span>&nbsp;<span class="ident" id="6725668">testing</span><span class="op" id="6725675">.</span><span class="ident" id="6725676">AllocsPerRun</span><span class="op" id="6725688">(</span><span class="num" id="6725689">200</span><span class="op" id="6725692">,</span>&nbsp;<span class="keyword" id="6725694">func</span><span class="op" id="6725698">(</span><span class="op" id="6725699">)</span>&nbsp;<span class="op" id="6725701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725705">if</span>&nbsp;<span class="ident" id="6725708">x</span>&nbsp;<span class="op" id="6725710">:=</span>&nbsp;<span class="ident" id="6725713">canonicalMIMEHeaderKey</span><span class="op" id="6725735">(</span><span class="ident" id="6725736">b</span><span class="op" id="6725737">)</span><span class="op" id="6725738">;</span>&nbsp;<span class="ident" id="6725740">x</span>&nbsp;<span class="op" id="6725742">!=</span>&nbsp;<span class="ident" id="6725745">want</span>&nbsp;<span class="op" id="6725750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725755">t</span><span class="op" id="6725756">.</span><span class="ident" id="6725757">Fatalf</span><span class="op" id="6725763">(</span><span class="string" id="6725764">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6725806">,</span>&nbsp;<span class="ident" id="6725808">b</span><span class="op" id="6725809">,</span>&nbsp;<span class="ident" id="6725811">x</span><span class="op" id="6725812">,</span>&nbsp;<span class="ident" id="6725814">want</span><span class="op" id="6725818">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725825">}</span><span class="op" id="6725826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6725829">if</span>&nbsp;<span class="ident" id="6725832">n</span>&nbsp;<span class="op" id="6725834">&gt;</span>&nbsp;<span class="num" id="6725836">0</span>&nbsp;<span class="op" id="6725838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6725842">t</span><span class="op" id="6725843">.</span><span class="ident" id="6725844">Errorf</span><span class="op" id="6725850">(</span><span class="string" id="6725851">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6725895">,</span>&nbsp;<span class="ident" id="6725897">n</span><span class="op" id="6725898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6725901">}</span><br>
<span class="lineno">265</span><span class="op" id="6725903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6725906">var</span>&nbsp;<span class="ident" id="6725910">clientHeaders</span>&nbsp;<span class="op" id="6725924">=</span>&nbsp;<span class="ident" id="6725926">strings</span><span class="op" id="6725933">.</span><span class="ident" id="6725934">Replace</span><span class="op" id="6725941">(</span><span class="string" id="6725942">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="6726619">,</span>&nbsp;<span class="string" id="6726621">&#34;\n&#34;</span><span class="op" id="6726625">,</span>&nbsp;<span class="string" id="6726627">&#34;\r\n&#34;</span><span class="op" id="6726633">,</span>&nbsp;<span class="op" id="6726635">-</span><span class="num" id="6726636">1</span><span class="op" id="6726637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="6726640">var</span>&nbsp;<span class="ident" id="6726644">serverHeaders</span>&nbsp;<span class="op" id="6726658">=</span>&nbsp;<span class="ident" id="6726660">strings</span><span class="op" id="6726667">.</span><span class="ident" id="6726668">Replace</span><span class="op" id="6726675">(</span><span class="string" id="6726676">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="6726928">,</span>&nbsp;<span class="string" id="6726930">&#34;\n&#34;</span><span class="op" id="6726934">,</span>&nbsp;<span class="string" id="6726936">&#34;\r\n&#34;</span><span class="op" id="6726942">,</span>&nbsp;<span class="op" id="6726944">-</span><span class="num" id="6726945">1</span><span class="op" id="6726946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6726949">func</span>&nbsp;<span class="ident" id="6726954">BenchmarkReadMIMEHeader</span><span class="op" id="6726977">(</span><span class="ident" id="6726978">b</span>&nbsp;<span class="op" id="6726980">*</span><span class="ident" id="6726981">testing</span><span class="op" id="6726988">.</span><span class="ident" id="6726989">B</span><span class="op" id="6726990">)</span>&nbsp;<span class="op" id="6726992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6726995">b</span><span class="op" id="6726996">.</span><span class="ident" id="6726997">ReportAllocs</span><span class="op" id="6727009">(</span><span class="op" id="6727010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727013">var</span>&nbsp;<span class="ident" id="6727017">buf</span>&nbsp;<span class="ident" id="6727021">bytes</span><span class="op" id="6727026">.</span><span class="ident" id="6727027">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727035">br</span>&nbsp;<span class="op" id="6727038">:=</span>&nbsp;<span class="ident" id="6727041">bufio</span><span class="op" id="6727046">.</span><span class="ident" id="6727047">NewReader</span><span class="op" id="6727056">(</span><span class="op" id="6727057">&amp;</span><span class="ident" id="6727058">buf</span><span class="op" id="6727061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727064">r</span>&nbsp;<span class="op" id="6727066">:=</span>&nbsp;<span class="ident" id="6727069">NewReader</span><span class="op" id="6727078">(</span><span class="ident" id="6727079">br</span><span class="op" id="6727081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727084">for</span>&nbsp;<span class="ident" id="6727088">i</span>&nbsp;<span class="op" id="6727090">:=</span>&nbsp;<span class="num" id="6727093">0</span><span class="op" id="6727094">;</span>&nbsp;<span class="ident" id="6727096">i</span>&nbsp;<span class="op" id="6727098">&lt;</span>&nbsp;<span class="ident" id="6727100">b</span><span class="op" id="6727101">.</span><span class="ident" id="6727102">N</span><span class="op" id="6727103">;</span>&nbsp;<span class="ident" id="6727105">i</span><span class="op" id="6727106">++</span>&nbsp;<span class="op" id="6727109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727113">var</span>&nbsp;<span class="ident" id="6727117">want</span>&nbsp;<span class="builtintype" id="6727122">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727128">var</span>&nbsp;<span class="ident" id="6727132">find</span>&nbsp;<span class="builtintype" id="6727137">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727146">if</span>&nbsp;<span class="op" id="6727149">(</span><span class="ident" id="6727150">i</span>&nbsp;<span class="op" id="6727152">&amp;</span>&nbsp;<span class="num" id="6727154">1</span><span class="op" id="6727155">)</span>&nbsp;<span class="op" id="6727157">==</span>&nbsp;<span class="num" id="6727160">1</span>&nbsp;<span class="op" id="6727162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727167">buf</span><span class="op" id="6727170">.</span><span class="ident" id="6727171">WriteString</span><span class="op" id="6727182">(</span><span class="ident" id="6727183">clientHeaders</span><span class="op" id="6727196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727201">want</span>&nbsp;<span class="op" id="6727206">=</span>&nbsp;<span class="num" id="6727208">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727214">find</span>&nbsp;<span class="op" id="6727219">=</span>&nbsp;<span class="string" id="6727221">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727232">}</span>&nbsp;<span class="keyword" id="6727234">else</span>&nbsp;<span class="op" id="6727239">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727244">buf</span><span class="op" id="6727247">.</span><span class="ident" id="6727248">WriteString</span><span class="op" id="6727259">(</span><span class="ident" id="6727260">serverHeaders</span><span class="op" id="6727273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727278">want</span>&nbsp;<span class="op" id="6727283">=</span>&nbsp;<span class="num" id="6727285">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727290">find</span>&nbsp;<span class="op" id="6727295">=</span>&nbsp;<span class="string" id="6727297">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727309">h</span><span class="op" id="6727310">,</span>&nbsp;<span class="ident" id="6727312">err</span>&nbsp;<span class="op" id="6727316">:=</span>&nbsp;<span class="ident" id="6727319">r</span><span class="op" id="6727320">.</span><span class="ident" id="6727321">ReadMIMEHeader</span><span class="op" id="6727335">(</span><span class="op" id="6727336">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727340">if</span>&nbsp;<span class="ident" id="6727343">err</span>&nbsp;<span class="op" id="6727347">!=</span>&nbsp;<span class="builtintype" id="6727350">nil</span>&nbsp;<span class="op" id="6727354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727359">b</span><span class="op" id="6727360">.</span><span class="ident" id="6727361">Fatal</span><span class="op" id="6727366">(</span><span class="ident" id="6727367">err</span><span class="op" id="6727370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727378">if</span>&nbsp;<span class="builtinfunc" id="6727381">len</span><span class="op" id="6727384">(</span><span class="ident" id="6727385">h</span><span class="op" id="6727386">)</span>&nbsp;<span class="op" id="6727388">!=</span>&nbsp;<span class="ident" id="6727391">want</span>&nbsp;<span class="op" id="6727396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727401">b</span><span class="op" id="6727402">.</span><span class="ident" id="6727403">Fatalf</span><span class="op" id="6727409">(</span><span class="string" id="6727410">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6727452">,</span>&nbsp;<span class="builtinfunc" id="6727454">len</span><span class="op" id="6727457">(</span><span class="ident" id="6727458">h</span><span class="op" id="6727459">)</span><span class="op" id="6727460">,</span>&nbsp;<span class="ident" id="6727462">want</span><span class="op" id="6727466">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727474">if</span>&nbsp;<span class="ident" id="6727477">_</span><span class="op" id="6727478">,</span>&nbsp;<span class="ident" id="6727480">ok</span>&nbsp;<span class="op" id="6727483">:=</span>&nbsp;<span class="ident" id="6727486">h</span><span class="op" id="6727487">[</span><span class="ident" id="6727488">find</span><span class="op" id="6727492">]</span><span class="op" id="6727493">;</span>&nbsp;<span class="op" id="6727495">!</span><span class="ident" id="6727496">ok</span>&nbsp;<span class="op" id="6727499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727504">b</span><span class="op" id="6727505">.</span><span class="ident" id="6727506">Fatalf</span><span class="op" id="6727512">(</span><span class="string" id="6727513">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="6727534">,</span>&nbsp;<span class="ident" id="6727536">find</span><span class="op" id="6727540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727547">}</span><br>
<span class="lineno">320</span><span class="op" id="6727549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6727552">func</span>&nbsp;<span class="ident" id="6727557">BenchmarkUncommon</span><span class="op" id="6727574">(</span><span class="ident" id="6727575">b</span>&nbsp;<span class="op" id="6727577">*</span><span class="ident" id="6727578">testing</span><span class="op" id="6727585">.</span><span class="ident" id="6727586">B</span><span class="op" id="6727587">)</span>&nbsp;<span class="op" id="6727589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727592">b</span><span class="op" id="6727593">.</span><span class="ident" id="6727594">ReportAllocs</span><span class="op" id="6727606">(</span><span class="op" id="6727607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727610">var</span>&nbsp;<span class="ident" id="6727614">buf</span>&nbsp;<span class="ident" id="6727618">bytes</span><span class="op" id="6727623">.</span><span class="ident" id="6727624">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727632">br</span>&nbsp;<span class="op" id="6727635">:=</span>&nbsp;<span class="ident" id="6727638">bufio</span><span class="op" id="6727643">.</span><span class="ident" id="6727644">NewReader</span><span class="op" id="6727653">(</span><span class="op" id="6727654">&amp;</span><span class="ident" id="6727655">buf</span><span class="op" id="6727658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727661">r</span>&nbsp;<span class="op" id="6727663">:=</span>&nbsp;<span class="ident" id="6727666">NewReader</span><span class="op" id="6727675">(</span><span class="ident" id="6727676">br</span><span class="op" id="6727678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727681">for</span>&nbsp;<span class="ident" id="6727685">i</span>&nbsp;<span class="op" id="6727687">:=</span>&nbsp;<span class="num" id="6727690">0</span><span class="op" id="6727691">;</span>&nbsp;<span class="ident" id="6727693">i</span>&nbsp;<span class="op" id="6727695">&lt;</span>&nbsp;<span class="ident" id="6727697">b</span><span class="op" id="6727698">.</span><span class="ident" id="6727699">N</span><span class="op" id="6727700">;</span>&nbsp;<span class="ident" id="6727702">i</span><span class="op" id="6727703">++</span>&nbsp;<span class="op" id="6727706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727710">buf</span><span class="op" id="6727713">.</span><span class="ident" id="6727714">WriteString</span><span class="op" id="6727725">(</span><span class="string" id="6727726">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="6727770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727774">h</span><span class="op" id="6727775">,</span>&nbsp;<span class="ident" id="6727777">err</span>&nbsp;<span class="op" id="6727781">:=</span>&nbsp;<span class="ident" id="6727784">r</span><span class="op" id="6727785">.</span><span class="ident" id="6727786">ReadMIMEHeader</span><span class="op" id="6727800">(</span><span class="op" id="6727801">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727805">if</span>&nbsp;<span class="ident" id="6727808">err</span>&nbsp;<span class="op" id="6727812">!=</span>&nbsp;<span class="builtintype" id="6727815">nil</span>&nbsp;<span class="op" id="6727819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727824">b</span><span class="op" id="6727825">.</span><span class="ident" id="6727826">Fatal</span><span class="op" id="6727831">(</span><span class="ident" id="6727832">err</span><span class="op" id="6727835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6727843">if</span>&nbsp;<span class="ident" id="6727846">_</span><span class="op" id="6727847">,</span>&nbsp;<span class="ident" id="6727849">ok</span>&nbsp;<span class="op" id="6727852">:=</span>&nbsp;<span class="ident" id="6727855">h</span><span class="op" id="6727856">[</span><span class="string" id="6727857">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="6727888">]</span><span class="op" id="6727889">;</span>&nbsp;<span class="op" id="6727891">!</span><span class="ident" id="6727892">ok</span>&nbsp;<span class="op" id="6727895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6727900">b</span><span class="op" id="6727901">.</span><span class="ident" id="6727902">Fatal</span><span class="op" id="6727907">(</span><span class="string" id="6727908">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="6727932">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6727939">}</span><br>
<span class="lineno"></span><span class="op" id="6727941">}</span>
</div>
</body>
</html>
