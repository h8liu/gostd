<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6313503">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6313558">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6313612">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6313663">package</span>&nbsp;<span class="ident" id="6313671">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6313677">import</span>&nbsp;<span class="op" id="6313684">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6313687">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6313705">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6313712">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6313720">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6313736">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6313741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6313744">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="6313824">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6313890">const</span>&nbsp;<span class="op" id="6313896">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313899">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313918">=</span>&nbsp;<span class="ident" id="6313920">flate</span><span class="op" id="6313925">.</span><span class="ident" id="6313926">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313941">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313960">=</span>&nbsp;<span class="ident" id="6313962">flate</span><span class="op" id="6313967">.</span><span class="ident" id="6313968">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6313979">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6313998">=</span>&nbsp;<span class="ident" id="6314000">flate</span><span class="op" id="6314005">.</span><span class="ident" id="6314006">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314023">DefaultCompression</span>&nbsp;<span class="op" id="6314042">=</span>&nbsp;<span class="ident" id="6314044">flate</span><span class="op" id="6314049">.</span><span class="ident" id="6314050">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="6314069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6314072">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="6314135">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="6314197">type</span>&nbsp;<span class="ident" id="6314202">Writer</span>&nbsp;<span class="keyword" id="6314209">struct</span>&nbsp;<span class="op" id="6314216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314219">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314231">io</span><span class="op" id="6314233">.</span><span class="ident" id="6314234">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314242">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6314254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314259">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314271">[</span><span class="op" id="6314272">]</span><span class="builtintype" id="6314273">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314279">compressor</span>&nbsp;&nbsp;<span class="op" id="6314291">*</span><span class="ident" id="6314292">flate</span><span class="op" id="6314297">.</span><span class="ident" id="6314298">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314306">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314318">hash</span><span class="op" id="6314322">.</span><span class="ident" id="6314323">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314331">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6314343">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314350">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6314362">[</span><span class="num" id="6314363">4</span><span class="op" id="6314364">]</span><span class="builtintype" id="6314365">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314371">wroteHeader</span>&nbsp;<span class="builtintype" id="6314383">bool</span><br>
<span class="lineno">35</span><span class="op" id="6314388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6314391">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="6314426">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="6314492">//</span><br>
<span class="lineno">40</span><span class="comment" id="6314495">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="6314576">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6314631">func</span>&nbsp;<span class="ident" id="6314636">NewWriter</span><span class="op" id="6314645">(</span><span class="ident" id="6314646">w</span>&nbsp;<span class="ident" id="6314648">io</span><span class="op" id="6314650">.</span><span class="ident" id="6314651">Writer</span><span class="op" id="6314657">)</span>&nbsp;<span class="op" id="6314659">*</span><span class="ident" id="6314660">Writer</span>&nbsp;<span class="op" id="6314667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6314670">z</span><span class="op" id="6314671">,</span>&nbsp;<span class="ident" id="6314673">_</span>&nbsp;<span class="op" id="6314675">:=</span>&nbsp;<span class="ident" id="6314678">NewWriterLevelDict</span><span class="op" id="6314696">(</span><span class="ident" id="6314697">w</span><span class="op" id="6314698">,</span>&nbsp;<span class="ident" id="6314700">DefaultCompression</span><span class="op" id="6314718">,</span>&nbsp;<span class="builtintype" id="6314720">nil</span><span class="op" id="6314723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6314726">return</span>&nbsp;<span class="ident" id="6314733">z</span><br>
<span class="lineno">45</span><span class="op" id="6314735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6314738">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="6314818">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="6314853">//</span><br>
<span class="lineno">50</span><span class="comment" id="6314856">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6314930">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6315006">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="6315053">func</span>&nbsp;<span class="ident" id="6315058">NewWriterLevel</span><span class="op" id="6315072">(</span><span class="ident" id="6315073">w</span>&nbsp;<span class="ident" id="6315075">io</span><span class="op" id="6315077">.</span><span class="ident" id="6315078">Writer</span><span class="op" id="6315084">,</span>&nbsp;<span class="ident" id="6315086">level</span>&nbsp;<span class="builtintype" id="6315092">int</span><span class="op" id="6315095">)</span>&nbsp;<span class="op" id="6315097">(</span><span class="op" id="6315098">*</span><span class="ident" id="6315099">Writer</span><span class="op" id="6315105">,</span>&nbsp;<span class="builtintype" id="6315107">error</span><span class="op" id="6315112">)</span>&nbsp;<span class="op" id="6315114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315117">return</span>&nbsp;<span class="ident" id="6315124">NewWriterLevelDict</span><span class="op" id="6315142">(</span><span class="ident" id="6315143">w</span><span class="op" id="6315144">,</span>&nbsp;<span class="ident" id="6315146">level</span><span class="op" id="6315151">,</span>&nbsp;<span class="builtintype" id="6315153">nil</span><span class="op" id="6315156">)</span><br>
<span class="lineno">55</span><span class="op" id="6315158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6315161">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6315236">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="6315254">//</span><br>
<span class="lineno">60</span><span class="comment" id="6315257">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="6315337">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6315362">func</span>&nbsp;<span class="ident" id="6315367">NewWriterLevelDict</span><span class="op" id="6315385">(</span><span class="ident" id="6315386">w</span>&nbsp;<span class="ident" id="6315388">io</span><span class="op" id="6315390">.</span><span class="ident" id="6315391">Writer</span><span class="op" id="6315397">,</span>&nbsp;<span class="ident" id="6315399">level</span>&nbsp;<span class="builtintype" id="6315405">int</span><span class="op" id="6315408">,</span>&nbsp;<span class="ident" id="6315410">dict</span>&nbsp;<span class="op" id="6315415">[</span><span class="op" id="6315416">]</span><span class="builtintype" id="6315417">byte</span><span class="op" id="6315421">)</span>&nbsp;<span class="op" id="6315423">(</span><span class="op" id="6315424">*</span><span class="ident" id="6315425">Writer</span><span class="op" id="6315431">,</span>&nbsp;<span class="builtintype" id="6315433">error</span><span class="op" id="6315438">)</span>&nbsp;<span class="op" id="6315440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315443">if</span>&nbsp;<span class="ident" id="6315446">level</span>&nbsp;<span class="op" id="6315452">&lt;</span>&nbsp;<span class="ident" id="6315454">DefaultCompression</span>&nbsp;<span class="op" id="6315473">||</span>&nbsp;<span class="ident" id="6315476">level</span>&nbsp;<span class="op" id="6315482">&gt;</span>&nbsp;<span class="ident" id="6315484">BestCompression</span>&nbsp;<span class="op" id="6315500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315504">return</span>&nbsp;<span class="builtintype" id="6315511">nil</span><span class="op" id="6315514">,</span>&nbsp;<span class="ident" id="6315516">fmt</span><span class="op" id="6315519">.</span><span class="ident" id="6315520">Errorf</span><span class="op" id="6315526">(</span><span class="string" id="6315527">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="6315564">,</span>&nbsp;<span class="ident" id="6315566">level</span><span class="op" id="6315571">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315577">return</span>&nbsp;<span class="op" id="6315584">&amp;</span><span class="ident" id="6315585">Writer</span><span class="op" id="6315591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315595">w</span><span class="op" id="6315596">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315602">w</span><span class="op" id="6315603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315607">level</span><span class="op" id="6315612">:</span>&nbsp;<span class="ident" id="6315614">level</span><span class="op" id="6315619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315623">dict</span><span class="op" id="6315627">:</span>&nbsp;&nbsp;<span class="ident" id="6315630">dict</span><span class="op" id="6315634">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315637">}</span><span class="op" id="6315638">,</span>&nbsp;<span class="builtintype" id="6315640">nil</span><br>
<span class="lineno"></span><span class="op" id="6315644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6315647">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6315723">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="6315803">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6315812">func</span>&nbsp;<span class="op" id="6315817">(</span><span class="ident" id="6315818">z</span>&nbsp;<span class="op" id="6315820">*</span><span class="ident" id="6315821">Writer</span><span class="op" id="6315827">)</span>&nbsp;<span class="ident" id="6315829">Reset</span><span class="op" id="6315834">(</span><span class="ident" id="6315835">w</span>&nbsp;<span class="ident" id="6315837">io</span><span class="op" id="6315839">.</span><span class="ident" id="6315840">Writer</span><span class="op" id="6315846">)</span>&nbsp;<span class="op" id="6315848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315851">z</span><span class="op" id="6315852">.</span><span class="ident" id="6315853">w</span>&nbsp;<span class="op" id="6315855">=</span>&nbsp;<span class="ident" id="6315857">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6315860">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315899">if</span>&nbsp;<span class="ident" id="6315902">z</span><span class="op" id="6315903">.</span><span class="ident" id="6315904">compressor</span>&nbsp;<span class="op" id="6315915">!=</span>&nbsp;<span class="builtintype" id="6315918">nil</span>&nbsp;<span class="op" id="6315922">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315926">z</span><span class="op" id="6315927">.</span><span class="ident" id="6315928">compressor</span><span class="op" id="6315938">.</span><span class="ident" id="6315939">Reset</span><span class="op" id="6315944">(</span><span class="ident" id="6315945">w</span><span class="op" id="6315946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6315952">if</span>&nbsp;<span class="ident" id="6315955">z</span><span class="op" id="6315956">.</span><span class="ident" id="6315957">digest</span>&nbsp;<span class="op" id="6315964">!=</span>&nbsp;<span class="builtintype" id="6315967">nil</span>&nbsp;<span class="op" id="6315971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315975">z</span><span class="op" id="6315976">.</span><span class="ident" id="6315977">digest</span><span class="op" id="6315983">.</span><span class="ident" id="6315984">Reset</span><span class="op" id="6315989">(</span><span class="op" id="6315990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6315993">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6315996">z</span><span class="op" id="6315997">.</span><span class="ident" id="6315998">err</span>&nbsp;<span class="op" id="6316002">=</span>&nbsp;<span class="builtintype" id="6316004">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316009">z</span><span class="op" id="6316010">.</span><span class="ident" id="6316011">scratch</span>&nbsp;<span class="op" id="6316019">=</span>&nbsp;<span class="op" id="6316021">[</span><span class="num" id="6316022">4</span><span class="op" id="6316023">]</span><span class="builtintype" id="6316024">byte</span><span class="op" id="6316028">{</span><span class="op" id="6316029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316032">z</span><span class="op" id="6316033">.</span><span class="ident" id="6316034">wroteHeader</span>&nbsp;<span class="op" id="6316046">=</span>&nbsp;<span class="builtintype" id="6316048">false</span><br>
<span class="lineno"></span><span class="op" id="6316054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6316057">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6316096">func</span>&nbsp;<span class="op" id="6316101">(</span><span class="ident" id="6316102">z</span>&nbsp;<span class="op" id="6316104">*</span><span class="ident" id="6316105">Writer</span><span class="op" id="6316111">)</span>&nbsp;<span class="ident" id="6316113">writeHeader</span><span class="op" id="6316124">(</span><span class="op" id="6316125">)</span>&nbsp;<span class="op" id="6316127">(</span><span class="ident" id="6316128">err</span>&nbsp;<span class="builtintype" id="6316132">error</span><span class="op" id="6316137">)</span>&nbsp;<span class="op" id="6316139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316142">z</span><span class="op" id="6316143">.</span><span class="ident" id="6316144">wroteHeader</span>&nbsp;<span class="op" id="6316156">=</span>&nbsp;<span class="builtintype" id="6316158">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316164">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316224">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316329">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316408">z</span><span class="op" id="6316409">.</span><span class="ident" id="6316410">scratch</span><span class="op" id="6316417">[</span><span class="num" id="6316418">0</span><span class="op" id="6316419">]</span>&nbsp;<span class="op" id="6316421">=</span>&nbsp;<span class="num" id="6316423">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316429">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316507">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316549">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6316607">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316662">switch</span>&nbsp;<span class="ident" id="6316669">z</span><span class="op" id="6316670">.</span><span class="ident" id="6316671">level</span>&nbsp;<span class="op" id="6316677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316680">case</span>&nbsp;<span class="num" id="6316685">0</span><span class="op" id="6316686">,</span>&nbsp;<span class="num" id="6316688">1</span><span class="op" id="6316689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316693">z</span><span class="op" id="6316694">.</span><span class="ident" id="6316695">scratch</span><span class="op" id="6316702">[</span><span class="num" id="6316703">1</span><span class="op" id="6316704">]</span>&nbsp;<span class="op" id="6316706">=</span>&nbsp;<span class="num" id="6316708">0</span>&nbsp;<span class="op" id="6316710">&lt;&lt;</span>&nbsp;<span class="num" id="6316713">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316716">case</span>&nbsp;<span class="num" id="6316721">2</span><span class="op" id="6316722">,</span>&nbsp;<span class="num" id="6316724">3</span><span class="op" id="6316725">,</span>&nbsp;<span class="num" id="6316727">4</span><span class="op" id="6316728">,</span>&nbsp;<span class="num" id="6316730">5</span><span class="op" id="6316731">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316735">z</span><span class="op" id="6316736">.</span><span class="ident" id="6316737">scratch</span><span class="op" id="6316744">[</span><span class="num" id="6316745">1</span><span class="op" id="6316746">]</span>&nbsp;<span class="op" id="6316748">=</span>&nbsp;<span class="num" id="6316750">1</span>&nbsp;<span class="op" id="6316752">&lt;&lt;</span>&nbsp;<span class="num" id="6316755">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316758">case</span>&nbsp;<span class="num" id="6316763">6</span><span class="op" id="6316764">,</span>&nbsp;<span class="op" id="6316766">-</span><span class="num" id="6316767">1</span><span class="op" id="6316768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316772">z</span><span class="op" id="6316773">.</span><span class="ident" id="6316774">scratch</span><span class="op" id="6316781">[</span><span class="num" id="6316782">1</span><span class="op" id="6316783">]</span>&nbsp;<span class="op" id="6316785">=</span>&nbsp;<span class="num" id="6316787">2</span>&nbsp;<span class="op" id="6316789">&lt;&lt;</span>&nbsp;<span class="num" id="6316792">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316795">case</span>&nbsp;<span class="num" id="6316800">7</span><span class="op" id="6316801">,</span>&nbsp;<span class="num" id="6316803">8</span><span class="op" id="6316804">,</span>&nbsp;<span class="num" id="6316806">9</span><span class="op" id="6316807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316811">z</span><span class="op" id="6316812">.</span><span class="ident" id="6316813">scratch</span><span class="op" id="6316820">[</span><span class="num" id="6316821">1</span><span class="op" id="6316822">]</span>&nbsp;<span class="op" id="6316824">=</span>&nbsp;<span class="num" id="6316826">3</span>&nbsp;<span class="op" id="6316828">&lt;&lt;</span>&nbsp;<span class="num" id="6316831">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316834">default</span><span class="op" id="6316841">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6316845">panic</span><span class="op" id="6316850">(</span><span class="string" id="6316851">&#34;unreachable&#34;</span><span class="op" id="6316864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316870">if</span>&nbsp;<span class="ident" id="6316873">z</span><span class="op" id="6316874">.</span><span class="ident" id="6316875">dict</span>&nbsp;<span class="op" id="6316880">!=</span>&nbsp;<span class="builtintype" id="6316883">nil</span>&nbsp;<span class="op" id="6316887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316891">z</span><span class="op" id="6316892">.</span><span class="ident" id="6316893">scratch</span><span class="op" id="6316900">[</span><span class="num" id="6316901">1</span><span class="op" id="6316902">]</span>&nbsp;<span class="op" id="6316904">|=</span>&nbsp;<span class="num" id="6316907">1</span>&nbsp;<span class="op" id="6316909">&lt;&lt;</span>&nbsp;<span class="num" id="6316912">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6316915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6316918">z</span><span class="op" id="6316919">.</span><span class="ident" id="6316920">scratch</span><span class="op" id="6316927">[</span><span class="num" id="6316928">1</span><span class="op" id="6316929">]</span>&nbsp;<span class="op" id="6316931">+=</span>&nbsp;<span class="builtintype" id="6316934">uint8</span><span class="op" id="6316939">(</span><span class="num" id="6316940">31</span>&nbsp;<span class="op" id="6316943">-</span>&nbsp;<span class="op" id="6316945">(</span><span class="builtintype" id="6316946">uint16</span><span class="op" id="6316952">(</span><span class="ident" id="6316953">z</span><span class="op" id="6316954">.</span><span class="ident" id="6316955">scratch</span><span class="op" id="6316962">[</span><span class="num" id="6316963">0</span><span class="op" id="6316964">]</span><span class="op" id="6316965">)</span><span class="op" id="6316966">&lt;&lt;</span><span class="num" id="6316968">8</span><span class="op" id="6316969">+</span><span class="builtintype" id="6316970">uint16</span><span class="op" id="6316976">(</span><span class="ident" id="6316977">z</span><span class="op" id="6316978">.</span><span class="ident" id="6316979">scratch</span><span class="op" id="6316986">[</span><span class="num" id="6316987">1</span><span class="op" id="6316988">]</span><span class="op" id="6316989">)</span><span class="op" id="6316990">)</span><span class="op" id="6316991">%</span><span class="num" id="6316992">31</span><span class="op" id="6316994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6316997">if</span>&nbsp;<span class="ident" id="6317000">_</span><span class="op" id="6317001">,</span>&nbsp;<span class="ident" id="6317003">err</span>&nbsp;<span class="op" id="6317007">=</span>&nbsp;<span class="ident" id="6317009">z</span><span class="op" id="6317010">.</span><span class="ident" id="6317011">w</span><span class="op" id="6317012">.</span><span class="ident" id="6317013">Write</span><span class="op" id="6317018">(</span><span class="ident" id="6317019">z</span><span class="op" id="6317020">.</span><span class="ident" id="6317021">scratch</span><span class="op" id="6317028">[</span><span class="num" id="6317029">0</span><span class="op" id="6317030">:</span><span class="num" id="6317031">2</span><span class="op" id="6317032">]</span><span class="op" id="6317033">)</span><span class="op" id="6317034">;</span>&nbsp;<span class="ident" id="6317036">err</span>&nbsp;<span class="op" id="6317040">!=</span>&nbsp;<span class="builtintype" id="6317043">nil</span>&nbsp;<span class="op" id="6317047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317051">return</span>&nbsp;<span class="ident" id="6317058">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317063">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317066">if</span>&nbsp;<span class="ident" id="6317069">z</span><span class="op" id="6317070">.</span><span class="ident" id="6317071">dict</span>&nbsp;<span class="op" id="6317076">!=</span>&nbsp;<span class="builtintype" id="6317079">nil</span>&nbsp;<span class="op" id="6317083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6317087">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317157">checksum</span>&nbsp;<span class="op" id="6317166">:=</span>&nbsp;<span class="ident" id="6317169">adler32</span><span class="op" id="6317176">.</span><span class="ident" id="6317177">Checksum</span><span class="op" id="6317185">(</span><span class="ident" id="6317186">z</span><span class="op" id="6317187">.</span><span class="ident" id="6317188">dict</span><span class="op" id="6317192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317196">z</span><span class="op" id="6317197">.</span><span class="ident" id="6317198">scratch</span><span class="op" id="6317205">[</span><span class="num" id="6317206">0</span><span class="op" id="6317207">]</span>&nbsp;<span class="op" id="6317209">=</span>&nbsp;<span class="builtintype" id="6317211">uint8</span><span class="op" id="6317216">(</span><span class="ident" id="6317217">checksum</span>&nbsp;<span class="op" id="6317226">&gt;&gt;</span>&nbsp;<span class="num" id="6317229">24</span><span class="op" id="6317231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317235">z</span><span class="op" id="6317236">.</span><span class="ident" id="6317237">scratch</span><span class="op" id="6317244">[</span><span class="num" id="6317245">1</span><span class="op" id="6317246">]</span>&nbsp;<span class="op" id="6317248">=</span>&nbsp;<span class="builtintype" id="6317250">uint8</span><span class="op" id="6317255">(</span><span class="ident" id="6317256">checksum</span>&nbsp;<span class="op" id="6317265">&gt;&gt;</span>&nbsp;<span class="num" id="6317268">16</span><span class="op" id="6317270">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317274">z</span><span class="op" id="6317275">.</span><span class="ident" id="6317276">scratch</span><span class="op" id="6317283">[</span><span class="num" id="6317284">2</span><span class="op" id="6317285">]</span>&nbsp;<span class="op" id="6317287">=</span>&nbsp;<span class="builtintype" id="6317289">uint8</span><span class="op" id="6317294">(</span><span class="ident" id="6317295">checksum</span>&nbsp;<span class="op" id="6317304">&gt;&gt;</span>&nbsp;<span class="num" id="6317307">8</span><span class="op" id="6317308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317312">z</span><span class="op" id="6317313">.</span><span class="ident" id="6317314">scratch</span><span class="op" id="6317321">[</span><span class="num" id="6317322">3</span><span class="op" id="6317323">]</span>&nbsp;<span class="op" id="6317325">=</span>&nbsp;<span class="builtintype" id="6317327">uint8</span><span class="op" id="6317332">(</span><span class="ident" id="6317333">checksum</span>&nbsp;<span class="op" id="6317342">&gt;&gt;</span>&nbsp;<span class="num" id="6317345">0</span><span class="op" id="6317346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317350">if</span>&nbsp;<span class="ident" id="6317353">_</span><span class="op" id="6317354">,</span>&nbsp;<span class="ident" id="6317356">err</span>&nbsp;<span class="op" id="6317360">=</span>&nbsp;<span class="ident" id="6317362">z</span><span class="op" id="6317363">.</span><span class="ident" id="6317364">w</span><span class="op" id="6317365">.</span><span class="ident" id="6317366">Write</span><span class="op" id="6317371">(</span><span class="ident" id="6317372">z</span><span class="op" id="6317373">.</span><span class="ident" id="6317374">scratch</span><span class="op" id="6317381">[</span><span class="num" id="6317382">0</span><span class="op" id="6317383">:</span><span class="num" id="6317384">4</span><span class="op" id="6317385">]</span><span class="op" id="6317386">)</span><span class="op" id="6317387">;</span>&nbsp;<span class="ident" id="6317389">err</span>&nbsp;<span class="op" id="6317393">!=</span>&nbsp;<span class="builtintype" id="6317396">nil</span>&nbsp;<span class="op" id="6317400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317405">return</span>&nbsp;<span class="ident" id="6317412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317418">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317424">if</span>&nbsp;<span class="ident" id="6317427">z</span><span class="op" id="6317428">.</span><span class="ident" id="6317429">compressor</span>&nbsp;<span class="op" id="6317440">==</span>&nbsp;<span class="builtintype" id="6317443">nil</span>&nbsp;<span class="op" id="6317447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6317451">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6317510">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317535">z</span><span class="op" id="6317536">.</span><span class="ident" id="6317537">compressor</span><span class="op" id="6317547">,</span>&nbsp;<span class="ident" id="6317549">err</span>&nbsp;<span class="op" id="6317553">=</span>&nbsp;<span class="ident" id="6317555">flate</span><span class="op" id="6317560">.</span><span class="ident" id="6317561">NewWriterDict</span><span class="op" id="6317574">(</span><span class="ident" id="6317575">z</span><span class="op" id="6317576">.</span><span class="ident" id="6317577">w</span><span class="op" id="6317578">,</span>&nbsp;<span class="ident" id="6317580">z</span><span class="op" id="6317581">.</span><span class="ident" id="6317582">level</span><span class="op" id="6317587">,</span>&nbsp;<span class="ident" id="6317589">z</span><span class="op" id="6317590">.</span><span class="ident" id="6317591">dict</span><span class="op" id="6317595">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317599">if</span>&nbsp;<span class="ident" id="6317602">err</span>&nbsp;<span class="op" id="6317606">!=</span>&nbsp;<span class="builtintype" id="6317609">nil</span>&nbsp;<span class="op" id="6317613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317618">return</span>&nbsp;<span class="ident" id="6317625">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317635">z</span><span class="op" id="6317636">.</span><span class="ident" id="6317637">digest</span>&nbsp;<span class="op" id="6317644">=</span>&nbsp;<span class="ident" id="6317646">adler32</span><span class="op" id="6317653">.</span><span class="ident" id="6317654">New</span><span class="op" id="6317657">(</span><span class="op" id="6317658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317661">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317664">return</span>&nbsp;<span class="builtintype" id="6317671">nil</span><br>
<span class="lineno"></span><span class="op" id="6317675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317678">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6317750">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="6317828">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6317851">func</span>&nbsp;<span class="op" id="6317856">(</span><span class="ident" id="6317857">z</span>&nbsp;<span class="op" id="6317859">*</span><span class="ident" id="6317860">Writer</span><span class="op" id="6317866">)</span>&nbsp;<span class="ident" id="6317868">Write</span><span class="op" id="6317873">(</span><span class="ident" id="6317874">p</span>&nbsp;<span class="op" id="6317876">[</span><span class="op" id="6317877">]</span><span class="builtintype" id="6317878">byte</span><span class="op" id="6317882">)</span>&nbsp;<span class="op" id="6317884">(</span><span class="ident" id="6317885">n</span>&nbsp;<span class="builtintype" id="6317887">int</span><span class="op" id="6317890">,</span>&nbsp;<span class="ident" id="6317892">err</span>&nbsp;<span class="builtintype" id="6317896">error</span><span class="op" id="6317901">)</span>&nbsp;<span class="op" id="6317903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317906">if</span>&nbsp;<span class="op" id="6317909">!</span><span class="ident" id="6317910">z</span><span class="op" id="6317911">.</span><span class="ident" id="6317912">wroteHeader</span>&nbsp;<span class="op" id="6317924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6317928">z</span><span class="op" id="6317929">.</span><span class="ident" id="6317930">err</span>&nbsp;<span class="op" id="6317934">=</span>&nbsp;<span class="ident" id="6317936">z</span><span class="op" id="6317937">.</span><span class="ident" id="6317938">writeHeader</span><span class="op" id="6317949">(</span><span class="op" id="6317950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317953">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317956">if</span>&nbsp;<span class="ident" id="6317959">z</span><span class="op" id="6317960">.</span><span class="ident" id="6317961">err</span>&nbsp;<span class="op" id="6317965">!=</span>&nbsp;<span class="builtintype" id="6317968">nil</span>&nbsp;<span class="op" id="6317972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317976">return</span>&nbsp;<span class="num" id="6317983">0</span><span class="op" id="6317984">,</span>&nbsp;<span class="ident" id="6317986">z</span><span class="op" id="6317987">.</span><span class="ident" id="6317988">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6317993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6317996">if</span>&nbsp;<span class="builtinfunc" id="6317999">len</span><span class="op" id="6318002">(</span><span class="ident" id="6318003">p</span><span class="op" id="6318004">)</span>&nbsp;<span class="op" id="6318006">==</span>&nbsp;<span class="num" id="6318009">0</span>&nbsp;<span class="op" id="6318011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318015">return</span>&nbsp;<span class="num" id="6318022">0</span><span class="op" id="6318023">,</span>&nbsp;<span class="builtintype" id="6318025">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318033">n</span><span class="op" id="6318034">,</span>&nbsp;<span class="ident" id="6318036">err</span>&nbsp;<span class="op" id="6318040">=</span>&nbsp;<span class="ident" id="6318042">z</span><span class="op" id="6318043">.</span><span class="ident" id="6318044">compressor</span><span class="op" id="6318054">.</span><span class="ident" id="6318055">Write</span><span class="op" id="6318060">(</span><span class="ident" id="6318061">p</span><span class="op" id="6318062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318065">if</span>&nbsp;<span class="ident" id="6318068">err</span>&nbsp;<span class="op" id="6318072">!=</span>&nbsp;<span class="builtintype" id="6318075">nil</span>&nbsp;<span class="op" id="6318079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318083">z</span><span class="op" id="6318084">.</span><span class="ident" id="6318085">err</span>&nbsp;<span class="op" id="6318089">=</span>&nbsp;<span class="ident" id="6318091">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318097">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318108">z</span><span class="op" id="6318109">.</span><span class="ident" id="6318110">digest</span><span class="op" id="6318116">.</span><span class="ident" id="6318117">Write</span><span class="op" id="6318122">(</span><span class="ident" id="6318123">p</span><span class="op" id="6318124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318127">return</span><br>
<span class="lineno"></span><span class="op" id="6318134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6318137">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6318194">func</span>&nbsp;<span class="op" id="6318199">(</span><span class="ident" id="6318200">z</span>&nbsp;<span class="op" id="6318202">*</span><span class="ident" id="6318203">Writer</span><span class="op" id="6318209">)</span>&nbsp;<span class="ident" id="6318211">Flush</span><span class="op" id="6318216">(</span><span class="op" id="6318217">)</span>&nbsp;<span class="builtintype" id="6318219">error</span>&nbsp;<span class="op" id="6318225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318228">if</span>&nbsp;<span class="op" id="6318231">!</span><span class="ident" id="6318232">z</span><span class="op" id="6318233">.</span><span class="ident" id="6318234">wroteHeader</span>&nbsp;<span class="op" id="6318246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318250">z</span><span class="op" id="6318251">.</span><span class="ident" id="6318252">err</span>&nbsp;<span class="op" id="6318256">=</span>&nbsp;<span class="ident" id="6318258">z</span><span class="op" id="6318259">.</span><span class="ident" id="6318260">writeHeader</span><span class="op" id="6318271">(</span><span class="op" id="6318272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318275">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318278">if</span>&nbsp;<span class="ident" id="6318281">z</span><span class="op" id="6318282">.</span><span class="ident" id="6318283">err</span>&nbsp;<span class="op" id="6318287">!=</span>&nbsp;<span class="builtintype" id="6318290">nil</span>&nbsp;<span class="op" id="6318294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318298">return</span>&nbsp;<span class="ident" id="6318305">z</span><span class="op" id="6318306">.</span><span class="ident" id="6318307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318315">z</span><span class="op" id="6318316">.</span><span class="ident" id="6318317">err</span>&nbsp;<span class="op" id="6318321">=</span>&nbsp;<span class="ident" id="6318323">z</span><span class="op" id="6318324">.</span><span class="ident" id="6318325">compressor</span><span class="op" id="6318335">.</span><span class="ident" id="6318336">Flush</span><span class="op" id="6318341">(</span><span class="op" id="6318342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318345">return</span>&nbsp;<span class="ident" id="6318352">z</span><span class="op" id="6318353">.</span><span class="ident" id="6318354">err</span><br>
<span class="lineno">175</span><span class="op" id="6318358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6318361">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6318435">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6318494">func</span>&nbsp;<span class="op" id="6318499">(</span><span class="ident" id="6318500">z</span>&nbsp;<span class="op" id="6318502">*</span><span class="ident" id="6318503">Writer</span><span class="op" id="6318509">)</span>&nbsp;<span class="ident" id="6318511">Close</span><span class="op" id="6318516">(</span><span class="op" id="6318517">)</span>&nbsp;<span class="builtintype" id="6318519">error</span>&nbsp;<span class="op" id="6318525">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318528">if</span>&nbsp;<span class="op" id="6318531">!</span><span class="ident" id="6318532">z</span><span class="op" id="6318533">.</span><span class="ident" id="6318534">wroteHeader</span>&nbsp;<span class="op" id="6318546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318550">z</span><span class="op" id="6318551">.</span><span class="ident" id="6318552">err</span>&nbsp;<span class="op" id="6318556">=</span>&nbsp;<span class="ident" id="6318558">z</span><span class="op" id="6318559">.</span><span class="ident" id="6318560">writeHeader</span><span class="op" id="6318571">(</span><span class="op" id="6318572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318578">if</span>&nbsp;<span class="ident" id="6318581">z</span><span class="op" id="6318582">.</span><span class="ident" id="6318583">err</span>&nbsp;<span class="op" id="6318587">!=</span>&nbsp;<span class="builtintype" id="6318590">nil</span>&nbsp;<span class="op" id="6318594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318598">return</span>&nbsp;<span class="ident" id="6318605">z</span><span class="op" id="6318606">.</span><span class="ident" id="6318607">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318615">z</span><span class="op" id="6318616">.</span><span class="ident" id="6318617">err</span>&nbsp;<span class="op" id="6318621">=</span>&nbsp;<span class="ident" id="6318623">z</span><span class="op" id="6318624">.</span><span class="ident" id="6318625">compressor</span><span class="op" id="6318635">.</span><span class="ident" id="6318636">Close</span><span class="op" id="6318641">(</span><span class="op" id="6318642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318645">if</span>&nbsp;<span class="ident" id="6318648">z</span><span class="op" id="6318649">.</span><span class="ident" id="6318650">err</span>&nbsp;<span class="op" id="6318654">!=</span>&nbsp;<span class="builtintype" id="6318657">nil</span>&nbsp;<span class="op" id="6318661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318665">return</span>&nbsp;<span class="ident" id="6318672">z</span><span class="op" id="6318673">.</span><span class="ident" id="6318674">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6318679">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318682">checksum</span>&nbsp;<span class="op" id="6318691">:=</span>&nbsp;<span class="ident" id="6318694">z</span><span class="op" id="6318695">.</span><span class="ident" id="6318696">digest</span><span class="op" id="6318702">.</span><span class="ident" id="6318703">Sum32</span><span class="op" id="6318708">(</span><span class="op" id="6318709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6318712">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318771">z</span><span class="op" id="6318772">.</span><span class="ident" id="6318773">scratch</span><span class="op" id="6318780">[</span><span class="num" id="6318781">0</span><span class="op" id="6318782">]</span>&nbsp;<span class="op" id="6318784">=</span>&nbsp;<span class="builtintype" id="6318786">uint8</span><span class="op" id="6318791">(</span><span class="ident" id="6318792">checksum</span>&nbsp;<span class="op" id="6318801">&gt;&gt;</span>&nbsp;<span class="num" id="6318804">24</span><span class="op" id="6318806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318809">z</span><span class="op" id="6318810">.</span><span class="ident" id="6318811">scratch</span><span class="op" id="6318818">[</span><span class="num" id="6318819">1</span><span class="op" id="6318820">]</span>&nbsp;<span class="op" id="6318822">=</span>&nbsp;<span class="builtintype" id="6318824">uint8</span><span class="op" id="6318829">(</span><span class="ident" id="6318830">checksum</span>&nbsp;<span class="op" id="6318839">&gt;&gt;</span>&nbsp;<span class="num" id="6318842">16</span><span class="op" id="6318844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318847">z</span><span class="op" id="6318848">.</span><span class="ident" id="6318849">scratch</span><span class="op" id="6318856">[</span><span class="num" id="6318857">2</span><span class="op" id="6318858">]</span>&nbsp;<span class="op" id="6318860">=</span>&nbsp;<span class="builtintype" id="6318862">uint8</span><span class="op" id="6318867">(</span><span class="ident" id="6318868">checksum</span>&nbsp;<span class="op" id="6318877">&gt;&gt;</span>&nbsp;<span class="num" id="6318880">8</span><span class="op" id="6318881">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318884">z</span><span class="op" id="6318885">.</span><span class="ident" id="6318886">scratch</span><span class="op" id="6318893">[</span><span class="num" id="6318894">3</span><span class="op" id="6318895">]</span>&nbsp;<span class="op" id="6318897">=</span>&nbsp;<span class="builtintype" id="6318899">uint8</span><span class="op" id="6318904">(</span><span class="ident" id="6318905">checksum</span>&nbsp;<span class="op" id="6318914">&gt;&gt;</span>&nbsp;<span class="num" id="6318917">0</span><span class="op" id="6318918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6318921">_</span><span class="op" id="6318922">,</span>&nbsp;<span class="ident" id="6318924">z</span><span class="op" id="6318925">.</span><span class="ident" id="6318926">err</span>&nbsp;<span class="op" id="6318930">=</span>&nbsp;<span class="ident" id="6318932">z</span><span class="op" id="6318933">.</span><span class="ident" id="6318934">w</span><span class="op" id="6318935">.</span><span class="ident" id="6318936">Write</span><span class="op" id="6318941">(</span><span class="ident" id="6318942">z</span><span class="op" id="6318943">.</span><span class="ident" id="6318944">scratch</span><span class="op" id="6318951">[</span><span class="num" id="6318952">0</span><span class="op" id="6318953">:</span><span class="num" id="6318954">4</span><span class="op" id="6318955">]</span><span class="op" id="6318956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6318959">return</span>&nbsp;<span class="ident" id="6318966">z</span><span class="op" id="6318967">.</span><span class="ident" id="6318968">err</span><br>
<span class="lineno"></span><span class="op" id="6318972">}</span>
</div>
</body>
</html>
