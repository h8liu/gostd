<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7245728">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7245783">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7245837">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7245888">package</span>&nbsp;<span class="ident" id="7245896">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7245903">import</span>&nbsp;<span class="op" id="7245910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7245913">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7245920">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7245933">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7245941">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7245951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7245954">func</span>&nbsp;<span class="ident" id="7245959">checkPos</span><span class="op" id="7245967">(</span><span class="ident" id="7245968">t</span>&nbsp;<span class="op" id="7245970">*</span><span class="ident" id="7245971">testing</span><span class="op" id="7245978">.</span><span class="ident" id="7245979">T</span><span class="op" id="7245980">,</span>&nbsp;<span class="ident" id="7245982">msg</span>&nbsp;<span class="builtintype" id="7245986">string</span><span class="op" id="7245992">,</span>&nbsp;<span class="ident" id="7245994">got</span><span class="op" id="7245997">,</span>&nbsp;<span class="ident" id="7245999">want</span>&nbsp;<span class="ident" id="7246004">Position</span><span class="op" id="7246012">)</span>&nbsp;<span class="op" id="7246014">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246017">if</span>&nbsp;<span class="ident" id="7246020">got</span><span class="op" id="7246023">.</span><span class="ident" id="7246024">Filename</span>&nbsp;<span class="op" id="7246033">!=</span>&nbsp;<span class="ident" id="7246036">want</span><span class="op" id="7246040">.</span><span class="ident" id="7246041">Filename</span>&nbsp;<span class="op" id="7246050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246054">t</span><span class="op" id="7246055">.</span><span class="ident" id="7246056">Errorf</span><span class="op" id="7246062">(</span><span class="string" id="7246063">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7246095">,</span>&nbsp;<span class="ident" id="7246097">msg</span><span class="op" id="7246100">,</span>&nbsp;<span class="ident" id="7246102">got</span><span class="op" id="7246105">.</span><span class="ident" id="7246106">Filename</span><span class="op" id="7246114">,</span>&nbsp;<span class="ident" id="7246116">want</span><span class="op" id="7246120">.</span><span class="ident" id="7246121">Filename</span><span class="op" id="7246129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246135">if</span>&nbsp;<span class="ident" id="7246138">got</span><span class="op" id="7246141">.</span><span class="ident" id="7246142">Offset</span>&nbsp;<span class="op" id="7246149">!=</span>&nbsp;<span class="ident" id="7246152">want</span><span class="op" id="7246156">.</span><span class="ident" id="7246157">Offset</span>&nbsp;<span class="op" id="7246164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246168">t</span><span class="op" id="7246169">.</span><span class="ident" id="7246170">Errorf</span><span class="op" id="7246176">(</span><span class="string" id="7246177">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7246207">,</span>&nbsp;<span class="ident" id="7246209">msg</span><span class="op" id="7246212">,</span>&nbsp;<span class="ident" id="7246214">got</span><span class="op" id="7246217">.</span><span class="ident" id="7246218">Offset</span><span class="op" id="7246224">,</span>&nbsp;<span class="ident" id="7246226">want</span><span class="op" id="7246230">.</span><span class="ident" id="7246231">Offset</span><span class="op" id="7246237">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246243">if</span>&nbsp;<span class="ident" id="7246246">got</span><span class="op" id="7246249">.</span><span class="ident" id="7246250">Line</span>&nbsp;<span class="op" id="7246255">!=</span>&nbsp;<span class="ident" id="7246258">want</span><span class="op" id="7246262">.</span><span class="ident" id="7246263">Line</span>&nbsp;<span class="op" id="7246268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246272">t</span><span class="op" id="7246273">.</span><span class="ident" id="7246274">Errorf</span><span class="op" id="7246280">(</span><span class="string" id="7246281">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7246309">,</span>&nbsp;<span class="ident" id="7246311">msg</span><span class="op" id="7246314">,</span>&nbsp;<span class="ident" id="7246316">got</span><span class="op" id="7246319">.</span><span class="ident" id="7246320">Line</span><span class="op" id="7246324">,</span>&nbsp;<span class="ident" id="7246326">want</span><span class="op" id="7246330">.</span><span class="ident" id="7246331">Line</span><span class="op" id="7246335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246341">if</span>&nbsp;<span class="ident" id="7246344">got</span><span class="op" id="7246347">.</span><span class="ident" id="7246348">Column</span>&nbsp;<span class="op" id="7246355">!=</span>&nbsp;<span class="ident" id="7246358">want</span><span class="op" id="7246362">.</span><span class="ident" id="7246363">Column</span>&nbsp;<span class="op" id="7246370">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246374">t</span><span class="op" id="7246375">.</span><span class="ident" id="7246376">Errorf</span><span class="op" id="7246382">(</span><span class="string" id="7246383">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7246413">,</span>&nbsp;<span class="ident" id="7246415">msg</span><span class="op" id="7246418">,</span>&nbsp;<span class="ident" id="7246420">got</span><span class="op" id="7246423">.</span><span class="ident" id="7246424">Column</span><span class="op" id="7246430">,</span>&nbsp;<span class="ident" id="7246432">want</span><span class="op" id="7246436">.</span><span class="ident" id="7246437">Column</span><span class="op" id="7246443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246446">}</span><br>
<span class="lineno"></span><span class="op" id="7246448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246451">func</span>&nbsp;<span class="ident" id="7246456">TestNoPos</span><span class="op" id="7246465">(</span><span class="ident" id="7246466">t</span>&nbsp;<span class="op" id="7246468">*</span><span class="ident" id="7246469">testing</span><span class="op" id="7246476">.</span><span class="ident" id="7246477">T</span><span class="op" id="7246478">)</span>&nbsp;<span class="op" id="7246480">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246483">if</span>&nbsp;<span class="ident" id="7246486">NoPos</span><span class="op" id="7246491">.</span><span class="ident" id="7246492">IsValid</span><span class="op" id="7246499">(</span><span class="op" id="7246500">)</span>&nbsp;<span class="op" id="7246502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246506">t</span><span class="op" id="7246507">.</span><span class="ident" id="7246508">Errorf</span><span class="op" id="7246514">(</span><span class="string" id="7246515">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7246542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7246548">var</span>&nbsp;<span class="ident" id="7246552">fset</span>&nbsp;<span class="op" id="7246557">*</span><span class="ident" id="7246558">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246567">checkPos</span><span class="op" id="7246575">(</span><span class="ident" id="7246576">t</span><span class="op" id="7246577">,</span>&nbsp;<span class="string" id="7246579">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7246590">,</span>&nbsp;<span class="ident" id="7246592">fset</span><span class="op" id="7246596">.</span><span class="ident" id="7246597">Position</span><span class="op" id="7246605">(</span><span class="ident" id="7246606">NoPos</span><span class="op" id="7246611">)</span><span class="op" id="7246612">,</span>&nbsp;<span class="ident" id="7246614">Position</span><span class="op" id="7246622">{</span><span class="op" id="7246623">}</span><span class="op" id="7246624">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246627">fset</span>&nbsp;<span class="op" id="7246632">=</span>&nbsp;<span class="ident" id="7246634">NewFileSet</span><span class="op" id="7246644">(</span><span class="op" id="7246645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246648">checkPos</span><span class="op" id="7246656">(</span><span class="ident" id="7246657">t</span><span class="op" id="7246658">,</span>&nbsp;<span class="string" id="7246660">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7246672">,</span>&nbsp;<span class="ident" id="7246674">fset</span><span class="op" id="7246678">.</span><span class="ident" id="7246679">Position</span><span class="op" id="7246687">(</span><span class="ident" id="7246688">NoPos</span><span class="op" id="7246693">)</span><span class="op" id="7246694">,</span>&nbsp;<span class="ident" id="7246696">Position</span><span class="op" id="7246704">{</span><span class="op" id="7246705">}</span><span class="op" id="7246706">)</span><br>
<span class="lineno"></span><span class="op" id="7246708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7246711">var</span>&nbsp;<span class="ident" id="7246715">tests</span>&nbsp;<span class="op" id="7246721">=</span>&nbsp;<span class="op" id="7246723">[</span><span class="op" id="7246724">]</span><span class="keyword" id="7246725">struct</span>&nbsp;<span class="op" id="7246732">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246735">filename</span>&nbsp;<span class="builtintype" id="7246744">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246752">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7246761">[</span><span class="op" id="7246762">]</span><span class="builtintype" id="7246763">byte</span>&nbsp;<span class="comment" id="7246768">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246783">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7246792">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7246797">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7246806">[</span><span class="op" id="7246807">]</span><span class="builtintype" id="7246808">int</span><br>
<span class="lineno"></span><span class="op" id="7246812">}</span><span class="op" id="7246813">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246816">{</span><span class="string" id="7246817">&#34;a&#34;</span><span class="op" id="7246820">,</span>&nbsp;<span class="op" id="7246822">[</span><span class="op" id="7246823">]</span><span class="builtintype" id="7246824">byte</span><span class="op" id="7246828">{</span><span class="op" id="7246829">}</span><span class="op" id="7246830">,</span>&nbsp;<span class="num" id="7246832">0</span><span class="op" id="7246833">,</span>&nbsp;<span class="op" id="7246835">[</span><span class="op" id="7246836">]</span><span class="builtintype" id="7246837">int</span><span class="op" id="7246840">{</span><span class="op" id="7246841">}</span><span class="op" id="7246842">}</span><span class="op" id="7246843">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246846">{</span><span class="string" id="7246847">&#34;b&#34;</span><span class="op" id="7246850">,</span>&nbsp;<span class="op" id="7246852">[</span><span class="op" id="7246853">]</span><span class="builtintype" id="7246854">byte</span><span class="op" id="7246858">(</span><span class="string" id="7246859">&#34;01234&#34;</span><span class="op" id="7246866">)</span><span class="op" id="7246867">,</span>&nbsp;<span class="num" id="7246869">5</span><span class="op" id="7246870">,</span>&nbsp;<span class="op" id="7246872">[</span><span class="op" id="7246873">]</span><span class="builtintype" id="7246874">int</span><span class="op" id="7246877">{</span><span class="num" id="7246878">0</span><span class="op" id="7246879">}</span><span class="op" id="7246880">}</span><span class="op" id="7246881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246884">{</span><span class="string" id="7246885">&#34;c&#34;</span><span class="op" id="7246888">,</span>&nbsp;<span class="op" id="7246890">[</span><span class="op" id="7246891">]</span><span class="builtintype" id="7246892">byte</span><span class="op" id="7246896">(</span><span class="string" id="7246897">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7246917">)</span><span class="op" id="7246918">,</span>&nbsp;<span class="num" id="7246920">9</span><span class="op" id="7246921">,</span>&nbsp;<span class="op" id="7246923">[</span><span class="op" id="7246924">]</span><span class="builtintype" id="7246925">int</span><span class="op" id="7246928">{</span><span class="num" id="7246929">0</span><span class="op" id="7246930">,</span>&nbsp;<span class="num" id="7246932">1</span><span class="op" id="7246933">,</span>&nbsp;<span class="num" id="7246935">2</span><span class="op" id="7246936">,</span>&nbsp;<span class="num" id="7246938">3</span><span class="op" id="7246939">,</span>&nbsp;<span class="num" id="7246941">4</span><span class="op" id="7246942">,</span>&nbsp;<span class="num" id="7246944">5</span><span class="op" id="7246945">,</span>&nbsp;<span class="num" id="7246947">6</span><span class="op" id="7246948">,</span>&nbsp;<span class="num" id="7246950">7</span><span class="op" id="7246951">,</span>&nbsp;<span class="num" id="7246953">8</span><span class="op" id="7246954">}</span><span class="op" id="7246955">}</span><span class="op" id="7246956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7246959">{</span><span class="string" id="7246960">&#34;d&#34;</span><span class="op" id="7246963">,</span>&nbsp;<span class="ident" id="7246965">nil</span><span class="op" id="7246968">,</span>&nbsp;<span class="num" id="7246970">100</span><span class="op" id="7246973">,</span>&nbsp;<span class="op" id="7246975">[</span><span class="op" id="7246976">]</span><span class="builtintype" id="7246977">int</span><span class="op" id="7246980">{</span><span class="num" id="7246981">0</span><span class="op" id="7246982">,</span>&nbsp;<span class="num" id="7246984">5</span><span class="op" id="7246985">,</span>&nbsp;<span class="num" id="7246987">10</span><span class="op" id="7246989">,</span>&nbsp;<span class="num" id="7246991">20</span><span class="op" id="7246993">,</span>&nbsp;<span class="num" id="7246995">30</span><span class="op" id="7246997">,</span>&nbsp;<span class="num" id="7246999">70</span><span class="op" id="7247001">,</span>&nbsp;<span class="num" id="7247003">71</span><span class="op" id="7247005">,</span>&nbsp;<span class="num" id="7247007">72</span><span class="op" id="7247009">,</span>&nbsp;<span class="num" id="7247011">80</span><span class="op" id="7247013">,</span>&nbsp;<span class="num" id="7247015">85</span><span class="op" id="7247017">,</span>&nbsp;<span class="num" id="7247019">90</span><span class="op" id="7247021">,</span>&nbsp;<span class="num" id="7247023">99</span><span class="op" id="7247025">}</span><span class="op" id="7247026">}</span><span class="op" id="7247027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247030">{</span><span class="string" id="7247031">&#34;e&#34;</span><span class="op" id="7247034">,</span>&nbsp;<span class="ident" id="7247036">nil</span><span class="op" id="7247039">,</span>&nbsp;<span class="num" id="7247041">777</span><span class="op" id="7247044">,</span>&nbsp;<span class="op" id="7247046">[</span><span class="op" id="7247047">]</span><span class="builtintype" id="7247048">int</span><span class="op" id="7247051">{</span><span class="num" id="7247052">0</span><span class="op" id="7247053">,</span>&nbsp;<span class="num" id="7247055">80</span><span class="op" id="7247057">,</span>&nbsp;<span class="num" id="7247059">100</span><span class="op" id="7247062">,</span>&nbsp;<span class="num" id="7247064">120</span><span class="op" id="7247067">,</span>&nbsp;<span class="num" id="7247069">130</span><span class="op" id="7247072">,</span>&nbsp;<span class="num" id="7247074">180</span><span class="op" id="7247077">,</span>&nbsp;<span class="num" id="7247079">267</span><span class="op" id="7247082">,</span>&nbsp;<span class="num" id="7247084">455</span><span class="op" id="7247087">,</span>&nbsp;<span class="num" id="7247089">500</span><span class="op" id="7247092">,</span>&nbsp;<span class="num" id="7247094">567</span><span class="op" id="7247097">,</span>&nbsp;<span class="num" id="7247099">620</span><span class="op" id="7247102">}</span><span class="op" id="7247103">}</span><span class="op" id="7247104">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247107">{</span><span class="string" id="7247108">&#34;f&#34;</span><span class="op" id="7247111">,</span>&nbsp;<span class="op" id="7247113">[</span><span class="op" id="7247114">]</span><span class="builtintype" id="7247115">byte</span><span class="op" id="7247119">(</span><span class="string" id="7247120">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7247149">)</span><span class="op" id="7247150">,</span>&nbsp;<span class="num" id="7247152">23</span><span class="op" id="7247154">,</span>&nbsp;<span class="op" id="7247156">[</span><span class="op" id="7247157">]</span><span class="builtintype" id="7247158">int</span><span class="op" id="7247161">{</span><span class="num" id="7247162">0</span><span class="op" id="7247163">,</span>&nbsp;<span class="num" id="7247165">10</span><span class="op" id="7247167">,</span>&nbsp;<span class="num" id="7247169">11</span><span class="op" id="7247171">}</span><span class="op" id="7247172">}</span><span class="op" id="7247173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247176">{</span><span class="string" id="7247177">&#34;g&#34;</span><span class="op" id="7247180">,</span>&nbsp;<span class="op" id="7247182">[</span><span class="op" id="7247183">]</span><span class="builtintype" id="7247184">byte</span><span class="op" id="7247188">(</span><span class="string" id="7247189">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7247220">)</span><span class="op" id="7247221">,</span>&nbsp;<span class="num" id="7247223">24</span><span class="op" id="7247225">,</span>&nbsp;<span class="op" id="7247227">[</span><span class="op" id="7247228">]</span><span class="builtintype" id="7247229">int</span><span class="op" id="7247232">{</span><span class="num" id="7247233">0</span><span class="op" id="7247234">,</span>&nbsp;<span class="num" id="7247236">10</span><span class="op" id="7247238">,</span>&nbsp;<span class="num" id="7247240">11</span><span class="op" id="7247242">}</span><span class="op" id="7247243">}</span><span class="op" id="7247244">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247247">{</span><span class="string" id="7247248">&#34;h&#34;</span><span class="op" id="7247251">,</span>&nbsp;<span class="op" id="7247253">[</span><span class="op" id="7247254">]</span><span class="builtintype" id="7247255">byte</span><span class="op" id="7247259">(</span><span class="string" id="7247260">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7247292">)</span><span class="op" id="7247293">,</span>&nbsp;<span class="num" id="7247295">25</span><span class="op" id="7247297">,</span>&nbsp;<span class="op" id="7247299">[</span><span class="op" id="7247300">]</span><span class="builtintype" id="7247301">int</span><span class="op" id="7247304">{</span><span class="num" id="7247305">0</span><span class="op" id="7247306">,</span>&nbsp;<span class="num" id="7247308">10</span><span class="op" id="7247310">,</span>&nbsp;<span class="num" id="7247312">11</span><span class="op" id="7247314">,</span>&nbsp;<span class="num" id="7247316">24</span><span class="op" id="7247318">}</span><span class="op" id="7247319">}</span><span class="op" id="7247320">,</span><br>
<span class="lineno"></span><span class="op" id="7247322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7247325">func</span>&nbsp;<span class="ident" id="7247330">linecol</span><span class="op" id="7247337">(</span><span class="ident" id="7247338">lines</span>&nbsp;<span class="op" id="7247344">[</span><span class="op" id="7247345">]</span><span class="builtintype" id="7247346">int</span><span class="op" id="7247349">,</span>&nbsp;<span class="ident" id="7247351">offs</span>&nbsp;<span class="builtintype" id="7247356">int</span><span class="op" id="7247359">)</span>&nbsp;<span class="op" id="7247361">(</span><span class="builtintype" id="7247362">int</span><span class="op" id="7247365">,</span>&nbsp;<span class="builtintype" id="7247367">int</span><span class="op" id="7247370">)</span>&nbsp;<span class="op" id="7247372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247375">prevLineOffs</span>&nbsp;<span class="op" id="7247388">:=</span>&nbsp;<span class="num" id="7247391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247394">for</span>&nbsp;<span class="ident" id="7247398">line</span><span class="op" id="7247402">,</span>&nbsp;<span class="ident" id="7247404">lineOffs</span>&nbsp;<span class="op" id="7247413">:=</span>&nbsp;<span class="keyword" id="7247416">range</span>&nbsp;<span class="ident" id="7247422">lines</span>&nbsp;<span class="op" id="7247428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247432">if</span>&nbsp;<span class="ident" id="7247435">offs</span>&nbsp;<span class="op" id="7247440">&lt;</span>&nbsp;<span class="ident" id="7247442">lineOffs</span>&nbsp;<span class="op" id="7247451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247456">return</span>&nbsp;<span class="ident" id="7247463">line</span><span class="op" id="7247467">,</span>&nbsp;<span class="ident" id="7247469">offs</span>&nbsp;<span class="op" id="7247474">-</span>&nbsp;<span class="ident" id="7247476">prevLineOffs</span>&nbsp;<span class="op" id="7247489">+</span>&nbsp;<span class="num" id="7247491">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247499">prevLineOffs</span>&nbsp;<span class="op" id="7247512">=</span>&nbsp;<span class="ident" id="7247514">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247527">return</span>&nbsp;<span class="builtinfunc" id="7247534">len</span><span class="op" id="7247537">(</span><span class="ident" id="7247538">lines</span><span class="op" id="7247543">)</span><span class="op" id="7247544">,</span>&nbsp;<span class="ident" id="7247546">offs</span>&nbsp;<span class="op" id="7247551">-</span>&nbsp;<span class="ident" id="7247553">prevLineOffs</span>&nbsp;<span class="op" id="7247566">+</span>&nbsp;<span class="num" id="7247568">1</span><br>
<span class="lineno"></span><span class="op" id="7247570">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7247573">func</span>&nbsp;<span class="ident" id="7247578">verifyPositions</span><span class="op" id="7247593">(</span><span class="ident" id="7247594">t</span>&nbsp;<span class="op" id="7247596">*</span><span class="ident" id="7247597">testing</span><span class="op" id="7247604">.</span><span class="ident" id="7247605">T</span><span class="op" id="7247606">,</span>&nbsp;<span class="ident" id="7247608">fset</span>&nbsp;<span class="op" id="7247613">*</span><span class="ident" id="7247614">FileSet</span><span class="op" id="7247621">,</span>&nbsp;<span class="ident" id="7247623">f</span>&nbsp;<span class="op" id="7247625">*</span><span class="ident" id="7247626">File</span><span class="op" id="7247630">,</span>&nbsp;<span class="ident" id="7247632">lines</span>&nbsp;<span class="op" id="7247638">[</span><span class="op" id="7247639">]</span><span class="builtintype" id="7247640">int</span><span class="op" id="7247643">)</span>&nbsp;<span class="op" id="7247645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247648">for</span>&nbsp;<span class="ident" id="7247652">offs</span>&nbsp;<span class="op" id="7247657">:=</span>&nbsp;<span class="num" id="7247660">0</span><span class="op" id="7247661">;</span>&nbsp;<span class="ident" id="7247663">offs</span>&nbsp;<span class="op" id="7247668">&lt;</span>&nbsp;<span class="ident" id="7247670">f</span><span class="op" id="7247671">.</span><span class="ident" id="7247672">Size</span><span class="op" id="7247676">(</span><span class="op" id="7247677">)</span><span class="op" id="7247678">;</span>&nbsp;<span class="ident" id="7247680">offs</span><span class="op" id="7247684">++</span>&nbsp;<span class="op" id="7247687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247691">p</span>&nbsp;<span class="op" id="7247693">:=</span>&nbsp;<span class="ident" id="7247696">f</span><span class="op" id="7247697">.</span><span class="ident" id="7247698">Pos</span><span class="op" id="7247701">(</span><span class="ident" id="7247702">offs</span><span class="op" id="7247706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247710">offs2</span>&nbsp;<span class="op" id="7247716">:=</span>&nbsp;<span class="ident" id="7247719">f</span><span class="op" id="7247720">.</span><span class="ident" id="7247721">Offset</span><span class="op" id="7247727">(</span><span class="ident" id="7247728">p</span><span class="op" id="7247729">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7247733">if</span>&nbsp;<span class="ident" id="7247736">offs2</span>&nbsp;<span class="op" id="7247742">!=</span>&nbsp;<span class="ident" id="7247745">offs</span>&nbsp;<span class="op" id="7247750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247755">t</span><span class="op" id="7247756">.</span><span class="ident" id="7247757">Errorf</span><span class="op" id="7247763">(</span><span class="string" id="7247764">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7247800">,</span>&nbsp;<span class="ident" id="7247802">f</span><span class="op" id="7247803">.</span><span class="ident" id="7247804">Name</span><span class="op" id="7247808">(</span><span class="op" id="7247809">)</span><span class="op" id="7247810">,</span>&nbsp;<span class="ident" id="7247812">offs2</span><span class="op" id="7247817">,</span>&nbsp;<span class="ident" id="7247819">offs</span><span class="op" id="7247823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7247827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247831">line</span><span class="op" id="7247835">,</span>&nbsp;<span class="ident" id="7247837">col</span>&nbsp;<span class="op" id="7247841">:=</span>&nbsp;<span class="ident" id="7247844">linecol</span><span class="op" id="7247851">(</span><span class="ident" id="7247852">lines</span><span class="op" id="7247857">,</span>&nbsp;<span class="ident" id="7247859">offs</span><span class="op" id="7247863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247867">msg</span>&nbsp;<span class="op" id="7247871">:=</span>&nbsp;<span class="ident" id="7247874">fmt</span><span class="op" id="7247877">.</span><span class="ident" id="7247878">Sprintf</span><span class="op" id="7247885">(</span><span class="string" id="7247886">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7247910">,</span>&nbsp;<span class="ident" id="7247912">f</span><span class="op" id="7247913">.</span><span class="ident" id="7247914">Name</span><span class="op" id="7247918">(</span><span class="op" id="7247919">)</span><span class="op" id="7247920">,</span>&nbsp;<span class="ident" id="7247922">offs</span><span class="op" id="7247926">,</span>&nbsp;<span class="ident" id="7247928">p</span><span class="op" id="7247929">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7247933">checkPos</span><span class="op" id="7247941">(</span><span class="ident" id="7247942">t</span><span class="op" id="7247943">,</span>&nbsp;<span class="ident" id="7247945">msg</span><span class="op" id="7247948">,</span>&nbsp;<span class="ident" id="7247950">f</span><span class="op" id="7247951">.</span><span class="ident" id="7247952">Position</span><span class="op" id="7247960">(</span><span class="ident" id="7247961">f</span><span class="op" id="7247962">.</span><span class="ident" id="7247963">Pos</span><span class="op" id="7247966">(</span><span class="ident" id="7247967">offs</span><span class="op" id="7247971">)</span><span class="op" id="7247972">)</span><span class="op" id="7247973">,</span>&nbsp;<span class="ident" id="7247975">Position</span><span class="op" id="7247983">{</span><span class="ident" id="7247984">f</span><span class="op" id="7247985">.</span><span class="ident" id="7247986">Name</span><span class="op" id="7247990">(</span><span class="op" id="7247991">)</span><span class="op" id="7247992">,</span>&nbsp;<span class="ident" id="7247994">offs</span><span class="op" id="7247998">,</span>&nbsp;<span class="ident" id="7248000">line</span><span class="op" id="7248004">,</span>&nbsp;<span class="ident" id="7248006">col</span><span class="op" id="7248009">}</span><span class="op" id="7248010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248014">checkPos</span><span class="op" id="7248022">(</span><span class="ident" id="7248023">t</span><span class="op" id="7248024">,</span>&nbsp;<span class="ident" id="7248026">msg</span><span class="op" id="7248029">,</span>&nbsp;<span class="ident" id="7248031">fset</span><span class="op" id="7248035">.</span><span class="ident" id="7248036">Position</span><span class="op" id="7248044">(</span><span class="ident" id="7248045">p</span><span class="op" id="7248046">)</span><span class="op" id="7248047">,</span>&nbsp;<span class="ident" id="7248049">Position</span><span class="op" id="7248057">{</span><span class="ident" id="7248058">f</span><span class="op" id="7248059">.</span><span class="ident" id="7248060">Name</span><span class="op" id="7248064">(</span><span class="op" id="7248065">)</span><span class="op" id="7248066">,</span>&nbsp;<span class="ident" id="7248068">offs</span><span class="op" id="7248072">,</span>&nbsp;<span class="ident" id="7248074">line</span><span class="op" id="7248078">,</span>&nbsp;<span class="ident" id="7248080">col</span><span class="op" id="7248083">}</span><span class="op" id="7248084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248087">}</span><br>
<span class="lineno"></span><span class="op" id="7248089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7248092">func</span>&nbsp;<span class="ident" id="7248097">makeTestSource</span><span class="op" id="7248111">(</span><span class="ident" id="7248112">size</span>&nbsp;<span class="builtintype" id="7248117">int</span><span class="op" id="7248120">,</span>&nbsp;<span class="ident" id="7248122">lines</span>&nbsp;<span class="op" id="7248128">[</span><span class="op" id="7248129">]</span><span class="builtintype" id="7248130">int</span><span class="op" id="7248133">)</span>&nbsp;<span class="op" id="7248135">[</span><span class="op" id="7248136">]</span><span class="builtintype" id="7248137">byte</span>&nbsp;<span class="op" id="7248142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248145">src</span>&nbsp;<span class="op" id="7248149">:=</span>&nbsp;<span class="builtinfunc" id="7248152">make</span><span class="op" id="7248156">(</span><span class="op" id="7248157">[</span><span class="op" id="7248158">]</span><span class="builtintype" id="7248159">byte</span><span class="op" id="7248163">,</span>&nbsp;<span class="ident" id="7248165">size</span><span class="op" id="7248169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248172">for</span>&nbsp;<span class="ident" id="7248176">_</span><span class="op" id="7248177">,</span>&nbsp;<span class="ident" id="7248179">offs</span>&nbsp;<span class="op" id="7248184">:=</span>&nbsp;<span class="keyword" id="7248187">range</span>&nbsp;<span class="ident" id="7248193">lines</span>&nbsp;<span class="op" id="7248199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248203">if</span>&nbsp;<span class="ident" id="7248206">offs</span>&nbsp;<span class="op" id="7248211">&gt;</span>&nbsp;<span class="num" id="7248213">0</span>&nbsp;<span class="op" id="7248215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248220">src</span><span class="op" id="7248223">[</span><span class="ident" id="7248224">offs</span><span class="op" id="7248228">-</span><span class="num" id="7248229">1</span><span class="op" id="7248230">]</span>&nbsp;<span class="op" id="7248232">=</span>&nbsp;<span class="string" id="7248234">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248247">return</span>&nbsp;<span class="ident" id="7248254">src</span><br>
<span class="lineno"></span><span class="op" id="7248258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7248261">func</span>&nbsp;<span class="ident" id="7248266">TestPositions</span><span class="op" id="7248279">(</span><span class="ident" id="7248280">t</span>&nbsp;<span class="op" id="7248282">*</span><span class="ident" id="7248283">testing</span><span class="op" id="7248290">.</span><span class="ident" id="7248291">T</span><span class="op" id="7248292">)</span>&nbsp;<span class="op" id="7248294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248297">const</span>&nbsp;<span class="ident" id="7248303">delta</span>&nbsp;<span class="op" id="7248309">=</span>&nbsp;<span class="num" id="7248311">7</span>&nbsp;<span class="comment" id="7248313">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248350">fset</span>&nbsp;<span class="op" id="7248355">:=</span>&nbsp;<span class="ident" id="7248358">NewFileSet</span><span class="op" id="7248368">(</span><span class="op" id="7248369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248372">for</span>&nbsp;<span class="ident" id="7248376">_</span><span class="op" id="7248377">,</span>&nbsp;<span class="ident" id="7248379">test</span>&nbsp;<span class="op" id="7248384">:=</span>&nbsp;<span class="keyword" id="7248387">range</span>&nbsp;<span class="ident" id="7248393">tests</span>&nbsp;<span class="op" id="7248399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7248403">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248440">if</span>&nbsp;<span class="ident" id="7248443">test</span><span class="op" id="7248447">.</span><span class="ident" id="7248448">source</span>&nbsp;<span class="op" id="7248455">!=</span>&nbsp;<span class="ident" id="7248458">nil</span>&nbsp;<span class="op" id="7248462">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7248465">len</span><span class="op" id="7248468">(</span><span class="ident" id="7248469">test</span><span class="op" id="7248473">.</span><span class="ident" id="7248474">source</span><span class="op" id="7248480">)</span>&nbsp;<span class="op" id="7248482">!=</span>&nbsp;<span class="ident" id="7248485">test</span><span class="op" id="7248489">.</span><span class="ident" id="7248490">size</span>&nbsp;<span class="op" id="7248495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248500">t</span><span class="op" id="7248501">.</span><span class="ident" id="7248502">Errorf</span><span class="op" id="7248508">(</span><span class="string" id="7248509">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7248564">,</span>&nbsp;<span class="ident" id="7248566">test</span><span class="op" id="7248570">.</span><span class="ident" id="7248571">filename</span><span class="op" id="7248579">,</span>&nbsp;<span class="builtinfunc" id="7248581">len</span><span class="op" id="7248584">(</span><span class="ident" id="7248585">test</span><span class="op" id="7248589">.</span><span class="ident" id="7248590">source</span><span class="op" id="7248596">)</span><span class="op" id="7248597">,</span>&nbsp;<span class="ident" id="7248599">test</span><span class="op" id="7248603">.</span><span class="ident" id="7248604">size</span><span class="op" id="7248608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7248617">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248656">f</span>&nbsp;<span class="op" id="7248658">:=</span>&nbsp;<span class="ident" id="7248661">fset</span><span class="op" id="7248665">.</span><span class="ident" id="7248666">AddFile</span><span class="op" id="7248673">(</span><span class="ident" id="7248674">test</span><span class="op" id="7248678">.</span><span class="ident" id="7248679">filename</span><span class="op" id="7248687">,</span>&nbsp;<span class="ident" id="7248689">fset</span><span class="op" id="7248693">.</span><span class="ident" id="7248694">Base</span><span class="op" id="7248698">(</span><span class="op" id="7248699">)</span><span class="op" id="7248700">+</span><span class="ident" id="7248701">delta</span><span class="op" id="7248706">,</span>&nbsp;<span class="ident" id="7248708">test</span><span class="op" id="7248712">.</span><span class="ident" id="7248713">size</span><span class="op" id="7248717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248721">if</span>&nbsp;<span class="ident" id="7248724">f</span><span class="op" id="7248725">.</span><span class="ident" id="7248726">Name</span><span class="op" id="7248730">(</span><span class="op" id="7248731">)</span>&nbsp;<span class="op" id="7248733">!=</span>&nbsp;<span class="ident" id="7248736">test</span><span class="op" id="7248740">.</span><span class="ident" id="7248741">filename</span>&nbsp;<span class="op" id="7248750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248755">t</span><span class="op" id="7248756">.</span><span class="ident" id="7248757">Errorf</span><span class="op" id="7248763">(</span><span class="string" id="7248764">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7248790">,</span>&nbsp;<span class="ident" id="7248792">f</span><span class="op" id="7248793">.</span><span class="ident" id="7248794">Name</span><span class="op" id="7248798">(</span><span class="op" id="7248799">)</span><span class="op" id="7248800">,</span>&nbsp;<span class="ident" id="7248802">test</span><span class="op" id="7248806">.</span><span class="ident" id="7248807">filename</span><span class="op" id="7248815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248823">if</span>&nbsp;<span class="ident" id="7248826">f</span><span class="op" id="7248827">.</span><span class="ident" id="7248828">Size</span><span class="op" id="7248832">(</span><span class="op" id="7248833">)</span>&nbsp;<span class="op" id="7248835">!=</span>&nbsp;<span class="ident" id="7248838">test</span><span class="op" id="7248842">.</span><span class="ident" id="7248843">size</span>&nbsp;<span class="op" id="7248848">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248853">t</span><span class="op" id="7248854">.</span><span class="ident" id="7248855">Errorf</span><span class="op" id="7248861">(</span><span class="string" id="7248862">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7248893">,</span>&nbsp;<span class="ident" id="7248895">f</span><span class="op" id="7248896">.</span><span class="ident" id="7248897">Name</span><span class="op" id="7248901">(</span><span class="op" id="7248902">)</span><span class="op" id="7248903">,</span>&nbsp;<span class="ident" id="7248905">f</span><span class="op" id="7248906">.</span><span class="ident" id="7248907">Size</span><span class="op" id="7248911">(</span><span class="op" id="7248912">)</span><span class="op" id="7248913">,</span>&nbsp;<span class="ident" id="7248915">test</span><span class="op" id="7248919">.</span><span class="ident" id="7248920">size</span><span class="op" id="7248924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7248928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7248932">if</span>&nbsp;<span class="ident" id="7248935">fset</span><span class="op" id="7248939">.</span><span class="ident" id="7248940">File</span><span class="op" id="7248944">(</span><span class="ident" id="7248945">f</span><span class="op" id="7248946">.</span><span class="ident" id="7248947">Pos</span><span class="op" id="7248950">(</span><span class="num" id="7248951">0</span><span class="op" id="7248952">)</span><span class="op" id="7248953">)</span>&nbsp;<span class="op" id="7248955">!=</span>&nbsp;<span class="ident" id="7248958">f</span>&nbsp;<span class="op" id="7248960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7248965">t</span><span class="op" id="7248966">.</span><span class="ident" id="7248967">Errorf</span><span class="op" id="7248973">(</span><span class="string" id="7248974">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7249007">,</span>&nbsp;<span class="ident" id="7249009">f</span><span class="op" id="7249010">.</span><span class="ident" id="7249011">Name</span><span class="op" id="7249015">(</span><span class="op" id="7249016">)</span><span class="op" id="7249017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249021">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7249026">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249079">for</span>&nbsp;<span class="ident" id="7249083">i</span><span class="op" id="7249084">,</span>&nbsp;<span class="ident" id="7249086">offset</span>&nbsp;<span class="op" id="7249093">:=</span>&nbsp;<span class="keyword" id="7249096">range</span>&nbsp;<span class="ident" id="7249102">test</span><span class="op" id="7249106">.</span><span class="ident" id="7249107">lines</span>&nbsp;<span class="op" id="7249113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249118">f</span><span class="op" id="7249119">.</span><span class="ident" id="7249120">AddLine</span><span class="op" id="7249127">(</span><span class="ident" id="7249128">offset</span><span class="op" id="7249134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249139">if</span>&nbsp;<span class="ident" id="7249142">f</span><span class="op" id="7249143">.</span><span class="ident" id="7249144">LineCount</span><span class="op" id="7249153">(</span><span class="op" id="7249154">)</span>&nbsp;<span class="op" id="7249156">!=</span>&nbsp;<span class="ident" id="7249159">i</span><span class="op" id="7249160">+</span><span class="num" id="7249161">1</span>&nbsp;<span class="op" id="7249163">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249169">t</span><span class="op" id="7249170">.</span><span class="ident" id="7249171">Errorf</span><span class="op" id="7249177">(</span><span class="string" id="7249178">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7249219">,</span>&nbsp;<span class="ident" id="7249221">f</span><span class="op" id="7249222">.</span><span class="ident" id="7249223">Name</span><span class="op" id="7249227">(</span><span class="op" id="7249228">)</span><span class="op" id="7249229">,</span>&nbsp;<span class="ident" id="7249231">f</span><span class="op" id="7249232">.</span><span class="ident" id="7249233">LineCount</span><span class="op" id="7249242">(</span><span class="op" id="7249243">)</span><span class="op" id="7249244">,</span>&nbsp;<span class="ident" id="7249246">i</span><span class="op" id="7249247">+</span><span class="num" id="7249248">1</span><span class="op" id="7249249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7249259">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249312">f</span><span class="op" id="7249313">.</span><span class="ident" id="7249314">AddLine</span><span class="op" id="7249321">(</span><span class="ident" id="7249322">offset</span><span class="op" id="7249328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249333">if</span>&nbsp;<span class="ident" id="7249336">f</span><span class="op" id="7249337">.</span><span class="ident" id="7249338">LineCount</span><span class="op" id="7249347">(</span><span class="op" id="7249348">)</span>&nbsp;<span class="op" id="7249350">!=</span>&nbsp;<span class="ident" id="7249353">i</span><span class="op" id="7249354">+</span><span class="num" id="7249355">1</span>&nbsp;<span class="op" id="7249357">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249363">t</span><span class="op" id="7249364">.</span><span class="ident" id="7249365">Errorf</span><span class="op" id="7249371">(</span><span class="string" id="7249372">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7249423">,</span>&nbsp;<span class="ident" id="7249425">f</span><span class="op" id="7249426">.</span><span class="ident" id="7249427">Name</span><span class="op" id="7249431">(</span><span class="op" id="7249432">)</span><span class="op" id="7249433">,</span>&nbsp;<span class="ident" id="7249435">f</span><span class="op" id="7249436">.</span><span class="ident" id="7249437">LineCount</span><span class="op" id="7249446">(</span><span class="op" id="7249447">)</span><span class="op" id="7249448">,</span>&nbsp;<span class="ident" id="7249450">i</span><span class="op" id="7249451">+</span><span class="num" id="7249452">1</span><span class="op" id="7249453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249463">verifyPositions</span><span class="op" id="7249478">(</span><span class="ident" id="7249479">t</span><span class="op" id="7249480">,</span>&nbsp;<span class="ident" id="7249482">fset</span><span class="op" id="7249486">,</span>&nbsp;<span class="ident" id="7249488">f</span><span class="op" id="7249489">,</span>&nbsp;<span class="ident" id="7249491">test</span><span class="op" id="7249495">.</span><span class="ident" id="7249496">lines</span><span class="op" id="7249501">[</span><span class="num" id="7249502">0</span><span class="op" id="7249503">:</span><span class="ident" id="7249504">i</span><span class="op" id="7249505">+</span><span class="num" id="7249506">1</span><span class="op" id="7249507">]</span><span class="op" id="7249508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7249517">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249571">if</span>&nbsp;<span class="ident" id="7249574">ok</span>&nbsp;<span class="op" id="7249577">:=</span>&nbsp;<span class="ident" id="7249580">f</span><span class="op" id="7249581">.</span><span class="ident" id="7249582">SetLines</span><span class="op" id="7249590">(</span><span class="ident" id="7249591">test</span><span class="op" id="7249595">.</span><span class="ident" id="7249596">lines</span><span class="op" id="7249601">)</span><span class="op" id="7249602">;</span>&nbsp;<span class="op" id="7249604">!</span><span class="ident" id="7249605">ok</span>&nbsp;<span class="op" id="7249608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249613">t</span><span class="op" id="7249614">.</span><span class="ident" id="7249615">Errorf</span><span class="op" id="7249621">(</span><span class="string" id="7249622">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7249643">,</span>&nbsp;<span class="ident" id="7249645">f</span><span class="op" id="7249646">.</span><span class="ident" id="7249647">Name</span><span class="op" id="7249651">(</span><span class="op" id="7249652">)</span><span class="op" id="7249653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249661">if</span>&nbsp;<span class="ident" id="7249664">f</span><span class="op" id="7249665">.</span><span class="ident" id="7249666">LineCount</span><span class="op" id="7249675">(</span><span class="op" id="7249676">)</span>&nbsp;<span class="op" id="7249678">!=</span>&nbsp;<span class="builtinfunc" id="7249681">len</span><span class="op" id="7249684">(</span><span class="ident" id="7249685">test</span><span class="op" id="7249689">.</span><span class="ident" id="7249690">lines</span><span class="op" id="7249695">)</span>&nbsp;<span class="op" id="7249697">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249702">t</span><span class="op" id="7249703">.</span><span class="ident" id="7249704">Errorf</span><span class="op" id="7249710">(</span><span class="string" id="7249711">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7249753">,</span>&nbsp;<span class="ident" id="7249755">f</span><span class="op" id="7249756">.</span><span class="ident" id="7249757">Name</span><span class="op" id="7249761">(</span><span class="op" id="7249762">)</span><span class="op" id="7249763">,</span>&nbsp;<span class="ident" id="7249765">f</span><span class="op" id="7249766">.</span><span class="ident" id="7249767">LineCount</span><span class="op" id="7249776">(</span><span class="op" id="7249777">)</span><span class="op" id="7249778">,</span>&nbsp;<span class="builtinfunc" id="7249780">len</span><span class="op" id="7249783">(</span><span class="ident" id="7249784">test</span><span class="op" id="7249788">.</span><span class="ident" id="7249789">lines</span><span class="op" id="7249794">)</span><span class="op" id="7249795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7249799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249803">verifyPositions</span><span class="op" id="7249818">(</span><span class="ident" id="7249819">t</span><span class="op" id="7249820">,</span>&nbsp;<span class="ident" id="7249822">fset</span><span class="op" id="7249826">,</span>&nbsp;<span class="ident" id="7249828">f</span><span class="op" id="7249829">,</span>&nbsp;<span class="ident" id="7249831">test</span><span class="op" id="7249835">.</span><span class="ident" id="7249836">lines</span><span class="op" id="7249841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7249846">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7249910">src</span>&nbsp;<span class="op" id="7249914">:=</span>&nbsp;<span class="ident" id="7249917">test</span><span class="op" id="7249921">.</span><span class="ident" id="7249922">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7249931">if</span>&nbsp;<span class="ident" id="7249934">src</span>&nbsp;<span class="op" id="7249938">==</span>&nbsp;<span class="ident" id="7249941">nil</span>&nbsp;<span class="op" id="7249945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7249950">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250007">src</span>&nbsp;<span class="op" id="7250011">=</span>&nbsp;<span class="ident" id="7250013">makeTestSource</span><span class="op" id="7250027">(</span><span class="ident" id="7250028">test</span><span class="op" id="7250032">.</span><span class="ident" id="7250033">size</span><span class="op" id="7250037">,</span>&nbsp;<span class="ident" id="7250039">test</span><span class="op" id="7250043">.</span><span class="ident" id="7250044">lines</span><span class="op" id="7250049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250053">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250057">f</span><span class="op" id="7250058">.</span><span class="ident" id="7250059">SetLinesForContent</span><span class="op" id="7250077">(</span><span class="ident" id="7250078">src</span><span class="op" id="7250081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250085">if</span>&nbsp;<span class="ident" id="7250088">f</span><span class="op" id="7250089">.</span><span class="ident" id="7250090">LineCount</span><span class="op" id="7250099">(</span><span class="op" id="7250100">)</span>&nbsp;<span class="op" id="7250102">!=</span>&nbsp;<span class="builtinfunc" id="7250105">len</span><span class="op" id="7250108">(</span><span class="ident" id="7250109">test</span><span class="op" id="7250113">.</span><span class="ident" id="7250114">lines</span><span class="op" id="7250119">)</span>&nbsp;<span class="op" id="7250121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250126">t</span><span class="op" id="7250127">.</span><span class="ident" id="7250128">Errorf</span><span class="op" id="7250134">(</span><span class="string" id="7250135">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7250187">,</span>&nbsp;<span class="ident" id="7250189">f</span><span class="op" id="7250190">.</span><span class="ident" id="7250191">Name</span><span class="op" id="7250195">(</span><span class="op" id="7250196">)</span><span class="op" id="7250197">,</span>&nbsp;<span class="ident" id="7250199">f</span><span class="op" id="7250200">.</span><span class="ident" id="7250201">LineCount</span><span class="op" id="7250210">(</span><span class="op" id="7250211">)</span><span class="op" id="7250212">,</span>&nbsp;<span class="builtinfunc" id="7250214">len</span><span class="op" id="7250217">(</span><span class="ident" id="7250218">test</span><span class="op" id="7250222">.</span><span class="ident" id="7250223">lines</span><span class="op" id="7250228">)</span><span class="op" id="7250229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250237">verifyPositions</span><span class="op" id="7250252">(</span><span class="ident" id="7250253">t</span><span class="op" id="7250254">,</span>&nbsp;<span class="ident" id="7250256">fset</span><span class="op" id="7250260">,</span>&nbsp;<span class="ident" id="7250262">f</span><span class="op" id="7250263">,</span>&nbsp;<span class="ident" id="7250265">test</span><span class="op" id="7250269">.</span><span class="ident" id="7250270">lines</span><span class="op" id="7250275">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250278">}</span><br>
<span class="lineno"></span><span class="op" id="7250280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7250283">func</span>&nbsp;<span class="ident" id="7250288">TestLineInfo</span><span class="op" id="7250300">(</span><span class="ident" id="7250301">t</span>&nbsp;<span class="op" id="7250303">*</span><span class="ident" id="7250304">testing</span><span class="op" id="7250311">.</span><span class="ident" id="7250312">T</span><span class="op" id="7250313">)</span>&nbsp;<span class="op" id="7250315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250318">fset</span>&nbsp;<span class="op" id="7250323">:=</span>&nbsp;<span class="ident" id="7250326">NewFileSet</span><span class="op" id="7250336">(</span><span class="op" id="7250337">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250340">f</span>&nbsp;<span class="op" id="7250342">:=</span>&nbsp;<span class="ident" id="7250345">fset</span><span class="op" id="7250349">.</span><span class="ident" id="7250350">AddFile</span><span class="op" id="7250357">(</span><span class="string" id="7250358">&#34;foo&#34;</span><span class="op" id="7250363">,</span>&nbsp;<span class="ident" id="7250365">fset</span><span class="op" id="7250369">.</span><span class="ident" id="7250370">Base</span><span class="op" id="7250374">(</span><span class="op" id="7250375">)</span><span class="op" id="7250376">,</span>&nbsp;<span class="num" id="7250378">500</span><span class="op" id="7250381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250384">lines</span>&nbsp;<span class="op" id="7250390">:=</span>&nbsp;<span class="op" id="7250393">[</span><span class="op" id="7250394">]</span><span class="builtintype" id="7250395">int</span><span class="op" id="7250398">{</span><span class="num" id="7250399">0</span><span class="op" id="7250400">,</span>&nbsp;<span class="num" id="7250402">42</span><span class="op" id="7250404">,</span>&nbsp;<span class="num" id="7250406">77</span><span class="op" id="7250408">,</span>&nbsp;<span class="num" id="7250410">100</span><span class="op" id="7250413">,</span>&nbsp;<span class="num" id="7250415">210</span><span class="op" id="7250418">,</span>&nbsp;<span class="num" id="7250420">220</span><span class="op" id="7250423">,</span>&nbsp;<span class="num" id="7250425">277</span><span class="op" id="7250428">,</span>&nbsp;<span class="num" id="7250430">300</span><span class="op" id="7250433">,</span>&nbsp;<span class="num" id="7250435">333</span><span class="op" id="7250438">,</span>&nbsp;<span class="num" id="7250440">401</span><span class="op" id="7250443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7250446">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250514">for</span>&nbsp;<span class="ident" id="7250518">_</span><span class="op" id="7250519">,</span>&nbsp;<span class="ident" id="7250521">offs</span>&nbsp;<span class="op" id="7250526">:=</span>&nbsp;<span class="keyword" id="7250529">range</span>&nbsp;<span class="ident" id="7250535">lines</span>&nbsp;<span class="op" id="7250541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250545">f</span><span class="op" id="7250546">.</span><span class="ident" id="7250547">AddLine</span><span class="op" id="7250554">(</span><span class="ident" id="7250555">offs</span><span class="op" id="7250559">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250563">f</span><span class="op" id="7250564">.</span><span class="ident" id="7250565">AddLineInfo</span><span class="op" id="7250576">(</span><span class="ident" id="7250577">offs</span><span class="op" id="7250581">,</span>&nbsp;<span class="string" id="7250583">&#34;bar&#34;</span><span class="op" id="7250588">,</span>&nbsp;<span class="num" id="7250590">42</span><span class="op" id="7250592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7250598">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7250635">for</span>&nbsp;<span class="ident" id="7250639">offs</span>&nbsp;<span class="op" id="7250644">:=</span>&nbsp;<span class="num" id="7250647">0</span><span class="op" id="7250648">;</span>&nbsp;<span class="ident" id="7250650">offs</span>&nbsp;<span class="op" id="7250655">&lt;=</span>&nbsp;<span class="ident" id="7250658">f</span><span class="op" id="7250659">.</span><span class="ident" id="7250660">Size</span><span class="op" id="7250664">(</span><span class="op" id="7250665">)</span><span class="op" id="7250666">;</span>&nbsp;<span class="ident" id="7250668">offs</span><span class="op" id="7250672">++</span>&nbsp;<span class="op" id="7250675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250679">p</span>&nbsp;<span class="op" id="7250681">:=</span>&nbsp;<span class="ident" id="7250684">f</span><span class="op" id="7250685">.</span><span class="ident" id="7250686">Pos</span><span class="op" id="7250689">(</span><span class="ident" id="7250690">offs</span><span class="op" id="7250694">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250698">_</span><span class="op" id="7250699">,</span>&nbsp;<span class="ident" id="7250701">col</span>&nbsp;<span class="op" id="7250705">:=</span>&nbsp;<span class="ident" id="7250708">linecol</span><span class="op" id="7250715">(</span><span class="ident" id="7250716">lines</span><span class="op" id="7250721">,</span>&nbsp;<span class="ident" id="7250723">offs</span><span class="op" id="7250727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250731">msg</span>&nbsp;<span class="op" id="7250735">:=</span>&nbsp;<span class="ident" id="7250738">fmt</span><span class="op" id="7250741">.</span><span class="ident" id="7250742">Sprintf</span><span class="op" id="7250749">(</span><span class="string" id="7250750">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7250774">,</span>&nbsp;<span class="ident" id="7250776">f</span><span class="op" id="7250777">.</span><span class="ident" id="7250778">Name</span><span class="op" id="7250782">(</span><span class="op" id="7250783">)</span><span class="op" id="7250784">,</span>&nbsp;<span class="ident" id="7250786">offs</span><span class="op" id="7250790">,</span>&nbsp;<span class="ident" id="7250792">p</span><span class="op" id="7250793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250797">checkPos</span><span class="op" id="7250805">(</span><span class="ident" id="7250806">t</span><span class="op" id="7250807">,</span>&nbsp;<span class="ident" id="7250809">msg</span><span class="op" id="7250812">,</span>&nbsp;<span class="ident" id="7250814">f</span><span class="op" id="7250815">.</span><span class="ident" id="7250816">Position</span><span class="op" id="7250824">(</span><span class="ident" id="7250825">f</span><span class="op" id="7250826">.</span><span class="ident" id="7250827">Pos</span><span class="op" id="7250830">(</span><span class="ident" id="7250831">offs</span><span class="op" id="7250835">)</span><span class="op" id="7250836">)</span><span class="op" id="7250837">,</span>&nbsp;<span class="ident" id="7250839">Position</span><span class="op" id="7250847">{</span><span class="string" id="7250848">&#34;bar&#34;</span><span class="op" id="7250853">,</span>&nbsp;<span class="ident" id="7250855">offs</span><span class="op" id="7250859">,</span>&nbsp;<span class="num" id="7250861">42</span><span class="op" id="7250863">,</span>&nbsp;<span class="ident" id="7250865">col</span><span class="op" id="7250868">}</span><span class="op" id="7250869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250873">checkPos</span><span class="op" id="7250881">(</span><span class="ident" id="7250882">t</span><span class="op" id="7250883">,</span>&nbsp;<span class="ident" id="7250885">msg</span><span class="op" id="7250888">,</span>&nbsp;<span class="ident" id="7250890">fset</span><span class="op" id="7250894">.</span><span class="ident" id="7250895">Position</span><span class="op" id="7250903">(</span><span class="ident" id="7250904">p</span><span class="op" id="7250905">)</span><span class="op" id="7250906">,</span>&nbsp;<span class="ident" id="7250908">Position</span><span class="op" id="7250916">{</span><span class="string" id="7250917">&#34;bar&#34;</span><span class="op" id="7250922">,</span>&nbsp;<span class="ident" id="7250924">offs</span><span class="op" id="7250928">,</span>&nbsp;<span class="num" id="7250930">42</span><span class="op" id="7250932">,</span>&nbsp;<span class="ident" id="7250934">col</span><span class="op" id="7250937">}</span><span class="op" id="7250938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7250941">}</span><br>
<span class="lineno">165</span><span class="op" id="7250943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7250946">func</span>&nbsp;<span class="ident" id="7250951">TestFiles</span><span class="op" id="7250960">(</span><span class="ident" id="7250961">t</span>&nbsp;<span class="op" id="7250963">*</span><span class="ident" id="7250964">testing</span><span class="op" id="7250971">.</span><span class="ident" id="7250972">T</span><span class="op" id="7250973">)</span>&nbsp;<span class="op" id="7250975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7250978">fset</span>&nbsp;<span class="op" id="7250983">:=</span>&nbsp;<span class="ident" id="7250986">NewFileSet</span><span class="op" id="7250996">(</span><span class="op" id="7250997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251000">for</span>&nbsp;<span class="ident" id="7251004">i</span><span class="op" id="7251005">,</span>&nbsp;<span class="ident" id="7251007">test</span>&nbsp;<span class="op" id="7251012">:=</span>&nbsp;<span class="keyword" id="7251015">range</span>&nbsp;<span class="ident" id="7251021">tests</span>&nbsp;<span class="op" id="7251027">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251031">base</span>&nbsp;<span class="op" id="7251036">:=</span>&nbsp;<span class="ident" id="7251039">fset</span><span class="op" id="7251043">.</span><span class="ident" id="7251044">Base</span><span class="op" id="7251048">(</span><span class="op" id="7251049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251053">if</span>&nbsp;<span class="ident" id="7251056">i</span><span class="op" id="7251057">%</span><span class="num" id="7251058">2</span>&nbsp;<span class="op" id="7251060">==</span>&nbsp;<span class="num" id="7251063">1</span>&nbsp;<span class="op" id="7251065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251070">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7251117">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251158">base</span>&nbsp;<span class="op" id="7251163">=</span>&nbsp;<span class="op" id="7251165">-</span><span class="num" id="7251166">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251174">fset</span><span class="op" id="7251178">.</span><span class="ident" id="7251179">AddFile</span><span class="op" id="7251186">(</span><span class="ident" id="7251187">test</span><span class="op" id="7251191">.</span><span class="ident" id="7251192">filename</span><span class="op" id="7251200">,</span>&nbsp;<span class="ident" id="7251202">base</span><span class="op" id="7251206">,</span>&nbsp;<span class="ident" id="7251208">test</span><span class="op" id="7251212">.</span><span class="ident" id="7251213">size</span><span class="op" id="7251217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251221">j</span>&nbsp;<span class="op" id="7251223">:=</span>&nbsp;<span class="num" id="7251226">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251230">fset</span><span class="op" id="7251234">.</span><span class="ident" id="7251235">Iterate</span><span class="op" id="7251242">(</span><span class="keyword" id="7251243">func</span><span class="op" id="7251247">(</span><span class="ident" id="7251248">f</span>&nbsp;<span class="op" id="7251250">*</span><span class="ident" id="7251251">File</span><span class="op" id="7251255">)</span>&nbsp;<span class="builtintype" id="7251257">bool</span>&nbsp;<span class="op" id="7251262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251267">if</span>&nbsp;<span class="ident" id="7251270">f</span><span class="op" id="7251271">.</span><span class="ident" id="7251272">Name</span><span class="op" id="7251276">(</span><span class="op" id="7251277">)</span>&nbsp;<span class="op" id="7251279">!=</span>&nbsp;<span class="ident" id="7251282">tests</span><span class="op" id="7251287">[</span><span class="ident" id="7251288">j</span><span class="op" id="7251289">]</span><span class="op" id="7251290">.</span><span class="ident" id="7251291">filename</span>&nbsp;<span class="op" id="7251300">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251306">t</span><span class="op" id="7251307">.</span><span class="ident" id="7251308">Errorf</span><span class="op" id="7251314">(</span><span class="string" id="7251315">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7251343">,</span>&nbsp;<span class="ident" id="7251345">f</span><span class="op" id="7251346">.</span><span class="ident" id="7251347">Name</span><span class="op" id="7251351">(</span><span class="op" id="7251352">)</span><span class="op" id="7251353">,</span>&nbsp;<span class="ident" id="7251355">tests</span><span class="op" id="7251360">[</span><span class="ident" id="7251361">j</span><span class="op" id="7251362">]</span><span class="op" id="7251363">.</span><span class="ident" id="7251364">filename</span><span class="op" id="7251372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251382">j</span><span class="op" id="7251383">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251389">return</span>&nbsp;<span class="builtintype" id="7251396">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251403">}</span><span class="op" id="7251404">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251408">if</span>&nbsp;<span class="ident" id="7251411">j</span>&nbsp;<span class="op" id="7251413">!=</span>&nbsp;<span class="ident" id="7251416">i</span><span class="op" id="7251417">+</span><span class="num" id="7251418">1</span>&nbsp;<span class="op" id="7251420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251425">t</span><span class="op" id="7251426">.</span><span class="ident" id="7251427">Errorf</span><span class="op" id="7251433">(</span><span class="string" id="7251434">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7251457">,</span>&nbsp;<span class="ident" id="7251459">j</span><span class="op" id="7251460">,</span>&nbsp;<span class="ident" id="7251462">i</span><span class="op" id="7251463">+</span><span class="num" id="7251464">1</span><span class="op" id="7251465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251472">}</span><br>
<span class="lineno"></span><span class="op" id="7251474">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7251477">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7251550">func</span>&nbsp;<span class="ident" id="7251555">TestFileSetPastEnd</span><span class="op" id="7251573">(</span><span class="ident" id="7251574">t</span>&nbsp;<span class="op" id="7251576">*</span><span class="ident" id="7251577">testing</span><span class="op" id="7251584">.</span><span class="ident" id="7251585">T</span><span class="op" id="7251586">)</span>&nbsp;<span class="op" id="7251588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251591">fset</span>&nbsp;<span class="op" id="7251596">:=</span>&nbsp;<span class="ident" id="7251599">NewFileSet</span><span class="op" id="7251609">(</span><span class="op" id="7251610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251613">for</span>&nbsp;<span class="ident" id="7251617">_</span><span class="op" id="7251618">,</span>&nbsp;<span class="ident" id="7251620">test</span>&nbsp;<span class="op" id="7251625">:=</span>&nbsp;<span class="keyword" id="7251628">range</span>&nbsp;<span class="ident" id="7251634">tests</span>&nbsp;<span class="op" id="7251640">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251644">fset</span><span class="op" id="7251648">.</span><span class="ident" id="7251649">AddFile</span><span class="op" id="7251656">(</span><span class="ident" id="7251657">test</span><span class="op" id="7251661">.</span><span class="ident" id="7251662">filename</span><span class="op" id="7251670">,</span>&nbsp;<span class="ident" id="7251672">fset</span><span class="op" id="7251676">.</span><span class="ident" id="7251677">Base</span><span class="op" id="7251681">(</span><span class="op" id="7251682">)</span><span class="op" id="7251683">,</span>&nbsp;<span class="ident" id="7251685">test</span><span class="op" id="7251689">.</span><span class="ident" id="7251690">size</span><span class="op" id="7251694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251700">if</span>&nbsp;<span class="ident" id="7251703">f</span>&nbsp;<span class="op" id="7251705">:=</span>&nbsp;<span class="ident" id="7251708">fset</span><span class="op" id="7251712">.</span><span class="ident" id="7251713">File</span><span class="op" id="7251717">(</span><span class="ident" id="7251718">Pos</span><span class="op" id="7251721">(</span><span class="ident" id="7251722">fset</span><span class="op" id="7251726">.</span><span class="ident" id="7251727">Base</span><span class="op" id="7251731">(</span><span class="op" id="7251732">)</span><span class="op" id="7251733">)</span><span class="op" id="7251734">)</span><span class="op" id="7251735">;</span>&nbsp;<span class="ident" id="7251737">f</span>&nbsp;<span class="op" id="7251739">!=</span>&nbsp;<span class="ident" id="7251742">nil</span>&nbsp;<span class="op" id="7251746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251750">t</span><span class="op" id="7251751">.</span><span class="ident" id="7251752">Errorf</span><span class="op" id="7251758">(</span><span class="string" id="7251759">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7251777">,</span>&nbsp;<span class="ident" id="7251779">f</span><span class="op" id="7251780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7251783">}</span><br>
<span class="lineno">200</span><span class="op" id="7251785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7251788">func</span>&nbsp;<span class="ident" id="7251793">TestFileSetCacheUnlikely</span><span class="op" id="7251817">(</span><span class="ident" id="7251818">t</span>&nbsp;<span class="op" id="7251820">*</span><span class="ident" id="7251821">testing</span><span class="op" id="7251828">.</span><span class="ident" id="7251829">T</span><span class="op" id="7251830">)</span>&nbsp;<span class="op" id="7251832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251835">fset</span>&nbsp;<span class="op" id="7251840">:=</span>&nbsp;<span class="ident" id="7251843">NewFileSet</span><span class="op" id="7251853">(</span><span class="op" id="7251854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251857">offsets</span>&nbsp;<span class="op" id="7251865">:=</span>&nbsp;<span class="builtinfunc" id="7251868">make</span><span class="op" id="7251872">(</span><span class="keyword" id="7251873">map</span><span class="op" id="7251876">[</span><span class="builtintype" id="7251877">string</span><span class="op" id="7251883">]</span><span class="builtintype" id="7251884">int</span><span class="op" id="7251887">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7251890">for</span>&nbsp;<span class="ident" id="7251894">_</span><span class="op" id="7251895">,</span>&nbsp;<span class="ident" id="7251897">test</span>&nbsp;<span class="op" id="7251902">:=</span>&nbsp;<span class="keyword" id="7251905">range</span>&nbsp;<span class="ident" id="7251911">tests</span>&nbsp;<span class="op" id="7251917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251921">offsets</span><span class="op" id="7251928">[</span><span class="ident" id="7251929">test</span><span class="op" id="7251933">.</span><span class="ident" id="7251934">filename</span><span class="op" id="7251942">]</span>&nbsp;<span class="op" id="7251944">=</span>&nbsp;<span class="ident" id="7251946">fset</span><span class="op" id="7251950">.</span><span class="ident" id="7251951">Base</span><span class="op" id="7251955">(</span><span class="op" id="7251956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7251960">fset</span><span class="op" id="7251964">.</span><span class="ident" id="7251965">AddFile</span><span class="op" id="7251972">(</span><span class="ident" id="7251973">test</span><span class="op" id="7251977">.</span><span class="ident" id="7251978">filename</span><span class="op" id="7251986">,</span>&nbsp;<span class="ident" id="7251988">fset</span><span class="op" id="7251992">.</span><span class="ident" id="7251993">Base</span><span class="op" id="7251997">(</span><span class="op" id="7251998">)</span><span class="op" id="7251999">,</span>&nbsp;<span class="ident" id="7252001">test</span><span class="op" id="7252005">.</span><span class="ident" id="7252006">size</span><span class="op" id="7252010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252016">for</span>&nbsp;<span class="ident" id="7252020">file</span><span class="op" id="7252024">,</span>&nbsp;<span class="ident" id="7252026">pos</span>&nbsp;<span class="op" id="7252030">:=</span>&nbsp;<span class="keyword" id="7252033">range</span>&nbsp;<span class="ident" id="7252039">offsets</span>&nbsp;<span class="op" id="7252047">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252051">f</span>&nbsp;<span class="op" id="7252053">:=</span>&nbsp;<span class="ident" id="7252056">fset</span><span class="op" id="7252060">.</span><span class="ident" id="7252061">File</span><span class="op" id="7252065">(</span><span class="ident" id="7252066">Pos</span><span class="op" id="7252069">(</span><span class="ident" id="7252070">pos</span><span class="op" id="7252073">)</span><span class="op" id="7252074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252078">if</span>&nbsp;<span class="ident" id="7252081">f</span><span class="op" id="7252082">.</span><span class="ident" id="7252083">Name</span><span class="op" id="7252087">(</span><span class="op" id="7252088">)</span>&nbsp;<span class="op" id="7252090">!=</span>&nbsp;<span class="ident" id="7252093">file</span>&nbsp;<span class="op" id="7252098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252103">t</span><span class="op" id="7252104">.</span><span class="ident" id="7252105">Errorf</span><span class="op" id="7252111">(</span><span class="string" id="7252112">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7252144">,</span>&nbsp;<span class="ident" id="7252146">f</span><span class="op" id="7252147">.</span><span class="ident" id="7252148">Name</span><span class="op" id="7252152">(</span><span class="op" id="7252153">)</span><span class="op" id="7252154">,</span>&nbsp;<span class="ident" id="7252156">pos</span><span class="op" id="7252159">,</span>&nbsp;<span class="ident" id="7252161">file</span><span class="op" id="7252165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252172">}</span><br>
<span class="lineno">215</span><span class="op" id="7252174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7252177">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7252246">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7252285">func</span>&nbsp;<span class="ident" id="7252290">TestFileSetRace</span><span class="op" id="7252305">(</span><span class="ident" id="7252306">t</span>&nbsp;<span class="op" id="7252308">*</span><span class="ident" id="7252309">testing</span><span class="op" id="7252316">.</span><span class="ident" id="7252317">T</span><span class="op" id="7252318">)</span>&nbsp;<span class="op" id="7252320">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252323">fset</span>&nbsp;<span class="op" id="7252328">:=</span>&nbsp;<span class="ident" id="7252331">NewFileSet</span><span class="op" id="7252341">(</span><span class="op" id="7252342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252345">for</span>&nbsp;<span class="ident" id="7252349">i</span>&nbsp;<span class="op" id="7252351">:=</span>&nbsp;<span class="num" id="7252354">0</span><span class="op" id="7252355">;</span>&nbsp;<span class="ident" id="7252357">i</span>&nbsp;<span class="op" id="7252359">&lt;</span>&nbsp;<span class="num" id="7252361">100</span><span class="op" id="7252364">;</span>&nbsp;<span class="ident" id="7252366">i</span><span class="op" id="7252367">++</span>&nbsp;<span class="op" id="7252370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252374">fset</span><span class="op" id="7252378">.</span><span class="ident" id="7252379">AddFile</span><span class="op" id="7252386">(</span><span class="ident" id="7252387">fmt</span><span class="op" id="7252390">.</span><span class="ident" id="7252391">Sprintf</span><span class="op" id="7252398">(</span><span class="string" id="7252399">&#34;file-%d&#34;</span><span class="op" id="7252408">,</span>&nbsp;<span class="ident" id="7252410">i</span><span class="op" id="7252411">)</span><span class="op" id="7252412">,</span>&nbsp;<span class="ident" id="7252414">fset</span><span class="op" id="7252418">.</span><span class="ident" id="7252419">Base</span><span class="op" id="7252423">(</span><span class="op" id="7252424">)</span><span class="op" id="7252425">,</span>&nbsp;<span class="num" id="7252427">1031</span><span class="op" id="7252431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252437">max</span>&nbsp;<span class="op" id="7252441">:=</span>&nbsp;<span class="builtintype" id="7252444">int32</span><span class="op" id="7252449">(</span><span class="ident" id="7252450">fset</span><span class="op" id="7252454">.</span><span class="ident" id="7252455">Base</span><span class="op" id="7252459">(</span><span class="op" id="7252460">)</span><span class="op" id="7252461">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252464">var</span>&nbsp;<span class="ident" id="7252468">stop</span>&nbsp;<span class="ident" id="7252473">sync</span><span class="op" id="7252477">.</span><span class="ident" id="7252478">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252489">r</span>&nbsp;<span class="op" id="7252491">:=</span>&nbsp;<span class="ident" id="7252494">rand</span><span class="op" id="7252498">.</span><span class="ident" id="7252499">New</span><span class="op" id="7252502">(</span><span class="ident" id="7252503">rand</span><span class="op" id="7252507">.</span><span class="ident" id="7252508">NewSource</span><span class="op" id="7252517">(</span><span class="num" id="7252518">7</span><span class="op" id="7252519">)</span><span class="op" id="7252520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252523">for</span>&nbsp;<span class="ident" id="7252527">i</span>&nbsp;<span class="op" id="7252529">:=</span>&nbsp;<span class="num" id="7252532">0</span><span class="op" id="7252533">;</span>&nbsp;<span class="ident" id="7252535">i</span>&nbsp;<span class="op" id="7252537">&lt;</span>&nbsp;<span class="num" id="7252539">2</span><span class="op" id="7252540">;</span>&nbsp;<span class="ident" id="7252542">i</span><span class="op" id="7252543">++</span>&nbsp;<span class="op" id="7252546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252550">r</span>&nbsp;<span class="op" id="7252552">:=</span>&nbsp;<span class="ident" id="7252555">rand</span><span class="op" id="7252559">.</span><span class="ident" id="7252560">New</span><span class="op" id="7252563">(</span><span class="ident" id="7252564">rand</span><span class="op" id="7252568">.</span><span class="ident" id="7252569">NewSource</span><span class="op" id="7252578">(</span><span class="ident" id="7252579">r</span><span class="op" id="7252580">.</span><span class="ident" id="7252581">Int63</span><span class="op" id="7252586">(</span><span class="op" id="7252587">)</span><span class="op" id="7252588">)</span><span class="op" id="7252589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252593">stop</span><span class="op" id="7252597">.</span><span class="ident" id="7252598">Add</span><span class="op" id="7252601">(</span><span class="num" id="7252602">1</span><span class="op" id="7252603">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252607">go</span>&nbsp;<span class="keyword" id="7252610">func</span><span class="op" id="7252614">(</span><span class="op" id="7252615">)</span>&nbsp;<span class="op" id="7252617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252622">for</span>&nbsp;<span class="ident" id="7252626">i</span>&nbsp;<span class="op" id="7252628">:=</span>&nbsp;<span class="num" id="7252631">0</span><span class="op" id="7252632">;</span>&nbsp;<span class="ident" id="7252634">i</span>&nbsp;<span class="op" id="7252636">&lt;</span>&nbsp;<span class="num" id="7252638">1000</span><span class="op" id="7252642">;</span>&nbsp;<span class="ident" id="7252644">i</span><span class="op" id="7252645">++</span>&nbsp;<span class="op" id="7252648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252654">fset</span><span class="op" id="7252658">.</span><span class="ident" id="7252659">Position</span><span class="op" id="7252667">(</span><span class="ident" id="7252668">Pos</span><span class="op" id="7252671">(</span><span class="ident" id="7252672">r</span><span class="op" id="7252673">.</span><span class="ident" id="7252674">Int31n</span><span class="op" id="7252680">(</span><span class="ident" id="7252681">max</span><span class="op" id="7252684">)</span><span class="op" id="7252685">)</span><span class="op" id="7252686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252696">stop</span><span class="op" id="7252700">.</span><span class="ident" id="7252701">Done</span><span class="op" id="7252705">(</span><span class="op" id="7252706">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252710">}</span><span class="op" id="7252711">(</span><span class="op" id="7252712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7252715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252718">stop</span><span class="op" id="7252722">.</span><span class="ident" id="7252723">Wait</span><span class="op" id="7252727">(</span><span class="op" id="7252728">)</span><br>
<span class="lineno"></span><span class="op" id="7252730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7252733">func</span>&nbsp;<span class="ident" id="7252738">TestPositionFor</span><span class="op" id="7252753">(</span><span class="ident" id="7252754">t</span>&nbsp;<span class="op" id="7252756">*</span><span class="ident" id="7252757">testing</span><span class="op" id="7252764">.</span><span class="ident" id="7252765">T</span><span class="op" id="7252766">)</span>&nbsp;<span class="op" id="7252768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252771">src</span>&nbsp;<span class="op" id="7252775">:=</span>&nbsp;<span class="op" id="7252778">[</span><span class="op" id="7252779">]</span><span class="builtintype" id="7252780">byte</span><span class="op" id="7252784">(</span><span class="string" id="7252785">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7252834">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252838">const</span>&nbsp;<span class="ident" id="7252844">filename</span>&nbsp;<span class="op" id="7252853">=</span>&nbsp;<span class="string" id="7252855">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252862">fset</span>&nbsp;<span class="op" id="7252867">:=</span>&nbsp;<span class="ident" id="7252870">NewFileSet</span><span class="op" id="7252880">(</span><span class="op" id="7252881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252884">f</span>&nbsp;<span class="op" id="7252886">:=</span>&nbsp;<span class="ident" id="7252889">fset</span><span class="op" id="7252893">.</span><span class="ident" id="7252894">AddFile</span><span class="op" id="7252901">(</span><span class="ident" id="7252902">filename</span><span class="op" id="7252910">,</span>&nbsp;<span class="ident" id="7252912">fset</span><span class="op" id="7252916">.</span><span class="ident" id="7252917">Base</span><span class="op" id="7252921">(</span><span class="op" id="7252922">)</span><span class="op" id="7252923">,</span>&nbsp;<span class="builtinfunc" id="7252925">len</span><span class="op" id="7252928">(</span><span class="ident" id="7252929">src</span><span class="op" id="7252932">)</span><span class="op" id="7252933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7252936">f</span><span class="op" id="7252937">.</span><span class="ident" id="7252938">SetLinesForContent</span><span class="op" id="7252956">(</span><span class="ident" id="7252957">src</span><span class="op" id="7252960">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7252964">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7252989">for</span>&nbsp;<span class="ident" id="7252993">i</span><span class="op" id="7252994">,</span>&nbsp;<span class="ident" id="7252996">offs</span>&nbsp;<span class="op" id="7253001">:=</span>&nbsp;<span class="keyword" id="7253004">range</span>&nbsp;<span class="ident" id="7253010">f</span><span class="op" id="7253011">.</span><span class="ident" id="7253012">lines</span>&nbsp;<span class="op" id="7253018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253022">got1</span>&nbsp;<span class="op" id="7253027">:=</span>&nbsp;<span class="ident" id="7253030">f</span><span class="op" id="7253031">.</span><span class="ident" id="7253032">PositionFor</span><span class="op" id="7253043">(</span><span class="ident" id="7253044">f</span><span class="op" id="7253045">.</span><span class="ident" id="7253046">Pos</span><span class="op" id="7253049">(</span><span class="ident" id="7253050">offs</span><span class="op" id="7253054">)</span><span class="op" id="7253055">,</span>&nbsp;<span class="builtintype" id="7253057">false</span><span class="op" id="7253062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253066">got2</span>&nbsp;<span class="op" id="7253071">:=</span>&nbsp;<span class="ident" id="7253074">f</span><span class="op" id="7253075">.</span><span class="ident" id="7253076">PositionFor</span><span class="op" id="7253087">(</span><span class="ident" id="7253088">f</span><span class="op" id="7253089">.</span><span class="ident" id="7253090">Pos</span><span class="op" id="7253093">(</span><span class="ident" id="7253094">offs</span><span class="op" id="7253098">)</span><span class="op" id="7253099">,</span>&nbsp;<span class="builtintype" id="7253101">true</span><span class="op" id="7253105">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253109">got3</span>&nbsp;<span class="op" id="7253114">:=</span>&nbsp;<span class="ident" id="7253117">f</span><span class="op" id="7253118">.</span><span class="ident" id="7253119">Position</span><span class="op" id="7253127">(</span><span class="ident" id="7253128">f</span><span class="op" id="7253129">.</span><span class="ident" id="7253130">Pos</span><span class="op" id="7253133">(</span><span class="ident" id="7253134">offs</span><span class="op" id="7253138">)</span><span class="op" id="7253139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253143">want</span>&nbsp;<span class="op" id="7253148">:=</span>&nbsp;<span class="ident" id="7253151">Position</span><span class="op" id="7253159">{</span><span class="ident" id="7253160">filename</span><span class="op" id="7253168">,</span>&nbsp;<span class="ident" id="7253170">offs</span><span class="op" id="7253174">,</span>&nbsp;<span class="ident" id="7253176">i</span>&nbsp;<span class="op" id="7253178">+</span>&nbsp;<span class="num" id="7253180">1</span><span class="op" id="7253181">,</span>&nbsp;<span class="num" id="7253183">1</span><span class="op" id="7253184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253188">checkPos</span><span class="op" id="7253196">(</span><span class="ident" id="7253197">t</span><span class="op" id="7253198">,</span>&nbsp;<span class="string" id="7253200">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7253227">,</span>&nbsp;<span class="ident" id="7253229">got1</span><span class="op" id="7253233">,</span>&nbsp;<span class="ident" id="7253235">want</span><span class="op" id="7253239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253243">checkPos</span><span class="op" id="7253251">(</span><span class="ident" id="7253252">t</span><span class="op" id="7253253">,</span>&nbsp;<span class="string" id="7253255">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7253280">,</span>&nbsp;<span class="ident" id="7253282">got2</span><span class="op" id="7253286">,</span>&nbsp;<span class="ident" id="7253288">want</span><span class="op" id="7253292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253296">checkPos</span><span class="op" id="7253304">(</span><span class="ident" id="7253305">t</span><span class="op" id="7253306">,</span>&nbsp;<span class="string" id="7253308">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7253321">,</span>&nbsp;<span class="ident" id="7253323">got3</span><span class="op" id="7253327">,</span>&nbsp;<span class="ident" id="7253329">want</span><span class="op" id="7253333">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7253336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7253340">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7253385">const</span>&nbsp;<span class="ident" id="7253391">l1</span><span class="op" id="7253393">,</span>&nbsp;<span class="ident" id="7253395">l2</span>&nbsp;<span class="op" id="7253398">=</span>&nbsp;<span class="num" id="7253400">5</span><span class="op" id="7253401">,</span>&nbsp;<span class="num" id="7253403">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253406">f</span><span class="op" id="7253407">.</span><span class="ident" id="7253408">AddLineInfo</span><span class="op" id="7253419">(</span><span class="ident" id="7253420">f</span><span class="op" id="7253421">.</span><span class="ident" id="7253422">lines</span><span class="op" id="7253427">[</span><span class="ident" id="7253428">l1</span><span class="op" id="7253430">-</span><span class="num" id="7253431">1</span><span class="op" id="7253432">]</span><span class="op" id="7253433">,</span>&nbsp;<span class="string" id="7253435">&#34;&#34;</span><span class="op" id="7253437">,</span>&nbsp;<span class="num" id="7253439">100</span><span class="op" id="7253442">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253445">f</span><span class="op" id="7253446">.</span><span class="ident" id="7253447">AddLineInfo</span><span class="op" id="7253458">(</span><span class="ident" id="7253459">f</span><span class="op" id="7253460">.</span><span class="ident" id="7253461">lines</span><span class="op" id="7253466">[</span><span class="ident" id="7253467">l2</span><span class="op" id="7253469">-</span><span class="num" id="7253470">1</span><span class="op" id="7253471">]</span><span class="op" id="7253472">,</span>&nbsp;<span class="string" id="7253474">&#34;bar&#34;</span><span class="op" id="7253479">,</span>&nbsp;<span class="num" id="7253481">3</span><span class="op" id="7253482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7253486">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7253537">for</span>&nbsp;<span class="ident" id="7253541">i</span><span class="op" id="7253542">,</span>&nbsp;<span class="ident" id="7253544">offs</span>&nbsp;<span class="op" id="7253549">:=</span>&nbsp;<span class="keyword" id="7253552">range</span>&nbsp;<span class="ident" id="7253558">f</span><span class="op" id="7253559">.</span><span class="ident" id="7253560">lines</span>&nbsp;<span class="op" id="7253566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253570">got1</span>&nbsp;<span class="op" id="7253575">:=</span>&nbsp;<span class="ident" id="7253578">f</span><span class="op" id="7253579">.</span><span class="ident" id="7253580">PositionFor</span><span class="op" id="7253591">(</span><span class="ident" id="7253592">f</span><span class="op" id="7253593">.</span><span class="ident" id="7253594">Pos</span><span class="op" id="7253597">(</span><span class="ident" id="7253598">offs</span><span class="op" id="7253602">)</span><span class="op" id="7253603">,</span>&nbsp;<span class="builtintype" id="7253605">false</span><span class="op" id="7253610">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253614">want</span>&nbsp;<span class="op" id="7253619">:=</span>&nbsp;<span class="ident" id="7253622">Position</span><span class="op" id="7253630">{</span><span class="ident" id="7253631">filename</span><span class="op" id="7253639">,</span>&nbsp;<span class="ident" id="7253641">offs</span><span class="op" id="7253645">,</span>&nbsp;<span class="ident" id="7253647">i</span>&nbsp;<span class="op" id="7253649">+</span>&nbsp;<span class="num" id="7253651">1</span><span class="op" id="7253652">,</span>&nbsp;<span class="num" id="7253654">1</span><span class="op" id="7253655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253659">checkPos</span><span class="op" id="7253667">(</span><span class="ident" id="7253668">t</span><span class="op" id="7253669">,</span>&nbsp;<span class="string" id="7253671">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7253698">,</span>&nbsp;<span class="ident" id="7253700">got1</span><span class="op" id="7253704">,</span>&nbsp;<span class="ident" id="7253706">want</span><span class="op" id="7253710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7253713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7253717">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7253764">for</span>&nbsp;<span class="ident" id="7253768">i</span><span class="op" id="7253769">,</span>&nbsp;<span class="ident" id="7253771">offs</span>&nbsp;<span class="op" id="7253776">:=</span>&nbsp;<span class="keyword" id="7253779">range</span>&nbsp;<span class="ident" id="7253785">f</span><span class="op" id="7253786">.</span><span class="ident" id="7253787">lines</span>&nbsp;<span class="op" id="7253793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253797">got2</span>&nbsp;<span class="op" id="7253802">:=</span>&nbsp;<span class="ident" id="7253805">f</span><span class="op" id="7253806">.</span><span class="ident" id="7253807">PositionFor</span><span class="op" id="7253818">(</span><span class="ident" id="7253819">f</span><span class="op" id="7253820">.</span><span class="ident" id="7253821">Pos</span><span class="op" id="7253824">(</span><span class="ident" id="7253825">offs</span><span class="op" id="7253829">)</span><span class="op" id="7253830">,</span>&nbsp;<span class="builtintype" id="7253832">true</span><span class="op" id="7253836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253840">got3</span>&nbsp;<span class="op" id="7253845">:=</span>&nbsp;<span class="ident" id="7253848">f</span><span class="op" id="7253849">.</span><span class="ident" id="7253850">Position</span><span class="op" id="7253858">(</span><span class="ident" id="7253859">f</span><span class="op" id="7253860">.</span><span class="ident" id="7253861">Pos</span><span class="op" id="7253864">(</span><span class="ident" id="7253865">offs</span><span class="op" id="7253869">)</span><span class="op" id="7253870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253874">want</span>&nbsp;<span class="op" id="7253879">:=</span>&nbsp;<span class="ident" id="7253882">Position</span><span class="op" id="7253890">{</span><span class="ident" id="7253891">filename</span><span class="op" id="7253899">,</span>&nbsp;<span class="ident" id="7253901">offs</span><span class="op" id="7253905">,</span>&nbsp;<span class="ident" id="7253907">i</span>&nbsp;<span class="op" id="7253909">+</span>&nbsp;<span class="num" id="7253911">1</span><span class="op" id="7253912">,</span>&nbsp;<span class="num" id="7253914">1</span><span class="op" id="7253915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7253919">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7253966">line</span>&nbsp;<span class="op" id="7253971">:=</span>&nbsp;<span class="ident" id="7253974">want</span><span class="op" id="7253978">.</span><span class="ident" id="7253979">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7253986">if</span>&nbsp;<span class="ident" id="7253989">i</span><span class="op" id="7253990">+</span><span class="num" id="7253991">1</span>&nbsp;<span class="op" id="7253993">&gt;=</span>&nbsp;<span class="ident" id="7253996">l1</span>&nbsp;<span class="op" id="7253999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254004">want</span><span class="op" id="7254008">.</span><span class="ident" id="7254009">Filename</span>&nbsp;<span class="op" id="7254018">=</span>&nbsp;<span class="string" id="7254020">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254026">want</span><span class="op" id="7254030">.</span><span class="ident" id="7254031">Line</span>&nbsp;<span class="op" id="7254036">=</span>&nbsp;<span class="ident" id="7254038">line</span>&nbsp;<span class="op" id="7254043">-</span>&nbsp;<span class="ident" id="7254045">l1</span>&nbsp;<span class="op" id="7254048">+</span>&nbsp;<span class="num" id="7254050">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7254056">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7254060">if</span>&nbsp;<span class="ident" id="7254063">i</span><span class="op" id="7254064">+</span><span class="num" id="7254065">1</span>&nbsp;<span class="op" id="7254067">&gt;=</span>&nbsp;<span class="ident" id="7254070">l2</span>&nbsp;<span class="op" id="7254073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254078">want</span><span class="op" id="7254082">.</span><span class="ident" id="7254083">Filename</span>&nbsp;<span class="op" id="7254092">=</span>&nbsp;<span class="string" id="7254094">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254103">want</span><span class="op" id="7254107">.</span><span class="ident" id="7254108">Line</span>&nbsp;<span class="op" id="7254113">=</span>&nbsp;<span class="ident" id="7254115">line</span>&nbsp;<span class="op" id="7254120">-</span>&nbsp;<span class="ident" id="7254122">l2</span>&nbsp;<span class="op" id="7254125">+</span>&nbsp;<span class="num" id="7254127">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7254131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254135">checkPos</span><span class="op" id="7254143">(</span><span class="ident" id="7254144">t</span><span class="op" id="7254145">,</span>&nbsp;<span class="string" id="7254147">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7254172">,</span>&nbsp;<span class="ident" id="7254174">got2</span><span class="op" id="7254178">,</span>&nbsp;<span class="ident" id="7254180">want</span><span class="op" id="7254184">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7254188">checkPos</span><span class="op" id="7254196">(</span><span class="ident" id="7254197">t</span><span class="op" id="7254198">,</span>&nbsp;<span class="string" id="7254200">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7254213">,</span>&nbsp;<span class="ident" id="7254215">got3</span><span class="op" id="7254219">,</span>&nbsp;<span class="ident" id="7254221">want</span><span class="op" id="7254225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7254228">}</span><br>
<span class="lineno"></span><span class="op" id="7254230">}</span>
</div>
</body>
</html>
