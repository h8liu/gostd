<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5072918">package</span>&nbsp;<span class="ident" id="5072926">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5072933">import</span>&nbsp;<span class="op" id="5072940">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5072943">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5072952">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5072958">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5072965">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="5072970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5072973">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;serial&nbsp;console&nbsp;device</span><br>
<span class="lineno"></span><span class="comment" id="5073010">//&nbsp;It&nbsp;is&nbsp;basically&nbsp;two&nbsp;DMA&nbsp;pipes&nbsp;of&nbsp;ring&nbsp;buffered&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5073067">//&nbsp;one&nbsp;pipe&nbsp;for&nbsp;input,&nbsp;one&nbsp;pipe&nbsp;for&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5073111">type</span>&nbsp;<span class="ident" id="5073116">serial</span>&nbsp;<span class="keyword" id="5073123">struct</span>&nbsp;<span class="op" id="5073130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073133">intBus</span>&nbsp;<span class="ident" id="5073140">intBus</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073148">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5073155">*</span><span class="ident" id="5073156">page</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073163">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5073170">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073176">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="5073183">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073189">IntOut</span>&nbsp;<span class="builtintype" id="5073196">byte</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073203">Output</span>&nbsp;<span class="ident" id="5073210">io</span><span class="op" id="5073212">.</span><span class="ident" id="5073213">Writer</span><br>
<span class="lineno"></span><span class="op" id="5073220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5073223">var</span>&nbsp;<span class="ident" id="5073227">_</span>&nbsp;<span class="ident" id="5073229">device</span>&nbsp;<span class="op" id="5073236">=</span>&nbsp;<span class="builtinfunc" id="5073238">new</span><span class="op" id="5073241">(</span><span class="ident" id="5073242">serial</span><span class="op" id="5073248">)</span>&nbsp;<span class="comment" id="5073250">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;device</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5073273">const</span>&nbsp;<span class="op" id="5073279">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073282">serialBase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5073297">=</span>&nbsp;<span class="num" id="5073299">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073304">serialInHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073319">=</span>&nbsp;<span class="ident" id="5073321">serialBase</span>&nbsp;<span class="op" id="5073332">+</span>&nbsp;<span class="num" id="5073334">0</span>&nbsp;&nbsp;<span class="comment" id="5073337">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073361">serialInTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073376">=</span>&nbsp;<span class="ident" id="5073378">serialBase</span>&nbsp;<span class="op" id="5073389">+</span>&nbsp;<span class="num" id="5073391">4</span>&nbsp;&nbsp;<span class="comment" id="5073394">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073413">serialInWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073428">=</span>&nbsp;<span class="ident" id="5073430">serialBase</span>&nbsp;<span class="op" id="5073441">+</span>&nbsp;<span class="num" id="5073443">8</span>&nbsp;&nbsp;<span class="comment" id="5073446">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073487">serialInThresh</span>&nbsp;<span class="op" id="5073502">=</span>&nbsp;<span class="ident" id="5073504">serialBase</span>&nbsp;<span class="op" id="5073515">+</span>&nbsp;<span class="num" id="5073517">12</span>&nbsp;<span class="comment" id="5073520">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;input&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073564">serialOutHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073580">=</span>&nbsp;<span class="ident" id="5073582">serialBase</span>&nbsp;<span class="op" id="5073593">+</span>&nbsp;<span class="num" id="5073595">16</span>&nbsp;<span class="comment" id="5073598">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073617">serialOutTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073633">=</span>&nbsp;<span class="ident" id="5073635">serialBase</span>&nbsp;<span class="op" id="5073646">+</span>&nbsp;<span class="num" id="5073648">20</span>&nbsp;<span class="comment" id="5073651">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073675">serialOutWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5073691">=</span>&nbsp;<span class="ident" id="5073693">serialBase</span>&nbsp;<span class="op" id="5073704">+</span>&nbsp;<span class="num" id="5073706">24</span>&nbsp;<span class="comment" id="5073709">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073750">serialOutThresh</span>&nbsp;<span class="op" id="5073766">=</span>&nbsp;<span class="ident" id="5073768">serialBase</span>&nbsp;<span class="op" id="5073779">+</span>&nbsp;<span class="num" id="5073781">28</span>&nbsp;<span class="comment" id="5073784">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;output&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073829">serialInBuf</span>&nbsp;&nbsp;<span class="op" id="5073842">=</span>&nbsp;<span class="ident" id="5073844">serialBase</span>&nbsp;<span class="op" id="5073855">+</span>&nbsp;<span class="num" id="5073857">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073861">serialOutBuf</span>&nbsp;<span class="op" id="5073874">=</span>&nbsp;<span class="ident" id="5073876">serialBase</span>&nbsp;<span class="op" id="5073887">+</span>&nbsp;<span class="num" id="5073889">96</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5073894">serialCap</span>&nbsp;<span class="op" id="5073904">=</span>&nbsp;<span class="num" id="5073906">30</span>&nbsp;<span class="comment" id="5073909">//&nbsp;30&nbsp;bytes&nbsp;maximum&nbsp;in&nbsp;each&nbsp;pipe</span><br>
<span class="lineno"></span><span class="op" id="5073942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5073945">//&nbsp;NewSerial&nbsp;creates&nbsp;a&nbsp;new&nbsp;serial&nbsp;controller.</span><br>
<span class="lineno">45</span><span class="keyword" id="5073991">func</span>&nbsp;<span class="ident" id="5073996">newSerial</span><span class="op" id="5074005">(</span><span class="ident" id="5074006">p</span>&nbsp;<span class="op" id="5074008">*</span><span class="ident" id="5074009">page</span><span class="op" id="5074013">,</span>&nbsp;<span class="ident" id="5074015">i</span>&nbsp;<span class="ident" id="5074017">intBus</span><span class="op" id="5074023">)</span>&nbsp;<span class="op" id="5074025">*</span><span class="ident" id="5074026">serial</span>&nbsp;<span class="op" id="5074033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074036">ret</span>&nbsp;<span class="op" id="5074040">:=</span>&nbsp;<span class="builtinfunc" id="5074043">new</span><span class="op" id="5074046">(</span><span class="ident" id="5074047">serial</span><span class="op" id="5074053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074056">ret</span><span class="op" id="5074059">.</span><span class="ident" id="5074060">intBus</span>&nbsp;<span class="op" id="5074067">=</span>&nbsp;<span class="ident" id="5074069">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074072">ret</span><span class="op" id="5074075">.</span><span class="ident" id="5074076">p</span>&nbsp;<span class="op" id="5074078">=</span>&nbsp;<span class="ident" id="5074080">p</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074084">//&nbsp;default&nbsp;interrupts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074107">ret</span><span class="op" id="5074110">.</span><span class="ident" id="5074111">Core</span>&nbsp;<span class="op" id="5074116">=</span>&nbsp;<span class="num" id="5074118">0</span>&nbsp;<span class="comment" id="5074120">//&nbsp;to&nbsp;core&nbsp;0&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074139">ret</span><span class="op" id="5074142">.</span><span class="ident" id="5074143">IntIn</span>&nbsp;<span class="op" id="5074149">=</span>&nbsp;<span class="num" id="5074151">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074154">ret</span><span class="op" id="5074157">.</span><span class="ident" id="5074158">IntOut</span>&nbsp;<span class="op" id="5074165">=</span>&nbsp;<span class="num" id="5074167">9</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074171">ret</span><span class="op" id="5074174">.</span><span class="ident" id="5074175">Output</span>&nbsp;<span class="op" id="5074182">=</span>&nbsp;<span class="ident" id="5074184">os</span><span class="op" id="5074186">.</span><span class="ident" id="5074187">Stdout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074196">return</span>&nbsp;<span class="ident" id="5074203">ret</span><br>
<span class="lineno"></span><span class="op" id="5074207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="5074210">func</span>&nbsp;<span class="op" id="5074215">(</span><span class="ident" id="5074216">s</span>&nbsp;<span class="op" id="5074218">*</span><span class="ident" id="5074219">serial</span><span class="op" id="5074225">)</span>&nbsp;<span class="ident" id="5074227">interrupt</span><span class="op" id="5074236">(</span><span class="ident" id="5074237">code</span>&nbsp;<span class="builtintype" id="5074242">byte</span><span class="op" id="5074246">)</span>&nbsp;<span class="op" id="5074248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074251">s</span><span class="op" id="5074252">.</span><span class="ident" id="5074253">intBus</span><span class="op" id="5074259">.</span><span class="ident" id="5074260">Interrupt</span><span class="op" id="5074269">(</span><span class="ident" id="5074270">code</span><span class="op" id="5074274">,</span>&nbsp;<span class="ident" id="5074276">s</span><span class="op" id="5074277">.</span><span class="ident" id="5074278">Core</span><span class="op" id="5074282">)</span><br>
<span class="lineno"></span><span class="op" id="5074284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074287">//&nbsp;WriteByte&nbsp;appends&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno">65</span><span class="keyword" id="5074343">func</span>&nbsp;<span class="op" id="5074348">(</span><span class="ident" id="5074349">s</span>&nbsp;<span class="op" id="5074351">*</span><span class="ident" id="5074352">serial</span><span class="op" id="5074358">)</span>&nbsp;<span class="ident" id="5074360">WriteByte</span><span class="op" id="5074369">(</span><span class="ident" id="5074370">b</span>&nbsp;<span class="builtintype" id="5074372">byte</span><span class="op" id="5074376">)</span>&nbsp;<span class="builtintype" id="5074378">bool</span>&nbsp;<span class="op" id="5074383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074386">head</span>&nbsp;<span class="op" id="5074391">:=</span>&nbsp;<span class="ident" id="5074394">s</span><span class="op" id="5074395">.</span><span class="ident" id="5074396">p</span><span class="op" id="5074397">.</span><span class="ident" id="5074398">ReadWord</span><span class="op" id="5074406">(</span><span class="ident" id="5074407">serialInHead</span><span class="op" id="5074419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074422">tail</span>&nbsp;<span class="op" id="5074427">:=</span>&nbsp;<span class="ident" id="5074430">s</span><span class="op" id="5074431">.</span><span class="ident" id="5074432">p</span><span class="op" id="5074433">.</span><span class="ident" id="5074434">ReadWord</span><span class="op" id="5074442">(</span><span class="ident" id="5074443">serialInTail</span><span class="op" id="5074455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074458">n</span>&nbsp;<span class="op" id="5074460">:=</span>&nbsp;<span class="ident" id="5074463">head</span>&nbsp;<span class="op" id="5074468">-</span>&nbsp;<span class="ident" id="5074470">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074476">if</span>&nbsp;<span class="ident" id="5074479">n</span>&nbsp;<span class="op" id="5074481">&gt;=</span>&nbsp;<span class="ident" id="5074484">serialCap</span>&nbsp;<span class="op" id="5074494">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074498">return</span>&nbsp;<span class="builtintype" id="5074505">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074516">s</span><span class="op" id="5074517">.</span><span class="ident" id="5074518">p</span><span class="op" id="5074519">.</span><span class="ident" id="5074520">WriteByte</span><span class="op" id="5074529">(</span><span class="ident" id="5074530">serialInBuf</span><span class="op" id="5074541">+</span><span class="ident" id="5074542">head</span><span class="op" id="5074546">%</span><span class="num" id="5074547">32</span><span class="op" id="5074549">,</span>&nbsp;<span class="ident" id="5074551">b</span><span class="op" id="5074552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074556">head</span><span class="op" id="5074560">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074564">s</span><span class="op" id="5074565">.</span><span class="ident" id="5074566">p</span><span class="op" id="5074567">.</span><span class="ident" id="5074568">WriteWord</span><span class="op" id="5074577">(</span><span class="ident" id="5074578">serialInTail</span><span class="op" id="5074590">,</span>&nbsp;<span class="ident" id="5074592">head</span><span class="op" id="5074596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074600">n</span><span class="op" id="5074601">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074605">thresh</span>&nbsp;<span class="op" id="5074612">:=</span>&nbsp;<span class="ident" id="5074615">s</span><span class="op" id="5074616">.</span><span class="ident" id="5074617">p</span><span class="op" id="5074618">.</span><span class="ident" id="5074619">ReadWord</span><span class="op" id="5074627">(</span><span class="ident" id="5074628">serialInThresh</span><span class="op" id="5074642">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074645">if</span>&nbsp;<span class="ident" id="5074648">n</span>&nbsp;<span class="op" id="5074650">&gt;=</span>&nbsp;<span class="ident" id="5074653">thresh</span>&nbsp;<span class="op" id="5074660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074664">s</span><span class="op" id="5074665">.</span><span class="ident" id="5074666">interrupt</span><span class="op" id="5074675">(</span><span class="ident" id="5074676">s</span><span class="op" id="5074677">.</span><span class="ident" id="5074678">IntIn</span><span class="op" id="5074683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5074686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074690">return</span>&nbsp;<span class="builtintype" id="5074697">true</span><br>
<span class="lineno">85</span><span class="op" id="5074702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5074705">//&nbsp;OutLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5074776">func</span>&nbsp;<span class="op" id="5074781">(</span><span class="ident" id="5074782">s</span>&nbsp;<span class="op" id="5074784">*</span><span class="ident" id="5074785">serial</span><span class="op" id="5074791">)</span>&nbsp;<span class="ident" id="5074793">OutLen</span><span class="op" id="5074799">(</span><span class="op" id="5074800">)</span>&nbsp;<span class="builtintype" id="5074802">uint32</span>&nbsp;<span class="op" id="5074809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074812">head</span>&nbsp;<span class="op" id="5074817">:=</span>&nbsp;<span class="ident" id="5074820">s</span><span class="op" id="5074821">.</span><span class="ident" id="5074822">p</span><span class="op" id="5074823">.</span><span class="ident" id="5074824">ReadWord</span><span class="op" id="5074832">(</span><span class="ident" id="5074833">serialOutHead</span><span class="op" id="5074846">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074849">tail</span>&nbsp;<span class="op" id="5074854">:=</span>&nbsp;<span class="ident" id="5074857">s</span><span class="op" id="5074858">.</span><span class="ident" id="5074859">p</span><span class="op" id="5074860">.</span><span class="ident" id="5074861">ReadWord</span><span class="op" id="5074869">(</span><span class="ident" id="5074870">serialOutTail</span><span class="op" id="5074883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074886">ret</span>&nbsp;<span class="op" id="5074890">:=</span>&nbsp;<span class="ident" id="5074893">head</span>&nbsp;<span class="op" id="5074898">-</span>&nbsp;<span class="ident" id="5074900">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5074906">if</span>&nbsp;<span class="ident" id="5074909">ret</span>&nbsp;<span class="op" id="5074913">&gt;</span>&nbsp;<span class="ident" id="5074915">serialCap</span>&nbsp;<span class="op" id="5074925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5074929">log</span><span class="op" id="5074932">.</span><span class="ident" id="5074933">Printf</span><span class="op" id="5074939">(</span><span class="string" id="5074940">&#34;error&nbsp;output&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5074968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5074972">//&nbsp;on&nbsp;error&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;full</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075009">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075041">ret</span>&nbsp;<span class="op" id="5075045">=</span>&nbsp;<span class="ident" id="5075047">serialCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075061">return</span>&nbsp;<span class="ident" id="5075068">ret</span><br>
<span class="lineno"></span><span class="op" id="5075072">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5075075">//&nbsp;InLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5075144">func</span>&nbsp;<span class="op" id="5075149">(</span><span class="ident" id="5075150">s</span>&nbsp;<span class="op" id="5075152">*</span><span class="ident" id="5075153">serial</span><span class="op" id="5075159">)</span>&nbsp;<span class="ident" id="5075161">InLen</span><span class="op" id="5075166">(</span><span class="op" id="5075167">)</span>&nbsp;<span class="builtintype" id="5075169">uint32</span>&nbsp;<span class="op" id="5075176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075179">head</span>&nbsp;<span class="op" id="5075184">:=</span>&nbsp;<span class="ident" id="5075187">s</span><span class="op" id="5075188">.</span><span class="ident" id="5075189">p</span><span class="op" id="5075190">.</span><span class="ident" id="5075191">ReadWord</span><span class="op" id="5075199">(</span><span class="ident" id="5075200">serialInHead</span><span class="op" id="5075212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075215">tail</span>&nbsp;<span class="op" id="5075220">:=</span>&nbsp;<span class="ident" id="5075223">s</span><span class="op" id="5075224">.</span><span class="ident" id="5075225">p</span><span class="op" id="5075226">.</span><span class="ident" id="5075227">ReadWord</span><span class="op" id="5075235">(</span><span class="ident" id="5075236">serialInTail</span><span class="op" id="5075248">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075251">ret</span>&nbsp;<span class="op" id="5075255">:=</span>&nbsp;<span class="ident" id="5075258">head</span>&nbsp;<span class="op" id="5075263">-</span>&nbsp;<span class="ident" id="5075265">tail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075271">if</span>&nbsp;<span class="ident" id="5075274">ret</span>&nbsp;<span class="op" id="5075278">&gt;</span>&nbsp;<span class="ident" id="5075280">serialCap</span>&nbsp;<span class="op" id="5075290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075294">log</span><span class="op" id="5075297">.</span><span class="ident" id="5075298">Printf</span><span class="op" id="5075304">(</span><span class="string" id="5075305">&#34;error&nbsp;input&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5075332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075336">//&nbsp;on&nbsp;error,&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5075375">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075407">ret</span>&nbsp;<span class="op" id="5075411">=</span>&nbsp;<span class="num" id="5075413">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075419">return</span>&nbsp;<span class="ident" id="5075426">ret</span><br>
<span class="lineno"></span><span class="op" id="5075430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5075433">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;out&nbsp;of&nbsp;serial&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5075492">func</span>&nbsp;<span class="op" id="5075497">(</span><span class="ident" id="5075498">s</span>&nbsp;<span class="op" id="5075500">*</span><span class="ident" id="5075501">serial</span><span class="op" id="5075507">)</span>&nbsp;<span class="ident" id="5075509">ReadByte</span><span class="op" id="5075517">(</span><span class="op" id="5075518">)</span>&nbsp;<span class="op" id="5075520">(</span><span class="builtintype" id="5075521">byte</span><span class="op" id="5075525">,</span>&nbsp;<span class="builtintype" id="5075527">bool</span><span class="op" id="5075531">)</span>&nbsp;<span class="op" id="5075533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075536">head</span>&nbsp;<span class="op" id="5075541">:=</span>&nbsp;<span class="ident" id="5075544">s</span><span class="op" id="5075545">.</span><span class="ident" id="5075546">p</span><span class="op" id="5075547">.</span><span class="ident" id="5075548">ReadWord</span><span class="op" id="5075556">(</span><span class="ident" id="5075557">serialOutHead</span><span class="op" id="5075570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075573">tail</span>&nbsp;<span class="op" id="5075578">:=</span>&nbsp;<span class="ident" id="5075581">s</span><span class="op" id="5075582">.</span><span class="ident" id="5075583">p</span><span class="op" id="5075584">.</span><span class="ident" id="5075585">ReadWord</span><span class="op" id="5075593">(</span><span class="ident" id="5075594">serialOutTail</span><span class="op" id="5075607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075610">n</span>&nbsp;<span class="op" id="5075612">:=</span>&nbsp;<span class="ident" id="5075615">head</span>&nbsp;<span class="op" id="5075620">-</span>&nbsp;<span class="ident" id="5075622">tail</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075628">if</span>&nbsp;<span class="ident" id="5075631">n</span>&nbsp;<span class="op" id="5075633">==</span>&nbsp;<span class="num" id="5075636">0</span>&nbsp;<span class="op" id="5075638">||</span>&nbsp;<span class="ident" id="5075641">n</span>&nbsp;<span class="op" id="5075643">&gt;</span>&nbsp;<span class="ident" id="5075645">serialCap</span>&nbsp;<span class="op" id="5075655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075659">return</span>&nbsp;<span class="num" id="5075666">0</span><span class="op" id="5075667">,</span>&nbsp;<span class="builtintype" id="5075669">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075680">b</span>&nbsp;<span class="op" id="5075682">:=</span>&nbsp;<span class="ident" id="5075685">s</span><span class="op" id="5075686">.</span><span class="ident" id="5075687">p</span><span class="op" id="5075688">.</span><span class="ident" id="5075689">ReadByte</span><span class="op" id="5075697">(</span><span class="ident" id="5075698">serialOutBuf</span>&nbsp;<span class="op" id="5075711">+</span>&nbsp;<span class="ident" id="5075713">tail</span><span class="op" id="5075717">%</span><span class="num" id="5075718">32</span><span class="op" id="5075720">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075723">tail</span><span class="op" id="5075727">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075731">s</span><span class="op" id="5075732">.</span><span class="ident" id="5075733">p</span><span class="op" id="5075734">.</span><span class="ident" id="5075735">WriteWord</span><span class="op" id="5075744">(</span><span class="ident" id="5075745">serialOutTail</span><span class="op" id="5075758">,</span>&nbsp;<span class="ident" id="5075760">tail</span><span class="op" id="5075764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075768">n</span><span class="op" id="5075769">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075773">thresh</span>&nbsp;<span class="op" id="5075780">:=</span>&nbsp;<span class="ident" id="5075783">s</span><span class="op" id="5075784">.</span><span class="ident" id="5075785">p</span><span class="op" id="5075786">.</span><span class="ident" id="5075787">ReadWord</span><span class="op" id="5075795">(</span><span class="ident" id="5075796">serialOutThresh</span><span class="op" id="5075811">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075814">if</span>&nbsp;<span class="ident" id="5075817">n</span>&nbsp;<span class="op" id="5075819">&lt;=</span>&nbsp;<span class="ident" id="5075822">thresh</span>&nbsp;<span class="op" id="5075829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075833">s</span><span class="op" id="5075834">.</span><span class="ident" id="5075835">interrupt</span><span class="op" id="5075844">(</span><span class="ident" id="5075845">s</span><span class="op" id="5075846">.</span><span class="ident" id="5075847">IntOut</span><span class="op" id="5075853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5075856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075860">return</span>&nbsp;<span class="ident" id="5075867">b</span><span class="op" id="5075868">,</span>&nbsp;<span class="builtintype" id="5075870">true</span><br>
<span class="lineno">135</span><span class="op" id="5075875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5075878">func</span>&nbsp;<span class="op" id="5075883">(</span><span class="ident" id="5075884">s</span>&nbsp;<span class="op" id="5075886">*</span><span class="ident" id="5075887">serial</span><span class="op" id="5075893">)</span>&nbsp;<span class="ident" id="5075895">countDown</span><span class="op" id="5075904">(</span><span class="op" id="5075905">)</span>&nbsp;<span class="op" id="5075907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075910">inWait</span>&nbsp;<span class="op" id="5075917">:=</span>&nbsp;<span class="ident" id="5075920">s</span><span class="op" id="5075921">.</span><span class="ident" id="5075922">p</span><span class="op" id="5075923">.</span><span class="ident" id="5075924">ReadWord</span><span class="op" id="5075932">(</span><span class="ident" id="5075933">serialInWait</span><span class="op" id="5075945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5075948">outWait</span>&nbsp;<span class="op" id="5075956">:=</span>&nbsp;<span class="ident" id="5075959">s</span><span class="op" id="5075960">.</span><span class="ident" id="5075961">p</span><span class="op" id="5075962">.</span><span class="ident" id="5075963">ReadWord</span><span class="op" id="5075971">(</span><span class="ident" id="5075972">serialOutWait</span><span class="op" id="5075985">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5075989">if</span>&nbsp;<span class="ident" id="5075992">inWait</span>&nbsp;<span class="op" id="5075999">&gt;</span>&nbsp;<span class="num" id="5076001">0</span>&nbsp;<span class="op" id="5076003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076007">inWait</span><span class="op" id="5076013">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076020">if</span>&nbsp;<span class="ident" id="5076023">outWait</span>&nbsp;<span class="op" id="5076031">&gt;</span>&nbsp;<span class="num" id="5076033">0</span>&nbsp;<span class="op" id="5076035">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076039">outWait</span><span class="op" id="5076046">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076054">if</span>&nbsp;<span class="ident" id="5076057">inWait</span>&nbsp;<span class="op" id="5076064">==</span>&nbsp;<span class="num" id="5076067">0</span>&nbsp;<span class="op" id="5076069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076073">if</span>&nbsp;<span class="ident" id="5076076">s</span><span class="op" id="5076077">.</span><span class="ident" id="5076078">InLen</span><span class="op" id="5076083">(</span><span class="op" id="5076084">)</span>&nbsp;<span class="op" id="5076086">&gt;</span>&nbsp;<span class="num" id="5076088">0</span>&nbsp;<span class="op" id="5076090">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076095">s</span><span class="op" id="5076096">.</span><span class="ident" id="5076097">interrupt</span><span class="op" id="5076106">(</span><span class="ident" id="5076107">s</span><span class="op" id="5076108">.</span><span class="ident" id="5076109">IntIn</span><span class="op" id="5076114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076125">if</span>&nbsp;<span class="ident" id="5076128">outWait</span>&nbsp;<span class="op" id="5076136">==</span>&nbsp;<span class="num" id="5076139">0</span>&nbsp;<span class="op" id="5076141">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076145">if</span>&nbsp;<span class="ident" id="5076148">s</span><span class="op" id="5076149">.</span><span class="ident" id="5076150">OutLen</span><span class="op" id="5076156">(</span><span class="op" id="5076157">)</span>&nbsp;<span class="op" id="5076159">&lt;</span>&nbsp;<span class="ident" id="5076161">serialCap</span>&nbsp;<span class="op" id="5076171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076176">s</span><span class="op" id="5076177">.</span><span class="ident" id="5076178">interrupt</span><span class="op" id="5076187">(</span><span class="ident" id="5076188">s</span><span class="op" id="5076189">.</span><span class="ident" id="5076190">IntOut</span><span class="op" id="5076196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076207">s</span><span class="op" id="5076208">.</span><span class="ident" id="5076209">p</span><span class="op" id="5076210">.</span><span class="ident" id="5076211">WriteWord</span><span class="op" id="5076220">(</span><span class="ident" id="5076221">serialInWait</span><span class="op" id="5076233">,</span>&nbsp;<span class="ident" id="5076235">inWait</span><span class="op" id="5076241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076244">s</span><span class="op" id="5076245">.</span><span class="ident" id="5076246">p</span><span class="op" id="5076247">.</span><span class="ident" id="5076248">WriteWord</span><span class="op" id="5076257">(</span><span class="ident" id="5076258">serialOutWait</span><span class="op" id="5076271">,</span>&nbsp;<span class="ident" id="5076273">outWait</span><span class="op" id="5076280">)</span><br>
<span class="lineno"></span><span class="op" id="5076282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5076285">func</span>&nbsp;<span class="op" id="5076290">(</span><span class="ident" id="5076291">s</span>&nbsp;<span class="op" id="5076293">*</span><span class="ident" id="5076294">serial</span><span class="op" id="5076300">)</span>&nbsp;<span class="ident" id="5076302">flush</span><span class="op" id="5076307">(</span><span class="op" id="5076308">)</span>&nbsp;<span class="op" id="5076310">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076313">buf</span>&nbsp;<span class="op" id="5076317">:=</span>&nbsp;<span class="builtinfunc" id="5076320">new</span><span class="op" id="5076323">(</span><span class="ident" id="5076324">bytes</span><span class="op" id="5076329">.</span><span class="ident" id="5076330">Buffer</span><span class="op" id="5076336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076339">for</span>&nbsp;<span class="op" id="5076343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076347">b</span><span class="op" id="5076348">,</span>&nbsp;<span class="ident" id="5076350">valid</span>&nbsp;<span class="op" id="5076356">:=</span>&nbsp;<span class="ident" id="5076359">s</span><span class="op" id="5076360">.</span><span class="ident" id="5076361">ReadByte</span><span class="op" id="5076369">(</span><span class="op" id="5076370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076374">if</span>&nbsp;<span class="ident" id="5076377">valid</span>&nbsp;<span class="op" id="5076383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076388">buf</span><span class="op" id="5076391">.</span><span class="ident" id="5076392">WriteByte</span><span class="op" id="5076401">(</span><span class="ident" id="5076402">b</span><span class="op" id="5076403">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076407">}</span>&nbsp;<span class="keyword" id="5076409">else</span>&nbsp;<span class="op" id="5076414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076419">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076434">if</span>&nbsp;<span class="ident" id="5076437">s</span><span class="op" id="5076438">.</span><span class="ident" id="5076439">Output</span>&nbsp;<span class="op" id="5076446">!=</span>&nbsp;<span class="ident" id="5076449">nil</span>&nbsp;<span class="op" id="5076453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076457">_</span><span class="op" id="5076458">,</span>&nbsp;<span class="ident" id="5076460">e</span>&nbsp;<span class="op" id="5076462">:=</span>&nbsp;<span class="ident" id="5076465">s</span><span class="op" id="5076466">.</span><span class="ident" id="5076467">Output</span><span class="op" id="5076473">.</span><span class="ident" id="5076474">Write</span><span class="op" id="5076479">(</span><span class="ident" id="5076480">buf</span><span class="op" id="5076483">.</span><span class="ident" id="5076484">Bytes</span><span class="op" id="5076489">(</span><span class="op" id="5076490">)</span><span class="op" id="5076491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5076495">if</span>&nbsp;<span class="ident" id="5076498">e</span>&nbsp;<span class="op" id="5076500">!=</span>&nbsp;<span class="ident" id="5076503">nil</span>&nbsp;<span class="op" id="5076507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076512">log</span><span class="op" id="5076515">.</span><span class="ident" id="5076516">Print</span><span class="op" id="5076521">(</span><span class="ident" id="5076522">e</span><span class="op" id="5076523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076527">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5076530">}</span><br>
<span class="lineno"></span><span class="op" id="5076532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5076535">//&nbsp;Tick&nbsp;counts&nbsp;down&nbsp;the&nbsp;waiting&nbsp;counters&nbsp;and&nbsp;triggers</span><br>
<span class="lineno"></span><span class="comment" id="5076589">//&nbsp;interrupt&nbsp;when&nbsp;the&nbsp;count&nbsp;down&nbsp;reaches&nbsp;zero.</span><br>
<span class="lineno">185</span><span class="keyword" id="5076636">func</span>&nbsp;<span class="op" id="5076641">(</span><span class="ident" id="5076642">s</span>&nbsp;<span class="op" id="5076644">*</span><span class="ident" id="5076645">serial</span><span class="op" id="5076651">)</span>&nbsp;<span class="ident" id="5076653">Tick</span><span class="op" id="5076657">(</span><span class="op" id="5076658">)</span>&nbsp;<span class="op" id="5076660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076663">s</span><span class="op" id="5076664">.</span><span class="ident" id="5076665">flush</span><span class="op" id="5076670">(</span><span class="op" id="5076671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5076674">s</span><span class="op" id="5076675">.</span><span class="ident" id="5076676">countDown</span><span class="op" id="5076685">(</span><span class="op" id="5076686">)</span><br>
<span class="lineno"></span><span class="op" id="5076688">}</span>
</div>
</body>
</html>
