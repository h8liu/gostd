<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2489024">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2489079">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2489133">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2489184">package</span>&nbsp;<span class="ident" id="2489192">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2489201">import</span>&nbsp;<span class="string" id="2489208">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2489214">//&nbsp;Replacer&nbsp;replaces&nbsp;a&nbsp;list&nbsp;of&nbsp;strings&nbsp;with&nbsp;replacements.</span><br>
<span class="lineno">10</span><span class="comment" id="2489272">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="2489329">type</span>&nbsp;<span class="ident" id="2489334">Replacer</span>&nbsp;<span class="keyword" id="2489343">struct</span>&nbsp;<span class="op" id="2489350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489353">r</span>&nbsp;<span class="ident" id="2489355"><a href="/strings/replace.go.html#2489450">replacer</a></span><br>
<span class="lineno"></span><span class="op" id="2489364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2489367">//&nbsp;replacer&nbsp;is&nbsp;the&nbsp;interface&nbsp;that&nbsp;a&nbsp;replacement&nbsp;algorithm&nbsp;needs&nbsp;to&nbsp;implement.</span><br>
<span class="lineno"></span><span class="keyword" id="2489445">type</span>&nbsp;<span class="ident" id="2489450">replacer</span>&nbsp;<span class="keyword" id="2489459">interface</span>&nbsp;<span class="op" id="2489469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489472">Replace</span><span class="op" id="2489479">(</span><span class="ident" id="2489480">s</span>&nbsp;<span class="builtintype" id="2489482">string</span><span class="op" id="2489488">)</span>&nbsp;<span class="builtintype" id="2489490">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489498">WriteString</span><span class="op" id="2489509">(</span><span class="ident" id="2489510">w</span>&nbsp;<span class="ident" id="2489512"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2489514">.</span><span class="ident" id="2489515">Writer</span><span class="op" id="2489521">,</span>&nbsp;<span class="ident" id="2489523">s</span>&nbsp;<span class="builtintype" id="2489525">string</span><span class="op" id="2489531">)</span>&nbsp;<span class="op" id="2489533">(</span><span class="ident" id="2489534">n</span>&nbsp;<span class="builtintype" id="2489536">int</span><span class="op" id="2489539">,</span>&nbsp;<span class="ident" id="2489541">err</span>&nbsp;<span class="builtintype" id="2489545">error</span><span class="op" id="2489550">)</span><br>
<span class="lineno"></span><span class="op" id="2489552">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2489555">//&nbsp;NewReplacer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Replacer&nbsp;from&nbsp;a&nbsp;list&nbsp;of&nbsp;old,&nbsp;new&nbsp;string&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="2489631">//&nbsp;Replacements&nbsp;are&nbsp;performed&nbsp;in&nbsp;order,&nbsp;without&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span><span class="keyword" id="2489700">func</span>&nbsp;<span class="ident" id="2489705">NewReplacer</span><span class="op" id="2489716">(</span><span class="ident" id="2489717">oldnew</span>&nbsp;<span class="op" id="2489724">...</span><span class="builtintype" id="2489727">string</span><span class="op" id="2489733">)</span>&nbsp;<span class="op" id="2489735">*</span><span class="ident" id="2489736"><a href="/strings/replace.go.html#2489334">Replacer</a></span>&nbsp;<span class="op" id="2489745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489748">if</span>&nbsp;<span class="builtinfunc" id="2489751">len</span><span class="op" id="2489754">(</span><span class="ident" id="2489755"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489761">)</span><span class="op" id="2489762">%</span><span class="num" id="2489763">2</span>&nbsp;<span class="op" id="2489765">==</span>&nbsp;<span class="num" id="2489768">1</span>&nbsp;<span class="op" id="2489770">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2489774">panic</span><span class="op" id="2489779">(</span><span class="string" id="2489780">&#34;strings.NewReplacer:&nbsp;odd&nbsp;argument&nbsp;count&#34;</span><span class="op" id="2489821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489828">if</span>&nbsp;<span class="builtinfunc" id="2489831">len</span><span class="op" id="2489834">(</span><span class="ident" id="2489835"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489841">)</span>&nbsp;<span class="op" id="2489843">==</span>&nbsp;<span class="num" id="2489846">2</span>&nbsp;<span class="op" id="2489848">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2489851">len</span><span class="op" id="2489854">(</span><span class="ident" id="2489855"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489861">[</span><span class="num" id="2489862">0</span><span class="op" id="2489863">]</span><span class="op" id="2489864">)</span>&nbsp;<span class="op" id="2489866">&gt;</span>&nbsp;<span class="num" id="2489868">1</span>&nbsp;<span class="op" id="2489870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489874">return</span>&nbsp;<span class="op" id="2489881">&amp;</span><span class="ident" id="2489882"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2489890">{</span><span class="ident" id="2489891">r</span><span class="op" id="2489892">:</span>&nbsp;<span class="ident" id="2489894"><a href="/strings/replace.go.html#2498690">makeSingleStringReplacer</a></span><span class="op" id="2489918">(</span><span class="ident" id="2489919"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489925">[</span><span class="num" id="2489926">0</span><span class="op" id="2489927">]</span><span class="op" id="2489928">,</span>&nbsp;<span class="ident" id="2489930"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489936">[</span><span class="num" id="2489937">1</span><span class="op" id="2489938">]</span><span class="op" id="2489939">)</span><span class="op" id="2489940">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2489943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2489947">allNewBytes</span>&nbsp;<span class="op" id="2489959">:=</span>&nbsp;<span class="builtintype" id="2489962">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2489968">for</span>&nbsp;<span class="ident" id="2489972">i</span>&nbsp;<span class="op" id="2489974">:=</span>&nbsp;<span class="num" id="2489977">0</span><span class="op" id="2489978">;</span>&nbsp;<span class="ident" id="2489980"><a href="/strings/replace.go.html#2489972">i</a></span>&nbsp;<span class="op" id="2489982">&lt;</span>&nbsp;<span class="builtinfunc" id="2489984">len</span><span class="op" id="2489987">(</span><span class="ident" id="2489988"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2489994">)</span><span class="op" id="2489995">;</span>&nbsp;<span class="ident" id="2489997"><a href="/strings/replace.go.html#2489972">i</a></span>&nbsp;<span class="op" id="2489999">+=</span>&nbsp;<span class="num" id="2490002">2</span>&nbsp;<span class="op" id="2490004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490008">if</span>&nbsp;<span class="builtinfunc" id="2490011">len</span><span class="op" id="2490014">(</span><span class="ident" id="2490015"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490021">[</span><span class="ident" id="2490022"><a href="/strings/replace.go.html#2489972">i</a></span><span class="op" id="2490023">]</span><span class="op" id="2490024">)</span>&nbsp;<span class="op" id="2490026">!=</span>&nbsp;<span class="num" id="2490029">1</span>&nbsp;<span class="op" id="2490031">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490036">return</span>&nbsp;<span class="op" id="2490043">&amp;</span><span class="ident" id="2490044"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2490052">{</span><span class="ident" id="2490053">r</span><span class="op" id="2490054">:</span>&nbsp;<span class="ident" id="2490056"><a href="/strings/replace.go.html#2495960">makeGenericReplacer</a></span><span class="op" id="2490075">(</span><span class="ident" id="2490076"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490082">)</span><span class="op" id="2490083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490091">if</span>&nbsp;<span class="builtinfunc" id="2490094">len</span><span class="op" id="2490097">(</span><span class="ident" id="2490098"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490104">[</span><span class="ident" id="2490105"><a href="/strings/replace.go.html#2489972">i</a></span><span class="op" id="2490106">+</span><span class="num" id="2490107">1</span><span class="op" id="2490108">]</span><span class="op" id="2490109">)</span>&nbsp;<span class="op" id="2490111">!=</span>&nbsp;<span class="num" id="2490114">1</span>&nbsp;<span class="op" id="2490116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490121"><a href="/strings/replace.go.html#2489947">allNewBytes</a></span>&nbsp;<span class="op" id="2490133">=</span>&nbsp;<span class="builtintype" id="2490135">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490143">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490150">if</span>&nbsp;<span class="ident" id="2490153"><a href="/strings/replace.go.html#2489947">allNewBytes</a></span>&nbsp;<span class="op" id="2490165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490169">r</span>&nbsp;<span class="op" id="2490171">:=</span>&nbsp;<span class="ident" id="2490174"><a href="/strings/replace.go.html#2499861">byteReplacer</a></span><span class="op" id="2490186">{</span><span class="op" id="2490187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490191">for</span>&nbsp;<span class="ident" id="2490195">i</span>&nbsp;<span class="op" id="2490197">:=</span>&nbsp;<span class="keyword" id="2490200">range</span>&nbsp;<span class="ident" id="2490206"><a href="/strings/replace.go.html#2490169">r</a></span>&nbsp;<span class="op" id="2490208">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490213"><a href="/strings/replace.go.html#2490169">r</a></span><span class="op" id="2490214">[</span><span class="ident" id="2490215"><a href="/strings/replace.go.html#2490195">i</a></span><span class="op" id="2490216">]</span>&nbsp;<span class="op" id="2490218">=</span>&nbsp;<span class="builtintype" id="2490220">byte</span><span class="op" id="2490224">(</span><span class="ident" id="2490225"><a href="/strings/replace.go.html#2490195">i</a></span><span class="op" id="2490226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490234">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490293">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490340">for</span>&nbsp;<span class="ident" id="2490344">i</span>&nbsp;<span class="op" id="2490346">:=</span>&nbsp;<span class="builtinfunc" id="2490349">len</span><span class="op" id="2490352">(</span><span class="ident" id="2490353"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490359">)</span>&nbsp;<span class="op" id="2490361">-</span>&nbsp;<span class="num" id="2490363">2</span><span class="op" id="2490364">;</span>&nbsp;<span class="ident" id="2490366"><a href="/strings/replace.go.html#2490344">i</a></span>&nbsp;<span class="op" id="2490368">&gt;=</span>&nbsp;<span class="num" id="2490371">0</span><span class="op" id="2490372">;</span>&nbsp;<span class="ident" id="2490374"><a href="/strings/replace.go.html#2490344">i</a></span>&nbsp;<span class="op" id="2490376">-=</span>&nbsp;<span class="num" id="2490379">2</span>&nbsp;<span class="op" id="2490381">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490386">o</span>&nbsp;<span class="op" id="2490388">:=</span>&nbsp;<span class="ident" id="2490391"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490397">[</span><span class="ident" id="2490398"><a href="/strings/replace.go.html#2490344">i</a></span><span class="op" id="2490399">]</span><span class="op" id="2490400">[</span><span class="num" id="2490401">0</span><span class="op" id="2490402">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490407">n</span>&nbsp;<span class="op" id="2490409">:=</span>&nbsp;<span class="ident" id="2490412"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490418">[</span><span class="ident" id="2490419"><a href="/strings/replace.go.html#2490344">i</a></span><span class="op" id="2490420">+</span><span class="num" id="2490421">1</span><span class="op" id="2490422">]</span><span class="op" id="2490423">[</span><span class="num" id="2490424">0</span><span class="op" id="2490425">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490430"><a href="/strings/replace.go.html#2490169">r</a></span><span class="op" id="2490431">[</span><span class="ident" id="2490432"><a href="/strings/replace.go.html#2490386">o</a></span><span class="op" id="2490433">]</span>&nbsp;<span class="op" id="2490435">=</span>&nbsp;<span class="ident" id="2490437"><a href="/strings/replace.go.html#2490407">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490445">return</span>&nbsp;<span class="op" id="2490452">&amp;</span><span class="ident" id="2490453"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2490461">{</span><span class="ident" id="2490462">r</span><span class="op" id="2490463">:</span>&nbsp;<span class="op" id="2490465">&amp;</span><span class="ident" id="2490466"><a href="/strings/replace.go.html#2490169">r</a></span><span class="op" id="2490467">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490474">r</span>&nbsp;<span class="op" id="2490476">:=</span>&nbsp;<span class="ident" id="2490479"><a href="/strings/replace.go.html#2500906">byteStringReplacer</a></span><span class="op" id="2490497">{</span><span class="op" id="2490498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490501">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2490559">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490605">for</span>&nbsp;<span class="ident" id="2490609">i</span>&nbsp;<span class="op" id="2490611">:=</span>&nbsp;<span class="builtinfunc" id="2490614">len</span><span class="op" id="2490617">(</span><span class="ident" id="2490618"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490624">)</span>&nbsp;<span class="op" id="2490626">-</span>&nbsp;<span class="num" id="2490628">2</span><span class="op" id="2490629">;</span>&nbsp;<span class="ident" id="2490631"><a href="/strings/replace.go.html#2490609">i</a></span>&nbsp;<span class="op" id="2490633">&gt;=</span>&nbsp;<span class="num" id="2490636">0</span><span class="op" id="2490637">;</span>&nbsp;<span class="ident" id="2490639"><a href="/strings/replace.go.html#2490609">i</a></span>&nbsp;<span class="op" id="2490641">-=</span>&nbsp;<span class="num" id="2490644">2</span>&nbsp;<span class="op" id="2490646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490650">o</span>&nbsp;<span class="op" id="2490652">:=</span>&nbsp;<span class="ident" id="2490655"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490661">[</span><span class="ident" id="2490662"><a href="/strings/replace.go.html#2490609">i</a></span><span class="op" id="2490663">]</span><span class="op" id="2490664">[</span><span class="num" id="2490665">0</span><span class="op" id="2490666">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490670">n</span>&nbsp;<span class="op" id="2490672">:=</span>&nbsp;<span class="ident" id="2490675"><a href="/strings/replace.go.html#2489717">oldnew</a></span><span class="op" id="2490681">[</span><span class="ident" id="2490682"><a href="/strings/replace.go.html#2490609">i</a></span><span class="op" id="2490683">+</span><span class="num" id="2490684">1</span><span class="op" id="2490685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2490689"><a href="/strings/replace.go.html#2490474">r</a></span><span class="op" id="2490690">[</span><span class="ident" id="2490691"><a href="/strings/replace.go.html#2490650">o</a></span><span class="op" id="2490692">]</span>&nbsp;<span class="op" id="2490694">=</span>&nbsp;<span class="op" id="2490696">[</span><span class="op" id="2490697">]</span><span class="builtintype" id="2490698">byte</span><span class="op" id="2490702">(</span><span class="ident" id="2490703"><a href="/strings/replace.go.html#2490670">n</a></span><span class="op" id="2490704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2490707">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490710">return</span>&nbsp;<span class="op" id="2490717">&amp;</span><span class="ident" id="2490718"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2490726">{</span><span class="ident" id="2490727">r</span><span class="op" id="2490728">:</span>&nbsp;<span class="op" id="2490730">&amp;</span><span class="ident" id="2490731"><a href="/strings/replace.go.html#2490474">r</a></span><span class="op" id="2490732">}</span><br>
<span class="lineno"></span><span class="op" id="2490734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2490737">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2490801">func</span>&nbsp;<span class="op" id="2490806">(</span><span class="ident" id="2490807">r</span>&nbsp;<span class="op" id="2490809">*</span><span class="ident" id="2490810"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2490818">)</span>&nbsp;<span class="ident" id="2490820">Replace</span><span class="op" id="2490827">(</span><span class="ident" id="2490828">s</span>&nbsp;<span class="builtintype" id="2490830">string</span><span class="op" id="2490836">)</span>&nbsp;<span class="builtintype" id="2490838">string</span>&nbsp;<span class="op" id="2490845">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2490848">return</span>&nbsp;<span class="ident" id="2490855"><a href="/strings/replace.go.html#2490807">r</a></span><span class="op" id="2490856">.</span><span class="ident" id="2490857">r</span><span class="op" id="2490858">.</span><span class="ident" id="2490859">Replace</span><span class="op" id="2490866">(</span><span class="ident" id="2490867"><a href="/strings/replace.go.html#2490828">s</a></span><span class="op" id="2490868">)</span><br>
<span class="lineno"></span><span class="op" id="2490870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2490873">//&nbsp;WriteString&nbsp;writes&nbsp;s&nbsp;to&nbsp;w&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2490935">func</span>&nbsp;<span class="op" id="2490940">(</span><span class="ident" id="2490941">r</span>&nbsp;<span class="op" id="2490943">*</span><span class="ident" id="2490944"><a href="/strings/replace.go.html#2489334">Replacer</a></span><span class="op" id="2490952">)</span>&nbsp;<span class="ident" id="2490954">WriteString</span><span class="op" id="2490965">(</span><span class="ident" id="2490966">w</span>&nbsp;<span class="ident" id="2490968"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2490970">.</span><span class="ident" id="2490971">Writer</span><span class="op" id="2490977">,</span>&nbsp;<span class="ident" id="2490979">s</span>&nbsp;<span class="builtintype" id="2490981">string</span><span class="op" id="2490987">)</span>&nbsp;<span class="op" id="2490989">(</span><span class="ident" id="2490990">n</span>&nbsp;<span class="builtintype" id="2490992">int</span><span class="op" id="2490995">,</span>&nbsp;<span class="ident" id="2490997">err</span>&nbsp;<span class="builtintype" id="2491001">error</span><span class="op" id="2491006">)</span>&nbsp;<span class="op" id="2491008">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2491011">return</span>&nbsp;<span class="ident" id="2491018"><a href="/strings/replace.go.html#2490941">r</a></span><span class="op" id="2491019">.</span><span class="ident" id="2491020">r</span><span class="op" id="2491021">.</span><span class="ident" id="2491022">WriteString</span><span class="op" id="2491033">(</span><span class="ident" id="2491034"><a href="/strings/replace.go.html#2490966">w</a></span><span class="op" id="2491035">,</span>&nbsp;<span class="ident" id="2491037"><a href="/strings/replace.go.html#2490979">s</a></span><span class="op" id="2491038">)</span><br>
<span class="lineno"></span><span class="op" id="2491040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2491043">//&nbsp;trieNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;a&nbsp;lookup&nbsp;trie&nbsp;for&nbsp;prioritized&nbsp;key/value&nbsp;pairs.&nbsp;Keys</span><br>
<span class="lineno"></span><span class="comment" id="2491120">//&nbsp;and&nbsp;values&nbsp;may&nbsp;be&nbsp;empty.&nbsp;For&nbsp;example,&nbsp;the&nbsp;trie&nbsp;containing&nbsp;keys&nbsp;&#34;ax&#34;,&nbsp;&#34;ay&#34;,</span><br>
<span class="lineno">80</span><span class="comment" id="2491198">//&nbsp;&#34;bcbc&#34;,&nbsp;&#34;x&#34;&nbsp;and&nbsp;&#34;xy&#34;&nbsp;could&nbsp;have&nbsp;eight&nbsp;nodes:</span><br>
<span class="lineno"></span><span class="comment" id="2491246">//</span><br>
<span class="lineno"></span><span class="comment" id="2491249">//&nbsp;&nbsp;n0&nbsp;&nbsp;-</span><br>
<span class="lineno"></span><span class="comment" id="2491259">//&nbsp;&nbsp;n1&nbsp;&nbsp;a-</span><br>
<span class="lineno"></span><span class="comment" id="2491270">//&nbsp;&nbsp;n2&nbsp;&nbsp;.x+</span><br>
<span class="lineno">85</span><span class="comment" id="2491282">//&nbsp;&nbsp;n3&nbsp;&nbsp;.y+</span><br>
<span class="lineno"></span><span class="comment" id="2491294">//&nbsp;&nbsp;n4&nbsp;&nbsp;b-</span><br>
<span class="lineno"></span><span class="comment" id="2491305">//&nbsp;&nbsp;n5&nbsp;&nbsp;.cbc+</span><br>
<span class="lineno"></span><span class="comment" id="2491319">//&nbsp;&nbsp;n6&nbsp;&nbsp;x+</span><br>
<span class="lineno"></span><span class="comment" id="2491330">//&nbsp;&nbsp;n7&nbsp;&nbsp;.y+</span><br>
<span class="lineno">90</span><span class="comment" id="2491342">//</span><br>
<span class="lineno"></span><span class="comment" id="2491345">//&nbsp;n0&nbsp;is&nbsp;the&nbsp;root&nbsp;node,&nbsp;and&nbsp;its&nbsp;children&nbsp;are&nbsp;n1,&nbsp;n4&nbsp;and&nbsp;n6;&nbsp;n1&#39;s&nbsp;children&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2491423">//&nbsp;n2&nbsp;and&nbsp;n3;&nbsp;n4&#39;s&nbsp;child&nbsp;is&nbsp;n5;&nbsp;n6&#39;s&nbsp;child&nbsp;is&nbsp;n7.&nbsp;Nodes&nbsp;n0,&nbsp;n1&nbsp;and&nbsp;n4&nbsp;(marked</span><br>
<span class="lineno"></span><span class="comment" id="2491501">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;-&#34;)&nbsp;are&nbsp;partial&nbsp;keys,&nbsp;and&nbsp;nodes&nbsp;n2,&nbsp;n3,&nbsp;n5,&nbsp;n6&nbsp;and&nbsp;n7</span><br>
<span class="lineno"></span><span class="comment" id="2491575">//&nbsp;(marked&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;)&nbsp;are&nbsp;complete&nbsp;keys.</span><br>
<span class="lineno">95</span><span class="keyword" id="2491626">type</span>&nbsp;<span class="ident" id="2491631">trieNode</span>&nbsp;<span class="keyword" id="2491640">struct</span>&nbsp;<span class="op" id="2491647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491650">//&nbsp;value&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s&nbsp;key/value&nbsp;pair.&nbsp;It&nbsp;is&nbsp;empty&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491723">//&nbsp;this&nbsp;node&nbsp;is&nbsp;not&nbsp;a&nbsp;complete&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2491760">value</span>&nbsp;<span class="builtintype" id="2491766">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491774">//&nbsp;priority&nbsp;is&nbsp;the&nbsp;priority&nbsp;(higher&nbsp;is&nbsp;more&nbsp;important)&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491849">//&nbsp;key/value&nbsp;pair;&nbsp;keys&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;matched&nbsp;shortest-&nbsp;or&nbsp;longest-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491924">//&nbsp;first.&nbsp;Priority&nbsp;is&nbsp;positive&nbsp;if&nbsp;this&nbsp;node&nbsp;is&nbsp;a&nbsp;complete&nbsp;key,&nbsp;and&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2491997">//&nbsp;otherwise.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;positive/zero&nbsp;priorities&nbsp;are&nbsp;marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492070">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;&nbsp;or&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492102">priority</span>&nbsp;<span class="builtintype" id="2492111">int</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492117">//&nbsp;A&nbsp;trie&nbsp;node&nbsp;may&nbsp;have&nbsp;zero,&nbsp;one&nbsp;or&nbsp;more&nbsp;child&nbsp;nodes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492173">//&nbsp;&nbsp;*&nbsp;if&nbsp;the&nbsp;remaining&nbsp;fields&nbsp;are&nbsp;zero,&nbsp;there&nbsp;are&nbsp;no&nbsp;children.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492237">//&nbsp;&nbsp;*&nbsp;if&nbsp;prefix&nbsp;and&nbsp;next&nbsp;are&nbsp;non-zero,&nbsp;there&nbsp;is&nbsp;one&nbsp;child&nbsp;in&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492305">//&nbsp;&nbsp;*&nbsp;if&nbsp;table&nbsp;is&nbsp;non-zero,&nbsp;it&nbsp;defines&nbsp;all&nbsp;the&nbsp;children.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492363">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492367">//&nbsp;Prefixes&nbsp;are&nbsp;preferred&nbsp;over&nbsp;tables&nbsp;when&nbsp;there&nbsp;is&nbsp;one&nbsp;child,&nbsp;but&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492439">//&nbsp;root&nbsp;node&nbsp;always&nbsp;uses&nbsp;a&nbsp;table&nbsp;for&nbsp;lookup&nbsp;efficiency.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492497">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;difference&nbsp;in&nbsp;keys&nbsp;between&nbsp;this&nbsp;trie&nbsp;node&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492571">//&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;node&nbsp;n4&nbsp;has&nbsp;prefix&nbsp;&#34;cbc&#34;&nbsp;and&nbsp;n4&#39;s&nbsp;next&nbsp;node&nbsp;is&nbsp;n5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492648">//&nbsp;Node&nbsp;n5&nbsp;has&nbsp;no&nbsp;children&nbsp;and&nbsp;so&nbsp;has&nbsp;zero&nbsp;prefix,&nbsp;next&nbsp;and&nbsp;table&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492723">prefix</span>&nbsp;<span class="builtintype" id="2492730">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2492738">next</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2492745">*</span><span class="ident" id="2492746"><a href="/strings/replace.go.html#2491631">trieNode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492757">//&nbsp;table&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;indexed&nbsp;by&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;key,&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492828">//&nbsp;remapping&nbsp;that&nbsp;byte&nbsp;through&nbsp;genericReplacer.mapping&nbsp;to&nbsp;create&nbsp;a&nbsp;dense</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492902">//&nbsp;index.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;the&nbsp;keys&nbsp;only&nbsp;use&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;,&nbsp;&#39;c&#39;,&nbsp;&#39;x&#39;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2492976">//&nbsp;&#39;y&#39;,&nbsp;which&nbsp;remap&nbsp;to&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3&nbsp;and&nbsp;4.&nbsp;All&nbsp;other&nbsp;bytes&nbsp;remap&nbsp;to&nbsp;5,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493050">//&nbsp;genericReplacer.tableSize&nbsp;will&nbsp;be&nbsp;5.&nbsp;Node&nbsp;n0&#39;s&nbsp;table&nbsp;will&nbsp;be</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493115">//&nbsp;[]*trieNode{&nbsp;0:n1,&nbsp;1:n4,&nbsp;3:n6&nbsp;},&nbsp;where&nbsp;the&nbsp;0,&nbsp;1&nbsp;and&nbsp;3&nbsp;are&nbsp;the&nbsp;remapped</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493190">//&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;&nbsp;and&nbsp;&#39;x&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493212">table</span>&nbsp;<span class="op" id="2493218">[</span><span class="op" id="2493219">]</span><span class="op" id="2493220">*</span><span class="ident" id="2493221"><a href="/strings/replace.go.html#2491631">trieNode</a></span><br>
<span class="lineno"></span><span class="op" id="2493230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2493233">func</span>&nbsp;<span class="op" id="2493238">(</span><span class="ident" id="2493239">t</span>&nbsp;<span class="op" id="2493241">*</span><span class="ident" id="2493242"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2493250">)</span>&nbsp;<span class="ident" id="2493252">add</span><span class="op" id="2493255">(</span><span class="ident" id="2493256">key</span><span class="op" id="2493259">,</span>&nbsp;<span class="ident" id="2493261">val</span>&nbsp;<span class="builtintype" id="2493265">string</span><span class="op" id="2493271">,</span>&nbsp;<span class="ident" id="2493273">priority</span>&nbsp;<span class="builtintype" id="2493282">int</span><span class="op" id="2493285">,</span>&nbsp;<span class="ident" id="2493287">r</span>&nbsp;<span class="op" id="2493289">*</span><span class="ident" id="2493290"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span><span class="op" id="2493305">)</span>&nbsp;<span class="op" id="2493307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493310">if</span>&nbsp;<span class="ident" id="2493313"><a href="/strings/replace.go.html#2493256">key</a></span>&nbsp;<span class="op" id="2493317">==</span>&nbsp;<span class="string" id="2493320">&#34;&#34;</span>&nbsp;<span class="op" id="2493323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493327">if</span>&nbsp;<span class="ident" id="2493330"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493331">.</span><span class="ident" id="2493332">priority</span>&nbsp;<span class="op" id="2493341">==</span>&nbsp;<span class="num" id="2493344">0</span>&nbsp;<span class="op" id="2493346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493351"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493352">.</span><span class="ident" id="2493353">value</span>&nbsp;<span class="op" id="2493359">=</span>&nbsp;<span class="ident" id="2493361"><a href="/strings/replace.go.html#2493261">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493368"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493369">.</span><span class="ident" id="2493370">priority</span>&nbsp;<span class="op" id="2493379">=</span>&nbsp;<span class="ident" id="2493381"><a href="/strings/replace.go.html#2493273">priority</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493408">if</span>&nbsp;<span class="ident" id="2493411"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493412">.</span><span class="ident" id="2493413">prefix</span>&nbsp;<span class="op" id="2493420">!=</span>&nbsp;<span class="string" id="2493423">&#34;&#34;</span>&nbsp;<span class="op" id="2493426">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493430">//&nbsp;Need&nbsp;to&nbsp;split&nbsp;the&nbsp;prefix&nbsp;among&nbsp;multiple&nbsp;nodes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493482">var</span>&nbsp;<span class="ident" id="2493486">n</span>&nbsp;<span class="builtintype" id="2493488">int</span>&nbsp;<span class="comment" id="2493492">//&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493533">for</span>&nbsp;<span class="op" id="2493537">;</span>&nbsp;<span class="ident" id="2493539"><a href="/strings/replace.go.html#2493486">n</a></span>&nbsp;<span class="op" id="2493541">&lt;</span>&nbsp;<span class="builtinfunc" id="2493543">len</span><span class="op" id="2493546">(</span><span class="ident" id="2493547"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493548">.</span><span class="ident" id="2493549">prefix</span><span class="op" id="2493555">)</span>&nbsp;<span class="op" id="2493557">&amp;&amp;</span>&nbsp;<span class="ident" id="2493560"><a href="/strings/replace.go.html#2493486">n</a></span>&nbsp;<span class="op" id="2493562">&lt;</span>&nbsp;<span class="builtinfunc" id="2493564">len</span><span class="op" id="2493567">(</span><span class="ident" id="2493568"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2493571">)</span><span class="op" id="2493572">;</span>&nbsp;<span class="ident" id="2493574"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2493575">++</span>&nbsp;<span class="op" id="2493578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493583">if</span>&nbsp;<span class="ident" id="2493586"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493587">.</span><span class="ident" id="2493588">prefix</span><span class="op" id="2493594">[</span><span class="ident" id="2493595"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2493596">]</span>&nbsp;<span class="op" id="2493598">!=</span>&nbsp;<span class="ident" id="2493601"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2493604">[</span><span class="ident" id="2493605"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2493606">]</span>&nbsp;<span class="op" id="2493608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493614">break</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493631">if</span>&nbsp;<span class="ident" id="2493634"><a href="/strings/replace.go.html#2493486">n</a></span>&nbsp;<span class="op" id="2493636">==</span>&nbsp;<span class="builtinfunc" id="2493639">len</span><span class="op" id="2493642">(</span><span class="ident" id="2493643"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493644">.</span><span class="ident" id="2493645">prefix</span><span class="op" id="2493651">)</span>&nbsp;<span class="op" id="2493653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493658"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493659">.</span><span class="ident" id="2493660">next</span><span class="op" id="2493664">.</span><span class="ident" id="2493665">add</span><span class="op" id="2493668">(</span><span class="ident" id="2493669"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2493672">[</span><span class="ident" id="2493673"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2493674">:</span><span class="op" id="2493675">]</span><span class="op" id="2493676">,</span>&nbsp;<span class="ident" id="2493678"><a href="/strings/replace.go.html#2493261">val</a></span><span class="op" id="2493681">,</span>&nbsp;<span class="ident" id="2493683"><a href="/strings/replace.go.html#2493273">priority</a></span><span class="op" id="2493691">,</span>&nbsp;<span class="ident" id="2493693"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2493694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493698">}</span>&nbsp;<span class="keyword" id="2493700">else</span>&nbsp;<span class="keyword" id="2493705">if</span>&nbsp;<span class="ident" id="2493708"><a href="/strings/replace.go.html#2493486">n</a></span>&nbsp;<span class="op" id="2493710">==</span>&nbsp;<span class="num" id="2493713">0</span>&nbsp;<span class="op" id="2493715">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493720">//&nbsp;First&nbsp;byte&nbsp;differs,&nbsp;start&nbsp;a&nbsp;new&nbsp;lookup&nbsp;table&nbsp;here.&nbsp;Looking&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493788">//&nbsp;what&nbsp;is&nbsp;currently&nbsp;t.prefix[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;prefixNode,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2493853">//&nbsp;looking&nbsp;up&nbsp;key[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;keyNode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493899">var</span>&nbsp;<span class="ident" id="2493903">prefixNode</span>&nbsp;<span class="op" id="2493914">*</span><span class="ident" id="2493915"><a href="/strings/replace.go.html#2491631">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2493927">if</span>&nbsp;<span class="builtinfunc" id="2493930">len</span><span class="op" id="2493933">(</span><span class="ident" id="2493934"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493935">.</span><span class="ident" id="2493936">prefix</span><span class="op" id="2493942">)</span>&nbsp;<span class="op" id="2493944">==</span>&nbsp;<span class="num" id="2493947">1</span>&nbsp;<span class="op" id="2493949">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493955"><a href="/strings/replace.go.html#2493903">prefixNode</a></span>&nbsp;<span class="op" id="2493966">=</span>&nbsp;<span class="ident" id="2493968"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2493969">.</span><span class="ident" id="2493970">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2493978">}</span>&nbsp;<span class="keyword" id="2493980">else</span>&nbsp;<span class="op" id="2493985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2493991"><a href="/strings/replace.go.html#2493903">prefixNode</a></span>&nbsp;<span class="op" id="2494002">=</span>&nbsp;<span class="op" id="2494004">&amp;</span><span class="ident" id="2494005"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494020">prefix</span><span class="op" id="2494026">:</span>&nbsp;<span class="ident" id="2494028"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494029">.</span><span class="ident" id="2494030">prefix</span><span class="op" id="2494036">[</span><span class="num" id="2494037">1</span><span class="op" id="2494038">:</span><span class="op" id="2494039">]</span><span class="op" id="2494040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494047">next</span><span class="op" id="2494051">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2494055"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494056">.</span><span class="ident" id="2494057">next</span><span class="op" id="2494061">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494077">keyNode</span>&nbsp;<span class="op" id="2494085">:=</span>&nbsp;<span class="builtinfunc" id="2494088">new</span><span class="op" id="2494091">(</span><span class="ident" id="2494092"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494105"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494106">.</span><span class="ident" id="2494107">table</span>&nbsp;<span class="op" id="2494113">=</span>&nbsp;<span class="builtinfunc" id="2494115">make</span><span class="op" id="2494119">(</span><span class="op" id="2494120">[</span><span class="op" id="2494121">]</span><span class="op" id="2494122">*</span><span class="ident" id="2494123"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494131">,</span>&nbsp;<span class="ident" id="2494133"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494134">.</span><span class="ident" id="2494135">tableSize</span><span class="op" id="2494144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494149"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494150">.</span><span class="ident" id="2494151">table</span><span class="op" id="2494156">[</span><span class="ident" id="2494157"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494158">.</span><span class="ident" id="2494159">mapping</span><span class="op" id="2494166">[</span><span class="ident" id="2494167"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494168">.</span><span class="ident" id="2494169">prefix</span><span class="op" id="2494175">[</span><span class="num" id="2494176">0</span><span class="op" id="2494177">]</span><span class="op" id="2494178">]</span><span class="op" id="2494179">]</span>&nbsp;<span class="op" id="2494181">=</span>&nbsp;<span class="ident" id="2494183"><a href="/strings/replace.go.html#2493903">prefixNode</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494197"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494198">.</span><span class="ident" id="2494199">table</span><span class="op" id="2494204">[</span><span class="ident" id="2494205"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494206">.</span><span class="ident" id="2494207">mapping</span><span class="op" id="2494214">[</span><span class="ident" id="2494215"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2494218">[</span><span class="num" id="2494219">0</span><span class="op" id="2494220">]</span><span class="op" id="2494221">]</span><span class="op" id="2494222">]</span>&nbsp;<span class="op" id="2494224">=</span>&nbsp;<span class="ident" id="2494226"><a href="/strings/replace.go.html#2494077">keyNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494237"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494238">.</span><span class="ident" id="2494239">prefix</span>&nbsp;<span class="op" id="2494246">=</span>&nbsp;<span class="string" id="2494248">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494254"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494255">.</span><span class="ident" id="2494256">next</span>&nbsp;<span class="op" id="2494261">=</span>&nbsp;<span class="ident" id="2494263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494270"><a href="/strings/replace.go.html#2494077">keyNode</a></span><span class="op" id="2494277">.</span><span class="ident" id="2494278">add</span><span class="op" id="2494281">(</span><span class="ident" id="2494282"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2494285">[</span><span class="num" id="2494286">1</span><span class="op" id="2494287">:</span><span class="op" id="2494288">]</span><span class="op" id="2494289">,</span>&nbsp;<span class="ident" id="2494291"><a href="/strings/replace.go.html#2493261">val</a></span><span class="op" id="2494294">,</span>&nbsp;<span class="ident" id="2494296"><a href="/strings/replace.go.html#2493273">priority</a></span><span class="op" id="2494304">,</span>&nbsp;<span class="ident" id="2494306"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494311">}</span>&nbsp;<span class="keyword" id="2494313">else</span>&nbsp;<span class="op" id="2494318">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2494323">//&nbsp;Insert&nbsp;new&nbsp;node&nbsp;after&nbsp;the&nbsp;common&nbsp;section&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494385">next</span>&nbsp;<span class="op" id="2494390">:=</span>&nbsp;<span class="op" id="2494393">&amp;</span><span class="ident" id="2494394"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494408">prefix</span><span class="op" id="2494414">:</span>&nbsp;<span class="ident" id="2494416"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494417">.</span><span class="ident" id="2494418">prefix</span><span class="op" id="2494424">[</span><span class="ident" id="2494425"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2494426">:</span><span class="op" id="2494427">]</span><span class="op" id="2494428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494434">next</span><span class="op" id="2494438">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2494442"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494443">.</span><span class="ident" id="2494444">next</span><span class="op" id="2494448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494453">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494458"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494459">.</span><span class="ident" id="2494460">prefix</span>&nbsp;<span class="op" id="2494467">=</span>&nbsp;<span class="ident" id="2494469"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494470">.</span><span class="ident" id="2494471">prefix</span><span class="op" id="2494477">[</span><span class="op" id="2494478">:</span><span class="ident" id="2494479"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2494480">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494485"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494486">.</span><span class="ident" id="2494487">next</span>&nbsp;<span class="op" id="2494492">=</span>&nbsp;<span class="ident" id="2494494"><a href="/strings/replace.go.html#2494385">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494502"><a href="/strings/replace.go.html#2494385">next</a></span><span class="op" id="2494506">.</span><span class="ident" id="2494507">add</span><span class="op" id="2494510">(</span><span class="ident" id="2494511"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2494514">[</span><span class="ident" id="2494515"><a href="/strings/replace.go.html#2493486">n</a></span><span class="op" id="2494516">:</span><span class="op" id="2494517">]</span><span class="op" id="2494518">,</span>&nbsp;<span class="ident" id="2494520"><a href="/strings/replace.go.html#2493261">val</a></span><span class="op" id="2494523">,</span>&nbsp;<span class="ident" id="2494525"><a href="/strings/replace.go.html#2493273">priority</a></span><span class="op" id="2494533">,</span>&nbsp;<span class="ident" id="2494535"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494543">}</span>&nbsp;<span class="keyword" id="2494545">else</span>&nbsp;<span class="keyword" id="2494550">if</span>&nbsp;<span class="ident" id="2494553"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494554">.</span><span class="ident" id="2494555">table</span>&nbsp;<span class="op" id="2494561">!=</span>&nbsp;<span class="ident" id="2494564">nil</span>&nbsp;<span class="op" id="2494568">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2494572">//&nbsp;Insert&nbsp;into&nbsp;existing&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494605">m</span>&nbsp;<span class="op" id="2494607">:=</span>&nbsp;<span class="ident" id="2494610"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494611">.</span><span class="ident" id="2494612">mapping</span><span class="op" id="2494619">[</span><span class="ident" id="2494620"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2494623">[</span><span class="num" id="2494624">0</span><span class="op" id="2494625">]</span><span class="op" id="2494626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2494630">if</span>&nbsp;<span class="ident" id="2494633"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494634">.</span><span class="ident" id="2494635">table</span><span class="op" id="2494640">[</span><span class="ident" id="2494641"><a href="/strings/replace.go.html#2494605">m</a></span><span class="op" id="2494642">]</span>&nbsp;<span class="op" id="2494644">==</span>&nbsp;<span class="ident" id="2494647">nil</span>&nbsp;<span class="op" id="2494651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494656"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494657">.</span><span class="ident" id="2494658">table</span><span class="op" id="2494663">[</span><span class="ident" id="2494664"><a href="/strings/replace.go.html#2494605">m</a></span><span class="op" id="2494665">]</span>&nbsp;<span class="op" id="2494667">=</span>&nbsp;<span class="builtinfunc" id="2494669">new</span><span class="op" id="2494672">(</span><span class="ident" id="2494673"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494685">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494689"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494690">.</span><span class="ident" id="2494691">table</span><span class="op" id="2494696">[</span><span class="ident" id="2494697"><a href="/strings/replace.go.html#2494605">m</a></span><span class="op" id="2494698">]</span><span class="op" id="2494699">.</span><span class="ident" id="2494700">add</span><span class="op" id="2494703">(</span><span class="ident" id="2494704"><a href="/strings/replace.go.html#2493256">key</a></span><span class="op" id="2494707">[</span><span class="num" id="2494708">1</span><span class="op" id="2494709">:</span><span class="op" id="2494710">]</span><span class="op" id="2494711">,</span>&nbsp;<span class="ident" id="2494713"><a href="/strings/replace.go.html#2493261">val</a></span><span class="op" id="2494716">,</span>&nbsp;<span class="ident" id="2494718"><a href="/strings/replace.go.html#2493273">priority</a></span><span class="op" id="2494726">,</span>&nbsp;<span class="ident" id="2494728"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494732">}</span>&nbsp;<span class="keyword" id="2494734">else</span>&nbsp;<span class="op" id="2494739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494743"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494744">.</span><span class="ident" id="2494745">prefix</span>&nbsp;<span class="op" id="2494752">=</span>&nbsp;<span class="ident" id="2494754"><a href="/strings/replace.go.html#2493256">key</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494760"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494761">.</span><span class="ident" id="2494762">next</span>&nbsp;<span class="op" id="2494767">=</span>&nbsp;<span class="builtinfunc" id="2494769">new</span><span class="op" id="2494772">(</span><span class="ident" id="2494773"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2494781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2494785"><a href="/strings/replace.go.html#2493239">t</a></span><span class="op" id="2494786">.</span><span class="ident" id="2494787">next</span><span class="op" id="2494791">.</span><span class="ident" id="2494792">add</span><span class="op" id="2494795">(</span><span class="string" id="2494796">&#34;&#34;</span><span class="op" id="2494798">,</span>&nbsp;<span class="ident" id="2494800"><a href="/strings/replace.go.html#2493261">val</a></span><span class="op" id="2494803">,</span>&nbsp;<span class="ident" id="2494805"><a href="/strings/replace.go.html#2493273">priority</a></span><span class="op" id="2494813">,</span>&nbsp;<span class="ident" id="2494815"><a href="/strings/replace.go.html#2493287">r</a></span><span class="op" id="2494816">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2494819">}</span><br>
<span class="lineno"></span><span class="op" id="2494821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2494824">func</span>&nbsp;<span class="op" id="2494829">(</span><span class="ident" id="2494830">r</span>&nbsp;<span class="op" id="2494832">*</span><span class="ident" id="2494833"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span><span class="op" id="2494848">)</span>&nbsp;<span class="ident" id="2494850">lookup</span><span class="op" id="2494856">(</span><span class="ident" id="2494857">s</span>&nbsp;<span class="builtintype" id="2494859">string</span><span class="op" id="2494865">,</span>&nbsp;<span class="ident" id="2494867">ignoreRoot</span>&nbsp;<span class="builtintype" id="2494878">bool</span><span class="op" id="2494882">)</span>&nbsp;<span class="op" id="2494884">(</span><span class="ident" id="2494885">val</span>&nbsp;<span class="builtintype" id="2494889">string</span><span class="op" id="2494895">,</span>&nbsp;<span class="ident" id="2494897">keylen</span>&nbsp;<span class="builtintype" id="2494904">int</span><span class="op" id="2494907">,</span>&nbsp;<span class="ident" id="2494909">found</span>&nbsp;<span class="builtintype" id="2494915">bool</span><span class="op" id="2494919">)</span>&nbsp;<span class="op" id="2494921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2494924">//&nbsp;Iterate&nbsp;down&nbsp;the&nbsp;trie&nbsp;to&nbsp;the&nbsp;end,&nbsp;and&nbsp;grab&nbsp;the&nbsp;value&nbsp;and&nbsp;keylen&nbsp;with</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2494997">//&nbsp;the&nbsp;highest&nbsp;priority.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495023">bestPriority</span>&nbsp;<span class="op" id="2495036">:=</span>&nbsp;<span class="num" id="2495039">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495042">node</span>&nbsp;<span class="op" id="2495047">:=</span>&nbsp;<span class="op" id="2495050">&amp;</span><span class="ident" id="2495051"><a href="/strings/replace.go.html#2494830">r</a></span><span class="op" id="2495052">.</span><span class="ident" id="2495053">root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495059">n</span>&nbsp;<span class="op" id="2495061">:=</span>&nbsp;<span class="num" id="2495064">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495067">for</span>&nbsp;<span class="ident" id="2495071"><a href="/strings/replace.go.html#2495042">node</a></span>&nbsp;<span class="op" id="2495076">!=</span>&nbsp;<span class="ident" id="2495079">nil</span>&nbsp;<span class="op" id="2495083">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495087">if</span>&nbsp;<span class="ident" id="2495090"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495094">.</span><span class="ident" id="2495095">priority</span>&nbsp;<span class="op" id="2495104">&gt;</span>&nbsp;<span class="ident" id="2495106"><a href="/strings/replace.go.html#2495023">bestPriority</a></span>&nbsp;<span class="op" id="2495119">&amp;&amp;</span>&nbsp;<span class="op" id="2495122">!</span><span class="op" id="2495123">(</span><span class="ident" id="2495124"><a href="/strings/replace.go.html#2494867">ignoreRoot</a></span>&nbsp;<span class="op" id="2495135">&amp;&amp;</span>&nbsp;<span class="ident" id="2495138"><a href="/strings/replace.go.html#2495042">node</a></span>&nbsp;<span class="op" id="2495143">==</span>&nbsp;<span class="op" id="2495146">&amp;</span><span class="ident" id="2495147"><a href="/strings/replace.go.html#2494830">r</a></span><span class="op" id="2495148">.</span><span class="ident" id="2495149">root</span><span class="op" id="2495153">)</span>&nbsp;<span class="op" id="2495155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495160"><a href="/strings/replace.go.html#2495023">bestPriority</a></span>&nbsp;<span class="op" id="2495173">=</span>&nbsp;<span class="ident" id="2495175"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495179">.</span><span class="ident" id="2495180">priority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495192"><a href="/strings/replace.go.html#2494885">val</a></span>&nbsp;<span class="op" id="2495196">=</span>&nbsp;<span class="ident" id="2495198"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495202">.</span><span class="ident" id="2495203">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495212"><a href="/strings/replace.go.html#2494897">keylen</a></span>&nbsp;<span class="op" id="2495219">=</span>&nbsp;<span class="ident" id="2495221"><a href="/strings/replace.go.html#2495059">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495226"><a href="/strings/replace.go.html#2494909">found</a></span>&nbsp;<span class="op" id="2495232">=</span>&nbsp;<span class="builtintype" id="2495234">true</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495246">if</span>&nbsp;<span class="ident" id="2495249"><a href="/strings/replace.go.html#2494857">s</a></span>&nbsp;<span class="op" id="2495251">==</span>&nbsp;<span class="string" id="2495254">&#34;&#34;</span>&nbsp;<span class="op" id="2495257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495262">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495270">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495274">if</span>&nbsp;<span class="ident" id="2495277"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495281">.</span><span class="ident" id="2495282">table</span>&nbsp;<span class="op" id="2495288">!=</span>&nbsp;<span class="ident" id="2495291">nil</span>&nbsp;<span class="op" id="2495295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495300">index</span>&nbsp;<span class="op" id="2495306">:=</span>&nbsp;<span class="ident" id="2495309"><a href="/strings/replace.go.html#2494830">r</a></span><span class="op" id="2495310">.</span><span class="ident" id="2495311">mapping</span><span class="op" id="2495318">[</span><span class="ident" id="2495319"><a href="/strings/replace.go.html#2494857">s</a></span><span class="op" id="2495320">[</span><span class="num" id="2495321">0</span><span class="op" id="2495322">]</span><span class="op" id="2495323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495328">if</span>&nbsp;<span class="builtintype" id="2495331">int</span><span class="op" id="2495334">(</span><span class="ident" id="2495335"><a href="/strings/replace.go.html#2495300">index</a></span><span class="op" id="2495340">)</span>&nbsp;<span class="op" id="2495342">==</span>&nbsp;<span class="ident" id="2495345"><a href="/strings/replace.go.html#2494830">r</a></span><span class="op" id="2495346">.</span><span class="ident" id="2495347">tableSize</span>&nbsp;<span class="op" id="2495357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495363">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495372">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495377"><a href="/strings/replace.go.html#2495042">node</a></span>&nbsp;<span class="op" id="2495382">=</span>&nbsp;<span class="ident" id="2495384"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495388">.</span><span class="ident" id="2495389">table</span><span class="op" id="2495394">[</span><span class="ident" id="2495395"><a href="/strings/replace.go.html#2495300">index</a></span><span class="op" id="2495400">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495405"><a href="/strings/replace.go.html#2494857">s</a></span>&nbsp;<span class="op" id="2495407">=</span>&nbsp;<span class="ident" id="2495409"><a href="/strings/replace.go.html#2494857">s</a></span><span class="op" id="2495410">[</span><span class="num" id="2495411">1</span><span class="op" id="2495412">:</span><span class="op" id="2495413">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495418"><a href="/strings/replace.go.html#2495059">n</a></span><span class="op" id="2495419">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495424">}</span>&nbsp;<span class="keyword" id="2495426">else</span>&nbsp;<span class="keyword" id="2495431">if</span>&nbsp;<span class="ident" id="2495434"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495438">.</span><span class="ident" id="2495439">prefix</span>&nbsp;<span class="op" id="2495446">!=</span>&nbsp;<span class="string" id="2495449">&#34;&#34;</span>&nbsp;<span class="op" id="2495452">&amp;&amp;</span>&nbsp;<span class="ident" id="2495455"><a href="/strings/strings.go.html#2516015">HasPrefix</a></span><span class="op" id="2495464">(</span><span class="ident" id="2495465"><a href="/strings/replace.go.html#2494857">s</a></span><span class="op" id="2495466">,</span>&nbsp;<span class="ident" id="2495468"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495472">.</span><span class="ident" id="2495473">prefix</span><span class="op" id="2495479">)</span>&nbsp;<span class="op" id="2495481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495486"><a href="/strings/replace.go.html#2495059">n</a></span>&nbsp;<span class="op" id="2495488">+=</span>&nbsp;<span class="builtinfunc" id="2495491">len</span><span class="op" id="2495494">(</span><span class="ident" id="2495495"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495499">.</span><span class="ident" id="2495500">prefix</span><span class="op" id="2495506">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495511"><a href="/strings/replace.go.html#2494857">s</a></span>&nbsp;<span class="op" id="2495513">=</span>&nbsp;<span class="ident" id="2495515"><a href="/strings/replace.go.html#2494857">s</a></span><span class="op" id="2495516">[</span><span class="builtinfunc" id="2495517">len</span><span class="op" id="2495520">(</span><span class="ident" id="2495521"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495525">.</span><span class="ident" id="2495526">prefix</span><span class="op" id="2495532">)</span><span class="op" id="2495533">:</span><span class="op" id="2495534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495539"><a href="/strings/replace.go.html#2495042">node</a></span>&nbsp;<span class="op" id="2495544">=</span>&nbsp;<span class="ident" id="2495546"><a href="/strings/replace.go.html#2495042">node</a></span><span class="op" id="2495550">.</span><span class="ident" id="2495551">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495558">}</span>&nbsp;<span class="keyword" id="2495560">else</span>&nbsp;<span class="op" id="2495565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495570">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495578">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2495581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2495584">return</span><br>
<span class="lineno"></span><span class="op" id="2495591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2495594">//&nbsp;genericReplacer&nbsp;is&nbsp;the&nbsp;fully&nbsp;generic&nbsp;algorithm.</span><br>
<span class="lineno">230</span><span class="comment" id="2495645">//&nbsp;It&#39;s&nbsp;used&nbsp;as&nbsp;a&nbsp;fallback&nbsp;when&nbsp;nothing&nbsp;faster&nbsp;can&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2495705">type</span>&nbsp;<span class="ident" id="2495710">genericReplacer</span>&nbsp;<span class="keyword" id="2495726">struct</span>&nbsp;<span class="op" id="2495733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495736">root</span>&nbsp;<span class="ident" id="2495741"><a href="/strings/replace.go.html#2491631">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2495751">//&nbsp;tableSize&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;trie&nbsp;node&#39;s&nbsp;lookup&nbsp;table.&nbsp;It&nbsp;is&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2495825">//&nbsp;of&nbsp;unique&nbsp;key&nbsp;bytes.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495850">tableSize</span>&nbsp;<span class="builtintype" id="2495860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2495865">//&nbsp;mapping&nbsp;maps&nbsp;from&nbsp;key&nbsp;bytes&nbsp;to&nbsp;a&nbsp;dense&nbsp;index&nbsp;for&nbsp;trieNode.table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2495934">mapping</span>&nbsp;<span class="op" id="2495942">[</span><span class="num" id="2495943">256</span><span class="op" id="2495946">]</span><span class="builtintype" id="2495947">byte</span><br>
<span class="lineno"></span><span class="op" id="2495952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="2495955">func</span>&nbsp;<span class="ident" id="2495960">makeGenericReplacer</span><span class="op" id="2495979">(</span><span class="ident" id="2495980">oldnew</span>&nbsp;<span class="op" id="2495987">[</span><span class="op" id="2495988">]</span><span class="builtintype" id="2495989">string</span><span class="op" id="2495995">)</span>&nbsp;<span class="op" id="2495997">*</span><span class="ident" id="2495998"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span>&nbsp;<span class="op" id="2496014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496017">r</span>&nbsp;<span class="op" id="2496019">:=</span>&nbsp;<span class="builtinfunc" id="2496022">new</span><span class="op" id="2496025">(</span><span class="ident" id="2496026"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span><span class="op" id="2496041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2496044">//&nbsp;Find&nbsp;each&nbsp;byte&nbsp;used,&nbsp;then&nbsp;assign&nbsp;them&nbsp;each&nbsp;an&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496101">for</span>&nbsp;<span class="ident" id="2496105">i</span>&nbsp;<span class="op" id="2496107">:=</span>&nbsp;<span class="num" id="2496110">0</span><span class="op" id="2496111">;</span>&nbsp;<span class="ident" id="2496113"><a href="/strings/replace.go.html#2496105">i</a></span>&nbsp;<span class="op" id="2496115">&lt;</span>&nbsp;<span class="builtinfunc" id="2496117">len</span><span class="op" id="2496120">(</span><span class="ident" id="2496121"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496127">)</span><span class="op" id="2496128">;</span>&nbsp;<span class="ident" id="2496130"><a href="/strings/replace.go.html#2496105">i</a></span>&nbsp;<span class="op" id="2496132">+=</span>&nbsp;<span class="num" id="2496135">2</span>&nbsp;<span class="op" id="2496137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496141">key</span>&nbsp;<span class="op" id="2496145">:=</span>&nbsp;<span class="ident" id="2496148"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496154">[</span><span class="ident" id="2496155"><a href="/strings/replace.go.html#2496105">i</a></span><span class="op" id="2496156">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496160">for</span>&nbsp;<span class="ident" id="2496164">j</span>&nbsp;<span class="op" id="2496166">:=</span>&nbsp;<span class="num" id="2496169">0</span><span class="op" id="2496170">;</span>&nbsp;<span class="ident" id="2496172"><a href="/strings/replace.go.html#2496164">j</a></span>&nbsp;<span class="op" id="2496174">&lt;</span>&nbsp;<span class="builtinfunc" id="2496176">len</span><span class="op" id="2496179">(</span><span class="ident" id="2496180"><a href="/strings/replace.go.html#2496141">key</a></span><span class="op" id="2496183">)</span><span class="op" id="2496184">;</span>&nbsp;<span class="ident" id="2496186"><a href="/strings/replace.go.html#2496164">j</a></span><span class="op" id="2496187">++</span>&nbsp;<span class="op" id="2496190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496195"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496196">.</span><span class="ident" id="2496197">mapping</span><span class="op" id="2496204">[</span><span class="ident" id="2496205"><a href="/strings/replace.go.html#2496141">key</a></span><span class="op" id="2496208">[</span><span class="ident" id="2496209"><a href="/strings/replace.go.html#2496164">j</a></span><span class="op" id="2496210">]</span><span class="op" id="2496211">]</span>&nbsp;<span class="op" id="2496213">=</span>&nbsp;<span class="num" id="2496215">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496226">for</span>&nbsp;<span class="ident" id="2496230">_</span><span class="op" id="2496231">,</span>&nbsp;<span class="ident" id="2496233">b</span>&nbsp;<span class="op" id="2496235">:=</span>&nbsp;<span class="keyword" id="2496238">range</span>&nbsp;<span class="ident" id="2496244"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496245">.</span><span class="ident" id="2496246">mapping</span>&nbsp;<span class="op" id="2496254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496258"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496259">.</span><span class="ident" id="2496260">tableSize</span>&nbsp;<span class="op" id="2496270">+=</span>&nbsp;<span class="builtintype" id="2496273">int</span><span class="op" id="2496276">(</span><span class="ident" id="2496277"><a href="/strings/replace.go.html#2496233">b</a></span><span class="op" id="2496278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496285">var</span>&nbsp;<span class="ident" id="2496289">index</span>&nbsp;<span class="builtintype" id="2496295">byte</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496301">for</span>&nbsp;<span class="ident" id="2496305">i</span><span class="op" id="2496306">,</span>&nbsp;<span class="ident" id="2496308">b</span>&nbsp;<span class="op" id="2496310">:=</span>&nbsp;<span class="keyword" id="2496313">range</span>&nbsp;<span class="ident" id="2496319"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496320">.</span><span class="ident" id="2496321">mapping</span>&nbsp;<span class="op" id="2496329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496333">if</span>&nbsp;<span class="ident" id="2496336"><a href="/strings/replace.go.html#2496308">b</a></span>&nbsp;<span class="op" id="2496338">==</span>&nbsp;<span class="num" id="2496341">0</span>&nbsp;<span class="op" id="2496343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496348"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496349">.</span><span class="ident" id="2496350">mapping</span><span class="op" id="2496357">[</span><span class="ident" id="2496358"><a href="/strings/replace.go.html#2496305">i</a></span><span class="op" id="2496359">]</span>&nbsp;<span class="op" id="2496361">=</span>&nbsp;<span class="builtintype" id="2496363">byte</span><span class="op" id="2496367">(</span><span class="ident" id="2496368"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496369">.</span><span class="ident" id="2496370">tableSize</span><span class="op" id="2496379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496383">}</span>&nbsp;<span class="keyword" id="2496385">else</span>&nbsp;<span class="op" id="2496390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496395"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496396">.</span><span class="ident" id="2496397">mapping</span><span class="op" id="2496404">[</span><span class="ident" id="2496405"><a href="/strings/replace.go.html#2496305">i</a></span><span class="op" id="2496406">]</span>&nbsp;<span class="op" id="2496408">=</span>&nbsp;<span class="ident" id="2496410"><a href="/strings/replace.go.html#2496289">index</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496419"><a href="/strings/replace.go.html#2496289">index</a></span><span class="op" id="2496424">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2496435">//&nbsp;Ensure&nbsp;root&nbsp;node&nbsp;uses&nbsp;a&nbsp;lookup&nbsp;table&nbsp;(for&nbsp;performance).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496495"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496496">.</span><span class="ident" id="2496497">root</span><span class="op" id="2496501">.</span><span class="ident" id="2496502">table</span>&nbsp;<span class="op" id="2496508">=</span>&nbsp;<span class="builtinfunc" id="2496510">make</span><span class="op" id="2496514">(</span><span class="op" id="2496515">[</span><span class="op" id="2496516">]</span><span class="op" id="2496517">*</span><span class="ident" id="2496518"><a href="/strings/replace.go.html#2491631">trieNode</a></span><span class="op" id="2496526">,</span>&nbsp;<span class="ident" id="2496528"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496529">.</span><span class="ident" id="2496530">tableSize</span><span class="op" id="2496539">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496543">for</span>&nbsp;<span class="ident" id="2496547">i</span>&nbsp;<span class="op" id="2496549">:=</span>&nbsp;<span class="num" id="2496552">0</span><span class="op" id="2496553">;</span>&nbsp;<span class="ident" id="2496555"><a href="/strings/replace.go.html#2496547">i</a></span>&nbsp;<span class="op" id="2496557">&lt;</span>&nbsp;<span class="builtinfunc" id="2496559">len</span><span class="op" id="2496562">(</span><span class="ident" id="2496563"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496569">)</span><span class="op" id="2496570">;</span>&nbsp;<span class="ident" id="2496572"><a href="/strings/replace.go.html#2496547">i</a></span>&nbsp;<span class="op" id="2496574">+=</span>&nbsp;<span class="num" id="2496577">2</span>&nbsp;<span class="op" id="2496579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2496583"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496584">.</span><span class="ident" id="2496585">root</span><span class="op" id="2496589">.</span><span class="ident" id="2496590">add</span><span class="op" id="2496593">(</span><span class="ident" id="2496594"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496600">[</span><span class="ident" id="2496601"><a href="/strings/replace.go.html#2496547">i</a></span><span class="op" id="2496602">]</span><span class="op" id="2496603">,</span>&nbsp;<span class="ident" id="2496605"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496611">[</span><span class="ident" id="2496612"><a href="/strings/replace.go.html#2496547">i</a></span><span class="op" id="2496613">+</span><span class="num" id="2496614">1</span><span class="op" id="2496615">]</span><span class="op" id="2496616">,</span>&nbsp;<span class="builtinfunc" id="2496618">len</span><span class="op" id="2496621">(</span><span class="ident" id="2496622"><a href="/strings/replace.go.html#2495980">oldnew</a></span><span class="op" id="2496628">)</span><span class="op" id="2496629">-</span><span class="ident" id="2496630"><a href="/strings/replace.go.html#2496547">i</a></span><span class="op" id="2496631">,</span>&nbsp;<span class="ident" id="2496633"><a href="/strings/replace.go.html#2496017">r</a></span><span class="op" id="2496634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496640">return</span>&nbsp;<span class="ident" id="2496647"><a href="/strings/replace.go.html#2496017">r</a></span><br>
<span class="lineno">270</span><span class="op" id="2496649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2496652">type</span>&nbsp;<span class="ident" id="2496657">appendSliceWriter</span>&nbsp;<span class="op" id="2496675">[</span><span class="op" id="2496676">]</span><span class="builtintype" id="2496677">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2496683">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;to&nbsp;satisfy&nbsp;io.Writer.</span><br>
<span class="lineno">275</span><span class="keyword" id="2496735">func</span>&nbsp;<span class="op" id="2496740">(</span><span class="ident" id="2496741">w</span>&nbsp;<span class="op" id="2496743">*</span><span class="ident" id="2496744"><a href="/strings/replace.go.html#2496657">appendSliceWriter</a></span><span class="op" id="2496761">)</span>&nbsp;<span class="ident" id="2496763">Write</span><span class="op" id="2496768">(</span><span class="ident" id="2496769">p</span>&nbsp;<span class="op" id="2496771">[</span><span class="op" id="2496772">]</span><span class="builtintype" id="2496773">byte</span><span class="op" id="2496777">)</span>&nbsp;<span class="op" id="2496779">(</span><span class="builtintype" id="2496780">int</span><span class="op" id="2496783">,</span>&nbsp;<span class="builtintype" id="2496785">error</span><span class="op" id="2496790">)</span>&nbsp;<span class="op" id="2496792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496795">*</span><span class="ident" id="2496796"><a href="/strings/replace.go.html#2496741">w</a></span>&nbsp;<span class="op" id="2496798">=</span>&nbsp;<span class="builtinfunc" id="2496800">append</span><span class="op" id="2496806">(</span><span class="op" id="2496807">*</span><span class="ident" id="2496808"><a href="/strings/replace.go.html#2496741">w</a></span><span class="op" id="2496809">,</span>&nbsp;<span class="ident" id="2496811"><a href="/strings/replace.go.html#2496769">p</a></span><span class="op" id="2496812">...</span><span class="op" id="2496815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2496818">return</span>&nbsp;<span class="builtinfunc" id="2496825">len</span><span class="op" id="2496828">(</span><span class="ident" id="2496829"><a href="/strings/replace.go.html#2496769">p</a></span><span class="op" id="2496830">)</span><span class="op" id="2496831">,</span>&nbsp;<span class="ident" id="2496833">nil</span><br>
<span class="lineno"></span><span class="op" id="2496837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="comment" id="2496840">//&nbsp;WriteString&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;without&nbsp;string-&gt;[]byte-&gt;string&nbsp;allocations.</span><br>
<span class="lineno"></span><span class="keyword" id="2496920">func</span>&nbsp;<span class="op" id="2496925">(</span><span class="ident" id="2496926">w</span>&nbsp;<span class="op" id="2496928">*</span><span class="ident" id="2496929"><a href="/strings/replace.go.html#2496657">appendSliceWriter</a></span><span class="op" id="2496946">)</span>&nbsp;<span class="ident" id="2496948">WriteString</span><span class="op" id="2496959">(</span><span class="ident" id="2496960">s</span>&nbsp;<span class="builtintype" id="2496962">string</span><span class="op" id="2496968">)</span>&nbsp;<span class="op" id="2496970">(</span><span class="builtintype" id="2496971">int</span><span class="op" id="2496974">,</span>&nbsp;<span class="builtintype" id="2496976">error</span><span class="op" id="2496981">)</span>&nbsp;<span class="op" id="2496983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2496986">*</span><span class="ident" id="2496987"><a href="/strings/replace.go.html#2496926">w</a></span>&nbsp;<span class="op" id="2496989">=</span>&nbsp;<span class="builtinfunc" id="2496991">append</span><span class="op" id="2496997">(</span><span class="op" id="2496998">*</span><span class="ident" id="2496999"><a href="/strings/replace.go.html#2496926">w</a></span><span class="op" id="2497000">,</span>&nbsp;<span class="ident" id="2497002"><a href="/strings/replace.go.html#2496960">s</a></span><span class="op" id="2497003">...</span><span class="op" id="2497006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497009">return</span>&nbsp;<span class="builtinfunc" id="2497016">len</span><span class="op" id="2497019">(</span><span class="ident" id="2497020"><a href="/strings/replace.go.html#2496960">s</a></span><span class="op" id="2497021">)</span><span class="op" id="2497022">,</span>&nbsp;<span class="ident" id="2497024">nil</span><br>
<span class="lineno"></span><span class="op" id="2497028">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="2497031">type</span>&nbsp;<span class="ident" id="2497036">stringWriterIface</span>&nbsp;<span class="keyword" id="2497054">interface</span>&nbsp;<span class="op" id="2497064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497067">WriteString</span><span class="op" id="2497078">(</span><span class="builtintype" id="2497079">string</span><span class="op" id="2497085">)</span>&nbsp;<span class="op" id="2497087">(</span><span class="builtintype" id="2497088">int</span><span class="op" id="2497091">,</span>&nbsp;<span class="builtintype" id="2497093">error</span><span class="op" id="2497098">)</span><br>
<span class="lineno"></span><span class="op" id="2497100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="2497103">type</span>&nbsp;<span class="ident" id="2497108">stringWriter</span>&nbsp;<span class="keyword" id="2497121">struct</span>&nbsp;<span class="op" id="2497128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497131">w</span>&nbsp;<span class="ident" id="2497133"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2497135">.</span><span class="ident" id="2497136">Writer</span><br>
<span class="lineno"></span><span class="op" id="2497143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2497146">func</span>&nbsp;<span class="op" id="2497151">(</span><span class="ident" id="2497152">w</span>&nbsp;<span class="ident" id="2497154"><a href="/strings/replace.go.html#2497108">stringWriter</a></span><span class="op" id="2497166">)</span>&nbsp;<span class="ident" id="2497168">WriteString</span><span class="op" id="2497179">(</span><span class="ident" id="2497180">s</span>&nbsp;<span class="builtintype" id="2497182">string</span><span class="op" id="2497188">)</span>&nbsp;<span class="op" id="2497190">(</span><span class="builtintype" id="2497191">int</span><span class="op" id="2497194">,</span>&nbsp;<span class="builtintype" id="2497196">error</span><span class="op" id="2497201">)</span>&nbsp;<span class="op" id="2497203">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497206">return</span>&nbsp;<span class="ident" id="2497213"><a href="/strings/replace.go.html#2497152">w</a></span><span class="op" id="2497214">.</span><span class="ident" id="2497215">w</span><span class="op" id="2497216">.</span><span class="ident" id="2497217">Write</span><span class="op" id="2497222">(</span><span class="op" id="2497223">[</span><span class="op" id="2497224">]</span><span class="builtintype" id="2497225">byte</span><span class="op" id="2497229">(</span><span class="ident" id="2497230"><a href="/strings/replace.go.html#2497180">s</a></span><span class="op" id="2497231">)</span><span class="op" id="2497232">)</span><br>
<span class="lineno"></span><span class="op" id="2497234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2497237">func</span>&nbsp;<span class="ident" id="2497242">getStringWriter</span><span class="op" id="2497257">(</span><span class="ident" id="2497258">w</span>&nbsp;<span class="ident" id="2497260"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2497262">.</span><span class="ident" id="2497263">Writer</span><span class="op" id="2497269">)</span>&nbsp;<span class="ident" id="2497271"><a href="/strings/replace.go.html#2497036">stringWriterIface</a></span>&nbsp;<span class="op" id="2497289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497292">sw</span><span class="op" id="2497294">,</span>&nbsp;<span class="ident" id="2497296">ok</span>&nbsp;<span class="op" id="2497299">:=</span>&nbsp;<span class="ident" id="2497302"><a href="/strings/replace.go.html#2497258">w</a></span><span class="op" id="2497303">.</span><span class="op" id="2497304">(</span><span class="ident" id="2497305"><a href="/strings/replace.go.html#2497036">stringWriterIface</a></span><span class="op" id="2497322">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497325">if</span>&nbsp;<span class="op" id="2497328">!</span><span class="ident" id="2497329"><a href="/strings/replace.go.html#2497296">ok</a></span>&nbsp;<span class="op" id="2497332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497336"><a href="/strings/replace.go.html#2497292">sw</a></span>&nbsp;<span class="op" id="2497339">=</span>&nbsp;<span class="ident" id="2497341"><a href="/strings/replace.go.html#2497108">stringWriter</a></span><span class="op" id="2497353">{</span><span class="ident" id="2497354"><a href="/strings/replace.go.html#2497258">w</a></span><span class="op" id="2497355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2497358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497361">return</span>&nbsp;<span class="ident" id="2497368"><a href="/strings/replace.go.html#2497292">sw</a></span><br>
<span class="lineno"></span><span class="op" id="2497371">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="2497374">func</span>&nbsp;<span class="op" id="2497379">(</span><span class="ident" id="2497380">r</span>&nbsp;<span class="op" id="2497382">*</span><span class="ident" id="2497383"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span><span class="op" id="2497398">)</span>&nbsp;<span class="ident" id="2497400">Replace</span><span class="op" id="2497407">(</span><span class="ident" id="2497408">s</span>&nbsp;<span class="builtintype" id="2497410">string</span><span class="op" id="2497416">)</span>&nbsp;<span class="builtintype" id="2497418">string</span>&nbsp;<span class="op" id="2497425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497428">buf</span>&nbsp;<span class="op" id="2497432">:=</span>&nbsp;<span class="builtinfunc" id="2497435">make</span><span class="op" id="2497439">(</span><span class="ident" id="2497440"><a href="/strings/replace.go.html#2496657">appendSliceWriter</a></span><span class="op" id="2497457">,</span>&nbsp;<span class="num" id="2497459">0</span><span class="op" id="2497460">,</span>&nbsp;<span class="builtinfunc" id="2497462">len</span><span class="op" id="2497465">(</span><span class="ident" id="2497466"><a href="/strings/replace.go.html#2497408">s</a></span><span class="op" id="2497467">)</span><span class="op" id="2497468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497471"><a href="/strings/replace.go.html#2497380">r</a></span><span class="op" id="2497472">.</span><span class="ident" id="2497473">WriteString</span><span class="op" id="2497484">(</span><span class="op" id="2497485">&amp;</span><span class="ident" id="2497486"><a href="/strings/replace.go.html#2497428">buf</a></span><span class="op" id="2497489">,</span>&nbsp;<span class="ident" id="2497491"><a href="/strings/replace.go.html#2497408">s</a></span><span class="op" id="2497492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497495">return</span>&nbsp;<span class="builtintype" id="2497502">string</span><span class="op" id="2497508">(</span><span class="ident" id="2497509"><a href="/strings/replace.go.html#2497428">buf</a></span><span class="op" id="2497512">)</span><br>
<span class="lineno">310</span><span class="op" id="2497514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2497517">func</span>&nbsp;<span class="op" id="2497522">(</span><span class="ident" id="2497523">r</span>&nbsp;<span class="op" id="2497525">*</span><span class="ident" id="2497526"><a href="/strings/replace.go.html#2495710">genericReplacer</a></span><span class="op" id="2497541">)</span>&nbsp;<span class="ident" id="2497543">WriteString</span><span class="op" id="2497554">(</span><span class="ident" id="2497555">w</span>&nbsp;<span class="ident" id="2497557"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2497559">.</span><span class="ident" id="2497560">Writer</span><span class="op" id="2497566">,</span>&nbsp;<span class="ident" id="2497568">s</span>&nbsp;<span class="builtintype" id="2497570">string</span><span class="op" id="2497576">)</span>&nbsp;<span class="op" id="2497578">(</span><span class="ident" id="2497579">n</span>&nbsp;<span class="builtintype" id="2497581">int</span><span class="op" id="2497584">,</span>&nbsp;<span class="ident" id="2497586">err</span>&nbsp;<span class="builtintype" id="2497590">error</span><span class="op" id="2497595">)</span>&nbsp;<span class="op" id="2497597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497600">sw</span>&nbsp;<span class="op" id="2497603">:=</span>&nbsp;<span class="ident" id="2497606"><a href="/strings/replace.go.html#2497242">getStringWriter</a></span><span class="op" id="2497621">(</span><span class="ident" id="2497622"><a href="/strings/replace.go.html#2497555">w</a></span><span class="op" id="2497623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497626">var</span>&nbsp;<span class="ident" id="2497630">last</span><span class="op" id="2497634">,</span>&nbsp;<span class="ident" id="2497636">wn</span>&nbsp;<span class="builtintype" id="2497639">int</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497644">var</span>&nbsp;<span class="ident" id="2497648">prevMatchEmpty</span>&nbsp;<span class="builtintype" id="2497663">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497669">for</span>&nbsp;<span class="ident" id="2497673">i</span>&nbsp;<span class="op" id="2497675">:=</span>&nbsp;<span class="num" id="2497678">0</span><span class="op" id="2497679">;</span>&nbsp;<span class="ident" id="2497681"><a href="/strings/replace.go.html#2497673">i</a></span>&nbsp;<span class="op" id="2497683">&lt;=</span>&nbsp;<span class="builtinfunc" id="2497686">len</span><span class="op" id="2497689">(</span><span class="ident" id="2497690"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2497691">)</span><span class="op" id="2497692">;</span>&nbsp;<span class="op" id="2497694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2497698">//&nbsp;Fast&nbsp;path:&nbsp;s[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix&nbsp;of&nbsp;any&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497751">if</span>&nbsp;<span class="ident" id="2497754"><a href="/strings/replace.go.html#2497673">i</a></span>&nbsp;<span class="op" id="2497756">!=</span>&nbsp;<span class="builtinfunc" id="2497759">len</span><span class="op" id="2497762">(</span><span class="ident" id="2497763"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2497764">)</span>&nbsp;<span class="op" id="2497766">&amp;&amp;</span>&nbsp;<span class="ident" id="2497769"><a href="/strings/replace.go.html#2497523">r</a></span><span class="op" id="2497770">.</span><span class="ident" id="2497771">root</span><span class="op" id="2497775">.</span><span class="ident" id="2497776">priority</span>&nbsp;<span class="op" id="2497785">==</span>&nbsp;<span class="num" id="2497788">0</span>&nbsp;<span class="op" id="2497790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497795">index</span>&nbsp;<span class="op" id="2497801">:=</span>&nbsp;<span class="builtintype" id="2497804">int</span><span class="op" id="2497807">(</span><span class="ident" id="2497808"><a href="/strings/replace.go.html#2497523">r</a></span><span class="op" id="2497809">.</span><span class="ident" id="2497810">mapping</span><span class="op" id="2497817">[</span><span class="ident" id="2497818"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2497819">[</span><span class="ident" id="2497820"><a href="/strings/replace.go.html#2497673">i</a></span><span class="op" id="2497821">]</span><span class="op" id="2497822">]</span><span class="op" id="2497823">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497828">if</span>&nbsp;<span class="ident" id="2497831"><a href="/strings/replace.go.html#2497795">index</a></span>&nbsp;<span class="op" id="2497837">==</span>&nbsp;<span class="ident" id="2497840"><a href="/strings/replace.go.html#2497523">r</a></span><span class="op" id="2497841">.</span><span class="ident" id="2497842">tableSize</span>&nbsp;<span class="op" id="2497852">||</span>&nbsp;<span class="ident" id="2497855"><a href="/strings/replace.go.html#2497523">r</a></span><span class="op" id="2497856">.</span><span class="ident" id="2497857">root</span><span class="op" id="2497861">.</span><span class="ident" id="2497862">table</span><span class="op" id="2497867">[</span><span class="ident" id="2497868"><a href="/strings/replace.go.html#2497795">index</a></span><span class="op" id="2497873">]</span>&nbsp;<span class="op" id="2497875">==</span>&nbsp;<span class="ident" id="2497878">nil</span>&nbsp;<span class="op" id="2497882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497888"><a href="/strings/replace.go.html#2497673">i</a></span><span class="op" id="2497889">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2497896">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2497908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2497912">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2497917">//&nbsp;Ignore&nbsp;the&nbsp;empty&nbsp;match&nbsp;iff&nbsp;the&nbsp;previous&nbsp;loop&nbsp;found&nbsp;the&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2497990">val</span><span class="op" id="2497993">,</span>&nbsp;<span class="ident" id="2497995">keylen</span><span class="op" id="2498001">,</span>&nbsp;<span class="ident" id="2498003">match</span>&nbsp;<span class="op" id="2498009">:=</span>&nbsp;<span class="ident" id="2498012"><a href="/strings/replace.go.html#2497523">r</a></span><span class="op" id="2498013">.</span><span class="ident" id="2498014">lookup</span><span class="op" id="2498020">(</span><span class="ident" id="2498021"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2498022">[</span><span class="ident" id="2498023"><a href="/strings/replace.go.html#2497673">i</a></span><span class="op" id="2498024">:</span><span class="op" id="2498025">]</span><span class="op" id="2498026">,</span>&nbsp;<span class="ident" id="2498028"><a href="/strings/replace.go.html#2497648">prevMatchEmpty</a></span><span class="op" id="2498042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498046"><a href="/strings/replace.go.html#2497648">prevMatchEmpty</a></span>&nbsp;<span class="op" id="2498061">=</span>&nbsp;<span class="ident" id="2498063"><a href="/strings/replace.go.html#2498003">match</a></span>&nbsp;<span class="op" id="2498069">&amp;&amp;</span>&nbsp;<span class="ident" id="2498072"><a href="/strings/replace.go.html#2497995">keylen</a></span>&nbsp;<span class="op" id="2498079">==</span>&nbsp;<span class="num" id="2498082">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498086">if</span>&nbsp;<span class="ident" id="2498089"><a href="/strings/replace.go.html#2498003">match</a></span>&nbsp;<span class="op" id="2498095">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498100"><a href="/strings/replace.go.html#2497636">wn</a></span><span class="op" id="2498102">,</span>&nbsp;<span class="ident" id="2498104"><a href="/strings/replace.go.html#2497586">err</a></span>&nbsp;<span class="op" id="2498108">=</span>&nbsp;<span class="ident" id="2498110"><a href="/strings/replace.go.html#2497600">sw</a></span><span class="op" id="2498112">.</span><span class="ident" id="2498113">WriteString</span><span class="op" id="2498124">(</span><span class="ident" id="2498125"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2498126">[</span><span class="ident" id="2498127"><a href="/strings/replace.go.html#2497630">last</a></span><span class="op" id="2498131">:</span><span class="ident" id="2498132"><a href="/strings/replace.go.html#2497673">i</a></span><span class="op" id="2498133">]</span><span class="op" id="2498134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498139"><a href="/strings/replace.go.html#2497579">n</a></span>&nbsp;<span class="op" id="2498141">+=</span>&nbsp;<span class="ident" id="2498144"><a href="/strings/replace.go.html#2497636">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498150">if</span>&nbsp;<span class="ident" id="2498153"><a href="/strings/replace.go.html#2497586">err</a></span>&nbsp;<span class="op" id="2498157">!=</span>&nbsp;<span class="ident" id="2498160">nil</span>&nbsp;<span class="op" id="2498164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498170">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2498180">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498185"><a href="/strings/replace.go.html#2497636">wn</a></span><span class="op" id="2498187">,</span>&nbsp;<span class="ident" id="2498189"><a href="/strings/replace.go.html#2497586">err</a></span>&nbsp;<span class="op" id="2498193">=</span>&nbsp;<span class="ident" id="2498195"><a href="/strings/replace.go.html#2497600">sw</a></span><span class="op" id="2498197">.</span><span class="ident" id="2498198">WriteString</span><span class="op" id="2498209">(</span><span class="ident" id="2498210"><a href="/strings/replace.go.html#2497990">val</a></span><span class="op" id="2498213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498218"><a href="/strings/replace.go.html#2497579">n</a></span>&nbsp;<span class="op" id="2498220">+=</span>&nbsp;<span class="ident" id="2498223"><a href="/strings/replace.go.html#2497636">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498229">if</span>&nbsp;<span class="ident" id="2498232"><a href="/strings/replace.go.html#2497586">err</a></span>&nbsp;<span class="op" id="2498236">!=</span>&nbsp;<span class="ident" id="2498239">nil</span>&nbsp;<span class="op" id="2498243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498249">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2498259">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498264"><a href="/strings/replace.go.html#2497673">i</a></span>&nbsp;<span class="op" id="2498266">+=</span>&nbsp;<span class="ident" id="2498269"><a href="/strings/replace.go.html#2497995">keylen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498279"><a href="/strings/replace.go.html#2497630">last</a></span>&nbsp;<span class="op" id="2498284">=</span>&nbsp;<span class="ident" id="2498286"><a href="/strings/replace.go.html#2497673">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498291">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2498302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498306"><a href="/strings/replace.go.html#2497673">i</a></span><span class="op" id="2498307">++</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2498311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498314">if</span>&nbsp;<span class="ident" id="2498317"><a href="/strings/replace.go.html#2497630">last</a></span>&nbsp;<span class="op" id="2498322">!=</span>&nbsp;<span class="builtinfunc" id="2498325">len</span><span class="op" id="2498328">(</span><span class="ident" id="2498329"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2498330">)</span>&nbsp;<span class="op" id="2498332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498336"><a href="/strings/replace.go.html#2497636">wn</a></span><span class="op" id="2498338">,</span>&nbsp;<span class="ident" id="2498340"><a href="/strings/replace.go.html#2497586">err</a></span>&nbsp;<span class="op" id="2498344">=</span>&nbsp;<span class="ident" id="2498346"><a href="/strings/replace.go.html#2497600">sw</a></span><span class="op" id="2498348">.</span><span class="ident" id="2498349">WriteString</span><span class="op" id="2498360">(</span><span class="ident" id="2498361"><a href="/strings/replace.go.html#2497568">s</a></span><span class="op" id="2498362">[</span><span class="ident" id="2498363"><a href="/strings/replace.go.html#2497630">last</a></span><span class="op" id="2498367">:</span><span class="op" id="2498368">]</span><span class="op" id="2498369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498373"><a href="/strings/replace.go.html#2497579">n</a></span>&nbsp;<span class="op" id="2498375">+=</span>&nbsp;<span class="ident" id="2498378"><a href="/strings/replace.go.html#2497636">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2498382">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498385">return</span><br>
<span class="lineno"></span><span class="op" id="2498392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2498395">//&nbsp;singleStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;there&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="2498472">//&nbsp;one&nbsp;string&nbsp;to&nbsp;replace&nbsp;(and&nbsp;that&nbsp;string&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;byte).</span><br>
<span class="lineno">355</span><span class="keyword" id="2498539">type</span>&nbsp;<span class="ident" id="2498544">singleStringReplacer</span>&nbsp;<span class="keyword" id="2498565">struct</span>&nbsp;<span class="op" id="2498572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498575">finder</span>&nbsp;<span class="op" id="2498582">*</span><span class="ident" id="2498583"><a href="/strings/search.go.html#2502456">stringFinder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2498597">//&nbsp;value&nbsp;is&nbsp;the&nbsp;new&nbsp;string&nbsp;that&nbsp;replaces&nbsp;that&nbsp;pattern&nbsp;when&nbsp;it&#39;s&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498669">value</span>&nbsp;<span class="builtintype" id="2498675">string</span><br>
<span class="lineno"></span><span class="op" id="2498682">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="2498685">func</span>&nbsp;<span class="ident" id="2498690">makeSingleStringReplacer</span><span class="op" id="2498714">(</span><span class="ident" id="2498715">pattern</span>&nbsp;<span class="builtintype" id="2498723">string</span><span class="op" id="2498729">,</span>&nbsp;<span class="ident" id="2498731">value</span>&nbsp;<span class="builtintype" id="2498737">string</span><span class="op" id="2498743">)</span>&nbsp;<span class="op" id="2498745">*</span><span class="ident" id="2498746"><a href="/strings/replace.go.html#2498544">singleStringReplacer</a></span>&nbsp;<span class="op" id="2498767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498770">return</span>&nbsp;<span class="op" id="2498777">&amp;</span><span class="ident" id="2498778"><a href="/strings/replace.go.html#2498544">singleStringReplacer</a></span><span class="op" id="2498798">{</span><span class="ident" id="2498799">finder</span><span class="op" id="2498805">:</span>&nbsp;<span class="ident" id="2498807"><a href="/strings/search.go.html#2504200">makeStringFinder</a></span><span class="op" id="2498823">(</span><span class="ident" id="2498824"><a href="/strings/replace.go.html#2498715">pattern</a></span><span class="op" id="2498831">)</span><span class="op" id="2498832">,</span>&nbsp;<span class="ident" id="2498834">value</span><span class="op" id="2498839">:</span>&nbsp;<span class="ident" id="2498841"><a href="/strings/replace.go.html#2498731">value</a></span><span class="op" id="2498846">}</span><br>
<span class="lineno"></span><span class="op" id="2498848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="2498851">func</span>&nbsp;<span class="op" id="2498856">(</span><span class="ident" id="2498857">r</span>&nbsp;<span class="op" id="2498859">*</span><span class="ident" id="2498860"><a href="/strings/replace.go.html#2498544">singleStringReplacer</a></span><span class="op" id="2498880">)</span>&nbsp;<span class="ident" id="2498882">Replace</span><span class="op" id="2498889">(</span><span class="ident" id="2498890">s</span>&nbsp;<span class="builtintype" id="2498892">string</span><span class="op" id="2498898">)</span>&nbsp;<span class="builtintype" id="2498900">string</span>&nbsp;<span class="op" id="2498907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498910">var</span>&nbsp;<span class="ident" id="2498914">buf</span>&nbsp;<span class="op" id="2498918">[</span><span class="op" id="2498919">]</span><span class="builtintype" id="2498920">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498926">i</span><span class="op" id="2498927">,</span>&nbsp;<span class="ident" id="2498929">matched</span>&nbsp;<span class="op" id="2498937">:=</span>&nbsp;<span class="num" id="2498940">0</span><span class="op" id="2498941">,</span>&nbsp;<span class="builtintype" id="2498943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498950">for</span>&nbsp;<span class="op" id="2498954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2498958">match</span>&nbsp;<span class="op" id="2498964">:=</span>&nbsp;<span class="ident" id="2498967"><a href="/strings/replace.go.html#2498857">r</a></span><span class="op" id="2498968">.</span><span class="ident" id="2498969">finder</span><span class="op" id="2498975">.</span><span class="ident" id="2498976">next</span><span class="op" id="2498980">(</span><span class="ident" id="2498981"><a href="/strings/replace.go.html#2498890">s</a></span><span class="op" id="2498982">[</span><span class="ident" id="2498983"><a href="/strings/replace.go.html#2498926">i</a></span><span class="op" id="2498984">:</span><span class="op" id="2498985">]</span><span class="op" id="2498986">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2498990">if</span>&nbsp;<span class="ident" id="2498993"><a href="/strings/replace.go.html#2498958">match</a></span>&nbsp;<span class="op" id="2498999">==</span>&nbsp;<span class="op" id="2499002">-</span><span class="num" id="2499003">1</span>&nbsp;<span class="op" id="2499005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499010">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499022"><a href="/strings/replace.go.html#2498929">matched</a></span>&nbsp;<span class="op" id="2499030">=</span>&nbsp;<span class="builtintype" id="2499032">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499039"><a href="/strings/replace.go.html#2498914">buf</a></span>&nbsp;<span class="op" id="2499043">=</span>&nbsp;<span class="builtinfunc" id="2499045">append</span><span class="op" id="2499051">(</span><span class="ident" id="2499052"><a href="/strings/replace.go.html#2498914">buf</a></span><span class="op" id="2499055">,</span>&nbsp;<span class="ident" id="2499057"><a href="/strings/replace.go.html#2498890">s</a></span><span class="op" id="2499058">[</span><span class="ident" id="2499059"><a href="/strings/replace.go.html#2498926">i</a></span><span class="op" id="2499060">:</span><span class="ident" id="2499061"><a href="/strings/replace.go.html#2498926">i</a></span><span class="op" id="2499062">+</span><span class="ident" id="2499063"><a href="/strings/replace.go.html#2498958">match</a></span><span class="op" id="2499068">]</span><span class="op" id="2499069">...</span><span class="op" id="2499072">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499076"><a href="/strings/replace.go.html#2498914">buf</a></span>&nbsp;<span class="op" id="2499080">=</span>&nbsp;<span class="builtinfunc" id="2499082">append</span><span class="op" id="2499088">(</span><span class="ident" id="2499089"><a href="/strings/replace.go.html#2498914">buf</a></span><span class="op" id="2499092">,</span>&nbsp;<span class="ident" id="2499094"><a href="/strings/replace.go.html#2498857">r</a></span><span class="op" id="2499095">.</span><span class="ident" id="2499096">value</span><span class="op" id="2499101">...</span><span class="op" id="2499104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499108"><a href="/strings/replace.go.html#2498926">i</a></span>&nbsp;<span class="op" id="2499110">+=</span>&nbsp;<span class="ident" id="2499113"><a href="/strings/replace.go.html#2498958">match</a></span>&nbsp;<span class="op" id="2499119">+</span>&nbsp;<span class="builtinfunc" id="2499121">len</span><span class="op" id="2499124">(</span><span class="ident" id="2499125"><a href="/strings/replace.go.html#2498857">r</a></span><span class="op" id="2499126">.</span><span class="ident" id="2499127">finder</span><span class="op" id="2499133">.</span><span class="ident" id="2499134">pattern</span><span class="op" id="2499141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499147">if</span>&nbsp;<span class="op" id="2499150">!</span><span class="ident" id="2499151"><a href="/strings/replace.go.html#2498929">matched</a></span>&nbsp;<span class="op" id="2499159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499163">return</span>&nbsp;<span class="ident" id="2499170"><a href="/strings/replace.go.html#2498890">s</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499176"><a href="/strings/replace.go.html#2498914">buf</a></span>&nbsp;<span class="op" id="2499180">=</span>&nbsp;<span class="builtinfunc" id="2499182">append</span><span class="op" id="2499188">(</span><span class="ident" id="2499189"><a href="/strings/replace.go.html#2498914">buf</a></span><span class="op" id="2499192">,</span>&nbsp;<span class="ident" id="2499194"><a href="/strings/replace.go.html#2498890">s</a></span><span class="op" id="2499195">[</span><span class="ident" id="2499196"><a href="/strings/replace.go.html#2498926">i</a></span><span class="op" id="2499197">:</span><span class="op" id="2499198">]</span><span class="op" id="2499199">...</span><span class="op" id="2499202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499205">return</span>&nbsp;<span class="builtintype" id="2499212">string</span><span class="op" id="2499218">(</span><span class="ident" id="2499219"><a href="/strings/replace.go.html#2498914">buf</a></span><span class="op" id="2499222">)</span><br>
<span class="lineno"></span><span class="op" id="2499224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="2499227">func</span>&nbsp;<span class="op" id="2499232">(</span><span class="ident" id="2499233">r</span>&nbsp;<span class="op" id="2499235">*</span><span class="ident" id="2499236"><a href="/strings/replace.go.html#2498544">singleStringReplacer</a></span><span class="op" id="2499256">)</span>&nbsp;<span class="ident" id="2499258">WriteString</span><span class="op" id="2499269">(</span><span class="ident" id="2499270">w</span>&nbsp;<span class="ident" id="2499272"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2499274">.</span><span class="ident" id="2499275">Writer</span><span class="op" id="2499281">,</span>&nbsp;<span class="ident" id="2499283">s</span>&nbsp;<span class="builtintype" id="2499285">string</span><span class="op" id="2499291">)</span>&nbsp;<span class="op" id="2499293">(</span><span class="ident" id="2499294">n</span>&nbsp;<span class="builtintype" id="2499296">int</span><span class="op" id="2499299">,</span>&nbsp;<span class="ident" id="2499301">err</span>&nbsp;<span class="builtintype" id="2499305">error</span><span class="op" id="2499310">)</span>&nbsp;<span class="op" id="2499312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499315">sw</span>&nbsp;<span class="op" id="2499318">:=</span>&nbsp;<span class="ident" id="2499321"><a href="/strings/replace.go.html#2497242">getStringWriter</a></span><span class="op" id="2499336">(</span><span class="ident" id="2499337"><a href="/strings/replace.go.html#2499270">w</a></span><span class="op" id="2499338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499341">var</span>&nbsp;<span class="ident" id="2499345">i</span><span class="op" id="2499346">,</span>&nbsp;<span class="ident" id="2499348">wn</span>&nbsp;<span class="builtintype" id="2499351">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499356">for</span>&nbsp;<span class="op" id="2499360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499364">match</span>&nbsp;<span class="op" id="2499370">:=</span>&nbsp;<span class="ident" id="2499373"><a href="/strings/replace.go.html#2499233">r</a></span><span class="op" id="2499374">.</span><span class="ident" id="2499375">finder</span><span class="op" id="2499381">.</span><span class="ident" id="2499382">next</span><span class="op" id="2499386">(</span><span class="ident" id="2499387"><a href="/strings/replace.go.html#2499283">s</a></span><span class="op" id="2499388">[</span><span class="ident" id="2499389"><a href="/strings/replace.go.html#2499345">i</a></span><span class="op" id="2499390">:</span><span class="op" id="2499391">]</span><span class="op" id="2499392">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499396">if</span>&nbsp;<span class="ident" id="2499399"><a href="/strings/replace.go.html#2499364">match</a></span>&nbsp;<span class="op" id="2499405">==</span>&nbsp;<span class="op" id="2499408">-</span><span class="num" id="2499409">1</span>&nbsp;<span class="op" id="2499411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499416">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499428"><a href="/strings/replace.go.html#2499348">wn</a></span><span class="op" id="2499430">,</span>&nbsp;<span class="ident" id="2499432"><a href="/strings/replace.go.html#2499301">err</a></span>&nbsp;<span class="op" id="2499436">=</span>&nbsp;<span class="ident" id="2499438"><a href="/strings/replace.go.html#2499315">sw</a></span><span class="op" id="2499440">.</span><span class="ident" id="2499441">WriteString</span><span class="op" id="2499452">(</span><span class="ident" id="2499453"><a href="/strings/replace.go.html#2499283">s</a></span><span class="op" id="2499454">[</span><span class="ident" id="2499455"><a href="/strings/replace.go.html#2499345">i</a></span>&nbsp;<span class="op" id="2499457">:</span>&nbsp;<span class="ident" id="2499459"><a href="/strings/replace.go.html#2499345">i</a></span><span class="op" id="2499460">+</span><span class="ident" id="2499461"><a href="/strings/replace.go.html#2499364">match</a></span><span class="op" id="2499466">]</span><span class="op" id="2499467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499471"><a href="/strings/replace.go.html#2499294">n</a></span>&nbsp;<span class="op" id="2499473">+=</span>&nbsp;<span class="ident" id="2499476"><a href="/strings/replace.go.html#2499348">wn</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499481">if</span>&nbsp;<span class="ident" id="2499484"><a href="/strings/replace.go.html#2499301">err</a></span>&nbsp;<span class="op" id="2499488">!=</span>&nbsp;<span class="ident" id="2499491">nil</span>&nbsp;<span class="op" id="2499495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499513"><a href="/strings/replace.go.html#2499348">wn</a></span><span class="op" id="2499515">,</span>&nbsp;<span class="ident" id="2499517"><a href="/strings/replace.go.html#2499301">err</a></span>&nbsp;<span class="op" id="2499521">=</span>&nbsp;<span class="ident" id="2499523"><a href="/strings/replace.go.html#2499315">sw</a></span><span class="op" id="2499525">.</span><span class="ident" id="2499526">WriteString</span><span class="op" id="2499537">(</span><span class="ident" id="2499538"><a href="/strings/replace.go.html#2499233">r</a></span><span class="op" id="2499539">.</span><span class="ident" id="2499540">value</span><span class="op" id="2499545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499549"><a href="/strings/replace.go.html#2499294">n</a></span>&nbsp;<span class="op" id="2499551">+=</span>&nbsp;<span class="ident" id="2499554"><a href="/strings/replace.go.html#2499348">wn</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499559">if</span>&nbsp;<span class="ident" id="2499562"><a href="/strings/replace.go.html#2499301">err</a></span>&nbsp;<span class="op" id="2499566">!=</span>&nbsp;<span class="ident" id="2499569">nil</span>&nbsp;<span class="op" id="2499573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499591"><a href="/strings/replace.go.html#2499345">i</a></span>&nbsp;<span class="op" id="2499593">+=</span>&nbsp;<span class="ident" id="2499596"><a href="/strings/replace.go.html#2499364">match</a></span>&nbsp;<span class="op" id="2499602">+</span>&nbsp;<span class="builtinfunc" id="2499604">len</span><span class="op" id="2499607">(</span><span class="ident" id="2499608"><a href="/strings/replace.go.html#2499233">r</a></span><span class="op" id="2499609">.</span><span class="ident" id="2499610">finder</span><span class="op" id="2499616">.</span><span class="ident" id="2499617">pattern</span><span class="op" id="2499624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2499627">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499630"><a href="/strings/replace.go.html#2499348">wn</a></span><span class="op" id="2499632">,</span>&nbsp;<span class="ident" id="2499634"><a href="/strings/replace.go.html#2499301">err</a></span>&nbsp;<span class="op" id="2499638">=</span>&nbsp;<span class="ident" id="2499640"><a href="/strings/replace.go.html#2499315">sw</a></span><span class="op" id="2499642">.</span><span class="ident" id="2499643">WriteString</span><span class="op" id="2499654">(</span><span class="ident" id="2499655"><a href="/strings/replace.go.html#2499283">s</a></span><span class="op" id="2499656">[</span><span class="ident" id="2499657"><a href="/strings/replace.go.html#2499345">i</a></span><span class="op" id="2499658">:</span><span class="op" id="2499659">]</span><span class="op" id="2499660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2499663"><a href="/strings/replace.go.html#2499294">n</a></span>&nbsp;<span class="op" id="2499665">+=</span>&nbsp;<span class="ident" id="2499668"><a href="/strings/replace.go.html#2499348">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499672">return</span><br>
<span class="lineno"></span><span class="op" id="2499679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="2499682">//&nbsp;byteReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the&nbsp;&#34;old&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2499751">//&nbsp;and&nbsp;&#34;new&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2499795">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;bytes&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2499856">type</span>&nbsp;<span class="ident" id="2499861">byteReplacer</span>&nbsp;<span class="op" id="2499874">[</span><span class="num" id="2499875">256</span><span class="op" id="2499878">]</span><span class="builtintype" id="2499879">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="2499885">func</span>&nbsp;<span class="op" id="2499890">(</span><span class="ident" id="2499891">r</span>&nbsp;<span class="op" id="2499893">*</span><span class="ident" id="2499894"><a href="/strings/replace.go.html#2499861">byteReplacer</a></span><span class="op" id="2499906">)</span>&nbsp;<span class="ident" id="2499908">Replace</span><span class="op" id="2499915">(</span><span class="ident" id="2499916">s</span>&nbsp;<span class="builtintype" id="2499918">string</span><span class="op" id="2499924">)</span>&nbsp;<span class="builtintype" id="2499926">string</span>&nbsp;<span class="op" id="2499933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499936">var</span>&nbsp;<span class="ident" id="2499940">buf</span>&nbsp;<span class="op" id="2499944">[</span><span class="op" id="2499945">]</span><span class="builtintype" id="2499946">byte</span>&nbsp;<span class="comment" id="2499951">//&nbsp;lazily&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2499972">for</span>&nbsp;<span class="ident" id="2499976">i</span>&nbsp;<span class="op" id="2499978">:=</span>&nbsp;<span class="num" id="2499981">0</span><span class="op" id="2499982">;</span>&nbsp;<span class="ident" id="2499984"><a href="/strings/replace.go.html#2499976">i</a></span>&nbsp;<span class="op" id="2499986">&lt;</span>&nbsp;<span class="builtinfunc" id="2499988">len</span><span class="op" id="2499991">(</span><span class="ident" id="2499992"><a href="/strings/replace.go.html#2499916">s</a></span><span class="op" id="2499993">)</span><span class="op" id="2499994">;</span>&nbsp;<span class="ident" id="2499996"><a href="/strings/replace.go.html#2499976">i</a></span><span class="op" id="2499997">++</span>&nbsp;<span class="op" id="2500000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500004">b</span>&nbsp;<span class="op" id="2500006">:=</span>&nbsp;<span class="ident" id="2500009"><a href="/strings/replace.go.html#2499916">s</a></span><span class="op" id="2500010">[</span><span class="ident" id="2500011"><a href="/strings/replace.go.html#2499976">i</a></span><span class="op" id="2500012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500016">if</span>&nbsp;<span class="ident" id="2500019"><a href="/strings/replace.go.html#2499891">r</a></span><span class="op" id="2500020">[</span><span class="ident" id="2500021"><a href="/strings/replace.go.html#2500004">b</a></span><span class="op" id="2500022">]</span>&nbsp;<span class="op" id="2500024">!=</span>&nbsp;<span class="ident" id="2500027"><a href="/strings/replace.go.html#2500004">b</a></span>&nbsp;<span class="op" id="2500029">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500034">if</span>&nbsp;<span class="ident" id="2500037"><a href="/strings/replace.go.html#2499940">buf</a></span>&nbsp;<span class="op" id="2500041">==</span>&nbsp;<span class="ident" id="2500044">nil</span>&nbsp;<span class="op" id="2500048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500054"><a href="/strings/replace.go.html#2499940">buf</a></span>&nbsp;<span class="op" id="2500058">=</span>&nbsp;<span class="op" id="2500060">[</span><span class="op" id="2500061">]</span><span class="builtintype" id="2500062">byte</span><span class="op" id="2500066">(</span><span class="ident" id="2500067"><a href="/strings/replace.go.html#2499916">s</a></span><span class="op" id="2500068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500078"><a href="/strings/replace.go.html#2499940">buf</a></span><span class="op" id="2500081">[</span><span class="ident" id="2500082"><a href="/strings/replace.go.html#2499976">i</a></span><span class="op" id="2500083">]</span>&nbsp;<span class="op" id="2500085">=</span>&nbsp;<span class="ident" id="2500087"><a href="/strings/replace.go.html#2499891">r</a></span><span class="op" id="2500088">[</span><span class="ident" id="2500089"><a href="/strings/replace.go.html#2500004">b</a></span><span class="op" id="2500090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500094">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500100">if</span>&nbsp;<span class="ident" id="2500103"><a href="/strings/replace.go.html#2499940">buf</a></span>&nbsp;<span class="op" id="2500107">==</span>&nbsp;<span class="ident" id="2500110">nil</span>&nbsp;<span class="op" id="2500114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500118">return</span>&nbsp;<span class="ident" id="2500125"><a href="/strings/replace.go.html#2499916">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500131">return</span>&nbsp;<span class="builtintype" id="2500138">string</span><span class="op" id="2500144">(</span><span class="ident" id="2500145"><a href="/strings/replace.go.html#2499940">buf</a></span><span class="op" id="2500148">)</span><br>
<span class="lineno">430</span><span class="op" id="2500150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2500153">func</span>&nbsp;<span class="op" id="2500158">(</span><span class="ident" id="2500159">r</span>&nbsp;<span class="op" id="2500161">*</span><span class="ident" id="2500162"><a href="/strings/replace.go.html#2499861">byteReplacer</a></span><span class="op" id="2500174">)</span>&nbsp;<span class="ident" id="2500176">WriteString</span><span class="op" id="2500187">(</span><span class="ident" id="2500188">w</span>&nbsp;<span class="ident" id="2500190"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2500192">.</span><span class="ident" id="2500193">Writer</span><span class="op" id="2500199">,</span>&nbsp;<span class="ident" id="2500201">s</span>&nbsp;<span class="builtintype" id="2500203">string</span><span class="op" id="2500209">)</span>&nbsp;<span class="op" id="2500211">(</span><span class="ident" id="2500212">n</span>&nbsp;<span class="builtintype" id="2500214">int</span><span class="op" id="2500217">,</span>&nbsp;<span class="ident" id="2500219">err</span>&nbsp;<span class="builtintype" id="2500223">error</span><span class="op" id="2500228">)</span>&nbsp;<span class="op" id="2500230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2500233">//&nbsp;TODO(bradfitz):&nbsp;use&nbsp;io.WriteString&nbsp;with&nbsp;slices&nbsp;of&nbsp;s,&nbsp;avoiding&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500311">bufsize</span>&nbsp;<span class="op" id="2500319">:=</span>&nbsp;<span class="num" id="2500322">32</span>&nbsp;<span class="op" id="2500325">&lt;&lt;</span>&nbsp;<span class="num" id="2500328">10</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500332">if</span>&nbsp;<span class="builtinfunc" id="2500335">len</span><span class="op" id="2500338">(</span><span class="ident" id="2500339"><a href="/strings/replace.go.html#2500201">s</a></span><span class="op" id="2500340">)</span>&nbsp;<span class="op" id="2500342">&lt;</span>&nbsp;<span class="ident" id="2500344"><a href="/strings/replace.go.html#2500311">bufsize</a></span>&nbsp;<span class="op" id="2500352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500356"><a href="/strings/replace.go.html#2500311">bufsize</a></span>&nbsp;<span class="op" id="2500364">=</span>&nbsp;<span class="builtinfunc" id="2500366">len</span><span class="op" id="2500369">(</span><span class="ident" id="2500370"><a href="/strings/replace.go.html#2500201">s</a></span><span class="op" id="2500371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500377">buf</span>&nbsp;<span class="op" id="2500381">:=</span>&nbsp;<span class="builtinfunc" id="2500384">make</span><span class="op" id="2500388">(</span><span class="op" id="2500389">[</span><span class="op" id="2500390">]</span><span class="builtintype" id="2500391">byte</span><span class="op" id="2500395">,</span>&nbsp;<span class="ident" id="2500397"><a href="/strings/replace.go.html#2500311">bufsize</a></span><span class="op" id="2500404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500408">for</span>&nbsp;<span class="builtinfunc" id="2500412">len</span><span class="op" id="2500415">(</span><span class="ident" id="2500416"><a href="/strings/replace.go.html#2500201">s</a></span><span class="op" id="2500417">)</span>&nbsp;<span class="op" id="2500419">&gt;</span>&nbsp;<span class="num" id="2500421">0</span>&nbsp;<span class="op" id="2500423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500427">ncopy</span>&nbsp;<span class="op" id="2500433">:=</span>&nbsp;<span class="builtinfunc" id="2500436">copy</span><span class="op" id="2500440">(</span><span class="ident" id="2500441"><a href="/strings/replace.go.html#2500377">buf</a></span><span class="op" id="2500444">,</span>&nbsp;<span class="ident" id="2500446"><a href="/strings/replace.go.html#2500201">s</a></span><span class="op" id="2500447">[</span><span class="op" id="2500448">:</span><span class="op" id="2500449">]</span><span class="op" id="2500450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500454"><a href="/strings/replace.go.html#2500201">s</a></span>&nbsp;<span class="op" id="2500456">=</span>&nbsp;<span class="ident" id="2500458"><a href="/strings/replace.go.html#2500201">s</a></span><span class="op" id="2500459">[</span><span class="ident" id="2500460"><a href="/strings/replace.go.html#2500427">ncopy</a></span><span class="op" id="2500465">:</span><span class="op" id="2500466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500470">for</span>&nbsp;<span class="ident" id="2500474">i</span><span class="op" id="2500475">,</span>&nbsp;<span class="ident" id="2500477">b</span>&nbsp;<span class="op" id="2500479">:=</span>&nbsp;<span class="keyword" id="2500482">range</span>&nbsp;<span class="ident" id="2500488"><a href="/strings/replace.go.html#2500377">buf</a></span><span class="op" id="2500491">[</span><span class="op" id="2500492">:</span><span class="ident" id="2500493"><a href="/strings/replace.go.html#2500427">ncopy</a></span><span class="op" id="2500498">]</span>&nbsp;<span class="op" id="2500500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500505"><a href="/strings/replace.go.html#2500377">buf</a></span><span class="op" id="2500508">[</span><span class="ident" id="2500509"><a href="/strings/replace.go.html#2500474">i</a></span><span class="op" id="2500510">]</span>&nbsp;<span class="op" id="2500512">=</span>&nbsp;<span class="ident" id="2500514"><a href="/strings/replace.go.html#2500159">r</a></span><span class="op" id="2500515">[</span><span class="ident" id="2500516"><a href="/strings/replace.go.html#2500477">b</a></span><span class="op" id="2500517">]</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500525">wn</span><span class="op" id="2500527">,</span>&nbsp;<span class="ident" id="2500529">err</span>&nbsp;<span class="op" id="2500533">:=</span>&nbsp;<span class="ident" id="2500536"><a href="/strings/replace.go.html#2500188">w</a></span><span class="op" id="2500537">.</span><span class="ident" id="2500538">Write</span><span class="op" id="2500543">(</span><span class="ident" id="2500544"><a href="/strings/replace.go.html#2500377">buf</a></span><span class="op" id="2500547">[</span><span class="op" id="2500548">:</span><span class="ident" id="2500549"><a href="/strings/replace.go.html#2500427">ncopy</a></span><span class="op" id="2500554">]</span><span class="op" id="2500555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500559"><a href="/strings/replace.go.html#2500212">n</a></span>&nbsp;<span class="op" id="2500561">+=</span>&nbsp;<span class="ident" id="2500564"><a href="/strings/replace.go.html#2500525">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500569">if</span>&nbsp;<span class="ident" id="2500572"><a href="/strings/replace.go.html#2500529">err</a></span>&nbsp;<span class="op" id="2500576">!=</span>&nbsp;<span class="ident" id="2500579">nil</span>&nbsp;<span class="op" id="2500583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500588">return</span>&nbsp;<span class="ident" id="2500595"><a href="/strings/replace.go.html#2500212">n</a></span><span class="op" id="2500596">,</span>&nbsp;<span class="ident" id="2500598"><a href="/strings/replace.go.html#2500529">err</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2500607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2500610">return</span>&nbsp;<span class="ident" id="2500617"><a href="/strings/replace.go.html#2500212">n</a></span><span class="op" id="2500618">,</span>&nbsp;<span class="ident" id="2500620">nil</span><br>
<span class="lineno"></span><span class="op" id="2500624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="2500627">//&nbsp;byteStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2500696">//&nbsp;&#34;old&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes&nbsp;but&nbsp;the&nbsp;&#34;new&#34;&nbsp;values&nbsp;vary&nbsp;in&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="2500770">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;byte&nbsp;slices&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="2500837">//&nbsp;A&nbsp;nil&nbsp;[]byte&nbsp;means&nbsp;that&nbsp;the&nbsp;old&nbsp;byte&nbsp;should&nbsp;not&nbsp;be&nbsp;replaced.</span><br>
<span class="lineno"></span><span class="keyword" id="2500901">type</span>&nbsp;<span class="ident" id="2500906">byteStringReplacer</span>&nbsp;<span class="op" id="2500925">[</span><span class="num" id="2500926">256</span><span class="op" id="2500929">]</span><span class="op" id="2500930">[</span><span class="op" id="2500931">]</span><span class="builtintype" id="2500932">byte</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="keyword" id="2500938">func</span>&nbsp;<span class="op" id="2500943">(</span><span class="ident" id="2500944">r</span>&nbsp;<span class="op" id="2500946">*</span><span class="ident" id="2500947"><a href="/strings/replace.go.html#2500906">byteStringReplacer</a></span><span class="op" id="2500965">)</span>&nbsp;<span class="ident" id="2500967">Replace</span><span class="op" id="2500974">(</span><span class="ident" id="2500975">s</span>&nbsp;<span class="builtintype" id="2500977">string</span><span class="op" id="2500983">)</span>&nbsp;<span class="builtintype" id="2500985">string</span>&nbsp;<span class="op" id="2500992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2500995">newSize</span>&nbsp;<span class="op" id="2501003">:=</span>&nbsp;<span class="builtinfunc" id="2501006">len</span><span class="op" id="2501009">(</span><span class="ident" id="2501010"><a href="/strings/replace.go.html#2500975">s</a></span><span class="op" id="2501011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501014">anyChanges</span>&nbsp;<span class="op" id="2501025">:=</span>&nbsp;<span class="builtintype" id="2501028">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501035">for</span>&nbsp;<span class="ident" id="2501039">i</span>&nbsp;<span class="op" id="2501041">:=</span>&nbsp;<span class="num" id="2501044">0</span><span class="op" id="2501045">;</span>&nbsp;<span class="ident" id="2501047"><a href="/strings/replace.go.html#2501039">i</a></span>&nbsp;<span class="op" id="2501049">&lt;</span>&nbsp;<span class="builtinfunc" id="2501051">len</span><span class="op" id="2501054">(</span><span class="ident" id="2501055"><a href="/strings/replace.go.html#2500975">s</a></span><span class="op" id="2501056">)</span><span class="op" id="2501057">;</span>&nbsp;<span class="ident" id="2501059"><a href="/strings/replace.go.html#2501039">i</a></span><span class="op" id="2501060">++</span>&nbsp;<span class="op" id="2501063">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501067">b</span>&nbsp;<span class="op" id="2501069">:=</span>&nbsp;<span class="ident" id="2501072"><a href="/strings/replace.go.html#2500975">s</a></span><span class="op" id="2501073">[</span><span class="ident" id="2501074"><a href="/strings/replace.go.html#2501039">i</a></span><span class="op" id="2501075">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501079">if</span>&nbsp;<span class="ident" id="2501082"><a href="/strings/replace.go.html#2500944">r</a></span><span class="op" id="2501083">[</span><span class="ident" id="2501084"><a href="/strings/replace.go.html#2501067">b</a></span><span class="op" id="2501085">]</span>&nbsp;<span class="op" id="2501087">!=</span>&nbsp;<span class="ident" id="2501090">nil</span>&nbsp;<span class="op" id="2501094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501099"><a href="/strings/replace.go.html#2501014">anyChanges</a></span>&nbsp;<span class="op" id="2501110">=</span>&nbsp;<span class="builtintype" id="2501112">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2501120">//&nbsp;The&nbsp;-1&nbsp;is&nbsp;because&nbsp;we&nbsp;are&nbsp;replacing&nbsp;1&nbsp;byte&nbsp;with&nbsp;len(r[b])&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501190"><a href="/strings/replace.go.html#2500995">newSize</a></span>&nbsp;<span class="op" id="2501198">+=</span>&nbsp;<span class="builtinfunc" id="2501201">len</span><span class="op" id="2501204">(</span><span class="ident" id="2501205"><a href="/strings/replace.go.html#2500944">r</a></span><span class="op" id="2501206">[</span><span class="ident" id="2501207"><a href="/strings/replace.go.html#2501067">b</a></span><span class="op" id="2501208">]</span><span class="op" id="2501209">)</span>&nbsp;<span class="op" id="2501211">-</span>&nbsp;<span class="num" id="2501213">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501223">if</span>&nbsp;<span class="op" id="2501226">!</span><span class="ident" id="2501227"><a href="/strings/replace.go.html#2501014">anyChanges</a></span>&nbsp;<span class="op" id="2501238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501242">return</span>&nbsp;<span class="ident" id="2501249"><a href="/strings/replace.go.html#2500975">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501252">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501255">buf</span>&nbsp;<span class="op" id="2501259">:=</span>&nbsp;<span class="builtinfunc" id="2501262">make</span><span class="op" id="2501266">(</span><span class="op" id="2501267">[</span><span class="op" id="2501268">]</span><span class="builtintype" id="2501269">byte</span><span class="op" id="2501273">,</span>&nbsp;<span class="ident" id="2501275"><a href="/strings/replace.go.html#2500995">newSize</a></span><span class="op" id="2501282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501285">bi</span>&nbsp;<span class="op" id="2501288">:=</span>&nbsp;<span class="ident" id="2501291"><a href="/strings/replace.go.html#2501255">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501296">for</span>&nbsp;<span class="ident" id="2501300">i</span>&nbsp;<span class="op" id="2501302">:=</span>&nbsp;<span class="num" id="2501305">0</span><span class="op" id="2501306">;</span>&nbsp;<span class="ident" id="2501308"><a href="/strings/replace.go.html#2501300">i</a></span>&nbsp;<span class="op" id="2501310">&lt;</span>&nbsp;<span class="builtinfunc" id="2501312">len</span><span class="op" id="2501315">(</span><span class="ident" id="2501316"><a href="/strings/replace.go.html#2500975">s</a></span><span class="op" id="2501317">)</span><span class="op" id="2501318">;</span>&nbsp;<span class="ident" id="2501320"><a href="/strings/replace.go.html#2501300">i</a></span><span class="op" id="2501321">++</span>&nbsp;<span class="op" id="2501324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501328">b</span>&nbsp;<span class="op" id="2501330">:=</span>&nbsp;<span class="ident" id="2501333"><a href="/strings/replace.go.html#2500975">s</a></span><span class="op" id="2501334">[</span><span class="ident" id="2501335"><a href="/strings/replace.go.html#2501300">i</a></span><span class="op" id="2501336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501340">if</span>&nbsp;<span class="ident" id="2501343"><a href="/strings/replace.go.html#2500944">r</a></span><span class="op" id="2501344">[</span><span class="ident" id="2501345"><a href="/strings/replace.go.html#2501328">b</a></span><span class="op" id="2501346">]</span>&nbsp;<span class="op" id="2501348">!=</span>&nbsp;<span class="ident" id="2501351">nil</span>&nbsp;<span class="op" id="2501355">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501360">n</span>&nbsp;<span class="op" id="2501362">:=</span>&nbsp;<span class="builtinfunc" id="2501365">copy</span><span class="op" id="2501369">(</span><span class="ident" id="2501370"><a href="/strings/replace.go.html#2501285">bi</a></span><span class="op" id="2501372">,</span>&nbsp;<span class="ident" id="2501374"><a href="/strings/replace.go.html#2500944">r</a></span><span class="op" id="2501375">[</span><span class="ident" id="2501376"><a href="/strings/replace.go.html#2501328">b</a></span><span class="op" id="2501377">]</span><span class="op" id="2501378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501383"><a href="/strings/replace.go.html#2501285">bi</a></span>&nbsp;<span class="op" id="2501386">=</span>&nbsp;<span class="ident" id="2501388"><a href="/strings/replace.go.html#2501285">bi</a></span><span class="op" id="2501390">[</span><span class="ident" id="2501391"><a href="/strings/replace.go.html#2501360">n</a></span><span class="op" id="2501392">:</span><span class="op" id="2501393">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501397">}</span>&nbsp;<span class="keyword" id="2501399">else</span>&nbsp;<span class="op" id="2501404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501409"><a href="/strings/replace.go.html#2501285">bi</a></span><span class="op" id="2501411">[</span><span class="num" id="2501412">0</span><span class="op" id="2501413">]</span>&nbsp;<span class="op" id="2501415">=</span>&nbsp;<span class="ident" id="2501417"><a href="/strings/replace.go.html#2501328">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501422"><a href="/strings/replace.go.html#2501285">bi</a></span>&nbsp;<span class="op" id="2501425">=</span>&nbsp;<span class="ident" id="2501427"><a href="/strings/replace.go.html#2501285">bi</a></span><span class="op" id="2501429">[</span><span class="num" id="2501430">1</span><span class="op" id="2501431">:</span><span class="op" id="2501432">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501442">return</span>&nbsp;<span class="builtintype" id="2501449">string</span><span class="op" id="2501455">(</span><span class="ident" id="2501456"><a href="/strings/replace.go.html#2501255">buf</a></span><span class="op" id="2501459">)</span><br>
<span class="lineno"></span><span class="op" id="2501461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="keyword" id="2501464">func</span>&nbsp;<span class="op" id="2501469">(</span><span class="ident" id="2501470">r</span>&nbsp;<span class="op" id="2501472">*</span><span class="ident" id="2501473"><a href="/strings/replace.go.html#2500906">byteStringReplacer</a></span><span class="op" id="2501491">)</span>&nbsp;<span class="ident" id="2501493">WriteString</span><span class="op" id="2501504">(</span><span class="ident" id="2501505">w</span>&nbsp;<span class="ident" id="2501507"><a href="/strings/replace.go.html#2489208">io</a></span><span class="op" id="2501509">.</span><span class="ident" id="2501510">Writer</span><span class="op" id="2501516">,</span>&nbsp;<span class="ident" id="2501518">s</span>&nbsp;<span class="builtintype" id="2501520">string</span><span class="op" id="2501526">)</span>&nbsp;<span class="op" id="2501528">(</span><span class="ident" id="2501529">n</span>&nbsp;<span class="builtintype" id="2501531">int</span><span class="op" id="2501534">,</span>&nbsp;<span class="ident" id="2501536">err</span>&nbsp;<span class="builtintype" id="2501540">error</span><span class="op" id="2501545">)</span>&nbsp;<span class="op" id="2501547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501550">sw</span>&nbsp;<span class="op" id="2501553">:=</span>&nbsp;<span class="ident" id="2501556"><a href="/strings/replace.go.html#2497242">getStringWriter</a></span><span class="op" id="2501571">(</span><span class="ident" id="2501572"><a href="/strings/replace.go.html#2501505">w</a></span><span class="op" id="2501573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501576">last</span>&nbsp;<span class="op" id="2501581">:=</span>&nbsp;<span class="num" id="2501584">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501587">for</span>&nbsp;<span class="ident" id="2501591">i</span>&nbsp;<span class="op" id="2501593">:=</span>&nbsp;<span class="num" id="2501596">0</span><span class="op" id="2501597">;</span>&nbsp;<span class="ident" id="2501599"><a href="/strings/replace.go.html#2501591">i</a></span>&nbsp;<span class="op" id="2501601">&lt;</span>&nbsp;<span class="builtinfunc" id="2501603">len</span><span class="op" id="2501606">(</span><span class="ident" id="2501607"><a href="/strings/replace.go.html#2501518">s</a></span><span class="op" id="2501608">)</span><span class="op" id="2501609">;</span>&nbsp;<span class="ident" id="2501611"><a href="/strings/replace.go.html#2501591">i</a></span><span class="op" id="2501612">++</span>&nbsp;<span class="op" id="2501615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501619">b</span>&nbsp;<span class="op" id="2501621">:=</span>&nbsp;<span class="ident" id="2501624"><a href="/strings/replace.go.html#2501518">s</a></span><span class="op" id="2501625">[</span><span class="ident" id="2501626"><a href="/strings/replace.go.html#2501591">i</a></span><span class="op" id="2501627">]</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501631">if</span>&nbsp;<span class="ident" id="2501634"><a href="/strings/replace.go.html#2501470">r</a></span><span class="op" id="2501635">[</span><span class="ident" id="2501636"><a href="/strings/replace.go.html#2501619">b</a></span><span class="op" id="2501637">]</span>&nbsp;<span class="op" id="2501639">==</span>&nbsp;<span class="ident" id="2501642">nil</span>&nbsp;<span class="op" id="2501646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501651">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501666">if</span>&nbsp;<span class="ident" id="2501669"><a href="/strings/replace.go.html#2501576">last</a></span>&nbsp;<span class="op" id="2501674">!=</span>&nbsp;<span class="ident" id="2501677"><a href="/strings/replace.go.html#2501591">i</a></span>&nbsp;<span class="op" id="2501679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501684">nw</span><span class="op" id="2501686">,</span>&nbsp;<span class="ident" id="2501688">err</span>&nbsp;<span class="op" id="2501692">:=</span>&nbsp;<span class="ident" id="2501695"><a href="/strings/replace.go.html#2501550">sw</a></span><span class="op" id="2501697">.</span><span class="ident" id="2501698">WriteString</span><span class="op" id="2501709">(</span><span class="ident" id="2501710"><a href="/strings/replace.go.html#2501518">s</a></span><span class="op" id="2501711">[</span><span class="ident" id="2501712"><a href="/strings/replace.go.html#2501576">last</a></span><span class="op" id="2501716">:</span><span class="ident" id="2501717"><a href="/strings/replace.go.html#2501591">i</a></span><span class="op" id="2501718">]</span><span class="op" id="2501719">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501724"><a href="/strings/replace.go.html#2501529">n</a></span>&nbsp;<span class="op" id="2501726">+=</span>&nbsp;<span class="ident" id="2501729"><a href="/strings/replace.go.html#2501684">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501735">if</span>&nbsp;<span class="ident" id="2501738"><a href="/strings/replace.go.html#2501688">err</a></span>&nbsp;<span class="op" id="2501742">!=</span>&nbsp;<span class="ident" id="2501745">nil</span>&nbsp;<span class="op" id="2501749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501755">return</span>&nbsp;<span class="ident" id="2501762"><a href="/strings/replace.go.html#2501529">n</a></span><span class="op" id="2501763">,</span>&nbsp;<span class="ident" id="2501765"><a href="/strings/replace.go.html#2501688">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501776">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501780"><a href="/strings/replace.go.html#2501576">last</a></span>&nbsp;<span class="op" id="2501785">=</span>&nbsp;<span class="ident" id="2501787"><a href="/strings/replace.go.html#2501591">i</a></span>&nbsp;<span class="op" id="2501789">+</span>&nbsp;<span class="num" id="2501791">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501795">nw</span><span class="op" id="2501797">,</span>&nbsp;<span class="ident" id="2501799">err</span>&nbsp;<span class="op" id="2501803">:=</span>&nbsp;<span class="ident" id="2501806"><a href="/strings/replace.go.html#2501505">w</a></span><span class="op" id="2501807">.</span><span class="ident" id="2501808">Write</span><span class="op" id="2501813">(</span><span class="ident" id="2501814"><a href="/strings/replace.go.html#2501470">r</a></span><span class="op" id="2501815">[</span><span class="ident" id="2501816"><a href="/strings/replace.go.html#2501619">b</a></span><span class="op" id="2501817">]</span><span class="op" id="2501818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501822"><a href="/strings/replace.go.html#2501529">n</a></span>&nbsp;<span class="op" id="2501824">+=</span>&nbsp;<span class="ident" id="2501827"><a href="/strings/replace.go.html#2501795">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501832">if</span>&nbsp;<span class="ident" id="2501835"><a href="/strings/replace.go.html#2501799">err</a></span>&nbsp;<span class="op" id="2501839">!=</span>&nbsp;<span class="ident" id="2501842">nil</span>&nbsp;<span class="op" id="2501846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501851">return</span>&nbsp;<span class="ident" id="2501858"><a href="/strings/replace.go.html#2501529">n</a></span><span class="op" id="2501859">,</span>&nbsp;<span class="ident" id="2501861"><a href="/strings/replace.go.html#2501799">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501873">if</span>&nbsp;<span class="ident" id="2501876"><a href="/strings/replace.go.html#2501576">last</a></span>&nbsp;<span class="op" id="2501881">!=</span>&nbsp;<span class="builtinfunc" id="2501884">len</span><span class="op" id="2501887">(</span><span class="ident" id="2501888"><a href="/strings/replace.go.html#2501518">s</a></span><span class="op" id="2501889">)</span>&nbsp;<span class="op" id="2501891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501895">var</span>&nbsp;<span class="ident" id="2501899">nw</span>&nbsp;<span class="builtintype" id="2501902">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501908"><a href="/strings/replace.go.html#2501899">nw</a></span><span class="op" id="2501910">,</span>&nbsp;<span class="ident" id="2501912"><a href="/strings/replace.go.html#2501536">err</a></span>&nbsp;<span class="op" id="2501916">=</span>&nbsp;<span class="ident" id="2501918"><a href="/strings/replace.go.html#2501550">sw</a></span><span class="op" id="2501920">.</span><span class="ident" id="2501921">WriteString</span><span class="op" id="2501932">(</span><span class="ident" id="2501933"><a href="/strings/replace.go.html#2501518">s</a></span><span class="op" id="2501934">[</span><span class="ident" id="2501935"><a href="/strings/replace.go.html#2501576">last</a></span><span class="op" id="2501939">:</span><span class="op" id="2501940">]</span><span class="op" id="2501941">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2501945"><a href="/strings/replace.go.html#2501529">n</a></span>&nbsp;<span class="op" id="2501947">+=</span>&nbsp;<span class="ident" id="2501950"><a href="/strings/replace.go.html#2501899">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2501954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2501957">return</span><br>
<span class="lineno"></span><span class="op" id="2501964">}</span>
</div>
</body>
</html>
