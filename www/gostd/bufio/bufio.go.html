<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html" class="current">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3449593">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3449648">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3449702">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3449753">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="3449831">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3449906">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="3449977">package</span>&nbsp;<span class="ident" id="3449985">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3449992">import</span>&nbsp;<span class="op" id="3449999">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3450002">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3450011">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3450021">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3450027">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3450042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3450045">const</span>&nbsp;<span class="op" id="3450051">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450054">defaultBufSize</span>&nbsp;<span class="op" id="3450069">=</span>&nbsp;<span class="num" id="3450071">4096</span><br>
<span class="lineno"></span><span class="op" id="3450076">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3450079">var</span>&nbsp;<span class="op" id="3450083">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450086">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="3450107">=</span>&nbsp;<span class="ident" id="3450109">errors</span><span class="op" id="3450115">.</span><span class="ident" id="3450116">New</span><span class="op" id="3450119">(</span><span class="string" id="3450120">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="3450154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450157">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="3450178">=</span>&nbsp;<span class="ident" id="3450180">errors</span><span class="op" id="3450186">.</span><span class="ident" id="3450187">New</span><span class="op" id="3450190">(</span><span class="string" id="3450191">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="3450225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450228">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3450249">=</span>&nbsp;<span class="ident" id="3450251">errors</span><span class="op" id="3450257">.</span><span class="ident" id="3450258">New</span><span class="op" id="3450261">(</span><span class="string" id="3450262">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="3450282">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450285">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3450306">=</span>&nbsp;<span class="ident" id="3450308">errors</span><span class="op" id="3450314">.</span><span class="ident" id="3450315">New</span><span class="op" id="3450318">(</span><span class="string" id="3450319">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="3450342">)</span><br>
<span class="lineno"></span><span class="op" id="3450344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3450347">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3450367">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="3450423">type</span>&nbsp;<span class="ident" id="3450428">Reader</span>&nbsp;<span class="keyword" id="3450435">struct</span>&nbsp;<span class="op" id="3450442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450445">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3450458">[</span><span class="op" id="3450459">]</span><span class="builtintype" id="3450460">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450466">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450479">io</span><span class="op" id="3450481">.</span><span class="ident" id="3450482">Reader</span>&nbsp;<span class="comment" id="3450489">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450523">r</span><span class="op" id="3450524">,</span>&nbsp;<span class="ident" id="3450526">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3450536">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3450546">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450579">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3450592">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450599">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3450612">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450617">lastRuneSize</span>&nbsp;<span class="builtintype" id="3450630">int</span><br>
<span class="lineno"></span><span class="op" id="3450634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3450637">const</span>&nbsp;<span class="ident" id="3450643">minReadBufferSize</span>&nbsp;<span class="op" id="3450661">=</span>&nbsp;<span class="num" id="3450663">16</span><br>
<span class="lineno"></span><span class="keyword" id="3450666">const</span>&nbsp;<span class="ident" id="3450672">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3450697">=</span>&nbsp;<span class="num" id="3450699">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3450704">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3450782">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="3450855">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="3450898">func</span>&nbsp;<span class="ident" id="3450903">NewReaderSize</span><span class="op" id="3450916">(</span><span class="ident" id="3450917">rd</span>&nbsp;<span class="ident" id="3450920">io</span><span class="op" id="3450922">.</span><span class="ident" id="3450923">Reader</span><span class="op" id="3450929">,</span>&nbsp;<span class="ident" id="3450931">size</span>&nbsp;<span class="builtintype" id="3450936">int</span><span class="op" id="3450939">)</span>&nbsp;<span class="op" id="3450941">*</span><span class="ident" id="3450942">Reader</span>&nbsp;<span class="op" id="3450949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3450952">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3450980">b</span><span class="op" id="3450981">,</span>&nbsp;<span class="ident" id="3450983">ok</span>&nbsp;<span class="op" id="3450986">:=</span>&nbsp;<span class="ident" id="3450989">rd</span><span class="op" id="3450991">.</span><span class="op" id="3450992">(</span><span class="op" id="3450993">*</span><span class="ident" id="3450994">Reader</span><span class="op" id="3451000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451003">if</span>&nbsp;<span class="ident" id="3451006">ok</span>&nbsp;<span class="op" id="3451009">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3451012">len</span><span class="op" id="3451015">(</span><span class="ident" id="3451016">b</span><span class="op" id="3451017">.</span><span class="ident" id="3451018">buf</span><span class="op" id="3451021">)</span>&nbsp;<span class="op" id="3451023">&gt;=</span>&nbsp;<span class="ident" id="3451026">size</span>&nbsp;<span class="op" id="3451031">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451035">return</span>&nbsp;<span class="ident" id="3451042">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451048">if</span>&nbsp;<span class="ident" id="3451051">size</span>&nbsp;<span class="op" id="3451056">&lt;</span>&nbsp;<span class="ident" id="3451058">minReadBufferSize</span>&nbsp;<span class="op" id="3451076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451080">size</span>&nbsp;<span class="op" id="3451085">=</span>&nbsp;<span class="ident" id="3451087">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451106">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451109">r</span>&nbsp;<span class="op" id="3451111">:=</span>&nbsp;<span class="builtinfunc" id="3451114">new</span><span class="op" id="3451117">(</span><span class="ident" id="3451118">Reader</span><span class="op" id="3451124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451127">r</span><span class="op" id="3451128">.</span><span class="ident" id="3451129">reset</span><span class="op" id="3451134">(</span><span class="builtinfunc" id="3451135">make</span><span class="op" id="3451139">(</span><span class="op" id="3451140">[</span><span class="op" id="3451141">]</span><span class="builtintype" id="3451142">byte</span><span class="op" id="3451146">,</span>&nbsp;<span class="ident" id="3451148">size</span><span class="op" id="3451152">)</span><span class="op" id="3451153">,</span>&nbsp;<span class="ident" id="3451155">rd</span><span class="op" id="3451157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451160">return</span>&nbsp;<span class="ident" id="3451167">r</span><br>
<span class="lineno"></span><span class="op" id="3451169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3451172">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3451241">func</span>&nbsp;<span class="ident" id="3451246">NewReader</span><span class="op" id="3451255">(</span><span class="ident" id="3451256">rd</span>&nbsp;<span class="ident" id="3451259">io</span><span class="op" id="3451261">.</span><span class="ident" id="3451262">Reader</span><span class="op" id="3451268">)</span>&nbsp;<span class="op" id="3451270">*</span><span class="ident" id="3451271">Reader</span>&nbsp;<span class="op" id="3451278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451281">return</span>&nbsp;<span class="ident" id="3451288">NewReaderSize</span><span class="op" id="3451301">(</span><span class="ident" id="3451302">rd</span><span class="op" id="3451304">,</span>&nbsp;<span class="ident" id="3451306">defaultBufSize</span><span class="op" id="3451320">)</span><br>
<span class="lineno"></span><span class="op" id="3451322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3451325">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="3451393">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3451432">func</span>&nbsp;<span class="op" id="3451437">(</span><span class="ident" id="3451438">b</span>&nbsp;<span class="op" id="3451440">*</span><span class="ident" id="3451441">Reader</span><span class="op" id="3451447">)</span>&nbsp;<span class="ident" id="3451449">Reset</span><span class="op" id="3451454">(</span><span class="ident" id="3451455">r</span>&nbsp;<span class="ident" id="3451457">io</span><span class="op" id="3451459">.</span><span class="ident" id="3451460">Reader</span><span class="op" id="3451466">)</span>&nbsp;<span class="op" id="3451468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451471">b</span><span class="op" id="3451472">.</span><span class="ident" id="3451473">reset</span><span class="op" id="3451478">(</span><span class="ident" id="3451479">b</span><span class="op" id="3451480">.</span><span class="ident" id="3451481">buf</span><span class="op" id="3451484">,</span>&nbsp;<span class="ident" id="3451486">r</span><span class="op" id="3451487">)</span><br>
<span class="lineno"></span><span class="op" id="3451489">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3451492">func</span>&nbsp;<span class="op" id="3451497">(</span><span class="ident" id="3451498">b</span>&nbsp;<span class="op" id="3451500">*</span><span class="ident" id="3451501">Reader</span><span class="op" id="3451507">)</span>&nbsp;<span class="ident" id="3451509">reset</span><span class="op" id="3451514">(</span><span class="ident" id="3451515">buf</span>&nbsp;<span class="op" id="3451519">[</span><span class="op" id="3451520">]</span><span class="builtintype" id="3451521">byte</span><span class="op" id="3451525">,</span>&nbsp;<span class="ident" id="3451527">r</span>&nbsp;<span class="ident" id="3451529">io</span><span class="op" id="3451531">.</span><span class="ident" id="3451532">Reader</span><span class="op" id="3451538">)</span>&nbsp;<span class="op" id="3451540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451543">*</span><span class="ident" id="3451544">b</span>&nbsp;<span class="op" id="3451546">=</span>&nbsp;<span class="ident" id="3451548">Reader</span><span class="op" id="3451554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451558">buf</span><span class="op" id="3451561">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451572">buf</span><span class="op" id="3451575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451579">rd</span><span class="op" id="3451581">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451593">r</span><span class="op" id="3451594">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451598">lastByte</span><span class="op" id="3451606">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451612">-</span><span class="num" id="3451613">1</span><span class="op" id="3451614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451618">lastRuneSize</span><span class="op" id="3451630">:</span>&nbsp;<span class="op" id="3451632">-</span><span class="num" id="3451633">1</span><span class="op" id="3451634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451637">}</span><br>
<span class="lineno"></span><span class="op" id="3451639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3451642">var</span>&nbsp;<span class="ident" id="3451646">errNegativeRead</span>&nbsp;<span class="op" id="3451662">=</span>&nbsp;<span class="ident" id="3451664">errors</span><span class="op" id="3451670">.</span><span class="ident" id="3451671">New</span><span class="op" id="3451674">(</span><span class="string" id="3451675">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="3451724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3451727">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3451770">func</span>&nbsp;<span class="op" id="3451775">(</span><span class="ident" id="3451776">b</span>&nbsp;<span class="op" id="3451778">*</span><span class="ident" id="3451779">Reader</span><span class="op" id="3451785">)</span>&nbsp;<span class="ident" id="3451787">fill</span><span class="op" id="3451791">(</span><span class="op" id="3451792">)</span>&nbsp;<span class="op" id="3451794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3451797">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451835">if</span>&nbsp;<span class="ident" id="3451838">b</span><span class="op" id="3451839">.</span><span class="ident" id="3451840">r</span>&nbsp;<span class="op" id="3451842">&gt;</span>&nbsp;<span class="num" id="3451844">0</span>&nbsp;<span class="op" id="3451846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3451850">copy</span><span class="op" id="3451854">(</span><span class="ident" id="3451855">b</span><span class="op" id="3451856">.</span><span class="ident" id="3451857">buf</span><span class="op" id="3451860">,</span>&nbsp;<span class="ident" id="3451862">b</span><span class="op" id="3451863">.</span><span class="ident" id="3451864">buf</span><span class="op" id="3451867">[</span><span class="ident" id="3451868">b</span><span class="op" id="3451869">.</span><span class="ident" id="3451870">r</span><span class="op" id="3451871">:</span><span class="ident" id="3451872">b</span><span class="op" id="3451873">.</span><span class="ident" id="3451874">w</span><span class="op" id="3451875">]</span><span class="op" id="3451876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451880">b</span><span class="op" id="3451881">.</span><span class="ident" id="3451882">w</span>&nbsp;<span class="op" id="3451884">-=</span>&nbsp;<span class="ident" id="3451887">b</span><span class="op" id="3451888">.</span><span class="ident" id="3451889">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3451893">b</span><span class="op" id="3451894">.</span><span class="ident" id="3451895">r</span>&nbsp;<span class="op" id="3451897">=</span>&nbsp;<span class="num" id="3451899">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451902">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3451906">if</span>&nbsp;<span class="ident" id="3451909">b</span><span class="op" id="3451910">.</span><span class="ident" id="3451911">w</span>&nbsp;<span class="op" id="3451913">&gt;=</span>&nbsp;<span class="builtinfunc" id="3451916">len</span><span class="op" id="3451919">(</span><span class="ident" id="3451920">b</span><span class="op" id="3451921">.</span><span class="ident" id="3451922">buf</span><span class="op" id="3451925">)</span>&nbsp;<span class="op" id="3451927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3451931">panic</span><span class="op" id="3451936">(</span><span class="string" id="3451937">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="3451971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3451974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3451978">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452028">for</span>&nbsp;<span class="ident" id="3452032">i</span>&nbsp;<span class="op" id="3452034">:=</span>&nbsp;<span class="ident" id="3452037">maxConsecutiveEmptyReads</span><span class="op" id="3452061">;</span>&nbsp;<span class="ident" id="3452063">i</span>&nbsp;<span class="op" id="3452065">&gt;</span>&nbsp;<span class="num" id="3452067">0</span><span class="op" id="3452068">;</span>&nbsp;<span class="ident" id="3452070">i</span><span class="op" id="3452071">--</span>&nbsp;<span class="op" id="3452074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452078">n</span><span class="op" id="3452079">,</span>&nbsp;<span class="ident" id="3452081">err</span>&nbsp;<span class="op" id="3452085">:=</span>&nbsp;<span class="ident" id="3452088">b</span><span class="op" id="3452089">.</span><span class="ident" id="3452090">rd</span><span class="op" id="3452092">.</span><span class="ident" id="3452093">Read</span><span class="op" id="3452097">(</span><span class="ident" id="3452098">b</span><span class="op" id="3452099">.</span><span class="ident" id="3452100">buf</span><span class="op" id="3452103">[</span><span class="ident" id="3452104">b</span><span class="op" id="3452105">.</span><span class="ident" id="3452106">w</span><span class="op" id="3452107">:</span><span class="op" id="3452108">]</span><span class="op" id="3452109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452113">if</span>&nbsp;<span class="ident" id="3452116">n</span>&nbsp;<span class="op" id="3452118">&lt;</span>&nbsp;<span class="num" id="3452120">0</span>&nbsp;<span class="op" id="3452122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3452127">panic</span><span class="op" id="3452132">(</span><span class="ident" id="3452133">errNegativeRead</span><span class="op" id="3452148">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452156">b</span><span class="op" id="3452157">.</span><span class="ident" id="3452158">w</span>&nbsp;<span class="op" id="3452160">+=</span>&nbsp;<span class="ident" id="3452163">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452167">if</span>&nbsp;<span class="ident" id="3452170">err</span>&nbsp;<span class="op" id="3452174">!=</span>&nbsp;<span class="builtintype" id="3452177">nil</span>&nbsp;<span class="op" id="3452181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452186">b</span><span class="op" id="3452187">.</span><span class="ident" id="3452188">err</span>&nbsp;<span class="op" id="3452192">=</span>&nbsp;<span class="ident" id="3452194">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452201">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452214">if</span>&nbsp;<span class="ident" id="3452217">n</span>&nbsp;<span class="op" id="3452219">&gt;</span>&nbsp;<span class="num" id="3452221">0</span>&nbsp;<span class="op" id="3452223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452228">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452240">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452243">b</span><span class="op" id="3452244">.</span><span class="ident" id="3452245">err</span>&nbsp;<span class="op" id="3452249">=</span>&nbsp;<span class="ident" id="3452251">io</span><span class="op" id="3452253">.</span><span class="ident" id="3452254">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="3452268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3452271">func</span>&nbsp;<span class="op" id="3452276">(</span><span class="ident" id="3452277">b</span>&nbsp;<span class="op" id="3452279">*</span><span class="ident" id="3452280">Reader</span><span class="op" id="3452286">)</span>&nbsp;<span class="ident" id="3452288">readErr</span><span class="op" id="3452295">(</span><span class="op" id="3452296">)</span>&nbsp;<span class="builtintype" id="3452298">error</span>&nbsp;<span class="op" id="3452304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452307">err</span>&nbsp;<span class="op" id="3452311">:=</span>&nbsp;<span class="ident" id="3452314">b</span><span class="op" id="3452315">.</span><span class="ident" id="3452316">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452321">b</span><span class="op" id="3452322">.</span><span class="ident" id="3452323">err</span>&nbsp;<span class="op" id="3452327">=</span>&nbsp;<span class="builtintype" id="3452329">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452334">return</span>&nbsp;<span class="ident" id="3452341">err</span><br>
<span class="lineno"></span><span class="op" id="3452345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3452348">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="3452426">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3452503">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3452575">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3452629">func</span>&nbsp;<span class="op" id="3452634">(</span><span class="ident" id="3452635">b</span>&nbsp;<span class="op" id="3452637">*</span><span class="ident" id="3452638">Reader</span><span class="op" id="3452644">)</span>&nbsp;<span class="ident" id="3452646">Peek</span><span class="op" id="3452650">(</span><span class="ident" id="3452651">n</span>&nbsp;<span class="builtintype" id="3452653">int</span><span class="op" id="3452656">)</span>&nbsp;<span class="op" id="3452658">(</span><span class="op" id="3452659">[</span><span class="op" id="3452660">]</span><span class="builtintype" id="3452661">byte</span><span class="op" id="3452665">,</span>&nbsp;<span class="builtintype" id="3452667">error</span><span class="op" id="3452672">)</span>&nbsp;<span class="op" id="3452674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452677">if</span>&nbsp;<span class="ident" id="3452680">n</span>&nbsp;<span class="op" id="3452682">&lt;</span>&nbsp;<span class="num" id="3452684">0</span>&nbsp;<span class="op" id="3452686">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452690">return</span>&nbsp;<span class="builtintype" id="3452697">nil</span><span class="op" id="3452700">,</span>&nbsp;<span class="ident" id="3452702">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452723">if</span>&nbsp;<span class="ident" id="3452726">n</span>&nbsp;<span class="op" id="3452728">&gt;</span>&nbsp;<span class="builtinfunc" id="3452730">len</span><span class="op" id="3452733">(</span><span class="ident" id="3452734">b</span><span class="op" id="3452735">.</span><span class="ident" id="3452736">buf</span><span class="op" id="3452739">)</span>&nbsp;<span class="op" id="3452741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452745">return</span>&nbsp;<span class="builtintype" id="3452752">nil</span><span class="op" id="3452755">,</span>&nbsp;<span class="ident" id="3452757">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452772">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3452775">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452800">for</span>&nbsp;<span class="ident" id="3452804">b</span><span class="op" id="3452805">.</span><span class="ident" id="3452806">w</span><span class="op" id="3452807">-</span><span class="ident" id="3452808">b</span><span class="op" id="3452809">.</span><span class="ident" id="3452810">r</span>&nbsp;<span class="op" id="3452812">&lt;</span>&nbsp;<span class="ident" id="3452814">n</span>&nbsp;<span class="op" id="3452816">&amp;&amp;</span>&nbsp;<span class="ident" id="3452819">b</span><span class="op" id="3452820">.</span><span class="ident" id="3452821">err</span>&nbsp;<span class="op" id="3452825">==</span>&nbsp;<span class="builtintype" id="3452828">nil</span>&nbsp;<span class="op" id="3452832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452836">b</span><span class="op" id="3452837">.</span><span class="ident" id="3452838">fill</span><span class="op" id="3452842">(</span><span class="op" id="3452843">)</span>&nbsp;<span class="comment" id="3452845">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3452892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452896">var</span>&nbsp;<span class="ident" id="3452900">err</span>&nbsp;<span class="builtintype" id="3452904">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3452911">if</span>&nbsp;<span class="ident" id="3452914">avail</span>&nbsp;<span class="op" id="3452920">:=</span>&nbsp;<span class="ident" id="3452923">b</span><span class="op" id="3452924">.</span><span class="ident" id="3452925">w</span>&nbsp;<span class="op" id="3452927">-</span>&nbsp;<span class="ident" id="3452929">b</span><span class="op" id="3452930">.</span><span class="ident" id="3452931">r</span><span class="op" id="3452932">;</span>&nbsp;<span class="ident" id="3452934">avail</span>&nbsp;<span class="op" id="3452940">&lt;</span>&nbsp;<span class="ident" id="3452942">n</span>&nbsp;<span class="op" id="3452944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3452948">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452979">n</span>&nbsp;<span class="op" id="3452981">=</span>&nbsp;<span class="ident" id="3452983">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3452991">err</span>&nbsp;<span class="op" id="3452995">=</span>&nbsp;<span class="ident" id="3452997">b</span><span class="op" id="3452998">.</span><span class="ident" id="3452999">readErr</span><span class="op" id="3453006">(</span><span class="op" id="3453007">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453011">if</span>&nbsp;<span class="ident" id="3453014">err</span>&nbsp;<span class="op" id="3453018">==</span>&nbsp;<span class="builtintype" id="3453021">nil</span>&nbsp;<span class="op" id="3453025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453030">err</span>&nbsp;<span class="op" id="3453034">=</span>&nbsp;<span class="ident" id="3453036">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453058">return</span>&nbsp;<span class="ident" id="3453065">b</span><span class="op" id="3453066">.</span><span class="ident" id="3453067">buf</span><span class="op" id="3453070">[</span><span class="ident" id="3453071">b</span><span class="op" id="3453072">.</span><span class="ident" id="3453073">r</span>&nbsp;<span class="op" id="3453075">:</span>&nbsp;<span class="ident" id="3453077">b</span><span class="op" id="3453078">.</span><span class="ident" id="3453079">r</span><span class="op" id="3453080">+</span><span class="ident" id="3453081">n</span><span class="op" id="3453082">]</span><span class="op" id="3453083">,</span>&nbsp;<span class="ident" id="3453085">err</span><br>
<span class="lineno">145</span><span class="op" id="3453089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3453092">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3453119">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="3453166">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="3453222">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="3453258">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="3453316">func</span>&nbsp;<span class="op" id="3453321">(</span><span class="ident" id="3453322">b</span>&nbsp;<span class="op" id="3453324">*</span><span class="ident" id="3453325">Reader</span><span class="op" id="3453331">)</span>&nbsp;<span class="ident" id="3453333">Read</span><span class="op" id="3453337">(</span><span class="ident" id="3453338">p</span>&nbsp;<span class="op" id="3453340">[</span><span class="op" id="3453341">]</span><span class="builtintype" id="3453342">byte</span><span class="op" id="3453346">)</span>&nbsp;<span class="op" id="3453348">(</span><span class="ident" id="3453349">n</span>&nbsp;<span class="builtintype" id="3453351">int</span><span class="op" id="3453354">,</span>&nbsp;<span class="ident" id="3453356">err</span>&nbsp;<span class="builtintype" id="3453360">error</span><span class="op" id="3453365">)</span>&nbsp;<span class="op" id="3453367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453370">n</span>&nbsp;<span class="op" id="3453372">=</span>&nbsp;<span class="builtinfunc" id="3453374">len</span><span class="op" id="3453377">(</span><span class="ident" id="3453378">p</span><span class="op" id="3453379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453382">if</span>&nbsp;<span class="ident" id="3453385">n</span>&nbsp;<span class="op" id="3453387">==</span>&nbsp;<span class="num" id="3453390">0</span>&nbsp;<span class="op" id="3453392">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453396">return</span>&nbsp;<span class="num" id="3453403">0</span><span class="op" id="3453404">,</span>&nbsp;<span class="ident" id="3453406">b</span><span class="op" id="3453407">.</span><span class="ident" id="3453408">readErr</span><span class="op" id="3453415">(</span><span class="op" id="3453416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453422">if</span>&nbsp;<span class="ident" id="3453425">b</span><span class="op" id="3453426">.</span><span class="ident" id="3453427">r</span>&nbsp;<span class="op" id="3453429">==</span>&nbsp;<span class="ident" id="3453432">b</span><span class="op" id="3453433">.</span><span class="ident" id="3453434">w</span>&nbsp;<span class="op" id="3453436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453440">if</span>&nbsp;<span class="ident" id="3453443">b</span><span class="op" id="3453444">.</span><span class="ident" id="3453445">err</span>&nbsp;<span class="op" id="3453449">!=</span>&nbsp;<span class="builtintype" id="3453452">nil</span>&nbsp;<span class="op" id="3453456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453461">return</span>&nbsp;<span class="num" id="3453468">0</span><span class="op" id="3453469">,</span>&nbsp;<span class="ident" id="3453471">b</span><span class="op" id="3453472">.</span><span class="ident" id="3453473">readErr</span><span class="op" id="3453480">(</span><span class="op" id="3453481">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453489">if</span>&nbsp;<span class="builtinfunc" id="3453492">len</span><span class="op" id="3453495">(</span><span class="ident" id="3453496">p</span><span class="op" id="3453497">)</span>&nbsp;<span class="op" id="3453499">&gt;=</span>&nbsp;<span class="builtinfunc" id="3453502">len</span><span class="op" id="3453505">(</span><span class="ident" id="3453506">b</span><span class="op" id="3453507">.</span><span class="ident" id="3453508">buf</span><span class="op" id="3453511">)</span>&nbsp;<span class="op" id="3453513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3453518">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3453550">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453592">n</span><span class="op" id="3453593">,</span>&nbsp;<span class="ident" id="3453595">b</span><span class="op" id="3453596">.</span><span class="ident" id="3453597">err</span>&nbsp;<span class="op" id="3453601">=</span>&nbsp;<span class="ident" id="3453603">b</span><span class="op" id="3453604">.</span><span class="ident" id="3453605">rd</span><span class="op" id="3453607">.</span><span class="ident" id="3453608">Read</span><span class="op" id="3453612">(</span><span class="ident" id="3453613">p</span><span class="op" id="3453614">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453619">if</span>&nbsp;<span class="ident" id="3453622">n</span>&nbsp;<span class="op" id="3453624">&lt;</span>&nbsp;<span class="num" id="3453626">0</span>&nbsp;<span class="op" id="3453628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3453634">panic</span><span class="op" id="3453639">(</span><span class="ident" id="3453640">errNegativeRead</span><span class="op" id="3453655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453665">if</span>&nbsp;<span class="ident" id="3453668">n</span>&nbsp;<span class="op" id="3453670">&gt;</span>&nbsp;<span class="num" id="3453672">0</span>&nbsp;<span class="op" id="3453674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453680">b</span><span class="op" id="3453681">.</span><span class="ident" id="3453682">lastByte</span>&nbsp;<span class="op" id="3453691">=</span>&nbsp;<span class="builtintype" id="3453693">int</span><span class="op" id="3453696">(</span><span class="ident" id="3453697">p</span><span class="op" id="3453698">[</span><span class="ident" id="3453699">n</span><span class="op" id="3453700">-</span><span class="num" id="3453701">1</span><span class="op" id="3453702">]</span><span class="op" id="3453703">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453709">b</span><span class="op" id="3453710">.</span><span class="ident" id="3453711">lastRuneSize</span>&nbsp;<span class="op" id="3453724">=</span>&nbsp;<span class="op" id="3453726">-</span><span class="num" id="3453727">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453737">return</span>&nbsp;<span class="ident" id="3453744">n</span><span class="op" id="3453745">,</span>&nbsp;<span class="ident" id="3453747">b</span><span class="op" id="3453748">.</span><span class="ident" id="3453749">readErr</span><span class="op" id="3453756">(</span><span class="op" id="3453757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453765">b</span><span class="op" id="3453766">.</span><span class="ident" id="3453767">fill</span><span class="op" id="3453771">(</span><span class="op" id="3453772">)</span>&nbsp;<span class="comment" id="3453774">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453795">if</span>&nbsp;<span class="ident" id="3453798">b</span><span class="op" id="3453799">.</span><span class="ident" id="3453800">r</span>&nbsp;<span class="op" id="3453802">==</span>&nbsp;<span class="ident" id="3453805">b</span><span class="op" id="3453806">.</span><span class="ident" id="3453807">w</span>&nbsp;<span class="op" id="3453809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453814">return</span>&nbsp;<span class="num" id="3453821">0</span><span class="op" id="3453822">,</span>&nbsp;<span class="ident" id="3453824">b</span><span class="op" id="3453825">.</span><span class="ident" id="3453826">readErr</span><span class="op" id="3453833">(</span><span class="op" id="3453834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3453841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3453845">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453872">n</span>&nbsp;<span class="op" id="3453874">=</span>&nbsp;<span class="builtinfunc" id="3453876">copy</span><span class="op" id="3453880">(</span><span class="ident" id="3453881">p</span><span class="op" id="3453882">,</span>&nbsp;<span class="ident" id="3453884">b</span><span class="op" id="3453885">.</span><span class="ident" id="3453886">buf</span><span class="op" id="3453889">[</span><span class="ident" id="3453890">b</span><span class="op" id="3453891">.</span><span class="ident" id="3453892">r</span><span class="op" id="3453893">:</span><span class="ident" id="3453894">b</span><span class="op" id="3453895">.</span><span class="ident" id="3453896">w</span><span class="op" id="3453897">]</span><span class="op" id="3453898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453901">b</span><span class="op" id="3453902">.</span><span class="ident" id="3453903">r</span>&nbsp;<span class="op" id="3453905">+=</span>&nbsp;<span class="ident" id="3453908">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453911">b</span><span class="op" id="3453912">.</span><span class="ident" id="3453913">lastByte</span>&nbsp;<span class="op" id="3453922">=</span>&nbsp;<span class="builtintype" id="3453924">int</span><span class="op" id="3453927">(</span><span class="ident" id="3453928">b</span><span class="op" id="3453929">.</span><span class="ident" id="3453930">buf</span><span class="op" id="3453933">[</span><span class="ident" id="3453934">b</span><span class="op" id="3453935">.</span><span class="ident" id="3453936">r</span><span class="op" id="3453937">-</span><span class="num" id="3453938">1</span><span class="op" id="3453939">]</span><span class="op" id="3453940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453943">b</span><span class="op" id="3453944">.</span><span class="ident" id="3453945">lastRuneSize</span>&nbsp;<span class="op" id="3453958">=</span>&nbsp;<span class="op" id="3453960">-</span><span class="num" id="3453961">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3453964">return</span>&nbsp;<span class="ident" id="3453971">n</span><span class="op" id="3453972">,</span>&nbsp;<span class="builtintype" id="3453974">nil</span><br>
<span class="lineno"></span><span class="op" id="3453978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3453981">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="3454026">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="3454072">func</span>&nbsp;<span class="op" id="3454077">(</span><span class="ident" id="3454078">b</span>&nbsp;<span class="op" id="3454080">*</span><span class="ident" id="3454081">Reader</span><span class="op" id="3454087">)</span>&nbsp;<span class="ident" id="3454089">ReadByte</span><span class="op" id="3454097">(</span><span class="op" id="3454098">)</span>&nbsp;<span class="op" id="3454100">(</span><span class="ident" id="3454101">c</span>&nbsp;<span class="builtintype" id="3454103">byte</span><span class="op" id="3454107">,</span>&nbsp;<span class="ident" id="3454109">err</span>&nbsp;<span class="builtintype" id="3454113">error</span><span class="op" id="3454118">)</span>&nbsp;<span class="op" id="3454120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454123">b</span><span class="op" id="3454124">.</span><span class="ident" id="3454125">lastRuneSize</span>&nbsp;<span class="op" id="3454138">=</span>&nbsp;<span class="op" id="3454140">-</span><span class="num" id="3454141">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454144">for</span>&nbsp;<span class="ident" id="3454148">b</span><span class="op" id="3454149">.</span><span class="ident" id="3454150">r</span>&nbsp;<span class="op" id="3454152">==</span>&nbsp;<span class="ident" id="3454155">b</span><span class="op" id="3454156">.</span><span class="ident" id="3454157">w</span>&nbsp;<span class="op" id="3454159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454163">if</span>&nbsp;<span class="ident" id="3454166">b</span><span class="op" id="3454167">.</span><span class="ident" id="3454168">err</span>&nbsp;<span class="op" id="3454172">!=</span>&nbsp;<span class="builtintype" id="3454175">nil</span>&nbsp;<span class="op" id="3454179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454184">return</span>&nbsp;<span class="num" id="3454191">0</span><span class="op" id="3454192">,</span>&nbsp;<span class="ident" id="3454194">b</span><span class="op" id="3454195">.</span><span class="ident" id="3454196">readErr</span><span class="op" id="3454203">(</span><span class="op" id="3454204">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454212">b</span><span class="op" id="3454213">.</span><span class="ident" id="3454214">fill</span><span class="op" id="3454218">(</span><span class="op" id="3454219">)</span>&nbsp;<span class="comment" id="3454221">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454244">c</span>&nbsp;<span class="op" id="3454246">=</span>&nbsp;<span class="ident" id="3454248">b</span><span class="op" id="3454249">.</span><span class="ident" id="3454250">buf</span><span class="op" id="3454253">[</span><span class="ident" id="3454254">b</span><span class="op" id="3454255">.</span><span class="ident" id="3454256">r</span><span class="op" id="3454257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454260">b</span><span class="op" id="3454261">.</span><span class="ident" id="3454262">r</span><span class="op" id="3454263">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454267">b</span><span class="op" id="3454268">.</span><span class="ident" id="3454269">lastByte</span>&nbsp;<span class="op" id="3454278">=</span>&nbsp;<span class="builtintype" id="3454280">int</span><span class="op" id="3454283">(</span><span class="ident" id="3454284">c</span><span class="op" id="3454285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454288">return</span>&nbsp;<span class="ident" id="3454295">c</span><span class="op" id="3454296">,</span>&nbsp;<span class="builtintype" id="3454298">nil</span><br>
<span class="lineno"></span><span class="op" id="3454302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3454305">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="3454391">func</span>&nbsp;<span class="op" id="3454396">(</span><span class="ident" id="3454397">b</span>&nbsp;<span class="op" id="3454399">*</span><span class="ident" id="3454400">Reader</span><span class="op" id="3454406">)</span>&nbsp;<span class="ident" id="3454408">UnreadByte</span><span class="op" id="3454418">(</span><span class="op" id="3454419">)</span>&nbsp;<span class="builtintype" id="3454421">error</span>&nbsp;<span class="op" id="3454427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454430">if</span>&nbsp;<span class="ident" id="3454433">b</span><span class="op" id="3454434">.</span><span class="ident" id="3454435">lastByte</span>&nbsp;<span class="op" id="3454444">&lt;</span>&nbsp;<span class="num" id="3454446">0</span>&nbsp;<span class="op" id="3454448">||</span>&nbsp;<span class="ident" id="3454451">b</span><span class="op" id="3454452">.</span><span class="ident" id="3454453">r</span>&nbsp;<span class="op" id="3454455">==</span>&nbsp;<span class="num" id="3454458">0</span>&nbsp;<span class="op" id="3454460">&amp;&amp;</span>&nbsp;<span class="ident" id="3454463">b</span><span class="op" id="3454464">.</span><span class="ident" id="3454465">w</span>&nbsp;<span class="op" id="3454467">&gt;</span>&nbsp;<span class="num" id="3454469">0</span>&nbsp;<span class="op" id="3454471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454475">return</span>&nbsp;<span class="ident" id="3454482">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3454507">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454531">if</span>&nbsp;<span class="ident" id="3454534">b</span><span class="op" id="3454535">.</span><span class="ident" id="3454536">r</span>&nbsp;<span class="op" id="3454538">&gt;</span>&nbsp;<span class="num" id="3454540">0</span>&nbsp;<span class="op" id="3454542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454546">b</span><span class="op" id="3454547">.</span><span class="ident" id="3454548">r</span><span class="op" id="3454549">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454553">}</span>&nbsp;<span class="keyword" id="3454555">else</span>&nbsp;<span class="op" id="3454560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3454564">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454590">b</span><span class="op" id="3454591">.</span><span class="ident" id="3454592">w</span>&nbsp;<span class="op" id="3454594">=</span>&nbsp;<span class="num" id="3454596">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3454599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454602">b</span><span class="op" id="3454603">.</span><span class="ident" id="3454604">buf</span><span class="op" id="3454607">[</span><span class="ident" id="3454608">b</span><span class="op" id="3454609">.</span><span class="ident" id="3454610">r</span><span class="op" id="3454611">]</span>&nbsp;<span class="op" id="3454613">=</span>&nbsp;<span class="builtintype" id="3454615">byte</span><span class="op" id="3454619">(</span><span class="ident" id="3454620">b</span><span class="op" id="3454621">.</span><span class="ident" id="3454622">lastByte</span><span class="op" id="3454630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454633">b</span><span class="op" id="3454634">.</span><span class="ident" id="3454635">lastByte</span>&nbsp;<span class="op" id="3454644">=</span>&nbsp;<span class="op" id="3454646">-</span><span class="num" id="3454647">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3454650">b</span><span class="op" id="3454651">.</span><span class="ident" id="3454652">lastRuneSize</span>&nbsp;<span class="op" id="3454665">=</span>&nbsp;<span class="op" id="3454667">-</span><span class="num" id="3454668">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454671">return</span>&nbsp;<span class="builtintype" id="3454678">nil</span><br>
<span class="lineno">220</span><span class="op" id="3454682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3454685">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3454760">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3454844">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="3454910">func</span>&nbsp;<span class="op" id="3454915">(</span><span class="ident" id="3454916">b</span>&nbsp;<span class="op" id="3454918">*</span><span class="ident" id="3454919">Reader</span><span class="op" id="3454925">)</span>&nbsp;<span class="ident" id="3454927">ReadRune</span><span class="op" id="3454935">(</span><span class="op" id="3454936">)</span>&nbsp;<span class="op" id="3454938">(</span><span class="ident" id="3454939">r</span>&nbsp;<span class="builtintype" id="3454941">rune</span><span class="op" id="3454945">,</span>&nbsp;<span class="ident" id="3454947">size</span>&nbsp;<span class="builtintype" id="3454952">int</span><span class="op" id="3454955">,</span>&nbsp;<span class="ident" id="3454957">err</span>&nbsp;<span class="builtintype" id="3454961">error</span><span class="op" id="3454966">)</span>&nbsp;<span class="op" id="3454968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3454971">for</span>&nbsp;<span class="ident" id="3454975">b</span><span class="op" id="3454976">.</span><span class="ident" id="3454977">r</span><span class="op" id="3454978">+</span><span class="ident" id="3454979">utf8</span><span class="op" id="3454983">.</span><span class="ident" id="3454984">UTFMax</span>&nbsp;<span class="op" id="3454991">&gt;</span>&nbsp;<span class="ident" id="3454993">b</span><span class="op" id="3454994">.</span><span class="ident" id="3454995">w</span>&nbsp;<span class="op" id="3454997">&amp;&amp;</span>&nbsp;<span class="op" id="3455000">!</span><span class="ident" id="3455001">utf8</span><span class="op" id="3455005">.</span><span class="ident" id="3455006">FullRune</span><span class="op" id="3455014">(</span><span class="ident" id="3455015">b</span><span class="op" id="3455016">.</span><span class="ident" id="3455017">buf</span><span class="op" id="3455020">[</span><span class="ident" id="3455021">b</span><span class="op" id="3455022">.</span><span class="ident" id="3455023">r</span><span class="op" id="3455024">:</span><span class="ident" id="3455025">b</span><span class="op" id="3455026">.</span><span class="ident" id="3455027">w</span><span class="op" id="3455028">]</span><span class="op" id="3455029">)</span>&nbsp;<span class="op" id="3455031">&amp;&amp;</span>&nbsp;<span class="ident" id="3455034">b</span><span class="op" id="3455035">.</span><span class="ident" id="3455036">err</span>&nbsp;<span class="op" id="3455040">==</span>&nbsp;<span class="builtintype" id="3455043">nil</span>&nbsp;<span class="op" id="3455047">&amp;&amp;</span>&nbsp;<span class="ident" id="3455050">b</span><span class="op" id="3455051">.</span><span class="ident" id="3455052">w</span><span class="op" id="3455053">-</span><span class="ident" id="3455054">b</span><span class="op" id="3455055">.</span><span class="ident" id="3455056">r</span>&nbsp;<span class="op" id="3455058">&lt;</span>&nbsp;<span class="builtinfunc" id="3455060">len</span><span class="op" id="3455063">(</span><span class="ident" id="3455064">b</span><span class="op" id="3455065">.</span><span class="ident" id="3455066">buf</span><span class="op" id="3455069">)</span>&nbsp;<span class="op" id="3455071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455075">b</span><span class="op" id="3455076">.</span><span class="ident" id="3455077">fill</span><span class="op" id="3455081">(</span><span class="op" id="3455082">)</span>&nbsp;<span class="comment" id="3455084">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455132">b</span><span class="op" id="3455133">.</span><span class="ident" id="3455134">lastRuneSize</span>&nbsp;<span class="op" id="3455147">=</span>&nbsp;<span class="op" id="3455149">-</span><span class="num" id="3455150">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455153">if</span>&nbsp;<span class="ident" id="3455156">b</span><span class="op" id="3455157">.</span><span class="ident" id="3455158">r</span>&nbsp;<span class="op" id="3455160">==</span>&nbsp;<span class="ident" id="3455163">b</span><span class="op" id="3455164">.</span><span class="ident" id="3455165">w</span>&nbsp;<span class="op" id="3455167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455171">return</span>&nbsp;<span class="num" id="3455178">0</span><span class="op" id="3455179">,</span>&nbsp;<span class="num" id="3455181">0</span><span class="op" id="3455182">,</span>&nbsp;<span class="ident" id="3455184">b</span><span class="op" id="3455185">.</span><span class="ident" id="3455186">readErr</span><span class="op" id="3455193">(</span><span class="op" id="3455194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455200">r</span><span class="op" id="3455201">,</span>&nbsp;<span class="ident" id="3455203">size</span>&nbsp;<span class="op" id="3455208">=</span>&nbsp;<span class="builtintype" id="3455210">rune</span><span class="op" id="3455214">(</span><span class="ident" id="3455215">b</span><span class="op" id="3455216">.</span><span class="ident" id="3455217">buf</span><span class="op" id="3455220">[</span><span class="ident" id="3455221">b</span><span class="op" id="3455222">.</span><span class="ident" id="3455223">r</span><span class="op" id="3455224">]</span><span class="op" id="3455225">)</span><span class="op" id="3455226">,</span>&nbsp;<span class="num" id="3455228">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455231">if</span>&nbsp;<span class="ident" id="3455234">r</span>&nbsp;<span class="op" id="3455236">&gt;=</span>&nbsp;<span class="num" id="3455239">0x80</span>&nbsp;<span class="op" id="3455244">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455248">r</span><span class="op" id="3455249">,</span>&nbsp;<span class="ident" id="3455251">size</span>&nbsp;<span class="op" id="3455256">=</span>&nbsp;<span class="ident" id="3455258">utf8</span><span class="op" id="3455262">.</span><span class="ident" id="3455263">DecodeRune</span><span class="op" id="3455273">(</span><span class="ident" id="3455274">b</span><span class="op" id="3455275">.</span><span class="ident" id="3455276">buf</span><span class="op" id="3455279">[</span><span class="ident" id="3455280">b</span><span class="op" id="3455281">.</span><span class="ident" id="3455282">r</span><span class="op" id="3455283">:</span><span class="ident" id="3455284">b</span><span class="op" id="3455285">.</span><span class="ident" id="3455286">w</span><span class="op" id="3455287">]</span><span class="op" id="3455288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455294">b</span><span class="op" id="3455295">.</span><span class="ident" id="3455296">r</span>&nbsp;<span class="op" id="3455298">+=</span>&nbsp;<span class="ident" id="3455301">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455307">b</span><span class="op" id="3455308">.</span><span class="ident" id="3455309">lastByte</span>&nbsp;<span class="op" id="3455318">=</span>&nbsp;<span class="builtintype" id="3455320">int</span><span class="op" id="3455323">(</span><span class="ident" id="3455324">b</span><span class="op" id="3455325">.</span><span class="ident" id="3455326">buf</span><span class="op" id="3455329">[</span><span class="ident" id="3455330">b</span><span class="op" id="3455331">.</span><span class="ident" id="3455332">r</span><span class="op" id="3455333">-</span><span class="num" id="3455334">1</span><span class="op" id="3455335">]</span><span class="op" id="3455336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455339">b</span><span class="op" id="3455340">.</span><span class="ident" id="3455341">lastRuneSize</span>&nbsp;<span class="op" id="3455354">=</span>&nbsp;<span class="ident" id="3455356">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455362">return</span>&nbsp;<span class="ident" id="3455369">r</span><span class="op" id="3455370">,</span>&nbsp;<span class="ident" id="3455372">size</span><span class="op" id="3455376">,</span>&nbsp;<span class="builtintype" id="3455378">nil</span><br>
<span class="lineno"></span><span class="op" id="3455382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3455385">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3455460">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="3455533">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3455607">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="3455636">func</span>&nbsp;<span class="op" id="3455641">(</span><span class="ident" id="3455642">b</span>&nbsp;<span class="op" id="3455644">*</span><span class="ident" id="3455645">Reader</span><span class="op" id="3455651">)</span>&nbsp;<span class="ident" id="3455653">UnreadRune</span><span class="op" id="3455663">(</span><span class="op" id="3455664">)</span>&nbsp;<span class="builtintype" id="3455666">error</span>&nbsp;<span class="op" id="3455672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455675">if</span>&nbsp;<span class="ident" id="3455678">b</span><span class="op" id="3455679">.</span><span class="ident" id="3455680">lastRuneSize</span>&nbsp;<span class="op" id="3455693">&lt;</span>&nbsp;<span class="num" id="3455695">0</span>&nbsp;<span class="op" id="3455697">||</span>&nbsp;<span class="ident" id="3455700">b</span><span class="op" id="3455701">.</span><span class="ident" id="3455702">r</span>&nbsp;<span class="op" id="3455704">&lt;</span>&nbsp;<span class="ident" id="3455706">b</span><span class="op" id="3455707">.</span><span class="ident" id="3455708">lastRuneSize</span>&nbsp;<span class="op" id="3455721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455725">return</span>&nbsp;<span class="ident" id="3455732">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3455754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455757">b</span><span class="op" id="3455758">.</span><span class="ident" id="3455759">r</span>&nbsp;<span class="op" id="3455761">-=</span>&nbsp;<span class="ident" id="3455764">b</span><span class="op" id="3455765">.</span><span class="ident" id="3455766">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455780">b</span><span class="op" id="3455781">.</span><span class="ident" id="3455782">lastByte</span>&nbsp;<span class="op" id="3455791">=</span>&nbsp;<span class="op" id="3455793">-</span><span class="num" id="3455794">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3455797">b</span><span class="op" id="3455798">.</span><span class="ident" id="3455799">lastRuneSize</span>&nbsp;<span class="op" id="3455812">=</span>&nbsp;<span class="op" id="3455814">-</span><span class="num" id="3455815">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3455818">return</span>&nbsp;<span class="builtintype" id="3455825">nil</span><br>
<span class="lineno">255</span><span class="op" id="3455829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3455832">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3455914">func</span>&nbsp;<span class="op" id="3455919">(</span><span class="ident" id="3455920">b</span>&nbsp;<span class="op" id="3455922">*</span><span class="ident" id="3455923">Reader</span><span class="op" id="3455929">)</span>&nbsp;<span class="ident" id="3455931">Buffered</span><span class="op" id="3455939">(</span><span class="op" id="3455940">)</span>&nbsp;<span class="builtintype" id="3455942">int</span>&nbsp;<span class="op" id="3455946">{</span>&nbsp;<span class="keyword" id="3455948">return</span>&nbsp;<span class="ident" id="3455955">b</span><span class="op" id="3455956">.</span><span class="ident" id="3455957">w</span>&nbsp;<span class="op" id="3455959">-</span>&nbsp;<span class="ident" id="3455961">b</span><span class="op" id="3455962">.</span><span class="ident" id="3455963">r</span>&nbsp;<span class="op" id="3455965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="3455968">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3456037">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3456095">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="3456143">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3456207">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="3456285">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3456366">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="3456430">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3456484">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="3456520">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="3456595">func</span>&nbsp;<span class="op" id="3456600">(</span><span class="ident" id="3456601">b</span>&nbsp;<span class="op" id="3456603">*</span><span class="ident" id="3456604">Reader</span><span class="op" id="3456610">)</span>&nbsp;<span class="ident" id="3456612">ReadSlice</span><span class="op" id="3456621">(</span><span class="ident" id="3456622">delim</span>&nbsp;<span class="builtintype" id="3456628">byte</span><span class="op" id="3456632">)</span>&nbsp;<span class="op" id="3456634">(</span><span class="ident" id="3456635">line</span>&nbsp;<span class="op" id="3456640">[</span><span class="op" id="3456641">]</span><span class="builtintype" id="3456642">byte</span><span class="op" id="3456646">,</span>&nbsp;<span class="ident" id="3456648">err</span>&nbsp;<span class="builtintype" id="3456652">error</span><span class="op" id="3456657">)</span>&nbsp;<span class="op" id="3456659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456662">for</span>&nbsp;<span class="op" id="3456666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456670">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456690">if</span>&nbsp;<span class="ident" id="3456693">i</span>&nbsp;<span class="op" id="3456695">:=</span>&nbsp;<span class="ident" id="3456698">bytes</span><span class="op" id="3456703">.</span><span class="ident" id="3456704">IndexByte</span><span class="op" id="3456713">(</span><span class="ident" id="3456714">b</span><span class="op" id="3456715">.</span><span class="ident" id="3456716">buf</span><span class="op" id="3456719">[</span><span class="ident" id="3456720">b</span><span class="op" id="3456721">.</span><span class="ident" id="3456722">r</span><span class="op" id="3456723">:</span><span class="ident" id="3456724">b</span><span class="op" id="3456725">.</span><span class="ident" id="3456726">w</span><span class="op" id="3456727">]</span><span class="op" id="3456728">,</span>&nbsp;<span class="ident" id="3456730">delim</span><span class="op" id="3456735">)</span><span class="op" id="3456736">;</span>&nbsp;<span class="ident" id="3456738">i</span>&nbsp;<span class="op" id="3456740">&gt;=</span>&nbsp;<span class="num" id="3456743">0</span>&nbsp;<span class="op" id="3456745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456750">line</span>&nbsp;<span class="op" id="3456755">=</span>&nbsp;<span class="ident" id="3456757">b</span><span class="op" id="3456758">.</span><span class="ident" id="3456759">buf</span><span class="op" id="3456762">[</span><span class="ident" id="3456763">b</span><span class="op" id="3456764">.</span><span class="ident" id="3456765">r</span>&nbsp;<span class="op" id="3456767">:</span>&nbsp;<span class="ident" id="3456769">b</span><span class="op" id="3456770">.</span><span class="ident" id="3456771">r</span><span class="op" id="3456772">+</span><span class="ident" id="3456773">i</span><span class="op" id="3456774">+</span><span class="num" id="3456775">1</span><span class="op" id="3456776">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456781">b</span><span class="op" id="3456782">.</span><span class="ident" id="3456783">r</span>&nbsp;<span class="op" id="3456785">+=</span>&nbsp;<span class="ident" id="3456788">i</span>&nbsp;<span class="op" id="3456790">+</span>&nbsp;<span class="num" id="3456792">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456797">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456810">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456830">if</span>&nbsp;<span class="ident" id="3456833">b</span><span class="op" id="3456834">.</span><span class="ident" id="3456835">err</span>&nbsp;<span class="op" id="3456839">!=</span>&nbsp;<span class="builtintype" id="3456842">nil</span>&nbsp;<span class="op" id="3456846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456851">line</span>&nbsp;<span class="op" id="3456856">=</span>&nbsp;<span class="ident" id="3456858">b</span><span class="op" id="3456859">.</span><span class="ident" id="3456860">buf</span><span class="op" id="3456863">[</span><span class="ident" id="3456864">b</span><span class="op" id="3456865">.</span><span class="ident" id="3456866">r</span><span class="op" id="3456867">:</span><span class="ident" id="3456868">b</span><span class="op" id="3456869">.</span><span class="ident" id="3456870">w</span><span class="op" id="3456871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456876">b</span><span class="op" id="3456877">.</span><span class="ident" id="3456878">r</span>&nbsp;<span class="op" id="3456880">=</span>&nbsp;<span class="ident" id="3456882">b</span><span class="op" id="3456883">.</span><span class="ident" id="3456884">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456889">err</span>&nbsp;<span class="op" id="3456893">=</span>&nbsp;<span class="ident" id="3456895">b</span><span class="op" id="3456896">.</span><span class="ident" id="3456897">readErr</span><span class="op" id="3456904">(</span><span class="op" id="3456905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456910">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3456918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3456923">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3456941">if</span>&nbsp;<span class="ident" id="3456944">b</span><span class="op" id="3456945">.</span><span class="ident" id="3456946">Buffered</span><span class="op" id="3456954">(</span><span class="op" id="3456955">)</span>&nbsp;<span class="op" id="3456957">&gt;=</span>&nbsp;<span class="builtinfunc" id="3456960">len</span><span class="op" id="3456963">(</span><span class="ident" id="3456964">b</span><span class="op" id="3456965">.</span><span class="ident" id="3456966">buf</span><span class="op" id="3456969">)</span>&nbsp;<span class="op" id="3456971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456976">b</span><span class="op" id="3456977">.</span><span class="ident" id="3456978">r</span>&nbsp;<span class="op" id="3456980">=</span>&nbsp;<span class="ident" id="3456982">b</span><span class="op" id="3456983">.</span><span class="ident" id="3456984">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3456989">line</span>&nbsp;<span class="op" id="3456994">=</span>&nbsp;<span class="ident" id="3456996">b</span><span class="op" id="3456997">.</span><span class="ident" id="3456998">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457005">err</span>&nbsp;<span class="op" id="3457009">=</span>&nbsp;<span class="ident" id="3457011">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457028">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457041">b</span><span class="op" id="3457042">.</span><span class="ident" id="3457043">fill</span><span class="op" id="3457047">(</span><span class="op" id="3457048">)</span>&nbsp;<span class="comment" id="3457050">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3457077">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457107">if</span>&nbsp;<span class="ident" id="3457110">i</span>&nbsp;<span class="op" id="3457112">:=</span>&nbsp;<span class="builtinfunc" id="3457115">len</span><span class="op" id="3457118">(</span><span class="ident" id="3457119">line</span><span class="op" id="3457123">)</span>&nbsp;<span class="op" id="3457125">-</span>&nbsp;<span class="num" id="3457127">1</span><span class="op" id="3457128">;</span>&nbsp;<span class="ident" id="3457130">i</span>&nbsp;<span class="op" id="3457132">&gt;=</span>&nbsp;<span class="num" id="3457135">0</span>&nbsp;<span class="op" id="3457137">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457141">b</span><span class="op" id="3457142">.</span><span class="ident" id="3457143">lastByte</span>&nbsp;<span class="op" id="3457152">=</span>&nbsp;<span class="builtintype" id="3457154">int</span><span class="op" id="3457157">(</span><span class="ident" id="3457158">line</span><span class="op" id="3457162">[</span><span class="ident" id="3457163">i</span><span class="op" id="3457164">]</span><span class="op" id="3457165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3457169">b</span><span class="op" id="3457170">.</span><span class="ident" id="3457171">lastRuneSize</span>&nbsp;<span class="op" id="3457184">=</span>&nbsp;<span class="op" id="3457186">-</span><span class="num" id="3457187">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3457190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3457194">return</span><br>
<span class="lineno">305</span><span class="op" id="3457201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3457204">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="3457279">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="3457344">//</span><br>
<span class="lineno">310</span><span class="comment" id="3457347">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3457427">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3457499">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3457575">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="3457653">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="3457726">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="3457802">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="3457817">//</span><br>
<span class="lineno"></span><span class="comment" id="3457820">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="3457903">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="3457982">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3458057">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3458134">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="3458176">func</span>&nbsp;<span class="op" id="3458181">(</span><span class="ident" id="3458182">b</span>&nbsp;<span class="op" id="3458184">*</span><span class="ident" id="3458185">Reader</span><span class="op" id="3458191">)</span>&nbsp;<span class="ident" id="3458193">ReadLine</span><span class="op" id="3458201">(</span><span class="op" id="3458202">)</span>&nbsp;<span class="op" id="3458204">(</span><span class="ident" id="3458205">line</span>&nbsp;<span class="op" id="3458210">[</span><span class="op" id="3458211">]</span><span class="builtintype" id="3458212">byte</span><span class="op" id="3458216">,</span>&nbsp;<span class="ident" id="3458218">isPrefix</span>&nbsp;<span class="builtintype" id="3458227">bool</span><span class="op" id="3458231">,</span>&nbsp;<span class="ident" id="3458233">err</span>&nbsp;<span class="builtintype" id="3458237">error</span><span class="op" id="3458242">)</span>&nbsp;<span class="op" id="3458244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458247">line</span><span class="op" id="3458251">,</span>&nbsp;<span class="ident" id="3458253">err</span>&nbsp;<span class="op" id="3458257">=</span>&nbsp;<span class="ident" id="3458259">b</span><span class="op" id="3458260">.</span><span class="ident" id="3458261">ReadSlice</span><span class="op" id="3458270">(</span><span class="string" id="3458271">&#39;\n&#39;</span><span class="op" id="3458275">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458278">if</span>&nbsp;<span class="ident" id="3458281">err</span>&nbsp;<span class="op" id="3458285">==</span>&nbsp;<span class="ident" id="3458288">ErrBufferFull</span>&nbsp;<span class="op" id="3458302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458306">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458362">if</span>&nbsp;<span class="builtinfunc" id="3458365">len</span><span class="op" id="3458368">(</span><span class="ident" id="3458369">line</span><span class="op" id="3458373">)</span>&nbsp;<span class="op" id="3458375">&gt;</span>&nbsp;<span class="num" id="3458377">0</span>&nbsp;<span class="op" id="3458379">&amp;&amp;</span>&nbsp;<span class="ident" id="3458382">line</span><span class="op" id="3458386">[</span><span class="builtinfunc" id="3458387">len</span><span class="op" id="3458390">(</span><span class="ident" id="3458391">line</span><span class="op" id="3458395">)</span><span class="op" id="3458396">-</span><span class="num" id="3458397">1</span><span class="op" id="3458398">]</span>&nbsp;<span class="op" id="3458400">==</span>&nbsp;<span class="string" id="3458403">&#39;\r&#39;</span>&nbsp;<span class="op" id="3458408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458413">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458467">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458521">if</span>&nbsp;<span class="ident" id="3458524">b</span><span class="op" id="3458525">.</span><span class="ident" id="3458526">r</span>&nbsp;<span class="op" id="3458528">==</span>&nbsp;<span class="num" id="3458531">0</span>&nbsp;<span class="op" id="3458533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3458539">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3458568">panic</span><span class="op" id="3458573">(</span><span class="string" id="3458574">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="3458619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458629">b</span><span class="op" id="3458630">.</span><span class="ident" id="3458631">r</span><span class="op" id="3458632">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458638">line</span>&nbsp;<span class="op" id="3458643">=</span>&nbsp;<span class="ident" id="3458645">line</span><span class="op" id="3458649">[</span><span class="op" id="3458650">:</span><span class="builtinfunc" id="3458651">len</span><span class="op" id="3458654">(</span><span class="ident" id="3458655">line</span><span class="op" id="3458659">)</span><span class="op" id="3458660">-</span><span class="num" id="3458661">1</span><span class="op" id="3458662">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458670">return</span>&nbsp;<span class="ident" id="3458677">line</span><span class="op" id="3458681">,</span>&nbsp;<span class="builtintype" id="3458683">true</span><span class="op" id="3458687">,</span>&nbsp;<span class="builtintype" id="3458689">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458698">if</span>&nbsp;<span class="builtinfunc" id="3458701">len</span><span class="op" id="3458704">(</span><span class="ident" id="3458705">line</span><span class="op" id="3458709">)</span>&nbsp;<span class="op" id="3458711">==</span>&nbsp;<span class="num" id="3458714">0</span>&nbsp;<span class="op" id="3458716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458720">if</span>&nbsp;<span class="ident" id="3458723">err</span>&nbsp;<span class="op" id="3458727">!=</span>&nbsp;<span class="builtintype" id="3458730">nil</span>&nbsp;<span class="op" id="3458734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458739">line</span>&nbsp;<span class="op" id="3458744">=</span>&nbsp;<span class="builtintype" id="3458746">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458756">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458767">err</span>&nbsp;<span class="op" id="3458771">=</span>&nbsp;<span class="builtintype" id="3458773">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458779">if</span>&nbsp;<span class="ident" id="3458782">line</span><span class="op" id="3458786">[</span><span class="builtinfunc" id="3458787">len</span><span class="op" id="3458790">(</span><span class="ident" id="3458791">line</span><span class="op" id="3458795">)</span><span class="op" id="3458796">-</span><span class="num" id="3458797">1</span><span class="op" id="3458798">]</span>&nbsp;<span class="op" id="3458800">==</span>&nbsp;<span class="string" id="3458803">&#39;\n&#39;</span>&nbsp;<span class="op" id="3458808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458812">drop</span>&nbsp;<span class="op" id="3458817">:=</span>&nbsp;<span class="num" id="3458820">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458824">if</span>&nbsp;<span class="builtinfunc" id="3458827">len</span><span class="op" id="3458830">(</span><span class="ident" id="3458831">line</span><span class="op" id="3458835">)</span>&nbsp;<span class="op" id="3458837">&gt;</span>&nbsp;<span class="num" id="3458839">1</span>&nbsp;<span class="op" id="3458841">&amp;&amp;</span>&nbsp;<span class="ident" id="3458844">line</span><span class="op" id="3458848">[</span><span class="builtinfunc" id="3458849">len</span><span class="op" id="3458852">(</span><span class="ident" id="3458853">line</span><span class="op" id="3458857">)</span><span class="op" id="3458858">-</span><span class="num" id="3458859">2</span><span class="op" id="3458860">]</span>&nbsp;<span class="op" id="3458862">==</span>&nbsp;<span class="string" id="3458865">&#39;\r&#39;</span>&nbsp;<span class="op" id="3458870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458875">drop</span>&nbsp;<span class="op" id="3458880">=</span>&nbsp;<span class="num" id="3458882">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3458890">line</span>&nbsp;<span class="op" id="3458895">=</span>&nbsp;<span class="ident" id="3458897">line</span><span class="op" id="3458901">[</span><span class="op" id="3458902">:</span><span class="builtinfunc" id="3458903">len</span><span class="op" id="3458906">(</span><span class="ident" id="3458907">line</span><span class="op" id="3458911">)</span><span class="op" id="3458912">-</span><span class="ident" id="3458913">drop</span><span class="op" id="3458917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3458920">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3458923">return</span><br>
<span class="lineno"></span><span class="op" id="3458930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3458933">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3459002">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="3459078">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3459142">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="3459224">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3459305">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3459315">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="3459369">func</span>&nbsp;<span class="op" id="3459374">(</span><span class="ident" id="3459375">b</span>&nbsp;<span class="op" id="3459377">*</span><span class="ident" id="3459378">Reader</span><span class="op" id="3459384">)</span>&nbsp;<span class="ident" id="3459386">ReadBytes</span><span class="op" id="3459395">(</span><span class="ident" id="3459396">delim</span>&nbsp;<span class="builtintype" id="3459402">byte</span><span class="op" id="3459406">)</span>&nbsp;<span class="op" id="3459408">(</span><span class="ident" id="3459409">line</span>&nbsp;<span class="op" id="3459414">[</span><span class="op" id="3459415">]</span><span class="builtintype" id="3459416">byte</span><span class="op" id="3459420">,</span>&nbsp;<span class="ident" id="3459422">err</span>&nbsp;<span class="builtintype" id="3459426">error</span><span class="op" id="3459431">)</span>&nbsp;<span class="op" id="3459433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3459436">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3459473">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459504">var</span>&nbsp;<span class="ident" id="3459508">frag</span>&nbsp;<span class="op" id="3459513">[</span><span class="op" id="3459514">]</span><span class="builtintype" id="3459515">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459521">var</span>&nbsp;<span class="ident" id="3459525">full</span>&nbsp;<span class="op" id="3459530">[</span><span class="op" id="3459531">]</span><span class="op" id="3459532">[</span><span class="op" id="3459533">]</span><span class="builtintype" id="3459534">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459540">err</span>&nbsp;<span class="op" id="3459544">=</span>&nbsp;<span class="builtintype" id="3459546">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459552">for</span>&nbsp;<span class="op" id="3459556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459560">var</span>&nbsp;<span class="ident" id="3459564">e</span>&nbsp;<span class="builtintype" id="3459566">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459574">frag</span><span class="op" id="3459578">,</span>&nbsp;<span class="ident" id="3459580">e</span>&nbsp;<span class="op" id="3459582">=</span>&nbsp;<span class="ident" id="3459584">b</span><span class="op" id="3459585">.</span><span class="ident" id="3459586">ReadSlice</span><span class="op" id="3459595">(</span><span class="ident" id="3459596">delim</span><span class="op" id="3459601">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459605">if</span>&nbsp;<span class="ident" id="3459608">e</span>&nbsp;<span class="op" id="3459610">==</span>&nbsp;<span class="builtintype" id="3459613">nil</span>&nbsp;<span class="op" id="3459617">{</span>&nbsp;<span class="comment" id="3459619">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459644">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3459652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459656">if</span>&nbsp;<span class="ident" id="3459659">e</span>&nbsp;<span class="op" id="3459661">!=</span>&nbsp;<span class="ident" id="3459664">ErrBufferFull</span>&nbsp;<span class="op" id="3459678">{</span>&nbsp;<span class="comment" id="3459680">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459703">err</span>&nbsp;<span class="op" id="3459707">=</span>&nbsp;<span class="ident" id="3459709">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459714">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3459722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3459727">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459759">buf</span>&nbsp;<span class="op" id="3459763">:=</span>&nbsp;<span class="builtinfunc" id="3459766">make</span><span class="op" id="3459770">(</span><span class="op" id="3459771">[</span><span class="op" id="3459772">]</span><span class="builtintype" id="3459773">byte</span><span class="op" id="3459777">,</span>&nbsp;<span class="builtinfunc" id="3459779">len</span><span class="op" id="3459782">(</span><span class="ident" id="3459783">frag</span><span class="op" id="3459787">)</span><span class="op" id="3459788">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3459792">copy</span><span class="op" id="3459796">(</span><span class="ident" id="3459797">buf</span><span class="op" id="3459800">,</span>&nbsp;<span class="ident" id="3459802">frag</span><span class="op" id="3459806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459810">full</span>&nbsp;<span class="op" id="3459815">=</span>&nbsp;<span class="builtinfunc" id="3459817">append</span><span class="op" id="3459823">(</span><span class="ident" id="3459824">full</span><span class="op" id="3459828">,</span>&nbsp;<span class="ident" id="3459830">buf</span><span class="op" id="3459833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3459836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3459840">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459906">n</span>&nbsp;<span class="op" id="3459908">:=</span>&nbsp;<span class="num" id="3459911">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3459914">for</span>&nbsp;<span class="ident" id="3459918">i</span>&nbsp;<span class="op" id="3459920">:=</span>&nbsp;<span class="keyword" id="3459923">range</span>&nbsp;<span class="ident" id="3459929">full</span>&nbsp;<span class="op" id="3459934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459938">n</span>&nbsp;<span class="op" id="3459940">+=</span>&nbsp;<span class="builtinfunc" id="3459943">len</span><span class="op" id="3459946">(</span><span class="ident" id="3459947">full</span><span class="op" id="3459951">[</span><span class="ident" id="3459952">i</span><span class="op" id="3459953">]</span><span class="op" id="3459954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3459957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3459960">n</span>&nbsp;<span class="op" id="3459962">+=</span>&nbsp;<span class="builtinfunc" id="3459965">len</span><span class="op" id="3459968">(</span><span class="ident" id="3459969">frag</span><span class="op" id="3459973">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3459977">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460015">buf</span>&nbsp;<span class="op" id="3460019">:=</span>&nbsp;<span class="builtinfunc" id="3460022">make</span><span class="op" id="3460026">(</span><span class="op" id="3460027">[</span><span class="op" id="3460028">]</span><span class="builtintype" id="3460029">byte</span><span class="op" id="3460033">,</span>&nbsp;<span class="ident" id="3460035">n</span><span class="op" id="3460036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460039">n</span>&nbsp;<span class="op" id="3460041">=</span>&nbsp;<span class="num" id="3460043">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460046">for</span>&nbsp;<span class="ident" id="3460050">i</span>&nbsp;<span class="op" id="3460052">:=</span>&nbsp;<span class="keyword" id="3460055">range</span>&nbsp;<span class="ident" id="3460061">full</span>&nbsp;<span class="op" id="3460066">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460070">n</span>&nbsp;<span class="op" id="3460072">+=</span>&nbsp;<span class="builtinfunc" id="3460075">copy</span><span class="op" id="3460079">(</span><span class="ident" id="3460080">buf</span><span class="op" id="3460083">[</span><span class="ident" id="3460084">n</span><span class="op" id="3460085">:</span><span class="op" id="3460086">]</span><span class="op" id="3460087">,</span>&nbsp;<span class="ident" id="3460089">full</span><span class="op" id="3460093">[</span><span class="ident" id="3460094">i</span><span class="op" id="3460095">]</span><span class="op" id="3460096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3460099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3460102">copy</span><span class="op" id="3460106">(</span><span class="ident" id="3460107">buf</span><span class="op" id="3460110">[</span><span class="ident" id="3460111">n</span><span class="op" id="3460112">:</span><span class="op" id="3460113">]</span><span class="op" id="3460114">,</span>&nbsp;<span class="ident" id="3460116">frag</span><span class="op" id="3460120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460123">return</span>&nbsp;<span class="ident" id="3460130">buf</span><span class="op" id="3460133">,</span>&nbsp;<span class="ident" id="3460135">err</span><br>
<span class="lineno"></span><span class="op" id="3460139">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3460142">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="3460212">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="3460289">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="3460354">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="3460436">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3460518">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="3460528">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="3460582">func</span>&nbsp;<span class="op" id="3460587">(</span><span class="ident" id="3460588">b</span>&nbsp;<span class="op" id="3460590">*</span><span class="ident" id="3460591">Reader</span><span class="op" id="3460597">)</span>&nbsp;<span class="ident" id="3460599">ReadString</span><span class="op" id="3460609">(</span><span class="ident" id="3460610">delim</span>&nbsp;<span class="builtintype" id="3460616">byte</span><span class="op" id="3460620">)</span>&nbsp;<span class="op" id="3460622">(</span><span class="ident" id="3460623">line</span>&nbsp;<span class="builtintype" id="3460628">string</span><span class="op" id="3460634">,</span>&nbsp;<span class="ident" id="3460636">err</span>&nbsp;<span class="builtintype" id="3460640">error</span><span class="op" id="3460645">)</span>&nbsp;<span class="op" id="3460647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460650">bytes</span><span class="op" id="3460655">,</span>&nbsp;<span class="ident" id="3460657">err</span>&nbsp;<span class="op" id="3460661">:=</span>&nbsp;<span class="ident" id="3460664">b</span><span class="op" id="3460665">.</span><span class="ident" id="3460666">ReadBytes</span><span class="op" id="3460675">(</span><span class="ident" id="3460676">delim</span><span class="op" id="3460681">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460684">line</span>&nbsp;<span class="op" id="3460689">=</span>&nbsp;<span class="builtintype" id="3460691">string</span><span class="op" id="3460697">(</span><span class="ident" id="3460698">bytes</span><span class="op" id="3460703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460706">return</span>&nbsp;<span class="ident" id="3460713">line</span><span class="op" id="3460717">,</span>&nbsp;<span class="ident" id="3460719">err</span><br>
<span class="lineno"></span><span class="op" id="3460723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3460726">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="3460761">func</span>&nbsp;<span class="op" id="3460766">(</span><span class="ident" id="3460767">b</span>&nbsp;<span class="op" id="3460769">*</span><span class="ident" id="3460770">Reader</span><span class="op" id="3460776">)</span>&nbsp;<span class="ident" id="3460778">WriteTo</span><span class="op" id="3460785">(</span><span class="ident" id="3460786">w</span>&nbsp;<span class="ident" id="3460788">io</span><span class="op" id="3460790">.</span><span class="ident" id="3460791">Writer</span><span class="op" id="3460797">)</span>&nbsp;<span class="op" id="3460799">(</span><span class="ident" id="3460800">n</span>&nbsp;<span class="ident" id="3460802">int64</span><span class="op" id="3460807">,</span>&nbsp;<span class="ident" id="3460809">err</span>&nbsp;<span class="builtintype" id="3460813">error</span><span class="op" id="3460818">)</span>&nbsp;<span class="op" id="3460820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460823">n</span><span class="op" id="3460824">,</span>&nbsp;<span class="ident" id="3460826">err</span>&nbsp;<span class="op" id="3460830">=</span>&nbsp;<span class="ident" id="3460832">b</span><span class="op" id="3460833">.</span><span class="ident" id="3460834">writeBuf</span><span class="op" id="3460842">(</span><span class="ident" id="3460843">w</span><span class="op" id="3460844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460847">if</span>&nbsp;<span class="ident" id="3460850">err</span>&nbsp;<span class="op" id="3460854">!=</span>&nbsp;<span class="builtintype" id="3460857">nil</span>&nbsp;<span class="op" id="3460861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460865">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3460873">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460877">if</span>&nbsp;<span class="ident" id="3460880">r</span><span class="op" id="3460881">,</span>&nbsp;<span class="ident" id="3460883">ok</span>&nbsp;<span class="op" id="3460886">:=</span>&nbsp;<span class="ident" id="3460889">b</span><span class="op" id="3460890">.</span><span class="ident" id="3460891">rd</span><span class="op" id="3460893">.</span><span class="op" id="3460894">(</span><span class="ident" id="3460895">io</span><span class="op" id="3460897">.</span><span class="ident" id="3460898">WriterTo</span><span class="op" id="3460906">)</span><span class="op" id="3460907">;</span>&nbsp;<span class="ident" id="3460909">ok</span>&nbsp;<span class="op" id="3460912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460916">m</span><span class="op" id="3460917">,</span>&nbsp;<span class="ident" id="3460919">err</span>&nbsp;<span class="op" id="3460923">:=</span>&nbsp;<span class="ident" id="3460926">r</span><span class="op" id="3460927">.</span><span class="ident" id="3460928">WriteTo</span><span class="op" id="3460935">(</span><span class="ident" id="3460936">w</span><span class="op" id="3460937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3460941">n</span>&nbsp;<span class="op" id="3460943">+=</span>&nbsp;<span class="ident" id="3460946">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460950">return</span>&nbsp;<span class="ident" id="3460957">n</span><span class="op" id="3460958">,</span>&nbsp;<span class="ident" id="3460960">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3460965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3460969">if</span>&nbsp;<span class="ident" id="3460972">w</span><span class="op" id="3460973">,</span>&nbsp;<span class="ident" id="3460975">ok</span>&nbsp;<span class="op" id="3460978">:=</span>&nbsp;<span class="ident" id="3460981">w</span><span class="op" id="3460982">.</span><span class="op" id="3460983">(</span><span class="ident" id="3460984">io</span><span class="op" id="3460986">.</span><span class="ident" id="3460987">ReaderFrom</span><span class="op" id="3460997">)</span><span class="op" id="3460998">;</span>&nbsp;<span class="ident" id="3461000">ok</span>&nbsp;<span class="op" id="3461003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461007">m</span><span class="op" id="3461008">,</span>&nbsp;<span class="ident" id="3461010">err</span>&nbsp;<span class="op" id="3461014">:=</span>&nbsp;<span class="ident" id="3461017">w</span><span class="op" id="3461018">.</span><span class="ident" id="3461019">ReadFrom</span><span class="op" id="3461027">(</span><span class="ident" id="3461028">b</span><span class="op" id="3461029">.</span><span class="ident" id="3461030">rd</span><span class="op" id="3461032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461036">n</span>&nbsp;<span class="op" id="3461038">+=</span>&nbsp;<span class="ident" id="3461041">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461045">return</span>&nbsp;<span class="ident" id="3461052">n</span><span class="op" id="3461053">,</span>&nbsp;<span class="ident" id="3461055">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461064">if</span>&nbsp;<span class="ident" id="3461067">b</span><span class="op" id="3461068">.</span><span class="ident" id="3461069">w</span><span class="op" id="3461070">-</span><span class="ident" id="3461071">b</span><span class="op" id="3461072">.</span><span class="ident" id="3461073">r</span>&nbsp;<span class="op" id="3461075">&lt;</span>&nbsp;<span class="builtinfunc" id="3461077">len</span><span class="op" id="3461080">(</span><span class="ident" id="3461081">b</span><span class="op" id="3461082">.</span><span class="ident" id="3461083">buf</span><span class="op" id="3461086">)</span>&nbsp;<span class="op" id="3461088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461092">b</span><span class="op" id="3461093">.</span><span class="ident" id="3461094">fill</span><span class="op" id="3461098">(</span><span class="op" id="3461099">)</span>&nbsp;<span class="comment" id="3461101">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461125">for</span>&nbsp;<span class="ident" id="3461129">b</span><span class="op" id="3461130">.</span><span class="ident" id="3461131">r</span>&nbsp;<span class="op" id="3461133">&lt;</span>&nbsp;<span class="ident" id="3461135">b</span><span class="op" id="3461136">.</span><span class="ident" id="3461137">w</span>&nbsp;<span class="op" id="3461139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3461143">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461181">m</span><span class="op" id="3461182">,</span>&nbsp;<span class="ident" id="3461184">err</span>&nbsp;<span class="op" id="3461188">:=</span>&nbsp;<span class="ident" id="3461191">b</span><span class="op" id="3461192">.</span><span class="ident" id="3461193">writeBuf</span><span class="op" id="3461201">(</span><span class="ident" id="3461202">w</span><span class="op" id="3461203">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461207">n</span>&nbsp;<span class="op" id="3461209">+=</span>&nbsp;<span class="ident" id="3461212">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461216">if</span>&nbsp;<span class="ident" id="3461219">err</span>&nbsp;<span class="op" id="3461223">!=</span>&nbsp;<span class="builtintype" id="3461226">nil</span>&nbsp;<span class="op" id="3461230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461235">return</span>&nbsp;<span class="ident" id="3461242">n</span><span class="op" id="3461243">,</span>&nbsp;<span class="ident" id="3461245">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461255">b</span><span class="op" id="3461256">.</span><span class="ident" id="3461257">fill</span><span class="op" id="3461261">(</span><span class="op" id="3461262">)</span>&nbsp;<span class="comment" id="3461264">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461288">if</span>&nbsp;<span class="ident" id="3461291">b</span><span class="op" id="3461292">.</span><span class="ident" id="3461293">err</span>&nbsp;<span class="op" id="3461297">==</span>&nbsp;<span class="ident" id="3461300">io</span><span class="op" id="3461302">.</span><span class="ident" id="3461303">EOF</span>&nbsp;<span class="op" id="3461307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461311">b</span><span class="op" id="3461312">.</span><span class="ident" id="3461313">err</span>&nbsp;<span class="op" id="3461317">=</span>&nbsp;<span class="builtintype" id="3461319">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461324">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461328">return</span>&nbsp;<span class="ident" id="3461335">n</span><span class="op" id="3461336">,</span>&nbsp;<span class="ident" id="3461338">b</span><span class="op" id="3461339">.</span><span class="ident" id="3461340">readErr</span><span class="op" id="3461347">(</span><span class="op" id="3461348">)</span><br>
<span class="lineno"></span><span class="op" id="3461350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3461353">var</span>&nbsp;<span class="ident" id="3461357">errNegativeWrite</span>&nbsp;<span class="op" id="3461374">=</span>&nbsp;<span class="ident" id="3461376">errors</span><span class="op" id="3461382">.</span><span class="ident" id="3461383">New</span><span class="op" id="3461386">(</span><span class="string" id="3461387">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="3461437">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="3461440">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3461494">func</span>&nbsp;<span class="op" id="3461499">(</span><span class="ident" id="3461500">b</span>&nbsp;<span class="op" id="3461502">*</span><span class="ident" id="3461503">Reader</span><span class="op" id="3461509">)</span>&nbsp;<span class="ident" id="3461511">writeBuf</span><span class="op" id="3461519">(</span><span class="ident" id="3461520">w</span>&nbsp;<span class="ident" id="3461522">io</span><span class="op" id="3461524">.</span><span class="ident" id="3461525">Writer</span><span class="op" id="3461531">)</span>&nbsp;<span class="op" id="3461533">(</span><span class="ident" id="3461534">int64</span><span class="op" id="3461539">,</span>&nbsp;<span class="builtintype" id="3461541">error</span><span class="op" id="3461546">)</span>&nbsp;<span class="op" id="3461548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461551">n</span><span class="op" id="3461552">,</span>&nbsp;<span class="ident" id="3461554">err</span>&nbsp;<span class="op" id="3461558">:=</span>&nbsp;<span class="ident" id="3461561">w</span><span class="op" id="3461562">.</span><span class="ident" id="3461563">Write</span><span class="op" id="3461568">(</span><span class="ident" id="3461569">b</span><span class="op" id="3461570">.</span><span class="ident" id="3461571">buf</span><span class="op" id="3461574">[</span><span class="ident" id="3461575">b</span><span class="op" id="3461576">.</span><span class="ident" id="3461577">r</span><span class="op" id="3461578">:</span><span class="ident" id="3461579">b</span><span class="op" id="3461580">.</span><span class="ident" id="3461581">w</span><span class="op" id="3461582">]</span><span class="op" id="3461583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461586">if</span>&nbsp;<span class="ident" id="3461589">n</span>&nbsp;<span class="op" id="3461591">&lt;</span>&nbsp;<span class="num" id="3461593">0</span>&nbsp;<span class="op" id="3461595">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3461599">panic</span><span class="op" id="3461604">(</span><span class="ident" id="3461605">errNegativeWrite</span><span class="op" id="3461621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3461624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3461627">b</span><span class="op" id="3461628">.</span><span class="ident" id="3461629">r</span>&nbsp;<span class="op" id="3461631">+=</span>&nbsp;<span class="ident" id="3461634">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3461637">return</span>&nbsp;<span class="ident" id="3461644">int64</span><span class="op" id="3461649">(</span><span class="ident" id="3461650">n</span><span class="op" id="3461651">)</span><span class="op" id="3461652">,</span>&nbsp;<span class="ident" id="3461654">err</span><br>
<span class="lineno"></span><span class="op" id="3461658">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="3461661">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3461681">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="3461737">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="3461801">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3461862">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3461925">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3461985">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3462014">type</span>&nbsp;<span class="ident" id="3462019">Writer</span>&nbsp;<span class="keyword" id="3462026">struct</span>&nbsp;<span class="op" id="3462033">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462036">err</span>&nbsp;<span class="builtintype" id="3462040">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462047">buf</span>&nbsp;<span class="op" id="3462051">[</span><span class="op" id="3462052">]</span><span class="builtintype" id="3462053">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462059">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3462063">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462068">wr</span>&nbsp;&nbsp;<span class="ident" id="3462072">io</span><span class="op" id="3462074">.</span><span class="ident" id="3462075">Writer</span><br>
<span class="lineno"></span><span class="op" id="3462082">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="3462085">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="3462163">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="3462236">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3462279">func</span>&nbsp;<span class="ident" id="3462284">NewWriterSize</span><span class="op" id="3462297">(</span><span class="ident" id="3462298">w</span>&nbsp;<span class="ident" id="3462300">io</span><span class="op" id="3462302">.</span><span class="ident" id="3462303">Writer</span><span class="op" id="3462309">,</span>&nbsp;<span class="ident" id="3462311">size</span>&nbsp;<span class="builtintype" id="3462316">int</span><span class="op" id="3462319">)</span>&nbsp;<span class="op" id="3462321">*</span><span class="ident" id="3462322">Writer</span>&nbsp;<span class="op" id="3462329">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3462332">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462360">b</span><span class="op" id="3462361">,</span>&nbsp;<span class="ident" id="3462363">ok</span>&nbsp;<span class="op" id="3462366">:=</span>&nbsp;<span class="ident" id="3462369">w</span><span class="op" id="3462370">.</span><span class="op" id="3462371">(</span><span class="op" id="3462372">*</span><span class="ident" id="3462373">Writer</span><span class="op" id="3462379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462382">if</span>&nbsp;<span class="ident" id="3462385">ok</span>&nbsp;<span class="op" id="3462388">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3462391">len</span><span class="op" id="3462394">(</span><span class="ident" id="3462395">b</span><span class="op" id="3462396">.</span><span class="ident" id="3462397">buf</span><span class="op" id="3462400">)</span>&nbsp;<span class="op" id="3462402">&gt;=</span>&nbsp;<span class="ident" id="3462405">size</span>&nbsp;<span class="op" id="3462410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462414">return</span>&nbsp;<span class="ident" id="3462421">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3462424">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462427">if</span>&nbsp;<span class="ident" id="3462430">size</span>&nbsp;<span class="op" id="3462435">&lt;=</span>&nbsp;<span class="num" id="3462438">0</span>&nbsp;<span class="op" id="3462440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462444">size</span>&nbsp;<span class="op" id="3462449">=</span>&nbsp;<span class="ident" id="3462451">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3462467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462470">return</span>&nbsp;<span class="op" id="3462477">&amp;</span><span class="ident" id="3462478">Writer</span><span class="op" id="3462484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462488">buf</span><span class="op" id="3462491">:</span>&nbsp;<span class="builtinfunc" id="3462493">make</span><span class="op" id="3462497">(</span><span class="op" id="3462498">[</span><span class="op" id="3462499">]</span><span class="builtintype" id="3462500">byte</span><span class="op" id="3462504">,</span>&nbsp;<span class="ident" id="3462506">size</span><span class="op" id="3462510">)</span><span class="op" id="3462511">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462515">wr</span><span class="op" id="3462517">:</span>&nbsp;&nbsp;<span class="ident" id="3462520">w</span><span class="op" id="3462521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3462524">}</span><br>
<span class="lineno"></span><span class="op" id="3462526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462529">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="3462598">func</span>&nbsp;<span class="ident" id="3462603">NewWriter</span><span class="op" id="3462612">(</span><span class="ident" id="3462613">w</span>&nbsp;<span class="ident" id="3462615">io</span><span class="op" id="3462617">.</span><span class="ident" id="3462618">Writer</span><span class="op" id="3462624">)</span>&nbsp;<span class="op" id="3462626">*</span><span class="ident" id="3462627">Writer</span>&nbsp;<span class="op" id="3462634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462637">return</span>&nbsp;<span class="ident" id="3462644">NewWriterSize</span><span class="op" id="3462657">(</span><span class="ident" id="3462658">w</span><span class="op" id="3462659">,</span>&nbsp;<span class="ident" id="3462661">defaultBufSize</span><span class="op" id="3462675">)</span><br>
<span class="lineno"></span><span class="op" id="3462677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462680">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="3462749">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3462787">func</span>&nbsp;<span class="op" id="3462792">(</span><span class="ident" id="3462793">b</span>&nbsp;<span class="op" id="3462795">*</span><span class="ident" id="3462796">Writer</span><span class="op" id="3462802">)</span>&nbsp;<span class="ident" id="3462804">Reset</span><span class="op" id="3462809">(</span><span class="ident" id="3462810">w</span>&nbsp;<span class="ident" id="3462812">io</span><span class="op" id="3462814">.</span><span class="ident" id="3462815">Writer</span><span class="op" id="3462821">)</span>&nbsp;<span class="op" id="3462823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462826">b</span><span class="op" id="3462827">.</span><span class="ident" id="3462828">err</span>&nbsp;<span class="op" id="3462832">=</span>&nbsp;<span class="builtintype" id="3462834">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462839">b</span><span class="op" id="3462840">.</span><span class="ident" id="3462841">n</span>&nbsp;<span class="op" id="3462843">=</span>&nbsp;<span class="num" id="3462845">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462848">b</span><span class="op" id="3462849">.</span><span class="ident" id="3462850">wr</span>&nbsp;<span class="op" id="3462853">=</span>&nbsp;<span class="ident" id="3462855">w</span><br>
<span class="lineno">515</span><span class="op" id="3462857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3462860">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="3462923">func</span>&nbsp;<span class="op" id="3462928">(</span><span class="ident" id="3462929">b</span>&nbsp;<span class="op" id="3462931">*</span><span class="ident" id="3462932">Writer</span><span class="op" id="3462938">)</span>&nbsp;<span class="ident" id="3462940">Flush</span><span class="op" id="3462945">(</span><span class="op" id="3462946">)</span>&nbsp;<span class="builtintype" id="3462948">error</span>&nbsp;<span class="op" id="3462954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3462957">err</span>&nbsp;<span class="op" id="3462961">:=</span>&nbsp;<span class="ident" id="3462964">b</span><span class="op" id="3462965">.</span><span class="ident" id="3462966">flush</span><span class="op" id="3462971">(</span><span class="op" id="3462972">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3462975">return</span>&nbsp;<span class="ident" id="3462982">err</span><br>
<span class="lineno"></span><span class="op" id="3462986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3462989">func</span>&nbsp;<span class="op" id="3462994">(</span><span class="ident" id="3462995">b</span>&nbsp;<span class="op" id="3462997">*</span><span class="ident" id="3462998">Writer</span><span class="op" id="3463004">)</span>&nbsp;<span class="ident" id="3463006">flush</span><span class="op" id="3463011">(</span><span class="op" id="3463012">)</span>&nbsp;<span class="builtintype" id="3463014">error</span>&nbsp;<span class="op" id="3463020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463023">if</span>&nbsp;<span class="ident" id="3463026">b</span><span class="op" id="3463027">.</span><span class="ident" id="3463028">err</span>&nbsp;<span class="op" id="3463032">!=</span>&nbsp;<span class="builtintype" id="3463035">nil</span>&nbsp;<span class="op" id="3463039">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463043">return</span>&nbsp;<span class="ident" id="3463050">b</span><span class="op" id="3463051">.</span><span class="ident" id="3463052">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463060">if</span>&nbsp;<span class="ident" id="3463063">b</span><span class="op" id="3463064">.</span><span class="ident" id="3463065">n</span>&nbsp;<span class="op" id="3463067">==</span>&nbsp;<span class="num" id="3463070">0</span>&nbsp;<span class="op" id="3463072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463076">return</span>&nbsp;<span class="builtintype" id="3463083">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463088">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463091">n</span><span class="op" id="3463092">,</span>&nbsp;<span class="ident" id="3463094">err</span>&nbsp;<span class="op" id="3463098">:=</span>&nbsp;<span class="ident" id="3463101">b</span><span class="op" id="3463102">.</span><span class="ident" id="3463103">wr</span><span class="op" id="3463105">.</span><span class="ident" id="3463106">Write</span><span class="op" id="3463111">(</span><span class="ident" id="3463112">b</span><span class="op" id="3463113">.</span><span class="ident" id="3463114">buf</span><span class="op" id="3463117">[</span><span class="num" id="3463118">0</span><span class="op" id="3463119">:</span><span class="ident" id="3463120">b</span><span class="op" id="3463121">.</span><span class="ident" id="3463122">n</span><span class="op" id="3463123">]</span><span class="op" id="3463124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463127">if</span>&nbsp;<span class="ident" id="3463130">n</span>&nbsp;<span class="op" id="3463132">&lt;</span>&nbsp;<span class="ident" id="3463134">b</span><span class="op" id="3463135">.</span><span class="ident" id="3463136">n</span>&nbsp;<span class="op" id="3463138">&amp;&amp;</span>&nbsp;<span class="ident" id="3463141">err</span>&nbsp;<span class="op" id="3463145">==</span>&nbsp;<span class="builtintype" id="3463148">nil</span>&nbsp;<span class="op" id="3463152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463156">err</span>&nbsp;<span class="op" id="3463160">=</span>&nbsp;<span class="ident" id="3463162">io</span><span class="op" id="3463164">.</span><span class="ident" id="3463165">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463183">if</span>&nbsp;<span class="ident" id="3463186">err</span>&nbsp;<span class="op" id="3463190">!=</span>&nbsp;<span class="builtintype" id="3463193">nil</span>&nbsp;<span class="op" id="3463197">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463201">if</span>&nbsp;<span class="ident" id="3463204">n</span>&nbsp;<span class="op" id="3463206">&gt;</span>&nbsp;<span class="num" id="3463208">0</span>&nbsp;<span class="op" id="3463210">&amp;&amp;</span>&nbsp;<span class="ident" id="3463213">n</span>&nbsp;<span class="op" id="3463215">&lt;</span>&nbsp;<span class="ident" id="3463217">b</span><span class="op" id="3463218">.</span><span class="ident" id="3463219">n</span>&nbsp;<span class="op" id="3463221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3463226">copy</span><span class="op" id="3463230">(</span><span class="ident" id="3463231">b</span><span class="op" id="3463232">.</span><span class="ident" id="3463233">buf</span><span class="op" id="3463236">[</span><span class="num" id="3463237">0</span><span class="op" id="3463238">:</span><span class="ident" id="3463239">b</span><span class="op" id="3463240">.</span><span class="ident" id="3463241">n</span><span class="op" id="3463242">-</span><span class="ident" id="3463243">n</span><span class="op" id="3463244">]</span><span class="op" id="3463245">,</span>&nbsp;<span class="ident" id="3463247">b</span><span class="op" id="3463248">.</span><span class="ident" id="3463249">buf</span><span class="op" id="3463252">[</span><span class="ident" id="3463253">n</span><span class="op" id="3463254">:</span><span class="ident" id="3463255">b</span><span class="op" id="3463256">.</span><span class="ident" id="3463257">n</span><span class="op" id="3463258">]</span><span class="op" id="3463259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463267">b</span><span class="op" id="3463268">.</span><span class="ident" id="3463269">n</span>&nbsp;<span class="op" id="3463271">-=</span>&nbsp;<span class="ident" id="3463274">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463278">b</span><span class="op" id="3463279">.</span><span class="ident" id="3463280">err</span>&nbsp;<span class="op" id="3463284">=</span>&nbsp;<span class="ident" id="3463286">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463292">return</span>&nbsp;<span class="ident" id="3463299">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3463304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463307">b</span><span class="op" id="3463308">.</span><span class="ident" id="3463309">n</span>&nbsp;<span class="op" id="3463311">=</span>&nbsp;<span class="num" id="3463313">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463316">return</span>&nbsp;<span class="builtintype" id="3463323">nil</span><br>
<span class="lineno"></span><span class="op" id="3463327">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="3463330">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="3463392">func</span>&nbsp;<span class="op" id="3463397">(</span><span class="ident" id="3463398">b</span>&nbsp;<span class="op" id="3463400">*</span><span class="ident" id="3463401">Writer</span><span class="op" id="3463407">)</span>&nbsp;<span class="ident" id="3463409">Available</span><span class="op" id="3463418">(</span><span class="op" id="3463419">)</span>&nbsp;<span class="builtintype" id="3463421">int</span>&nbsp;<span class="op" id="3463425">{</span>&nbsp;<span class="keyword" id="3463427">return</span>&nbsp;<span class="builtinfunc" id="3463434">len</span><span class="op" id="3463437">(</span><span class="ident" id="3463438">b</span><span class="op" id="3463439">.</span><span class="ident" id="3463440">buf</span><span class="op" id="3463443">)</span>&nbsp;<span class="op" id="3463445">-</span>&nbsp;<span class="ident" id="3463447">b</span><span class="op" id="3463448">.</span><span class="ident" id="3463449">n</span>&nbsp;<span class="op" id="3463451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463454">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="3463542">func</span>&nbsp;<span class="op" id="3463547">(</span><span class="ident" id="3463548">b</span>&nbsp;<span class="op" id="3463550">*</span><span class="ident" id="3463551">Writer</span><span class="op" id="3463557">)</span>&nbsp;<span class="ident" id="3463559">Buffered</span><span class="op" id="3463567">(</span><span class="op" id="3463568">)</span>&nbsp;<span class="builtintype" id="3463570">int</span>&nbsp;<span class="op" id="3463574">{</span>&nbsp;<span class="keyword" id="3463576">return</span>&nbsp;<span class="ident" id="3463583">b</span><span class="op" id="3463584">.</span><span class="ident" id="3463585">n</span>&nbsp;<span class="op" id="3463587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463590">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3463641">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3463684">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="3463739">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3463766">func</span>&nbsp;<span class="op" id="3463771">(</span><span class="ident" id="3463772">b</span>&nbsp;<span class="op" id="3463774">*</span><span class="ident" id="3463775">Writer</span><span class="op" id="3463781">)</span>&nbsp;<span class="ident" id="3463783">Write</span><span class="op" id="3463788">(</span><span class="ident" id="3463789">p</span>&nbsp;<span class="op" id="3463791">[</span><span class="op" id="3463792">]</span><span class="builtintype" id="3463793">byte</span><span class="op" id="3463797">)</span>&nbsp;<span class="op" id="3463799">(</span><span class="ident" id="3463800">nn</span>&nbsp;<span class="builtintype" id="3463803">int</span><span class="op" id="3463806">,</span>&nbsp;<span class="ident" id="3463808">err</span>&nbsp;<span class="builtintype" id="3463812">error</span><span class="op" id="3463817">)</span>&nbsp;<span class="op" id="3463819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463822">for</span>&nbsp;<span class="builtinfunc" id="3463826">len</span><span class="op" id="3463829">(</span><span class="ident" id="3463830">p</span><span class="op" id="3463831">)</span>&nbsp;<span class="op" id="3463833">&gt;</span>&nbsp;<span class="ident" id="3463835">b</span><span class="op" id="3463836">.</span><span class="ident" id="3463837">Available</span><span class="op" id="3463846">(</span><span class="op" id="3463847">)</span>&nbsp;<span class="op" id="3463849">&amp;&amp;</span>&nbsp;<span class="ident" id="3463852">b</span><span class="op" id="3463853">.</span><span class="ident" id="3463854">err</span>&nbsp;<span class="op" id="3463858">==</span>&nbsp;<span class="builtintype" id="3463861">nil</span>&nbsp;<span class="op" id="3463865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463869">var</span>&nbsp;<span class="ident" id="3463873">n</span>&nbsp;<span class="builtintype" id="3463875">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3463881">if</span>&nbsp;<span class="ident" id="3463884">b</span><span class="op" id="3463885">.</span><span class="ident" id="3463886">Buffered</span><span class="op" id="3463894">(</span><span class="op" id="3463895">)</span>&nbsp;<span class="op" id="3463897">==</span>&nbsp;<span class="num" id="3463900">0</span>&nbsp;<span class="op" id="3463902">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463907">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3463940">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3463983">n</span><span class="op" id="3463984">,</span>&nbsp;<span class="ident" id="3463986">b</span><span class="op" id="3463987">.</span><span class="ident" id="3463988">err</span>&nbsp;<span class="op" id="3463992">=</span>&nbsp;<span class="ident" id="3463994">b</span><span class="op" id="3463995">.</span><span class="ident" id="3463996">wr</span><span class="op" id="3463998">.</span><span class="ident" id="3463999">Write</span><span class="op" id="3464004">(</span><span class="ident" id="3464005">p</span><span class="op" id="3464006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464010">}</span>&nbsp;<span class="keyword" id="3464012">else</span>&nbsp;<span class="op" id="3464017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464022">n</span>&nbsp;<span class="op" id="3464024">=</span>&nbsp;<span class="builtinfunc" id="3464026">copy</span><span class="op" id="3464030">(</span><span class="ident" id="3464031">b</span><span class="op" id="3464032">.</span><span class="ident" id="3464033">buf</span><span class="op" id="3464036">[</span><span class="ident" id="3464037">b</span><span class="op" id="3464038">.</span><span class="ident" id="3464039">n</span><span class="op" id="3464040">:</span><span class="op" id="3464041">]</span><span class="op" id="3464042">,</span>&nbsp;<span class="ident" id="3464044">p</span><span class="op" id="3464045">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464050">b</span><span class="op" id="3464051">.</span><span class="ident" id="3464052">n</span>&nbsp;<span class="op" id="3464054">+=</span>&nbsp;<span class="ident" id="3464057">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464062">b</span><span class="op" id="3464063">.</span><span class="ident" id="3464064">flush</span><span class="op" id="3464069">(</span><span class="op" id="3464070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464078">nn</span>&nbsp;<span class="op" id="3464081">+=</span>&nbsp;<span class="ident" id="3464084">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464088">p</span>&nbsp;<span class="op" id="3464090">=</span>&nbsp;<span class="ident" id="3464092">p</span><span class="op" id="3464093">[</span><span class="ident" id="3464094">n</span><span class="op" id="3464095">:</span><span class="op" id="3464096">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464102">if</span>&nbsp;<span class="ident" id="3464105">b</span><span class="op" id="3464106">.</span><span class="ident" id="3464107">err</span>&nbsp;<span class="op" id="3464111">!=</span>&nbsp;<span class="builtintype" id="3464114">nil</span>&nbsp;<span class="op" id="3464118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464122">return</span>&nbsp;<span class="ident" id="3464129">nn</span><span class="op" id="3464131">,</span>&nbsp;<span class="ident" id="3464133">b</span><span class="op" id="3464134">.</span><span class="ident" id="3464135">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464143">n</span>&nbsp;<span class="op" id="3464145">:=</span>&nbsp;<span class="builtinfunc" id="3464148">copy</span><span class="op" id="3464152">(</span><span class="ident" id="3464153">b</span><span class="op" id="3464154">.</span><span class="ident" id="3464155">buf</span><span class="op" id="3464158">[</span><span class="ident" id="3464159">b</span><span class="op" id="3464160">.</span><span class="ident" id="3464161">n</span><span class="op" id="3464162">:</span><span class="op" id="3464163">]</span><span class="op" id="3464164">,</span>&nbsp;<span class="ident" id="3464166">p</span><span class="op" id="3464167">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464170">b</span><span class="op" id="3464171">.</span><span class="ident" id="3464172">n</span>&nbsp;<span class="op" id="3464174">+=</span>&nbsp;<span class="ident" id="3464177">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464180">nn</span>&nbsp;<span class="op" id="3464183">+=</span>&nbsp;<span class="ident" id="3464186">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464189">return</span>&nbsp;<span class="ident" id="3464196">nn</span><span class="op" id="3464198">,</span>&nbsp;<span class="builtintype" id="3464200">nil</span><br>
<span class="lineno"></span><span class="op" id="3464204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="3464207">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="3464242">func</span>&nbsp;<span class="op" id="3464247">(</span><span class="ident" id="3464248">b</span>&nbsp;<span class="op" id="3464250">*</span><span class="ident" id="3464251">Writer</span><span class="op" id="3464257">)</span>&nbsp;<span class="ident" id="3464259">WriteByte</span><span class="op" id="3464268">(</span><span class="ident" id="3464269">c</span>&nbsp;<span class="builtintype" id="3464271">byte</span><span class="op" id="3464275">)</span>&nbsp;<span class="builtintype" id="3464277">error</span>&nbsp;<span class="op" id="3464283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464286">if</span>&nbsp;<span class="ident" id="3464289">b</span><span class="op" id="3464290">.</span><span class="ident" id="3464291">err</span>&nbsp;<span class="op" id="3464295">!=</span>&nbsp;<span class="builtintype" id="3464298">nil</span>&nbsp;<span class="op" id="3464302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464306">return</span>&nbsp;<span class="ident" id="3464313">b</span><span class="op" id="3464314">.</span><span class="ident" id="3464315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464320">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464323">if</span>&nbsp;<span class="ident" id="3464326">b</span><span class="op" id="3464327">.</span><span class="ident" id="3464328">Available</span><span class="op" id="3464337">(</span><span class="op" id="3464338">)</span>&nbsp;<span class="op" id="3464340">&lt;=</span>&nbsp;<span class="num" id="3464343">0</span>&nbsp;<span class="op" id="3464345">&amp;&amp;</span>&nbsp;<span class="ident" id="3464348">b</span><span class="op" id="3464349">.</span><span class="ident" id="3464350">flush</span><span class="op" id="3464355">(</span><span class="op" id="3464356">)</span>&nbsp;<span class="op" id="3464358">!=</span>&nbsp;<span class="builtintype" id="3464361">nil</span>&nbsp;<span class="op" id="3464365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464369">return</span>&nbsp;<span class="ident" id="3464376">b</span><span class="op" id="3464377">.</span><span class="ident" id="3464378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464386">b</span><span class="op" id="3464387">.</span><span class="ident" id="3464388">buf</span><span class="op" id="3464391">[</span><span class="ident" id="3464392">b</span><span class="op" id="3464393">.</span><span class="ident" id="3464394">n</span><span class="op" id="3464395">]</span>&nbsp;<span class="op" id="3464397">=</span>&nbsp;<span class="ident" id="3464399">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464402">b</span><span class="op" id="3464403">.</span><span class="ident" id="3464404">n</span><span class="op" id="3464405">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464409">return</span>&nbsp;<span class="builtintype" id="3464416">nil</span><br>
<span class="lineno"></span><span class="op" id="3464420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464423">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="3464482">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="3464528">func</span>&nbsp;<span class="op" id="3464533">(</span><span class="ident" id="3464534">b</span>&nbsp;<span class="op" id="3464536">*</span><span class="ident" id="3464537">Writer</span><span class="op" id="3464543">)</span>&nbsp;<span class="ident" id="3464545">WriteRune</span><span class="op" id="3464554">(</span><span class="ident" id="3464555">r</span>&nbsp;<span class="builtintype" id="3464557">rune</span><span class="op" id="3464561">)</span>&nbsp;<span class="op" id="3464563">(</span><span class="ident" id="3464564">size</span>&nbsp;<span class="builtintype" id="3464569">int</span><span class="op" id="3464572">,</span>&nbsp;<span class="ident" id="3464574">err</span>&nbsp;<span class="builtintype" id="3464578">error</span><span class="op" id="3464583">)</span>&nbsp;<span class="op" id="3464585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464588">if</span>&nbsp;<span class="ident" id="3464591">r</span>&nbsp;<span class="op" id="3464593">&lt;</span>&nbsp;<span class="ident" id="3464595">utf8</span><span class="op" id="3464599">.</span><span class="ident" id="3464600">RuneSelf</span>&nbsp;<span class="op" id="3464609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464613">err</span>&nbsp;<span class="op" id="3464617">=</span>&nbsp;<span class="ident" id="3464619">b</span><span class="op" id="3464620">.</span><span class="ident" id="3464621">WriteByte</span><span class="op" id="3464630">(</span><span class="builtintype" id="3464631">byte</span><span class="op" id="3464635">(</span><span class="ident" id="3464636">r</span><span class="op" id="3464637">)</span><span class="op" id="3464638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464642">if</span>&nbsp;<span class="ident" id="3464645">err</span>&nbsp;<span class="op" id="3464649">!=</span>&nbsp;<span class="builtintype" id="3464652">nil</span>&nbsp;<span class="op" id="3464656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464661">return</span>&nbsp;<span class="num" id="3464668">0</span><span class="op" id="3464669">,</span>&nbsp;<span class="ident" id="3464671">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464681">return</span>&nbsp;<span class="num" id="3464688">1</span><span class="op" id="3464689">,</span>&nbsp;<span class="builtintype" id="3464691">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464699">if</span>&nbsp;<span class="ident" id="3464702">b</span><span class="op" id="3464703">.</span><span class="ident" id="3464704">err</span>&nbsp;<span class="op" id="3464708">!=</span>&nbsp;<span class="builtintype" id="3464711">nil</span>&nbsp;<span class="op" id="3464715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464719">return</span>&nbsp;<span class="num" id="3464726">0</span><span class="op" id="3464727">,</span>&nbsp;<span class="ident" id="3464729">b</span><span class="op" id="3464730">.</span><span class="ident" id="3464731">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464739">n</span>&nbsp;<span class="op" id="3464741">:=</span>&nbsp;<span class="ident" id="3464744">b</span><span class="op" id="3464745">.</span><span class="ident" id="3464746">Available</span><span class="op" id="3464755">(</span><span class="op" id="3464756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464759">if</span>&nbsp;<span class="ident" id="3464762">n</span>&nbsp;<span class="op" id="3464764">&lt;</span>&nbsp;<span class="ident" id="3464766">utf8</span><span class="op" id="3464770">.</span><span class="ident" id="3464771">UTFMax</span>&nbsp;<span class="op" id="3464778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464782">if</span>&nbsp;<span class="ident" id="3464785">b</span><span class="op" id="3464786">.</span><span class="ident" id="3464787">flush</span><span class="op" id="3464792">(</span><span class="op" id="3464793">)</span><span class="op" id="3464794">;</span>&nbsp;<span class="ident" id="3464796">b</span><span class="op" id="3464797">.</span><span class="ident" id="3464798">err</span>&nbsp;<span class="op" id="3464802">!=</span>&nbsp;<span class="builtintype" id="3464805">nil</span>&nbsp;<span class="op" id="3464809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464814">return</span>&nbsp;<span class="num" id="3464821">0</span><span class="op" id="3464822">,</span>&nbsp;<span class="ident" id="3464824">b</span><span class="op" id="3464825">.</span><span class="ident" id="3464826">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464836">n</span>&nbsp;<span class="op" id="3464838">=</span>&nbsp;<span class="ident" id="3464840">b</span><span class="op" id="3464841">.</span><span class="ident" id="3464842">Available</span><span class="op" id="3464851">(</span><span class="op" id="3464852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464856">if</span>&nbsp;<span class="ident" id="3464859">n</span>&nbsp;<span class="op" id="3464861">&lt;</span>&nbsp;<span class="ident" id="3464863">utf8</span><span class="op" id="3464867">.</span><span class="ident" id="3464868">UTFMax</span>&nbsp;<span class="op" id="3464875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3464880">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3464928">return</span>&nbsp;<span class="ident" id="3464935">b</span><span class="op" id="3464936">.</span><span class="ident" id="3464937">WriteString</span><span class="op" id="3464948">(</span><span class="builtintype" id="3464949">string</span><span class="op" id="3464955">(</span><span class="ident" id="3464956">r</span><span class="op" id="3464957">)</span><span class="op" id="3464958">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3464965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3464968">size</span>&nbsp;<span class="op" id="3464973">=</span>&nbsp;<span class="ident" id="3464975">utf8</span><span class="op" id="3464979">.</span><span class="ident" id="3464980">EncodeRune</span><span class="op" id="3464990">(</span><span class="ident" id="3464991">b</span><span class="op" id="3464992">.</span><span class="ident" id="3464993">buf</span><span class="op" id="3464996">[</span><span class="ident" id="3464997">b</span><span class="op" id="3464998">.</span><span class="ident" id="3464999">n</span><span class="op" id="3465000">:</span><span class="op" id="3465001">]</span><span class="op" id="3465002">,</span>&nbsp;<span class="ident" id="3465004">r</span><span class="op" id="3465005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465008">b</span><span class="op" id="3465009">.</span><span class="ident" id="3465010">n</span>&nbsp;<span class="op" id="3465012">+=</span>&nbsp;<span class="ident" id="3465015">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465021">return</span>&nbsp;<span class="ident" id="3465028">size</span><span class="op" id="3465032">,</span>&nbsp;<span class="builtintype" id="3465034">nil</span><br>
<span class="lineno">620</span><span class="op" id="3465038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465041">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3465073">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3465116">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="3465189">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="3465216">func</span>&nbsp;<span class="op" id="3465221">(</span><span class="ident" id="3465222">b</span>&nbsp;<span class="op" id="3465224">*</span><span class="ident" id="3465225">Writer</span><span class="op" id="3465231">)</span>&nbsp;<span class="ident" id="3465233">WriteString</span><span class="op" id="3465244">(</span><span class="ident" id="3465245">s</span>&nbsp;<span class="builtintype" id="3465247">string</span><span class="op" id="3465253">)</span>&nbsp;<span class="op" id="3465255">(</span><span class="builtintype" id="3465256">int</span><span class="op" id="3465259">,</span>&nbsp;<span class="builtintype" id="3465261">error</span><span class="op" id="3465266">)</span>&nbsp;<span class="op" id="3465268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465271">nn</span>&nbsp;<span class="op" id="3465274">:=</span>&nbsp;<span class="num" id="3465277">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465280">for</span>&nbsp;<span class="builtinfunc" id="3465284">len</span><span class="op" id="3465287">(</span><span class="ident" id="3465288">s</span><span class="op" id="3465289">)</span>&nbsp;<span class="op" id="3465291">&gt;</span>&nbsp;<span class="ident" id="3465293">b</span><span class="op" id="3465294">.</span><span class="ident" id="3465295">Available</span><span class="op" id="3465304">(</span><span class="op" id="3465305">)</span>&nbsp;<span class="op" id="3465307">&amp;&amp;</span>&nbsp;<span class="ident" id="3465310">b</span><span class="op" id="3465311">.</span><span class="ident" id="3465312">err</span>&nbsp;<span class="op" id="3465316">==</span>&nbsp;<span class="builtintype" id="3465319">nil</span>&nbsp;<span class="op" id="3465323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465327">n</span>&nbsp;<span class="op" id="3465329">:=</span>&nbsp;<span class="builtinfunc" id="3465332">copy</span><span class="op" id="3465336">(</span><span class="ident" id="3465337">b</span><span class="op" id="3465338">.</span><span class="ident" id="3465339">buf</span><span class="op" id="3465342">[</span><span class="ident" id="3465343">b</span><span class="op" id="3465344">.</span><span class="ident" id="3465345">n</span><span class="op" id="3465346">:</span><span class="op" id="3465347">]</span><span class="op" id="3465348">,</span>&nbsp;<span class="ident" id="3465350">s</span><span class="op" id="3465351">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465355">b</span><span class="op" id="3465356">.</span><span class="ident" id="3465357">n</span>&nbsp;<span class="op" id="3465359">+=</span>&nbsp;<span class="ident" id="3465362">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465366">nn</span>&nbsp;<span class="op" id="3465369">+=</span>&nbsp;<span class="ident" id="3465372">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465376">s</span>&nbsp;<span class="op" id="3465378">=</span>&nbsp;<span class="ident" id="3465380">s</span><span class="op" id="3465381">[</span><span class="ident" id="3465382">n</span><span class="op" id="3465383">:</span><span class="op" id="3465384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465388">b</span><span class="op" id="3465389">.</span><span class="ident" id="3465390">flush</span><span class="op" id="3465395">(</span><span class="op" id="3465396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465399">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465402">if</span>&nbsp;<span class="ident" id="3465405">b</span><span class="op" id="3465406">.</span><span class="ident" id="3465407">err</span>&nbsp;<span class="op" id="3465411">!=</span>&nbsp;<span class="builtintype" id="3465414">nil</span>&nbsp;<span class="op" id="3465418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465422">return</span>&nbsp;<span class="ident" id="3465429">nn</span><span class="op" id="3465431">,</span>&nbsp;<span class="ident" id="3465433">b</span><span class="op" id="3465434">.</span><span class="ident" id="3465435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465443">n</span>&nbsp;<span class="op" id="3465445">:=</span>&nbsp;<span class="builtinfunc" id="3465448">copy</span><span class="op" id="3465452">(</span><span class="ident" id="3465453">b</span><span class="op" id="3465454">.</span><span class="ident" id="3465455">buf</span><span class="op" id="3465458">[</span><span class="ident" id="3465459">b</span><span class="op" id="3465460">.</span><span class="ident" id="3465461">n</span><span class="op" id="3465462">:</span><span class="op" id="3465463">]</span><span class="op" id="3465464">,</span>&nbsp;<span class="ident" id="3465466">s</span><span class="op" id="3465467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465470">b</span><span class="op" id="3465471">.</span><span class="ident" id="3465472">n</span>&nbsp;<span class="op" id="3465474">+=</span>&nbsp;<span class="ident" id="3465477">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465480">nn</span>&nbsp;<span class="op" id="3465483">+=</span>&nbsp;<span class="ident" id="3465486">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465489">return</span>&nbsp;<span class="ident" id="3465496">nn</span><span class="op" id="3465498">,</span>&nbsp;<span class="builtintype" id="3465500">nil</span><br>
<span class="lineno"></span><span class="op" id="3465504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3465507">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="3465545">func</span>&nbsp;<span class="op" id="3465550">(</span><span class="ident" id="3465551">b</span>&nbsp;<span class="op" id="3465553">*</span><span class="ident" id="3465554">Writer</span><span class="op" id="3465560">)</span>&nbsp;<span class="ident" id="3465562">ReadFrom</span><span class="op" id="3465570">(</span><span class="ident" id="3465571">r</span>&nbsp;<span class="ident" id="3465573">io</span><span class="op" id="3465575">.</span><span class="ident" id="3465576">Reader</span><span class="op" id="3465582">)</span>&nbsp;<span class="op" id="3465584">(</span><span class="ident" id="3465585">n</span>&nbsp;<span class="ident" id="3465587">int64</span><span class="op" id="3465592">,</span>&nbsp;<span class="ident" id="3465594">err</span>&nbsp;<span class="builtintype" id="3465598">error</span><span class="op" id="3465603">)</span>&nbsp;<span class="op" id="3465605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465608">if</span>&nbsp;<span class="ident" id="3465611">b</span><span class="op" id="3465612">.</span><span class="ident" id="3465613">Buffered</span><span class="op" id="3465621">(</span><span class="op" id="3465622">)</span>&nbsp;<span class="op" id="3465624">==</span>&nbsp;<span class="num" id="3465627">0</span>&nbsp;<span class="op" id="3465629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465633">if</span>&nbsp;<span class="ident" id="3465636">w</span><span class="op" id="3465637">,</span>&nbsp;<span class="ident" id="3465639">ok</span>&nbsp;<span class="op" id="3465642">:=</span>&nbsp;<span class="ident" id="3465645">b</span><span class="op" id="3465646">.</span><span class="ident" id="3465647">wr</span><span class="op" id="3465649">.</span><span class="op" id="3465650">(</span><span class="ident" id="3465651">io</span><span class="op" id="3465653">.</span><span class="ident" id="3465654">ReaderFrom</span><span class="op" id="3465664">)</span><span class="op" id="3465665">;</span>&nbsp;<span class="ident" id="3465667">ok</span>&nbsp;<span class="op" id="3465670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465675">return</span>&nbsp;<span class="ident" id="3465682">w</span><span class="op" id="3465683">.</span><span class="ident" id="3465684">ReadFrom</span><span class="op" id="3465692">(</span><span class="ident" id="3465693">r</span><span class="op" id="3465694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465698">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465704">var</span>&nbsp;<span class="ident" id="3465708">m</span>&nbsp;<span class="builtintype" id="3465710">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465715">for</span>&nbsp;<span class="op" id="3465719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465723">if</span>&nbsp;<span class="ident" id="3465726">b</span><span class="op" id="3465727">.</span><span class="ident" id="3465728">Available</span><span class="op" id="3465737">(</span><span class="op" id="3465738">)</span>&nbsp;<span class="op" id="3465740">==</span>&nbsp;<span class="num" id="3465743">0</span>&nbsp;<span class="op" id="3465745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465750">if</span>&nbsp;<span class="ident" id="3465753">err1</span>&nbsp;<span class="op" id="3465758">:=</span>&nbsp;<span class="ident" id="3465761">b</span><span class="op" id="3465762">.</span><span class="ident" id="3465763">flush</span><span class="op" id="3465768">(</span><span class="op" id="3465769">)</span><span class="op" id="3465770">;</span>&nbsp;<span class="ident" id="3465772">err1</span>&nbsp;<span class="op" id="3465777">!=</span>&nbsp;<span class="builtintype" id="3465780">nil</span>&nbsp;<span class="op" id="3465784">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465790">return</span>&nbsp;<span class="ident" id="3465797">n</span><span class="op" id="3465798">,</span>&nbsp;<span class="ident" id="3465800">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465816">nr</span>&nbsp;<span class="op" id="3465819">:=</span>&nbsp;<span class="num" id="3465822">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465826">for</span>&nbsp;<span class="ident" id="3465830">nr</span>&nbsp;<span class="op" id="3465833">&lt;</span>&nbsp;<span class="ident" id="3465835">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3465860">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465865">m</span><span class="op" id="3465866">,</span>&nbsp;<span class="ident" id="3465868">err</span>&nbsp;<span class="op" id="3465872">=</span>&nbsp;<span class="ident" id="3465874">r</span><span class="op" id="3465875">.</span><span class="ident" id="3465876">Read</span><span class="op" id="3465880">(</span><span class="ident" id="3465881">b</span><span class="op" id="3465882">.</span><span class="ident" id="3465883">buf</span><span class="op" id="3465886">[</span><span class="ident" id="3465887">b</span><span class="op" id="3465888">.</span><span class="ident" id="3465889">n</span><span class="op" id="3465890">:</span><span class="op" id="3465891">]</span><span class="op" id="3465892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465897">if</span>&nbsp;<span class="ident" id="3465900">m</span>&nbsp;<span class="op" id="3465902">!=</span>&nbsp;<span class="num" id="3465905">0</span>&nbsp;<span class="op" id="3465907">||</span>&nbsp;<span class="ident" id="3465910">err</span>&nbsp;<span class="op" id="3465914">!=</span>&nbsp;<span class="builtintype" id="3465917">nil</span>&nbsp;<span class="op" id="3465921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3465941">nr</span><span class="op" id="3465943">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3465948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465952">if</span>&nbsp;<span class="ident" id="3465955">nr</span>&nbsp;<span class="op" id="3465958">==</span>&nbsp;<span class="ident" id="3465961">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="3465986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3465991">return</span>&nbsp;<span class="ident" id="3465998">n</span><span class="op" id="3465999">,</span>&nbsp;<span class="ident" id="3466001">io</span><span class="op" id="3466003">.</span><span class="ident" id="3466004">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466024">b</span><span class="op" id="3466025">.</span><span class="ident" id="3466026">n</span>&nbsp;<span class="op" id="3466028">+=</span>&nbsp;<span class="ident" id="3466031">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466035">n</span>&nbsp;<span class="op" id="3466037">+=</span>&nbsp;<span class="ident" id="3466040">int64</span><span class="op" id="3466045">(</span><span class="ident" id="3466046">m</span><span class="op" id="3466047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466051">if</span>&nbsp;<span class="ident" id="3466054">err</span>&nbsp;<span class="op" id="3466058">!=</span>&nbsp;<span class="builtintype" id="3466061">nil</span>&nbsp;<span class="op" id="3466065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466070">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466081">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466084">if</span>&nbsp;<span class="ident" id="3466087">err</span>&nbsp;<span class="op" id="3466091">==</span>&nbsp;<span class="ident" id="3466094">io</span><span class="op" id="3466096">.</span><span class="ident" id="3466097">EOF</span>&nbsp;<span class="op" id="3466101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3466105">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466164">if</span>&nbsp;<span class="ident" id="3466167">b</span><span class="op" id="3466168">.</span><span class="ident" id="3466169">Available</span><span class="op" id="3466178">(</span><span class="op" id="3466179">)</span>&nbsp;<span class="op" id="3466181">==</span>&nbsp;<span class="num" id="3466184">0</span>&nbsp;<span class="op" id="3466186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466191">err</span>&nbsp;<span class="op" id="3466195">=</span>&nbsp;<span class="ident" id="3466197">b</span><span class="op" id="3466198">.</span><span class="ident" id="3466199">flush</span><span class="op" id="3466204">(</span><span class="op" id="3466205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466209">}</span>&nbsp;<span class="keyword" id="3466211">else</span>&nbsp;<span class="op" id="3466216">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3466221">err</span>&nbsp;<span class="op" id="3466225">=</span>&nbsp;<span class="builtintype" id="3466227">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466239">return</span>&nbsp;<span class="ident" id="3466246">n</span><span class="op" id="3466247">,</span>&nbsp;<span class="ident" id="3466249">err</span><br>
<span class="lineno"></span><span class="op" id="3466253">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="3466256">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466286">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="3466342">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="3466374">type</span>&nbsp;<span class="ident" id="3466379">ReadWriter</span>&nbsp;<span class="keyword" id="3466390">struct</span>&nbsp;<span class="op" id="3466397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466400">*</span><span class="ident" id="3466401">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3466409">*</span><span class="ident" id="3466410">Writer</span><br>
<span class="lineno"></span><span class="op" id="3466417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="3466420">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3466492">func</span>&nbsp;<span class="ident" id="3466497">NewReadWriter</span><span class="op" id="3466510">(</span><span class="ident" id="3466511">r</span>&nbsp;<span class="op" id="3466513">*</span><span class="ident" id="3466514">Reader</span><span class="op" id="3466520">,</span>&nbsp;<span class="ident" id="3466522">w</span>&nbsp;<span class="op" id="3466524">*</span><span class="ident" id="3466525">Writer</span><span class="op" id="3466531">)</span>&nbsp;<span class="op" id="3466533">*</span><span class="ident" id="3466534">ReadWriter</span>&nbsp;<span class="op" id="3466545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3466548">return</span>&nbsp;<span class="op" id="3466555">&amp;</span><span class="ident" id="3466556">ReadWriter</span><span class="op" id="3466566">{</span><span class="ident" id="3466567">r</span><span class="op" id="3466568">,</span>&nbsp;<span class="ident" id="3466570">w</span><span class="op" id="3466571">}</span><br>
<span class="lineno"></span><span class="op" id="3466573">}</span>
</div>
</body>
</html>
