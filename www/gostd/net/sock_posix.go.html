<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html" class="current">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3995801">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3995857">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3995911">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3995962">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996040">package</span>&nbsp;<span class="ident" id="3996048">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996053">import</span>&nbsp;<span class="op" id="3996060">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3996063">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3996069">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3996080">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3996087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3996090">//&nbsp;A&nbsp;sockaddr&nbsp;represents&nbsp;a&nbsp;TCP,&nbsp;UDP,&nbsp;IP&nbsp;or&nbsp;Unix&nbsp;network&nbsp;endpoint</span><br>
<span class="lineno"></span><span class="comment" id="3996155">//&nbsp;address&nbsp;that&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall.Sockaddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3996213">type</span>&nbsp;<span class="ident" id="3996218">sockaddr</span>&nbsp;<span class="keyword" id="3996227">interface</span>&nbsp;<span class="op" id="3996237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996240">Addr</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996247">netaddr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996257">//&nbsp;family&nbsp;returns&nbsp;the&nbsp;platform-dependent&nbsp;address&nbsp;family</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996314">//&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996330">family</span><span class="op" id="3996336">(</span><span class="op" id="3996337">)</span>&nbsp;<span class="builtintype" id="3996339">int</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996345">//&nbsp;isWildcard&nbsp;reports&nbsp;whether&nbsp;the&nbsp;address&nbsp;is&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996402">//&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996415">isWildcard</span><span class="op" id="3996425">(</span><span class="op" id="3996426">)</span>&nbsp;<span class="builtintype" id="3996428">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996435">//&nbsp;sockaddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;converted&nbsp;into&nbsp;a&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996493">//&nbsp;sockaddr&nbsp;type&nbsp;that&nbsp;implements&nbsp;syscall.Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996544">//&nbsp;interface.&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996606">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996615">sockaddr</span><span class="op" id="3996623">(</span><span class="ident" id="3996624">family</span>&nbsp;<span class="builtintype" id="3996631">int</span><span class="op" id="3996634">)</span>&nbsp;<span class="op" id="3996636">(</span><span class="ident" id="3996637">syscall</span><span class="op" id="3996644">.</span><span class="ident" id="3996645">Sockaddr</span><span class="op" id="3996653">,</span>&nbsp;<span class="builtintype" id="3996655">error</span><span class="op" id="3996660">)</span><br>
<span class="lineno">35</span><span class="op" id="3996662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3996665">//&nbsp;socket&nbsp;returns&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;that&nbsp;is&nbsp;ready&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3996727">//&nbsp;asynchronous&nbsp;I/O&nbsp;using&nbsp;the&nbsp;network&nbsp;poller.</span><br>
<span class="lineno"></span><span class="keyword" id="3996773">func</span>&nbsp;<span class="ident" id="3996778">socket</span><span class="op" id="3996784">(</span><span class="ident" id="3996785">net</span>&nbsp;<span class="builtintype" id="3996789">string</span><span class="op" id="3996795">,</span>&nbsp;<span class="ident" id="3996797">family</span><span class="op" id="3996803">,</span>&nbsp;<span class="ident" id="3996805">sotype</span><span class="op" id="3996811">,</span>&nbsp;<span class="ident" id="3996813">proto</span>&nbsp;<span class="builtintype" id="3996819">int</span><span class="op" id="3996822">,</span>&nbsp;<span class="ident" id="3996824">ipv6only</span>&nbsp;<span class="builtintype" id="3996833">bool</span><span class="op" id="3996837">,</span>&nbsp;<span class="ident" id="3996839">laddr</span><span class="op" id="3996844">,</span>&nbsp;<span class="ident" id="3996846">raddr</span>&nbsp;<span class="ident" id="3996852">sockaddr</span><span class="op" id="3996860">,</span>&nbsp;<span class="ident" id="3996862">deadline</span>&nbsp;<span class="ident" id="3996871">time</span><span class="op" id="3996875">.</span><span class="ident" id="3996876">Time</span><span class="op" id="3996880">)</span>&nbsp;<span class="op" id="3996882">(</span><span class="ident" id="3996883">fd</span>&nbsp;<span class="op" id="3996886">*</span><span class="ident" id="3996887">netFD</span><span class="op" id="3996892">,</span>&nbsp;<span class="ident" id="3996894">err</span>&nbsp;<span class="builtintype" id="3996898">error</span><span class="op" id="3996903">)</span>&nbsp;<span class="op" id="3996905">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3996908">s</span><span class="op" id="3996909">,</span>&nbsp;<span class="ident" id="3996911">err</span>&nbsp;<span class="op" id="3996915">:=</span>&nbsp;<span class="ident" id="3996918">sysSocket</span><span class="op" id="3996927">(</span><span class="ident" id="3996928">family</span><span class="op" id="3996934">,</span>&nbsp;<span class="ident" id="3996936">sotype</span><span class="op" id="3996942">,</span>&nbsp;<span class="ident" id="3996944">proto</span><span class="op" id="3996949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996952">if</span>&nbsp;<span class="ident" id="3996955">err</span>&nbsp;<span class="op" id="3996959">!=</span>&nbsp;<span class="builtintype" id="3996962">nil</span>&nbsp;<span class="op" id="3996966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996970">return</span>&nbsp;<span class="builtintype" id="3996977">nil</span><span class="op" id="3996980">,</span>&nbsp;<span class="ident" id="3996982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3996990">if</span>&nbsp;<span class="ident" id="3996993">err</span>&nbsp;<span class="op" id="3996997">=</span>&nbsp;<span class="ident" id="3996999">setDefaultSockopts</span><span class="op" id="3997017">(</span><span class="ident" id="3997018">s</span><span class="op" id="3997019">,</span>&nbsp;<span class="ident" id="3997021">family</span><span class="op" id="3997027">,</span>&nbsp;<span class="ident" id="3997029">sotype</span><span class="op" id="3997035">,</span>&nbsp;<span class="ident" id="3997037">ipv6only</span><span class="op" id="3997045">)</span><span class="op" id="3997046">;</span>&nbsp;<span class="ident" id="3997048">err</span>&nbsp;<span class="op" id="3997052">!=</span>&nbsp;<span class="builtintype" id="3997055">nil</span>&nbsp;<span class="op" id="3997059">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997063">closesocket</span><span class="op" id="3997074">(</span><span class="ident" id="3997075">s</span><span class="op" id="3997076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997080">return</span>&nbsp;<span class="builtintype" id="3997087">nil</span><span class="op" id="3997090">,</span>&nbsp;<span class="ident" id="3997092">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997100">if</span>&nbsp;<span class="ident" id="3997103">fd</span><span class="op" id="3997105">,</span>&nbsp;<span class="ident" id="3997107">err</span>&nbsp;<span class="op" id="3997111">=</span>&nbsp;<span class="ident" id="3997113">newFD</span><span class="op" id="3997118">(</span><span class="ident" id="3997119">s</span><span class="op" id="3997120">,</span>&nbsp;<span class="ident" id="3997122">family</span><span class="op" id="3997128">,</span>&nbsp;<span class="ident" id="3997130">sotype</span><span class="op" id="3997136">,</span>&nbsp;<span class="ident" id="3997138">net</span><span class="op" id="3997141">)</span><span class="op" id="3997142">;</span>&nbsp;<span class="ident" id="3997144">err</span>&nbsp;<span class="op" id="3997148">!=</span>&nbsp;<span class="builtintype" id="3997151">nil</span>&nbsp;<span class="op" id="3997155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3997159">closesocket</span><span class="op" id="3997170">(</span><span class="ident" id="3997171">s</span><span class="op" id="3997172">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3997176">return</span>&nbsp;<span class="builtintype" id="3997183">nil</span><span class="op" id="3997186">,</span>&nbsp;<span class="ident" id="3997188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3997193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997197">//&nbsp;This&nbsp;function&nbsp;makes&nbsp;a&nbsp;network&nbsp;file&nbsp;descriptor&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997255">//&nbsp;following&nbsp;applications:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997283">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997287">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;passive&nbsp;stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997340">//&nbsp;&nbsp;&nbsp;connenction,&nbsp;known&nbsp;as&nbsp;a&nbsp;stream&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997386">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997390">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;a&nbsp;destination-unspecific</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997451">//&nbsp;&nbsp;&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a&nbsp;datagram&nbsp;listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997507">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997511">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;an&nbsp;active&nbsp;stream&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997569">//&nbsp;&nbsp;&nbsp;destination-specific&nbsp;datagram&nbsp;connection,&nbsp;known&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997628">//&nbsp;&nbsp;&nbsp;dialer</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997641">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997645">//&nbsp;-&nbsp;An&nbsp;endpoint&nbsp;holder&nbsp;that&nbsp;opens&nbsp;the&nbsp;other&nbsp;connection,&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997708">//&nbsp;&nbsp;&nbsp;as&nbsp;talking&nbsp;to&nbsp;the&nbsp;protocol&nbsp;stack&nbsp;inside&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997765">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997769">//&nbsp;For&nbsp;stream&nbsp;and&nbsp;datagram&nbsp;listeners,&nbsp;they&nbsp;will&nbsp;only&nbsp;require</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997831">//&nbsp;named&nbsp;sockets,&nbsp;so&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&#39;s&nbsp;just&nbsp;a&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997892">//&nbsp;from&nbsp;stream&nbsp;or&nbsp;datagram&nbsp;listeners&nbsp;when&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3997956">//&nbsp;raddr&nbsp;is&nbsp;nil.&nbsp;Otherwise&nbsp;we&nbsp;assume&nbsp;it&#39;s&nbsp;just&nbsp;for&nbsp;dialers&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3998019">//&nbsp;the&nbsp;other&nbsp;connection&nbsp;holders.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998054">if</span>&nbsp;<span class="ident" id="3998057">laddr</span>&nbsp;<span class="op" id="3998063">!=</span>&nbsp;<span class="builtintype" id="3998066">nil</span>&nbsp;<span class="op" id="3998070">&amp;&amp;</span>&nbsp;<span class="ident" id="3998073">raddr</span>&nbsp;<span class="op" id="3998079">==</span>&nbsp;<span class="builtintype" id="3998082">nil</span>&nbsp;<span class="op" id="3998086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998090">switch</span>&nbsp;<span class="ident" id="3998097">sotype</span>&nbsp;<span class="op" id="3998104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998108">case</span>&nbsp;<span class="ident" id="3998113">syscall</span><span class="op" id="3998120">.</span><span class="ident" id="3998121">SOCK_STREAM</span><span class="op" id="3998132">,</span>&nbsp;<span class="ident" id="3998134">syscall</span><span class="op" id="3998141">.</span><span class="ident" id="3998142">SOCK_SEQPACKET</span><span class="op" id="3998156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998161">if</span>&nbsp;<span class="ident" id="3998164">err</span>&nbsp;<span class="op" id="3998168">:=</span>&nbsp;<span class="ident" id="3998171">fd</span><span class="op" id="3998173">.</span><span class="ident" id="3998174">listenStream</span><span class="op" id="3998186">(</span><span class="ident" id="3998187">laddr</span><span class="op" id="3998192">,</span>&nbsp;<span class="ident" id="3998194">listenerBacklog</span><span class="op" id="3998209">)</span><span class="op" id="3998210">;</span>&nbsp;<span class="ident" id="3998212">err</span>&nbsp;<span class="op" id="3998216">!=</span>&nbsp;<span class="builtintype" id="3998219">nil</span>&nbsp;<span class="op" id="3998223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998229">fd</span><span class="op" id="3998231">.</span><span class="ident" id="3998232">Close</span><span class="op" id="3998237">(</span><span class="op" id="3998238">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998244">return</span>&nbsp;<span class="builtintype" id="3998251">nil</span><span class="op" id="3998254">,</span>&nbsp;<span class="ident" id="3998256">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998268">return</span>&nbsp;<span class="ident" id="3998275">fd</span><span class="op" id="3998277">,</span>&nbsp;<span class="builtintype" id="3998279">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998285">case</span>&nbsp;<span class="ident" id="3998290">syscall</span><span class="op" id="3998297">.</span><span class="ident" id="3998298">SOCK_DGRAM</span><span class="op" id="3998308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998313">if</span>&nbsp;<span class="ident" id="3998316">err</span>&nbsp;<span class="op" id="3998320">:=</span>&nbsp;<span class="ident" id="3998323">fd</span><span class="op" id="3998325">.</span><span class="ident" id="3998326">listenDatagram</span><span class="op" id="3998340">(</span><span class="ident" id="3998341">laddr</span><span class="op" id="3998346">)</span><span class="op" id="3998347">;</span>&nbsp;<span class="ident" id="3998349">err</span>&nbsp;<span class="op" id="3998353">!=</span>&nbsp;<span class="builtintype" id="3998356">nil</span>&nbsp;<span class="op" id="3998360">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998366">fd</span><span class="op" id="3998368">.</span><span class="ident" id="3998369">Close</span><span class="op" id="3998374">(</span><span class="op" id="3998375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998381">return</span>&nbsp;<span class="builtintype" id="3998388">nil</span><span class="op" id="3998391">,</span>&nbsp;<span class="ident" id="3998393">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998405">return</span>&nbsp;<span class="ident" id="3998412">fd</span><span class="op" id="3998414">,</span>&nbsp;<span class="builtintype" id="3998416">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998422">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998428">if</span>&nbsp;<span class="ident" id="3998431">err</span>&nbsp;<span class="op" id="3998435">:=</span>&nbsp;<span class="ident" id="3998438">fd</span><span class="op" id="3998440">.</span><span class="ident" id="3998441">dial</span><span class="op" id="3998445">(</span><span class="ident" id="3998446">laddr</span><span class="op" id="3998451">,</span>&nbsp;<span class="ident" id="3998453">raddr</span><span class="op" id="3998458">,</span>&nbsp;<span class="ident" id="3998460">deadline</span><span class="op" id="3998468">)</span><span class="op" id="3998469">;</span>&nbsp;<span class="ident" id="3998471">err</span>&nbsp;<span class="op" id="3998475">!=</span>&nbsp;<span class="builtintype" id="3998478">nil</span>&nbsp;<span class="op" id="3998482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3998486">fd</span><span class="op" id="3998488">.</span><span class="ident" id="3998489">Close</span><span class="op" id="3998494">(</span><span class="op" id="3998495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998499">return</span>&nbsp;<span class="builtintype" id="3998506">nil</span><span class="op" id="3998509">,</span>&nbsp;<span class="ident" id="3998511">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998516">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998519">return</span>&nbsp;<span class="ident" id="3998526">fd</span><span class="op" id="3998528">,</span>&nbsp;<span class="builtintype" id="3998530">nil</span><br>
<span class="lineno"></span><span class="op" id="3998534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3998537">func</span>&nbsp;<span class="op" id="3998542">(</span><span class="ident" id="3998543">fd</span>&nbsp;<span class="op" id="3998546">*</span><span class="ident" id="3998547">netFD</span><span class="op" id="3998552">)</span>&nbsp;<span class="ident" id="3998554">addrFunc</span><span class="op" id="3998562">(</span><span class="op" id="3998563">)</span>&nbsp;<span class="keyword" id="3998565">func</span><span class="op" id="3998569">(</span><span class="ident" id="3998570">syscall</span><span class="op" id="3998577">.</span><span class="ident" id="3998578">Sockaddr</span><span class="op" id="3998586">)</span>&nbsp;<span class="ident" id="3998588">Addr</span>&nbsp;<span class="op" id="3998593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998596">switch</span>&nbsp;<span class="ident" id="3998603">fd</span><span class="op" id="3998605">.</span><span class="ident" id="3998606">family</span>&nbsp;<span class="op" id="3998613">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998616">case</span>&nbsp;<span class="ident" id="3998621">syscall</span><span class="op" id="3998628">.</span><span class="ident" id="3998629">AF_INET</span><span class="op" id="3998636">,</span>&nbsp;<span class="ident" id="3998638">syscall</span><span class="op" id="3998645">.</span><span class="ident" id="3998646">AF_INET6</span><span class="op" id="3998654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998658">switch</span>&nbsp;<span class="ident" id="3998665">fd</span><span class="op" id="3998667">.</span><span class="ident" id="3998668">sotype</span>&nbsp;<span class="op" id="3998675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998679">case</span>&nbsp;<span class="ident" id="3998684">syscall</span><span class="op" id="3998691">.</span><span class="ident" id="3998692">SOCK_STREAM</span><span class="op" id="3998703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998708">return</span>&nbsp;<span class="ident" id="3998715">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998731">case</span>&nbsp;<span class="ident" id="3998736">syscall</span><span class="op" id="3998743">.</span><span class="ident" id="3998744">SOCK_DGRAM</span><span class="op" id="3998754">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998759">return</span>&nbsp;<span class="ident" id="3998766">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998782">case</span>&nbsp;<span class="ident" id="3998787">syscall</span><span class="op" id="3998794">.</span><span class="ident" id="3998795">SOCK_RAW</span><span class="op" id="3998803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998808">return</span>&nbsp;<span class="ident" id="3998815">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3998830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998833">case</span>&nbsp;<span class="ident" id="3998838">syscall</span><span class="op" id="3998845">.</span><span class="ident" id="3998846">AF_UNIX</span><span class="op" id="3998853">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998857">switch</span>&nbsp;<span class="ident" id="3998864">fd</span><span class="op" id="3998866">.</span><span class="ident" id="3998867">sotype</span>&nbsp;<span class="op" id="3998874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998878">case</span>&nbsp;<span class="ident" id="3998883">syscall</span><span class="op" id="3998890">.</span><span class="ident" id="3998891">SOCK_STREAM</span><span class="op" id="3998902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998907">return</span>&nbsp;<span class="ident" id="3998914">sockaddrToUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998931">case</span>&nbsp;<span class="ident" id="3998936">syscall</span><span class="op" id="3998943">.</span><span class="ident" id="3998944">SOCK_DGRAM</span><span class="op" id="3998954">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998959">return</span>&nbsp;<span class="ident" id="3998966">sockaddrToUnixgram</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3998987">case</span>&nbsp;<span class="ident" id="3998992">syscall</span><span class="op" id="3998999">.</span><span class="ident" id="3999000">SOCK_SEQPACKET</span><span class="op" id="3999014">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999019">return</span>&nbsp;<span class="ident" id="3999026">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999055">return</span>&nbsp;<span class="keyword" id="3999062">func</span><span class="op" id="3999066">(</span><span class="ident" id="3999067">syscall</span><span class="op" id="3999074">.</span><span class="ident" id="3999075">Sockaddr</span><span class="op" id="3999083">)</span>&nbsp;<span class="ident" id="3999085">Addr</span>&nbsp;<span class="op" id="3999090">{</span>&nbsp;<span class="keyword" id="3999092">return</span>&nbsp;<span class="builtintype" id="3999099">nil</span>&nbsp;<span class="op" id="3999103">}</span><br>
<span class="lineno">120</span><span class="op" id="3999105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3999108">func</span>&nbsp;<span class="op" id="3999113">(</span><span class="ident" id="3999114">fd</span>&nbsp;<span class="op" id="3999117">*</span><span class="ident" id="3999118">netFD</span><span class="op" id="3999123">)</span>&nbsp;<span class="ident" id="3999125">dial</span><span class="op" id="3999129">(</span><span class="ident" id="3999130">laddr</span><span class="op" id="3999135">,</span>&nbsp;<span class="ident" id="3999137">raddr</span>&nbsp;<span class="ident" id="3999143">sockaddr</span><span class="op" id="3999151">,</span>&nbsp;<span class="ident" id="3999153">deadline</span>&nbsp;<span class="ident" id="3999162">time</span><span class="op" id="3999166">.</span><span class="ident" id="3999167">Time</span><span class="op" id="3999171">)</span>&nbsp;<span class="builtintype" id="3999173">error</span>&nbsp;<span class="op" id="3999179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999182">var</span>&nbsp;<span class="ident" id="3999186">err</span>&nbsp;<span class="builtintype" id="3999190">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999197">var</span>&nbsp;<span class="ident" id="3999201">lsa</span>&nbsp;<span class="ident" id="3999205">syscall</span><span class="op" id="3999212">.</span><span class="ident" id="3999213">Sockaddr</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999223">if</span>&nbsp;<span class="ident" id="3999226">laddr</span>&nbsp;<span class="op" id="3999232">!=</span>&nbsp;<span class="builtintype" id="3999235">nil</span>&nbsp;<span class="op" id="3999239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999243">if</span>&nbsp;<span class="ident" id="3999246">lsa</span><span class="op" id="3999249">,</span>&nbsp;<span class="ident" id="3999251">err</span>&nbsp;<span class="op" id="3999255">=</span>&nbsp;<span class="ident" id="3999257">laddr</span><span class="op" id="3999262">.</span><span class="ident" id="3999263">sockaddr</span><span class="op" id="3999271">(</span><span class="ident" id="3999272">fd</span><span class="op" id="3999274">.</span><span class="ident" id="3999275">family</span><span class="op" id="3999281">)</span><span class="op" id="3999282">;</span>&nbsp;<span class="ident" id="3999284">err</span>&nbsp;<span class="op" id="3999288">!=</span>&nbsp;<span class="builtintype" id="3999291">nil</span>&nbsp;<span class="op" id="3999295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999300">return</span>&nbsp;<span class="ident" id="3999307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999313">}</span>&nbsp;<span class="keyword" id="3999315">else</span>&nbsp;<span class="keyword" id="3999320">if</span>&nbsp;<span class="ident" id="3999323">lsa</span>&nbsp;<span class="op" id="3999327">!=</span>&nbsp;<span class="builtintype" id="3999330">nil</span>&nbsp;<span class="op" id="3999334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999339">if</span>&nbsp;<span class="ident" id="3999342">err</span>&nbsp;<span class="op" id="3999346">:=</span>&nbsp;<span class="ident" id="3999349">syscall</span><span class="op" id="3999356">.</span><span class="ident" id="3999357">Bind</span><span class="op" id="3999361">(</span><span class="ident" id="3999362">fd</span><span class="op" id="3999364">.</span><span class="ident" id="3999365">sysfd</span><span class="op" id="3999370">,</span>&nbsp;<span class="ident" id="3999372">lsa</span><span class="op" id="3999375">)</span><span class="op" id="3999376">;</span>&nbsp;<span class="ident" id="3999378">err</span>&nbsp;<span class="op" id="3999382">!=</span>&nbsp;<span class="builtintype" id="3999385">nil</span>&nbsp;<span class="op" id="3999389">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999395">return</span>&nbsp;<span class="ident" id="3999402">os</span><span class="op" id="3999404">.</span><span class="ident" id="3999405">NewSyscallError</span><span class="op" id="3999420">(</span><span class="string" id="3999421">&#34;bind&#34;</span><span class="op" id="3999427">,</span>&nbsp;<span class="ident" id="3999429">err</span><span class="op" id="3999432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999447">var</span>&nbsp;<span class="ident" id="3999451">rsa</span>&nbsp;<span class="ident" id="3999455">syscall</span><span class="op" id="3999462">.</span><span class="ident" id="3999463">Sockaddr</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999473">if</span>&nbsp;<span class="ident" id="3999476">raddr</span>&nbsp;<span class="op" id="3999482">!=</span>&nbsp;<span class="builtintype" id="3999485">nil</span>&nbsp;<span class="op" id="3999489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999493">if</span>&nbsp;<span class="ident" id="3999496">rsa</span><span class="op" id="3999499">,</span>&nbsp;<span class="ident" id="3999501">err</span>&nbsp;<span class="op" id="3999505">=</span>&nbsp;<span class="ident" id="3999507">raddr</span><span class="op" id="3999512">.</span><span class="ident" id="3999513">sockaddr</span><span class="op" id="3999521">(</span><span class="ident" id="3999522">fd</span><span class="op" id="3999524">.</span><span class="ident" id="3999525">family</span><span class="op" id="3999531">)</span><span class="op" id="3999532">;</span>&nbsp;<span class="ident" id="3999534">err</span>&nbsp;<span class="op" id="3999538">!=</span>&nbsp;<span class="builtintype" id="3999541">nil</span>&nbsp;<span class="op" id="3999545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999550">return</span>&nbsp;<span class="ident" id="3999557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999567">if</span>&nbsp;<span class="ident" id="3999570">err</span>&nbsp;<span class="op" id="3999574">:=</span>&nbsp;<span class="ident" id="3999577">fd</span><span class="op" id="3999579">.</span><span class="ident" id="3999580">connect</span><span class="op" id="3999587">(</span><span class="ident" id="3999588">lsa</span><span class="op" id="3999591">,</span>&nbsp;<span class="ident" id="3999593">rsa</span><span class="op" id="3999596">,</span>&nbsp;<span class="ident" id="3999598">deadline</span><span class="op" id="3999606">)</span><span class="op" id="3999607">;</span>&nbsp;<span class="ident" id="3999609">err</span>&nbsp;<span class="op" id="3999613">!=</span>&nbsp;<span class="builtintype" id="3999616">nil</span>&nbsp;<span class="op" id="3999620">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999625">return</span>&nbsp;<span class="ident" id="3999632">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999642">fd</span><span class="op" id="3999644">.</span><span class="ident" id="3999645">isConnected</span>&nbsp;<span class="op" id="3999657">=</span>&nbsp;<span class="builtintype" id="3999659">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999665">}</span>&nbsp;<span class="keyword" id="3999667">else</span>&nbsp;<span class="op" id="3999672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999676">if</span>&nbsp;<span class="ident" id="3999679">err</span>&nbsp;<span class="op" id="3999683">:=</span>&nbsp;<span class="ident" id="3999686">fd</span><span class="op" id="3999688">.</span><span class="ident" id="3999689">init</span><span class="op" id="3999693">(</span><span class="op" id="3999694">)</span><span class="op" id="3999695">;</span>&nbsp;<span class="ident" id="3999697">err</span>&nbsp;<span class="op" id="3999701">!=</span>&nbsp;<span class="builtintype" id="3999704">nil</span>&nbsp;<span class="op" id="3999708">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999713">return</span>&nbsp;<span class="ident" id="3999720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999732">lsa</span><span class="op" id="3999735">,</span>&nbsp;<span class="ident" id="3999737">_</span>&nbsp;<span class="op" id="3999739">=</span>&nbsp;<span class="ident" id="3999741">syscall</span><span class="op" id="3999748">.</span><span class="ident" id="3999749">Getsockname</span><span class="op" id="3999760">(</span><span class="ident" id="3999761">fd</span><span class="op" id="3999763">.</span><span class="ident" id="3999764">sysfd</span><span class="op" id="3999769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999772">if</span>&nbsp;<span class="ident" id="3999775">rsa</span><span class="op" id="3999778">,</span>&nbsp;<span class="ident" id="3999780">_</span>&nbsp;<span class="op" id="3999782">=</span>&nbsp;<span class="ident" id="3999784">syscall</span><span class="op" id="3999791">.</span><span class="ident" id="3999792">Getpeername</span><span class="op" id="3999803">(</span><span class="ident" id="3999804">fd</span><span class="op" id="3999806">.</span><span class="ident" id="3999807">sysfd</span><span class="op" id="3999812">)</span><span class="op" id="3999813">;</span>&nbsp;<span class="ident" id="3999815">rsa</span>&nbsp;<span class="op" id="3999819">!=</span>&nbsp;<span class="builtintype" id="3999822">nil</span>&nbsp;<span class="op" id="3999826">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999830">fd</span><span class="op" id="3999832">.</span><span class="ident" id="3999833">setAddr</span><span class="op" id="3999840">(</span><span class="ident" id="3999841">fd</span><span class="op" id="3999843">.</span><span class="ident" id="3999844">addrFunc</span><span class="op" id="3999852">(</span><span class="op" id="3999853">)</span><span class="op" id="3999854">(</span><span class="ident" id="3999855">lsa</span><span class="op" id="3999858">)</span><span class="op" id="3999859">,</span>&nbsp;<span class="ident" id="3999861">fd</span><span class="op" id="3999863">.</span><span class="ident" id="3999864">addrFunc</span><span class="op" id="3999872">(</span><span class="op" id="3999873">)</span><span class="op" id="3999874">(</span><span class="ident" id="3999875">rsa</span><span class="op" id="3999878">)</span><span class="op" id="3999879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999882">}</span>&nbsp;<span class="keyword" id="3999884">else</span>&nbsp;<span class="op" id="3999889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3999893">fd</span><span class="op" id="3999895">.</span><span class="ident" id="3999896">setAddr</span><span class="op" id="3999903">(</span><span class="ident" id="3999904">fd</span><span class="op" id="3999906">.</span><span class="ident" id="3999907">addrFunc</span><span class="op" id="3999915">(</span><span class="op" id="3999916">)</span><span class="op" id="3999917">(</span><span class="ident" id="3999918">lsa</span><span class="op" id="3999921">)</span><span class="op" id="3999922">,</span>&nbsp;<span class="ident" id="3999924">raddr</span><span class="op" id="3999929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3999932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3999935">return</span>&nbsp;<span class="builtintype" id="3999942">nil</span><br>
<span class="lineno">155</span><span class="op" id="3999946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3999949">func</span>&nbsp;<span class="op" id="3999954">(</span><span class="ident" id="3999955">fd</span>&nbsp;<span class="op" id="3999958">*</span><span class="ident" id="3999959">netFD</span><span class="op" id="3999964">)</span>&nbsp;<span class="ident" id="3999966">listenStream</span><span class="op" id="3999978">(</span><span class="ident" id="3999979">laddr</span>&nbsp;<span class="ident" id="3999985">sockaddr</span><span class="op" id="3999993">,</span>&nbsp;<span class="ident" id="3999995">backlog</span>&nbsp;<span class="builtintype" id="4000003">int</span><span class="op" id="4000006">)</span>&nbsp;<span class="builtintype" id="4000008">error</span>&nbsp;<span class="op" id="4000014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000017">if</span>&nbsp;<span class="ident" id="4000020">err</span>&nbsp;<span class="op" id="4000024">:=</span>&nbsp;<span class="ident" id="4000027">setDefaultListenerSockopts</span><span class="op" id="4000053">(</span><span class="ident" id="4000054">fd</span><span class="op" id="4000056">.</span><span class="ident" id="4000057">sysfd</span><span class="op" id="4000062">)</span><span class="op" id="4000063">;</span>&nbsp;<span class="ident" id="4000065">err</span>&nbsp;<span class="op" id="4000069">!=</span>&nbsp;<span class="builtintype" id="4000072">nil</span>&nbsp;<span class="op" id="4000076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000080">return</span>&nbsp;<span class="ident" id="4000087">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000095">if</span>&nbsp;<span class="ident" id="4000098">lsa</span><span class="op" id="4000101">,</span>&nbsp;<span class="ident" id="4000103">err</span>&nbsp;<span class="op" id="4000107">:=</span>&nbsp;<span class="ident" id="4000110">laddr</span><span class="op" id="4000115">.</span><span class="ident" id="4000116">sockaddr</span><span class="op" id="4000124">(</span><span class="ident" id="4000125">fd</span><span class="op" id="4000127">.</span><span class="ident" id="4000128">family</span><span class="op" id="4000134">)</span><span class="op" id="4000135">;</span>&nbsp;<span class="ident" id="4000137">err</span>&nbsp;<span class="op" id="4000141">!=</span>&nbsp;<span class="builtintype" id="4000144">nil</span>&nbsp;<span class="op" id="4000148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000152">return</span>&nbsp;<span class="ident" id="4000159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000164">}</span>&nbsp;<span class="keyword" id="4000166">else</span>&nbsp;<span class="keyword" id="4000171">if</span>&nbsp;<span class="ident" id="4000174">lsa</span>&nbsp;<span class="op" id="4000178">!=</span>&nbsp;<span class="builtintype" id="4000181">nil</span>&nbsp;<span class="op" id="4000185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000189">if</span>&nbsp;<span class="ident" id="4000192">err</span>&nbsp;<span class="op" id="4000196">:=</span>&nbsp;<span class="ident" id="4000199">syscall</span><span class="op" id="4000206">.</span><span class="ident" id="4000207">Bind</span><span class="op" id="4000211">(</span><span class="ident" id="4000212">fd</span><span class="op" id="4000214">.</span><span class="ident" id="4000215">sysfd</span><span class="op" id="4000220">,</span>&nbsp;<span class="ident" id="4000222">lsa</span><span class="op" id="4000225">)</span><span class="op" id="4000226">;</span>&nbsp;<span class="ident" id="4000228">err</span>&nbsp;<span class="op" id="4000232">!=</span>&nbsp;<span class="builtintype" id="4000235">nil</span>&nbsp;<span class="op" id="4000239">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000244">return</span>&nbsp;<span class="ident" id="4000251">os</span><span class="op" id="4000253">.</span><span class="ident" id="4000254">NewSyscallError</span><span class="op" id="4000269">(</span><span class="string" id="4000270">&#34;bind&#34;</span><span class="op" id="4000276">,</span>&nbsp;<span class="ident" id="4000278">err</span><span class="op" id="4000281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000291">if</span>&nbsp;<span class="ident" id="4000294">err</span>&nbsp;<span class="op" id="4000298">:=</span>&nbsp;<span class="ident" id="4000301">syscall</span><span class="op" id="4000308">.</span><span class="ident" id="4000309">Listen</span><span class="op" id="4000315">(</span><span class="ident" id="4000316">fd</span><span class="op" id="4000318">.</span><span class="ident" id="4000319">sysfd</span><span class="op" id="4000324">,</span>&nbsp;<span class="ident" id="4000326">backlog</span><span class="op" id="4000333">)</span><span class="op" id="4000334">;</span>&nbsp;<span class="ident" id="4000336">err</span>&nbsp;<span class="op" id="4000340">!=</span>&nbsp;<span class="builtintype" id="4000343">nil</span>&nbsp;<span class="op" id="4000347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000351">return</span>&nbsp;<span class="ident" id="4000358">os</span><span class="op" id="4000360">.</span><span class="ident" id="4000361">NewSyscallError</span><span class="op" id="4000376">(</span><span class="string" id="4000377">&#34;listen&#34;</span><span class="op" id="4000385">,</span>&nbsp;<span class="ident" id="4000387">err</span><span class="op" id="4000390">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000396">if</span>&nbsp;<span class="ident" id="4000399">err</span>&nbsp;<span class="op" id="4000403">:=</span>&nbsp;<span class="ident" id="4000406">fd</span><span class="op" id="4000408">.</span><span class="ident" id="4000409">init</span><span class="op" id="4000413">(</span><span class="op" id="4000414">)</span><span class="op" id="4000415">;</span>&nbsp;<span class="ident" id="4000417">err</span>&nbsp;<span class="op" id="4000421">!=</span>&nbsp;<span class="builtintype" id="4000424">nil</span>&nbsp;<span class="op" id="4000428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000432">return</span>&nbsp;<span class="ident" id="4000439">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4000444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000447">lsa</span><span class="op" id="4000450">,</span>&nbsp;<span class="ident" id="4000452">_</span>&nbsp;<span class="op" id="4000454">:=</span>&nbsp;<span class="ident" id="4000457">syscall</span><span class="op" id="4000464">.</span><span class="ident" id="4000465">Getsockname</span><span class="op" id="4000476">(</span><span class="ident" id="4000477">fd</span><span class="op" id="4000479">.</span><span class="ident" id="4000480">sysfd</span><span class="op" id="4000485">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4000488">fd</span><span class="op" id="4000490">.</span><span class="ident" id="4000491">setAddr</span><span class="op" id="4000498">(</span><span class="ident" id="4000499">fd</span><span class="op" id="4000501">.</span><span class="ident" id="4000502">addrFunc</span><span class="op" id="4000510">(</span><span class="op" id="4000511">)</span><span class="op" id="4000512">(</span><span class="ident" id="4000513">lsa</span><span class="op" id="4000516">)</span><span class="op" id="4000517">,</span>&nbsp;<span class="builtintype" id="4000519">nil</span><span class="op" id="4000522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000525">return</span>&nbsp;<span class="builtintype" id="4000532">nil</span><br>
<span class="lineno"></span><span class="op" id="4000536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4000539">func</span>&nbsp;<span class="op" id="4000544">(</span><span class="ident" id="4000545">fd</span>&nbsp;<span class="op" id="4000548">*</span><span class="ident" id="4000549">netFD</span><span class="op" id="4000554">)</span>&nbsp;<span class="ident" id="4000556">listenDatagram</span><span class="op" id="4000570">(</span><span class="ident" id="4000571">laddr</span>&nbsp;<span class="ident" id="4000577">sockaddr</span><span class="op" id="4000585">)</span>&nbsp;<span class="builtintype" id="4000587">error</span>&nbsp;<span class="op" id="4000593">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000596">switch</span>&nbsp;<span class="ident" id="4000603">addr</span>&nbsp;<span class="op" id="4000608">:=</span>&nbsp;<span class="ident" id="4000611">laddr</span><span class="op" id="4000616">.</span><span class="op" id="4000617">(</span><span class="keyword" id="4000618">type</span><span class="op" id="4000622">)</span>&nbsp;<span class="op" id="4000624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4000627">case</span>&nbsp;<span class="op" id="4000632">*</span><span class="ident" id="4000633">UDPAddr</span><span class="op" id="4000640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000644">//&nbsp;We&nbsp;provide&nbsp;a&nbsp;socket&nbsp;that&nbsp;listens&nbsp;to&nbsp;a&nbsp;wildcard</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000696">//&nbsp;address&nbsp;with&nbsp;reusable&nbsp;UDP&nbsp;port&nbsp;when&nbsp;the&nbsp;given&nbsp;laddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000753">//&nbsp;is&nbsp;an&nbsp;appropriate&nbsp;UDP&nbsp;multicast&nbsp;address&nbsp;prefix.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000806">//&nbsp;This&nbsp;makes&nbsp;it&nbsp;possible&nbsp;for&nbsp;a&nbsp;single&nbsp;UDP&nbsp;listener&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000863">//&nbsp;join&nbsp;multiple&nbsp;different&nbsp;group&nbsp;addresses,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000913">//&nbsp;multiple&nbsp;UDP&nbsp;listeners&nbsp;that&nbsp;listen&nbsp;on&nbsp;the&nbsp;same&nbsp;UDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4000969">//&nbsp;port&nbsp;to&nbsp;join&nbsp;the&nbsp;same&nbsp;group&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001011">if</span>&nbsp;<span class="ident" id="4001014">addr</span><span class="op" id="4001018">.</span><span class="ident" id="4001019">IP</span>&nbsp;<span class="op" id="4001022">!=</span>&nbsp;<span class="builtintype" id="4001025">nil</span>&nbsp;<span class="op" id="4001029">&amp;&amp;</span>&nbsp;<span class="ident" id="4001032">addr</span><span class="op" id="4001036">.</span><span class="ident" id="4001037">IP</span><span class="op" id="4001039">.</span><span class="ident" id="4001040">IsMulticast</span><span class="op" id="4001051">(</span><span class="op" id="4001052">)</span>&nbsp;<span class="op" id="4001054">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001059">if</span>&nbsp;<span class="ident" id="4001062">err</span>&nbsp;<span class="op" id="4001066">:=</span>&nbsp;<span class="ident" id="4001069">setDefaultMulticastSockopts</span><span class="op" id="4001096">(</span><span class="ident" id="4001097">fd</span><span class="op" id="4001099">.</span><span class="ident" id="4001100">sysfd</span><span class="op" id="4001105">)</span><span class="op" id="4001106">;</span>&nbsp;<span class="ident" id="4001108">err</span>&nbsp;<span class="op" id="4001112">!=</span>&nbsp;<span class="builtintype" id="4001115">nil</span>&nbsp;<span class="op" id="4001119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001125">return</span>&nbsp;<span class="ident" id="4001132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001144">addr</span>&nbsp;<span class="op" id="4001149">:=</span>&nbsp;<span class="op" id="4001152">*</span><span class="ident" id="4001153">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001161">switch</span>&nbsp;<span class="ident" id="4001168">fd</span><span class="op" id="4001170">.</span><span class="ident" id="4001171">family</span>&nbsp;<span class="op" id="4001178">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001183">case</span>&nbsp;<span class="ident" id="4001188">syscall</span><span class="op" id="4001195">.</span><span class="ident" id="4001196">AF_INET</span><span class="op" id="4001203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001209">addr</span><span class="op" id="4001213">.</span><span class="ident" id="4001214">IP</span>&nbsp;<span class="op" id="4001217">=</span>&nbsp;<span class="ident" id="4001219">IPv4zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001231">case</span>&nbsp;<span class="ident" id="4001236">syscall</span><span class="op" id="4001243">.</span><span class="ident" id="4001244">AF_INET6</span><span class="op" id="4001252">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001258">addr</span><span class="op" id="4001262">.</span><span class="ident" id="4001263">IP</span>&nbsp;<span class="op" id="4001266">=</span>&nbsp;<span class="ident" id="4001268">IPv6unspecified</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001287">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001292">laddr</span>&nbsp;<span class="op" id="4001298">=</span>&nbsp;<span class="op" id="4001300">&amp;</span><span class="ident" id="4001301">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001314">if</span>&nbsp;<span class="ident" id="4001317">lsa</span><span class="op" id="4001320">,</span>&nbsp;<span class="ident" id="4001322">err</span>&nbsp;<span class="op" id="4001326">:=</span>&nbsp;<span class="ident" id="4001329">laddr</span><span class="op" id="4001334">.</span><span class="ident" id="4001335">sockaddr</span><span class="op" id="4001343">(</span><span class="ident" id="4001344">fd</span><span class="op" id="4001346">.</span><span class="ident" id="4001347">family</span><span class="op" id="4001353">)</span><span class="op" id="4001354">;</span>&nbsp;<span class="ident" id="4001356">err</span>&nbsp;<span class="op" id="4001360">!=</span>&nbsp;<span class="builtintype" id="4001363">nil</span>&nbsp;<span class="op" id="4001367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001371">return</span>&nbsp;<span class="ident" id="4001378">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001383">}</span>&nbsp;<span class="keyword" id="4001385">else</span>&nbsp;<span class="keyword" id="4001390">if</span>&nbsp;<span class="ident" id="4001393">lsa</span>&nbsp;<span class="op" id="4001397">!=</span>&nbsp;<span class="builtintype" id="4001400">nil</span>&nbsp;<span class="op" id="4001404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001408">if</span>&nbsp;<span class="ident" id="4001411">err</span>&nbsp;<span class="op" id="4001415">:=</span>&nbsp;<span class="ident" id="4001418">syscall</span><span class="op" id="4001425">.</span><span class="ident" id="4001426">Bind</span><span class="op" id="4001430">(</span><span class="ident" id="4001431">fd</span><span class="op" id="4001433">.</span><span class="ident" id="4001434">sysfd</span><span class="op" id="4001439">,</span>&nbsp;<span class="ident" id="4001441">lsa</span><span class="op" id="4001444">)</span><span class="op" id="4001445">;</span>&nbsp;<span class="ident" id="4001447">err</span>&nbsp;<span class="op" id="4001451">!=</span>&nbsp;<span class="builtintype" id="4001454">nil</span>&nbsp;<span class="op" id="4001458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001463">return</span>&nbsp;<span class="ident" id="4001470">os</span><span class="op" id="4001472">.</span><span class="ident" id="4001473">NewSyscallError</span><span class="op" id="4001488">(</span><span class="string" id="4001489">&#34;bind&#34;</span><span class="op" id="4001495">,</span>&nbsp;<span class="ident" id="4001497">err</span><span class="op" id="4001500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001507">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001510">if</span>&nbsp;<span class="ident" id="4001513">err</span>&nbsp;<span class="op" id="4001517">:=</span>&nbsp;<span class="ident" id="4001520">fd</span><span class="op" id="4001522">.</span><span class="ident" id="4001523">init</span><span class="op" id="4001527">(</span><span class="op" id="4001528">)</span><span class="op" id="4001529">;</span>&nbsp;<span class="ident" id="4001531">err</span>&nbsp;<span class="op" id="4001535">!=</span>&nbsp;<span class="builtintype" id="4001538">nil</span>&nbsp;<span class="op" id="4001542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001546">return</span>&nbsp;<span class="ident" id="4001553">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4001558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001561">lsa</span><span class="op" id="4001564">,</span>&nbsp;<span class="ident" id="4001566">_</span>&nbsp;<span class="op" id="4001568">:=</span>&nbsp;<span class="ident" id="4001571">syscall</span><span class="op" id="4001578">.</span><span class="ident" id="4001579">Getsockname</span><span class="op" id="4001590">(</span><span class="ident" id="4001591">fd</span><span class="op" id="4001593">.</span><span class="ident" id="4001594">sysfd</span><span class="op" id="4001599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4001602">fd</span><span class="op" id="4001604">.</span><span class="ident" id="4001605">setAddr</span><span class="op" id="4001612">(</span><span class="ident" id="4001613">fd</span><span class="op" id="4001615">.</span><span class="ident" id="4001616">addrFunc</span><span class="op" id="4001624">(</span><span class="op" id="4001625">)</span><span class="op" id="4001626">(</span><span class="ident" id="4001627">lsa</span><span class="op" id="4001630">)</span><span class="op" id="4001631">,</span>&nbsp;<span class="builtintype" id="4001633">nil</span><span class="op" id="4001636">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4001639">return</span>&nbsp;<span class="builtintype" id="4001646">nil</span><br>
<span class="lineno"></span><span class="op" id="4001650">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
