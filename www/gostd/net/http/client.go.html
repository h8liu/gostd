<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2923938">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2923993">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2924047">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2924098">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="2924128">//</span><br>
<span class="lineno"></span><span class="comment" id="2924131">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="2924175">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2924228">package</span>&nbsp;<span class="ident" id="2924236">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2924242">import</span>&nbsp;<span class="op" id="2924249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924252">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924271">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924281">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924288">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924294">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924307">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924314">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924325">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924336">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2924344">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2924351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2924354">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2924421">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="2924466">//</span><br>
<span class="lineno"></span><span class="comment" id="2924469">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="2924536">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="2924603">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="2924674">//</span><br>
<span class="lineno"></span><span class="comment" id="2924677">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="2924745">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2924806">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="2924820">type</span>&nbsp;<span class="ident" id="2924825">Client</span>&nbsp;<span class="keyword" id="2924832">struct</span>&nbsp;<span class="op" id="2924839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2924842">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2924900">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2924928">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2924966">Transport</span>&nbsp;<span class="ident" id="2924976">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2924991">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925054">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925114">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925176">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925239">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925302">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925352">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925414">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925443">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925447">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925512">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2925564">CheckRedirect</span>&nbsp;<span class="keyword" id="2925578">func</span><span class="op" id="2925582">(</span><span class="ident" id="2925583">req</span>&nbsp;<span class="op" id="2925587">*</span><span class="ident" id="2925588">Request</span><span class="op" id="2925595">,</span>&nbsp;<span class="ident" id="2925597">via</span>&nbsp;<span class="op" id="2925601">[</span><span class="op" id="2925602">]</span><span class="op" id="2925603">*</span><span class="ident" id="2925604">Request</span><span class="op" id="2925611">)</span>&nbsp;<span class="builtintype" id="2925613">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925621">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925655">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925719">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2925737">Jar</span>&nbsp;<span class="ident" id="2925741">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925753">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925814">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925868">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925932">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2925989">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926033">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926037">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926077">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926081">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926139">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926203">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926263">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2926320">Timeout</span>&nbsp;<span class="ident" id="2926328">time</span><span class="op" id="2926332">.</span><span class="ident" id="2926333">Duration</span><br>
<span class="lineno"></span><span class="op" id="2926342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926345">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="2926420">var</span>&nbsp;<span class="ident" id="2926424">DefaultClient</span>&nbsp;<span class="op" id="2926438">=</span>&nbsp;<span class="op" id="2926440">&amp;</span><span class="ident" id="2926441">Client</span><span class="op" id="2926447">{</span><span class="op" id="2926448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2926451">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2926521">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="2926593">//</span><br>
<span class="lineno">80</span><span class="comment" id="2926596">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="2926658">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="2926673">type</span>&nbsp;<span class="ident" id="2926678">RoundTripper</span>&nbsp;<span class="keyword" id="2926691">interface</span>&nbsp;<span class="op" id="2926701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926704">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926764">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926824">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926879">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2926943">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927005">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927066">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927120">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927173">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927205">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927209">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927265">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927326">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927383">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2927400">RoundTrip</span><span class="op" id="2927409">(</span><span class="op" id="2927410">*</span><span class="ident" id="2927411">Request</span><span class="op" id="2927418">)</span>&nbsp;<span class="op" id="2927420">(</span><span class="op" id="2927421">*</span><span class="ident" id="2927422">Response</span><span class="op" id="2927430">,</span>&nbsp;<span class="builtintype" id="2927432">error</span><span class="op" id="2927437">)</span><br>
<span class="lineno"></span><span class="op" id="2927439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2927442">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2927520">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="2927566">func</span>&nbsp;<span class="ident" id="2927571">hasPort</span><span class="op" id="2927578">(</span><span class="ident" id="2927579">s</span>&nbsp;<span class="builtintype" id="2927581">string</span><span class="op" id="2927587">)</span>&nbsp;<span class="builtintype" id="2927589">bool</span>&nbsp;<span class="op" id="2927594">{</span>&nbsp;<span class="keyword" id="2927596">return</span>&nbsp;<span class="ident" id="2927603">strings</span><span class="op" id="2927610">.</span><span class="ident" id="2927611">LastIndex</span><span class="op" id="2927620">(</span><span class="ident" id="2927621">s</span><span class="op" id="2927622">,</span>&nbsp;<span class="string" id="2927624">&#34;:&#34;</span><span class="op" id="2927627">)</span>&nbsp;<span class="op" id="2927629">&gt;</span>&nbsp;<span class="ident" id="2927631">strings</span><span class="op" id="2927638">.</span><span class="ident" id="2927639">LastIndex</span><span class="op" id="2927648">(</span><span class="ident" id="2927649">s</span><span class="op" id="2927650">,</span>&nbsp;<span class="string" id="2927652">&#34;]&#34;</span><span class="op" id="2927655">)</span>&nbsp;<span class="op" id="2927657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2927660">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="2927730">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="2927803">func</span>&nbsp;<span class="ident" id="2927808">refererForURL</span><span class="op" id="2927821">(</span><span class="ident" id="2927822">lastReq</span><span class="op" id="2927829">,</span>&nbsp;<span class="ident" id="2927831">newReq</span>&nbsp;<span class="op" id="2927838">*</span><span class="ident" id="2927839">url</span><span class="op" id="2927842">.</span><span class="ident" id="2927843">URL</span><span class="op" id="2927846">)</span>&nbsp;<span class="builtintype" id="2927848">string</span>&nbsp;<span class="op" id="2927855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927858">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927912">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2927974">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928033">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928077">if</span>&nbsp;<span class="ident" id="2928080">lastReq</span><span class="op" id="2928087">.</span><span class="ident" id="2928088">Scheme</span>&nbsp;<span class="op" id="2928095">==</span>&nbsp;<span class="string" id="2928098">&#34;https&#34;</span>&nbsp;<span class="op" id="2928106">&amp;&amp;</span>&nbsp;<span class="ident" id="2928109">newReq</span><span class="op" id="2928115">.</span><span class="ident" id="2928116">Scheme</span>&nbsp;<span class="op" id="2928123">==</span>&nbsp;<span class="string" id="2928126">&#34;http&#34;</span>&nbsp;<span class="op" id="2928133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928137">return</span>&nbsp;<span class="string" id="2928144">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2928148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928151">referer</span>&nbsp;<span class="op" id="2928159">:=</span>&nbsp;<span class="ident" id="2928162">lastReq</span><span class="op" id="2928169">.</span><span class="ident" id="2928170">String</span><span class="op" id="2928176">(</span><span class="op" id="2928177">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928180">if</span>&nbsp;<span class="ident" id="2928183">lastReq</span><span class="op" id="2928190">.</span><span class="ident" id="2928191">User</span>&nbsp;<span class="op" id="2928196">!=</span>&nbsp;<span class="builtintype" id="2928199">nil</span>&nbsp;<span class="op" id="2928203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928207">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928263">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928280">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928319">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928352">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2928410">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928452">auth</span>&nbsp;<span class="op" id="2928457">:=</span>&nbsp;<span class="ident" id="2928460">lastReq</span><span class="op" id="2928467">.</span><span class="ident" id="2928468">User</span><span class="op" id="2928472">.</span><span class="ident" id="2928473">String</span><span class="op" id="2928479">(</span><span class="op" id="2928480">)</span>&nbsp;<span class="op" id="2928482">+</span>&nbsp;<span class="string" id="2928484">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928490">referer</span>&nbsp;<span class="op" id="2928498">=</span>&nbsp;<span class="ident" id="2928500">strings</span><span class="op" id="2928507">.</span><span class="ident" id="2928508">Replace</span><span class="op" id="2928515">(</span><span class="ident" id="2928516">referer</span><span class="op" id="2928523">,</span>&nbsp;<span class="ident" id="2928525">auth</span><span class="op" id="2928529">,</span>&nbsp;<span class="string" id="2928531">&#34;&#34;</span><span class="op" id="2928533">,</span>&nbsp;<span class="num" id="2928535">1</span><span class="op" id="2928536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2928539">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928542">return</span>&nbsp;<span class="ident" id="2928549">referer</span><br>
<span class="lineno"></span><span class="op" id="2928557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2928560">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2928628">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="2928699">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="2928722">type</span>&nbsp;<span class="ident" id="2928727">readClose</span>&nbsp;<span class="keyword" id="2928737">struct</span>&nbsp;<span class="op" id="2928744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928747">io</span><span class="op" id="2928749">.</span><span class="ident" id="2928750">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928758">io</span><span class="op" id="2928760">.</span><span class="ident" id="2928761">Closer</span><br>
<span class="lineno"></span><span class="op" id="2928768">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="2928771">func</span>&nbsp;<span class="op" id="2928776">(</span><span class="ident" id="2928777">c</span>&nbsp;<span class="op" id="2928779">*</span><span class="ident" id="2928780">Client</span><span class="op" id="2928786">)</span>&nbsp;<span class="ident" id="2928788">send</span><span class="op" id="2928792">(</span><span class="ident" id="2928793">req</span>&nbsp;<span class="op" id="2928797">*</span><span class="ident" id="2928798">Request</span><span class="op" id="2928805">)</span>&nbsp;<span class="op" id="2928807">(</span><span class="op" id="2928808">*</span><span class="ident" id="2928809">Response</span><span class="op" id="2928817">,</span>&nbsp;<span class="builtintype" id="2928819">error</span><span class="op" id="2928824">)</span>&nbsp;<span class="op" id="2928826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928829">if</span>&nbsp;<span class="ident" id="2928832">c</span><span class="op" id="2928833">.</span><span class="ident" id="2928834">Jar</span>&nbsp;<span class="op" id="2928838">!=</span>&nbsp;<span class="builtintype" id="2928841">nil</span>&nbsp;<span class="op" id="2928845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928849">for</span>&nbsp;<span class="ident" id="2928853">_</span><span class="op" id="2928854">,</span>&nbsp;<span class="ident" id="2928856">cookie</span>&nbsp;<span class="op" id="2928863">:=</span>&nbsp;<span class="keyword" id="2928866">range</span>&nbsp;<span class="ident" id="2928872">c</span><span class="op" id="2928873">.</span><span class="ident" id="2928874">Jar</span><span class="op" id="2928877">.</span><span class="ident" id="2928878">Cookies</span><span class="op" id="2928885">(</span><span class="ident" id="2928886">req</span><span class="op" id="2928889">.</span><span class="ident" id="2928890">URL</span><span class="op" id="2928893">)</span>&nbsp;<span class="op" id="2928895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928900">req</span><span class="op" id="2928903">.</span><span class="ident" id="2928904">AddCookie</span><span class="op" id="2928913">(</span><span class="ident" id="2928914">cookie</span><span class="op" id="2928920">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2928924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2928927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2928930">resp</span><span class="op" id="2928934">,</span>&nbsp;<span class="ident" id="2928936">err</span>&nbsp;<span class="op" id="2928940">:=</span>&nbsp;<span class="ident" id="2928943">send</span><span class="op" id="2928947">(</span><span class="ident" id="2928948">req</span><span class="op" id="2928951">,</span>&nbsp;<span class="ident" id="2928953">c</span><span class="op" id="2928954">.</span><span class="ident" id="2928955">transport</span><span class="op" id="2928964">(</span><span class="op" id="2928965">)</span><span class="op" id="2928966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928969">if</span>&nbsp;<span class="ident" id="2928972">err</span>&nbsp;<span class="op" id="2928976">!=</span>&nbsp;<span class="builtintype" id="2928979">nil</span>&nbsp;<span class="op" id="2928983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2928987">return</span>&nbsp;<span class="builtintype" id="2928994">nil</span><span class="op" id="2928997">,</span>&nbsp;<span class="ident" id="2928999">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2929004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2929007">if</span>&nbsp;<span class="ident" id="2929010">c</span><span class="op" id="2929011">.</span><span class="ident" id="2929012">Jar</span>&nbsp;<span class="op" id="2929016">!=</span>&nbsp;<span class="builtintype" id="2929019">nil</span>&nbsp;<span class="op" id="2929023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2929027">if</span>&nbsp;<span class="ident" id="2929030">rc</span>&nbsp;<span class="op" id="2929033">:=</span>&nbsp;<span class="ident" id="2929036">resp</span><span class="op" id="2929040">.</span><span class="ident" id="2929041">Cookies</span><span class="op" id="2929048">(</span><span class="op" id="2929049">)</span><span class="op" id="2929050">;</span>&nbsp;<span class="builtinfunc" id="2929052">len</span><span class="op" id="2929055">(</span><span class="ident" id="2929056">rc</span><span class="op" id="2929058">)</span>&nbsp;<span class="op" id="2929060">&gt;</span>&nbsp;<span class="num" id="2929062">0</span>&nbsp;<span class="op" id="2929064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2929069">c</span><span class="op" id="2929070">.</span><span class="ident" id="2929071">Jar</span><span class="op" id="2929074">.</span><span class="ident" id="2929075">SetCookies</span><span class="op" id="2929085">(</span><span class="ident" id="2929086">req</span><span class="op" id="2929089">.</span><span class="ident" id="2929090">URL</span><span class="op" id="2929093">,</span>&nbsp;<span class="ident" id="2929095">rc</span><span class="op" id="2929097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2929101">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2929104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2929107">return</span>&nbsp;<span class="ident" id="2929114">resp</span><span class="op" id="2929118">,</span>&nbsp;<span class="ident" id="2929120">err</span><br>
<span class="lineno"></span><span class="op" id="2929124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2929127">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="2929195">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="2929266">//</span><br>
<span class="lineno"></span><span class="comment" id="2929269">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2929329">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2929388">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="2929434">//</span><br>
<span class="lineno"></span><span class="comment" id="2929437">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2929499">//</span><br>
<span class="lineno"></span><span class="comment" id="2929502">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2929566">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="2929631">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="2929699">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2929766">//</span><br>
<span class="lineno"></span><span class="comment" id="2929769">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="2929835">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="2929865">//</span><br>
<span class="lineno"></span><span class="comment" id="2929868">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="2929932">func</span>&nbsp;<span class="op" id="2929937">(</span><span class="ident" id="2929938">c</span>&nbsp;<span class="op" id="2929940">*</span><span class="ident" id="2929941">Client</span><span class="op" id="2929947">)</span>&nbsp;<span class="ident" id="2929949">Do</span><span class="op" id="2929951">(</span><span class="ident" id="2929952">req</span>&nbsp;<span class="op" id="2929956">*</span><span class="ident" id="2929957">Request</span><span class="op" id="2929964">)</span>&nbsp;<span class="op" id="2929966">(</span><span class="ident" id="2929967">resp</span>&nbsp;<span class="op" id="2929972">*</span><span class="ident" id="2929973">Response</span><span class="op" id="2929981">,</span>&nbsp;<span class="ident" id="2929983">err</span>&nbsp;<span class="builtintype" id="2929987">error</span><span class="op" id="2929992">)</span>&nbsp;<span class="op" id="2929994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2929997">if</span>&nbsp;<span class="ident" id="2930000">req</span><span class="op" id="2930003">.</span><span class="ident" id="2930004">Method</span>&nbsp;<span class="op" id="2930011">==</span>&nbsp;<span class="string" id="2930014">&#34;GET&#34;</span>&nbsp;<span class="op" id="2930020">||</span>&nbsp;<span class="ident" id="2930023">req</span><span class="op" id="2930026">.</span><span class="ident" id="2930027">Method</span>&nbsp;<span class="op" id="2930034">==</span>&nbsp;<span class="string" id="2930037">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="2930044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930048">return</span>&nbsp;<span class="ident" id="2930055">c</span><span class="op" id="2930056">.</span><span class="ident" id="2930057">doFollowingRedirects</span><span class="op" id="2930077">(</span><span class="ident" id="2930078">req</span><span class="op" id="2930081">,</span>&nbsp;<span class="ident" id="2930083">shouldRedirectGet</span><span class="op" id="2930100">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930106">if</span>&nbsp;<span class="ident" id="2930109">req</span><span class="op" id="2930112">.</span><span class="ident" id="2930113">Method</span>&nbsp;<span class="op" id="2930120">==</span>&nbsp;<span class="string" id="2930123">&#34;POST&#34;</span>&nbsp;<span class="op" id="2930130">||</span>&nbsp;<span class="ident" id="2930133">req</span><span class="op" id="2930136">.</span><span class="ident" id="2930137">Method</span>&nbsp;<span class="op" id="2930144">==</span>&nbsp;<span class="string" id="2930147">&#34;PUT&#34;</span>&nbsp;<span class="op" id="2930153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930157">return</span>&nbsp;<span class="ident" id="2930164">c</span><span class="op" id="2930165">.</span><span class="ident" id="2930166">doFollowingRedirects</span><span class="op" id="2930186">(</span><span class="ident" id="2930187">req</span><span class="op" id="2930190">,</span>&nbsp;<span class="ident" id="2930192">shouldRedirectPost</span><span class="op" id="2930210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930216">return</span>&nbsp;<span class="ident" id="2930223">c</span><span class="op" id="2930224">.</span><span class="ident" id="2930225">send</span><span class="op" id="2930229">(</span><span class="ident" id="2930230">req</span><span class="op" id="2930233">)</span><br>
<span class="lineno">180</span><span class="op" id="2930235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2930238">func</span>&nbsp;<span class="op" id="2930243">(</span><span class="ident" id="2930244">c</span>&nbsp;<span class="op" id="2930246">*</span><span class="ident" id="2930247">Client</span><span class="op" id="2930253">)</span>&nbsp;<span class="ident" id="2930255">transport</span><span class="op" id="2930264">(</span><span class="op" id="2930265">)</span>&nbsp;<span class="ident" id="2930267">RoundTripper</span>&nbsp;<span class="op" id="2930280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930283">if</span>&nbsp;<span class="ident" id="2930286">c</span><span class="op" id="2930287">.</span><span class="ident" id="2930288">Transport</span>&nbsp;<span class="op" id="2930298">!=</span>&nbsp;<span class="builtintype" id="2930301">nil</span>&nbsp;<span class="op" id="2930305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930309">return</span>&nbsp;<span class="ident" id="2930316">c</span><span class="op" id="2930317">.</span><span class="ident" id="2930318">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930332">return</span>&nbsp;<span class="ident" id="2930339">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="2930356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930359">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="2930391">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2930451">func</span>&nbsp;<span class="ident" id="2930456">send</span><span class="op" id="2930460">(</span><span class="ident" id="2930461">req</span>&nbsp;<span class="op" id="2930465">*</span><span class="ident" id="2930466">Request</span><span class="op" id="2930473">,</span>&nbsp;<span class="ident" id="2930475">t</span>&nbsp;<span class="ident" id="2930477">RoundTripper</span><span class="op" id="2930489">)</span>&nbsp;<span class="op" id="2930491">(</span><span class="ident" id="2930492">resp</span>&nbsp;<span class="op" id="2930497">*</span><span class="ident" id="2930498">Response</span><span class="op" id="2930506">,</span>&nbsp;<span class="ident" id="2930508">err</span>&nbsp;<span class="builtintype" id="2930512">error</span><span class="op" id="2930517">)</span>&nbsp;<span class="op" id="2930519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930522">if</span>&nbsp;<span class="ident" id="2930525">t</span>&nbsp;<span class="op" id="2930527">==</span>&nbsp;<span class="builtintype" id="2930530">nil</span>&nbsp;<span class="op" id="2930534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2930538">req</span><span class="op" id="2930541">.</span><span class="ident" id="2930542">closeBody</span><span class="op" id="2930551">(</span><span class="op" id="2930552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930556">return</span>&nbsp;<span class="builtintype" id="2930563">nil</span><span class="op" id="2930566">,</span>&nbsp;<span class="ident" id="2930568">errors</span><span class="op" id="2930574">.</span><span class="ident" id="2930575">New</span><span class="op" id="2930578">(</span><span class="string" id="2930579">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="2930626">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930633">if</span>&nbsp;<span class="ident" id="2930636">req</span><span class="op" id="2930639">.</span><span class="ident" id="2930640">URL</span>&nbsp;<span class="op" id="2930644">==</span>&nbsp;<span class="builtintype" id="2930647">nil</span>&nbsp;<span class="op" id="2930651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2930655">req</span><span class="op" id="2930658">.</span><span class="ident" id="2930659">closeBody</span><span class="op" id="2930668">(</span><span class="op" id="2930669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930673">return</span>&nbsp;<span class="builtintype" id="2930680">nil</span><span class="op" id="2930683">,</span>&nbsp;<span class="ident" id="2930685">errors</span><span class="op" id="2930691">.</span><span class="ident" id="2930692">New</span><span class="op" id="2930695">(</span><span class="string" id="2930696">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="2930719">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930726">if</span>&nbsp;<span class="ident" id="2930729">req</span><span class="op" id="2930732">.</span><span class="ident" id="2930733">RequestURI</span>&nbsp;<span class="op" id="2930744">!=</span>&nbsp;<span class="string" id="2930747">&#34;&#34;</span>&nbsp;<span class="op" id="2930750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2930754">req</span><span class="op" id="2930757">.</span><span class="ident" id="2930758">closeBody</span><span class="op" id="2930767">(</span><span class="op" id="2930768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2930772">return</span>&nbsp;<span class="builtintype" id="2930779">nil</span><span class="op" id="2930782">,</span>&nbsp;<span class="ident" id="2930784">errors</span><span class="op" id="2930790">.</span><span class="ident" id="2930791">New</span><span class="op" id="2930794">(</span><span class="string" id="2930795">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="2930854">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2930857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2930861">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2930920">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2930980">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931034">if</span>&nbsp;<span class="ident" id="2931037">req</span><span class="op" id="2931040">.</span><span class="ident" id="2931041">Header</span>&nbsp;<span class="op" id="2931048">==</span>&nbsp;<span class="builtintype" id="2931051">nil</span>&nbsp;<span class="op" id="2931055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931059">req</span><span class="op" id="2931062">.</span><span class="ident" id="2931063">Header</span>&nbsp;<span class="op" id="2931070">=</span>&nbsp;<span class="builtinfunc" id="2931072">make</span><span class="op" id="2931076">(</span><span class="ident" id="2931077">Header</span><span class="op" id="2931083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2931086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931090">if</span>&nbsp;<span class="ident" id="2931093">u</span>&nbsp;<span class="op" id="2931095">:=</span>&nbsp;<span class="ident" id="2931098">req</span><span class="op" id="2931101">.</span><span class="ident" id="2931102">URL</span><span class="op" id="2931105">.</span><span class="ident" id="2931106">User</span><span class="op" id="2931110">;</span>&nbsp;<span class="ident" id="2931112">u</span>&nbsp;<span class="op" id="2931114">!=</span>&nbsp;<span class="builtintype" id="2931117">nil</span>&nbsp;<span class="op" id="2931121">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931125">username</span>&nbsp;<span class="op" id="2931134">:=</span>&nbsp;<span class="ident" id="2931137">u</span><span class="op" id="2931138">.</span><span class="ident" id="2931139">Username</span><span class="op" id="2931147">(</span><span class="op" id="2931148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931152">password</span><span class="op" id="2931160">,</span>&nbsp;<span class="ident" id="2931162">_</span>&nbsp;<span class="op" id="2931164">:=</span>&nbsp;<span class="ident" id="2931167">u</span><span class="op" id="2931168">.</span><span class="ident" id="2931169">Password</span><span class="op" id="2931177">(</span><span class="op" id="2931178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931182">req</span><span class="op" id="2931185">.</span><span class="ident" id="2931186">Header</span><span class="op" id="2931192">.</span><span class="ident" id="2931193">Set</span><span class="op" id="2931196">(</span><span class="string" id="2931197">&#34;Authorization&#34;</span><span class="op" id="2931212">,</span>&nbsp;<span class="string" id="2931214">&#34;Basic&nbsp;&#34;</span><span class="op" id="2931222">+</span><span class="ident" id="2931223">basicAuth</span><span class="op" id="2931232">(</span><span class="ident" id="2931233">username</span><span class="op" id="2931241">,</span>&nbsp;<span class="ident" id="2931243">password</span><span class="op" id="2931251">)</span><span class="op" id="2931252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2931255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931258">resp</span><span class="op" id="2931262">,</span>&nbsp;<span class="ident" id="2931264">err</span>&nbsp;<span class="op" id="2931268">=</span>&nbsp;<span class="ident" id="2931270">t</span><span class="op" id="2931271">.</span><span class="ident" id="2931272">RoundTrip</span><span class="op" id="2931281">(</span><span class="ident" id="2931282">req</span><span class="op" id="2931285">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931288">if</span>&nbsp;<span class="ident" id="2931291">err</span>&nbsp;<span class="op" id="2931295">!=</span>&nbsp;<span class="builtintype" id="2931298">nil</span>&nbsp;<span class="op" id="2931302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931306">if</span>&nbsp;<span class="ident" id="2931309">resp</span>&nbsp;<span class="op" id="2931314">!=</span>&nbsp;<span class="builtintype" id="2931317">nil</span>&nbsp;<span class="op" id="2931321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931326">log</span><span class="op" id="2931329">.</span><span class="ident" id="2931330">Printf</span><span class="op" id="2931336">(</span><span class="string" id="2931337">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="2931398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2931402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931406">return</span>&nbsp;<span class="builtintype" id="2931413">nil</span><span class="op" id="2931416">,</span>&nbsp;<span class="ident" id="2931418">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2931423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931426">return</span>&nbsp;<span class="ident" id="2931433">resp</span><span class="op" id="2931437">,</span>&nbsp;<span class="builtintype" id="2931439">nil</span><br>
<span class="lineno"></span><span class="op" id="2931443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2931446">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="2931507">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="2931579">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="2931643">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2931682">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="2931719">func</span>&nbsp;<span class="ident" id="2931724">basicAuth</span><span class="op" id="2931733">(</span><span class="ident" id="2931734">username</span><span class="op" id="2931742">,</span>&nbsp;<span class="ident" id="2931744">password</span>&nbsp;<span class="builtintype" id="2931753">string</span><span class="op" id="2931759">)</span>&nbsp;<span class="builtintype" id="2931761">string</span>&nbsp;<span class="op" id="2931768">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2931771">auth</span>&nbsp;<span class="op" id="2931776">:=</span>&nbsp;<span class="ident" id="2931779">username</span>&nbsp;<span class="op" id="2931788">+</span>&nbsp;<span class="string" id="2931790">&#34;:&#34;</span>&nbsp;<span class="op" id="2931794">+</span>&nbsp;<span class="ident" id="2931796">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2931806">return</span>&nbsp;<span class="ident" id="2931813">base64</span><span class="op" id="2931819">.</span><span class="ident" id="2931820">StdEncoding</span><span class="op" id="2931831">.</span><span class="ident" id="2931832">EncodeToString</span><span class="op" id="2931846">(</span><span class="op" id="2931847">[</span><span class="op" id="2931848">]</span><span class="builtintype" id="2931849">byte</span><span class="op" id="2931853">(</span><span class="ident" id="2931854">auth</span><span class="op" id="2931858">)</span><span class="op" id="2931859">)</span><br>
<span class="lineno"></span><span class="op" id="2931861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2931864">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="2931946">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="2931973">func</span>&nbsp;<span class="ident" id="2931978">shouldRedirectGet</span><span class="op" id="2931995">(</span><span class="ident" id="2931996">statusCode</span>&nbsp;<span class="builtintype" id="2932007">int</span><span class="op" id="2932010">)</span>&nbsp;<span class="builtintype" id="2932012">bool</span>&nbsp;<span class="op" id="2932017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932020">switch</span>&nbsp;<span class="ident" id="2932027">statusCode</span>&nbsp;<span class="op" id="2932038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932041">case</span>&nbsp;<span class="ident" id="2932046">StatusMovedPermanently</span><span class="op" id="2932068">,</span>&nbsp;<span class="ident" id="2932070">StatusFound</span><span class="op" id="2932081">,</span>&nbsp;<span class="ident" id="2932083">StatusSeeOther</span><span class="op" id="2932097">,</span>&nbsp;<span class="ident" id="2932099">StatusTemporaryRedirect</span><span class="op" id="2932122">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932126">return</span>&nbsp;<span class="builtintype" id="2932133">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2932139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932142">return</span>&nbsp;<span class="builtintype" id="2932149">false</span><br>
<span class="lineno"></span><span class="op" id="2932155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2932158">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="2932241">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="2932268">func</span>&nbsp;<span class="ident" id="2932273">shouldRedirectPost</span><span class="op" id="2932291">(</span><span class="ident" id="2932292">statusCode</span>&nbsp;<span class="builtintype" id="2932303">int</span><span class="op" id="2932306">)</span>&nbsp;<span class="builtintype" id="2932308">bool</span>&nbsp;<span class="op" id="2932313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932316">switch</span>&nbsp;<span class="ident" id="2932323">statusCode</span>&nbsp;<span class="op" id="2932334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932337">case</span>&nbsp;<span class="ident" id="2932342">StatusFound</span><span class="op" id="2932353">,</span>&nbsp;<span class="ident" id="2932355">StatusSeeOther</span><span class="op" id="2932369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932373">return</span>&nbsp;<span class="builtintype" id="2932380">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2932386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2932389">return</span>&nbsp;<span class="builtintype" id="2932396">false</span><br>
<span class="lineno"></span><span class="op" id="2932402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2932405">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="2932488">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="2932566">//</span><br>
<span class="lineno"></span><span class="comment" id="2932569">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2932599">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="2932617">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="2932639">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2932670">//</span><br>
<span class="lineno"></span><span class="comment" id="2932673">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2932742">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2932809">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="2932819">//</span><br>
<span class="lineno"></span><span class="comment" id="2932822">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2932884">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2932944">//</span><br>
<span class="lineno"></span><span class="comment" id="2932947">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="2932993">func</span>&nbsp;<span class="ident" id="2932998">Get</span><span class="op" id="2933001">(</span><span class="ident" id="2933002">url</span>&nbsp;<span class="builtintype" id="2933006">string</span><span class="op" id="2933012">)</span>&nbsp;<span class="op" id="2933014">(</span><span class="ident" id="2933015">resp</span>&nbsp;<span class="op" id="2933020">*</span><span class="ident" id="2933021">Response</span><span class="op" id="2933029">,</span>&nbsp;<span class="ident" id="2933031">err</span>&nbsp;<span class="builtintype" id="2933035">error</span><span class="op" id="2933040">)</span>&nbsp;<span class="op" id="2933042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933045">return</span>&nbsp;<span class="ident" id="2933052">DefaultClient</span><span class="op" id="2933065">.</span><span class="ident" id="2933066">Get</span><span class="op" id="2933069">(</span><span class="ident" id="2933070">url</span><span class="op" id="2933073">)</span><br>
<span class="lineno"></span><span class="op" id="2933075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2933078">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="2933151">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2933223">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2933259">//</span><br>
<span class="lineno"></span><span class="comment" id="2933262">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2933292">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="2933310">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="2933332">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2933363">//</span><br>
<span class="lineno"></span><span class="comment" id="2933366">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="2933435">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="2933505">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2933524">//</span><br>
<span class="lineno"></span><span class="comment" id="2933527">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2933589">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2933649">func</span>&nbsp;<span class="op" id="2933654">(</span><span class="ident" id="2933655">c</span>&nbsp;<span class="op" id="2933657">*</span><span class="ident" id="2933658">Client</span><span class="op" id="2933664">)</span>&nbsp;<span class="ident" id="2933666">Get</span><span class="op" id="2933669">(</span><span class="ident" id="2933670">url</span>&nbsp;<span class="builtintype" id="2933674">string</span><span class="op" id="2933680">)</span>&nbsp;<span class="op" id="2933682">(</span><span class="ident" id="2933683">resp</span>&nbsp;<span class="op" id="2933688">*</span><span class="ident" id="2933689">Response</span><span class="op" id="2933697">,</span>&nbsp;<span class="ident" id="2933699">err</span>&nbsp;<span class="builtintype" id="2933703">error</span><span class="op" id="2933708">)</span>&nbsp;<span class="op" id="2933710">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933713">req</span><span class="op" id="2933716">,</span>&nbsp;<span class="ident" id="2933718">err</span>&nbsp;<span class="op" id="2933722">:=</span>&nbsp;<span class="ident" id="2933725">NewRequest</span><span class="op" id="2933735">(</span><span class="string" id="2933736">&#34;GET&#34;</span><span class="op" id="2933741">,</span>&nbsp;<span class="ident" id="2933743">url</span><span class="op" id="2933746">,</span>&nbsp;<span class="builtintype" id="2933748">nil</span><span class="op" id="2933751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933754">if</span>&nbsp;<span class="ident" id="2933757">err</span>&nbsp;<span class="op" id="2933761">!=</span>&nbsp;<span class="builtintype" id="2933764">nil</span>&nbsp;<span class="op" id="2933768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933772">return</span>&nbsp;<span class="builtintype" id="2933779">nil</span><span class="op" id="2933782">,</span>&nbsp;<span class="ident" id="2933784">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2933789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933792">return</span>&nbsp;<span class="ident" id="2933799">c</span><span class="op" id="2933800">.</span><span class="ident" id="2933801">doFollowingRedirects</span><span class="op" id="2933821">(</span><span class="ident" id="2933822">req</span><span class="op" id="2933825">,</span>&nbsp;<span class="ident" id="2933827">shouldRedirectGet</span><span class="op" id="2933844">)</span><br>
<span class="lineno">300</span><span class="op" id="2933846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2933849">func</span>&nbsp;<span class="op" id="2933854">(</span><span class="ident" id="2933855">c</span>&nbsp;<span class="op" id="2933857">*</span><span class="ident" id="2933858">Client</span><span class="op" id="2933864">)</span>&nbsp;<span class="ident" id="2933866">doFollowingRedirects</span><span class="op" id="2933886">(</span><span class="ident" id="2933887">ireq</span>&nbsp;<span class="op" id="2933892">*</span><span class="ident" id="2933893">Request</span><span class="op" id="2933900">,</span>&nbsp;<span class="ident" id="2933902">shouldRedirect</span>&nbsp;<span class="keyword" id="2933917">func</span><span class="op" id="2933921">(</span><span class="builtintype" id="2933922">int</span><span class="op" id="2933925">)</span>&nbsp;<span class="builtintype" id="2933927">bool</span><span class="op" id="2933931">)</span>&nbsp;<span class="op" id="2933933">(</span><span class="ident" id="2933934">resp</span>&nbsp;<span class="op" id="2933939">*</span><span class="ident" id="2933940">Response</span><span class="op" id="2933948">,</span>&nbsp;<span class="ident" id="2933950">err</span>&nbsp;<span class="builtintype" id="2933954">error</span><span class="op" id="2933959">)</span>&nbsp;<span class="op" id="2933961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933964">var</span>&nbsp;<span class="ident" id="2933968">base</span>&nbsp;<span class="op" id="2933973">*</span><span class="ident" id="2933974">url</span><span class="op" id="2933977">.</span><span class="ident" id="2933978">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933983">redirectChecker</span>&nbsp;<span class="op" id="2933999">:=</span>&nbsp;<span class="ident" id="2934002">c</span><span class="op" id="2934003">.</span><span class="ident" id="2934004">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934019">if</span>&nbsp;<span class="ident" id="2934022">redirectChecker</span>&nbsp;<span class="op" id="2934038">==</span>&nbsp;<span class="builtintype" id="2934041">nil</span>&nbsp;<span class="op" id="2934045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934049">redirectChecker</span>&nbsp;<span class="op" id="2934065">=</span>&nbsp;<span class="ident" id="2934067">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934092">var</span>&nbsp;<span class="ident" id="2934096">via</span>&nbsp;<span class="op" id="2934100">[</span><span class="op" id="2934101">]</span><span class="op" id="2934102">*</span><span class="ident" id="2934103">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934113">if</span>&nbsp;<span class="ident" id="2934116">ireq</span><span class="op" id="2934120">.</span><span class="ident" id="2934121">URL</span>&nbsp;<span class="op" id="2934125">==</span>&nbsp;<span class="builtintype" id="2934128">nil</span>&nbsp;<span class="op" id="2934132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934136">ireq</span><span class="op" id="2934140">.</span><span class="ident" id="2934141">closeBody</span><span class="op" id="2934150">(</span><span class="op" id="2934151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934155">return</span>&nbsp;<span class="builtintype" id="2934162">nil</span><span class="op" id="2934165">,</span>&nbsp;<span class="ident" id="2934167">errors</span><span class="op" id="2934173">.</span><span class="ident" id="2934174">New</span><span class="op" id="2934177">(</span><span class="string" id="2934178">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="2934201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934208">var</span>&nbsp;<span class="ident" id="2934212">reqmu</span>&nbsp;<span class="ident" id="2934218">sync</span><span class="op" id="2934222">.</span><span class="ident" id="2934223">Mutex</span>&nbsp;<span class="comment" id="2934229">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934244">req</span>&nbsp;<span class="op" id="2934248">:=</span>&nbsp;<span class="ident" id="2934251">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934258">var</span>&nbsp;<span class="ident" id="2934262">timer</span>&nbsp;<span class="op" id="2934268">*</span><span class="ident" id="2934269">time</span><span class="op" id="2934273">.</span><span class="ident" id="2934274">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934281">if</span>&nbsp;<span class="ident" id="2934284">c</span><span class="op" id="2934285">.</span><span class="ident" id="2934286">Timeout</span>&nbsp;<span class="op" id="2934294">&gt;</span>&nbsp;<span class="num" id="2934296">0</span>&nbsp;<span class="op" id="2934298">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934302">type</span>&nbsp;<span class="ident" id="2934307">canceler</span>&nbsp;<span class="keyword" id="2934316">interface</span>&nbsp;<span class="op" id="2934326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934331">CancelRequest</span><span class="op" id="2934344">(</span><span class="op" id="2934345">*</span><span class="ident" id="2934346">Request</span><span class="op" id="2934353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934361">tr</span><span class="op" id="2934363">,</span>&nbsp;<span class="ident" id="2934365">ok</span>&nbsp;<span class="op" id="2934368">:=</span>&nbsp;<span class="ident" id="2934371">c</span><span class="op" id="2934372">.</span><span class="ident" id="2934373">transport</span><span class="op" id="2934382">(</span><span class="op" id="2934383">)</span><span class="op" id="2934384">.</span><span class="op" id="2934385">(</span><span class="ident" id="2934386">canceler</span><span class="op" id="2934394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934398">if</span>&nbsp;<span class="op" id="2934401">!</span><span class="ident" id="2934402">ok</span>&nbsp;<span class="op" id="2934405">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934410">return</span>&nbsp;<span class="builtintype" id="2934417">nil</span><span class="op" id="2934420">,</span>&nbsp;<span class="ident" id="2934422">fmt</span><span class="op" id="2934425">.</span><span class="ident" id="2934426">Errorf</span><span class="op" id="2934432">(</span><span class="string" id="2934433">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="2934525">,</span>&nbsp;<span class="ident" id="2934527">c</span><span class="op" id="2934528">.</span><span class="ident" id="2934529">transport</span><span class="op" id="2934538">(</span><span class="op" id="2934539">)</span><span class="op" id="2934540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934548">timer</span>&nbsp;<span class="op" id="2934554">=</span>&nbsp;<span class="ident" id="2934556">time</span><span class="op" id="2934560">.</span><span class="ident" id="2934561">AfterFunc</span><span class="op" id="2934570">(</span><span class="ident" id="2934571">c</span><span class="op" id="2934572">.</span><span class="ident" id="2934573">Timeout</span><span class="op" id="2934580">,</span>&nbsp;<span class="keyword" id="2934582">func</span><span class="op" id="2934586">(</span><span class="op" id="2934587">)</span>&nbsp;<span class="op" id="2934589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934594">reqmu</span><span class="op" id="2934599">.</span><span class="ident" id="2934600">Lock</span><span class="op" id="2934604">(</span><span class="op" id="2934605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934610">defer</span>&nbsp;<span class="ident" id="2934616">reqmu</span><span class="op" id="2934621">.</span><span class="ident" id="2934622">Unlock</span><span class="op" id="2934628">(</span><span class="op" id="2934629">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934634">tr</span><span class="op" id="2934636">.</span><span class="ident" id="2934637">CancelRequest</span><span class="op" id="2934650">(</span><span class="ident" id="2934651">req</span><span class="op" id="2934654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934658">}</span><span class="op" id="2934659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934666">urlStr</span>&nbsp;<span class="op" id="2934673">:=</span>&nbsp;<span class="string" id="2934676">&#34;&#34;</span>&nbsp;<span class="comment" id="2934679">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934744">redirectFailed</span>&nbsp;<span class="op" id="2934759">:=</span>&nbsp;<span class="builtintype" id="2934762">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934769">for</span>&nbsp;<span class="ident" id="2934773">redirect</span>&nbsp;<span class="op" id="2934782">:=</span>&nbsp;<span class="num" id="2934785">0</span><span class="op" id="2934786">;</span>&nbsp;<span class="op" id="2934788">;</span>&nbsp;<span class="ident" id="2934790">redirect</span><span class="op" id="2934798">++</span>&nbsp;<span class="op" id="2934801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934805">if</span>&nbsp;<span class="ident" id="2934808">redirect</span>&nbsp;<span class="op" id="2934817">!=</span>&nbsp;<span class="num" id="2934820">0</span>&nbsp;<span class="op" id="2934822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934827">nreq</span>&nbsp;<span class="op" id="2934832">:=</span>&nbsp;<span class="builtinfunc" id="2934835">new</span><span class="op" id="2934838">(</span><span class="ident" id="2934839">Request</span><span class="op" id="2934846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934851">nreq</span><span class="op" id="2934855">.</span><span class="ident" id="2934856">Method</span>&nbsp;<span class="op" id="2934863">=</span>&nbsp;<span class="ident" id="2934865">ireq</span><span class="op" id="2934869">.</span><span class="ident" id="2934870">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934880">if</span>&nbsp;<span class="ident" id="2934883">ireq</span><span class="op" id="2934887">.</span><span class="ident" id="2934888">Method</span>&nbsp;<span class="op" id="2934895">==</span>&nbsp;<span class="string" id="2934898">&#34;POST&#34;</span>&nbsp;<span class="op" id="2934905">||</span>&nbsp;<span class="ident" id="2934908">ireq</span><span class="op" id="2934912">.</span><span class="ident" id="2934913">Method</span>&nbsp;<span class="op" id="2934920">==</span>&nbsp;<span class="string" id="2934923">&#34;PUT&#34;</span>&nbsp;<span class="op" id="2934929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934935">nreq</span><span class="op" id="2934939">.</span><span class="ident" id="2934940">Method</span>&nbsp;<span class="op" id="2934947">=</span>&nbsp;<span class="string" id="2934949">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2934958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934963">nreq</span><span class="op" id="2934967">.</span><span class="ident" id="2934968">Header</span>&nbsp;<span class="op" id="2934975">=</span>&nbsp;<span class="builtinfunc" id="2934977">make</span><span class="op" id="2934981">(</span><span class="ident" id="2934982">Header</span><span class="op" id="2934988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934993">nreq</span><span class="op" id="2934997">.</span><span class="ident" id="2934998">URL</span><span class="op" id="2935001">,</span>&nbsp;<span class="ident" id="2935003">err</span>&nbsp;<span class="op" id="2935007">=</span>&nbsp;<span class="ident" id="2935009">base</span><span class="op" id="2935013">.</span><span class="ident" id="2935014">Parse</span><span class="op" id="2935019">(</span><span class="ident" id="2935020">urlStr</span><span class="op" id="2935026">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935031">if</span>&nbsp;<span class="ident" id="2935034">err</span>&nbsp;<span class="op" id="2935038">!=</span>&nbsp;<span class="builtintype" id="2935041">nil</span>&nbsp;<span class="op" id="2935045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935051">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935065">if</span>&nbsp;<span class="builtinfunc" id="2935068">len</span><span class="op" id="2935071">(</span><span class="ident" id="2935072">via</span><span class="op" id="2935075">)</span>&nbsp;<span class="op" id="2935077">&gt;</span>&nbsp;<span class="num" id="2935079">0</span>&nbsp;<span class="op" id="2935081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935087">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935118">lastReq</span>&nbsp;<span class="op" id="2935126">:=</span>&nbsp;<span class="ident" id="2935129">via</span><span class="op" id="2935132">[</span><span class="builtinfunc" id="2935133">len</span><span class="op" id="2935136">(</span><span class="ident" id="2935137">via</span><span class="op" id="2935140">)</span><span class="op" id="2935141">-</span><span class="num" id="2935142">1</span><span class="op" id="2935143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935149">if</span>&nbsp;<span class="ident" id="2935152">ref</span>&nbsp;<span class="op" id="2935156">:=</span>&nbsp;<span class="ident" id="2935159">refererForURL</span><span class="op" id="2935172">(</span><span class="ident" id="2935173">lastReq</span><span class="op" id="2935180">.</span><span class="ident" id="2935181">URL</span><span class="op" id="2935184">,</span>&nbsp;<span class="ident" id="2935186">nreq</span><span class="op" id="2935190">.</span><span class="ident" id="2935191">URL</span><span class="op" id="2935194">)</span><span class="op" id="2935195">;</span>&nbsp;<span class="ident" id="2935197">ref</span>&nbsp;<span class="op" id="2935201">!=</span>&nbsp;<span class="string" id="2935204">&#34;&#34;</span>&nbsp;<span class="op" id="2935207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935214">nreq</span><span class="op" id="2935218">.</span><span class="ident" id="2935219">Header</span><span class="op" id="2935225">.</span><span class="ident" id="2935226">Set</span><span class="op" id="2935229">(</span><span class="string" id="2935230">&#34;Referer&#34;</span><span class="op" id="2935239">,</span>&nbsp;<span class="ident" id="2935241">ref</span><span class="op" id="2935244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935257">err</span>&nbsp;<span class="op" id="2935261">=</span>&nbsp;<span class="ident" id="2935263">redirectChecker</span><span class="op" id="2935278">(</span><span class="ident" id="2935279">nreq</span><span class="op" id="2935283">,</span>&nbsp;<span class="ident" id="2935285">via</span><span class="op" id="2935288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935294">if</span>&nbsp;<span class="ident" id="2935297">err</span>&nbsp;<span class="op" id="2935301">!=</span>&nbsp;<span class="builtintype" id="2935304">nil</span>&nbsp;<span class="op" id="2935308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935315">redirectFailed</span>&nbsp;<span class="op" id="2935330">=</span>&nbsp;<span class="builtintype" id="2935332">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935342">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935352">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935362">reqmu</span><span class="op" id="2935367">.</span><span class="ident" id="2935368">Lock</span><span class="op" id="2935372">(</span><span class="op" id="2935373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935378">req</span>&nbsp;<span class="op" id="2935382">=</span>&nbsp;<span class="ident" id="2935384">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935392">reqmu</span><span class="op" id="2935397">.</span><span class="ident" id="2935398">Unlock</span><span class="op" id="2935404">(</span><span class="op" id="2935405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935409">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935414">urlStr</span>&nbsp;<span class="op" id="2935421">=</span>&nbsp;<span class="ident" id="2935423">req</span><span class="op" id="2935426">.</span><span class="ident" id="2935427">URL</span><span class="op" id="2935430">.</span><span class="ident" id="2935431">String</span><span class="op" id="2935437">(</span><span class="op" id="2935438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935442">if</span>&nbsp;<span class="ident" id="2935445">resp</span><span class="op" id="2935449">,</span>&nbsp;<span class="ident" id="2935451">err</span>&nbsp;<span class="op" id="2935455">=</span>&nbsp;<span class="ident" id="2935457">c</span><span class="op" id="2935458">.</span><span class="ident" id="2935459">send</span><span class="op" id="2935463">(</span><span class="ident" id="2935464">req</span><span class="op" id="2935467">)</span><span class="op" id="2935468">;</span>&nbsp;<span class="ident" id="2935470">err</span>&nbsp;<span class="op" id="2935474">!=</span>&nbsp;<span class="builtintype" id="2935477">nil</span>&nbsp;<span class="op" id="2935481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935494">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935499">if</span>&nbsp;<span class="ident" id="2935502">shouldRedirect</span><span class="op" id="2935516">(</span><span class="ident" id="2935517">resp</span><span class="op" id="2935521">.</span><span class="ident" id="2935522">StatusCode</span><span class="op" id="2935532">)</span>&nbsp;<span class="op" id="2935534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935539">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935614">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935695">const</span>&nbsp;<span class="ident" id="2935701">maxBodySlurpSize</span>&nbsp;<span class="op" id="2935718">=</span>&nbsp;<span class="num" id="2935720">2</span>&nbsp;<span class="op" id="2935722">&lt;&lt;</span>&nbsp;<span class="num" id="2935725">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935731">if</span>&nbsp;<span class="ident" id="2935734">resp</span><span class="op" id="2935738">.</span><span class="ident" id="2935739">ContentLength</span>&nbsp;<span class="op" id="2935753">==</span>&nbsp;<span class="op" id="2935756">-</span><span class="num" id="2935757">1</span>&nbsp;<span class="op" id="2935759">||</span>&nbsp;<span class="ident" id="2935762">resp</span><span class="op" id="2935766">.</span><span class="ident" id="2935767">ContentLength</span>&nbsp;<span class="op" id="2935781">&lt;=</span>&nbsp;<span class="ident" id="2935784">maxBodySlurpSize</span>&nbsp;<span class="op" id="2935801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935807">io</span><span class="op" id="2935809">.</span><span class="ident" id="2935810">CopyN</span><span class="op" id="2935815">(</span><span class="ident" id="2935816">ioutil</span><span class="op" id="2935822">.</span><span class="ident" id="2935823">Discard</span><span class="op" id="2935830">,</span>&nbsp;<span class="ident" id="2935832">resp</span><span class="op" id="2935836">.</span><span class="ident" id="2935837">Body</span><span class="op" id="2935841">,</span>&nbsp;<span class="ident" id="2935843">maxBodySlurpSize</span><span class="op" id="2935859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935869">resp</span><span class="op" id="2935873">.</span><span class="ident" id="2935874">Body</span><span class="op" id="2935878">.</span><span class="ident" id="2935879">Close</span><span class="op" id="2935884">(</span><span class="op" id="2935885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935890">if</span>&nbsp;<span class="ident" id="2935893">urlStr</span>&nbsp;<span class="op" id="2935900">=</span>&nbsp;<span class="ident" id="2935902">resp</span><span class="op" id="2935906">.</span><span class="ident" id="2935907">Header</span><span class="op" id="2935913">.</span><span class="ident" id="2935914">Get</span><span class="op" id="2935917">(</span><span class="string" id="2935918">&#34;Location&#34;</span><span class="op" id="2935928">)</span><span class="op" id="2935929">;</span>&nbsp;<span class="ident" id="2935931">urlStr</span>&nbsp;<span class="op" id="2935938">==</span>&nbsp;<span class="string" id="2935941">&#34;&#34;</span>&nbsp;<span class="op" id="2935944">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935950">err</span>&nbsp;<span class="op" id="2935954">=</span>&nbsp;<span class="ident" id="2935956">errors</span><span class="op" id="2935962">.</span><span class="ident" id="2935963">New</span><span class="op" id="2935966">(</span><span class="ident" id="2935967">fmt</span><span class="op" id="2935970">.</span><span class="ident" id="2935971">Sprintf</span><span class="op" id="2935978">(</span><span class="string" id="2935979">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="2936016">,</span>&nbsp;<span class="ident" id="2936018">resp</span><span class="op" id="2936022">.</span><span class="ident" id="2936023">StatusCode</span><span class="op" id="2936033">)</span><span class="op" id="2936034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936040">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936054">base</span>&nbsp;<span class="op" id="2936059">=</span>&nbsp;<span class="ident" id="2936061">req</span><span class="op" id="2936064">.</span><span class="ident" id="2936065">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936072">via</span>&nbsp;<span class="op" id="2936076">=</span>&nbsp;<span class="builtinfunc" id="2936078">append</span><span class="op" id="2936084">(</span><span class="ident" id="2936085">via</span><span class="op" id="2936088">,</span>&nbsp;<span class="ident" id="2936090">req</span><span class="op" id="2936093">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936113">if</span>&nbsp;<span class="ident" id="2936116">timer</span>&nbsp;<span class="op" id="2936122">!=</span>&nbsp;<span class="builtintype" id="2936125">nil</span>&nbsp;<span class="op" id="2936129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936134">resp</span><span class="op" id="2936138">.</span><span class="ident" id="2936139">Body</span>&nbsp;<span class="op" id="2936144">=</span>&nbsp;<span class="op" id="2936146">&amp;</span><span class="ident" id="2936147">cancelTimerBody</span><span class="op" id="2936162">{</span><span class="ident" id="2936163">timer</span><span class="op" id="2936168">,</span>&nbsp;<span class="ident" id="2936170">resp</span><span class="op" id="2936174">.</span><span class="ident" id="2936175">Body</span><span class="op" id="2936179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936183">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936187">return</span>&nbsp;<span class="ident" id="2936194">resp</span><span class="op" id="2936198">,</span>&nbsp;<span class="builtintype" id="2936200">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936209">method</span>&nbsp;<span class="op" id="2936216">:=</span>&nbsp;<span class="ident" id="2936219">ireq</span><span class="op" id="2936223">.</span><span class="ident" id="2936224">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936232">urlErr</span>&nbsp;<span class="op" id="2936239">:=</span>&nbsp;<span class="op" id="2936242">&amp;</span><span class="ident" id="2936243">url</span><span class="op" id="2936246">.</span><span class="ident" id="2936247">Error</span><span class="op" id="2936252">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936256">Op</span><span class="op" id="2936258">:</span>&nbsp;&nbsp;<span class="ident" id="2936261">method</span><span class="op" id="2936267">[</span><span class="num" id="2936268">0</span><span class="op" id="2936269">:</span><span class="num" id="2936270">1</span><span class="op" id="2936271">]</span>&nbsp;<span class="op" id="2936273">+</span>&nbsp;<span class="ident" id="2936275">strings</span><span class="op" id="2936282">.</span><span class="ident" id="2936283">ToLower</span><span class="op" id="2936290">(</span><span class="ident" id="2936291">method</span><span class="op" id="2936297">[</span><span class="num" id="2936298">1</span><span class="op" id="2936299">:</span><span class="op" id="2936300">]</span><span class="op" id="2936301">)</span><span class="op" id="2936302">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936306">URL</span><span class="op" id="2936309">:</span>&nbsp;<span class="ident" id="2936311">urlStr</span><span class="op" id="2936317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936321">Err</span><span class="op" id="2936324">:</span>&nbsp;<span class="ident" id="2936326">err</span><span class="op" id="2936329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936336">if</span>&nbsp;<span class="ident" id="2936339">redirectFailed</span>&nbsp;<span class="op" id="2936354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936358">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936425">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936481">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936519">return</span>&nbsp;<span class="ident" id="2936526">resp</span><span class="op" id="2936530">,</span>&nbsp;<span class="ident" id="2936532">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936544">if</span>&nbsp;<span class="ident" id="2936547">resp</span>&nbsp;<span class="op" id="2936552">!=</span>&nbsp;<span class="builtintype" id="2936555">nil</span>&nbsp;<span class="op" id="2936559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936563">resp</span><span class="op" id="2936567">.</span><span class="ident" id="2936568">Body</span><span class="op" id="2936572">.</span><span class="ident" id="2936573">Close</span><span class="op" id="2936578">(</span><span class="op" id="2936579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936582">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936585">return</span>&nbsp;<span class="builtintype" id="2936592">nil</span><span class="op" id="2936595">,</span>&nbsp;<span class="ident" id="2936597">urlErr</span><br>
<span class="lineno"></span><span class="op" id="2936604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2936607">func</span>&nbsp;<span class="ident" id="2936612">defaultCheckRedirect</span><span class="op" id="2936632">(</span><span class="ident" id="2936633">req</span>&nbsp;<span class="op" id="2936637">*</span><span class="ident" id="2936638">Request</span><span class="op" id="2936645">,</span>&nbsp;<span class="ident" id="2936647">via</span>&nbsp;<span class="op" id="2936651">[</span><span class="op" id="2936652">]</span><span class="op" id="2936653">*</span><span class="ident" id="2936654">Request</span><span class="op" id="2936661">)</span>&nbsp;<span class="builtintype" id="2936663">error</span>&nbsp;<span class="op" id="2936669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936672">if</span>&nbsp;<span class="builtinfunc" id="2936675">len</span><span class="op" id="2936678">(</span><span class="ident" id="2936679">via</span><span class="op" id="2936682">)</span>&nbsp;<span class="op" id="2936684">&gt;=</span>&nbsp;<span class="num" id="2936687">10</span>&nbsp;<span class="op" id="2936690">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936694">return</span>&nbsp;<span class="ident" id="2936701">errors</span><span class="op" id="2936707">.</span><span class="ident" id="2936708">New</span><span class="op" id="2936711">(</span><span class="string" id="2936712">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="2936740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936746">return</span>&nbsp;<span class="builtintype" id="2936753">nil</span><br>
<span class="lineno"></span><span class="op" id="2936757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="2936760">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="2936804">//</span><br>
<span class="lineno"></span><span class="comment" id="2936807">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2936867">//</span><br>
<span class="lineno"></span><span class="comment" id="2936870">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="2936917">func</span>&nbsp;<span class="ident" id="2936922">Post</span><span class="op" id="2936926">(</span><span class="ident" id="2936927">url</span>&nbsp;<span class="builtintype" id="2936931">string</span><span class="op" id="2936937">,</span>&nbsp;<span class="ident" id="2936939">bodyType</span>&nbsp;<span class="builtintype" id="2936948">string</span><span class="op" id="2936954">,</span>&nbsp;<span class="ident" id="2936956">body</span>&nbsp;<span class="ident" id="2936961">io</span><span class="op" id="2936963">.</span><span class="ident" id="2936964">Reader</span><span class="op" id="2936970">)</span>&nbsp;<span class="op" id="2936972">(</span><span class="ident" id="2936973">resp</span>&nbsp;<span class="op" id="2936978">*</span><span class="ident" id="2936979">Response</span><span class="op" id="2936987">,</span>&nbsp;<span class="ident" id="2936989">err</span>&nbsp;<span class="builtintype" id="2936993">error</span><span class="op" id="2936998">)</span>&nbsp;<span class="op" id="2937000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937003">return</span>&nbsp;<span class="ident" id="2937010">DefaultClient</span><span class="op" id="2937023">.</span><span class="ident" id="2937024">Post</span><span class="op" id="2937028">(</span><span class="ident" id="2937029">url</span><span class="op" id="2937032">,</span>&nbsp;<span class="ident" id="2937034">bodyType</span><span class="op" id="2937042">,</span>&nbsp;<span class="ident" id="2937044">body</span><span class="op" id="2937048">)</span><br>
<span class="lineno"></span><span class="op" id="2937050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2937053">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="2937097">//</span><br>
<span class="lineno"></span><span class="comment" id="2937100">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2937160">//</span><br>
<span class="lineno"></span><span class="comment" id="2937163">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2937232">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="2937244">func</span>&nbsp;<span class="op" id="2937249">(</span><span class="ident" id="2937250">c</span>&nbsp;<span class="op" id="2937252">*</span><span class="ident" id="2937253">Client</span><span class="op" id="2937259">)</span>&nbsp;<span class="ident" id="2937261">Post</span><span class="op" id="2937265">(</span><span class="ident" id="2937266">url</span>&nbsp;<span class="builtintype" id="2937270">string</span><span class="op" id="2937276">,</span>&nbsp;<span class="ident" id="2937278">bodyType</span>&nbsp;<span class="builtintype" id="2937287">string</span><span class="op" id="2937293">,</span>&nbsp;<span class="ident" id="2937295">body</span>&nbsp;<span class="ident" id="2937300">io</span><span class="op" id="2937302">.</span><span class="ident" id="2937303">Reader</span><span class="op" id="2937309">)</span>&nbsp;<span class="op" id="2937311">(</span><span class="ident" id="2937312">resp</span>&nbsp;<span class="op" id="2937317">*</span><span class="ident" id="2937318">Response</span><span class="op" id="2937326">,</span>&nbsp;<span class="ident" id="2937328">err</span>&nbsp;<span class="builtintype" id="2937332">error</span><span class="op" id="2937337">)</span>&nbsp;<span class="op" id="2937339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937342">req</span><span class="op" id="2937345">,</span>&nbsp;<span class="ident" id="2937347">err</span>&nbsp;<span class="op" id="2937351">:=</span>&nbsp;<span class="ident" id="2937354">NewRequest</span><span class="op" id="2937364">(</span><span class="string" id="2937365">&#34;POST&#34;</span><span class="op" id="2937371">,</span>&nbsp;<span class="ident" id="2937373">url</span><span class="op" id="2937376">,</span>&nbsp;<span class="ident" id="2937378">body</span><span class="op" id="2937382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937385">if</span>&nbsp;<span class="ident" id="2937388">err</span>&nbsp;<span class="op" id="2937392">!=</span>&nbsp;<span class="builtintype" id="2937395">nil</span>&nbsp;<span class="op" id="2937399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937403">return</span>&nbsp;<span class="builtintype" id="2937410">nil</span><span class="op" id="2937413">,</span>&nbsp;<span class="ident" id="2937415">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937420">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937423">req</span><span class="op" id="2937426">.</span><span class="ident" id="2937427">Header</span><span class="op" id="2937433">.</span><span class="ident" id="2937434">Set</span><span class="op" id="2937437">(</span><span class="string" id="2937438">&#34;Content-Type&#34;</span><span class="op" id="2937452">,</span>&nbsp;<span class="ident" id="2937454">bodyType</span><span class="op" id="2937462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937465">return</span>&nbsp;<span class="ident" id="2937472">c</span><span class="op" id="2937473">.</span><span class="ident" id="2937474">doFollowingRedirects</span><span class="op" id="2937494">(</span><span class="ident" id="2937495">req</span><span class="op" id="2937498">,</span>&nbsp;<span class="ident" id="2937500">shouldRedirectPost</span><span class="op" id="2937518">)</span><br>
<span class="lineno"></span><span class="op" id="2937520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2937523">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="2937592">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="2937635">//</span><br>
<span class="lineno"></span><span class="comment" id="2937638">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2937700">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2937760">//</span><br>
<span class="lineno">450</span><span class="comment" id="2937763">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="2937818">func</span>&nbsp;<span class="ident" id="2937823">PostForm</span><span class="op" id="2937831">(</span><span class="ident" id="2937832">url</span>&nbsp;<span class="builtintype" id="2937836">string</span><span class="op" id="2937842">,</span>&nbsp;<span class="ident" id="2937844">data</span>&nbsp;<span class="ident" id="2937849">url</span><span class="op" id="2937852">.</span><span class="ident" id="2937853">Values</span><span class="op" id="2937859">)</span>&nbsp;<span class="op" id="2937861">(</span><span class="ident" id="2937862">resp</span>&nbsp;<span class="op" id="2937867">*</span><span class="ident" id="2937868">Response</span><span class="op" id="2937876">,</span>&nbsp;<span class="ident" id="2937878">err</span>&nbsp;<span class="builtintype" id="2937882">error</span><span class="op" id="2937887">)</span>&nbsp;<span class="op" id="2937889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937892">return</span>&nbsp;<span class="ident" id="2937899">DefaultClient</span><span class="op" id="2937912">.</span><span class="ident" id="2937913">PostForm</span><span class="op" id="2937921">(</span><span class="ident" id="2937922">url</span><span class="op" id="2937925">,</span>&nbsp;<span class="ident" id="2937927">data</span><span class="op" id="2937931">)</span><br>
<span class="lineno"></span><span class="op" id="2937933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="2937936">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="2937984">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="2938047">//</span><br>
<span class="lineno"></span><span class="comment" id="2938050">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2938112">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="2938172">func</span>&nbsp;<span class="op" id="2938177">(</span><span class="ident" id="2938178">c</span>&nbsp;<span class="op" id="2938180">*</span><span class="ident" id="2938181">Client</span><span class="op" id="2938187">)</span>&nbsp;<span class="ident" id="2938189">PostForm</span><span class="op" id="2938197">(</span><span class="ident" id="2938198">url</span>&nbsp;<span class="builtintype" id="2938202">string</span><span class="op" id="2938208">,</span>&nbsp;<span class="ident" id="2938210">data</span>&nbsp;<span class="ident" id="2938215">url</span><span class="op" id="2938218">.</span><span class="ident" id="2938219">Values</span><span class="op" id="2938225">)</span>&nbsp;<span class="op" id="2938227">(</span><span class="ident" id="2938228">resp</span>&nbsp;<span class="op" id="2938233">*</span><span class="ident" id="2938234">Response</span><span class="op" id="2938242">,</span>&nbsp;<span class="ident" id="2938244">err</span>&nbsp;<span class="builtintype" id="2938248">error</span><span class="op" id="2938253">)</span>&nbsp;<span class="op" id="2938255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938258">return</span>&nbsp;<span class="ident" id="2938265">c</span><span class="op" id="2938266">.</span><span class="ident" id="2938267">Post</span><span class="op" id="2938271">(</span><span class="ident" id="2938272">url</span><span class="op" id="2938275">,</span>&nbsp;<span class="string" id="2938277">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="2938312">,</span>&nbsp;<span class="ident" id="2938314">strings</span><span class="op" id="2938321">.</span><span class="ident" id="2938322">NewReader</span><span class="op" id="2938331">(</span><span class="ident" id="2938332">data</span><span class="op" id="2938336">.</span><span class="ident" id="2938337">Encode</span><span class="op" id="2938343">(</span><span class="op" id="2938344">)</span><span class="op" id="2938345">)</span><span class="op" id="2938346">)</span><br>
<span class="lineno"></span><span class="op" id="2938348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2938351">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="2938426">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2938499">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2938535">//</span><br>
<span class="lineno"></span><span class="comment" id="2938538">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2938568">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="2938586">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="2938608">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2938639">//</span><br>
<span class="lineno"></span><span class="comment" id="2938642">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="2938689">func</span>&nbsp;<span class="ident" id="2938694">Head</span><span class="op" id="2938698">(</span><span class="ident" id="2938699">url</span>&nbsp;<span class="builtintype" id="2938703">string</span><span class="op" id="2938709">)</span>&nbsp;<span class="op" id="2938711">(</span><span class="ident" id="2938712">resp</span>&nbsp;<span class="op" id="2938717">*</span><span class="ident" id="2938718">Response</span><span class="op" id="2938726">,</span>&nbsp;<span class="ident" id="2938728">err</span>&nbsp;<span class="builtintype" id="2938732">error</span><span class="op" id="2938737">)</span>&nbsp;<span class="op" id="2938739">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938742">return</span>&nbsp;<span class="ident" id="2938749">DefaultClient</span><span class="op" id="2938762">.</span><span class="ident" id="2938763">Head</span><span class="op" id="2938767">(</span><span class="ident" id="2938768">url</span><span class="op" id="2938771">)</span><br>
<span class="lineno"></span><span class="op" id="2938773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2938776">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2938851">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="2938924">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2938960">//</span><br>
<span class="lineno"></span><span class="comment" id="2938963">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2938993">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="2939011">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="2939033">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="2939064">func</span>&nbsp;<span class="op" id="2939069">(</span><span class="ident" id="2939070">c</span>&nbsp;<span class="op" id="2939072">*</span><span class="ident" id="2939073">Client</span><span class="op" id="2939079">)</span>&nbsp;<span class="ident" id="2939081">Head</span><span class="op" id="2939085">(</span><span class="ident" id="2939086">url</span>&nbsp;<span class="builtintype" id="2939090">string</span><span class="op" id="2939096">)</span>&nbsp;<span class="op" id="2939098">(</span><span class="ident" id="2939099">resp</span>&nbsp;<span class="op" id="2939104">*</span><span class="ident" id="2939105">Response</span><span class="op" id="2939113">,</span>&nbsp;<span class="ident" id="2939115">err</span>&nbsp;<span class="builtintype" id="2939119">error</span><span class="op" id="2939124">)</span>&nbsp;<span class="op" id="2939126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939129">req</span><span class="op" id="2939132">,</span>&nbsp;<span class="ident" id="2939134">err</span>&nbsp;<span class="op" id="2939138">:=</span>&nbsp;<span class="ident" id="2939141">NewRequest</span><span class="op" id="2939151">(</span><span class="string" id="2939152">&#34;HEAD&#34;</span><span class="op" id="2939158">,</span>&nbsp;<span class="ident" id="2939160">url</span><span class="op" id="2939163">,</span>&nbsp;<span class="builtintype" id="2939165">nil</span><span class="op" id="2939168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939171">if</span>&nbsp;<span class="ident" id="2939174">err</span>&nbsp;<span class="op" id="2939178">!=</span>&nbsp;<span class="builtintype" id="2939181">nil</span>&nbsp;<span class="op" id="2939185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939189">return</span>&nbsp;<span class="builtintype" id="2939196">nil</span><span class="op" id="2939199">,</span>&nbsp;<span class="ident" id="2939201">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2939206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939209">return</span>&nbsp;<span class="ident" id="2939216">c</span><span class="op" id="2939217">.</span><span class="ident" id="2939218">doFollowingRedirects</span><span class="op" id="2939238">(</span><span class="ident" id="2939239">req</span><span class="op" id="2939242">,</span>&nbsp;<span class="ident" id="2939244">shouldRedirectGet</span><span class="op" id="2939261">)</span><br>
<span class="lineno"></span><span class="op" id="2939263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939266">type</span>&nbsp;<span class="ident" id="2939271">cancelTimerBody</span>&nbsp;<span class="keyword" id="2939287">struct</span>&nbsp;<span class="op" id="2939294">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939297">t</span>&nbsp;&nbsp;<span class="op" id="2939300">*</span><span class="ident" id="2939301">time</span><span class="op" id="2939305">.</span><span class="ident" id="2939306">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939313">rc</span>&nbsp;<span class="ident" id="2939316">io</span><span class="op" id="2939318">.</span><span class="ident" id="2939319">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="2939330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939333">func</span>&nbsp;<span class="op" id="2939338">(</span><span class="ident" id="2939339">b</span>&nbsp;<span class="op" id="2939341">*</span><span class="ident" id="2939342">cancelTimerBody</span><span class="op" id="2939357">)</span>&nbsp;<span class="ident" id="2939359">Read</span><span class="op" id="2939363">(</span><span class="ident" id="2939364">p</span>&nbsp;<span class="op" id="2939366">[</span><span class="op" id="2939367">]</span><span class="builtintype" id="2939368">byte</span><span class="op" id="2939372">)</span>&nbsp;<span class="op" id="2939374">(</span><span class="ident" id="2939375">n</span>&nbsp;<span class="builtintype" id="2939377">int</span><span class="op" id="2939380">,</span>&nbsp;<span class="ident" id="2939382">err</span>&nbsp;<span class="builtintype" id="2939386">error</span><span class="op" id="2939391">)</span>&nbsp;<span class="op" id="2939393">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939396">n</span><span class="op" id="2939397">,</span>&nbsp;<span class="ident" id="2939399">err</span>&nbsp;<span class="op" id="2939403">=</span>&nbsp;<span class="ident" id="2939405">b</span><span class="op" id="2939406">.</span><span class="ident" id="2939407">rc</span><span class="op" id="2939409">.</span><span class="ident" id="2939410">Read</span><span class="op" id="2939414">(</span><span class="ident" id="2939415">p</span><span class="op" id="2939416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939419">if</span>&nbsp;<span class="ident" id="2939422">err</span>&nbsp;<span class="op" id="2939426">==</span>&nbsp;<span class="ident" id="2939429">io</span><span class="op" id="2939431">.</span><span class="ident" id="2939432">EOF</span>&nbsp;<span class="op" id="2939436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939440">b</span><span class="op" id="2939441">.</span><span class="ident" id="2939442">t</span><span class="op" id="2939443">.</span><span class="ident" id="2939444">Stop</span><span class="op" id="2939448">(</span><span class="op" id="2939449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2939452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939455">return</span><br>
<span class="lineno">505</span><span class="op" id="2939462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939465">func</span>&nbsp;<span class="op" id="2939470">(</span><span class="ident" id="2939471">b</span>&nbsp;<span class="op" id="2939473">*</span><span class="ident" id="2939474">cancelTimerBody</span><span class="op" id="2939489">)</span>&nbsp;<span class="ident" id="2939491">Close</span><span class="op" id="2939496">(</span><span class="op" id="2939497">)</span>&nbsp;<span class="builtintype" id="2939499">error</span>&nbsp;<span class="op" id="2939505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939508">err</span>&nbsp;<span class="op" id="2939512">:=</span>&nbsp;<span class="ident" id="2939515">b</span><span class="op" id="2939516">.</span><span class="ident" id="2939517">rc</span><span class="op" id="2939519">.</span><span class="ident" id="2939520">Close</span><span class="op" id="2939525">(</span><span class="op" id="2939526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939529">b</span><span class="op" id="2939530">.</span><span class="ident" id="2939531">t</span><span class="op" id="2939532">.</span><span class="ident" id="2939533">Stop</span><span class="op" id="2939537">(</span><span class="op" id="2939538">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939541">return</span>&nbsp;<span class="ident" id="2939548">err</span><br>
<span class="lineno"></span><span class="op" id="2939552">}</span>
</div>
</body>
</html>
