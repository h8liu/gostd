<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html" class="current">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1561107">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1561162">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1561216">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1561267">//&nbsp;+build&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1561284">package</span>&nbsp;<span class="ident" id="1561292">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1561301">import</span>&nbsp;<span class="string" id="1561308">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1561318">func</span>&nbsp;<span class="ident" id="1561323">epollcreate</span><span class="op" id="1561334">(</span><span class="ident" id="1561335">size</span>&nbsp;<span class="builtintype" id="1561340">int32</span><span class="op" id="1561345">)</span>&nbsp;<span class="builtintype" id="1561347">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1561353">func</span>&nbsp;<span class="ident" id="1561358">epollcreate1</span><span class="op" id="1561370">(</span><span class="ident" id="1561371">flags</span>&nbsp;<span class="builtintype" id="1561377">int32</span><span class="op" id="1561382">)</span>&nbsp;<span class="builtintype" id="1561384">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1561391">//go:noescape</span><br>
<span class="lineno">15</span><span class="keyword" id="1561405">func</span>&nbsp;<span class="ident" id="1561410">epollctl</span><span class="op" id="1561418">(</span><span class="ident" id="1561419">epfd</span><span class="op" id="1561423">,</span>&nbsp;<span class="ident" id="1561425">op</span><span class="op" id="1561427">,</span>&nbsp;<span class="ident" id="1561429">fd</span>&nbsp;<span class="builtintype" id="1561432">int32</span><span class="op" id="1561437">,</span>&nbsp;<span class="ident" id="1561439">ev</span>&nbsp;<span class="op" id="1561442">*</span><span class="ident" id="1561443">epollevent</span><span class="op" id="1561453">)</span>&nbsp;<span class="builtintype" id="1561455">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1561462">//go:noescape</span><br>
<span class="lineno"></span><span class="keyword" id="1561476">func</span>&nbsp;<span class="ident" id="1561481">epollwait</span><span class="op" id="1561490">(</span><span class="ident" id="1561491">epfd</span>&nbsp;<span class="builtintype" id="1561496">int32</span><span class="op" id="1561501">,</span>&nbsp;<span class="ident" id="1561503">ev</span>&nbsp;<span class="op" id="1561506">*</span><span class="ident" id="1561507">epollevent</span><span class="op" id="1561517">,</span>&nbsp;<span class="ident" id="1561519">nev</span><span class="op" id="1561522">,</span>&nbsp;<span class="ident" id="1561524">timeout</span>&nbsp;<span class="builtintype" id="1561532">int32</span><span class="op" id="1561537">)</span>&nbsp;<span class="builtintype" id="1561539">int32</span><br>
<span class="lineno"></span><span class="keyword" id="1561545">func</span>&nbsp;<span class="ident" id="1561550">closeonexec</span><span class="op" id="1561561">(</span><span class="ident" id="1561562">fd</span>&nbsp;<span class="builtintype" id="1561565">int32</span><span class="op" id="1561570">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1561573">var</span>&nbsp;<span class="op" id="1561577">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561580">epfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1561595">int32</span>&nbsp;<span class="op" id="1561601">=</span>&nbsp;<span class="op" id="1561603">-</span><span class="num" id="1561604">1</span>&nbsp;<span class="comment" id="1561606">//&nbsp;epoll&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561627">netpolllasterr</span>&nbsp;<span class="builtintype" id="1561642">int32</span><br>
<span class="lineno"></span><span class="op" id="1561648">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="1561651">func</span>&nbsp;<span class="ident" id="1561656">netpollinit</span><span class="op" id="1561667">(</span><span class="op" id="1561668">)</span>&nbsp;<span class="op" id="1561670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561673">epfd</span>&nbsp;<span class="op" id="1561678">=</span>&nbsp;<span class="ident" id="1561680">epollcreate1</span><span class="op" id="1561692">(</span><span class="ident" id="1561693">_EPOLL_CLOEXEC</span><span class="op" id="1561707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561710">if</span>&nbsp;<span class="ident" id="1561713">epfd</span>&nbsp;<span class="op" id="1561718">&gt;=</span>&nbsp;<span class="num" id="1561721">0</span>&nbsp;<span class="op" id="1561723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561727">return</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1561735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561738">epfd</span>&nbsp;<span class="op" id="1561743">=</span>&nbsp;<span class="ident" id="1561745">epollcreate</span><span class="op" id="1561756">(</span><span class="num" id="1561757">1024</span><span class="op" id="1561761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561764">if</span>&nbsp;<span class="ident" id="1561767">epfd</span>&nbsp;<span class="op" id="1561772">&gt;=</span>&nbsp;<span class="num" id="1561775">0</span>&nbsp;<span class="op" id="1561777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561781">closeonexec</span><span class="op" id="1561792">(</span><span class="ident" id="1561793">epfd</span><span class="op" id="1561797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561801">return</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1561809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1561812">println</span><span class="op" id="1561819">(</span><span class="string" id="1561820">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;epoll&nbsp;descriptor&#34;</span><span class="op" id="1561868">,</span>&nbsp;<span class="op" id="1561870">-</span><span class="ident" id="1561871">epfd</span><span class="op" id="1561875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561878">gothrow</span><span class="op" id="1561885">(</span><span class="string" id="1561886">&#34;netpollinit:&nbsp;failed&nbsp;to&nbsp;create&nbsp;descriptor&#34;</span><span class="op" id="1561928">)</span><br>
<span class="lineno"></span><span class="op" id="1561930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1561933">func</span>&nbsp;<span class="ident" id="1561938">netpollopen</span><span class="op" id="1561949">(</span><span class="ident" id="1561950">fd</span>&nbsp;<span class="builtintype" id="1561953">uintptr</span><span class="op" id="1561960">,</span>&nbsp;<span class="ident" id="1561962">pd</span>&nbsp;<span class="op" id="1561965">*</span><span class="ident" id="1561966">pollDesc</span><span class="op" id="1561974">)</span>&nbsp;<span class="builtintype" id="1561976">int32</span>&nbsp;<span class="op" id="1561982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561985">var</span>&nbsp;<span class="ident" id="1561989">ev</span>&nbsp;<span class="ident" id="1561992">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562004">ev</span><span class="op" id="1562006">.</span><span class="ident" id="1562007">events</span>&nbsp;<span class="op" id="1562014">=</span>&nbsp;<span class="ident" id="1562016">_EPOLLIN</span>&nbsp;<span class="op" id="1562025">|</span>&nbsp;<span class="ident" id="1562027">_EPOLLOUT</span>&nbsp;<span class="op" id="1562037">|</span>&nbsp;<span class="ident" id="1562039">_EPOLLRDHUP</span>&nbsp;<span class="op" id="1562051">|</span>&nbsp;<span class="ident" id="1562053">_EPOLLET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562063">*</span><span class="op" id="1562064">(</span><span class="op" id="1562065">*</span><span class="op" id="1562066">*</span><span class="ident" id="1562067">pollDesc</span><span class="op" id="1562075">)</span><span class="op" id="1562076">(</span><span class="ident" id="1562077">unsafe</span><span class="op" id="1562083">.</span><span class="ident" id="1562084">Pointer</span><span class="op" id="1562091">(</span><span class="op" id="1562092">&amp;</span><span class="ident" id="1562093">ev</span><span class="op" id="1562095">.</span><span class="ident" id="1562096">data</span><span class="op" id="1562100">)</span><span class="op" id="1562101">)</span>&nbsp;<span class="op" id="1562103">=</span>&nbsp;<span class="ident" id="1562105">pd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562109">return</span>&nbsp;<span class="op" id="1562116">-</span><span class="ident" id="1562117">epollctl</span><span class="op" id="1562125">(</span><span class="ident" id="1562126">epfd</span><span class="op" id="1562130">,</span>&nbsp;<span class="ident" id="1562132">_EPOLL_CTL_ADD</span><span class="op" id="1562146">,</span>&nbsp;<span class="builtintype" id="1562148">int32</span><span class="op" id="1562153">(</span><span class="ident" id="1562154">fd</span><span class="op" id="1562156">)</span><span class="op" id="1562157">,</span>&nbsp;<span class="op" id="1562159">&amp;</span><span class="ident" id="1562160">ev</span><span class="op" id="1562162">)</span><br>
<span class="lineno">45</span><span class="op" id="1562164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1562167">func</span>&nbsp;<span class="ident" id="1562172">netpollclose</span><span class="op" id="1562184">(</span><span class="ident" id="1562185">fd</span>&nbsp;<span class="builtintype" id="1562188">uintptr</span><span class="op" id="1562195">)</span>&nbsp;<span class="builtintype" id="1562197">int32</span>&nbsp;<span class="op" id="1562203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562206">var</span>&nbsp;<span class="ident" id="1562210">ev</span>&nbsp;<span class="ident" id="1562213">epollevent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562225">return</span>&nbsp;<span class="op" id="1562232">-</span><span class="ident" id="1562233">epollctl</span><span class="op" id="1562241">(</span><span class="ident" id="1562242">epfd</span><span class="op" id="1562246">,</span>&nbsp;<span class="ident" id="1562248">_EPOLL_CTL_DEL</span><span class="op" id="1562262">,</span>&nbsp;<span class="builtintype" id="1562264">int32</span><span class="op" id="1562269">(</span><span class="ident" id="1562270">fd</span><span class="op" id="1562272">)</span><span class="op" id="1562273">,</span>&nbsp;<span class="op" id="1562275">&amp;</span><span class="ident" id="1562276">ev</span><span class="op" id="1562278">)</span><br>
<span class="lineno">50</span><span class="op" id="1562280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1562283">func</span>&nbsp;<span class="ident" id="1562288">netpollarm</span><span class="op" id="1562298">(</span><span class="ident" id="1562299">pd</span>&nbsp;<span class="op" id="1562302">*</span><span class="ident" id="1562303">pollDesc</span><span class="op" id="1562311">,</span>&nbsp;<span class="ident" id="1562313">mode</span>&nbsp;<span class="builtintype" id="1562318">int</span><span class="op" id="1562321">)</span>&nbsp;<span class="op" id="1562323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562326">gothrow</span><span class="op" id="1562333">(</span><span class="string" id="1562334">&#34;unused&#34;</span><span class="op" id="1562342">)</span><br>
<span class="lineno"></span><span class="op" id="1562344">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1562347">//&nbsp;polls&nbsp;for&nbsp;ready&nbsp;network&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="1562386">//&nbsp;returns&nbsp;list&nbsp;of&nbsp;goroutines&nbsp;that&nbsp;become&nbsp;runnable</span><br>
<span class="lineno"></span><span class="keyword" id="1562437">func</span>&nbsp;<span class="ident" id="1562442">netpoll</span><span class="op" id="1562449">(</span><span class="ident" id="1562450">block</span>&nbsp;<span class="builtintype" id="1562456">bool</span><span class="op" id="1562460">)</span>&nbsp;<span class="op" id="1562462">(</span><span class="ident" id="1562463">gp</span>&nbsp;<span class="op" id="1562466">*</span><span class="ident" id="1562467">g</span><span class="op" id="1562468">)</span>&nbsp;<span class="op" id="1562470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562473">if</span>&nbsp;<span class="ident" id="1562476">epfd</span>&nbsp;<span class="op" id="1562481">==</span>&nbsp;<span class="op" id="1562484">-</span><span class="num" id="1562485">1</span>&nbsp;<span class="op" id="1562487">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562502">waitms</span>&nbsp;<span class="op" id="1562509">:=</span>&nbsp;<span class="builtintype" id="1562512">int32</span><span class="op" id="1562517">(</span><span class="op" id="1562518">-</span><span class="num" id="1562519">1</span><span class="op" id="1562520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562523">if</span>&nbsp;<span class="op" id="1562526">!</span><span class="ident" id="1562527">block</span>&nbsp;<span class="op" id="1562533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562537">waitms</span>&nbsp;<span class="op" id="1562544">=</span>&nbsp;<span class="num" id="1562546">0</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562552">var</span>&nbsp;<span class="ident" id="1562556">events</span>&nbsp;<span class="op" id="1562563">[</span><span class="num" id="1562564">128</span><span class="op" id="1562567">]</span><span class="ident" id="1562568">epollevent</span><br>
<span class="lineno"></span><span class="ident" id="1562579">retry</span><span class="op" id="1562584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562587">n</span>&nbsp;<span class="op" id="1562589">:=</span>&nbsp;<span class="ident" id="1562592">epollwait</span><span class="op" id="1562601">(</span><span class="ident" id="1562602">epfd</span><span class="op" id="1562606">,</span>&nbsp;<span class="op" id="1562608">&amp;</span><span class="ident" id="1562609">events</span><span class="op" id="1562615">[</span><span class="num" id="1562616">0</span><span class="op" id="1562617">]</span><span class="op" id="1562618">,</span>&nbsp;<span class="builtintype" id="1562620">int32</span><span class="op" id="1562625">(</span><span class="builtinfunc" id="1562626">len</span><span class="op" id="1562629">(</span><span class="ident" id="1562630">events</span><span class="op" id="1562636">)</span><span class="op" id="1562637">)</span><span class="op" id="1562638">,</span>&nbsp;<span class="ident" id="1562640">waitms</span><span class="op" id="1562646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562649">if</span>&nbsp;<span class="ident" id="1562652">n</span>&nbsp;<span class="op" id="1562654">&lt;</span>&nbsp;<span class="num" id="1562656">0</span>&nbsp;<span class="op" id="1562658">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562662">if</span>&nbsp;<span class="ident" id="1562665">n</span>&nbsp;<span class="op" id="1562667">!=</span>&nbsp;<span class="op" id="1562670">-</span><span class="ident" id="1562671">_EINTR</span>&nbsp;<span class="op" id="1562678">&amp;&amp;</span>&nbsp;<span class="ident" id="1562681">n</span>&nbsp;<span class="op" id="1562683">!=</span>&nbsp;<span class="ident" id="1562686">netpolllasterr</span>&nbsp;<span class="op" id="1562701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562706">netpolllasterr</span>&nbsp;<span class="op" id="1562721">=</span>&nbsp;<span class="ident" id="1562723">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1562728">println</span><span class="op" id="1562735">(</span><span class="string" id="1562736">&#34;runtime:&nbsp;epollwait&nbsp;on&nbsp;fd&#34;</span><span class="op" id="1562762">,</span>&nbsp;<span class="ident" id="1562764">epfd</span><span class="op" id="1562768">,</span>&nbsp;<span class="string" id="1562770">&#34;failed&nbsp;with&#34;</span><span class="op" id="1562783">,</span>&nbsp;<span class="op" id="1562785">-</span><span class="ident" id="1562786">n</span><span class="op" id="1562787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562795">goto</span>&nbsp;<span class="ident" id="1562800">retry</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562810">for</span>&nbsp;<span class="ident" id="1562814">i</span>&nbsp;<span class="op" id="1562816">:=</span>&nbsp;<span class="builtintype" id="1562819">int32</span><span class="op" id="1562824">(</span><span class="num" id="1562825">0</span><span class="op" id="1562826">)</span><span class="op" id="1562827">;</span>&nbsp;<span class="ident" id="1562829">i</span>&nbsp;<span class="op" id="1562831">&lt;</span>&nbsp;<span class="ident" id="1562833">n</span><span class="op" id="1562834">;</span>&nbsp;<span class="ident" id="1562836">i</span><span class="op" id="1562837">++</span>&nbsp;<span class="op" id="1562840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562844">ev</span>&nbsp;<span class="op" id="1562847">:=</span>&nbsp;<span class="op" id="1562850">&amp;</span><span class="ident" id="1562851">events</span><span class="op" id="1562857">[</span><span class="ident" id="1562858">i</span><span class="op" id="1562859">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562863">if</span>&nbsp;<span class="ident" id="1562866">ev</span><span class="op" id="1562868">.</span><span class="ident" id="1562869">events</span>&nbsp;<span class="op" id="1562876">==</span>&nbsp;<span class="num" id="1562879">0</span>&nbsp;<span class="op" id="1562881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562886">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562901">var</span>&nbsp;<span class="ident" id="1562905">mode</span>&nbsp;<span class="builtintype" id="1562910">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1562918">if</span>&nbsp;<span class="ident" id="1562921">ev</span><span class="op" id="1562923">.</span><span class="ident" id="1562924">events</span><span class="op" id="1562930">&amp;</span><span class="op" id="1562931">(</span><span class="ident" id="1562932">_EPOLLIN</span><span class="op" id="1562940">|</span><span class="ident" id="1562941">_EPOLLRDHUP</span><span class="op" id="1562952">|</span><span class="ident" id="1562953">_EPOLLHUP</span><span class="op" id="1562962">|</span><span class="ident" id="1562963">_EPOLLERR</span><span class="op" id="1562972">)</span>&nbsp;<span class="op" id="1562974">!=</span>&nbsp;<span class="num" id="1562977">0</span>&nbsp;<span class="op" id="1562979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562984">mode</span>&nbsp;<span class="op" id="1562989">+=</span>&nbsp;<span class="string" id="1562992">&#39;r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562998">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1563002">if</span>&nbsp;<span class="ident" id="1563005">ev</span><span class="op" id="1563007">.</span><span class="ident" id="1563008">events</span><span class="op" id="1563014">&amp;</span><span class="op" id="1563015">(</span><span class="ident" id="1563016">_EPOLLOUT</span><span class="op" id="1563025">|</span><span class="ident" id="1563026">_EPOLLHUP</span><span class="op" id="1563035">|</span><span class="ident" id="1563036">_EPOLLERR</span><span class="op" id="1563045">)</span>&nbsp;<span class="op" id="1563047">!=</span>&nbsp;<span class="num" id="1563050">0</span>&nbsp;<span class="op" id="1563052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1563057">mode</span>&nbsp;<span class="op" id="1563062">+=</span>&nbsp;<span class="string" id="1563065">&#39;w&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1563071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1563075">if</span>&nbsp;<span class="ident" id="1563078">mode</span>&nbsp;<span class="op" id="1563083">!=</span>&nbsp;<span class="num" id="1563086">0</span>&nbsp;<span class="op" id="1563088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1563093">pd</span>&nbsp;<span class="op" id="1563096">:=</span>&nbsp;<span class="op" id="1563099">*</span><span class="op" id="1563100">(</span><span class="op" id="1563101">*</span><span class="op" id="1563102">*</span><span class="ident" id="1563103">pollDesc</span><span class="op" id="1563111">)</span><span class="op" id="1563112">(</span><span class="ident" id="1563113">unsafe</span><span class="op" id="1563119">.</span><span class="ident" id="1563120">Pointer</span><span class="op" id="1563127">(</span><span class="op" id="1563128">&amp;</span><span class="ident" id="1563129">ev</span><span class="op" id="1563131">.</span><span class="ident" id="1563132">data</span><span class="op" id="1563136">)</span><span class="op" id="1563137">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1563142">netpollready</span><span class="op" id="1563154">(</span><span class="op" id="1563155">(</span><span class="op" id="1563156">*</span><span class="op" id="1563157">*</span><span class="ident" id="1563158">g</span><span class="op" id="1563159">)</span><span class="op" id="1563160">(</span><span class="ident" id="1563161">noescape</span><span class="op" id="1563169">(</span><span class="ident" id="1563170">unsafe</span><span class="op" id="1563176">.</span><span class="ident" id="1563177">Pointer</span><span class="op" id="1563184">(</span><span class="op" id="1563185">&amp;</span><span class="ident" id="1563186">gp</span><span class="op" id="1563188">)</span><span class="op" id="1563189">)</span><span class="op" id="1563190">)</span><span class="op" id="1563191">,</span>&nbsp;<span class="ident" id="1563193">pd</span><span class="op" id="1563195">,</span>&nbsp;<span class="ident" id="1563197">mode</span><span class="op" id="1563201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1563205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1563208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1563211">if</span>&nbsp;<span class="ident" id="1563214">block</span>&nbsp;<span class="op" id="1563220">&amp;&amp;</span>&nbsp;<span class="ident" id="1563223">gp</span>&nbsp;<span class="op" id="1563226">==</span>&nbsp;<span class="builtintype" id="1563229">nil</span>&nbsp;<span class="op" id="1563233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1563237">goto</span>&nbsp;<span class="ident" id="1563242">retry</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1563249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1563252">return</span>&nbsp;<span class="ident" id="1563259">gp</span><br>
<span class="lineno"></span><span class="op" id="1563262">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
