<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6066809">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6066864">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6066918">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6066969">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="6067478">package</span>&nbsp;<span class="ident" id="6067486">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067491">import</span>&nbsp;<span class="op" id="6067498">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067501">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067507">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6067515">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6067522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6067525">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6067549">const</span>&nbsp;<span class="op" id="6067555">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067558">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6067566">uint16</span>&nbsp;<span class="op" id="6067573">=</span>&nbsp;<span class="num" id="6067575">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067578">Deflate</span>&nbsp;<span class="builtintype" id="6067586">uint16</span>&nbsp;<span class="op" id="6067593">=</span>&nbsp;<span class="num" id="6067595">8</span><br>
<span class="lineno"></span><span class="op" id="6067597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6067600">const</span>&nbsp;<span class="op" id="6067606">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067609">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067634">=</span>&nbsp;<span class="num" id="6067636">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067648">directoryHeaderSignature</span>&nbsp;<span class="op" id="6067673">=</span>&nbsp;<span class="num" id="6067675">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067687">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067712">=</span>&nbsp;<span class="num" id="6067714">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067726">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="6067751">=</span>&nbsp;<span class="num" id="6067753">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067765">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="6067790">=</span>&nbsp;<span class="num" id="6067792">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067804">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="6067829">=</span>&nbsp;<span class="num" id="6067831">0x08074b50</span>&nbsp;<span class="comment" id="6067842">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067889">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067914">=</span>&nbsp;<span class="num" id="6067916">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6067927">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067950">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6067975">=</span>&nbsp;<span class="num" id="6067977">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6067988">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068021">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068046">=</span>&nbsp;<span class="num" id="6068048">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068059">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068073">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068098">=</span>&nbsp;<span class="num" id="6068100">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068111">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068179">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068204">=</span>&nbsp;<span class="num" id="6068206">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068217">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068250">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068275">=</span>&nbsp;<span class="num" id="6068277">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068288">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068292">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068317">=</span>&nbsp;<span class="num" id="6068319">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6068330">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068343">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068394">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6068408">=</span>&nbsp;<span class="num" id="6068410">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068413">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6068427">=</span>&nbsp;<span class="num" id="6068429">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068432">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6068446">=</span>&nbsp;<span class="num" id="6068448">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068452">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6068466">=</span>&nbsp;<span class="num" id="6068468">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068472">creatorMacOSX</span>&nbsp;<span class="op" id="6068486">=</span>&nbsp;<span class="num" id="6068488">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068493">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068513">zipVersion20</span>&nbsp;<span class="op" id="6068526">=</span>&nbsp;<span class="num" id="6068528">20</span>&nbsp;<span class="comment" id="6068531">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068539">zipVersion45</span>&nbsp;<span class="op" id="6068552">=</span>&nbsp;<span class="num" id="6068554">45</span>&nbsp;<span class="comment" id="6068557">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068600">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068631">uint16max</span>&nbsp;<span class="op" id="6068641">=</span>&nbsp;<span class="op" id="6068643">(</span><span class="num" id="6068644">1</span>&nbsp;<span class="op" id="6068646">&lt;&lt;</span>&nbsp;<span class="num" id="6068649">16</span><span class="op" id="6068651">)</span>&nbsp;<span class="op" id="6068653">-</span>&nbsp;<span class="num" id="6068655">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068658">uint32max</span>&nbsp;<span class="op" id="6068668">=</span>&nbsp;<span class="op" id="6068670">(</span><span class="num" id="6068671">1</span>&nbsp;<span class="op" id="6068673">&lt;&lt;</span>&nbsp;<span class="num" id="6068676">32</span><span class="op" id="6068678">)</span>&nbsp;<span class="op" id="6068680">-</span>&nbsp;<span class="num" id="6068682">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068686">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068708">zip64ExtraId</span>&nbsp;<span class="op" id="6068721">=</span>&nbsp;<span class="num" id="6068723">0x0001</span>&nbsp;<span class="comment" id="6068730">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="6068772">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6068775">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6068825">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="6068858">type</span>&nbsp;<span class="ident" id="6068863">FileHeader</span>&nbsp;<span class="keyword" id="6068874">struct</span>&nbsp;<span class="op" id="6068881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068884">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068918">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068981">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069045">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069062">Name</span>&nbsp;<span class="builtintype" id="6069067">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069076">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069095">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069103">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069122">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069130">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069149">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069157">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069176">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069184">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069203">uint16</span>&nbsp;<span class="comment" id="6069210">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069226">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069245">uint16</span>&nbsp;<span class="comment" id="6069252">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069268">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069287">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069295">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069314">uint32</span>&nbsp;<span class="comment" id="6069321">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069358">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069377">uint32</span>&nbsp;<span class="comment" id="6069384">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069423">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6069442">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069450">UncompressedSize64</span>&nbsp;<span class="ident" id="6069469">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069477">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6069496">[</span><span class="op" id="6069497">]</span><span class="builtintype" id="6069498">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069504">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069523">uint32</span>&nbsp;<span class="comment" id="6069530">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069568">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6069587">string</span><br>
<span class="lineno"></span><span class="op" id="6069594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069597">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6069652">func</span>&nbsp;<span class="op" id="6069657">(</span><span class="ident" id="6069658">h</span>&nbsp;<span class="op" id="6069660">*</span><span class="ident" id="6069661">FileHeader</span><span class="op" id="6069671">)</span>&nbsp;<span class="ident" id="6069673">FileInfo</span><span class="op" id="6069681">(</span><span class="op" id="6069682">)</span>&nbsp;<span class="ident" id="6069684">os</span><span class="op" id="6069686">.</span><span class="ident" id="6069687">FileInfo</span>&nbsp;<span class="op" id="6069696">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069699">return</span>&nbsp;<span class="ident" id="6069706">headerFileInfo</span><span class="op" id="6069720">{</span><span class="ident" id="6069721">h</span><span class="op" id="6069722">}</span><br>
<span class="lineno"></span><span class="op" id="6069724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6069727">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6069769">type</span>&nbsp;<span class="ident" id="6069774">headerFileInfo</span>&nbsp;<span class="keyword" id="6069789">struct</span>&nbsp;<span class="op" id="6069796">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069799">fh</span>&nbsp;<span class="op" id="6069802">*</span><span class="ident" id="6069803">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="6069814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6069817">func</span>&nbsp;<span class="op" id="6069822">(</span><span class="ident" id="6069823">fi</span>&nbsp;<span class="ident" id="6069826">headerFileInfo</span><span class="op" id="6069840">)</span>&nbsp;<span class="ident" id="6069842">Name</span><span class="op" id="6069846">(</span><span class="op" id="6069847">)</span>&nbsp;<span class="builtintype" id="6069849">string</span>&nbsp;<span class="op" id="6069856">{</span>&nbsp;<span class="keyword" id="6069858">return</span>&nbsp;<span class="ident" id="6069865">path</span><span class="op" id="6069869">.</span><span class="ident" id="6069870">Base</span><span class="op" id="6069874">(</span><span class="ident" id="6069875">fi</span><span class="op" id="6069877">.</span><span class="ident" id="6069878">fh</span><span class="op" id="6069880">.</span><span class="ident" id="6069881">Name</span><span class="op" id="6069885">)</span>&nbsp;<span class="op" id="6069887">}</span><br>
<span class="lineno"></span><span class="keyword" id="6069889">func</span>&nbsp;<span class="op" id="6069894">(</span><span class="ident" id="6069895">fi</span>&nbsp;<span class="ident" id="6069898">headerFileInfo</span><span class="op" id="6069912">)</span>&nbsp;<span class="ident" id="6069914">Size</span><span class="op" id="6069918">(</span><span class="op" id="6069919">)</span>&nbsp;<span class="ident" id="6069921">int64</span>&nbsp;<span class="op" id="6069927">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069930">if</span>&nbsp;<span class="ident" id="6069933">fi</span><span class="op" id="6069935">.</span><span class="ident" id="6069936">fh</span><span class="op" id="6069938">.</span><span class="ident" id="6069939">UncompressedSize64</span>&nbsp;<span class="op" id="6069958">&gt;</span>&nbsp;<span class="num" id="6069960">0</span>&nbsp;<span class="op" id="6069962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069966">return</span>&nbsp;<span class="ident" id="6069973">int64</span><span class="op" id="6069978">(</span><span class="ident" id="6069979">fi</span><span class="op" id="6069981">.</span><span class="ident" id="6069982">fh</span><span class="op" id="6069984">.</span><span class="ident" id="6069985">UncompressedSize64</span><span class="op" id="6070003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070009">return</span>&nbsp;<span class="ident" id="6070016">int64</span><span class="op" id="6070021">(</span><span class="ident" id="6070022">fi</span><span class="op" id="6070024">.</span><span class="ident" id="6070025">fh</span><span class="op" id="6070027">.</span><span class="ident" id="6070028">UncompressedSize</span><span class="op" id="6070044">)</span><br>
<span class="lineno"></span><span class="op" id="6070046">}</span><br>
<span class="lineno">110</span><span class="keyword" id="6070048">func</span>&nbsp;<span class="op" id="6070053">(</span><span class="ident" id="6070054">fi</span>&nbsp;<span class="ident" id="6070057">headerFileInfo</span><span class="op" id="6070071">)</span>&nbsp;<span class="ident" id="6070073">IsDir</span><span class="op" id="6070078">(</span><span class="op" id="6070079">)</span>&nbsp;<span class="builtintype" id="6070081">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6070093">{</span>&nbsp;<span class="keyword" id="6070095">return</span>&nbsp;<span class="ident" id="6070102">fi</span><span class="op" id="6070104">.</span><span class="ident" id="6070105">Mode</span><span class="op" id="6070109">(</span><span class="op" id="6070110">)</span><span class="op" id="6070111">.</span><span class="ident" id="6070112">IsDir</span><span class="op" id="6070117">(</span><span class="op" id="6070118">)</span>&nbsp;<span class="op" id="6070120">}</span><br>
<span class="lineno"></span><span class="keyword" id="6070122">func</span>&nbsp;<span class="op" id="6070127">(</span><span class="ident" id="6070128">fi</span>&nbsp;<span class="ident" id="6070131">headerFileInfo</span><span class="op" id="6070145">)</span>&nbsp;<span class="ident" id="6070147">ModTime</span><span class="op" id="6070154">(</span><span class="op" id="6070155">)</span>&nbsp;<span class="ident" id="6070157">time</span><span class="op" id="6070161">.</span><span class="ident" id="6070162">Time</span>&nbsp;<span class="op" id="6070167">{</span>&nbsp;<span class="keyword" id="6070169">return</span>&nbsp;<span class="ident" id="6070176">fi</span><span class="op" id="6070178">.</span><span class="ident" id="6070179">fh</span><span class="op" id="6070181">.</span><span class="ident" id="6070182">ModTime</span><span class="op" id="6070189">(</span><span class="op" id="6070190">)</span>&nbsp;<span class="op" id="6070192">}</span><br>
<span class="lineno"></span><span class="keyword" id="6070194">func</span>&nbsp;<span class="op" id="6070199">(</span><span class="ident" id="6070200">fi</span>&nbsp;<span class="ident" id="6070203">headerFileInfo</span><span class="op" id="6070217">)</span>&nbsp;<span class="ident" id="6070219">Mode</span><span class="op" id="6070223">(</span><span class="op" id="6070224">)</span>&nbsp;<span class="ident" id="6070226">os</span><span class="op" id="6070228">.</span><span class="ident" id="6070229">FileMode</span>&nbsp;&nbsp;<span class="op" id="6070239">{</span>&nbsp;<span class="keyword" id="6070241">return</span>&nbsp;<span class="ident" id="6070248">fi</span><span class="op" id="6070250">.</span><span class="ident" id="6070251">fh</span><span class="op" id="6070253">.</span><span class="ident" id="6070254">Mode</span><span class="op" id="6070258">(</span><span class="op" id="6070259">)</span>&nbsp;<span class="op" id="6070261">}</span><br>
<span class="lineno"></span><span class="keyword" id="6070263">func</span>&nbsp;<span class="op" id="6070268">(</span><span class="ident" id="6070269">fi</span>&nbsp;<span class="ident" id="6070272">headerFileInfo</span><span class="op" id="6070286">)</span>&nbsp;<span class="ident" id="6070288">Sys</span><span class="op" id="6070291">(</span><span class="op" id="6070292">)</span>&nbsp;<span class="keyword" id="6070294">interface</span><span class="op" id="6070303">{</span><span class="op" id="6070304">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6070308">{</span>&nbsp;<span class="keyword" id="6070310">return</span>&nbsp;<span class="ident" id="6070317">fi</span><span class="op" id="6070319">.</span><span class="ident" id="6070320">fh</span>&nbsp;<span class="op" id="6070323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6070326">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6070393">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="6070409">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6070476">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6070547">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="6070616">func</span>&nbsp;<span class="ident" id="6070621">FileInfoHeader</span><span class="op" id="6070635">(</span><span class="ident" id="6070636">fi</span>&nbsp;<span class="ident" id="6070639">os</span><span class="op" id="6070641">.</span><span class="ident" id="6070642">FileInfo</span><span class="op" id="6070650">)</span>&nbsp;<span class="op" id="6070652">(</span><span class="op" id="6070653">*</span><span class="ident" id="6070654">FileHeader</span><span class="op" id="6070664">,</span>&nbsp;<span class="builtintype" id="6070666">error</span><span class="op" id="6070671">)</span>&nbsp;<span class="op" id="6070673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070676">size</span>&nbsp;<span class="op" id="6070681">:=</span>&nbsp;<span class="ident" id="6070684">fi</span><span class="op" id="6070686">.</span><span class="ident" id="6070687">Size</span><span class="op" id="6070691">(</span><span class="op" id="6070692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070695">fh</span>&nbsp;<span class="op" id="6070698">:=</span>&nbsp;<span class="op" id="6070701">&amp;</span><span class="ident" id="6070702">FileHeader</span><span class="op" id="6070712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070716">Name</span><span class="op" id="6070720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6070736">fi</span><span class="op" id="6070738">.</span><span class="ident" id="6070739">Name</span><span class="op" id="6070743">(</span><span class="op" id="6070744">)</span><span class="op" id="6070745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070749">UncompressedSize64</span><span class="op" id="6070767">:</span>&nbsp;<span class="ident" id="6070769">uint64</span><span class="op" id="6070775">(</span><span class="ident" id="6070776">size</span><span class="op" id="6070780">)</span><span class="op" id="6070781">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070787">fh</span><span class="op" id="6070789">.</span><span class="ident" id="6070790">SetModTime</span><span class="op" id="6070800">(</span><span class="ident" id="6070801">fi</span><span class="op" id="6070803">.</span><span class="ident" id="6070804">ModTime</span><span class="op" id="6070811">(</span><span class="op" id="6070812">)</span><span class="op" id="6070813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070816">fh</span><span class="op" id="6070818">.</span><span class="ident" id="6070819">SetMode</span><span class="op" id="6070826">(</span><span class="ident" id="6070827">fi</span><span class="op" id="6070829">.</span><span class="ident" id="6070830">Mode</span><span class="op" id="6070834">(</span><span class="op" id="6070835">)</span><span class="op" id="6070836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070839">if</span>&nbsp;<span class="ident" id="6070842">fh</span><span class="op" id="6070844">.</span><span class="ident" id="6070845">UncompressedSize64</span>&nbsp;<span class="op" id="6070864">&gt;</span>&nbsp;<span class="ident" id="6070866">uint32max</span>&nbsp;<span class="op" id="6070876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070880">fh</span><span class="op" id="6070882">.</span><span class="ident" id="6070883">UncompressedSize</span>&nbsp;<span class="op" id="6070900">=</span>&nbsp;<span class="ident" id="6070902">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070913">}</span>&nbsp;<span class="keyword" id="6070915">else</span>&nbsp;<span class="op" id="6070920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070924">fh</span><span class="op" id="6070926">.</span><span class="ident" id="6070927">UncompressedSize</span>&nbsp;<span class="op" id="6070944">=</span>&nbsp;<span class="builtintype" id="6070946">uint32</span><span class="op" id="6070952">(</span><span class="ident" id="6070953">fh</span><span class="op" id="6070955">.</span><span class="ident" id="6070956">UncompressedSize64</span><span class="op" id="6070974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070980">return</span>&nbsp;<span class="ident" id="6070987">fh</span><span class="op" id="6070989">,</span>&nbsp;<span class="ident" id="6070991">nil</span><br>
<span class="lineno"></span><span class="op" id="6070995">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6070998">type</span>&nbsp;<span class="ident" id="6071003">directoryEnd</span>&nbsp;<span class="keyword" id="6071016">struct</span>&nbsp;<span class="op" id="6071023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071026">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6071045">uint32</span>&nbsp;<span class="comment" id="6071052">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071063">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6071082">uint32</span>&nbsp;<span class="comment" id="6071089">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071100">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="6071119">uint64</span>&nbsp;<span class="comment" id="6071126">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071137">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6071156">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071164">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071183">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071191">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6071210">uint64</span>&nbsp;<span class="comment" id="6071217">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071238">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6071257">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071265">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6071284">string</span><br>
<span class="lineno">145</span><span class="op" id="6071291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071294">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="6071364">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6071389">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="6071460">func</span>&nbsp;<span class="ident" id="6071465">msDosTimeToTime</span><span class="op" id="6071480">(</span><span class="ident" id="6071481">dosDate</span><span class="op" id="6071488">,</span>&nbsp;<span class="ident" id="6071490">dosTime</span>&nbsp;<span class="builtintype" id="6071498">uint16</span><span class="op" id="6071504">)</span>&nbsp;<span class="ident" id="6071506">time</span><span class="op" id="6071510">.</span><span class="ident" id="6071511">Time</span>&nbsp;<span class="op" id="6071516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071519">return</span>&nbsp;<span class="ident" id="6071526">time</span><span class="op" id="6071530">.</span><span class="ident" id="6071531">Date</span><span class="op" id="6071535">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071539">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6071608">int</span><span class="op" id="6071611">(</span><span class="ident" id="6071612">dosDate</span><span class="op" id="6071619">&gt;&gt;</span><span class="num" id="6071621">9</span><span class="op" id="6071622">+</span><span class="num" id="6071623">1980</span><span class="op" id="6071627">)</span><span class="op" id="6071628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071632">time</span><span class="op" id="6071636">.</span><span class="ident" id="6071637">Month</span><span class="op" id="6071642">(</span><span class="ident" id="6071643">dosDate</span><span class="op" id="6071650">&gt;&gt;</span><span class="num" id="6071652">5</span><span class="op" id="6071653">&amp;</span><span class="num" id="6071654">0xf</span><span class="op" id="6071657">)</span><span class="op" id="6071658">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6071662">int</span><span class="op" id="6071665">(</span><span class="ident" id="6071666">dosDate</span><span class="op" id="6071673">&amp;</span><span class="num" id="6071674">0x1f</span><span class="op" id="6071678">)</span><span class="op" id="6071679">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071684">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6071740">int</span><span class="op" id="6071743">(</span><span class="ident" id="6071744">dosTime</span><span class="op" id="6071751">&gt;&gt;</span><span class="num" id="6071753">11</span><span class="op" id="6071755">)</span><span class="op" id="6071756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6071760">int</span><span class="op" id="6071763">(</span><span class="ident" id="6071764">dosTime</span><span class="op" id="6071771">&gt;&gt;</span><span class="num" id="6071773">5</span><span class="op" id="6071774">&amp;</span><span class="num" id="6071775">0x3f</span><span class="op" id="6071779">)</span><span class="op" id="6071780">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6071784">int</span><span class="op" id="6071787">(</span><span class="ident" id="6071788">dosTime</span><span class="op" id="6071795">&amp;</span><span class="num" id="6071796">0x1f</span><span class="op" id="6071800">*</span><span class="num" id="6071801">2</span><span class="op" id="6071802">)</span><span class="op" id="6071803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6071807">0</span><span class="op" id="6071808">,</span>&nbsp;<span class="comment" id="6071810">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071828">time</span><span class="op" id="6071832">.</span><span class="ident" id="6071833">UTC</span><span class="op" id="6071836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071839">)</span><br>
<span class="lineno">165</span><span class="op" id="6071841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6071844">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6071912">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6071937">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="6072008">func</span>&nbsp;<span class="ident" id="6072013">timeToMsDosTime</span><span class="op" id="6072028">(</span><span class="ident" id="6072029">t</span>&nbsp;<span class="ident" id="6072031">time</span><span class="op" id="6072035">.</span><span class="ident" id="6072036">Time</span><span class="op" id="6072040">)</span>&nbsp;<span class="op" id="6072042">(</span><span class="ident" id="6072043">fDate</span>&nbsp;<span class="builtintype" id="6072049">uint16</span><span class="op" id="6072055">,</span>&nbsp;<span class="ident" id="6072057">fTime</span>&nbsp;<span class="builtintype" id="6072063">uint16</span><span class="op" id="6072069">)</span>&nbsp;<span class="op" id="6072071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072074">t</span>&nbsp;<span class="op" id="6072076">=</span>&nbsp;<span class="ident" id="6072078">t</span><span class="op" id="6072079">.</span><span class="ident" id="6072080">In</span><span class="op" id="6072082">(</span><span class="ident" id="6072083">time</span><span class="op" id="6072087">.</span><span class="ident" id="6072088">UTC</span><span class="op" id="6072091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072094">fDate</span>&nbsp;<span class="op" id="6072100">=</span>&nbsp;<span class="builtintype" id="6072102">uint16</span><span class="op" id="6072108">(</span><span class="ident" id="6072109">t</span><span class="op" id="6072110">.</span><span class="ident" id="6072111">Day</span><span class="op" id="6072114">(</span><span class="op" id="6072115">)</span>&nbsp;<span class="op" id="6072117">+</span>&nbsp;<span class="builtintype" id="6072119">int</span><span class="op" id="6072122">(</span><span class="ident" id="6072123">t</span><span class="op" id="6072124">.</span><span class="ident" id="6072125">Month</span><span class="op" id="6072130">(</span><span class="op" id="6072131">)</span><span class="op" id="6072132">)</span><span class="op" id="6072133">&lt;&lt;</span><span class="num" id="6072135">5</span>&nbsp;<span class="op" id="6072137">+</span>&nbsp;<span class="op" id="6072139">(</span><span class="ident" id="6072140">t</span><span class="op" id="6072141">.</span><span class="ident" id="6072142">Year</span><span class="op" id="6072146">(</span><span class="op" id="6072147">)</span><span class="op" id="6072148">-</span><span class="num" id="6072149">1980</span><span class="op" id="6072153">)</span><span class="op" id="6072154">&lt;&lt;</span><span class="num" id="6072156">9</span><span class="op" id="6072157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072160">fTime</span>&nbsp;<span class="op" id="6072166">=</span>&nbsp;<span class="builtintype" id="6072168">uint16</span><span class="op" id="6072174">(</span><span class="ident" id="6072175">t</span><span class="op" id="6072176">.</span><span class="ident" id="6072177">Second</span><span class="op" id="6072183">(</span><span class="op" id="6072184">)</span><span class="op" id="6072185">/</span><span class="num" id="6072186">2</span>&nbsp;<span class="op" id="6072188">+</span>&nbsp;<span class="ident" id="6072190">t</span><span class="op" id="6072191">.</span><span class="ident" id="6072192">Minute</span><span class="op" id="6072198">(</span><span class="op" id="6072199">)</span><span class="op" id="6072200">&lt;&lt;</span><span class="num" id="6072202">5</span>&nbsp;<span class="op" id="6072204">+</span>&nbsp;<span class="ident" id="6072206">t</span><span class="op" id="6072207">.</span><span class="ident" id="6072208">Hour</span><span class="op" id="6072212">(</span><span class="op" id="6072213">)</span><span class="op" id="6072214">&lt;&lt;</span><span class="num" id="6072216">11</span><span class="op" id="6072218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072221">return</span><br>
<span class="lineno">175</span><span class="op" id="6072228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072231">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6072280">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="6072305">func</span>&nbsp;<span class="op" id="6072310">(</span><span class="ident" id="6072311">h</span>&nbsp;<span class="op" id="6072313">*</span><span class="ident" id="6072314">FileHeader</span><span class="op" id="6072324">)</span>&nbsp;<span class="ident" id="6072326">ModTime</span><span class="op" id="6072333">(</span><span class="op" id="6072334">)</span>&nbsp;<span class="ident" id="6072336">time</span><span class="op" id="6072340">.</span><span class="ident" id="6072341">Time</span>&nbsp;<span class="op" id="6072346">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072349">return</span>&nbsp;<span class="ident" id="6072356">msDosTimeToTime</span><span class="op" id="6072371">(</span><span class="ident" id="6072372">h</span><span class="op" id="6072373">.</span><span class="ident" id="6072374">ModifiedDate</span><span class="op" id="6072386">,</span>&nbsp;<span class="ident" id="6072388">h</span><span class="op" id="6072389">.</span><span class="ident" id="6072390">ModifiedTime</span><span class="op" id="6072402">)</span><br>
<span class="lineno"></span><span class="op" id="6072404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072407">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6072493">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="6072518">func</span>&nbsp;<span class="op" id="6072523">(</span><span class="ident" id="6072524">h</span>&nbsp;<span class="op" id="6072526">*</span><span class="ident" id="6072527">FileHeader</span><span class="op" id="6072537">)</span>&nbsp;<span class="ident" id="6072539">SetModTime</span><span class="op" id="6072549">(</span><span class="ident" id="6072550">t</span>&nbsp;<span class="ident" id="6072552">time</span><span class="op" id="6072556">.</span><span class="ident" id="6072557">Time</span><span class="op" id="6072561">)</span>&nbsp;<span class="op" id="6072563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072566">h</span><span class="op" id="6072567">.</span><span class="ident" id="6072568">ModifiedDate</span><span class="op" id="6072580">,</span>&nbsp;<span class="ident" id="6072582">h</span><span class="op" id="6072583">.</span><span class="ident" id="6072584">ModifiedTime</span>&nbsp;<span class="op" id="6072597">=</span>&nbsp;<span class="ident" id="6072599">timeToMsDosTime</span><span class="op" id="6072614">(</span><span class="ident" id="6072615">t</span><span class="op" id="6072616">)</span><br>
<span class="lineno"></span><span class="op" id="6072618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6072621">const</span>&nbsp;<span class="op" id="6072627">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072630">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6072690">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072746">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6072755">=</span>&nbsp;<span class="num" id="6072757">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072765">s_IFSOCK</span>&nbsp;<span class="op" id="6072774">=</span>&nbsp;<span class="num" id="6072776">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072784">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="6072793">=</span>&nbsp;<span class="num" id="6072795">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072803">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="6072812">=</span>&nbsp;<span class="num" id="6072814">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072822">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="6072831">=</span>&nbsp;<span class="num" id="6072833">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072841">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="6072850">=</span>&nbsp;<span class="num" id="6072852">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072860">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="6072869">=</span>&nbsp;<span class="num" id="6072871">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072879">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="6072888">=</span>&nbsp;<span class="num" id="6072890">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072898">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="6072907">=</span>&nbsp;<span class="num" id="6072909">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072916">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="6072925">=</span>&nbsp;<span class="num" id="6072927">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072934">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6072943">=</span>&nbsp;<span class="num" id="6072945">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072953">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6072967">=</span>&nbsp;<span class="num" id="6072969">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072975">msdosReadOnly</span>&nbsp;<span class="op" id="6072989">=</span>&nbsp;<span class="num" id="6072991">0x01</span><br>
<span class="lineno"></span><span class="op" id="6072996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6072999">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6073064">func</span>&nbsp;<span class="op" id="6073069">(</span><span class="ident" id="6073070">h</span>&nbsp;<span class="op" id="6073072">*</span><span class="ident" id="6073073">FileHeader</span><span class="op" id="6073083">)</span>&nbsp;<span class="ident" id="6073085">Mode</span><span class="op" id="6073089">(</span><span class="op" id="6073090">)</span>&nbsp;<span class="op" id="6073092">(</span><span class="ident" id="6073093">mode</span>&nbsp;<span class="ident" id="6073098">os</span><span class="op" id="6073100">.</span><span class="ident" id="6073101">FileMode</span><span class="op" id="6073109">)</span>&nbsp;<span class="op" id="6073111">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073114">switch</span>&nbsp;<span class="ident" id="6073121">h</span><span class="op" id="6073122">.</span><span class="ident" id="6073123">CreatorVersion</span>&nbsp;<span class="op" id="6073138">&gt;&gt;</span>&nbsp;<span class="num" id="6073141">8</span>&nbsp;<span class="op" id="6073143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073146">case</span>&nbsp;<span class="ident" id="6073151">creatorUnix</span><span class="op" id="6073162">,</span>&nbsp;<span class="ident" id="6073164">creatorMacOSX</span><span class="op" id="6073177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073181">mode</span>&nbsp;<span class="op" id="6073186">=</span>&nbsp;<span class="ident" id="6073188">unixModeToFileMode</span><span class="op" id="6073206">(</span><span class="ident" id="6073207">h</span><span class="op" id="6073208">.</span><span class="ident" id="6073209">ExternalAttrs</span>&nbsp;<span class="op" id="6073223">&gt;&gt;</span>&nbsp;<span class="num" id="6073226">16</span><span class="op" id="6073228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073231">case</span>&nbsp;<span class="ident" id="6073236">creatorNTFS</span><span class="op" id="6073247">,</span>&nbsp;<span class="ident" id="6073249">creatorVFAT</span><span class="op" id="6073260">,</span>&nbsp;<span class="ident" id="6073262">creatorFAT</span><span class="op" id="6073272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073276">mode</span>&nbsp;<span class="op" id="6073281">=</span>&nbsp;<span class="ident" id="6073283">msdosModeToFileMode</span><span class="op" id="6073302">(</span><span class="ident" id="6073303">h</span><span class="op" id="6073304">.</span><span class="ident" id="6073305">ExternalAttrs</span><span class="op" id="6073318">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073324">if</span>&nbsp;<span class="builtinfunc" id="6073327">len</span><span class="op" id="6073330">(</span><span class="ident" id="6073331">h</span><span class="op" id="6073332">.</span><span class="ident" id="6073333">Name</span><span class="op" id="6073337">)</span>&nbsp;<span class="op" id="6073339">&gt;</span>&nbsp;<span class="num" id="6073341">0</span>&nbsp;<span class="op" id="6073343">&amp;&amp;</span>&nbsp;<span class="ident" id="6073346">h</span><span class="op" id="6073347">.</span><span class="ident" id="6073348">Name</span><span class="op" id="6073352">[</span><span class="builtinfunc" id="6073353">len</span><span class="op" id="6073356">(</span><span class="ident" id="6073357">h</span><span class="op" id="6073358">.</span><span class="ident" id="6073359">Name</span><span class="op" id="6073363">)</span><span class="op" id="6073364">-</span><span class="num" id="6073365">1</span><span class="op" id="6073366">]</span>&nbsp;<span class="op" id="6073368">==</span>&nbsp;<span class="string" id="6073371">&#39;/&#39;</span>&nbsp;<span class="op" id="6073375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073379">mode</span>&nbsp;<span class="op" id="6073384">|=</span>&nbsp;<span class="ident" id="6073387">os</span><span class="op" id="6073389">.</span><span class="ident" id="6073390">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073402">return</span>&nbsp;<span class="ident" id="6073409">mode</span><br>
<span class="lineno">220</span><span class="op" id="6073414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6073417">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6073485">func</span>&nbsp;<span class="op" id="6073490">(</span><span class="ident" id="6073491">h</span>&nbsp;<span class="op" id="6073493">*</span><span class="ident" id="6073494">FileHeader</span><span class="op" id="6073504">)</span>&nbsp;<span class="ident" id="6073506">SetMode</span><span class="op" id="6073513">(</span><span class="ident" id="6073514">mode</span>&nbsp;<span class="ident" id="6073519">os</span><span class="op" id="6073521">.</span><span class="ident" id="6073522">FileMode</span><span class="op" id="6073530">)</span>&nbsp;<span class="op" id="6073532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073535">h</span><span class="op" id="6073536">.</span><span class="ident" id="6073537">CreatorVersion</span>&nbsp;<span class="op" id="6073552">=</span>&nbsp;<span class="ident" id="6073554">h</span><span class="op" id="6073555">.</span><span class="ident" id="6073556">CreatorVersion</span><span class="op" id="6073570">&amp;</span><span class="num" id="6073571">0xff</span>&nbsp;<span class="op" id="6073576">|</span>&nbsp;<span class="ident" id="6073578">creatorUnix</span><span class="op" id="6073589">&lt;&lt;</span><span class="num" id="6073591">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073594">h</span><span class="op" id="6073595">.</span><span class="ident" id="6073596">ExternalAttrs</span>&nbsp;<span class="op" id="6073610">=</span>&nbsp;<span class="ident" id="6073612">fileModeToUnixMode</span><span class="op" id="6073630">(</span><span class="ident" id="6073631">mode</span><span class="op" id="6073635">)</span>&nbsp;<span class="op" id="6073637">&lt;&lt;</span>&nbsp;<span class="num" id="6073640">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6073645">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073701">if</span>&nbsp;<span class="ident" id="6073704">mode</span><span class="op" id="6073708">&amp;</span><span class="ident" id="6073709">os</span><span class="op" id="6073711">.</span><span class="ident" id="6073712">ModeDir</span>&nbsp;<span class="op" id="6073720">!=</span>&nbsp;<span class="num" id="6073723">0</span>&nbsp;<span class="op" id="6073725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073729">h</span><span class="op" id="6073730">.</span><span class="ident" id="6073731">ExternalAttrs</span>&nbsp;<span class="op" id="6073745">|=</span>&nbsp;<span class="ident" id="6073748">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073761">if</span>&nbsp;<span class="ident" id="6073764">mode</span><span class="op" id="6073768">&amp;</span><span class="num" id="6073769">0200</span>&nbsp;<span class="op" id="6073774">==</span>&nbsp;<span class="num" id="6073777">0</span>&nbsp;<span class="op" id="6073779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6073783">h</span><span class="op" id="6073784">.</span><span class="ident" id="6073785">ExternalAttrs</span>&nbsp;<span class="op" id="6073799">|=</span>&nbsp;<span class="ident" id="6073802">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6073817">}</span><br>
<span class="lineno"></span><span class="op" id="6073819">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6073822">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="6073888">func</span>&nbsp;<span class="op" id="6073893">(</span><span class="ident" id="6073894">fh</span>&nbsp;<span class="op" id="6073897">*</span><span class="ident" id="6073898">FileHeader</span><span class="op" id="6073908">)</span>&nbsp;<span class="ident" id="6073910">isZip64</span><span class="op" id="6073917">(</span><span class="op" id="6073918">)</span>&nbsp;<span class="builtintype" id="6073920">bool</span>&nbsp;<span class="op" id="6073925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6073928">return</span>&nbsp;<span class="ident" id="6073935">fh</span><span class="op" id="6073937">.</span><span class="ident" id="6073938">CompressedSize64</span>&nbsp;<span class="op" id="6073955">&gt;</span>&nbsp;<span class="ident" id="6073957">uint32max</span>&nbsp;<span class="op" id="6073967">||</span>&nbsp;<span class="ident" id="6073970">fh</span><span class="op" id="6073972">.</span><span class="ident" id="6073973">UncompressedSize64</span>&nbsp;<span class="op" id="6073992">&gt;</span>&nbsp;<span class="ident" id="6073994">uint32max</span><br>
<span class="lineno"></span><span class="op" id="6074004">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6074007">func</span>&nbsp;<span class="ident" id="6074012">msdosModeToFileMode</span><span class="op" id="6074031">(</span><span class="ident" id="6074032">m</span>&nbsp;<span class="builtintype" id="6074034">uint32</span><span class="op" id="6074040">)</span>&nbsp;<span class="op" id="6074042">(</span><span class="ident" id="6074043">mode</span>&nbsp;<span class="ident" id="6074048">os</span><span class="op" id="6074050">.</span><span class="ident" id="6074051">FileMode</span><span class="op" id="6074059">)</span>&nbsp;<span class="op" id="6074061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074064">if</span>&nbsp;<span class="ident" id="6074067">m</span><span class="op" id="6074068">&amp;</span><span class="ident" id="6074069">msdosDir</span>&nbsp;<span class="op" id="6074078">!=</span>&nbsp;<span class="num" id="6074081">0</span>&nbsp;<span class="op" id="6074083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074087">mode</span>&nbsp;<span class="op" id="6074092">=</span>&nbsp;<span class="ident" id="6074094">os</span><span class="op" id="6074096">.</span><span class="ident" id="6074097">ModeDir</span>&nbsp;<span class="op" id="6074105">|</span>&nbsp;<span class="num" id="6074107">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074113">}</span>&nbsp;<span class="keyword" id="6074115">else</span>&nbsp;<span class="op" id="6074120">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074124">mode</span>&nbsp;<span class="op" id="6074129">=</span>&nbsp;<span class="num" id="6074131">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074140">if</span>&nbsp;<span class="ident" id="6074143">m</span><span class="op" id="6074144">&amp;</span><span class="ident" id="6074145">msdosReadOnly</span>&nbsp;<span class="op" id="6074159">!=</span>&nbsp;<span class="num" id="6074162">0</span>&nbsp;<span class="op" id="6074164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074168">mode</span>&nbsp;<span class="op" id="6074173">&amp;^=</span>&nbsp;<span class="num" id="6074177">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074183">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074186">return</span>&nbsp;<span class="ident" id="6074193">mode</span><br>
<span class="lineno"></span><span class="op" id="6074198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6074201">func</span>&nbsp;<span class="ident" id="6074206">fileModeToUnixMode</span><span class="op" id="6074224">(</span><span class="ident" id="6074225">mode</span>&nbsp;<span class="ident" id="6074230">os</span><span class="op" id="6074232">.</span><span class="ident" id="6074233">FileMode</span><span class="op" id="6074241">)</span>&nbsp;<span class="builtintype" id="6074243">uint32</span>&nbsp;<span class="op" id="6074250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074253">var</span>&nbsp;<span class="ident" id="6074257">m</span>&nbsp;<span class="builtintype" id="6074259">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074267">switch</span>&nbsp;<span class="ident" id="6074274">mode</span>&nbsp;<span class="op" id="6074279">&amp;</span>&nbsp;<span class="ident" id="6074281">os</span><span class="op" id="6074283">.</span><span class="ident" id="6074284">ModeType</span>&nbsp;<span class="op" id="6074293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074296">default</span><span class="op" id="6074303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074307">m</span>&nbsp;<span class="op" id="6074309">=</span>&nbsp;<span class="ident" id="6074311">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074320">case</span>&nbsp;<span class="ident" id="6074325">os</span><span class="op" id="6074327">.</span><span class="ident" id="6074328">ModeDir</span><span class="op" id="6074335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074339">m</span>&nbsp;<span class="op" id="6074341">=</span>&nbsp;<span class="ident" id="6074343">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074352">case</span>&nbsp;<span class="ident" id="6074357">os</span><span class="op" id="6074359">.</span><span class="ident" id="6074360">ModeSymlink</span><span class="op" id="6074371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074375">m</span>&nbsp;<span class="op" id="6074377">=</span>&nbsp;<span class="ident" id="6074379">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074388">case</span>&nbsp;<span class="ident" id="6074393">os</span><span class="op" id="6074395">.</span><span class="ident" id="6074396">ModeNamedPipe</span><span class="op" id="6074409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074413">m</span>&nbsp;<span class="op" id="6074415">=</span>&nbsp;<span class="ident" id="6074417">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074426">case</span>&nbsp;<span class="ident" id="6074431">os</span><span class="op" id="6074433">.</span><span class="ident" id="6074434">ModeSocket</span><span class="op" id="6074444">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074448">m</span>&nbsp;<span class="op" id="6074450">=</span>&nbsp;<span class="ident" id="6074452">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074462">case</span>&nbsp;<span class="ident" id="6074467">os</span><span class="op" id="6074469">.</span><span class="ident" id="6074470">ModeDevice</span><span class="op" id="6074480">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074484">if</span>&nbsp;<span class="ident" id="6074487">mode</span><span class="op" id="6074491">&amp;</span><span class="ident" id="6074492">os</span><span class="op" id="6074494">.</span><span class="ident" id="6074495">ModeCharDevice</span>&nbsp;<span class="op" id="6074510">!=</span>&nbsp;<span class="num" id="6074513">0</span>&nbsp;<span class="op" id="6074515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074520">m</span>&nbsp;<span class="op" id="6074522">=</span>&nbsp;<span class="ident" id="6074524">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074534">}</span>&nbsp;<span class="keyword" id="6074536">else</span>&nbsp;<span class="op" id="6074541">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074546">m</span>&nbsp;<span class="op" id="6074548">=</span>&nbsp;<span class="ident" id="6074550">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074566">if</span>&nbsp;<span class="ident" id="6074569">mode</span><span class="op" id="6074573">&amp;</span><span class="ident" id="6074574">os</span><span class="op" id="6074576">.</span><span class="ident" id="6074577">ModeSetuid</span>&nbsp;<span class="op" id="6074588">!=</span>&nbsp;<span class="num" id="6074591">0</span>&nbsp;<span class="op" id="6074593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074597">m</span>&nbsp;<span class="op" id="6074599">|=</span>&nbsp;<span class="ident" id="6074602">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074614">if</span>&nbsp;<span class="ident" id="6074617">mode</span><span class="op" id="6074621">&amp;</span><span class="ident" id="6074622">os</span><span class="op" id="6074624">.</span><span class="ident" id="6074625">ModeSetgid</span>&nbsp;<span class="op" id="6074636">!=</span>&nbsp;<span class="num" id="6074639">0</span>&nbsp;<span class="op" id="6074641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074645">m</span>&nbsp;<span class="op" id="6074647">|=</span>&nbsp;<span class="ident" id="6074650">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074662">if</span>&nbsp;<span class="ident" id="6074665">mode</span><span class="op" id="6074669">&amp;</span><span class="ident" id="6074670">os</span><span class="op" id="6074672">.</span><span class="ident" id="6074673">ModeSticky</span>&nbsp;<span class="op" id="6074684">!=</span>&nbsp;<span class="num" id="6074687">0</span>&nbsp;<span class="op" id="6074689">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074693">m</span>&nbsp;<span class="op" id="6074695">|=</span>&nbsp;<span class="ident" id="6074698">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6074707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074710">return</span>&nbsp;<span class="ident" id="6074717">m</span>&nbsp;<span class="op" id="6074719">|</span>&nbsp;<span class="builtintype" id="6074721">uint32</span><span class="op" id="6074727">(</span><span class="ident" id="6074728">mode</span><span class="op" id="6074732">&amp;</span><span class="num" id="6074733">0777</span><span class="op" id="6074737">)</span><br>
<span class="lineno"></span><span class="op" id="6074739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6074742">func</span>&nbsp;<span class="ident" id="6074747">unixModeToFileMode</span><span class="op" id="6074765">(</span><span class="ident" id="6074766">m</span>&nbsp;<span class="builtintype" id="6074768">uint32</span><span class="op" id="6074774">)</span>&nbsp;<span class="ident" id="6074776">os</span><span class="op" id="6074778">.</span><span class="ident" id="6074779">FileMode</span>&nbsp;<span class="op" id="6074788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074791">mode</span>&nbsp;<span class="op" id="6074796">:=</span>&nbsp;<span class="ident" id="6074799">os</span><span class="op" id="6074801">.</span><span class="ident" id="6074802">FileMode</span><span class="op" id="6074810">(</span><span class="ident" id="6074811">m</span>&nbsp;<span class="op" id="6074813">&amp;</span>&nbsp;<span class="num" id="6074815">0777</span><span class="op" id="6074819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074822">switch</span>&nbsp;<span class="ident" id="6074829">m</span>&nbsp;<span class="op" id="6074831">&amp;</span>&nbsp;<span class="ident" id="6074833">s_IFMT</span>&nbsp;<span class="op" id="6074840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074843">case</span>&nbsp;<span class="ident" id="6074848">s_IFBLK</span><span class="op" id="6074855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074859">mode</span>&nbsp;<span class="op" id="6074864">|=</span>&nbsp;<span class="ident" id="6074867">os</span><span class="op" id="6074869">.</span><span class="ident" id="6074870">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074882">case</span>&nbsp;<span class="ident" id="6074887">s_IFCHR</span><span class="op" id="6074894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074898">mode</span>&nbsp;<span class="op" id="6074903">|=</span>&nbsp;<span class="ident" id="6074906">os</span><span class="op" id="6074908">.</span><span class="ident" id="6074909">ModeDevice</span>&nbsp;<span class="op" id="6074920">|</span>&nbsp;<span class="ident" id="6074922">os</span><span class="op" id="6074924">.</span><span class="ident" id="6074925">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074941">case</span>&nbsp;<span class="ident" id="6074946">s_IFDIR</span><span class="op" id="6074953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074957">mode</span>&nbsp;<span class="op" id="6074962">|=</span>&nbsp;<span class="ident" id="6074965">os</span><span class="op" id="6074967">.</span><span class="ident" id="6074968">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6074977">case</span>&nbsp;<span class="ident" id="6074982">s_IFIFO</span><span class="op" id="6074989">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6074993">mode</span>&nbsp;<span class="op" id="6074998">|=</span>&nbsp;<span class="ident" id="6075001">os</span><span class="op" id="6075003">.</span><span class="ident" id="6075004">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075019">case</span>&nbsp;<span class="ident" id="6075024">s_IFLNK</span><span class="op" id="6075031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075035">mode</span>&nbsp;<span class="op" id="6075040">|=</span>&nbsp;<span class="ident" id="6075043">os</span><span class="op" id="6075045">.</span><span class="ident" id="6075046">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075059">case</span>&nbsp;<span class="ident" id="6075064">s_IFREG</span><span class="op" id="6075071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6075075">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075093">case</span>&nbsp;<span class="ident" id="6075098">s_IFSOCK</span><span class="op" id="6075106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075110">mode</span>&nbsp;<span class="op" id="6075115">|=</span>&nbsp;<span class="ident" id="6075118">os</span><span class="op" id="6075120">.</span><span class="ident" id="6075121">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075136">if</span>&nbsp;<span class="ident" id="6075139">m</span><span class="op" id="6075140">&amp;</span><span class="ident" id="6075141">s_ISGID</span>&nbsp;<span class="op" id="6075149">!=</span>&nbsp;<span class="num" id="6075152">0</span>&nbsp;<span class="op" id="6075154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075158">mode</span>&nbsp;<span class="op" id="6075163">|=</span>&nbsp;<span class="ident" id="6075166">os</span><span class="op" id="6075168">.</span><span class="ident" id="6075169">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075184">if</span>&nbsp;<span class="ident" id="6075187">m</span><span class="op" id="6075188">&amp;</span><span class="ident" id="6075189">s_ISUID</span>&nbsp;<span class="op" id="6075197">!=</span>&nbsp;<span class="num" id="6075200">0</span>&nbsp;<span class="op" id="6075202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075206">mode</span>&nbsp;<span class="op" id="6075211">|=</span>&nbsp;<span class="ident" id="6075214">os</span><span class="op" id="6075216">.</span><span class="ident" id="6075217">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075232">if</span>&nbsp;<span class="ident" id="6075235">m</span><span class="op" id="6075236">&amp;</span><span class="ident" id="6075237">s_ISVTX</span>&nbsp;<span class="op" id="6075245">!=</span>&nbsp;<span class="num" id="6075248">0</span>&nbsp;<span class="op" id="6075250">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075254">mode</span>&nbsp;<span class="op" id="6075259">|=</span>&nbsp;<span class="ident" id="6075262">os</span><span class="op" id="6075264">.</span><span class="ident" id="6075265">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075280">return</span>&nbsp;<span class="ident" id="6075287">mode</span><br>
<span class="lineno"></span><span class="op" id="6075292">}</span>
</div>
</body>
</html>
