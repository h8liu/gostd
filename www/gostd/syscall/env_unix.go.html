<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html" class="current">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2366657">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2366713">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2366767">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2366818">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2366888">//&nbsp;Unix&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2366920">package</span>&nbsp;<span class="ident" id="2366928">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2366937">import</span>&nbsp;<span class="string" id="2366944">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2366952">var</span>&nbsp;<span class="op" id="2366956">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2366959">//&nbsp;envOnce&nbsp;guards&nbsp;initialization&nbsp;by&nbsp;copyenv,&nbsp;which&nbsp;populates&nbsp;env.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367026">envOnce</span>&nbsp;<span class="ident" id="2367034">sync</span><span class="op" id="2367038">.</span><span class="ident" id="2367039">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367046">//&nbsp;envLock&nbsp;guards&nbsp;env&nbsp;and&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367079">envLock</span>&nbsp;<span class="ident" id="2367087">sync</span><span class="op" id="2367091">.</span><span class="ident" id="2367092">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367102">//&nbsp;env&nbsp;maps&nbsp;from&nbsp;an&nbsp;environment&nbsp;variable&nbsp;to&nbsp;its&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;envs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367177">env</span>&nbsp;<span class="keyword" id="2367181">map</span><span class="op" id="2367184">[</span><span class="builtintype" id="2367185">string</span><span class="op" id="2367191">]</span><span class="builtintype" id="2367192">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367198">//&nbsp;envs&nbsp;is&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;elements&nbsp;are&nbsp;expected&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367260">//&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;key=value&#34;.&nbsp;An&nbsp;empty&nbsp;string&nbsp;means&nbsp;deleted</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367322">//&nbsp;(or&nbsp;a&nbsp;duplicate&nbsp;to&nbsp;be&nbsp;ignored).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367358">envs</span>&nbsp;<span class="op" id="2367363">[</span><span class="op" id="2367364">]</span><span class="builtintype" id="2367365">string</span>&nbsp;<span class="op" id="2367372">=</span>&nbsp;<span class="ident" id="2367374">runtime_envs</span><span class="op" id="2367386">(</span><span class="op" id="2367387">)</span><br>
<span class="lineno"></span><span class="op" id="2367389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2367392">func</span>&nbsp;<span class="ident" id="2367397">runtime_envs</span><span class="op" id="2367409">(</span><span class="op" id="2367410">)</span>&nbsp;<span class="op" id="2367412">[</span><span class="op" id="2367413">]</span><span class="builtintype" id="2367414">string</span>&nbsp;<span class="comment" id="2367421">//&nbsp;in&nbsp;package&nbsp;runtime</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="2367444">//&nbsp;setenv_c&nbsp;and&nbsp;unsetenv_c&nbsp;are&nbsp;provided&nbsp;by&nbsp;the&nbsp;runtime&nbsp;but&nbsp;are&nbsp;no-ops</span><br>
<span class="lineno"></span><span class="comment" id="2367514">//&nbsp;if&nbsp;cgo&nbsp;isn&#39;t&nbsp;loaded.</span><br>
<span class="lineno"></span><span class="keyword" id="2367538">func</span>&nbsp;<span class="ident" id="2367543">setenv_c</span><span class="op" id="2367551">(</span><span class="ident" id="2367552">k</span><span class="op" id="2367553">,</span>&nbsp;<span class="ident" id="2367555">v</span>&nbsp;<span class="builtintype" id="2367557">string</span><span class="op" id="2367563">)</span><br>
<span class="lineno"></span><span class="keyword" id="2367565">func</span>&nbsp;<span class="ident" id="2367570">unsetenv_c</span><span class="op" id="2367580">(</span><span class="ident" id="2367581">k</span>&nbsp;<span class="builtintype" id="2367583">string</span><span class="op" id="2367589">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2367592">func</span>&nbsp;<span class="ident" id="2367597">copyenv</span><span class="op" id="2367604">(</span><span class="op" id="2367605">)</span>&nbsp;<span class="op" id="2367607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367610">env</span>&nbsp;<span class="op" id="2367614">=</span>&nbsp;<span class="builtinfunc" id="2367616">make</span><span class="op" id="2367620">(</span><span class="keyword" id="2367621">map</span><span class="op" id="2367624">[</span><span class="builtintype" id="2367625">string</span><span class="op" id="2367631">]</span><span class="builtintype" id="2367632">int</span><span class="op" id="2367635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2367638">for</span>&nbsp;<span class="ident" id="2367642">i</span><span class="op" id="2367643">,</span>&nbsp;<span class="ident" id="2367645">s</span>&nbsp;<span class="op" id="2367647">:=</span>&nbsp;<span class="keyword" id="2367650">range</span>&nbsp;<span class="ident" id="2367656">envs</span>&nbsp;<span class="op" id="2367661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2367665">for</span>&nbsp;<span class="ident" id="2367669">j</span>&nbsp;<span class="op" id="2367671">:=</span>&nbsp;<span class="num" id="2367674">0</span><span class="op" id="2367675">;</span>&nbsp;<span class="ident" id="2367677">j</span>&nbsp;<span class="op" id="2367679">&lt;</span>&nbsp;<span class="builtinfunc" id="2367681">len</span><span class="op" id="2367684">(</span><span class="ident" id="2367685">s</span><span class="op" id="2367686">)</span><span class="op" id="2367687">;</span>&nbsp;<span class="ident" id="2367689">j</span><span class="op" id="2367690">++</span>&nbsp;<span class="op" id="2367693">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2367698">if</span>&nbsp;<span class="ident" id="2367701">s</span><span class="op" id="2367702">[</span><span class="ident" id="2367703">j</span><span class="op" id="2367704">]</span>&nbsp;<span class="op" id="2367706">==</span>&nbsp;<span class="string" id="2367709">&#39;=&#39;</span>&nbsp;<span class="op" id="2367713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367719">key</span>&nbsp;<span class="op" id="2367723">:=</span>&nbsp;<span class="ident" id="2367726">s</span><span class="op" id="2367727">[</span><span class="op" id="2367728">:</span><span class="ident" id="2367729">j</span><span class="op" id="2367730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2367736">if</span>&nbsp;<span class="ident" id="2367739">_</span><span class="op" id="2367740">,</span>&nbsp;<span class="ident" id="2367742">ok</span>&nbsp;<span class="op" id="2367745">:=</span>&nbsp;<span class="ident" id="2367748">env</span><span class="op" id="2367751">[</span><span class="ident" id="2367752">key</span><span class="op" id="2367755">]</span><span class="op" id="2367756">;</span>&nbsp;<span class="op" id="2367758">!</span><span class="ident" id="2367759">ok</span>&nbsp;<span class="op" id="2367762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2367769">env</span><span class="op" id="2367772">[</span><span class="ident" id="2367773">key</span><span class="op" id="2367776">]</span>&nbsp;<span class="op" id="2367778">=</span>&nbsp;<span class="ident" id="2367780">i</span>&nbsp;<span class="comment" id="2367782">//&nbsp;first&nbsp;mention&nbsp;of&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2367810">}</span>&nbsp;<span class="keyword" id="2367812">else</span>&nbsp;<span class="op" id="2367817">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367824">//&nbsp;Clear&nbsp;duplicate&nbsp;keys.&nbsp;This&nbsp;permits&nbsp;Unsetenv&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367879">//&nbsp;safely&nbsp;delete&nbsp;only&nbsp;the&nbsp;first&nbsp;item&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367929">//&nbsp;worrying&nbsp;about&nbsp;unshadowing&nbsp;a&nbsp;later&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2367977">//&nbsp;which&nbsp;might&nbsp;be&nbsp;a&nbsp;security&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368020">envs</span><span class="op" id="2368024">[</span><span class="ident" id="2368025">i</span><span class="op" id="2368026">]</span>&nbsp;<span class="op" id="2368028">=</span>&nbsp;<span class="string" id="2368030">&#34;&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368043">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368059">}</span><br>
<span class="lineno">55</span><span class="op" id="2368061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2368064">func</span>&nbsp;<span class="ident" id="2368069">Unsetenv</span><span class="op" id="2368077">(</span><span class="ident" id="2368078">key</span>&nbsp;<span class="builtintype" id="2368082">string</span><span class="op" id="2368088">)</span>&nbsp;<span class="builtintype" id="2368090">error</span>&nbsp;<span class="op" id="2368096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368099">envOnce</span><span class="op" id="2368106">.</span><span class="ident" id="2368107">Do</span><span class="op" id="2368109">(</span><span class="ident" id="2368110">copyenv</span><span class="op" id="2368117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368121">envLock</span><span class="op" id="2368128">.</span><span class="ident" id="2368129">Lock</span><span class="op" id="2368133">(</span><span class="op" id="2368134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368137">defer</span>&nbsp;<span class="ident" id="2368143">envLock</span><span class="op" id="2368150">.</span><span class="ident" id="2368151">Unlock</span><span class="op" id="2368157">(</span><span class="op" id="2368158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368162">if</span>&nbsp;<span class="ident" id="2368165">i</span><span class="op" id="2368166">,</span>&nbsp;<span class="ident" id="2368168">ok</span>&nbsp;<span class="op" id="2368171">:=</span>&nbsp;<span class="ident" id="2368174">env</span><span class="op" id="2368177">[</span><span class="ident" id="2368178">key</span><span class="op" id="2368181">]</span><span class="op" id="2368182">;</span>&nbsp;<span class="ident" id="2368184">ok</span>&nbsp;<span class="op" id="2368187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368191">envs</span><span class="op" id="2368195">[</span><span class="ident" id="2368196">i</span><span class="op" id="2368197">]</span>&nbsp;<span class="op" id="2368199">=</span>&nbsp;<span class="string" id="2368201">&#34;&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2368206">delete</span><span class="op" id="2368212">(</span><span class="ident" id="2368213">env</span><span class="op" id="2368216">,</span>&nbsp;<span class="ident" id="2368218">key</span><span class="op" id="2368221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368227">unsetenv_c</span><span class="op" id="2368237">(</span><span class="ident" id="2368238">key</span><span class="op" id="2368241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368244">return</span>&nbsp;<span class="ident" id="2368251">nil</span><br>
<span class="lineno"></span><span class="op" id="2368255">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2368258">func</span>&nbsp;<span class="ident" id="2368263">Getenv</span><span class="op" id="2368269">(</span><span class="ident" id="2368270">key</span>&nbsp;<span class="builtintype" id="2368274">string</span><span class="op" id="2368280">)</span>&nbsp;<span class="op" id="2368282">(</span><span class="ident" id="2368283">value</span>&nbsp;<span class="builtintype" id="2368289">string</span><span class="op" id="2368295">,</span>&nbsp;<span class="ident" id="2368297">found</span>&nbsp;<span class="builtintype" id="2368303">bool</span><span class="op" id="2368307">)</span>&nbsp;<span class="op" id="2368309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368312">envOnce</span><span class="op" id="2368319">.</span><span class="ident" id="2368320">Do</span><span class="op" id="2368322">(</span><span class="ident" id="2368323">copyenv</span><span class="op" id="2368330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368333">if</span>&nbsp;<span class="builtinfunc" id="2368336">len</span><span class="op" id="2368339">(</span><span class="ident" id="2368340">key</span><span class="op" id="2368343">)</span>&nbsp;<span class="op" id="2368345">==</span>&nbsp;<span class="num" id="2368348">0</span>&nbsp;<span class="op" id="2368350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368354">return</span>&nbsp;<span class="string" id="2368361">&#34;&#34;</span><span class="op" id="2368363">,</span>&nbsp;<span class="builtintype" id="2368365">false</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368376">envLock</span><span class="op" id="2368383">.</span><span class="ident" id="2368384">RLock</span><span class="op" id="2368389">(</span><span class="op" id="2368390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368393">defer</span>&nbsp;<span class="ident" id="2368399">envLock</span><span class="op" id="2368406">.</span><span class="ident" id="2368407">RUnlock</span><span class="op" id="2368414">(</span><span class="op" id="2368415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368419">i</span><span class="op" id="2368420">,</span>&nbsp;<span class="ident" id="2368422">ok</span>&nbsp;<span class="op" id="2368425">:=</span>&nbsp;<span class="ident" id="2368428">env</span><span class="op" id="2368431">[</span><span class="ident" id="2368432">key</span><span class="op" id="2368435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368438">if</span>&nbsp;<span class="op" id="2368441">!</span><span class="ident" id="2368442">ok</span>&nbsp;<span class="op" id="2368445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368449">return</span>&nbsp;<span class="string" id="2368456">&#34;&#34;</span><span class="op" id="2368458">,</span>&nbsp;<span class="builtintype" id="2368460">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368470">s</span>&nbsp;<span class="op" id="2368472">:=</span>&nbsp;<span class="ident" id="2368475">envs</span><span class="op" id="2368479">[</span><span class="ident" id="2368480">i</span><span class="op" id="2368481">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368484">for</span>&nbsp;<span class="ident" id="2368488">i</span>&nbsp;<span class="op" id="2368490">:=</span>&nbsp;<span class="num" id="2368493">0</span><span class="op" id="2368494">;</span>&nbsp;<span class="ident" id="2368496">i</span>&nbsp;<span class="op" id="2368498">&lt;</span>&nbsp;<span class="builtinfunc" id="2368500">len</span><span class="op" id="2368503">(</span><span class="ident" id="2368504">s</span><span class="op" id="2368505">)</span><span class="op" id="2368506">;</span>&nbsp;<span class="ident" id="2368508">i</span><span class="op" id="2368509">++</span>&nbsp;<span class="op" id="2368512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368516">if</span>&nbsp;<span class="ident" id="2368519">s</span><span class="op" id="2368520">[</span><span class="ident" id="2368521">i</span><span class="op" id="2368522">]</span>&nbsp;<span class="op" id="2368524">==</span>&nbsp;<span class="string" id="2368527">&#39;=&#39;</span>&nbsp;<span class="op" id="2368531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368536">return</span>&nbsp;<span class="ident" id="2368543">s</span><span class="op" id="2368544">[</span><span class="ident" id="2368545">i</span><span class="op" id="2368546">+</span><span class="num" id="2368547">1</span><span class="op" id="2368548">:</span><span class="op" id="2368549">]</span><span class="op" id="2368550">,</span>&nbsp;<span class="builtintype" id="2368552">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368562">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368565">return</span>&nbsp;<span class="string" id="2368572">&#34;&#34;</span><span class="op" id="2368574">,</span>&nbsp;<span class="builtintype" id="2368576">false</span><br>
<span class="lineno"></span><span class="op" id="2368582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2368585">func</span>&nbsp;<span class="ident" id="2368590">Setenv</span><span class="op" id="2368596">(</span><span class="ident" id="2368597">key</span><span class="op" id="2368600">,</span>&nbsp;<span class="ident" id="2368602">value</span>&nbsp;<span class="builtintype" id="2368608">string</span><span class="op" id="2368614">)</span>&nbsp;<span class="builtintype" id="2368616">error</span>&nbsp;<span class="op" id="2368622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368625">envOnce</span><span class="op" id="2368632">.</span><span class="ident" id="2368633">Do</span><span class="op" id="2368635">(</span><span class="ident" id="2368636">copyenv</span><span class="op" id="2368643">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368646">if</span>&nbsp;<span class="builtinfunc" id="2368649">len</span><span class="op" id="2368652">(</span><span class="ident" id="2368653">key</span><span class="op" id="2368656">)</span>&nbsp;<span class="op" id="2368658">==</span>&nbsp;<span class="num" id="2368661">0</span>&nbsp;<span class="op" id="2368663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368667">return</span>&nbsp;<span class="ident" id="2368674">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368685">for</span>&nbsp;<span class="ident" id="2368689">i</span>&nbsp;<span class="op" id="2368691">:=</span>&nbsp;<span class="num" id="2368694">0</span><span class="op" id="2368695">;</span>&nbsp;<span class="ident" id="2368697">i</span>&nbsp;<span class="op" id="2368699">&lt;</span>&nbsp;<span class="builtinfunc" id="2368701">len</span><span class="op" id="2368704">(</span><span class="ident" id="2368705">key</span><span class="op" id="2368708">)</span><span class="op" id="2368709">;</span>&nbsp;<span class="ident" id="2368711">i</span><span class="op" id="2368712">++</span>&nbsp;<span class="op" id="2368715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368719">if</span>&nbsp;<span class="ident" id="2368722">key</span><span class="op" id="2368725">[</span><span class="ident" id="2368726">i</span><span class="op" id="2368727">]</span>&nbsp;<span class="op" id="2368729">==</span>&nbsp;<span class="string" id="2368732">&#39;=&#39;</span>&nbsp;<span class="op" id="2368736">||</span>&nbsp;<span class="ident" id="2368739">key</span><span class="op" id="2368742">[</span><span class="ident" id="2368743">i</span><span class="op" id="2368744">]</span>&nbsp;<span class="op" id="2368746">==</span>&nbsp;<span class="num" id="2368749">0</span>&nbsp;<span class="op" id="2368751">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368756">return</span>&nbsp;<span class="ident" id="2368763">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368778">for</span>&nbsp;<span class="ident" id="2368782">i</span>&nbsp;<span class="op" id="2368784">:=</span>&nbsp;<span class="num" id="2368787">0</span><span class="op" id="2368788">;</span>&nbsp;<span class="ident" id="2368790">i</span>&nbsp;<span class="op" id="2368792">&lt;</span>&nbsp;<span class="builtinfunc" id="2368794">len</span><span class="op" id="2368797">(</span><span class="ident" id="2368798">value</span><span class="op" id="2368803">)</span><span class="op" id="2368804">;</span>&nbsp;<span class="ident" id="2368806">i</span><span class="op" id="2368807">++</span>&nbsp;<span class="op" id="2368810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368814">if</span>&nbsp;<span class="ident" id="2368817">value</span><span class="op" id="2368822">[</span><span class="ident" id="2368823">i</span><span class="op" id="2368824">]</span>&nbsp;<span class="op" id="2368826">==</span>&nbsp;<span class="num" id="2368829">0</span>&nbsp;<span class="op" id="2368831">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368836">return</span>&nbsp;<span class="ident" id="2368843">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368859">envLock</span><span class="op" id="2368866">.</span><span class="ident" id="2368867">Lock</span><span class="op" id="2368871">(</span><span class="op" id="2368872">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368875">defer</span>&nbsp;<span class="ident" id="2368881">envLock</span><span class="op" id="2368888">.</span><span class="ident" id="2368889">Unlock</span><span class="op" id="2368895">(</span><span class="op" id="2368896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368900">i</span><span class="op" id="2368901">,</span>&nbsp;<span class="ident" id="2368903">ok</span>&nbsp;<span class="op" id="2368906">:=</span>&nbsp;<span class="ident" id="2368909">env</span><span class="op" id="2368912">[</span><span class="ident" id="2368913">key</span><span class="op" id="2368916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368919">kv</span>&nbsp;<span class="op" id="2368922">:=</span>&nbsp;<span class="ident" id="2368925">key</span>&nbsp;<span class="op" id="2368929">+</span>&nbsp;<span class="string" id="2368931">&#34;=&#34;</span>&nbsp;<span class="op" id="2368935">+</span>&nbsp;<span class="ident" id="2368937">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2368944">if</span>&nbsp;<span class="ident" id="2368947">ok</span>&nbsp;<span class="op" id="2368950">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368954">envs</span><span class="op" id="2368958">[</span><span class="ident" id="2368959">i</span><span class="op" id="2368960">]</span>&nbsp;<span class="op" id="2368962">=</span>&nbsp;<span class="ident" id="2368964">kv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2368968">}</span>&nbsp;<span class="keyword" id="2368970">else</span>&nbsp;<span class="op" id="2368975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368979">i</span>&nbsp;<span class="op" id="2368981">=</span>&nbsp;<span class="builtinfunc" id="2368983">len</span><span class="op" id="2368986">(</span><span class="ident" id="2368987">envs</span><span class="op" id="2368991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2368995">envs</span>&nbsp;<span class="op" id="2369000">=</span>&nbsp;<span class="builtinfunc" id="2369002">append</span><span class="op" id="2369008">(</span><span class="ident" id="2369009">envs</span><span class="op" id="2369013">,</span>&nbsp;<span class="ident" id="2369015">kv</span><span class="op" id="2369017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2369020">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369023">env</span><span class="op" id="2369026">[</span><span class="ident" id="2369027">key</span><span class="op" id="2369030">]</span>&nbsp;<span class="op" id="2369032">=</span>&nbsp;<span class="ident" id="2369034">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369037">setenv_c</span><span class="op" id="2369045">(</span><span class="ident" id="2369046">key</span><span class="op" id="2369049">,</span>&nbsp;<span class="ident" id="2369051">value</span><span class="op" id="2369056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369059">return</span>&nbsp;<span class="ident" id="2369066">nil</span><br>
<span class="lineno"></span><span class="op" id="2369070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2369073">func</span>&nbsp;<span class="ident" id="2369078">Clearenv</span><span class="op" id="2369086">(</span><span class="op" id="2369087">)</span>&nbsp;<span class="op" id="2369089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369092">envOnce</span><span class="op" id="2369099">.</span><span class="ident" id="2369100">Do</span><span class="op" id="2369102">(</span><span class="ident" id="2369103">copyenv</span><span class="op" id="2369110">)</span>&nbsp;<span class="comment" id="2369112">//&nbsp;prevent&nbsp;copyenv&nbsp;in&nbsp;Getenv/Setenv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369150">envLock</span><span class="op" id="2369157">.</span><span class="ident" id="2369158">Lock</span><span class="op" id="2369162">(</span><span class="op" id="2369163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369166">defer</span>&nbsp;<span class="ident" id="2369172">envLock</span><span class="op" id="2369179">.</span><span class="ident" id="2369180">Unlock</span><span class="op" id="2369186">(</span><span class="op" id="2369187">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369191">for</span>&nbsp;<span class="ident" id="2369195">k</span>&nbsp;<span class="op" id="2369197">:=</span>&nbsp;<span class="keyword" id="2369200">range</span>&nbsp;<span class="ident" id="2369206">env</span>&nbsp;<span class="op" id="2369210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369214">unsetenv_c</span><span class="op" id="2369224">(</span><span class="ident" id="2369225">k</span><span class="op" id="2369226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2369229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369232">env</span>&nbsp;<span class="op" id="2369236">=</span>&nbsp;<span class="builtinfunc" id="2369238">make</span><span class="op" id="2369242">(</span><span class="keyword" id="2369243">map</span><span class="op" id="2369246">[</span><span class="builtintype" id="2369247">string</span><span class="op" id="2369253">]</span><span class="builtintype" id="2369254">int</span><span class="op" id="2369257">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369260">envs</span>&nbsp;<span class="op" id="2369265">=</span>&nbsp;<span class="op" id="2369267">[</span><span class="op" id="2369268">]</span><span class="builtintype" id="2369269">string</span><span class="op" id="2369275">{</span><span class="op" id="2369276">}</span><br>
<span class="lineno"></span><span class="op" id="2369278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2369281">func</span>&nbsp;<span class="ident" id="2369286">Environ</span><span class="op" id="2369293">(</span><span class="op" id="2369294">)</span>&nbsp;<span class="op" id="2369296">[</span><span class="op" id="2369297">]</span><span class="builtintype" id="2369298">string</span>&nbsp;<span class="op" id="2369305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369308">envOnce</span><span class="op" id="2369315">.</span><span class="ident" id="2369316">Do</span><span class="op" id="2369318">(</span><span class="ident" id="2369319">copyenv</span><span class="op" id="2369326">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369329">envLock</span><span class="op" id="2369336">.</span><span class="ident" id="2369337">RLock</span><span class="op" id="2369342">(</span><span class="op" id="2369343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369346">defer</span>&nbsp;<span class="ident" id="2369352">envLock</span><span class="op" id="2369359">.</span><span class="ident" id="2369360">RUnlock</span><span class="op" id="2369367">(</span><span class="op" id="2369368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369371">a</span>&nbsp;<span class="op" id="2369373">:=</span>&nbsp;<span class="builtinfunc" id="2369376">make</span><span class="op" id="2369380">(</span><span class="op" id="2369381">[</span><span class="op" id="2369382">]</span><span class="builtintype" id="2369383">string</span><span class="op" id="2369389">,</span>&nbsp;<span class="num" id="2369391">0</span><span class="op" id="2369392">,</span>&nbsp;<span class="builtinfunc" id="2369394">len</span><span class="op" id="2369397">(</span><span class="ident" id="2369398">envs</span><span class="op" id="2369402">)</span><span class="op" id="2369403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369406">for</span>&nbsp;<span class="ident" id="2369410">_</span><span class="op" id="2369411">,</span>&nbsp;<span class="ident" id="2369413">env</span>&nbsp;<span class="op" id="2369417">:=</span>&nbsp;<span class="keyword" id="2369420">range</span>&nbsp;<span class="ident" id="2369426">envs</span>&nbsp;<span class="op" id="2369431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369435">if</span>&nbsp;<span class="ident" id="2369438">env</span>&nbsp;<span class="op" id="2369442">!=</span>&nbsp;<span class="string" id="2369445">&#34;&#34;</span>&nbsp;<span class="op" id="2369448">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2369453">a</span>&nbsp;<span class="op" id="2369455">=</span>&nbsp;<span class="builtinfunc" id="2369457">append</span><span class="op" id="2369463">(</span><span class="ident" id="2369464">a</span><span class="op" id="2369465">,</span>&nbsp;<span class="ident" id="2369467">env</span><span class="op" id="2369470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2369474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2369477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2369480">return</span>&nbsp;<span class="ident" id="2369487">a</span><br>
<span class="lineno"></span><span class="op" id="2369489">}</span>
</div>
</body>
</html>
