<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1484093">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1484148">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1484202">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1484253">package</span>&nbsp;<span class="ident" id="1484261">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1484270">import</span>&nbsp;<span class="op" id="1484277">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1484280">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1484289">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1484292">func</span>&nbsp;<span class="ident" id="1484297">mapaccess1_fast32</span><span class="op" id="1484314">(</span><span class="ident" id="1484315">t</span>&nbsp;<span class="op" id="1484317">*</span><span class="ident" id="1484318">maptype</span><span class="op" id="1484325">,</span>&nbsp;<span class="ident" id="1484327">h</span>&nbsp;<span class="op" id="1484329">*</span><span class="ident" id="1484330">hmap</span><span class="op" id="1484334">,</span>&nbsp;<span class="ident" id="1484336">key</span>&nbsp;<span class="builtintype" id="1484340">uint32</span><span class="op" id="1484346">)</span>&nbsp;<span class="ident" id="1484348">unsafe</span><span class="op" id="1484354">.</span><span class="ident" id="1484355">Pointer</span>&nbsp;<span class="op" id="1484363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484366">if</span>&nbsp;<span class="ident" id="1484369">raceenabled</span>&nbsp;<span class="op" id="1484381">&amp;&amp;</span>&nbsp;<span class="ident" id="1484384">h</span>&nbsp;<span class="op" id="1484386">!=</span>&nbsp;<span class="ident" id="1484389">nil</span>&nbsp;<span class="op" id="1484393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484397">callerpc</span>&nbsp;<span class="op" id="1484406">:=</span>&nbsp;<span class="ident" id="1484409">getcallerpc</span><span class="op" id="1484420">(</span><span class="ident" id="1484421">unsafe</span><span class="op" id="1484427">.</span><span class="ident" id="1484428">Pointer</span><span class="op" id="1484435">(</span><span class="op" id="1484436">&amp;</span><span class="ident" id="1484437">t</span><span class="op" id="1484438">)</span><span class="op" id="1484439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484443">racereadpc</span><span class="op" id="1484453">(</span><span class="ident" id="1484454">unsafe</span><span class="op" id="1484460">.</span><span class="ident" id="1484461">Pointer</span><span class="op" id="1484468">(</span><span class="ident" id="1484469">h</span><span class="op" id="1484470">)</span><span class="op" id="1484471">,</span>&nbsp;<span class="ident" id="1484473">callerpc</span><span class="op" id="1484481">,</span>&nbsp;<span class="ident" id="1484483">funcPC</span><span class="op" id="1484489">(</span><span class="ident" id="1484490">mapaccess1_fast32</span><span class="op" id="1484507">)</span><span class="op" id="1484508">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484514">if</span>&nbsp;<span class="ident" id="1484517">h</span>&nbsp;<span class="op" id="1484519">==</span>&nbsp;<span class="ident" id="1484522">nil</span>&nbsp;<span class="op" id="1484526">||</span>&nbsp;<span class="ident" id="1484529">h</span><span class="op" id="1484530">.</span><span class="ident" id="1484531">count</span>&nbsp;<span class="op" id="1484537">==</span>&nbsp;<span class="num" id="1484540">0</span>&nbsp;<span class="op" id="1484542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484546">return</span>&nbsp;<span class="ident" id="1484553">unsafe</span><span class="op" id="1484559">.</span><span class="ident" id="1484560">Pointer</span><span class="op" id="1484567">(</span><span class="ident" id="1484568">t</span><span class="op" id="1484569">.</span><span class="ident" id="1484570">elem</span><span class="op" id="1484574">.</span><span class="ident" id="1484575">zero</span><span class="op" id="1484579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484585">var</span>&nbsp;<span class="ident" id="1484589">b</span>&nbsp;<span class="op" id="1484591">*</span><span class="ident" id="1484592">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484598">if</span>&nbsp;<span class="ident" id="1484601">h</span><span class="op" id="1484602">.</span><span class="ident" id="1484603">B</span>&nbsp;<span class="op" id="1484605">==</span>&nbsp;<span class="num" id="1484608">0</span>&nbsp;<span class="op" id="1484610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1484614">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484655">b</span>&nbsp;<span class="op" id="1484657">=</span>&nbsp;<span class="op" id="1484659">(</span><span class="op" id="1484660">*</span><span class="ident" id="1484661">bmap</span><span class="op" id="1484665">)</span><span class="op" id="1484666">(</span><span class="ident" id="1484667">h</span><span class="op" id="1484668">.</span><span class="ident" id="1484669">buckets</span><span class="op" id="1484676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1484679">}</span>&nbsp;<span class="keyword" id="1484681">else</span>&nbsp;<span class="op" id="1484686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484690">hash</span>&nbsp;<span class="op" id="1484695">:=</span>&nbsp;<span class="ident" id="1484698">goalg</span><span class="op" id="1484703">(</span><span class="ident" id="1484704">t</span><span class="op" id="1484705">.</span><span class="ident" id="1484706">key</span><span class="op" id="1484709">.</span><span class="ident" id="1484710">alg</span><span class="op" id="1484713">)</span><span class="op" id="1484714">.</span><span class="ident" id="1484715">hash</span><span class="op" id="1484719">(</span><span class="ident" id="1484720">noescape</span><span class="op" id="1484728">(</span><span class="ident" id="1484729">unsafe</span><span class="op" id="1484735">.</span><span class="ident" id="1484736">Pointer</span><span class="op" id="1484743">(</span><span class="op" id="1484744">&amp;</span><span class="ident" id="1484745">key</span><span class="op" id="1484748">)</span><span class="op" id="1484749">)</span><span class="op" id="1484750">,</span>&nbsp;<span class="num" id="1484752">4</span><span class="op" id="1484753">,</span>&nbsp;<span class="builtintype" id="1484755">uintptr</span><span class="op" id="1484762">(</span><span class="ident" id="1484763">h</span><span class="op" id="1484764">.</span><span class="ident" id="1484765">hash0</span><span class="op" id="1484770">)</span><span class="op" id="1484771">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484775">m</span>&nbsp;<span class="op" id="1484777">:=</span>&nbsp;<span class="builtintype" id="1484780">uintptr</span><span class="op" id="1484787">(</span><span class="num" id="1484788">1</span><span class="op" id="1484789">)</span><span class="op" id="1484790">&lt;&lt;</span><span class="ident" id="1484792">h</span><span class="op" id="1484793">.</span><span class="ident" id="1484794">B</span>&nbsp;<span class="op" id="1484796">-</span>&nbsp;<span class="num" id="1484798">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484802">b</span>&nbsp;<span class="op" id="1484804">=</span>&nbsp;<span class="op" id="1484806">(</span><span class="op" id="1484807">*</span><span class="ident" id="1484808">bmap</span><span class="op" id="1484812">)</span><span class="op" id="1484813">(</span><span class="ident" id="1484814">add</span><span class="op" id="1484817">(</span><span class="ident" id="1484818">h</span><span class="op" id="1484819">.</span><span class="ident" id="1484820">buckets</span><span class="op" id="1484827">,</span>&nbsp;<span class="op" id="1484829">(</span><span class="ident" id="1484830">hash</span><span class="op" id="1484834">&amp;</span><span class="ident" id="1484835">m</span><span class="op" id="1484836">)</span><span class="op" id="1484837">*</span><span class="builtintype" id="1484838">uintptr</span><span class="op" id="1484845">(</span><span class="ident" id="1484846">t</span><span class="op" id="1484847">.</span><span class="ident" id="1484848">bucketsize</span><span class="op" id="1484858">)</span><span class="op" id="1484859">)</span><span class="op" id="1484860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484864">if</span>&nbsp;<span class="ident" id="1484867">c</span>&nbsp;<span class="op" id="1484869">:=</span>&nbsp;<span class="ident" id="1484872">h</span><span class="op" id="1484873">.</span><span class="ident" id="1484874">oldbuckets</span><span class="op" id="1484884">;</span>&nbsp;<span class="ident" id="1484886">c</span>&nbsp;<span class="op" id="1484888">!=</span>&nbsp;<span class="ident" id="1484891">nil</span>&nbsp;<span class="op" id="1484895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484900">oldb</span>&nbsp;<span class="op" id="1484905">:=</span>&nbsp;<span class="op" id="1484908">(</span><span class="op" id="1484909">*</span><span class="ident" id="1484910">bmap</span><span class="op" id="1484914">)</span><span class="op" id="1484915">(</span><span class="ident" id="1484916">add</span><span class="op" id="1484919">(</span><span class="ident" id="1484920">c</span><span class="op" id="1484921">,</span>&nbsp;<span class="op" id="1484923">(</span><span class="ident" id="1484924">hash</span><span class="op" id="1484928">&amp;</span><span class="op" id="1484929">(</span><span class="ident" id="1484930">m</span><span class="op" id="1484931">&gt;&gt;</span><span class="num" id="1484933">1</span><span class="op" id="1484934">)</span><span class="op" id="1484935">)</span><span class="op" id="1484936">*</span><span class="builtintype" id="1484937">uintptr</span><span class="op" id="1484944">(</span><span class="ident" id="1484945">t</span><span class="op" id="1484946">.</span><span class="ident" id="1484947">bucketsize</span><span class="op" id="1484957">)</span><span class="op" id="1484958">)</span><span class="op" id="1484959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1484964">if</span>&nbsp;<span class="op" id="1484967">!</span><span class="ident" id="1484968">evacuated</span><span class="op" id="1484977">(</span><span class="ident" id="1484978">oldb</span><span class="op" id="1484982">)</span>&nbsp;<span class="op" id="1484984">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1484990">b</span>&nbsp;<span class="op" id="1484992">=</span>&nbsp;<span class="ident" id="1484994">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485012">for</span>&nbsp;<span class="op" id="1485016">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485020">for</span>&nbsp;<span class="ident" id="1485024">i</span>&nbsp;<span class="op" id="1485026">:=</span>&nbsp;<span class="builtintype" id="1485029">uintptr</span><span class="op" id="1485036">(</span><span class="num" id="1485037">0</span><span class="op" id="1485038">)</span><span class="op" id="1485039">;</span>&nbsp;<span class="ident" id="1485041">i</span>&nbsp;<span class="op" id="1485043">&lt;</span>&nbsp;<span class="ident" id="1485045">bucketCnt</span><span class="op" id="1485054">;</span>&nbsp;<span class="ident" id="1485056">i</span><span class="op" id="1485057">++</span>&nbsp;<span class="op" id="1485060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485065">k</span>&nbsp;<span class="op" id="1485067">:=</span>&nbsp;<span class="op" id="1485070">*</span><span class="op" id="1485071">(</span><span class="op" id="1485072">(</span><span class="op" id="1485073">*</span><span class="builtintype" id="1485074">uint32</span><span class="op" id="1485080">)</span><span class="op" id="1485081">(</span><span class="ident" id="1485082">add</span><span class="op" id="1485085">(</span><span class="ident" id="1485086">unsafe</span><span class="op" id="1485092">.</span><span class="ident" id="1485093">Pointer</span><span class="op" id="1485100">(</span><span class="ident" id="1485101">b</span><span class="op" id="1485102">)</span><span class="op" id="1485103">,</span>&nbsp;<span class="ident" id="1485105">dataOffset</span><span class="op" id="1485115">+</span><span class="ident" id="1485116">i</span><span class="op" id="1485117">*</span><span class="num" id="1485118">4</span><span class="op" id="1485119">)</span><span class="op" id="1485120">)</span><span class="op" id="1485121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485126">if</span>&nbsp;<span class="ident" id="1485129">k</span>&nbsp;<span class="op" id="1485131">!=</span>&nbsp;<span class="ident" id="1485134">key</span>&nbsp;<span class="op" id="1485138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485144">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485156">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485161">x</span>&nbsp;<span class="op" id="1485163">:=</span>&nbsp;<span class="op" id="1485166">*</span><span class="op" id="1485167">(</span><span class="op" id="1485168">(</span><span class="op" id="1485169">*</span><span class="builtintype" id="1485170">uint8</span><span class="op" id="1485175">)</span><span class="op" id="1485176">(</span><span class="ident" id="1485177">add</span><span class="op" id="1485180">(</span><span class="ident" id="1485181">unsafe</span><span class="op" id="1485187">.</span><span class="ident" id="1485188">Pointer</span><span class="op" id="1485195">(</span><span class="ident" id="1485196">b</span><span class="op" id="1485197">)</span><span class="op" id="1485198">,</span>&nbsp;<span class="ident" id="1485200">i</span><span class="op" id="1485201">)</span><span class="op" id="1485202">)</span><span class="op" id="1485203">)</span>&nbsp;<span class="comment" id="1485205">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485249">if</span>&nbsp;<span class="ident" id="1485252">x</span>&nbsp;<span class="op" id="1485254">==</span>&nbsp;<span class="ident" id="1485257">empty</span>&nbsp;<span class="op" id="1485263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485269">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485286">return</span>&nbsp;<span class="ident" id="1485293">add</span><span class="op" id="1485296">(</span><span class="ident" id="1485297">unsafe</span><span class="op" id="1485303">.</span><span class="ident" id="1485304">Pointer</span><span class="op" id="1485311">(</span><span class="ident" id="1485312">b</span><span class="op" id="1485313">)</span><span class="op" id="1485314">,</span>&nbsp;<span class="ident" id="1485316">dataOffset</span><span class="op" id="1485326">+</span><span class="ident" id="1485327">bucketCnt</span><span class="op" id="1485336">*</span><span class="num" id="1485337">4</span><span class="op" id="1485338">+</span><span class="ident" id="1485339">i</span><span class="op" id="1485340">*</span><span class="builtintype" id="1485341">uintptr</span><span class="op" id="1485348">(</span><span class="ident" id="1485349">t</span><span class="op" id="1485350">.</span><span class="ident" id="1485351">valuesize</span><span class="op" id="1485360">)</span><span class="op" id="1485361">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485369">b</span>&nbsp;<span class="op" id="1485371">=</span>&nbsp;<span class="ident" id="1485373">b</span><span class="op" id="1485374">.</span><span class="ident" id="1485375">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485386">if</span>&nbsp;<span class="ident" id="1485389">b</span>&nbsp;<span class="op" id="1485391">==</span>&nbsp;<span class="ident" id="1485394">nil</span>&nbsp;<span class="op" id="1485398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485403">return</span>&nbsp;<span class="ident" id="1485410">unsafe</span><span class="op" id="1485416">.</span><span class="ident" id="1485417">Pointer</span><span class="op" id="1485424">(</span><span class="ident" id="1485425">t</span><span class="op" id="1485426">.</span><span class="ident" id="1485427">elem</span><span class="op" id="1485431">.</span><span class="ident" id="1485432">zero</span><span class="op" id="1485436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485440">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485443">}</span><br>
<span class="lineno"></span><span class="op" id="1485445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1485448">func</span>&nbsp;<span class="ident" id="1485453">mapaccess2_fast32</span><span class="op" id="1485470">(</span><span class="ident" id="1485471">t</span>&nbsp;<span class="op" id="1485473">*</span><span class="ident" id="1485474">maptype</span><span class="op" id="1485481">,</span>&nbsp;<span class="ident" id="1485483">h</span>&nbsp;<span class="op" id="1485485">*</span><span class="ident" id="1485486">hmap</span><span class="op" id="1485490">,</span>&nbsp;<span class="ident" id="1485492">key</span>&nbsp;<span class="builtintype" id="1485496">uint32</span><span class="op" id="1485502">)</span>&nbsp;<span class="op" id="1485504">(</span><span class="ident" id="1485505">unsafe</span><span class="op" id="1485511">.</span><span class="ident" id="1485512">Pointer</span><span class="op" id="1485519">,</span>&nbsp;<span class="builtintype" id="1485521">bool</span><span class="op" id="1485525">)</span>&nbsp;<span class="op" id="1485527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485530">if</span>&nbsp;<span class="ident" id="1485533">raceenabled</span>&nbsp;<span class="op" id="1485545">&amp;&amp;</span>&nbsp;<span class="ident" id="1485548">h</span>&nbsp;<span class="op" id="1485550">!=</span>&nbsp;<span class="ident" id="1485553">nil</span>&nbsp;<span class="op" id="1485557">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485561">callerpc</span>&nbsp;<span class="op" id="1485570">:=</span>&nbsp;<span class="ident" id="1485573">getcallerpc</span><span class="op" id="1485584">(</span><span class="ident" id="1485585">unsafe</span><span class="op" id="1485591">.</span><span class="ident" id="1485592">Pointer</span><span class="op" id="1485599">(</span><span class="op" id="1485600">&amp;</span><span class="ident" id="1485601">t</span><span class="op" id="1485602">)</span><span class="op" id="1485603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485607">racereadpc</span><span class="op" id="1485617">(</span><span class="ident" id="1485618">unsafe</span><span class="op" id="1485624">.</span><span class="ident" id="1485625">Pointer</span><span class="op" id="1485632">(</span><span class="ident" id="1485633">h</span><span class="op" id="1485634">)</span><span class="op" id="1485635">,</span>&nbsp;<span class="ident" id="1485637">callerpc</span><span class="op" id="1485645">,</span>&nbsp;<span class="ident" id="1485647">funcPC</span><span class="op" id="1485653">(</span><span class="ident" id="1485654">mapaccess2_fast32</span><span class="op" id="1485671">)</span><span class="op" id="1485672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485678">if</span>&nbsp;<span class="ident" id="1485681">h</span>&nbsp;<span class="op" id="1485683">==</span>&nbsp;<span class="ident" id="1485686">nil</span>&nbsp;<span class="op" id="1485690">||</span>&nbsp;<span class="ident" id="1485693">h</span><span class="op" id="1485694">.</span><span class="ident" id="1485695">count</span>&nbsp;<span class="op" id="1485701">==</span>&nbsp;<span class="num" id="1485704">0</span>&nbsp;<span class="op" id="1485706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485710">return</span>&nbsp;<span class="ident" id="1485717">unsafe</span><span class="op" id="1485723">.</span><span class="ident" id="1485724">Pointer</span><span class="op" id="1485731">(</span><span class="ident" id="1485732">t</span><span class="op" id="1485733">.</span><span class="ident" id="1485734">elem</span><span class="op" id="1485738">.</span><span class="ident" id="1485739">zero</span><span class="op" id="1485743">)</span><span class="op" id="1485744">,</span>&nbsp;<span class="builtintype" id="1485746">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485756">var</span>&nbsp;<span class="ident" id="1485760">b</span>&nbsp;<span class="op" id="1485762">*</span><span class="ident" id="1485763">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1485769">if</span>&nbsp;<span class="ident" id="1485772">h</span><span class="op" id="1485773">.</span><span class="ident" id="1485774">B</span>&nbsp;<span class="op" id="1485776">==</span>&nbsp;<span class="num" id="1485779">0</span>&nbsp;<span class="op" id="1485781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1485785">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485826">b</span>&nbsp;<span class="op" id="1485828">=</span>&nbsp;<span class="op" id="1485830">(</span><span class="op" id="1485831">*</span><span class="ident" id="1485832">bmap</span><span class="op" id="1485836">)</span><span class="op" id="1485837">(</span><span class="ident" id="1485838">h</span><span class="op" id="1485839">.</span><span class="ident" id="1485840">buckets</span><span class="op" id="1485847">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1485850">}</span>&nbsp;<span class="keyword" id="1485852">else</span>&nbsp;<span class="op" id="1485857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485861">hash</span>&nbsp;<span class="op" id="1485866">:=</span>&nbsp;<span class="ident" id="1485869">goalg</span><span class="op" id="1485874">(</span><span class="ident" id="1485875">t</span><span class="op" id="1485876">.</span><span class="ident" id="1485877">key</span><span class="op" id="1485880">.</span><span class="ident" id="1485881">alg</span><span class="op" id="1485884">)</span><span class="op" id="1485885">.</span><span class="ident" id="1485886">hash</span><span class="op" id="1485890">(</span><span class="ident" id="1485891">noescape</span><span class="op" id="1485899">(</span><span class="ident" id="1485900">unsafe</span><span class="op" id="1485906">.</span><span class="ident" id="1485907">Pointer</span><span class="op" id="1485914">(</span><span class="op" id="1485915">&amp;</span><span class="ident" id="1485916">key</span><span class="op" id="1485919">)</span><span class="op" id="1485920">)</span><span class="op" id="1485921">,</span>&nbsp;<span class="num" id="1485923">4</span><span class="op" id="1485924">,</span>&nbsp;<span class="builtintype" id="1485926">uintptr</span><span class="op" id="1485933">(</span><span class="ident" id="1485934">h</span><span class="op" id="1485935">.</span><span class="ident" id="1485936">hash0</span><span class="op" id="1485941">)</span><span class="op" id="1485942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485946">m</span>&nbsp;<span class="op" id="1485948">:=</span>&nbsp;<span class="builtintype" id="1485951">uintptr</span><span class="op" id="1485958">(</span><span class="num" id="1485959">1</span><span class="op" id="1485960">)</span><span class="op" id="1485961">&lt;&lt;</span><span class="ident" id="1485963">h</span><span class="op" id="1485964">.</span><span class="ident" id="1485965">B</span>&nbsp;<span class="op" id="1485967">-</span>&nbsp;<span class="num" id="1485969">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1485973">b</span>&nbsp;<span class="op" id="1485975">=</span>&nbsp;<span class="op" id="1485977">(</span><span class="op" id="1485978">*</span><span class="ident" id="1485979">bmap</span><span class="op" id="1485983">)</span><span class="op" id="1485984">(</span><span class="ident" id="1485985">add</span><span class="op" id="1485988">(</span><span class="ident" id="1485989">h</span><span class="op" id="1485990">.</span><span class="ident" id="1485991">buckets</span><span class="op" id="1485998">,</span>&nbsp;<span class="op" id="1486000">(</span><span class="ident" id="1486001">hash</span><span class="op" id="1486005">&amp;</span><span class="ident" id="1486006">m</span><span class="op" id="1486007">)</span><span class="op" id="1486008">*</span><span class="builtintype" id="1486009">uintptr</span><span class="op" id="1486016">(</span><span class="ident" id="1486017">t</span><span class="op" id="1486018">.</span><span class="ident" id="1486019">bucketsize</span><span class="op" id="1486029">)</span><span class="op" id="1486030">)</span><span class="op" id="1486031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486035">if</span>&nbsp;<span class="ident" id="1486038">c</span>&nbsp;<span class="op" id="1486040">:=</span>&nbsp;<span class="ident" id="1486043">h</span><span class="op" id="1486044">.</span><span class="ident" id="1486045">oldbuckets</span><span class="op" id="1486055">;</span>&nbsp;<span class="ident" id="1486057">c</span>&nbsp;<span class="op" id="1486059">!=</span>&nbsp;<span class="ident" id="1486062">nil</span>&nbsp;<span class="op" id="1486066">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486071">oldb</span>&nbsp;<span class="op" id="1486076">:=</span>&nbsp;<span class="op" id="1486079">(</span><span class="op" id="1486080">*</span><span class="ident" id="1486081">bmap</span><span class="op" id="1486085">)</span><span class="op" id="1486086">(</span><span class="ident" id="1486087">add</span><span class="op" id="1486090">(</span><span class="ident" id="1486091">c</span><span class="op" id="1486092">,</span>&nbsp;<span class="op" id="1486094">(</span><span class="ident" id="1486095">hash</span><span class="op" id="1486099">&amp;</span><span class="op" id="1486100">(</span><span class="ident" id="1486101">m</span><span class="op" id="1486102">&gt;&gt;</span><span class="num" id="1486104">1</span><span class="op" id="1486105">)</span><span class="op" id="1486106">)</span><span class="op" id="1486107">*</span><span class="builtintype" id="1486108">uintptr</span><span class="op" id="1486115">(</span><span class="ident" id="1486116">t</span><span class="op" id="1486117">.</span><span class="ident" id="1486118">bucketsize</span><span class="op" id="1486128">)</span><span class="op" id="1486129">)</span><span class="op" id="1486130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486135">if</span>&nbsp;<span class="op" id="1486138">!</span><span class="ident" id="1486139">evacuated</span><span class="op" id="1486148">(</span><span class="ident" id="1486149">oldb</span><span class="op" id="1486153">)</span>&nbsp;<span class="op" id="1486155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486161">b</span>&nbsp;<span class="op" id="1486163">=</span>&nbsp;<span class="ident" id="1486165">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486177">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486183">for</span>&nbsp;<span class="op" id="1486187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486191">for</span>&nbsp;<span class="ident" id="1486195">i</span>&nbsp;<span class="op" id="1486197">:=</span>&nbsp;<span class="builtintype" id="1486200">uintptr</span><span class="op" id="1486207">(</span><span class="num" id="1486208">0</span><span class="op" id="1486209">)</span><span class="op" id="1486210">;</span>&nbsp;<span class="ident" id="1486212">i</span>&nbsp;<span class="op" id="1486214">&lt;</span>&nbsp;<span class="ident" id="1486216">bucketCnt</span><span class="op" id="1486225">;</span>&nbsp;<span class="ident" id="1486227">i</span><span class="op" id="1486228">++</span>&nbsp;<span class="op" id="1486231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486236">k</span>&nbsp;<span class="op" id="1486238">:=</span>&nbsp;<span class="op" id="1486241">*</span><span class="op" id="1486242">(</span><span class="op" id="1486243">(</span><span class="op" id="1486244">*</span><span class="builtintype" id="1486245">uint32</span><span class="op" id="1486251">)</span><span class="op" id="1486252">(</span><span class="ident" id="1486253">add</span><span class="op" id="1486256">(</span><span class="ident" id="1486257">unsafe</span><span class="op" id="1486263">.</span><span class="ident" id="1486264">Pointer</span><span class="op" id="1486271">(</span><span class="ident" id="1486272">b</span><span class="op" id="1486273">)</span><span class="op" id="1486274">,</span>&nbsp;<span class="ident" id="1486276">dataOffset</span><span class="op" id="1486286">+</span><span class="ident" id="1486287">i</span><span class="op" id="1486288">*</span><span class="num" id="1486289">4</span><span class="op" id="1486290">)</span><span class="op" id="1486291">)</span><span class="op" id="1486292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486297">if</span>&nbsp;<span class="ident" id="1486300">k</span>&nbsp;<span class="op" id="1486302">!=</span>&nbsp;<span class="ident" id="1486305">key</span>&nbsp;<span class="op" id="1486309">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486315">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486332">x</span>&nbsp;<span class="op" id="1486334">:=</span>&nbsp;<span class="op" id="1486337">*</span><span class="op" id="1486338">(</span><span class="op" id="1486339">(</span><span class="op" id="1486340">*</span><span class="builtintype" id="1486341">uint8</span><span class="op" id="1486346">)</span><span class="op" id="1486347">(</span><span class="ident" id="1486348">add</span><span class="op" id="1486351">(</span><span class="ident" id="1486352">unsafe</span><span class="op" id="1486358">.</span><span class="ident" id="1486359">Pointer</span><span class="op" id="1486366">(</span><span class="ident" id="1486367">b</span><span class="op" id="1486368">)</span><span class="op" id="1486369">,</span>&nbsp;<span class="ident" id="1486371">i</span><span class="op" id="1486372">)</span><span class="op" id="1486373">)</span><span class="op" id="1486374">)</span>&nbsp;<span class="comment" id="1486376">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486420">if</span>&nbsp;<span class="ident" id="1486423">x</span>&nbsp;<span class="op" id="1486425">==</span>&nbsp;<span class="ident" id="1486428">empty</span>&nbsp;<span class="op" id="1486434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486440">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486457">return</span>&nbsp;<span class="ident" id="1486464">add</span><span class="op" id="1486467">(</span><span class="ident" id="1486468">unsafe</span><span class="op" id="1486474">.</span><span class="ident" id="1486475">Pointer</span><span class="op" id="1486482">(</span><span class="ident" id="1486483">b</span><span class="op" id="1486484">)</span><span class="op" id="1486485">,</span>&nbsp;<span class="ident" id="1486487">dataOffset</span><span class="op" id="1486497">+</span><span class="ident" id="1486498">bucketCnt</span><span class="op" id="1486507">*</span><span class="num" id="1486508">4</span><span class="op" id="1486509">+</span><span class="ident" id="1486510">i</span><span class="op" id="1486511">*</span><span class="builtintype" id="1486512">uintptr</span><span class="op" id="1486519">(</span><span class="ident" id="1486520">t</span><span class="op" id="1486521">.</span><span class="ident" id="1486522">valuesize</span><span class="op" id="1486531">)</span><span class="op" id="1486532">)</span><span class="op" id="1486533">,</span>&nbsp;<span class="builtintype" id="1486535">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486546">b</span>&nbsp;<span class="op" id="1486548">=</span>&nbsp;<span class="ident" id="1486550">b</span><span class="op" id="1486551">.</span><span class="ident" id="1486552">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486563">if</span>&nbsp;<span class="ident" id="1486566">b</span>&nbsp;<span class="op" id="1486568">==</span>&nbsp;<span class="ident" id="1486571">nil</span>&nbsp;<span class="op" id="1486575">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486580">return</span>&nbsp;<span class="ident" id="1486587">unsafe</span><span class="op" id="1486593">.</span><span class="ident" id="1486594">Pointer</span><span class="op" id="1486601">(</span><span class="ident" id="1486602">t</span><span class="op" id="1486603">.</span><span class="ident" id="1486604">elem</span><span class="op" id="1486608">.</span><span class="ident" id="1486609">zero</span><span class="op" id="1486613">)</span><span class="op" id="1486614">,</span>&nbsp;<span class="builtintype" id="1486616">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486627">}</span><br>
<span class="lineno"></span><span class="op" id="1486629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1486632">func</span>&nbsp;<span class="ident" id="1486637">mapaccess1_fast64</span><span class="op" id="1486654">(</span><span class="ident" id="1486655">t</span>&nbsp;<span class="op" id="1486657">*</span><span class="ident" id="1486658">maptype</span><span class="op" id="1486665">,</span>&nbsp;<span class="ident" id="1486667">h</span>&nbsp;<span class="op" id="1486669">*</span><span class="ident" id="1486670">hmap</span><span class="op" id="1486674">,</span>&nbsp;<span class="ident" id="1486676">key</span>&nbsp;<span class="ident" id="1486680">uint64</span><span class="op" id="1486686">)</span>&nbsp;<span class="ident" id="1486688">unsafe</span><span class="op" id="1486694">.</span><span class="ident" id="1486695">Pointer</span>&nbsp;<span class="op" id="1486703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486706">if</span>&nbsp;<span class="ident" id="1486709">raceenabled</span>&nbsp;<span class="op" id="1486721">&amp;&amp;</span>&nbsp;<span class="ident" id="1486724">h</span>&nbsp;<span class="op" id="1486726">!=</span>&nbsp;<span class="ident" id="1486729">nil</span>&nbsp;<span class="op" id="1486733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486737">callerpc</span>&nbsp;<span class="op" id="1486746">:=</span>&nbsp;<span class="ident" id="1486749">getcallerpc</span><span class="op" id="1486760">(</span><span class="ident" id="1486761">unsafe</span><span class="op" id="1486767">.</span><span class="ident" id="1486768">Pointer</span><span class="op" id="1486775">(</span><span class="op" id="1486776">&amp;</span><span class="ident" id="1486777">t</span><span class="op" id="1486778">)</span><span class="op" id="1486779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486783">racereadpc</span><span class="op" id="1486793">(</span><span class="ident" id="1486794">unsafe</span><span class="op" id="1486800">.</span><span class="ident" id="1486801">Pointer</span><span class="op" id="1486808">(</span><span class="ident" id="1486809">h</span><span class="op" id="1486810">)</span><span class="op" id="1486811">,</span>&nbsp;<span class="ident" id="1486813">callerpc</span><span class="op" id="1486821">,</span>&nbsp;<span class="ident" id="1486823">funcPC</span><span class="op" id="1486829">(</span><span class="ident" id="1486830">mapaccess1_fast64</span><span class="op" id="1486847">)</span><span class="op" id="1486848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486851">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486854">if</span>&nbsp;<span class="ident" id="1486857">h</span>&nbsp;<span class="op" id="1486859">==</span>&nbsp;<span class="ident" id="1486862">nil</span>&nbsp;<span class="op" id="1486866">||</span>&nbsp;<span class="ident" id="1486869">h</span><span class="op" id="1486870">.</span><span class="ident" id="1486871">count</span>&nbsp;<span class="op" id="1486877">==</span>&nbsp;<span class="num" id="1486880">0</span>&nbsp;<span class="op" id="1486882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486886">return</span>&nbsp;<span class="ident" id="1486893">unsafe</span><span class="op" id="1486899">.</span><span class="ident" id="1486900">Pointer</span><span class="op" id="1486907">(</span><span class="ident" id="1486908">t</span><span class="op" id="1486909">.</span><span class="ident" id="1486910">elem</span><span class="op" id="1486914">.</span><span class="ident" id="1486915">zero</span><span class="op" id="1486919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1486922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486925">var</span>&nbsp;<span class="ident" id="1486929">b</span>&nbsp;<span class="op" id="1486931">*</span><span class="ident" id="1486932">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1486938">if</span>&nbsp;<span class="ident" id="1486941">h</span><span class="op" id="1486942">.</span><span class="ident" id="1486943">B</span>&nbsp;<span class="op" id="1486945">==</span>&nbsp;<span class="num" id="1486948">0</span>&nbsp;<span class="op" id="1486950">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1486954">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1486995">b</span>&nbsp;<span class="op" id="1486997">=</span>&nbsp;<span class="op" id="1486999">(</span><span class="op" id="1487000">*</span><span class="ident" id="1487001">bmap</span><span class="op" id="1487005">)</span><span class="op" id="1487006">(</span><span class="ident" id="1487007">h</span><span class="op" id="1487008">.</span><span class="ident" id="1487009">buckets</span><span class="op" id="1487016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487019">}</span>&nbsp;<span class="keyword" id="1487021">else</span>&nbsp;<span class="op" id="1487026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487030">hash</span>&nbsp;<span class="op" id="1487035">:=</span>&nbsp;<span class="ident" id="1487038">goalg</span><span class="op" id="1487043">(</span><span class="ident" id="1487044">t</span><span class="op" id="1487045">.</span><span class="ident" id="1487046">key</span><span class="op" id="1487049">.</span><span class="ident" id="1487050">alg</span><span class="op" id="1487053">)</span><span class="op" id="1487054">.</span><span class="ident" id="1487055">hash</span><span class="op" id="1487059">(</span><span class="ident" id="1487060">noescape</span><span class="op" id="1487068">(</span><span class="ident" id="1487069">unsafe</span><span class="op" id="1487075">.</span><span class="ident" id="1487076">Pointer</span><span class="op" id="1487083">(</span><span class="op" id="1487084">&amp;</span><span class="ident" id="1487085">key</span><span class="op" id="1487088">)</span><span class="op" id="1487089">)</span><span class="op" id="1487090">,</span>&nbsp;<span class="num" id="1487092">8</span><span class="op" id="1487093">,</span>&nbsp;<span class="builtintype" id="1487095">uintptr</span><span class="op" id="1487102">(</span><span class="ident" id="1487103">h</span><span class="op" id="1487104">.</span><span class="ident" id="1487105">hash0</span><span class="op" id="1487110">)</span><span class="op" id="1487111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487115">m</span>&nbsp;<span class="op" id="1487117">:=</span>&nbsp;<span class="builtintype" id="1487120">uintptr</span><span class="op" id="1487127">(</span><span class="num" id="1487128">1</span><span class="op" id="1487129">)</span><span class="op" id="1487130">&lt;&lt;</span><span class="ident" id="1487132">h</span><span class="op" id="1487133">.</span><span class="ident" id="1487134">B</span>&nbsp;<span class="op" id="1487136">-</span>&nbsp;<span class="num" id="1487138">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487142">b</span>&nbsp;<span class="op" id="1487144">=</span>&nbsp;<span class="op" id="1487146">(</span><span class="op" id="1487147">*</span><span class="ident" id="1487148">bmap</span><span class="op" id="1487152">)</span><span class="op" id="1487153">(</span><span class="ident" id="1487154">add</span><span class="op" id="1487157">(</span><span class="ident" id="1487158">h</span><span class="op" id="1487159">.</span><span class="ident" id="1487160">buckets</span><span class="op" id="1487167">,</span>&nbsp;<span class="op" id="1487169">(</span><span class="ident" id="1487170">hash</span><span class="op" id="1487174">&amp;</span><span class="ident" id="1487175">m</span><span class="op" id="1487176">)</span><span class="op" id="1487177">*</span><span class="builtintype" id="1487178">uintptr</span><span class="op" id="1487185">(</span><span class="ident" id="1487186">t</span><span class="op" id="1487187">.</span><span class="ident" id="1487188">bucketsize</span><span class="op" id="1487198">)</span><span class="op" id="1487199">)</span><span class="op" id="1487200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487204">if</span>&nbsp;<span class="ident" id="1487207">c</span>&nbsp;<span class="op" id="1487209">:=</span>&nbsp;<span class="ident" id="1487212">h</span><span class="op" id="1487213">.</span><span class="ident" id="1487214">oldbuckets</span><span class="op" id="1487224">;</span>&nbsp;<span class="ident" id="1487226">c</span>&nbsp;<span class="op" id="1487228">!=</span>&nbsp;<span class="ident" id="1487231">nil</span>&nbsp;<span class="op" id="1487235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487240">oldb</span>&nbsp;<span class="op" id="1487245">:=</span>&nbsp;<span class="op" id="1487248">(</span><span class="op" id="1487249">*</span><span class="ident" id="1487250">bmap</span><span class="op" id="1487254">)</span><span class="op" id="1487255">(</span><span class="ident" id="1487256">add</span><span class="op" id="1487259">(</span><span class="ident" id="1487260">c</span><span class="op" id="1487261">,</span>&nbsp;<span class="op" id="1487263">(</span><span class="ident" id="1487264">hash</span><span class="op" id="1487268">&amp;</span><span class="op" id="1487269">(</span><span class="ident" id="1487270">m</span><span class="op" id="1487271">&gt;&gt;</span><span class="num" id="1487273">1</span><span class="op" id="1487274">)</span><span class="op" id="1487275">)</span><span class="op" id="1487276">*</span><span class="builtintype" id="1487277">uintptr</span><span class="op" id="1487284">(</span><span class="ident" id="1487285">t</span><span class="op" id="1487286">.</span><span class="ident" id="1487287">bucketsize</span><span class="op" id="1487297">)</span><span class="op" id="1487298">)</span><span class="op" id="1487299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487304">if</span>&nbsp;<span class="op" id="1487307">!</span><span class="ident" id="1487308">evacuated</span><span class="op" id="1487317">(</span><span class="ident" id="1487318">oldb</span><span class="op" id="1487322">)</span>&nbsp;<span class="op" id="1487324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487330">b</span>&nbsp;<span class="op" id="1487332">=</span>&nbsp;<span class="ident" id="1487334">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487352">for</span>&nbsp;<span class="op" id="1487356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487360">for</span>&nbsp;<span class="ident" id="1487364">i</span>&nbsp;<span class="op" id="1487366">:=</span>&nbsp;<span class="builtintype" id="1487369">uintptr</span><span class="op" id="1487376">(</span><span class="num" id="1487377">0</span><span class="op" id="1487378">)</span><span class="op" id="1487379">;</span>&nbsp;<span class="ident" id="1487381">i</span>&nbsp;<span class="op" id="1487383">&lt;</span>&nbsp;<span class="ident" id="1487385">bucketCnt</span><span class="op" id="1487394">;</span>&nbsp;<span class="ident" id="1487396">i</span><span class="op" id="1487397">++</span>&nbsp;<span class="op" id="1487400">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487405">k</span>&nbsp;<span class="op" id="1487407">:=</span>&nbsp;<span class="op" id="1487410">*</span><span class="op" id="1487411">(</span><span class="op" id="1487412">(</span><span class="op" id="1487413">*</span><span class="ident" id="1487414">uint64</span><span class="op" id="1487420">)</span><span class="op" id="1487421">(</span><span class="ident" id="1487422">add</span><span class="op" id="1487425">(</span><span class="ident" id="1487426">unsafe</span><span class="op" id="1487432">.</span><span class="ident" id="1487433">Pointer</span><span class="op" id="1487440">(</span><span class="ident" id="1487441">b</span><span class="op" id="1487442">)</span><span class="op" id="1487443">,</span>&nbsp;<span class="ident" id="1487445">dataOffset</span><span class="op" id="1487455">+</span><span class="ident" id="1487456">i</span><span class="op" id="1487457">*</span><span class="num" id="1487458">8</span><span class="op" id="1487459">)</span><span class="op" id="1487460">)</span><span class="op" id="1487461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487466">if</span>&nbsp;<span class="ident" id="1487469">k</span>&nbsp;<span class="op" id="1487471">!=</span>&nbsp;<span class="ident" id="1487474">key</span>&nbsp;<span class="op" id="1487478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487484">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487501">x</span>&nbsp;<span class="op" id="1487503">:=</span>&nbsp;<span class="op" id="1487506">*</span><span class="op" id="1487507">(</span><span class="op" id="1487508">(</span><span class="op" id="1487509">*</span><span class="builtintype" id="1487510">uint8</span><span class="op" id="1487515">)</span><span class="op" id="1487516">(</span><span class="ident" id="1487517">add</span><span class="op" id="1487520">(</span><span class="ident" id="1487521">unsafe</span><span class="op" id="1487527">.</span><span class="ident" id="1487528">Pointer</span><span class="op" id="1487535">(</span><span class="ident" id="1487536">b</span><span class="op" id="1487537">)</span><span class="op" id="1487538">,</span>&nbsp;<span class="ident" id="1487540">i</span><span class="op" id="1487541">)</span><span class="op" id="1487542">)</span><span class="op" id="1487543">)</span>&nbsp;<span class="comment" id="1487545">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487589">if</span>&nbsp;<span class="ident" id="1487592">x</span>&nbsp;<span class="op" id="1487594">==</span>&nbsp;<span class="ident" id="1487597">empty</span>&nbsp;<span class="op" id="1487603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487609">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487626">return</span>&nbsp;<span class="ident" id="1487633">add</span><span class="op" id="1487636">(</span><span class="ident" id="1487637">unsafe</span><span class="op" id="1487643">.</span><span class="ident" id="1487644">Pointer</span><span class="op" id="1487651">(</span><span class="ident" id="1487652">b</span><span class="op" id="1487653">)</span><span class="op" id="1487654">,</span>&nbsp;<span class="ident" id="1487656">dataOffset</span><span class="op" id="1487666">+</span><span class="ident" id="1487667">bucketCnt</span><span class="op" id="1487676">*</span><span class="num" id="1487677">8</span><span class="op" id="1487678">+</span><span class="ident" id="1487679">i</span><span class="op" id="1487680">*</span><span class="builtintype" id="1487681">uintptr</span><span class="op" id="1487688">(</span><span class="ident" id="1487689">t</span><span class="op" id="1487690">.</span><span class="ident" id="1487691">valuesize</span><span class="op" id="1487700">)</span><span class="op" id="1487701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487705">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487709">b</span>&nbsp;<span class="op" id="1487711">=</span>&nbsp;<span class="ident" id="1487713">b</span><span class="op" id="1487714">.</span><span class="ident" id="1487715">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487726">if</span>&nbsp;<span class="ident" id="1487729">b</span>&nbsp;<span class="op" id="1487731">==</span>&nbsp;<span class="ident" id="1487734">nil</span>&nbsp;<span class="op" id="1487738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487743">return</span>&nbsp;<span class="ident" id="1487750">unsafe</span><span class="op" id="1487756">.</span><span class="ident" id="1487757">Pointer</span><span class="op" id="1487764">(</span><span class="ident" id="1487765">t</span><span class="op" id="1487766">.</span><span class="ident" id="1487767">elem</span><span class="op" id="1487771">.</span><span class="ident" id="1487772">zero</span><span class="op" id="1487776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1487783">}</span><br>
<span class="lineno">135</span><span class="op" id="1487785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1487788">func</span>&nbsp;<span class="ident" id="1487793">mapaccess2_fast64</span><span class="op" id="1487810">(</span><span class="ident" id="1487811">t</span>&nbsp;<span class="op" id="1487813">*</span><span class="ident" id="1487814">maptype</span><span class="op" id="1487821">,</span>&nbsp;<span class="ident" id="1487823">h</span>&nbsp;<span class="op" id="1487825">*</span><span class="ident" id="1487826">hmap</span><span class="op" id="1487830">,</span>&nbsp;<span class="ident" id="1487832">key</span>&nbsp;<span class="ident" id="1487836">uint64</span><span class="op" id="1487842">)</span>&nbsp;<span class="op" id="1487844">(</span><span class="ident" id="1487845">unsafe</span><span class="op" id="1487851">.</span><span class="ident" id="1487852">Pointer</span><span class="op" id="1487859">,</span>&nbsp;<span class="builtintype" id="1487861">bool</span><span class="op" id="1487865">)</span>&nbsp;<span class="op" id="1487867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1487870">if</span>&nbsp;<span class="ident" id="1487873">raceenabled</span>&nbsp;<span class="op" id="1487885">&amp;&amp;</span>&nbsp;<span class="ident" id="1487888">h</span>&nbsp;<span class="op" id="1487890">!=</span>&nbsp;<span class="ident" id="1487893">nil</span>&nbsp;<span class="op" id="1487897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487901">callerpc</span>&nbsp;<span class="op" id="1487910">:=</span>&nbsp;<span class="ident" id="1487913">getcallerpc</span><span class="op" id="1487924">(</span><span class="ident" id="1487925">unsafe</span><span class="op" id="1487931">.</span><span class="ident" id="1487932">Pointer</span><span class="op" id="1487939">(</span><span class="op" id="1487940">&amp;</span><span class="ident" id="1487941">t</span><span class="op" id="1487942">)</span><span class="op" id="1487943">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1487947">racereadpc</span><span class="op" id="1487957">(</span><span class="ident" id="1487958">unsafe</span><span class="op" id="1487964">.</span><span class="ident" id="1487965">Pointer</span><span class="op" id="1487972">(</span><span class="ident" id="1487973">h</span><span class="op" id="1487974">)</span><span class="op" id="1487975">,</span>&nbsp;<span class="ident" id="1487977">callerpc</span><span class="op" id="1487985">,</span>&nbsp;<span class="ident" id="1487987">funcPC</span><span class="op" id="1487993">(</span><span class="ident" id="1487994">mapaccess2_fast64</span><span class="op" id="1488011">)</span><span class="op" id="1488012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488018">if</span>&nbsp;<span class="ident" id="1488021">h</span>&nbsp;<span class="op" id="1488023">==</span>&nbsp;<span class="ident" id="1488026">nil</span>&nbsp;<span class="op" id="1488030">||</span>&nbsp;<span class="ident" id="1488033">h</span><span class="op" id="1488034">.</span><span class="ident" id="1488035">count</span>&nbsp;<span class="op" id="1488041">==</span>&nbsp;<span class="num" id="1488044">0</span>&nbsp;<span class="op" id="1488046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488050">return</span>&nbsp;<span class="ident" id="1488057">unsafe</span><span class="op" id="1488063">.</span><span class="ident" id="1488064">Pointer</span><span class="op" id="1488071">(</span><span class="ident" id="1488072">t</span><span class="op" id="1488073">.</span><span class="ident" id="1488074">elem</span><span class="op" id="1488078">.</span><span class="ident" id="1488079">zero</span><span class="op" id="1488083">)</span><span class="op" id="1488084">,</span>&nbsp;<span class="builtintype" id="1488086">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488093">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488096">var</span>&nbsp;<span class="ident" id="1488100">b</span>&nbsp;<span class="op" id="1488102">*</span><span class="ident" id="1488103">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488109">if</span>&nbsp;<span class="ident" id="1488112">h</span><span class="op" id="1488113">.</span><span class="ident" id="1488114">B</span>&nbsp;<span class="op" id="1488116">==</span>&nbsp;<span class="num" id="1488119">0</span>&nbsp;<span class="op" id="1488121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1488125">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488166">b</span>&nbsp;<span class="op" id="1488168">=</span>&nbsp;<span class="op" id="1488170">(</span><span class="op" id="1488171">*</span><span class="ident" id="1488172">bmap</span><span class="op" id="1488176">)</span><span class="op" id="1488177">(</span><span class="ident" id="1488178">h</span><span class="op" id="1488179">.</span><span class="ident" id="1488180">buckets</span><span class="op" id="1488187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488190">}</span>&nbsp;<span class="keyword" id="1488192">else</span>&nbsp;<span class="op" id="1488197">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488201">hash</span>&nbsp;<span class="op" id="1488206">:=</span>&nbsp;<span class="ident" id="1488209">goalg</span><span class="op" id="1488214">(</span><span class="ident" id="1488215">t</span><span class="op" id="1488216">.</span><span class="ident" id="1488217">key</span><span class="op" id="1488220">.</span><span class="ident" id="1488221">alg</span><span class="op" id="1488224">)</span><span class="op" id="1488225">.</span><span class="ident" id="1488226">hash</span><span class="op" id="1488230">(</span><span class="ident" id="1488231">noescape</span><span class="op" id="1488239">(</span><span class="ident" id="1488240">unsafe</span><span class="op" id="1488246">.</span><span class="ident" id="1488247">Pointer</span><span class="op" id="1488254">(</span><span class="op" id="1488255">&amp;</span><span class="ident" id="1488256">key</span><span class="op" id="1488259">)</span><span class="op" id="1488260">)</span><span class="op" id="1488261">,</span>&nbsp;<span class="num" id="1488263">8</span><span class="op" id="1488264">,</span>&nbsp;<span class="builtintype" id="1488266">uintptr</span><span class="op" id="1488273">(</span><span class="ident" id="1488274">h</span><span class="op" id="1488275">.</span><span class="ident" id="1488276">hash0</span><span class="op" id="1488281">)</span><span class="op" id="1488282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488286">m</span>&nbsp;<span class="op" id="1488288">:=</span>&nbsp;<span class="builtintype" id="1488291">uintptr</span><span class="op" id="1488298">(</span><span class="num" id="1488299">1</span><span class="op" id="1488300">)</span><span class="op" id="1488301">&lt;&lt;</span><span class="ident" id="1488303">h</span><span class="op" id="1488304">.</span><span class="ident" id="1488305">B</span>&nbsp;<span class="op" id="1488307">-</span>&nbsp;<span class="num" id="1488309">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488313">b</span>&nbsp;<span class="op" id="1488315">=</span>&nbsp;<span class="op" id="1488317">(</span><span class="op" id="1488318">*</span><span class="ident" id="1488319">bmap</span><span class="op" id="1488323">)</span><span class="op" id="1488324">(</span><span class="ident" id="1488325">add</span><span class="op" id="1488328">(</span><span class="ident" id="1488329">h</span><span class="op" id="1488330">.</span><span class="ident" id="1488331">buckets</span><span class="op" id="1488338">,</span>&nbsp;<span class="op" id="1488340">(</span><span class="ident" id="1488341">hash</span><span class="op" id="1488345">&amp;</span><span class="ident" id="1488346">m</span><span class="op" id="1488347">)</span><span class="op" id="1488348">*</span><span class="builtintype" id="1488349">uintptr</span><span class="op" id="1488356">(</span><span class="ident" id="1488357">t</span><span class="op" id="1488358">.</span><span class="ident" id="1488359">bucketsize</span><span class="op" id="1488369">)</span><span class="op" id="1488370">)</span><span class="op" id="1488371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488375">if</span>&nbsp;<span class="ident" id="1488378">c</span>&nbsp;<span class="op" id="1488380">:=</span>&nbsp;<span class="ident" id="1488383">h</span><span class="op" id="1488384">.</span><span class="ident" id="1488385">oldbuckets</span><span class="op" id="1488395">;</span>&nbsp;<span class="ident" id="1488397">c</span>&nbsp;<span class="op" id="1488399">!=</span>&nbsp;<span class="ident" id="1488402">nil</span>&nbsp;<span class="op" id="1488406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488411">oldb</span>&nbsp;<span class="op" id="1488416">:=</span>&nbsp;<span class="op" id="1488419">(</span><span class="op" id="1488420">*</span><span class="ident" id="1488421">bmap</span><span class="op" id="1488425">)</span><span class="op" id="1488426">(</span><span class="ident" id="1488427">add</span><span class="op" id="1488430">(</span><span class="ident" id="1488431">c</span><span class="op" id="1488432">,</span>&nbsp;<span class="op" id="1488434">(</span><span class="ident" id="1488435">hash</span><span class="op" id="1488439">&amp;</span><span class="op" id="1488440">(</span><span class="ident" id="1488441">m</span><span class="op" id="1488442">&gt;&gt;</span><span class="num" id="1488444">1</span><span class="op" id="1488445">)</span><span class="op" id="1488446">)</span><span class="op" id="1488447">*</span><span class="builtintype" id="1488448">uintptr</span><span class="op" id="1488455">(</span><span class="ident" id="1488456">t</span><span class="op" id="1488457">.</span><span class="ident" id="1488458">bucketsize</span><span class="op" id="1488468">)</span><span class="op" id="1488469">)</span><span class="op" id="1488470">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488475">if</span>&nbsp;<span class="op" id="1488478">!</span><span class="ident" id="1488479">evacuated</span><span class="op" id="1488488">(</span><span class="ident" id="1488489">oldb</span><span class="op" id="1488493">)</span>&nbsp;<span class="op" id="1488495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488501">b</span>&nbsp;<span class="op" id="1488503">=</span>&nbsp;<span class="ident" id="1488505">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488520">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488523">for</span>&nbsp;<span class="op" id="1488527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488531">for</span>&nbsp;<span class="ident" id="1488535">i</span>&nbsp;<span class="op" id="1488537">:=</span>&nbsp;<span class="builtintype" id="1488540">uintptr</span><span class="op" id="1488547">(</span><span class="num" id="1488548">0</span><span class="op" id="1488549">)</span><span class="op" id="1488550">;</span>&nbsp;<span class="ident" id="1488552">i</span>&nbsp;<span class="op" id="1488554">&lt;</span>&nbsp;<span class="ident" id="1488556">bucketCnt</span><span class="op" id="1488565">;</span>&nbsp;<span class="ident" id="1488567">i</span><span class="op" id="1488568">++</span>&nbsp;<span class="op" id="1488571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488576">k</span>&nbsp;<span class="op" id="1488578">:=</span>&nbsp;<span class="op" id="1488581">*</span><span class="op" id="1488582">(</span><span class="op" id="1488583">(</span><span class="op" id="1488584">*</span><span class="ident" id="1488585">uint64</span><span class="op" id="1488591">)</span><span class="op" id="1488592">(</span><span class="ident" id="1488593">add</span><span class="op" id="1488596">(</span><span class="ident" id="1488597">unsafe</span><span class="op" id="1488603">.</span><span class="ident" id="1488604">Pointer</span><span class="op" id="1488611">(</span><span class="ident" id="1488612">b</span><span class="op" id="1488613">)</span><span class="op" id="1488614">,</span>&nbsp;<span class="ident" id="1488616">dataOffset</span><span class="op" id="1488626">+</span><span class="ident" id="1488627">i</span><span class="op" id="1488628">*</span><span class="num" id="1488629">8</span><span class="op" id="1488630">)</span><span class="op" id="1488631">)</span><span class="op" id="1488632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488637">if</span>&nbsp;<span class="ident" id="1488640">k</span>&nbsp;<span class="op" id="1488642">!=</span>&nbsp;<span class="ident" id="1488645">key</span>&nbsp;<span class="op" id="1488649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488655">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488672">x</span>&nbsp;<span class="op" id="1488674">:=</span>&nbsp;<span class="op" id="1488677">*</span><span class="op" id="1488678">(</span><span class="op" id="1488679">(</span><span class="op" id="1488680">*</span><span class="builtintype" id="1488681">uint8</span><span class="op" id="1488686">)</span><span class="op" id="1488687">(</span><span class="ident" id="1488688">add</span><span class="op" id="1488691">(</span><span class="ident" id="1488692">unsafe</span><span class="op" id="1488698">.</span><span class="ident" id="1488699">Pointer</span><span class="op" id="1488706">(</span><span class="ident" id="1488707">b</span><span class="op" id="1488708">)</span><span class="op" id="1488709">,</span>&nbsp;<span class="ident" id="1488711">i</span><span class="op" id="1488712">)</span><span class="op" id="1488713">)</span><span class="op" id="1488714">)</span>&nbsp;<span class="comment" id="1488716">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488760">if</span>&nbsp;<span class="ident" id="1488763">x</span>&nbsp;<span class="op" id="1488765">==</span>&nbsp;<span class="ident" id="1488768">empty</span>&nbsp;<span class="op" id="1488774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488780">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488792">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488797">return</span>&nbsp;<span class="ident" id="1488804">add</span><span class="op" id="1488807">(</span><span class="ident" id="1488808">unsafe</span><span class="op" id="1488814">.</span><span class="ident" id="1488815">Pointer</span><span class="op" id="1488822">(</span><span class="ident" id="1488823">b</span><span class="op" id="1488824">)</span><span class="op" id="1488825">,</span>&nbsp;<span class="ident" id="1488827">dataOffset</span><span class="op" id="1488837">+</span><span class="ident" id="1488838">bucketCnt</span><span class="op" id="1488847">*</span><span class="num" id="1488848">8</span><span class="op" id="1488849">+</span><span class="ident" id="1488850">i</span><span class="op" id="1488851">*</span><span class="builtintype" id="1488852">uintptr</span><span class="op" id="1488859">(</span><span class="ident" id="1488860">t</span><span class="op" id="1488861">.</span><span class="ident" id="1488862">valuesize</span><span class="op" id="1488871">)</span><span class="op" id="1488872">)</span><span class="op" id="1488873">,</span>&nbsp;<span class="builtintype" id="1488875">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1488886">b</span>&nbsp;<span class="op" id="1488888">=</span>&nbsp;<span class="ident" id="1488890">b</span><span class="op" id="1488891">.</span><span class="ident" id="1488892">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488903">if</span>&nbsp;<span class="ident" id="1488906">b</span>&nbsp;<span class="op" id="1488908">==</span>&nbsp;<span class="ident" id="1488911">nil</span>&nbsp;<span class="op" id="1488915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1488920">return</span>&nbsp;<span class="ident" id="1488927">unsafe</span><span class="op" id="1488933">.</span><span class="ident" id="1488934">Pointer</span><span class="op" id="1488941">(</span><span class="ident" id="1488942">t</span><span class="op" id="1488943">.</span><span class="ident" id="1488944">elem</span><span class="op" id="1488948">.</span><span class="ident" id="1488949">zero</span><span class="op" id="1488953">)</span><span class="op" id="1488954">,</span>&nbsp;<span class="builtintype" id="1488956">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1488967">}</span><br>
<span class="lineno"></span><span class="op" id="1488969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1488972">func</span>&nbsp;<span class="ident" id="1488977">mapaccess1_faststr</span><span class="op" id="1488995">(</span><span class="ident" id="1488996">t</span>&nbsp;<span class="op" id="1488998">*</span><span class="ident" id="1488999">maptype</span><span class="op" id="1489006">,</span>&nbsp;<span class="ident" id="1489008">h</span>&nbsp;<span class="op" id="1489010">*</span><span class="ident" id="1489011">hmap</span><span class="op" id="1489015">,</span>&nbsp;<span class="ident" id="1489017">ky</span>&nbsp;<span class="builtintype" id="1489020">string</span><span class="op" id="1489026">)</span>&nbsp;<span class="ident" id="1489028">unsafe</span><span class="op" id="1489034">.</span><span class="ident" id="1489035">Pointer</span>&nbsp;<span class="op" id="1489043">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489046">if</span>&nbsp;<span class="ident" id="1489049">raceenabled</span>&nbsp;<span class="op" id="1489061">&amp;&amp;</span>&nbsp;<span class="ident" id="1489064">h</span>&nbsp;<span class="op" id="1489066">!=</span>&nbsp;<span class="ident" id="1489069">nil</span>&nbsp;<span class="op" id="1489073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489077">callerpc</span>&nbsp;<span class="op" id="1489086">:=</span>&nbsp;<span class="ident" id="1489089">getcallerpc</span><span class="op" id="1489100">(</span><span class="ident" id="1489101">unsafe</span><span class="op" id="1489107">.</span><span class="ident" id="1489108">Pointer</span><span class="op" id="1489115">(</span><span class="op" id="1489116">&amp;</span><span class="ident" id="1489117">t</span><span class="op" id="1489118">)</span><span class="op" id="1489119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489123">racereadpc</span><span class="op" id="1489133">(</span><span class="ident" id="1489134">unsafe</span><span class="op" id="1489140">.</span><span class="ident" id="1489141">Pointer</span><span class="op" id="1489148">(</span><span class="ident" id="1489149">h</span><span class="op" id="1489150">)</span><span class="op" id="1489151">,</span>&nbsp;<span class="ident" id="1489153">callerpc</span><span class="op" id="1489161">,</span>&nbsp;<span class="ident" id="1489163">funcPC</span><span class="op" id="1489169">(</span><span class="ident" id="1489170">mapaccess1_faststr</span><span class="op" id="1489188">)</span><span class="op" id="1489189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489195">if</span>&nbsp;<span class="ident" id="1489198">h</span>&nbsp;<span class="op" id="1489200">==</span>&nbsp;<span class="ident" id="1489203">nil</span>&nbsp;<span class="op" id="1489207">||</span>&nbsp;<span class="ident" id="1489210">h</span><span class="op" id="1489211">.</span><span class="ident" id="1489212">count</span>&nbsp;<span class="op" id="1489218">==</span>&nbsp;<span class="num" id="1489221">0</span>&nbsp;<span class="op" id="1489223">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489227">return</span>&nbsp;<span class="ident" id="1489234">unsafe</span><span class="op" id="1489240">.</span><span class="ident" id="1489241">Pointer</span><span class="op" id="1489248">(</span><span class="ident" id="1489249">t</span><span class="op" id="1489250">.</span><span class="ident" id="1489251">elem</span><span class="op" id="1489255">.</span><span class="ident" id="1489256">zero</span><span class="op" id="1489260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489266">key</span>&nbsp;<span class="op" id="1489270">:=</span>&nbsp;<span class="op" id="1489273">(</span><span class="op" id="1489274">*</span><span class="ident" id="1489275">stringStruct</span><span class="op" id="1489287">)</span><span class="op" id="1489288">(</span><span class="ident" id="1489289">unsafe</span><span class="op" id="1489295">.</span><span class="ident" id="1489296">Pointer</span><span class="op" id="1489303">(</span><span class="op" id="1489304">&amp;</span><span class="ident" id="1489305">ky</span><span class="op" id="1489307">)</span><span class="op" id="1489308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489311">if</span>&nbsp;<span class="ident" id="1489314">h</span><span class="op" id="1489315">.</span><span class="ident" id="1489316">B</span>&nbsp;<span class="op" id="1489318">==</span>&nbsp;<span class="num" id="1489321">0</span>&nbsp;<span class="op" id="1489323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489327">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489350">b</span>&nbsp;<span class="op" id="1489352">:=</span>&nbsp;<span class="op" id="1489355">(</span><span class="op" id="1489356">*</span><span class="ident" id="1489357">bmap</span><span class="op" id="1489361">)</span><span class="op" id="1489362">(</span><span class="ident" id="1489363">h</span><span class="op" id="1489364">.</span><span class="ident" id="1489365">buckets</span><span class="op" id="1489372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489376">if</span>&nbsp;<span class="ident" id="1489379">key</span><span class="op" id="1489382">.</span><span class="builtinfunc" id="1489383">len</span>&nbsp;<span class="op" id="1489387">&lt;</span>&nbsp;<span class="num" id="1489389">32</span>&nbsp;<span class="op" id="1489392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489397">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489446">for</span>&nbsp;<span class="ident" id="1489450">i</span>&nbsp;<span class="op" id="1489452">:=</span>&nbsp;<span class="builtintype" id="1489455">uintptr</span><span class="op" id="1489462">(</span><span class="num" id="1489463">0</span><span class="op" id="1489464">)</span><span class="op" id="1489465">;</span>&nbsp;<span class="ident" id="1489467">i</span>&nbsp;<span class="op" id="1489469">&lt;</span>&nbsp;<span class="ident" id="1489471">bucketCnt</span><span class="op" id="1489480">;</span>&nbsp;<span class="ident" id="1489482">i</span><span class="op" id="1489483">++</span>&nbsp;<span class="op" id="1489486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489492">x</span>&nbsp;<span class="op" id="1489494">:=</span>&nbsp;<span class="op" id="1489497">*</span><span class="op" id="1489498">(</span><span class="op" id="1489499">(</span><span class="op" id="1489500">*</span><span class="builtintype" id="1489501">uint8</span><span class="op" id="1489506">)</span><span class="op" id="1489507">(</span><span class="ident" id="1489508">add</span><span class="op" id="1489511">(</span><span class="ident" id="1489512">unsafe</span><span class="op" id="1489518">.</span><span class="ident" id="1489519">Pointer</span><span class="op" id="1489526">(</span><span class="ident" id="1489527">b</span><span class="op" id="1489528">)</span><span class="op" id="1489529">,</span>&nbsp;<span class="ident" id="1489531">i</span><span class="op" id="1489532">)</span><span class="op" id="1489533">)</span><span class="op" id="1489534">)</span>&nbsp;<span class="comment" id="1489536">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489581">if</span>&nbsp;<span class="ident" id="1489584">x</span>&nbsp;<span class="op" id="1489586">==</span>&nbsp;<span class="ident" id="1489589">empty</span>&nbsp;<span class="op" id="1489595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1489621">k</span>&nbsp;<span class="op" id="1489623">:=</span>&nbsp;<span class="op" id="1489626">(</span><span class="op" id="1489627">*</span><span class="ident" id="1489628">stringStruct</span><span class="op" id="1489640">)</span><span class="op" id="1489641">(</span><span class="ident" id="1489642">add</span><span class="op" id="1489645">(</span><span class="ident" id="1489646">unsafe</span><span class="op" id="1489652">.</span><span class="ident" id="1489653">Pointer</span><span class="op" id="1489660">(</span><span class="ident" id="1489661">b</span><span class="op" id="1489662">)</span><span class="op" id="1489663">,</span>&nbsp;<span class="ident" id="1489665">dataOffset</span><span class="op" id="1489675">+</span><span class="ident" id="1489676">i</span><span class="op" id="1489677">*</span><span class="num" id="1489678">2</span><span class="op" id="1489679">*</span><span class="ident" id="1489680">ptrSize</span><span class="op" id="1489687">)</span><span class="op" id="1489688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489694">if</span>&nbsp;<span class="ident" id="1489697">k</span><span class="op" id="1489698">.</span><span class="builtinfunc" id="1489699">len</span>&nbsp;<span class="op" id="1489703">!=</span>&nbsp;<span class="ident" id="1489706">key</span><span class="op" id="1489709">.</span><span class="builtinfunc" id="1489710">len</span>&nbsp;<span class="op" id="1489714">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489721">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489740">if</span>&nbsp;<span class="ident" id="1489743">k</span><span class="op" id="1489744">.</span><span class="ident" id="1489745">str</span>&nbsp;<span class="op" id="1489749">==</span>&nbsp;<span class="ident" id="1489752">key</span><span class="op" id="1489755">.</span><span class="ident" id="1489756">str</span>&nbsp;<span class="op" id="1489760">||</span>&nbsp;<span class="ident" id="1489763">memeq</span><span class="op" id="1489768">(</span><span class="ident" id="1489769">k</span><span class="op" id="1489770">.</span><span class="ident" id="1489771">str</span><span class="op" id="1489774">,</span>&nbsp;<span class="ident" id="1489776">key</span><span class="op" id="1489779">.</span><span class="ident" id="1489780">str</span><span class="op" id="1489783">,</span>&nbsp;<span class="builtintype" id="1489785">uintptr</span><span class="op" id="1489792">(</span><span class="ident" id="1489793">key</span><span class="op" id="1489796">.</span><span class="builtinfunc" id="1489797">len</span><span class="op" id="1489800">)</span><span class="op" id="1489801">)</span>&nbsp;<span class="op" id="1489803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489810">return</span>&nbsp;<span class="ident" id="1489817">add</span><span class="op" id="1489820">(</span><span class="ident" id="1489821">unsafe</span><span class="op" id="1489827">.</span><span class="ident" id="1489828">Pointer</span><span class="op" id="1489835">(</span><span class="ident" id="1489836">b</span><span class="op" id="1489837">)</span><span class="op" id="1489838">,</span>&nbsp;<span class="ident" id="1489840">dataOffset</span><span class="op" id="1489850">+</span><span class="ident" id="1489851">bucketCnt</span><span class="op" id="1489860">*</span><span class="num" id="1489861">2</span><span class="op" id="1489862">*</span><span class="ident" id="1489863">ptrSize</span><span class="op" id="1489870">+</span><span class="ident" id="1489871">i</span><span class="op" id="1489872">*</span><span class="builtintype" id="1489873">uintptr</span><span class="op" id="1489880">(</span><span class="ident" id="1489881">t</span><span class="op" id="1489882">.</span><span class="ident" id="1489883">valuesize</span><span class="op" id="1489892">)</span><span class="op" id="1489893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489899">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1489909">return</span>&nbsp;<span class="ident" id="1489916">unsafe</span><span class="op" id="1489922">.</span><span class="ident" id="1489923">Pointer</span><span class="op" id="1489930">(</span><span class="ident" id="1489931">t</span><span class="op" id="1489932">.</span><span class="ident" id="1489933">elem</span><span class="op" id="1489937">.</span><span class="ident" id="1489938">zero</span><span class="op" id="1489942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1489946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1489950">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490011">keymaybe</span>&nbsp;<span class="op" id="1490020">:=</span>&nbsp;<span class="builtintype" id="1490023">uintptr</span><span class="op" id="1490030">(</span><span class="ident" id="1490031">bucketCnt</span><span class="op" id="1490040">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490044">for</span>&nbsp;<span class="ident" id="1490048">i</span>&nbsp;<span class="op" id="1490050">:=</span>&nbsp;<span class="builtintype" id="1490053">uintptr</span><span class="op" id="1490060">(</span><span class="num" id="1490061">0</span><span class="op" id="1490062">)</span><span class="op" id="1490063">;</span>&nbsp;<span class="ident" id="1490065">i</span>&nbsp;<span class="op" id="1490067">&lt;</span>&nbsp;<span class="ident" id="1490069">bucketCnt</span><span class="op" id="1490078">;</span>&nbsp;<span class="ident" id="1490080">i</span><span class="op" id="1490081">++</span>&nbsp;<span class="op" id="1490084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490089">x</span>&nbsp;<span class="op" id="1490091">:=</span>&nbsp;<span class="op" id="1490094">*</span><span class="op" id="1490095">(</span><span class="op" id="1490096">(</span><span class="op" id="1490097">*</span><span class="builtintype" id="1490098">uint8</span><span class="op" id="1490103">)</span><span class="op" id="1490104">(</span><span class="ident" id="1490105">add</span><span class="op" id="1490108">(</span><span class="ident" id="1490109">unsafe</span><span class="op" id="1490115">.</span><span class="ident" id="1490116">Pointer</span><span class="op" id="1490123">(</span><span class="ident" id="1490124">b</span><span class="op" id="1490125">)</span><span class="op" id="1490126">,</span>&nbsp;<span class="ident" id="1490128">i</span><span class="op" id="1490129">)</span><span class="op" id="1490130">)</span><span class="op" id="1490131">)</span>&nbsp;<span class="comment" id="1490133">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490177">if</span>&nbsp;<span class="ident" id="1490180">x</span>&nbsp;<span class="op" id="1490182">==</span>&nbsp;<span class="ident" id="1490185">empty</span>&nbsp;<span class="op" id="1490191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490197">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490209">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490214">k</span>&nbsp;<span class="op" id="1490216">:=</span>&nbsp;<span class="op" id="1490219">(</span><span class="op" id="1490220">*</span><span class="ident" id="1490221">stringStruct</span><span class="op" id="1490233">)</span><span class="op" id="1490234">(</span><span class="ident" id="1490235">add</span><span class="op" id="1490238">(</span><span class="ident" id="1490239">unsafe</span><span class="op" id="1490245">.</span><span class="ident" id="1490246">Pointer</span><span class="op" id="1490253">(</span><span class="ident" id="1490254">b</span><span class="op" id="1490255">)</span><span class="op" id="1490256">,</span>&nbsp;<span class="ident" id="1490258">dataOffset</span><span class="op" id="1490268">+</span><span class="ident" id="1490269">i</span><span class="op" id="1490270">*</span><span class="num" id="1490271">2</span><span class="op" id="1490272">*</span><span class="ident" id="1490273">ptrSize</span><span class="op" id="1490280">)</span><span class="op" id="1490281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490286">if</span>&nbsp;<span class="ident" id="1490289">k</span><span class="op" id="1490290">.</span><span class="builtinfunc" id="1490291">len</span>&nbsp;<span class="op" id="1490295">!=</span>&nbsp;<span class="ident" id="1490298">key</span><span class="op" id="1490301">.</span><span class="builtinfunc" id="1490302">len</span>&nbsp;<span class="op" id="1490306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490312">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490329">if</span>&nbsp;<span class="ident" id="1490332">k</span><span class="op" id="1490333">.</span><span class="ident" id="1490334">str</span>&nbsp;<span class="op" id="1490338">==</span>&nbsp;<span class="ident" id="1490341">key</span><span class="op" id="1490344">.</span><span class="ident" id="1490345">str</span>&nbsp;<span class="op" id="1490349">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490355">return</span>&nbsp;<span class="ident" id="1490362">add</span><span class="op" id="1490365">(</span><span class="ident" id="1490366">unsafe</span><span class="op" id="1490372">.</span><span class="ident" id="1490373">Pointer</span><span class="op" id="1490380">(</span><span class="ident" id="1490381">b</span><span class="op" id="1490382">)</span><span class="op" id="1490383">,</span>&nbsp;<span class="ident" id="1490385">dataOffset</span><span class="op" id="1490395">+</span><span class="ident" id="1490396">bucketCnt</span><span class="op" id="1490405">*</span><span class="num" id="1490406">2</span><span class="op" id="1490407">*</span><span class="ident" id="1490408">ptrSize</span><span class="op" id="1490415">+</span><span class="ident" id="1490416">i</span><span class="op" id="1490417">*</span><span class="builtintype" id="1490418">uintptr</span><span class="op" id="1490425">(</span><span class="ident" id="1490426">t</span><span class="op" id="1490427">.</span><span class="ident" id="1490428">valuesize</span><span class="op" id="1490437">)</span><span class="op" id="1490438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490448">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490474">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490563">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490594">if</span>&nbsp;<span class="op" id="1490597">*</span><span class="op" id="1490598">(</span><span class="op" id="1490599">(</span><span class="op" id="1490600">*</span><span class="op" id="1490601">[</span><span class="num" id="1490602">4</span><span class="op" id="1490603">]</span><span class="builtintype" id="1490604">byte</span><span class="op" id="1490608">)</span><span class="op" id="1490609">(</span><span class="ident" id="1490610">key</span><span class="op" id="1490613">.</span><span class="ident" id="1490614">str</span><span class="op" id="1490617">)</span><span class="op" id="1490618">)</span>&nbsp;<span class="op" id="1490620">!=</span>&nbsp;<span class="op" id="1490623">*</span><span class="op" id="1490624">(</span><span class="op" id="1490625">(</span><span class="op" id="1490626">*</span><span class="op" id="1490627">[</span><span class="num" id="1490628">4</span><span class="op" id="1490629">]</span><span class="builtintype" id="1490630">byte</span><span class="op" id="1490634">)</span><span class="op" id="1490635">(</span><span class="ident" id="1490636">k</span><span class="op" id="1490637">.</span><span class="ident" id="1490638">str</span><span class="op" id="1490641">)</span><span class="op" id="1490642">)</span>&nbsp;<span class="op" id="1490644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490650">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490667">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490692">if</span>&nbsp;<span class="op" id="1490695">*</span><span class="op" id="1490696">(</span><span class="op" id="1490697">(</span><span class="op" id="1490698">*</span><span class="op" id="1490699">[</span><span class="num" id="1490700">4</span><span class="op" id="1490701">]</span><span class="builtintype" id="1490702">byte</span><span class="op" id="1490706">)</span><span class="op" id="1490707">(</span><span class="ident" id="1490708">add</span><span class="op" id="1490711">(</span><span class="ident" id="1490712">key</span><span class="op" id="1490715">.</span><span class="ident" id="1490716">str</span><span class="op" id="1490719">,</span>&nbsp;<span class="builtintype" id="1490721">uintptr</span><span class="op" id="1490728">(</span><span class="ident" id="1490729">key</span><span class="op" id="1490732">.</span><span class="builtinfunc" id="1490733">len</span><span class="op" id="1490736">)</span><span class="op" id="1490737">-</span><span class="num" id="1490738">4</span><span class="op" id="1490739">)</span><span class="op" id="1490740">)</span><span class="op" id="1490741">)</span>&nbsp;<span class="op" id="1490743">!=</span>&nbsp;<span class="op" id="1490746">*</span><span class="op" id="1490747">(</span><span class="op" id="1490748">(</span><span class="op" id="1490749">*</span><span class="op" id="1490750">[</span><span class="num" id="1490751">4</span><span class="op" id="1490752">]</span><span class="builtintype" id="1490753">byte</span><span class="op" id="1490757">)</span><span class="op" id="1490758">(</span><span class="ident" id="1490759">add</span><span class="op" id="1490762">(</span><span class="ident" id="1490763">k</span><span class="op" id="1490764">.</span><span class="ident" id="1490765">str</span><span class="op" id="1490768">,</span>&nbsp;<span class="builtintype" id="1490770">uintptr</span><span class="op" id="1490777">(</span><span class="ident" id="1490778">key</span><span class="op" id="1490781">.</span><span class="builtinfunc" id="1490782">len</span><span class="op" id="1490785">)</span><span class="op" id="1490786">-</span><span class="num" id="1490787">4</span><span class="op" id="1490788">)</span><span class="op" id="1490789">)</span><span class="op" id="1490790">)</span>&nbsp;<span class="op" id="1490792">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490798">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490815">if</span>&nbsp;<span class="ident" id="1490818">keymaybe</span>&nbsp;<span class="op" id="1490827">!=</span>&nbsp;<span class="ident" id="1490830">bucketCnt</span>&nbsp;<span class="op" id="1490840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1490846">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490916">goto</span>&nbsp;<span class="ident" id="1490921">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490936">keymaybe</span>&nbsp;<span class="op" id="1490945">=</span>&nbsp;<span class="ident" id="1490947">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1490951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1490955">if</span>&nbsp;<span class="ident" id="1490958">keymaybe</span>&nbsp;<span class="op" id="1490967">!=</span>&nbsp;<span class="ident" id="1490970">bucketCnt</span>&nbsp;<span class="op" id="1490980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1490985">k</span>&nbsp;<span class="op" id="1490987">:=</span>&nbsp;<span class="op" id="1490990">(</span><span class="op" id="1490991">*</span><span class="ident" id="1490992">stringStruct</span><span class="op" id="1491004">)</span><span class="op" id="1491005">(</span><span class="ident" id="1491006">add</span><span class="op" id="1491009">(</span><span class="ident" id="1491010">unsafe</span><span class="op" id="1491016">.</span><span class="ident" id="1491017">Pointer</span><span class="op" id="1491024">(</span><span class="ident" id="1491025">b</span><span class="op" id="1491026">)</span><span class="op" id="1491027">,</span>&nbsp;<span class="ident" id="1491029">dataOffset</span><span class="op" id="1491039">+</span><span class="ident" id="1491040">keymaybe</span><span class="op" id="1491048">*</span><span class="num" id="1491049">2</span><span class="op" id="1491050">*</span><span class="ident" id="1491051">ptrSize</span><span class="op" id="1491058">)</span><span class="op" id="1491059">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491064">if</span>&nbsp;<span class="ident" id="1491067">memeq</span><span class="op" id="1491072">(</span><span class="ident" id="1491073">k</span><span class="op" id="1491074">.</span><span class="ident" id="1491075">str</span><span class="op" id="1491078">,</span>&nbsp;<span class="ident" id="1491080">key</span><span class="op" id="1491083">.</span><span class="ident" id="1491084">str</span><span class="op" id="1491087">,</span>&nbsp;<span class="builtintype" id="1491089">uintptr</span><span class="op" id="1491096">(</span><span class="ident" id="1491097">key</span><span class="op" id="1491100">.</span><span class="builtinfunc" id="1491101">len</span><span class="op" id="1491104">)</span><span class="op" id="1491105">)</span>&nbsp;<span class="op" id="1491107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491113">return</span>&nbsp;<span class="ident" id="1491120">add</span><span class="op" id="1491123">(</span><span class="ident" id="1491124">unsafe</span><span class="op" id="1491130">.</span><span class="ident" id="1491131">Pointer</span><span class="op" id="1491138">(</span><span class="ident" id="1491139">b</span><span class="op" id="1491140">)</span><span class="op" id="1491141">,</span>&nbsp;<span class="ident" id="1491143">dataOffset</span><span class="op" id="1491153">+</span><span class="ident" id="1491154">bucketCnt</span><span class="op" id="1491163">*</span><span class="num" id="1491164">2</span><span class="op" id="1491165">*</span><span class="ident" id="1491166">ptrSize</span><span class="op" id="1491173">+</span><span class="ident" id="1491174">keymaybe</span><span class="op" id="1491182">*</span><span class="builtintype" id="1491183">uintptr</span><span class="op" id="1491190">(</span><span class="ident" id="1491191">t</span><span class="op" id="1491192">.</span><span class="ident" id="1491193">valuesize</span><span class="op" id="1491202">)</span><span class="op" id="1491203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491216">return</span>&nbsp;<span class="ident" id="1491223">unsafe</span><span class="op" id="1491229">.</span><span class="ident" id="1491230">Pointer</span><span class="op" id="1491237">(</span><span class="ident" id="1491238">t</span><span class="op" id="1491239">.</span><span class="ident" id="1491240">elem</span><span class="op" id="1491244">.</span><span class="ident" id="1491245">zero</span><span class="op" id="1491249">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491252">}</span><br>
<span class="lineno"></span><span class="ident" id="1491254">dohash</span><span class="op" id="1491260">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491263">hash</span>&nbsp;<span class="op" id="1491268">:=</span>&nbsp;<span class="ident" id="1491271">goalg</span><span class="op" id="1491276">(</span><span class="ident" id="1491277">t</span><span class="op" id="1491278">.</span><span class="ident" id="1491279">key</span><span class="op" id="1491282">.</span><span class="ident" id="1491283">alg</span><span class="op" id="1491286">)</span><span class="op" id="1491287">.</span><span class="ident" id="1491288">hash</span><span class="op" id="1491292">(</span><span class="ident" id="1491293">noescape</span><span class="op" id="1491301">(</span><span class="ident" id="1491302">unsafe</span><span class="op" id="1491308">.</span><span class="ident" id="1491309">Pointer</span><span class="op" id="1491316">(</span><span class="op" id="1491317">&amp;</span><span class="ident" id="1491318">ky</span><span class="op" id="1491320">)</span><span class="op" id="1491321">)</span><span class="op" id="1491322">,</span>&nbsp;<span class="num" id="1491324">2</span><span class="op" id="1491325">*</span><span class="ident" id="1491326">ptrSize</span><span class="op" id="1491333">,</span>&nbsp;<span class="builtintype" id="1491335">uintptr</span><span class="op" id="1491342">(</span><span class="ident" id="1491343">h</span><span class="op" id="1491344">.</span><span class="ident" id="1491345">hash0</span><span class="op" id="1491350">)</span><span class="op" id="1491351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491354">m</span>&nbsp;<span class="op" id="1491356">:=</span>&nbsp;<span class="builtintype" id="1491359">uintptr</span><span class="op" id="1491366">(</span><span class="num" id="1491367">1</span><span class="op" id="1491368">)</span><span class="op" id="1491369">&lt;&lt;</span><span class="ident" id="1491371">h</span><span class="op" id="1491372">.</span><span class="ident" id="1491373">B</span>&nbsp;<span class="op" id="1491375">-</span>&nbsp;<span class="num" id="1491377">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491380">b</span>&nbsp;<span class="op" id="1491382">:=</span>&nbsp;<span class="op" id="1491385">(</span><span class="op" id="1491386">*</span><span class="ident" id="1491387">bmap</span><span class="op" id="1491391">)</span><span class="op" id="1491392">(</span><span class="ident" id="1491393">add</span><span class="op" id="1491396">(</span><span class="ident" id="1491397">h</span><span class="op" id="1491398">.</span><span class="ident" id="1491399">buckets</span><span class="op" id="1491406">,</span>&nbsp;<span class="op" id="1491408">(</span><span class="ident" id="1491409">hash</span><span class="op" id="1491413">&amp;</span><span class="ident" id="1491414">m</span><span class="op" id="1491415">)</span><span class="op" id="1491416">*</span><span class="builtintype" id="1491417">uintptr</span><span class="op" id="1491424">(</span><span class="ident" id="1491425">t</span><span class="op" id="1491426">.</span><span class="ident" id="1491427">bucketsize</span><span class="op" id="1491437">)</span><span class="op" id="1491438">)</span><span class="op" id="1491439">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491442">if</span>&nbsp;<span class="ident" id="1491445">c</span>&nbsp;<span class="op" id="1491447">:=</span>&nbsp;<span class="ident" id="1491450">h</span><span class="op" id="1491451">.</span><span class="ident" id="1491452">oldbuckets</span><span class="op" id="1491462">;</span>&nbsp;<span class="ident" id="1491464">c</span>&nbsp;<span class="op" id="1491466">!=</span>&nbsp;<span class="ident" id="1491469">nil</span>&nbsp;<span class="op" id="1491473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491477">oldb</span>&nbsp;<span class="op" id="1491482">:=</span>&nbsp;<span class="op" id="1491485">(</span><span class="op" id="1491486">*</span><span class="ident" id="1491487">bmap</span><span class="op" id="1491491">)</span><span class="op" id="1491492">(</span><span class="ident" id="1491493">add</span><span class="op" id="1491496">(</span><span class="ident" id="1491497">c</span><span class="op" id="1491498">,</span>&nbsp;<span class="op" id="1491500">(</span><span class="ident" id="1491501">hash</span><span class="op" id="1491505">&amp;</span><span class="op" id="1491506">(</span><span class="ident" id="1491507">m</span><span class="op" id="1491508">&gt;&gt;</span><span class="num" id="1491510">1</span><span class="op" id="1491511">)</span><span class="op" id="1491512">)</span><span class="op" id="1491513">*</span><span class="builtintype" id="1491514">uintptr</span><span class="op" id="1491521">(</span><span class="ident" id="1491522">t</span><span class="op" id="1491523">.</span><span class="ident" id="1491524">bucketsize</span><span class="op" id="1491534">)</span><span class="op" id="1491535">)</span><span class="op" id="1491536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491540">if</span>&nbsp;<span class="op" id="1491543">!</span><span class="ident" id="1491544">evacuated</span><span class="op" id="1491553">(</span><span class="ident" id="1491554">oldb</span><span class="op" id="1491558">)</span>&nbsp;<span class="op" id="1491560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491565">b</span>&nbsp;<span class="op" id="1491567">=</span>&nbsp;<span class="ident" id="1491569">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491576">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491582">top</span>&nbsp;<span class="op" id="1491586">:=</span>&nbsp;<span class="builtintype" id="1491589">uint8</span><span class="op" id="1491594">(</span><span class="ident" id="1491595">hash</span>&nbsp;<span class="op" id="1491600">&gt;&gt;</span>&nbsp;<span class="op" id="1491603">(</span><span class="ident" id="1491604">ptrSize</span><span class="op" id="1491611">*</span><span class="num" id="1491612">8</span>&nbsp;<span class="op" id="1491614">-</span>&nbsp;<span class="num" id="1491616">8</span><span class="op" id="1491617">)</span><span class="op" id="1491618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491621">if</span>&nbsp;<span class="ident" id="1491624">top</span>&nbsp;<span class="op" id="1491628">&lt;</span>&nbsp;<span class="ident" id="1491630">minTopHash</span>&nbsp;<span class="op" id="1491641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491645">top</span>&nbsp;<span class="op" id="1491649">+=</span>&nbsp;<span class="ident" id="1491652">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491664">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491667">for</span>&nbsp;<span class="op" id="1491671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491675">for</span>&nbsp;<span class="ident" id="1491679">i</span>&nbsp;<span class="op" id="1491681">:=</span>&nbsp;<span class="builtintype" id="1491684">uintptr</span><span class="op" id="1491691">(</span><span class="num" id="1491692">0</span><span class="op" id="1491693">)</span><span class="op" id="1491694">;</span>&nbsp;<span class="ident" id="1491696">i</span>&nbsp;<span class="op" id="1491698">&lt;</span>&nbsp;<span class="ident" id="1491700">bucketCnt</span><span class="op" id="1491709">;</span>&nbsp;<span class="ident" id="1491711">i</span><span class="op" id="1491712">++</span>&nbsp;<span class="op" id="1491715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491720">x</span>&nbsp;<span class="op" id="1491722">:=</span>&nbsp;<span class="op" id="1491725">*</span><span class="op" id="1491726">(</span><span class="op" id="1491727">(</span><span class="op" id="1491728">*</span><span class="builtintype" id="1491729">uint8</span><span class="op" id="1491734">)</span><span class="op" id="1491735">(</span><span class="ident" id="1491736">add</span><span class="op" id="1491739">(</span><span class="ident" id="1491740">unsafe</span><span class="op" id="1491746">.</span><span class="ident" id="1491747">Pointer</span><span class="op" id="1491754">(</span><span class="ident" id="1491755">b</span><span class="op" id="1491756">)</span><span class="op" id="1491757">,</span>&nbsp;<span class="ident" id="1491759">i</span><span class="op" id="1491760">)</span><span class="op" id="1491761">)</span><span class="op" id="1491762">)</span>&nbsp;<span class="comment" id="1491764">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491808">if</span>&nbsp;<span class="ident" id="1491811">x</span>&nbsp;<span class="op" id="1491813">!=</span>&nbsp;<span class="ident" id="1491816">top</span>&nbsp;<span class="op" id="1491820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491826">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1491843">k</span>&nbsp;<span class="op" id="1491845">:=</span>&nbsp;<span class="op" id="1491848">(</span><span class="op" id="1491849">*</span><span class="ident" id="1491850">stringStruct</span><span class="op" id="1491862">)</span><span class="op" id="1491863">(</span><span class="ident" id="1491864">add</span><span class="op" id="1491867">(</span><span class="ident" id="1491868">unsafe</span><span class="op" id="1491874">.</span><span class="ident" id="1491875">Pointer</span><span class="op" id="1491882">(</span><span class="ident" id="1491883">b</span><span class="op" id="1491884">)</span><span class="op" id="1491885">,</span>&nbsp;<span class="ident" id="1491887">dataOffset</span><span class="op" id="1491897">+</span><span class="ident" id="1491898">i</span><span class="op" id="1491899">*</span><span class="num" id="1491900">2</span><span class="op" id="1491901">*</span><span class="ident" id="1491902">ptrSize</span><span class="op" id="1491909">)</span><span class="op" id="1491910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491915">if</span>&nbsp;<span class="ident" id="1491918">k</span><span class="op" id="1491919">.</span><span class="builtinfunc" id="1491920">len</span>&nbsp;<span class="op" id="1491924">!=</span>&nbsp;<span class="ident" id="1491927">key</span><span class="op" id="1491930">.</span><span class="builtinfunc" id="1491931">len</span>&nbsp;<span class="op" id="1491935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491941">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1491953">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1491958">if</span>&nbsp;<span class="ident" id="1491961">k</span><span class="op" id="1491962">.</span><span class="ident" id="1491963">str</span>&nbsp;<span class="op" id="1491967">==</span>&nbsp;<span class="ident" id="1491970">key</span><span class="op" id="1491973">.</span><span class="ident" id="1491974">str</span>&nbsp;<span class="op" id="1491978">||</span>&nbsp;<span class="ident" id="1491981">memeq</span><span class="op" id="1491986">(</span><span class="ident" id="1491987">k</span><span class="op" id="1491988">.</span><span class="ident" id="1491989">str</span><span class="op" id="1491992">,</span>&nbsp;<span class="ident" id="1491994">key</span><span class="op" id="1491997">.</span><span class="ident" id="1491998">str</span><span class="op" id="1492001">,</span>&nbsp;<span class="builtintype" id="1492003">uintptr</span><span class="op" id="1492010">(</span><span class="ident" id="1492011">key</span><span class="op" id="1492014">.</span><span class="builtinfunc" id="1492015">len</span><span class="op" id="1492018">)</span><span class="op" id="1492019">)</span>&nbsp;<span class="op" id="1492021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492027">return</span>&nbsp;<span class="ident" id="1492034">add</span><span class="op" id="1492037">(</span><span class="ident" id="1492038">unsafe</span><span class="op" id="1492044">.</span><span class="ident" id="1492045">Pointer</span><span class="op" id="1492052">(</span><span class="ident" id="1492053">b</span><span class="op" id="1492054">)</span><span class="op" id="1492055">,</span>&nbsp;<span class="ident" id="1492057">dataOffset</span><span class="op" id="1492067">+</span><span class="ident" id="1492068">bucketCnt</span><span class="op" id="1492077">*</span><span class="num" id="1492078">2</span><span class="op" id="1492079">*</span><span class="ident" id="1492080">ptrSize</span><span class="op" id="1492087">+</span><span class="ident" id="1492088">i</span><span class="op" id="1492089">*</span><span class="builtintype" id="1492090">uintptr</span><span class="op" id="1492097">(</span><span class="ident" id="1492098">t</span><span class="op" id="1492099">.</span><span class="ident" id="1492100">valuesize</span><span class="op" id="1492109">)</span><span class="op" id="1492110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492123">b</span>&nbsp;<span class="op" id="1492125">=</span>&nbsp;<span class="ident" id="1492127">b</span><span class="op" id="1492128">.</span><span class="ident" id="1492129">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492140">if</span>&nbsp;<span class="ident" id="1492143">b</span>&nbsp;<span class="op" id="1492145">==</span>&nbsp;<span class="ident" id="1492148">nil</span>&nbsp;<span class="op" id="1492152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492157">return</span>&nbsp;<span class="ident" id="1492164">unsafe</span><span class="op" id="1492170">.</span><span class="ident" id="1492171">Pointer</span><span class="op" id="1492178">(</span><span class="ident" id="1492179">t</span><span class="op" id="1492180">.</span><span class="ident" id="1492181">elem</span><span class="op" id="1492185">.</span><span class="ident" id="1492186">zero</span><span class="op" id="1492190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492197">}</span><br>
<span class="lineno"></span><span class="op" id="1492199">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1492202">func</span>&nbsp;<span class="ident" id="1492207">mapaccess2_faststr</span><span class="op" id="1492225">(</span><span class="ident" id="1492226">t</span>&nbsp;<span class="op" id="1492228">*</span><span class="ident" id="1492229">maptype</span><span class="op" id="1492236">,</span>&nbsp;<span class="ident" id="1492238">h</span>&nbsp;<span class="op" id="1492240">*</span><span class="ident" id="1492241">hmap</span><span class="op" id="1492245">,</span>&nbsp;<span class="ident" id="1492247">ky</span>&nbsp;<span class="builtintype" id="1492250">string</span><span class="op" id="1492256">)</span>&nbsp;<span class="op" id="1492258">(</span><span class="ident" id="1492259">unsafe</span><span class="op" id="1492265">.</span><span class="ident" id="1492266">Pointer</span><span class="op" id="1492273">,</span>&nbsp;<span class="builtintype" id="1492275">bool</span><span class="op" id="1492279">)</span>&nbsp;<span class="op" id="1492281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492284">if</span>&nbsp;<span class="ident" id="1492287">raceenabled</span>&nbsp;<span class="op" id="1492299">&amp;&amp;</span>&nbsp;<span class="ident" id="1492302">h</span>&nbsp;<span class="op" id="1492304">!=</span>&nbsp;<span class="ident" id="1492307">nil</span>&nbsp;<span class="op" id="1492311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492315">callerpc</span>&nbsp;<span class="op" id="1492324">:=</span>&nbsp;<span class="ident" id="1492327">getcallerpc</span><span class="op" id="1492338">(</span><span class="ident" id="1492339">unsafe</span><span class="op" id="1492345">.</span><span class="ident" id="1492346">Pointer</span><span class="op" id="1492353">(</span><span class="op" id="1492354">&amp;</span><span class="ident" id="1492355">t</span><span class="op" id="1492356">)</span><span class="op" id="1492357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492361">racereadpc</span><span class="op" id="1492371">(</span><span class="ident" id="1492372">unsafe</span><span class="op" id="1492378">.</span><span class="ident" id="1492379">Pointer</span><span class="op" id="1492386">(</span><span class="ident" id="1492387">h</span><span class="op" id="1492388">)</span><span class="op" id="1492389">,</span>&nbsp;<span class="ident" id="1492391">callerpc</span><span class="op" id="1492399">,</span>&nbsp;<span class="ident" id="1492401">funcPC</span><span class="op" id="1492407">(</span><span class="ident" id="1492408">mapaccess2_faststr</span><span class="op" id="1492426">)</span><span class="op" id="1492427">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492433">if</span>&nbsp;<span class="ident" id="1492436">h</span>&nbsp;<span class="op" id="1492438">==</span>&nbsp;<span class="ident" id="1492441">nil</span>&nbsp;<span class="op" id="1492445">||</span>&nbsp;<span class="ident" id="1492448">h</span><span class="op" id="1492449">.</span><span class="ident" id="1492450">count</span>&nbsp;<span class="op" id="1492456">==</span>&nbsp;<span class="num" id="1492459">0</span>&nbsp;<span class="op" id="1492461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492465">return</span>&nbsp;<span class="ident" id="1492472">unsafe</span><span class="op" id="1492478">.</span><span class="ident" id="1492479">Pointer</span><span class="op" id="1492486">(</span><span class="ident" id="1492487">t</span><span class="op" id="1492488">.</span><span class="ident" id="1492489">elem</span><span class="op" id="1492493">.</span><span class="ident" id="1492494">zero</span><span class="op" id="1492498">)</span><span class="op" id="1492499">,</span>&nbsp;<span class="builtintype" id="1492501">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492511">key</span>&nbsp;<span class="op" id="1492515">:=</span>&nbsp;<span class="op" id="1492518">(</span><span class="op" id="1492519">*</span><span class="ident" id="1492520">stringStruct</span><span class="op" id="1492532">)</span><span class="op" id="1492533">(</span><span class="ident" id="1492534">unsafe</span><span class="op" id="1492540">.</span><span class="ident" id="1492541">Pointer</span><span class="op" id="1492548">(</span><span class="op" id="1492549">&amp;</span><span class="ident" id="1492550">ky</span><span class="op" id="1492552">)</span><span class="op" id="1492553">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492556">if</span>&nbsp;<span class="ident" id="1492559">h</span><span class="op" id="1492560">.</span><span class="ident" id="1492561">B</span>&nbsp;<span class="op" id="1492563">==</span>&nbsp;<span class="num" id="1492566">0</span>&nbsp;<span class="op" id="1492568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1492572">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492595">b</span>&nbsp;<span class="op" id="1492597">:=</span>&nbsp;<span class="op" id="1492600">(</span><span class="op" id="1492601">*</span><span class="ident" id="1492602">bmap</span><span class="op" id="1492606">)</span><span class="op" id="1492607">(</span><span class="ident" id="1492608">h</span><span class="op" id="1492609">.</span><span class="ident" id="1492610">buckets</span><span class="op" id="1492617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492621">if</span>&nbsp;<span class="ident" id="1492624">key</span><span class="op" id="1492627">.</span><span class="builtinfunc" id="1492628">len</span>&nbsp;<span class="op" id="1492632">&lt;</span>&nbsp;<span class="num" id="1492634">32</span>&nbsp;<span class="op" id="1492637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1492642">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492691">for</span>&nbsp;<span class="ident" id="1492695">i</span>&nbsp;<span class="op" id="1492697">:=</span>&nbsp;<span class="builtintype" id="1492700">uintptr</span><span class="op" id="1492707">(</span><span class="num" id="1492708">0</span><span class="op" id="1492709">)</span><span class="op" id="1492710">;</span>&nbsp;<span class="ident" id="1492712">i</span>&nbsp;<span class="op" id="1492714">&lt;</span>&nbsp;<span class="ident" id="1492716">bucketCnt</span><span class="op" id="1492725">;</span>&nbsp;<span class="ident" id="1492727">i</span><span class="op" id="1492728">++</span>&nbsp;<span class="op" id="1492731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492737">x</span>&nbsp;<span class="op" id="1492739">:=</span>&nbsp;<span class="op" id="1492742">*</span><span class="op" id="1492743">(</span><span class="op" id="1492744">(</span><span class="op" id="1492745">*</span><span class="builtintype" id="1492746">uint8</span><span class="op" id="1492751">)</span><span class="op" id="1492752">(</span><span class="ident" id="1492753">add</span><span class="op" id="1492756">(</span><span class="ident" id="1492757">unsafe</span><span class="op" id="1492763">.</span><span class="ident" id="1492764">Pointer</span><span class="op" id="1492771">(</span><span class="ident" id="1492772">b</span><span class="op" id="1492773">)</span><span class="op" id="1492774">,</span>&nbsp;<span class="ident" id="1492776">i</span><span class="op" id="1492777">)</span><span class="op" id="1492778">)</span><span class="op" id="1492779">)</span>&nbsp;<span class="comment" id="1492781">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492826">if</span>&nbsp;<span class="ident" id="1492829">x</span>&nbsp;<span class="op" id="1492831">==</span>&nbsp;<span class="ident" id="1492834">empty</span>&nbsp;<span class="op" id="1492840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492847">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492860">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1492866">k</span>&nbsp;<span class="op" id="1492868">:=</span>&nbsp;<span class="op" id="1492871">(</span><span class="op" id="1492872">*</span><span class="ident" id="1492873">stringStruct</span><span class="op" id="1492885">)</span><span class="op" id="1492886">(</span><span class="ident" id="1492887">add</span><span class="op" id="1492890">(</span><span class="ident" id="1492891">unsafe</span><span class="op" id="1492897">.</span><span class="ident" id="1492898">Pointer</span><span class="op" id="1492905">(</span><span class="ident" id="1492906">b</span><span class="op" id="1492907">)</span><span class="op" id="1492908">,</span>&nbsp;<span class="ident" id="1492910">dataOffset</span><span class="op" id="1492920">+</span><span class="ident" id="1492921">i</span><span class="op" id="1492922">*</span><span class="num" id="1492923">2</span><span class="op" id="1492924">*</span><span class="ident" id="1492925">ptrSize</span><span class="op" id="1492932">)</span><span class="op" id="1492933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492939">if</span>&nbsp;<span class="ident" id="1492942">k</span><span class="op" id="1492943">.</span><span class="builtinfunc" id="1492944">len</span>&nbsp;<span class="op" id="1492948">!=</span>&nbsp;<span class="ident" id="1492951">key</span><span class="op" id="1492954">.</span><span class="builtinfunc" id="1492955">len</span>&nbsp;<span class="op" id="1492959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1492979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1492985">if</span>&nbsp;<span class="ident" id="1492988">k</span><span class="op" id="1492989">.</span><span class="ident" id="1492990">str</span>&nbsp;<span class="op" id="1492994">==</span>&nbsp;<span class="ident" id="1492997">key</span><span class="op" id="1493000">.</span><span class="ident" id="1493001">str</span>&nbsp;<span class="op" id="1493005">||</span>&nbsp;<span class="ident" id="1493008">memeq</span><span class="op" id="1493013">(</span><span class="ident" id="1493014">k</span><span class="op" id="1493015">.</span><span class="ident" id="1493016">str</span><span class="op" id="1493019">,</span>&nbsp;<span class="ident" id="1493021">key</span><span class="op" id="1493024">.</span><span class="ident" id="1493025">str</span><span class="op" id="1493028">,</span>&nbsp;<span class="builtintype" id="1493030">uintptr</span><span class="op" id="1493037">(</span><span class="ident" id="1493038">key</span><span class="op" id="1493041">.</span><span class="builtinfunc" id="1493042">len</span><span class="op" id="1493045">)</span><span class="op" id="1493046">)</span>&nbsp;<span class="op" id="1493048">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493055">return</span>&nbsp;<span class="ident" id="1493062">add</span><span class="op" id="1493065">(</span><span class="ident" id="1493066">unsafe</span><span class="op" id="1493072">.</span><span class="ident" id="1493073">Pointer</span><span class="op" id="1493080">(</span><span class="ident" id="1493081">b</span><span class="op" id="1493082">)</span><span class="op" id="1493083">,</span>&nbsp;<span class="ident" id="1493085">dataOffset</span><span class="op" id="1493095">+</span><span class="ident" id="1493096">bucketCnt</span><span class="op" id="1493105">*</span><span class="num" id="1493106">2</span><span class="op" id="1493107">*</span><span class="ident" id="1493108">ptrSize</span><span class="op" id="1493115">+</span><span class="ident" id="1493116">i</span><span class="op" id="1493117">*</span><span class="builtintype" id="1493118">uintptr</span><span class="op" id="1493125">(</span><span class="ident" id="1493126">t</span><span class="op" id="1493127">.</span><span class="ident" id="1493128">valuesize</span><span class="op" id="1493137">)</span><span class="op" id="1493138">)</span><span class="op" id="1493139">,</span>&nbsp;<span class="builtintype" id="1493141">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493160">return</span>&nbsp;<span class="ident" id="1493167">unsafe</span><span class="op" id="1493173">.</span><span class="ident" id="1493174">Pointer</span><span class="op" id="1493181">(</span><span class="ident" id="1493182">t</span><span class="op" id="1493183">.</span><span class="ident" id="1493184">elem</span><span class="op" id="1493188">.</span><span class="ident" id="1493189">zero</span><span class="op" id="1493193">)</span><span class="op" id="1493194">,</span>&nbsp;<span class="builtintype" id="1493196">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493204">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1493208">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1493269">keymaybe</span>&nbsp;<span class="op" id="1493278">:=</span>&nbsp;<span class="builtintype" id="1493281">uintptr</span><span class="op" id="1493288">(</span><span class="ident" id="1493289">bucketCnt</span><span class="op" id="1493298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493302">for</span>&nbsp;<span class="ident" id="1493306">i</span>&nbsp;<span class="op" id="1493308">:=</span>&nbsp;<span class="builtintype" id="1493311">uintptr</span><span class="op" id="1493318">(</span><span class="num" id="1493319">0</span><span class="op" id="1493320">)</span><span class="op" id="1493321">;</span>&nbsp;<span class="ident" id="1493323">i</span>&nbsp;<span class="op" id="1493325">&lt;</span>&nbsp;<span class="ident" id="1493327">bucketCnt</span><span class="op" id="1493336">;</span>&nbsp;<span class="ident" id="1493338">i</span><span class="op" id="1493339">++</span>&nbsp;<span class="op" id="1493342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1493347">x</span>&nbsp;<span class="op" id="1493349">:=</span>&nbsp;<span class="op" id="1493352">*</span><span class="op" id="1493353">(</span><span class="op" id="1493354">(</span><span class="op" id="1493355">*</span><span class="builtintype" id="1493356">uint8</span><span class="op" id="1493361">)</span><span class="op" id="1493362">(</span><span class="ident" id="1493363">add</span><span class="op" id="1493366">(</span><span class="ident" id="1493367">unsafe</span><span class="op" id="1493373">.</span><span class="ident" id="1493374">Pointer</span><span class="op" id="1493381">(</span><span class="ident" id="1493382">b</span><span class="op" id="1493383">)</span><span class="op" id="1493384">,</span>&nbsp;<span class="ident" id="1493386">i</span><span class="op" id="1493387">)</span><span class="op" id="1493388">)</span><span class="op" id="1493389">)</span>&nbsp;<span class="comment" id="1493391">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493435">if</span>&nbsp;<span class="ident" id="1493438">x</span>&nbsp;<span class="op" id="1493440">==</span>&nbsp;<span class="ident" id="1493443">empty</span>&nbsp;<span class="op" id="1493449">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493455">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1493472">k</span>&nbsp;<span class="op" id="1493474">:=</span>&nbsp;<span class="op" id="1493477">(</span><span class="op" id="1493478">*</span><span class="ident" id="1493479">stringStruct</span><span class="op" id="1493491">)</span><span class="op" id="1493492">(</span><span class="ident" id="1493493">add</span><span class="op" id="1493496">(</span><span class="ident" id="1493497">unsafe</span><span class="op" id="1493503">.</span><span class="ident" id="1493504">Pointer</span><span class="op" id="1493511">(</span><span class="ident" id="1493512">b</span><span class="op" id="1493513">)</span><span class="op" id="1493514">,</span>&nbsp;<span class="ident" id="1493516">dataOffset</span><span class="op" id="1493526">+</span><span class="ident" id="1493527">i</span><span class="op" id="1493528">*</span><span class="num" id="1493529">2</span><span class="op" id="1493530">*</span><span class="ident" id="1493531">ptrSize</span><span class="op" id="1493538">)</span><span class="op" id="1493539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493544">if</span>&nbsp;<span class="ident" id="1493547">k</span><span class="op" id="1493548">.</span><span class="builtinfunc" id="1493549">len</span>&nbsp;<span class="op" id="1493553">!=</span>&nbsp;<span class="ident" id="1493556">key</span><span class="op" id="1493559">.</span><span class="builtinfunc" id="1493560">len</span>&nbsp;<span class="op" id="1493564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493570">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493587">if</span>&nbsp;<span class="ident" id="1493590">k</span><span class="op" id="1493591">.</span><span class="ident" id="1493592">str</span>&nbsp;<span class="op" id="1493596">==</span>&nbsp;<span class="ident" id="1493599">key</span><span class="op" id="1493602">.</span><span class="ident" id="1493603">str</span>&nbsp;<span class="op" id="1493607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493613">return</span>&nbsp;<span class="ident" id="1493620">add</span><span class="op" id="1493623">(</span><span class="ident" id="1493624">unsafe</span><span class="op" id="1493630">.</span><span class="ident" id="1493631">Pointer</span><span class="op" id="1493638">(</span><span class="ident" id="1493639">b</span><span class="op" id="1493640">)</span><span class="op" id="1493641">,</span>&nbsp;<span class="ident" id="1493643">dataOffset</span><span class="op" id="1493653">+</span><span class="ident" id="1493654">bucketCnt</span><span class="op" id="1493663">*</span><span class="num" id="1493664">2</span><span class="op" id="1493665">*</span><span class="ident" id="1493666">ptrSize</span><span class="op" id="1493673">+</span><span class="ident" id="1493674">i</span><span class="op" id="1493675">*</span><span class="builtintype" id="1493676">uintptr</span><span class="op" id="1493683">(</span><span class="ident" id="1493684">t</span><span class="op" id="1493685">.</span><span class="ident" id="1493686">valuesize</span><span class="op" id="1493695">)</span><span class="op" id="1493696">)</span><span class="op" id="1493697">,</span>&nbsp;<span class="builtintype" id="1493699">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1493712">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493738">if</span>&nbsp;<span class="op" id="1493741">*</span><span class="op" id="1493742">(</span><span class="op" id="1493743">(</span><span class="op" id="1493744">*</span><span class="op" id="1493745">[</span><span class="num" id="1493746">4</span><span class="op" id="1493747">]</span><span class="builtintype" id="1493748">byte</span><span class="op" id="1493752">)</span><span class="op" id="1493753">(</span><span class="ident" id="1493754">key</span><span class="op" id="1493757">.</span><span class="ident" id="1493758">str</span><span class="op" id="1493761">)</span><span class="op" id="1493762">)</span>&nbsp;<span class="op" id="1493764">!=</span>&nbsp;<span class="op" id="1493767">*</span><span class="op" id="1493768">(</span><span class="op" id="1493769">(</span><span class="op" id="1493770">*</span><span class="op" id="1493771">[</span><span class="num" id="1493772">4</span><span class="op" id="1493773">]</span><span class="builtintype" id="1493774">byte</span><span class="op" id="1493778">)</span><span class="op" id="1493779">(</span><span class="ident" id="1493780">k</span><span class="op" id="1493781">.</span><span class="ident" id="1493782">str</span><span class="op" id="1493785">)</span><span class="op" id="1493786">)</span>&nbsp;<span class="op" id="1493788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493794">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1493811">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493836">if</span>&nbsp;<span class="op" id="1493839">*</span><span class="op" id="1493840">(</span><span class="op" id="1493841">(</span><span class="op" id="1493842">*</span><span class="op" id="1493843">[</span><span class="num" id="1493844">4</span><span class="op" id="1493845">]</span><span class="builtintype" id="1493846">byte</span><span class="op" id="1493850">)</span><span class="op" id="1493851">(</span><span class="ident" id="1493852">add</span><span class="op" id="1493855">(</span><span class="ident" id="1493856">key</span><span class="op" id="1493859">.</span><span class="ident" id="1493860">str</span><span class="op" id="1493863">,</span>&nbsp;<span class="builtintype" id="1493865">uintptr</span><span class="op" id="1493872">(</span><span class="ident" id="1493873">key</span><span class="op" id="1493876">.</span><span class="builtinfunc" id="1493877">len</span><span class="op" id="1493880">)</span><span class="op" id="1493881">-</span><span class="num" id="1493882">4</span><span class="op" id="1493883">)</span><span class="op" id="1493884">)</span><span class="op" id="1493885">)</span>&nbsp;<span class="op" id="1493887">!=</span>&nbsp;<span class="op" id="1493890">*</span><span class="op" id="1493891">(</span><span class="op" id="1493892">(</span><span class="op" id="1493893">*</span><span class="op" id="1493894">[</span><span class="num" id="1493895">4</span><span class="op" id="1493896">]</span><span class="builtintype" id="1493897">byte</span><span class="op" id="1493901">)</span><span class="op" id="1493902">(</span><span class="ident" id="1493903">add</span><span class="op" id="1493906">(</span><span class="ident" id="1493907">k</span><span class="op" id="1493908">.</span><span class="ident" id="1493909">str</span><span class="op" id="1493912">,</span>&nbsp;<span class="builtintype" id="1493914">uintptr</span><span class="op" id="1493921">(</span><span class="ident" id="1493922">key</span><span class="op" id="1493925">.</span><span class="builtinfunc" id="1493926">len</span><span class="op" id="1493929">)</span><span class="op" id="1493930">-</span><span class="num" id="1493931">4</span><span class="op" id="1493932">)</span><span class="op" id="1493933">)</span><span class="op" id="1493934">)</span>&nbsp;<span class="op" id="1493936">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493942">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1493954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1493959">if</span>&nbsp;<span class="ident" id="1493962">keymaybe</span>&nbsp;<span class="op" id="1493971">!=</span>&nbsp;<span class="ident" id="1493974">bucketCnt</span>&nbsp;<span class="op" id="1493984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1493990">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494060">goto</span>&nbsp;<span class="ident" id="1494065">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494080">keymaybe</span>&nbsp;<span class="op" id="1494089">=</span>&nbsp;<span class="ident" id="1494091">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494099">if</span>&nbsp;<span class="ident" id="1494102">keymaybe</span>&nbsp;<span class="op" id="1494111">!=</span>&nbsp;<span class="ident" id="1494114">bucketCnt</span>&nbsp;<span class="op" id="1494124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494129">k</span>&nbsp;<span class="op" id="1494131">:=</span>&nbsp;<span class="op" id="1494134">(</span><span class="op" id="1494135">*</span><span class="ident" id="1494136">stringStruct</span><span class="op" id="1494148">)</span><span class="op" id="1494149">(</span><span class="ident" id="1494150">add</span><span class="op" id="1494153">(</span><span class="ident" id="1494154">unsafe</span><span class="op" id="1494160">.</span><span class="ident" id="1494161">Pointer</span><span class="op" id="1494168">(</span><span class="ident" id="1494169">b</span><span class="op" id="1494170">)</span><span class="op" id="1494171">,</span>&nbsp;<span class="ident" id="1494173">dataOffset</span><span class="op" id="1494183">+</span><span class="ident" id="1494184">keymaybe</span><span class="op" id="1494192">*</span><span class="num" id="1494193">2</span><span class="op" id="1494194">*</span><span class="ident" id="1494195">ptrSize</span><span class="op" id="1494202">)</span><span class="op" id="1494203">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494208">if</span>&nbsp;<span class="ident" id="1494211">memeq</span><span class="op" id="1494216">(</span><span class="ident" id="1494217">k</span><span class="op" id="1494218">.</span><span class="ident" id="1494219">str</span><span class="op" id="1494222">,</span>&nbsp;<span class="ident" id="1494224">key</span><span class="op" id="1494227">.</span><span class="ident" id="1494228">str</span><span class="op" id="1494231">,</span>&nbsp;<span class="builtintype" id="1494233">uintptr</span><span class="op" id="1494240">(</span><span class="ident" id="1494241">key</span><span class="op" id="1494244">.</span><span class="builtinfunc" id="1494245">len</span><span class="op" id="1494248">)</span><span class="op" id="1494249">)</span>&nbsp;<span class="op" id="1494251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494257">return</span>&nbsp;<span class="ident" id="1494264">add</span><span class="op" id="1494267">(</span><span class="ident" id="1494268">unsafe</span><span class="op" id="1494274">.</span><span class="ident" id="1494275">Pointer</span><span class="op" id="1494282">(</span><span class="ident" id="1494283">b</span><span class="op" id="1494284">)</span><span class="op" id="1494285">,</span>&nbsp;<span class="ident" id="1494287">dataOffset</span><span class="op" id="1494297">+</span><span class="ident" id="1494298">bucketCnt</span><span class="op" id="1494307">*</span><span class="num" id="1494308">2</span><span class="op" id="1494309">*</span><span class="ident" id="1494310">ptrSize</span><span class="op" id="1494317">+</span><span class="ident" id="1494318">keymaybe</span><span class="op" id="1494326">*</span><span class="builtintype" id="1494327">uintptr</span><span class="op" id="1494334">(</span><span class="ident" id="1494335">t</span><span class="op" id="1494336">.</span><span class="ident" id="1494337">valuesize</span><span class="op" id="1494346">)</span><span class="op" id="1494347">)</span><span class="op" id="1494348">,</span>&nbsp;<span class="builtintype" id="1494350">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494366">return</span>&nbsp;<span class="ident" id="1494373">unsafe</span><span class="op" id="1494379">.</span><span class="ident" id="1494380">Pointer</span><span class="op" id="1494387">(</span><span class="ident" id="1494388">t</span><span class="op" id="1494389">.</span><span class="ident" id="1494390">elem</span><span class="op" id="1494394">.</span><span class="ident" id="1494395">zero</span><span class="op" id="1494399">)</span><span class="op" id="1494400">,</span>&nbsp;<span class="builtintype" id="1494402">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494409">}</span><br>
<span class="lineno"></span><span class="ident" id="1494411">dohash</span><span class="op" id="1494417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494420">hash</span>&nbsp;<span class="op" id="1494425">:=</span>&nbsp;<span class="ident" id="1494428">goalg</span><span class="op" id="1494433">(</span><span class="ident" id="1494434">t</span><span class="op" id="1494435">.</span><span class="ident" id="1494436">key</span><span class="op" id="1494439">.</span><span class="ident" id="1494440">alg</span><span class="op" id="1494443">)</span><span class="op" id="1494444">.</span><span class="ident" id="1494445">hash</span><span class="op" id="1494449">(</span><span class="ident" id="1494450">noescape</span><span class="op" id="1494458">(</span><span class="ident" id="1494459">unsafe</span><span class="op" id="1494465">.</span><span class="ident" id="1494466">Pointer</span><span class="op" id="1494473">(</span><span class="op" id="1494474">&amp;</span><span class="ident" id="1494475">ky</span><span class="op" id="1494477">)</span><span class="op" id="1494478">)</span><span class="op" id="1494479">,</span>&nbsp;<span class="num" id="1494481">2</span><span class="op" id="1494482">*</span><span class="ident" id="1494483">ptrSize</span><span class="op" id="1494490">,</span>&nbsp;<span class="builtintype" id="1494492">uintptr</span><span class="op" id="1494499">(</span><span class="ident" id="1494500">h</span><span class="op" id="1494501">.</span><span class="ident" id="1494502">hash0</span><span class="op" id="1494507">)</span><span class="op" id="1494508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494511">m</span>&nbsp;<span class="op" id="1494513">:=</span>&nbsp;<span class="builtintype" id="1494516">uintptr</span><span class="op" id="1494523">(</span><span class="num" id="1494524">1</span><span class="op" id="1494525">)</span><span class="op" id="1494526">&lt;&lt;</span><span class="ident" id="1494528">h</span><span class="op" id="1494529">.</span><span class="ident" id="1494530">B</span>&nbsp;<span class="op" id="1494532">-</span>&nbsp;<span class="num" id="1494534">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494537">b</span>&nbsp;<span class="op" id="1494539">:=</span>&nbsp;<span class="op" id="1494542">(</span><span class="op" id="1494543">*</span><span class="ident" id="1494544">bmap</span><span class="op" id="1494548">)</span><span class="op" id="1494549">(</span><span class="ident" id="1494550">add</span><span class="op" id="1494553">(</span><span class="ident" id="1494554">h</span><span class="op" id="1494555">.</span><span class="ident" id="1494556">buckets</span><span class="op" id="1494563">,</span>&nbsp;<span class="op" id="1494565">(</span><span class="ident" id="1494566">hash</span><span class="op" id="1494570">&amp;</span><span class="ident" id="1494571">m</span><span class="op" id="1494572">)</span><span class="op" id="1494573">*</span><span class="builtintype" id="1494574">uintptr</span><span class="op" id="1494581">(</span><span class="ident" id="1494582">t</span><span class="op" id="1494583">.</span><span class="ident" id="1494584">bucketsize</span><span class="op" id="1494594">)</span><span class="op" id="1494595">)</span><span class="op" id="1494596">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494599">if</span>&nbsp;<span class="ident" id="1494602">c</span>&nbsp;<span class="op" id="1494604">:=</span>&nbsp;<span class="ident" id="1494607">h</span><span class="op" id="1494608">.</span><span class="ident" id="1494609">oldbuckets</span><span class="op" id="1494619">;</span>&nbsp;<span class="ident" id="1494621">c</span>&nbsp;<span class="op" id="1494623">!=</span>&nbsp;<span class="ident" id="1494626">nil</span>&nbsp;<span class="op" id="1494630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494634">oldb</span>&nbsp;<span class="op" id="1494639">:=</span>&nbsp;<span class="op" id="1494642">(</span><span class="op" id="1494643">*</span><span class="ident" id="1494644">bmap</span><span class="op" id="1494648">)</span><span class="op" id="1494649">(</span><span class="ident" id="1494650">add</span><span class="op" id="1494653">(</span><span class="ident" id="1494654">c</span><span class="op" id="1494655">,</span>&nbsp;<span class="op" id="1494657">(</span><span class="ident" id="1494658">hash</span><span class="op" id="1494662">&amp;</span><span class="op" id="1494663">(</span><span class="ident" id="1494664">m</span><span class="op" id="1494665">&gt;&gt;</span><span class="num" id="1494667">1</span><span class="op" id="1494668">)</span><span class="op" id="1494669">)</span><span class="op" id="1494670">*</span><span class="builtintype" id="1494671">uintptr</span><span class="op" id="1494678">(</span><span class="ident" id="1494679">t</span><span class="op" id="1494680">.</span><span class="ident" id="1494681">bucketsize</span><span class="op" id="1494691">)</span><span class="op" id="1494692">)</span><span class="op" id="1494693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494697">if</span>&nbsp;<span class="op" id="1494700">!</span><span class="ident" id="1494701">evacuated</span><span class="op" id="1494710">(</span><span class="ident" id="1494711">oldb</span><span class="op" id="1494715">)</span>&nbsp;<span class="op" id="1494717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494722">b</span>&nbsp;<span class="op" id="1494724">=</span>&nbsp;<span class="ident" id="1494726">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494733">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494739">top</span>&nbsp;<span class="op" id="1494743">:=</span>&nbsp;<span class="builtintype" id="1494746">uint8</span><span class="op" id="1494751">(</span><span class="ident" id="1494752">hash</span>&nbsp;<span class="op" id="1494757">&gt;&gt;</span>&nbsp;<span class="op" id="1494760">(</span><span class="ident" id="1494761">ptrSize</span><span class="op" id="1494768">*</span><span class="num" id="1494769">8</span>&nbsp;<span class="op" id="1494771">-</span>&nbsp;<span class="num" id="1494773">8</span><span class="op" id="1494774">)</span><span class="op" id="1494775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494778">if</span>&nbsp;<span class="ident" id="1494781">top</span>&nbsp;<span class="op" id="1494785">&lt;</span>&nbsp;<span class="ident" id="1494787">minTopHash</span>&nbsp;<span class="op" id="1494798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494802">top</span>&nbsp;<span class="op" id="1494806">+=</span>&nbsp;<span class="ident" id="1494809">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494821">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494824">for</span>&nbsp;<span class="op" id="1494828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494832">for</span>&nbsp;<span class="ident" id="1494836">i</span>&nbsp;<span class="op" id="1494838">:=</span>&nbsp;<span class="builtintype" id="1494841">uintptr</span><span class="op" id="1494848">(</span><span class="num" id="1494849">0</span><span class="op" id="1494850">)</span><span class="op" id="1494851">;</span>&nbsp;<span class="ident" id="1494853">i</span>&nbsp;<span class="op" id="1494855">&lt;</span>&nbsp;<span class="ident" id="1494857">bucketCnt</span><span class="op" id="1494866">;</span>&nbsp;<span class="ident" id="1494868">i</span><span class="op" id="1494869">++</span>&nbsp;<span class="op" id="1494872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1494877">x</span>&nbsp;<span class="op" id="1494879">:=</span>&nbsp;<span class="op" id="1494882">*</span><span class="op" id="1494883">(</span><span class="op" id="1494884">(</span><span class="op" id="1494885">*</span><span class="builtintype" id="1494886">uint8</span><span class="op" id="1494891">)</span><span class="op" id="1494892">(</span><span class="ident" id="1494893">add</span><span class="op" id="1494896">(</span><span class="ident" id="1494897">unsafe</span><span class="op" id="1494903">.</span><span class="ident" id="1494904">Pointer</span><span class="op" id="1494911">(</span><span class="ident" id="1494912">b</span><span class="op" id="1494913">)</span><span class="op" id="1494914">,</span>&nbsp;<span class="ident" id="1494916">i</span><span class="op" id="1494917">)</span><span class="op" id="1494918">)</span><span class="op" id="1494919">)</span>&nbsp;<span class="comment" id="1494921">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494965">if</span>&nbsp;<span class="ident" id="1494968">x</span>&nbsp;<span class="op" id="1494970">!=</span>&nbsp;<span class="ident" id="1494973">top</span>&nbsp;<span class="op" id="1494977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1494983">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1494995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1495000">k</span>&nbsp;<span class="op" id="1495002">:=</span>&nbsp;<span class="op" id="1495005">(</span><span class="op" id="1495006">*</span><span class="ident" id="1495007">stringStruct</span><span class="op" id="1495019">)</span><span class="op" id="1495020">(</span><span class="ident" id="1495021">add</span><span class="op" id="1495024">(</span><span class="ident" id="1495025">unsafe</span><span class="op" id="1495031">.</span><span class="ident" id="1495032">Pointer</span><span class="op" id="1495039">(</span><span class="ident" id="1495040">b</span><span class="op" id="1495041">)</span><span class="op" id="1495042">,</span>&nbsp;<span class="ident" id="1495044">dataOffset</span><span class="op" id="1495054">+</span><span class="ident" id="1495055">i</span><span class="op" id="1495056">*</span><span class="num" id="1495057">2</span><span class="op" id="1495058">*</span><span class="ident" id="1495059">ptrSize</span><span class="op" id="1495066">)</span><span class="op" id="1495067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495072">if</span>&nbsp;<span class="ident" id="1495075">k</span><span class="op" id="1495076">.</span><span class="builtinfunc" id="1495077">len</span>&nbsp;<span class="op" id="1495081">!=</span>&nbsp;<span class="ident" id="1495084">key</span><span class="op" id="1495087">.</span><span class="builtinfunc" id="1495088">len</span>&nbsp;<span class="op" id="1495092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1495110">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495115">if</span>&nbsp;<span class="ident" id="1495118">k</span><span class="op" id="1495119">.</span><span class="ident" id="1495120">str</span>&nbsp;<span class="op" id="1495124">==</span>&nbsp;<span class="ident" id="1495127">key</span><span class="op" id="1495130">.</span><span class="ident" id="1495131">str</span>&nbsp;<span class="op" id="1495135">||</span>&nbsp;<span class="ident" id="1495138">memeq</span><span class="op" id="1495143">(</span><span class="ident" id="1495144">k</span><span class="op" id="1495145">.</span><span class="ident" id="1495146">str</span><span class="op" id="1495149">,</span>&nbsp;<span class="ident" id="1495151">key</span><span class="op" id="1495154">.</span><span class="ident" id="1495155">str</span><span class="op" id="1495158">,</span>&nbsp;<span class="builtintype" id="1495160">uintptr</span><span class="op" id="1495167">(</span><span class="ident" id="1495168">key</span><span class="op" id="1495171">.</span><span class="builtinfunc" id="1495172">len</span><span class="op" id="1495175">)</span><span class="op" id="1495176">)</span>&nbsp;<span class="op" id="1495178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495184">return</span>&nbsp;<span class="ident" id="1495191">add</span><span class="op" id="1495194">(</span><span class="ident" id="1495195">unsafe</span><span class="op" id="1495201">.</span><span class="ident" id="1495202">Pointer</span><span class="op" id="1495209">(</span><span class="ident" id="1495210">b</span><span class="op" id="1495211">)</span><span class="op" id="1495212">,</span>&nbsp;<span class="ident" id="1495214">dataOffset</span><span class="op" id="1495224">+</span><span class="ident" id="1495225">bucketCnt</span><span class="op" id="1495234">*</span><span class="num" id="1495235">2</span><span class="op" id="1495236">*</span><span class="ident" id="1495237">ptrSize</span><span class="op" id="1495244">+</span><span class="ident" id="1495245">i</span><span class="op" id="1495246">*</span><span class="builtintype" id="1495247">uintptr</span><span class="op" id="1495254">(</span><span class="ident" id="1495255">t</span><span class="op" id="1495256">.</span><span class="ident" id="1495257">valuesize</span><span class="op" id="1495266">)</span><span class="op" id="1495267">)</span><span class="op" id="1495268">,</span>&nbsp;<span class="builtintype" id="1495270">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1495278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1495282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1495286">b</span>&nbsp;<span class="op" id="1495288">=</span>&nbsp;<span class="ident" id="1495290">b</span><span class="op" id="1495291">.</span><span class="ident" id="1495292">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495303">if</span>&nbsp;<span class="ident" id="1495306">b</span>&nbsp;<span class="op" id="1495308">==</span>&nbsp;<span class="ident" id="1495311">nil</span>&nbsp;<span class="op" id="1495315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1495320">return</span>&nbsp;<span class="ident" id="1495327">unsafe</span><span class="op" id="1495333">.</span><span class="ident" id="1495334">Pointer</span><span class="op" id="1495341">(</span><span class="ident" id="1495342">t</span><span class="op" id="1495343">.</span><span class="ident" id="1495344">elem</span><span class="op" id="1495348">.</span><span class="ident" id="1495349">zero</span><span class="op" id="1495353">)</span><span class="op" id="1495354">,</span>&nbsp;<span class="builtintype" id="1495356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1495364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1495367">}</span><br>
<span class="lineno"></span><span class="op" id="1495369">}</span>
</div>
</body>
</html>
