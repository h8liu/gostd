<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2109161">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2109216">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2109270">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2109321">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2109369">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2109383">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2109432">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2109466">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2109500">package</span>&nbsp;<span class="ident" id="2109508">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2109517">import</span>&nbsp;<span class="string" id="2109524">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2109532">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2109557">type</span>&nbsp;<span class="ident" id="2109562">floatInfo</span>&nbsp;<span class="keyword" id="2109572">struct</span>&nbsp;<span class="op" id="2109579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2109582">mantbits</span>&nbsp;<span class="builtintype" id="2109591">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2109597">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2109606">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2109612">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2109621">int</span><br>
<span class="lineno">20</span><span class="op" id="2109625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2109628">var</span>&nbsp;<span class="ident" id="2109632">float32info</span>&nbsp;<span class="op" id="2109644">=</span>&nbsp;<span class="ident" id="2109646">floatInfo</span><span class="op" id="2109655">{</span><span class="num" id="2109656">23</span><span class="op" id="2109658">,</span>&nbsp;<span class="num" id="2109660">8</span><span class="op" id="2109661">,</span>&nbsp;<span class="op" id="2109663">-</span><span class="num" id="2109664">127</span><span class="op" id="2109667">}</span><br>
<span class="lineno"></span><span class="keyword" id="2109669">var</span>&nbsp;<span class="ident" id="2109673">float64info</span>&nbsp;<span class="op" id="2109685">=</span>&nbsp;<span class="ident" id="2109687">floatInfo</span><span class="op" id="2109696">{</span><span class="num" id="2109697">52</span><span class="op" id="2109699">,</span>&nbsp;<span class="num" id="2109701">11</span><span class="op" id="2109703">,</span>&nbsp;<span class="op" id="2109705">-</span><span class="num" id="2109706">1023</span><span class="op" id="2109710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2109713">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2109778">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2109844">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2109916">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2109975">//</span><br>
<span class="lineno">30</span><span class="comment" id="2109978">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2110006">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2110047">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2110090">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2110133">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2110166">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2110218">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2110267">//</span><br>
<span class="lineno"></span><span class="comment" id="2110270">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2110322">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2110402">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2110479">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2110532">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2110595">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2110652">func</span>&nbsp;<span class="ident" id="2110657">FormatFloat</span><span class="op" id="2110668">(</span><span class="ident" id="2110669">f</span>&nbsp;<span class="builtintype" id="2110671">float64</span><span class="op" id="2110678">,</span>&nbsp;<span class="ident" id="2110680">fmt</span>&nbsp;<span class="builtintype" id="2110684">byte</span><span class="op" id="2110688">,</span>&nbsp;<span class="ident" id="2110690">prec</span><span class="op" id="2110694">,</span>&nbsp;<span class="ident" id="2110696">bitSize</span>&nbsp;<span class="builtintype" id="2110704">int</span><span class="op" id="2110707">)</span>&nbsp;<span class="builtintype" id="2110709">string</span>&nbsp;<span class="op" id="2110716">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2110719">return</span>&nbsp;<span class="builtintype" id="2110726">string</span><span class="op" id="2110732">(</span><span class="ident" id="2110733">genericFtoa</span><span class="op" id="2110744">(</span><span class="builtinfunc" id="2110745">make</span><span class="op" id="2110749">(</span><span class="op" id="2110750">[</span><span class="op" id="2110751">]</span><span class="builtintype" id="2110752">byte</span><span class="op" id="2110756">,</span>&nbsp;<span class="num" id="2110758">0</span><span class="op" id="2110759">,</span>&nbsp;<span class="ident" id="2110761">max</span><span class="op" id="2110764">(</span><span class="ident" id="2110765">prec</span><span class="op" id="2110769">+</span><span class="num" id="2110770">4</span><span class="op" id="2110771">,</span>&nbsp;<span class="num" id="2110773">24</span><span class="op" id="2110775">)</span><span class="op" id="2110776">)</span><span class="op" id="2110777">,</span>&nbsp;<span class="ident" id="2110779">f</span><span class="op" id="2110780">,</span>&nbsp;<span class="ident" id="2110782">fmt</span><span class="op" id="2110785">,</span>&nbsp;<span class="ident" id="2110787">prec</span><span class="op" id="2110791">,</span>&nbsp;<span class="ident" id="2110793">bitSize</span><span class="op" id="2110800">)</span><span class="op" id="2110801">)</span><br>
<span class="lineno"></span><span class="op" id="2110803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2110806">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2110877">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2110949">func</span>&nbsp;<span class="ident" id="2110954">AppendFloat</span><span class="op" id="2110965">(</span><span class="ident" id="2110966">dst</span>&nbsp;<span class="op" id="2110970">[</span><span class="op" id="2110971">]</span><span class="builtintype" id="2110972">byte</span><span class="op" id="2110976">,</span>&nbsp;<span class="ident" id="2110978">f</span>&nbsp;<span class="builtintype" id="2110980">float64</span><span class="op" id="2110987">,</span>&nbsp;<span class="ident" id="2110989">fmt</span>&nbsp;<span class="builtintype" id="2110993">byte</span><span class="op" id="2110997">,</span>&nbsp;<span class="ident" id="2110999">prec</span>&nbsp;<span class="builtintype" id="2111004">int</span><span class="op" id="2111007">,</span>&nbsp;<span class="ident" id="2111009">bitSize</span>&nbsp;<span class="builtintype" id="2111017">int</span><span class="op" id="2111020">)</span>&nbsp;<span class="op" id="2111022">[</span><span class="op" id="2111023">]</span><span class="builtintype" id="2111024">byte</span>&nbsp;<span class="op" id="2111029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111032">return</span>&nbsp;<span class="ident" id="2111039">genericFtoa</span><span class="op" id="2111050">(</span><span class="ident" id="2111051">dst</span><span class="op" id="2111054">,</span>&nbsp;<span class="ident" id="2111056">f</span><span class="op" id="2111057">,</span>&nbsp;<span class="ident" id="2111059">fmt</span><span class="op" id="2111062">,</span>&nbsp;<span class="ident" id="2111064">prec</span><span class="op" id="2111068">,</span>&nbsp;<span class="ident" id="2111070">bitSize</span><span class="op" id="2111077">)</span><br>
<span class="lineno"></span><span class="op" id="2111079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2111082">func</span>&nbsp;<span class="ident" id="2111087">genericFtoa</span><span class="op" id="2111098">(</span><span class="ident" id="2111099">dst</span>&nbsp;<span class="op" id="2111103">[</span><span class="op" id="2111104">]</span><span class="builtintype" id="2111105">byte</span><span class="op" id="2111109">,</span>&nbsp;<span class="ident" id="2111111">val</span>&nbsp;<span class="builtintype" id="2111115">float64</span><span class="op" id="2111122">,</span>&nbsp;<span class="ident" id="2111124">fmt</span>&nbsp;<span class="builtintype" id="2111128">byte</span><span class="op" id="2111132">,</span>&nbsp;<span class="ident" id="2111134">prec</span><span class="op" id="2111138">,</span>&nbsp;<span class="ident" id="2111140">bitSize</span>&nbsp;<span class="builtintype" id="2111148">int</span><span class="op" id="2111151">)</span>&nbsp;<span class="op" id="2111153">[</span><span class="op" id="2111154">]</span><span class="builtintype" id="2111155">byte</span>&nbsp;<span class="op" id="2111160">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111163">var</span>&nbsp;<span class="ident" id="2111167">bits</span>&nbsp;<span class="ident" id="2111172">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111180">var</span>&nbsp;<span class="ident" id="2111184">flt</span>&nbsp;<span class="op" id="2111188">*</span><span class="ident" id="2111189">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111200">switch</span>&nbsp;<span class="ident" id="2111207">bitSize</span>&nbsp;<span class="op" id="2111215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111218">case</span>&nbsp;<span class="num" id="2111223">32</span><span class="op" id="2111225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111229">bits</span>&nbsp;<span class="op" id="2111234">=</span>&nbsp;<span class="ident" id="2111236">uint64</span><span class="op" id="2111242">(</span><span class="ident" id="2111243">math</span><span class="op" id="2111247">.</span><span class="ident" id="2111248">Float32bits</span><span class="op" id="2111259">(</span><span class="builtintype" id="2111260">float32</span><span class="op" id="2111267">(</span><span class="ident" id="2111268">val</span><span class="op" id="2111271">)</span><span class="op" id="2111272">)</span><span class="op" id="2111273">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111277">flt</span>&nbsp;<span class="op" id="2111281">=</span>&nbsp;<span class="op" id="2111283">&amp;</span><span class="ident" id="2111284">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111297">case</span>&nbsp;<span class="num" id="2111302">64</span><span class="op" id="2111304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111308">bits</span>&nbsp;<span class="op" id="2111313">=</span>&nbsp;<span class="ident" id="2111315">math</span><span class="op" id="2111319">.</span><span class="ident" id="2111320">Float64bits</span><span class="op" id="2111331">(</span><span class="ident" id="2111332">val</span><span class="op" id="2111335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111339">flt</span>&nbsp;<span class="op" id="2111343">=</span>&nbsp;<span class="op" id="2111345">&amp;</span><span class="ident" id="2111346">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111359">default</span><span class="op" id="2111366">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2111370">panic</span><span class="op" id="2111375">(</span><span class="string" id="2111376">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2111426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2111429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111433">neg</span>&nbsp;<span class="op" id="2111437">:=</span>&nbsp;<span class="ident" id="2111440">bits</span><span class="op" id="2111444">&gt;&gt;</span><span class="op" id="2111446">(</span><span class="ident" id="2111447">flt</span><span class="op" id="2111450">.</span><span class="ident" id="2111451">expbits</span><span class="op" id="2111458">+</span><span class="ident" id="2111459">flt</span><span class="op" id="2111462">.</span><span class="ident" id="2111463">mantbits</span><span class="op" id="2111471">)</span>&nbsp;<span class="op" id="2111473">!=</span>&nbsp;<span class="num" id="2111476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111479">exp</span>&nbsp;<span class="op" id="2111483">:=</span>&nbsp;<span class="builtintype" id="2111486">int</span><span class="op" id="2111489">(</span><span class="ident" id="2111490">bits</span><span class="op" id="2111494">&gt;&gt;</span><span class="ident" id="2111496">flt</span><span class="op" id="2111499">.</span><span class="ident" id="2111500">mantbits</span><span class="op" id="2111508">)</span>&nbsp;<span class="op" id="2111510">&amp;</span>&nbsp;<span class="op" id="2111512">(</span><span class="num" id="2111513">1</span><span class="op" id="2111514">&lt;&lt;</span><span class="ident" id="2111516">flt</span><span class="op" id="2111519">.</span><span class="ident" id="2111520">expbits</span>&nbsp;<span class="op" id="2111528">-</span>&nbsp;<span class="num" id="2111530">1</span><span class="op" id="2111531">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111534">mant</span>&nbsp;<span class="op" id="2111539">:=</span>&nbsp;<span class="ident" id="2111542">bits</span>&nbsp;<span class="op" id="2111547">&amp;</span>&nbsp;<span class="op" id="2111549">(</span><span class="ident" id="2111550">uint64</span><span class="op" id="2111556">(</span><span class="num" id="2111557">1</span><span class="op" id="2111558">)</span><span class="op" id="2111559">&lt;&lt;</span><span class="ident" id="2111561">flt</span><span class="op" id="2111564">.</span><span class="ident" id="2111565">mantbits</span>&nbsp;<span class="op" id="2111574">-</span>&nbsp;<span class="num" id="2111576">1</span><span class="op" id="2111577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111581">switch</span>&nbsp;<span class="ident" id="2111588">exp</span>&nbsp;<span class="op" id="2111592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111595">case</span>&nbsp;<span class="num" id="2111600">1</span><span class="op" id="2111601">&lt;&lt;</span><span class="ident" id="2111603">flt</span><span class="op" id="2111606">.</span><span class="ident" id="2111607">expbits</span>&nbsp;<span class="op" id="2111615">-</span>&nbsp;<span class="num" id="2111617">1</span><span class="op" id="2111618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2111622">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111636">var</span>&nbsp;<span class="ident" id="2111640">s</span>&nbsp;<span class="builtintype" id="2111642">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111651">switch</span>&nbsp;<span class="op" id="2111658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111662">case</span>&nbsp;<span class="ident" id="2111667">mant</span>&nbsp;<span class="op" id="2111672">!=</span>&nbsp;<span class="num" id="2111675">0</span><span class="op" id="2111676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111681">s</span>&nbsp;<span class="op" id="2111683">=</span>&nbsp;<span class="string" id="2111685">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111693">case</span>&nbsp;<span class="ident" id="2111698">neg</span><span class="op" id="2111701">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111706">s</span>&nbsp;<span class="op" id="2111708">=</span>&nbsp;<span class="string" id="2111710">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111719">default</span><span class="op" id="2111726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111731">s</span>&nbsp;<span class="op" id="2111733">=</span>&nbsp;<span class="string" id="2111735">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2111744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111748">return</span>&nbsp;<span class="builtinfunc" id="2111755">append</span><span class="op" id="2111761">(</span><span class="ident" id="2111762">dst</span><span class="op" id="2111765">,</span>&nbsp;<span class="ident" id="2111767">s</span><span class="op" id="2111768">...</span><span class="op" id="2111771">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111775">case</span>&nbsp;<span class="num" id="2111780">0</span><span class="op" id="2111781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2111785">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111803">exp</span><span class="op" id="2111806">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111811">default</span><span class="op" id="2111818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2111822">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111848">mant</span>&nbsp;<span class="op" id="2111853">|=</span>&nbsp;<span class="ident" id="2111856">uint64</span><span class="op" id="2111862">(</span><span class="num" id="2111863">1</span><span class="op" id="2111864">)</span>&nbsp;<span class="op" id="2111866">&lt;&lt;</span>&nbsp;<span class="ident" id="2111869">flt</span><span class="op" id="2111872">.</span><span class="ident" id="2111873">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2111883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2111886">exp</span>&nbsp;<span class="op" id="2111890">+=</span>&nbsp;<span class="ident" id="2111893">flt</span><span class="op" id="2111896">.</span><span class="ident" id="2111897">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2111904">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111937">if</span>&nbsp;<span class="ident" id="2111940">fmt</span>&nbsp;<span class="op" id="2111944">==</span>&nbsp;<span class="string" id="2111947">&#39;b&#39;</span>&nbsp;<span class="op" id="2111951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111955">return</span>&nbsp;<span class="ident" id="2111962">fmtB</span><span class="op" id="2111966">(</span><span class="ident" id="2111967">dst</span><span class="op" id="2111970">,</span>&nbsp;<span class="ident" id="2111972">neg</span><span class="op" id="2111975">,</span>&nbsp;<span class="ident" id="2111977">mant</span><span class="op" id="2111981">,</span>&nbsp;<span class="ident" id="2111983">exp</span><span class="op" id="2111986">,</span>&nbsp;<span class="ident" id="2111988">flt</span><span class="op" id="2111991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2111994">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2111998">if</span>&nbsp;<span class="op" id="2112001">!</span><span class="ident" id="2112002">optimize</span>&nbsp;<span class="op" id="2112011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112015">return</span>&nbsp;<span class="ident" id="2112022">bigFtoa</span><span class="op" id="2112029">(</span><span class="ident" id="2112030">dst</span><span class="op" id="2112033">,</span>&nbsp;<span class="ident" id="2112035">prec</span><span class="op" id="2112039">,</span>&nbsp;<span class="ident" id="2112041">fmt</span><span class="op" id="2112044">,</span>&nbsp;<span class="ident" id="2112046">neg</span><span class="op" id="2112049">,</span>&nbsp;<span class="ident" id="2112051">mant</span><span class="op" id="2112055">,</span>&nbsp;<span class="ident" id="2112057">exp</span><span class="op" id="2112060">,</span>&nbsp;<span class="ident" id="2112062">flt</span><span class="op" id="2112065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112072">var</span>&nbsp;<span class="ident" id="2112076">digs</span>&nbsp;<span class="ident" id="2112081">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112095">ok</span>&nbsp;<span class="op" id="2112098">:=</span>&nbsp;<span class="builtintype" id="2112101">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2112108">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112175">shortest</span>&nbsp;<span class="op" id="2112184">:=</span>&nbsp;<span class="ident" id="2112187">prec</span>&nbsp;<span class="op" id="2112192">&lt;</span>&nbsp;<span class="num" id="2112194">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112197">if</span>&nbsp;<span class="ident" id="2112200">shortest</span>&nbsp;<span class="op" id="2112209">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2112213">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112240">f</span>&nbsp;<span class="op" id="2112242">:=</span>&nbsp;<span class="builtinfunc" id="2112245">new</span><span class="op" id="2112248">(</span><span class="ident" id="2112249">extFloat</span><span class="op" id="2112257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112261">lower</span><span class="op" id="2112266">,</span>&nbsp;<span class="ident" id="2112268">upper</span>&nbsp;<span class="op" id="2112274">:=</span>&nbsp;<span class="ident" id="2112277">f</span><span class="op" id="2112278">.</span><span class="ident" id="2112279">AssignComputeBounds</span><span class="op" id="2112298">(</span><span class="ident" id="2112299">mant</span><span class="op" id="2112303">,</span>&nbsp;<span class="ident" id="2112305">exp</span><span class="op" id="2112308">,</span>&nbsp;<span class="ident" id="2112310">neg</span><span class="op" id="2112313">,</span>&nbsp;<span class="ident" id="2112315">flt</span><span class="op" id="2112318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112322">var</span>&nbsp;<span class="ident" id="2112326">buf</span>&nbsp;<span class="op" id="2112330">[</span><span class="num" id="2112331">32</span><span class="op" id="2112333">]</span><span class="builtintype" id="2112334">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112341">digs</span><span class="op" id="2112345">.</span><span class="ident" id="2112346">d</span>&nbsp;<span class="op" id="2112348">=</span>&nbsp;<span class="ident" id="2112350">buf</span><span class="op" id="2112353">[</span><span class="op" id="2112354">:</span><span class="op" id="2112355">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112359">ok</span>&nbsp;<span class="op" id="2112362">=</span>&nbsp;<span class="ident" id="2112364">f</span><span class="op" id="2112365">.</span><span class="ident" id="2112366">ShortestDecimal</span><span class="op" id="2112381">(</span><span class="op" id="2112382">&amp;</span><span class="ident" id="2112383">digs</span><span class="op" id="2112387">,</span>&nbsp;<span class="op" id="2112389">&amp;</span><span class="ident" id="2112390">lower</span><span class="op" id="2112395">,</span>&nbsp;<span class="op" id="2112397">&amp;</span><span class="ident" id="2112398">upper</span><span class="op" id="2112403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112407">if</span>&nbsp;<span class="op" id="2112410">!</span><span class="ident" id="2112411">ok</span>&nbsp;<span class="op" id="2112414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112419">return</span>&nbsp;<span class="ident" id="2112426">bigFtoa</span><span class="op" id="2112433">(</span><span class="ident" id="2112434">dst</span><span class="op" id="2112437">,</span>&nbsp;<span class="ident" id="2112439">prec</span><span class="op" id="2112443">,</span>&nbsp;<span class="ident" id="2112445">fmt</span><span class="op" id="2112448">,</span>&nbsp;<span class="ident" id="2112450">neg</span><span class="op" id="2112453">,</span>&nbsp;<span class="ident" id="2112455">mant</span><span class="op" id="2112459">,</span>&nbsp;<span class="ident" id="2112461">exp</span><span class="op" id="2112464">,</span>&nbsp;<span class="ident" id="2112466">flt</span><span class="op" id="2112469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2112477">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112526">switch</span>&nbsp;<span class="ident" id="2112533">fmt</span>&nbsp;<span class="op" id="2112537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112541">case</span>&nbsp;<span class="string" id="2112546">&#39;e&#39;</span><span class="op" id="2112549">,</span>&nbsp;<span class="string" id="2112551">&#39;E&#39;</span><span class="op" id="2112554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112559">prec</span>&nbsp;<span class="op" id="2112564">=</span>&nbsp;<span class="ident" id="2112566">digs</span><span class="op" id="2112570">.</span><span class="ident" id="2112571">nd</span>&nbsp;<span class="op" id="2112574">-</span>&nbsp;<span class="num" id="2112576">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112580">case</span>&nbsp;<span class="string" id="2112585">&#39;f&#39;</span><span class="op" id="2112588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112593">prec</span>&nbsp;<span class="op" id="2112598">=</span>&nbsp;<span class="ident" id="2112600">max</span><span class="op" id="2112603">(</span><span class="ident" id="2112604">digs</span><span class="op" id="2112608">.</span><span class="ident" id="2112609">nd</span><span class="op" id="2112611">-</span><span class="ident" id="2112612">digs</span><span class="op" id="2112616">.</span><span class="ident" id="2112617">dp</span><span class="op" id="2112619">,</span>&nbsp;<span class="num" id="2112621">0</span><span class="op" id="2112622">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112626">case</span>&nbsp;<span class="string" id="2112631">&#39;g&#39;</span><span class="op" id="2112634">,</span>&nbsp;<span class="string" id="2112636">&#39;G&#39;</span><span class="op" id="2112639">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112644">prec</span>&nbsp;<span class="op" id="2112649">=</span>&nbsp;<span class="ident" id="2112651">digs</span><span class="op" id="2112655">.</span><span class="ident" id="2112656">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112664">}</span>&nbsp;<span class="keyword" id="2112666">else</span>&nbsp;<span class="keyword" id="2112671">if</span>&nbsp;<span class="ident" id="2112674">fmt</span>&nbsp;<span class="op" id="2112678">!=</span>&nbsp;<span class="string" id="2112681">&#39;f&#39;</span>&nbsp;<span class="op" id="2112685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2112689">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112718">digits</span>&nbsp;<span class="op" id="2112725">:=</span>&nbsp;<span class="ident" id="2112728">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112735">switch</span>&nbsp;<span class="ident" id="2112742">fmt</span>&nbsp;<span class="op" id="2112746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112750">case</span>&nbsp;<span class="string" id="2112755">&#39;e&#39;</span><span class="op" id="2112758">,</span>&nbsp;<span class="string" id="2112760">&#39;E&#39;</span><span class="op" id="2112763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112768">digits</span><span class="op" id="2112774">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112779">case</span>&nbsp;<span class="string" id="2112784">&#39;g&#39;</span><span class="op" id="2112787">,</span>&nbsp;<span class="string" id="2112789">&#39;G&#39;</span><span class="op" id="2112792">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112797">if</span>&nbsp;<span class="ident" id="2112800">prec</span>&nbsp;<span class="op" id="2112805">==</span>&nbsp;<span class="num" id="2112808">0</span>&nbsp;<span class="op" id="2112810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112816">prec</span>&nbsp;<span class="op" id="2112821">=</span>&nbsp;<span class="num" id="2112823">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112833">digits</span>&nbsp;<span class="op" id="2112840">=</span>&nbsp;<span class="ident" id="2112842">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2112849">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112853">if</span>&nbsp;<span class="ident" id="2112856">digits</span>&nbsp;<span class="op" id="2112863">&lt;=</span>&nbsp;<span class="num" id="2112866">15</span>&nbsp;<span class="op" id="2112869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2112874">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2112940">var</span>&nbsp;<span class="ident" id="2112944">buf</span>&nbsp;<span class="op" id="2112948">[</span><span class="num" id="2112949">24</span><span class="op" id="2112951">]</span><span class="builtintype" id="2112952">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112960">digs</span><span class="op" id="2112964">.</span><span class="ident" id="2112965">d</span>&nbsp;<span class="op" id="2112967">=</span>&nbsp;<span class="ident" id="2112969">buf</span><span class="op" id="2112972">[</span><span class="op" id="2112973">:</span><span class="op" id="2112974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2112979">f</span>&nbsp;<span class="op" id="2112981">:=</span>&nbsp;<span class="ident" id="2112984">extFloat</span><span class="op" id="2112992">{</span><span class="ident" id="2112993">mant</span><span class="op" id="2112997">,</span>&nbsp;<span class="ident" id="2112999">exp</span>&nbsp;<span class="op" id="2113003">-</span>&nbsp;<span class="builtintype" id="2113005">int</span><span class="op" id="2113008">(</span><span class="ident" id="2113009">flt</span><span class="op" id="2113012">.</span><span class="ident" id="2113013">mantbits</span><span class="op" id="2113021">)</span><span class="op" id="2113022">,</span>&nbsp;<span class="ident" id="2113024">neg</span><span class="op" id="2113027">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113032">ok</span>&nbsp;<span class="op" id="2113035">=</span>&nbsp;<span class="ident" id="2113037">f</span><span class="op" id="2113038">.</span><span class="ident" id="2113039">FixedDecimal</span><span class="op" id="2113051">(</span><span class="op" id="2113052">&amp;</span><span class="ident" id="2113053">digs</span><span class="op" id="2113057">,</span>&nbsp;<span class="ident" id="2113059">digits</span><span class="op" id="2113065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113075">if</span>&nbsp;<span class="op" id="2113078">!</span><span class="ident" id="2113079">ok</span>&nbsp;<span class="op" id="2113082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113086">return</span>&nbsp;<span class="ident" id="2113093">bigFtoa</span><span class="op" id="2113100">(</span><span class="ident" id="2113101">dst</span><span class="op" id="2113104">,</span>&nbsp;<span class="ident" id="2113106">prec</span><span class="op" id="2113110">,</span>&nbsp;<span class="ident" id="2113112">fmt</span><span class="op" id="2113115">,</span>&nbsp;<span class="ident" id="2113117">neg</span><span class="op" id="2113120">,</span>&nbsp;<span class="ident" id="2113122">mant</span><span class="op" id="2113126">,</span>&nbsp;<span class="ident" id="2113128">exp</span><span class="op" id="2113131">,</span>&nbsp;<span class="ident" id="2113133">flt</span><span class="op" id="2113136">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113142">return</span>&nbsp;<span class="ident" id="2113149">formatDigits</span><span class="op" id="2113161">(</span><span class="ident" id="2113162">dst</span><span class="op" id="2113165">,</span>&nbsp;<span class="ident" id="2113167">shortest</span><span class="op" id="2113175">,</span>&nbsp;<span class="ident" id="2113177">neg</span><span class="op" id="2113180">,</span>&nbsp;<span class="ident" id="2113182">digs</span><span class="op" id="2113186">,</span>&nbsp;<span class="ident" id="2113188">prec</span><span class="op" id="2113192">,</span>&nbsp;<span class="ident" id="2113194">fmt</span><span class="op" id="2113197">)</span><br>
<span class="lineno"></span><span class="op" id="2113199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2113202">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2113265">func</span>&nbsp;<span class="ident" id="2113270">bigFtoa</span><span class="op" id="2113277">(</span><span class="ident" id="2113278">dst</span>&nbsp;<span class="op" id="2113282">[</span><span class="op" id="2113283">]</span><span class="builtintype" id="2113284">byte</span><span class="op" id="2113288">,</span>&nbsp;<span class="ident" id="2113290">prec</span>&nbsp;<span class="builtintype" id="2113295">int</span><span class="op" id="2113298">,</span>&nbsp;<span class="ident" id="2113300">fmt</span>&nbsp;<span class="builtintype" id="2113304">byte</span><span class="op" id="2113308">,</span>&nbsp;<span class="ident" id="2113310">neg</span>&nbsp;<span class="builtintype" id="2113314">bool</span><span class="op" id="2113318">,</span>&nbsp;<span class="ident" id="2113320">mant</span>&nbsp;<span class="ident" id="2113325">uint64</span><span class="op" id="2113331">,</span>&nbsp;<span class="ident" id="2113333">exp</span>&nbsp;<span class="builtintype" id="2113337">int</span><span class="op" id="2113340">,</span>&nbsp;<span class="ident" id="2113342">flt</span>&nbsp;<span class="op" id="2113346">*</span><span class="ident" id="2113347">floatInfo</span><span class="op" id="2113356">)</span>&nbsp;<span class="op" id="2113358">[</span><span class="op" id="2113359">]</span><span class="builtintype" id="2113360">byte</span>&nbsp;<span class="op" id="2113365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113368">d</span>&nbsp;<span class="op" id="2113370">:=</span>&nbsp;<span class="builtinfunc" id="2113373">new</span><span class="op" id="2113376">(</span><span class="ident" id="2113377">decimal</span><span class="op" id="2113384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113387">d</span><span class="op" id="2113388">.</span><span class="ident" id="2113389">Assign</span><span class="op" id="2113395">(</span><span class="ident" id="2113396">mant</span><span class="op" id="2113400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113403">d</span><span class="op" id="2113404">.</span><span class="ident" id="2113405">Shift</span><span class="op" id="2113410">(</span><span class="ident" id="2113411">exp</span>&nbsp;<span class="op" id="2113415">-</span>&nbsp;<span class="builtintype" id="2113417">int</span><span class="op" id="2113420">(</span><span class="ident" id="2113421">flt</span><span class="op" id="2113424">.</span><span class="ident" id="2113425">mantbits</span><span class="op" id="2113433">)</span><span class="op" id="2113434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113437">var</span>&nbsp;<span class="ident" id="2113441">digs</span>&nbsp;<span class="ident" id="2113446">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113460">shortest</span>&nbsp;<span class="op" id="2113469">:=</span>&nbsp;<span class="ident" id="2113472">prec</span>&nbsp;<span class="op" id="2113477">&lt;</span>&nbsp;<span class="num" id="2113479">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113482">if</span>&nbsp;<span class="ident" id="2113485">shortest</span>&nbsp;<span class="op" id="2113494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113498">roundShortest</span><span class="op" id="2113511">(</span><span class="ident" id="2113512">d</span><span class="op" id="2113513">,</span>&nbsp;<span class="ident" id="2113515">mant</span><span class="op" id="2113519">,</span>&nbsp;<span class="ident" id="2113521">exp</span><span class="op" id="2113524">,</span>&nbsp;<span class="ident" id="2113526">flt</span><span class="op" id="2113529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113533">digs</span>&nbsp;<span class="op" id="2113538">=</span>&nbsp;<span class="ident" id="2113540">decimalSlice</span><span class="op" id="2113552">{</span><span class="ident" id="2113553">d</span><span class="op" id="2113554">:</span>&nbsp;<span class="ident" id="2113556">d</span><span class="op" id="2113557">.</span><span class="ident" id="2113558">d</span><span class="op" id="2113559">[</span><span class="op" id="2113560">:</span><span class="op" id="2113561">]</span><span class="op" id="2113562">,</span>&nbsp;<span class="ident" id="2113564">nd</span><span class="op" id="2113566">:</span>&nbsp;<span class="ident" id="2113568">d</span><span class="op" id="2113569">.</span><span class="ident" id="2113570">nd</span><span class="op" id="2113572">,</span>&nbsp;<span class="ident" id="2113574">dp</span><span class="op" id="2113576">:</span>&nbsp;<span class="ident" id="2113578">d</span><span class="op" id="2113579">.</span><span class="ident" id="2113580">dp</span><span class="op" id="2113582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2113586">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113635">switch</span>&nbsp;<span class="ident" id="2113642">fmt</span>&nbsp;<span class="op" id="2113646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113650">case</span>&nbsp;<span class="string" id="2113655">&#39;e&#39;</span><span class="op" id="2113658">,</span>&nbsp;<span class="string" id="2113660">&#39;E&#39;</span><span class="op" id="2113663">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113668">prec</span>&nbsp;<span class="op" id="2113673">=</span>&nbsp;<span class="ident" id="2113675">digs</span><span class="op" id="2113679">.</span><span class="ident" id="2113680">nd</span>&nbsp;<span class="op" id="2113683">-</span>&nbsp;<span class="num" id="2113685">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113689">case</span>&nbsp;<span class="string" id="2113694">&#39;f&#39;</span><span class="op" id="2113697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113702">prec</span>&nbsp;<span class="op" id="2113707">=</span>&nbsp;<span class="ident" id="2113709">max</span><span class="op" id="2113712">(</span><span class="ident" id="2113713">digs</span><span class="op" id="2113717">.</span><span class="ident" id="2113718">nd</span><span class="op" id="2113720">-</span><span class="ident" id="2113721">digs</span><span class="op" id="2113725">.</span><span class="ident" id="2113726">dp</span><span class="op" id="2113728">,</span>&nbsp;<span class="num" id="2113730">0</span><span class="op" id="2113731">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113735">case</span>&nbsp;<span class="string" id="2113740">&#39;g&#39;</span><span class="op" id="2113743">,</span>&nbsp;<span class="string" id="2113745">&#39;G&#39;</span><span class="op" id="2113748">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113753">prec</span>&nbsp;<span class="op" id="2113758">=</span>&nbsp;<span class="ident" id="2113760">digs</span><span class="op" id="2113764">.</span><span class="ident" id="2113765">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113773">}</span>&nbsp;<span class="keyword" id="2113775">else</span>&nbsp;<span class="op" id="2113780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2113784">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113810">switch</span>&nbsp;<span class="ident" id="2113817">fmt</span>&nbsp;<span class="op" id="2113821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113825">case</span>&nbsp;<span class="string" id="2113830">&#39;e&#39;</span><span class="op" id="2113833">,</span>&nbsp;<span class="string" id="2113835">&#39;E&#39;</span><span class="op" id="2113838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113843">d</span><span class="op" id="2113844">.</span><span class="ident" id="2113845">Round</span><span class="op" id="2113850">(</span><span class="ident" id="2113851">prec</span>&nbsp;<span class="op" id="2113856">+</span>&nbsp;<span class="num" id="2113858">1</span><span class="op" id="2113859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113863">case</span>&nbsp;<span class="string" id="2113868">&#39;f&#39;</span><span class="op" id="2113871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113876">d</span><span class="op" id="2113877">.</span><span class="ident" id="2113878">Round</span><span class="op" id="2113883">(</span><span class="ident" id="2113884">d</span><span class="op" id="2113885">.</span><span class="ident" id="2113886">dp</span>&nbsp;<span class="op" id="2113889">+</span>&nbsp;<span class="ident" id="2113891">prec</span><span class="op" id="2113895">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113899">case</span>&nbsp;<span class="string" id="2113904">&#39;g&#39;</span><span class="op" id="2113907">,</span>&nbsp;<span class="string" id="2113909">&#39;G&#39;</span><span class="op" id="2113912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2113917">if</span>&nbsp;<span class="ident" id="2113920">prec</span>&nbsp;<span class="op" id="2113925">==</span>&nbsp;<span class="num" id="2113928">0</span>&nbsp;<span class="op" id="2113930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113936">prec</span>&nbsp;<span class="op" id="2113941">=</span>&nbsp;<span class="num" id="2113943">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113953">d</span><span class="op" id="2113954">.</span><span class="ident" id="2113955">Round</span><span class="op" id="2113960">(</span><span class="ident" id="2113961">prec</span><span class="op" id="2113965">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2113969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2113973">digs</span>&nbsp;<span class="op" id="2113978">=</span>&nbsp;<span class="ident" id="2113980">decimalSlice</span><span class="op" id="2113992">{</span><span class="ident" id="2113993">d</span><span class="op" id="2113994">:</span>&nbsp;<span class="ident" id="2113996">d</span><span class="op" id="2113997">.</span><span class="ident" id="2113998">d</span><span class="op" id="2113999">[</span><span class="op" id="2114000">:</span><span class="op" id="2114001">]</span><span class="op" id="2114002">,</span>&nbsp;<span class="ident" id="2114004">nd</span><span class="op" id="2114006">:</span>&nbsp;<span class="ident" id="2114008">d</span><span class="op" id="2114009">.</span><span class="ident" id="2114010">nd</span><span class="op" id="2114012">,</span>&nbsp;<span class="ident" id="2114014">dp</span><span class="op" id="2114016">:</span>&nbsp;<span class="ident" id="2114018">d</span><span class="op" id="2114019">.</span><span class="ident" id="2114020">dp</span><span class="op" id="2114022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114028">return</span>&nbsp;<span class="ident" id="2114035">formatDigits</span><span class="op" id="2114047">(</span><span class="ident" id="2114048">dst</span><span class="op" id="2114051">,</span>&nbsp;<span class="ident" id="2114053">shortest</span><span class="op" id="2114061">,</span>&nbsp;<span class="ident" id="2114063">neg</span><span class="op" id="2114066">,</span>&nbsp;<span class="ident" id="2114068">digs</span><span class="op" id="2114072">,</span>&nbsp;<span class="ident" id="2114074">prec</span><span class="op" id="2114078">,</span>&nbsp;<span class="ident" id="2114080">fmt</span><span class="op" id="2114083">)</span><br>
<span class="lineno"></span><span class="op" id="2114085">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2114088">func</span>&nbsp;<span class="ident" id="2114093">formatDigits</span><span class="op" id="2114105">(</span><span class="ident" id="2114106">dst</span>&nbsp;<span class="op" id="2114110">[</span><span class="op" id="2114111">]</span><span class="builtintype" id="2114112">byte</span><span class="op" id="2114116">,</span>&nbsp;<span class="ident" id="2114118">shortest</span>&nbsp;<span class="builtintype" id="2114127">bool</span><span class="op" id="2114131">,</span>&nbsp;<span class="ident" id="2114133">neg</span>&nbsp;<span class="builtintype" id="2114137">bool</span><span class="op" id="2114141">,</span>&nbsp;<span class="ident" id="2114143">digs</span>&nbsp;<span class="ident" id="2114148">decimalSlice</span><span class="op" id="2114160">,</span>&nbsp;<span class="ident" id="2114162">prec</span>&nbsp;<span class="builtintype" id="2114167">int</span><span class="op" id="2114170">,</span>&nbsp;<span class="ident" id="2114172">fmt</span>&nbsp;<span class="builtintype" id="2114176">byte</span><span class="op" id="2114180">)</span>&nbsp;<span class="op" id="2114182">[</span><span class="op" id="2114183">]</span><span class="builtintype" id="2114184">byte</span>&nbsp;<span class="op" id="2114189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114192">switch</span>&nbsp;<span class="ident" id="2114199">fmt</span>&nbsp;<span class="op" id="2114203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114206">case</span>&nbsp;<span class="string" id="2114211">&#39;e&#39;</span><span class="op" id="2114214">,</span>&nbsp;<span class="string" id="2114216">&#39;E&#39;</span><span class="op" id="2114219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114223">return</span>&nbsp;<span class="ident" id="2114230">fmtE</span><span class="op" id="2114234">(</span><span class="ident" id="2114235">dst</span><span class="op" id="2114238">,</span>&nbsp;<span class="ident" id="2114240">neg</span><span class="op" id="2114243">,</span>&nbsp;<span class="ident" id="2114245">digs</span><span class="op" id="2114249">,</span>&nbsp;<span class="ident" id="2114251">prec</span><span class="op" id="2114255">,</span>&nbsp;<span class="ident" id="2114257">fmt</span><span class="op" id="2114260">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114263">case</span>&nbsp;<span class="string" id="2114268">&#39;f&#39;</span><span class="op" id="2114271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114275">return</span>&nbsp;<span class="ident" id="2114282">fmtF</span><span class="op" id="2114286">(</span><span class="ident" id="2114287">dst</span><span class="op" id="2114290">,</span>&nbsp;<span class="ident" id="2114292">neg</span><span class="op" id="2114295">,</span>&nbsp;<span class="ident" id="2114297">digs</span><span class="op" id="2114301">,</span>&nbsp;<span class="ident" id="2114303">prec</span><span class="op" id="2114307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114310">case</span>&nbsp;<span class="string" id="2114315">&#39;g&#39;</span><span class="op" id="2114318">,</span>&nbsp;<span class="string" id="2114320">&#39;G&#39;</span><span class="op" id="2114323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2114327">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114387">eprec</span>&nbsp;<span class="op" id="2114393">:=</span>&nbsp;<span class="ident" id="2114396">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114403">if</span>&nbsp;<span class="ident" id="2114406">eprec</span>&nbsp;<span class="op" id="2114412">&gt;</span>&nbsp;<span class="ident" id="2114414">digs</span><span class="op" id="2114418">.</span><span class="ident" id="2114419">nd</span>&nbsp;<span class="op" id="2114422">&amp;&amp;</span>&nbsp;<span class="ident" id="2114425">digs</span><span class="op" id="2114429">.</span><span class="ident" id="2114430">nd</span>&nbsp;<span class="op" id="2114433">&gt;=</span>&nbsp;<span class="ident" id="2114436">digs</span><span class="op" id="2114440">.</span><span class="ident" id="2114441">dp</span>&nbsp;<span class="op" id="2114444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114449">eprec</span>&nbsp;<span class="op" id="2114455">=</span>&nbsp;<span class="ident" id="2114457">digs</span><span class="op" id="2114461">.</span><span class="ident" id="2114462">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2114471">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2114523">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2114587">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114667">if</span>&nbsp;<span class="ident" id="2114670">shortest</span>&nbsp;<span class="op" id="2114679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114684">eprec</span>&nbsp;<span class="op" id="2114690">=</span>&nbsp;<span class="num" id="2114692">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114700">exp</span>&nbsp;<span class="op" id="2114704">:=</span>&nbsp;<span class="ident" id="2114707">digs</span><span class="op" id="2114711">.</span><span class="ident" id="2114712">dp</span>&nbsp;<span class="op" id="2114715">-</span>&nbsp;<span class="num" id="2114717">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114721">if</span>&nbsp;<span class="ident" id="2114724">exp</span>&nbsp;<span class="op" id="2114728">&lt;</span>&nbsp;<span class="op" id="2114730">-</span><span class="num" id="2114731">4</span>&nbsp;<span class="op" id="2114733">||</span>&nbsp;<span class="ident" id="2114736">exp</span>&nbsp;<span class="op" id="2114740">&gt;=</span>&nbsp;<span class="ident" id="2114743">eprec</span>&nbsp;<span class="op" id="2114749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114754">if</span>&nbsp;<span class="ident" id="2114757">prec</span>&nbsp;<span class="op" id="2114762">&gt;</span>&nbsp;<span class="ident" id="2114764">digs</span><span class="op" id="2114768">.</span><span class="ident" id="2114769">nd</span>&nbsp;<span class="op" id="2114772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114778">prec</span>&nbsp;<span class="op" id="2114783">=</span>&nbsp;<span class="ident" id="2114785">digs</span><span class="op" id="2114789">.</span><span class="ident" id="2114790">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114801">return</span>&nbsp;<span class="ident" id="2114808">fmtE</span><span class="op" id="2114812">(</span><span class="ident" id="2114813">dst</span><span class="op" id="2114816">,</span>&nbsp;<span class="ident" id="2114818">neg</span><span class="op" id="2114821">,</span>&nbsp;<span class="ident" id="2114823">digs</span><span class="op" id="2114827">,</span>&nbsp;<span class="ident" id="2114829">prec</span><span class="op" id="2114833">-</span><span class="num" id="2114834">1</span><span class="op" id="2114835">,</span>&nbsp;<span class="ident" id="2114837">fmt</span><span class="op" id="2114840">+</span><span class="string" id="2114841">&#39;e&#39;</span><span class="op" id="2114844">-</span><span class="string" id="2114845">&#39;g&#39;</span><span class="op" id="2114848">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114856">if</span>&nbsp;<span class="ident" id="2114859">prec</span>&nbsp;<span class="op" id="2114864">&gt;</span>&nbsp;<span class="ident" id="2114866">digs</span><span class="op" id="2114870">.</span><span class="ident" id="2114871">dp</span>&nbsp;<span class="op" id="2114874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2114879">prec</span>&nbsp;<span class="op" id="2114884">=</span>&nbsp;<span class="ident" id="2114886">digs</span><span class="op" id="2114890">.</span><span class="ident" id="2114891">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114900">return</span>&nbsp;<span class="ident" id="2114907">fmtF</span><span class="op" id="2114911">(</span><span class="ident" id="2114912">dst</span><span class="op" id="2114915">,</span>&nbsp;<span class="ident" id="2114917">neg</span><span class="op" id="2114920">,</span>&nbsp;<span class="ident" id="2114922">digs</span><span class="op" id="2114926">,</span>&nbsp;<span class="ident" id="2114928">max</span><span class="op" id="2114931">(</span><span class="ident" id="2114932">prec</span><span class="op" id="2114936">-</span><span class="ident" id="2114937">digs</span><span class="op" id="2114941">.</span><span class="ident" id="2114942">dp</span><span class="op" id="2114944">,</span>&nbsp;<span class="num" id="2114946">0</span><span class="op" id="2114947">)</span><span class="op" id="2114948">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2114951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2114955">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2114974">return</span>&nbsp;<span class="builtinfunc" id="2114981">append</span><span class="op" id="2114987">(</span><span class="ident" id="2114988">dst</span><span class="op" id="2114991">,</span>&nbsp;<span class="string" id="2114993">&#39;%&#39;</span><span class="op" id="2114996">,</span>&nbsp;<span class="ident" id="2114998">fmt</span><span class="op" id="2115001">)</span><br>
<span class="lineno"></span><span class="op" id="2115003">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2115006">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2115067">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2115131">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2115199">func</span>&nbsp;<span class="ident" id="2115204">roundShortest</span><span class="op" id="2115217">(</span><span class="ident" id="2115218">d</span>&nbsp;<span class="op" id="2115220">*</span><span class="ident" id="2115221">decimal</span><span class="op" id="2115228">,</span>&nbsp;<span class="ident" id="2115230">mant</span>&nbsp;<span class="ident" id="2115235">uint64</span><span class="op" id="2115241">,</span>&nbsp;<span class="ident" id="2115243">exp</span>&nbsp;<span class="builtintype" id="2115247">int</span><span class="op" id="2115250">,</span>&nbsp;<span class="ident" id="2115252">flt</span>&nbsp;<span class="op" id="2115256">*</span><span class="ident" id="2115257">floatInfo</span><span class="op" id="2115266">)</span>&nbsp;<span class="op" id="2115268">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115271">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2115326">if</span>&nbsp;<span class="ident" id="2115329">mant</span>&nbsp;<span class="op" id="2115334">==</span>&nbsp;<span class="num" id="2115337">0</span>&nbsp;<span class="op" id="2115339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2115343">d</span><span class="op" id="2115344">.</span><span class="ident" id="2115345">nd</span>&nbsp;<span class="op" id="2115348">=</span>&nbsp;<span class="num" id="2115350">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2115354">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2115362">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115366">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115423">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115472">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115527">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115587">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115591">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115650">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115710">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115768">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115798">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115802">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115874">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2115927">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2115996">minexp</span>&nbsp;<span class="op" id="2116003">:=</span>&nbsp;<span class="ident" id="2116006">flt</span><span class="op" id="2116009">.</span><span class="ident" id="2116010">bias</span>&nbsp;<span class="op" id="2116015">+</span>&nbsp;<span class="num" id="2116017">1</span>&nbsp;<span class="comment" id="2116019">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2116049">if</span>&nbsp;<span class="ident" id="2116052">exp</span>&nbsp;<span class="op" id="2116056">&gt;</span>&nbsp;<span class="ident" id="2116058">minexp</span>&nbsp;<span class="op" id="2116065">&amp;&amp;</span>&nbsp;<span class="num" id="2116068">332</span><span class="op" id="2116071">*</span><span class="op" id="2116072">(</span><span class="ident" id="2116073">d</span><span class="op" id="2116074">.</span><span class="ident" id="2116075">dp</span><span class="op" id="2116077">-</span><span class="ident" id="2116078">d</span><span class="op" id="2116079">.</span><span class="ident" id="2116080">nd</span><span class="op" id="2116082">)</span>&nbsp;<span class="op" id="2116084">&gt;=</span>&nbsp;<span class="num" id="2116087">100</span><span class="op" id="2116090">*</span><span class="op" id="2116091">(</span><span class="ident" id="2116092">exp</span><span class="op" id="2116095">-</span><span class="builtintype" id="2116096">int</span><span class="op" id="2116099">(</span><span class="ident" id="2116100">flt</span><span class="op" id="2116103">.</span><span class="ident" id="2116104">mantbits</span><span class="op" id="2116112">)</span><span class="op" id="2116113">)</span>&nbsp;<span class="op" id="2116115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116119">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2116156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2116164">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116168">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116201">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116267">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116335">upper</span>&nbsp;<span class="op" id="2116341">:=</span>&nbsp;<span class="builtinfunc" id="2116344">new</span><span class="op" id="2116347">(</span><span class="ident" id="2116348">decimal</span><span class="op" id="2116355">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116358">upper</span><span class="op" id="2116363">.</span><span class="ident" id="2116364">Assign</span><span class="op" id="2116370">(</span><span class="ident" id="2116371">mant</span><span class="op" id="2116375">*</span><span class="num" id="2116376">2</span>&nbsp;<span class="op" id="2116378">+</span>&nbsp;<span class="num" id="2116380">1</span><span class="op" id="2116381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116384">upper</span><span class="op" id="2116389">.</span><span class="ident" id="2116390">Shift</span><span class="op" id="2116395">(</span><span class="ident" id="2116396">exp</span>&nbsp;<span class="op" id="2116400">-</span>&nbsp;<span class="builtintype" id="2116402">int</span><span class="op" id="2116405">(</span><span class="ident" id="2116406">flt</span><span class="op" id="2116409">.</span><span class="ident" id="2116410">mantbits</span><span class="op" id="2116418">)</span>&nbsp;<span class="op" id="2116420">-</span>&nbsp;<span class="num" id="2116422">1</span><span class="op" id="2116423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116427">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116460">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116525">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116601">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116666">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2116716">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2116788">var</span>&nbsp;<span class="ident" id="2116792">mantlo</span>&nbsp;<span class="ident" id="2116799">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2116807">var</span>&nbsp;<span class="ident" id="2116811">explo</span>&nbsp;<span class="builtintype" id="2116817">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2116822">if</span>&nbsp;<span class="ident" id="2116825">mant</span>&nbsp;<span class="op" id="2116830">&gt;</span>&nbsp;<span class="num" id="2116832">1</span><span class="op" id="2116833">&lt;&lt;</span><span class="ident" id="2116835">flt</span><span class="op" id="2116838">.</span><span class="ident" id="2116839">mantbits</span>&nbsp;<span class="op" id="2116848">||</span>&nbsp;<span class="ident" id="2116851">exp</span>&nbsp;<span class="op" id="2116855">==</span>&nbsp;<span class="ident" id="2116858">minexp</span>&nbsp;<span class="op" id="2116865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116869">mantlo</span>&nbsp;<span class="op" id="2116876">=</span>&nbsp;<span class="ident" id="2116878">mant</span>&nbsp;<span class="op" id="2116883">-</span>&nbsp;<span class="num" id="2116885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116889">explo</span>&nbsp;<span class="op" id="2116895">=</span>&nbsp;<span class="ident" id="2116897">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2116902">}</span>&nbsp;<span class="keyword" id="2116904">else</span>&nbsp;<span class="op" id="2116909">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116913">mantlo</span>&nbsp;<span class="op" id="2116920">=</span>&nbsp;<span class="ident" id="2116922">mant</span><span class="op" id="2116926">*</span><span class="num" id="2116927">2</span>&nbsp;<span class="op" id="2116929">-</span>&nbsp;<span class="num" id="2116931">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116935">explo</span>&nbsp;<span class="op" id="2116941">=</span>&nbsp;<span class="ident" id="2116943">exp</span>&nbsp;<span class="op" id="2116947">-</span>&nbsp;<span class="num" id="2116949">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2116952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116955">lower</span>&nbsp;<span class="op" id="2116961">:=</span>&nbsp;<span class="builtinfunc" id="2116964">new</span><span class="op" id="2116967">(</span><span class="ident" id="2116968">decimal</span><span class="op" id="2116975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2116978">lower</span><span class="op" id="2116983">.</span><span class="ident" id="2116984">Assign</span><span class="op" id="2116990">(</span><span class="ident" id="2116991">mantlo</span><span class="op" id="2116997">*</span><span class="num" id="2116998">2</span>&nbsp;<span class="op" id="2117000">+</span>&nbsp;<span class="num" id="2117002">1</span><span class="op" id="2117003">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117006">lower</span><span class="op" id="2117011">.</span><span class="ident" id="2117012">Shift</span><span class="op" id="2117017">(</span><span class="ident" id="2117018">explo</span>&nbsp;<span class="op" id="2117024">-</span>&nbsp;<span class="builtintype" id="2117026">int</span><span class="op" id="2117029">(</span><span class="ident" id="2117030">flt</span><span class="op" id="2117033">.</span><span class="ident" id="2117034">mantbits</span><span class="op" id="2117042">)</span>&nbsp;<span class="op" id="2117044">-</span>&nbsp;<span class="num" id="2117046">1</span><span class="op" id="2117047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117051">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117111">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117173">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117237">inclusive</span>&nbsp;<span class="op" id="2117247">:=</span>&nbsp;<span class="ident" id="2117250">mant</span><span class="op" id="2117254">%</span><span class="num" id="2117255">2</span>&nbsp;<span class="op" id="2117257">==</span>&nbsp;<span class="num" id="2117260">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117264">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117329">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2117399">for</span>&nbsp;<span class="ident" id="2117403">i</span>&nbsp;<span class="op" id="2117405">:=</span>&nbsp;<span class="num" id="2117408">0</span><span class="op" id="2117409">;</span>&nbsp;<span class="ident" id="2117411">i</span>&nbsp;<span class="op" id="2117413">&lt;</span>&nbsp;<span class="ident" id="2117415">d</span><span class="op" id="2117416">.</span><span class="ident" id="2117417">nd</span><span class="op" id="2117419">;</span>&nbsp;<span class="ident" id="2117421">i</span><span class="op" id="2117422">++</span>&nbsp;<span class="op" id="2117425">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2117429">var</span>&nbsp;<span class="ident" id="2117433">l</span><span class="op" id="2117434">,</span>&nbsp;<span class="ident" id="2117436">m</span><span class="op" id="2117437">,</span>&nbsp;<span class="ident" id="2117439">u</span>&nbsp;<span class="builtintype" id="2117441">byte</span>&nbsp;<span class="comment" id="2117446">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2117479">if</span>&nbsp;<span class="ident" id="2117482">i</span>&nbsp;<span class="op" id="2117484">&lt;</span>&nbsp;<span class="ident" id="2117486">lower</span><span class="op" id="2117491">.</span><span class="ident" id="2117492">nd</span>&nbsp;<span class="op" id="2117495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117500">l</span>&nbsp;<span class="op" id="2117502">=</span>&nbsp;<span class="ident" id="2117504">lower</span><span class="op" id="2117509">.</span><span class="ident" id="2117510">d</span><span class="op" id="2117511">[</span><span class="ident" id="2117512">i</span><span class="op" id="2117513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2117517">}</span>&nbsp;<span class="keyword" id="2117519">else</span>&nbsp;<span class="op" id="2117524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117529">l</span>&nbsp;<span class="op" id="2117531">=</span>&nbsp;<span class="string" id="2117533">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2117539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117543">m</span>&nbsp;<span class="op" id="2117545">=</span>&nbsp;<span class="ident" id="2117547">d</span><span class="op" id="2117548">.</span><span class="ident" id="2117549">d</span><span class="op" id="2117550">[</span><span class="ident" id="2117551">i</span><span class="op" id="2117552">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2117556">if</span>&nbsp;<span class="ident" id="2117559">i</span>&nbsp;<span class="op" id="2117561">&lt;</span>&nbsp;<span class="ident" id="2117563">upper</span><span class="op" id="2117568">.</span><span class="ident" id="2117569">nd</span>&nbsp;<span class="op" id="2117572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117577">u</span>&nbsp;<span class="op" id="2117579">=</span>&nbsp;<span class="ident" id="2117581">upper</span><span class="op" id="2117586">.</span><span class="ident" id="2117587">d</span><span class="op" id="2117588">[</span><span class="ident" id="2117589">i</span><span class="op" id="2117590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2117594">}</span>&nbsp;<span class="keyword" id="2117596">else</span>&nbsp;<span class="op" id="2117601">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117606">u</span>&nbsp;<span class="op" id="2117608">=</span>&nbsp;<span class="string" id="2117610">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2117616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117621">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117687">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117761">okdown</span>&nbsp;<span class="op" id="2117768">:=</span>&nbsp;<span class="ident" id="2117771">l</span>&nbsp;<span class="op" id="2117773">!=</span>&nbsp;<span class="ident" id="2117776">m</span>&nbsp;<span class="op" id="2117778">||</span>&nbsp;<span class="op" id="2117781">(</span><span class="ident" id="2117782">inclusive</span>&nbsp;<span class="op" id="2117792">&amp;&amp;</span>&nbsp;<span class="ident" id="2117795">l</span>&nbsp;<span class="op" id="2117797">==</span>&nbsp;<span class="ident" id="2117800">m</span>&nbsp;<span class="op" id="2117802">&amp;&amp;</span>&nbsp;<span class="ident" id="2117805">i</span><span class="op" id="2117806">+</span><span class="num" id="2117807">1</span>&nbsp;<span class="op" id="2117809">==</span>&nbsp;<span class="ident" id="2117812">lower</span><span class="op" id="2117817">.</span><span class="ident" id="2117818">nd</span><span class="op" id="2117820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117825">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2117882">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2117964">okup</span>&nbsp;<span class="op" id="2117969">:=</span>&nbsp;<span class="ident" id="2117972">m</span>&nbsp;<span class="op" id="2117974">!=</span>&nbsp;<span class="ident" id="2117977">u</span>&nbsp;<span class="op" id="2117979">&amp;&amp;</span>&nbsp;<span class="op" id="2117982">(</span><span class="ident" id="2117983">inclusive</span>&nbsp;<span class="op" id="2117993">||</span>&nbsp;<span class="ident" id="2117996">m</span><span class="op" id="2117997">+</span><span class="num" id="2117998">1</span>&nbsp;<span class="op" id="2118000">&lt;</span>&nbsp;<span class="ident" id="2118002">u</span>&nbsp;<span class="op" id="2118004">||</span>&nbsp;<span class="ident" id="2118007">i</span><span class="op" id="2118008">+</span><span class="num" id="2118009">1</span>&nbsp;<span class="op" id="2118011">&lt;</span>&nbsp;<span class="ident" id="2118013">upper</span><span class="op" id="2118018">.</span><span class="ident" id="2118019">nd</span><span class="op" id="2118021">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118026">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118089">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118130">switch</span>&nbsp;<span class="op" id="2118137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118141">case</span>&nbsp;<span class="ident" id="2118146">okdown</span>&nbsp;<span class="op" id="2118153">&amp;&amp;</span>&nbsp;<span class="ident" id="2118156">okup</span><span class="op" id="2118160">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118165">d</span><span class="op" id="2118166">.</span><span class="ident" id="2118167">Round</span><span class="op" id="2118172">(</span><span class="ident" id="2118173">i</span>&nbsp;<span class="op" id="2118175">+</span>&nbsp;<span class="num" id="2118177">1</span><span class="op" id="2118178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118183">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118192">case</span>&nbsp;<span class="ident" id="2118197">okdown</span><span class="op" id="2118203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118208">d</span><span class="op" id="2118209">.</span><span class="ident" id="2118210">RoundDown</span><span class="op" id="2118219">(</span><span class="ident" id="2118220">i</span>&nbsp;<span class="op" id="2118222">+</span>&nbsp;<span class="num" id="2118224">1</span><span class="op" id="2118225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118230">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118239">case</span>&nbsp;<span class="ident" id="2118244">okup</span><span class="op" id="2118248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118253">d</span><span class="op" id="2118254">.</span><span class="ident" id="2118255">RoundUp</span><span class="op" id="2118262">(</span><span class="ident" id="2118263">i</span>&nbsp;<span class="op" id="2118265">+</span>&nbsp;<span class="num" id="2118267">1</span><span class="op" id="2118268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118273">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118285">}</span><br>
<span class="lineno">325</span><span class="op" id="2118287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2118290">type</span>&nbsp;<span class="ident" id="2118295">decimalSlice</span>&nbsp;<span class="keyword" id="2118308">struct</span>&nbsp;<span class="op" id="2118315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118318">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118325">[</span><span class="op" id="2118326">]</span><span class="builtintype" id="2118327">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118333">nd</span><span class="op" id="2118335">,</span>&nbsp;<span class="ident" id="2118337">dp</span>&nbsp;<span class="builtintype" id="2118340">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118345">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2118352">bool</span><br>
<span class="lineno"></span><span class="op" id="2118357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2118360">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2118381">func</span>&nbsp;<span class="ident" id="2118386">fmtE</span><span class="op" id="2118390">(</span><span class="ident" id="2118391">dst</span>&nbsp;<span class="op" id="2118395">[</span><span class="op" id="2118396">]</span><span class="builtintype" id="2118397">byte</span><span class="op" id="2118401">,</span>&nbsp;<span class="ident" id="2118403">neg</span>&nbsp;<span class="builtintype" id="2118407">bool</span><span class="op" id="2118411">,</span>&nbsp;<span class="ident" id="2118413">d</span>&nbsp;<span class="ident" id="2118415">decimalSlice</span><span class="op" id="2118427">,</span>&nbsp;<span class="ident" id="2118429">prec</span>&nbsp;<span class="builtintype" id="2118434">int</span><span class="op" id="2118437">,</span>&nbsp;<span class="ident" id="2118439">fmt</span>&nbsp;<span class="builtintype" id="2118443">byte</span><span class="op" id="2118447">)</span>&nbsp;<span class="op" id="2118449">[</span><span class="op" id="2118450">]</span><span class="builtintype" id="2118451">byte</span>&nbsp;<span class="op" id="2118456">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118459">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118468">if</span>&nbsp;<span class="ident" id="2118471">neg</span>&nbsp;<span class="op" id="2118475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118479">dst</span>&nbsp;<span class="op" id="2118483">=</span>&nbsp;<span class="builtinfunc" id="2118485">append</span><span class="op" id="2118491">(</span><span class="ident" id="2118492">dst</span><span class="op" id="2118495">,</span>&nbsp;<span class="string" id="2118497">&#39;-&#39;</span><span class="op" id="2118500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118507">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118523">ch</span>&nbsp;<span class="op" id="2118526">:=</span>&nbsp;<span class="builtintype" id="2118529">byte</span><span class="op" id="2118533">(</span><span class="string" id="2118534">&#39;0&#39;</span><span class="op" id="2118537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118540">if</span>&nbsp;<span class="ident" id="2118543">d</span><span class="op" id="2118544">.</span><span class="ident" id="2118545">nd</span>&nbsp;<span class="op" id="2118548">!=</span>&nbsp;<span class="num" id="2118551">0</span>&nbsp;<span class="op" id="2118553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118557">ch</span>&nbsp;<span class="op" id="2118560">=</span>&nbsp;<span class="ident" id="2118562">d</span><span class="op" id="2118563">.</span><span class="ident" id="2118564">d</span><span class="op" id="2118565">[</span><span class="num" id="2118566">0</span><span class="op" id="2118567">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118570">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118573">dst</span>&nbsp;<span class="op" id="2118577">=</span>&nbsp;<span class="builtinfunc" id="2118579">append</span><span class="op" id="2118585">(</span><span class="ident" id="2118586">dst</span><span class="op" id="2118589">,</span>&nbsp;<span class="ident" id="2118591">ch</span><span class="op" id="2118593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118597">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118613">if</span>&nbsp;<span class="ident" id="2118616">prec</span>&nbsp;<span class="op" id="2118621">&gt;</span>&nbsp;<span class="num" id="2118623">0</span>&nbsp;<span class="op" id="2118625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118629">dst</span>&nbsp;<span class="op" id="2118633">=</span>&nbsp;<span class="builtinfunc" id="2118635">append</span><span class="op" id="2118641">(</span><span class="ident" id="2118642">dst</span><span class="op" id="2118645">,</span>&nbsp;<span class="string" id="2118647">&#39;.&#39;</span><span class="op" id="2118650">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118654">i</span>&nbsp;<span class="op" id="2118656">:=</span>&nbsp;<span class="num" id="2118659">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118663">m</span>&nbsp;<span class="op" id="2118665">:=</span>&nbsp;<span class="ident" id="2118668">d</span><span class="op" id="2118669">.</span><span class="ident" id="2118670">nd</span>&nbsp;<span class="op" id="2118673">+</span>&nbsp;<span class="ident" id="2118675">prec</span>&nbsp;<span class="op" id="2118680">+</span>&nbsp;<span class="num" id="2118682">1</span>&nbsp;<span class="op" id="2118684">-</span>&nbsp;<span class="ident" id="2118686">max</span><span class="op" id="2118689">(</span><span class="ident" id="2118690">d</span><span class="op" id="2118691">.</span><span class="ident" id="2118692">nd</span><span class="op" id="2118694">,</span>&nbsp;<span class="ident" id="2118696">prec</span><span class="op" id="2118700">+</span><span class="num" id="2118701">1</span><span class="op" id="2118702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118706">for</span>&nbsp;<span class="ident" id="2118710">i</span>&nbsp;<span class="op" id="2118712">&lt;</span>&nbsp;<span class="ident" id="2118714">m</span>&nbsp;<span class="op" id="2118716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118721">dst</span>&nbsp;<span class="op" id="2118725">=</span>&nbsp;<span class="builtinfunc" id="2118727">append</span><span class="op" id="2118733">(</span><span class="ident" id="2118734">dst</span><span class="op" id="2118737">,</span>&nbsp;<span class="ident" id="2118739">d</span><span class="op" id="2118740">.</span><span class="ident" id="2118741">d</span><span class="op" id="2118742">[</span><span class="ident" id="2118743">i</span><span class="op" id="2118744">]</span><span class="op" id="2118745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118750">i</span><span class="op" id="2118751">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118760">for</span>&nbsp;<span class="ident" id="2118764">i</span>&nbsp;<span class="op" id="2118766">&lt;=</span>&nbsp;<span class="ident" id="2118769">prec</span>&nbsp;<span class="op" id="2118774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118779">dst</span>&nbsp;<span class="op" id="2118783">=</span>&nbsp;<span class="builtinfunc" id="2118785">append</span><span class="op" id="2118791">(</span><span class="ident" id="2118792">dst</span><span class="op" id="2118795">,</span>&nbsp;<span class="string" id="2118797">&#39;0&#39;</span><span class="op" id="2118800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118805">i</span><span class="op" id="2118806">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118811">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2118818">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118826">dst</span>&nbsp;<span class="op" id="2118830">=</span>&nbsp;<span class="builtinfunc" id="2118832">append</span><span class="op" id="2118838">(</span><span class="ident" id="2118839">dst</span><span class="op" id="2118842">,</span>&nbsp;<span class="ident" id="2118844">fmt</span><span class="op" id="2118847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118850">exp</span>&nbsp;<span class="op" id="2118854">:=</span>&nbsp;<span class="ident" id="2118857">d</span><span class="op" id="2118858">.</span><span class="ident" id="2118859">dp</span>&nbsp;<span class="op" id="2118862">-</span>&nbsp;<span class="num" id="2118864">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118867">if</span>&nbsp;<span class="ident" id="2118870">d</span><span class="op" id="2118871">.</span><span class="ident" id="2118872">nd</span>&nbsp;<span class="op" id="2118875">==</span>&nbsp;<span class="num" id="2118878">0</span>&nbsp;<span class="op" id="2118880">{</span>&nbsp;<span class="comment" id="2118882">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118918">exp</span>&nbsp;<span class="op" id="2118922">=</span>&nbsp;<span class="num" id="2118924">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2118930">if</span>&nbsp;<span class="ident" id="2118933">exp</span>&nbsp;<span class="op" id="2118937">&lt;</span>&nbsp;<span class="num" id="2118939">0</span>&nbsp;<span class="op" id="2118941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118945">ch</span>&nbsp;<span class="op" id="2118948">=</span>&nbsp;<span class="string" id="2118950">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118956">exp</span>&nbsp;<span class="op" id="2118960">=</span>&nbsp;<span class="op" id="2118962">-</span><span class="ident" id="2118963">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118968">}</span>&nbsp;<span class="keyword" id="2118970">else</span>&nbsp;<span class="op" id="2118975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118979">ch</span>&nbsp;<span class="op" id="2118982">=</span>&nbsp;<span class="string" id="2118984">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2118989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2118992">dst</span>&nbsp;<span class="op" id="2118996">=</span>&nbsp;<span class="builtinfunc" id="2118998">append</span><span class="op" id="2119004">(</span><span class="ident" id="2119005">dst</span><span class="op" id="2119008">,</span>&nbsp;<span class="ident" id="2119010">ch</span><span class="op" id="2119012">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119016">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119025">var</span>&nbsp;<span class="ident" id="2119029">buf</span>&nbsp;<span class="op" id="2119033">[</span><span class="num" id="2119034">3</span><span class="op" id="2119035">]</span><span class="builtintype" id="2119036">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119042">i</span>&nbsp;<span class="op" id="2119044">:=</span>&nbsp;<span class="builtinfunc" id="2119047">len</span><span class="op" id="2119050">(</span><span class="ident" id="2119051">buf</span><span class="op" id="2119054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119057">for</span>&nbsp;<span class="ident" id="2119061">exp</span>&nbsp;<span class="op" id="2119065">&gt;=</span>&nbsp;<span class="num" id="2119068">10</span>&nbsp;<span class="op" id="2119071">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119075">i</span><span class="op" id="2119076">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119081">buf</span><span class="op" id="2119084">[</span><span class="ident" id="2119085">i</span><span class="op" id="2119086">]</span>&nbsp;<span class="op" id="2119088">=</span>&nbsp;<span class="builtintype" id="2119090">byte</span><span class="op" id="2119094">(</span><span class="ident" id="2119095">exp</span><span class="op" id="2119098">%</span><span class="num" id="2119099">10</span>&nbsp;<span class="op" id="2119102">+</span>&nbsp;<span class="string" id="2119104">&#39;0&#39;</span><span class="op" id="2119107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119111">exp</span>&nbsp;<span class="op" id="2119115">/=</span>&nbsp;<span class="num" id="2119118">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119125">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119138">i</span><span class="op" id="2119139">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119143">buf</span><span class="op" id="2119146">[</span><span class="ident" id="2119147">i</span><span class="op" id="2119148">]</span>&nbsp;<span class="op" id="2119150">=</span>&nbsp;<span class="builtintype" id="2119152">byte</span><span class="op" id="2119156">(</span><span class="ident" id="2119157">exp</span>&nbsp;<span class="op" id="2119161">+</span>&nbsp;<span class="string" id="2119163">&#39;0&#39;</span><span class="op" id="2119166">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119170">switch</span>&nbsp;<span class="ident" id="2119177">i</span>&nbsp;<span class="op" id="2119179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119182">case</span>&nbsp;<span class="num" id="2119187">0</span><span class="op" id="2119188">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119192">dst</span>&nbsp;<span class="op" id="2119196">=</span>&nbsp;<span class="builtinfunc" id="2119198">append</span><span class="op" id="2119204">(</span><span class="ident" id="2119205">dst</span><span class="op" id="2119208">,</span>&nbsp;<span class="ident" id="2119210">buf</span><span class="op" id="2119213">[</span><span class="num" id="2119214">0</span><span class="op" id="2119215">]</span><span class="op" id="2119216">,</span>&nbsp;<span class="ident" id="2119218">buf</span><span class="op" id="2119221">[</span><span class="num" id="2119222">1</span><span class="op" id="2119223">]</span><span class="op" id="2119224">,</span>&nbsp;<span class="ident" id="2119226">buf</span><span class="op" id="2119229">[</span><span class="num" id="2119230">2</span><span class="op" id="2119231">]</span><span class="op" id="2119232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119235">case</span>&nbsp;<span class="num" id="2119240">1</span><span class="op" id="2119241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119245">dst</span>&nbsp;<span class="op" id="2119249">=</span>&nbsp;<span class="builtinfunc" id="2119251">append</span><span class="op" id="2119257">(</span><span class="ident" id="2119258">dst</span><span class="op" id="2119261">,</span>&nbsp;<span class="ident" id="2119263">buf</span><span class="op" id="2119266">[</span><span class="num" id="2119267">1</span><span class="op" id="2119268">]</span><span class="op" id="2119269">,</span>&nbsp;<span class="ident" id="2119271">buf</span><span class="op" id="2119274">[</span><span class="num" id="2119275">2</span><span class="op" id="2119276">]</span><span class="op" id="2119277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119280">case</span>&nbsp;<span class="num" id="2119285">2</span><span class="op" id="2119286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119290">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119310">dst</span>&nbsp;<span class="op" id="2119314">=</span>&nbsp;<span class="builtinfunc" id="2119316">append</span><span class="op" id="2119322">(</span><span class="ident" id="2119323">dst</span><span class="op" id="2119326">,</span>&nbsp;<span class="string" id="2119328">&#39;0&#39;</span><span class="op" id="2119331">,</span>&nbsp;<span class="ident" id="2119333">buf</span><span class="op" id="2119336">[</span><span class="num" id="2119337">2</span><span class="op" id="2119338">]</span><span class="op" id="2119339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119345">return</span>&nbsp;<span class="ident" id="2119352">dst</span><br>
<span class="lineno"></span><span class="op" id="2119356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2119359">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2119381">func</span>&nbsp;<span class="ident" id="2119386">fmtF</span><span class="op" id="2119390">(</span><span class="ident" id="2119391">dst</span>&nbsp;<span class="op" id="2119395">[</span><span class="op" id="2119396">]</span><span class="builtintype" id="2119397">byte</span><span class="op" id="2119401">,</span>&nbsp;<span class="ident" id="2119403">neg</span>&nbsp;<span class="builtintype" id="2119407">bool</span><span class="op" id="2119411">,</span>&nbsp;<span class="ident" id="2119413">d</span>&nbsp;<span class="ident" id="2119415">decimalSlice</span><span class="op" id="2119427">,</span>&nbsp;<span class="ident" id="2119429">prec</span>&nbsp;<span class="builtintype" id="2119434">int</span><span class="op" id="2119437">)</span>&nbsp;<span class="op" id="2119439">[</span><span class="op" id="2119440">]</span><span class="builtintype" id="2119441">byte</span>&nbsp;<span class="op" id="2119446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119449">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119458">if</span>&nbsp;<span class="ident" id="2119461">neg</span>&nbsp;<span class="op" id="2119465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119469">dst</span>&nbsp;<span class="op" id="2119473">=</span>&nbsp;<span class="builtinfunc" id="2119475">append</span><span class="op" id="2119481">(</span><span class="ident" id="2119482">dst</span><span class="op" id="2119485">,</span>&nbsp;<span class="string" id="2119487">&#39;-&#39;</span><span class="op" id="2119490">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119497">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119539">if</span>&nbsp;<span class="ident" id="2119542">d</span><span class="op" id="2119543">.</span><span class="ident" id="2119544">dp</span>&nbsp;<span class="op" id="2119547">&gt;</span>&nbsp;<span class="num" id="2119549">0</span>&nbsp;<span class="op" id="2119551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119555">var</span>&nbsp;<span class="ident" id="2119559">i</span>&nbsp;<span class="builtintype" id="2119561">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119567">for</span>&nbsp;<span class="ident" id="2119571">i</span>&nbsp;<span class="op" id="2119573">=</span>&nbsp;<span class="num" id="2119575">0</span><span class="op" id="2119576">;</span>&nbsp;<span class="ident" id="2119578">i</span>&nbsp;<span class="op" id="2119580">&lt;</span>&nbsp;<span class="ident" id="2119582">d</span><span class="op" id="2119583">.</span><span class="ident" id="2119584">dp</span>&nbsp;<span class="op" id="2119587">&amp;&amp;</span>&nbsp;<span class="ident" id="2119590">i</span>&nbsp;<span class="op" id="2119592">&lt;</span>&nbsp;<span class="ident" id="2119594">d</span><span class="op" id="2119595">.</span><span class="ident" id="2119596">nd</span><span class="op" id="2119598">;</span>&nbsp;<span class="ident" id="2119600">i</span><span class="op" id="2119601">++</span>&nbsp;<span class="op" id="2119604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119609">dst</span>&nbsp;<span class="op" id="2119613">=</span>&nbsp;<span class="builtinfunc" id="2119615">append</span><span class="op" id="2119621">(</span><span class="ident" id="2119622">dst</span><span class="op" id="2119625">,</span>&nbsp;<span class="ident" id="2119627">d</span><span class="op" id="2119628">.</span><span class="ident" id="2119629">d</span><span class="op" id="2119630">[</span><span class="ident" id="2119631">i</span><span class="op" id="2119632">]</span><span class="op" id="2119633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119641">for</span>&nbsp;<span class="op" id="2119645">;</span>&nbsp;<span class="ident" id="2119647">i</span>&nbsp;<span class="op" id="2119649">&lt;</span>&nbsp;<span class="ident" id="2119651">d</span><span class="op" id="2119652">.</span><span class="ident" id="2119653">dp</span><span class="op" id="2119655">;</span>&nbsp;<span class="ident" id="2119657">i</span><span class="op" id="2119658">++</span>&nbsp;<span class="op" id="2119661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119666">dst</span>&nbsp;<span class="op" id="2119670">=</span>&nbsp;<span class="builtinfunc" id="2119672">append</span><span class="op" id="2119678">(</span><span class="ident" id="2119679">dst</span><span class="op" id="2119682">,</span>&nbsp;<span class="string" id="2119684">&#39;0&#39;</span><span class="op" id="2119687">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119694">}</span>&nbsp;<span class="keyword" id="2119696">else</span>&nbsp;<span class="op" id="2119701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119705">dst</span>&nbsp;<span class="op" id="2119709">=</span>&nbsp;<span class="builtinfunc" id="2119711">append</span><span class="op" id="2119717">(</span><span class="ident" id="2119718">dst</span><span class="op" id="2119721">,</span>&nbsp;<span class="string" id="2119723">&#39;0&#39;</span><span class="op" id="2119726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2119733">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119746">if</span>&nbsp;<span class="ident" id="2119749">prec</span>&nbsp;<span class="op" id="2119754">&gt;</span>&nbsp;<span class="num" id="2119756">0</span>&nbsp;<span class="op" id="2119758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119762">dst</span>&nbsp;<span class="op" id="2119766">=</span>&nbsp;<span class="builtinfunc" id="2119768">append</span><span class="op" id="2119774">(</span><span class="ident" id="2119775">dst</span><span class="op" id="2119778">,</span>&nbsp;<span class="string" id="2119780">&#39;.&#39;</span><span class="op" id="2119783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119787">for</span>&nbsp;<span class="ident" id="2119791">i</span>&nbsp;<span class="op" id="2119793">:=</span>&nbsp;<span class="num" id="2119796">0</span><span class="op" id="2119797">;</span>&nbsp;<span class="ident" id="2119799">i</span>&nbsp;<span class="op" id="2119801">&lt;</span>&nbsp;<span class="ident" id="2119803">prec</span><span class="op" id="2119807">;</span>&nbsp;<span class="ident" id="2119809">i</span><span class="op" id="2119810">++</span>&nbsp;<span class="op" id="2119813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119818">ch</span>&nbsp;<span class="op" id="2119821">:=</span>&nbsp;<span class="builtintype" id="2119824">byte</span><span class="op" id="2119828">(</span><span class="string" id="2119829">&#39;0&#39;</span><span class="op" id="2119832">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119837">if</span>&nbsp;<span class="ident" id="2119840">j</span>&nbsp;<span class="op" id="2119842">:=</span>&nbsp;<span class="ident" id="2119845">d</span><span class="op" id="2119846">.</span><span class="ident" id="2119847">dp</span>&nbsp;<span class="op" id="2119850">+</span>&nbsp;<span class="ident" id="2119852">i</span><span class="op" id="2119853">;</span>&nbsp;<span class="num" id="2119855">0</span>&nbsp;<span class="op" id="2119857">&lt;=</span>&nbsp;<span class="ident" id="2119860">j</span>&nbsp;<span class="op" id="2119862">&amp;&amp;</span>&nbsp;<span class="ident" id="2119865">j</span>&nbsp;<span class="op" id="2119867">&lt;</span>&nbsp;<span class="ident" id="2119869">d</span><span class="op" id="2119870">.</span><span class="ident" id="2119871">nd</span>&nbsp;<span class="op" id="2119874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119880">ch</span>&nbsp;<span class="op" id="2119883">=</span>&nbsp;<span class="ident" id="2119885">d</span><span class="op" id="2119886">.</span><span class="ident" id="2119887">d</span><span class="op" id="2119888">[</span><span class="ident" id="2119889">j</span><span class="op" id="2119890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2119900">dst</span>&nbsp;<span class="op" id="2119904">=</span>&nbsp;<span class="builtinfunc" id="2119906">append</span><span class="op" id="2119912">(</span><span class="ident" id="2119913">dst</span><span class="op" id="2119916">,</span>&nbsp;<span class="ident" id="2119918">ch</span><span class="op" id="2119920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119924">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2119927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2119931">return</span>&nbsp;<span class="ident" id="2119938">dst</span><br>
<span class="lineno"></span><span class="op" id="2119942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2119945">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2119967">func</span>&nbsp;<span class="ident" id="2119972">fmtB</span><span class="op" id="2119976">(</span><span class="ident" id="2119977">dst</span>&nbsp;<span class="op" id="2119981">[</span><span class="op" id="2119982">]</span><span class="builtintype" id="2119983">byte</span><span class="op" id="2119987">,</span>&nbsp;<span class="ident" id="2119989">neg</span>&nbsp;<span class="builtintype" id="2119993">bool</span><span class="op" id="2119997">,</span>&nbsp;<span class="ident" id="2119999">mant</span>&nbsp;<span class="ident" id="2120004">uint64</span><span class="op" id="2120010">,</span>&nbsp;<span class="ident" id="2120012">exp</span>&nbsp;<span class="builtintype" id="2120016">int</span><span class="op" id="2120019">,</span>&nbsp;<span class="ident" id="2120021">flt</span>&nbsp;<span class="op" id="2120025">*</span><span class="ident" id="2120026">floatInfo</span><span class="op" id="2120035">)</span>&nbsp;<span class="op" id="2120037">[</span><span class="op" id="2120038">]</span><span class="builtintype" id="2120039">byte</span>&nbsp;<span class="op" id="2120044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120047">var</span>&nbsp;<span class="ident" id="2120051">buf</span>&nbsp;<span class="op" id="2120055">[</span><span class="num" id="2120056">50</span><span class="op" id="2120058">]</span><span class="builtintype" id="2120059">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120065">w</span>&nbsp;<span class="op" id="2120067">:=</span>&nbsp;<span class="builtinfunc" id="2120070">len</span><span class="op" id="2120073">(</span><span class="ident" id="2120074">buf</span><span class="op" id="2120077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120080">exp</span>&nbsp;<span class="op" id="2120084">-=</span>&nbsp;<span class="builtintype" id="2120087">int</span><span class="op" id="2120090">(</span><span class="ident" id="2120091">flt</span><span class="op" id="2120094">.</span><span class="ident" id="2120095">mantbits</span><span class="op" id="2120103">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120106">esign</span>&nbsp;<span class="op" id="2120112">:=</span>&nbsp;<span class="builtintype" id="2120115">byte</span><span class="op" id="2120119">(</span><span class="string" id="2120120">&#39;+&#39;</span><span class="op" id="2120123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120126">if</span>&nbsp;<span class="ident" id="2120129">exp</span>&nbsp;<span class="op" id="2120133">&lt;</span>&nbsp;<span class="num" id="2120135">0</span>&nbsp;<span class="op" id="2120137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120141">esign</span>&nbsp;<span class="op" id="2120147">=</span>&nbsp;<span class="string" id="2120149">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120155">exp</span>&nbsp;<span class="op" id="2120159">=</span>&nbsp;<span class="op" id="2120161">-</span><span class="ident" id="2120162">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2120167">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120170">n</span>&nbsp;<span class="op" id="2120172">:=</span>&nbsp;<span class="num" id="2120175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120178">for</span>&nbsp;<span class="ident" id="2120182">exp</span>&nbsp;<span class="op" id="2120186">&gt;</span>&nbsp;<span class="num" id="2120188">0</span>&nbsp;<span class="op" id="2120190">||</span>&nbsp;<span class="ident" id="2120193">n</span>&nbsp;<span class="op" id="2120195">&lt;</span>&nbsp;<span class="num" id="2120197">1</span>&nbsp;<span class="op" id="2120199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120203">n</span><span class="op" id="2120204">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120209">w</span><span class="op" id="2120210">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120215">buf</span><span class="op" id="2120218">[</span><span class="ident" id="2120219">w</span><span class="op" id="2120220">]</span>&nbsp;<span class="op" id="2120222">=</span>&nbsp;<span class="builtintype" id="2120224">byte</span><span class="op" id="2120228">(</span><span class="ident" id="2120229">exp</span><span class="op" id="2120232">%</span><span class="num" id="2120233">10</span>&nbsp;<span class="op" id="2120236">+</span>&nbsp;<span class="string" id="2120238">&#39;0&#39;</span><span class="op" id="2120241">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120245">exp</span>&nbsp;<span class="op" id="2120249">/=</span>&nbsp;<span class="num" id="2120252">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2120256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120259">w</span><span class="op" id="2120260">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120264">buf</span><span class="op" id="2120267">[</span><span class="ident" id="2120268">w</span><span class="op" id="2120269">]</span>&nbsp;<span class="op" id="2120271">=</span>&nbsp;<span class="ident" id="2120273">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120280">w</span><span class="op" id="2120281">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120285">buf</span><span class="op" id="2120288">[</span><span class="ident" id="2120289">w</span><span class="op" id="2120290">]</span>&nbsp;<span class="op" id="2120292">=</span>&nbsp;<span class="string" id="2120294">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120299">n</span>&nbsp;<span class="op" id="2120301">=</span>&nbsp;<span class="num" id="2120303">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120306">for</span>&nbsp;<span class="ident" id="2120310">mant</span>&nbsp;<span class="op" id="2120315">&gt;</span>&nbsp;<span class="num" id="2120317">0</span>&nbsp;<span class="op" id="2120319">||</span>&nbsp;<span class="ident" id="2120322">n</span>&nbsp;<span class="op" id="2120324">&lt;</span>&nbsp;<span class="num" id="2120326">1</span>&nbsp;<span class="op" id="2120328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120332">n</span><span class="op" id="2120333">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120338">w</span><span class="op" id="2120339">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120344">buf</span><span class="op" id="2120347">[</span><span class="ident" id="2120348">w</span><span class="op" id="2120349">]</span>&nbsp;<span class="op" id="2120351">=</span>&nbsp;<span class="builtintype" id="2120353">byte</span><span class="op" id="2120357">(</span><span class="ident" id="2120358">mant</span><span class="op" id="2120362">%</span><span class="num" id="2120363">10</span>&nbsp;<span class="op" id="2120366">+</span>&nbsp;<span class="string" id="2120368">&#39;0&#39;</span><span class="op" id="2120371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120375">mant</span>&nbsp;<span class="op" id="2120380">/=</span>&nbsp;<span class="num" id="2120383">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2120387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120390">if</span>&nbsp;<span class="ident" id="2120393">neg</span>&nbsp;<span class="op" id="2120397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120401">w</span><span class="op" id="2120402">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2120407">buf</span><span class="op" id="2120410">[</span><span class="ident" id="2120411">w</span><span class="op" id="2120412">]</span>&nbsp;<span class="op" id="2120414">=</span>&nbsp;<span class="string" id="2120416">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2120421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120424">return</span>&nbsp;<span class="builtinfunc" id="2120431">append</span><span class="op" id="2120437">(</span><span class="ident" id="2120438">dst</span><span class="op" id="2120441">,</span>&nbsp;<span class="ident" id="2120443">buf</span><span class="op" id="2120446">[</span><span class="ident" id="2120447">w</span><span class="op" id="2120448">:</span><span class="op" id="2120449">]</span><span class="op" id="2120450">...</span><span class="op" id="2120453">)</span><br>
<span class="lineno"></span><span class="op" id="2120455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2120458">func</span>&nbsp;<span class="ident" id="2120463">max</span><span class="op" id="2120466">(</span><span class="ident" id="2120467">a</span><span class="op" id="2120468">,</span>&nbsp;<span class="ident" id="2120470">b</span>&nbsp;<span class="builtintype" id="2120472">int</span><span class="op" id="2120475">)</span>&nbsp;<span class="builtintype" id="2120477">int</span>&nbsp;<span class="op" id="2120481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120484">if</span>&nbsp;<span class="ident" id="2120487">a</span>&nbsp;<span class="op" id="2120489">&gt;</span>&nbsp;<span class="ident" id="2120491">b</span>&nbsp;<span class="op" id="2120493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120497">return</span>&nbsp;<span class="ident" id="2120504">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2120507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2120510">return</span>&nbsp;<span class="ident" id="2120517">b</span><br>
<span class="lineno">475</span><span class="op" id="2120519">}</span>
</div>
</body>
</html>
