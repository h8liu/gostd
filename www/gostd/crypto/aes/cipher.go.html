<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html" class="current">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4330572">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4330627">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4330681">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4330732">package</span>&nbsp;<span class="ident" id="4330740">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4330745">import</span>&nbsp;<span class="op" id="4330752">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4330755">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4330772">&#34;strconv&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4330782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4330785">//&nbsp;The&nbsp;AES&nbsp;block&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4330817">const</span>&nbsp;<span class="ident" id="4330823">BlockSize</span>&nbsp;<span class="op" id="4330833">=</span>&nbsp;<span class="num" id="4330835">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4330839">//&nbsp;A&nbsp;cipher&nbsp;is&nbsp;an&nbsp;instance&nbsp;of&nbsp;AES&nbsp;encryption&nbsp;using&nbsp;a&nbsp;particular&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4330908">type</span>&nbsp;<span class="ident" id="4330913">aesCipher</span>&nbsp;<span class="keyword" id="4330923">struct</span>&nbsp;<span class="op" id="4330930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330933">enc</span>&nbsp;<span class="op" id="4330937">[</span><span class="op" id="4330938">]</span><span class="builtintype" id="4330939">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4330947">dec</span>&nbsp;<span class="op" id="4330951">[</span><span class="op" id="4330952">]</span><span class="builtintype" id="4330953">uint32</span><br>
<span class="lineno"></span><span class="op" id="4330960">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="4330963">type</span>&nbsp;<span class="ident" id="4330968">KeySizeError</span>&nbsp;<span class="builtintype" id="4330981">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4330986">func</span>&nbsp;<span class="op" id="4330991">(</span><span class="ident" id="4330992">k</span>&nbsp;<span class="ident" id="4330994">KeySizeError</span><span class="op" id="4331006">)</span>&nbsp;<span class="ident" id="4331008">Error</span><span class="op" id="4331013">(</span><span class="op" id="4331014">)</span>&nbsp;<span class="builtintype" id="4331016">string</span>&nbsp;<span class="op" id="4331023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331026">return</span>&nbsp;<span class="string" id="4331033">&#34;crypto/aes:&nbsp;invalid&nbsp;key&nbsp;size&nbsp;&#34;</span>&nbsp;<span class="op" id="4331065">+</span>&nbsp;<span class="ident" id="4331067">strconv</span><span class="op" id="4331074">.</span><span class="ident" id="4331075">Itoa</span><span class="op" id="4331079">(</span><span class="builtintype" id="4331080">int</span><span class="op" id="4331083">(</span><span class="ident" id="4331084">k</span><span class="op" id="4331085">)</span><span class="op" id="4331086">)</span><br>
<span class="lineno">25</span><span class="op" id="4331088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4331091">//&nbsp;NewCipher&nbsp;creates&nbsp;and&nbsp;returns&nbsp;a&nbsp;new&nbsp;cipher.Block.</span><br>
<span class="lineno"></span><span class="comment" id="4331144">//&nbsp;The&nbsp;key&nbsp;argument&nbsp;should&nbsp;be&nbsp;the&nbsp;AES&nbsp;key,</span><br>
<span class="lineno"></span><span class="comment" id="4331187">//&nbsp;either&nbsp;16,&nbsp;24,&nbsp;or&nbsp;32&nbsp;bytes&nbsp;to&nbsp;select</span><br>
<span class="lineno">30</span><span class="comment" id="4331227">//&nbsp;AES-128,&nbsp;AES-192,&nbsp;or&nbsp;AES-256.</span><br>
<span class="lineno"></span><span class="keyword" id="4331260">func</span>&nbsp;<span class="ident" id="4331265">NewCipher</span><span class="op" id="4331274">(</span><span class="ident" id="4331275">key</span>&nbsp;<span class="op" id="4331279">[</span><span class="op" id="4331280">]</span><span class="builtintype" id="4331281">byte</span><span class="op" id="4331285">)</span>&nbsp;<span class="op" id="4331287">(</span><span class="ident" id="4331288">cipher</span><span class="op" id="4331294">.</span><span class="ident" id="4331295">Block</span><span class="op" id="4331300">,</span>&nbsp;<span class="builtintype" id="4331302">error</span><span class="op" id="4331307">)</span>&nbsp;<span class="op" id="4331309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331312">k</span>&nbsp;<span class="op" id="4331314">:=</span>&nbsp;<span class="builtinfunc" id="4331317">len</span><span class="op" id="4331320">(</span><span class="ident" id="4331321">key</span><span class="op" id="4331324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331327">switch</span>&nbsp;<span class="ident" id="4331334">k</span>&nbsp;<span class="op" id="4331336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331339">default</span><span class="op" id="4331346">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331350">return</span>&nbsp;<span class="ident" id="4331357">nil</span><span class="op" id="4331360">,</span>&nbsp;<span class="ident" id="4331362">KeySizeError</span><span class="op" id="4331374">(</span><span class="ident" id="4331375">k</span><span class="op" id="4331376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331379">case</span>&nbsp;<span class="num" id="4331384">16</span><span class="op" id="4331386">,</span>&nbsp;<span class="num" id="4331388">24</span><span class="op" id="4331390">,</span>&nbsp;<span class="num" id="4331392">32</span><span class="op" id="4331394">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331398">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331409">n</span>&nbsp;<span class="op" id="4331411">:=</span>&nbsp;<span class="ident" id="4331414">k</span>&nbsp;<span class="op" id="4331416">+</span>&nbsp;<span class="num" id="4331418">28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331422">c</span>&nbsp;<span class="op" id="4331424">:=</span>&nbsp;<span class="op" id="4331427">&amp;</span><span class="ident" id="4331428">aesCipher</span><span class="op" id="4331437">{</span><span class="builtinfunc" id="4331438">make</span><span class="op" id="4331442">(</span><span class="op" id="4331443">[</span><span class="op" id="4331444">]</span><span class="builtintype" id="4331445">uint32</span><span class="op" id="4331451">,</span>&nbsp;<span class="ident" id="4331453">n</span><span class="op" id="4331454">)</span><span class="op" id="4331455">,</span>&nbsp;<span class="builtinfunc" id="4331457">make</span><span class="op" id="4331461">(</span><span class="op" id="4331462">[</span><span class="op" id="4331463">]</span><span class="builtintype" id="4331464">uint32</span><span class="op" id="4331470">,</span>&nbsp;<span class="ident" id="4331472">n</span><span class="op" id="4331473">)</span><span class="op" id="4331474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331477">expandKey</span><span class="op" id="4331486">(</span><span class="ident" id="4331487">key</span><span class="op" id="4331490">,</span>&nbsp;<span class="ident" id="4331492">c</span><span class="op" id="4331493">.</span><span class="ident" id="4331494">enc</span><span class="op" id="4331497">,</span>&nbsp;<span class="ident" id="4331499">c</span><span class="op" id="4331500">.</span><span class="ident" id="4331501">dec</span><span class="op" id="4331504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331507">return</span>&nbsp;<span class="ident" id="4331514">c</span><span class="op" id="4331515">,</span>&nbsp;<span class="ident" id="4331517">nil</span><br>
<span class="lineno"></span><span class="op" id="4331521">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="4331524">func</span>&nbsp;<span class="op" id="4331529">(</span><span class="ident" id="4331530">c</span>&nbsp;<span class="op" id="4331532">*</span><span class="ident" id="4331533">aesCipher</span><span class="op" id="4331542">)</span>&nbsp;<span class="ident" id="4331544">BlockSize</span><span class="op" id="4331553">(</span><span class="op" id="4331554">)</span>&nbsp;<span class="builtintype" id="4331556">int</span>&nbsp;<span class="op" id="4331560">{</span>&nbsp;<span class="keyword" id="4331562">return</span>&nbsp;<span class="ident" id="4331569">BlockSize</span>&nbsp;<span class="op" id="4331579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4331582">func</span>&nbsp;<span class="op" id="4331587">(</span><span class="ident" id="4331588">c</span>&nbsp;<span class="op" id="4331590">*</span><span class="ident" id="4331591">aesCipher</span><span class="op" id="4331600">)</span>&nbsp;<span class="ident" id="4331602">Encrypt</span><span class="op" id="4331609">(</span><span class="ident" id="4331610">dst</span><span class="op" id="4331613">,</span>&nbsp;<span class="ident" id="4331615">src</span>&nbsp;<span class="op" id="4331619">[</span><span class="op" id="4331620">]</span><span class="builtintype" id="4331621">byte</span><span class="op" id="4331625">)</span>&nbsp;<span class="op" id="4331627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331630">if</span>&nbsp;<span class="builtinfunc" id="4331633">len</span><span class="op" id="4331636">(</span><span class="ident" id="4331637">src</span><span class="op" id="4331640">)</span>&nbsp;<span class="op" id="4331642">&lt;</span>&nbsp;<span class="ident" id="4331644">BlockSize</span>&nbsp;<span class="op" id="4331654">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4331658">panic</span><span class="op" id="4331663">(</span><span class="string" id="4331664">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="4331698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331704">if</span>&nbsp;<span class="builtinfunc" id="4331707">len</span><span class="op" id="4331710">(</span><span class="ident" id="4331711">dst</span><span class="op" id="4331714">)</span>&nbsp;<span class="op" id="4331716">&lt;</span>&nbsp;<span class="ident" id="4331718">BlockSize</span>&nbsp;<span class="op" id="4331728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4331732">panic</span><span class="op" id="4331737">(</span><span class="string" id="4331738">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="4331773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331776">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4331779">encryptBlock</span><span class="op" id="4331791">(</span><span class="ident" id="4331792">c</span><span class="op" id="4331793">.</span><span class="ident" id="4331794">enc</span><span class="op" id="4331797">,</span>&nbsp;<span class="ident" id="4331799">dst</span><span class="op" id="4331802">,</span>&nbsp;<span class="ident" id="4331804">src</span><span class="op" id="4331807">)</span><br>
<span class="lineno"></span><span class="op" id="4331809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4331812">func</span>&nbsp;<span class="op" id="4331817">(</span><span class="ident" id="4331818">c</span>&nbsp;<span class="op" id="4331820">*</span><span class="ident" id="4331821">aesCipher</span><span class="op" id="4331830">)</span>&nbsp;<span class="ident" id="4331832">Decrypt</span><span class="op" id="4331839">(</span><span class="ident" id="4331840">dst</span><span class="op" id="4331843">,</span>&nbsp;<span class="ident" id="4331845">src</span>&nbsp;<span class="op" id="4331849">[</span><span class="op" id="4331850">]</span><span class="builtintype" id="4331851">byte</span><span class="op" id="4331855">)</span>&nbsp;<span class="op" id="4331857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331860">if</span>&nbsp;<span class="builtinfunc" id="4331863">len</span><span class="op" id="4331866">(</span><span class="ident" id="4331867">src</span><span class="op" id="4331870">)</span>&nbsp;<span class="op" id="4331872">&lt;</span>&nbsp;<span class="ident" id="4331874">BlockSize</span>&nbsp;<span class="op" id="4331884">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4331888">panic</span><span class="op" id="4331893">(</span><span class="string" id="4331894">&#34;crypto/aes:&nbsp;input&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="4331928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4331931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4331934">if</span>&nbsp;<span class="builtinfunc" id="4331937">len</span><span class="op" id="4331940">(</span><span class="ident" id="4331941">dst</span><span class="op" id="4331944">)</span>&nbsp;<span class="op" id="4331946">&lt;</span>&nbsp;<span class="ident" id="4331948">BlockSize</span>&nbsp;<span class="op" id="4331958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4331962">panic</span><span class="op" id="4331967">(</span><span class="string" id="4331968">&#34;crypto/aes:&nbsp;output&nbsp;not&nbsp;full&nbsp;block&#34;</span><span class="op" id="4332003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4332006">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4332009">decryptBlock</span><span class="op" id="4332021">(</span><span class="ident" id="4332022">c</span><span class="op" id="4332023">.</span><span class="ident" id="4332024">dec</span><span class="op" id="4332027">,</span>&nbsp;<span class="ident" id="4332029">dst</span><span class="op" id="4332032">,</span>&nbsp;<span class="ident" id="4332034">src</span><span class="op" id="4332037">)</span><br>
<span class="lineno"></span><span class="op" id="4332039">}</span>
</div>
</body>
</html>
