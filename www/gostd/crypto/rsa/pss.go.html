<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4356451">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4356506">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4356560">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4356611">package</span>&nbsp;<span class="ident" id="4356619">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4356624">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4356678">//</span><br>
<span class="lineno"></span><span class="comment" id="4356681">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4356778">import</span>&nbsp;<span class="op" id="4356785">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356788">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356797">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356807">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356817">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356825">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4356831">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4356842">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4356845">func</span>&nbsp;<span class="ident" id="4356850">emsaPSSEncode</span><span class="op" id="4356863">(</span><span class="ident" id="4356864">mHash</span>&nbsp;<span class="op" id="4356870">[</span><span class="op" id="4356871">]</span><span class="builtintype" id="4356872">byte</span><span class="op" id="4356876">,</span>&nbsp;<span class="ident" id="4356878">emBits</span>&nbsp;<span class="builtintype" id="4356885">int</span><span class="op" id="4356888">,</span>&nbsp;<span class="ident" id="4356890">salt</span>&nbsp;<span class="op" id="4356895">[</span><span class="op" id="4356896">]</span><span class="builtintype" id="4356897">byte</span><span class="op" id="4356901">,</span>&nbsp;<span class="ident" id="4356903">hash</span>&nbsp;<span class="ident" id="4356908">hash</span><span class="op" id="4356912">.</span><span class="ident" id="4356913">Hash</span><span class="op" id="4356917">)</span>&nbsp;<span class="op" id="4356919">(</span><span class="op" id="4356920">[</span><span class="op" id="4356921">]</span><span class="builtintype" id="4356922">byte</span><span class="op" id="4356926">,</span>&nbsp;<span class="builtintype" id="4356928">error</span><span class="op" id="4356933">)</span>&nbsp;<span class="op" id="4356935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4356938">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356965">hLen</span>&nbsp;<span class="op" id="4356970">:=</span>&nbsp;<span class="ident" id="4356973">hash</span><span class="op" id="4356977">.</span><span class="ident" id="4356978">Size</span><span class="op" id="4356982">(</span><span class="op" id="4356983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356986">sLen</span>&nbsp;<span class="op" id="4356991">:=</span>&nbsp;<span class="builtinfunc" id="4356994">len</span><span class="op" id="4356997">(</span><span class="ident" id="4356998">salt</span><span class="op" id="4357002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357005">emLen</span>&nbsp;<span class="op" id="4357011">:=</span>&nbsp;<span class="op" id="4357014">(</span><span class="ident" id="4357015">emBits</span>&nbsp;<span class="op" id="4357022">+</span>&nbsp;<span class="num" id="4357024">7</span><span class="op" id="4357025">)</span>&nbsp;<span class="op" id="4357027">/</span>&nbsp;<span class="num" id="4357029">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357033">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357105">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357176">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357200">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357204">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357266">if</span>&nbsp;<span class="builtinfunc" id="4357269">len</span><span class="op" id="4357272">(</span><span class="ident" id="4357273">mHash</span><span class="op" id="4357278">)</span>&nbsp;<span class="op" id="4357280">!=</span>&nbsp;<span class="ident" id="4357283">hLen</span>&nbsp;<span class="op" id="4357288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357292">return</span>&nbsp;<span class="ident" id="4357299">nil</span><span class="op" id="4357302">,</span>&nbsp;<span class="ident" id="4357304">errors</span><span class="op" id="4357310">.</span><span class="ident" id="4357311">New</span><span class="op" id="4357314">(</span><span class="string" id="4357315">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4357357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357360">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357364">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357435">if</span>&nbsp;<span class="ident" id="4357438">emLen</span>&nbsp;<span class="op" id="4357444">&lt;</span>&nbsp;<span class="ident" id="4357446">hLen</span><span class="op" id="4357450">+</span><span class="ident" id="4357451">sLen</span><span class="op" id="4357455">+</span><span class="num" id="4357456">2</span>&nbsp;<span class="op" id="4357458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357462">return</span>&nbsp;<span class="ident" id="4357469">nil</span><span class="op" id="4357472">,</span>&nbsp;<span class="ident" id="4357474">errors</span><span class="op" id="4357480">.</span><span class="ident" id="4357481">New</span><span class="op" id="4357484">(</span><span class="string" id="4357485">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4357513">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357520">em</span>&nbsp;<span class="op" id="4357523">:=</span>&nbsp;<span class="builtinfunc" id="4357526">make</span><span class="op" id="4357530">(</span><span class="op" id="4357531">[</span><span class="op" id="4357532">]</span><span class="builtintype" id="4357533">byte</span><span class="op" id="4357537">,</span>&nbsp;<span class="ident" id="4357539">emLen</span><span class="op" id="4357544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357547">db</span>&nbsp;<span class="op" id="4357550">:=</span>&nbsp;<span class="ident" id="4357553">em</span><span class="op" id="4357555">[</span><span class="op" id="4357556">:</span><span class="ident" id="4357557">emLen</span><span class="op" id="4357562">-</span><span class="ident" id="4357563">sLen</span><span class="op" id="4357567">-</span><span class="ident" id="4357568">hLen</span><span class="op" id="4357572">-</span><span class="num" id="4357573">2</span><span class="op" id="4357574">+</span><span class="num" id="4357575">1</span><span class="op" id="4357576">+</span><span class="ident" id="4357577">sLen</span><span class="op" id="4357581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357584">h</span>&nbsp;<span class="op" id="4357586">:=</span>&nbsp;<span class="ident" id="4357589">em</span><span class="op" id="4357591">[</span><span class="ident" id="4357592">emLen</span><span class="op" id="4357597">-</span><span class="ident" id="4357598">sLen</span><span class="op" id="4357602">-</span><span class="ident" id="4357603">hLen</span><span class="op" id="4357607">-</span><span class="num" id="4357608">2</span><span class="op" id="4357609">+</span><span class="num" id="4357610">1</span><span class="op" id="4357611">+</span><span class="ident" id="4357612">sLen</span>&nbsp;<span class="op" id="4357617">:</span>&nbsp;<span class="ident" id="4357619">emLen</span><span class="op" id="4357624">-</span><span class="num" id="4357625">1</span><span class="op" id="4357626">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357630">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357703">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357742">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357746">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357758">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357819">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357823">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357919">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357923">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357982">var</span>&nbsp;<span class="ident" id="4357986">prefix</span>&nbsp;<span class="op" id="4357993">[</span><span class="num" id="4357994">8</span><span class="op" id="4357995">]</span><span class="builtintype" id="4357996">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358003">hash</span><span class="op" id="4358007">.</span><span class="ident" id="4358008">Write</span><span class="op" id="4358013">(</span><span class="ident" id="4358014">prefix</span><span class="op" id="4358020">[</span><span class="op" id="4358021">:</span><span class="op" id="4358022">]</span><span class="op" id="4358023">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358026">hash</span><span class="op" id="4358030">.</span><span class="ident" id="4358031">Write</span><span class="op" id="4358036">(</span><span class="ident" id="4358037">mHash</span><span class="op" id="4358042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358045">hash</span><span class="op" id="4358049">.</span><span class="ident" id="4358050">Write</span><span class="op" id="4358055">(</span><span class="ident" id="4358056">salt</span><span class="op" id="4358060">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358064">h</span>&nbsp;<span class="op" id="4358066">=</span>&nbsp;<span class="ident" id="4358068">hash</span><span class="op" id="4358072">.</span><span class="ident" id="4358073">Sum</span><span class="op" id="4358076">(</span><span class="ident" id="4358077">h</span><span class="op" id="4358078">[</span><span class="op" id="4358079">:</span><span class="num" id="4358080">0</span><span class="op" id="4358081">]</span><span class="op" id="4358082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358085">hash</span><span class="op" id="4358089">.</span><span class="ident" id="4358090">Reset</span><span class="op" id="4358095">(</span><span class="op" id="4358096">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358100">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358174">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358223">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358227">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358296">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358323">db</span><span class="op" id="4358325">[</span><span class="ident" id="4358326">emLen</span><span class="op" id="4358331">-</span><span class="ident" id="4358332">sLen</span><span class="op" id="4358336">-</span><span class="ident" id="4358337">hLen</span><span class="op" id="4358341">-</span><span class="num" id="4358342">2</span><span class="op" id="4358343">]</span>&nbsp;<span class="op" id="4358345">=</span>&nbsp;<span class="num" id="4358347">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4358353">copy</span><span class="op" id="4358357">(</span><span class="ident" id="4358358">db</span><span class="op" id="4358360">[</span><span class="ident" id="4358361">emLen</span><span class="op" id="4358366">-</span><span class="ident" id="4358367">sLen</span><span class="op" id="4358371">-</span><span class="ident" id="4358372">hLen</span><span class="op" id="4358376">-</span><span class="num" id="4358377">1</span><span class="op" id="4358378">:</span><span class="op" id="4358379">]</span><span class="op" id="4358380">,</span>&nbsp;<span class="ident" id="4358382">salt</span><span class="op" id="4358386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358390">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358437">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358441">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358481">mgf1XOR</span><span class="op" id="4358488">(</span><span class="ident" id="4358489">db</span><span class="op" id="4358491">,</span>&nbsp;<span class="ident" id="4358493">hash</span><span class="op" id="4358497">,</span>&nbsp;<span class="ident" id="4358499">h</span><span class="op" id="4358500">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358504">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358578">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358605">db</span><span class="op" id="4358607">[</span><span class="num" id="4358608">0</span><span class="op" id="4358609">]</span>&nbsp;<span class="op" id="4358611">&amp;=</span>&nbsp;<span class="op" id="4358614">(</span><span class="num" id="4358615">0xFF</span>&nbsp;<span class="op" id="4358620">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4358623">uint</span><span class="op" id="4358627">(</span><span class="num" id="4358628">8</span><span class="op" id="4358629">*</span><span class="ident" id="4358630">emLen</span><span class="op" id="4358635">-</span><span class="ident" id="4358636">emBits</span><span class="op" id="4358642">)</span><span class="op" id="4358643">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358647">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358687">em</span><span class="op" id="4358689">[</span><span class="ident" id="4358690">emLen</span><span class="op" id="4358695">-</span><span class="num" id="4358696">1</span><span class="op" id="4358697">]</span>&nbsp;<span class="op" id="4358699">=</span>&nbsp;<span class="num" id="4358701">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358708">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358727">return</span>&nbsp;<span class="ident" id="4358734">em</span><span class="op" id="4358736">,</span>&nbsp;<span class="ident" id="4358738">nil</span><br>
<span class="lineno"></span><span class="op" id="4358742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4358745">func</span>&nbsp;<span class="ident" id="4358750">emsaPSSVerify</span><span class="op" id="4358763">(</span><span class="ident" id="4358764">mHash</span><span class="op" id="4358769">,</span>&nbsp;<span class="ident" id="4358771">em</span>&nbsp;<span class="op" id="4358774">[</span><span class="op" id="4358775">]</span><span class="builtintype" id="4358776">byte</span><span class="op" id="4358780">,</span>&nbsp;<span class="ident" id="4358782">emBits</span><span class="op" id="4358788">,</span>&nbsp;<span class="ident" id="4358790">sLen</span>&nbsp;<span class="builtintype" id="4358795">int</span><span class="op" id="4358798">,</span>&nbsp;<span class="ident" id="4358800">hash</span>&nbsp;<span class="ident" id="4358805">hash</span><span class="op" id="4358809">.</span><span class="ident" id="4358810">Hash</span><span class="op" id="4358814">)</span>&nbsp;<span class="builtintype" id="4358816">error</span>&nbsp;<span class="op" id="4358822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358825">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358897">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358970">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358988">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358992">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359053">hLen</span>&nbsp;<span class="op" id="4359058">:=</span>&nbsp;<span class="ident" id="4359061">hash</span><span class="op" id="4359065">.</span><span class="ident" id="4359066">Size</span><span class="op" id="4359070">(</span><span class="op" id="4359071">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359074">if</span>&nbsp;<span class="ident" id="4359077">hLen</span>&nbsp;<span class="op" id="4359082">!=</span>&nbsp;<span class="builtinfunc" id="4359085">len</span><span class="op" id="4359088">(</span><span class="ident" id="4359089">mHash</span><span class="op" id="4359094">)</span>&nbsp;<span class="op" id="4359096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359100">return</span>&nbsp;<span class="ident" id="4359107">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359128">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359196">emLen</span>&nbsp;<span class="op" id="4359202">:=</span>&nbsp;<span class="op" id="4359205">(</span><span class="ident" id="4359206">emBits</span>&nbsp;<span class="op" id="4359213">+</span>&nbsp;<span class="num" id="4359215">7</span><span class="op" id="4359216">)</span>&nbsp;<span class="op" id="4359218">/</span>&nbsp;<span class="num" id="4359220">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359223">if</span>&nbsp;<span class="ident" id="4359226">emLen</span>&nbsp;<span class="op" id="4359232">&lt;</span>&nbsp;<span class="ident" id="4359234">hLen</span><span class="op" id="4359238">+</span><span class="ident" id="4359239">sLen</span><span class="op" id="4359243">+</span><span class="num" id="4359244">2</span>&nbsp;<span class="op" id="4359246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359250">return</span>&nbsp;<span class="ident" id="4359257">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359278">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359393">if</span>&nbsp;<span class="ident" id="4359396">em</span><span class="op" id="4359398">[</span><span class="builtinfunc" id="4359399">len</span><span class="op" id="4359402">(</span><span class="ident" id="4359403">em</span><span class="op" id="4359405">)</span><span class="op" id="4359406">-</span><span class="num" id="4359407">1</span><span class="op" id="4359408">]</span>&nbsp;<span class="op" id="4359410">!=</span>&nbsp;<span class="num" id="4359413">0xBC</span>&nbsp;<span class="op" id="4359418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359422">return</span>&nbsp;<span class="ident" id="4359429">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359446">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359450">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359522">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359561">db</span>&nbsp;<span class="op" id="4359564">:=</span>&nbsp;<span class="ident" id="4359567">em</span><span class="op" id="4359569">[</span><span class="op" id="4359570">:</span><span class="ident" id="4359571">emLen</span><span class="op" id="4359576">-</span><span class="ident" id="4359577">hLen</span><span class="op" id="4359581">-</span><span class="num" id="4359582">1</span><span class="op" id="4359583">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359586">h</span>&nbsp;<span class="op" id="4359588">:=</span>&nbsp;<span class="ident" id="4359591">em</span><span class="op" id="4359593">[</span><span class="ident" id="4359594">emLen</span><span class="op" id="4359599">-</span><span class="ident" id="4359600">hLen</span><span class="op" id="4359604">-</span><span class="num" id="4359605">1</span>&nbsp;<span class="op" id="4359607">:</span>&nbsp;<span class="builtinfunc" id="4359609">len</span><span class="op" id="4359612">(</span><span class="ident" id="4359613">em</span><span class="op" id="4359615">)</span><span class="op" id="4359616">-</span><span class="num" id="4359617">1</span><span class="op" id="4359618">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359622">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359695">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359765">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359779">if</span>&nbsp;<span class="ident" id="4359782">em</span><span class="op" id="4359784">[</span><span class="num" id="4359785">0</span><span class="op" id="4359786">]</span><span class="op" id="4359787">&amp;</span><span class="op" id="4359788">(</span><span class="num" id="4359789">0xFF</span><span class="op" id="4359793">&lt;&lt;</span><span class="builtintype" id="4359795">uint</span><span class="op" id="4359799">(</span><span class="num" id="4359800">8</span><span class="op" id="4359801">-</span><span class="op" id="4359802">(</span><span class="num" id="4359803">8</span><span class="op" id="4359804">*</span><span class="ident" id="4359805">emLen</span><span class="op" id="4359810">-</span><span class="ident" id="4359811">emBits</span><span class="op" id="4359817">)</span><span class="op" id="4359818">)</span><span class="op" id="4359819">)</span>&nbsp;<span class="op" id="4359821">!=</span>&nbsp;<span class="num" id="4359824">0</span>&nbsp;<span class="op" id="4359826">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359830">return</span>&nbsp;<span class="ident" id="4359837">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359858">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359905">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359909">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359948">mgf1XOR</span><span class="op" id="4359955">(</span><span class="ident" id="4359956">db</span><span class="op" id="4359958">,</span>&nbsp;<span class="ident" id="4359960">hash</span><span class="op" id="4359964">,</span>&nbsp;<span class="ident" id="4359966">h</span><span class="op" id="4359967">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359971">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360048">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360065">db</span><span class="op" id="4360067">[</span><span class="num" id="4360068">0</span><span class="op" id="4360069">]</span>&nbsp;<span class="op" id="4360071">&amp;=</span>&nbsp;<span class="op" id="4360074">(</span><span class="num" id="4360075">0xFF</span>&nbsp;<span class="op" id="4360080">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4360083">uint</span><span class="op" id="4360087">(</span><span class="num" id="4360088">8</span><span class="op" id="4360089">*</span><span class="ident" id="4360090">emLen</span><span class="op" id="4360095">-</span><span class="ident" id="4360096">emBits</span><span class="op" id="4360102">)</span><span class="op" id="4360103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360107">if</span>&nbsp;<span class="ident" id="4360110">sLen</span>&nbsp;<span class="op" id="4360115">==</span>&nbsp;<span class="ident" id="4360118">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4360136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360139">FindSaltLength</span><span class="op" id="4360153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360157">for</span>&nbsp;<span class="ident" id="4360161">sLen</span>&nbsp;<span class="op" id="4360166">=</span>&nbsp;<span class="ident" id="4360168">emLen</span>&nbsp;<span class="op" id="4360174">-</span>&nbsp;<span class="op" id="4360176">(</span><span class="ident" id="4360177">hLen</span>&nbsp;<span class="op" id="4360182">+</span>&nbsp;<span class="num" id="4360184">2</span><span class="op" id="4360185">)</span><span class="op" id="4360186">;</span>&nbsp;<span class="ident" id="4360188">sLen</span>&nbsp;<span class="op" id="4360193">&gt;=</span>&nbsp;<span class="num" id="4360196">0</span><span class="op" id="4360197">;</span>&nbsp;<span class="ident" id="4360199">sLen</span><span class="op" id="4360203">--</span>&nbsp;<span class="op" id="4360206">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360211">switch</span>&nbsp;<span class="ident" id="4360218">db</span><span class="op" id="4360220">[</span><span class="ident" id="4360221">emLen</span><span class="op" id="4360226">-</span><span class="ident" id="4360227">hLen</span><span class="op" id="4360231">-</span><span class="ident" id="4360232">sLen</span><span class="op" id="4360236">-</span><span class="num" id="4360237">2</span><span class="op" id="4360238">]</span>&nbsp;<span class="op" id="4360240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360245">case</span>&nbsp;<span class="num" id="4360250">1</span><span class="op" id="4360251">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360257">break</span>&nbsp;<span class="ident" id="4360263">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360281">case</span>&nbsp;<span class="num" id="4360286">0</span><span class="op" id="4360287">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360293">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360305">default</span><span class="op" id="4360312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360318">return</span>&nbsp;<span class="ident" id="4360325">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360352">if</span>&nbsp;<span class="ident" id="4360355">sLen</span>&nbsp;<span class="op" id="4360360">&lt;</span>&nbsp;<span class="num" id="4360362">0</span>&nbsp;<span class="op" id="4360364">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360369">return</span>&nbsp;<span class="ident" id="4360376">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360397">}</span>&nbsp;<span class="keyword" id="4360399">else</span>&nbsp;<span class="op" id="4360404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360408">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360558">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360631">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360672">for</span>&nbsp;<span class="ident" id="4360676">_</span><span class="op" id="4360677">,</span>&nbsp;<span class="ident" id="4360679">e</span>&nbsp;<span class="op" id="4360681">:=</span>&nbsp;<span class="keyword" id="4360684">range</span>&nbsp;<span class="ident" id="4360690">db</span><span class="op" id="4360692">[</span><span class="op" id="4360693">:</span><span class="ident" id="4360694">emLen</span><span class="op" id="4360699">-</span><span class="ident" id="4360700">hLen</span><span class="op" id="4360704">-</span><span class="ident" id="4360705">sLen</span><span class="op" id="4360709">-</span><span class="num" id="4360710">2</span><span class="op" id="4360711">]</span>&nbsp;<span class="op" id="4360713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360718">if</span>&nbsp;<span class="ident" id="4360721">e</span>&nbsp;<span class="op" id="4360723">!=</span>&nbsp;<span class="num" id="4360726">0x00</span>&nbsp;<span class="op" id="4360731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360737">return</span>&nbsp;<span class="ident" id="4360744">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360771">if</span>&nbsp;<span class="ident" id="4360774">db</span><span class="op" id="4360776">[</span><span class="ident" id="4360777">emLen</span><span class="op" id="4360782">-</span><span class="ident" id="4360783">hLen</span><span class="op" id="4360787">-</span><span class="ident" id="4360788">sLen</span><span class="op" id="4360792">-</span><span class="num" id="4360793">2</span><span class="op" id="4360794">]</span>&nbsp;<span class="op" id="4360796">!=</span>&nbsp;<span class="num" id="4360799">0x01</span>&nbsp;<span class="op" id="4360804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360809">return</span>&nbsp;<span class="ident" id="4360816">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360834">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360841">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360890">salt</span>&nbsp;<span class="op" id="4360895">:=</span>&nbsp;<span class="ident" id="4360898">db</span><span class="op" id="4360900">[</span><span class="builtinfunc" id="4360901">len</span><span class="op" id="4360904">(</span><span class="ident" id="4360905">db</span><span class="op" id="4360907">)</span><span class="op" id="4360908">-</span><span class="ident" id="4360909">sLen</span><span class="op" id="4360913">:</span><span class="op" id="4360914">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360918">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360931">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4360996">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361063">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361092">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361096">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361155">var</span>&nbsp;<span class="ident" id="4361159">prefix</span>&nbsp;<span class="op" id="4361166">[</span><span class="num" id="4361167">8</span><span class="op" id="4361168">]</span><span class="builtintype" id="4361169">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361175">hash</span><span class="op" id="4361179">.</span><span class="ident" id="4361180">Write</span><span class="op" id="4361185">(</span><span class="ident" id="4361186">prefix</span><span class="op" id="4361192">[</span><span class="op" id="4361193">:</span><span class="op" id="4361194">]</span><span class="op" id="4361195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361198">hash</span><span class="op" id="4361202">.</span><span class="ident" id="4361203">Write</span><span class="op" id="4361208">(</span><span class="ident" id="4361209">mHash</span><span class="op" id="4361214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361217">hash</span><span class="op" id="4361221">.</span><span class="ident" id="4361222">Write</span><span class="op" id="4361227">(</span><span class="ident" id="4361228">salt</span><span class="op" id="4361232">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361236">h0</span>&nbsp;<span class="op" id="4361239">:=</span>&nbsp;<span class="ident" id="4361242">hash</span><span class="op" id="4361246">.</span><span class="ident" id="4361247">Sum</span><span class="op" id="4361250">(</span><span class="ident" id="4361251">nil</span><span class="op" id="4361254">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361258">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361332">if</span>&nbsp;<span class="op" id="4361335">!</span><span class="ident" id="4361336">bytes</span><span class="op" id="4361341">.</span><span class="ident" id="4361342">Equal</span><span class="op" id="4361347">(</span><span class="ident" id="4361348">h0</span><span class="op" id="4361350">,</span>&nbsp;<span class="ident" id="4361352">h</span><span class="op" id="4361353">)</span>&nbsp;<span class="op" id="4361355">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361359">return</span>&nbsp;<span class="ident" id="4361366">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361386">return</span>&nbsp;<span class="ident" id="4361393">nil</span><br>
<span class="lineno"></span><span class="op" id="4361397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4361400">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4361489">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4361567">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4361647">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4361686">func</span>&nbsp;<span class="ident" id="4361691">signPSSWithSalt</span><span class="op" id="4361706">(</span><span class="ident" id="4361707">rand</span>&nbsp;<span class="ident" id="4361712">io</span><span class="op" id="4361714">.</span><span class="ident" id="4361715">Reader</span><span class="op" id="4361721">,</span>&nbsp;<span class="ident" id="4361723">priv</span>&nbsp;<span class="op" id="4361728">*</span><span class="ident" id="4361729">PrivateKey</span><span class="op" id="4361739">,</span>&nbsp;<span class="ident" id="4361741">hash</span>&nbsp;<span class="ident" id="4361746">crypto</span><span class="op" id="4361752">.</span><span class="ident" id="4361753">Hash</span><span class="op" id="4361757">,</span>&nbsp;<span class="ident" id="4361759">hashed</span><span class="op" id="4361765">,</span>&nbsp;<span class="ident" id="4361767">salt</span>&nbsp;<span class="op" id="4361772">[</span><span class="op" id="4361773">]</span><span class="builtintype" id="4361774">byte</span><span class="op" id="4361778">)</span>&nbsp;<span class="op" id="4361780">(</span><span class="ident" id="4361781">s</span>&nbsp;<span class="op" id="4361783">[</span><span class="op" id="4361784">]</span><span class="builtintype" id="4361785">byte</span><span class="op" id="4361789">,</span>&nbsp;<span class="ident" id="4361791">err</span>&nbsp;<span class="builtintype" id="4361795">error</span><span class="op" id="4361800">)</span>&nbsp;<span class="op" id="4361802">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361805">nBits</span>&nbsp;<span class="op" id="4361811">:=</span>&nbsp;<span class="ident" id="4361814">priv</span><span class="op" id="4361818">.</span><span class="ident" id="4361819">N</span><span class="op" id="4361820">.</span><span class="ident" id="4361821">BitLen</span><span class="op" id="4361827">(</span><span class="op" id="4361828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361831">em</span><span class="op" id="4361833">,</span>&nbsp;<span class="ident" id="4361835">err</span>&nbsp;<span class="op" id="4361839">:=</span>&nbsp;<span class="ident" id="4361842">emsaPSSEncode</span><span class="op" id="4361855">(</span><span class="ident" id="4361856">hashed</span><span class="op" id="4361862">,</span>&nbsp;<span class="ident" id="4361864">nBits</span><span class="op" id="4361869">-</span><span class="num" id="4361870">1</span><span class="op" id="4361871">,</span>&nbsp;<span class="ident" id="4361873">salt</span><span class="op" id="4361877">,</span>&nbsp;<span class="ident" id="4361879">hash</span><span class="op" id="4361883">.</span><span class="ident" id="4361884">New</span><span class="op" id="4361887">(</span><span class="op" id="4361888">)</span><span class="op" id="4361889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361892">if</span>&nbsp;<span class="ident" id="4361895">err</span>&nbsp;<span class="op" id="4361899">!=</span>&nbsp;<span class="ident" id="4361902">nil</span>&nbsp;<span class="op" id="4361906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361910">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361918">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361921">m</span>&nbsp;<span class="op" id="4361923">:=</span>&nbsp;<span class="builtinfunc" id="4361926">new</span><span class="op" id="4361929">(</span><span class="ident" id="4361930">big</span><span class="op" id="4361933">.</span><span class="ident" id="4361934">Int</span><span class="op" id="4361937">)</span><span class="op" id="4361938">.</span><span class="ident" id="4361939">SetBytes</span><span class="op" id="4361947">(</span><span class="ident" id="4361948">em</span><span class="op" id="4361950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361953">c</span><span class="op" id="4361954">,</span>&nbsp;<span class="ident" id="4361956">err</span>&nbsp;<span class="op" id="4361960">:=</span>&nbsp;<span class="ident" id="4361963">decrypt</span><span class="op" id="4361970">(</span><span class="ident" id="4361971">rand</span><span class="op" id="4361975">,</span>&nbsp;<span class="ident" id="4361977">priv</span><span class="op" id="4361981">,</span>&nbsp;<span class="ident" id="4361983">m</span><span class="op" id="4361984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361987">if</span>&nbsp;<span class="ident" id="4361990">err</span>&nbsp;<span class="op" id="4361994">!=</span>&nbsp;<span class="ident" id="4361997">nil</span>&nbsp;<span class="op" id="4362001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362005">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362013">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362016">s</span>&nbsp;<span class="op" id="4362018">=</span>&nbsp;<span class="builtinfunc" id="4362020">make</span><span class="op" id="4362024">(</span><span class="op" id="4362025">[</span><span class="op" id="4362026">]</span><span class="builtintype" id="4362027">byte</span><span class="op" id="4362031">,</span>&nbsp;<span class="op" id="4362033">(</span><span class="ident" id="4362034">nBits</span><span class="op" id="4362039">+</span><span class="num" id="4362040">7</span><span class="op" id="4362041">)</span><span class="op" id="4362042">/</span><span class="num" id="4362043">8</span><span class="op" id="4362044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362047">copyWithLeftPad</span><span class="op" id="4362062">(</span><span class="ident" id="4362063">s</span><span class="op" id="4362064">,</span>&nbsp;<span class="ident" id="4362066">c</span><span class="op" id="4362067">.</span><span class="ident" id="4362068">Bytes</span><span class="op" id="4362073">(</span><span class="op" id="4362074">)</span><span class="op" id="4362075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362078">return</span><br>
<span class="lineno"></span><span class="op" id="4362085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4362088">const</span>&nbsp;<span class="op" id="4362094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362097">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362169">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362239">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4362257">=</span>&nbsp;<span class="num" id="4362259">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362262">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362333">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362372">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4362396">=</span>&nbsp;<span class="op" id="4362398">-</span><span class="num" id="4362399">1</span><br>
<span class="lineno"></span><span class="op" id="4362401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362404">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4362478">type</span>&nbsp;<span class="ident" id="4362483">PSSOptions</span>&nbsp;<span class="keyword" id="4362494">struct</span>&nbsp;<span class="op" id="4362501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362504">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362567">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362640">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362669">SaltLength</span>&nbsp;<span class="builtintype" id="4362680">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362686">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362756">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362825">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362854">Hash</span>&nbsp;<span class="ident" id="4362859">crypto</span><span class="op" id="4362865">.</span><span class="ident" id="4362866">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4362871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362874">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4362937">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4362959">func</span>&nbsp;<span class="op" id="4362964">(</span><span class="ident" id="4362965">pssOpts</span>&nbsp;<span class="op" id="4362973">*</span><span class="ident" id="4362974">PSSOptions</span><span class="op" id="4362984">)</span>&nbsp;<span class="ident" id="4362986">HashFunc</span><span class="op" id="4362994">(</span><span class="op" id="4362995">)</span>&nbsp;<span class="ident" id="4362997">crypto</span><span class="op" id="4363003">.</span><span class="ident" id="4363004">Hash</span>&nbsp;<span class="op" id="4363009">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363012">return</span>&nbsp;<span class="ident" id="4363019">pssOpts</span><span class="op" id="4363026">.</span><span class="ident" id="4363027">Hash</span><br>
<span class="lineno"></span><span class="op" id="4363032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4363035">func</span>&nbsp;<span class="op" id="4363040">(</span><span class="ident" id="4363041">opts</span>&nbsp;<span class="op" id="4363046">*</span><span class="ident" id="4363047">PSSOptions</span><span class="op" id="4363057">)</span>&nbsp;<span class="ident" id="4363059">saltLength</span><span class="op" id="4363069">(</span><span class="op" id="4363070">)</span>&nbsp;<span class="builtintype" id="4363072">int</span>&nbsp;<span class="op" id="4363076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363079">if</span>&nbsp;<span class="ident" id="4363082">opts</span>&nbsp;<span class="op" id="4363087">==</span>&nbsp;<span class="ident" id="4363090">nil</span>&nbsp;<span class="op" id="4363094">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363098">return</span>&nbsp;<span class="ident" id="4363105">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363127">return</span>&nbsp;<span class="ident" id="4363134">opts</span><span class="op" id="4363138">.</span><span class="ident" id="4363139">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4363150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4363153">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4363221">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4363299">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4363376">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4363398">func</span>&nbsp;<span class="ident" id="4363403">SignPSS</span><span class="op" id="4363410">(</span><span class="ident" id="4363411">rand</span>&nbsp;<span class="ident" id="4363416">io</span><span class="op" id="4363418">.</span><span class="ident" id="4363419">Reader</span><span class="op" id="4363425">,</span>&nbsp;<span class="ident" id="4363427">priv</span>&nbsp;<span class="op" id="4363432">*</span><span class="ident" id="4363433">PrivateKey</span><span class="op" id="4363443">,</span>&nbsp;<span class="ident" id="4363445">hash</span>&nbsp;<span class="ident" id="4363450">crypto</span><span class="op" id="4363456">.</span><span class="ident" id="4363457">Hash</span><span class="op" id="4363461">,</span>&nbsp;<span class="ident" id="4363463">hashed</span>&nbsp;<span class="op" id="4363470">[</span><span class="op" id="4363471">]</span><span class="builtintype" id="4363472">byte</span><span class="op" id="4363476">,</span>&nbsp;<span class="ident" id="4363478">opts</span>&nbsp;<span class="op" id="4363483">*</span><span class="ident" id="4363484">PSSOptions</span><span class="op" id="4363494">)</span>&nbsp;<span class="op" id="4363496">(</span><span class="ident" id="4363497">s</span>&nbsp;<span class="op" id="4363499">[</span><span class="op" id="4363500">]</span><span class="builtintype" id="4363501">byte</span><span class="op" id="4363505">,</span>&nbsp;<span class="ident" id="4363507">err</span>&nbsp;<span class="builtintype" id="4363511">error</span><span class="op" id="4363516">)</span>&nbsp;<span class="op" id="4363518">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363521">saltLength</span>&nbsp;<span class="op" id="4363532">:=</span>&nbsp;<span class="ident" id="4363535">opts</span><span class="op" id="4363539">.</span><span class="ident" id="4363540">saltLength</span><span class="op" id="4363550">(</span><span class="op" id="4363551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363554">switch</span>&nbsp;<span class="ident" id="4363561">saltLength</span>&nbsp;<span class="op" id="4363572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363575">case</span>&nbsp;<span class="ident" id="4363580">PSSSaltLengthAuto</span><span class="op" id="4363597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363601">saltLength</span>&nbsp;<span class="op" id="4363612">=</span>&nbsp;<span class="op" id="4363614">(</span><span class="ident" id="4363615">priv</span><span class="op" id="4363619">.</span><span class="ident" id="4363620">N</span><span class="op" id="4363621">.</span><span class="ident" id="4363622">BitLen</span><span class="op" id="4363628">(</span><span class="op" id="4363629">)</span><span class="op" id="4363630">+</span><span class="num" id="4363631">7</span><span class="op" id="4363632">)</span><span class="op" id="4363633">/</span><span class="num" id="4363634">8</span>&nbsp;<span class="op" id="4363636">-</span>&nbsp;<span class="num" id="4363638">2</span>&nbsp;<span class="op" id="4363640">-</span>&nbsp;<span class="ident" id="4363642">hash</span><span class="op" id="4363646">.</span><span class="ident" id="4363647">Size</span><span class="op" id="4363651">(</span><span class="op" id="4363652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363655">case</span>&nbsp;<span class="ident" id="4363660">PSSSaltLengthEqualsHash</span><span class="op" id="4363683">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363687">saltLength</span>&nbsp;<span class="op" id="4363698">=</span>&nbsp;<span class="ident" id="4363700">hash</span><span class="op" id="4363704">.</span><span class="ident" id="4363705">Size</span><span class="op" id="4363709">(</span><span class="op" id="4363710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363717">if</span>&nbsp;<span class="ident" id="4363720">opts</span><span class="op" id="4363724">.</span><span class="ident" id="4363725">Hash</span>&nbsp;<span class="op" id="4363730">!=</span>&nbsp;<span class="num" id="4363733">0</span>&nbsp;<span class="op" id="4363735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363739">hash</span>&nbsp;<span class="op" id="4363744">=</span>&nbsp;<span class="ident" id="4363746">opts</span><span class="op" id="4363750">.</span><span class="ident" id="4363751">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363761">salt</span>&nbsp;<span class="op" id="4363766">:=</span>&nbsp;<span class="builtinfunc" id="4363769">make</span><span class="op" id="4363773">(</span><span class="op" id="4363774">[</span><span class="op" id="4363775">]</span><span class="builtintype" id="4363776">byte</span><span class="op" id="4363780">,</span>&nbsp;<span class="ident" id="4363782">saltLength</span><span class="op" id="4363792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363795">if</span>&nbsp;<span class="ident" id="4363798">_</span><span class="op" id="4363799">,</span>&nbsp;<span class="ident" id="4363801">err</span>&nbsp;<span class="op" id="4363805">=</span>&nbsp;<span class="ident" id="4363807">io</span><span class="op" id="4363809">.</span><span class="ident" id="4363810">ReadFull</span><span class="op" id="4363818">(</span><span class="ident" id="4363819">rand</span><span class="op" id="4363823">,</span>&nbsp;<span class="ident" id="4363825">salt</span><span class="op" id="4363829">)</span><span class="op" id="4363830">;</span>&nbsp;<span class="ident" id="4363832">err</span>&nbsp;<span class="op" id="4363836">!=</span>&nbsp;<span class="ident" id="4363839">nil</span>&nbsp;<span class="op" id="4363843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363847">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363858">return</span>&nbsp;<span class="ident" id="4363865">signPSSWithSalt</span><span class="op" id="4363880">(</span><span class="ident" id="4363881">rand</span><span class="op" id="4363885">,</span>&nbsp;<span class="ident" id="4363887">priv</span><span class="op" id="4363891">,</span>&nbsp;<span class="ident" id="4363893">hash</span><span class="op" id="4363897">,</span>&nbsp;<span class="ident" id="4363899">hashed</span><span class="op" id="4363905">,</span>&nbsp;<span class="ident" id="4363907">salt</span><span class="op" id="4363911">)</span><br>
<span class="lineno"></span><span class="op" id="4363913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4363916">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4363955">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4364029">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4364101">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4364180">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4364202">func</span>&nbsp;<span class="ident" id="4364207">VerifyPSS</span><span class="op" id="4364216">(</span><span class="ident" id="4364217">pub</span>&nbsp;<span class="op" id="4364221">*</span><span class="ident" id="4364222">PublicKey</span><span class="op" id="4364231">,</span>&nbsp;<span class="ident" id="4364233">hash</span>&nbsp;<span class="ident" id="4364238">crypto</span><span class="op" id="4364244">.</span><span class="ident" id="4364245">Hash</span><span class="op" id="4364249">,</span>&nbsp;<span class="ident" id="4364251">hashed</span>&nbsp;<span class="op" id="4364258">[</span><span class="op" id="4364259">]</span><span class="builtintype" id="4364260">byte</span><span class="op" id="4364264">,</span>&nbsp;<span class="ident" id="4364266">sig</span>&nbsp;<span class="op" id="4364270">[</span><span class="op" id="4364271">]</span><span class="builtintype" id="4364272">byte</span><span class="op" id="4364276">,</span>&nbsp;<span class="ident" id="4364278">opts</span>&nbsp;<span class="op" id="4364283">*</span><span class="ident" id="4364284">PSSOptions</span><span class="op" id="4364294">)</span>&nbsp;<span class="builtintype" id="4364296">error</span>&nbsp;<span class="op" id="4364302">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364305">return</span>&nbsp;<span class="ident" id="4364312">verifyPSS</span><span class="op" id="4364321">(</span><span class="ident" id="4364322">pub</span><span class="op" id="4364325">,</span>&nbsp;<span class="ident" id="4364327">hash</span><span class="op" id="4364331">,</span>&nbsp;<span class="ident" id="4364333">hashed</span><span class="op" id="4364339">,</span>&nbsp;<span class="ident" id="4364341">sig</span><span class="op" id="4364344">,</span>&nbsp;<span class="ident" id="4364346">opts</span><span class="op" id="4364350">.</span><span class="ident" id="4364351">saltLength</span><span class="op" id="4364361">(</span><span class="op" id="4364362">)</span><span class="op" id="4364363">)</span><br>
<span class="lineno"></span><span class="op" id="4364365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4364368">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4364434">func</span>&nbsp;<span class="ident" id="4364439">verifyPSS</span><span class="op" id="4364448">(</span><span class="ident" id="4364449">pub</span>&nbsp;<span class="op" id="4364453">*</span><span class="ident" id="4364454">PublicKey</span><span class="op" id="4364463">,</span>&nbsp;<span class="ident" id="4364465">hash</span>&nbsp;<span class="ident" id="4364470">crypto</span><span class="op" id="4364476">.</span><span class="ident" id="4364477">Hash</span><span class="op" id="4364481">,</span>&nbsp;<span class="ident" id="4364483">hashed</span>&nbsp;<span class="op" id="4364490">[</span><span class="op" id="4364491">]</span><span class="builtintype" id="4364492">byte</span><span class="op" id="4364496">,</span>&nbsp;<span class="ident" id="4364498">sig</span>&nbsp;<span class="op" id="4364502">[</span><span class="op" id="4364503">]</span><span class="builtintype" id="4364504">byte</span><span class="op" id="4364508">,</span>&nbsp;<span class="ident" id="4364510">saltLen</span>&nbsp;<span class="builtintype" id="4364518">int</span><span class="op" id="4364521">)</span>&nbsp;<span class="builtintype" id="4364523">error</span>&nbsp;<span class="op" id="4364529">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364532">nBits</span>&nbsp;<span class="op" id="4364538">:=</span>&nbsp;<span class="ident" id="4364541">pub</span><span class="op" id="4364544">.</span><span class="ident" id="4364545">N</span><span class="op" id="4364546">.</span><span class="ident" id="4364547">BitLen</span><span class="op" id="4364553">(</span><span class="op" id="4364554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364557">if</span>&nbsp;<span class="builtinfunc" id="4364560">len</span><span class="op" id="4364563">(</span><span class="ident" id="4364564">sig</span><span class="op" id="4364567">)</span>&nbsp;<span class="op" id="4364569">!=</span>&nbsp;<span class="op" id="4364572">(</span><span class="ident" id="4364573">nBits</span><span class="op" id="4364578">+</span><span class="num" id="4364579">7</span><span class="op" id="4364580">)</span><span class="op" id="4364581">/</span><span class="num" id="4364582">8</span>&nbsp;<span class="op" id="4364584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364588">return</span>&nbsp;<span class="ident" id="4364595">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364615">s</span>&nbsp;<span class="op" id="4364617">:=</span>&nbsp;<span class="builtinfunc" id="4364620">new</span><span class="op" id="4364623">(</span><span class="ident" id="4364624">big</span><span class="op" id="4364627">.</span><span class="ident" id="4364628">Int</span><span class="op" id="4364631">)</span><span class="op" id="4364632">.</span><span class="ident" id="4364633">SetBytes</span><span class="op" id="4364641">(</span><span class="ident" id="4364642">sig</span><span class="op" id="4364645">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364648">m</span>&nbsp;<span class="op" id="4364650">:=</span>&nbsp;<span class="ident" id="4364653">encrypt</span><span class="op" id="4364660">(</span><span class="builtinfunc" id="4364661">new</span><span class="op" id="4364664">(</span><span class="ident" id="4364665">big</span><span class="op" id="4364668">.</span><span class="ident" id="4364669">Int</span><span class="op" id="4364672">)</span><span class="op" id="4364673">,</span>&nbsp;<span class="ident" id="4364675">pub</span><span class="op" id="4364678">,</span>&nbsp;<span class="ident" id="4364680">s</span><span class="op" id="4364681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364684">emBits</span>&nbsp;<span class="op" id="4364691">:=</span>&nbsp;<span class="ident" id="4364694">nBits</span>&nbsp;<span class="op" id="4364700">-</span>&nbsp;<span class="num" id="4364702">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364705">emLen</span>&nbsp;<span class="op" id="4364711">:=</span>&nbsp;<span class="op" id="4364714">(</span><span class="ident" id="4364715">emBits</span>&nbsp;<span class="op" id="4364722">+</span>&nbsp;<span class="num" id="4364724">7</span><span class="op" id="4364725">)</span>&nbsp;<span class="op" id="4364727">/</span>&nbsp;<span class="num" id="4364729">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364732">if</span>&nbsp;<span class="ident" id="4364735">emLen</span>&nbsp;<span class="op" id="4364741">&lt;</span>&nbsp;<span class="builtinfunc" id="4364743">len</span><span class="op" id="4364746">(</span><span class="ident" id="4364747">m</span><span class="op" id="4364748">.</span><span class="ident" id="4364749">Bytes</span><span class="op" id="4364754">(</span><span class="op" id="4364755">)</span><span class="op" id="4364756">)</span>&nbsp;<span class="op" id="4364758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364762">return</span>&nbsp;<span class="ident" id="4364769">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364789">em</span>&nbsp;<span class="op" id="4364792">:=</span>&nbsp;<span class="builtinfunc" id="4364795">make</span><span class="op" id="4364799">(</span><span class="op" id="4364800">[</span><span class="op" id="4364801">]</span><span class="builtintype" id="4364802">byte</span><span class="op" id="4364806">,</span>&nbsp;<span class="ident" id="4364808">emLen</span><span class="op" id="4364813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364816">copyWithLeftPad</span><span class="op" id="4364831">(</span><span class="ident" id="4364832">em</span><span class="op" id="4364834">,</span>&nbsp;<span class="ident" id="4364836">m</span><span class="op" id="4364837">.</span><span class="ident" id="4364838">Bytes</span><span class="op" id="4364843">(</span><span class="op" id="4364844">)</span><span class="op" id="4364845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364848">if</span>&nbsp;<span class="ident" id="4364851">saltLen</span>&nbsp;<span class="op" id="4364859">==</span>&nbsp;<span class="ident" id="4364862">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4364886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4364890">saltLen</span>&nbsp;<span class="op" id="4364898">=</span>&nbsp;<span class="ident" id="4364900">hash</span><span class="op" id="4364904">.</span><span class="ident" id="4364905">Size</span><span class="op" id="4364909">(</span><span class="op" id="4364910">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4364913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364916">return</span>&nbsp;<span class="ident" id="4364923">emsaPSSVerify</span><span class="op" id="4364936">(</span><span class="ident" id="4364937">hashed</span><span class="op" id="4364943">,</span>&nbsp;<span class="ident" id="4364945">em</span><span class="op" id="4364947">,</span>&nbsp;<span class="ident" id="4364949">emBits</span><span class="op" id="4364955">,</span>&nbsp;<span class="ident" id="4364957">saltLen</span><span class="op" id="4364964">,</span>&nbsp;<span class="ident" id="4364966">hash</span><span class="op" id="4364970">.</span><span class="ident" id="4364971">New</span><span class="op" id="4364974">(</span><span class="op" id="4364975">)</span><span class="op" id="4364976">)</span><br>
<span class="lineno"></span><span class="op" id="4364978">}</span>
</div>
</body>
</html>
