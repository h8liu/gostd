<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3218628">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3218684">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3218738">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3218789">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3218867">package</span>&nbsp;<span class="ident" id="3218875">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3218880">import</span>&nbsp;<span class="op" id="3218887">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3218890">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3218901">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3218908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3218911">//&nbsp;BUG(mikio):&nbsp;On&nbsp;every&nbsp;POSIX&nbsp;platform,&nbsp;reads&nbsp;from&nbsp;the&nbsp;&#34;ip4&#34;&nbsp;network</span><br>
<span class="lineno">15</span><span class="comment" id="3218980">//&nbsp;using&nbsp;the&nbsp;ReadFrom&nbsp;or&nbsp;ReadFromIP&nbsp;method&nbsp;might&nbsp;not&nbsp;return&nbsp;a&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="3219051">//&nbsp;IPv4&nbsp;packet,&nbsp;including&nbsp;its&nbsp;header,&nbsp;even&nbsp;if&nbsp;there&nbsp;is&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3219112">//&nbsp;available.&nbsp;This&nbsp;can&nbsp;occur&nbsp;even&nbsp;in&nbsp;cases&nbsp;where&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3219179">//&nbsp;could&nbsp;return&nbsp;a&nbsp;complete&nbsp;packet.&nbsp;For&nbsp;this&nbsp;reason,&nbsp;it&nbsp;is&nbsp;recommended</span><br>
<span class="lineno"></span><span class="comment" id="3219249">//&nbsp;that&nbsp;you&nbsp;do&nbsp;not&nbsp;uses&nbsp;these&nbsp;methods&nbsp;if&nbsp;it&nbsp;is&nbsp;important&nbsp;to&nbsp;receive&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3219319">//&nbsp;full&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3219335">//</span><br>
<span class="lineno"></span><span class="comment" id="3219338">//&nbsp;The&nbsp;Go&nbsp;1&nbsp;compatibility&nbsp;guidelines&nbsp;make&nbsp;it&nbsp;impossible&nbsp;for&nbsp;us&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3219404">//&nbsp;change&nbsp;the&nbsp;behavior&nbsp;of&nbsp;these&nbsp;methods;&nbsp;use&nbsp;Read&nbsp;or&nbsp;ReadMsgIP</span><br>
<span class="lineno"></span><span class="comment" id="3219467">//&nbsp;instead.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3219480">func</span>&nbsp;<span class="ident" id="3219485">sockaddrToIP</span><span class="op" id="3219497">(</span><span class="ident" id="3219498">sa</span>&nbsp;<span class="ident" id="3219501">syscall</span><span class="op" id="3219508">.</span><span class="ident" id="3219509">Sockaddr</span><span class="op" id="3219517">)</span>&nbsp;<span class="ident" id="3219519">Addr</span>&nbsp;<span class="op" id="3219524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219527">switch</span>&nbsp;<span class="ident" id="3219534">sa</span>&nbsp;<span class="op" id="3219537">:=</span>&nbsp;<span class="ident" id="3219540">sa</span><span class="op" id="3219542">.</span><span class="op" id="3219543">(</span><span class="keyword" id="3219544">type</span><span class="op" id="3219548">)</span>&nbsp;<span class="op" id="3219550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219553">case</span>&nbsp;<span class="op" id="3219558">*</span><span class="ident" id="3219559">syscall</span><span class="op" id="3219566">.</span><span class="ident" id="3219567">SockaddrInet4</span><span class="op" id="3219580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219584">return</span>&nbsp;<span class="op" id="3219591">&amp;</span><span class="ident" id="3219592">IPAddr</span><span class="op" id="3219598">{</span><span class="ident" id="3219599">IP</span><span class="op" id="3219601">:</span>&nbsp;<span class="ident" id="3219603">sa</span><span class="op" id="3219605">.</span><span class="ident" id="3219606">Addr</span><span class="op" id="3219610">[</span><span class="num" id="3219611">0</span><span class="op" id="3219612">:</span><span class="op" id="3219613">]</span><span class="op" id="3219614">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219617">case</span>&nbsp;<span class="op" id="3219622">*</span><span class="ident" id="3219623">syscall</span><span class="op" id="3219630">.</span><span class="ident" id="3219631">SockaddrInet6</span><span class="op" id="3219644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219648">return</span>&nbsp;<span class="op" id="3219655">&amp;</span><span class="ident" id="3219656">IPAddr</span><span class="op" id="3219662">{</span><span class="ident" id="3219663">IP</span><span class="op" id="3219665">:</span>&nbsp;<span class="ident" id="3219667">sa</span><span class="op" id="3219669">.</span><span class="ident" id="3219670">Addr</span><span class="op" id="3219674">[</span><span class="num" id="3219675">0</span><span class="op" id="3219676">:</span><span class="op" id="3219677">]</span><span class="op" id="3219678">,</span>&nbsp;<span class="ident" id="3219680">Zone</span><span class="op" id="3219684">:</span>&nbsp;<span class="ident" id="3219686">zoneToString</span><span class="op" id="3219698">(</span><span class="builtintype" id="3219699">int</span><span class="op" id="3219702">(</span><span class="ident" id="3219703">sa</span><span class="op" id="3219705">.</span><span class="ident" id="3219706">ZoneId</span><span class="op" id="3219712">)</span><span class="op" id="3219713">)</span><span class="op" id="3219714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219720">return</span>&nbsp;<span class="ident" id="3219727">nil</span><br>
<span class="lineno"></span><span class="op" id="3219731">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3219734">func</span>&nbsp;<span class="op" id="3219739">(</span><span class="ident" id="3219740">a</span>&nbsp;<span class="op" id="3219742">*</span><span class="ident" id="3219743">IPAddr</span><span class="op" id="3219749">)</span>&nbsp;<span class="ident" id="3219751">family</span><span class="op" id="3219757">(</span><span class="op" id="3219758">)</span>&nbsp;<span class="builtintype" id="3219760">int</span>&nbsp;<span class="op" id="3219764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219767">if</span>&nbsp;<span class="ident" id="3219770">a</span>&nbsp;<span class="op" id="3219772">==</span>&nbsp;<span class="ident" id="3219775">nil</span>&nbsp;<span class="op" id="3219779">||</span>&nbsp;<span class="builtinfunc" id="3219782">len</span><span class="op" id="3219785">(</span><span class="ident" id="3219786">a</span><span class="op" id="3219787">.</span><span class="ident" id="3219788">IP</span><span class="op" id="3219790">)</span>&nbsp;<span class="op" id="3219792">&lt;=</span>&nbsp;<span class="ident" id="3219795">IPv4len</span>&nbsp;<span class="op" id="3219803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219807">return</span>&nbsp;<span class="ident" id="3219814">syscall</span><span class="op" id="3219821">.</span><span class="ident" id="3219822">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219831">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219834">if</span>&nbsp;<span class="ident" id="3219837">a</span><span class="op" id="3219838">.</span><span class="ident" id="3219839">IP</span><span class="op" id="3219841">.</span><span class="ident" id="3219842">To4</span><span class="op" id="3219845">(</span><span class="op" id="3219846">)</span>&nbsp;<span class="op" id="3219848">!=</span>&nbsp;<span class="ident" id="3219851">nil</span>&nbsp;<span class="op" id="3219855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219859">return</span>&nbsp;<span class="ident" id="3219866">syscall</span><span class="op" id="3219873">.</span><span class="ident" id="3219874">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219886">return</span>&nbsp;<span class="ident" id="3219893">syscall</span><span class="op" id="3219900">.</span><span class="ident" id="3219901">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3219910">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3219913">func</span>&nbsp;<span class="op" id="3219918">(</span><span class="ident" id="3219919">a</span>&nbsp;<span class="op" id="3219921">*</span><span class="ident" id="3219922">IPAddr</span><span class="op" id="3219928">)</span>&nbsp;<span class="ident" id="3219930">isWildcard</span><span class="op" id="3219940">(</span><span class="op" id="3219941">)</span>&nbsp;<span class="builtintype" id="3219943">bool</span>&nbsp;<span class="op" id="3219948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219951">if</span>&nbsp;<span class="ident" id="3219954">a</span>&nbsp;<span class="op" id="3219956">==</span>&nbsp;<span class="ident" id="3219959">nil</span>&nbsp;<span class="op" id="3219963">||</span>&nbsp;<span class="ident" id="3219966">a</span><span class="op" id="3219967">.</span><span class="ident" id="3219968">IP</span>&nbsp;<span class="op" id="3219971">==</span>&nbsp;<span class="ident" id="3219974">nil</span>&nbsp;<span class="op" id="3219978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219982">return</span>&nbsp;<span class="builtintype" id="3219989">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3219995">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3219998">return</span>&nbsp;<span class="ident" id="3220005">a</span><span class="op" id="3220006">.</span><span class="ident" id="3220007">IP</span><span class="op" id="3220009">.</span><span class="ident" id="3220010">IsUnspecified</span><span class="op" id="3220023">(</span><span class="op" id="3220024">)</span><br>
<span class="lineno"></span><span class="op" id="3220026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3220029">func</span>&nbsp;<span class="op" id="3220034">(</span><span class="ident" id="3220035">a</span>&nbsp;<span class="op" id="3220037">*</span><span class="ident" id="3220038">IPAddr</span><span class="op" id="3220044">)</span>&nbsp;<span class="ident" id="3220046">sockaddr</span><span class="op" id="3220054">(</span><span class="ident" id="3220055">family</span>&nbsp;<span class="builtintype" id="3220062">int</span><span class="op" id="3220065">)</span>&nbsp;<span class="op" id="3220067">(</span><span class="ident" id="3220068">syscall</span><span class="op" id="3220075">.</span><span class="ident" id="3220076">Sockaddr</span><span class="op" id="3220084">,</span>&nbsp;<span class="builtintype" id="3220086">error</span><span class="op" id="3220091">)</span>&nbsp;<span class="op" id="3220093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220096">if</span>&nbsp;<span class="ident" id="3220099">a</span>&nbsp;<span class="op" id="3220101">==</span>&nbsp;<span class="ident" id="3220104">nil</span>&nbsp;<span class="op" id="3220108">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220112">return</span>&nbsp;<span class="ident" id="3220119">nil</span><span class="op" id="3220122">,</span>&nbsp;<span class="ident" id="3220124">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220132">return</span>&nbsp;<span class="ident" id="3220139">ipToSockaddr</span><span class="op" id="3220151">(</span><span class="ident" id="3220152">family</span><span class="op" id="3220158">,</span>&nbsp;<span class="ident" id="3220160">a</span><span class="op" id="3220161">.</span><span class="ident" id="3220162">IP</span><span class="op" id="3220164">,</span>&nbsp;<span class="num" id="3220166">0</span><span class="op" id="3220167">,</span>&nbsp;<span class="ident" id="3220169">a</span><span class="op" id="3220170">.</span><span class="ident" id="3220171">Zone</span><span class="op" id="3220175">)</span><br>
<span class="lineno"></span><span class="op" id="3220177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3220180">//&nbsp;IPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3220250">//&nbsp;for&nbsp;IP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3220281">type</span>&nbsp;<span class="ident" id="3220286">IPConn</span>&nbsp;<span class="keyword" id="3220293">struct</span>&nbsp;<span class="op" id="3220300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220303">conn</span><br>
<span class="lineno"></span><span class="op" id="3220308">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3220311">func</span>&nbsp;<span class="ident" id="3220316">newIPConn</span><span class="op" id="3220325">(</span><span class="ident" id="3220326">fd</span>&nbsp;<span class="op" id="3220329">*</span><span class="ident" id="3220330">netFD</span><span class="op" id="3220335">)</span>&nbsp;<span class="op" id="3220337">*</span><span class="ident" id="3220338">IPConn</span>&nbsp;<span class="op" id="3220345">{</span>&nbsp;<span class="keyword" id="3220347">return</span>&nbsp;<span class="op" id="3220354">&amp;</span><span class="ident" id="3220355">IPConn</span><span class="op" id="3220361">{</span><span class="ident" id="3220362">conn</span><span class="op" id="3220366">{</span><span class="ident" id="3220367">fd</span><span class="op" id="3220369">}</span><span class="op" id="3220370">}</span>&nbsp;<span class="op" id="3220372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3220375">//&nbsp;ReadFromIP&nbsp;reads&nbsp;an&nbsp;IP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3220444">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno">70</span><span class="comment" id="3220515">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3220542">//</span><br>
<span class="lineno"></span><span class="comment" id="3220545">//&nbsp;ReadFromIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3220608">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3220675">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno">75</span><span class="keyword" id="3220695">func</span>&nbsp;<span class="op" id="3220700">(</span><span class="ident" id="3220701">c</span>&nbsp;<span class="op" id="3220703">*</span><span class="ident" id="3220704">IPConn</span><span class="op" id="3220710">)</span>&nbsp;<span class="ident" id="3220712">ReadFromIP</span><span class="op" id="3220722">(</span><span class="ident" id="3220723">b</span>&nbsp;<span class="op" id="3220725">[</span><span class="op" id="3220726">]</span><span class="builtintype" id="3220727">byte</span><span class="op" id="3220731">)</span>&nbsp;<span class="op" id="3220733">(</span><span class="builtintype" id="3220734">int</span><span class="op" id="3220737">,</span>&nbsp;<span class="op" id="3220739">*</span><span class="ident" id="3220740">IPAddr</span><span class="op" id="3220746">,</span>&nbsp;<span class="builtintype" id="3220748">error</span><span class="op" id="3220753">)</span>&nbsp;<span class="op" id="3220755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220758">if</span>&nbsp;<span class="op" id="3220761">!</span><span class="ident" id="3220762">c</span><span class="op" id="3220763">.</span><span class="ident" id="3220764">ok</span><span class="op" id="3220766">(</span><span class="op" id="3220767">)</span>&nbsp;<span class="op" id="3220769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220773">return</span>&nbsp;<span class="num" id="3220780">0</span><span class="op" id="3220781">,</span>&nbsp;<span class="ident" id="3220783">nil</span><span class="op" id="3220786">,</span>&nbsp;<span class="ident" id="3220788">syscall</span><span class="op" id="3220795">.</span><span class="ident" id="3220796">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3220804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3220807">//&nbsp;TODO(cw,rsc):&nbsp;consider&nbsp;using&nbsp;readv&nbsp;if&nbsp;we&nbsp;know&nbsp;the&nbsp;family</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3220868">//&nbsp;type&nbsp;to&nbsp;avoid&nbsp;the&nbsp;header&nbsp;trim/copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220907">var</span>&nbsp;<span class="ident" id="3220911">addr</span>&nbsp;<span class="op" id="3220916">*</span><span class="ident" id="3220917">IPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3220925">n</span><span class="op" id="3220926">,</span>&nbsp;<span class="ident" id="3220928">sa</span><span class="op" id="3220930">,</span>&nbsp;<span class="ident" id="3220932">err</span>&nbsp;<span class="op" id="3220936">:=</span>&nbsp;<span class="ident" id="3220939">c</span><span class="op" id="3220940">.</span><span class="ident" id="3220941">fd</span><span class="op" id="3220943">.</span><span class="ident" id="3220944">readFrom</span><span class="op" id="3220952">(</span><span class="ident" id="3220953">b</span><span class="op" id="3220954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220957">switch</span>&nbsp;<span class="ident" id="3220964">sa</span>&nbsp;<span class="op" id="3220967">:=</span>&nbsp;<span class="ident" id="3220970">sa</span><span class="op" id="3220972">.</span><span class="op" id="3220973">(</span><span class="keyword" id="3220974">type</span><span class="op" id="3220978">)</span>&nbsp;<span class="op" id="3220980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3220983">case</span>&nbsp;<span class="op" id="3220988">*</span><span class="ident" id="3220989">syscall</span><span class="op" id="3220996">.</span><span class="ident" id="3220997">SockaddrInet4</span><span class="op" id="3221010">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221014">addr</span>&nbsp;<span class="op" id="3221019">=</span>&nbsp;<span class="op" id="3221021">&amp;</span><span class="ident" id="3221022">IPAddr</span><span class="op" id="3221028">{</span><span class="ident" id="3221029">IP</span><span class="op" id="3221031">:</span>&nbsp;<span class="ident" id="3221033">sa</span><span class="op" id="3221035">.</span><span class="ident" id="3221036">Addr</span><span class="op" id="3221040">[</span><span class="num" id="3221041">0</span><span class="op" id="3221042">:</span><span class="op" id="3221043">]</span><span class="op" id="3221044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221048">if</span>&nbsp;<span class="builtinfunc" id="3221051">len</span><span class="op" id="3221054">(</span><span class="ident" id="3221055">b</span><span class="op" id="3221056">)</span>&nbsp;<span class="op" id="3221058">&gt;=</span>&nbsp;<span class="ident" id="3221061">IPv4len</span>&nbsp;<span class="op" id="3221069">{</span>&nbsp;<span class="comment" id="3221071">//&nbsp;discard&nbsp;ipv4&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221097">hsize</span>&nbsp;<span class="op" id="3221103">:=</span>&nbsp;<span class="op" id="3221106">(</span><span class="builtintype" id="3221107">int</span><span class="op" id="3221110">(</span><span class="ident" id="3221111">b</span><span class="op" id="3221112">[</span><span class="num" id="3221113">0</span><span class="op" id="3221114">]</span><span class="op" id="3221115">)</span>&nbsp;<span class="op" id="3221117">&amp;</span>&nbsp;<span class="num" id="3221119">0xf</span><span class="op" id="3221122">)</span>&nbsp;<span class="op" id="3221124">*</span>&nbsp;<span class="num" id="3221126">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3221131">copy</span><span class="op" id="3221135">(</span><span class="ident" id="3221136">b</span><span class="op" id="3221137">,</span>&nbsp;<span class="ident" id="3221139">b</span><span class="op" id="3221140">[</span><span class="ident" id="3221141">hsize</span><span class="op" id="3221146">:</span><span class="op" id="3221147">]</span><span class="op" id="3221148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221153">n</span>&nbsp;<span class="op" id="3221155">-=</span>&nbsp;<span class="ident" id="3221158">hsize</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221169">case</span>&nbsp;<span class="op" id="3221174">*</span><span class="ident" id="3221175">syscall</span><span class="op" id="3221182">.</span><span class="ident" id="3221183">SockaddrInet6</span><span class="op" id="3221196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221200">addr</span>&nbsp;<span class="op" id="3221205">=</span>&nbsp;<span class="op" id="3221207">&amp;</span><span class="ident" id="3221208">IPAddr</span><span class="op" id="3221214">{</span><span class="ident" id="3221215">IP</span><span class="op" id="3221217">:</span>&nbsp;<span class="ident" id="3221219">sa</span><span class="op" id="3221221">.</span><span class="ident" id="3221222">Addr</span><span class="op" id="3221226">[</span><span class="num" id="3221227">0</span><span class="op" id="3221228">:</span><span class="op" id="3221229">]</span><span class="op" id="3221230">,</span>&nbsp;<span class="ident" id="3221232">Zone</span><span class="op" id="3221236">:</span>&nbsp;<span class="ident" id="3221238">zoneToString</span><span class="op" id="3221250">(</span><span class="builtintype" id="3221251">int</span><span class="op" id="3221254">(</span><span class="ident" id="3221255">sa</span><span class="op" id="3221257">.</span><span class="ident" id="3221258">ZoneId</span><span class="op" id="3221264">)</span><span class="op" id="3221265">)</span><span class="op" id="3221266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221272">return</span>&nbsp;<span class="ident" id="3221279">n</span><span class="op" id="3221280">,</span>&nbsp;<span class="ident" id="3221282">addr</span><span class="op" id="3221286">,</span>&nbsp;<span class="ident" id="3221288">err</span><br>
<span class="lineno">95</span><span class="op" id="3221292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3221295">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3221350">func</span>&nbsp;<span class="op" id="3221355">(</span><span class="ident" id="3221356">c</span>&nbsp;<span class="op" id="3221358">*</span><span class="ident" id="3221359">IPConn</span><span class="op" id="3221365">)</span>&nbsp;<span class="ident" id="3221367">ReadFrom</span><span class="op" id="3221375">(</span><span class="ident" id="3221376">b</span>&nbsp;<span class="op" id="3221378">[</span><span class="op" id="3221379">]</span><span class="builtintype" id="3221380">byte</span><span class="op" id="3221384">)</span>&nbsp;<span class="op" id="3221386">(</span><span class="builtintype" id="3221387">int</span><span class="op" id="3221390">,</span>&nbsp;<span class="ident" id="3221392">Addr</span><span class="op" id="3221396">,</span>&nbsp;<span class="builtintype" id="3221398">error</span><span class="op" id="3221403">)</span>&nbsp;<span class="op" id="3221405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221408">if</span>&nbsp;<span class="op" id="3221411">!</span><span class="ident" id="3221412">c</span><span class="op" id="3221413">.</span><span class="ident" id="3221414">ok</span><span class="op" id="3221416">(</span><span class="op" id="3221417">)</span>&nbsp;<span class="op" id="3221419">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221423">return</span>&nbsp;<span class="num" id="3221430">0</span><span class="op" id="3221431">,</span>&nbsp;<span class="ident" id="3221433">nil</span><span class="op" id="3221436">,</span>&nbsp;<span class="ident" id="3221438">syscall</span><span class="op" id="3221445">.</span><span class="ident" id="3221446">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221457">n</span><span class="op" id="3221458">,</span>&nbsp;<span class="ident" id="3221460">addr</span><span class="op" id="3221464">,</span>&nbsp;<span class="ident" id="3221466">err</span>&nbsp;<span class="op" id="3221470">:=</span>&nbsp;<span class="ident" id="3221473">c</span><span class="op" id="3221474">.</span><span class="ident" id="3221475">ReadFromIP</span><span class="op" id="3221485">(</span><span class="ident" id="3221486">b</span><span class="op" id="3221487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221490">return</span>&nbsp;<span class="ident" id="3221497">n</span><span class="op" id="3221498">,</span>&nbsp;<span class="ident" id="3221500">addr</span><span class="op" id="3221504">.</span><span class="ident" id="3221505">toAddr</span><span class="op" id="3221511">(</span><span class="op" id="3221512">)</span><span class="op" id="3221513">,</span>&nbsp;<span class="ident" id="3221515">err</span><br>
<span class="lineno"></span><span class="op" id="3221519">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3221522">//&nbsp;ReadMsgIP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3221593">//&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3221660">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3221731">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno">110</span><span class="keyword" id="3221800">func</span>&nbsp;<span class="op" id="3221805">(</span><span class="ident" id="3221806">c</span>&nbsp;<span class="op" id="3221808">*</span><span class="ident" id="3221809">IPConn</span><span class="op" id="3221815">)</span>&nbsp;<span class="ident" id="3221817">ReadMsgIP</span><span class="op" id="3221826">(</span><span class="ident" id="3221827">b</span><span class="op" id="3221828">,</span>&nbsp;<span class="ident" id="3221830">oob</span>&nbsp;<span class="op" id="3221834">[</span><span class="op" id="3221835">]</span><span class="builtintype" id="3221836">byte</span><span class="op" id="3221840">)</span>&nbsp;<span class="op" id="3221842">(</span><span class="ident" id="3221843">n</span><span class="op" id="3221844">,</span>&nbsp;<span class="ident" id="3221846">oobn</span><span class="op" id="3221850">,</span>&nbsp;<span class="ident" id="3221852">flags</span>&nbsp;<span class="builtintype" id="3221858">int</span><span class="op" id="3221861">,</span>&nbsp;<span class="ident" id="3221863">addr</span>&nbsp;<span class="op" id="3221868">*</span><span class="ident" id="3221869">IPAddr</span><span class="op" id="3221875">,</span>&nbsp;<span class="ident" id="3221877">err</span>&nbsp;<span class="builtintype" id="3221881">error</span><span class="op" id="3221886">)</span>&nbsp;<span class="op" id="3221888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221891">if</span>&nbsp;<span class="op" id="3221894">!</span><span class="ident" id="3221895">c</span><span class="op" id="3221896">.</span><span class="ident" id="3221897">ok</span><span class="op" id="3221899">(</span><span class="op" id="3221900">)</span>&nbsp;<span class="op" id="3221902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221906">return</span>&nbsp;<span class="num" id="3221913">0</span><span class="op" id="3221914">,</span>&nbsp;<span class="num" id="3221916">0</span><span class="op" id="3221917">,</span>&nbsp;<span class="num" id="3221919">0</span><span class="op" id="3221920">,</span>&nbsp;<span class="ident" id="3221922">nil</span><span class="op" id="3221925">,</span>&nbsp;<span class="ident" id="3221927">syscall</span><span class="op" id="3221934">.</span><span class="ident" id="3221935">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3221943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3221946">var</span>&nbsp;<span class="ident" id="3221950">sa</span>&nbsp;<span class="ident" id="3221953">syscall</span><span class="op" id="3221960">.</span><span class="ident" id="3221961">Sockaddr</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3221971">n</span><span class="op" id="3221972">,</span>&nbsp;<span class="ident" id="3221974">oobn</span><span class="op" id="3221978">,</span>&nbsp;<span class="ident" id="3221980">flags</span><span class="op" id="3221985">,</span>&nbsp;<span class="ident" id="3221987">sa</span><span class="op" id="3221989">,</span>&nbsp;<span class="ident" id="3221991">err</span>&nbsp;<span class="op" id="3221995">=</span>&nbsp;<span class="ident" id="3221997">c</span><span class="op" id="3221998">.</span><span class="ident" id="3221999">fd</span><span class="op" id="3222001">.</span><span class="ident" id="3222002">readMsg</span><span class="op" id="3222009">(</span><span class="ident" id="3222010">b</span><span class="op" id="3222011">,</span>&nbsp;<span class="ident" id="3222013">oob</span><span class="op" id="3222016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222019">switch</span>&nbsp;<span class="ident" id="3222026">sa</span>&nbsp;<span class="op" id="3222029">:=</span>&nbsp;<span class="ident" id="3222032">sa</span><span class="op" id="3222034">.</span><span class="op" id="3222035">(</span><span class="keyword" id="3222036">type</span><span class="op" id="3222040">)</span>&nbsp;<span class="op" id="3222042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222045">case</span>&nbsp;<span class="op" id="3222050">*</span><span class="ident" id="3222051">syscall</span><span class="op" id="3222058">.</span><span class="ident" id="3222059">SockaddrInet4</span><span class="op" id="3222072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222076">addr</span>&nbsp;<span class="op" id="3222081">=</span>&nbsp;<span class="op" id="3222083">&amp;</span><span class="ident" id="3222084">IPAddr</span><span class="op" id="3222090">{</span><span class="ident" id="3222091">IP</span><span class="op" id="3222093">:</span>&nbsp;<span class="ident" id="3222095">sa</span><span class="op" id="3222097">.</span><span class="ident" id="3222098">Addr</span><span class="op" id="3222102">[</span><span class="num" id="3222103">0</span><span class="op" id="3222104">:</span><span class="op" id="3222105">]</span><span class="op" id="3222106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222109">case</span>&nbsp;<span class="op" id="3222114">*</span><span class="ident" id="3222115">syscall</span><span class="op" id="3222122">.</span><span class="ident" id="3222123">SockaddrInet6</span><span class="op" id="3222136">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222140">addr</span>&nbsp;<span class="op" id="3222145">=</span>&nbsp;<span class="op" id="3222147">&amp;</span><span class="ident" id="3222148">IPAddr</span><span class="op" id="3222154">{</span><span class="ident" id="3222155">IP</span><span class="op" id="3222157">:</span>&nbsp;<span class="ident" id="3222159">sa</span><span class="op" id="3222161">.</span><span class="ident" id="3222162">Addr</span><span class="op" id="3222166">[</span><span class="num" id="3222167">0</span><span class="op" id="3222168">:</span><span class="op" id="3222169">]</span><span class="op" id="3222170">,</span>&nbsp;<span class="ident" id="3222172">Zone</span><span class="op" id="3222176">:</span>&nbsp;<span class="ident" id="3222178">zoneToString</span><span class="op" id="3222190">(</span><span class="builtintype" id="3222191">int</span><span class="op" id="3222194">(</span><span class="ident" id="3222195">sa</span><span class="op" id="3222197">.</span><span class="ident" id="3222198">ZoneId</span><span class="op" id="3222204">)</span><span class="op" id="3222205">)</span><span class="op" id="3222206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222212">return</span><br>
<span class="lineno"></span><span class="op" id="3222219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3222222">//&nbsp;WriteToIP&nbsp;writes&nbsp;an&nbsp;IP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3222290">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3222301">//</span><br>
<span class="lineno"></span><span class="comment" id="3222304">//&nbsp;WriteToIP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3222366">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">130</span><span class="comment" id="3222433">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3222502">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3222515">func</span>&nbsp;<span class="op" id="3222520">(</span><span class="ident" id="3222521">c</span>&nbsp;<span class="op" id="3222523">*</span><span class="ident" id="3222524">IPConn</span><span class="op" id="3222530">)</span>&nbsp;<span class="ident" id="3222532">WriteToIP</span><span class="op" id="3222541">(</span><span class="ident" id="3222542">b</span>&nbsp;<span class="op" id="3222544">[</span><span class="op" id="3222545">]</span><span class="builtintype" id="3222546">byte</span><span class="op" id="3222550">,</span>&nbsp;<span class="ident" id="3222552">addr</span>&nbsp;<span class="op" id="3222557">*</span><span class="ident" id="3222558">IPAddr</span><span class="op" id="3222564">)</span>&nbsp;<span class="op" id="3222566">(</span><span class="builtintype" id="3222567">int</span><span class="op" id="3222570">,</span>&nbsp;<span class="builtintype" id="3222572">error</span><span class="op" id="3222577">)</span>&nbsp;<span class="op" id="3222579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222582">if</span>&nbsp;<span class="op" id="3222585">!</span><span class="ident" id="3222586">c</span><span class="op" id="3222587">.</span><span class="ident" id="3222588">ok</span><span class="op" id="3222590">(</span><span class="op" id="3222591">)</span>&nbsp;<span class="op" id="3222593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222597">return</span>&nbsp;<span class="num" id="3222604">0</span><span class="op" id="3222605">,</span>&nbsp;<span class="ident" id="3222607">syscall</span><span class="op" id="3222614">.</span><span class="ident" id="3222615">EINVAL</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222626">if</span>&nbsp;<span class="ident" id="3222629">c</span><span class="op" id="3222630">.</span><span class="ident" id="3222631">fd</span><span class="op" id="3222633">.</span><span class="ident" id="3222634">isConnected</span>&nbsp;<span class="op" id="3222646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222650">return</span>&nbsp;<span class="num" id="3222657">0</span><span class="op" id="3222658">,</span>&nbsp;<span class="op" id="3222660">&amp;</span><span class="ident" id="3222661">OpError</span><span class="op" id="3222668">{</span><span class="ident" id="3222669">Op</span><span class="op" id="3222671">:</span>&nbsp;<span class="string" id="3222673">&#34;write&#34;</span><span class="op" id="3222680">,</span>&nbsp;<span class="ident" id="3222682">Net</span><span class="op" id="3222685">:</span>&nbsp;<span class="ident" id="3222687">c</span><span class="op" id="3222688">.</span><span class="ident" id="3222689">fd</span><span class="op" id="3222691">.</span><span class="ident" id="3222692">net</span><span class="op" id="3222695">,</span>&nbsp;<span class="ident" id="3222697">Addr</span><span class="op" id="3222701">:</span>&nbsp;<span class="ident" id="3222703">addr</span><span class="op" id="3222707">,</span>&nbsp;<span class="ident" id="3222709">Err</span><span class="op" id="3222712">:</span>&nbsp;<span class="ident" id="3222714">ErrWriteToConnected</span><span class="op" id="3222733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222739">if</span>&nbsp;<span class="ident" id="3222742">addr</span>&nbsp;<span class="op" id="3222747">==</span>&nbsp;<span class="ident" id="3222750">nil</span>&nbsp;<span class="op" id="3222754">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222758">return</span>&nbsp;<span class="num" id="3222765">0</span><span class="op" id="3222766">,</span>&nbsp;<span class="op" id="3222768">&amp;</span><span class="ident" id="3222769">OpError</span><span class="op" id="3222776">{</span><span class="ident" id="3222777">Op</span><span class="op" id="3222779">:</span>&nbsp;<span class="string" id="3222781">&#34;write&#34;</span><span class="op" id="3222788">,</span>&nbsp;<span class="ident" id="3222790">Net</span><span class="op" id="3222793">:</span>&nbsp;<span class="ident" id="3222795">c</span><span class="op" id="3222796">.</span><span class="ident" id="3222797">fd</span><span class="op" id="3222799">.</span><span class="ident" id="3222800">net</span><span class="op" id="3222803">,</span>&nbsp;<span class="ident" id="3222805">Addr</span><span class="op" id="3222809">:</span>&nbsp;<span class="ident" id="3222811">nil</span><span class="op" id="3222814">,</span>&nbsp;<span class="ident" id="3222816">Err</span><span class="op" id="3222819">:</span>&nbsp;<span class="ident" id="3222821">errMissingAddress</span><span class="op" id="3222838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3222844">sa</span><span class="op" id="3222846">,</span>&nbsp;<span class="ident" id="3222848">err</span>&nbsp;<span class="op" id="3222852">:=</span>&nbsp;<span class="ident" id="3222855">addr</span><span class="op" id="3222859">.</span><span class="ident" id="3222860">sockaddr</span><span class="op" id="3222868">(</span><span class="ident" id="3222869">c</span><span class="op" id="3222870">.</span><span class="ident" id="3222871">fd</span><span class="op" id="3222873">.</span><span class="ident" id="3222874">family</span><span class="op" id="3222880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222883">if</span>&nbsp;<span class="ident" id="3222886">err</span>&nbsp;<span class="op" id="3222890">!=</span>&nbsp;<span class="ident" id="3222893">nil</span>&nbsp;<span class="op" id="3222897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222901">return</span>&nbsp;<span class="num" id="3222908">0</span><span class="op" id="3222909">,</span>&nbsp;<span class="op" id="3222911">&amp;</span><span class="ident" id="3222912">OpError</span><span class="op" id="3222919">{</span><span class="string" id="3222920">&#34;write&#34;</span><span class="op" id="3222927">,</span>&nbsp;<span class="ident" id="3222929">c</span><span class="op" id="3222930">.</span><span class="ident" id="3222931">fd</span><span class="op" id="3222933">.</span><span class="ident" id="3222934">net</span><span class="op" id="3222937">,</span>&nbsp;<span class="ident" id="3222939">addr</span><span class="op" id="3222943">,</span>&nbsp;<span class="ident" id="3222945">err</span><span class="op" id="3222948">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3222951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3222954">return</span>&nbsp;<span class="ident" id="3222961">c</span><span class="op" id="3222962">.</span><span class="ident" id="3222963">fd</span><span class="op" id="3222965">.</span><span class="ident" id="3222966">writeTo</span><span class="op" id="3222973">(</span><span class="ident" id="3222974">b</span><span class="op" id="3222975">,</span>&nbsp;<span class="ident" id="3222977">sa</span><span class="op" id="3222979">)</span><br>
<span class="lineno"></span><span class="op" id="3222981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3222984">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno">150</span><span class="keyword" id="3223037">func</span>&nbsp;<span class="op" id="3223042">(</span><span class="ident" id="3223043">c</span>&nbsp;<span class="op" id="3223045">*</span><span class="ident" id="3223046">IPConn</span><span class="op" id="3223052">)</span>&nbsp;<span class="ident" id="3223054">WriteTo</span><span class="op" id="3223061">(</span><span class="ident" id="3223062">b</span>&nbsp;<span class="op" id="3223064">[</span><span class="op" id="3223065">]</span><span class="builtintype" id="3223066">byte</span><span class="op" id="3223070">,</span>&nbsp;<span class="ident" id="3223072">addr</span>&nbsp;<span class="ident" id="3223077">Addr</span><span class="op" id="3223081">)</span>&nbsp;<span class="op" id="3223083">(</span><span class="builtintype" id="3223084">int</span><span class="op" id="3223087">,</span>&nbsp;<span class="builtintype" id="3223089">error</span><span class="op" id="3223094">)</span>&nbsp;<span class="op" id="3223096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223099">if</span>&nbsp;<span class="op" id="3223102">!</span><span class="ident" id="3223103">c</span><span class="op" id="3223104">.</span><span class="ident" id="3223105">ok</span><span class="op" id="3223107">(</span><span class="op" id="3223108">)</span>&nbsp;<span class="op" id="3223110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223114">return</span>&nbsp;<span class="num" id="3223121">0</span><span class="op" id="3223122">,</span>&nbsp;<span class="ident" id="3223124">syscall</span><span class="op" id="3223131">.</span><span class="ident" id="3223132">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223143">a</span><span class="op" id="3223144">,</span>&nbsp;<span class="ident" id="3223146">ok</span>&nbsp;<span class="op" id="3223149">:=</span>&nbsp;<span class="ident" id="3223152">addr</span><span class="op" id="3223156">.</span><span class="op" id="3223157">(</span><span class="op" id="3223158">*</span><span class="ident" id="3223159">IPAddr</span><span class="op" id="3223165">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223168">if</span>&nbsp;<span class="op" id="3223171">!</span><span class="ident" id="3223172">ok</span>&nbsp;<span class="op" id="3223175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223179">return</span>&nbsp;<span class="num" id="3223186">0</span><span class="op" id="3223187">,</span>&nbsp;<span class="op" id="3223189">&amp;</span><span class="ident" id="3223190">OpError</span><span class="op" id="3223197">{</span><span class="string" id="3223198">&#34;write&#34;</span><span class="op" id="3223205">,</span>&nbsp;<span class="ident" id="3223207">c</span><span class="op" id="3223208">.</span><span class="ident" id="3223209">fd</span><span class="op" id="3223211">.</span><span class="ident" id="3223212">net</span><span class="op" id="3223215">,</span>&nbsp;<span class="ident" id="3223217">addr</span><span class="op" id="3223221">,</span>&nbsp;<span class="ident" id="3223223">syscall</span><span class="op" id="3223230">.</span><span class="ident" id="3223231">EINVAL</span><span class="op" id="3223237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223243">return</span>&nbsp;<span class="ident" id="3223250">c</span><span class="op" id="3223251">.</span><span class="ident" id="3223252">WriteToIP</span><span class="op" id="3223261">(</span><span class="ident" id="3223262">b</span><span class="op" id="3223263">,</span>&nbsp;<span class="ident" id="3223265">a</span><span class="op" id="3223266">)</span><br>
<span class="lineno"></span><span class="op" id="3223268">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="3223271">//&nbsp;WriteMsgIP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3223341">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3223408">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="3223460">func</span>&nbsp;<span class="op" id="3223465">(</span><span class="ident" id="3223466">c</span>&nbsp;<span class="op" id="3223468">*</span><span class="ident" id="3223469">IPConn</span><span class="op" id="3223475">)</span>&nbsp;<span class="ident" id="3223477">WriteMsgIP</span><span class="op" id="3223487">(</span><span class="ident" id="3223488">b</span><span class="op" id="3223489">,</span>&nbsp;<span class="ident" id="3223491">oob</span>&nbsp;<span class="op" id="3223495">[</span><span class="op" id="3223496">]</span><span class="builtintype" id="3223497">byte</span><span class="op" id="3223501">,</span>&nbsp;<span class="ident" id="3223503">addr</span>&nbsp;<span class="op" id="3223508">*</span><span class="ident" id="3223509">IPAddr</span><span class="op" id="3223515">)</span>&nbsp;<span class="op" id="3223517">(</span><span class="ident" id="3223518">n</span><span class="op" id="3223519">,</span>&nbsp;<span class="ident" id="3223521">oobn</span>&nbsp;<span class="builtintype" id="3223526">int</span><span class="op" id="3223529">,</span>&nbsp;<span class="ident" id="3223531">err</span>&nbsp;<span class="builtintype" id="3223535">error</span><span class="op" id="3223540">)</span>&nbsp;<span class="op" id="3223542">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223545">if</span>&nbsp;<span class="op" id="3223548">!</span><span class="ident" id="3223549">c</span><span class="op" id="3223550">.</span><span class="ident" id="3223551">ok</span><span class="op" id="3223553">(</span><span class="op" id="3223554">)</span>&nbsp;<span class="op" id="3223556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223560">return</span>&nbsp;<span class="num" id="3223567">0</span><span class="op" id="3223568">,</span>&nbsp;<span class="num" id="3223570">0</span><span class="op" id="3223571">,</span>&nbsp;<span class="ident" id="3223573">syscall</span><span class="op" id="3223580">.</span><span class="ident" id="3223581">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223592">if</span>&nbsp;<span class="ident" id="3223595">c</span><span class="op" id="3223596">.</span><span class="ident" id="3223597">fd</span><span class="op" id="3223599">.</span><span class="ident" id="3223600">isConnected</span>&nbsp;<span class="op" id="3223612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223616">return</span>&nbsp;<span class="num" id="3223623">0</span><span class="op" id="3223624">,</span>&nbsp;<span class="num" id="3223626">0</span><span class="op" id="3223627">,</span>&nbsp;<span class="op" id="3223629">&amp;</span><span class="ident" id="3223630">OpError</span><span class="op" id="3223637">{</span><span class="ident" id="3223638">Op</span><span class="op" id="3223640">:</span>&nbsp;<span class="string" id="3223642">&#34;write&#34;</span><span class="op" id="3223649">,</span>&nbsp;<span class="ident" id="3223651">Net</span><span class="op" id="3223654">:</span>&nbsp;<span class="ident" id="3223656">c</span><span class="op" id="3223657">.</span><span class="ident" id="3223658">fd</span><span class="op" id="3223660">.</span><span class="ident" id="3223661">net</span><span class="op" id="3223664">,</span>&nbsp;<span class="ident" id="3223666">Addr</span><span class="op" id="3223670">:</span>&nbsp;<span class="ident" id="3223672">addr</span><span class="op" id="3223676">,</span>&nbsp;<span class="ident" id="3223678">Err</span><span class="op" id="3223681">:</span>&nbsp;<span class="ident" id="3223683">ErrWriteToConnected</span><span class="op" id="3223702">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223708">if</span>&nbsp;<span class="ident" id="3223711">addr</span>&nbsp;<span class="op" id="3223716">==</span>&nbsp;<span class="ident" id="3223719">nil</span>&nbsp;<span class="op" id="3223723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223727">return</span>&nbsp;<span class="num" id="3223734">0</span><span class="op" id="3223735">,</span>&nbsp;<span class="num" id="3223737">0</span><span class="op" id="3223738">,</span>&nbsp;<span class="op" id="3223740">&amp;</span><span class="ident" id="3223741">OpError</span><span class="op" id="3223748">{</span><span class="ident" id="3223749">Op</span><span class="op" id="3223751">:</span>&nbsp;<span class="string" id="3223753">&#34;write&#34;</span><span class="op" id="3223760">,</span>&nbsp;<span class="ident" id="3223762">Net</span><span class="op" id="3223765">:</span>&nbsp;<span class="ident" id="3223767">c</span><span class="op" id="3223768">.</span><span class="ident" id="3223769">fd</span><span class="op" id="3223771">.</span><span class="ident" id="3223772">net</span><span class="op" id="3223775">,</span>&nbsp;<span class="ident" id="3223777">Addr</span><span class="op" id="3223781">:</span>&nbsp;<span class="ident" id="3223783">nil</span><span class="op" id="3223786">,</span>&nbsp;<span class="ident" id="3223788">Err</span><span class="op" id="3223791">:</span>&nbsp;<span class="ident" id="3223793">errMissingAddress</span><span class="op" id="3223810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3223816">sa</span><span class="op" id="3223818">,</span>&nbsp;<span class="ident" id="3223820">err</span>&nbsp;<span class="op" id="3223824">:=</span>&nbsp;<span class="ident" id="3223827">addr</span><span class="op" id="3223831">.</span><span class="ident" id="3223832">sockaddr</span><span class="op" id="3223840">(</span><span class="ident" id="3223841">c</span><span class="op" id="3223842">.</span><span class="ident" id="3223843">fd</span><span class="op" id="3223845">.</span><span class="ident" id="3223846">family</span><span class="op" id="3223852">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223855">if</span>&nbsp;<span class="ident" id="3223858">err</span>&nbsp;<span class="op" id="3223862">!=</span>&nbsp;<span class="ident" id="3223865">nil</span>&nbsp;<span class="op" id="3223869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223873">return</span>&nbsp;<span class="num" id="3223880">0</span><span class="op" id="3223881">,</span>&nbsp;<span class="num" id="3223883">0</span><span class="op" id="3223884">,</span>&nbsp;<span class="op" id="3223886">&amp;</span><span class="ident" id="3223887">OpError</span><span class="op" id="3223894">{</span><span class="string" id="3223895">&#34;write&#34;</span><span class="op" id="3223902">,</span>&nbsp;<span class="ident" id="3223904">c</span><span class="op" id="3223905">.</span><span class="ident" id="3223906">fd</span><span class="op" id="3223908">.</span><span class="ident" id="3223909">net</span><span class="op" id="3223912">,</span>&nbsp;<span class="ident" id="3223914">addr</span><span class="op" id="3223918">,</span>&nbsp;<span class="ident" id="3223920">err</span><span class="op" id="3223923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3223926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3223929">return</span>&nbsp;<span class="ident" id="3223936">c</span><span class="op" id="3223937">.</span><span class="ident" id="3223938">fd</span><span class="op" id="3223940">.</span><span class="ident" id="3223941">writeMsg</span><span class="op" id="3223949">(</span><span class="ident" id="3223950">b</span><span class="op" id="3223951">,</span>&nbsp;<span class="ident" id="3223953">oob</span><span class="op" id="3223956">,</span>&nbsp;<span class="ident" id="3223958">sa</span><span class="op" id="3223960">)</span><br>
<span class="lineno"></span><span class="op" id="3223962">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="3223965">//&nbsp;DialIP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;protocol</span><br>
<span class="lineno"></span><span class="comment" id="3224036">//&nbsp;netProto,&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon</span><br>
<span class="lineno"></span><span class="comment" id="3224105">//&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3224139">func</span>&nbsp;<span class="ident" id="3224144">DialIP</span><span class="op" id="3224150">(</span><span class="ident" id="3224151">netProto</span>&nbsp;<span class="builtintype" id="3224160">string</span><span class="op" id="3224166">,</span>&nbsp;<span class="ident" id="3224168">laddr</span><span class="op" id="3224173">,</span>&nbsp;<span class="ident" id="3224175">raddr</span>&nbsp;<span class="op" id="3224181">*</span><span class="ident" id="3224182">IPAddr</span><span class="op" id="3224188">)</span>&nbsp;<span class="op" id="3224190">(</span><span class="op" id="3224191">*</span><span class="ident" id="3224192">IPConn</span><span class="op" id="3224198">,</span>&nbsp;<span class="builtintype" id="3224200">error</span><span class="op" id="3224205">)</span>&nbsp;<span class="op" id="3224207">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224210">return</span>&nbsp;<span class="ident" id="3224217">dialIP</span><span class="op" id="3224223">(</span><span class="ident" id="3224224">netProto</span><span class="op" id="3224232">,</span>&nbsp;<span class="ident" id="3224234">laddr</span><span class="op" id="3224239">,</span>&nbsp;<span class="ident" id="3224241">raddr</span><span class="op" id="3224246">,</span>&nbsp;<span class="ident" id="3224248">noDeadline</span><span class="op" id="3224258">)</span><br>
<span class="lineno"></span><span class="op" id="3224260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3224263">func</span>&nbsp;<span class="ident" id="3224268">dialIP</span><span class="op" id="3224274">(</span><span class="ident" id="3224275">netProto</span>&nbsp;<span class="builtintype" id="3224284">string</span><span class="op" id="3224290">,</span>&nbsp;<span class="ident" id="3224292">laddr</span><span class="op" id="3224297">,</span>&nbsp;<span class="ident" id="3224299">raddr</span>&nbsp;<span class="op" id="3224305">*</span><span class="ident" id="3224306">IPAddr</span><span class="op" id="3224312">,</span>&nbsp;<span class="ident" id="3224314">deadline</span>&nbsp;<span class="ident" id="3224323">time</span><span class="op" id="3224327">.</span><span class="ident" id="3224328">Time</span><span class="op" id="3224332">)</span>&nbsp;<span class="op" id="3224334">(</span><span class="op" id="3224335">*</span><span class="ident" id="3224336">IPConn</span><span class="op" id="3224342">,</span>&nbsp;<span class="builtintype" id="3224344">error</span><span class="op" id="3224349">)</span>&nbsp;<span class="op" id="3224351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224354">net</span><span class="op" id="3224357">,</span>&nbsp;<span class="ident" id="3224359">proto</span><span class="op" id="3224364">,</span>&nbsp;<span class="ident" id="3224366">err</span>&nbsp;<span class="op" id="3224370">:=</span>&nbsp;<span class="ident" id="3224373">parseNetwork</span><span class="op" id="3224385">(</span><span class="ident" id="3224386">netProto</span><span class="op" id="3224394">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224397">if</span>&nbsp;<span class="ident" id="3224400">err</span>&nbsp;<span class="op" id="3224404">!=</span>&nbsp;<span class="ident" id="3224407">nil</span>&nbsp;<span class="op" id="3224411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224415">return</span>&nbsp;<span class="ident" id="3224422">nil</span><span class="op" id="3224425">,</span>&nbsp;<span class="op" id="3224427">&amp;</span><span class="ident" id="3224428">OpError</span><span class="op" id="3224435">{</span><span class="ident" id="3224436">Op</span><span class="op" id="3224438">:</span>&nbsp;<span class="string" id="3224440">&#34;dial&#34;</span><span class="op" id="3224446">,</span>&nbsp;<span class="ident" id="3224448">Net</span><span class="op" id="3224451">:</span>&nbsp;<span class="ident" id="3224453">netProto</span><span class="op" id="3224461">,</span>&nbsp;<span class="ident" id="3224463">Addr</span><span class="op" id="3224467">:</span>&nbsp;<span class="ident" id="3224469">raddr</span><span class="op" id="3224474">,</span>&nbsp;<span class="ident" id="3224476">Err</span><span class="op" id="3224479">:</span>&nbsp;<span class="ident" id="3224481">err</span><span class="op" id="3224484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224490">switch</span>&nbsp;<span class="ident" id="3224497">net</span>&nbsp;<span class="op" id="3224501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224504">case</span>&nbsp;<span class="string" id="3224509">&#34;ip&#34;</span><span class="op" id="3224513">,</span>&nbsp;<span class="string" id="3224515">&#34;ip4&#34;</span><span class="op" id="3224520">,</span>&nbsp;<span class="string" id="3224522">&#34;ip6&#34;</span><span class="op" id="3224527">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224530">default</span><span class="op" id="3224537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224541">return</span>&nbsp;<span class="ident" id="3224548">nil</span><span class="op" id="3224551">,</span>&nbsp;<span class="op" id="3224553">&amp;</span><span class="ident" id="3224554">OpError</span><span class="op" id="3224561">{</span><span class="ident" id="3224562">Op</span><span class="op" id="3224564">:</span>&nbsp;<span class="string" id="3224566">&#34;dial&#34;</span><span class="op" id="3224572">,</span>&nbsp;<span class="ident" id="3224574">Net</span><span class="op" id="3224577">:</span>&nbsp;<span class="ident" id="3224579">netProto</span><span class="op" id="3224587">,</span>&nbsp;<span class="ident" id="3224589">Addr</span><span class="op" id="3224593">:</span>&nbsp;<span class="ident" id="3224595">raddr</span><span class="op" id="3224600">,</span>&nbsp;<span class="ident" id="3224602">Err</span><span class="op" id="3224605">:</span>&nbsp;<span class="ident" id="3224607">UnknownNetworkError</span><span class="op" id="3224626">(</span><span class="ident" id="3224627">netProto</span><span class="op" id="3224635">)</span><span class="op" id="3224636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224642">if</span>&nbsp;<span class="ident" id="3224645">raddr</span>&nbsp;<span class="op" id="3224651">==</span>&nbsp;<span class="ident" id="3224654">nil</span>&nbsp;<span class="op" id="3224658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224662">return</span>&nbsp;<span class="ident" id="3224669">nil</span><span class="op" id="3224672">,</span>&nbsp;<span class="op" id="3224674">&amp;</span><span class="ident" id="3224675">OpError</span><span class="op" id="3224682">{</span><span class="ident" id="3224683">Op</span><span class="op" id="3224685">:</span>&nbsp;<span class="string" id="3224687">&#34;dial&#34;</span><span class="op" id="3224693">,</span>&nbsp;<span class="ident" id="3224695">Net</span><span class="op" id="3224698">:</span>&nbsp;<span class="ident" id="3224700">netProto</span><span class="op" id="3224708">,</span>&nbsp;<span class="ident" id="3224710">Addr</span><span class="op" id="3224714">:</span>&nbsp;<span class="ident" id="3224716">nil</span><span class="op" id="3224719">,</span>&nbsp;<span class="ident" id="3224721">Err</span><span class="op" id="3224724">:</span>&nbsp;<span class="ident" id="3224726">errMissingAddress</span><span class="op" id="3224743">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3224749">fd</span><span class="op" id="3224751">,</span>&nbsp;<span class="ident" id="3224753">err</span>&nbsp;<span class="op" id="3224757">:=</span>&nbsp;<span class="ident" id="3224760">internetSocket</span><span class="op" id="3224774">(</span><span class="ident" id="3224775">net</span><span class="op" id="3224778">,</span>&nbsp;<span class="ident" id="3224780">laddr</span><span class="op" id="3224785">,</span>&nbsp;<span class="ident" id="3224787">raddr</span><span class="op" id="3224792">,</span>&nbsp;<span class="ident" id="3224794">deadline</span><span class="op" id="3224802">,</span>&nbsp;<span class="ident" id="3224804">syscall</span><span class="op" id="3224811">.</span><span class="ident" id="3224812">SOCK_RAW</span><span class="op" id="3224820">,</span>&nbsp;<span class="ident" id="3224822">proto</span><span class="op" id="3224827">,</span>&nbsp;<span class="string" id="3224829">&#34;dial&#34;</span><span class="op" id="3224835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224838">if</span>&nbsp;<span class="ident" id="3224841">err</span>&nbsp;<span class="op" id="3224845">!=</span>&nbsp;<span class="ident" id="3224848">nil</span>&nbsp;<span class="op" id="3224852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224856">return</span>&nbsp;<span class="ident" id="3224863">nil</span><span class="op" id="3224866">,</span>&nbsp;<span class="op" id="3224868">&amp;</span><span class="ident" id="3224869">OpError</span><span class="op" id="3224876">{</span><span class="ident" id="3224877">Op</span><span class="op" id="3224879">:</span>&nbsp;<span class="string" id="3224881">&#34;dial&#34;</span><span class="op" id="3224887">,</span>&nbsp;<span class="ident" id="3224889">Net</span><span class="op" id="3224892">:</span>&nbsp;<span class="ident" id="3224894">netProto</span><span class="op" id="3224902">,</span>&nbsp;<span class="ident" id="3224904">Addr</span><span class="op" id="3224908">:</span>&nbsp;<span class="ident" id="3224910">raddr</span><span class="op" id="3224915">,</span>&nbsp;<span class="ident" id="3224917">Err</span><span class="op" id="3224920">:</span>&nbsp;<span class="ident" id="3224922">err</span><span class="op" id="3224925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3224928">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3224931">return</span>&nbsp;<span class="ident" id="3224938">newIPConn</span><span class="op" id="3224947">(</span><span class="ident" id="3224948">fd</span><span class="op" id="3224950">)</span><span class="op" id="3224951">,</span>&nbsp;<span class="ident" id="3224953">nil</span><br>
<span class="lineno"></span><span class="op" id="3224957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3224960">//&nbsp;ListenIP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;IP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3225027">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">210</span><span class="comment" id="3225093">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;IP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3225163">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3225178">func</span>&nbsp;<span class="ident" id="3225183">ListenIP</span><span class="op" id="3225191">(</span><span class="ident" id="3225192">netProto</span>&nbsp;<span class="builtintype" id="3225201">string</span><span class="op" id="3225207">,</span>&nbsp;<span class="ident" id="3225209">laddr</span>&nbsp;<span class="op" id="3225215">*</span><span class="ident" id="3225216">IPAddr</span><span class="op" id="3225222">)</span>&nbsp;<span class="op" id="3225224">(</span><span class="op" id="3225225">*</span><span class="ident" id="3225226">IPConn</span><span class="op" id="3225232">,</span>&nbsp;<span class="builtintype" id="3225234">error</span><span class="op" id="3225239">)</span>&nbsp;<span class="op" id="3225241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225244">net</span><span class="op" id="3225247">,</span>&nbsp;<span class="ident" id="3225249">proto</span><span class="op" id="3225254">,</span>&nbsp;<span class="ident" id="3225256">err</span>&nbsp;<span class="op" id="3225260">:=</span>&nbsp;<span class="ident" id="3225263">parseNetwork</span><span class="op" id="3225275">(</span><span class="ident" id="3225276">netProto</span><span class="op" id="3225284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225287">if</span>&nbsp;<span class="ident" id="3225290">err</span>&nbsp;<span class="op" id="3225294">!=</span>&nbsp;<span class="ident" id="3225297">nil</span>&nbsp;<span class="op" id="3225301">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225305">return</span>&nbsp;<span class="ident" id="3225312">nil</span><span class="op" id="3225315">,</span>&nbsp;<span class="op" id="3225317">&amp;</span><span class="ident" id="3225318">OpError</span><span class="op" id="3225325">{</span><span class="ident" id="3225326">Op</span><span class="op" id="3225328">:</span>&nbsp;<span class="string" id="3225330">&#34;dial&#34;</span><span class="op" id="3225336">,</span>&nbsp;<span class="ident" id="3225338">Net</span><span class="op" id="3225341">:</span>&nbsp;<span class="ident" id="3225343">netProto</span><span class="op" id="3225351">,</span>&nbsp;<span class="ident" id="3225353">Addr</span><span class="op" id="3225357">:</span>&nbsp;<span class="ident" id="3225359">laddr</span><span class="op" id="3225364">,</span>&nbsp;<span class="ident" id="3225366">Err</span><span class="op" id="3225369">:</span>&nbsp;<span class="ident" id="3225371">err</span><span class="op" id="3225374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225380">switch</span>&nbsp;<span class="ident" id="3225387">net</span>&nbsp;<span class="op" id="3225391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225394">case</span>&nbsp;<span class="string" id="3225399">&#34;ip&#34;</span><span class="op" id="3225403">,</span>&nbsp;<span class="string" id="3225405">&#34;ip4&#34;</span><span class="op" id="3225410">,</span>&nbsp;<span class="string" id="3225412">&#34;ip6&#34;</span><span class="op" id="3225417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225420">default</span><span class="op" id="3225427">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225431">return</span>&nbsp;<span class="ident" id="3225438">nil</span><span class="op" id="3225441">,</span>&nbsp;<span class="op" id="3225443">&amp;</span><span class="ident" id="3225444">OpError</span><span class="op" id="3225451">{</span><span class="ident" id="3225452">Op</span><span class="op" id="3225454">:</span>&nbsp;<span class="string" id="3225456">&#34;listen&#34;</span><span class="op" id="3225464">,</span>&nbsp;<span class="ident" id="3225466">Net</span><span class="op" id="3225469">:</span>&nbsp;<span class="ident" id="3225471">netProto</span><span class="op" id="3225479">,</span>&nbsp;<span class="ident" id="3225481">Addr</span><span class="op" id="3225485">:</span>&nbsp;<span class="ident" id="3225487">laddr</span><span class="op" id="3225492">,</span>&nbsp;<span class="ident" id="3225494">Err</span><span class="op" id="3225497">:</span>&nbsp;<span class="ident" id="3225499">UnknownNetworkError</span><span class="op" id="3225518">(</span><span class="ident" id="3225519">netProto</span><span class="op" id="3225527">)</span><span class="op" id="3225528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3225534">fd</span><span class="op" id="3225536">,</span>&nbsp;<span class="ident" id="3225538">err</span>&nbsp;<span class="op" id="3225542">:=</span>&nbsp;<span class="ident" id="3225545">internetSocket</span><span class="op" id="3225559">(</span><span class="ident" id="3225560">net</span><span class="op" id="3225563">,</span>&nbsp;<span class="ident" id="3225565">laddr</span><span class="op" id="3225570">,</span>&nbsp;<span class="ident" id="3225572">nil</span><span class="op" id="3225575">,</span>&nbsp;<span class="ident" id="3225577">noDeadline</span><span class="op" id="3225587">,</span>&nbsp;<span class="ident" id="3225589">syscall</span><span class="op" id="3225596">.</span><span class="ident" id="3225597">SOCK_RAW</span><span class="op" id="3225605">,</span>&nbsp;<span class="ident" id="3225607">proto</span><span class="op" id="3225612">,</span>&nbsp;<span class="string" id="3225614">&#34;listen&#34;</span><span class="op" id="3225622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225625">if</span>&nbsp;<span class="ident" id="3225628">err</span>&nbsp;<span class="op" id="3225632">!=</span>&nbsp;<span class="ident" id="3225635">nil</span>&nbsp;<span class="op" id="3225639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225643">return</span>&nbsp;<span class="ident" id="3225650">nil</span><span class="op" id="3225653">,</span>&nbsp;<span class="op" id="3225655">&amp;</span><span class="ident" id="3225656">OpError</span><span class="op" id="3225663">{</span><span class="ident" id="3225664">Op</span><span class="op" id="3225666">:</span>&nbsp;<span class="string" id="3225668">&#34;listen&#34;</span><span class="op" id="3225676">,</span>&nbsp;<span class="ident" id="3225678">Net</span><span class="op" id="3225681">:</span>&nbsp;<span class="ident" id="3225683">netProto</span><span class="op" id="3225691">,</span>&nbsp;<span class="ident" id="3225693">Addr</span><span class="op" id="3225697">:</span>&nbsp;<span class="ident" id="3225699">laddr</span><span class="op" id="3225704">,</span>&nbsp;<span class="ident" id="3225706">Err</span><span class="op" id="3225709">:</span>&nbsp;<span class="ident" id="3225711">err</span><span class="op" id="3225714">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3225717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3225720">return</span>&nbsp;<span class="ident" id="3225727">newIPConn</span><span class="op" id="3225736">(</span><span class="ident" id="3225737">fd</span><span class="op" id="3225739">)</span><span class="op" id="3225740">,</span>&nbsp;<span class="ident" id="3225742">nil</span><br>
<span class="lineno"></span><span class="op" id="3225746">}</span>
</div>
</body>
</html>
