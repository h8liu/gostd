<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8581719">package</span>&nbsp;<span class="ident" id="8581727">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8581734">import</span>&nbsp;<span class="op" id="8581741">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8581744">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8581754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8581757">func</span>&nbsp;<span class="ident" id="8581762">TestPhyMemory</span><span class="op" id="8581775">(</span><span class="ident" id="8581776">t</span>&nbsp;<span class="op" id="8581778">*</span><span class="ident" id="8581779">testing</span><span class="op" id="8581786">.</span><span class="ident" id="8581787">T</span><span class="op" id="8581788">)</span>&nbsp;<span class="op" id="8581790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581793">eo</span>&nbsp;<span class="op" id="8581796">:=</span>&nbsp;<span class="keyword" id="8581799">func</span><span class="op" id="8581803">(</span><span class="ident" id="8581804">cond</span>&nbsp;<span class="builtintype" id="8581809">bool</span><span class="op" id="8581813">,</span>&nbsp;<span class="ident" id="8581815">s</span>&nbsp;<span class="builtintype" id="8581817">string</span><span class="op" id="8581823">,</span>&nbsp;<span class="ident" id="8581825">args</span>&nbsp;<span class="op" id="8581830">...</span><span class="keyword" id="8581833">interface</span><span class="op" id="8581842">{</span><span class="op" id="8581843">}</span><span class="op" id="8581844">)</span>&nbsp;<span class="op" id="8581846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8581850">if</span>&nbsp;<span class="ident" id="8581853">cond</span>&nbsp;<span class="op" id="8581858">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581863">t</span><span class="op" id="8581864">.</span><span class="ident" id="8581865">Fatalf</span><span class="op" id="8581871">(</span><span class="ident" id="8581872">s</span><span class="op" id="8581873">,</span>&nbsp;<span class="ident" id="8581875">args</span><span class="op" id="8581879">...</span><span class="op" id="8581882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581893">as</span>&nbsp;<span class="op" id="8581896">:=</span>&nbsp;<span class="keyword" id="8581899">func</span><span class="op" id="8581903">(</span><span class="ident" id="8581904">cond</span>&nbsp;<span class="builtintype" id="8581909">bool</span><span class="op" id="8581913">)</span>&nbsp;<span class="op" id="8581915">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8581919">if</span>&nbsp;<span class="op" id="8581922">!</span><span class="ident" id="8581923">cond</span>&nbsp;<span class="op" id="8581928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581933">t</span><span class="op" id="8581934">.</span><span class="ident" id="8581935">Fatal</span><span class="op" id="8581940">(</span><span class="string" id="8581941">&#34;assertion&nbsp;failed&#34;</span><span class="op" id="8581959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8581966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8581970">size</span>&nbsp;<span class="op" id="8581975">:=</span>&nbsp;<span class="builtintype" id="8581978">uint32</span><span class="op" id="8581984">(</span><span class="num" id="8581985">20</span>&nbsp;<span class="op" id="8581988">*</span>&nbsp;<span class="ident" id="8581990">PageSize</span><span class="op" id="8581998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582001">m</span>&nbsp;<span class="op" id="8582003">:=</span>&nbsp;<span class="ident" id="8582006">newPhyMemory</span><span class="op" id="8582018">(</span><span class="ident" id="8582019">size</span><span class="op" id="8582023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582026">eo</span><span class="op" id="8582028">(</span><span class="ident" id="8582029">m</span><span class="op" id="8582030">.</span><span class="ident" id="8582031">Size</span><span class="op" id="8582035">(</span><span class="op" id="8582036">)</span>&nbsp;<span class="op" id="8582038">!=</span>&nbsp;<span class="ident" id="8582041">size</span><span class="op" id="8582045">,</span>&nbsp;<span class="string" id="8582047">&#34;size&nbsp;mismatch&#34;</span><span class="op" id="8582062">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582066">w</span><span class="op" id="8582067">,</span>&nbsp;<span class="ident" id="8582069">e</span>&nbsp;<span class="op" id="8582071">:=</span>&nbsp;<span class="ident" id="8582074">m</span><span class="op" id="8582075">.</span><span class="ident" id="8582076">ReadWord</span><span class="op" id="8582084">(</span><span class="num" id="8582085">4</span><span class="op" id="8582086">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582089">eo</span><span class="op" id="8582091">(</span><span class="ident" id="8582092">e</span>&nbsp;<span class="op" id="8582094">!=</span>&nbsp;<span class="ident" id="8582097">nil</span><span class="op" id="8582100">,</span>&nbsp;<span class="string" id="8582102">&#34;get&nbsp;an&nbsp;error&nbsp;for&nbsp;word&nbsp;reading&#34;</span><span class="op" id="8582133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582136">eo</span><span class="op" id="8582138">(</span><span class="ident" id="8582139">w</span>&nbsp;<span class="op" id="8582141">!=</span>&nbsp;<span class="num" id="8582144">0</span><span class="op" id="8582145">,</span>&nbsp;<span class="string" id="8582147">&#34;page&nbsp;is&nbsp;not&nbsp;zeroed&nbsp;out&#34;</span><span class="op" id="8582171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582175">_</span><span class="op" id="8582176">,</span>&nbsp;<span class="ident" id="8582178">e</span>&nbsp;<span class="op" id="8582180">=</span>&nbsp;<span class="ident" id="8582182">m</span><span class="op" id="8582183">.</span><span class="ident" id="8582184">ReadWord</span><span class="op" id="8582192">(</span><span class="num" id="8582193">13</span><span class="op" id="8582195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582198">eo</span><span class="op" id="8582200">(</span><span class="ident" id="8582201">e</span>&nbsp;<span class="op" id="8582203">!=</span>&nbsp;<span class="ident" id="8582206">errMisalign</span><span class="op" id="8582217">,</span>&nbsp;<span class="string" id="8582219">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8582247">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582250">_</span><span class="op" id="8582251">,</span>&nbsp;<span class="ident" id="8582253">e</span>&nbsp;<span class="op" id="8582255">=</span>&nbsp;<span class="ident" id="8582257">m</span><span class="op" id="8582258">.</span><span class="ident" id="8582259">ReadWord</span><span class="op" id="8582267">(</span><span class="ident" id="8582268">size</span>&nbsp;<span class="op" id="8582273">-</span>&nbsp;<span class="num" id="8582275">1</span><span class="op" id="8582276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582279">eo</span><span class="op" id="8582281">(</span><span class="ident" id="8582282">e</span>&nbsp;<span class="op" id="8582284">!=</span>&nbsp;<span class="ident" id="8582287">errMisalign</span><span class="op" id="8582298">,</span>&nbsp;<span class="string" id="8582300">&#34;should&nbsp;have&nbsp;misalign&nbsp;error&#34;</span><span class="op" id="8582328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582332">_</span><span class="op" id="8582333">,</span>&nbsp;<span class="ident" id="8582335">e</span>&nbsp;<span class="op" id="8582337">=</span>&nbsp;<span class="ident" id="8582339">m</span><span class="op" id="8582340">.</span><span class="ident" id="8582341">ReadWord</span><span class="op" id="8582349">(</span><span class="ident" id="8582350">size</span><span class="op" id="8582354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582357">eo</span><span class="op" id="8582359">(</span><span class="ident" id="8582360">e</span>&nbsp;<span class="op" id="8582362">!=</span>&nbsp;<span class="ident" id="8582365">errOutOfRange</span><span class="op" id="8582378">,</span>&nbsp;<span class="string" id="8582380">&#34;should&nbsp;have&nbsp;out&nbsp;of&nbsp;range&nbsp;error&#34;</span><span class="op" id="8582412">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582416">off</span>&nbsp;<span class="op" id="8582420">:=</span>&nbsp;<span class="builtintype" id="8582423">uint32</span><span class="op" id="8582429">(</span><span class="num" id="8582430">56</span>&nbsp;<span class="op" id="8582433">+</span>&nbsp;<span class="ident" id="8582435">PageSize</span><span class="op" id="8582443">*</span><span class="num" id="8582444">2</span><span class="op" id="8582445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582448">as</span><span class="op" id="8582450">(</span><span class="ident" id="8582451">m</span><span class="op" id="8582452">.</span><span class="ident" id="8582453">WriteByte</span><span class="op" id="8582462">(</span><span class="ident" id="8582463">off</span><span class="op" id="8582466">+</span><span class="num" id="8582467">0</span><span class="op" id="8582468">,</span>&nbsp;<span class="num" id="8582470">0x37</span><span class="op" id="8582474">)</span>&nbsp;<span class="op" id="8582476">==</span>&nbsp;<span class="ident" id="8582479">nil</span><span class="op" id="8582482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582485">as</span><span class="op" id="8582487">(</span><span class="ident" id="8582488">m</span><span class="op" id="8582489">.</span><span class="ident" id="8582490">WriteByte</span><span class="op" id="8582499">(</span><span class="ident" id="8582500">off</span><span class="op" id="8582503">+</span><span class="num" id="8582504">1</span><span class="op" id="8582505">,</span>&nbsp;<span class="num" id="8582507">0x21</span><span class="op" id="8582511">)</span>&nbsp;<span class="op" id="8582513">==</span>&nbsp;<span class="ident" id="8582516">nil</span><span class="op" id="8582519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582522">as</span><span class="op" id="8582524">(</span><span class="ident" id="8582525">m</span><span class="op" id="8582526">.</span><span class="ident" id="8582527">WriteByte</span><span class="op" id="8582536">(</span><span class="ident" id="8582537">off</span><span class="op" id="8582540">+</span><span class="num" id="8582541">2</span><span class="op" id="8582542">,</span>&nbsp;<span class="num" id="8582544">0x5a</span><span class="op" id="8582548">)</span>&nbsp;<span class="op" id="8582550">==</span>&nbsp;<span class="ident" id="8582553">nil</span><span class="op" id="8582556">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582559">as</span><span class="op" id="8582561">(</span><span class="ident" id="8582562">m</span><span class="op" id="8582563">.</span><span class="ident" id="8582564">WriteByte</span><span class="op" id="8582573">(</span><span class="ident" id="8582574">off</span><span class="op" id="8582577">+</span><span class="num" id="8582578">3</span><span class="op" id="8582579">,</span>&nbsp;<span class="num" id="8582581">0x70</span><span class="op" id="8582585">)</span>&nbsp;<span class="op" id="8582587">==</span>&nbsp;<span class="ident" id="8582590">nil</span><span class="op" id="8582593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582596">exp</span>&nbsp;<span class="op" id="8582600">:=</span>&nbsp;<span class="builtintype" id="8582603">uint32</span><span class="op" id="8582609">(</span><span class="num" id="8582610">0x705a2137</span><span class="op" id="8582620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582623">w</span><span class="op" id="8582624">,</span>&nbsp;<span class="ident" id="8582626">e</span>&nbsp;<span class="op" id="8582628">=</span>&nbsp;<span class="ident" id="8582630">m</span><span class="op" id="8582631">.</span><span class="ident" id="8582632">ReadWord</span><span class="op" id="8582640">(</span><span class="ident" id="8582641">off</span><span class="op" id="8582644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582647">as</span><span class="op" id="8582649">(</span><span class="ident" id="8582650">e</span>&nbsp;<span class="op" id="8582652">==</span>&nbsp;<span class="ident" id="8582655">nil</span><span class="op" id="8582658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582661">eo</span><span class="op" id="8582663">(</span><span class="ident" id="8582664">w</span>&nbsp;<span class="op" id="8582666">!=</span>&nbsp;<span class="ident" id="8582669">exp</span><span class="op" id="8582672">,</span>&nbsp;<span class="string" id="8582674">&#34;expect&nbsp;0x%08x&nbsp;got&nbsp;0x%08x&#34;</span><span class="op" id="8582700">,</span>&nbsp;<span class="ident" id="8582702">exp</span><span class="op" id="8582705">,</span>&nbsp;<span class="ident" id="8582707">w</span><span class="op" id="8582708">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582711">b</span><span class="op" id="8582712">,</span>&nbsp;<span class="ident" id="8582714">e</span>&nbsp;<span class="op" id="8582716">:=</span>&nbsp;<span class="ident" id="8582719">m</span><span class="op" id="8582720">.</span><span class="ident" id="8582721">ReadByte</span><span class="op" id="8582729">(</span><span class="ident" id="8582730">off</span>&nbsp;<span class="op" id="8582734">+</span>&nbsp;<span class="num" id="8582736">2</span><span class="op" id="8582737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582740">as</span><span class="op" id="8582742">(</span><span class="ident" id="8582743">e</span>&nbsp;<span class="op" id="8582745">==</span>&nbsp;<span class="ident" id="8582748">nil</span><span class="op" id="8582751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8582754">eo</span><span class="op" id="8582756">(</span><span class="ident" id="8582757">b</span>&nbsp;<span class="op" id="8582759">!=</span>&nbsp;<span class="num" id="8582762">0x5a</span><span class="op" id="8582766">,</span>&nbsp;<span class="string" id="8582768">&#34;expect&nbsp;0x5a&nbsp;got&nbsp;%02x&#34;</span><span class="op" id="8582790">,</span>&nbsp;<span class="ident" id="8582792">b</span><span class="op" id="8582793">)</span><br>
<span class="lineno"></span><span class="op" id="8582795">}</span>
</div>
</body>
</html>
