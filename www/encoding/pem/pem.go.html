<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4149019">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4149074">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4149128">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4149179">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="4149256">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4149335">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="4149366">package</span>&nbsp;<span class="ident" id="4149374">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4149379">import</span>&nbsp;<span class="op" id="4149386">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4149389">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4149398">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4149417">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4149423">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4149430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4149433">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4149480">//</span><br>
<span class="lineno"></span><span class="comment" id="4149483">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="4149507">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4149534">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="4149548">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="4149575">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4149600">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="4149667">type</span>&nbsp;<span class="ident" id="4149672">Block</span>&nbsp;<span class="keyword" id="4149678">struct</span>&nbsp;<span class="op" id="4149685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149688">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4149696">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4149714">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149778">Headers</span>&nbsp;<span class="keyword" id="4149786">map</span><span class="op" id="4149789">[</span><span class="builtintype" id="4149790">string</span><span class="op" id="4149796">]</span><span class="builtintype" id="4149797">string</span>&nbsp;<span class="comment" id="4149804">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149826">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4149834">[</span><span class="op" id="4149835">]</span><span class="builtintype" id="4149836">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4149852">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="4149931">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4149934">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4150010">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4150086">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4150166">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="4150243">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4150256">func</span>&nbsp;<span class="ident" id="4150261">getLine</span><span class="op" id="4150268">(</span><span class="ident" id="4150269">data</span>&nbsp;<span class="op" id="4150274">[</span><span class="op" id="4150275">]</span><span class="builtintype" id="4150276">byte</span><span class="op" id="4150280">)</span>&nbsp;<span class="op" id="4150282">(</span><span class="ident" id="4150283">line</span><span class="op" id="4150287">,</span>&nbsp;<span class="ident" id="4150289">rest</span>&nbsp;<span class="op" id="4150294">[</span><span class="op" id="4150295">]</span><span class="builtintype" id="4150296">byte</span><span class="op" id="4150300">)</span>&nbsp;<span class="op" id="4150302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150305">i</span>&nbsp;<span class="op" id="4150307">:=</span>&nbsp;<span class="ident" id="4150310">bytes</span><span class="op" id="4150315">.</span><span class="ident" id="4150316">Index</span><span class="op" id="4150321">(</span><span class="ident" id="4150322">data</span><span class="op" id="4150326">,</span>&nbsp;<span class="op" id="4150328">[</span><span class="op" id="4150329">]</span><span class="builtintype" id="4150330">byte</span><span class="op" id="4150334">{</span><span class="string" id="4150335">&#39;\n&#39;</span><span class="op" id="4150339">}</span><span class="op" id="4150340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150343">var</span>&nbsp;<span class="ident" id="4150347">j</span>&nbsp;<span class="builtintype" id="4150349">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150354">if</span>&nbsp;<span class="ident" id="4150357">i</span>&nbsp;<span class="op" id="4150359">&lt;</span>&nbsp;<span class="num" id="4150361">0</span>&nbsp;<span class="op" id="4150363">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150367">i</span>&nbsp;<span class="op" id="4150369">=</span>&nbsp;<span class="builtinfunc" id="4150371">len</span><span class="op" id="4150374">(</span><span class="ident" id="4150375">data</span><span class="op" id="4150379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150383">j</span>&nbsp;<span class="op" id="4150385">=</span>&nbsp;<span class="ident" id="4150387">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150390">}</span>&nbsp;<span class="keyword" id="4150392">else</span>&nbsp;<span class="op" id="4150397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150401">j</span>&nbsp;<span class="op" id="4150403">=</span>&nbsp;<span class="ident" id="4150405">i</span>&nbsp;<span class="op" id="4150407">+</span>&nbsp;<span class="num" id="4150409">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150413">if</span>&nbsp;<span class="ident" id="4150416">i</span>&nbsp;<span class="op" id="4150418">&gt;</span>&nbsp;<span class="num" id="4150420">0</span>&nbsp;<span class="op" id="4150422">&amp;&amp;</span>&nbsp;<span class="ident" id="4150425">data</span><span class="op" id="4150429">[</span><span class="ident" id="4150430">i</span><span class="op" id="4150431">-</span><span class="num" id="4150432">1</span><span class="op" id="4150433">]</span>&nbsp;<span class="op" id="4150435">==</span>&nbsp;<span class="string" id="4150438">&#39;\r&#39;</span>&nbsp;<span class="op" id="4150443">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150448">i</span><span class="op" id="4150449">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150460">return</span>&nbsp;<span class="ident" id="4150467">bytes</span><span class="op" id="4150472">.</span><span class="ident" id="4150473">TrimRight</span><span class="op" id="4150482">(</span><span class="ident" id="4150483">data</span><span class="op" id="4150487">[</span><span class="num" id="4150488">0</span><span class="op" id="4150489">:</span><span class="ident" id="4150490">i</span><span class="op" id="4150491">]</span><span class="op" id="4150492">,</span>&nbsp;<span class="string" id="4150494">&#34;&nbsp;\t&#34;</span><span class="op" id="4150499">)</span><span class="op" id="4150500">,</span>&nbsp;<span class="ident" id="4150502">data</span><span class="op" id="4150506">[</span><span class="ident" id="4150507">j</span><span class="op" id="4150508">:</span><span class="op" id="4150509">]</span><br>
<span class="lineno"></span><span class="op" id="4150511">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4150514">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4150587">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4150618">func</span>&nbsp;<span class="ident" id="4150623">removeWhitespace</span><span class="op" id="4150639">(</span><span class="ident" id="4150640">data</span>&nbsp;<span class="op" id="4150645">[</span><span class="op" id="4150646">]</span><span class="builtintype" id="4150647">byte</span><span class="op" id="4150651">)</span>&nbsp;<span class="op" id="4150653">[</span><span class="op" id="4150654">]</span><span class="builtintype" id="4150655">byte</span>&nbsp;<span class="op" id="4150660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150663">result</span>&nbsp;<span class="op" id="4150670">:=</span>&nbsp;<span class="builtinfunc" id="4150673">make</span><span class="op" id="4150677">(</span><span class="op" id="4150678">[</span><span class="op" id="4150679">]</span><span class="builtintype" id="4150680">byte</span><span class="op" id="4150684">,</span>&nbsp;<span class="builtinfunc" id="4150686">len</span><span class="op" id="4150689">(</span><span class="ident" id="4150690">data</span><span class="op" id="4150694">)</span><span class="op" id="4150695">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150698">n</span>&nbsp;<span class="op" id="4150700">:=</span>&nbsp;<span class="num" id="4150703">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150707">for</span>&nbsp;<span class="ident" id="4150711">_</span><span class="op" id="4150712">,</span>&nbsp;<span class="ident" id="4150714">b</span>&nbsp;<span class="op" id="4150716">:=</span>&nbsp;<span class="keyword" id="4150719">range</span>&nbsp;<span class="ident" id="4150725">data</span>&nbsp;<span class="op" id="4150730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150734">if</span>&nbsp;<span class="ident" id="4150737">b</span>&nbsp;<span class="op" id="4150739">==</span>&nbsp;<span class="string" id="4150742">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4150746">||</span>&nbsp;<span class="ident" id="4150749">b</span>&nbsp;<span class="op" id="4150751">==</span>&nbsp;<span class="string" id="4150754">&#39;\t&#39;</span>&nbsp;<span class="op" id="4150759">||</span>&nbsp;<span class="ident" id="4150762">b</span>&nbsp;<span class="op" id="4150764">==</span>&nbsp;<span class="string" id="4150767">&#39;\r&#39;</span>&nbsp;<span class="op" id="4150772">||</span>&nbsp;<span class="ident" id="4150775">b</span>&nbsp;<span class="op" id="4150777">==</span>&nbsp;<span class="string" id="4150780">&#39;\n&#39;</span>&nbsp;<span class="op" id="4150785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150790">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150805">result</span><span class="op" id="4150811">[</span><span class="ident" id="4150812">n</span><span class="op" id="4150813">]</span>&nbsp;<span class="op" id="4150815">=</span>&nbsp;<span class="ident" id="4150817">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150821">n</span><span class="op" id="4150822">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150830">return</span>&nbsp;<span class="ident" id="4150837">result</span><span class="op" id="4150843">[</span><span class="num" id="4150844">0</span><span class="op" id="4150845">:</span><span class="ident" id="4150846">n</span><span class="op" id="4150847">]</span><br>
<span class="lineno"></span><span class="op" id="4150849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4150852">var</span>&nbsp;<span class="ident" id="4150856">pemStart</span>&nbsp;<span class="op" id="4150865">=</span>&nbsp;<span class="op" id="4150867">[</span><span class="op" id="4150868">]</span><span class="builtintype" id="4150869">byte</span><span class="op" id="4150873">(</span><span class="string" id="4150874">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="4150889">)</span><br>
<span class="lineno"></span><span class="keyword" id="4150891">var</span>&nbsp;<span class="ident" id="4150895">pemEnd</span>&nbsp;<span class="op" id="4150902">=</span>&nbsp;<span class="op" id="4150904">[</span><span class="op" id="4150905">]</span><span class="builtintype" id="4150906">byte</span><span class="op" id="4150910">(</span><span class="string" id="4150911">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="4150924">)</span><br>
<span class="lineno">70</span><span class="keyword" id="4150926">var</span>&nbsp;<span class="ident" id="4150930">pemEndOfLine</span>&nbsp;<span class="op" id="4150943">=</span>&nbsp;<span class="op" id="4150945">[</span><span class="op" id="4150946">]</span><span class="builtintype" id="4150947">byte</span><span class="op" id="4150951">(</span><span class="string" id="4150952">&#34;-----&#34;</span><span class="op" id="4150959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4150962">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="4151037">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4151116">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="4151192">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="4151201">func</span>&nbsp;<span class="ident" id="4151206">Decode</span><span class="op" id="4151212">(</span><span class="ident" id="4151213">data</span>&nbsp;<span class="op" id="4151218">[</span><span class="op" id="4151219">]</span><span class="builtintype" id="4151220">byte</span><span class="op" id="4151224">)</span>&nbsp;<span class="op" id="4151226">(</span><span class="ident" id="4151227">p</span>&nbsp;<span class="op" id="4151229">*</span><span class="ident" id="4151230">Block</span><span class="op" id="4151235">,</span>&nbsp;<span class="ident" id="4151237">rest</span>&nbsp;<span class="op" id="4151242">[</span><span class="op" id="4151243">]</span><span class="builtintype" id="4151244">byte</span><span class="op" id="4151248">)</span>&nbsp;<span class="op" id="4151250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151253">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151323">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151385">rest</span>&nbsp;<span class="op" id="4151390">=</span>&nbsp;<span class="ident" id="4151392">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151398">if</span>&nbsp;<span class="ident" id="4151401">bytes</span><span class="op" id="4151406">.</span><span class="ident" id="4151407">HasPrefix</span><span class="op" id="4151416">(</span><span class="ident" id="4151417">data</span><span class="op" id="4151421">,</span>&nbsp;<span class="ident" id="4151423">pemStart</span><span class="op" id="4151431">[</span><span class="num" id="4151432">1</span><span class="op" id="4151433">:</span><span class="op" id="4151434">]</span><span class="op" id="4151435">)</span>&nbsp;<span class="op" id="4151437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151441">rest</span>&nbsp;<span class="op" id="4151446">=</span>&nbsp;<span class="ident" id="4151448">rest</span><span class="op" id="4151452">[</span><span class="builtinfunc" id="4151453">len</span><span class="op" id="4151456">(</span><span class="ident" id="4151457">pemStart</span><span class="op" id="4151465">)</span><span class="op" id="4151466">-</span><span class="num" id="4151467">1</span>&nbsp;<span class="op" id="4151469">:</span>&nbsp;<span class="builtinfunc" id="4151471">len</span><span class="op" id="4151474">(</span><span class="ident" id="4151475">data</span><span class="op" id="4151479">)</span><span class="op" id="4151480">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151483">}</span>&nbsp;<span class="keyword" id="4151485">else</span>&nbsp;<span class="keyword" id="4151490">if</span>&nbsp;<span class="ident" id="4151493">i</span>&nbsp;<span class="op" id="4151495">:=</span>&nbsp;<span class="ident" id="4151498">bytes</span><span class="op" id="4151503">.</span><span class="ident" id="4151504">Index</span><span class="op" id="4151509">(</span><span class="ident" id="4151510">data</span><span class="op" id="4151514">,</span>&nbsp;<span class="ident" id="4151516">pemStart</span><span class="op" id="4151524">)</span><span class="op" id="4151525">;</span>&nbsp;<span class="ident" id="4151527">i</span>&nbsp;<span class="op" id="4151529">&gt;=</span>&nbsp;<span class="num" id="4151532">0</span>&nbsp;<span class="op" id="4151534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151538">rest</span>&nbsp;<span class="op" id="4151543">=</span>&nbsp;<span class="ident" id="4151545">rest</span><span class="op" id="4151549">[</span><span class="ident" id="4151550">i</span><span class="op" id="4151551">+</span><span class="builtinfunc" id="4151552">len</span><span class="op" id="4151555">(</span><span class="ident" id="4151556">pemStart</span><span class="op" id="4151564">)</span>&nbsp;<span class="op" id="4151566">:</span>&nbsp;<span class="builtinfunc" id="4151568">len</span><span class="op" id="4151571">(</span><span class="ident" id="4151572">data</span><span class="op" id="4151576">)</span><span class="op" id="4151577">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151580">}</span>&nbsp;<span class="keyword" id="4151582">else</span>&nbsp;<span class="op" id="4151587">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151591">return</span>&nbsp;<span class="ident" id="4151598">nil</span><span class="op" id="4151601">,</span>&nbsp;<span class="ident" id="4151603">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151613">typeLine</span><span class="op" id="4151621">,</span>&nbsp;<span class="ident" id="4151623">rest</span>&nbsp;<span class="op" id="4151628">:=</span>&nbsp;<span class="ident" id="4151631">getLine</span><span class="op" id="4151638">(</span><span class="ident" id="4151639">rest</span><span class="op" id="4151643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151646">if</span>&nbsp;<span class="op" id="4151649">!</span><span class="ident" id="4151650">bytes</span><span class="op" id="4151655">.</span><span class="ident" id="4151656">HasSuffix</span><span class="op" id="4151665">(</span><span class="ident" id="4151666">typeLine</span><span class="op" id="4151674">,</span>&nbsp;<span class="ident" id="4151676">pemEndOfLine</span><span class="op" id="4151688">)</span>&nbsp;<span class="op" id="4151690">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151694">return</span>&nbsp;<span class="ident" id="4151701">decodeError</span><span class="op" id="4151712">(</span><span class="ident" id="4151713">data</span><span class="op" id="4151717">,</span>&nbsp;<span class="ident" id="4151719">rest</span><span class="op" id="4151723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151729">typeLine</span>&nbsp;<span class="op" id="4151738">=</span>&nbsp;<span class="ident" id="4151740">typeLine</span><span class="op" id="4151748">[</span><span class="num" id="4151749">0</span>&nbsp;<span class="op" id="4151751">:</span>&nbsp;<span class="builtinfunc" id="4151753">len</span><span class="op" id="4151756">(</span><span class="ident" id="4151757">typeLine</span><span class="op" id="4151765">)</span><span class="op" id="4151766">-</span><span class="builtinfunc" id="4151767">len</span><span class="op" id="4151770">(</span><span class="ident" id="4151771">pemEndOfLine</span><span class="op" id="4151783">)</span><span class="op" id="4151784">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151788">p</span>&nbsp;<span class="op" id="4151790">=</span>&nbsp;<span class="op" id="4151792">&amp;</span><span class="ident" id="4151793">Block</span><span class="op" id="4151798">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151802">Headers</span><span class="op" id="4151809">:</span>&nbsp;<span class="builtinfunc" id="4151811">make</span><span class="op" id="4151815">(</span><span class="keyword" id="4151816">map</span><span class="op" id="4151819">[</span><span class="builtintype" id="4151820">string</span><span class="op" id="4151826">]</span><span class="builtintype" id="4151827">string</span><span class="op" id="4151833">)</span><span class="op" id="4151834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151838">Type</span><span class="op" id="4151842">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4151847">string</span><span class="op" id="4151853">(</span><span class="ident" id="4151854">typeLine</span><span class="op" id="4151862">)</span><span class="op" id="4151863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151870">for</span>&nbsp;<span class="op" id="4151874">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151878">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151939">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151978">if</span>&nbsp;<span class="builtinfunc" id="4151981">len</span><span class="op" id="4151984">(</span><span class="ident" id="4151985">rest</span><span class="op" id="4151989">)</span>&nbsp;<span class="op" id="4151991">==</span>&nbsp;<span class="num" id="4151994">0</span>&nbsp;<span class="op" id="4151996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152001">return</span>&nbsp;<span class="ident" id="4152008">nil</span><span class="op" id="4152011">,</span>&nbsp;<span class="ident" id="4152013">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152020">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152024">line</span><span class="op" id="4152028">,</span>&nbsp;<span class="ident" id="4152030">next</span>&nbsp;<span class="op" id="4152035">:=</span>&nbsp;<span class="ident" id="4152038">getLine</span><span class="op" id="4152045">(</span><span class="ident" id="4152046">rest</span><span class="op" id="4152050">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152055">i</span>&nbsp;<span class="op" id="4152057">:=</span>&nbsp;<span class="ident" id="4152060">bytes</span><span class="op" id="4152065">.</span><span class="ident" id="4152066">Index</span><span class="op" id="4152071">(</span><span class="ident" id="4152072">line</span><span class="op" id="4152076">,</span>&nbsp;<span class="op" id="4152078">[</span><span class="op" id="4152079">]</span><span class="builtintype" id="4152080">byte</span><span class="op" id="4152084">{</span><span class="string" id="4152085">&#39;:&#39;</span><span class="op" id="4152088">}</span><span class="op" id="4152089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152093">if</span>&nbsp;<span class="ident" id="4152096">i</span>&nbsp;<span class="op" id="4152098">==</span>&nbsp;<span class="op" id="4152101">-</span><span class="num" id="4152102">1</span>&nbsp;<span class="op" id="4152104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152109">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152122">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152189">key</span><span class="op" id="4152192">,</span>&nbsp;<span class="ident" id="4152194">val</span>&nbsp;<span class="op" id="4152198">:=</span>&nbsp;<span class="ident" id="4152201">line</span><span class="op" id="4152205">[</span><span class="num" id="4152206">0</span><span class="op" id="4152207">:</span><span class="ident" id="4152208">i</span><span class="op" id="4152209">]</span><span class="op" id="4152210">,</span>&nbsp;<span class="ident" id="4152212">line</span><span class="op" id="4152216">[</span><span class="ident" id="4152217">i</span><span class="op" id="4152218">+</span><span class="num" id="4152219">1</span><span class="op" id="4152220">:</span><span class="op" id="4152221">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152225">key</span>&nbsp;<span class="op" id="4152229">=</span>&nbsp;<span class="ident" id="4152231">bytes</span><span class="op" id="4152236">.</span><span class="ident" id="4152237">TrimSpace</span><span class="op" id="4152246">(</span><span class="ident" id="4152247">key</span><span class="op" id="4152250">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152254">val</span>&nbsp;<span class="op" id="4152258">=</span>&nbsp;<span class="ident" id="4152260">bytes</span><span class="op" id="4152265">.</span><span class="ident" id="4152266">TrimSpace</span><span class="op" id="4152275">(</span><span class="ident" id="4152276">val</span><span class="op" id="4152279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152283">p</span><span class="op" id="4152284">.</span><span class="ident" id="4152285">Headers</span><span class="op" id="4152292">[</span><span class="builtintype" id="4152293">string</span><span class="op" id="4152299">(</span><span class="ident" id="4152300">key</span><span class="op" id="4152303">)</span><span class="op" id="4152304">]</span>&nbsp;<span class="op" id="4152306">=</span>&nbsp;<span class="builtintype" id="4152308">string</span><span class="op" id="4152314">(</span><span class="ident" id="4152315">val</span><span class="op" id="4152318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152322">rest</span>&nbsp;<span class="op" id="4152327">=</span>&nbsp;<span class="ident" id="4152329">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152339">i</span>&nbsp;<span class="op" id="4152341">:=</span>&nbsp;<span class="ident" id="4152344">bytes</span><span class="op" id="4152349">.</span><span class="ident" id="4152350">Index</span><span class="op" id="4152355">(</span><span class="ident" id="4152356">rest</span><span class="op" id="4152360">,</span>&nbsp;<span class="ident" id="4152362">pemEnd</span><span class="op" id="4152368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152371">if</span>&nbsp;<span class="ident" id="4152374">i</span>&nbsp;<span class="op" id="4152376">&lt;</span>&nbsp;<span class="num" id="4152378">0</span>&nbsp;<span class="op" id="4152380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152384">return</span>&nbsp;<span class="ident" id="4152391">decodeError</span><span class="op" id="4152402">(</span><span class="ident" id="4152403">data</span><span class="op" id="4152407">,</span>&nbsp;<span class="ident" id="4152409">rest</span><span class="op" id="4152413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152419">base64Data</span>&nbsp;<span class="op" id="4152430">:=</span>&nbsp;<span class="ident" id="4152433">removeWhitespace</span><span class="op" id="4152449">(</span><span class="ident" id="4152450">rest</span><span class="op" id="4152454">[</span><span class="num" id="4152455">0</span><span class="op" id="4152456">:</span><span class="ident" id="4152457">i</span><span class="op" id="4152458">]</span><span class="op" id="4152459">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152463">p</span><span class="op" id="4152464">.</span><span class="ident" id="4152465">Bytes</span>&nbsp;<span class="op" id="4152471">=</span>&nbsp;<span class="builtinfunc" id="4152473">make</span><span class="op" id="4152477">(</span><span class="op" id="4152478">[</span><span class="op" id="4152479">]</span><span class="builtintype" id="4152480">byte</span><span class="op" id="4152484">,</span>&nbsp;<span class="ident" id="4152486">base64</span><span class="op" id="4152492">.</span><span class="ident" id="4152493">StdEncoding</span><span class="op" id="4152504">.</span><span class="ident" id="4152505">DecodedLen</span><span class="op" id="4152515">(</span><span class="builtinfunc" id="4152516">len</span><span class="op" id="4152519">(</span><span class="ident" id="4152520">base64Data</span><span class="op" id="4152530">)</span><span class="op" id="4152531">)</span><span class="op" id="4152532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152535">n</span><span class="op" id="4152536">,</span>&nbsp;<span class="ident" id="4152538">err</span>&nbsp;<span class="op" id="4152542">:=</span>&nbsp;<span class="ident" id="4152545">base64</span><span class="op" id="4152551">.</span><span class="ident" id="4152552">StdEncoding</span><span class="op" id="4152563">.</span><span class="ident" id="4152564">Decode</span><span class="op" id="4152570">(</span><span class="ident" id="4152571">p</span><span class="op" id="4152572">.</span><span class="ident" id="4152573">Bytes</span><span class="op" id="4152578">,</span>&nbsp;<span class="ident" id="4152580">base64Data</span><span class="op" id="4152590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152593">if</span>&nbsp;<span class="ident" id="4152596">err</span>&nbsp;<span class="op" id="4152600">!=</span>&nbsp;<span class="ident" id="4152603">nil</span>&nbsp;<span class="op" id="4152607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152611">return</span>&nbsp;<span class="ident" id="4152618">decodeError</span><span class="op" id="4152629">(</span><span class="ident" id="4152630">data</span><span class="op" id="4152634">,</span>&nbsp;<span class="ident" id="4152636">rest</span><span class="op" id="4152640">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4152643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152646">p</span><span class="op" id="4152647">.</span><span class="ident" id="4152648">Bytes</span>&nbsp;<span class="op" id="4152654">=</span>&nbsp;<span class="ident" id="4152656">p</span><span class="op" id="4152657">.</span><span class="ident" id="4152658">Bytes</span><span class="op" id="4152663">[</span><span class="num" id="4152664">0</span><span class="op" id="4152665">:</span><span class="ident" id="4152666">n</span><span class="op" id="4152667">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4152671">_</span><span class="op" id="4152672">,</span>&nbsp;<span class="ident" id="4152674">rest</span>&nbsp;<span class="op" id="4152679">=</span>&nbsp;<span class="ident" id="4152681">getLine</span><span class="op" id="4152688">(</span><span class="ident" id="4152689">rest</span><span class="op" id="4152693">[</span><span class="ident" id="4152694">i</span><span class="op" id="4152695">+</span><span class="builtinfunc" id="4152696">len</span><span class="op" id="4152699">(</span><span class="ident" id="4152700">pemEnd</span><span class="op" id="4152706">)</span><span class="op" id="4152707">:</span><span class="op" id="4152708">]</span><span class="op" id="4152709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4152713">return</span><br>
<span class="lineno"></span><span class="op" id="4152720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4152723">func</span>&nbsp;<span class="ident" id="4152728">decodeError</span><span class="op" id="4152739">(</span><span class="ident" id="4152740">data</span><span class="op" id="4152744">,</span>&nbsp;<span class="ident" id="4152746">rest</span>&nbsp;<span class="op" id="4152751">[</span><span class="op" id="4152752">]</span><span class="builtintype" id="4152753">byte</span><span class="op" id="4152757">)</span>&nbsp;<span class="op" id="4152759">(</span><span class="op" id="4152760">*</span><span class="ident" id="4152761">Block</span><span class="op" id="4152766">,</span>&nbsp;<span class="op" id="4152768">[</span><span class="op" id="4152769">]</span><span class="builtintype" id="4152770">byte</span><span class="op" id="4152774">)</span>&nbsp;<span class="op" id="4152776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152779">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152842">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152909">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4152982">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153051">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153122">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153195">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153254">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153258">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153291">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153295">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153334">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153378">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153415">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153419">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153455">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153471">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153505">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153509">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4153562">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153619">p</span><span class="op" id="4153620">,</span>&nbsp;<span class="ident" id="4153622">rest</span>&nbsp;<span class="op" id="4153627">:=</span>&nbsp;<span class="ident" id="4153630">Decode</span><span class="op" id="4153636">(</span><span class="ident" id="4153637">rest</span><span class="op" id="4153641">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153644">if</span>&nbsp;<span class="ident" id="4153647">p</span>&nbsp;<span class="op" id="4153649">==</span>&nbsp;<span class="ident" id="4153652">nil</span>&nbsp;<span class="op" id="4153656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153660">rest</span>&nbsp;<span class="op" id="4153665">=</span>&nbsp;<span class="ident" id="4153667">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153676">return</span>&nbsp;<span class="ident" id="4153683">p</span><span class="op" id="4153684">,</span>&nbsp;<span class="ident" id="4153686">rest</span><br>
<span class="lineno"></span><span class="op" id="4153691">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4153694">const</span>&nbsp;<span class="ident" id="4153700">pemLineLength</span>&nbsp;<span class="op" id="4153714">=</span>&nbsp;<span class="num" id="4153716">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153720">type</span>&nbsp;<span class="ident" id="4153725">lineBreaker</span>&nbsp;<span class="keyword" id="4153737">struct</span>&nbsp;<span class="op" id="4153744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153747">line</span>&nbsp;<span class="op" id="4153752">[</span><span class="ident" id="4153753">pemLineLength</span><span class="op" id="4153766">]</span><span class="builtintype" id="4153767">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153773">used</span>&nbsp;<span class="builtintype" id="4153778">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153783">out</span>&nbsp;&nbsp;<span class="ident" id="4153788">io</span><span class="op" id="4153790">.</span><span class="ident" id="4153791">Writer</span><br>
<span class="lineno"></span><span class="op" id="4153798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4153801">func</span>&nbsp;<span class="op" id="4153806">(</span><span class="ident" id="4153807">l</span>&nbsp;<span class="op" id="4153809">*</span><span class="ident" id="4153810">lineBreaker</span><span class="op" id="4153821">)</span>&nbsp;<span class="ident" id="4153823">Write</span><span class="op" id="4153828">(</span><span class="ident" id="4153829">b</span>&nbsp;<span class="op" id="4153831">[</span><span class="op" id="4153832">]</span><span class="builtintype" id="4153833">byte</span><span class="op" id="4153837">)</span>&nbsp;<span class="op" id="4153839">(</span><span class="ident" id="4153840">n</span>&nbsp;<span class="builtintype" id="4153842">int</span><span class="op" id="4153845">,</span>&nbsp;<span class="ident" id="4153847">err</span>&nbsp;<span class="builtintype" id="4153851">error</span><span class="op" id="4153856">)</span>&nbsp;<span class="op" id="4153858">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153861">if</span>&nbsp;<span class="ident" id="4153864">l</span><span class="op" id="4153865">.</span><span class="ident" id="4153866">used</span><span class="op" id="4153870">+</span><span class="builtinfunc" id="4153871">len</span><span class="op" id="4153874">(</span><span class="ident" id="4153875">b</span><span class="op" id="4153876">)</span>&nbsp;<span class="op" id="4153878">&lt;</span>&nbsp;<span class="ident" id="4153880">pemLineLength</span>&nbsp;<span class="op" id="4153894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4153898">copy</span><span class="op" id="4153902">(</span><span class="ident" id="4153903">l</span><span class="op" id="4153904">.</span><span class="ident" id="4153905">line</span><span class="op" id="4153909">[</span><span class="ident" id="4153910">l</span><span class="op" id="4153911">.</span><span class="ident" id="4153912">used</span><span class="op" id="4153916">:</span><span class="op" id="4153917">]</span><span class="op" id="4153918">,</span>&nbsp;<span class="ident" id="4153920">b</span><span class="op" id="4153921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153925">l</span><span class="op" id="4153926">.</span><span class="ident" id="4153927">used</span>&nbsp;<span class="op" id="4153932">+=</span>&nbsp;<span class="builtinfunc" id="4153935">len</span><span class="op" id="4153938">(</span><span class="ident" id="4153939">b</span><span class="op" id="4153940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4153944">return</span>&nbsp;<span class="builtinfunc" id="4153951">len</span><span class="op" id="4153954">(</span><span class="ident" id="4153955">b</span><span class="op" id="4153956">)</span><span class="op" id="4153957">,</span>&nbsp;<span class="ident" id="4153959">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4153964">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4153968">n</span><span class="op" id="4153969">,</span>&nbsp;<span class="ident" id="4153971">err</span>&nbsp;<span class="op" id="4153975">=</span>&nbsp;<span class="ident" id="4153977">l</span><span class="op" id="4153978">.</span><span class="ident" id="4153979">out</span><span class="op" id="4153982">.</span><span class="ident" id="4153983">Write</span><span class="op" id="4153988">(</span><span class="ident" id="4153989">l</span><span class="op" id="4153990">.</span><span class="ident" id="4153991">line</span><span class="op" id="4153995">[</span><span class="num" id="4153996">0</span><span class="op" id="4153997">:</span><span class="ident" id="4153998">l</span><span class="op" id="4153999">.</span><span class="ident" id="4154000">used</span><span class="op" id="4154004">]</span><span class="op" id="4154005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154008">if</span>&nbsp;<span class="ident" id="4154011">err</span>&nbsp;<span class="op" id="4154015">!=</span>&nbsp;<span class="ident" id="4154018">nil</span>&nbsp;<span class="op" id="4154022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154026">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154034">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154037">excess</span>&nbsp;<span class="op" id="4154044">:=</span>&nbsp;<span class="ident" id="4154047">pemLineLength</span>&nbsp;<span class="op" id="4154061">-</span>&nbsp;<span class="ident" id="4154063">l</span><span class="op" id="4154064">.</span><span class="ident" id="4154065">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154071">l</span><span class="op" id="4154072">.</span><span class="ident" id="4154073">used</span>&nbsp;<span class="op" id="4154078">=</span>&nbsp;<span class="num" id="4154080">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154084">n</span><span class="op" id="4154085">,</span>&nbsp;<span class="ident" id="4154087">err</span>&nbsp;<span class="op" id="4154091">=</span>&nbsp;<span class="ident" id="4154093">l</span><span class="op" id="4154094">.</span><span class="ident" id="4154095">out</span><span class="op" id="4154098">.</span><span class="ident" id="4154099">Write</span><span class="op" id="4154104">(</span><span class="ident" id="4154105">b</span><span class="op" id="4154106">[</span><span class="num" id="4154107">0</span><span class="op" id="4154108">:</span><span class="ident" id="4154109">excess</span><span class="op" id="4154115">]</span><span class="op" id="4154116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154119">if</span>&nbsp;<span class="ident" id="4154122">err</span>&nbsp;<span class="op" id="4154126">!=</span>&nbsp;<span class="ident" id="4154129">nil</span>&nbsp;<span class="op" id="4154133">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154137">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154149">n</span><span class="op" id="4154150">,</span>&nbsp;<span class="ident" id="4154152">err</span>&nbsp;<span class="op" id="4154156">=</span>&nbsp;<span class="ident" id="4154158">l</span><span class="op" id="4154159">.</span><span class="ident" id="4154160">out</span><span class="op" id="4154163">.</span><span class="ident" id="4154164">Write</span><span class="op" id="4154169">(</span><span class="op" id="4154170">[</span><span class="op" id="4154171">]</span><span class="builtintype" id="4154172">byte</span><span class="op" id="4154176">{</span><span class="string" id="4154177">&#39;\n&#39;</span><span class="op" id="4154181">}</span><span class="op" id="4154182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154185">if</span>&nbsp;<span class="ident" id="4154188">err</span>&nbsp;<span class="op" id="4154192">!=</span>&nbsp;<span class="ident" id="4154195">nil</span>&nbsp;<span class="op" id="4154199">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154203">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154215">return</span>&nbsp;<span class="ident" id="4154222">l</span><span class="op" id="4154223">.</span><span class="ident" id="4154224">Write</span><span class="op" id="4154229">(</span><span class="ident" id="4154230">b</span><span class="op" id="4154231">[</span><span class="ident" id="4154232">excess</span><span class="op" id="4154238">:</span><span class="op" id="4154239">]</span><span class="op" id="4154240">)</span><br>
<span class="lineno"></span><span class="op" id="4154242">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="4154245">func</span>&nbsp;<span class="op" id="4154250">(</span><span class="ident" id="4154251">l</span>&nbsp;<span class="op" id="4154253">*</span><span class="ident" id="4154254">lineBreaker</span><span class="op" id="4154265">)</span>&nbsp;<span class="ident" id="4154267">Close</span><span class="op" id="4154272">(</span><span class="op" id="4154273">)</span>&nbsp;<span class="op" id="4154275">(</span><span class="ident" id="4154276">err</span>&nbsp;<span class="builtintype" id="4154280">error</span><span class="op" id="4154285">)</span>&nbsp;<span class="op" id="4154287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154290">if</span>&nbsp;<span class="ident" id="4154293">l</span><span class="op" id="4154294">.</span><span class="ident" id="4154295">used</span>&nbsp;<span class="op" id="4154300">&gt;</span>&nbsp;<span class="num" id="4154302">0</span>&nbsp;<span class="op" id="4154304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154308">_</span><span class="op" id="4154309">,</span>&nbsp;<span class="ident" id="4154311">err</span>&nbsp;<span class="op" id="4154315">=</span>&nbsp;<span class="ident" id="4154317">l</span><span class="op" id="4154318">.</span><span class="ident" id="4154319">out</span><span class="op" id="4154322">.</span><span class="ident" id="4154323">Write</span><span class="op" id="4154328">(</span><span class="ident" id="4154329">l</span><span class="op" id="4154330">.</span><span class="ident" id="4154331">line</span><span class="op" id="4154335">[</span><span class="num" id="4154336">0</span><span class="op" id="4154337">:</span><span class="ident" id="4154338">l</span><span class="op" id="4154339">.</span><span class="ident" id="4154340">used</span><span class="op" id="4154344">]</span><span class="op" id="4154345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154349">if</span>&nbsp;<span class="ident" id="4154352">err</span>&nbsp;<span class="op" id="4154356">!=</span>&nbsp;<span class="ident" id="4154359">nil</span>&nbsp;<span class="op" id="4154363">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154368">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154381">_</span><span class="op" id="4154382">,</span>&nbsp;<span class="ident" id="4154384">err</span>&nbsp;<span class="op" id="4154388">=</span>&nbsp;<span class="ident" id="4154390">l</span><span class="op" id="4154391">.</span><span class="ident" id="4154392">out</span><span class="op" id="4154395">.</span><span class="ident" id="4154396">Write</span><span class="op" id="4154401">(</span><span class="op" id="4154402">[</span><span class="op" id="4154403">]</span><span class="builtintype" id="4154404">byte</span><span class="op" id="4154408">{</span><span class="string" id="4154409">&#39;\n&#39;</span><span class="op" id="4154413">}</span><span class="op" id="4154414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154421">return</span><br>
<span class="lineno"></span><span class="op" id="4154428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4154431">func</span>&nbsp;<span class="ident" id="4154436">writeHeader</span><span class="op" id="4154447">(</span><span class="ident" id="4154448">out</span>&nbsp;<span class="ident" id="4154452">io</span><span class="op" id="4154454">.</span><span class="ident" id="4154455">Writer</span><span class="op" id="4154461">,</span>&nbsp;<span class="ident" id="4154463">k</span><span class="op" id="4154464">,</span>&nbsp;<span class="ident" id="4154466">v</span>&nbsp;<span class="builtintype" id="4154468">string</span><span class="op" id="4154474">)</span>&nbsp;<span class="builtintype" id="4154476">error</span>&nbsp;<span class="op" id="4154482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154485">_</span><span class="op" id="4154486">,</span>&nbsp;<span class="ident" id="4154488">err</span>&nbsp;<span class="op" id="4154492">:=</span>&nbsp;<span class="ident" id="4154495">out</span><span class="op" id="4154498">.</span><span class="ident" id="4154499">Write</span><span class="op" id="4154504">(</span><span class="op" id="4154505">[</span><span class="op" id="4154506">]</span><span class="builtintype" id="4154507">byte</span><span class="op" id="4154511">(</span><span class="ident" id="4154512">k</span>&nbsp;<span class="op" id="4154514">+</span>&nbsp;<span class="string" id="4154516">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4154521">+</span>&nbsp;<span class="ident" id="4154523">v</span>&nbsp;<span class="op" id="4154525">+</span>&nbsp;<span class="string" id="4154527">&#34;\n&#34;</span><span class="op" id="4154531">)</span><span class="op" id="4154532">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154535">return</span>&nbsp;<span class="ident" id="4154542">err</span><br>
<span class="lineno"></span><span class="op" id="4154546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4154549">func</span>&nbsp;<span class="ident" id="4154554">Encode</span><span class="op" id="4154560">(</span><span class="ident" id="4154561">out</span>&nbsp;<span class="ident" id="4154565">io</span><span class="op" id="4154567">.</span><span class="ident" id="4154568">Writer</span><span class="op" id="4154574">,</span>&nbsp;<span class="ident" id="4154576">b</span>&nbsp;<span class="op" id="4154578">*</span><span class="ident" id="4154579">Block</span><span class="op" id="4154584">)</span>&nbsp;<span class="builtintype" id="4154586">error</span>&nbsp;<span class="op" id="4154592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154595">if</span>&nbsp;<span class="ident" id="4154598">_</span><span class="op" id="4154599">,</span>&nbsp;<span class="ident" id="4154601">err</span>&nbsp;<span class="op" id="4154605">:=</span>&nbsp;<span class="ident" id="4154608">out</span><span class="op" id="4154611">.</span><span class="ident" id="4154612">Write</span><span class="op" id="4154617">(</span><span class="ident" id="4154618">pemStart</span><span class="op" id="4154626">[</span><span class="num" id="4154627">1</span><span class="op" id="4154628">:</span><span class="op" id="4154629">]</span><span class="op" id="4154630">)</span><span class="op" id="4154631">;</span>&nbsp;<span class="ident" id="4154633">err</span>&nbsp;<span class="op" id="4154637">!=</span>&nbsp;<span class="ident" id="4154640">nil</span>&nbsp;<span class="op" id="4154644">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154648">return</span>&nbsp;<span class="ident" id="4154655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154663">if</span>&nbsp;<span class="ident" id="4154666">_</span><span class="op" id="4154667">,</span>&nbsp;<span class="ident" id="4154669">err</span>&nbsp;<span class="op" id="4154673">:=</span>&nbsp;<span class="ident" id="4154676">out</span><span class="op" id="4154679">.</span><span class="ident" id="4154680">Write</span><span class="op" id="4154685">(</span><span class="op" id="4154686">[</span><span class="op" id="4154687">]</span><span class="builtintype" id="4154688">byte</span><span class="op" id="4154692">(</span><span class="ident" id="4154693">b</span><span class="op" id="4154694">.</span><span class="ident" id="4154695">Type</span>&nbsp;<span class="op" id="4154700">+</span>&nbsp;<span class="string" id="4154702">&#34;-----\n&#34;</span><span class="op" id="4154711">)</span><span class="op" id="4154712">)</span><span class="op" id="4154713">;</span>&nbsp;<span class="ident" id="4154715">err</span>&nbsp;<span class="op" id="4154719">!=</span>&nbsp;<span class="ident" id="4154722">nil</span>&nbsp;<span class="op" id="4154726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154730">return</span>&nbsp;<span class="ident" id="4154737">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154742">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154746">if</span>&nbsp;<span class="builtinfunc" id="4154749">len</span><span class="op" id="4154752">(</span><span class="ident" id="4154753">b</span><span class="op" id="4154754">.</span><span class="ident" id="4154755">Headers</span><span class="op" id="4154762">)</span>&nbsp;<span class="op" id="4154764">&gt;</span>&nbsp;<span class="num" id="4154766">0</span>&nbsp;<span class="op" id="4154768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154772">const</span>&nbsp;<span class="ident" id="4154778">procType</span>&nbsp;<span class="op" id="4154787">=</span>&nbsp;<span class="string" id="4154789">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154803">h</span>&nbsp;<span class="op" id="4154805">:=</span>&nbsp;<span class="builtinfunc" id="4154808">make</span><span class="op" id="4154812">(</span><span class="op" id="4154813">[</span><span class="op" id="4154814">]</span><span class="builtintype" id="4154815">string</span><span class="op" id="4154821">,</span>&nbsp;<span class="num" id="4154823">0</span><span class="op" id="4154824">,</span>&nbsp;<span class="builtinfunc" id="4154826">len</span><span class="op" id="4154829">(</span><span class="ident" id="4154830">b</span><span class="op" id="4154831">.</span><span class="ident" id="4154832">Headers</span><span class="op" id="4154839">)</span><span class="op" id="4154840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154844">hasProcType</span>&nbsp;<span class="op" id="4154856">:=</span>&nbsp;<span class="ident" id="4154859">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154867">for</span>&nbsp;<span class="ident" id="4154871">k</span>&nbsp;<span class="op" id="4154873">:=</span>&nbsp;<span class="keyword" id="4154876">range</span>&nbsp;<span class="ident" id="4154882">b</span><span class="op" id="4154883">.</span><span class="ident" id="4154884">Headers</span>&nbsp;<span class="op" id="4154892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154897">if</span>&nbsp;<span class="ident" id="4154900">k</span>&nbsp;<span class="op" id="4154902">==</span>&nbsp;<span class="ident" id="4154905">procType</span>&nbsp;<span class="op" id="4154914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154920">hasProcType</span>&nbsp;<span class="op" id="4154932">=</span>&nbsp;<span class="ident" id="4154934">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4154943">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154955">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4154960">h</span>&nbsp;<span class="op" id="4154962">=</span>&nbsp;<span class="builtinfunc" id="4154964">append</span><span class="op" id="4154970">(</span><span class="ident" id="4154971">h</span><span class="op" id="4154972">,</span>&nbsp;<span class="ident" id="4154974">k</span><span class="op" id="4154975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4154979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4154983">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155032">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155067">if</span>&nbsp;<span class="ident" id="4155070">hasProcType</span>&nbsp;<span class="op" id="4155082">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155087">if</span>&nbsp;<span class="ident" id="4155090">err</span>&nbsp;<span class="op" id="4155094">:=</span>&nbsp;<span class="ident" id="4155097">writeHeader</span><span class="op" id="4155108">(</span><span class="ident" id="4155109">out</span><span class="op" id="4155112">,</span>&nbsp;<span class="ident" id="4155114">procType</span><span class="op" id="4155122">,</span>&nbsp;<span class="ident" id="4155124">b</span><span class="op" id="4155125">.</span><span class="ident" id="4155126">Headers</span><span class="op" id="4155133">[</span><span class="ident" id="4155134">procType</span><span class="op" id="4155142">]</span><span class="op" id="4155143">)</span><span class="op" id="4155144">;</span>&nbsp;<span class="ident" id="4155146">err</span>&nbsp;<span class="op" id="4155150">!=</span>&nbsp;<span class="ident" id="4155153">nil</span>&nbsp;<span class="op" id="4155157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155163">return</span>&nbsp;<span class="ident" id="4155170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4155185">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155252">sort</span><span class="op" id="4155256">.</span><span class="ident" id="4155257">Strings</span><span class="op" id="4155264">(</span><span class="ident" id="4155265">h</span><span class="op" id="4155266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155270">for</span>&nbsp;<span class="ident" id="4155274">_</span><span class="op" id="4155275">,</span>&nbsp;<span class="ident" id="4155277">k</span>&nbsp;<span class="op" id="4155279">:=</span>&nbsp;<span class="keyword" id="4155282">range</span>&nbsp;<span class="ident" id="4155288">h</span>&nbsp;<span class="op" id="4155290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155295">if</span>&nbsp;<span class="ident" id="4155298">err</span>&nbsp;<span class="op" id="4155302">:=</span>&nbsp;<span class="ident" id="4155305">writeHeader</span><span class="op" id="4155316">(</span><span class="ident" id="4155317">out</span><span class="op" id="4155320">,</span>&nbsp;<span class="ident" id="4155322">k</span><span class="op" id="4155323">,</span>&nbsp;<span class="ident" id="4155325">b</span><span class="op" id="4155326">.</span><span class="ident" id="4155327">Headers</span><span class="op" id="4155334">[</span><span class="ident" id="4155335">k</span><span class="op" id="4155336">]</span><span class="op" id="4155337">)</span><span class="op" id="4155338">;</span>&nbsp;<span class="ident" id="4155340">err</span>&nbsp;<span class="op" id="4155344">!=</span>&nbsp;<span class="ident" id="4155347">nil</span>&nbsp;<span class="op" id="4155351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155357">return</span>&nbsp;<span class="ident" id="4155364">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155371">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155379">if</span>&nbsp;<span class="ident" id="4155382">_</span><span class="op" id="4155383">,</span>&nbsp;<span class="ident" id="4155385">err</span>&nbsp;<span class="op" id="4155389">:=</span>&nbsp;<span class="ident" id="4155392">out</span><span class="op" id="4155395">.</span><span class="ident" id="4155396">Write</span><span class="op" id="4155401">(</span><span class="op" id="4155402">[</span><span class="op" id="4155403">]</span><span class="builtintype" id="4155404">byte</span><span class="op" id="4155408">{</span><span class="string" id="4155409">&#39;\n&#39;</span><span class="op" id="4155413">}</span><span class="op" id="4155414">)</span><span class="op" id="4155415">;</span>&nbsp;<span class="ident" id="4155417">err</span>&nbsp;<span class="op" id="4155421">!=</span>&nbsp;<span class="ident" id="4155424">nil</span>&nbsp;<span class="op" id="4155428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155433">return</span>&nbsp;<span class="ident" id="4155440">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155449">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155453">var</span>&nbsp;<span class="ident" id="4155457">breaker</span>&nbsp;<span class="ident" id="4155465">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155478">breaker</span><span class="op" id="4155485">.</span><span class="ident" id="4155486">out</span>&nbsp;<span class="op" id="4155490">=</span>&nbsp;<span class="ident" id="4155492">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155498">b64</span>&nbsp;<span class="op" id="4155502">:=</span>&nbsp;<span class="ident" id="4155505">base64</span><span class="op" id="4155511">.</span><span class="ident" id="4155512">NewEncoder</span><span class="op" id="4155522">(</span><span class="ident" id="4155523">base64</span><span class="op" id="4155529">.</span><span class="ident" id="4155530">StdEncoding</span><span class="op" id="4155541">,</span>&nbsp;<span class="op" id="4155543">&amp;</span><span class="ident" id="4155544">breaker</span><span class="op" id="4155551">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155554">if</span>&nbsp;<span class="ident" id="4155557">_</span><span class="op" id="4155558">,</span>&nbsp;<span class="ident" id="4155560">err</span>&nbsp;<span class="op" id="4155564">:=</span>&nbsp;<span class="ident" id="4155567">b64</span><span class="op" id="4155570">.</span><span class="ident" id="4155571">Write</span><span class="op" id="4155576">(</span><span class="ident" id="4155577">b</span><span class="op" id="4155578">.</span><span class="ident" id="4155579">Bytes</span><span class="op" id="4155584">)</span><span class="op" id="4155585">;</span>&nbsp;<span class="ident" id="4155587">err</span>&nbsp;<span class="op" id="4155591">!=</span>&nbsp;<span class="ident" id="4155594">nil</span>&nbsp;<span class="op" id="4155598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155602">return</span>&nbsp;<span class="ident" id="4155609">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155617">b64</span><span class="op" id="4155620">.</span><span class="ident" id="4155621">Close</span><span class="op" id="4155626">(</span><span class="op" id="4155627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155630">breaker</span><span class="op" id="4155637">.</span><span class="ident" id="4155638">Close</span><span class="op" id="4155643">(</span><span class="op" id="4155644">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155648">if</span>&nbsp;<span class="ident" id="4155651">_</span><span class="op" id="4155652">,</span>&nbsp;<span class="ident" id="4155654">err</span>&nbsp;<span class="op" id="4155658">:=</span>&nbsp;<span class="ident" id="4155661">out</span><span class="op" id="4155664">.</span><span class="ident" id="4155665">Write</span><span class="op" id="4155670">(</span><span class="ident" id="4155671">pemEnd</span><span class="op" id="4155677">[</span><span class="num" id="4155678">1</span><span class="op" id="4155679">:</span><span class="op" id="4155680">]</span><span class="op" id="4155681">)</span><span class="op" id="4155682">;</span>&nbsp;<span class="ident" id="4155684">err</span>&nbsp;<span class="op" id="4155688">!=</span>&nbsp;<span class="ident" id="4155691">nil</span>&nbsp;<span class="op" id="4155695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155699">return</span>&nbsp;<span class="ident" id="4155706">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4155711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155714">_</span><span class="op" id="4155715">,</span>&nbsp;<span class="ident" id="4155717">err</span>&nbsp;<span class="op" id="4155721">:=</span>&nbsp;<span class="ident" id="4155724">out</span><span class="op" id="4155727">.</span><span class="ident" id="4155728">Write</span><span class="op" id="4155733">(</span><span class="op" id="4155734">[</span><span class="op" id="4155735">]</span><span class="builtintype" id="4155736">byte</span><span class="op" id="4155740">(</span><span class="ident" id="4155741">b</span><span class="op" id="4155742">.</span><span class="ident" id="4155743">Type</span>&nbsp;<span class="op" id="4155748">+</span>&nbsp;<span class="string" id="4155750">&#34;-----\n&#34;</span><span class="op" id="4155759">)</span><span class="op" id="4155760">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155763">return</span>&nbsp;<span class="ident" id="4155770">err</span><br>
<span class="lineno"></span><span class="op" id="4155774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4155777">func</span>&nbsp;<span class="ident" id="4155782">EncodeToMemory</span><span class="op" id="4155796">(</span><span class="ident" id="4155797">b</span>&nbsp;<span class="op" id="4155799">*</span><span class="ident" id="4155800">Block</span><span class="op" id="4155805">)</span>&nbsp;<span class="op" id="4155807">[</span><span class="op" id="4155808">]</span><span class="builtintype" id="4155809">byte</span>&nbsp;<span class="op" id="4155814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155817">var</span>&nbsp;<span class="ident" id="4155821">buf</span>&nbsp;<span class="ident" id="4155825">bytes</span><span class="op" id="4155830">.</span><span class="ident" id="4155831">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4155839">Encode</span><span class="op" id="4155845">(</span><span class="op" id="4155846">&amp;</span><span class="ident" id="4155847">buf</span><span class="op" id="4155850">,</span>&nbsp;<span class="ident" id="4155852">b</span><span class="op" id="4155853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4155856">return</span>&nbsp;<span class="ident" id="4155863">buf</span><span class="op" id="4155866">.</span><span class="ident" id="4155867">Bytes</span><span class="op" id="4155872">(</span><span class="op" id="4155873">)</span><br>
<span class="lineno"></span><span class="op" id="4155875">}</span>
</div>
</body>
</html>
