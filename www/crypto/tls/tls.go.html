<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3963514">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3963569">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3963623">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3963674">//&nbsp;Package&nbsp;tls&nbsp;partially&nbsp;implements&nbsp;TLS&nbsp;1.2,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5246.</span><br>
<span class="lineno"></span><span class="keyword" id="3963745">package</span>&nbsp;<span class="ident" id="3963753">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3963758">import</span>&nbsp;<span class="op" id="3963765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963768">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963778">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963794">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963808">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963823">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963839">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963849">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963862">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963869">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3963880">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3963887">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3963890">//&nbsp;Server&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;server&nbsp;side&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="3963941">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="3963984">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3964042">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno">25</span><span class="keyword" id="3964071">func</span>&nbsp;<span class="ident" id="3964076">Server</span><span class="op" id="3964082">(</span><span class="ident" id="3964083">conn</span>&nbsp;<span class="ident" id="3964088"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3964091">.</span><span class="ident" id="3964092">Conn</span><span class="op" id="3964096">,</span>&nbsp;<span class="ident" id="3964098">config</span>&nbsp;<span class="op" id="3964105">*</span><span class="ident" id="3964106"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3964112">)</span>&nbsp;<span class="op" id="3964114">*</span><span class="ident" id="3964115"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span>&nbsp;<span class="op" id="3964120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3964123">return</span>&nbsp;<span class="op" id="3964130">&amp;</span><span class="ident" id="3964131"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><span class="op" id="3964135">{</span><span class="ident" id="3964136">conn</span><span class="op" id="3964140">:</span>&nbsp;<span class="ident" id="3964142"><a href="/crypto/tls/tls.go.html#3964083">conn</a></span><span class="op" id="3964146">,</span>&nbsp;<span class="ident" id="3964148">config</span><span class="op" id="3964154">:</span>&nbsp;<span class="ident" id="3964156"><a href="/crypto/tls/tls.go.html#3964098">config</a></span><span class="op" id="3964162">}</span><br>
<span class="lineno"></span><span class="op" id="3964164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3964167">//&nbsp;Client&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;client&nbsp;side&nbsp;connection</span><br>
<span class="lineno">30</span><span class="comment" id="3964218">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="3964261">//&nbsp;The&nbsp;config&nbsp;cannot&nbsp;be&nbsp;nil:&nbsp;users&nbsp;must&nbsp;set&nbsp;either&nbsp;ServerName&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3964326">//&nbsp;InsecureSkipVerify&nbsp;in&nbsp;the&nbsp;config.</span><br>
<span class="lineno"></span><span class="keyword" id="3964363">func</span>&nbsp;<span class="ident" id="3964368">Client</span><span class="op" id="3964374">(</span><span class="ident" id="3964375">conn</span>&nbsp;<span class="ident" id="3964380"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3964383">.</span><span class="ident" id="3964384">Conn</span><span class="op" id="3964388">,</span>&nbsp;<span class="ident" id="3964390">config</span>&nbsp;<span class="op" id="3964397">*</span><span class="ident" id="3964398"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3964404">)</span>&nbsp;<span class="op" id="3964406">*</span><span class="ident" id="3964407"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span>&nbsp;<span class="op" id="3964412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3964415">return</span>&nbsp;<span class="op" id="3964422">&amp;</span><span class="ident" id="3964423"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><span class="op" id="3964427">{</span><span class="ident" id="3964428">conn</span><span class="op" id="3964432">:</span>&nbsp;<span class="ident" id="3964434"><a href="/crypto/tls/tls.go.html#3964375">conn</a></span><span class="op" id="3964438">,</span>&nbsp;<span class="ident" id="3964440">config</span><span class="op" id="3964446">:</span>&nbsp;<span class="ident" id="3964448"><a href="/crypto/tls/tls.go.html#3964390">config</a></span><span class="op" id="3964454">,</span>&nbsp;<span class="ident" id="3964456">isClient</span><span class="op" id="3964464">:</span>&nbsp;<span class="builtintype" id="3964466">true</span><span class="op" id="3964470">}</span><br>
<span class="lineno">35</span><span class="op" id="3964472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3964475">//&nbsp;A&nbsp;listener&nbsp;implements&nbsp;a&nbsp;network&nbsp;listener&nbsp;(net.Listener)&nbsp;for&nbsp;TLS&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="3964555">type</span>&nbsp;<span class="ident" id="3964560">listener</span>&nbsp;<span class="keyword" id="3964569">struct</span>&nbsp;<span class="op" id="3964576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3964579"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3964582">.</span><span class="ident" id="3964583">Listener</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3964593">config</span>&nbsp;<span class="op" id="3964600">*</span><span class="ident" id="3964601"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><br>
<span class="lineno"></span><span class="op" id="3964608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3964611">//&nbsp;Accept&nbsp;waits&nbsp;for&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;incoming&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3964677">//&nbsp;The&nbsp;returned&nbsp;connection&nbsp;c&nbsp;is&nbsp;a&nbsp;*tls.Conn.</span><br>
<span class="lineno">45</span><span class="keyword" id="3964722">func</span>&nbsp;<span class="op" id="3964727">(</span><span class="ident" id="3964728">l</span>&nbsp;<span class="op" id="3964730">*</span><span class="ident" id="3964731"><a href="/crypto/tls/tls.go.html#3964560">listener</a></span><span class="op" id="3964739">)</span>&nbsp;<span class="ident" id="3964741">Accept</span><span class="op" id="3964747">(</span><span class="op" id="3964748">)</span>&nbsp;<span class="op" id="3964750">(</span><span class="ident" id="3964751">c</span>&nbsp;<span class="ident" id="3964753"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3964756">.</span><span class="ident" id="3964757">Conn</span><span class="op" id="3964761">,</span>&nbsp;<span class="ident" id="3964763">err</span>&nbsp;<span class="builtintype" id="3964767">error</span><span class="op" id="3964772">)</span>&nbsp;<span class="op" id="3964774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3964777"><a href="/crypto/tls/tls.go.html#3964751">c</a></span><span class="op" id="3964778">,</span>&nbsp;<span class="ident" id="3964780"><a href="/crypto/tls/tls.go.html#3964763">err</a></span>&nbsp;<span class="op" id="3964784">=</span>&nbsp;<span class="ident" id="3964786"><a href="/crypto/tls/tls.go.html#3964728">l</a></span><span class="op" id="3964787">.</span><span class="ident" id="3964788">Listener</span><span class="op" id="3964796">.</span><span class="ident" id="3964797">Accept</span><span class="op" id="3964803">(</span><span class="op" id="3964804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3964807">if</span>&nbsp;<span class="ident" id="3964810"><a href="/crypto/tls/tls.go.html#3964763">err</a></span>&nbsp;<span class="op" id="3964814">!=</span>&nbsp;<span class="ident" id="3964817">nil</span>&nbsp;<span class="op" id="3964821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3964825">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3964833">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3964836"><a href="/crypto/tls/tls.go.html#3964751">c</a></span>&nbsp;<span class="op" id="3964838">=</span>&nbsp;<span class="ident" id="3964840"><a href="/crypto/tls/tls.go.html#3964076">Server</a></span><span class="op" id="3964846">(</span><span class="ident" id="3964847"><a href="/crypto/tls/tls.go.html#3964751">c</a></span><span class="op" id="3964848">,</span>&nbsp;<span class="ident" id="3964850"><a href="/crypto/tls/tls.go.html#3964728">l</a></span><span class="op" id="3964851">.</span><span class="ident" id="3964852">config</span><span class="op" id="3964858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3964861">return</span><br>
<span class="lineno"></span><span class="op" id="3964868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3964871">//&nbsp;NewListener&nbsp;creates&nbsp;a&nbsp;Listener&nbsp;which&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;an&nbsp;inner</span><br>
<span class="lineno">55</span><span class="comment" id="3964945">//&nbsp;Listener&nbsp;and&nbsp;wraps&nbsp;each&nbsp;connection&nbsp;with&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="3964996">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3965054">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3965083">func</span>&nbsp;<span class="ident" id="3965088">NewListener</span><span class="op" id="3965099">(</span><span class="ident" id="3965100">inner</span>&nbsp;<span class="ident" id="3965106"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3965109">.</span><span class="ident" id="3965110">Listener</span><span class="op" id="3965118">,</span>&nbsp;<span class="ident" id="3965120">config</span>&nbsp;<span class="op" id="3965127">*</span><span class="ident" id="3965128"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3965134">)</span>&nbsp;<span class="ident" id="3965136"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3965139">.</span><span class="ident" id="3965140">Listener</span>&nbsp;<span class="op" id="3965149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3965152">l</span>&nbsp;<span class="op" id="3965154">:=</span>&nbsp;<span class="builtinfunc" id="3965157">new</span><span class="op" id="3965160">(</span><span class="ident" id="3965161"><a href="/crypto/tls/tls.go.html#3964560">listener</a></span><span class="op" id="3965169">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3965172"><a href="/crypto/tls/tls.go.html#3965152">l</a></span><span class="op" id="3965173">.</span><span class="ident" id="3965174">Listener</span>&nbsp;<span class="op" id="3965183">=</span>&nbsp;<span class="ident" id="3965185"><a href="/crypto/tls/tls.go.html#3965100">inner</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3965192"><a href="/crypto/tls/tls.go.html#3965152">l</a></span><span class="op" id="3965193">.</span><span class="ident" id="3965194">config</span>&nbsp;<span class="op" id="3965201">=</span>&nbsp;<span class="ident" id="3965203"><a href="/crypto/tls/tls.go.html#3965120">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965211">return</span>&nbsp;<span class="ident" id="3965218"><a href="/crypto/tls/tls.go.html#3965152">l</a></span><br>
<span class="lineno"></span><span class="op" id="3965220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3965223">//&nbsp;Listen&nbsp;creates&nbsp;a&nbsp;TLS&nbsp;listener&nbsp;accepting&nbsp;connections&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3965285">//&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Listen.</span><br>
<span class="lineno"></span><span class="comment" id="3965328">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="3965386">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3965415">func</span>&nbsp;<span class="ident" id="3965420">Listen</span><span class="op" id="3965426">(</span><span class="ident" id="3965427">network</span><span class="op" id="3965434">,</span>&nbsp;<span class="ident" id="3965436">laddr</span>&nbsp;<span class="builtintype" id="3965442">string</span><span class="op" id="3965448">,</span>&nbsp;<span class="ident" id="3965450">config</span>&nbsp;<span class="op" id="3965457">*</span><span class="ident" id="3965458"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3965464">)</span>&nbsp;<span class="op" id="3965466">(</span><span class="ident" id="3965467"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3965470">.</span><span class="ident" id="3965471">Listener</span><span class="op" id="3965479">,</span>&nbsp;<span class="builtintype" id="3965481">error</span><span class="op" id="3965486">)</span>&nbsp;<span class="op" id="3965488">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965491">if</span>&nbsp;<span class="ident" id="3965494"><a href="/crypto/tls/tls.go.html#3965450">config</a></span>&nbsp;<span class="op" id="3965501">==</span>&nbsp;<span class="ident" id="3965504">nil</span>&nbsp;<span class="op" id="3965508">||</span>&nbsp;<span class="builtinfunc" id="3965511">len</span><span class="op" id="3965514">(</span><span class="ident" id="3965515"><a href="/crypto/tls/tls.go.html#3965450">config</a></span><span class="op" id="3965521">.</span><span class="ident" id="3965522">Certificates</span><span class="op" id="3965534">)</span>&nbsp;<span class="op" id="3965536">==</span>&nbsp;<span class="num" id="3965539">0</span>&nbsp;<span class="op" id="3965541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965545">return</span>&nbsp;<span class="ident" id="3965552">nil</span><span class="op" id="3965555">,</span>&nbsp;<span class="ident" id="3965557"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3965563">.</span><span class="ident" id="3965564">New</span><span class="op" id="3965567">(</span><span class="string" id="3965568">&#34;tls.Listen:&nbsp;no&nbsp;certificates&nbsp;in&nbsp;configuration&#34;</span><span class="op" id="3965614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3965617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3965620">l</span><span class="op" id="3965621">,</span>&nbsp;<span class="ident" id="3965623">err</span>&nbsp;<span class="op" id="3965627">:=</span>&nbsp;<span class="ident" id="3965630"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3965633">.</span><span class="ident" id="3965634">Listen</span><span class="op" id="3965640">(</span><span class="ident" id="3965641"><a href="/crypto/tls/tls.go.html#3965427">network</a></span><span class="op" id="3965648">,</span>&nbsp;<span class="ident" id="3965650"><a href="/crypto/tls/tls.go.html#3965436">laddr</a></span><span class="op" id="3965655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965658">if</span>&nbsp;<span class="ident" id="3965661"><a href="/crypto/tls/tls.go.html#3965623">err</a></span>&nbsp;<span class="op" id="3965665">!=</span>&nbsp;<span class="ident" id="3965668">nil</span>&nbsp;<span class="op" id="3965672">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965676">return</span>&nbsp;<span class="ident" id="3965683">nil</span><span class="op" id="3965686">,</span>&nbsp;<span class="ident" id="3965688"><a href="/crypto/tls/tls.go.html#3965623">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3965693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3965696">return</span>&nbsp;<span class="ident" id="3965703"><a href="/crypto/tls/tls.go.html#3965088">NewListener</a></span><span class="op" id="3965714">(</span><span class="ident" id="3965715"><a href="/crypto/tls/tls.go.html#3965620">l</a></span><span class="op" id="3965716">,</span>&nbsp;<span class="ident" id="3965718"><a href="/crypto/tls/tls.go.html#3965450">config</a></span><span class="op" id="3965724">)</span><span class="op" id="3965725">,</span>&nbsp;<span class="ident" id="3965727">nil</span><br>
<span class="lineno"></span><span class="op" id="3965731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="3965734">type</span>&nbsp;<span class="ident" id="3965739">timeoutError</span>&nbsp;<span class="keyword" id="3965752">struct</span><span class="op" id="3965758">{</span><span class="op" id="3965759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3965762">func</span>&nbsp;<span class="op" id="3965767">(</span><span class="ident" id="3965768"><a href="/crypto/tls/tls.go.html#3965739">timeoutError</a></span><span class="op" id="3965780">)</span>&nbsp;<span class="ident" id="3965782">Error</span><span class="op" id="3965787">(</span><span class="op" id="3965788">)</span>&nbsp;<span class="builtintype" id="3965790">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3965799">{</span>&nbsp;<span class="keyword" id="3965801">return</span>&nbsp;<span class="string" id="3965808">&#34;tls:&nbsp;DialWithDialer&nbsp;timed&nbsp;out&#34;</span>&nbsp;<span class="op" id="3965840">}</span><br>
<span class="lineno"></span><span class="keyword" id="3965842">func</span>&nbsp;<span class="op" id="3965847">(</span><span class="ident" id="3965848"><a href="/crypto/tls/tls.go.html#3965739">timeoutError</a></span><span class="op" id="3965860">)</span>&nbsp;<span class="ident" id="3965862">Timeout</span><span class="op" id="3965869">(</span><span class="op" id="3965870">)</span>&nbsp;<span class="builtintype" id="3965872">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3965879">{</span>&nbsp;<span class="keyword" id="3965881">return</span>&nbsp;<span class="builtintype" id="3965888">true</span>&nbsp;<span class="op" id="3965893">}</span><br>
<span class="lineno"></span><span class="keyword" id="3965895">func</span>&nbsp;<span class="op" id="3965900">(</span><span class="ident" id="3965901"><a href="/crypto/tls/tls.go.html#3965739">timeoutError</a></span><span class="op" id="3965913">)</span>&nbsp;<span class="ident" id="3965915">Temporary</span><span class="op" id="3965924">(</span><span class="op" id="3965925">)</span>&nbsp;<span class="builtintype" id="3965927">bool</span>&nbsp;<span class="op" id="3965932">{</span>&nbsp;<span class="keyword" id="3965934">return</span>&nbsp;<span class="builtintype" id="3965941">true</span>&nbsp;<span class="op" id="3965946">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3965949">//&nbsp;DialWithDialer&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;dialer.Dial&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3966027">//&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting&nbsp;TLS&nbsp;connection.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="3966106">//&nbsp;timeout&nbsp;or&nbsp;deadline&nbsp;given&nbsp;in&nbsp;the&nbsp;dialer&nbsp;apply&nbsp;to&nbsp;connection&nbsp;and&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3966177">//&nbsp;handshake&nbsp;as&nbsp;a&nbsp;whole.</span><br>
<span class="lineno">90</span><span class="comment" id="3966202">//</span><br>
<span class="lineno"></span><span class="comment" id="3966205">//&nbsp;DialWithDialer&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3966280">//&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="3966348">func</span>&nbsp;<span class="ident" id="3966353">DialWithDialer</span><span class="op" id="3966367">(</span><span class="ident" id="3966368">dialer</span>&nbsp;<span class="op" id="3966375">*</span><span class="ident" id="3966376"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3966379">.</span><span class="ident" id="3966380">Dialer</span><span class="op" id="3966386">,</span>&nbsp;<span class="ident" id="3966388">network</span><span class="op" id="3966395">,</span>&nbsp;<span class="ident" id="3966397">addr</span>&nbsp;<span class="builtintype" id="3966402">string</span><span class="op" id="3966408">,</span>&nbsp;<span class="ident" id="3966410">config</span>&nbsp;<span class="op" id="3966417">*</span><span class="ident" id="3966418"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3966424">)</span>&nbsp;<span class="op" id="3966426">(</span><span class="op" id="3966427">*</span><span class="ident" id="3966428"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><span class="op" id="3966432">,</span>&nbsp;<span class="builtintype" id="3966434">error</span><span class="op" id="3966439">)</span>&nbsp;<span class="op" id="3966441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3966444">//&nbsp;We&nbsp;want&nbsp;the&nbsp;Timeout&nbsp;and&nbsp;Deadline&nbsp;values&nbsp;from&nbsp;dialer&nbsp;to&nbsp;cover&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3966513">//&nbsp;whole&nbsp;process:&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;TLS&nbsp;handshake.&nbsp;This&nbsp;means&nbsp;that&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3966585">//&nbsp;also&nbsp;need&nbsp;to&nbsp;start&nbsp;our&nbsp;own&nbsp;timers&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966628">timeout</span>&nbsp;<span class="op" id="3966636">:=</span>&nbsp;<span class="ident" id="3966639"><a href="/crypto/tls/tls.go.html#3966368">dialer</a></span><span class="op" id="3966645">.</span><span class="ident" id="3966646">Timeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3966656">if</span>&nbsp;<span class="op" id="3966659">!</span><span class="ident" id="3966660"><a href="/crypto/tls/tls.go.html#3966368">dialer</a></span><span class="op" id="3966666">.</span><span class="ident" id="3966667">Deadline</span><span class="op" id="3966675">.</span><span class="ident" id="3966676">IsZero</span><span class="op" id="3966682">(</span><span class="op" id="3966683">)</span>&nbsp;<span class="op" id="3966685">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966689">deadlineTimeout</span>&nbsp;<span class="op" id="3966705">:=</span>&nbsp;<span class="ident" id="3966708"><a href="/crypto/tls/tls.go.html#3966368">dialer</a></span><span class="op" id="3966714">.</span><span class="ident" id="3966715">Deadline</span><span class="op" id="3966723">.</span><span class="ident" id="3966724">Sub</span><span class="op" id="3966727">(</span><span class="ident" id="3966728"><a href="/crypto/tls/tls.go.html#3963880">time</a></span><span class="op" id="3966732">.</span><span class="ident" id="3966733">Now</span><span class="op" id="3966736">(</span><span class="op" id="3966737">)</span><span class="op" id="3966738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3966742">if</span>&nbsp;<span class="ident" id="3966745"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span>&nbsp;<span class="op" id="3966753">==</span>&nbsp;<span class="num" id="3966756">0</span>&nbsp;<span class="op" id="3966758">||</span>&nbsp;<span class="ident" id="3966761"><a href="/crypto/tls/tls.go.html#3966689">deadlineTimeout</a></span>&nbsp;<span class="op" id="3966777">&lt;</span>&nbsp;<span class="ident" id="3966779"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span>&nbsp;<span class="op" id="3966787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966792"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span>&nbsp;<span class="op" id="3966800">=</span>&nbsp;<span class="ident" id="3966802"><a href="/crypto/tls/tls.go.html#3966689">deadlineTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3966820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3966823">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3966827">var</span>&nbsp;<span class="ident" id="3966831">errChannel</span>&nbsp;<span class="keyword" id="3966842">chan</span>&nbsp;<span class="builtintype" id="3966847">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3966855">if</span>&nbsp;<span class="ident" id="3966858"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span>&nbsp;<span class="op" id="3966866">!=</span>&nbsp;<span class="num" id="3966869">0</span>&nbsp;<span class="op" id="3966871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966875"><a href="/crypto/tls/tls.go.html#3966831">errChannel</a></span>&nbsp;<span class="op" id="3966886">=</span>&nbsp;<span class="builtinfunc" id="3966888">make</span><span class="op" id="3966892">(</span><span class="keyword" id="3966893">chan</span>&nbsp;<span class="builtintype" id="3966898">error</span><span class="op" id="3966903">,</span>&nbsp;<span class="num" id="3966905">2</span><span class="op" id="3966906">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966910"><a href="/crypto/tls/tls.go.html#3963880">time</a></span><span class="op" id="3966914">.</span><span class="ident" id="3966915">AfterFunc</span><span class="op" id="3966924">(</span><span class="ident" id="3966925"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span><span class="op" id="3966932">,</span>&nbsp;<span class="keyword" id="3966934">func</span><span class="op" id="3966938">(</span><span class="op" id="3966939">)</span>&nbsp;<span class="op" id="3966941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966946"><a href="/crypto/tls/tls.go.html#3966831">errChannel</a></span>&nbsp;<span class="op" id="3966957">&lt;-</span>&nbsp;<span class="ident" id="3966960"><a href="/crypto/tls/tls.go.html#3965739">timeoutError</a></span><span class="op" id="3966972">{</span><span class="op" id="3966973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3966977">}</span><span class="op" id="3966978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3966981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3966985">rawConn</span><span class="op" id="3966992">,</span>&nbsp;<span class="ident" id="3966994">err</span>&nbsp;<span class="op" id="3966998">:=</span>&nbsp;<span class="ident" id="3967001"><a href="/crypto/tls/tls.go.html#3966368">dialer</a></span><span class="op" id="3967007">.</span><span class="ident" id="3967008">Dial</span><span class="op" id="3967012">(</span><span class="ident" id="3967013"><a href="/crypto/tls/tls.go.html#3966388">network</a></span><span class="op" id="3967020">,</span>&nbsp;<span class="ident" id="3967022"><a href="/crypto/tls/tls.go.html#3966397">addr</a></span><span class="op" id="3967026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967029">if</span>&nbsp;<span class="ident" id="3967032"><a href="/crypto/tls/tls.go.html#3966994">err</a></span>&nbsp;<span class="op" id="3967036">!=</span>&nbsp;<span class="ident" id="3967039">nil</span>&nbsp;<span class="op" id="3967043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967047">return</span>&nbsp;<span class="ident" id="3967054">nil</span><span class="op" id="3967057">,</span>&nbsp;<span class="ident" id="3967059"><a href="/crypto/tls/tls.go.html#3966994">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967068">colonPos</span>&nbsp;<span class="op" id="3967077">:=</span>&nbsp;<span class="ident" id="3967080"><a href="/crypto/tls/tls.go.html#3963869">strings</a></span><span class="op" id="3967087">.</span><span class="ident" id="3967088">LastIndex</span><span class="op" id="3967097">(</span><span class="ident" id="3967098"><a href="/crypto/tls/tls.go.html#3966397">addr</a></span><span class="op" id="3967102">,</span>&nbsp;<span class="string" id="3967104">&#34;:&#34;</span><span class="op" id="3967107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967110">if</span>&nbsp;<span class="ident" id="3967113"><a href="/crypto/tls/tls.go.html#3967068">colonPos</a></span>&nbsp;<span class="op" id="3967122">==</span>&nbsp;<span class="op" id="3967125">-</span><span class="num" id="3967126">1</span>&nbsp;<span class="op" id="3967128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967132"><a href="/crypto/tls/tls.go.html#3967068">colonPos</a></span>&nbsp;<span class="op" id="3967141">=</span>&nbsp;<span class="builtinfunc" id="3967143">len</span><span class="op" id="3967146">(</span><span class="ident" id="3967147"><a href="/crypto/tls/tls.go.html#3966397">addr</a></span><span class="op" id="3967151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967157">hostname</span>&nbsp;<span class="op" id="3967166">:=</span>&nbsp;<span class="ident" id="3967169"><a href="/crypto/tls/tls.go.html#3966397">addr</a></span><span class="op" id="3967173">[</span><span class="op" id="3967174">:</span><span class="ident" id="3967175"><a href="/crypto/tls/tls.go.html#3967068">colonPos</a></span><span class="op" id="3967183">]</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967187">if</span>&nbsp;<span class="ident" id="3967190"><a href="/crypto/tls/tls.go.html#3966410">config</a></span>&nbsp;<span class="op" id="3967197">==</span>&nbsp;<span class="ident" id="3967200">nil</span>&nbsp;<span class="op" id="3967204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967208"><a href="/crypto/tls/tls.go.html#3966410">config</a></span>&nbsp;<span class="op" id="3967215">=</span>&nbsp;<span class="ident" id="3967217"><a href="/crypto/tls/common.go.html#3841230">defaultConfig</a></span><span class="op" id="3967230">(</span><span class="op" id="3967231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3967237">//&nbsp;If&nbsp;no&nbsp;ServerName&nbsp;is&nbsp;set,&nbsp;infer&nbsp;the&nbsp;ServerName</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3967287">//&nbsp;from&nbsp;the&nbsp;hostname&nbsp;we&#39;re&nbsp;connecting&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967330">if</span>&nbsp;<span class="ident" id="3967333"><a href="/crypto/tls/tls.go.html#3966410">config</a></span><span class="op" id="3967339">.</span><span class="ident" id="3967340">ServerName</span>&nbsp;<span class="op" id="3967351">==</span>&nbsp;<span class="string" id="3967354">&#34;&#34;</span>&nbsp;<span class="op" id="3967357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3967361">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;to&nbsp;avoid&nbsp;polluting&nbsp;argument&nbsp;or&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967418">c</span>&nbsp;<span class="op" id="3967420">:=</span>&nbsp;<span class="op" id="3967423">*</span><span class="ident" id="3967424"><a href="/crypto/tls/tls.go.html#3966410">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967433"><a href="/crypto/tls/tls.go.html#3967418">c</a></span><span class="op" id="3967434">.</span><span class="ident" id="3967435">ServerName</span>&nbsp;<span class="op" id="3967446">=</span>&nbsp;<span class="ident" id="3967448"><a href="/crypto/tls/tls.go.html#3967157">hostname</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967459"><a href="/crypto/tls/tls.go.html#3966410">config</a></span>&nbsp;<span class="op" id="3967466">=</span>&nbsp;<span class="op" id="3967468">&amp;</span><span class="ident" id="3967469"><a href="/crypto/tls/tls.go.html#3967418">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967476">conn</span>&nbsp;<span class="op" id="3967481">:=</span>&nbsp;<span class="ident" id="3967484"><a href="/crypto/tls/tls.go.html#3964368">Client</a></span><span class="op" id="3967490">(</span><span class="ident" id="3967491"><a href="/crypto/tls/tls.go.html#3966985">rawConn</a></span><span class="op" id="3967498">,</span>&nbsp;<span class="ident" id="3967500"><a href="/crypto/tls/tls.go.html#3966410">config</a></span><span class="op" id="3967506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967510">if</span>&nbsp;<span class="ident" id="3967513"><a href="/crypto/tls/tls.go.html#3966628">timeout</a></span>&nbsp;<span class="op" id="3967521">==</span>&nbsp;<span class="num" id="3967524">0</span>&nbsp;<span class="op" id="3967526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967530"><a href="/crypto/tls/tls.go.html#3966994">err</a></span>&nbsp;<span class="op" id="3967534">=</span>&nbsp;<span class="ident" id="3967536"><a href="/crypto/tls/tls.go.html#3967476">conn</a></span><span class="op" id="3967540">.</span><span class="ident" id="3967541">Handshake</span><span class="op" id="3967550">(</span><span class="op" id="3967551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967554">}</span>&nbsp;<span class="keyword" id="3967556">else</span>&nbsp;<span class="op" id="3967561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967565">go</span>&nbsp;<span class="keyword" id="3967568">func</span><span class="op" id="3967572">(</span><span class="op" id="3967573">)</span>&nbsp;<span class="op" id="3967575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967580"><a href="/crypto/tls/tls.go.html#3966831">errChannel</a></span>&nbsp;<span class="op" id="3967591">&lt;-</span>&nbsp;<span class="ident" id="3967594"><a href="/crypto/tls/tls.go.html#3967476">conn</a></span><span class="op" id="3967598">.</span><span class="ident" id="3967599">Handshake</span><span class="op" id="3967608">(</span><span class="op" id="3967609">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967613">}</span><span class="op" id="3967614">(</span><span class="op" id="3967615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967620"><a href="/crypto/tls/tls.go.html#3966994">err</a></span>&nbsp;<span class="op" id="3967624">=</span>&nbsp;<span class="op" id="3967626">&lt;-</span><span class="ident" id="3967628"><a href="/crypto/tls/tls.go.html#3966831">errChannel</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967644">if</span>&nbsp;<span class="ident" id="3967647"><a href="/crypto/tls/tls.go.html#3966994">err</a></span>&nbsp;<span class="op" id="3967651">!=</span>&nbsp;<span class="ident" id="3967654">nil</span>&nbsp;<span class="op" id="3967658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3967662"><a href="/crypto/tls/tls.go.html#3966985">rawConn</a></span><span class="op" id="3967669">.</span><span class="ident" id="3967670">Close</span><span class="op" id="3967675">(</span><span class="op" id="3967676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967680">return</span>&nbsp;<span class="ident" id="3967687">nil</span><span class="op" id="3967690">,</span>&nbsp;<span class="ident" id="3967692"><a href="/crypto/tls/tls.go.html#3966994">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3967697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3967701">return</span>&nbsp;<span class="ident" id="3967708"><a href="/crypto/tls/tls.go.html#3967476">conn</a></span><span class="op" id="3967712">,</span>&nbsp;<span class="ident" id="3967714">nil</span><br>
<span class="lineno"></span><span class="op" id="3967718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3967721">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno"></span><span class="comment" id="3967782">//&nbsp;and&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting</span><br>
<span class="lineno">160</span><span class="comment" id="3967845">//&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3967864">//&nbsp;Dial&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3967920">//&nbsp;the&nbsp;zero&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config</span><br>
<span class="lineno"></span><span class="comment" id="3967979">//&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="3968000">func</span>&nbsp;<span class="ident" id="3968005">Dial</span><span class="op" id="3968009">(</span><span class="ident" id="3968010">network</span><span class="op" id="3968017">,</span>&nbsp;<span class="ident" id="3968019">addr</span>&nbsp;<span class="builtintype" id="3968024">string</span><span class="op" id="3968030">,</span>&nbsp;<span class="ident" id="3968032">config</span>&nbsp;<span class="op" id="3968039">*</span><span class="ident" id="3968040"><a href="/crypto/tls/common.go.html#3830813">Config</a></span><span class="op" id="3968046">)</span>&nbsp;<span class="op" id="3968048">(</span><span class="op" id="3968049">*</span><span class="ident" id="3968050"><a href="/crypto/tls/conn.go.html#3842235">Conn</a></span><span class="op" id="3968054">,</span>&nbsp;<span class="builtintype" id="3968056">error</span><span class="op" id="3968061">)</span>&nbsp;<span class="op" id="3968063">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968066">return</span>&nbsp;<span class="ident" id="3968073"><a href="/crypto/tls/tls.go.html#3966353">DialWithDialer</a></span><span class="op" id="3968087">(</span><span class="builtinfunc" id="3968088">new</span><span class="op" id="3968091">(</span><span class="ident" id="3968092"><a href="/crypto/tls/tls.go.html#3963862">net</a></span><span class="op" id="3968095">.</span><span class="ident" id="3968096">Dialer</span><span class="op" id="3968102">)</span><span class="op" id="3968103">,</span>&nbsp;<span class="ident" id="3968105"><a href="/crypto/tls/tls.go.html#3968010">network</a></span><span class="op" id="3968112">,</span>&nbsp;<span class="ident" id="3968114"><a href="/crypto/tls/tls.go.html#3968019">addr</a></span><span class="op" id="3968118">,</span>&nbsp;<span class="ident" id="3968120"><a href="/crypto/tls/tls.go.html#3968032">config</a></span><span class="op" id="3968126">)</span><br>
<span class="lineno"></span><span class="op" id="3968128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3968131">//&nbsp;LoadX509KeyPair&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3968208">//&nbsp;files.&nbsp;The&nbsp;files&nbsp;must&nbsp;contain&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">170</span><span class="keyword" id="3968259">func</span>&nbsp;<span class="ident" id="3968264">LoadX509KeyPair</span><span class="op" id="3968279">(</span><span class="ident" id="3968280">certFile</span><span class="op" id="3968288">,</span>&nbsp;<span class="ident" id="3968290">keyFile</span>&nbsp;<span class="builtintype" id="3968298">string</span><span class="op" id="3968304">)</span>&nbsp;<span class="op" id="3968306">(</span><span class="ident" id="3968307">cert</span>&nbsp;<span class="ident" id="3968312"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="3968323">,</span>&nbsp;<span class="ident" id="3968325">err</span>&nbsp;<span class="builtintype" id="3968329">error</span><span class="op" id="3968334">)</span>&nbsp;<span class="op" id="3968336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3968339">certPEMBlock</span><span class="op" id="3968351">,</span>&nbsp;<span class="ident" id="3968353"><a href="/crypto/tls/tls.go.html#3968325">err</a></span>&nbsp;<span class="op" id="3968357">:=</span>&nbsp;<span class="ident" id="3968360"><a href="/crypto/tls/tls.go.html#3963849">ioutil</a></span><span class="op" id="3968366">.</span><span class="ident" id="3968367">ReadFile</span><span class="op" id="3968375">(</span><span class="ident" id="3968376"><a href="/crypto/tls/tls.go.html#3968280">certFile</a></span><span class="op" id="3968384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968387">if</span>&nbsp;<span class="ident" id="3968390"><a href="/crypto/tls/tls.go.html#3968325">err</a></span>&nbsp;<span class="op" id="3968394">!=</span>&nbsp;<span class="ident" id="3968397">nil</span>&nbsp;<span class="op" id="3968401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968405">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3968413">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3968416">keyPEMBlock</span><span class="op" id="3968427">,</span>&nbsp;<span class="ident" id="3968429"><a href="/crypto/tls/tls.go.html#3968325">err</a></span>&nbsp;<span class="op" id="3968433">:=</span>&nbsp;<span class="ident" id="3968436"><a href="/crypto/tls/tls.go.html#3963849">ioutil</a></span><span class="op" id="3968442">.</span><span class="ident" id="3968443">ReadFile</span><span class="op" id="3968451">(</span><span class="ident" id="3968452"><a href="/crypto/tls/tls.go.html#3968290">keyFile</a></span><span class="op" id="3968459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968462">if</span>&nbsp;<span class="ident" id="3968465"><a href="/crypto/tls/tls.go.html#3968325">err</a></span>&nbsp;<span class="op" id="3968469">!=</span>&nbsp;<span class="ident" id="3968472">nil</span>&nbsp;<span class="op" id="3968476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968480">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3968488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968491">return</span>&nbsp;<span class="ident" id="3968498"><a href="/crypto/tls/tls.go.html#3968629">X509KeyPair</a></span><span class="op" id="3968509">(</span><span class="ident" id="3968510"><a href="/crypto/tls/tls.go.html#3968339">certPEMBlock</a></span><span class="op" id="3968522">,</span>&nbsp;<span class="ident" id="3968524"><a href="/crypto/tls/tls.go.html#3968416">keyPEMBlock</a></span><span class="op" id="3968535">)</span><br>
<span class="lineno">180</span><span class="op" id="3968537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3968540">//&nbsp;X509KeyPair&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3968603">//&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3968624">func</span>&nbsp;<span class="ident" id="3968629">X509KeyPair</span><span class="op" id="3968640">(</span><span class="ident" id="3968641">certPEMBlock</span><span class="op" id="3968653">,</span>&nbsp;<span class="ident" id="3968655">keyPEMBlock</span>&nbsp;<span class="op" id="3968667">[</span><span class="op" id="3968668">]</span><span class="builtintype" id="3968669">byte</span><span class="op" id="3968673">)</span>&nbsp;<span class="op" id="3968675">(</span><span class="ident" id="3968676">cert</span>&nbsp;<span class="ident" id="3968681"><a href="/crypto/tls/common.go.html#3838319">Certificate</a></span><span class="op" id="3968692">,</span>&nbsp;<span class="ident" id="3968694">err</span>&nbsp;<span class="builtintype" id="3968698">error</span><span class="op" id="3968703">)</span>&nbsp;<span class="op" id="3968705">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968708">var</span>&nbsp;<span class="ident" id="3968712">certDERBlock</span>&nbsp;<span class="op" id="3968725">*</span><span class="ident" id="3968726"><a href="/crypto/tls/tls.go.html#3963823">pem</a></span><span class="op" id="3968729">.</span><span class="ident" id="3968730">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968737">for</span>&nbsp;<span class="op" id="3968741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3968745"><a href="/crypto/tls/tls.go.html#3968712">certDERBlock</a></span><span class="op" id="3968757">,</span>&nbsp;<span class="ident" id="3968759"><a href="/crypto/tls/tls.go.html#3968641">certPEMBlock</a></span>&nbsp;<span class="op" id="3968772">=</span>&nbsp;<span class="ident" id="3968774"><a href="/crypto/tls/tls.go.html#3963823">pem</a></span><span class="op" id="3968777">.</span><span class="ident" id="3968778">Decode</span><span class="op" id="3968784">(</span><span class="ident" id="3968785"><a href="/crypto/tls/tls.go.html#3968641">certPEMBlock</a></span><span class="op" id="3968797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968801">if</span>&nbsp;<span class="ident" id="3968804"><a href="/crypto/tls/tls.go.html#3968712">certDERBlock</a></span>&nbsp;<span class="op" id="3968817">==</span>&nbsp;<span class="ident" id="3968820">nil</span>&nbsp;<span class="op" id="3968824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968829">break</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3968837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968841">if</span>&nbsp;<span class="ident" id="3968844"><a href="/crypto/tls/tls.go.html#3968712">certDERBlock</a></span><span class="op" id="3968856">.</span><span class="ident" id="3968857">Type</span>&nbsp;<span class="op" id="3968862">==</span>&nbsp;<span class="string" id="3968865">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="3968879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3968884"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3968888">.</span><span class="ident" id="3968889">Certificate</span>&nbsp;<span class="op" id="3968901">=</span>&nbsp;<span class="builtinfunc" id="3968903">append</span><span class="op" id="3968909">(</span><span class="ident" id="3968910"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3968914">.</span><span class="ident" id="3968915">Certificate</span><span class="op" id="3968926">,</span>&nbsp;<span class="ident" id="3968928"><a href="/crypto/tls/tls.go.html#3968712">certDERBlock</a></span><span class="op" id="3968940">.</span><span class="ident" id="3968941">Bytes</span><span class="op" id="3968946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3968950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3968953">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3968957">if</span>&nbsp;<span class="builtinfunc" id="3968960">len</span><span class="op" id="3968963">(</span><span class="ident" id="3968964"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3968968">.</span><span class="ident" id="3968969">Certificate</span><span class="op" id="3968980">)</span>&nbsp;<span class="op" id="3968982">==</span>&nbsp;<span class="num" id="3968985">0</span>&nbsp;<span class="op" id="3968987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3968991"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3968995">=</span>&nbsp;<span class="ident" id="3968997"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3969003">.</span><span class="ident" id="3969004">New</span><span class="op" id="3969007">(</span><span class="string" id="3969008">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="3969058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969070">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969074">var</span>&nbsp;<span class="ident" id="3969078">keyDERBlock</span>&nbsp;<span class="op" id="3969090">*</span><span class="ident" id="3969091"><a href="/crypto/tls/tls.go.html#3963823">pem</a></span><span class="op" id="3969094">.</span><span class="ident" id="3969095">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969102">for</span>&nbsp;<span class="op" id="3969106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969110"><a href="/crypto/tls/tls.go.html#3969078">keyDERBlock</a></span><span class="op" id="3969121">,</span>&nbsp;<span class="ident" id="3969123"><a href="/crypto/tls/tls.go.html#3968655">keyPEMBlock</a></span>&nbsp;<span class="op" id="3969135">=</span>&nbsp;<span class="ident" id="3969137"><a href="/crypto/tls/tls.go.html#3963823">pem</a></span><span class="op" id="3969140">.</span><span class="ident" id="3969141">Decode</span><span class="op" id="3969147">(</span><span class="ident" id="3969148"><a href="/crypto/tls/tls.go.html#3968655">keyPEMBlock</a></span><span class="op" id="3969159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969163">if</span>&nbsp;<span class="ident" id="3969166"><a href="/crypto/tls/tls.go.html#3969078">keyDERBlock</a></span>&nbsp;<span class="op" id="3969178">==</span>&nbsp;<span class="ident" id="3969181">nil</span>&nbsp;<span class="op" id="3969185">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969190"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969194">=</span>&nbsp;<span class="ident" id="3969196"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3969202">.</span><span class="ident" id="3969203">New</span><span class="op" id="3969206">(</span><span class="string" id="3969207">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;key&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="3969249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969254">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969267">if</span>&nbsp;<span class="ident" id="3969270"><a href="/crypto/tls/tls.go.html#3969078">keyDERBlock</a></span><span class="op" id="3969281">.</span><span class="ident" id="3969282">Type</span>&nbsp;<span class="op" id="3969287">==</span>&nbsp;<span class="string" id="3969290">&#34;PRIVATE&nbsp;KEY&#34;</span>&nbsp;<span class="op" id="3969304">||</span>&nbsp;<span class="ident" id="3969307"><a href="/crypto/tls/tls.go.html#3963869">strings</a></span><span class="op" id="3969314">.</span><span class="ident" id="3969315">HasSuffix</span><span class="op" id="3969324">(</span><span class="ident" id="3969325"><a href="/crypto/tls/tls.go.html#3969078">keyDERBlock</a></span><span class="op" id="3969336">.</span><span class="ident" id="3969337">Type</span><span class="op" id="3969341">,</span>&nbsp;<span class="string" id="3969343">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="3969357">)</span>&nbsp;<span class="op" id="3969359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969364">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969379"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3969383">.</span><span class="ident" id="3969384">PrivateKey</span><span class="op" id="3969394">,</span>&nbsp;<span class="ident" id="3969396"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969400">=</span>&nbsp;<span class="ident" id="3969402"><a href="/crypto/tls/tls.go.html#3970690">parsePrivateKey</a></span><span class="op" id="3969417">(</span><span class="ident" id="3969418"><a href="/crypto/tls/tls.go.html#3969078">keyDERBlock</a></span><span class="op" id="3969429">.</span><span class="ident" id="3969430">Bytes</span><span class="op" id="3969435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969438">if</span>&nbsp;<span class="ident" id="3969441"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969445">!=</span>&nbsp;<span class="ident" id="3969448">nil</span>&nbsp;<span class="op" id="3969452">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969456">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3969468">//&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;parse&nbsp;the&nbsp;public&nbsp;key&nbsp;for&nbsp;TLS,&nbsp;but&nbsp;we&nbsp;so&nbsp;do&nbsp;anyway</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3969539">//&nbsp;to&nbsp;check&nbsp;that&nbsp;it&nbsp;looks&nbsp;sane&nbsp;and&nbsp;matches&nbsp;the&nbsp;private&nbsp;key.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969600">x509Cert</span><span class="op" id="3969608">,</span>&nbsp;<span class="ident" id="3969610"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969614">:=</span>&nbsp;<span class="ident" id="3969617"><a href="/crypto/tls/tls.go.html#3963808">x509</a></span><span class="op" id="3969621">.</span><span class="ident" id="3969622">ParseCertificate</span><span class="op" id="3969638">(</span><span class="ident" id="3969639"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3969643">.</span><span class="ident" id="3969644">Certificate</span><span class="op" id="3969655">[</span><span class="num" id="3969656">0</span><span class="op" id="3969657">]</span><span class="op" id="3969658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969661">if</span>&nbsp;<span class="ident" id="3969664"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969668">!=</span>&nbsp;<span class="ident" id="3969671">nil</span>&nbsp;<span class="op" id="3969675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969679">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969691">switch</span>&nbsp;<span class="ident" id="3969698">pub</span>&nbsp;<span class="op" id="3969702">:=</span>&nbsp;<span class="ident" id="3969705"><a href="/crypto/tls/tls.go.html#3969600">x509Cert</a></span><span class="op" id="3969713">.</span><span class="ident" id="3969714">PublicKey</span><span class="op" id="3969723">.</span><span class="op" id="3969724">(</span><span class="keyword" id="3969725">type</span><span class="op" id="3969729">)</span>&nbsp;<span class="op" id="3969731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969734">case</span>&nbsp;<span class="op" id="3969739">*</span><span class="ident" id="3969740"><a href="/crypto/tls/tls.go.html#3963794">rsa</a></span><span class="op" id="3969743">.</span><span class="ident" id="3969744">PublicKey</span><span class="op" id="3969753">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969757">priv</span><span class="op" id="3969761">,</span>&nbsp;<span class="ident" id="3969763">ok</span>&nbsp;<span class="op" id="3969766">:=</span>&nbsp;<span class="ident" id="3969769"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3969773">.</span><span class="ident" id="3969774">PrivateKey</span><span class="op" id="3969784">.</span><span class="op" id="3969785">(</span><span class="op" id="3969786">*</span><span class="ident" id="3969787"><a href="/crypto/tls/tls.go.html#3963794">rsa</a></span><span class="op" id="3969790">.</span><span class="ident" id="3969791">PrivateKey</span><span class="op" id="3969801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969805">if</span>&nbsp;<span class="op" id="3969808">!</span><span class="ident" id="3969809"><a href="/crypto/tls/tls.go.html#3969763">ok</a></span>&nbsp;<span class="op" id="3969812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969817"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969821">=</span>&nbsp;<span class="ident" id="3969823"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3969829">.</span><span class="ident" id="3969830">New</span><span class="op" id="3969833">(</span><span class="string" id="3969834">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="3969895">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969900">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3969909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3969913">if</span>&nbsp;<span class="ident" id="3969916"><a href="/crypto/tls/tls.go.html#3969698">pub</a></span><span class="op" id="3969919">.</span><span class="ident" id="3969920">N</span><span class="op" id="3969921">.</span><span class="ident" id="3969922">Cmp</span><span class="op" id="3969925">(</span><span class="ident" id="3969926"><a href="/crypto/tls/tls.go.html#3969757">priv</a></span><span class="op" id="3969930">.</span><span class="ident" id="3969931">N</span><span class="op" id="3969932">)</span>&nbsp;<span class="op" id="3969934">!=</span>&nbsp;<span class="num" id="3969937">0</span>&nbsp;<span class="op" id="3969939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3969944"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3969948">=</span>&nbsp;<span class="ident" id="3969950"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3969956">.</span><span class="ident" id="3969957">New</span><span class="op" id="3969960">(</span><span class="string" id="3969961">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="3970012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970017">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3970026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970029">case</span>&nbsp;<span class="op" id="3970034">*</span><span class="ident" id="3970035"><a href="/crypto/tls/tls.go.html#3963778">ecdsa</a></span><span class="op" id="3970040">.</span><span class="ident" id="3970041">PublicKey</span><span class="op" id="3970050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3970054">priv</span><span class="op" id="3970058">,</span>&nbsp;<span class="ident" id="3970060">ok</span>&nbsp;<span class="op" id="3970063">:=</span>&nbsp;<span class="ident" id="3970066"><a href="/crypto/tls/tls.go.html#3968676">cert</a></span><span class="op" id="3970070">.</span><span class="ident" id="3970071">PrivateKey</span><span class="op" id="3970081">.</span><span class="op" id="3970082">(</span><span class="op" id="3970083">*</span><span class="ident" id="3970084"><a href="/crypto/tls/tls.go.html#3963778">ecdsa</a></span><span class="op" id="3970089">.</span><span class="ident" id="3970090">PrivateKey</span><span class="op" id="3970100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970104">if</span>&nbsp;<span class="op" id="3970107">!</span><span class="ident" id="3970108"><a href="/crypto/tls/tls.go.html#3970060">ok</a></span>&nbsp;<span class="op" id="3970111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3970116"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3970120">=</span>&nbsp;<span class="ident" id="3970122"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3970128">.</span><span class="ident" id="3970129">New</span><span class="op" id="3970132">(</span><span class="string" id="3970133">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="3970194">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970199">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3970209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970213">if</span>&nbsp;<span class="ident" id="3970216"><a href="/crypto/tls/tls.go.html#3969698">pub</a></span><span class="op" id="3970219">.</span><span class="ident" id="3970220">X</span><span class="op" id="3970221">.</span><span class="ident" id="3970222">Cmp</span><span class="op" id="3970225">(</span><span class="ident" id="3970226"><a href="/crypto/tls/tls.go.html#3970054">priv</a></span><span class="op" id="3970230">.</span><span class="ident" id="3970231">X</span><span class="op" id="3970232">)</span>&nbsp;<span class="op" id="3970234">!=</span>&nbsp;<span class="num" id="3970237">0</span>&nbsp;<span class="op" id="3970239">||</span>&nbsp;<span class="ident" id="3970242"><a href="/crypto/tls/tls.go.html#3969698">pub</a></span><span class="op" id="3970245">.</span><span class="ident" id="3970246">Y</span><span class="op" id="3970247">.</span><span class="ident" id="3970248">Cmp</span><span class="op" id="3970251">(</span><span class="ident" id="3970252"><a href="/crypto/tls/tls.go.html#3970054">priv</a></span><span class="op" id="3970256">.</span><span class="ident" id="3970257">Y</span><span class="op" id="3970258">)</span>&nbsp;<span class="op" id="3970260">!=</span>&nbsp;<span class="num" id="3970263">0</span>&nbsp;<span class="op" id="3970265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3970270"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3970274">=</span>&nbsp;<span class="ident" id="3970276"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3970282">.</span><span class="ident" id="3970283">New</span><span class="op" id="3970286">(</span><span class="string" id="3970287">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="3970338">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970343">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3970352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970355">default</span><span class="op" id="3970362">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3970366"><a href="/crypto/tls/tls.go.html#3968694">err</a></span>&nbsp;<span class="op" id="3970370">=</span>&nbsp;<span class="ident" id="3970372"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3970378">.</span><span class="ident" id="3970379">New</span><span class="op" id="3970382">(</span><span class="string" id="3970383">&#34;crypto/tls:&nbsp;unknown&nbsp;public&nbsp;key&nbsp;algorithm&#34;</span><span class="op" id="3970425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970429">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3970437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970441">return</span><br>
<span class="lineno"></span><span class="op" id="3970448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3970451">//&nbsp;Attempt&nbsp;to&nbsp;parse&nbsp;the&nbsp;given&nbsp;private&nbsp;key&nbsp;DER&nbsp;block.&nbsp;OpenSSL&nbsp;0.9.8&nbsp;generates</span><br>
<span class="lineno"></span><span class="comment" id="3970528">//&nbsp;PKCS#1&nbsp;private&nbsp;keys&nbsp;by&nbsp;default,&nbsp;while&nbsp;OpenSSL&nbsp;1.0.0&nbsp;generates&nbsp;PKCS#8&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="3970606">//&nbsp;OpenSSL&nbsp;ecparam&nbsp;generates&nbsp;SEC1&nbsp;EC&nbsp;private&nbsp;keys&nbsp;for&nbsp;ECDSA.&nbsp;We&nbsp;try&nbsp;all&nbsp;three.</span><br>
<span class="lineno"></span><span class="keyword" id="3970685">func</span>&nbsp;<span class="ident" id="3970690">parsePrivateKey</span><span class="op" id="3970705">(</span><span class="ident" id="3970706">der</span>&nbsp;<span class="op" id="3970710">[</span><span class="op" id="3970711">]</span><span class="builtintype" id="3970712">byte</span><span class="op" id="3970716">)</span>&nbsp;<span class="op" id="3970718">(</span><span class="ident" id="3970719"><a href="/crypto/tls/tls.go.html#3963768">crypto</a></span><span class="op" id="3970725">.</span><span class="ident" id="3970726">PrivateKey</span><span class="op" id="3970736">,</span>&nbsp;<span class="builtintype" id="3970738">error</span><span class="op" id="3970743">)</span>&nbsp;<span class="op" id="3970745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970748">if</span>&nbsp;<span class="ident" id="3970751">key</span><span class="op" id="3970754">,</span>&nbsp;<span class="ident" id="3970756">err</span>&nbsp;<span class="op" id="3970760">:=</span>&nbsp;<span class="ident" id="3970763"><a href="/crypto/tls/tls.go.html#3963808">x509</a></span><span class="op" id="3970767">.</span><span class="ident" id="3970768">ParsePKCS1PrivateKey</span><span class="op" id="3970788">(</span><span class="ident" id="3970789"><a href="/crypto/tls/tls.go.html#3970706">der</a></span><span class="op" id="3970792">)</span><span class="op" id="3970793">;</span>&nbsp;<span class="ident" id="3970795"><a href="/crypto/tls/tls.go.html#3970756">err</a></span>&nbsp;<span class="op" id="3970799">==</span>&nbsp;<span class="ident" id="3970802">nil</span>&nbsp;<span class="op" id="3970806">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970810">return</span>&nbsp;<span class="ident" id="3970817"><a href="/crypto/tls/tls.go.html#3970751">key</a></span><span class="op" id="3970820">,</span>&nbsp;<span class="ident" id="3970822">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3970827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970830">if</span>&nbsp;<span class="ident" id="3970833">key</span><span class="op" id="3970836">,</span>&nbsp;<span class="ident" id="3970838">err</span>&nbsp;<span class="op" id="3970842">:=</span>&nbsp;<span class="ident" id="3970845"><a href="/crypto/tls/tls.go.html#3963808">x509</a></span><span class="op" id="3970849">.</span><span class="ident" id="3970850">ParsePKCS8PrivateKey</span><span class="op" id="3970870">(</span><span class="ident" id="3970871"><a href="/crypto/tls/tls.go.html#3970706">der</a></span><span class="op" id="3970874">)</span><span class="op" id="3970875">;</span>&nbsp;<span class="ident" id="3970877"><a href="/crypto/tls/tls.go.html#3970838">err</a></span>&nbsp;<span class="op" id="3970881">==</span>&nbsp;<span class="ident" id="3970884">nil</span>&nbsp;<span class="op" id="3970888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970892">switch</span>&nbsp;<span class="ident" id="3970899">key</span>&nbsp;<span class="op" id="3970903">:=</span>&nbsp;<span class="ident" id="3970906"><a href="/crypto/tls/tls.go.html#3970833">key</a></span><span class="op" id="3970909">.</span><span class="op" id="3970910">(</span><span class="keyword" id="3970911">type</span><span class="op" id="3970915">)</span>&nbsp;<span class="op" id="3970917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970921">case</span>&nbsp;<span class="op" id="3970926">*</span><span class="ident" id="3970927"><a href="/crypto/tls/tls.go.html#3963794">rsa</a></span><span class="op" id="3970930">.</span><span class="ident" id="3970931">PrivateKey</span><span class="op" id="3970941">,</span>&nbsp;<span class="op" id="3970943">*</span><span class="ident" id="3970944"><a href="/crypto/tls/tls.go.html#3963778">ecdsa</a></span><span class="op" id="3970949">.</span><span class="ident" id="3970950">PrivateKey</span><span class="op" id="3970960">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970965">return</span>&nbsp;<span class="ident" id="3970972"><a href="/crypto/tls/tls.go.html#3970899">key</a></span><span class="op" id="3970975">,</span>&nbsp;<span class="ident" id="3970977">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970983">default</span><span class="op" id="3970990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3970995">return</span>&nbsp;<span class="ident" id="3971002">nil</span><span class="op" id="3971005">,</span>&nbsp;<span class="ident" id="3971007"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3971013">.</span><span class="ident" id="3971014">New</span><span class="op" id="3971017">(</span><span class="string" id="3971018">&#34;crypto/tls:&nbsp;found&nbsp;unknown&nbsp;private&nbsp;key&nbsp;type&nbsp;in&nbsp;PKCS#8&nbsp;wrapping&#34;</span><span class="op" id="3971081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3971085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3971088">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3971091">if</span>&nbsp;<span class="ident" id="3971094">key</span><span class="op" id="3971097">,</span>&nbsp;<span class="ident" id="3971099">err</span>&nbsp;<span class="op" id="3971103">:=</span>&nbsp;<span class="ident" id="3971106"><a href="/crypto/tls/tls.go.html#3963808">x509</a></span><span class="op" id="3971110">.</span><span class="ident" id="3971111">ParseECPrivateKey</span><span class="op" id="3971128">(</span><span class="ident" id="3971129"><a href="/crypto/tls/tls.go.html#3970706">der</a></span><span class="op" id="3971132">)</span><span class="op" id="3971133">;</span>&nbsp;<span class="ident" id="3971135"><a href="/crypto/tls/tls.go.html#3971099">err</a></span>&nbsp;<span class="op" id="3971139">==</span>&nbsp;<span class="ident" id="3971142">nil</span>&nbsp;<span class="op" id="3971146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3971150">return</span>&nbsp;<span class="ident" id="3971157"><a href="/crypto/tls/tls.go.html#3971094">key</a></span><span class="op" id="3971160">,</span>&nbsp;<span class="ident" id="3971162">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3971167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3971171">return</span>&nbsp;<span class="ident" id="3971178">nil</span><span class="op" id="3971181">,</span>&nbsp;<span class="ident" id="3971183"><a href="/crypto/tls/tls.go.html#3963839">errors</a></span><span class="op" id="3971189">.</span><span class="ident" id="3971190">New</span><span class="op" id="3971193">(</span><span class="string" id="3971194">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;private&nbsp;key&#34;</span><span class="op" id="3971235">)</span><br>
<span class="lineno">275</span><span class="op" id="3971237">}</span>
</div>
</body>
</html>
