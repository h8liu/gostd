<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2653171">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2653226">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2653280">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2653331">package</span>&nbsp;<span class="ident" id="2653339">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2653348">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2653425">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2653475">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2653543">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2653620">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2653655">type</span>&nbsp;<span class="ident" id="2653660">stringFinder</span>&nbsp;<span class="keyword" id="2653673">struct</span>&nbsp;<span class="op" id="2653680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653683">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2653748">pattern</span>&nbsp;<span class="builtintype" id="2653756">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653765">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653839">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653913">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653949">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2653953">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654025">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654098">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2654143">badCharSkip</span>&nbsp;<span class="op" id="2654155">[</span><span class="num" id="2654156">256</span><span class="op" id="2654159">]</span><span class="builtintype" id="2654160">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654166">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654242">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654314">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654356">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654360">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654432">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654506">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654576">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654649">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654714">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654749">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654753">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654828">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654896">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2654970">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655036">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655104">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655174">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655245">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655318">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655375">goodSuffixSkip</span>&nbsp;<span class="op" id="2655390">[</span><span class="op" id="2655391">]</span><span class="builtintype" id="2655392">int</span><br>
<span class="lineno"></span><span class="op" id="2655396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2655399">func</span>&nbsp;<span class="ident" id="2655404">makeStringFinder</span><span class="op" id="2655420">(</span><span class="ident" id="2655421">pattern</span>&nbsp;<span class="builtintype" id="2655429">string</span><span class="op" id="2655435">)</span>&nbsp;<span class="op" id="2655437">*</span><span class="ident" id="2655438">stringFinder</span>&nbsp;<span class="op" id="2655451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655454">f</span>&nbsp;<span class="op" id="2655456">:=</span>&nbsp;<span class="op" id="2655459">&amp;</span><span class="ident" id="2655460">stringFinder</span><span class="op" id="2655472">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655476">pattern</span><span class="op" id="2655483">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2655492">pattern</span><span class="op" id="2655499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655503">goodSuffixSkip</span><span class="op" id="2655517">:</span>&nbsp;<span class="builtinfunc" id="2655519">make</span><span class="op" id="2655523">(</span><span class="op" id="2655524">[</span><span class="op" id="2655525">]</span><span class="builtintype" id="2655526">int</span><span class="op" id="2655529">,</span>&nbsp;<span class="builtinfunc" id="2655531">len</span><span class="op" id="2655534">(</span><span class="ident" id="2655535">pattern</span><span class="op" id="2655542">)</span><span class="op" id="2655543">)</span><span class="op" id="2655544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2655547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655550">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655610">last</span>&nbsp;<span class="op" id="2655615">:=</span>&nbsp;<span class="builtinfunc" id="2655618">len</span><span class="op" id="2655621">(</span><span class="ident" id="2655622">pattern</span><span class="op" id="2655629">)</span>&nbsp;<span class="op" id="2655631">-</span>&nbsp;<span class="num" id="2655633">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655637">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655668">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2655728">for</span>&nbsp;<span class="ident" id="2655732">i</span>&nbsp;<span class="op" id="2655734">:=</span>&nbsp;<span class="keyword" id="2655737">range</span>&nbsp;<span class="ident" id="2655743">f</span><span class="op" id="2655744">.</span><span class="ident" id="2655745">badCharSkip</span>&nbsp;<span class="op" id="2655757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2655761">f</span><span class="op" id="2655762">.</span><span class="ident" id="2655763">badCharSkip</span><span class="op" id="2655774">[</span><span class="ident" id="2655775">i</span><span class="op" id="2655776">]</span>&nbsp;<span class="op" id="2655778">=</span>&nbsp;<span class="builtinfunc" id="2655780">len</span><span class="op" id="2655783">(</span><span class="ident" id="2655784">pattern</span><span class="op" id="2655791">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2655794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655797">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655870">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2655945">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2655986">for</span>&nbsp;<span class="ident" id="2655990">i</span>&nbsp;<span class="op" id="2655992">:=</span>&nbsp;<span class="num" id="2655995">0</span><span class="op" id="2655996">;</span>&nbsp;<span class="ident" id="2655998">i</span>&nbsp;<span class="op" id="2656000">&lt;</span>&nbsp;<span class="ident" id="2656002">last</span><span class="op" id="2656006">;</span>&nbsp;<span class="ident" id="2656008">i</span><span class="op" id="2656009">++</span>&nbsp;<span class="op" id="2656012">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656016">f</span><span class="op" id="2656017">.</span><span class="ident" id="2656018">badCharSkip</span><span class="op" id="2656029">[</span><span class="ident" id="2656030">pattern</span><span class="op" id="2656037">[</span><span class="ident" id="2656038">i</span><span class="op" id="2656039">]</span><span class="op" id="2656040">]</span>&nbsp;<span class="op" id="2656042">=</span>&nbsp;<span class="ident" id="2656044">last</span>&nbsp;<span class="op" id="2656049">-</span>&nbsp;<span class="ident" id="2656051">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656058">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656087">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656161">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656174">lastPrefix</span>&nbsp;<span class="op" id="2656185">:=</span>&nbsp;<span class="ident" id="2656188">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656194">for</span>&nbsp;<span class="ident" id="2656198">i</span>&nbsp;<span class="op" id="2656200">:=</span>&nbsp;<span class="ident" id="2656203">last</span><span class="op" id="2656207">;</span>&nbsp;<span class="ident" id="2656209">i</span>&nbsp;<span class="op" id="2656211">&gt;=</span>&nbsp;<span class="num" id="2656214">0</span><span class="op" id="2656215">;</span>&nbsp;<span class="ident" id="2656217">i</span><span class="op" id="2656218">--</span>&nbsp;<span class="op" id="2656221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656225">if</span>&nbsp;<span class="ident" id="2656228">HasPrefix</span><span class="op" id="2656237">(</span><span class="ident" id="2656238">pattern</span><span class="op" id="2656245">,</span>&nbsp;<span class="ident" id="2656247">pattern</span><span class="op" id="2656254">[</span><span class="ident" id="2656255">i</span><span class="op" id="2656256">+</span><span class="num" id="2656257">1</span><span class="op" id="2656258">:</span><span class="op" id="2656259">]</span><span class="op" id="2656260">)</span>&nbsp;<span class="op" id="2656262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656267">lastPrefix</span>&nbsp;<span class="op" id="2656278">=</span>&nbsp;<span class="ident" id="2656280">i</span>&nbsp;<span class="op" id="2656282">+</span>&nbsp;<span class="num" id="2656284">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656292">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656351">f</span><span class="op" id="2656352">.</span><span class="ident" id="2656353">goodSuffixSkip</span><span class="op" id="2656367">[</span><span class="ident" id="2656368">i</span><span class="op" id="2656369">]</span>&nbsp;<span class="op" id="2656371">=</span>&nbsp;<span class="ident" id="2656373">lastPrefix</span>&nbsp;<span class="op" id="2656384">+</span>&nbsp;<span class="ident" id="2656386">last</span>&nbsp;<span class="op" id="2656391">-</span>&nbsp;<span class="ident" id="2656393">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656399">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656474">for</span>&nbsp;<span class="ident" id="2656478">i</span>&nbsp;<span class="op" id="2656480">:=</span>&nbsp;<span class="num" id="2656483">0</span><span class="op" id="2656484">;</span>&nbsp;<span class="ident" id="2656486">i</span>&nbsp;<span class="op" id="2656488">&lt;</span>&nbsp;<span class="ident" id="2656490">last</span><span class="op" id="2656494">;</span>&nbsp;<span class="ident" id="2656496">i</span><span class="op" id="2656497">++</span>&nbsp;<span class="op" id="2656500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656504">lenSuffix</span>&nbsp;<span class="op" id="2656514">:=</span>&nbsp;<span class="ident" id="2656517">longestCommonSuffix</span><span class="op" id="2656536">(</span><span class="ident" id="2656537">pattern</span><span class="op" id="2656544">,</span>&nbsp;<span class="ident" id="2656546">pattern</span><span class="op" id="2656553">[</span><span class="num" id="2656554">1</span><span class="op" id="2656555">:</span><span class="ident" id="2656556">i</span><span class="op" id="2656557">+</span><span class="num" id="2656558">1</span><span class="op" id="2656559">]</span><span class="op" id="2656560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656564">if</span>&nbsp;<span class="ident" id="2656567">pattern</span><span class="op" id="2656574">[</span><span class="ident" id="2656575">i</span><span class="op" id="2656576">-</span><span class="ident" id="2656577">lenSuffix</span><span class="op" id="2656586">]</span>&nbsp;<span class="op" id="2656588">!=</span>&nbsp;<span class="ident" id="2656591">pattern</span><span class="op" id="2656598">[</span><span class="ident" id="2656599">last</span><span class="op" id="2656603">-</span><span class="ident" id="2656604">lenSuffix</span><span class="op" id="2656613">]</span>&nbsp;<span class="op" id="2656615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2656620">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2656679">f</span><span class="op" id="2656680">.</span><span class="ident" id="2656681">goodSuffixSkip</span><span class="op" id="2656695">[</span><span class="ident" id="2656696">last</span><span class="op" id="2656700">-</span><span class="ident" id="2656701">lenSuffix</span><span class="op" id="2656710">]</span>&nbsp;<span class="op" id="2656712">=</span>&nbsp;<span class="ident" id="2656714">lenSuffix</span>&nbsp;<span class="op" id="2656724">+</span>&nbsp;<span class="ident" id="2656726">last</span>&nbsp;<span class="op" id="2656731">-</span>&nbsp;<span class="ident" id="2656733">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656744">return</span>&nbsp;<span class="ident" id="2656751">f</span><br>
<span class="lineno"></span><span class="op" id="2656753">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2656756">func</span>&nbsp;<span class="ident" id="2656761">longestCommonSuffix</span><span class="op" id="2656780">(</span><span class="ident" id="2656781">a</span><span class="op" id="2656782">,</span>&nbsp;<span class="ident" id="2656784">b</span>&nbsp;<span class="builtintype" id="2656786">string</span><span class="op" id="2656792">)</span>&nbsp;<span class="op" id="2656794">(</span><span class="ident" id="2656795">i</span>&nbsp;<span class="builtintype" id="2656797">int</span><span class="op" id="2656800">)</span>&nbsp;<span class="op" id="2656802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656805">for</span>&nbsp;<span class="op" id="2656809">;</span>&nbsp;<span class="ident" id="2656811">i</span>&nbsp;<span class="op" id="2656813">&lt;</span>&nbsp;<span class="builtinfunc" id="2656815">len</span><span class="op" id="2656818">(</span><span class="ident" id="2656819">a</span><span class="op" id="2656820">)</span>&nbsp;<span class="op" id="2656822">&amp;&amp;</span>&nbsp;<span class="ident" id="2656825">i</span>&nbsp;<span class="op" id="2656827">&lt;</span>&nbsp;<span class="builtinfunc" id="2656829">len</span><span class="op" id="2656832">(</span><span class="ident" id="2656833">b</span><span class="op" id="2656834">)</span><span class="op" id="2656835">;</span>&nbsp;<span class="ident" id="2656837">i</span><span class="op" id="2656838">++</span>&nbsp;<span class="op" id="2656841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656845">if</span>&nbsp;<span class="ident" id="2656848">a</span><span class="op" id="2656849">[</span><span class="builtinfunc" id="2656850">len</span><span class="op" id="2656853">(</span><span class="ident" id="2656854">a</span><span class="op" id="2656855">)</span><span class="op" id="2656856">-</span><span class="num" id="2656857">1</span><span class="op" id="2656858">-</span><span class="ident" id="2656859">i</span><span class="op" id="2656860">]</span>&nbsp;<span class="op" id="2656862">!=</span>&nbsp;<span class="ident" id="2656865">b</span><span class="op" id="2656866">[</span><span class="builtinfunc" id="2656867">len</span><span class="op" id="2656870">(</span><span class="ident" id="2656871">b</span><span class="op" id="2656872">)</span><span class="op" id="2656873">-</span><span class="num" id="2656874">1</span><span class="op" id="2656875">-</span><span class="ident" id="2656876">i</span><span class="op" id="2656877">]</span>&nbsp;<span class="op" id="2656879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656884">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2656895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2656898">return</span><br>
<span class="lineno"></span><span class="op" id="2656905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2656908">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2656985">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2657029">func</span>&nbsp;<span class="op" id="2657034">(</span><span class="ident" id="2657035">f</span>&nbsp;<span class="op" id="2657037">*</span><span class="ident" id="2657038">stringFinder</span><span class="op" id="2657050">)</span>&nbsp;<span class="ident" id="2657052">next</span><span class="op" id="2657056">(</span><span class="ident" id="2657057">text</span>&nbsp;<span class="builtintype" id="2657062">string</span><span class="op" id="2657068">)</span>&nbsp;<span class="builtintype" id="2657070">int</span>&nbsp;<span class="op" id="2657074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2657077">i</span>&nbsp;<span class="op" id="2657079">:=</span>&nbsp;<span class="builtinfunc" id="2657082">len</span><span class="op" id="2657085">(</span><span class="ident" id="2657086">f</span><span class="op" id="2657087">.</span><span class="ident" id="2657088">pattern</span><span class="op" id="2657095">)</span>&nbsp;<span class="op" id="2657097">-</span>&nbsp;<span class="num" id="2657099">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657102">for</span>&nbsp;<span class="ident" id="2657106">i</span>&nbsp;<span class="op" id="2657108">&lt;</span>&nbsp;<span class="builtinfunc" id="2657110">len</span><span class="op" id="2657113">(</span><span class="ident" id="2657114">text</span><span class="op" id="2657118">)</span>&nbsp;<span class="op" id="2657120">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2657124">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2657198">j</span>&nbsp;<span class="op" id="2657200">:=</span>&nbsp;<span class="builtinfunc" id="2657203">len</span><span class="op" id="2657206">(</span><span class="ident" id="2657207">f</span><span class="op" id="2657208">.</span><span class="ident" id="2657209">pattern</span><span class="op" id="2657216">)</span>&nbsp;<span class="op" id="2657218">-</span>&nbsp;<span class="num" id="2657220">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657224">for</span>&nbsp;<span class="ident" id="2657228">j</span>&nbsp;<span class="op" id="2657230">&gt;=</span>&nbsp;<span class="num" id="2657233">0</span>&nbsp;<span class="op" id="2657235">&amp;&amp;</span>&nbsp;<span class="ident" id="2657238">text</span><span class="op" id="2657242">[</span><span class="ident" id="2657243">i</span><span class="op" id="2657244">]</span>&nbsp;<span class="op" id="2657246">==</span>&nbsp;<span class="ident" id="2657249">f</span><span class="op" id="2657250">.</span><span class="ident" id="2657251">pattern</span><span class="op" id="2657258">[</span><span class="ident" id="2657259">j</span><span class="op" id="2657260">]</span>&nbsp;<span class="op" id="2657262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2657267">i</span><span class="op" id="2657268">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2657274">j</span><span class="op" id="2657275">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2657280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657284">if</span>&nbsp;<span class="ident" id="2657287">j</span>&nbsp;<span class="op" id="2657289">&lt;</span>&nbsp;<span class="num" id="2657291">0</span>&nbsp;<span class="op" id="2657293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657298">return</span>&nbsp;<span class="ident" id="2657305">i</span>&nbsp;<span class="op" id="2657307">+</span>&nbsp;<span class="num" id="2657309">1</span>&nbsp;<span class="comment" id="2657311">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2657322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2657326">i</span>&nbsp;<span class="op" id="2657328">+=</span>&nbsp;<span class="ident" id="2657331">max</span><span class="op" id="2657334">(</span><span class="ident" id="2657335">f</span><span class="op" id="2657336">.</span><span class="ident" id="2657337">badCharSkip</span><span class="op" id="2657348">[</span><span class="ident" id="2657349">text</span><span class="op" id="2657353">[</span><span class="ident" id="2657354">i</span><span class="op" id="2657355">]</span><span class="op" id="2657356">]</span><span class="op" id="2657357">,</span>&nbsp;<span class="ident" id="2657359">f</span><span class="op" id="2657360">.</span><span class="ident" id="2657361">goodSuffixSkip</span><span class="op" id="2657375">[</span><span class="ident" id="2657376">j</span><span class="op" id="2657377">]</span><span class="op" id="2657378">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2657381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657384">return</span>&nbsp;<span class="op" id="2657391">-</span><span class="num" id="2657392">1</span><br>
<span class="lineno"></span><span class="op" id="2657394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2657397">func</span>&nbsp;<span class="ident" id="2657402">max</span><span class="op" id="2657405">(</span><span class="ident" id="2657406">a</span><span class="op" id="2657407">,</span>&nbsp;<span class="ident" id="2657409">b</span>&nbsp;<span class="builtintype" id="2657411">int</span><span class="op" id="2657414">)</span>&nbsp;<span class="builtintype" id="2657416">int</span>&nbsp;<span class="op" id="2657420">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657423">if</span>&nbsp;<span class="ident" id="2657426">a</span>&nbsp;<span class="op" id="2657428">&gt;</span>&nbsp;<span class="ident" id="2657430">b</span>&nbsp;<span class="op" id="2657432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657436">return</span>&nbsp;<span class="ident" id="2657443">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2657446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2657449">return</span>&nbsp;<span class="ident" id="2657456">b</span><br>
<span class="lineno"></span><span class="op" id="2657458">}</span>
</div>
</body>
</html>
