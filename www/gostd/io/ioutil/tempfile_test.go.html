<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io/ioutil</h2>
<ul>
<li><a href="/gostd/io/ioutil/ioutil.go.html">ioutil.go</a></li>
<li><a href="/gostd/io/ioutil/ioutil_test.go.html">ioutil_test.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile.go.html">tempfile.go</a></li>
<li><a href="/gostd/io/ioutil/tempfile_test.go.html" class="current">tempfile_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8299617">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8299672">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8299726">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8299777">package</span>&nbsp;<span class="ident" id="8299785">ioutil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299793">import</span>&nbsp;<span class="op" id="8299800">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299803">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299809">&#34;path/filepath&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299826">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8299836">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8299846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8299849">func</span>&nbsp;<span class="ident" id="8299854">TestTempFile</span><span class="op" id="8299866">(</span><span class="ident" id="8299867">t</span>&nbsp;<span class="op" id="8299869">*</span><span class="ident" id="8299870">testing</span><span class="op" id="8299877">.</span><span class="ident" id="8299878">T</span><span class="op" id="8299879">)</span>&nbsp;<span class="op" id="8299881">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299884">f</span><span class="op" id="8299885">,</span>&nbsp;<span class="ident" id="8299887">err</span>&nbsp;<span class="op" id="8299891">:=</span>&nbsp;<span class="ident" id="8299894">TempFile</span><span class="op" id="8299902">(</span><span class="string" id="8299903">&#34;/_not_exists_&#34;</span><span class="op" id="8299918">,</span>&nbsp;<span class="string" id="8299920">&#34;foo&#34;</span><span class="op" id="8299925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8299928">if</span>&nbsp;<span class="ident" id="8299931">f</span>&nbsp;<span class="op" id="8299933">!=</span>&nbsp;<span class="ident" id="8299936">nil</span>&nbsp;<span class="op" id="8299940">||</span>&nbsp;<span class="ident" id="8299943">err</span>&nbsp;<span class="op" id="8299947">==</span>&nbsp;<span class="ident" id="8299950">nil</span>&nbsp;<span class="op" id="8299954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8299958">t</span><span class="op" id="8299959">.</span><span class="ident" id="8299960">Errorf</span><span class="op" id="8299966">(</span><span class="string" id="8299967">&#34;TempFile(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8300010">,</span>&nbsp;<span class="ident" id="8300012">f</span><span class="op" id="8300013">,</span>&nbsp;<span class="ident" id="8300015">err</span><span class="op" id="8300018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300025">dir</span>&nbsp;<span class="op" id="8300029">:=</span>&nbsp;<span class="ident" id="8300032">os</span><span class="op" id="8300034">.</span><span class="ident" id="8300035">TempDir</span><span class="op" id="8300042">(</span><span class="op" id="8300043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300046">f</span><span class="op" id="8300047">,</span>&nbsp;<span class="ident" id="8300049">err</span>&nbsp;<span class="op" id="8300053">=</span>&nbsp;<span class="ident" id="8300055">TempFile</span><span class="op" id="8300063">(</span><span class="ident" id="8300064">dir</span><span class="op" id="8300067">,</span>&nbsp;<span class="string" id="8300069">&#34;ioutil_test&#34;</span><span class="op" id="8300082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300085">if</span>&nbsp;<span class="ident" id="8300088">f</span>&nbsp;<span class="op" id="8300090">==</span>&nbsp;<span class="ident" id="8300093">nil</span>&nbsp;<span class="op" id="8300097">||</span>&nbsp;<span class="ident" id="8300100">err</span>&nbsp;<span class="op" id="8300104">!=</span>&nbsp;<span class="ident" id="8300107">nil</span>&nbsp;<span class="op" id="8300111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300115">t</span><span class="op" id="8300116">.</span><span class="ident" id="8300117">Errorf</span><span class="op" id="8300123">(</span><span class="string" id="8300124">&#34;TempFile(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8300163">,</span>&nbsp;<span class="ident" id="8300165">f</span><span class="op" id="8300166">,</span>&nbsp;<span class="ident" id="8300168">err</span><span class="op" id="8300171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300174">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300177">if</span>&nbsp;<span class="ident" id="8300180">f</span>&nbsp;<span class="op" id="8300182">!=</span>&nbsp;<span class="ident" id="8300185">nil</span>&nbsp;<span class="op" id="8300189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300193">f</span><span class="op" id="8300194">.</span><span class="ident" id="8300195">Close</span><span class="op" id="8300200">(</span><span class="op" id="8300201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300205">os</span><span class="op" id="8300207">.</span><span class="ident" id="8300208">Remove</span><span class="op" id="8300214">(</span><span class="ident" id="8300215">f</span><span class="op" id="8300216">.</span><span class="ident" id="8300217">Name</span><span class="op" id="8300221">(</span><span class="op" id="8300222">)</span><span class="op" id="8300223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300227">re</span>&nbsp;<span class="op" id="8300230">:=</span>&nbsp;<span class="ident" id="8300233">regexp</span><span class="op" id="8300239">.</span><span class="ident" id="8300240">MustCompile</span><span class="op" id="8300251">(</span><span class="string" id="8300252">&#34;^&#34;</span>&nbsp;<span class="op" id="8300256">+</span>&nbsp;<span class="ident" id="8300258">regexp</span><span class="op" id="8300264">.</span><span class="ident" id="8300265">QuoteMeta</span><span class="op" id="8300274">(</span><span class="ident" id="8300275">filepath</span><span class="op" id="8300283">.</span><span class="ident" id="8300284">Join</span><span class="op" id="8300288">(</span><span class="ident" id="8300289">dir</span><span class="op" id="8300292">,</span>&nbsp;<span class="string" id="8300294">&#34;ioutil_test&#34;</span><span class="op" id="8300307">)</span><span class="op" id="8300308">)</span>&nbsp;<span class="op" id="8300310">+</span>&nbsp;<span class="string" id="8300312">&#34;[0-9]+$&#34;</span><span class="op" id="8300321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300325">if</span>&nbsp;<span class="op" id="8300328">!</span><span class="ident" id="8300329">re</span><span class="op" id="8300331">.</span><span class="ident" id="8300332">MatchString</span><span class="op" id="8300343">(</span><span class="ident" id="8300344">f</span><span class="op" id="8300345">.</span><span class="ident" id="8300346">Name</span><span class="op" id="8300350">(</span><span class="op" id="8300351">)</span><span class="op" id="8300352">)</span>&nbsp;<span class="op" id="8300354">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300359">t</span><span class="op" id="8300360">.</span><span class="ident" id="8300361">Errorf</span><span class="op" id="8300367">(</span><span class="string" id="8300368">&#34;TempFile(`&#34;</span><span class="op" id="8300380">+</span><span class="ident" id="8300381">dir</span><span class="op" id="8300384">+</span><span class="string" id="8300385">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="8300424">,</span>&nbsp;<span class="ident" id="8300426">f</span><span class="op" id="8300427">.</span><span class="ident" id="8300428">Name</span><span class="op" id="8300432">(</span><span class="op" id="8300433">)</span><span class="op" id="8300434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300441">}</span><br>
<span class="lineno"></span><span class="op" id="8300443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="8300446">func</span>&nbsp;<span class="ident" id="8300451">TestTempDir</span><span class="op" id="8300462">(</span><span class="ident" id="8300463">t</span>&nbsp;<span class="op" id="8300465">*</span><span class="ident" id="8300466">testing</span><span class="op" id="8300473">.</span><span class="ident" id="8300474">T</span><span class="op" id="8300475">)</span>&nbsp;<span class="op" id="8300477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300480">name</span><span class="op" id="8300484">,</span>&nbsp;<span class="ident" id="8300486">err</span>&nbsp;<span class="op" id="8300490">:=</span>&nbsp;<span class="ident" id="8300493">TempDir</span><span class="op" id="8300500">(</span><span class="string" id="8300501">&#34;/_not_exists_&#34;</span><span class="op" id="8300516">,</span>&nbsp;<span class="string" id="8300518">&#34;foo&#34;</span><span class="op" id="8300523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300526">if</span>&nbsp;<span class="ident" id="8300529">name</span>&nbsp;<span class="op" id="8300534">!=</span>&nbsp;<span class="string" id="8300537">&#34;&#34;</span>&nbsp;<span class="op" id="8300540">||</span>&nbsp;<span class="ident" id="8300543">err</span>&nbsp;<span class="op" id="8300547">==</span>&nbsp;<span class="ident" id="8300550">nil</span>&nbsp;<span class="op" id="8300554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300558">t</span><span class="op" id="8300559">.</span><span class="ident" id="8300560">Errorf</span><span class="op" id="8300566">(</span><span class="string" id="8300567">&#34;TempDir(`/_not_exists_`,&nbsp;`foo`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8300609">,</span>&nbsp;<span class="ident" id="8300611">name</span><span class="op" id="8300615">,</span>&nbsp;<span class="ident" id="8300617">err</span><span class="op" id="8300620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300623">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300627">dir</span>&nbsp;<span class="op" id="8300631">:=</span>&nbsp;<span class="ident" id="8300634">os</span><span class="op" id="8300636">.</span><span class="ident" id="8300637">TempDir</span><span class="op" id="8300644">(</span><span class="op" id="8300645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300648">name</span><span class="op" id="8300652">,</span>&nbsp;<span class="ident" id="8300654">err</span>&nbsp;<span class="op" id="8300658">=</span>&nbsp;<span class="ident" id="8300660">TempDir</span><span class="op" id="8300667">(</span><span class="ident" id="8300668">dir</span><span class="op" id="8300671">,</span>&nbsp;<span class="string" id="8300673">&#34;ioutil_test&#34;</span><span class="op" id="8300686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300689">if</span>&nbsp;<span class="ident" id="8300692">name</span>&nbsp;<span class="op" id="8300697">==</span>&nbsp;<span class="string" id="8300700">&#34;&#34;</span>&nbsp;<span class="op" id="8300703">||</span>&nbsp;<span class="ident" id="8300706">err</span>&nbsp;<span class="op" id="8300710">!=</span>&nbsp;<span class="ident" id="8300713">nil</span>&nbsp;<span class="op" id="8300717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300721">t</span><span class="op" id="8300722">.</span><span class="ident" id="8300723">Errorf</span><span class="op" id="8300729">(</span><span class="string" id="8300730">&#34;TempDir(dir,&nbsp;`ioutil_test`)&nbsp;=&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8300768">,</span>&nbsp;<span class="ident" id="8300770">name</span><span class="op" id="8300774">,</span>&nbsp;<span class="ident" id="8300776">err</span><span class="op" id="8300779">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8300782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300785">if</span>&nbsp;<span class="ident" id="8300788">name</span>&nbsp;<span class="op" id="8300793">!=</span>&nbsp;<span class="string" id="8300796">&#34;&#34;</span>&nbsp;<span class="op" id="8300799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300803">os</span><span class="op" id="8300805">.</span><span class="ident" id="8300806">Remove</span><span class="op" id="8300812">(</span><span class="ident" id="8300813">name</span><span class="op" id="8300817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300821">re</span>&nbsp;<span class="op" id="8300824">:=</span>&nbsp;<span class="ident" id="8300827">regexp</span><span class="op" id="8300833">.</span><span class="ident" id="8300834">MustCompile</span><span class="op" id="8300845">(</span><span class="string" id="8300846">&#34;^&#34;</span>&nbsp;<span class="op" id="8300850">+</span>&nbsp;<span class="ident" id="8300852">regexp</span><span class="op" id="8300858">.</span><span class="ident" id="8300859">QuoteMeta</span><span class="op" id="8300868">(</span><span class="ident" id="8300869">filepath</span><span class="op" id="8300877">.</span><span class="ident" id="8300878">Join</span><span class="op" id="8300882">(</span><span class="ident" id="8300883">dir</span><span class="op" id="8300886">,</span>&nbsp;<span class="string" id="8300888">&#34;ioutil_test&#34;</span><span class="op" id="8300901">)</span><span class="op" id="8300902">)</span>&nbsp;<span class="op" id="8300904">+</span>&nbsp;<span class="string" id="8300906">&#34;[0-9]+$&#34;</span><span class="op" id="8300915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8300919">if</span>&nbsp;<span class="op" id="8300922">!</span><span class="ident" id="8300923">re</span><span class="op" id="8300925">.</span><span class="ident" id="8300926">MatchString</span><span class="op" id="8300937">(</span><span class="ident" id="8300938">name</span><span class="op" id="8300942">)</span>&nbsp;<span class="op" id="8300944">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8300949">t</span><span class="op" id="8300950">.</span><span class="ident" id="8300951">Errorf</span><span class="op" id="8300957">(</span><span class="string" id="8300958">&#34;TempDir(`&#34;</span><span class="op" id="8300969">+</span><span class="ident" id="8300970">dir</span><span class="op" id="8300973">+</span><span class="string" id="8300974">&#34;`,&nbsp;`ioutil_test`)&nbsp;created&nbsp;bad&nbsp;name&nbsp;%s&#34;</span><span class="op" id="8301013">,</span>&nbsp;<span class="ident" id="8301015">name</span><span class="op" id="8301019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8301026">}</span><br>
<span class="lineno"></span><span class="op" id="8301028">}</span>
</div>
</body>
</html>
