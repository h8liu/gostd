<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html" class="current">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7984681">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7984736">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7984790">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7984841">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7984906">package</span>&nbsp;<span class="ident" id="7984914">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7984919">import</span>&nbsp;<span class="op" id="7984926">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984929">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984935">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984948">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984954">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984962">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984973">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7984984">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7984991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7984994">var</span>&nbsp;<span class="ident" id="7984998">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7985024">=</span>&nbsp;<span class="op" id="7985026">[</span><span class="op" id="7985027">]</span><span class="keyword" id="7985028">struct</span>&nbsp;<span class="op" id="7985035">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985038">server</span>&nbsp;&nbsp;<span class="builtintype" id="7985046">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985054">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7985062">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985070">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7985078">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985086">timeout</span>&nbsp;<span class="builtintype" id="7985094">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985099">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7985107">int</span><br>
<span class="lineno">25</span><span class="op" id="7985111">}</span><span class="op" id="7985112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7985115">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7985174">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985214">{</span><span class="string" id="7985215">&#34;8.8.8.8:53&#34;</span><span class="op" id="7985227">,</span>&nbsp;<span class="string" id="7985229">&#34;com.&#34;</span><span class="op" id="7985235">,</span>&nbsp;<span class="ident" id="7985237">dnsTypeALL</span><span class="op" id="7985247">,</span>&nbsp;<span class="num" id="7985249">2</span><span class="op" id="7985250">,</span>&nbsp;<span class="ident" id="7985252">dnsRcodeSuccess</span><span class="op" id="7985267">}</span><span class="op" id="7985268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985271">{</span><span class="string" id="7985272">&#34;8.8.4.4:53&#34;</span><span class="op" id="7985284">,</span>&nbsp;<span class="string" id="7985286">&#34;com.&#34;</span><span class="op" id="7985292">,</span>&nbsp;<span class="ident" id="7985294">dnsTypeALL</span><span class="op" id="7985304">,</span>&nbsp;<span class="num" id="7985306">4</span><span class="op" id="7985307">,</span>&nbsp;<span class="ident" id="7985309">dnsRcodeSuccess</span><span class="op" id="7985324">}</span><span class="op" id="7985325">,</span><br>
<span class="lineno">30</span><span class="op" id="7985327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7985330">func</span>&nbsp;<span class="ident" id="7985335">TestDNSTransportFallback</span><span class="op" id="7985359">(</span><span class="ident" id="7985360">t</span>&nbsp;<span class="op" id="7985362">*</span><span class="ident" id="7985363">testing</span><span class="op" id="7985370">.</span><span class="ident" id="7985371">T</span><span class="op" id="7985372">)</span>&nbsp;<span class="op" id="7985374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985377">if</span>&nbsp;<span class="ident" id="7985380">testing</span><span class="op" id="7985387">.</span><span class="ident" id="7985388">Short</span><span class="op" id="7985393">(</span><span class="op" id="7985394">)</span>&nbsp;<span class="op" id="7985396">||</span>&nbsp;<span class="op" id="7985399">!</span><span class="op" id="7985400">*</span><span class="ident" id="7985401">testExternal</span>&nbsp;<span class="op" id="7985414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985418">t</span><span class="op" id="7985419">.</span><span class="ident" id="7985420">Skip</span><span class="op" id="7985424">(</span><span class="string" id="7985425">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7985466">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985473">for</span>&nbsp;<span class="ident" id="7985477">_</span><span class="op" id="7985478">,</span>&nbsp;<span class="ident" id="7985480">tt</span>&nbsp;<span class="op" id="7985483">:=</span>&nbsp;<span class="keyword" id="7985486">range</span>&nbsp;<span class="ident" id="7985492">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7985518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985522">timeout</span>&nbsp;<span class="op" id="7985530">:=</span>&nbsp;<span class="ident" id="7985533">time</span><span class="op" id="7985537">.</span><span class="ident" id="7985538">Duration</span><span class="op" id="7985546">(</span><span class="ident" id="7985547">tt</span><span class="op" id="7985549">.</span><span class="ident" id="7985550">timeout</span><span class="op" id="7985557">)</span>&nbsp;<span class="op" id="7985559">*</span>&nbsp;<span class="ident" id="7985561">time</span><span class="op" id="7985565">.</span><span class="ident" id="7985566">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985575">msg</span><span class="op" id="7985578">,</span>&nbsp;<span class="ident" id="7985580">err</span>&nbsp;<span class="op" id="7985584">:=</span>&nbsp;<span class="ident" id="7985587">exchange</span><span class="op" id="7985595">(</span><span class="ident" id="7985596">tt</span><span class="op" id="7985598">.</span><span class="ident" id="7985599">server</span><span class="op" id="7985605">,</span>&nbsp;<span class="ident" id="7985607">tt</span><span class="op" id="7985609">.</span><span class="ident" id="7985610">name</span><span class="op" id="7985614">,</span>&nbsp;<span class="ident" id="7985616">tt</span><span class="op" id="7985618">.</span><span class="ident" id="7985619">qtype</span><span class="op" id="7985624">,</span>&nbsp;<span class="ident" id="7985626">timeout</span><span class="op" id="7985633">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985637">if</span>&nbsp;<span class="ident" id="7985640">err</span>&nbsp;<span class="op" id="7985644">!=</span>&nbsp;<span class="ident" id="7985647">nil</span>&nbsp;<span class="op" id="7985651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985656">t</span><span class="op" id="7985657">.</span><span class="ident" id="7985658">Error</span><span class="op" id="7985663">(</span><span class="ident" id="7985664">err</span><span class="op" id="7985667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985672">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985687">switch</span>&nbsp;<span class="ident" id="7985694">msg</span><span class="op" id="7985697">.</span><span class="ident" id="7985698">rcode</span>&nbsp;<span class="op" id="7985704">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985708">case</span>&nbsp;<span class="ident" id="7985713">tt</span><span class="op" id="7985715">.</span><span class="ident" id="7985716">rcode</span><span class="op" id="7985721">,</span>&nbsp;<span class="ident" id="7985723">dnsRcodeServerFailure</span><span class="op" id="7985744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985748">default</span><span class="op" id="7985755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985760">t</span><span class="op" id="7985761">.</span><span class="ident" id="7985762">Errorf</span><span class="op" id="7985768">(</span><span class="string" id="7985769">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7985794">,</span>&nbsp;<span class="ident" id="7985796">msg</span><span class="op" id="7985799">.</span><span class="ident" id="7985800">rcode</span><span class="op" id="7985805">,</span>&nbsp;<span class="ident" id="7985807">tt</span><span class="op" id="7985809">.</span><span class="ident" id="7985810">server</span><span class="op" id="7985816">,</span>&nbsp;<span class="ident" id="7985818">tt</span><span class="op" id="7985820">.</span><span class="ident" id="7985821">rcode</span><span class="op" id="7985826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7985831">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985842">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7985845">}</span><br>
<span class="lineno"></span><span class="op" id="7985847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7985850">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="7985917">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="7985934">var</span>&nbsp;<span class="ident" id="7985938">specialDomainNameTests</span>&nbsp;<span class="op" id="7985961">=</span>&nbsp;<span class="op" id="7985963">[</span><span class="op" id="7985964">]</span><span class="keyword" id="7985965">struct</span>&nbsp;<span class="op" id="7985972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985975">name</span>&nbsp;&nbsp;<span class="builtintype" id="7985981">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7985989">qtype</span>&nbsp;<span class="builtintype" id="7985995">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986003">rcode</span>&nbsp;<span class="builtintype" id="7986009">int</span><br>
<span class="lineno"></span><span class="op" id="7986013">}</span><span class="op" id="7986014">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986017">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986081">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986108">{</span><span class="string" id="7986109">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="7986136">,</span>&nbsp;<span class="ident" id="7986138">dnsTypePTR</span><span class="op" id="7986148">,</span>&nbsp;<span class="ident" id="7986150">dnsRcodeNameError</span><span class="op" id="7986167">}</span><span class="op" id="7986168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986171">{</span><span class="string" id="7986172">&#34;test.&#34;</span><span class="op" id="7986179">,</span>&nbsp;<span class="ident" id="7986181">dnsTypeALL</span><span class="op" id="7986191">,</span>&nbsp;<span class="ident" id="7986193">dnsRcodeNameError</span><span class="op" id="7986210">}</span><span class="op" id="7986211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986214">{</span><span class="string" id="7986215">&#34;example.com.&#34;</span><span class="op" id="7986229">,</span>&nbsp;<span class="ident" id="7986231">dnsTypeALL</span><span class="op" id="7986241">,</span>&nbsp;<span class="ident" id="7986243">dnsRcodeSuccess</span><span class="op" id="7986258">}</span><span class="op" id="7986259">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986263">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986323">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986382">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7986442">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986495">{</span><span class="string" id="7986496">&#34;localhost.&#34;</span><span class="op" id="7986508">,</span>&nbsp;<span class="ident" id="7986510">dnsTypeALL</span><span class="op" id="7986520">,</span>&nbsp;<span class="ident" id="7986522">dnsRcodeNameError</span><span class="op" id="7986539">}</span><span class="op" id="7986540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986543">{</span><span class="string" id="7986544">&#34;invalid.&#34;</span><span class="op" id="7986554">,</span>&nbsp;<span class="ident" id="7986556">dnsTypeALL</span><span class="op" id="7986566">,</span>&nbsp;<span class="ident" id="7986568">dnsRcodeNameError</span><span class="op" id="7986585">}</span><span class="op" id="7986586">,</span><br>
<span class="lineno"></span><span class="op" id="7986588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7986591">func</span>&nbsp;<span class="ident" id="7986596">TestSpecialDomainName</span><span class="op" id="7986617">(</span><span class="ident" id="7986618">t</span>&nbsp;<span class="op" id="7986620">*</span><span class="ident" id="7986621">testing</span><span class="op" id="7986628">.</span><span class="ident" id="7986629">T</span><span class="op" id="7986630">)</span>&nbsp;<span class="op" id="7986632">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986635">if</span>&nbsp;<span class="ident" id="7986638">testing</span><span class="op" id="7986645">.</span><span class="ident" id="7986646">Short</span><span class="op" id="7986651">(</span><span class="op" id="7986652">)</span>&nbsp;<span class="op" id="7986654">||</span>&nbsp;<span class="op" id="7986657">!</span><span class="op" id="7986658">*</span><span class="ident" id="7986659">testExternal</span>&nbsp;<span class="op" id="7986672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986676">t</span><span class="op" id="7986677">.</span><span class="ident" id="7986678">Skip</span><span class="op" id="7986682">(</span><span class="string" id="7986683">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7986724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986731">server</span>&nbsp;<span class="op" id="7986738">:=</span>&nbsp;<span class="string" id="7986741">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986755">for</span>&nbsp;<span class="ident" id="7986759">_</span><span class="op" id="7986760">,</span>&nbsp;<span class="ident" id="7986762">tt</span>&nbsp;<span class="op" id="7986765">:=</span>&nbsp;<span class="keyword" id="7986768">range</span>&nbsp;<span class="ident" id="7986774">specialDomainNameTests</span>&nbsp;<span class="op" id="7986797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986801">msg</span><span class="op" id="7986804">,</span>&nbsp;<span class="ident" id="7986806">err</span>&nbsp;<span class="op" id="7986810">:=</span>&nbsp;<span class="ident" id="7986813">exchange</span><span class="op" id="7986821">(</span><span class="ident" id="7986822">server</span><span class="op" id="7986828">,</span>&nbsp;<span class="ident" id="7986830">tt</span><span class="op" id="7986832">.</span><span class="ident" id="7986833">name</span><span class="op" id="7986837">,</span>&nbsp;<span class="ident" id="7986839">tt</span><span class="op" id="7986841">.</span><span class="ident" id="7986842">qtype</span><span class="op" id="7986847">,</span>&nbsp;<span class="num" id="7986849">0</span><span class="op" id="7986850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986854">if</span>&nbsp;<span class="ident" id="7986857">err</span>&nbsp;<span class="op" id="7986861">!=</span>&nbsp;<span class="ident" id="7986864">nil</span>&nbsp;<span class="op" id="7986868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986873">t</span><span class="op" id="7986874">.</span><span class="ident" id="7986875">Error</span><span class="op" id="7986880">(</span><span class="ident" id="7986881">err</span><span class="op" id="7986884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986889">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7986900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986904">switch</span>&nbsp;<span class="ident" id="7986911">msg</span><span class="op" id="7986914">.</span><span class="ident" id="7986915">rcode</span>&nbsp;<span class="op" id="7986921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986925">case</span>&nbsp;<span class="ident" id="7986930">tt</span><span class="op" id="7986932">.</span><span class="ident" id="7986933">rcode</span><span class="op" id="7986938">,</span>&nbsp;<span class="ident" id="7986940">dnsRcodeServerFailure</span><span class="op" id="7986961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7986965">default</span><span class="op" id="7986972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7986977">t</span><span class="op" id="7986978">.</span><span class="ident" id="7986979">Errorf</span><span class="op" id="7986985">(</span><span class="string" id="7986986">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7987011">,</span>&nbsp;<span class="ident" id="7987013">msg</span><span class="op" id="7987016">.</span><span class="ident" id="7987017">rcode</span><span class="op" id="7987022">,</span>&nbsp;<span class="ident" id="7987024">server</span><span class="op" id="7987030">,</span>&nbsp;<span class="ident" id="7987032">tt</span><span class="op" id="7987034">.</span><span class="ident" id="7987035">rcode</span><span class="op" id="7987040">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7987045">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7987056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7987059">}</span><br>
<span class="lineno"></span><span class="op" id="7987061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7987064">type</span>&nbsp;<span class="ident" id="7987069">resolvConfTest</span>&nbsp;<span class="keyword" id="7987084">struct</span>&nbsp;<span class="op" id="7987091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7987094">*</span><span class="ident" id="7987095">testing</span><span class="op" id="7987102">.</span><span class="ident" id="7987103">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987106">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7987114">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987122">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7987130">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987138">started</span>&nbsp;<span class="builtintype" id="7987146">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987152">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7987160">chan</span>&nbsp;<span class="keyword" id="7987165">chan</span>&nbsp;<span class="keyword" id="7987170">struct</span><span class="op" id="7987176">{</span><span class="op" id="7987177">}</span><br>
<span class="lineno"></span><span class="op" id="7987179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987182">func</span>&nbsp;<span class="ident" id="7987187">newResolvConfTest</span><span class="op" id="7987204">(</span><span class="ident" id="7987205">t</span>&nbsp;<span class="op" id="7987207">*</span><span class="ident" id="7987208">testing</span><span class="op" id="7987215">.</span><span class="ident" id="7987216">T</span><span class="op" id="7987217">)</span>&nbsp;<span class="op" id="7987219">*</span><span class="ident" id="7987220">resolvConfTest</span>&nbsp;<span class="op" id="7987235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987238">dir</span><span class="op" id="7987241">,</span>&nbsp;<span class="ident" id="7987243">err</span>&nbsp;<span class="op" id="7987247">:=</span>&nbsp;<span class="ident" id="7987250">ioutil</span><span class="op" id="7987256">.</span><span class="ident" id="7987257">TempDir</span><span class="op" id="7987264">(</span><span class="string" id="7987265">&#34;&#34;</span><span class="op" id="7987267">,</span>&nbsp;<span class="string" id="7987269">&#34;resolvConfTest&#34;</span><span class="op" id="7987285">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7987288">if</span>&nbsp;<span class="ident" id="7987291">err</span>&nbsp;<span class="op" id="7987295">!=</span>&nbsp;<span class="ident" id="7987298">nil</span>&nbsp;<span class="op" id="7987302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987306">t</span><span class="op" id="7987307">.</span><span class="ident" id="7987308">Fatalf</span><span class="op" id="7987314">(</span><span class="string" id="7987315">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="7987346">,</span>&nbsp;<span class="ident" id="7987348">err</span><span class="op" id="7987351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7987354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7987358">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987393">onceLoadConfig</span><span class="op" id="7987407">.</span><span class="ident" id="7987408">Do</span><span class="op" id="7987410">(</span><span class="keyword" id="7987411">func</span><span class="op" id="7987415">(</span><span class="op" id="7987416">)</span>&nbsp;<span class="op" id="7987418">{</span><span class="op" id="7987419">}</span><span class="op" id="7987420">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987424">r</span>&nbsp;<span class="op" id="7987426">:=</span>&nbsp;<span class="op" id="7987429">&amp;</span><span class="ident" id="7987430">resolvConfTest</span><span class="op" id="7987444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987448">T</span><span class="op" id="7987449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987455">t</span><span class="op" id="7987456">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987460">dir</span><span class="op" id="7987463">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7987467">dir</span><span class="op" id="7987470">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987474">path</span><span class="op" id="7987478">:</span>&nbsp;&nbsp;<span class="ident" id="7987481">path</span><span class="op" id="7987485">.</span><span class="ident" id="7987486">Join</span><span class="op" id="7987490">(</span><span class="ident" id="7987491">dir</span><span class="op" id="7987494">,</span>&nbsp;<span class="string" id="7987496">&#34;resolv.conf&#34;</span><span class="op" id="7987509">)</span><span class="op" id="7987510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987514">quitc</span><span class="op" id="7987519">:</span>&nbsp;<span class="builtinfunc" id="7987521">make</span><span class="op" id="7987525">(</span><span class="keyword" id="7987526">chan</span>&nbsp;<span class="keyword" id="7987531">chan</span>&nbsp;<span class="keyword" id="7987536">struct</span><span class="op" id="7987542">{</span><span class="op" id="7987543">}</span><span class="op" id="7987544">)</span><span class="op" id="7987545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7987548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7987552">return</span>&nbsp;<span class="ident" id="7987559">r</span><br>
<span class="lineno">120</span><span class="op" id="7987561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987564">func</span>&nbsp;<span class="op" id="7987569">(</span><span class="ident" id="7987570">r</span>&nbsp;<span class="op" id="7987572">*</span><span class="ident" id="7987573">resolvConfTest</span><span class="op" id="7987587">)</span>&nbsp;<span class="ident" id="7987589">Start</span><span class="op" id="7987594">(</span><span class="op" id="7987595">)</span>&nbsp;<span class="op" id="7987597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987600">loadConfig</span><span class="op" id="7987610">(</span><span class="ident" id="7987611">r</span><span class="op" id="7987612">.</span><span class="ident" id="7987613">path</span><span class="op" id="7987617">,</span>&nbsp;<span class="num" id="7987619">100</span><span class="op" id="7987622">*</span><span class="ident" id="7987623">time</span><span class="op" id="7987627">.</span><span class="ident" id="7987628">Millisecond</span><span class="op" id="7987639">,</span>&nbsp;<span class="ident" id="7987641">r</span><span class="op" id="7987642">.</span><span class="ident" id="7987643">quitc</span><span class="op" id="7987648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987651">r</span><span class="op" id="7987652">.</span><span class="ident" id="7987653">started</span>&nbsp;<span class="op" id="7987661">=</span>&nbsp;<span class="builtintype" id="7987663">true</span><br>
<span class="lineno">125</span><span class="op" id="7987668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987671">func</span>&nbsp;<span class="op" id="7987676">(</span><span class="ident" id="7987677">r</span>&nbsp;<span class="op" id="7987679">*</span><span class="ident" id="7987680">resolvConfTest</span><span class="op" id="7987694">)</span>&nbsp;<span class="ident" id="7987696">SetConf</span><span class="op" id="7987703">(</span><span class="ident" id="7987704">s</span>&nbsp;<span class="builtintype" id="7987706">string</span><span class="op" id="7987712">)</span>&nbsp;<span class="op" id="7987714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7987717">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7987786">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987841">time</span><span class="op" id="7987845">.</span><span class="ident" id="7987846">Sleep</span><span class="op" id="7987851">(</span><span class="ident" id="7987852">time</span><span class="op" id="7987856">.</span><span class="ident" id="7987857">Second</span><span class="op" id="7987863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987867">f</span><span class="op" id="7987868">,</span>&nbsp;<span class="ident" id="7987870">err</span>&nbsp;<span class="op" id="7987874">:=</span>&nbsp;<span class="ident" id="7987877">os</span><span class="op" id="7987879">.</span><span class="ident" id="7987880">OpenFile</span><span class="op" id="7987888">(</span><span class="ident" id="7987889">r</span><span class="op" id="7987890">.</span><span class="ident" id="7987891">path</span><span class="op" id="7987895">,</span>&nbsp;<span class="ident" id="7987897">os</span><span class="op" id="7987899">.</span><span class="ident" id="7987900">O_CREATE</span><span class="op" id="7987908">|</span><span class="ident" id="7987909">os</span><span class="op" id="7987911">.</span><span class="ident" id="7987912">O_TRUNC</span><span class="op" id="7987919">|</span><span class="ident" id="7987920">os</span><span class="op" id="7987922">.</span><span class="ident" id="7987923">O_WRONLY</span><span class="op" id="7987931">,</span>&nbsp;<span class="num" id="7987933">0600</span><span class="op" id="7987937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7987940">if</span>&nbsp;<span class="ident" id="7987943">err</span>&nbsp;<span class="op" id="7987947">!=</span>&nbsp;<span class="ident" id="7987950">nil</span>&nbsp;<span class="op" id="7987954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7987958">r</span><span class="op" id="7987959">.</span><span class="ident" id="7987960">Fatalf</span><span class="op" id="7987966">(</span><span class="string" id="7987967">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7988002">,</span>&nbsp;<span class="ident" id="7988004">r</span><span class="op" id="7988005">.</span><span class="ident" id="7988006">path</span><span class="op" id="7988010">,</span>&nbsp;<span class="ident" id="7988012">err</span><span class="op" id="7988015">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988021">if</span>&nbsp;<span class="ident" id="7988024">_</span><span class="op" id="7988025">,</span>&nbsp;<span class="ident" id="7988027">err</span>&nbsp;<span class="op" id="7988031">:=</span>&nbsp;<span class="ident" id="7988034">io</span><span class="op" id="7988036">.</span><span class="ident" id="7988037">WriteString</span><span class="op" id="7988048">(</span><span class="ident" id="7988049">f</span><span class="op" id="7988050">,</span>&nbsp;<span class="ident" id="7988052">s</span><span class="op" id="7988053">)</span><span class="op" id="7988054">;</span>&nbsp;<span class="ident" id="7988056">err</span>&nbsp;<span class="op" id="7988060">!=</span>&nbsp;<span class="ident" id="7988063">nil</span>&nbsp;<span class="op" id="7988067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988071">f</span><span class="op" id="7988072">.</span><span class="ident" id="7988073">Close</span><span class="op" id="7988078">(</span><span class="op" id="7988079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988083">r</span><span class="op" id="7988084">.</span><span class="ident" id="7988085">Fatalf</span><span class="op" id="7988091">(</span><span class="string" id="7988092">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="7988123">,</span>&nbsp;<span class="ident" id="7988125">err</span><span class="op" id="7988128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988131">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988134">f</span><span class="op" id="7988135">.</span><span class="ident" id="7988136">Close</span><span class="op" id="7988141">(</span><span class="op" id="7988142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988146">if</span>&nbsp;<span class="ident" id="7988149">r</span><span class="op" id="7988150">.</span><span class="ident" id="7988151">started</span>&nbsp;<span class="op" id="7988159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988163">cfg</span><span class="op" id="7988166">.</span><span class="ident" id="7988167">ch</span>&nbsp;<span class="op" id="7988170">&lt;-</span>&nbsp;<span class="keyword" id="7988173">struct</span><span class="op" id="7988179">{</span><span class="op" id="7988180">}</span><span class="op" id="7988181">{</span><span class="op" id="7988182">}</span>&nbsp;<span class="comment" id="7988184">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988201">cfg</span><span class="op" id="7988204">.</span><span class="ident" id="7988205">ch</span>&nbsp;<span class="op" id="7988208">&lt;-</span>&nbsp;<span class="keyword" id="7988211">struct</span><span class="op" id="7988217">{</span><span class="op" id="7988218">}</span><span class="op" id="7988219">{</span><span class="op" id="7988220">}</span>&nbsp;<span class="comment" id="7988222">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988252">cfg</span><span class="op" id="7988255">.</span><span class="ident" id="7988256">ch</span>&nbsp;<span class="op" id="7988259">&lt;-</span>&nbsp;<span class="keyword" id="7988262">struct</span><span class="op" id="7988268">{</span><span class="op" id="7988269">}</span><span class="op" id="7988270">{</span><span class="op" id="7988271">}</span>&nbsp;<span class="comment" id="7988273">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988305">}</span><br>
<span class="lineno"></span><span class="op" id="7988307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7988310">func</span>&nbsp;<span class="op" id="7988315">(</span><span class="ident" id="7988316">r</span>&nbsp;<span class="op" id="7988318">*</span><span class="ident" id="7988319">resolvConfTest</span><span class="op" id="7988333">)</span>&nbsp;<span class="ident" id="7988335">WantServers</span><span class="op" id="7988346">(</span><span class="ident" id="7988347">want</span>&nbsp;<span class="op" id="7988352">[</span><span class="op" id="7988353">]</span><span class="builtintype" id="7988354">string</span><span class="op" id="7988360">)</span>&nbsp;<span class="op" id="7988362">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988365">cfg</span><span class="op" id="7988368">.</span><span class="ident" id="7988369">mu</span><span class="op" id="7988371">.</span><span class="ident" id="7988372">RLock</span><span class="op" id="7988377">(</span><span class="op" id="7988378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988381">defer</span>&nbsp;<span class="ident" id="7988387">cfg</span><span class="op" id="7988390">.</span><span class="ident" id="7988391">mu</span><span class="op" id="7988393">.</span><span class="ident" id="7988394">RUnlock</span><span class="op" id="7988401">(</span><span class="op" id="7988402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988405">if</span>&nbsp;<span class="ident" id="7988408">got</span>&nbsp;<span class="op" id="7988412">:=</span>&nbsp;<span class="ident" id="7988415">cfg</span><span class="op" id="7988418">.</span><span class="ident" id="7988419">dnsConfig</span><span class="op" id="7988428">.</span><span class="ident" id="7988429">servers</span><span class="op" id="7988436">;</span>&nbsp;<span class="op" id="7988438">!</span><span class="ident" id="7988439">reflect</span><span class="op" id="7988446">.</span><span class="ident" id="7988447">DeepEqual</span><span class="op" id="7988456">(</span><span class="ident" id="7988457">got</span><span class="op" id="7988460">,</span>&nbsp;<span class="ident" id="7988462">want</span><span class="op" id="7988466">)</span>&nbsp;<span class="op" id="7988468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988472">r</span><span class="op" id="7988473">.</span><span class="ident" id="7988474">Fatalf</span><span class="op" id="7988480">(</span><span class="string" id="7988481">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7988527">,</span>&nbsp;<span class="ident" id="7988529">got</span><span class="op" id="7988532">,</span>&nbsp;<span class="ident" id="7988534">want</span><span class="op" id="7988538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988541">}</span><br>
<span class="lineno">155</span><span class="op" id="7988543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7988546">func</span>&nbsp;<span class="op" id="7988551">(</span><span class="ident" id="7988552">r</span>&nbsp;<span class="op" id="7988554">*</span><span class="ident" id="7988555">resolvConfTest</span><span class="op" id="7988569">)</span>&nbsp;<span class="ident" id="7988571">Close</span><span class="op" id="7988576">(</span><span class="op" id="7988577">)</span>&nbsp;<span class="op" id="7988579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988582">resp</span>&nbsp;<span class="op" id="7988587">:=</span>&nbsp;<span class="builtinfunc" id="7988590">make</span><span class="op" id="7988594">(</span><span class="keyword" id="7988595">chan</span>&nbsp;<span class="keyword" id="7988600">struct</span><span class="op" id="7988606">{</span><span class="op" id="7988607">}</span><span class="op" id="7988608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988611">r</span><span class="op" id="7988612">.</span><span class="ident" id="7988613">quitc</span>&nbsp;<span class="op" id="7988619">&lt;-</span>&nbsp;<span class="ident" id="7988622">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988628">&lt;-</span><span class="ident" id="7988630">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988636">if</span>&nbsp;<span class="ident" id="7988639">err</span>&nbsp;<span class="op" id="7988643">:=</span>&nbsp;<span class="ident" id="7988646">os</span><span class="op" id="7988648">.</span><span class="ident" id="7988649">RemoveAll</span><span class="op" id="7988658">(</span><span class="ident" id="7988659">r</span><span class="op" id="7988660">.</span><span class="ident" id="7988661">dir</span><span class="op" id="7988664">)</span><span class="op" id="7988665">;</span>&nbsp;<span class="ident" id="7988667">err</span>&nbsp;<span class="op" id="7988671">!=</span>&nbsp;<span class="ident" id="7988674">nil</span>&nbsp;<span class="op" id="7988678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988682">r</span><span class="op" id="7988683">.</span><span class="ident" id="7988684">Logf</span><span class="op" id="7988688">(</span><span class="string" id="7988689">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7988723">,</span>&nbsp;<span class="ident" id="7988725">r</span><span class="op" id="7988726">.</span><span class="ident" id="7988727">dir</span><span class="op" id="7988730">,</span>&nbsp;<span class="ident" id="7988732">err</span><span class="op" id="7988735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988738">}</span><br>
<span class="lineno"></span><span class="op" id="7988740">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7988743">func</span>&nbsp;<span class="ident" id="7988748">TestReloadResolvConfFail</span><span class="op" id="7988772">(</span><span class="ident" id="7988773">t</span>&nbsp;<span class="op" id="7988775">*</span><span class="ident" id="7988776">testing</span><span class="op" id="7988783">.</span><span class="ident" id="7988784">T</span><span class="op" id="7988785">)</span>&nbsp;<span class="op" id="7988787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988790">if</span>&nbsp;<span class="ident" id="7988793">testing</span><span class="op" id="7988800">.</span><span class="ident" id="7988801">Short</span><span class="op" id="7988806">(</span><span class="op" id="7988807">)</span>&nbsp;<span class="op" id="7988809">||</span>&nbsp;<span class="op" id="7988812">!</span><span class="op" id="7988813">*</span><span class="ident" id="7988814">testExternal</span>&nbsp;<span class="op" id="7988827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988831">t</span><span class="op" id="7988832">.</span><span class="ident" id="7988833">Skip</span><span class="op" id="7988837">(</span><span class="string" id="7988838">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7988879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7988882">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988886">r</span>&nbsp;<span class="op" id="7988888">:=</span>&nbsp;<span class="ident" id="7988891">newResolvConfTest</span><span class="op" id="7988908">(</span><span class="ident" id="7988909">t</span><span class="op" id="7988910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988913">defer</span>&nbsp;<span class="ident" id="7988919">r</span><span class="op" id="7988920">.</span><span class="ident" id="7988921">Close</span><span class="op" id="7988926">(</span><span class="op" id="7988927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7988931">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7988970">r</span><span class="op" id="7988971">.</span><span class="ident" id="7988972">Start</span><span class="op" id="7988977">(</span><span class="op" id="7988978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7988981">if</span>&nbsp;<span class="ident" id="7988984">_</span><span class="op" id="7988985">,</span>&nbsp;<span class="ident" id="7988987">err</span>&nbsp;<span class="op" id="7988991">:=</span>&nbsp;<span class="ident" id="7988994">goLookupIP</span><span class="op" id="7989004">(</span><span class="string" id="7989005">&#34;golang.org&#34;</span><span class="op" id="7989017">)</span><span class="op" id="7989018">;</span>&nbsp;<span class="ident" id="7989020">err</span>&nbsp;<span class="op" id="7989024">==</span>&nbsp;<span class="ident" id="7989027">nil</span>&nbsp;<span class="op" id="7989031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989035">t</span><span class="op" id="7989036">.</span><span class="ident" id="7989037">Fatal</span><span class="op" id="7989042">(</span><span class="string" id="7989043">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="7989074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7989077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989081">r</span><span class="op" id="7989082">.</span><span class="ident" id="7989083">SetConf</span><span class="op" id="7989090">(</span><span class="string" id="7989091">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7989111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989114">if</span>&nbsp;<span class="ident" id="7989117">_</span><span class="op" id="7989118">,</span>&nbsp;<span class="ident" id="7989120">err</span>&nbsp;<span class="op" id="7989124">:=</span>&nbsp;<span class="ident" id="7989127">goLookupIP</span><span class="op" id="7989137">(</span><span class="string" id="7989138">&#34;golang.org&#34;</span><span class="op" id="7989150">)</span><span class="op" id="7989151">;</span>&nbsp;<span class="ident" id="7989153">err</span>&nbsp;<span class="op" id="7989157">!=</span>&nbsp;<span class="ident" id="7989160">nil</span>&nbsp;<span class="op" id="7989164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989168">t</span><span class="op" id="7989169">.</span><span class="ident" id="7989170">Fatalf</span><span class="op" id="7989176">(</span><span class="string" id="7989177">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7989215">,</span>&nbsp;<span class="ident" id="7989217">err</span><span class="op" id="7989220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7989223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7989227">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7989275">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989319">r</span><span class="op" id="7989320">.</span><span class="ident" id="7989321">SetConf</span><span class="op" id="7989328">(</span><span class="string" id="7989329">&#34;&#34;</span><span class="op" id="7989331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989334">if</span>&nbsp;<span class="ident" id="7989337">_</span><span class="op" id="7989338">,</span>&nbsp;<span class="ident" id="7989340">err</span>&nbsp;<span class="op" id="7989344">:=</span>&nbsp;<span class="ident" id="7989347">goLookupIP</span><span class="op" id="7989357">(</span><span class="string" id="7989358">&#34;golang.org&#34;</span><span class="op" id="7989370">)</span><span class="op" id="7989371">;</span>&nbsp;<span class="ident" id="7989373">err</span>&nbsp;<span class="op" id="7989377">!=</span>&nbsp;<span class="ident" id="7989380">nil</span>&nbsp;<span class="op" id="7989384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989388">t</span><span class="op" id="7989389">.</span><span class="ident" id="7989390">Fatalf</span><span class="op" id="7989396">(</span><span class="string" id="7989397">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7989440">,</span>&nbsp;<span class="ident" id="7989442">err</span><span class="op" id="7989445">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7989448">}</span><br>
<span class="lineno"></span><span class="op" id="7989450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7989453">func</span>&nbsp;<span class="ident" id="7989458">TestReloadResolvConfChange</span><span class="op" id="7989484">(</span><span class="ident" id="7989485">t</span>&nbsp;<span class="op" id="7989487">*</span><span class="ident" id="7989488">testing</span><span class="op" id="7989495">.</span><span class="ident" id="7989496">T</span><span class="op" id="7989497">)</span>&nbsp;<span class="op" id="7989499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989502">if</span>&nbsp;<span class="ident" id="7989505">testing</span><span class="op" id="7989512">.</span><span class="ident" id="7989513">Short</span><span class="op" id="7989518">(</span><span class="op" id="7989519">)</span>&nbsp;<span class="op" id="7989521">||</span>&nbsp;<span class="op" id="7989524">!</span><span class="op" id="7989525">*</span><span class="ident" id="7989526">testExternal</span>&nbsp;<span class="op" id="7989539">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989543">t</span><span class="op" id="7989544">.</span><span class="ident" id="7989545">Skip</span><span class="op" id="7989549">(</span><span class="string" id="7989550">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7989591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7989594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989598">r</span>&nbsp;<span class="op" id="7989600">:=</span>&nbsp;<span class="ident" id="7989603">newResolvConfTest</span><span class="op" id="7989620">(</span><span class="ident" id="7989621">t</span><span class="op" id="7989622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989625">defer</span>&nbsp;<span class="ident" id="7989631">r</span><span class="op" id="7989632">.</span><span class="ident" id="7989633">Close</span><span class="op" id="7989638">(</span><span class="op" id="7989639">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989643">r</span><span class="op" id="7989644">.</span><span class="ident" id="7989645">SetConf</span><span class="op" id="7989652">(</span><span class="string" id="7989653">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7989673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989676">r</span><span class="op" id="7989677">.</span><span class="ident" id="7989678">Start</span><span class="op" id="7989683">(</span><span class="op" id="7989684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989688">if</span>&nbsp;<span class="ident" id="7989691">_</span><span class="op" id="7989692">,</span>&nbsp;<span class="ident" id="7989694">err</span>&nbsp;<span class="op" id="7989698">:=</span>&nbsp;<span class="ident" id="7989701">goLookupIP</span><span class="op" id="7989711">(</span><span class="string" id="7989712">&#34;golang.org&#34;</span><span class="op" id="7989724">)</span><span class="op" id="7989725">;</span>&nbsp;<span class="ident" id="7989727">err</span>&nbsp;<span class="op" id="7989731">!=</span>&nbsp;<span class="ident" id="7989734">nil</span>&nbsp;<span class="op" id="7989738">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989742">t</span><span class="op" id="7989743">.</span><span class="ident" id="7989744">Fatalf</span><span class="op" id="7989750">(</span><span class="string" id="7989751">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7989780">,</span>&nbsp;<span class="ident" id="7989782">err</span><span class="op" id="7989785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7989788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989791">r</span><span class="op" id="7989792">.</span><span class="ident" id="7989793">WantServers</span><span class="op" id="7989804">(</span><span class="op" id="7989805">[</span><span class="op" id="7989806">]</span><span class="builtintype" id="7989807">string</span><span class="op" id="7989813">{</span><span class="string" id="7989814">&#34;8.8.8.8&#34;</span><span class="op" id="7989823">}</span><span class="op" id="7989824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7989828">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7989879">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989919">r</span><span class="op" id="7989920">.</span><span class="ident" id="7989921">SetConf</span><span class="op" id="7989928">(</span><span class="string" id="7989929">&#34;&#34;</span><span class="op" id="7989931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7989934">if</span>&nbsp;<span class="ident" id="7989937">_</span><span class="op" id="7989938">,</span>&nbsp;<span class="ident" id="7989940">err</span>&nbsp;<span class="op" id="7989944">:=</span>&nbsp;<span class="ident" id="7989947">goLookupIP</span><span class="op" id="7989957">(</span><span class="string" id="7989958">&#34;golang.org&#34;</span><span class="op" id="7989970">)</span><span class="op" id="7989971">;</span>&nbsp;<span class="ident" id="7989973">err</span>&nbsp;<span class="op" id="7989977">!=</span>&nbsp;<span class="ident" id="7989980">nil</span>&nbsp;<span class="op" id="7989984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7989988">t</span><span class="op" id="7989989">.</span><span class="ident" id="7989990">Fatalf</span><span class="op" id="7989996">(</span><span class="string" id="7989997">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7990031">,</span>&nbsp;<span class="ident" id="7990033">err</span><span class="op" id="7990036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7990039">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7990043">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990086">r</span><span class="op" id="7990087">.</span><span class="ident" id="7990088">SetConf</span><span class="op" id="7990095">(</span><span class="string" id="7990096">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="7990116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990119">r</span><span class="op" id="7990120">.</span><span class="ident" id="7990121">WantServers</span><span class="op" id="7990132">(</span><span class="op" id="7990133">[</span><span class="op" id="7990134">]</span><span class="builtintype" id="7990135">string</span><span class="op" id="7990141">{</span><span class="string" id="7990142">&#34;8.8.4.4&#34;</span><span class="op" id="7990151">}</span><span class="op" id="7990152">)</span><br>
<span class="lineno"></span><span class="op" id="7990154">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7990157">func</span>&nbsp;<span class="ident" id="7990162">BenchmarkGoLookupIP</span><span class="op" id="7990181">(</span><span class="ident" id="7990182">b</span>&nbsp;<span class="op" id="7990184">*</span><span class="ident" id="7990185">testing</span><span class="op" id="7990192">.</span><span class="ident" id="7990193">B</span><span class="op" id="7990194">)</span>&nbsp;<span class="op" id="7990196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7990199">for</span>&nbsp;<span class="ident" id="7990203">i</span>&nbsp;<span class="op" id="7990205">:=</span>&nbsp;<span class="num" id="7990208">0</span><span class="op" id="7990209">;</span>&nbsp;<span class="ident" id="7990211">i</span>&nbsp;<span class="op" id="7990213">&lt;</span>&nbsp;<span class="ident" id="7990215">b</span><span class="op" id="7990216">.</span><span class="ident" id="7990217">N</span><span class="op" id="7990218">;</span>&nbsp;<span class="ident" id="7990220">i</span><span class="op" id="7990221">++</span>&nbsp;<span class="op" id="7990224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990228">goLookupIP</span><span class="op" id="7990238">(</span><span class="string" id="7990239">&#34;www.example.com&#34;</span><span class="op" id="7990256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7990259">}</span><br>
<span class="lineno">225</span><span class="op" id="7990261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7990264">func</span>&nbsp;<span class="ident" id="7990269">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="7990298">(</span><span class="ident" id="7990299">b</span>&nbsp;<span class="op" id="7990301">*</span><span class="ident" id="7990302">testing</span><span class="op" id="7990309">.</span><span class="ident" id="7990310">B</span><span class="op" id="7990311">)</span>&nbsp;<span class="op" id="7990313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7990316">for</span>&nbsp;<span class="ident" id="7990320">i</span>&nbsp;<span class="op" id="7990322">:=</span>&nbsp;<span class="num" id="7990325">0</span><span class="op" id="7990326">;</span>&nbsp;<span class="ident" id="7990328">i</span>&nbsp;<span class="op" id="7990330">&lt;</span>&nbsp;<span class="ident" id="7990332">b</span><span class="op" id="7990333">.</span><span class="ident" id="7990334">N</span><span class="op" id="7990335">;</span>&nbsp;<span class="ident" id="7990337">i</span><span class="op" id="7990338">++</span>&nbsp;<span class="op" id="7990341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990345">goLookupIP</span><span class="op" id="7990355">(</span><span class="string" id="7990356">&#34;some.nonexistent&#34;</span><span class="op" id="7990374">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7990377">}</span><br>
<span class="lineno"></span><span class="op" id="7990379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7990382">func</span>&nbsp;<span class="ident" id="7990387">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="7990426">(</span><span class="ident" id="7990427">b</span>&nbsp;<span class="op" id="7990429">*</span><span class="ident" id="7990430">testing</span><span class="op" id="7990437">.</span><span class="ident" id="7990438">B</span><span class="op" id="7990439">)</span>&nbsp;<span class="op" id="7990441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990444">onceLoadConfig</span><span class="op" id="7990458">.</span><span class="ident" id="7990459">Do</span><span class="op" id="7990461">(</span><span class="ident" id="7990462">loadDefaultConfig</span><span class="op" id="7990479">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7990482">if</span>&nbsp;<span class="ident" id="7990485">cfg</span><span class="op" id="7990488">.</span><span class="ident" id="7990489">dnserr</span>&nbsp;<span class="op" id="7990496">!=</span>&nbsp;<span class="ident" id="7990499">nil</span>&nbsp;<span class="op" id="7990503">||</span>&nbsp;<span class="ident" id="7990506">cfg</span><span class="op" id="7990509">.</span><span class="ident" id="7990510">dnsConfig</span>&nbsp;<span class="op" id="7990520">==</span>&nbsp;<span class="ident" id="7990523">nil</span>&nbsp;<span class="op" id="7990527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990531">b</span><span class="op" id="7990532">.</span><span class="ident" id="7990533">Fatalf</span><span class="op" id="7990539">(</span><span class="string" id="7990540">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7990563">,</span>&nbsp;<span class="ident" id="7990565">cfg</span><span class="op" id="7990568">.</span><span class="ident" id="7990569">dnserr</span><span class="op" id="7990575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7990578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7990581">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7990645">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990682">orig</span>&nbsp;<span class="op" id="7990687">:=</span>&nbsp;<span class="ident" id="7990690">cfg</span><span class="op" id="7990693">.</span><span class="ident" id="7990694">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990705">cfg</span><span class="op" id="7990708">.</span><span class="ident" id="7990709">dnsConfig</span><span class="op" id="7990718">.</span><span class="ident" id="7990719">servers</span>&nbsp;<span class="op" id="7990727">=</span>&nbsp;<span class="builtinfunc" id="7990729">append</span><span class="op" id="7990735">(</span><span class="op" id="7990736">[</span><span class="op" id="7990737">]</span><span class="builtintype" id="7990738">string</span><span class="op" id="7990744">{</span><span class="string" id="7990745">&#34;203.0.113.254&#34;</span><span class="op" id="7990760">}</span><span class="op" id="7990761">,</span>&nbsp;<span class="ident" id="7990763">cfg</span><span class="op" id="7990766">.</span><span class="ident" id="7990767">dnsConfig</span><span class="op" id="7990776">.</span><span class="ident" id="7990777">servers</span><span class="op" id="7990784">...</span><span class="op" id="7990787">)</span>&nbsp;<span class="comment" id="7990789">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7990828">for</span>&nbsp;<span class="ident" id="7990832">i</span>&nbsp;<span class="op" id="7990834">:=</span>&nbsp;<span class="num" id="7990837">0</span><span class="op" id="7990838">;</span>&nbsp;<span class="ident" id="7990840">i</span>&nbsp;<span class="op" id="7990842">&lt;</span>&nbsp;<span class="ident" id="7990844">b</span><span class="op" id="7990845">.</span><span class="ident" id="7990846">N</span><span class="op" id="7990847">;</span>&nbsp;<span class="ident" id="7990849">i</span><span class="op" id="7990850">++</span>&nbsp;<span class="op" id="7990853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990857">goLookupIP</span><span class="op" id="7990867">(</span><span class="string" id="7990868">&#34;www.example.com&#34;</span><span class="op" id="7990885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7990888">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7990891">cfg</span><span class="op" id="7990894">.</span><span class="ident" id="7990895">dnsConfig</span>&nbsp;<span class="op" id="7990905">=</span>&nbsp;<span class="ident" id="7990907">orig</span><br>
<span class="lineno"></span><span class="op" id="7990912">}</span>
</div>
</body>
</html>
