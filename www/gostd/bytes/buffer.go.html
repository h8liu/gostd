<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2868622">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2868677">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2868731">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2868782">package</span>&nbsp;<span class="ident" id="2868790">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2868797">//&nbsp;Simple&nbsp;byte&nbsp;buffer&nbsp;for&nbsp;marshaling&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2868841">import</span>&nbsp;<span class="op" id="2868848">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868851">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868861">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2868867">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2868882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2868885">//&nbsp;A&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;variable-sized&nbsp;buffer&nbsp;of&nbsp;bytes&nbsp;with&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods.</span><br>
<span class="lineno"></span><span class="comment" id="2868962">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Buffer&nbsp;is&nbsp;an&nbsp;empty&nbsp;buffer&nbsp;ready&nbsp;to&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="2869024">type</span>&nbsp;<span class="ident" id="2869029">Buffer</span>&nbsp;<span class="keyword" id="2869036">struct</span>&nbsp;<span class="op" id="2869043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869046">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2869056">[</span><span class="op" id="2869057">]</span><span class="builtintype" id="2869058">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869074">//&nbsp;contents&nbsp;are&nbsp;the&nbsp;bytes&nbsp;buf[off&nbsp;:&nbsp;len(buf)]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869121">off</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2869131">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869149">//&nbsp;read&nbsp;at&nbsp;&amp;buf[off],&nbsp;write&nbsp;at&nbsp;&amp;buf[len(buf)]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869196">runeBytes</span>&nbsp;<span class="op" id="2869206">[</span><span class="ident" id="2869207">utf8</span><span class="op" id="2869211">.</span><span class="ident" id="2869212">UTFMax</span><span class="op" id="2869218">]</span><span class="builtintype" id="2869219">byte</span>&nbsp;<span class="comment" id="2869224">//&nbsp;avoid&nbsp;allocation&nbsp;of&nbsp;slice&nbsp;on&nbsp;each&nbsp;WriteByte&nbsp;or&nbsp;Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869280">bootstrap</span>&nbsp;<span class="op" id="2869290">[</span><span class="num" id="2869291">64</span><span class="op" id="2869293">]</span><span class="builtintype" id="2869294">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869308">//&nbsp;memory&nbsp;to&nbsp;hold&nbsp;first&nbsp;slice;&nbsp;helps&nbsp;small&nbsp;buffers&nbsp;(Printf)&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869387">lastRead</span>&nbsp;&nbsp;<span class="ident" id="2869397">readOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869415">//&nbsp;last&nbsp;read&nbsp;operation,&nbsp;so&nbsp;that&nbsp;Unread*&nbsp;can&nbsp;work&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="op" id="2869475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2869478">//&nbsp;The&nbsp;readOp&nbsp;constants&nbsp;describe&nbsp;the&nbsp;last&nbsp;action&nbsp;performed&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2869540">//&nbsp;the&nbsp;buffer,&nbsp;so&nbsp;that&nbsp;UnreadRune&nbsp;and&nbsp;UnreadByte&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="2869593">//&nbsp;check&nbsp;for&nbsp;invalid&nbsp;usage.</span><br>
<span class="lineno"></span><span class="keyword" id="2869621">type</span>&nbsp;<span class="ident" id="2869626">readOp</span>&nbsp;<span class="builtintype" id="2869633">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="2869638">const</span>&nbsp;<span class="op" id="2869644">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869647">opInvalid</span>&nbsp;&nbsp;<span class="ident" id="2869658">readOp</span>&nbsp;<span class="op" id="2869665">=</span>&nbsp;<span class="ident" id="2869667">iota</span>&nbsp;<span class="comment" id="2869672">//&nbsp;Non-read&nbsp;operation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869696">opReadRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869721">//&nbsp;Read&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2869736">opRead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2869761">//&nbsp;Any&nbsp;other&nbsp;read&nbsp;operation.</span><br>
<span class="lineno"></span><span class="op" id="2869790">)</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="2869793">//&nbsp;ErrTooLarge&nbsp;is&nbsp;passed&nbsp;to&nbsp;panic&nbsp;if&nbsp;memory&nbsp;cannot&nbsp;be&nbsp;allocated&nbsp;to&nbsp;store&nbsp;data&nbsp;in&nbsp;a&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2869884">var</span>&nbsp;<span class="ident" id="2869888">ErrTooLarge</span>&nbsp;<span class="op" id="2869900">=</span>&nbsp;<span class="ident" id="2869902">errors</span><span class="op" id="2869908">.</span><span class="ident" id="2869909">New</span><span class="op" id="2869912">(</span><span class="string" id="2869913">&#34;bytes.Buffer:&nbsp;too&nbsp;large&#34;</span><span class="op" id="2869938">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2869941">//&nbsp;Bytes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno">40</span><span class="comment" id="2870019">//&nbsp;len(b.Bytes())&nbsp;==&nbsp;b.Len().&nbsp;&nbsp;If&nbsp;the&nbsp;caller&nbsp;changes&nbsp;the&nbsp;contents&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2870092">//&nbsp;returned&nbsp;slice,&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;buffer&nbsp;will&nbsp;change&nbsp;provided&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2870165">//&nbsp;are&nbsp;no&nbsp;intervening&nbsp;method&nbsp;calls&nbsp;on&nbsp;the&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2870215">func</span>&nbsp;<span class="op" id="2870220">(</span><span class="ident" id="2870221">b</span>&nbsp;<span class="op" id="2870223">*</span><span class="ident" id="2870224">Buffer</span><span class="op" id="2870230">)</span>&nbsp;<span class="ident" id="2870232">Bytes</span><span class="op" id="2870237">(</span><span class="op" id="2870238">)</span>&nbsp;<span class="op" id="2870240">[</span><span class="op" id="2870241">]</span><span class="builtintype" id="2870242">byte</span>&nbsp;<span class="op" id="2870247">{</span>&nbsp;<span class="keyword" id="2870249">return</span>&nbsp;<span class="ident" id="2870256">b</span><span class="op" id="2870257">.</span><span class="ident" id="2870258">buf</span><span class="op" id="2870261">[</span><span class="ident" id="2870262">b</span><span class="op" id="2870263">.</span><span class="ident" id="2870264">off</span><span class="op" id="2870267">:</span><span class="op" id="2870268">]</span>&nbsp;<span class="op" id="2870270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2870273">//&nbsp;String&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2870340">//&nbsp;as&nbsp;a&nbsp;string.&nbsp;&nbsp;If&nbsp;the&nbsp;Buffer&nbsp;is&nbsp;a&nbsp;nil&nbsp;pointer,&nbsp;it&nbsp;returns&nbsp;&#34;&lt;nil&gt;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2870409">func</span>&nbsp;<span class="op" id="2870414">(</span><span class="ident" id="2870415">b</span>&nbsp;<span class="op" id="2870417">*</span><span class="ident" id="2870418">Buffer</span><span class="op" id="2870424">)</span>&nbsp;<span class="ident" id="2870426">String</span><span class="op" id="2870432">(</span><span class="op" id="2870433">)</span>&nbsp;<span class="builtintype" id="2870435">string</span>&nbsp;<span class="op" id="2870442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870445">if</span>&nbsp;<span class="ident" id="2870448">b</span>&nbsp;<span class="op" id="2870450">==</span>&nbsp;<span class="ident" id="2870453">nil</span>&nbsp;<span class="op" id="2870457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2870461">//&nbsp;Special&nbsp;case,&nbsp;useful&nbsp;in&nbsp;debugging.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870501">return</span>&nbsp;<span class="string" id="2870508">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2870517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870520">return</span>&nbsp;<span class="builtintype" id="2870527">string</span><span class="op" id="2870533">(</span><span class="ident" id="2870534">b</span><span class="op" id="2870535">.</span><span class="ident" id="2870536">buf</span><span class="op" id="2870539">[</span><span class="ident" id="2870540">b</span><span class="op" id="2870541">.</span><span class="ident" id="2870542">off</span><span class="op" id="2870545">:</span><span class="op" id="2870546">]</span><span class="op" id="2870547">)</span><br>
<span class="lineno"></span><span class="op" id="2870549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2870552">//&nbsp;Len&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;the&nbsp;unread&nbsp;portion&nbsp;of&nbsp;the&nbsp;buffer;</span><br>
<span class="lineno"></span><span class="comment" id="2870624">//&nbsp;b.Len()&nbsp;==&nbsp;len(b.Bytes()).</span><br>
<span class="lineno"></span><span class="keyword" id="2870654">func</span>&nbsp;<span class="op" id="2870659">(</span><span class="ident" id="2870660">b</span>&nbsp;<span class="op" id="2870662">*</span><span class="ident" id="2870663">Buffer</span><span class="op" id="2870669">)</span>&nbsp;<span class="ident" id="2870671">Len</span><span class="op" id="2870674">(</span><span class="op" id="2870675">)</span>&nbsp;<span class="builtintype" id="2870677">int</span>&nbsp;<span class="op" id="2870681">{</span>&nbsp;<span class="keyword" id="2870683">return</span>&nbsp;<span class="builtinfunc" id="2870690">len</span><span class="op" id="2870693">(</span><span class="ident" id="2870694">b</span><span class="op" id="2870695">.</span><span class="ident" id="2870696">buf</span><span class="op" id="2870699">)</span>&nbsp;<span class="op" id="2870701">-</span>&nbsp;<span class="ident" id="2870703">b</span><span class="op" id="2870704">.</span><span class="ident" id="2870705">off</span>&nbsp;<span class="op" id="2870709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2870712">//&nbsp;Truncate&nbsp;discards&nbsp;all&nbsp;but&nbsp;the&nbsp;first&nbsp;n&nbsp;unread&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">60</span><span class="comment" id="2870783">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;n&nbsp;is&nbsp;negative&nbsp;or&nbsp;greater&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2870855">func</span>&nbsp;<span class="op" id="2870860">(</span><span class="ident" id="2870861">b</span>&nbsp;<span class="op" id="2870863">*</span><span class="ident" id="2870864">Buffer</span><span class="op" id="2870870">)</span>&nbsp;<span class="ident" id="2870872">Truncate</span><span class="op" id="2870880">(</span><span class="ident" id="2870881">n</span>&nbsp;<span class="builtintype" id="2870883">int</span><span class="op" id="2870886">)</span>&nbsp;<span class="op" id="2870888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2870891">b</span><span class="op" id="2870892">.</span><span class="ident" id="2870893">lastRead</span>&nbsp;<span class="op" id="2870902">=</span>&nbsp;<span class="ident" id="2870904">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870915">switch</span>&nbsp;<span class="op" id="2870922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2870925">case</span>&nbsp;<span class="ident" id="2870930">n</span>&nbsp;<span class="op" id="2870932">&lt;</span>&nbsp;<span class="num" id="2870934">0</span>&nbsp;<span class="op" id="2870936">||</span>&nbsp;<span class="ident" id="2870939">n</span>&nbsp;<span class="op" id="2870941">&gt;</span>&nbsp;<span class="ident" id="2870943">b</span><span class="op" id="2870944">.</span><span class="ident" id="2870945">Len</span><span class="op" id="2870948">(</span><span class="op" id="2870949">)</span><span class="op" id="2870950">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2870954">panic</span><span class="op" id="2870959">(</span><span class="string" id="2870960">&#34;bytes.Buffer:&nbsp;truncation&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="2870999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871002">case</span>&nbsp;<span class="ident" id="2871007">n</span>&nbsp;<span class="op" id="2871009">==</span>&nbsp;<span class="num" id="2871012">0</span><span class="op" id="2871013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871017">//&nbsp;Reuse&nbsp;buffer&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871042">b</span><span class="op" id="2871043">.</span><span class="ident" id="2871044">off</span>&nbsp;<span class="op" id="2871048">=</span>&nbsp;<span class="num" id="2871050">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871053">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871056">b</span><span class="op" id="2871057">.</span><span class="ident" id="2871058">buf</span>&nbsp;<span class="op" id="2871062">=</span>&nbsp;<span class="ident" id="2871064">b</span><span class="op" id="2871065">.</span><span class="ident" id="2871066">buf</span><span class="op" id="2871069">[</span><span class="num" id="2871070">0</span>&nbsp;<span class="op" id="2871072">:</span>&nbsp;<span class="ident" id="2871074">b</span><span class="op" id="2871075">.</span><span class="ident" id="2871076">off</span><span class="op" id="2871079">+</span><span class="ident" id="2871080">n</span><span class="op" id="2871081">]</span><br>
<span class="lineno"></span><span class="op" id="2871083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2871086">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;buffer&nbsp;so&nbsp;it&nbsp;has&nbsp;no&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="2871135">//&nbsp;b.Reset()&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;b.Truncate(0).</span><br>
<span class="lineno">75</span><span class="keyword" id="2871178">func</span>&nbsp;<span class="op" id="2871183">(</span><span class="ident" id="2871184">b</span>&nbsp;<span class="op" id="2871186">*</span><span class="ident" id="2871187">Buffer</span><span class="op" id="2871193">)</span>&nbsp;<span class="ident" id="2871195">Reset</span><span class="op" id="2871200">(</span><span class="op" id="2871201">)</span>&nbsp;<span class="op" id="2871203">{</span>&nbsp;<span class="ident" id="2871205">b</span><span class="op" id="2871206">.</span><span class="ident" id="2871207">Truncate</span><span class="op" id="2871215">(</span><span class="num" id="2871216">0</span><span class="op" id="2871217">)</span>&nbsp;<span class="op" id="2871219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2871222">//&nbsp;grow&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for&nbsp;n&nbsp;more&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2871284">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;where&nbsp;bytes&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2871339">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">80</span><span class="keyword" id="2871399">func</span>&nbsp;<span class="op" id="2871404">(</span><span class="ident" id="2871405">b</span>&nbsp;<span class="op" id="2871407">*</span><span class="ident" id="2871408">Buffer</span><span class="op" id="2871414">)</span>&nbsp;<span class="ident" id="2871416">grow</span><span class="op" id="2871420">(</span><span class="ident" id="2871421">n</span>&nbsp;<span class="builtintype" id="2871423">int</span><span class="op" id="2871426">)</span>&nbsp;<span class="builtintype" id="2871428">int</span>&nbsp;<span class="op" id="2871432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871435">m</span>&nbsp;<span class="op" id="2871437">:=</span>&nbsp;<span class="ident" id="2871440">b</span><span class="op" id="2871441">.</span><span class="ident" id="2871442">Len</span><span class="op" id="2871445">(</span><span class="op" id="2871446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871449">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871497">if</span>&nbsp;<span class="ident" id="2871500">m</span>&nbsp;<span class="op" id="2871502">==</span>&nbsp;<span class="num" id="2871505">0</span>&nbsp;<span class="op" id="2871507">&amp;&amp;</span>&nbsp;<span class="ident" id="2871510">b</span><span class="op" id="2871511">.</span><span class="ident" id="2871512">off</span>&nbsp;<span class="op" id="2871516">!=</span>&nbsp;<span class="num" id="2871519">0</span>&nbsp;<span class="op" id="2871521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871525">b</span><span class="op" id="2871526">.</span><span class="ident" id="2871527">Truncate</span><span class="op" id="2871535">(</span><span class="num" id="2871536">0</span><span class="op" id="2871537">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871543">if</span>&nbsp;<span class="builtinfunc" id="2871546">len</span><span class="op" id="2871549">(</span><span class="ident" id="2871550">b</span><span class="op" id="2871551">.</span><span class="ident" id="2871552">buf</span><span class="op" id="2871555">)</span><span class="op" id="2871556">+</span><span class="ident" id="2871557">n</span>&nbsp;<span class="op" id="2871559">&gt;</span>&nbsp;<span class="builtinfunc" id="2871561">cap</span><span class="op" id="2871564">(</span><span class="ident" id="2871565">b</span><span class="op" id="2871566">.</span><span class="ident" id="2871567">buf</span><span class="op" id="2871570">)</span>&nbsp;<span class="op" id="2871572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871576">var</span>&nbsp;<span class="ident" id="2871580">buf</span>&nbsp;<span class="op" id="2871584">[</span><span class="op" id="2871585">]</span><span class="builtintype" id="2871586">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2871593">if</span>&nbsp;<span class="ident" id="2871596">b</span><span class="op" id="2871597">.</span><span class="ident" id="2871598">buf</span>&nbsp;<span class="op" id="2871602">==</span>&nbsp;<span class="ident" id="2871605">nil</span>&nbsp;<span class="op" id="2871609">&amp;&amp;</span>&nbsp;<span class="ident" id="2871612">n</span>&nbsp;<span class="op" id="2871614">&lt;=</span>&nbsp;<span class="builtinfunc" id="2871617">len</span><span class="op" id="2871620">(</span><span class="ident" id="2871621">b</span><span class="op" id="2871622">.</span><span class="ident" id="2871623">bootstrap</span><span class="op" id="2871632">)</span>&nbsp;<span class="op" id="2871634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871639">buf</span>&nbsp;<span class="op" id="2871643">=</span>&nbsp;<span class="ident" id="2871645">b</span><span class="op" id="2871646">.</span><span class="ident" id="2871647">bootstrap</span><span class="op" id="2871656">[</span><span class="num" id="2871657">0</span><span class="op" id="2871658">:</span><span class="op" id="2871659">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871663">}</span>&nbsp;<span class="keyword" id="2871665">else</span>&nbsp;<span class="keyword" id="2871670">if</span>&nbsp;<span class="ident" id="2871673">m</span><span class="op" id="2871674">+</span><span class="ident" id="2871675">n</span>&nbsp;<span class="op" id="2871677">&lt;=</span>&nbsp;<span class="builtinfunc" id="2871680">cap</span><span class="op" id="2871683">(</span><span class="ident" id="2871684">b</span><span class="op" id="2871685">.</span><span class="ident" id="2871686">buf</span><span class="op" id="2871689">)</span><span class="op" id="2871690">/</span><span class="num" id="2871691">2</span>&nbsp;<span class="op" id="2871693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871698">//&nbsp;We&nbsp;can&nbsp;slide&nbsp;things&nbsp;down&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871757">//&nbsp;slice.&nbsp;We&nbsp;only&nbsp;need&nbsp;m+n&nbsp;&lt;=&nbsp;cap(b.buf)&nbsp;to&nbsp;slide,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871815">//&nbsp;we&nbsp;instead&nbsp;let&nbsp;capacity&nbsp;get&nbsp;twice&nbsp;as&nbsp;large&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871870">//&nbsp;don&#39;t&nbsp;spend&nbsp;all&nbsp;our&nbsp;time&nbsp;copying.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2871910">copy</span><span class="op" id="2871914">(</span><span class="ident" id="2871915">b</span><span class="op" id="2871916">.</span><span class="ident" id="2871917">buf</span><span class="op" id="2871920">[</span><span class="op" id="2871921">:</span><span class="op" id="2871922">]</span><span class="op" id="2871923">,</span>&nbsp;<span class="ident" id="2871925">b</span><span class="op" id="2871926">.</span><span class="ident" id="2871927">buf</span><span class="op" id="2871930">[</span><span class="ident" id="2871931">b</span><span class="op" id="2871932">.</span><span class="ident" id="2871933">off</span><span class="op" id="2871936">:</span><span class="op" id="2871937">]</span><span class="op" id="2871938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2871943">buf</span>&nbsp;<span class="op" id="2871947">=</span>&nbsp;<span class="ident" id="2871949">b</span><span class="op" id="2871950">.</span><span class="ident" id="2871951">buf</span><span class="op" id="2871954">[</span><span class="op" id="2871955">:</span><span class="ident" id="2871956">m</span><span class="op" id="2871957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2871961">}</span>&nbsp;<span class="keyword" id="2871963">else</span>&nbsp;<span class="op" id="2871968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2871973">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;anywhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872005">buf</span>&nbsp;<span class="op" id="2872009">=</span>&nbsp;<span class="ident" id="2872011">makeSlice</span><span class="op" id="2872020">(</span><span class="num" id="2872021">2</span><span class="op" id="2872022">*</span><span class="builtinfunc" id="2872023">cap</span><span class="op" id="2872026">(</span><span class="ident" id="2872027">b</span><span class="op" id="2872028">.</span><span class="ident" id="2872029">buf</span><span class="op" id="2872032">)</span>&nbsp;<span class="op" id="2872034">+</span>&nbsp;<span class="ident" id="2872036">n</span><span class="op" id="2872037">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2872042">copy</span><span class="op" id="2872046">(</span><span class="ident" id="2872047">buf</span><span class="op" id="2872050">,</span>&nbsp;<span class="ident" id="2872052">b</span><span class="op" id="2872053">.</span><span class="ident" id="2872054">buf</span><span class="op" id="2872057">[</span><span class="ident" id="2872058">b</span><span class="op" id="2872059">.</span><span class="ident" id="2872060">off</span><span class="op" id="2872063">:</span><span class="op" id="2872064">]</span><span class="op" id="2872065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872073">b</span><span class="op" id="2872074">.</span><span class="ident" id="2872075">buf</span>&nbsp;<span class="op" id="2872079">=</span>&nbsp;<span class="ident" id="2872081">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872087">b</span><span class="op" id="2872088">.</span><span class="ident" id="2872089">off</span>&nbsp;<span class="op" id="2872093">=</span>&nbsp;<span class="num" id="2872095">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872098">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872101">b</span><span class="op" id="2872102">.</span><span class="ident" id="2872103">buf</span>&nbsp;<span class="op" id="2872107">=</span>&nbsp;<span class="ident" id="2872109">b</span><span class="op" id="2872110">.</span><span class="ident" id="2872111">buf</span><span class="op" id="2872114">[</span><span class="num" id="2872115">0</span>&nbsp;<span class="op" id="2872117">:</span>&nbsp;<span class="ident" id="2872119">b</span><span class="op" id="2872120">.</span><span class="ident" id="2872121">off</span><span class="op" id="2872124">+</span><span class="ident" id="2872125">m</span><span class="op" id="2872126">+</span><span class="ident" id="2872127">n</span><span class="op" id="2872128">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872131">return</span>&nbsp;<span class="ident" id="2872138">b</span><span class="op" id="2872139">.</span><span class="ident" id="2872140">off</span>&nbsp;<span class="op" id="2872144">+</span>&nbsp;<span class="ident" id="2872146">m</span><br>
<span class="lineno"></span><span class="op" id="2872148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2872151">//&nbsp;Grow&nbsp;grows&nbsp;the&nbsp;buffer&#39;s&nbsp;capacity,&nbsp;if&nbsp;necessary,&nbsp;to&nbsp;guarantee&nbsp;space&nbsp;for</span><br>
<span class="lineno">110</span><span class="comment" id="2872225">//&nbsp;another&nbsp;n&nbsp;bytes.&nbsp;After&nbsp;Grow(n),&nbsp;at&nbsp;least&nbsp;n&nbsp;bytes&nbsp;can&nbsp;be&nbsp;written&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2872299">//&nbsp;buffer&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="2872337">//&nbsp;If&nbsp;n&nbsp;is&nbsp;negative,&nbsp;Grow&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="comment" id="2872375">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;can&#39;t&nbsp;grow&nbsp;it&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2872435">func</span>&nbsp;<span class="op" id="2872440">(</span><span class="ident" id="2872441">b</span>&nbsp;<span class="op" id="2872443">*</span><span class="ident" id="2872444">Buffer</span><span class="op" id="2872450">)</span>&nbsp;<span class="ident" id="2872452">Grow</span><span class="op" id="2872456">(</span><span class="ident" id="2872457">n</span>&nbsp;<span class="builtintype" id="2872459">int</span><span class="op" id="2872462">)</span>&nbsp;<span class="op" id="2872464">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872467">if</span>&nbsp;<span class="ident" id="2872470">n</span>&nbsp;<span class="op" id="2872472">&lt;</span>&nbsp;<span class="num" id="2872474">0</span>&nbsp;<span class="op" id="2872476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2872480">panic</span><span class="op" id="2872485">(</span><span class="string" id="2872486">&#34;bytes.Buffer.Grow:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2872521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2872524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872527">m</span>&nbsp;<span class="op" id="2872529">:=</span>&nbsp;<span class="ident" id="2872532">b</span><span class="op" id="2872533">.</span><span class="ident" id="2872534">grow</span><span class="op" id="2872538">(</span><span class="ident" id="2872539">n</span><span class="op" id="2872540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872543">b</span><span class="op" id="2872544">.</span><span class="ident" id="2872545">buf</span>&nbsp;<span class="op" id="2872549">=</span>&nbsp;<span class="ident" id="2872551">b</span><span class="op" id="2872552">.</span><span class="ident" id="2872553">buf</span><span class="op" id="2872556">[</span><span class="num" id="2872557">0</span><span class="op" id="2872558">:</span><span class="ident" id="2872559">m</span><span class="op" id="2872560">]</span><br>
<span class="lineno">120</span><span class="op" id="2872562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2872565">//&nbsp;Write&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2872637">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;p;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2872713">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;Write&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">125</span><span class="keyword" id="2872777">func</span>&nbsp;<span class="op" id="2872782">(</span><span class="ident" id="2872783">b</span>&nbsp;<span class="op" id="2872785">*</span><span class="ident" id="2872786">Buffer</span><span class="op" id="2872792">)</span>&nbsp;<span class="ident" id="2872794">Write</span><span class="op" id="2872799">(</span><span class="ident" id="2872800">p</span>&nbsp;<span class="op" id="2872802">[</span><span class="op" id="2872803">]</span><span class="builtintype" id="2872804">byte</span><span class="op" id="2872808">)</span>&nbsp;<span class="op" id="2872810">(</span><span class="ident" id="2872811">n</span>&nbsp;<span class="builtintype" id="2872813">int</span><span class="op" id="2872816">,</span>&nbsp;<span class="ident" id="2872818">err</span>&nbsp;<span class="builtintype" id="2872822">error</span><span class="op" id="2872827">)</span>&nbsp;<span class="op" id="2872829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872832">b</span><span class="op" id="2872833">.</span><span class="ident" id="2872834">lastRead</span>&nbsp;<span class="op" id="2872843">=</span>&nbsp;<span class="ident" id="2872845">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2872856">m</span>&nbsp;<span class="op" id="2872858">:=</span>&nbsp;<span class="ident" id="2872861">b</span><span class="op" id="2872862">.</span><span class="ident" id="2872863">grow</span><span class="op" id="2872867">(</span><span class="builtinfunc" id="2872868">len</span><span class="op" id="2872871">(</span><span class="ident" id="2872872">p</span><span class="op" id="2872873">)</span><span class="op" id="2872874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2872877">return</span>&nbsp;<span class="builtinfunc" id="2872884">copy</span><span class="op" id="2872888">(</span><span class="ident" id="2872889">b</span><span class="op" id="2872890">.</span><span class="ident" id="2872891">buf</span><span class="op" id="2872894">[</span><span class="ident" id="2872895">m</span><span class="op" id="2872896">:</span><span class="op" id="2872897">]</span><span class="op" id="2872898">,</span>&nbsp;<span class="ident" id="2872900">p</span><span class="op" id="2872901">)</span><span class="op" id="2872902">,</span>&nbsp;<span class="ident" id="2872904">nil</span><br>
<span class="lineno"></span><span class="op" id="2872908">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="2872911">//&nbsp;WriteString&nbsp;appends&nbsp;the&nbsp;contents&nbsp;of&nbsp;s&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2872989">//&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;length&nbsp;of&nbsp;s;&nbsp;err&nbsp;is&nbsp;always&nbsp;nil.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2873065">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteString&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2873135">func</span>&nbsp;<span class="op" id="2873140">(</span><span class="ident" id="2873141">b</span>&nbsp;<span class="op" id="2873143">*</span><span class="ident" id="2873144">Buffer</span><span class="op" id="2873150">)</span>&nbsp;<span class="ident" id="2873152">WriteString</span><span class="op" id="2873163">(</span><span class="ident" id="2873164">s</span>&nbsp;<span class="builtintype" id="2873166">string</span><span class="op" id="2873172">)</span>&nbsp;<span class="op" id="2873174">(</span><span class="ident" id="2873175">n</span>&nbsp;<span class="builtintype" id="2873177">int</span><span class="op" id="2873180">,</span>&nbsp;<span class="ident" id="2873182">err</span>&nbsp;<span class="builtintype" id="2873186">error</span><span class="op" id="2873191">)</span>&nbsp;<span class="op" id="2873193">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873196">b</span><span class="op" id="2873197">.</span><span class="ident" id="2873198">lastRead</span>&nbsp;<span class="op" id="2873207">=</span>&nbsp;<span class="ident" id="2873209">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873220">m</span>&nbsp;<span class="op" id="2873222">:=</span>&nbsp;<span class="ident" id="2873225">b</span><span class="op" id="2873226">.</span><span class="ident" id="2873227">grow</span><span class="op" id="2873231">(</span><span class="builtinfunc" id="2873232">len</span><span class="op" id="2873235">(</span><span class="ident" id="2873236">s</span><span class="op" id="2873237">)</span><span class="op" id="2873238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873241">return</span>&nbsp;<span class="builtinfunc" id="2873248">copy</span><span class="op" id="2873252">(</span><span class="ident" id="2873253">b</span><span class="op" id="2873254">.</span><span class="ident" id="2873255">buf</span><span class="op" id="2873258">[</span><span class="ident" id="2873259">m</span><span class="op" id="2873260">:</span><span class="op" id="2873261">]</span><span class="op" id="2873262">,</span>&nbsp;<span class="ident" id="2873264">s</span><span class="op" id="2873265">)</span><span class="op" id="2873266">,</span>&nbsp;<span class="ident" id="2873268">nil</span><br>
<span class="lineno"></span><span class="op" id="2873272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2873275">//&nbsp;MinRead&nbsp;is&nbsp;the&nbsp;minimum&nbsp;slice&nbsp;size&nbsp;passed&nbsp;to&nbsp;a&nbsp;Read&nbsp;call&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2873337">//&nbsp;Buffer.ReadFrom.&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;Buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;MinRead&nbsp;bytes&nbsp;beyond</span><br>
<span class="lineno"></span><span class="comment" id="2873414">//&nbsp;what&nbsp;is&nbsp;required&nbsp;to&nbsp;hold&nbsp;the&nbsp;contents&nbsp;of&nbsp;r,&nbsp;ReadFrom&nbsp;will&nbsp;not&nbsp;grow&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2873488">//&nbsp;underlying&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2873510">const</span>&nbsp;<span class="ident" id="2873516">MinRead</span>&nbsp;<span class="op" id="2873524">=</span>&nbsp;<span class="num" id="2873526">512</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2873531">//&nbsp;ReadFrom&nbsp;reads&nbsp;data&nbsp;from&nbsp;r&nbsp;until&nbsp;EOF&nbsp;and&nbsp;appends&nbsp;it&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing</span><br>
<span class="lineno"></span><span class="comment" id="2873609">//&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="2873686">//&nbsp;error&nbsp;except&nbsp;io.EOF&nbsp;encountered&nbsp;during&nbsp;the&nbsp;read&nbsp;is&nbsp;also&nbsp;returned.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2873762">//&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;ReadFrom&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno">150</span><span class="keyword" id="2873829">func</span>&nbsp;<span class="op" id="2873834">(</span><span class="ident" id="2873835">b</span>&nbsp;<span class="op" id="2873837">*</span><span class="ident" id="2873838">Buffer</span><span class="op" id="2873844">)</span>&nbsp;<span class="ident" id="2873846">ReadFrom</span><span class="op" id="2873854">(</span><span class="ident" id="2873855">r</span>&nbsp;<span class="ident" id="2873857">io</span><span class="op" id="2873859">.</span><span class="ident" id="2873860">Reader</span><span class="op" id="2873866">)</span>&nbsp;<span class="op" id="2873868">(</span><span class="ident" id="2873869">n</span>&nbsp;<span class="ident" id="2873871">int64</span><span class="op" id="2873876">,</span>&nbsp;<span class="ident" id="2873878">err</span>&nbsp;<span class="builtintype" id="2873882">error</span><span class="op" id="2873887">)</span>&nbsp;<span class="op" id="2873889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873892">b</span><span class="op" id="2873893">.</span><span class="ident" id="2873894">lastRead</span>&nbsp;<span class="op" id="2873903">=</span>&nbsp;<span class="ident" id="2873905">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2873916">//&nbsp;If&nbsp;buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2873964">if</span>&nbsp;<span class="ident" id="2873967">b</span><span class="op" id="2873968">.</span><span class="ident" id="2873969">off</span>&nbsp;<span class="op" id="2873973">&gt;=</span>&nbsp;<span class="builtinfunc" id="2873976">len</span><span class="op" id="2873979">(</span><span class="ident" id="2873980">b</span><span class="op" id="2873981">.</span><span class="ident" id="2873982">buf</span><span class="op" id="2873985">)</span>&nbsp;<span class="op" id="2873987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2873991">b</span><span class="op" id="2873992">.</span><span class="ident" id="2873993">Truncate</span><span class="op" id="2874001">(</span><span class="num" id="2874002">0</span><span class="op" id="2874003">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874009">for</span>&nbsp;<span class="op" id="2874013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874017">if</span>&nbsp;<span class="ident" id="2874020">free</span>&nbsp;<span class="op" id="2874025">:=</span>&nbsp;<span class="builtinfunc" id="2874028">cap</span><span class="op" id="2874031">(</span><span class="ident" id="2874032">b</span><span class="op" id="2874033">.</span><span class="ident" id="2874034">buf</span><span class="op" id="2874037">)</span>&nbsp;<span class="op" id="2874039">-</span>&nbsp;<span class="builtinfunc" id="2874041">len</span><span class="op" id="2874044">(</span><span class="ident" id="2874045">b</span><span class="op" id="2874046">.</span><span class="ident" id="2874047">buf</span><span class="op" id="2874050">)</span><span class="op" id="2874051">;</span>&nbsp;<span class="ident" id="2874053">free</span>&nbsp;<span class="op" id="2874058">&lt;</span>&nbsp;<span class="ident" id="2874060">MinRead</span>&nbsp;<span class="op" id="2874068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2874073">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;at&nbsp;end</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874103">newBuf</span>&nbsp;<span class="op" id="2874110">:=</span>&nbsp;<span class="ident" id="2874113">b</span><span class="op" id="2874114">.</span><span class="ident" id="2874115">buf</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874122">if</span>&nbsp;<span class="ident" id="2874125">b</span><span class="op" id="2874126">.</span><span class="ident" id="2874127">off</span><span class="op" id="2874130">+</span><span class="ident" id="2874131">free</span>&nbsp;<span class="op" id="2874136">&lt;</span>&nbsp;<span class="ident" id="2874138">MinRead</span>&nbsp;<span class="op" id="2874146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2874152">//&nbsp;not&nbsp;enough&nbsp;space&nbsp;using&nbsp;beginning&nbsp;of&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2874203">//&nbsp;double&nbsp;buffer&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874233">newBuf</span>&nbsp;<span class="op" id="2874240">=</span>&nbsp;<span class="ident" id="2874242">makeSlice</span><span class="op" id="2874251">(</span><span class="num" id="2874252">2</span><span class="op" id="2874253">*</span><span class="builtinfunc" id="2874254">cap</span><span class="op" id="2874257">(</span><span class="ident" id="2874258">b</span><span class="op" id="2874259">.</span><span class="ident" id="2874260">buf</span><span class="op" id="2874263">)</span>&nbsp;<span class="op" id="2874265">+</span>&nbsp;<span class="ident" id="2874267">MinRead</span><span class="op" id="2874274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874279">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2874284">copy</span><span class="op" id="2874288">(</span><span class="ident" id="2874289">newBuf</span><span class="op" id="2874295">,</span>&nbsp;<span class="ident" id="2874297">b</span><span class="op" id="2874298">.</span><span class="ident" id="2874299">buf</span><span class="op" id="2874302">[</span><span class="ident" id="2874303">b</span><span class="op" id="2874304">.</span><span class="ident" id="2874305">off</span><span class="op" id="2874308">:</span><span class="op" id="2874309">]</span><span class="op" id="2874310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874315">b</span><span class="op" id="2874316">.</span><span class="ident" id="2874317">buf</span>&nbsp;<span class="op" id="2874321">=</span>&nbsp;<span class="ident" id="2874323">newBuf</span><span class="op" id="2874329">[</span><span class="op" id="2874330">:</span><span class="builtinfunc" id="2874331">len</span><span class="op" id="2874334">(</span><span class="ident" id="2874335">b</span><span class="op" id="2874336">.</span><span class="ident" id="2874337">buf</span><span class="op" id="2874340">)</span><span class="op" id="2874341">-</span><span class="ident" id="2874342">b</span><span class="op" id="2874343">.</span><span class="ident" id="2874344">off</span><span class="op" id="2874347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874352">b</span><span class="op" id="2874353">.</span><span class="ident" id="2874354">off</span>&nbsp;<span class="op" id="2874358">=</span>&nbsp;<span class="num" id="2874360">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874368">m</span><span class="op" id="2874369">,</span>&nbsp;<span class="ident" id="2874371">e</span>&nbsp;<span class="op" id="2874373">:=</span>&nbsp;<span class="ident" id="2874376">r</span><span class="op" id="2874377">.</span><span class="ident" id="2874378">Read</span><span class="op" id="2874382">(</span><span class="ident" id="2874383">b</span><span class="op" id="2874384">.</span><span class="ident" id="2874385">buf</span><span class="op" id="2874388">[</span><span class="builtinfunc" id="2874389">len</span><span class="op" id="2874392">(</span><span class="ident" id="2874393">b</span><span class="op" id="2874394">.</span><span class="ident" id="2874395">buf</span><span class="op" id="2874398">)</span><span class="op" id="2874399">:</span><span class="builtinfunc" id="2874400">cap</span><span class="op" id="2874403">(</span><span class="ident" id="2874404">b</span><span class="op" id="2874405">.</span><span class="ident" id="2874406">buf</span><span class="op" id="2874409">)</span><span class="op" id="2874410">]</span><span class="op" id="2874411">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874415">b</span><span class="op" id="2874416">.</span><span class="ident" id="2874417">buf</span>&nbsp;<span class="op" id="2874421">=</span>&nbsp;<span class="ident" id="2874423">b</span><span class="op" id="2874424">.</span><span class="ident" id="2874425">buf</span><span class="op" id="2874428">[</span><span class="num" id="2874429">0</span>&nbsp;<span class="op" id="2874431">:</span>&nbsp;<span class="builtinfunc" id="2874433">len</span><span class="op" id="2874436">(</span><span class="ident" id="2874437">b</span><span class="op" id="2874438">.</span><span class="ident" id="2874439">buf</span><span class="op" id="2874442">)</span><span class="op" id="2874443">+</span><span class="ident" id="2874444">m</span><span class="op" id="2874445">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2874449">n</span>&nbsp;<span class="op" id="2874451">+=</span>&nbsp;<span class="ident" id="2874454">int64</span><span class="op" id="2874459">(</span><span class="ident" id="2874460">m</span><span class="op" id="2874461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874465">if</span>&nbsp;<span class="ident" id="2874468">e</span>&nbsp;<span class="op" id="2874470">==</span>&nbsp;<span class="ident" id="2874473">io</span><span class="op" id="2874475">.</span><span class="ident" id="2874476">EOF</span>&nbsp;<span class="op" id="2874480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874485">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874493">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874497">if</span>&nbsp;<span class="ident" id="2874500">e</span>&nbsp;<span class="op" id="2874502">!=</span>&nbsp;<span class="ident" id="2874505">nil</span>&nbsp;<span class="op" id="2874509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874514">return</span>&nbsp;<span class="ident" id="2874521">n</span><span class="op" id="2874522">,</span>&nbsp;<span class="ident" id="2874524">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874534">return</span>&nbsp;<span class="ident" id="2874541">n</span><span class="op" id="2874542">,</span>&nbsp;<span class="ident" id="2874544">nil</span>&nbsp;<span class="comment" id="2874548">//&nbsp;err&nbsp;is&nbsp;EOF,&nbsp;so&nbsp;return&nbsp;nil&nbsp;explicitly</span><br>
<span class="lineno">180</span><span class="op" id="2874588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2874591">//&nbsp;makeSlice&nbsp;allocates&nbsp;a&nbsp;slice&nbsp;of&nbsp;size&nbsp;n.&nbsp;If&nbsp;the&nbsp;allocation&nbsp;fails,&nbsp;it&nbsp;panics</span><br>
<span class="lineno"></span><span class="comment" id="2874668">//&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2874689">func</span>&nbsp;<span class="ident" id="2874694">makeSlice</span><span class="op" id="2874703">(</span><span class="ident" id="2874704">n</span>&nbsp;<span class="builtintype" id="2874706">int</span><span class="op" id="2874709">)</span>&nbsp;<span class="op" id="2874711">[</span><span class="op" id="2874712">]</span><span class="builtintype" id="2874713">byte</span>&nbsp;<span class="op" id="2874718">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2874721">//&nbsp;If&nbsp;the&nbsp;make&nbsp;fails,&nbsp;give&nbsp;a&nbsp;known&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874764">defer</span>&nbsp;<span class="keyword" id="2874770">func</span><span class="op" id="2874774">(</span><span class="op" id="2874775">)</span>&nbsp;<span class="op" id="2874777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874781">if</span>&nbsp;<span class="builtinfunc" id="2874784">recover</span><span class="op" id="2874791">(</span><span class="op" id="2874792">)</span>&nbsp;<span class="op" id="2874794">!=</span>&nbsp;<span class="ident" id="2874797">nil</span>&nbsp;<span class="op" id="2874801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2874806">panic</span><span class="op" id="2874811">(</span><span class="ident" id="2874812">ErrTooLarge</span><span class="op" id="2874823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874827">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2874830">}</span><span class="op" id="2874831">(</span><span class="op" id="2874832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2874835">return</span>&nbsp;<span class="builtinfunc" id="2874842">make</span><span class="op" id="2874846">(</span><span class="op" id="2874847">[</span><span class="op" id="2874848">]</span><span class="builtintype" id="2874849">byte</span><span class="op" id="2874853">,</span>&nbsp;<span class="ident" id="2874855">n</span><span class="op" id="2874856">)</span><br>
<span class="lineno"></span><span class="op" id="2874858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2874861">//&nbsp;WriteTo&nbsp;writes&nbsp;data&nbsp;to&nbsp;w&nbsp;until&nbsp;the&nbsp;buffer&nbsp;is&nbsp;drained&nbsp;or&nbsp;an&nbsp;error&nbsp;occurs.</span><br>
<span class="lineno">195</span><span class="comment" id="2874937">//&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written;&nbsp;it&nbsp;always&nbsp;fits&nbsp;into&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2875014">//&nbsp;int,&nbsp;but&nbsp;it&nbsp;is&nbsp;int64&nbsp;to&nbsp;match&nbsp;the&nbsp;io.WriterTo&nbsp;interface.&nbsp;Any&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="2875084">//&nbsp;encountered&nbsp;during&nbsp;the&nbsp;write&nbsp;is&nbsp;also&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="2875134">func</span>&nbsp;<span class="op" id="2875139">(</span><span class="ident" id="2875140">b</span>&nbsp;<span class="op" id="2875142">*</span><span class="ident" id="2875143">Buffer</span><span class="op" id="2875149">)</span>&nbsp;<span class="ident" id="2875151">WriteTo</span><span class="op" id="2875158">(</span><span class="ident" id="2875159">w</span>&nbsp;<span class="ident" id="2875161">io</span><span class="op" id="2875163">.</span><span class="ident" id="2875164">Writer</span><span class="op" id="2875170">)</span>&nbsp;<span class="op" id="2875172">(</span><span class="ident" id="2875173">n</span>&nbsp;<span class="ident" id="2875175">int64</span><span class="op" id="2875180">,</span>&nbsp;<span class="ident" id="2875182">err</span>&nbsp;<span class="builtintype" id="2875186">error</span><span class="op" id="2875191">)</span>&nbsp;<span class="op" id="2875193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875196">b</span><span class="op" id="2875197">.</span><span class="ident" id="2875198">lastRead</span>&nbsp;<span class="op" id="2875207">=</span>&nbsp;<span class="ident" id="2875209">opInvalid</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875220">if</span>&nbsp;<span class="ident" id="2875223">b</span><span class="op" id="2875224">.</span><span class="ident" id="2875225">off</span>&nbsp;<span class="op" id="2875229">&lt;</span>&nbsp;<span class="builtinfunc" id="2875231">len</span><span class="op" id="2875234">(</span><span class="ident" id="2875235">b</span><span class="op" id="2875236">.</span><span class="ident" id="2875237">buf</span><span class="op" id="2875240">)</span>&nbsp;<span class="op" id="2875242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875246">nBytes</span>&nbsp;<span class="op" id="2875253">:=</span>&nbsp;<span class="ident" id="2875256">b</span><span class="op" id="2875257">.</span><span class="ident" id="2875258">Len</span><span class="op" id="2875261">(</span><span class="op" id="2875262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875266">m</span><span class="op" id="2875267">,</span>&nbsp;<span class="ident" id="2875269">e</span>&nbsp;<span class="op" id="2875271">:=</span>&nbsp;<span class="ident" id="2875274">w</span><span class="op" id="2875275">.</span><span class="ident" id="2875276">Write</span><span class="op" id="2875281">(</span><span class="ident" id="2875282">b</span><span class="op" id="2875283">.</span><span class="ident" id="2875284">buf</span><span class="op" id="2875287">[</span><span class="ident" id="2875288">b</span><span class="op" id="2875289">.</span><span class="ident" id="2875290">off</span><span class="op" id="2875293">:</span><span class="op" id="2875294">]</span><span class="op" id="2875295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875299">if</span>&nbsp;<span class="ident" id="2875302">m</span>&nbsp;<span class="op" id="2875304">&gt;</span>&nbsp;<span class="ident" id="2875306">nBytes</span>&nbsp;<span class="op" id="2875313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2875318">panic</span><span class="op" id="2875323">(</span><span class="string" id="2875324">&#34;bytes.Buffer.WriteTo:&nbsp;invalid&nbsp;Write&nbsp;count&#34;</span><span class="op" id="2875367">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875375">b</span><span class="op" id="2875376">.</span><span class="ident" id="2875377">off</span>&nbsp;<span class="op" id="2875381">+=</span>&nbsp;<span class="ident" id="2875384">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875388">n</span>&nbsp;<span class="op" id="2875390">=</span>&nbsp;<span class="ident" id="2875392">int64</span><span class="op" id="2875397">(</span><span class="ident" id="2875398">m</span><span class="op" id="2875399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875403">if</span>&nbsp;<span class="ident" id="2875406">e</span>&nbsp;<span class="op" id="2875408">!=</span>&nbsp;<span class="ident" id="2875411">nil</span>&nbsp;<span class="op" id="2875415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875420">return</span>&nbsp;<span class="ident" id="2875427">n</span><span class="op" id="2875428">,</span>&nbsp;<span class="ident" id="2875430">e</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2875438">//&nbsp;all&nbsp;bytes&nbsp;should&nbsp;have&nbsp;been&nbsp;written,&nbsp;by&nbsp;definition&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2875496">//&nbsp;Write&nbsp;method&nbsp;in&nbsp;io.Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875527">if</span>&nbsp;<span class="ident" id="2875530">m</span>&nbsp;<span class="op" id="2875532">!=</span>&nbsp;<span class="ident" id="2875535">nBytes</span>&nbsp;<span class="op" id="2875542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875547">return</span>&nbsp;<span class="ident" id="2875554">n</span><span class="op" id="2875555">,</span>&nbsp;<span class="ident" id="2875557">io</span><span class="op" id="2875559">.</span><span class="ident" id="2875560">ErrShortWrite</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2875579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2875582">//&nbsp;Buffer&nbsp;is&nbsp;now&nbsp;empty;&nbsp;reset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875614">b</span><span class="op" id="2875615">.</span><span class="ident" id="2875616">Truncate</span><span class="op" id="2875624">(</span><span class="num" id="2875625">0</span><span class="op" id="2875626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875629">return</span><br>
<span class="lineno">220</span><span class="op" id="2875636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875639">//&nbsp;WriteByte&nbsp;appends&nbsp;the&nbsp;byte&nbsp;c&nbsp;to&nbsp;the&nbsp;buffer,&nbsp;growing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span><span class="comment" id="2875716">//&nbsp;The&nbsp;returned&nbsp;error&nbsp;is&nbsp;always&nbsp;nil,&nbsp;but&nbsp;is&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="2875793">//&nbsp;WriteByte.&nbsp;If&nbsp;the&nbsp;buffer&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteByte&nbsp;will&nbsp;panic&nbsp;with</span><br>
<span class="lineno">225</span><span class="comment" id="2875866">//&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2875882">func</span>&nbsp;<span class="op" id="2875887">(</span><span class="ident" id="2875888">b</span>&nbsp;<span class="op" id="2875890">*</span><span class="ident" id="2875891">Buffer</span><span class="op" id="2875897">)</span>&nbsp;<span class="ident" id="2875899">WriteByte</span><span class="op" id="2875908">(</span><span class="ident" id="2875909">c</span>&nbsp;<span class="builtintype" id="2875911">byte</span><span class="op" id="2875915">)</span>&nbsp;<span class="builtintype" id="2875917">error</span>&nbsp;<span class="op" id="2875923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875926">b</span><span class="op" id="2875927">.</span><span class="ident" id="2875928">lastRead</span>&nbsp;<span class="op" id="2875937">=</span>&nbsp;<span class="ident" id="2875939">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875950">m</span>&nbsp;<span class="op" id="2875952">:=</span>&nbsp;<span class="ident" id="2875955">b</span><span class="op" id="2875956">.</span><span class="ident" id="2875957">grow</span><span class="op" id="2875961">(</span><span class="num" id="2875962">1</span><span class="op" id="2875963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2875966">b</span><span class="op" id="2875967">.</span><span class="ident" id="2875968">buf</span><span class="op" id="2875971">[</span><span class="ident" id="2875972">m</span><span class="op" id="2875973">]</span>&nbsp;<span class="op" id="2875975">=</span>&nbsp;<span class="ident" id="2875977">c</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2875980">return</span>&nbsp;<span class="ident" id="2875987">nil</span><br>
<span class="lineno"></span><span class="op" id="2875991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2875994">//&nbsp;WriteRune&nbsp;appends&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;r&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2876065">//&nbsp;buffer,&nbsp;returning&nbsp;its&nbsp;length&nbsp;and&nbsp;an&nbsp;error,&nbsp;which&nbsp;is&nbsp;always&nbsp;nil&nbsp;but&nbsp;is</span><br>
<span class="lineno">235</span><span class="comment" id="2876138">//&nbsp;included&nbsp;to&nbsp;match&nbsp;bufio.Writer&#39;s&nbsp;WriteRune.&nbsp;The&nbsp;buffer&nbsp;is&nbsp;grown&nbsp;as&nbsp;needed;</span><br>
<span class="lineno"></span><span class="comment" id="2876216">//&nbsp;if&nbsp;it&nbsp;becomes&nbsp;too&nbsp;large,&nbsp;WriteRune&nbsp;will&nbsp;panic&nbsp;with&nbsp;ErrTooLarge.</span><br>
<span class="lineno"></span><span class="keyword" id="2876283">func</span>&nbsp;<span class="op" id="2876288">(</span><span class="ident" id="2876289">b</span>&nbsp;<span class="op" id="2876291">*</span><span class="ident" id="2876292">Buffer</span><span class="op" id="2876298">)</span>&nbsp;<span class="ident" id="2876300">WriteRune</span><span class="op" id="2876309">(</span><span class="ident" id="2876310">r</span>&nbsp;<span class="builtintype" id="2876312">rune</span><span class="op" id="2876316">)</span>&nbsp;<span class="op" id="2876318">(</span><span class="ident" id="2876319">n</span>&nbsp;<span class="builtintype" id="2876321">int</span><span class="op" id="2876324">,</span>&nbsp;<span class="ident" id="2876326">err</span>&nbsp;<span class="builtintype" id="2876330">error</span><span class="op" id="2876335">)</span>&nbsp;<span class="op" id="2876337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876340">if</span>&nbsp;<span class="ident" id="2876343">r</span>&nbsp;<span class="op" id="2876345">&lt;</span>&nbsp;<span class="ident" id="2876347">utf8</span><span class="op" id="2876351">.</span><span class="ident" id="2876352">RuneSelf</span>&nbsp;<span class="op" id="2876361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876365">b</span><span class="op" id="2876366">.</span><span class="ident" id="2876367">WriteByte</span><span class="op" id="2876376">(</span><span class="builtintype" id="2876377">byte</span><span class="op" id="2876381">(</span><span class="ident" id="2876382">r</span><span class="op" id="2876383">)</span><span class="op" id="2876384">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876388">return</span>&nbsp;<span class="num" id="2876395">1</span><span class="op" id="2876396">,</span>&nbsp;<span class="ident" id="2876398">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876406">n</span>&nbsp;<span class="op" id="2876408">=</span>&nbsp;<span class="ident" id="2876410">utf8</span><span class="op" id="2876414">.</span><span class="ident" id="2876415">EncodeRune</span><span class="op" id="2876425">(</span><span class="ident" id="2876426">b</span><span class="op" id="2876427">.</span><span class="ident" id="2876428">runeBytes</span><span class="op" id="2876437">[</span><span class="num" id="2876438">0</span><span class="op" id="2876439">:</span><span class="op" id="2876440">]</span><span class="op" id="2876441">,</span>&nbsp;<span class="ident" id="2876443">r</span><span class="op" id="2876444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876447">b</span><span class="op" id="2876448">.</span><span class="ident" id="2876449">Write</span><span class="op" id="2876454">(</span><span class="ident" id="2876455">b</span><span class="op" id="2876456">.</span><span class="ident" id="2876457">runeBytes</span><span class="op" id="2876466">[</span><span class="num" id="2876467">0</span><span class="op" id="2876468">:</span><span class="ident" id="2876469">n</span><span class="op" id="2876470">]</span><span class="op" id="2876471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876474">return</span>&nbsp;<span class="ident" id="2876481">n</span><span class="op" id="2876482">,</span>&nbsp;<span class="ident" id="2876484">nil</span><br>
<span class="lineno">245</span><span class="op" id="2876488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2876491">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;next&nbsp;len(p)&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer&nbsp;or&nbsp;until&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="2876563">//&nbsp;is&nbsp;drained.&nbsp;&nbsp;The&nbsp;return&nbsp;value&nbsp;n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read.&nbsp;&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2876635">//&nbsp;buffer&nbsp;has&nbsp;no&nbsp;data&nbsp;to&nbsp;return,&nbsp;err&nbsp;is&nbsp;io.EOF&nbsp;(unless&nbsp;len(p)&nbsp;is&nbsp;zero);</span><br>
<span class="lineno">250</span><span class="comment" id="2876707">//&nbsp;otherwise&nbsp;it&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2876731">func</span>&nbsp;<span class="op" id="2876736">(</span><span class="ident" id="2876737">b</span>&nbsp;<span class="op" id="2876739">*</span><span class="ident" id="2876740">Buffer</span><span class="op" id="2876746">)</span>&nbsp;<span class="ident" id="2876748">Read</span><span class="op" id="2876752">(</span><span class="ident" id="2876753">p</span>&nbsp;<span class="op" id="2876755">[</span><span class="op" id="2876756">]</span><span class="builtintype" id="2876757">byte</span><span class="op" id="2876761">)</span>&nbsp;<span class="op" id="2876763">(</span><span class="ident" id="2876764">n</span>&nbsp;<span class="builtintype" id="2876766">int</span><span class="op" id="2876769">,</span>&nbsp;<span class="ident" id="2876771">err</span>&nbsp;<span class="builtintype" id="2876775">error</span><span class="op" id="2876780">)</span>&nbsp;<span class="op" id="2876782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876785">b</span><span class="op" id="2876786">.</span><span class="ident" id="2876787">lastRead</span>&nbsp;<span class="op" id="2876796">=</span>&nbsp;<span class="ident" id="2876798">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876809">if</span>&nbsp;<span class="ident" id="2876812">b</span><span class="op" id="2876813">.</span><span class="ident" id="2876814">off</span>&nbsp;<span class="op" id="2876818">&gt;=</span>&nbsp;<span class="builtinfunc" id="2876821">len</span><span class="op" id="2876824">(</span><span class="ident" id="2876825">b</span><span class="op" id="2876826">.</span><span class="ident" id="2876827">buf</span><span class="op" id="2876830">)</span>&nbsp;<span class="op" id="2876832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2876836">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876882">b</span><span class="op" id="2876883">.</span><span class="ident" id="2876884">Truncate</span><span class="op" id="2876892">(</span><span class="num" id="2876893">0</span><span class="op" id="2876894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876898">if</span>&nbsp;<span class="builtinfunc" id="2876901">len</span><span class="op" id="2876904">(</span><span class="ident" id="2876905">p</span><span class="op" id="2876906">)</span>&nbsp;<span class="op" id="2876908">==</span>&nbsp;<span class="num" id="2876911">0</span>&nbsp;<span class="op" id="2876913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876931">return</span>&nbsp;<span class="num" id="2876938">0</span><span class="op" id="2876939">,</span>&nbsp;<span class="ident" id="2876941">io</span><span class="op" id="2876943">.</span><span class="ident" id="2876944">EOF</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2876949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876952">n</span>&nbsp;<span class="op" id="2876954">=</span>&nbsp;<span class="builtinfunc" id="2876956">copy</span><span class="op" id="2876960">(</span><span class="ident" id="2876961">p</span><span class="op" id="2876962">,</span>&nbsp;<span class="ident" id="2876964">b</span><span class="op" id="2876965">.</span><span class="ident" id="2876966">buf</span><span class="op" id="2876969">[</span><span class="ident" id="2876970">b</span><span class="op" id="2876971">.</span><span class="ident" id="2876972">off</span><span class="op" id="2876975">:</span><span class="op" id="2876976">]</span><span class="op" id="2876977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2876980">b</span><span class="op" id="2876981">.</span><span class="ident" id="2876982">off</span>&nbsp;<span class="op" id="2876986">+=</span>&nbsp;<span class="ident" id="2876989">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2876992">if</span>&nbsp;<span class="ident" id="2876995">n</span>&nbsp;<span class="op" id="2876997">&gt;</span>&nbsp;<span class="num" id="2876999">0</span>&nbsp;<span class="op" id="2877001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877005">b</span><span class="op" id="2877006">.</span><span class="ident" id="2877007">lastRead</span>&nbsp;<span class="op" id="2877016">=</span>&nbsp;<span class="ident" id="2877018">opRead</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877029">return</span><br>
<span class="lineno"></span><span class="op" id="2877036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877039">//&nbsp;Next&nbsp;returns&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;from&nbsp;the&nbsp;buffer,</span><br>
<span class="lineno">270</span><span class="comment" id="2877108">//&nbsp;advancing&nbsp;the&nbsp;buffer&nbsp;as&nbsp;if&nbsp;the&nbsp;bytes&nbsp;had&nbsp;been&nbsp;returned&nbsp;by&nbsp;Read.</span><br>
<span class="lineno"></span><span class="comment" id="2877175">//&nbsp;If&nbsp;there&nbsp;are&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;Next&nbsp;returns&nbsp;the&nbsp;entire&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2877257">//&nbsp;The&nbsp;slice&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;read&nbsp;or&nbsp;write&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="2877331">func</span>&nbsp;<span class="op" id="2877336">(</span><span class="ident" id="2877337">b</span>&nbsp;<span class="op" id="2877339">*</span><span class="ident" id="2877340">Buffer</span><span class="op" id="2877346">)</span>&nbsp;<span class="ident" id="2877348">Next</span><span class="op" id="2877352">(</span><span class="ident" id="2877353">n</span>&nbsp;<span class="builtintype" id="2877355">int</span><span class="op" id="2877358">)</span>&nbsp;<span class="op" id="2877360">[</span><span class="op" id="2877361">]</span><span class="builtintype" id="2877362">byte</span>&nbsp;<span class="op" id="2877367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877370">b</span><span class="op" id="2877371">.</span><span class="ident" id="2877372">lastRead</span>&nbsp;<span class="op" id="2877381">=</span>&nbsp;<span class="ident" id="2877383">opInvalid</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877394">m</span>&nbsp;<span class="op" id="2877396">:=</span>&nbsp;<span class="ident" id="2877399">b</span><span class="op" id="2877400">.</span><span class="ident" id="2877401">Len</span><span class="op" id="2877404">(</span><span class="op" id="2877405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877408">if</span>&nbsp;<span class="ident" id="2877411">n</span>&nbsp;<span class="op" id="2877413">&gt;</span>&nbsp;<span class="ident" id="2877415">m</span>&nbsp;<span class="op" id="2877417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877421">n</span>&nbsp;<span class="op" id="2877423">=</span>&nbsp;<span class="ident" id="2877425">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877431">data</span>&nbsp;<span class="op" id="2877436">:=</span>&nbsp;<span class="ident" id="2877439">b</span><span class="op" id="2877440">.</span><span class="ident" id="2877441">buf</span><span class="op" id="2877444">[</span><span class="ident" id="2877445">b</span><span class="op" id="2877446">.</span><span class="ident" id="2877447">off</span>&nbsp;<span class="op" id="2877451">:</span>&nbsp;<span class="ident" id="2877453">b</span><span class="op" id="2877454">.</span><span class="ident" id="2877455">off</span><span class="op" id="2877458">+</span><span class="ident" id="2877459">n</span><span class="op" id="2877460">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877463">b</span><span class="op" id="2877464">.</span><span class="ident" id="2877465">off</span>&nbsp;<span class="op" id="2877469">+=</span>&nbsp;<span class="ident" id="2877472">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877475">if</span>&nbsp;<span class="ident" id="2877478">n</span>&nbsp;<span class="op" id="2877480">&gt;</span>&nbsp;<span class="num" id="2877482">0</span>&nbsp;<span class="op" id="2877484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877488">b</span><span class="op" id="2877489">.</span><span class="ident" id="2877490">lastRead</span>&nbsp;<span class="op" id="2877499">=</span>&nbsp;<span class="ident" id="2877501">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877512">return</span>&nbsp;<span class="ident" id="2877519">data</span><br>
<span class="lineno">285</span><span class="op" id="2877524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877527">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2877588">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;it&nbsp;returns&nbsp;error&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2877641">func</span>&nbsp;<span class="op" id="2877646">(</span><span class="ident" id="2877647">b</span>&nbsp;<span class="op" id="2877649">*</span><span class="ident" id="2877650">Buffer</span><span class="op" id="2877656">)</span>&nbsp;<span class="ident" id="2877658">ReadByte</span><span class="op" id="2877666">(</span><span class="op" id="2877667">)</span>&nbsp;<span class="op" id="2877669">(</span><span class="ident" id="2877670">c</span>&nbsp;<span class="builtintype" id="2877672">byte</span><span class="op" id="2877676">,</span>&nbsp;<span class="ident" id="2877678">err</span>&nbsp;<span class="builtintype" id="2877682">error</span><span class="op" id="2877687">)</span>&nbsp;<span class="op" id="2877689">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877692">b</span><span class="op" id="2877693">.</span><span class="ident" id="2877694">lastRead</span>&nbsp;<span class="op" id="2877703">=</span>&nbsp;<span class="ident" id="2877705">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877716">if</span>&nbsp;<span class="ident" id="2877719">b</span><span class="op" id="2877720">.</span><span class="ident" id="2877721">off</span>&nbsp;<span class="op" id="2877725">&gt;=</span>&nbsp;<span class="builtinfunc" id="2877728">len</span><span class="op" id="2877731">(</span><span class="ident" id="2877732">b</span><span class="op" id="2877733">.</span><span class="ident" id="2877734">buf</span><span class="op" id="2877737">)</span>&nbsp;<span class="op" id="2877739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2877743">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877789">b</span><span class="op" id="2877790">.</span><span class="ident" id="2877791">Truncate</span><span class="op" id="2877799">(</span><span class="num" id="2877800">0</span><span class="op" id="2877801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877805">return</span>&nbsp;<span class="num" id="2877812">0</span><span class="op" id="2877813">,</span>&nbsp;<span class="ident" id="2877815">io</span><span class="op" id="2877817">.</span><span class="ident" id="2877818">EOF</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2877823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877826">c</span>&nbsp;<span class="op" id="2877828">=</span>&nbsp;<span class="ident" id="2877830">b</span><span class="op" id="2877831">.</span><span class="ident" id="2877832">buf</span><span class="op" id="2877835">[</span><span class="ident" id="2877836">b</span><span class="op" id="2877837">.</span><span class="ident" id="2877838">off</span><span class="op" id="2877841">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877844">b</span><span class="op" id="2877845">.</span><span class="ident" id="2877846">off</span><span class="op" id="2877849">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2877853">b</span><span class="op" id="2877854">.</span><span class="ident" id="2877855">lastRead</span>&nbsp;<span class="op" id="2877864">=</span>&nbsp;<span class="ident" id="2877866">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2877874">return</span>&nbsp;<span class="ident" id="2877881">c</span><span class="op" id="2877882">,</span>&nbsp;<span class="ident" id="2877884">nil</span><br>
<span class="lineno">300</span><span class="op" id="2877888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2877891">//&nbsp;ReadRune&nbsp;reads&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="2877944">//&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;from&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2877983">//&nbsp;If&nbsp;no&nbsp;bytes&nbsp;are&nbsp;available,&nbsp;the&nbsp;error&nbsp;returned&nbsp;is&nbsp;io.EOF.</span><br>
<span class="lineno">305</span><span class="comment" id="2878043">//&nbsp;If&nbsp;the&nbsp;bytes&nbsp;are&nbsp;an&nbsp;erroneous&nbsp;UTF-8&nbsp;encoding,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2878095">//&nbsp;consumes&nbsp;one&nbsp;byte&nbsp;and&nbsp;returns&nbsp;U+FFFD,&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="2878139">func</span>&nbsp;<span class="op" id="2878144">(</span><span class="ident" id="2878145">b</span>&nbsp;<span class="op" id="2878147">*</span><span class="ident" id="2878148">Buffer</span><span class="op" id="2878154">)</span>&nbsp;<span class="ident" id="2878156">ReadRune</span><span class="op" id="2878164">(</span><span class="op" id="2878165">)</span>&nbsp;<span class="op" id="2878167">(</span><span class="ident" id="2878168">r</span>&nbsp;<span class="builtintype" id="2878170">rune</span><span class="op" id="2878174">,</span>&nbsp;<span class="ident" id="2878176">size</span>&nbsp;<span class="builtintype" id="2878181">int</span><span class="op" id="2878184">,</span>&nbsp;<span class="ident" id="2878186">err</span>&nbsp;<span class="builtintype" id="2878190">error</span><span class="op" id="2878195">)</span>&nbsp;<span class="op" id="2878197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878200">b</span><span class="op" id="2878201">.</span><span class="ident" id="2878202">lastRead</span>&nbsp;<span class="op" id="2878211">=</span>&nbsp;<span class="ident" id="2878213">opInvalid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878224">if</span>&nbsp;<span class="ident" id="2878227">b</span><span class="op" id="2878228">.</span><span class="ident" id="2878229">off</span>&nbsp;<span class="op" id="2878233">&gt;=</span>&nbsp;<span class="builtinfunc" id="2878236">len</span><span class="op" id="2878239">(</span><span class="ident" id="2878240">b</span><span class="op" id="2878241">.</span><span class="ident" id="2878242">buf</span><span class="op" id="2878245">)</span>&nbsp;<span class="op" id="2878247">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2878251">//&nbsp;Buffer&nbsp;is&nbsp;empty,&nbsp;reset&nbsp;to&nbsp;recover&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878297">b</span><span class="op" id="2878298">.</span><span class="ident" id="2878299">Truncate</span><span class="op" id="2878307">(</span><span class="num" id="2878308">0</span><span class="op" id="2878309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878313">return</span>&nbsp;<span class="num" id="2878320">0</span><span class="op" id="2878321">,</span>&nbsp;<span class="num" id="2878323">0</span><span class="op" id="2878324">,</span>&nbsp;<span class="ident" id="2878326">io</span><span class="op" id="2878328">.</span><span class="ident" id="2878329">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878337">b</span><span class="op" id="2878338">.</span><span class="ident" id="2878339">lastRead</span>&nbsp;<span class="op" id="2878348">=</span>&nbsp;<span class="ident" id="2878350">opReadRune</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878362">c</span>&nbsp;<span class="op" id="2878364">:=</span>&nbsp;<span class="ident" id="2878367">b</span><span class="op" id="2878368">.</span><span class="ident" id="2878369">buf</span><span class="op" id="2878372">[</span><span class="ident" id="2878373">b</span><span class="op" id="2878374">.</span><span class="ident" id="2878375">off</span><span class="op" id="2878378">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878381">if</span>&nbsp;<span class="ident" id="2878384">c</span>&nbsp;<span class="op" id="2878386">&lt;</span>&nbsp;<span class="ident" id="2878388">utf8</span><span class="op" id="2878392">.</span><span class="ident" id="2878393">RuneSelf</span>&nbsp;<span class="op" id="2878402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878406">b</span><span class="op" id="2878407">.</span><span class="ident" id="2878408">off</span><span class="op" id="2878411">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878416">return</span>&nbsp;<span class="builtintype" id="2878423">rune</span><span class="op" id="2878427">(</span><span class="ident" id="2878428">c</span><span class="op" id="2878429">)</span><span class="op" id="2878430">,</span>&nbsp;<span class="num" id="2878432">1</span><span class="op" id="2878433">,</span>&nbsp;<span class="ident" id="2878435">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878440">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878443">r</span><span class="op" id="2878444">,</span>&nbsp;<span class="ident" id="2878446">n</span>&nbsp;<span class="op" id="2878448">:=</span>&nbsp;<span class="ident" id="2878451">utf8</span><span class="op" id="2878455">.</span><span class="ident" id="2878456">DecodeRune</span><span class="op" id="2878466">(</span><span class="ident" id="2878467">b</span><span class="op" id="2878468">.</span><span class="ident" id="2878469">buf</span><span class="op" id="2878472">[</span><span class="ident" id="2878473">b</span><span class="op" id="2878474">.</span><span class="ident" id="2878475">off</span><span class="op" id="2878478">:</span><span class="op" id="2878479">]</span><span class="op" id="2878480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878483">b</span><span class="op" id="2878484">.</span><span class="ident" id="2878485">off</span>&nbsp;<span class="op" id="2878489">+=</span>&nbsp;<span class="ident" id="2878492">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878495">return</span>&nbsp;<span class="ident" id="2878502">r</span><span class="op" id="2878503">,</span>&nbsp;<span class="ident" id="2878505">n</span><span class="op" id="2878506">,</span>&nbsp;<span class="ident" id="2878508">nil</span><br>
<span class="lineno"></span><span class="op" id="2878512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="comment" id="2878515">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune&nbsp;returned&nbsp;by&nbsp;ReadRune.</span><br>
<span class="lineno"></span><span class="comment" id="2878573">//&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;or&nbsp;write&nbsp;operation&nbsp;on&nbsp;the&nbsp;buffer&nbsp;was</span><br>
<span class="lineno"></span><span class="comment" id="2878637">//&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this&nbsp;regard</span><br>
<span class="lineno"></span><span class="comment" id="2878702">//&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2878769">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno">330</span><span class="keyword" id="2878798">func</span>&nbsp;<span class="op" id="2878803">(</span><span class="ident" id="2878804">b</span>&nbsp;<span class="op" id="2878806">*</span><span class="ident" id="2878807">Buffer</span><span class="op" id="2878813">)</span>&nbsp;<span class="ident" id="2878815">UnreadRune</span><span class="op" id="2878825">(</span><span class="op" id="2878826">)</span>&nbsp;<span class="builtintype" id="2878828">error</span>&nbsp;<span class="op" id="2878834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878837">if</span>&nbsp;<span class="ident" id="2878840">b</span><span class="op" id="2878841">.</span><span class="ident" id="2878842">lastRead</span>&nbsp;<span class="op" id="2878851">!=</span>&nbsp;<span class="ident" id="2878854">opReadRune</span>&nbsp;<span class="op" id="2878865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878869">return</span>&nbsp;<span class="ident" id="2878876">errors</span><span class="op" id="2878882">.</span><span class="ident" id="2878883">New</span><span class="op" id="2878886">(</span><span class="string" id="2878887">&#34;bytes.Buffer:&nbsp;UnreadRune:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;ReadRune&#34;</span><span class="op" id="2878950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2878953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878956">b</span><span class="op" id="2878957">.</span><span class="ident" id="2878958">lastRead</span>&nbsp;<span class="op" id="2878967">=</span>&nbsp;<span class="ident" id="2878969">opInvalid</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2878980">if</span>&nbsp;<span class="ident" id="2878983">b</span><span class="op" id="2878984">.</span><span class="ident" id="2878985">off</span>&nbsp;<span class="op" id="2878989">&gt;</span>&nbsp;<span class="num" id="2878991">0</span>&nbsp;<span class="op" id="2878993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2878997">_</span><span class="op" id="2878998">,</span>&nbsp;<span class="ident" id="2879000">n</span>&nbsp;<span class="op" id="2879002">:=</span>&nbsp;<span class="ident" id="2879005">utf8</span><span class="op" id="2879009">.</span><span class="ident" id="2879010">DecodeLastRune</span><span class="op" id="2879024">(</span><span class="ident" id="2879025">b</span><span class="op" id="2879026">.</span><span class="ident" id="2879027">buf</span><span class="op" id="2879030">[</span><span class="num" id="2879031">0</span><span class="op" id="2879032">:</span><span class="ident" id="2879033">b</span><span class="op" id="2879034">.</span><span class="ident" id="2879035">off</span><span class="op" id="2879038">]</span><span class="op" id="2879039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879043">b</span><span class="op" id="2879044">.</span><span class="ident" id="2879045">off</span>&nbsp;<span class="op" id="2879049">-=</span>&nbsp;<span class="ident" id="2879052">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879058">return</span>&nbsp;<span class="ident" id="2879065">nil</span><br>
<span class="lineno">340</span><span class="op" id="2879069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2879072">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte&nbsp;returned&nbsp;by&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span><span class="comment" id="2879136">//&nbsp;read&nbsp;operation.&nbsp;&nbsp;If&nbsp;write&nbsp;has&nbsp;happened&nbsp;since&nbsp;the&nbsp;last&nbsp;read,&nbsp;UnreadByte</span><br>
<span class="lineno"></span><span class="comment" id="2879210">//&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">345</span><span class="keyword" id="2879231">func</span>&nbsp;<span class="op" id="2879236">(</span><span class="ident" id="2879237">b</span>&nbsp;<span class="op" id="2879239">*</span><span class="ident" id="2879240">Buffer</span><span class="op" id="2879246">)</span>&nbsp;<span class="ident" id="2879248">UnreadByte</span><span class="op" id="2879258">(</span><span class="op" id="2879259">)</span>&nbsp;<span class="builtintype" id="2879261">error</span>&nbsp;<span class="op" id="2879267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879270">if</span>&nbsp;<span class="ident" id="2879273">b</span><span class="op" id="2879274">.</span><span class="ident" id="2879275">lastRead</span>&nbsp;<span class="op" id="2879284">!=</span>&nbsp;<span class="ident" id="2879287">opReadRune</span>&nbsp;<span class="op" id="2879298">&amp;&amp;</span>&nbsp;<span class="ident" id="2879301">b</span><span class="op" id="2879302">.</span><span class="ident" id="2879303">lastRead</span>&nbsp;<span class="op" id="2879312">!=</span>&nbsp;<span class="ident" id="2879315">opRead</span>&nbsp;<span class="op" id="2879322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879326">return</span>&nbsp;<span class="ident" id="2879333">errors</span><span class="op" id="2879339">.</span><span class="ident" id="2879340">New</span><span class="op" id="2879343">(</span><span class="string" id="2879344">&#34;bytes.Buffer:&nbsp;UnreadByte:&nbsp;previous&nbsp;operation&nbsp;was&nbsp;not&nbsp;a&nbsp;read&#34;</span><span class="op" id="2879405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879411">b</span><span class="op" id="2879412">.</span><span class="ident" id="2879413">lastRead</span>&nbsp;<span class="op" id="2879422">=</span>&nbsp;<span class="ident" id="2879424">opInvalid</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879435">if</span>&nbsp;<span class="ident" id="2879438">b</span><span class="op" id="2879439">.</span><span class="ident" id="2879440">off</span>&nbsp;<span class="op" id="2879444">&gt;</span>&nbsp;<span class="num" id="2879446">0</span>&nbsp;<span class="op" id="2879448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879452">b</span><span class="op" id="2879453">.</span><span class="ident" id="2879454">off</span><span class="op" id="2879457">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2879461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2879464">return</span>&nbsp;<span class="ident" id="2879471">nil</span><br>
<span class="lineno"></span><span class="op" id="2879475">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="2879478">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2879547">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2879623">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2879687">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">360</span><span class="comment" id="2879769">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2879850">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="keyword" id="2879860">func</span>&nbsp;<span class="op" id="2879865">(</span><span class="ident" id="2879866">b</span>&nbsp;<span class="op" id="2879868">*</span><span class="ident" id="2879869">Buffer</span><span class="op" id="2879875">)</span>&nbsp;<span class="ident" id="2879877">ReadBytes</span><span class="op" id="2879886">(</span><span class="ident" id="2879887">delim</span>&nbsp;<span class="builtintype" id="2879893">byte</span><span class="op" id="2879897">)</span>&nbsp;<span class="op" id="2879899">(</span><span class="ident" id="2879900">line</span>&nbsp;<span class="op" id="2879905">[</span><span class="op" id="2879906">]</span><span class="builtintype" id="2879907">byte</span><span class="op" id="2879911">,</span>&nbsp;<span class="ident" id="2879913">err</span>&nbsp;<span class="builtintype" id="2879917">error</span><span class="op" id="2879922">)</span>&nbsp;<span class="op" id="2879924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2879927">slice</span><span class="op" id="2879932">,</span>&nbsp;<span class="ident" id="2879934">err</span>&nbsp;<span class="op" id="2879938">:=</span>&nbsp;<span class="ident" id="2879941">b</span><span class="op" id="2879942">.</span><span class="ident" id="2879943">readSlice</span><span class="op" id="2879952">(</span><span class="ident" id="2879953">delim</span><span class="op" id="2879958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2879961">//&nbsp;return&nbsp;a&nbsp;copy&nbsp;of&nbsp;slice.&nbsp;The&nbsp;buffer&#39;s&nbsp;backing&nbsp;array&nbsp;may</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2880020">//&nbsp;be&nbsp;overwritten&nbsp;by&nbsp;later&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880055">line</span>&nbsp;<span class="op" id="2880060">=</span>&nbsp;<span class="builtinfunc" id="2880062">append</span><span class="op" id="2880068">(</span><span class="ident" id="2880069">line</span><span class="op" id="2880073">,</span>&nbsp;<span class="ident" id="2880075">slice</span><span class="op" id="2880080">...</span><span class="op" id="2880083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880086">return</span><br>
<span class="lineno"></span><span class="op" id="2880093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="comment" id="2880096">//&nbsp;readSlice&nbsp;is&nbsp;like&nbsp;ReadBytes&nbsp;but&nbsp;returns&nbsp;a&nbsp;reference&nbsp;to&nbsp;internal&nbsp;buffer&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="2880176">func</span>&nbsp;<span class="op" id="2880181">(</span><span class="ident" id="2880182">b</span>&nbsp;<span class="op" id="2880184">*</span><span class="ident" id="2880185">Buffer</span><span class="op" id="2880191">)</span>&nbsp;<span class="ident" id="2880193">readSlice</span><span class="op" id="2880202">(</span><span class="ident" id="2880203">delim</span>&nbsp;<span class="builtintype" id="2880209">byte</span><span class="op" id="2880213">)</span>&nbsp;<span class="op" id="2880215">(</span><span class="ident" id="2880216">line</span>&nbsp;<span class="op" id="2880221">[</span><span class="op" id="2880222">]</span><span class="builtintype" id="2880223">byte</span><span class="op" id="2880227">,</span>&nbsp;<span class="ident" id="2880229">err</span>&nbsp;<span class="builtintype" id="2880233">error</span><span class="op" id="2880238">)</span>&nbsp;<span class="op" id="2880240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880243">i</span>&nbsp;<span class="op" id="2880245">:=</span>&nbsp;<span class="ident" id="2880248">IndexByte</span><span class="op" id="2880257">(</span><span class="ident" id="2880258">b</span><span class="op" id="2880259">.</span><span class="ident" id="2880260">buf</span><span class="op" id="2880263">[</span><span class="ident" id="2880264">b</span><span class="op" id="2880265">.</span><span class="ident" id="2880266">off</span><span class="op" id="2880269">:</span><span class="op" id="2880270">]</span><span class="op" id="2880271">,</span>&nbsp;<span class="ident" id="2880273">delim</span><span class="op" id="2880278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880281">end</span>&nbsp;<span class="op" id="2880285">:=</span>&nbsp;<span class="ident" id="2880288">b</span><span class="op" id="2880289">.</span><span class="ident" id="2880290">off</span>&nbsp;<span class="op" id="2880294">+</span>&nbsp;<span class="ident" id="2880296">i</span>&nbsp;<span class="op" id="2880298">+</span>&nbsp;<span class="num" id="2880300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880303">if</span>&nbsp;<span class="ident" id="2880306">i</span>&nbsp;<span class="op" id="2880308">&lt;</span>&nbsp;<span class="num" id="2880310">0</span>&nbsp;<span class="op" id="2880312">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880316">end</span>&nbsp;<span class="op" id="2880320">=</span>&nbsp;<span class="builtinfunc" id="2880322">len</span><span class="op" id="2880325">(</span><span class="ident" id="2880326">b</span><span class="op" id="2880327">.</span><span class="ident" id="2880328">buf</span><span class="op" id="2880331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880335">err</span>&nbsp;<span class="op" id="2880339">=</span>&nbsp;<span class="ident" id="2880341">io</span><span class="op" id="2880343">.</span><span class="ident" id="2880344">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2880349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880352">line</span>&nbsp;<span class="op" id="2880357">=</span>&nbsp;<span class="ident" id="2880359">b</span><span class="op" id="2880360">.</span><span class="ident" id="2880361">buf</span><span class="op" id="2880364">[</span><span class="ident" id="2880365">b</span><span class="op" id="2880366">.</span><span class="ident" id="2880367">off</span><span class="op" id="2880370">:</span><span class="ident" id="2880371">end</span><span class="op" id="2880374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880377">b</span><span class="op" id="2880378">.</span><span class="ident" id="2880379">off</span>&nbsp;<span class="op" id="2880383">=</span>&nbsp;<span class="ident" id="2880385">end</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880390">b</span><span class="op" id="2880391">.</span><span class="ident" id="2880392">lastRead</span>&nbsp;<span class="op" id="2880401">=</span>&nbsp;<span class="ident" id="2880403">opRead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880411">return</span>&nbsp;<span class="ident" id="2880418">line</span><span class="op" id="2880422">,</span>&nbsp;<span class="ident" id="2880424">err</span><br>
<span class="lineno"></span><span class="op" id="2880428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2880431">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno">385</span><span class="comment" id="2880501">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2880578">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2880643">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="2880725">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="2880804">//&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">390</span><span class="keyword" id="2880817">func</span>&nbsp;<span class="op" id="2880822">(</span><span class="ident" id="2880823">b</span>&nbsp;<span class="op" id="2880825">*</span><span class="ident" id="2880826">Buffer</span><span class="op" id="2880832">)</span>&nbsp;<span class="ident" id="2880834">ReadString</span><span class="op" id="2880844">(</span><span class="ident" id="2880845">delim</span>&nbsp;<span class="builtintype" id="2880851">byte</span><span class="op" id="2880855">)</span>&nbsp;<span class="op" id="2880857">(</span><span class="ident" id="2880858">line</span>&nbsp;<span class="builtintype" id="2880863">string</span><span class="op" id="2880869">,</span>&nbsp;<span class="ident" id="2880871">err</span>&nbsp;<span class="builtintype" id="2880875">error</span><span class="op" id="2880880">)</span>&nbsp;<span class="op" id="2880882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2880885">slice</span><span class="op" id="2880890">,</span>&nbsp;<span class="ident" id="2880892">err</span>&nbsp;<span class="op" id="2880896">:=</span>&nbsp;<span class="ident" id="2880899">b</span><span class="op" id="2880900">.</span><span class="ident" id="2880901">readSlice</span><span class="op" id="2880910">(</span><span class="ident" id="2880911">delim</span><span class="op" id="2880916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2880919">return</span>&nbsp;<span class="builtintype" id="2880926">string</span><span class="op" id="2880932">(</span><span class="ident" id="2880933">slice</span><span class="op" id="2880938">)</span><span class="op" id="2880939">,</span>&nbsp;<span class="ident" id="2880941">err</span><br>
<span class="lineno"></span><span class="op" id="2880945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="comment" id="2880948">//&nbsp;NewBuffer&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;buf&nbsp;as&nbsp;its&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="2881023">//&nbsp;contents.&nbsp;&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;Buffer&nbsp;to&nbsp;read&nbsp;existing&nbsp;data.&nbsp;&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="2881099">//&nbsp;can&nbsp;also&nbsp;be&nbsp;used&nbsp;to&nbsp;size&nbsp;the&nbsp;internal&nbsp;buffer&nbsp;for&nbsp;writing.&nbsp;To&nbsp;do&nbsp;that,</span><br>
<span class="lineno"></span><span class="comment" id="2881172">//&nbsp;buf&nbsp;should&nbsp;have&nbsp;the&nbsp;desired&nbsp;capacity&nbsp;but&nbsp;a&nbsp;length&nbsp;of&nbsp;zero.</span><br>
<span class="lineno"></span><span class="comment" id="2881234">//</span><br>
<span class="lineno">400</span><span class="comment" id="2881237">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2881308">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2881346">func</span>&nbsp;<span class="ident" id="2881351">NewBuffer</span><span class="op" id="2881360">(</span><span class="ident" id="2881361">buf</span>&nbsp;<span class="op" id="2881365">[</span><span class="op" id="2881366">]</span><span class="builtintype" id="2881367">byte</span><span class="op" id="2881371">)</span>&nbsp;<span class="op" id="2881373">*</span><span class="ident" id="2881374">Buffer</span>&nbsp;<span class="op" id="2881381">{</span>&nbsp;<span class="keyword" id="2881383">return</span>&nbsp;<span class="op" id="2881390">&amp;</span><span class="ident" id="2881391">Buffer</span><span class="op" id="2881397">{</span><span class="ident" id="2881398">buf</span><span class="op" id="2881401">:</span>&nbsp;<span class="ident" id="2881403">buf</span><span class="op" id="2881406">}</span>&nbsp;<span class="op" id="2881408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2881411">//&nbsp;NewBufferString&nbsp;creates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;Buffer&nbsp;using&nbsp;string&nbsp;s&nbsp;as&nbsp;its</span><br>
<span class="lineno">405</span><span class="comment" id="2881489">//&nbsp;initial&nbsp;contents.&nbsp;It&nbsp;is&nbsp;intended&nbsp;to&nbsp;prepare&nbsp;a&nbsp;buffer&nbsp;to&nbsp;read&nbsp;an&nbsp;existing</span><br>
<span class="lineno"></span><span class="comment" id="2881565">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2881576">//</span><br>
<span class="lineno"></span><span class="comment" id="2881579">//&nbsp;In&nbsp;most&nbsp;cases,&nbsp;new(Buffer)&nbsp;(or&nbsp;just&nbsp;declaring&nbsp;a&nbsp;Buffer&nbsp;variable)&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2881650">//&nbsp;sufficient&nbsp;to&nbsp;initialize&nbsp;a&nbsp;Buffer.</span><br>
<span class="lineno">410</span><span class="keyword" id="2881688">func</span>&nbsp;<span class="ident" id="2881693">NewBufferString</span><span class="op" id="2881708">(</span><span class="ident" id="2881709">s</span>&nbsp;<span class="builtintype" id="2881711">string</span><span class="op" id="2881717">)</span>&nbsp;<span class="op" id="2881719">*</span><span class="ident" id="2881720">Buffer</span>&nbsp;<span class="op" id="2881727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2881730">return</span>&nbsp;<span class="op" id="2881737">&amp;</span><span class="ident" id="2881738">Buffer</span><span class="op" id="2881744">{</span><span class="ident" id="2881745">buf</span><span class="op" id="2881748">:</span>&nbsp;<span class="op" id="2881750">[</span><span class="op" id="2881751">]</span><span class="builtintype" id="2881752">byte</span><span class="op" id="2881756">(</span><span class="ident" id="2881757">s</span><span class="op" id="2881758">)</span><span class="op" id="2881759">}</span><br>
<span class="lineno"></span><span class="op" id="2881761">}</span>
</div>
</body>
</html>
