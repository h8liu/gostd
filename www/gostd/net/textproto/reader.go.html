<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3847636">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3847692">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3847746">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3847797">package</span>&nbsp;<span class="ident" id="3847805">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3847816">import</span>&nbsp;<span class="op" id="3847823">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847826">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847835">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847844">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847850">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847863">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3847874">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3847884">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3847887">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3847952">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3848017">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3848067">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3848131">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3848188">type</span>&nbsp;<span class="ident" id="3848193">Reader</span>&nbsp;<span class="keyword" id="3848200">struct</span>&nbsp;<span class="op" id="3848207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848210">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3848214">*</span><span class="ident" id="3848215">bufio</span><span class="op" id="3848220">.</span><span class="ident" id="3848221">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848229">dot</span>&nbsp;<span class="op" id="3848233">*</span><span class="ident" id="3848234">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848245">buf</span>&nbsp;<span class="op" id="3848249">[</span><span class="op" id="3848250">]</span><span class="builtintype" id="3848251">byte</span>&nbsp;<span class="comment" id="3848256">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3848305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3848308">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3848358">func</span>&nbsp;<span class="ident" id="3848363">NewReader</span><span class="op" id="3848372">(</span><span class="ident" id="3848373">r</span>&nbsp;<span class="op" id="3848375">*</span><span class="ident" id="3848376">bufio</span><span class="op" id="3848381">.</span><span class="ident" id="3848382">Reader</span><span class="op" id="3848388">)</span>&nbsp;<span class="op" id="3848390">*</span><span class="ident" id="3848391">Reader</span>&nbsp;<span class="op" id="3848398">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848401">return</span>&nbsp;<span class="op" id="3848408">&amp;</span><span class="ident" id="3848409">Reader</span><span class="op" id="3848415">{</span><span class="ident" id="3848416">R</span><span class="op" id="3848417">:</span>&nbsp;<span class="ident" id="3848419">r</span><span class="op" id="3848420">}</span><br>
<span class="lineno"></span><span class="op" id="3848422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3848425">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3848465">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3848523">func</span>&nbsp;<span class="op" id="3848528">(</span><span class="ident" id="3848529">r</span>&nbsp;<span class="op" id="3848531">*</span><span class="ident" id="3848532">Reader</span><span class="op" id="3848538">)</span>&nbsp;<span class="ident" id="3848540">ReadLine</span><span class="op" id="3848548">(</span><span class="op" id="3848549">)</span>&nbsp;<span class="op" id="3848551">(</span><span class="builtintype" id="3848552">string</span><span class="op" id="3848558">,</span>&nbsp;<span class="builtintype" id="3848560">error</span><span class="op" id="3848565">)</span>&nbsp;<span class="op" id="3848567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848570">line</span><span class="op" id="3848574">,</span>&nbsp;<span class="ident" id="3848576">err</span>&nbsp;<span class="op" id="3848580">:=</span>&nbsp;<span class="ident" id="3848583">r</span><span class="op" id="3848584">.</span><span class="ident" id="3848585">readLineSlice</span><span class="op" id="3848598">(</span><span class="op" id="3848599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848602">return</span>&nbsp;<span class="builtintype" id="3848609">string</span><span class="op" id="3848615">(</span><span class="ident" id="3848616">line</span><span class="op" id="3848620">)</span><span class="op" id="3848621">,</span>&nbsp;<span class="ident" id="3848623">err</span><br>
<span class="lineno"></span><span class="op" id="3848627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3848630">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3848706">func</span>&nbsp;<span class="op" id="3848711">(</span><span class="ident" id="3848712">r</span>&nbsp;<span class="op" id="3848714">*</span><span class="ident" id="3848715">Reader</span><span class="op" id="3848721">)</span>&nbsp;<span class="ident" id="3848723">ReadLineBytes</span><span class="op" id="3848736">(</span><span class="op" id="3848737">)</span>&nbsp;<span class="op" id="3848739">(</span><span class="op" id="3848740">[</span><span class="op" id="3848741">]</span><span class="builtintype" id="3848742">byte</span><span class="op" id="3848746">,</span>&nbsp;<span class="builtintype" id="3848748">error</span><span class="op" id="3848753">)</span>&nbsp;<span class="op" id="3848755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848758">line</span><span class="op" id="3848762">,</span>&nbsp;<span class="ident" id="3848764">err</span>&nbsp;<span class="op" id="3848768">:=</span>&nbsp;<span class="ident" id="3848771">r</span><span class="op" id="3848772">.</span><span class="ident" id="3848773">readLineSlice</span><span class="op" id="3848786">(</span><span class="op" id="3848787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848790">if</span>&nbsp;<span class="ident" id="3848793">line</span>&nbsp;<span class="op" id="3848798">!=</span>&nbsp;<span class="ident" id="3848801">nil</span>&nbsp;<span class="op" id="3848805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848809">buf</span>&nbsp;<span class="op" id="3848813">:=</span>&nbsp;<span class="builtinfunc" id="3848816">make</span><span class="op" id="3848820">(</span><span class="op" id="3848821">[</span><span class="op" id="3848822">]</span><span class="builtintype" id="3848823">byte</span><span class="op" id="3848827">,</span>&nbsp;<span class="builtinfunc" id="3848829">len</span><span class="op" id="3848832">(</span><span class="ident" id="3848833">line</span><span class="op" id="3848837">)</span><span class="op" id="3848838">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3848842">copy</span><span class="op" id="3848846">(</span><span class="ident" id="3848847">buf</span><span class="op" id="3848850">,</span>&nbsp;<span class="ident" id="3848852">line</span><span class="op" id="3848856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848860">line</span>&nbsp;<span class="op" id="3848865">=</span>&nbsp;<span class="ident" id="3848867">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3848872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848875">return</span>&nbsp;<span class="ident" id="3848882">line</span><span class="op" id="3848886">,</span>&nbsp;<span class="ident" id="3848888">err</span><br>
<span class="lineno"></span><span class="op" id="3848892">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3848895">func</span>&nbsp;<span class="op" id="3848900">(</span><span class="ident" id="3848901">r</span>&nbsp;<span class="op" id="3848903">*</span><span class="ident" id="3848904">Reader</span><span class="op" id="3848910">)</span>&nbsp;<span class="ident" id="3848912">readLineSlice</span><span class="op" id="3848925">(</span><span class="op" id="3848926">)</span>&nbsp;<span class="op" id="3848928">(</span><span class="op" id="3848929">[</span><span class="op" id="3848930">]</span><span class="builtintype" id="3848931">byte</span><span class="op" id="3848935">,</span>&nbsp;<span class="builtintype" id="3848937">error</span><span class="op" id="3848942">)</span>&nbsp;<span class="op" id="3848944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848947">r</span><span class="op" id="3848948">.</span><span class="ident" id="3848949">closeDot</span><span class="op" id="3848957">(</span><span class="op" id="3848958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848961">var</span>&nbsp;<span class="ident" id="3848965">line</span>&nbsp;<span class="op" id="3848970">[</span><span class="op" id="3848971">]</span><span class="builtintype" id="3848972">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3848978">for</span>&nbsp;<span class="op" id="3848982">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3848986">l</span><span class="op" id="3848987">,</span>&nbsp;<span class="ident" id="3848989">more</span><span class="op" id="3848993">,</span>&nbsp;<span class="ident" id="3848995">err</span>&nbsp;<span class="op" id="3848999">:=</span>&nbsp;<span class="ident" id="3849002">r</span><span class="op" id="3849003">.</span><span class="ident" id="3849004">R</span><span class="op" id="3849005">.</span><span class="ident" id="3849006">ReadLine</span><span class="op" id="3849014">(</span><span class="op" id="3849015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849019">if</span>&nbsp;<span class="ident" id="3849022">err</span>&nbsp;<span class="op" id="3849026">!=</span>&nbsp;<span class="ident" id="3849029">nil</span>&nbsp;<span class="op" id="3849033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849038">return</span>&nbsp;<span class="ident" id="3849045">nil</span><span class="op" id="3849048">,</span>&nbsp;<span class="ident" id="3849050">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3849056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3849060">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849120">if</span>&nbsp;<span class="ident" id="3849123">line</span>&nbsp;<span class="op" id="3849128">==</span>&nbsp;<span class="ident" id="3849131">nil</span>&nbsp;<span class="op" id="3849135">&amp;&amp;</span>&nbsp;<span class="op" id="3849138">!</span><span class="ident" id="3849139">more</span>&nbsp;<span class="op" id="3849144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849149">return</span>&nbsp;<span class="ident" id="3849156">l</span><span class="op" id="3849157">,</span>&nbsp;<span class="ident" id="3849159">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3849165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849169">line</span>&nbsp;<span class="op" id="3849174">=</span>&nbsp;<span class="builtinfunc" id="3849176">append</span><span class="op" id="3849182">(</span><span class="ident" id="3849183">line</span><span class="op" id="3849187">,</span>&nbsp;<span class="ident" id="3849189">l</span><span class="op" id="3849190">...</span><span class="op" id="3849193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849197">if</span>&nbsp;<span class="op" id="3849200">!</span><span class="ident" id="3849201">more</span>&nbsp;<span class="op" id="3849206">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849211">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3849219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3849222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849225">return</span>&nbsp;<span class="ident" id="3849232">line</span><span class="op" id="3849236">,</span>&nbsp;<span class="ident" id="3849238">nil</span><br>
<span class="lineno"></span><span class="op" id="3849242">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3849245">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3849306">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3849355">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3849417">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3849480">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3849539">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3849602">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3849618">//</span><br>
<span class="lineno"></span><span class="comment" id="3849621">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3849658">//</span><br>
<span class="lineno"></span><span class="comment" id="3849661">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3849671">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3849689">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3849699">//</span><br>
<span class="lineno">85</span><span class="comment" id="3849702">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3849775">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3849815">//</span><br>
<span class="lineno"></span><span class="comment" id="3849818">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3849879">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3849882">func</span>&nbsp;<span class="op" id="3849887">(</span><span class="ident" id="3849888">r</span>&nbsp;<span class="op" id="3849890">*</span><span class="ident" id="3849891">Reader</span><span class="op" id="3849897">)</span>&nbsp;<span class="ident" id="3849899">ReadContinuedLine</span><span class="op" id="3849916">(</span><span class="op" id="3849917">)</span>&nbsp;<span class="op" id="3849919">(</span><span class="builtintype" id="3849920">string</span><span class="op" id="3849926">,</span>&nbsp;<span class="builtintype" id="3849928">error</span><span class="op" id="3849933">)</span>&nbsp;<span class="op" id="3849935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3849938">line</span><span class="op" id="3849942">,</span>&nbsp;<span class="ident" id="3849944">err</span>&nbsp;<span class="op" id="3849948">:=</span>&nbsp;<span class="ident" id="3849951">r</span><span class="op" id="3849952">.</span><span class="ident" id="3849953">readContinuedLineSlice</span><span class="op" id="3849975">(</span><span class="op" id="3849976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3849979">return</span>&nbsp;<span class="builtintype" id="3849986">string</span><span class="op" id="3849992">(</span><span class="ident" id="3849993">line</span><span class="op" id="3849997">)</span><span class="op" id="3849998">,</span>&nbsp;<span class="ident" id="3850000">err</span><br>
<span class="lineno"></span><span class="op" id="3850004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3850007">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3850076">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3850116">func</span>&nbsp;<span class="ident" id="3850121">trim</span><span class="op" id="3850125">(</span><span class="ident" id="3850126">s</span>&nbsp;<span class="op" id="3850128">[</span><span class="op" id="3850129">]</span><span class="builtintype" id="3850130">byte</span><span class="op" id="3850134">)</span>&nbsp;<span class="op" id="3850136">[</span><span class="op" id="3850137">]</span><span class="builtintype" id="3850138">byte</span>&nbsp;<span class="op" id="3850143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850146">i</span>&nbsp;<span class="op" id="3850148">:=</span>&nbsp;<span class="num" id="3850151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850154">for</span>&nbsp;<span class="ident" id="3850158">i</span>&nbsp;<span class="op" id="3850160">&lt;</span>&nbsp;<span class="builtinfunc" id="3850162">len</span><span class="op" id="3850165">(</span><span class="ident" id="3850166">s</span><span class="op" id="3850167">)</span>&nbsp;<span class="op" id="3850169">&amp;&amp;</span>&nbsp;<span class="op" id="3850172">(</span><span class="ident" id="3850173">s</span><span class="op" id="3850174">[</span><span class="ident" id="3850175">i</span><span class="op" id="3850176">]</span>&nbsp;<span class="op" id="3850178">==</span>&nbsp;<span class="string" id="3850181">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3850185">||</span>&nbsp;<span class="ident" id="3850188">s</span><span class="op" id="3850189">[</span><span class="ident" id="3850190">i</span><span class="op" id="3850191">]</span>&nbsp;<span class="op" id="3850193">==</span>&nbsp;<span class="string" id="3850196">&#39;\t&#39;</span><span class="op" id="3850200">)</span>&nbsp;<span class="op" id="3850202">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850206">i</span><span class="op" id="3850207">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850214">n</span>&nbsp;<span class="op" id="3850216">:=</span>&nbsp;<span class="builtinfunc" id="3850219">len</span><span class="op" id="3850222">(</span><span class="ident" id="3850223">s</span><span class="op" id="3850224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850227">for</span>&nbsp;<span class="ident" id="3850231">n</span>&nbsp;<span class="op" id="3850233">&gt;</span>&nbsp;<span class="ident" id="3850235">i</span>&nbsp;<span class="op" id="3850237">&amp;&amp;</span>&nbsp;<span class="op" id="3850240">(</span><span class="ident" id="3850241">s</span><span class="op" id="3850242">[</span><span class="ident" id="3850243">n</span><span class="op" id="3850244">-</span><span class="num" id="3850245">1</span><span class="op" id="3850246">]</span>&nbsp;<span class="op" id="3850248">==</span>&nbsp;<span class="string" id="3850251">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3850255">||</span>&nbsp;<span class="ident" id="3850258">s</span><span class="op" id="3850259">[</span><span class="ident" id="3850260">n</span><span class="op" id="3850261">-</span><span class="num" id="3850262">1</span><span class="op" id="3850263">]</span>&nbsp;<span class="op" id="3850265">==</span>&nbsp;<span class="string" id="3850268">&#39;\t&#39;</span><span class="op" id="3850272">)</span>&nbsp;<span class="op" id="3850274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850278">n</span><span class="op" id="3850279">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850286">return</span>&nbsp;<span class="ident" id="3850293">s</span><span class="op" id="3850294">[</span><span class="ident" id="3850295">i</span><span class="op" id="3850296">:</span><span class="ident" id="3850297">n</span><span class="op" id="3850298">]</span><br>
<span class="lineno"></span><span class="op" id="3850300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3850303">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3850359">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3850400">func</span>&nbsp;<span class="op" id="3850405">(</span><span class="ident" id="3850406">r</span>&nbsp;<span class="op" id="3850408">*</span><span class="ident" id="3850409">Reader</span><span class="op" id="3850415">)</span>&nbsp;<span class="ident" id="3850417">ReadContinuedLineBytes</span><span class="op" id="3850439">(</span><span class="op" id="3850440">)</span>&nbsp;<span class="op" id="3850442">(</span><span class="op" id="3850443">[</span><span class="op" id="3850444">]</span><span class="builtintype" id="3850445">byte</span><span class="op" id="3850449">,</span>&nbsp;<span class="builtintype" id="3850451">error</span><span class="op" id="3850456">)</span>&nbsp;<span class="op" id="3850458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850461">line</span><span class="op" id="3850465">,</span>&nbsp;<span class="ident" id="3850467">err</span>&nbsp;<span class="op" id="3850471">:=</span>&nbsp;<span class="ident" id="3850474">r</span><span class="op" id="3850475">.</span><span class="ident" id="3850476">readContinuedLineSlice</span><span class="op" id="3850498">(</span><span class="op" id="3850499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850502">if</span>&nbsp;<span class="ident" id="3850505">line</span>&nbsp;<span class="op" id="3850510">!=</span>&nbsp;<span class="ident" id="3850513">nil</span>&nbsp;<span class="op" id="3850517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850521">buf</span>&nbsp;<span class="op" id="3850525">:=</span>&nbsp;<span class="builtinfunc" id="3850528">make</span><span class="op" id="3850532">(</span><span class="op" id="3850533">[</span><span class="op" id="3850534">]</span><span class="builtintype" id="3850535">byte</span><span class="op" id="3850539">,</span>&nbsp;<span class="builtinfunc" id="3850541">len</span><span class="op" id="3850544">(</span><span class="ident" id="3850545">line</span><span class="op" id="3850549">)</span><span class="op" id="3850550">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3850554">copy</span><span class="op" id="3850558">(</span><span class="ident" id="3850559">buf</span><span class="op" id="3850562">,</span>&nbsp;<span class="ident" id="3850564">line</span><span class="op" id="3850568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850572">line</span>&nbsp;<span class="op" id="3850577">=</span>&nbsp;<span class="ident" id="3850579">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850587">return</span>&nbsp;<span class="ident" id="3850594">line</span><span class="op" id="3850598">,</span>&nbsp;<span class="ident" id="3850600">err</span><br>
<span class="lineno"></span><span class="op" id="3850604">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3850607">func</span>&nbsp;<span class="op" id="3850612">(</span><span class="ident" id="3850613">r</span>&nbsp;<span class="op" id="3850615">*</span><span class="ident" id="3850616">Reader</span><span class="op" id="3850622">)</span>&nbsp;<span class="ident" id="3850624">readContinuedLineSlice</span><span class="op" id="3850646">(</span><span class="op" id="3850647">)</span>&nbsp;<span class="op" id="3850649">(</span><span class="op" id="3850650">[</span><span class="op" id="3850651">]</span><span class="builtintype" id="3850652">byte</span><span class="op" id="3850656">,</span>&nbsp;<span class="builtintype" id="3850658">error</span><span class="op" id="3850663">)</span>&nbsp;<span class="op" id="3850665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850668">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3850693">line</span><span class="op" id="3850697">,</span>&nbsp;<span class="ident" id="3850699">err</span>&nbsp;<span class="op" id="3850703">:=</span>&nbsp;<span class="ident" id="3850706">r</span><span class="op" id="3850707">.</span><span class="ident" id="3850708">readLineSlice</span><span class="op" id="3850721">(</span><span class="op" id="3850722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850725">if</span>&nbsp;<span class="ident" id="3850728">err</span>&nbsp;<span class="op" id="3850732">!=</span>&nbsp;<span class="ident" id="3850735">nil</span>&nbsp;<span class="op" id="3850739">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850743">return</span>&nbsp;<span class="ident" id="3850750">nil</span><span class="op" id="3850753">,</span>&nbsp;<span class="ident" id="3850755">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850763">if</span>&nbsp;<span class="builtinfunc" id="3850766">len</span><span class="op" id="3850769">(</span><span class="ident" id="3850770">line</span><span class="op" id="3850774">)</span>&nbsp;<span class="op" id="3850776">==</span>&nbsp;<span class="num" id="3850779">0</span>&nbsp;<span class="op" id="3850781">{</span>&nbsp;<span class="comment" id="3850783">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3850817">return</span>&nbsp;<span class="ident" id="3850824">line</span><span class="op" id="3850828">,</span>&nbsp;<span class="ident" id="3850830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3850835">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850839">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850910">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3850982">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3851054">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851083">if</span>&nbsp;<span class="ident" id="3851086">r</span><span class="op" id="3851087">.</span><span class="ident" id="3851088">R</span><span class="op" id="3851089">.</span><span class="ident" id="3851090">Buffered</span><span class="op" id="3851098">(</span><span class="op" id="3851099">)</span>&nbsp;<span class="op" id="3851101">&gt;</span>&nbsp;<span class="num" id="3851103">1</span>&nbsp;<span class="op" id="3851105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851109">peek</span><span class="op" id="3851113">,</span>&nbsp;<span class="ident" id="3851115">err</span>&nbsp;<span class="op" id="3851119">:=</span>&nbsp;<span class="ident" id="3851122">r</span><span class="op" id="3851123">.</span><span class="ident" id="3851124">R</span><span class="op" id="3851125">.</span><span class="ident" id="3851126">Peek</span><span class="op" id="3851130">(</span><span class="num" id="3851131">1</span><span class="op" id="3851132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851136">if</span>&nbsp;<span class="ident" id="3851139">err</span>&nbsp;<span class="op" id="3851143">==</span>&nbsp;<span class="ident" id="3851146">nil</span>&nbsp;<span class="op" id="3851150">&amp;&amp;</span>&nbsp;<span class="ident" id="3851153">isASCIILetter</span><span class="op" id="3851166">(</span><span class="ident" id="3851167">peek</span><span class="op" id="3851171">[</span><span class="num" id="3851172">0</span><span class="op" id="3851173">]</span><span class="op" id="3851174">)</span>&nbsp;<span class="op" id="3851176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851181">return</span>&nbsp;<span class="ident" id="3851188">trim</span><span class="op" id="3851192">(</span><span class="ident" id="3851193">line</span><span class="op" id="3851197">)</span><span class="op" id="3851198">,</span>&nbsp;<span class="ident" id="3851200">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851206">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3851213">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3851280">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851309">r</span><span class="op" id="3851310">.</span><span class="ident" id="3851311">buf</span>&nbsp;<span class="op" id="3851315">=</span>&nbsp;<span class="builtinfunc" id="3851317">append</span><span class="op" id="3851323">(</span><span class="ident" id="3851324">r</span><span class="op" id="3851325">.</span><span class="ident" id="3851326">buf</span><span class="op" id="3851329">[</span><span class="op" id="3851330">:</span><span class="num" id="3851331">0</span><span class="op" id="3851332">]</span><span class="op" id="3851333">,</span>&nbsp;<span class="ident" id="3851335">trim</span><span class="op" id="3851339">(</span><span class="ident" id="3851340">line</span><span class="op" id="3851344">)</span><span class="op" id="3851345">...</span><span class="op" id="3851348">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3851352">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851381">for</span>&nbsp;<span class="ident" id="3851385">r</span><span class="op" id="3851386">.</span><span class="ident" id="3851387">skipSpace</span><span class="op" id="3851396">(</span><span class="op" id="3851397">)</span>&nbsp;<span class="op" id="3851399">&gt;</span>&nbsp;<span class="num" id="3851401">0</span>&nbsp;<span class="op" id="3851403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851407">line</span><span class="op" id="3851411">,</span>&nbsp;<span class="ident" id="3851413">err</span>&nbsp;<span class="op" id="3851417">:=</span>&nbsp;<span class="ident" id="3851420">r</span><span class="op" id="3851421">.</span><span class="ident" id="3851422">readLineSlice</span><span class="op" id="3851435">(</span><span class="op" id="3851436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851440">if</span>&nbsp;<span class="ident" id="3851443">err</span>&nbsp;<span class="op" id="3851447">!=</span>&nbsp;<span class="ident" id="3851450">nil</span>&nbsp;<span class="op" id="3851454">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851459">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851471">r</span><span class="op" id="3851472">.</span><span class="ident" id="3851473">buf</span>&nbsp;<span class="op" id="3851477">=</span>&nbsp;<span class="builtinfunc" id="3851479">append</span><span class="op" id="3851485">(</span><span class="ident" id="3851486">r</span><span class="op" id="3851487">.</span><span class="ident" id="3851488">buf</span><span class="op" id="3851491">,</span>&nbsp;<span class="string" id="3851493">&#39;&nbsp;&#39;</span><span class="op" id="3851496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851500">r</span><span class="op" id="3851501">.</span><span class="ident" id="3851502">buf</span>&nbsp;<span class="op" id="3851506">=</span>&nbsp;<span class="builtinfunc" id="3851508">append</span><span class="op" id="3851514">(</span><span class="ident" id="3851515">r</span><span class="op" id="3851516">.</span><span class="ident" id="3851517">buf</span><span class="op" id="3851520">,</span>&nbsp;<span class="ident" id="3851522">line</span><span class="op" id="3851526">...</span><span class="op" id="3851529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851532">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851535">return</span>&nbsp;<span class="ident" id="3851542">r</span><span class="op" id="3851543">.</span><span class="ident" id="3851544">buf</span><span class="op" id="3851547">,</span>&nbsp;<span class="ident" id="3851549">nil</span><br>
<span class="lineno"></span><span class="op" id="3851553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3851556">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3851634">func</span>&nbsp;<span class="op" id="3851639">(</span><span class="ident" id="3851640">r</span>&nbsp;<span class="op" id="3851642">*</span><span class="ident" id="3851643">Reader</span><span class="op" id="3851649">)</span>&nbsp;<span class="ident" id="3851651">skipSpace</span><span class="op" id="3851660">(</span><span class="op" id="3851661">)</span>&nbsp;<span class="builtintype" id="3851663">int</span>&nbsp;<span class="op" id="3851667">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851670">n</span>&nbsp;<span class="op" id="3851672">:=</span>&nbsp;<span class="num" id="3851675">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851678">for</span>&nbsp;<span class="op" id="3851682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851686">c</span><span class="op" id="3851687">,</span>&nbsp;<span class="ident" id="3851689">err</span>&nbsp;<span class="op" id="3851693">:=</span>&nbsp;<span class="ident" id="3851696">r</span><span class="op" id="3851697">.</span><span class="ident" id="3851698">R</span><span class="op" id="3851699">.</span><span class="ident" id="3851700">ReadByte</span><span class="op" id="3851708">(</span><span class="op" id="3851709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851713">if</span>&nbsp;<span class="ident" id="3851716">err</span>&nbsp;<span class="op" id="3851720">!=</span>&nbsp;<span class="ident" id="3851723">nil</span>&nbsp;<span class="op" id="3851727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3851732">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851775">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851787">if</span>&nbsp;<span class="ident" id="3851790">c</span>&nbsp;<span class="op" id="3851792">!=</span>&nbsp;<span class="string" id="3851795">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3851799">&amp;&amp;</span>&nbsp;<span class="ident" id="3851802">c</span>&nbsp;<span class="op" id="3851804">!=</span>&nbsp;<span class="string" id="3851807">&#39;\t&#39;</span>&nbsp;<span class="op" id="3851812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851817">r</span><span class="op" id="3851818">.</span><span class="ident" id="3851819">R</span><span class="op" id="3851820">.</span><span class="ident" id="3851821">UnreadByte</span><span class="op" id="3851831">(</span><span class="op" id="3851832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851837">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851849">n</span><span class="op" id="3851850">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3851854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851857">return</span>&nbsp;<span class="ident" id="3851864">n</span><br>
<span class="lineno"></span><span class="op" id="3851866">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3851869">func</span>&nbsp;<span class="op" id="3851874">(</span><span class="ident" id="3851875">r</span>&nbsp;<span class="op" id="3851877">*</span><span class="ident" id="3851878">Reader</span><span class="op" id="3851884">)</span>&nbsp;<span class="ident" id="3851886">readCodeLine</span><span class="op" id="3851898">(</span><span class="ident" id="3851899">expectCode</span>&nbsp;<span class="builtintype" id="3851910">int</span><span class="op" id="3851913">)</span>&nbsp;<span class="op" id="3851915">(</span><span class="ident" id="3851916">code</span>&nbsp;<span class="builtintype" id="3851921">int</span><span class="op" id="3851924">,</span>&nbsp;<span class="ident" id="3851926">continued</span>&nbsp;<span class="builtintype" id="3851936">bool</span><span class="op" id="3851940">,</span>&nbsp;<span class="ident" id="3851942">message</span>&nbsp;<span class="builtintype" id="3851950">string</span><span class="op" id="3851956">,</span>&nbsp;<span class="ident" id="3851958">err</span>&nbsp;<span class="builtintype" id="3851962">error</span><span class="op" id="3851967">)</span>&nbsp;<span class="op" id="3851969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3851972">line</span><span class="op" id="3851976">,</span>&nbsp;<span class="ident" id="3851978">err</span>&nbsp;<span class="op" id="3851982">:=</span>&nbsp;<span class="ident" id="3851985">r</span><span class="op" id="3851986">.</span><span class="ident" id="3851987">ReadLine</span><span class="op" id="3851995">(</span><span class="op" id="3851996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3851999">if</span>&nbsp;<span class="ident" id="3852002">err</span>&nbsp;<span class="op" id="3852006">!=</span>&nbsp;<span class="ident" id="3852009">nil</span>&nbsp;<span class="op" id="3852013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852017">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852028">return</span>&nbsp;<span class="ident" id="3852035">parseCodeLine</span><span class="op" id="3852048">(</span><span class="ident" id="3852049">line</span><span class="op" id="3852053">,</span>&nbsp;<span class="ident" id="3852055">expectCode</span><span class="op" id="3852065">)</span><br>
<span class="lineno"></span><span class="op" id="3852067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3852070">func</span>&nbsp;<span class="ident" id="3852075">parseCodeLine</span><span class="op" id="3852088">(</span><span class="ident" id="3852089">line</span>&nbsp;<span class="builtintype" id="3852094">string</span><span class="op" id="3852100">,</span>&nbsp;<span class="ident" id="3852102">expectCode</span>&nbsp;<span class="builtintype" id="3852113">int</span><span class="op" id="3852116">)</span>&nbsp;<span class="op" id="3852118">(</span><span class="ident" id="3852119">code</span>&nbsp;<span class="builtintype" id="3852124">int</span><span class="op" id="3852127">,</span>&nbsp;<span class="ident" id="3852129">continued</span>&nbsp;<span class="builtintype" id="3852139">bool</span><span class="op" id="3852143">,</span>&nbsp;<span class="ident" id="3852145">message</span>&nbsp;<span class="builtintype" id="3852153">string</span><span class="op" id="3852159">,</span>&nbsp;<span class="ident" id="3852161">err</span>&nbsp;<span class="builtintype" id="3852165">error</span><span class="op" id="3852170">)</span>&nbsp;<span class="op" id="3852172">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852175">if</span>&nbsp;<span class="builtinfunc" id="3852178">len</span><span class="op" id="3852181">(</span><span class="ident" id="3852182">line</span><span class="op" id="3852186">)</span>&nbsp;<span class="op" id="3852188">&lt;</span>&nbsp;<span class="num" id="3852190">4</span>&nbsp;<span class="op" id="3852192">||</span>&nbsp;<span class="ident" id="3852195">line</span><span class="op" id="3852199">[</span><span class="num" id="3852200">3</span><span class="op" id="3852201">]</span>&nbsp;<span class="op" id="3852203">!=</span>&nbsp;<span class="string" id="3852206">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3852210">&amp;&amp;</span>&nbsp;<span class="ident" id="3852213">line</span><span class="op" id="3852217">[</span><span class="num" id="3852218">3</span><span class="op" id="3852219">]</span>&nbsp;<span class="op" id="3852221">!=</span>&nbsp;<span class="string" id="3852224">&#39;-&#39;</span>&nbsp;<span class="op" id="3852228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852232">err</span>&nbsp;<span class="op" id="3852236">=</span>&nbsp;<span class="ident" id="3852238">ProtocolError</span><span class="op" id="3852251">(</span><span class="string" id="3852252">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3852271">+</span>&nbsp;<span class="ident" id="3852273">line</span><span class="op" id="3852277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852281">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852292">continued</span>&nbsp;<span class="op" id="3852302">=</span>&nbsp;<span class="ident" id="3852304">line</span><span class="op" id="3852308">[</span><span class="num" id="3852309">3</span><span class="op" id="3852310">]</span>&nbsp;<span class="op" id="3852312">==</span>&nbsp;<span class="string" id="3852315">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852320">code</span><span class="op" id="3852324">,</span>&nbsp;<span class="ident" id="3852326">err</span>&nbsp;<span class="op" id="3852330">=</span>&nbsp;<span class="ident" id="3852332">strconv</span><span class="op" id="3852339">.</span><span class="ident" id="3852340">Atoi</span><span class="op" id="3852344">(</span><span class="ident" id="3852345">line</span><span class="op" id="3852349">[</span><span class="num" id="3852350">0</span><span class="op" id="3852351">:</span><span class="num" id="3852352">3</span><span class="op" id="3852353">]</span><span class="op" id="3852354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852357">if</span>&nbsp;<span class="ident" id="3852360">err</span>&nbsp;<span class="op" id="3852364">!=</span>&nbsp;<span class="ident" id="3852367">nil</span>&nbsp;<span class="op" id="3852371">||</span>&nbsp;<span class="ident" id="3852374">code</span>&nbsp;<span class="op" id="3852379">&lt;</span>&nbsp;<span class="num" id="3852381">100</span>&nbsp;<span class="op" id="3852385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852389">err</span>&nbsp;<span class="op" id="3852393">=</span>&nbsp;<span class="ident" id="3852395">ProtocolError</span><span class="op" id="3852408">(</span><span class="string" id="3852409">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3852435">+</span>&nbsp;<span class="ident" id="3852437">line</span><span class="op" id="3852441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852445">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852453">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852456">message</span>&nbsp;<span class="op" id="3852464">=</span>&nbsp;<span class="ident" id="3852466">line</span><span class="op" id="3852470">[</span><span class="num" id="3852471">4</span><span class="op" id="3852472">:</span><span class="op" id="3852473">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852476">if</span>&nbsp;<span class="num" id="3852479">1</span>&nbsp;<span class="op" id="3852481">&lt;=</span>&nbsp;<span class="ident" id="3852484">expectCode</span>&nbsp;<span class="op" id="3852495">&amp;&amp;</span>&nbsp;<span class="ident" id="3852498">expectCode</span>&nbsp;<span class="op" id="3852509">&lt;</span>&nbsp;<span class="num" id="3852511">10</span>&nbsp;<span class="op" id="3852514">&amp;&amp;</span>&nbsp;<span class="ident" id="3852517">code</span><span class="op" id="3852521">/</span><span class="num" id="3852522">100</span>&nbsp;<span class="op" id="3852526">!=</span>&nbsp;<span class="ident" id="3852529">expectCode</span>&nbsp;<span class="op" id="3852540">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3852545">10</span>&nbsp;<span class="op" id="3852548">&lt;=</span>&nbsp;<span class="ident" id="3852551">expectCode</span>&nbsp;<span class="op" id="3852562">&amp;&amp;</span>&nbsp;<span class="ident" id="3852565">expectCode</span>&nbsp;<span class="op" id="3852576">&lt;</span>&nbsp;<span class="num" id="3852578">100</span>&nbsp;<span class="op" id="3852582">&amp;&amp;</span>&nbsp;<span class="ident" id="3852585">code</span><span class="op" id="3852589">/</span><span class="num" id="3852590">10</span>&nbsp;<span class="op" id="3852593">!=</span>&nbsp;<span class="ident" id="3852596">expectCode</span>&nbsp;<span class="op" id="3852607">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3852612">100</span>&nbsp;<span class="op" id="3852616">&lt;=</span>&nbsp;<span class="ident" id="3852619">expectCode</span>&nbsp;<span class="op" id="3852630">&amp;&amp;</span>&nbsp;<span class="ident" id="3852633">expectCode</span>&nbsp;<span class="op" id="3852644">&lt;</span>&nbsp;<span class="num" id="3852646">1000</span>&nbsp;<span class="op" id="3852651">&amp;&amp;</span>&nbsp;<span class="ident" id="3852654">code</span>&nbsp;<span class="op" id="3852659">!=</span>&nbsp;<span class="ident" id="3852662">expectCode</span>&nbsp;<span class="op" id="3852673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3852677">err</span>&nbsp;<span class="op" id="3852681">=</span>&nbsp;<span class="op" id="3852683">&amp;</span><span class="ident" id="3852684">Error</span><span class="op" id="3852689">{</span><span class="ident" id="3852690">code</span><span class="op" id="3852694">,</span>&nbsp;<span class="ident" id="3852696">message</span><span class="op" id="3852703">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3852706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3852709">return</span><br>
<span class="lineno"></span><span class="op" id="3852716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3852719">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3852774">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3852790">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3852849">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3852916">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3852949">//</span><br>
<span class="lineno">210</span><span class="comment" id="3852952">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3853024">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3853087">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3853153">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3853198">//</span><br>
<span class="lineno">215</span><span class="comment" id="3853201">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3853266">//</span><br>
<span class="lineno"></span><span class="comment" id="3853269">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3853330">//</span><br>
<span class="lineno"></span><span class="keyword" id="3853333">func</span>&nbsp;<span class="op" id="3853338">(</span><span class="ident" id="3853339">r</span>&nbsp;<span class="op" id="3853341">*</span><span class="ident" id="3853342">Reader</span><span class="op" id="3853348">)</span>&nbsp;<span class="ident" id="3853350">ReadCodeLine</span><span class="op" id="3853362">(</span><span class="ident" id="3853363">expectCode</span>&nbsp;<span class="builtintype" id="3853374">int</span><span class="op" id="3853377">)</span>&nbsp;<span class="op" id="3853379">(</span><span class="ident" id="3853380">code</span>&nbsp;<span class="builtintype" id="3853385">int</span><span class="op" id="3853388">,</span>&nbsp;<span class="ident" id="3853390">message</span>&nbsp;<span class="builtintype" id="3853398">string</span><span class="op" id="3853404">,</span>&nbsp;<span class="ident" id="3853406">err</span>&nbsp;<span class="builtintype" id="3853410">error</span><span class="op" id="3853415">)</span>&nbsp;<span class="op" id="3853417">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853420">code</span><span class="op" id="3853424">,</span>&nbsp;<span class="ident" id="3853426">continued</span><span class="op" id="3853435">,</span>&nbsp;<span class="ident" id="3853437">message</span><span class="op" id="3853444">,</span>&nbsp;<span class="ident" id="3853446">err</span>&nbsp;<span class="op" id="3853450">:=</span>&nbsp;<span class="ident" id="3853453">r</span><span class="op" id="3853454">.</span><span class="ident" id="3853455">readCodeLine</span><span class="op" id="3853467">(</span><span class="ident" id="3853468">expectCode</span><span class="op" id="3853478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3853481">if</span>&nbsp;<span class="ident" id="3853484">err</span>&nbsp;<span class="op" id="3853488">==</span>&nbsp;<span class="ident" id="3853491">nil</span>&nbsp;<span class="op" id="3853495">&amp;&amp;</span>&nbsp;<span class="ident" id="3853498">continued</span>&nbsp;<span class="op" id="3853508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3853512">err</span>&nbsp;<span class="op" id="3853516">=</span>&nbsp;<span class="ident" id="3853518">ProtocolError</span><span class="op" id="3853531">(</span><span class="string" id="3853532">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3853567">+</span>&nbsp;<span class="ident" id="3853569">message</span><span class="op" id="3853576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3853579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3853582">return</span><br>
<span class="lineno">225</span><span class="op" id="3853589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3853592">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3853649">//</span><br>
<span class="lineno"></span><span class="comment" id="3853652">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3853675">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3853698">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3853705">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3853728">//</span><br>
<span class="lineno"></span><span class="comment" id="3853731">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3853806">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3853877">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3853944">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3853976">//</span><br>
<span class="lineno"></span><span class="comment" id="3853979">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3854046">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3854058">//</span><br>
<span class="lineno"></span><span class="comment" id="3854061">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3854133">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3854196">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3854262">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3854307">//</span><br>
<span class="lineno"></span><span class="comment" id="3854310">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3854371">//</span><br>
<span class="lineno"></span><span class="keyword" id="3854374">func</span>&nbsp;<span class="op" id="3854379">(</span><span class="ident" id="3854380">r</span>&nbsp;<span class="op" id="3854382">*</span><span class="ident" id="3854383">Reader</span><span class="op" id="3854389">)</span>&nbsp;<span class="ident" id="3854391">ReadResponse</span><span class="op" id="3854403">(</span><span class="ident" id="3854404">expectCode</span>&nbsp;<span class="builtintype" id="3854415">int</span><span class="op" id="3854418">)</span>&nbsp;<span class="op" id="3854420">(</span><span class="ident" id="3854421">code</span>&nbsp;<span class="builtintype" id="3854426">int</span><span class="op" id="3854429">,</span>&nbsp;<span class="ident" id="3854431">message</span>&nbsp;<span class="builtintype" id="3854439">string</span><span class="op" id="3854445">,</span>&nbsp;<span class="ident" id="3854447">err</span>&nbsp;<span class="builtintype" id="3854451">error</span><span class="op" id="3854456">)</span>&nbsp;<span class="op" id="3854458">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854461">code</span><span class="op" id="3854465">,</span>&nbsp;<span class="ident" id="3854467">continued</span><span class="op" id="3854476">,</span>&nbsp;<span class="ident" id="3854478">message</span><span class="op" id="3854485">,</span>&nbsp;<span class="ident" id="3854487">err</span>&nbsp;<span class="op" id="3854491">:=</span>&nbsp;<span class="ident" id="3854494">r</span><span class="op" id="3854495">.</span><span class="ident" id="3854496">readCodeLine</span><span class="op" id="3854508">(</span><span class="ident" id="3854509">expectCode</span><span class="op" id="3854519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854522">for</span>&nbsp;<span class="ident" id="3854526">err</span>&nbsp;<span class="op" id="3854530">==</span>&nbsp;<span class="ident" id="3854533">nil</span>&nbsp;<span class="op" id="3854537">&amp;&amp;</span>&nbsp;<span class="ident" id="3854540">continued</span>&nbsp;<span class="op" id="3854550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854554">line</span><span class="op" id="3854558">,</span>&nbsp;<span class="ident" id="3854560">err</span>&nbsp;<span class="op" id="3854564">:=</span>&nbsp;<span class="ident" id="3854567">r</span><span class="op" id="3854568">.</span><span class="ident" id="3854569">ReadLine</span><span class="op" id="3854577">(</span><span class="op" id="3854578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854582">if</span>&nbsp;<span class="ident" id="3854585">err</span>&nbsp;<span class="op" id="3854589">!=</span>&nbsp;<span class="ident" id="3854592">nil</span>&nbsp;<span class="op" id="3854596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854601">return</span>&nbsp;<span class="num" id="3854608">0</span><span class="op" id="3854609">,</span>&nbsp;<span class="string" id="3854611">&#34;&#34;</span><span class="op" id="3854613">,</span>&nbsp;<span class="ident" id="3854615">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854626">var</span>&nbsp;<span class="ident" id="3854630">code2</span>&nbsp;<span class="builtintype" id="3854636">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854642">var</span>&nbsp;<span class="ident" id="3854646">moreMessage</span>&nbsp;<span class="builtintype" id="3854658">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854667">code2</span><span class="op" id="3854672">,</span>&nbsp;<span class="ident" id="3854674">continued</span><span class="op" id="3854683">,</span>&nbsp;<span class="ident" id="3854685">moreMessage</span><span class="op" id="3854696">,</span>&nbsp;<span class="ident" id="3854698">err</span>&nbsp;<span class="op" id="3854702">=</span>&nbsp;<span class="ident" id="3854704">parseCodeLine</span><span class="op" id="3854717">(</span><span class="ident" id="3854718">line</span><span class="op" id="3854722">,</span>&nbsp;<span class="ident" id="3854724">expectCode</span><span class="op" id="3854734">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854738">if</span>&nbsp;<span class="ident" id="3854741">err</span>&nbsp;<span class="op" id="3854745">!=</span>&nbsp;<span class="ident" id="3854748">nil</span>&nbsp;<span class="op" id="3854752">||</span>&nbsp;<span class="ident" id="3854755">code2</span>&nbsp;<span class="op" id="3854761">!=</span>&nbsp;<span class="ident" id="3854764">code</span>&nbsp;<span class="op" id="3854769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854774">message</span>&nbsp;<span class="op" id="3854782">+=</span>&nbsp;<span class="string" id="3854785">&#34;\n&#34;</span>&nbsp;<span class="op" id="3854790">+</span>&nbsp;<span class="ident" id="3854792">strings</span><span class="op" id="3854799">.</span><span class="ident" id="3854800">TrimRight</span><span class="op" id="3854809">(</span><span class="ident" id="3854810">line</span><span class="op" id="3854814">,</span>&nbsp;<span class="string" id="3854816">&#34;\r\n&#34;</span><span class="op" id="3854822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854827">continued</span>&nbsp;<span class="op" id="3854837">=</span>&nbsp;<span class="builtintype" id="3854839">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854847">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854858">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3854862">message</span>&nbsp;<span class="op" id="3854870">+=</span>&nbsp;<span class="string" id="3854873">&#34;\n&#34;</span>&nbsp;<span class="op" id="3854878">+</span>&nbsp;<span class="ident" id="3854880">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3854893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3854896">return</span><br>
<span class="lineno"></span><span class="op" id="3854903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3854906">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3854971">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3855023">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3855080">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3855101">//</span><br>
<span class="lineno">275</span><span class="comment" id="3855104">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3855161">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3855229">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3855293">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3855360">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3855418">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3855459">//</span><br>
<span class="lineno"></span><span class="comment" id="3855462">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3855519">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3855578">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3855649">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3855711">func</span>&nbsp;<span class="op" id="3855716">(</span><span class="ident" id="3855717">r</span>&nbsp;<span class="op" id="3855719">*</span><span class="ident" id="3855720">Reader</span><span class="op" id="3855726">)</span>&nbsp;<span class="ident" id="3855728">DotReader</span><span class="op" id="3855737">(</span><span class="op" id="3855738">)</span>&nbsp;<span class="ident" id="3855740">io</span><span class="op" id="3855742">.</span><span class="ident" id="3855743">Reader</span>&nbsp;<span class="op" id="3855750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855753">r</span><span class="op" id="3855754">.</span><span class="ident" id="3855755">closeDot</span><span class="op" id="3855763">(</span><span class="op" id="3855764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855767">r</span><span class="op" id="3855768">.</span><span class="ident" id="3855769">dot</span>&nbsp;<span class="op" id="3855773">=</span>&nbsp;<span class="op" id="3855775">&amp;</span><span class="ident" id="3855776">dotReader</span><span class="op" id="3855785">{</span><span class="ident" id="3855786">r</span><span class="op" id="3855787">:</span>&nbsp;<span class="ident" id="3855789">r</span><span class="op" id="3855790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3855793">return</span>&nbsp;<span class="ident" id="3855800">r</span><span class="op" id="3855801">.</span><span class="ident" id="3855802">dot</span><br>
<span class="lineno">290</span><span class="op" id="3855806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3855809">type</span>&nbsp;<span class="ident" id="3855814">dotReader</span>&nbsp;<span class="keyword" id="3855824">struct</span>&nbsp;<span class="op" id="3855831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855834">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3855840">*</span><span class="ident" id="3855841">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3855849">state</span>&nbsp;<span class="builtintype" id="3855855">int</span><br>
<span class="lineno">295</span><span class="op" id="3855859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3855862">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3855930">func</span>&nbsp;<span class="op" id="3855935">(</span><span class="ident" id="3855936">d</span>&nbsp;<span class="op" id="3855938">*</span><span class="ident" id="3855939">dotReader</span><span class="op" id="3855948">)</span>&nbsp;<span class="ident" id="3855950">Read</span><span class="op" id="3855954">(</span><span class="ident" id="3855955">b</span>&nbsp;<span class="op" id="3855957">[</span><span class="op" id="3855958">]</span><span class="builtintype" id="3855959">byte</span><span class="op" id="3855963">)</span>&nbsp;<span class="op" id="3855965">(</span><span class="ident" id="3855966">n</span>&nbsp;<span class="builtintype" id="3855968">int</span><span class="op" id="3855971">,</span>&nbsp;<span class="ident" id="3855973">err</span>&nbsp;<span class="builtintype" id="3855977">error</span><span class="op" id="3855982">)</span>&nbsp;<span class="op" id="3855984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3855987">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3856034">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3856089">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856123">const</span>&nbsp;<span class="op" id="3856129">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856133">stateBeginLine</span>&nbsp;<span class="op" id="3856148">=</span>&nbsp;<span class="ident" id="3856150">iota</span>&nbsp;<span class="comment" id="3856155">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856207">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856229">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856262">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856284">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856319">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856341">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856380">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856402">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856438">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3856460">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856494">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856497">br</span>&nbsp;<span class="op" id="3856500">:=</span>&nbsp;<span class="ident" id="3856503">d</span><span class="op" id="3856504">.</span><span class="ident" id="3856505">r</span><span class="op" id="3856506">.</span><span class="ident" id="3856507">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856510">for</span>&nbsp;<span class="ident" id="3856514">n</span>&nbsp;<span class="op" id="3856516">&lt;</span>&nbsp;<span class="builtinfunc" id="3856518">len</span><span class="op" id="3856521">(</span><span class="ident" id="3856522">b</span><span class="op" id="3856523">)</span>&nbsp;<span class="op" id="3856525">&amp;&amp;</span>&nbsp;<span class="ident" id="3856528">d</span><span class="op" id="3856529">.</span><span class="ident" id="3856530">state</span>&nbsp;<span class="op" id="3856536">!=</span>&nbsp;<span class="ident" id="3856539">stateEOF</span>&nbsp;<span class="op" id="3856548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856552">var</span>&nbsp;<span class="ident" id="3856556">c</span>&nbsp;<span class="builtintype" id="3856558">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856565">c</span><span class="op" id="3856566">,</span>&nbsp;<span class="ident" id="3856568">err</span>&nbsp;<span class="op" id="3856572">=</span>&nbsp;<span class="ident" id="3856574">br</span><span class="op" id="3856576">.</span><span class="ident" id="3856577">ReadByte</span><span class="op" id="3856585">(</span><span class="op" id="3856586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856590">if</span>&nbsp;<span class="ident" id="3856593">err</span>&nbsp;<span class="op" id="3856597">!=</span>&nbsp;<span class="ident" id="3856600">nil</span>&nbsp;<span class="op" id="3856604">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856609">if</span>&nbsp;<span class="ident" id="3856612">err</span>&nbsp;<span class="op" id="3856616">==</span>&nbsp;<span class="ident" id="3856619">io</span><span class="op" id="3856621">.</span><span class="ident" id="3856622">EOF</span>&nbsp;<span class="op" id="3856626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856632">err</span>&nbsp;<span class="op" id="3856636">=</span>&nbsp;<span class="ident" id="3856638">io</span><span class="op" id="3856640">.</span><span class="ident" id="3856641">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856666">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856674">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856678">switch</span>&nbsp;<span class="ident" id="3856685">d</span><span class="op" id="3856686">.</span><span class="ident" id="3856687">state</span>&nbsp;<span class="op" id="3856693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856697">case</span>&nbsp;<span class="ident" id="3856702">stateBeginLine</span><span class="op" id="3856716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856721">if</span>&nbsp;<span class="ident" id="3856724">c</span>&nbsp;<span class="op" id="3856726">==</span>&nbsp;<span class="string" id="3856729">&#39;.&#39;</span>&nbsp;<span class="op" id="3856733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856739">d</span><span class="op" id="3856740">.</span><span class="ident" id="3856741">state</span>&nbsp;<span class="op" id="3856747">=</span>&nbsp;<span class="ident" id="3856749">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856762">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856779">if</span>&nbsp;<span class="ident" id="3856782">c</span>&nbsp;<span class="op" id="3856784">==</span>&nbsp;<span class="string" id="3856787">&#39;\r&#39;</span>&nbsp;<span class="op" id="3856792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856798">d</span><span class="op" id="3856799">.</span><span class="ident" id="3856800">state</span>&nbsp;<span class="op" id="3856806">=</span>&nbsp;<span class="ident" id="3856808">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856820">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856832">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856837">d</span><span class="op" id="3856838">.</span><span class="ident" id="3856839">state</span>&nbsp;<span class="op" id="3856845">=</span>&nbsp;<span class="ident" id="3856847">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856860">case</span>&nbsp;<span class="ident" id="3856865">stateDot</span><span class="op" id="3856873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856878">if</span>&nbsp;<span class="ident" id="3856881">c</span>&nbsp;<span class="op" id="3856883">==</span>&nbsp;<span class="string" id="3856886">&#39;\r&#39;</span>&nbsp;<span class="op" id="3856891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856897">d</span><span class="op" id="3856898">.</span><span class="ident" id="3856899">state</span>&nbsp;<span class="op" id="3856905">=</span>&nbsp;<span class="ident" id="3856907">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856922">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856939">if</span>&nbsp;<span class="ident" id="3856942">c</span>&nbsp;<span class="op" id="3856944">==</span>&nbsp;<span class="string" id="3856947">&#39;\n&#39;</span>&nbsp;<span class="op" id="3856952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856958">d</span><span class="op" id="3856959">.</span><span class="ident" id="3856960">state</span>&nbsp;<span class="op" id="3856966">=</span>&nbsp;<span class="ident" id="3856968">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3856981">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3856993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3856998">d</span><span class="op" id="3856999">.</span><span class="ident" id="3857000">state</span>&nbsp;<span class="op" id="3857006">=</span>&nbsp;<span class="ident" id="3857008">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857021">case</span>&nbsp;<span class="ident" id="3857026">stateDotCR</span><span class="op" id="3857036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857041">if</span>&nbsp;<span class="ident" id="3857044">c</span>&nbsp;<span class="op" id="3857046">==</span>&nbsp;<span class="string" id="3857049">&#39;\n&#39;</span>&nbsp;<span class="op" id="3857054">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857060">d</span><span class="op" id="3857061">.</span><span class="ident" id="3857062">state</span>&nbsp;<span class="op" id="3857068">=</span>&nbsp;<span class="ident" id="3857070">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857083">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3857100">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3857125">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857170">br</span><span class="op" id="3857172">.</span><span class="ident" id="3857173">UnreadByte</span><span class="op" id="3857183">(</span><span class="op" id="3857184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857189">c</span>&nbsp;<span class="op" id="3857191">=</span>&nbsp;<span class="string" id="3857193">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857201">d</span><span class="op" id="3857202">.</span><span class="ident" id="3857203">state</span>&nbsp;<span class="op" id="3857209">=</span>&nbsp;<span class="ident" id="3857211">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857224">case</span>&nbsp;<span class="ident" id="3857229">stateCR</span><span class="op" id="3857236">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857241">if</span>&nbsp;<span class="ident" id="3857244">c</span>&nbsp;<span class="op" id="3857246">==</span>&nbsp;<span class="string" id="3857249">&#39;\n&#39;</span>&nbsp;<span class="op" id="3857254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857260">d</span><span class="op" id="3857261">.</span><span class="ident" id="3857262">state</span>&nbsp;<span class="op" id="3857268">=</span>&nbsp;<span class="ident" id="3857270">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857289">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3857303">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857342">br</span><span class="op" id="3857344">.</span><span class="ident" id="3857345">UnreadByte</span><span class="op" id="3857355">(</span><span class="op" id="3857356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857361">c</span>&nbsp;<span class="op" id="3857363">=</span>&nbsp;<span class="string" id="3857365">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857373">d</span><span class="op" id="3857374">.</span><span class="ident" id="3857375">state</span>&nbsp;<span class="op" id="3857381">=</span>&nbsp;<span class="ident" id="3857383">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857396">case</span>&nbsp;<span class="ident" id="3857401">stateData</span><span class="op" id="3857410">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857415">if</span>&nbsp;<span class="ident" id="3857418">c</span>&nbsp;<span class="op" id="3857420">==</span>&nbsp;<span class="string" id="3857423">&#39;\r&#39;</span>&nbsp;<span class="op" id="3857428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857434">d</span><span class="op" id="3857435">.</span><span class="ident" id="3857436">state</span>&nbsp;<span class="op" id="3857442">=</span>&nbsp;<span class="ident" id="3857444">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857456">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857473">if</span>&nbsp;<span class="ident" id="3857476">c</span>&nbsp;<span class="op" id="3857478">==</span>&nbsp;<span class="string" id="3857481">&#39;\n&#39;</span>&nbsp;<span class="op" id="3857486">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857492">d</span><span class="op" id="3857493">.</span><span class="ident" id="3857494">state</span>&nbsp;<span class="op" id="3857500">=</span>&nbsp;<span class="ident" id="3857502">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857528">b</span><span class="op" id="3857529">[</span><span class="ident" id="3857530">n</span><span class="op" id="3857531">]</span>&nbsp;<span class="op" id="3857533">=</span>&nbsp;<span class="ident" id="3857535">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857539">n</span><span class="op" id="3857540">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857547">if</span>&nbsp;<span class="ident" id="3857550">err</span>&nbsp;<span class="op" id="3857554">==</span>&nbsp;<span class="ident" id="3857557">nil</span>&nbsp;<span class="op" id="3857561">&amp;&amp;</span>&nbsp;<span class="ident" id="3857564">d</span><span class="op" id="3857565">.</span><span class="ident" id="3857566">state</span>&nbsp;<span class="op" id="3857572">==</span>&nbsp;<span class="ident" id="3857575">stateEOF</span>&nbsp;<span class="op" id="3857584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857588">err</span>&nbsp;<span class="op" id="3857592">=</span>&nbsp;<span class="ident" id="3857594">io</span><span class="op" id="3857596">.</span><span class="ident" id="3857597">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857605">if</span>&nbsp;<span class="ident" id="3857608">err</span>&nbsp;<span class="op" id="3857612">!=</span>&nbsp;<span class="ident" id="3857615">nil</span>&nbsp;<span class="op" id="3857619">&amp;&amp;</span>&nbsp;<span class="ident" id="3857622">d</span><span class="op" id="3857623">.</span><span class="ident" id="3857624">r</span><span class="op" id="3857625">.</span><span class="ident" id="3857626">dot</span>&nbsp;<span class="op" id="3857630">==</span>&nbsp;<span class="ident" id="3857633">d</span>&nbsp;<span class="op" id="3857635">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857639">d</span><span class="op" id="3857640">.</span><span class="ident" id="3857641">r</span><span class="op" id="3857642">.</span><span class="ident" id="3857643">dot</span>&nbsp;<span class="op" id="3857647">=</span>&nbsp;<span class="ident" id="3857649">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857657">return</span><br>
<span class="lineno"></span><span class="op" id="3857664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3857667">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3857716">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3857772">func</span>&nbsp;<span class="op" id="3857777">(</span><span class="ident" id="3857778">r</span>&nbsp;<span class="op" id="3857780">*</span><span class="ident" id="3857781">Reader</span><span class="op" id="3857787">)</span>&nbsp;<span class="ident" id="3857789">closeDot</span><span class="op" id="3857797">(</span><span class="op" id="3857798">)</span>&nbsp;<span class="op" id="3857800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857803">if</span>&nbsp;<span class="ident" id="3857806">r</span><span class="op" id="3857807">.</span><span class="ident" id="3857808">dot</span>&nbsp;<span class="op" id="3857812">==</span>&nbsp;<span class="ident" id="3857815">nil</span>&nbsp;<span class="op" id="3857819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857823">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857834">buf</span>&nbsp;<span class="op" id="3857838">:=</span>&nbsp;<span class="builtinfunc" id="3857841">make</span><span class="op" id="3857845">(</span><span class="op" id="3857846">[</span><span class="op" id="3857847">]</span><span class="builtintype" id="3857848">byte</span><span class="op" id="3857852">,</span>&nbsp;<span class="num" id="3857854">128</span><span class="op" id="3857857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3857860">for</span>&nbsp;<span class="ident" id="3857864">r</span><span class="op" id="3857865">.</span><span class="ident" id="3857866">dot</span>&nbsp;<span class="op" id="3857870">!=</span>&nbsp;<span class="ident" id="3857873">nil</span>&nbsp;<span class="op" id="3857877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3857881">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3857921">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3857952">r</span><span class="op" id="3857953">.</span><span class="ident" id="3857954">dot</span><span class="op" id="3857957">.</span><span class="ident" id="3857958">Read</span><span class="op" id="3857962">(</span><span class="ident" id="3857963">buf</span><span class="op" id="3857966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3857969">}</span><br>
<span class="lineno"></span><span class="op" id="3857971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3857974">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3858041">//</span><br>
<span class="lineno"></span><span class="comment" id="3858044">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3858126">func</span>&nbsp;<span class="op" id="3858131">(</span><span class="ident" id="3858132">r</span>&nbsp;<span class="op" id="3858134">*</span><span class="ident" id="3858135">Reader</span><span class="op" id="3858141">)</span>&nbsp;<span class="ident" id="3858143">ReadDotBytes</span><span class="op" id="3858155">(</span><span class="op" id="3858156">)</span>&nbsp;<span class="op" id="3858158">(</span><span class="op" id="3858159">[</span><span class="op" id="3858160">]</span><span class="builtintype" id="3858161">byte</span><span class="op" id="3858165">,</span>&nbsp;<span class="builtintype" id="3858167">error</span><span class="op" id="3858172">)</span>&nbsp;<span class="op" id="3858174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858177">return</span>&nbsp;<span class="ident" id="3858184">ioutil</span><span class="op" id="3858190">.</span><span class="ident" id="3858191">ReadAll</span><span class="op" id="3858198">(</span><span class="ident" id="3858199">r</span><span class="op" id="3858200">.</span><span class="ident" id="3858201">DotReader</span><span class="op" id="3858210">(</span><span class="op" id="3858211">)</span><span class="op" id="3858212">)</span><br>
<span class="lineno"></span><span class="op" id="3858214">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3858217">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3858274">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3858351">//</span><br>
<span class="lineno"></span><span class="comment" id="3858354">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3858436">func</span>&nbsp;<span class="op" id="3858441">(</span><span class="ident" id="3858442">r</span>&nbsp;<span class="op" id="3858444">*</span><span class="ident" id="3858445">Reader</span><span class="op" id="3858451">)</span>&nbsp;<span class="ident" id="3858453">ReadDotLines</span><span class="op" id="3858465">(</span><span class="op" id="3858466">)</span>&nbsp;<span class="op" id="3858468">(</span><span class="op" id="3858469">[</span><span class="op" id="3858470">]</span><span class="builtintype" id="3858471">string</span><span class="op" id="3858477">,</span>&nbsp;<span class="builtintype" id="3858479">error</span><span class="op" id="3858484">)</span>&nbsp;<span class="op" id="3858486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3858489">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3858538">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3858588">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858641">var</span>&nbsp;<span class="ident" id="3858645">v</span>&nbsp;<span class="op" id="3858647">[</span><span class="op" id="3858648">]</span><span class="builtintype" id="3858649">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858657">var</span>&nbsp;<span class="ident" id="3858661">err</span>&nbsp;<span class="builtintype" id="3858665">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858672">for</span>&nbsp;<span class="op" id="3858676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858680">var</span>&nbsp;<span class="ident" id="3858684">line</span>&nbsp;<span class="builtintype" id="3858689">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858698">line</span><span class="op" id="3858702">,</span>&nbsp;<span class="ident" id="3858704">err</span>&nbsp;<span class="op" id="3858708">=</span>&nbsp;<span class="ident" id="3858710">r</span><span class="op" id="3858711">.</span><span class="ident" id="3858712">ReadLine</span><span class="op" id="3858720">(</span><span class="op" id="3858721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858725">if</span>&nbsp;<span class="ident" id="3858728">err</span>&nbsp;<span class="op" id="3858732">!=</span>&nbsp;<span class="ident" id="3858735">nil</span>&nbsp;<span class="op" id="3858739">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858744">if</span>&nbsp;<span class="ident" id="3858747">err</span>&nbsp;<span class="op" id="3858751">==</span>&nbsp;<span class="ident" id="3858754">io</span><span class="op" id="3858756">.</span><span class="ident" id="3858757">EOF</span>&nbsp;<span class="op" id="3858761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858767">err</span>&nbsp;<span class="op" id="3858771">=</span>&nbsp;<span class="ident" id="3858773">io</span><span class="op" id="3858775">.</span><span class="ident" id="3858776">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858801">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858809">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3858814">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858867">if</span>&nbsp;<span class="builtinfunc" id="3858870">len</span><span class="op" id="3858873">(</span><span class="ident" id="3858874">line</span><span class="op" id="3858878">)</span>&nbsp;<span class="op" id="3858880">&gt;</span>&nbsp;<span class="num" id="3858882">0</span>&nbsp;<span class="op" id="3858884">&amp;&amp;</span>&nbsp;<span class="ident" id="3858887">line</span><span class="op" id="3858891">[</span><span class="num" id="3858892">0</span><span class="op" id="3858893">]</span>&nbsp;<span class="op" id="3858895">==</span>&nbsp;<span class="string" id="3858898">&#39;.&#39;</span>&nbsp;<span class="op" id="3858902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858907">if</span>&nbsp;<span class="builtinfunc" id="3858910">len</span><span class="op" id="3858913">(</span><span class="ident" id="3858914">line</span><span class="op" id="3858918">)</span>&nbsp;<span class="op" id="3858920">==</span>&nbsp;<span class="num" id="3858923">1</span>&nbsp;<span class="op" id="3858925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858931">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858945">line</span>&nbsp;<span class="op" id="3858950">=</span>&nbsp;<span class="ident" id="3858952">line</span><span class="op" id="3858956">[</span><span class="num" id="3858957">1</span><span class="op" id="3858958">:</span><span class="op" id="3858959">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3858967">v</span>&nbsp;<span class="op" id="3858969">=</span>&nbsp;<span class="builtinfunc" id="3858971">append</span><span class="op" id="3858977">(</span><span class="ident" id="3858978">v</span><span class="op" id="3858979">,</span>&nbsp;<span class="ident" id="3858981">line</span><span class="op" id="3858985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3858988">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3858991">return</span>&nbsp;<span class="ident" id="3858998">v</span><span class="op" id="3858999">,</span>&nbsp;<span class="ident" id="3859001">err</span><br>
<span class="lineno"></span><span class="op" id="3859005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3859008">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3859060">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3859127">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3859154">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3859214">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3859280">//</span><br>
<span class="lineno"></span><span class="comment" id="3859283">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3859320">//</span><br>
<span class="lineno"></span><span class="comment" id="3859323">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3859342">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3859360">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3859383">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3859402">//</span><br>
<span class="lineno"></span><span class="comment" id="3859405">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3859458">//</span><br>
<span class="lineno"></span><span class="comment" id="3859461">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3859485">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3859523">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3859562">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3859567">//</span><br>
<span class="lineno"></span><span class="keyword" id="3859570">func</span>&nbsp;<span class="op" id="3859575">(</span><span class="ident" id="3859576">r</span>&nbsp;<span class="op" id="3859578">*</span><span class="ident" id="3859579">Reader</span><span class="op" id="3859585">)</span>&nbsp;<span class="ident" id="3859587">ReadMIMEHeader</span><span class="op" id="3859601">(</span><span class="op" id="3859602">)</span>&nbsp;<span class="op" id="3859604">(</span><span class="ident" id="3859605">MIMEHeader</span><span class="op" id="3859615">,</span>&nbsp;<span class="builtintype" id="3859617">error</span><span class="op" id="3859622">)</span>&nbsp;<span class="op" id="3859624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3859627">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3859693">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3859753">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859821">var</span>&nbsp;<span class="ident" id="3859825">strs</span>&nbsp;<span class="op" id="3859830">[</span><span class="op" id="3859831">]</span><span class="builtintype" id="3859832">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859840">hint</span>&nbsp;<span class="op" id="3859845">:=</span>&nbsp;<span class="ident" id="3859848">r</span><span class="op" id="3859849">.</span><span class="ident" id="3859850">upcomingHeaderNewlines</span><span class="op" id="3859872">(</span><span class="op" id="3859873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859876">if</span>&nbsp;<span class="ident" id="3859879">hint</span>&nbsp;<span class="op" id="3859884">&gt;</span>&nbsp;<span class="num" id="3859886">0</span>&nbsp;<span class="op" id="3859888">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859892">strs</span>&nbsp;<span class="op" id="3859897">=</span>&nbsp;<span class="builtinfunc" id="3859899">make</span><span class="op" id="3859903">(</span><span class="op" id="3859904">[</span><span class="op" id="3859905">]</span><span class="builtintype" id="3859906">string</span><span class="op" id="3859912">,</span>&nbsp;<span class="ident" id="3859914">hint</span><span class="op" id="3859918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3859921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859925">m</span>&nbsp;<span class="op" id="3859927">:=</span>&nbsp;<span class="builtinfunc" id="3859930">make</span><span class="op" id="3859934">(</span><span class="ident" id="3859935">MIMEHeader</span><span class="op" id="3859945">,</span>&nbsp;<span class="ident" id="3859947">hint</span><span class="op" id="3859951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3859954">for</span>&nbsp;<span class="op" id="3859958">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3859962">kv</span><span class="op" id="3859964">,</span>&nbsp;<span class="ident" id="3859966">err</span>&nbsp;<span class="op" id="3859970">:=</span>&nbsp;<span class="ident" id="3859973">r</span><span class="op" id="3859974">.</span><span class="ident" id="3859975">readContinuedLineSlice</span><span class="op" id="3859997">(</span><span class="op" id="3859998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860002">if</span>&nbsp;<span class="builtinfunc" id="3860005">len</span><span class="op" id="3860008">(</span><span class="ident" id="3860009">kv</span><span class="op" id="3860011">)</span>&nbsp;<span class="op" id="3860013">==</span>&nbsp;<span class="num" id="3860016">0</span>&nbsp;<span class="op" id="3860018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860023">return</span>&nbsp;<span class="ident" id="3860030">m</span><span class="op" id="3860031">,</span>&nbsp;<span class="ident" id="3860033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860044">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860101">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860154">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860183">i</span>&nbsp;<span class="op" id="3860185">:=</span>&nbsp;<span class="ident" id="3860188">bytes</span><span class="op" id="3860193">.</span><span class="ident" id="3860194">IndexByte</span><span class="op" id="3860203">(</span><span class="ident" id="3860204">kv</span><span class="op" id="3860206">,</span>&nbsp;<span class="string" id="3860208">&#39;:&#39;</span><span class="op" id="3860211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860215">if</span>&nbsp;<span class="ident" id="3860218">i</span>&nbsp;<span class="op" id="3860220">&lt;</span>&nbsp;<span class="num" id="3860222">0</span>&nbsp;<span class="op" id="3860224">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860229">return</span>&nbsp;<span class="ident" id="3860236">m</span><span class="op" id="3860237">,</span>&nbsp;<span class="ident" id="3860239">ProtocolError</span><span class="op" id="3860252">(</span><span class="string" id="3860253">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3860284">+</span>&nbsp;<span class="builtintype" id="3860286">string</span><span class="op" id="3860292">(</span><span class="ident" id="3860293">kv</span><span class="op" id="3860295">)</span><span class="op" id="3860296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860304">endKey</span>&nbsp;<span class="op" id="3860311">:=</span>&nbsp;<span class="ident" id="3860314">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860318">for</span>&nbsp;<span class="ident" id="3860322">endKey</span>&nbsp;<span class="op" id="3860329">&gt;</span>&nbsp;<span class="num" id="3860331">0</span>&nbsp;<span class="op" id="3860333">&amp;&amp;</span>&nbsp;<span class="ident" id="3860336">kv</span><span class="op" id="3860338">[</span><span class="ident" id="3860339">endKey</span><span class="op" id="3860345">-</span><span class="num" id="3860346">1</span><span class="op" id="3860347">]</span>&nbsp;<span class="op" id="3860349">==</span>&nbsp;<span class="string" id="3860352">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3860356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860361">endKey</span><span class="op" id="3860367">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860376">key</span>&nbsp;<span class="op" id="3860380">:=</span>&nbsp;<span class="ident" id="3860383">canonicalMIMEHeaderKey</span><span class="op" id="3860405">(</span><span class="ident" id="3860406">kv</span><span class="op" id="3860408">[</span><span class="op" id="3860409">:</span><span class="ident" id="3860410">endKey</span><span class="op" id="3860416">]</span><span class="op" id="3860417">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860422">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860457">i</span><span class="op" id="3860458">++</span>&nbsp;<span class="comment" id="3860461">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860477">for</span>&nbsp;<span class="ident" id="3860481">i</span>&nbsp;<span class="op" id="3860483">&lt;</span>&nbsp;<span class="builtinfunc" id="3860485">len</span><span class="op" id="3860488">(</span><span class="ident" id="3860489">kv</span><span class="op" id="3860491">)</span>&nbsp;<span class="op" id="3860493">&amp;&amp;</span>&nbsp;<span class="op" id="3860496">(</span><span class="ident" id="3860497">kv</span><span class="op" id="3860499">[</span><span class="ident" id="3860500">i</span><span class="op" id="3860501">]</span>&nbsp;<span class="op" id="3860503">==</span>&nbsp;<span class="string" id="3860506">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3860510">||</span>&nbsp;<span class="ident" id="3860513">kv</span><span class="op" id="3860515">[</span><span class="ident" id="3860516">i</span><span class="op" id="3860517">]</span>&nbsp;<span class="op" id="3860519">==</span>&nbsp;<span class="string" id="3860522">&#39;\t&#39;</span><span class="op" id="3860526">)</span>&nbsp;<span class="op" id="3860528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860533">i</span><span class="op" id="3860534">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860543">value</span>&nbsp;<span class="op" id="3860549">:=</span>&nbsp;<span class="builtintype" id="3860552">string</span><span class="op" id="3860558">(</span><span class="ident" id="3860559">kv</span><span class="op" id="3860561">[</span><span class="ident" id="3860562">i</span><span class="op" id="3860563">:</span><span class="op" id="3860564">]</span><span class="op" id="3860565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860570">vv</span>&nbsp;<span class="op" id="3860573">:=</span>&nbsp;<span class="ident" id="3860576">m</span><span class="op" id="3860577">[</span><span class="ident" id="3860578">key</span><span class="op" id="3860581">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860585">if</span>&nbsp;<span class="ident" id="3860588">vv</span>&nbsp;<span class="op" id="3860591">==</span>&nbsp;<span class="ident" id="3860594">nil</span>&nbsp;<span class="op" id="3860598">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3860601">len</span><span class="op" id="3860604">(</span><span class="ident" id="3860605">strs</span><span class="op" id="3860609">)</span>&nbsp;<span class="op" id="3860611">&gt;</span>&nbsp;<span class="num" id="3860613">0</span>&nbsp;<span class="op" id="3860615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860620">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860678">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860718">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3860779">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860832">vv</span><span class="op" id="3860834">,</span>&nbsp;<span class="ident" id="3860836">strs</span>&nbsp;<span class="op" id="3860841">=</span>&nbsp;<span class="ident" id="3860843">strs</span><span class="op" id="3860847">[</span><span class="op" id="3860848">:</span><span class="num" id="3860849">1</span><span class="op" id="3860850">:</span><span class="num" id="3860851">1</span><span class="op" id="3860852">]</span><span class="op" id="3860853">,</span>&nbsp;<span class="ident" id="3860855">strs</span><span class="op" id="3860859">[</span><span class="num" id="3860860">1</span><span class="op" id="3860861">:</span><span class="op" id="3860862">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860867">vv</span><span class="op" id="3860869">[</span><span class="num" id="3860870">0</span><span class="op" id="3860871">]</span>&nbsp;<span class="op" id="3860873">=</span>&nbsp;<span class="ident" id="3860875">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860884">m</span><span class="op" id="3860885">[</span><span class="ident" id="3860886">key</span><span class="op" id="3860889">]</span>&nbsp;<span class="op" id="3860891">=</span>&nbsp;<span class="ident" id="3860893">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860898">}</span>&nbsp;<span class="keyword" id="3860900">else</span>&nbsp;<span class="op" id="3860905">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3860910">m</span><span class="op" id="3860911">[</span><span class="ident" id="3860912">key</span><span class="op" id="3860915">]</span>&nbsp;<span class="op" id="3860917">=</span>&nbsp;<span class="builtinfunc" id="3860919">append</span><span class="op" id="3860925">(</span><span class="ident" id="3860926">vv</span><span class="op" id="3860928">,</span>&nbsp;<span class="ident" id="3860930">value</span><span class="op" id="3860935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860944">if</span>&nbsp;<span class="ident" id="3860947">err</span>&nbsp;<span class="op" id="3860951">!=</span>&nbsp;<span class="ident" id="3860954">nil</span>&nbsp;<span class="op" id="3860958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3860963">return</span>&nbsp;<span class="ident" id="3860970">m</span><span class="op" id="3860971">,</span>&nbsp;<span class="ident" id="3860973">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3860982">}</span><br>
<span class="lineno"></span><span class="op" id="3860984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3860987">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3861064">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3861131">func</span>&nbsp;<span class="op" id="3861136">(</span><span class="ident" id="3861137">r</span>&nbsp;<span class="op" id="3861139">*</span><span class="ident" id="3861140">Reader</span><span class="op" id="3861146">)</span>&nbsp;<span class="ident" id="3861148">upcomingHeaderNewlines</span><span class="op" id="3861170">(</span><span class="op" id="3861171">)</span>&nbsp;<span class="op" id="3861173">(</span><span class="ident" id="3861174">n</span>&nbsp;<span class="builtintype" id="3861176">int</span><span class="op" id="3861179">)</span>&nbsp;<span class="op" id="3861181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861184">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861222">r</span><span class="op" id="3861223">.</span><span class="ident" id="3861224">R</span><span class="op" id="3861225">.</span><span class="ident" id="3861226">Peek</span><span class="op" id="3861230">(</span><span class="num" id="3861231">1</span><span class="op" id="3861232">)</span>&nbsp;<span class="comment" id="3861234">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861267">s</span>&nbsp;<span class="op" id="3861269">:=</span>&nbsp;<span class="ident" id="3861272">r</span><span class="op" id="3861273">.</span><span class="ident" id="3861274">R</span><span class="op" id="3861275">.</span><span class="ident" id="3861276">Buffered</span><span class="op" id="3861284">(</span><span class="op" id="3861285">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861288">if</span>&nbsp;<span class="ident" id="3861291">s</span>&nbsp;<span class="op" id="3861293">==</span>&nbsp;<span class="num" id="3861296">0</span>&nbsp;<span class="op" id="3861298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861302">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861313">peek</span><span class="op" id="3861317">,</span>&nbsp;<span class="ident" id="3861319">_</span>&nbsp;<span class="op" id="3861321">:=</span>&nbsp;<span class="ident" id="3861324">r</span><span class="op" id="3861325">.</span><span class="ident" id="3861326">R</span><span class="op" id="3861327">.</span><span class="ident" id="3861328">Peek</span><span class="op" id="3861332">(</span><span class="ident" id="3861333">s</span><span class="op" id="3861334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861337">for</span>&nbsp;<span class="builtinfunc" id="3861341">len</span><span class="op" id="3861344">(</span><span class="ident" id="3861345">peek</span><span class="op" id="3861349">)</span>&nbsp;<span class="op" id="3861351">&gt;</span>&nbsp;<span class="num" id="3861353">0</span>&nbsp;<span class="op" id="3861355">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861359">i</span>&nbsp;<span class="op" id="3861361">:=</span>&nbsp;<span class="ident" id="3861364">bytes</span><span class="op" id="3861369">.</span><span class="ident" id="3861370">IndexByte</span><span class="op" id="3861379">(</span><span class="ident" id="3861380">peek</span><span class="op" id="3861384">,</span>&nbsp;<span class="string" id="3861386">&#39;\n&#39;</span><span class="op" id="3861390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861394">if</span>&nbsp;<span class="ident" id="3861397">i</span>&nbsp;<span class="op" id="3861399">&lt;</span>&nbsp;<span class="num" id="3861401">3</span>&nbsp;<span class="op" id="3861403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861408">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861467">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861522">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861535">n</span><span class="op" id="3861536">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3861541">peek</span>&nbsp;<span class="op" id="3861546">=</span>&nbsp;<span class="ident" id="3861548">peek</span><span class="op" id="3861552">[</span><span class="ident" id="3861553">i</span><span class="op" id="3861554">+</span><span class="num" id="3861555">1</span><span class="op" id="3861556">:</span><span class="op" id="3861557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3861560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3861563">return</span><br>
<span class="lineno">535</span><span class="op" id="3861570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3861573">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3861635">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3861698">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3861757">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3861815">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3861876">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3861926">func</span>&nbsp;<span class="ident" id="3861931">CanonicalMIMEHeaderKey</span><span class="op" id="3861953">(</span><span class="ident" id="3861954">s</span>&nbsp;<span class="builtintype" id="3861956">string</span><span class="op" id="3861962">)</span>&nbsp;<span class="builtintype" id="3861964">string</span>&nbsp;<span class="op" id="3861971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3861974">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862014">upper</span>&nbsp;<span class="op" id="3862020">:=</span>&nbsp;<span class="builtintype" id="3862023">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862029">for</span>&nbsp;<span class="ident" id="3862033">i</span>&nbsp;<span class="op" id="3862035">:=</span>&nbsp;<span class="num" id="3862038">0</span><span class="op" id="3862039">;</span>&nbsp;<span class="ident" id="3862041">i</span>&nbsp;<span class="op" id="3862043">&lt;</span>&nbsp;<span class="builtinfunc" id="3862045">len</span><span class="op" id="3862048">(</span><span class="ident" id="3862049">s</span><span class="op" id="3862050">)</span><span class="op" id="3862051">;</span>&nbsp;<span class="ident" id="3862053">i</span><span class="op" id="3862054">++</span>&nbsp;<span class="op" id="3862057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862061">c</span>&nbsp;<span class="op" id="3862063">:=</span>&nbsp;<span class="ident" id="3862066">s</span><span class="op" id="3862067">[</span><span class="ident" id="3862068">i</span><span class="op" id="3862069">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862073">if</span>&nbsp;<span class="ident" id="3862076">upper</span>&nbsp;<span class="op" id="3862082">&amp;&amp;</span>&nbsp;<span class="string" id="3862085">&#39;a&#39;</span>&nbsp;<span class="op" id="3862089">&lt;=</span>&nbsp;<span class="ident" id="3862092">c</span>&nbsp;<span class="op" id="3862094">&amp;&amp;</span>&nbsp;<span class="ident" id="3862097">c</span>&nbsp;<span class="op" id="3862099">&lt;=</span>&nbsp;<span class="string" id="3862102">&#39;z&#39;</span>&nbsp;<span class="op" id="3862106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862111">return</span>&nbsp;<span class="ident" id="3862118">canonicalMIMEHeaderKey</span><span class="op" id="3862140">(</span><span class="op" id="3862141">[</span><span class="op" id="3862142">]</span><span class="builtintype" id="3862143">byte</span><span class="op" id="3862147">(</span><span class="ident" id="3862148">s</span><span class="op" id="3862149">)</span><span class="op" id="3862150">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862158">if</span>&nbsp;<span class="op" id="3862161">!</span><span class="ident" id="3862162">upper</span>&nbsp;<span class="op" id="3862168">&amp;&amp;</span>&nbsp;<span class="string" id="3862171">&#39;A&#39;</span>&nbsp;<span class="op" id="3862175">&lt;=</span>&nbsp;<span class="ident" id="3862178">c</span>&nbsp;<span class="op" id="3862180">&amp;&amp;</span>&nbsp;<span class="ident" id="3862183">c</span>&nbsp;<span class="op" id="3862185">&lt;=</span>&nbsp;<span class="string" id="3862188">&#39;Z&#39;</span>&nbsp;<span class="op" id="3862192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862197">return</span>&nbsp;<span class="ident" id="3862204">canonicalMIMEHeaderKey</span><span class="op" id="3862226">(</span><span class="op" id="3862227">[</span><span class="op" id="3862228">]</span><span class="builtintype" id="3862229">byte</span><span class="op" id="3862233">(</span><span class="ident" id="3862234">s</span><span class="op" id="3862235">)</span><span class="op" id="3862236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862244">upper</span>&nbsp;<span class="op" id="3862250">=</span>&nbsp;<span class="ident" id="3862252">c</span>&nbsp;<span class="op" id="3862254">==</span>&nbsp;<span class="string" id="3862257">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862265">return</span>&nbsp;<span class="ident" id="3862272">s</span><br>
<span class="lineno"></span><span class="op" id="3862274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862277">const</span>&nbsp;<span class="ident" id="3862283">toLower</span>&nbsp;<span class="op" id="3862291">=</span>&nbsp;<span class="string" id="3862293">&#39;a&#39;</span>&nbsp;<span class="op" id="3862297">-</span>&nbsp;<span class="string" id="3862299">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3862304">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3862368">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3862434">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3862445">func</span>&nbsp;<span class="ident" id="3862450">canonicalMIMEHeaderKey</span><span class="op" id="3862472">(</span><span class="ident" id="3862473">a</span>&nbsp;<span class="op" id="3862475">[</span><span class="op" id="3862476">]</span><span class="builtintype" id="3862477">byte</span><span class="op" id="3862481">)</span>&nbsp;<span class="builtintype" id="3862483">string</span>&nbsp;<span class="op" id="3862490">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862493">upper</span>&nbsp;<span class="op" id="3862499">:=</span>&nbsp;<span class="builtintype" id="3862502">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862508">for</span>&nbsp;<span class="ident" id="3862512">i</span><span class="op" id="3862513">,</span>&nbsp;<span class="ident" id="3862515">c</span>&nbsp;<span class="op" id="3862517">:=</span>&nbsp;<span class="keyword" id="3862520">range</span>&nbsp;<span class="ident" id="3862526">a</span>&nbsp;<span class="op" id="3862528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862532">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862575">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862612">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862656">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3862712">if</span>&nbsp;<span class="ident" id="3862715">c</span>&nbsp;<span class="op" id="3862717">==</span>&nbsp;<span class="string" id="3862720">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3862724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862729">c</span>&nbsp;<span class="op" id="3862731">=</span>&nbsp;<span class="string" id="3862733">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862739">}</span>&nbsp;<span class="keyword" id="3862741">else</span>&nbsp;<span class="keyword" id="3862746">if</span>&nbsp;<span class="ident" id="3862749">upper</span>&nbsp;<span class="op" id="3862755">&amp;&amp;</span>&nbsp;<span class="string" id="3862758">&#39;a&#39;</span>&nbsp;<span class="op" id="3862762">&lt;=</span>&nbsp;<span class="ident" id="3862765">c</span>&nbsp;<span class="op" id="3862767">&amp;&amp;</span>&nbsp;<span class="ident" id="3862770">c</span>&nbsp;<span class="op" id="3862772">&lt;=</span>&nbsp;<span class="string" id="3862775">&#39;z&#39;</span>&nbsp;<span class="op" id="3862779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862784">c</span>&nbsp;<span class="op" id="3862786">-=</span>&nbsp;<span class="ident" id="3862789">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862799">}</span>&nbsp;<span class="keyword" id="3862801">else</span>&nbsp;<span class="keyword" id="3862806">if</span>&nbsp;<span class="op" id="3862809">!</span><span class="ident" id="3862810">upper</span>&nbsp;<span class="op" id="3862816">&amp;&amp;</span>&nbsp;<span class="string" id="3862819">&#39;A&#39;</span>&nbsp;<span class="op" id="3862823">&lt;=</span>&nbsp;<span class="ident" id="3862826">c</span>&nbsp;<span class="op" id="3862828">&amp;&amp;</span>&nbsp;<span class="ident" id="3862831">c</span>&nbsp;<span class="op" id="3862833">&lt;=</span>&nbsp;<span class="string" id="3862836">&#39;Z&#39;</span>&nbsp;<span class="op" id="3862840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862845">c</span>&nbsp;<span class="op" id="3862847">+=</span>&nbsp;<span class="ident" id="3862850">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862864">a</span><span class="op" id="3862865">[</span><span class="ident" id="3862866">i</span><span class="op" id="3862867">]</span>&nbsp;<span class="op" id="3862869">=</span>&nbsp;<span class="ident" id="3862871">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3862875">upper</span>&nbsp;<span class="op" id="3862881">=</span>&nbsp;<span class="ident" id="3862883">c</span>&nbsp;<span class="op" id="3862885">==</span>&nbsp;<span class="string" id="3862888">&#39;-&#39;</span>&nbsp;<span class="comment" id="3862892">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3862910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862913">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3862975">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3863035">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863066">if</span>&nbsp;<span class="ident" id="3863069">v</span>&nbsp;<span class="op" id="3863071">:=</span>&nbsp;<span class="ident" id="3863074">commonHeader</span><span class="op" id="3863086">[</span><span class="builtintype" id="3863087">string</span><span class="op" id="3863093">(</span><span class="ident" id="3863094">a</span><span class="op" id="3863095">)</span><span class="op" id="3863096">]</span><span class="op" id="3863097">;</span>&nbsp;<span class="ident" id="3863099">v</span>&nbsp;<span class="op" id="3863101">!=</span>&nbsp;<span class="string" id="3863104">&#34;&#34;</span>&nbsp;<span class="op" id="3863107">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863111">return</span>&nbsp;<span class="ident" id="3863118">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863124">return</span>&nbsp;<span class="builtintype" id="3863131">string</span><span class="op" id="3863137">(</span><span class="ident" id="3863138">a</span><span class="op" id="3863139">)</span><br>
<span class="lineno"></span><span class="op" id="3863141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3863144">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3863191">var</span>&nbsp;<span class="ident" id="3863195">commonHeader</span>&nbsp;<span class="op" id="3863208">=</span>&nbsp;<span class="builtinfunc" id="3863210">make</span><span class="op" id="3863214">(</span><span class="keyword" id="3863215">map</span><span class="op" id="3863218">[</span><span class="builtintype" id="3863219">string</span><span class="op" id="3863225">]</span><span class="builtintype" id="3863226">string</span><span class="op" id="3863232">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863235">func</span>&nbsp;<span class="ident" id="3863240">init</span><span class="op" id="3863244">(</span><span class="op" id="3863245">)</span>&nbsp;<span class="op" id="3863247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3863250">for</span>&nbsp;<span class="ident" id="3863254">_</span><span class="op" id="3863255">,</span>&nbsp;<span class="ident" id="3863257">v</span>&nbsp;<span class="op" id="3863259">:=</span>&nbsp;<span class="keyword" id="3863262">range</span>&nbsp;<span class="op" id="3863268">[</span><span class="op" id="3863269">]</span><span class="builtintype" id="3863270">string</span><span class="op" id="3863276">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863280">&#34;Accept&#34;</span><span class="op" id="3863288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863292">&#34;Accept-Charset&#34;</span><span class="op" id="3863308">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863312">&#34;Accept-Encoding&#34;</span><span class="op" id="3863329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863333">&#34;Accept-Language&#34;</span><span class="op" id="3863350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863354">&#34;Accept-Ranges&#34;</span><span class="op" id="3863369">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863373">&#34;Cache-Control&#34;</span><span class="op" id="3863388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863392">&#34;Cc&#34;</span><span class="op" id="3863396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863400">&#34;Connection&#34;</span><span class="op" id="3863412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863416">&#34;Content-Id&#34;</span><span class="op" id="3863428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863432">&#34;Content-Language&#34;</span><span class="op" id="3863450">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863454">&#34;Content-Length&#34;</span><span class="op" id="3863470">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863474">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3863501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863505">&#34;Content-Type&#34;</span><span class="op" id="3863519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863523">&#34;Cookie&#34;</span><span class="op" id="3863531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863535">&#34;Date&#34;</span><span class="op" id="3863541">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863545">&#34;Dkim-Signature&#34;</span><span class="op" id="3863561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863565">&#34;Etag&#34;</span><span class="op" id="3863571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863575">&#34;Expires&#34;</span><span class="op" id="3863584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863588">&#34;From&#34;</span><span class="op" id="3863594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863598">&#34;Host&#34;</span><span class="op" id="3863604">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863608">&#34;If-Modified-Since&#34;</span><span class="op" id="3863627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863631">&#34;If-None-Match&#34;</span><span class="op" id="3863646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863650">&#34;In-Reply-To&#34;</span><span class="op" id="3863663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863667">&#34;Last-Modified&#34;</span><span class="op" id="3863682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863686">&#34;Location&#34;</span><span class="op" id="3863696">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863700">&#34;Message-Id&#34;</span><span class="op" id="3863712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863716">&#34;Mime-Version&#34;</span><span class="op" id="3863730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863734">&#34;Pragma&#34;</span><span class="op" id="3863742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863746">&#34;Received&#34;</span><span class="op" id="3863756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863760">&#34;Return-Path&#34;</span><span class="op" id="3863773">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863777">&#34;Server&#34;</span><span class="op" id="3863785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863789">&#34;Set-Cookie&#34;</span><span class="op" id="3863801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863805">&#34;Subject&#34;</span><span class="op" id="3863814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863818">&#34;To&#34;</span><span class="op" id="3863822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863826">&#34;User-Agent&#34;</span><span class="op" id="3863838">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863842">&#34;Via&#34;</span><span class="op" id="3863847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863851">&#34;X-Forwarded-For&#34;</span><span class="op" id="3863868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863872">&#34;X-Imforwards&#34;</span><span class="op" id="3863886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3863890">&#34;X-Powered-By&#34;</span><span class="op" id="3863904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863907">}</span>&nbsp;<span class="op" id="3863909">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3863913">commonHeader</span><span class="op" id="3863925">[</span><span class="ident" id="3863926">v</span><span class="op" id="3863927">]</span>&nbsp;<span class="op" id="3863929">=</span>&nbsp;<span class="ident" id="3863931">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3863934">}</span><br>
<span class="lineno"></span><span class="op" id="3863936">}</span>
</div>
</body>
</html>
