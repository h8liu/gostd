<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5983347">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5983402">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5983456">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5983507">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;host&nbsp;side&nbsp;of&nbsp;CGI&nbsp;(being&nbsp;the&nbsp;webserver</span><br>
<span class="lineno"></span><span class="comment" id="5983573">//&nbsp;parent&nbsp;process).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5983594">//&nbsp;Package&nbsp;cgi&nbsp;implements&nbsp;CGI&nbsp;(Common&nbsp;Gateway&nbsp;Interface)&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5983664">//&nbsp;in&nbsp;RFC&nbsp;3875.</span><br>
<span class="lineno">10</span><span class="comment" id="5983680">//</span><br>
<span class="lineno"></span><span class="comment" id="5983683">//&nbsp;Note&nbsp;that&nbsp;using&nbsp;CGI&nbsp;means&nbsp;starting&nbsp;a&nbsp;new&nbsp;process&nbsp;to&nbsp;handle&nbsp;each</span><br>
<span class="lineno"></span><span class="comment" id="5983750">//&nbsp;request,&nbsp;which&nbsp;is&nbsp;typically&nbsp;less&nbsp;efficient&nbsp;than&nbsp;using&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5983809">//&nbsp;long-running&nbsp;server.&nbsp;&nbsp;This&nbsp;package&nbsp;is&nbsp;intended&nbsp;primarily&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5983873">//&nbsp;compatibility&nbsp;with&nbsp;existing&nbsp;systems.</span><br>
<span class="lineno">15</span><span class="keyword" id="5983913">package</span>&nbsp;<span class="ident" id="5983921">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5983926">import</span>&nbsp;<span class="op" id="5983933">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983936">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983945">&#34;fmt&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983952">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983958">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983965">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983977">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983983">&#34;os/exec&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5983994">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984011">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984021">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984032">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984043">&#34;strings&#34;</span><br>
<span class="lineno">30</span><span class="op" id="5984053">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984056">var</span>&nbsp;<span class="ident" id="5984060">trailingPort</span>&nbsp;<span class="op" id="5984073">=</span>&nbsp;<span class="ident" id="5984075">regexp</span><span class="op" id="5984081">.</span><span class="ident" id="5984082">MustCompile</span><span class="op" id="5984093">(</span><span class="string" id="5984094">`:([0-9]+)$`</span><span class="op" id="5984106">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5984109">var</span>&nbsp;<span class="ident" id="5984113">osDefaultInheritEnv</span>&nbsp;<span class="op" id="5984133">=</span>&nbsp;<span class="keyword" id="5984135">map</span><span class="op" id="5984138">[</span><span class="builtintype" id="5984139">string</span><span class="op" id="5984145">]</span><span class="op" id="5984146">[</span><span class="op" id="5984147">]</span><span class="builtintype" id="5984148">string</span><span class="op" id="5984154">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984157">&#34;darwin&#34;</span><span class="op" id="5984165">:</span>&nbsp;&nbsp;<span class="op" id="5984168">{</span><span class="string" id="5984169">&#34;DYLD_LIBRARY_PATH&#34;</span><span class="op" id="5984188">}</span><span class="op" id="5984189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984192">&#34;freebsd&#34;</span><span class="op" id="5984201">:</span>&nbsp;<span class="op" id="5984203">{</span><span class="string" id="5984204">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984221">}</span><span class="op" id="5984222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984225">&#34;hpux&#34;</span><span class="op" id="5984231">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984236">{</span><span class="string" id="5984237">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984254">,</span>&nbsp;<span class="string" id="5984256">&#34;SHLIB_PATH&#34;</span><span class="op" id="5984268">}</span><span class="op" id="5984269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984272">&#34;irix&#34;</span><span class="op" id="5984278">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984283">{</span><span class="string" id="5984284">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984301">,</span>&nbsp;<span class="string" id="5984303">&#34;LD_LIBRARYN32_PATH&#34;</span><span class="op" id="5984323">,</span>&nbsp;<span class="string" id="5984325">&#34;LD_LIBRARY64_PATH&#34;</span><span class="op" id="5984344">}</span><span class="op" id="5984345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984348">&#34;linux&#34;</span><span class="op" id="5984355">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5984359">{</span><span class="string" id="5984360">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984377">}</span><span class="op" id="5984378">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984381">&#34;openbsd&#34;</span><span class="op" id="5984390">:</span>&nbsp;<span class="op" id="5984392">{</span><span class="string" id="5984393">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984410">}</span><span class="op" id="5984411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984414">&#34;solaris&#34;</span><span class="op" id="5984423">:</span>&nbsp;<span class="op" id="5984425">{</span><span class="string" id="5984426">&#34;LD_LIBRARY_PATH&#34;</span><span class="op" id="5984443">,</span>&nbsp;<span class="string" id="5984445">&#34;LD_LIBRARY_PATH_32&#34;</span><span class="op" id="5984465">,</span>&nbsp;<span class="string" id="5984467">&#34;LD_LIBRARY_PATH_64&#34;</span><span class="op" id="5984487">}</span><span class="op" id="5984488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5984491">&#34;windows&#34;</span><span class="op" id="5984500">:</span>&nbsp;<span class="op" id="5984502">{</span><span class="string" id="5984503">&#34;SystemRoot&#34;</span><span class="op" id="5984515">,</span>&nbsp;<span class="string" id="5984517">&#34;COMSPEC&#34;</span><span class="op" id="5984526">,</span>&nbsp;<span class="string" id="5984528">&#34;PATHEXT&#34;</span><span class="op" id="5984537">,</span>&nbsp;<span class="string" id="5984539">&#34;WINDIR&#34;</span><span class="op" id="5984547">}</span><span class="op" id="5984548">,</span><br>
<span class="lineno"></span><span class="op" id="5984550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5984553">//&nbsp;Handler&nbsp;runs&nbsp;an&nbsp;executable&nbsp;in&nbsp;a&nbsp;subprocess&nbsp;with&nbsp;a&nbsp;CGI&nbsp;environment.</span><br>
<span class="lineno"></span><span class="keyword" id="5984623">type</span>&nbsp;<span class="ident" id="5984628">Handler</span>&nbsp;<span class="keyword" id="5984636">struct</span>&nbsp;<span class="op" id="5984643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984646">Path</span>&nbsp;<span class="builtintype" id="5984651">string</span>&nbsp;<span class="comment" id="5984658">//&nbsp;path&nbsp;to&nbsp;the&nbsp;CGI&nbsp;executable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984689">Root</span>&nbsp;<span class="builtintype" id="5984694">string</span>&nbsp;<span class="comment" id="5984701">//&nbsp;root&nbsp;URI&nbsp;prefix&nbsp;of&nbsp;handler&nbsp;or&nbsp;empty&nbsp;for&nbsp;&#34;/&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984750">//&nbsp;Dir&nbsp;specifies&nbsp;the&nbsp;CGI&nbsp;executable&#39;s&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984808">//&nbsp;If&nbsp;Dir&nbsp;is&nbsp;empty,&nbsp;the&nbsp;base&nbsp;directory&nbsp;of&nbsp;Path&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984865">//&nbsp;If&nbsp;Path&nbsp;has&nbsp;no&nbsp;base&nbsp;directory,&nbsp;the&nbsp;current&nbsp;working</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5984920">//&nbsp;directory&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984943">Dir</span>&nbsp;<span class="builtintype" id="5984947">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5984956">Env</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5984967">[</span><span class="op" id="5984968">]</span><span class="builtintype" id="5984969">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5984979">//&nbsp;extra&nbsp;environment&nbsp;variables&nbsp;to&nbsp;set,&nbsp;if&nbsp;any,&nbsp;as&nbsp;&#34;key=value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985042">InheritEnv</span>&nbsp;<span class="op" id="5985053">[</span><span class="op" id="5985054">]</span><span class="builtintype" id="5985055">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985065">//&nbsp;environment&nbsp;variables&nbsp;to&nbsp;inherit&nbsp;from&nbsp;host,&nbsp;as&nbsp;&#34;key&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985122">Logger</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985133">*</span><span class="ident" id="5985134">log</span><span class="op" id="5985137">.</span><span class="ident" id="5985138">Logger</span>&nbsp;<span class="comment" id="5985145">//&nbsp;optional&nbsp;log&nbsp;for&nbsp;errors&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;log.Print</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985197">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5985208">[</span><span class="op" id="5985209">]</span><span class="builtintype" id="5985210">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5985220">//&nbsp;optional&nbsp;arguments&nbsp;to&nbsp;pass&nbsp;to&nbsp;child&nbsp;process</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985269">//&nbsp;PathLocationHandler&nbsp;specifies&nbsp;the&nbsp;root&nbsp;http&nbsp;Handler&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985330">//&nbsp;should&nbsp;handle&nbsp;internal&nbsp;redirects&nbsp;when&nbsp;the&nbsp;CGI&nbsp;process</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985388">//&nbsp;returns&nbsp;a&nbsp;Location&nbsp;header&nbsp;value&nbsp;starting&nbsp;with&nbsp;a&nbsp;&#34;/&#34;,&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985448">//&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;3875&nbsp;ยง&nbsp;6.3.2.&nbsp;This&nbsp;will&nbsp;likely&nbsp;be</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985504">//&nbsp;http.DefaultServeMux.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985530">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985534">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;CGI&nbsp;response&nbsp;with&nbsp;a&nbsp;local&nbsp;URI&nbsp;path&nbsp;is&nbsp;instead&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5985599">//&nbsp;back&nbsp;to&nbsp;the&nbsp;client&nbsp;and&nbsp;not&nbsp;redirected&nbsp;internally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985653">PathLocationHandler</span>&nbsp;<span class="ident" id="5985673">http</span><span class="op" id="5985677">.</span><span class="ident" id="5985678">Handler</span><br>
<span class="lineno">70</span><span class="op" id="5985686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5985689">//&nbsp;removeLeadingDuplicates&nbsp;remove&nbsp;leading&nbsp;duplicate&nbsp;in&nbsp;environments.</span><br>
<span class="lineno"></span><span class="comment" id="5985758">//&nbsp;It&#39;s&nbsp;possible&nbsp;to&nbsp;override&nbsp;environment&nbsp;like&nbsp;following.</span><br>
<span class="lineno"></span><span class="comment" id="5985815">//&nbsp;&nbsp;&nbsp;&nbsp;cgi.Handler{</span><br>
<span class="lineno">75</span><span class="comment" id="5985834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5985846">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Env:&nbsp;[]string{&#34;SCRIPT_FILENAME=foo.php&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="5985896">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="5985904">func</span>&nbsp;<span class="ident" id="5985909">removeLeadingDuplicates</span><span class="op" id="5985932">(</span><span class="ident" id="5985933">env</span>&nbsp;<span class="op" id="5985937">[</span><span class="op" id="5985938">]</span><span class="builtintype" id="5985939">string</span><span class="op" id="5985945">)</span>&nbsp;<span class="op" id="5985947">(</span><span class="ident" id="5985948">ret</span>&nbsp;<span class="op" id="5985952">[</span><span class="op" id="5985953">]</span><span class="builtintype" id="5985954">string</span><span class="op" id="5985960">)</span>&nbsp;<span class="op" id="5985962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5985965">n</span>&nbsp;<span class="op" id="5985967">:=</span>&nbsp;<span class="builtinfunc" id="5985970">len</span><span class="op" id="5985973">(</span><span class="ident" id="5985974">env</span><span class="op" id="5985977">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5985980">for</span>&nbsp;<span class="ident" id="5985984">i</span>&nbsp;<span class="op" id="5985986">:=</span>&nbsp;<span class="num" id="5985989">0</span><span class="op" id="5985990">;</span>&nbsp;<span class="ident" id="5985992">i</span>&nbsp;<span class="op" id="5985994">&lt;</span>&nbsp;<span class="ident" id="5985996">n</span><span class="op" id="5985997">;</span>&nbsp;<span class="ident" id="5985999">i</span><span class="op" id="5986000">++</span>&nbsp;<span class="op" id="5986003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986007">e</span>&nbsp;<span class="op" id="5986009">:=</span>&nbsp;<span class="ident" id="5986012">env</span><span class="op" id="5986015">[</span><span class="ident" id="5986016">i</span><span class="op" id="5986017">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986021">s</span>&nbsp;<span class="op" id="5986023">:=</span>&nbsp;<span class="ident" id="5986026">strings</span><span class="op" id="5986033">.</span><span class="ident" id="5986034">SplitN</span><span class="op" id="5986040">(</span><span class="ident" id="5986041">e</span><span class="op" id="5986042">,</span>&nbsp;<span class="string" id="5986044">&#34;=&#34;</span><span class="op" id="5986047">,</span>&nbsp;<span class="num" id="5986049">2</span><span class="op" id="5986050">)</span><span class="op" id="5986051">[</span><span class="num" id="5986052">0</span><span class="op" id="5986053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986057">found</span>&nbsp;<span class="op" id="5986063">:=</span>&nbsp;<span class="builtintype" id="5986066">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986074">for</span>&nbsp;<span class="ident" id="5986078">j</span>&nbsp;<span class="op" id="5986080">:=</span>&nbsp;<span class="ident" id="5986083">i</span>&nbsp;<span class="op" id="5986085">+</span>&nbsp;<span class="num" id="5986087">1</span><span class="op" id="5986088">;</span>&nbsp;<span class="ident" id="5986090">j</span>&nbsp;<span class="op" id="5986092">&lt;</span>&nbsp;<span class="ident" id="5986094">n</span><span class="op" id="5986095">;</span>&nbsp;<span class="ident" id="5986097">j</span><span class="op" id="5986098">++</span>&nbsp;<span class="op" id="5986101">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986106">if</span>&nbsp;<span class="ident" id="5986109">s</span>&nbsp;<span class="op" id="5986111">==</span>&nbsp;<span class="ident" id="5986114">strings</span><span class="op" id="5986121">.</span><span class="ident" id="5986122">SplitN</span><span class="op" id="5986128">(</span><span class="ident" id="5986129">env</span><span class="op" id="5986132">[</span><span class="ident" id="5986133">j</span><span class="op" id="5986134">]</span><span class="op" id="5986135">,</span>&nbsp;<span class="string" id="5986137">&#34;=&#34;</span><span class="op" id="5986140">,</span>&nbsp;<span class="num" id="5986142">2</span><span class="op" id="5986143">)</span><span class="op" id="5986144">[</span><span class="num" id="5986145">0</span><span class="op" id="5986146">]</span>&nbsp;<span class="op" id="5986148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986154">found</span>&nbsp;<span class="op" id="5986160">=</span>&nbsp;<span class="builtintype" id="5986162">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986184">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986188">if</span>&nbsp;<span class="op" id="5986191">!</span><span class="ident" id="5986192">found</span>&nbsp;<span class="op" id="5986198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986203">ret</span>&nbsp;<span class="op" id="5986207">=</span>&nbsp;<span class="builtinfunc" id="5986209">append</span><span class="op" id="5986215">(</span><span class="ident" id="5986216">ret</span><span class="op" id="5986219">,</span>&nbsp;<span class="ident" id="5986221">e</span><span class="op" id="5986222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986232">return</span><br>
<span class="lineno">95</span><span class="op" id="5986239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5986242">func</span>&nbsp;<span class="op" id="5986247">(</span><span class="ident" id="5986248">h</span>&nbsp;<span class="op" id="5986250">*</span><span class="ident" id="5986251">Handler</span><span class="op" id="5986258">)</span>&nbsp;<span class="ident" id="5986260">ServeHTTP</span><span class="op" id="5986269">(</span><span class="ident" id="5986270">rw</span>&nbsp;<span class="ident" id="5986273">http</span><span class="op" id="5986277">.</span><span class="ident" id="5986278">ResponseWriter</span><span class="op" id="5986292">,</span>&nbsp;<span class="ident" id="5986294">req</span>&nbsp;<span class="op" id="5986298">*</span><span class="ident" id="5986299">http</span><span class="op" id="5986303">.</span><span class="ident" id="5986304">Request</span><span class="op" id="5986311">)</span>&nbsp;<span class="op" id="5986313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986316">root</span>&nbsp;<span class="op" id="5986321">:=</span>&nbsp;<span class="ident" id="5986324">h</span><span class="op" id="5986325">.</span><span class="ident" id="5986326">Root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986332">if</span>&nbsp;<span class="ident" id="5986335">root</span>&nbsp;<span class="op" id="5986340">==</span>&nbsp;<span class="string" id="5986343">&#34;&#34;</span>&nbsp;<span class="op" id="5986346">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986350">root</span>&nbsp;<span class="op" id="5986355">=</span>&nbsp;<span class="string" id="5986357">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986366">if</span>&nbsp;<span class="builtinfunc" id="5986369">len</span><span class="op" id="5986372">(</span><span class="ident" id="5986373">req</span><span class="op" id="5986376">.</span><span class="ident" id="5986377">TransferEncoding</span><span class="op" id="5986393">)</span>&nbsp;<span class="op" id="5986395">&gt;</span>&nbsp;<span class="num" id="5986397">0</span>&nbsp;<span class="op" id="5986399">&amp;&amp;</span>&nbsp;<span class="ident" id="5986402">req</span><span class="op" id="5986405">.</span><span class="ident" id="5986406">TransferEncoding</span><span class="op" id="5986422">[</span><span class="num" id="5986423">0</span><span class="op" id="5986424">]</span>&nbsp;<span class="op" id="5986426">==</span>&nbsp;<span class="string" id="5986429">&#34;chunked&#34;</span>&nbsp;<span class="op" id="5986439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986443">rw</span><span class="op" id="5986445">.</span><span class="ident" id="5986446">WriteHeader</span><span class="op" id="5986457">(</span><span class="ident" id="5986458">http</span><span class="op" id="5986462">.</span><span class="ident" id="5986463">StatusBadRequest</span><span class="op" id="5986479">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986483">rw</span><span class="op" id="5986485">.</span><span class="ident" id="5986486">Write</span><span class="op" id="5986491">(</span><span class="op" id="5986492">[</span><span class="op" id="5986493">]</span><span class="builtintype" id="5986494">byte</span><span class="op" id="5986498">(</span><span class="string" id="5986499">&#34;Chunked&nbsp;request&nbsp;bodies&nbsp;are&nbsp;not&nbsp;supported&nbsp;by&nbsp;CGI.&#34;</span><span class="op" id="5986549">)</span><span class="op" id="5986550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986554">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986566">pathInfo</span>&nbsp;<span class="op" id="5986575">:=</span>&nbsp;<span class="ident" id="5986578">req</span><span class="op" id="5986581">.</span><span class="ident" id="5986582">URL</span><span class="op" id="5986585">.</span><span class="ident" id="5986586">Path</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986592">if</span>&nbsp;<span class="ident" id="5986595">root</span>&nbsp;<span class="op" id="5986600">!=</span>&nbsp;<span class="string" id="5986603">&#34;/&#34;</span>&nbsp;<span class="op" id="5986607">&amp;&amp;</span>&nbsp;<span class="ident" id="5986610">strings</span><span class="op" id="5986617">.</span><span class="ident" id="5986618">HasPrefix</span><span class="op" id="5986627">(</span><span class="ident" id="5986628">pathInfo</span><span class="op" id="5986636">,</span>&nbsp;<span class="ident" id="5986638">root</span><span class="op" id="5986642">)</span>&nbsp;<span class="op" id="5986644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986648">pathInfo</span>&nbsp;<span class="op" id="5986657">=</span>&nbsp;<span class="ident" id="5986659">pathInfo</span><span class="op" id="5986667">[</span><span class="builtinfunc" id="5986668">len</span><span class="op" id="5986671">(</span><span class="ident" id="5986672">root</span><span class="op" id="5986676">)</span><span class="op" id="5986677">:</span><span class="op" id="5986678">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986685">port</span>&nbsp;<span class="op" id="5986690">:=</span>&nbsp;<span class="string" id="5986693">&#34;80&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5986699">if</span>&nbsp;<span class="ident" id="5986702">matches</span>&nbsp;<span class="op" id="5986710">:=</span>&nbsp;<span class="ident" id="5986713">trailingPort</span><span class="op" id="5986725">.</span><span class="ident" id="5986726">FindStringSubmatch</span><span class="op" id="5986744">(</span><span class="ident" id="5986745">req</span><span class="op" id="5986748">.</span><span class="ident" id="5986749">Host</span><span class="op" id="5986753">)</span><span class="op" id="5986754">;</span>&nbsp;<span class="builtinfunc" id="5986756">len</span><span class="op" id="5986759">(</span><span class="ident" id="5986760">matches</span><span class="op" id="5986767">)</span>&nbsp;<span class="op" id="5986769">!=</span>&nbsp;<span class="num" id="5986772">0</span>&nbsp;<span class="op" id="5986774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986778">port</span>&nbsp;<span class="op" id="5986783">=</span>&nbsp;<span class="ident" id="5986785">matches</span><span class="op" id="5986792">[</span><span class="num" id="5986793">1</span><span class="op" id="5986794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5986797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5986801">env</span>&nbsp;<span class="op" id="5986805">:=</span>&nbsp;<span class="op" id="5986808">[</span><span class="op" id="5986809">]</span><span class="builtintype" id="5986810">string</span><span class="op" id="5986816">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986820">&#34;SERVER_SOFTWARE=go&#34;</span><span class="op" id="5986840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986844">&#34;SERVER_NAME=&#34;</span>&nbsp;<span class="op" id="5986859">+</span>&nbsp;<span class="ident" id="5986861">req</span><span class="op" id="5986864">.</span><span class="ident" id="5986865">Host</span><span class="op" id="5986869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986873">&#34;SERVER_PROTOCOL=HTTP/1.1&#34;</span><span class="op" id="5986899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986903">&#34;HTTP_HOST=&#34;</span>&nbsp;<span class="op" id="5986916">+</span>&nbsp;<span class="ident" id="5986918">req</span><span class="op" id="5986921">.</span><span class="ident" id="5986922">Host</span><span class="op" id="5986926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986930">&#34;GATEWAY_INTERFACE=CGI/1.1&#34;</span><span class="op" id="5986957">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986961">&#34;REQUEST_METHOD=&#34;</span>&nbsp;<span class="op" id="5986979">+</span>&nbsp;<span class="ident" id="5986981">req</span><span class="op" id="5986984">.</span><span class="ident" id="5986985">Method</span><span class="op" id="5986991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5986995">&#34;QUERY_STRING=&#34;</span>&nbsp;<span class="op" id="5987011">+</span>&nbsp;<span class="ident" id="5987013">req</span><span class="op" id="5987016">.</span><span class="ident" id="5987017">URL</span><span class="op" id="5987020">.</span><span class="ident" id="5987021">RawQuery</span><span class="op" id="5987029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987033">&#34;REQUEST_URI=&#34;</span>&nbsp;<span class="op" id="5987048">+</span>&nbsp;<span class="ident" id="5987050">req</span><span class="op" id="5987053">.</span><span class="ident" id="5987054">URL</span><span class="op" id="5987057">.</span><span class="ident" id="5987058">RequestURI</span><span class="op" id="5987068">(</span><span class="op" id="5987069">)</span><span class="op" id="5987070">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987074">&#34;PATH_INFO=&#34;</span>&nbsp;<span class="op" id="5987087">+</span>&nbsp;<span class="ident" id="5987089">pathInfo</span><span class="op" id="5987097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987101">&#34;SCRIPT_NAME=&#34;</span>&nbsp;<span class="op" id="5987116">+</span>&nbsp;<span class="ident" id="5987118">root</span><span class="op" id="5987122">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987126">&#34;SCRIPT_FILENAME=&#34;</span>&nbsp;<span class="op" id="5987145">+</span>&nbsp;<span class="ident" id="5987147">h</span><span class="op" id="5987148">.</span><span class="ident" id="5987149">Path</span><span class="op" id="5987153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987157">&#34;REMOTE_ADDR=&#34;</span>&nbsp;<span class="op" id="5987172">+</span>&nbsp;<span class="ident" id="5987174">req</span><span class="op" id="5987177">.</span><span class="ident" id="5987178">RemoteAddr</span><span class="op" id="5987188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987192">&#34;REMOTE_HOST=&#34;</span>&nbsp;<span class="op" id="5987207">+</span>&nbsp;<span class="ident" id="5987209">req</span><span class="op" id="5987212">.</span><span class="ident" id="5987213">RemoteAddr</span><span class="op" id="5987223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987227">&#34;SERVER_PORT=&#34;</span>&nbsp;<span class="op" id="5987242">+</span>&nbsp;<span class="ident" id="5987244">port</span><span class="op" id="5987248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987251">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987255">if</span>&nbsp;<span class="ident" id="5987258">req</span><span class="op" id="5987261">.</span><span class="ident" id="5987262">TLS</span>&nbsp;<span class="op" id="5987266">!=</span>&nbsp;<span class="ident" id="5987269">nil</span>&nbsp;<span class="op" id="5987273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987277">env</span>&nbsp;<span class="op" id="5987281">=</span>&nbsp;<span class="builtinfunc" id="5987283">append</span><span class="op" id="5987289">(</span><span class="ident" id="5987290">env</span><span class="op" id="5987293">,</span>&nbsp;<span class="string" id="5987295">&#34;HTTPS=on&#34;</span><span class="op" id="5987305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987312">for</span>&nbsp;<span class="ident" id="5987316">k</span><span class="op" id="5987317">,</span>&nbsp;<span class="ident" id="5987319">v</span>&nbsp;<span class="op" id="5987321">:=</span>&nbsp;<span class="keyword" id="5987324">range</span>&nbsp;<span class="ident" id="5987330">req</span><span class="op" id="5987333">.</span><span class="ident" id="5987334">Header</span>&nbsp;<span class="op" id="5987341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987345">k</span>&nbsp;<span class="op" id="5987347">=</span>&nbsp;<span class="ident" id="5987349">strings</span><span class="op" id="5987356">.</span><span class="ident" id="5987357">Map</span><span class="op" id="5987360">(</span><span class="ident" id="5987361">upperCaseAndUnderscore</span><span class="op" id="5987383">,</span>&nbsp;<span class="ident" id="5987385">k</span><span class="op" id="5987386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987390">joinStr</span>&nbsp;<span class="op" id="5987398">:=</span>&nbsp;<span class="string" id="5987401">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987408">if</span>&nbsp;<span class="ident" id="5987411">k</span>&nbsp;<span class="op" id="5987413">==</span>&nbsp;<span class="string" id="5987416">&#34;COOKIE&#34;</span>&nbsp;<span class="op" id="5987425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987430">joinStr</span>&nbsp;<span class="op" id="5987438">=</span>&nbsp;<span class="string" id="5987440">&#34;;&nbsp;&#34;</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987451">env</span>&nbsp;<span class="op" id="5987455">=</span>&nbsp;<span class="builtinfunc" id="5987457">append</span><span class="op" id="5987463">(</span><span class="ident" id="5987464">env</span><span class="op" id="5987467">,</span>&nbsp;<span class="string" id="5987469">&#34;HTTP_&#34;</span><span class="op" id="5987476">+</span><span class="ident" id="5987477">k</span><span class="op" id="5987478">+</span><span class="string" id="5987479">&#34;=&#34;</span><span class="op" id="5987482">+</span><span class="ident" id="5987483">strings</span><span class="op" id="5987490">.</span><span class="ident" id="5987491">Join</span><span class="op" id="5987495">(</span><span class="ident" id="5987496">v</span><span class="op" id="5987497">,</span>&nbsp;<span class="ident" id="5987499">joinStr</span><span class="op" id="5987506">)</span><span class="op" id="5987507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987514">if</span>&nbsp;<span class="ident" id="5987517">req</span><span class="op" id="5987520">.</span><span class="ident" id="5987521">ContentLength</span>&nbsp;<span class="op" id="5987535">&gt;</span>&nbsp;<span class="num" id="5987537">0</span>&nbsp;<span class="op" id="5987539">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987543">env</span>&nbsp;<span class="op" id="5987547">=</span>&nbsp;<span class="builtinfunc" id="5987549">append</span><span class="op" id="5987555">(</span><span class="ident" id="5987556">env</span><span class="op" id="5987559">,</span>&nbsp;<span class="ident" id="5987561">fmt</span><span class="op" id="5987564">.</span><span class="ident" id="5987565">Sprintf</span><span class="op" id="5987572">(</span><span class="string" id="5987573">&#34;CONTENT_LENGTH=%d&#34;</span><span class="op" id="5987592">,</span>&nbsp;<span class="ident" id="5987594">req</span><span class="op" id="5987597">.</span><span class="ident" id="5987598">ContentLength</span><span class="op" id="5987611">)</span><span class="op" id="5987612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987618">if</span>&nbsp;<span class="ident" id="5987621">ctype</span>&nbsp;<span class="op" id="5987627">:=</span>&nbsp;<span class="ident" id="5987630">req</span><span class="op" id="5987633">.</span><span class="ident" id="5987634">Header</span><span class="op" id="5987640">.</span><span class="ident" id="5987641">Get</span><span class="op" id="5987644">(</span><span class="string" id="5987645">&#34;Content-Type&#34;</span><span class="op" id="5987659">)</span><span class="op" id="5987660">;</span>&nbsp;<span class="ident" id="5987662">ctype</span>&nbsp;<span class="op" id="5987668">!=</span>&nbsp;<span class="string" id="5987671">&#34;&#34;</span>&nbsp;<span class="op" id="5987674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987678">env</span>&nbsp;<span class="op" id="5987682">=</span>&nbsp;<span class="builtinfunc" id="5987684">append</span><span class="op" id="5987690">(</span><span class="ident" id="5987691">env</span><span class="op" id="5987694">,</span>&nbsp;<span class="string" id="5987696">&#34;CONTENT_TYPE=&#34;</span><span class="op" id="5987711">+</span><span class="ident" id="5987712">ctype</span><span class="op" id="5987717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987720">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987724">if</span>&nbsp;<span class="ident" id="5987727">h</span><span class="op" id="5987728">.</span><span class="ident" id="5987729">Env</span>&nbsp;<span class="op" id="5987733">!=</span>&nbsp;<span class="ident" id="5987736">nil</span>&nbsp;<span class="op" id="5987740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987744">env</span>&nbsp;<span class="op" id="5987748">=</span>&nbsp;<span class="builtinfunc" id="5987750">append</span><span class="op" id="5987756">(</span><span class="ident" id="5987757">env</span><span class="op" id="5987760">,</span>&nbsp;<span class="ident" id="5987762">h</span><span class="op" id="5987763">.</span><span class="ident" id="5987764">Env</span><span class="op" id="5987767">...</span><span class="op" id="5987770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987777">envPath</span>&nbsp;<span class="op" id="5987785">:=</span>&nbsp;<span class="ident" id="5987788">os</span><span class="op" id="5987790">.</span><span class="ident" id="5987791">Getenv</span><span class="op" id="5987797">(</span><span class="string" id="5987798">&#34;PATH&#34;</span><span class="op" id="5987804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987807">if</span>&nbsp;<span class="ident" id="5987810">envPath</span>&nbsp;<span class="op" id="5987818">==</span>&nbsp;<span class="string" id="5987821">&#34;&#34;</span>&nbsp;<span class="op" id="5987824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987828">envPath</span>&nbsp;<span class="op" id="5987836">=</span>&nbsp;<span class="string" id="5987838">&#34;/bin:/usr/bin:/usr/ucb:/usr/bsd:/usr/local/bin&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5987888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987891">env</span>&nbsp;<span class="op" id="5987895">=</span>&nbsp;<span class="builtinfunc" id="5987897">append</span><span class="op" id="5987903">(</span><span class="ident" id="5987904">env</span><span class="op" id="5987907">,</span>&nbsp;<span class="string" id="5987909">&#34;PATH=&#34;</span><span class="op" id="5987916">+</span><span class="ident" id="5987917">envPath</span><span class="op" id="5987924">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987928">for</span>&nbsp;<span class="ident" id="5987932">_</span><span class="op" id="5987933">,</span>&nbsp;<span class="ident" id="5987935">e</span>&nbsp;<span class="op" id="5987937">:=</span>&nbsp;<span class="keyword" id="5987940">range</span>&nbsp;<span class="ident" id="5987946">h</span><span class="op" id="5987947">.</span><span class="ident" id="5987948">InheritEnv</span>&nbsp;<span class="op" id="5987959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5987963">if</span>&nbsp;<span class="ident" id="5987966">v</span>&nbsp;<span class="op" id="5987968">:=</span>&nbsp;<span class="ident" id="5987971">os</span><span class="op" id="5987973">.</span><span class="ident" id="5987974">Getenv</span><span class="op" id="5987980">(</span><span class="ident" id="5987981">e</span><span class="op" id="5987982">)</span><span class="op" id="5987983">;</span>&nbsp;<span class="ident" id="5987985">v</span>&nbsp;<span class="op" id="5987987">!=</span>&nbsp;<span class="string" id="5987990">&#34;&#34;</span>&nbsp;<span class="op" id="5987993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987998">env</span>&nbsp;<span class="op" id="5988002">=</span>&nbsp;<span class="builtinfunc" id="5988004">append</span><span class="op" id="5988010">(</span><span class="ident" id="5988011">env</span><span class="op" id="5988014">,</span>&nbsp;<span class="ident" id="5988016">e</span><span class="op" id="5988017">+</span><span class="string" id="5988018">&#34;=&#34;</span><span class="op" id="5988021">+</span><span class="ident" id="5988022">v</span><span class="op" id="5988023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988027">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988034">for</span>&nbsp;<span class="ident" id="5988038">_</span><span class="op" id="5988039">,</span>&nbsp;<span class="ident" id="5988041">e</span>&nbsp;<span class="op" id="5988043">:=</span>&nbsp;<span class="keyword" id="5988046">range</span>&nbsp;<span class="ident" id="5988052">osDefaultInheritEnv</span><span class="op" id="5988071">[</span><span class="ident" id="5988072">runtime</span><span class="op" id="5988079">.</span><span class="ident" id="5988080">GOOS</span><span class="op" id="5988084">]</span>&nbsp;<span class="op" id="5988086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988090">if</span>&nbsp;<span class="ident" id="5988093">v</span>&nbsp;<span class="op" id="5988095">:=</span>&nbsp;<span class="ident" id="5988098">os</span><span class="op" id="5988100">.</span><span class="ident" id="5988101">Getenv</span><span class="op" id="5988107">(</span><span class="ident" id="5988108">e</span><span class="op" id="5988109">)</span><span class="op" id="5988110">;</span>&nbsp;<span class="ident" id="5988112">v</span>&nbsp;<span class="op" id="5988114">!=</span>&nbsp;<span class="string" id="5988117">&#34;&#34;</span>&nbsp;<span class="op" id="5988120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988125">env</span>&nbsp;<span class="op" id="5988129">=</span>&nbsp;<span class="builtinfunc" id="5988131">append</span><span class="op" id="5988137">(</span><span class="ident" id="5988138">env</span><span class="op" id="5988141">,</span>&nbsp;<span class="ident" id="5988143">e</span><span class="op" id="5988144">+</span><span class="string" id="5988145">&#34;=&#34;</span><span class="op" id="5988148">+</span><span class="ident" id="5988149">v</span><span class="op" id="5988150">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988161">env</span>&nbsp;<span class="op" id="5988165">=</span>&nbsp;<span class="ident" id="5988167">removeLeadingDuplicates</span><span class="op" id="5988190">(</span><span class="ident" id="5988191">env</span><span class="op" id="5988194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988198">var</span>&nbsp;<span class="ident" id="5988202">cwd</span><span class="op" id="5988205">,</span>&nbsp;<span class="ident" id="5988207">path</span>&nbsp;<span class="builtintype" id="5988212">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988220">if</span>&nbsp;<span class="ident" id="5988223">h</span><span class="op" id="5988224">.</span><span class="ident" id="5988225">Dir</span>&nbsp;<span class="op" id="5988229">!=</span>&nbsp;<span class="string" id="5988232">&#34;&#34;</span>&nbsp;<span class="op" id="5988235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988239">path</span>&nbsp;<span class="op" id="5988244">=</span>&nbsp;<span class="ident" id="5988246">h</span><span class="op" id="5988247">.</span><span class="ident" id="5988248">Path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988255">cwd</span>&nbsp;<span class="op" id="5988259">=</span>&nbsp;<span class="ident" id="5988261">h</span><span class="op" id="5988262">.</span><span class="ident" id="5988263">Dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988268">}</span>&nbsp;<span class="keyword" id="5988270">else</span>&nbsp;<span class="op" id="5988275">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988279">cwd</span><span class="op" id="5988282">,</span>&nbsp;<span class="ident" id="5988284">path</span>&nbsp;<span class="op" id="5988289">=</span>&nbsp;<span class="ident" id="5988291">filepath</span><span class="op" id="5988299">.</span><span class="ident" id="5988300">Split</span><span class="op" id="5988305">(</span><span class="ident" id="5988306">h</span><span class="op" id="5988307">.</span><span class="ident" id="5988308">Path</span><span class="op" id="5988312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988318">if</span>&nbsp;<span class="ident" id="5988321">cwd</span>&nbsp;<span class="op" id="5988325">==</span>&nbsp;<span class="string" id="5988328">&#34;&#34;</span>&nbsp;<span class="op" id="5988331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988335">cwd</span>&nbsp;<span class="op" id="5988339">=</span>&nbsp;<span class="string" id="5988341">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988346">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988350">internalError</span>&nbsp;<span class="op" id="5988364">:=</span>&nbsp;<span class="keyword" id="5988367">func</span><span class="op" id="5988371">(</span><span class="ident" id="5988372">err</span>&nbsp;<span class="builtintype" id="5988376">error</span><span class="op" id="5988381">)</span>&nbsp;<span class="op" id="5988383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988387">rw</span><span class="op" id="5988389">.</span><span class="ident" id="5988390">WriteHeader</span><span class="op" id="5988401">(</span><span class="ident" id="5988402">http</span><span class="op" id="5988406">.</span><span class="ident" id="5988407">StatusInternalServerError</span><span class="op" id="5988432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988436">h</span><span class="op" id="5988437">.</span><span class="ident" id="5988438">printf</span><span class="op" id="5988444">(</span><span class="string" id="5988445">&#34;CGI&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5988460">,</span>&nbsp;<span class="ident" id="5988462">err</span><span class="op" id="5988465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988468">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988472">cmd</span>&nbsp;<span class="op" id="5988476">:=</span>&nbsp;<span class="op" id="5988479">&amp;</span><span class="ident" id="5988480">exec</span><span class="op" id="5988484">.</span><span class="ident" id="5988485">Cmd</span><span class="op" id="5988488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988492">Path</span><span class="op" id="5988496">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5988500">path</span><span class="op" id="5988504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988508">Args</span><span class="op" id="5988512">:</span>&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5988516">append</span><span class="op" id="5988522">(</span><span class="op" id="5988523">[</span><span class="op" id="5988524">]</span><span class="builtintype" id="5988525">string</span><span class="op" id="5988531">{</span><span class="ident" id="5988532">h</span><span class="op" id="5988533">.</span><span class="ident" id="5988534">Path</span><span class="op" id="5988538">}</span><span class="op" id="5988539">,</span>&nbsp;<span class="ident" id="5988541">h</span><span class="op" id="5988542">.</span><span class="ident" id="5988543">Args</span><span class="op" id="5988547">...</span><span class="op" id="5988550">)</span><span class="op" id="5988551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988555">Dir</span><span class="op" id="5988558">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988563">cwd</span><span class="op" id="5988566">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988570">Env</span><span class="op" id="5988573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988578">env</span><span class="op" id="5988581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988585">Stderr</span><span class="op" id="5988591">:</span>&nbsp;<span class="ident" id="5988593">os</span><span class="op" id="5988595">.</span><span class="ident" id="5988596">Stderr</span><span class="op" id="5988602">,</span>&nbsp;<span class="comment" id="5988604">//&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988619">if</span>&nbsp;<span class="ident" id="5988622">req</span><span class="op" id="5988625">.</span><span class="ident" id="5988626">ContentLength</span>&nbsp;<span class="op" id="5988640">!=</span>&nbsp;<span class="num" id="5988643">0</span>&nbsp;<span class="op" id="5988645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988649">cmd</span><span class="op" id="5988652">.</span><span class="ident" id="5988653">Stdin</span>&nbsp;<span class="op" id="5988659">=</span>&nbsp;<span class="ident" id="5988661">req</span><span class="op" id="5988664">.</span><span class="ident" id="5988665">Body</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988674">stdoutRead</span><span class="op" id="5988684">,</span>&nbsp;<span class="ident" id="5988686">err</span>&nbsp;<span class="op" id="5988690">:=</span>&nbsp;<span class="ident" id="5988693">cmd</span><span class="op" id="5988696">.</span><span class="ident" id="5988697">StdoutPipe</span><span class="op" id="5988707">(</span><span class="op" id="5988708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988711">if</span>&nbsp;<span class="ident" id="5988714">err</span>&nbsp;<span class="op" id="5988718">!=</span>&nbsp;<span class="ident" id="5988721">nil</span>&nbsp;<span class="op" id="5988725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988729">internalError</span><span class="op" id="5988742">(</span><span class="ident" id="5988743">err</span><span class="op" id="5988746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988750">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988762">err</span>&nbsp;<span class="op" id="5988766">=</span>&nbsp;<span class="ident" id="5988768">cmd</span><span class="op" id="5988771">.</span><span class="ident" id="5988772">Start</span><span class="op" id="5988777">(</span><span class="op" id="5988778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988781">if</span>&nbsp;<span class="ident" id="5988784">err</span>&nbsp;<span class="op" id="5988788">!=</span>&nbsp;<span class="ident" id="5988791">nil</span>&nbsp;<span class="op" id="5988795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988799">internalError</span><span class="op" id="5988812">(</span><span class="ident" id="5988813">err</span><span class="op" id="5988816">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988820">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988831">if</span>&nbsp;<span class="ident" id="5988834">hook</span>&nbsp;<span class="op" id="5988839">:=</span>&nbsp;<span class="ident" id="5988842">testHookStartProcess</span><span class="op" id="5988862">;</span>&nbsp;<span class="ident" id="5988864">hook</span>&nbsp;<span class="op" id="5988869">!=</span>&nbsp;<span class="ident" id="5988872">nil</span>&nbsp;<span class="op" id="5988876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988880">hook</span><span class="op" id="5988884">(</span><span class="ident" id="5988885">cmd</span><span class="op" id="5988888">.</span><span class="ident" id="5988889">Process</span><span class="op" id="5988896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988899">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988902">defer</span>&nbsp;<span class="ident" id="5988908">cmd</span><span class="op" id="5988911">.</span><span class="ident" id="5988912">Wait</span><span class="op" id="5988916">(</span><span class="op" id="5988917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988920">defer</span>&nbsp;<span class="ident" id="5988926">stdoutRead</span><span class="op" id="5988936">.</span><span class="ident" id="5988937">Close</span><span class="op" id="5988942">(</span><span class="op" id="5988943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988947">linebody</span>&nbsp;<span class="op" id="5988956">:=</span>&nbsp;<span class="ident" id="5988959">bufio</span><span class="op" id="5988964">.</span><span class="ident" id="5988965">NewReaderSize</span><span class="op" id="5988978">(</span><span class="ident" id="5988979">stdoutRead</span><span class="op" id="5988989">,</span>&nbsp;<span class="num" id="5988991">1024</span><span class="op" id="5988995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988998">headers</span>&nbsp;<span class="op" id="5989006">:=</span>&nbsp;<span class="builtinfunc" id="5989009">make</span><span class="op" id="5989013">(</span><span class="ident" id="5989014">http</span><span class="op" id="5989018">.</span><span class="ident" id="5989019">Header</span><span class="op" id="5989025">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989028">statusCode</span>&nbsp;<span class="op" id="5989039">:=</span>&nbsp;<span class="num" id="5989042">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989045">headerLines</span>&nbsp;<span class="op" id="5989057">:=</span>&nbsp;<span class="num" id="5989060">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989063">sawBlankLine</span>&nbsp;<span class="op" id="5989076">:=</span>&nbsp;<span class="builtintype" id="5989079">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989086">for</span>&nbsp;<span class="op" id="5989090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989094">line</span><span class="op" id="5989098">,</span>&nbsp;<span class="ident" id="5989100">isPrefix</span><span class="op" id="5989108">,</span>&nbsp;<span class="ident" id="5989110">err</span>&nbsp;<span class="op" id="5989114">:=</span>&nbsp;<span class="ident" id="5989117">linebody</span><span class="op" id="5989125">.</span><span class="ident" id="5989126">ReadLine</span><span class="op" id="5989134">(</span><span class="op" id="5989135">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989139">if</span>&nbsp;<span class="ident" id="5989142">isPrefix</span>&nbsp;<span class="op" id="5989151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989156">rw</span><span class="op" id="5989158">.</span><span class="ident" id="5989159">WriteHeader</span><span class="op" id="5989170">(</span><span class="ident" id="5989171">http</span><span class="op" id="5989175">.</span><span class="ident" id="5989176">StatusInternalServerError</span><span class="op" id="5989201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989206">h</span><span class="op" id="5989207">.</span><span class="ident" id="5989208">printf</span><span class="op" id="5989214">(</span><span class="string" id="5989215">&#34;cgi:&nbsp;long&nbsp;header&nbsp;line&nbsp;from&nbsp;subprocess.&#34;</span><span class="op" id="5989255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989260">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989269">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989273">if</span>&nbsp;<span class="ident" id="5989276">err</span>&nbsp;<span class="op" id="5989280">==</span>&nbsp;<span class="ident" id="5989283">io</span><span class="op" id="5989285">.</span><span class="ident" id="5989286">EOF</span>&nbsp;<span class="op" id="5989290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989295">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989307">if</span>&nbsp;<span class="ident" id="5989310">err</span>&nbsp;<span class="op" id="5989314">!=</span>&nbsp;<span class="ident" id="5989317">nil</span>&nbsp;<span class="op" id="5989321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989326">rw</span><span class="op" id="5989328">.</span><span class="ident" id="5989329">WriteHeader</span><span class="op" id="5989340">(</span><span class="ident" id="5989341">http</span><span class="op" id="5989345">.</span><span class="ident" id="5989346">StatusInternalServerError</span><span class="op" id="5989371">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989376">h</span><span class="op" id="5989377">.</span><span class="ident" id="5989378">printf</span><span class="op" id="5989384">(</span><span class="string" id="5989385">&#34;cgi:&nbsp;error&nbsp;reading&nbsp;headers:&nbsp;%v&#34;</span><span class="op" id="5989417">,</span>&nbsp;<span class="ident" id="5989419">err</span><span class="op" id="5989422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989427">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989440">if</span>&nbsp;<span class="builtinfunc" id="5989443">len</span><span class="op" id="5989446">(</span><span class="ident" id="5989447">line</span><span class="op" id="5989451">)</span>&nbsp;<span class="op" id="5989453">==</span>&nbsp;<span class="num" id="5989456">0</span>&nbsp;<span class="op" id="5989458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989463">sawBlankLine</span>&nbsp;<span class="op" id="5989476">=</span>&nbsp;<span class="builtintype" id="5989478">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989498">headerLines</span><span class="op" id="5989509">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989514">parts</span>&nbsp;<span class="op" id="5989520">:=</span>&nbsp;<span class="ident" id="5989523">strings</span><span class="op" id="5989530">.</span><span class="ident" id="5989531">SplitN</span><span class="op" id="5989537">(</span><span class="builtintype" id="5989538">string</span><span class="op" id="5989544">(</span><span class="ident" id="5989545">line</span><span class="op" id="5989549">)</span><span class="op" id="5989550">,</span>&nbsp;<span class="string" id="5989552">&#34;:&#34;</span><span class="op" id="5989555">,</span>&nbsp;<span class="num" id="5989557">2</span><span class="op" id="5989558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989562">if</span>&nbsp;<span class="builtinfunc" id="5989565">len</span><span class="op" id="5989568">(</span><span class="ident" id="5989569">parts</span><span class="op" id="5989574">)</span>&nbsp;<span class="op" id="5989576">&lt;</span>&nbsp;<span class="num" id="5989578">2</span>&nbsp;<span class="op" id="5989580">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989585">h</span><span class="op" id="5989586">.</span><span class="ident" id="5989587">printf</span><span class="op" id="5989593">(</span><span class="string" id="5989594">&#34;cgi:&nbsp;bogus&nbsp;header&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="5989622">,</span>&nbsp;<span class="builtintype" id="5989624">string</span><span class="op" id="5989630">(</span><span class="ident" id="5989631">line</span><span class="op" id="5989635">)</span><span class="op" id="5989636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989641">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989656">header</span><span class="op" id="5989662">,</span>&nbsp;<span class="ident" id="5989664">val</span>&nbsp;<span class="op" id="5989668">:=</span>&nbsp;<span class="ident" id="5989671">parts</span><span class="op" id="5989676">[</span><span class="num" id="5989677">0</span><span class="op" id="5989678">]</span><span class="op" id="5989679">,</span>&nbsp;<span class="ident" id="5989681">parts</span><span class="op" id="5989686">[</span><span class="num" id="5989687">1</span><span class="op" id="5989688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989692">header</span>&nbsp;<span class="op" id="5989699">=</span>&nbsp;<span class="ident" id="5989701">strings</span><span class="op" id="5989708">.</span><span class="ident" id="5989709">TrimSpace</span><span class="op" id="5989718">(</span><span class="ident" id="5989719">header</span><span class="op" id="5989725">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989729">val</span>&nbsp;<span class="op" id="5989733">=</span>&nbsp;<span class="ident" id="5989735">strings</span><span class="op" id="5989742">.</span><span class="ident" id="5989743">TrimSpace</span><span class="op" id="5989752">(</span><span class="ident" id="5989753">val</span><span class="op" id="5989756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989760">switch</span>&nbsp;<span class="op" id="5989767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989771">case</span>&nbsp;<span class="ident" id="5989776">header</span>&nbsp;<span class="op" id="5989783">==</span>&nbsp;<span class="string" id="5989786">&#34;Status&#34;</span><span class="op" id="5989794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989799">if</span>&nbsp;<span class="builtinfunc" id="5989802">len</span><span class="op" id="5989805">(</span><span class="ident" id="5989806">val</span><span class="op" id="5989809">)</span>&nbsp;<span class="op" id="5989811">&lt;</span>&nbsp;<span class="num" id="5989813">3</span>&nbsp;<span class="op" id="5989815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989821">h</span><span class="op" id="5989822">.</span><span class="ident" id="5989823">printf</span><span class="op" id="5989829">(</span><span class="string" id="5989830">&#34;cgi:&nbsp;bogus&nbsp;status&nbsp;(short):&nbsp;%q&#34;</span><span class="op" id="5989861">,</span>&nbsp;<span class="ident" id="5989863">val</span><span class="op" id="5989866">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989872">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989887">code</span><span class="op" id="5989891">,</span>&nbsp;<span class="ident" id="5989893">err</span>&nbsp;<span class="op" id="5989897">:=</span>&nbsp;<span class="ident" id="5989900">strconv</span><span class="op" id="5989907">.</span><span class="ident" id="5989908">Atoi</span><span class="op" id="5989912">(</span><span class="ident" id="5989913">val</span><span class="op" id="5989916">[</span><span class="num" id="5989917">0</span><span class="op" id="5989918">:</span><span class="num" id="5989919">3</span><span class="op" id="5989920">]</span><span class="op" id="5989921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989926">if</span>&nbsp;<span class="ident" id="5989929">err</span>&nbsp;<span class="op" id="5989933">!=</span>&nbsp;<span class="ident" id="5989936">nil</span>&nbsp;<span class="op" id="5989940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989946">h</span><span class="op" id="5989947">.</span><span class="ident" id="5989948">printf</span><span class="op" id="5989954">(</span><span class="string" id="5989955">&#34;cgi:&nbsp;bogus&nbsp;status:&nbsp;%q&#34;</span><span class="op" id="5989978">,</span>&nbsp;<span class="ident" id="5989980">val</span><span class="op" id="5989983">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989989">h</span><span class="op" id="5989990">.</span><span class="ident" id="5989991">printf</span><span class="op" id="5989997">(</span><span class="string" id="5989998">&#34;cgi:&nbsp;line&nbsp;was&nbsp;%q&#34;</span><span class="op" id="5990016">,</span>&nbsp;<span class="ident" id="5990018">line</span><span class="op" id="5990022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990043">statusCode</span>&nbsp;<span class="op" id="5990054">=</span>&nbsp;<span class="ident" id="5990056">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990063">default</span><span class="op" id="5990070">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990075">headers</span><span class="op" id="5990082">.</span><span class="ident" id="5990083">Add</span><span class="op" id="5990086">(</span><span class="ident" id="5990087">header</span><span class="op" id="5990093">,</span>&nbsp;<span class="ident" id="5990095">val</span><span class="op" id="5990098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990108">if</span>&nbsp;<span class="ident" id="5990111">headerLines</span>&nbsp;<span class="op" id="5990123">==</span>&nbsp;<span class="num" id="5990126">0</span>&nbsp;<span class="op" id="5990128">||</span>&nbsp;<span class="op" id="5990131">!</span><span class="ident" id="5990132">sawBlankLine</span>&nbsp;<span class="op" id="5990145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990149">rw</span><span class="op" id="5990151">.</span><span class="ident" id="5990152">WriteHeader</span><span class="op" id="5990163">(</span><span class="ident" id="5990164">http</span><span class="op" id="5990168">.</span><span class="ident" id="5990169">StatusInternalServerError</span><span class="op" id="5990194">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990198">h</span><span class="op" id="5990199">.</span><span class="ident" id="5990200">printf</span><span class="op" id="5990206">(</span><span class="string" id="5990207">&#34;cgi:&nbsp;no&nbsp;headers&#34;</span><span class="op" id="5990224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990228">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990240">if</span>&nbsp;<span class="ident" id="5990243">loc</span>&nbsp;<span class="op" id="5990247">:=</span>&nbsp;<span class="ident" id="5990250">headers</span><span class="op" id="5990257">.</span><span class="ident" id="5990258">Get</span><span class="op" id="5990261">(</span><span class="string" id="5990262">&#34;Location&#34;</span><span class="op" id="5990272">)</span><span class="op" id="5990273">;</span>&nbsp;<span class="ident" id="5990275">loc</span>&nbsp;<span class="op" id="5990279">!=</span>&nbsp;<span class="string" id="5990282">&#34;&#34;</span>&nbsp;<span class="op" id="5990285">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990289">if</span>&nbsp;<span class="ident" id="5990292">strings</span><span class="op" id="5990299">.</span><span class="ident" id="5990300">HasPrefix</span><span class="op" id="5990309">(</span><span class="ident" id="5990310">loc</span><span class="op" id="5990313">,</span>&nbsp;<span class="string" id="5990315">&#34;/&#34;</span><span class="op" id="5990318">)</span>&nbsp;<span class="op" id="5990320">&amp;&amp;</span>&nbsp;<span class="ident" id="5990323">h</span><span class="op" id="5990324">.</span><span class="ident" id="5990325">PathLocationHandler</span>&nbsp;<span class="op" id="5990345">!=</span>&nbsp;<span class="ident" id="5990348">nil</span>&nbsp;<span class="op" id="5990352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990357">h</span><span class="op" id="5990358">.</span><span class="ident" id="5990359">handleInternalRedirect</span><span class="op" id="5990381">(</span><span class="ident" id="5990382">rw</span><span class="op" id="5990384">,</span>&nbsp;<span class="ident" id="5990386">req</span><span class="op" id="5990389">,</span>&nbsp;<span class="ident" id="5990391">loc</span><span class="op" id="5990394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990412">if</span>&nbsp;<span class="ident" id="5990415">statusCode</span>&nbsp;<span class="op" id="5990426">==</span>&nbsp;<span class="num" id="5990429">0</span>&nbsp;<span class="op" id="5990431">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990436">statusCode</span>&nbsp;<span class="op" id="5990447">=</span>&nbsp;<span class="ident" id="5990449">http</span><span class="op" id="5990453">.</span><span class="ident" id="5990454">StatusFound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990475">if</span>&nbsp;<span class="ident" id="5990478">statusCode</span>&nbsp;<span class="op" id="5990489">==</span>&nbsp;<span class="num" id="5990492">0</span>&nbsp;<span class="op" id="5990494">&amp;&amp;</span>&nbsp;<span class="ident" id="5990497">headers</span><span class="op" id="5990504">.</span><span class="ident" id="5990505">Get</span><span class="op" id="5990508">(</span><span class="string" id="5990509">&#34;Content-Type&#34;</span><span class="op" id="5990523">)</span>&nbsp;<span class="op" id="5990525">==</span>&nbsp;<span class="string" id="5990528">&#34;&#34;</span>&nbsp;<span class="op" id="5990531">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990535">rw</span><span class="op" id="5990537">.</span><span class="ident" id="5990538">WriteHeader</span><span class="op" id="5990549">(</span><span class="ident" id="5990550">http</span><span class="op" id="5990554">.</span><span class="ident" id="5990555">StatusInternalServerError</span><span class="op" id="5990580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990584">h</span><span class="op" id="5990585">.</span><span class="ident" id="5990586">printf</span><span class="op" id="5990592">(</span><span class="string" id="5990593">&#34;cgi:&nbsp;missing&nbsp;required&nbsp;Content-Type&nbsp;in&nbsp;headers&#34;</span><span class="op" id="5990640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990644">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990656">if</span>&nbsp;<span class="ident" id="5990659">statusCode</span>&nbsp;<span class="op" id="5990670">==</span>&nbsp;<span class="num" id="5990673">0</span>&nbsp;<span class="op" id="5990675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990679">statusCode</span>&nbsp;<span class="op" id="5990690">=</span>&nbsp;<span class="ident" id="5990692">http</span><span class="op" id="5990696">.</span><span class="ident" id="5990697">StatusOK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990711">//&nbsp;Copy&nbsp;headers&nbsp;to&nbsp;rw&#39;s&nbsp;headers,&nbsp;after&nbsp;we&#39;ve&nbsp;decided&nbsp;not&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990772">//&nbsp;go&nbsp;into&nbsp;handleInternalRedirect,&nbsp;which&nbsp;won&#39;t&nbsp;want&nbsp;its&nbsp;rw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5990832">//&nbsp;headers&nbsp;to&nbsp;have&nbsp;been&nbsp;touched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990866">for</span>&nbsp;<span class="ident" id="5990870">k</span><span class="op" id="5990871">,</span>&nbsp;<span class="ident" id="5990873">vv</span>&nbsp;<span class="op" id="5990876">:=</span>&nbsp;<span class="keyword" id="5990879">range</span>&nbsp;<span class="ident" id="5990885">headers</span>&nbsp;<span class="op" id="5990893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990897">for</span>&nbsp;<span class="ident" id="5990901">_</span><span class="op" id="5990902">,</span>&nbsp;<span class="ident" id="5990904">v</span>&nbsp;<span class="op" id="5990906">:=</span>&nbsp;<span class="keyword" id="5990909">range</span>&nbsp;<span class="ident" id="5990915">vv</span>&nbsp;<span class="op" id="5990918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990923">rw</span><span class="op" id="5990925">.</span><span class="ident" id="5990926">Header</span><span class="op" id="5990932">(</span><span class="op" id="5990933">)</span><span class="op" id="5990934">.</span><span class="ident" id="5990935">Add</span><span class="op" id="5990938">(</span><span class="ident" id="5990939">k</span><span class="op" id="5990940">,</span>&nbsp;<span class="ident" id="5990942">v</span><span class="op" id="5990943">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990954">rw</span><span class="op" id="5990956">.</span><span class="ident" id="5990957">WriteHeader</span><span class="op" id="5990968">(</span><span class="ident" id="5990969">statusCode</span><span class="op" id="5990979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990983">_</span><span class="op" id="5990984">,</span>&nbsp;<span class="ident" id="5990986">err</span>&nbsp;<span class="op" id="5990990">=</span>&nbsp;<span class="ident" id="5990992">io</span><span class="op" id="5990994">.</span><span class="ident" id="5990995">Copy</span><span class="op" id="5990999">(</span><span class="ident" id="5991000">rw</span><span class="op" id="5991002">,</span>&nbsp;<span class="ident" id="5991004">linebody</span><span class="op" id="5991012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991015">if</span>&nbsp;<span class="ident" id="5991018">err</span>&nbsp;<span class="op" id="5991022">!=</span>&nbsp;<span class="ident" id="5991025">nil</span>&nbsp;<span class="op" id="5991029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991033">h</span><span class="op" id="5991034">.</span><span class="ident" id="5991035">printf</span><span class="op" id="5991041">(</span><span class="string" id="5991042">&#34;cgi:&nbsp;copy&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="5991063">,</span>&nbsp;<span class="ident" id="5991065">err</span><span class="op" id="5991068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991072">//&nbsp;And&nbsp;kill&nbsp;the&nbsp;child&nbsp;CGI&nbsp;process&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;hang&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991128">//&nbsp;the&nbsp;deferred&nbsp;cmd.Wait&nbsp;above&nbsp;if&nbsp;the&nbsp;error&nbsp;was&nbsp;just</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991183">//&nbsp;the&nbsp;client&nbsp;(rw)&nbsp;going&nbsp;away.&nbsp;If&nbsp;it&nbsp;was&nbsp;a&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991239">//&nbsp;(because&nbsp;the&nbsp;child&nbsp;died&nbsp;itself),&nbsp;then&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991292">//&nbsp;kill&nbsp;of&nbsp;an&nbsp;already-dead&nbsp;process&nbsp;is&nbsp;harmless&nbsp;(the&nbsp;PID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991350">//&nbsp;won&#39;t&nbsp;be&nbsp;reused&nbsp;until&nbsp;the&nbsp;Wait&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991394">cmd</span><span class="op" id="5991397">.</span><span class="ident" id="5991398">Process</span><span class="op" id="5991405">.</span><span class="ident" id="5991406">Kill</span><span class="op" id="5991410">(</span><span class="op" id="5991411">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991414">}</span><br>
<span class="lineno"></span><span class="op" id="5991416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991419">func</span>&nbsp;<span class="op" id="5991424">(</span><span class="ident" id="5991425">h</span>&nbsp;<span class="op" id="5991427">*</span><span class="ident" id="5991428">Handler</span><span class="op" id="5991435">)</span>&nbsp;<span class="ident" id="5991437">printf</span><span class="op" id="5991443">(</span><span class="ident" id="5991444">format</span>&nbsp;<span class="builtintype" id="5991451">string</span><span class="op" id="5991457">,</span>&nbsp;<span class="ident" id="5991459">v</span>&nbsp;<span class="op" id="5991461">...</span><span class="keyword" id="5991464">interface</span><span class="op" id="5991473">{</span><span class="op" id="5991474">}</span><span class="op" id="5991475">)</span>&nbsp;<span class="op" id="5991477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991480">if</span>&nbsp;<span class="ident" id="5991483">h</span><span class="op" id="5991484">.</span><span class="ident" id="5991485">Logger</span>&nbsp;<span class="op" id="5991492">!=</span>&nbsp;<span class="ident" id="5991495">nil</span>&nbsp;<span class="op" id="5991499">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991503">h</span><span class="op" id="5991504">.</span><span class="ident" id="5991505">Logger</span><span class="op" id="5991511">.</span><span class="ident" id="5991512">Printf</span><span class="op" id="5991518">(</span><span class="ident" id="5991519">format</span><span class="op" id="5991525">,</span>&nbsp;<span class="ident" id="5991527">v</span><span class="op" id="5991528">...</span><span class="op" id="5991531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991534">}</span>&nbsp;<span class="keyword" id="5991536">else</span>&nbsp;<span class="op" id="5991541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991545">log</span><span class="op" id="5991548">.</span><span class="ident" id="5991549">Printf</span><span class="op" id="5991555">(</span><span class="ident" id="5991556">format</span><span class="op" id="5991562">,</span>&nbsp;<span class="ident" id="5991564">v</span><span class="op" id="5991565">...</span><span class="op" id="5991568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991571">}</span><br>
<span class="lineno"></span><span class="op" id="5991573">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="5991576">func</span>&nbsp;<span class="op" id="5991581">(</span><span class="ident" id="5991582">h</span>&nbsp;<span class="op" id="5991584">*</span><span class="ident" id="5991585">Handler</span><span class="op" id="5991592">)</span>&nbsp;<span class="ident" id="5991594">handleInternalRedirect</span><span class="op" id="5991616">(</span><span class="ident" id="5991617">rw</span>&nbsp;<span class="ident" id="5991620">http</span><span class="op" id="5991624">.</span><span class="ident" id="5991625">ResponseWriter</span><span class="op" id="5991639">,</span>&nbsp;<span class="ident" id="5991641">req</span>&nbsp;<span class="op" id="5991645">*</span><span class="ident" id="5991646">http</span><span class="op" id="5991650">.</span><span class="ident" id="5991651">Request</span><span class="op" id="5991658">,</span>&nbsp;<span class="ident" id="5991660">path</span>&nbsp;<span class="builtintype" id="5991665">string</span><span class="op" id="5991671">)</span>&nbsp;<span class="op" id="5991673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991676">url</span><span class="op" id="5991679">,</span>&nbsp;<span class="ident" id="5991681">err</span>&nbsp;<span class="op" id="5991685">:=</span>&nbsp;<span class="ident" id="5991688">req</span><span class="op" id="5991691">.</span><span class="ident" id="5991692">URL</span><span class="op" id="5991695">.</span><span class="ident" id="5991696">Parse</span><span class="op" id="5991701">(</span><span class="ident" id="5991702">path</span><span class="op" id="5991706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991709">if</span>&nbsp;<span class="ident" id="5991712">err</span>&nbsp;<span class="op" id="5991716">!=</span>&nbsp;<span class="ident" id="5991719">nil</span>&nbsp;<span class="op" id="5991723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991727">rw</span><span class="op" id="5991729">.</span><span class="ident" id="5991730">WriteHeader</span><span class="op" id="5991741">(</span><span class="ident" id="5991742">http</span><span class="op" id="5991746">.</span><span class="ident" id="5991747">StatusInternalServerError</span><span class="op" id="5991772">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991776">h</span><span class="op" id="5991777">.</span><span class="ident" id="5991778">printf</span><span class="op" id="5991784">(</span><span class="string" id="5991785">&#34;cgi:&nbsp;error&nbsp;resolving&nbsp;local&nbsp;URI&nbsp;path&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="5991829">,</span>&nbsp;<span class="ident" id="5991831">path</span><span class="op" id="5991835">,</span>&nbsp;<span class="ident" id="5991837">err</span><span class="op" id="5991840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991855">//&nbsp;TODO:&nbsp;RFC&nbsp;3875&nbsp;isn&#39;t&nbsp;clear&nbsp;if&nbsp;only&nbsp;GET&nbsp;is&nbsp;supported,&nbsp;but&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991919">//&nbsp;suggests&nbsp;so:&nbsp;&#34;Note&nbsp;that&nbsp;any&nbsp;message-body&nbsp;attached&nbsp;to&nbsp;the</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5991980">//&nbsp;request&nbsp;(such&nbsp;as&nbsp;for&nbsp;a&nbsp;POST&nbsp;request)&nbsp;may&nbsp;not&nbsp;be&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992042">//&nbsp;to&nbsp;the&nbsp;resource&nbsp;that&nbsp;is&nbsp;the&nbsp;target&nbsp;of&nbsp;the&nbsp;redirect.&#34;&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992103">//&nbsp;should&nbsp;do&nbsp;some&nbsp;tests&nbsp;against&nbsp;Apache&nbsp;to&nbsp;see&nbsp;how&nbsp;it&nbsp;handles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992165">//&nbsp;POST,&nbsp;HEAD,&nbsp;etc.&nbsp;Does&nbsp;the&nbsp;internal&nbsp;redirect&nbsp;get&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992226">//&nbsp;method&nbsp;or&nbsp;just&nbsp;GET?&nbsp;What&nbsp;about&nbsp;incoming&nbsp;headers?</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992279">//&nbsp;(e.g.&nbsp;Cookies)&nbsp;Which&nbsp;headers,&nbsp;if&nbsp;any,&nbsp;are&nbsp;copied&nbsp;into&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992341">//&nbsp;second&nbsp;request?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992361">newReq</span>&nbsp;<span class="op" id="5992368">:=</span>&nbsp;<span class="op" id="5992371">&amp;</span><span class="ident" id="5992372">http</span><span class="op" id="5992376">.</span><span class="ident" id="5992377">Request</span><span class="op" id="5992384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992388">Method</span><span class="op" id="5992394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5992400">&#34;GET&#34;</span><span class="op" id="5992405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992409">URL</span><span class="op" id="5992412">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992421">url</span><span class="op" id="5992424">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992428">Proto</span><span class="op" id="5992433">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5992440">&#34;HTTP/1.1&#34;</span><span class="op" id="5992450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992454">ProtoMajor</span><span class="op" id="5992464">:</span>&nbsp;<span class="num" id="5992466">1</span><span class="op" id="5992467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992471">ProtoMinor</span><span class="op" id="5992481">:</span>&nbsp;<span class="num" id="5992483">1</span><span class="op" id="5992484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992488">Header</span><span class="op" id="5992494">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5992500">make</span><span class="op" id="5992504">(</span><span class="ident" id="5992505">http</span><span class="op" id="5992509">.</span><span class="ident" id="5992510">Header</span><span class="op" id="5992516">)</span><span class="op" id="5992517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992521">Host</span><span class="op" id="5992525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992533">url</span><span class="op" id="5992536">.</span><span class="ident" id="5992537">Host</span><span class="op" id="5992541">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992545">RemoteAddr</span><span class="op" id="5992555">:</span>&nbsp;<span class="ident" id="5992557">req</span><span class="op" id="5992560">.</span><span class="ident" id="5992561">RemoteAddr</span><span class="op" id="5992571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992575">TLS</span><span class="op" id="5992578">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5992587">req</span><span class="op" id="5992590">.</span><span class="ident" id="5992591">TLS</span><span class="op" id="5992594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992600">h</span><span class="op" id="5992601">.</span><span class="ident" id="5992602">PathLocationHandler</span><span class="op" id="5992621">.</span><span class="ident" id="5992622">ServeHTTP</span><span class="op" id="5992631">(</span><span class="ident" id="5992632">rw</span><span class="op" id="5992634">,</span>&nbsp;<span class="ident" id="5992636">newReq</span><span class="op" id="5992642">)</span><br>
<span class="lineno"></span><span class="op" id="5992644">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="5992647">func</span>&nbsp;<span class="ident" id="5992652">upperCaseAndUnderscore</span><span class="op" id="5992674">(</span><span class="ident" id="5992675">r</span>&nbsp;<span class="builtintype" id="5992677">rune</span><span class="op" id="5992681">)</span>&nbsp;<span class="builtintype" id="5992683">rune</span>&nbsp;<span class="op" id="5992688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992691">switch</span>&nbsp;<span class="op" id="5992698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992701">case</span>&nbsp;<span class="ident" id="5992706">r</span>&nbsp;<span class="op" id="5992708">&gt;=</span>&nbsp;<span class="string" id="5992711">&#39;a&#39;</span>&nbsp;<span class="op" id="5992715">&amp;&amp;</span>&nbsp;<span class="ident" id="5992718">r</span>&nbsp;<span class="op" id="5992720">&lt;=</span>&nbsp;<span class="string" id="5992723">&#39;z&#39;</span><span class="op" id="5992726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992730">return</span>&nbsp;<span class="ident" id="5992737">r</span>&nbsp;<span class="op" id="5992739">-</span>&nbsp;<span class="op" id="5992741">(</span><span class="string" id="5992742">&#39;a&#39;</span>&nbsp;<span class="op" id="5992746">-</span>&nbsp;<span class="string" id="5992748">&#39;A&#39;</span><span class="op" id="5992751">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992754">case</span>&nbsp;<span class="ident" id="5992759">r</span>&nbsp;<span class="op" id="5992761">==</span>&nbsp;<span class="string" id="5992764">&#39;-&#39;</span><span class="op" id="5992767">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992771">return</span>&nbsp;<span class="string" id="5992778">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992783">case</span>&nbsp;<span class="ident" id="5992788">r</span>&nbsp;<span class="op" id="5992790">==</span>&nbsp;<span class="string" id="5992793">&#39;=&#39;</span><span class="op" id="5992796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992800">//&nbsp;Maybe&nbsp;not&nbsp;part&nbsp;of&nbsp;the&nbsp;CGI&nbsp;&#39;spec&#39;&nbsp;but&nbsp;would&nbsp;mess&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992856">//&nbsp;the&nbsp;environment&nbsp;in&nbsp;any&nbsp;case,&nbsp;as&nbsp;Go&nbsp;represents&nbsp;the</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992911">//&nbsp;environment&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;&#34;key=value&#34;&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992963">return</span>&nbsp;<span class="string" id="5992970">&#39;_&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5992978">//&nbsp;TODO:&nbsp;other&nbsp;transformations&nbsp;in&nbsp;spec&nbsp;or&nbsp;practice?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5993031">return</span>&nbsp;<span class="ident" id="5993038">r</span><br>
<span class="lineno">375</span><span class="op" id="5993040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5993043">var</span>&nbsp;<span class="ident" id="5993047">testHookStartProcess</span>&nbsp;<span class="keyword" id="5993068">func</span><span class="op" id="5993072">(</span><span class="op" id="5993073">*</span><span class="ident" id="5993074">os</span><span class="op" id="5993076">.</span><span class="ident" id="5993077">Process</span><span class="op" id="5993084">)</span>&nbsp;<span class="comment" id="5993086">//&nbsp;nil&nbsp;except&nbsp;for&nbsp;some&nbsp;tests</span>
</div>
</body>
</html>
