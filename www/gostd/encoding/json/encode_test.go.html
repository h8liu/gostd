<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8618312">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8618367">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8618421">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8618472">package</span>&nbsp;<span class="ident" id="8618480">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8618486">import</span>&nbsp;<span class="op" id="8618493">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8618496">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8618505">&#34;math&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8618513">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8618524">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8618535">&#34;unicode&#34;</span><br>
<span class="lineno"></span><span class="op" id="8618545">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8618548">type</span>&nbsp;<span class="ident" id="8618553">Optionals</span>&nbsp;<span class="keyword" id="8618563">struct</span>&nbsp;<span class="op" id="8618570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618573">Sr</span>&nbsp;<span class="builtintype" id="8618576">string</span>&nbsp;<span class="string" id="8618583">`json:&#34;sr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618596">So</span>&nbsp;<span class="builtintype" id="8618599">string</span>&nbsp;<span class="string" id="8618606">`json:&#34;so,omitempty&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618629">Sw</span>&nbsp;<span class="builtintype" id="8618632">string</span>&nbsp;<span class="string" id="8618639">`json:&#34;-&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618652">Ir</span>&nbsp;<span class="builtintype" id="8618655">int</span>&nbsp;<span class="string" id="8618659">`json:&#34;omitempty&#34;`</span>&nbsp;<span class="comment" id="8618678">//&nbsp;actually&nbsp;named&nbsp;omitempty,&nbsp;not&nbsp;an&nbsp;option</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618722">Io</span>&nbsp;<span class="builtintype" id="8618725">int</span>&nbsp;<span class="string" id="8618729">`json:&#34;io,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618753">Slr</span>&nbsp;<span class="op" id="8618757">[</span><span class="op" id="8618758">]</span><span class="builtintype" id="8618759">string</span>&nbsp;<span class="string" id="8618766">`json:&#34;slr,random&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618787">Slo</span>&nbsp;<span class="op" id="8618791">[</span><span class="op" id="8618792">]</span><span class="builtintype" id="8618793">string</span>&nbsp;<span class="string" id="8618800">`json:&#34;slo,omitempty&#34;`</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618825">Mr</span>&nbsp;<span class="keyword" id="8618828">map</span><span class="op" id="8618831">[</span><span class="builtintype" id="8618832">string</span><span class="op" id="8618838">]</span><span class="keyword" id="8618839">interface</span><span class="op" id="8618848">{</span><span class="op" id="8618849">}</span>&nbsp;<span class="string" id="8618851">`json:&#34;mr&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618864">Mo</span>&nbsp;<span class="keyword" id="8618867">map</span><span class="op" id="8618870">[</span><span class="builtintype" id="8618871">string</span><span class="op" id="8618877">]</span><span class="keyword" id="8618878">interface</span><span class="op" id="8618887">{</span><span class="op" id="8618888">}</span>&nbsp;<span class="string" id="8618890">`json:&#34;,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618912">Fr</span>&nbsp;<span class="builtintype" id="8618915">float64</span>&nbsp;<span class="string" id="8618923">`json:&#34;fr&#34;`</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618936">Fo</span>&nbsp;<span class="builtintype" id="8618939">float64</span>&nbsp;<span class="string" id="8618947">`json:&#34;fo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618971">Br</span>&nbsp;<span class="builtintype" id="8618974">bool</span>&nbsp;<span class="string" id="8618979">`json:&#34;br&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8618992">Bo</span>&nbsp;<span class="builtintype" id="8618995">bool</span>&nbsp;<span class="string" id="8619000">`json:&#34;bo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619024">Ur</span>&nbsp;<span class="builtintype" id="8619027">uint</span>&nbsp;<span class="string" id="8619032">`json:&#34;ur&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619045">Uo</span>&nbsp;<span class="builtintype" id="8619048">uint</span>&nbsp;<span class="string" id="8619053">`json:&#34;uo,omitempty&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619077">Str</span>&nbsp;<span class="keyword" id="8619081">struct</span><span class="op" id="8619087">{</span><span class="op" id="8619088">}</span>&nbsp;<span class="string" id="8619090">`json:&#34;str&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619104">Sto</span>&nbsp;<span class="keyword" id="8619108">struct</span><span class="op" id="8619114">{</span><span class="op" id="8619115">}</span>&nbsp;<span class="string" id="8619117">`json:&#34;sto,omitempty&#34;`</span><br>
<span class="lineno">40</span><span class="op" id="8619140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8619143">var</span>&nbsp;<span class="ident" id="8619147">optionalsExpected</span>&nbsp;<span class="op" id="8619165">=</span>&nbsp;<span class="string" id="8619167">`{<br>
<span class="lineno"></span>&nbsp;&#34;sr&#34;:&nbsp;&#34;&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;omitempty&#34;:&nbsp;0,<br>
<span class="lineno">45</span>&nbsp;&#34;slr&#34;:&nbsp;null,<br>
<span class="lineno"></span>&nbsp;&#34;mr&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;fr&#34;:&nbsp;0,<br>
<span class="lineno"></span>&nbsp;&#34;br&#34;:&nbsp;false,<br>
<span class="lineno"></span>&nbsp;&#34;ur&#34;:&nbsp;0,<br>
<span class="lineno">50</span>&nbsp;&#34;str&#34;:&nbsp;{},<br>
<span class="lineno"></span>&nbsp;&#34;sto&#34;:&nbsp;{}<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8619284">func</span>&nbsp;<span class="ident" id="8619289">TestOmitEmpty</span><span class="op" id="8619302">(</span><span class="ident" id="8619303">t</span>&nbsp;<span class="op" id="8619305">*</span><span class="ident" id="8619306">testing</span><span class="op" id="8619313">.</span><span class="ident" id="8619314">T</span><span class="op" id="8619315">)</span>&nbsp;<span class="op" id="8619317">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8619320">var</span>&nbsp;<span class="ident" id="8619324">o</span>&nbsp;<span class="ident" id="8619326">Optionals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619337">o</span><span class="op" id="8619338">.</span><span class="ident" id="8619339">Sw</span>&nbsp;<span class="op" id="8619342">=</span>&nbsp;<span class="string" id="8619344">&#34;something&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619357">o</span><span class="op" id="8619358">.</span><span class="ident" id="8619359">Mr</span>&nbsp;<span class="op" id="8619362">=</span>&nbsp;<span class="keyword" id="8619364">map</span><span class="op" id="8619367">[</span><span class="builtintype" id="8619368">string</span><span class="op" id="8619374">]</span><span class="keyword" id="8619375">interface</span><span class="op" id="8619384">{</span><span class="op" id="8619385">}</span><span class="op" id="8619386">{</span><span class="op" id="8619387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619390">o</span><span class="op" id="8619391">.</span><span class="ident" id="8619392">Mo</span>&nbsp;<span class="op" id="8619395">=</span>&nbsp;<span class="keyword" id="8619397">map</span><span class="op" id="8619400">[</span><span class="builtintype" id="8619401">string</span><span class="op" id="8619407">]</span><span class="keyword" id="8619408">interface</span><span class="op" id="8619417">{</span><span class="op" id="8619418">}</span><span class="op" id="8619419">{</span><span class="op" id="8619420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619424">got</span><span class="op" id="8619427">,</span>&nbsp;<span class="ident" id="8619429">err</span>&nbsp;<span class="op" id="8619433">:=</span>&nbsp;<span class="ident" id="8619436">MarshalIndent</span><span class="op" id="8619449">(</span><span class="op" id="8619450">&amp;</span><span class="ident" id="8619451">o</span><span class="op" id="8619452">,</span>&nbsp;<span class="string" id="8619454">&#34;&#34;</span><span class="op" id="8619456">,</span>&nbsp;<span class="string" id="8619458">&#34;&nbsp;&#34;</span><span class="op" id="8619461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8619464">if</span>&nbsp;<span class="ident" id="8619467">err</span>&nbsp;<span class="op" id="8619471">!=</span>&nbsp;<span class="ident" id="8619474">nil</span>&nbsp;<span class="op" id="8619478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619482">t</span><span class="op" id="8619483">.</span><span class="ident" id="8619484">Fatal</span><span class="op" id="8619489">(</span><span class="ident" id="8619490">err</span><span class="op" id="8619493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8619496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8619499">if</span>&nbsp;<span class="ident" id="8619502">got</span>&nbsp;<span class="op" id="8619506">:=</span>&nbsp;<span class="builtintype" id="8619509">string</span><span class="op" id="8619515">(</span><span class="ident" id="8619516">got</span><span class="op" id="8619519">)</span><span class="op" id="8619520">;</span>&nbsp;<span class="ident" id="8619522">got</span>&nbsp;<span class="op" id="8619526">!=</span>&nbsp;<span class="ident" id="8619529">optionalsExpected</span>&nbsp;<span class="op" id="8619547">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619551">t</span><span class="op" id="8619552">.</span><span class="ident" id="8619553">Errorf</span><span class="op" id="8619559">(</span><span class="string" id="8619560">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8619582">,</span>&nbsp;<span class="ident" id="8619584">got</span><span class="op" id="8619587">,</span>&nbsp;<span class="ident" id="8619589">optionalsExpected</span><span class="op" id="8619606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8619609">}</span><br>
<span class="lineno"></span><span class="op" id="8619611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8619614">type</span>&nbsp;<span class="ident" id="8619619">StringTag</span>&nbsp;<span class="keyword" id="8619629">struct</span>&nbsp;<span class="op" id="8619636">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619639">BoolStr</span>&nbsp;<span class="builtintype" id="8619647">bool</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8619654">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619672">IntStr</span>&nbsp;&nbsp;<span class="ident" id="8619680">int64</span>&nbsp;&nbsp;<span class="string" id="8619687">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619705">StrStr</span>&nbsp;&nbsp;<span class="builtintype" id="8619713">string</span>&nbsp;<span class="string" id="8619720">`json:&#34;,string&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8619737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8619740">var</span>&nbsp;<span class="ident" id="8619744">stringTagExpected</span>&nbsp;<span class="op" id="8619762">=</span>&nbsp;<span class="string" id="8619764">`{<br>
<span class="lineno"></span>&nbsp;&#34;BoolStr&#34;:&nbsp;&#34;true&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;IntStr&#34;:&nbsp;&#34;42&#34;,<br>
<span class="lineno"></span>&nbsp;&#34;StrStr&#34;:&nbsp;&#34;\&#34;xzbit\&#34;&#34;<br>
<span class="lineno"></span>}`</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="8619831">func</span>&nbsp;<span class="ident" id="8619836">TestStringTag</span><span class="op" id="8619849">(</span><span class="ident" id="8619850">t</span>&nbsp;<span class="op" id="8619852">*</span><span class="ident" id="8619853">testing</span><span class="op" id="8619860">.</span><span class="ident" id="8619861">T</span><span class="op" id="8619862">)</span>&nbsp;<span class="op" id="8619864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8619867">var</span>&nbsp;<span class="ident" id="8619871">s</span>&nbsp;<span class="ident" id="8619873">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619884">s</span><span class="op" id="8619885">.</span><span class="ident" id="8619886">BoolStr</span>&nbsp;<span class="op" id="8619894">=</span>&nbsp;<span class="builtintype" id="8619896">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619902">s</span><span class="op" id="8619903">.</span><span class="ident" id="8619904">IntStr</span>&nbsp;<span class="op" id="8619911">=</span>&nbsp;<span class="num" id="8619913">42</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619917">s</span><span class="op" id="8619918">.</span><span class="ident" id="8619919">StrStr</span>&nbsp;<span class="op" id="8619926">=</span>&nbsp;<span class="string" id="8619928">&#34;xzbit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619937">got</span><span class="op" id="8619940">,</span>&nbsp;<span class="ident" id="8619942">err</span>&nbsp;<span class="op" id="8619946">:=</span>&nbsp;<span class="ident" id="8619949">MarshalIndent</span><span class="op" id="8619962">(</span><span class="op" id="8619963">&amp;</span><span class="ident" id="8619964">s</span><span class="op" id="8619965">,</span>&nbsp;<span class="string" id="8619967">&#34;&#34;</span><span class="op" id="8619969">,</span>&nbsp;<span class="string" id="8619971">&#34;&nbsp;&#34;</span><span class="op" id="8619974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8619977">if</span>&nbsp;<span class="ident" id="8619980">err</span>&nbsp;<span class="op" id="8619984">!=</span>&nbsp;<span class="ident" id="8619987">nil</span>&nbsp;<span class="op" id="8619991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8619995">t</span><span class="op" id="8619996">.</span><span class="ident" id="8619997">Fatal</span><span class="op" id="8620002">(</span><span class="ident" id="8620003">err</span><span class="op" id="8620006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620009">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620012">if</span>&nbsp;<span class="ident" id="8620015">got</span>&nbsp;<span class="op" id="8620019">:=</span>&nbsp;<span class="builtintype" id="8620022">string</span><span class="op" id="8620028">(</span><span class="ident" id="8620029">got</span><span class="op" id="8620032">)</span><span class="op" id="8620033">;</span>&nbsp;<span class="ident" id="8620035">got</span>&nbsp;<span class="op" id="8620039">!=</span>&nbsp;<span class="ident" id="8620042">stringTagExpected</span>&nbsp;<span class="op" id="8620060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620064">t</span><span class="op" id="8620065">.</span><span class="ident" id="8620066">Fatalf</span><span class="op" id="8620072">(</span><span class="string" id="8620073">&#34;&nbsp;got:&nbsp;%s\nwant:&nbsp;%s\n&#34;</span><span class="op" id="8620095">,</span>&nbsp;<span class="ident" id="8620097">got</span><span class="op" id="8620100">,</span>&nbsp;<span class="ident" id="8620102">stringTagExpected</span><span class="op" id="8620119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8620126">//&nbsp;Verify&nbsp;that&nbsp;it&nbsp;round-trips.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620158">var</span>&nbsp;<span class="ident" id="8620162">s2</span>&nbsp;<span class="ident" id="8620165">StringTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620176">err</span>&nbsp;<span class="op" id="8620180">=</span>&nbsp;<span class="ident" id="8620182">NewDecoder</span><span class="op" id="8620192">(</span><span class="ident" id="8620193">bytes</span><span class="op" id="8620198">.</span><span class="ident" id="8620199">NewReader</span><span class="op" id="8620208">(</span><span class="ident" id="8620209">got</span><span class="op" id="8620212">)</span><span class="op" id="8620213">)</span><span class="op" id="8620214">.</span><span class="ident" id="8620215">Decode</span><span class="op" id="8620221">(</span><span class="op" id="8620222">&amp;</span><span class="ident" id="8620223">s2</span><span class="op" id="8620225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620228">if</span>&nbsp;<span class="ident" id="8620231">err</span>&nbsp;<span class="op" id="8620235">!=</span>&nbsp;<span class="ident" id="8620238">nil</span>&nbsp;<span class="op" id="8620242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620246">t</span><span class="op" id="8620247">.</span><span class="ident" id="8620248">Fatalf</span><span class="op" id="8620254">(</span><span class="string" id="8620255">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="8620267">,</span>&nbsp;<span class="ident" id="8620269">err</span><span class="op" id="8620272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620275">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620278">if</span>&nbsp;<span class="op" id="8620281">!</span><span class="ident" id="8620282">reflect</span><span class="op" id="8620289">.</span><span class="ident" id="8620290">DeepEqual</span><span class="op" id="8620299">(</span><span class="ident" id="8620300">s</span><span class="op" id="8620301">,</span>&nbsp;<span class="ident" id="8620303">s2</span><span class="op" id="8620305">)</span>&nbsp;<span class="op" id="8620307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620311">t</span><span class="op" id="8620312">.</span><span class="ident" id="8620313">Fatalf</span><span class="op" id="8620319">(</span><span class="string" id="8620320">&#34;decode&nbsp;didn&#39;t&nbsp;match.\nsource:&nbsp;%#v\nEncoded&nbsp;as:\n%s\ndecode:&nbsp;%#v&#34;</span><span class="op" id="8620385">,</span>&nbsp;<span class="ident" id="8620387">s</span><span class="op" id="8620388">,</span>&nbsp;<span class="builtintype" id="8620390">string</span><span class="op" id="8620396">(</span><span class="ident" id="8620397">got</span><span class="op" id="8620400">)</span><span class="op" id="8620401">,</span>&nbsp;<span class="ident" id="8620403">s2</span><span class="op" id="8620405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620408">}</span><br>
<span class="lineno"></span><span class="op" id="8620410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="8620413">//&nbsp;byte&nbsp;slices&nbsp;are&nbsp;special&nbsp;even&nbsp;if&nbsp;they&#39;re&nbsp;renamed&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="8620471">type</span>&nbsp;<span class="ident" id="8620476">renamedByte</span>&nbsp;<span class="builtintype" id="8620488">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8620493">type</span>&nbsp;<span class="ident" id="8620498">renamedByteSlice</span>&nbsp;<span class="op" id="8620515">[</span><span class="op" id="8620516">]</span><span class="builtintype" id="8620517">byte</span><br>
<span class="lineno"></span><span class="keyword" id="8620522">type</span>&nbsp;<span class="ident" id="8620527">renamedRenamedByteSlice</span>&nbsp;<span class="op" id="8620551">[</span><span class="op" id="8620552">]</span><span class="ident" id="8620553">renamedByte</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8620566">func</span>&nbsp;<span class="ident" id="8620571">TestEncodeRenamedByteSlice</span><span class="op" id="8620597">(</span><span class="ident" id="8620598">t</span>&nbsp;<span class="op" id="8620600">*</span><span class="ident" id="8620601">testing</span><span class="op" id="8620608">.</span><span class="ident" id="8620609">T</span><span class="op" id="8620610">)</span>&nbsp;<span class="op" id="8620612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620615">s</span>&nbsp;<span class="op" id="8620617">:=</span>&nbsp;<span class="ident" id="8620620">renamedByteSlice</span><span class="op" id="8620636">(</span><span class="string" id="8620637">&#34;abc&#34;</span><span class="op" id="8620642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620645">result</span><span class="op" id="8620651">,</span>&nbsp;<span class="ident" id="8620653">err</span>&nbsp;<span class="op" id="8620657">:=</span>&nbsp;<span class="ident" id="8620660">Marshal</span><span class="op" id="8620667">(</span><span class="ident" id="8620668">s</span><span class="op" id="8620669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620672">if</span>&nbsp;<span class="ident" id="8620675">err</span>&nbsp;<span class="op" id="8620679">!=</span>&nbsp;<span class="ident" id="8620682">nil</span>&nbsp;<span class="op" id="8620686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620690">t</span><span class="op" id="8620691">.</span><span class="ident" id="8620692">Fatal</span><span class="op" id="8620697">(</span><span class="ident" id="8620698">err</span><span class="op" id="8620701">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620707">expect</span>&nbsp;<span class="op" id="8620714">:=</span>&nbsp;<span class="string" id="8620717">`&#34;YWJj&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620727">if</span>&nbsp;<span class="builtintype" id="8620730">string</span><span class="op" id="8620736">(</span><span class="ident" id="8620737">result</span><span class="op" id="8620743">)</span>&nbsp;<span class="op" id="8620745">!=</span>&nbsp;<span class="ident" id="8620748">expect</span>&nbsp;<span class="op" id="8620755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620759">t</span><span class="op" id="8620760">.</span><span class="ident" id="8620761">Errorf</span><span class="op" id="8620767">(</span><span class="string" id="8620768">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8620785">,</span>&nbsp;<span class="ident" id="8620787">result</span><span class="op" id="8620793">,</span>&nbsp;<span class="ident" id="8620795">expect</span><span class="op" id="8620801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620804">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620807">r</span>&nbsp;<span class="op" id="8620809">:=</span>&nbsp;<span class="ident" id="8620812">renamedRenamedByteSlice</span><span class="op" id="8620835">(</span><span class="string" id="8620836">&#34;abc&#34;</span><span class="op" id="8620841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620844">result</span><span class="op" id="8620850">,</span>&nbsp;<span class="ident" id="8620852">err</span>&nbsp;<span class="op" id="8620856">=</span>&nbsp;<span class="ident" id="8620858">Marshal</span><span class="op" id="8620865">(</span><span class="ident" id="8620866">r</span><span class="op" id="8620867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620870">if</span>&nbsp;<span class="ident" id="8620873">err</span>&nbsp;<span class="op" id="8620877">!=</span>&nbsp;<span class="ident" id="8620880">nil</span>&nbsp;<span class="op" id="8620884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620888">t</span><span class="op" id="8620889">.</span><span class="ident" id="8620890">Fatal</span><span class="op" id="8620895">(</span><span class="ident" id="8620896">err</span><span class="op" id="8620899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620902">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8620905">if</span>&nbsp;<span class="builtintype" id="8620908">string</span><span class="op" id="8620914">(</span><span class="ident" id="8620915">result</span><span class="op" id="8620921">)</span>&nbsp;<span class="op" id="8620923">!=</span>&nbsp;<span class="ident" id="8620926">expect</span>&nbsp;<span class="op" id="8620933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8620937">t</span><span class="op" id="8620938">.</span><span class="ident" id="8620939">Errorf</span><span class="op" id="8620945">(</span><span class="string" id="8620946">&#34;&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8620963">,</span>&nbsp;<span class="ident" id="8620965">result</span><span class="op" id="8620971">,</span>&nbsp;<span class="ident" id="8620973">expect</span><span class="op" id="8620979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8620982">}</span><br>
<span class="lineno"></span><span class="op" id="8620984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="8620987">var</span>&nbsp;<span class="ident" id="8620991">unsupportedValues</span>&nbsp;<span class="op" id="8621009">=</span>&nbsp;<span class="op" id="8621011">[</span><span class="op" id="8621012">]</span><span class="keyword" id="8621013">interface</span><span class="op" id="8621022">{</span><span class="op" id="8621023">}</span><span class="op" id="8621024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8621027">math</span><span class="op" id="8621031">.</span><span class="ident" id="8621032">NaN</span><span class="op" id="8621035">(</span><span class="op" id="8621036">)</span><span class="op" id="8621037">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8621040">math</span><span class="op" id="8621044">.</span><span class="ident" id="8621045">Inf</span><span class="op" id="8621048">(</span><span class="op" id="8621049">-</span><span class="num" id="8621050">1</span><span class="op" id="8621051">)</span><span class="op" id="8621052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8621055">math</span><span class="op" id="8621059">.</span><span class="ident" id="8621060">Inf</span><span class="op" id="8621063">(</span><span class="num" id="8621064">1</span><span class="op" id="8621065">)</span><span class="op" id="8621066">,</span><br>
<span class="lineno"></span><span class="op" id="8621068">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="8621071">func</span>&nbsp;<span class="ident" id="8621076">TestUnsupportedValues</span><span class="op" id="8621097">(</span><span class="ident" id="8621098">t</span>&nbsp;<span class="op" id="8621100">*</span><span class="ident" id="8621101">testing</span><span class="op" id="8621108">.</span><span class="ident" id="8621109">T</span><span class="op" id="8621110">)</span>&nbsp;<span class="op" id="8621112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621115">for</span>&nbsp;<span class="ident" id="8621119">_</span><span class="op" id="8621120">,</span>&nbsp;<span class="ident" id="8621122">v</span>&nbsp;<span class="op" id="8621124">:=</span>&nbsp;<span class="keyword" id="8621127">range</span>&nbsp;<span class="ident" id="8621133">unsupportedValues</span>&nbsp;<span class="op" id="8621151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621155">if</span>&nbsp;<span class="ident" id="8621158">_</span><span class="op" id="8621159">,</span>&nbsp;<span class="ident" id="8621161">err</span>&nbsp;<span class="op" id="8621165">:=</span>&nbsp;<span class="ident" id="8621168">Marshal</span><span class="op" id="8621175">(</span><span class="ident" id="8621176">v</span><span class="op" id="8621177">)</span><span class="op" id="8621178">;</span>&nbsp;<span class="ident" id="8621180">err</span>&nbsp;<span class="op" id="8621184">!=</span>&nbsp;<span class="ident" id="8621187">nil</span>&nbsp;<span class="op" id="8621191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621196">if</span>&nbsp;<span class="ident" id="8621199">_</span><span class="op" id="8621200">,</span>&nbsp;<span class="ident" id="8621202">ok</span>&nbsp;<span class="op" id="8621205">:=</span>&nbsp;<span class="ident" id="8621208">err</span><span class="op" id="8621211">.</span><span class="op" id="8621212">(</span><span class="op" id="8621213">*</span><span class="ident" id="8621214">UnsupportedValueError</span><span class="op" id="8621235">)</span><span class="op" id="8621236">;</span>&nbsp;<span class="op" id="8621238">!</span><span class="ident" id="8621239">ok</span>&nbsp;<span class="op" id="8621242">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8621248">t</span><span class="op" id="8621249">.</span><span class="ident" id="8621250">Errorf</span><span class="op" id="8621256">(</span><span class="string" id="8621257">&#34;for&nbsp;%v,&nbsp;got&nbsp;%T&nbsp;want&nbsp;UnsupportedValueError&#34;</span><span class="op" id="8621300">,</span>&nbsp;<span class="ident" id="8621302">v</span><span class="op" id="8621303">,</span>&nbsp;<span class="ident" id="8621305">err</span><span class="op" id="8621308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621317">}</span>&nbsp;<span class="keyword" id="8621319">else</span>&nbsp;<span class="op" id="8621324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8621329">t</span><span class="op" id="8621330">.</span><span class="ident" id="8621331">Errorf</span><span class="op" id="8621337">(</span><span class="string" id="8621338">&#34;for&nbsp;%v,&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8621362">,</span>&nbsp;<span class="ident" id="8621364">v</span><span class="op" id="8621365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621369">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621372">}</span><br>
<span class="lineno"></span><span class="op" id="8621374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8621377">//&nbsp;Ref&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8621445">type</span>&nbsp;<span class="ident" id="8621450">Ref</span>&nbsp;<span class="builtintype" id="8621454">int</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="8621459">func</span>&nbsp;<span class="op" id="8621464">(</span><span class="op" id="8621465">*</span><span class="ident" id="8621466">Ref</span><span class="op" id="8621469">)</span>&nbsp;<span class="ident" id="8621471">MarshalJSON</span><span class="op" id="8621482">(</span><span class="op" id="8621483">)</span>&nbsp;<span class="op" id="8621485">(</span><span class="op" id="8621486">[</span><span class="op" id="8621487">]</span><span class="builtintype" id="8621488">byte</span><span class="op" id="8621492">,</span>&nbsp;<span class="builtintype" id="8621494">error</span><span class="op" id="8621499">)</span>&nbsp;<span class="op" id="8621501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621504">return</span>&nbsp;<span class="op" id="8621511">[</span><span class="op" id="8621512">]</span><span class="builtintype" id="8621513">byte</span><span class="op" id="8621517">(</span><span class="string" id="8621518">`&#34;ref&#34;`</span><span class="op" id="8621525">)</span><span class="op" id="8621526">,</span>&nbsp;<span class="ident" id="8621528">nil</span><br>
<span class="lineno"></span><span class="op" id="8621532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="8621535">func</span>&nbsp;<span class="op" id="8621540">(</span><span class="ident" id="8621541">r</span>&nbsp;<span class="op" id="8621543">*</span><span class="ident" id="8621544">Ref</span><span class="op" id="8621547">)</span>&nbsp;<span class="ident" id="8621549">UnmarshalJSON</span><span class="op" id="8621562">(</span><span class="op" id="8621563">[</span><span class="op" id="8621564">]</span><span class="builtintype" id="8621565">byte</span><span class="op" id="8621569">)</span>&nbsp;<span class="builtintype" id="8621571">error</span>&nbsp;<span class="op" id="8621577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621580">*</span><span class="ident" id="8621581">r</span>&nbsp;<span class="op" id="8621583">=</span>&nbsp;<span class="num" id="8621585">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621589">return</span>&nbsp;<span class="ident" id="8621596">nil</span><br>
<span class="lineno"></span><span class="op" id="8621600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="8621603">//&nbsp;Val&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8621653">type</span>&nbsp;<span class="ident" id="8621658">Val</span>&nbsp;<span class="builtintype" id="8621662">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8621667">func</span>&nbsp;<span class="op" id="8621672">(</span><span class="ident" id="8621673">Val</span><span class="op" id="8621676">)</span>&nbsp;<span class="ident" id="8621678">MarshalJSON</span><span class="op" id="8621689">(</span><span class="op" id="8621690">)</span>&nbsp;<span class="op" id="8621692">(</span><span class="op" id="8621693">[</span><span class="op" id="8621694">]</span><span class="builtintype" id="8621695">byte</span><span class="op" id="8621699">,</span>&nbsp;<span class="builtintype" id="8621701">error</span><span class="op" id="8621706">)</span>&nbsp;<span class="op" id="8621708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621711">return</span>&nbsp;<span class="op" id="8621718">[</span><span class="op" id="8621719">]</span><span class="builtintype" id="8621720">byte</span><span class="op" id="8621724">(</span><span class="string" id="8621725">`&#34;val&#34;`</span><span class="op" id="8621732">)</span><span class="op" id="8621733">,</span>&nbsp;<span class="ident" id="8621735">nil</span><br>
<span class="lineno">165</span><span class="op" id="8621739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8621742">//&nbsp;RefText&nbsp;has&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;methods&nbsp;with&nbsp;pointer&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="keyword" id="8621814">type</span>&nbsp;<span class="ident" id="8621819">RefText</span>&nbsp;<span class="builtintype" id="8621827">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="8621832">func</span>&nbsp;<span class="op" id="8621837">(</span><span class="op" id="8621838">*</span><span class="ident" id="8621839">RefText</span><span class="op" id="8621846">)</span>&nbsp;<span class="ident" id="8621848">MarshalText</span><span class="op" id="8621859">(</span><span class="op" id="8621860">)</span>&nbsp;<span class="op" id="8621862">(</span><span class="op" id="8621863">[</span><span class="op" id="8621864">]</span><span class="builtintype" id="8621865">byte</span><span class="op" id="8621869">,</span>&nbsp;<span class="builtintype" id="8621871">error</span><span class="op" id="8621876">)</span>&nbsp;<span class="op" id="8621878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621881">return</span>&nbsp;<span class="op" id="8621888">[</span><span class="op" id="8621889">]</span><span class="builtintype" id="8621890">byte</span><span class="op" id="8621894">(</span><span class="string" id="8621895">`&#34;ref&#34;`</span><span class="op" id="8621902">)</span><span class="op" id="8621903">,</span>&nbsp;<span class="ident" id="8621905">nil</span><br>
<span class="lineno"></span><span class="op" id="8621909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8621912">func</span>&nbsp;<span class="op" id="8621917">(</span><span class="ident" id="8621918">r</span>&nbsp;<span class="op" id="8621920">*</span><span class="ident" id="8621921">RefText</span><span class="op" id="8621928">)</span>&nbsp;<span class="ident" id="8621930">UnmarshalText</span><span class="op" id="8621943">(</span><span class="op" id="8621944">[</span><span class="op" id="8621945">]</span><span class="builtintype" id="8621946">byte</span><span class="op" id="8621950">)</span>&nbsp;<span class="builtintype" id="8621952">error</span>&nbsp;<span class="op" id="8621958">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8621961">*</span><span class="ident" id="8621962">r</span>&nbsp;<span class="op" id="8621964">=</span>&nbsp;<span class="num" id="8621966">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8621970">return</span>&nbsp;<span class="ident" id="8621977">nil</span><br>
<span class="lineno"></span><span class="op" id="8621981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8621984">//&nbsp;ValText&nbsp;has&nbsp;Marshaler&nbsp;methods&nbsp;with&nbsp;value&nbsp;receiver.</span><br>
<span class="lineno">180</span><span class="keyword" id="8622038">type</span>&nbsp;<span class="ident" id="8622043">ValText</span>&nbsp;<span class="builtintype" id="8622051">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8622056">func</span>&nbsp;<span class="op" id="8622061">(</span><span class="ident" id="8622062">ValText</span><span class="op" id="8622069">)</span>&nbsp;<span class="ident" id="8622071">MarshalText</span><span class="op" id="8622082">(</span><span class="op" id="8622083">)</span>&nbsp;<span class="op" id="8622085">(</span><span class="op" id="8622086">[</span><span class="op" id="8622087">]</span><span class="builtintype" id="8622088">byte</span><span class="op" id="8622092">,</span>&nbsp;<span class="builtintype" id="8622094">error</span><span class="op" id="8622099">)</span>&nbsp;<span class="op" id="8622101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622104">return</span>&nbsp;<span class="op" id="8622111">[</span><span class="op" id="8622112">]</span><span class="builtintype" id="8622113">byte</span><span class="op" id="8622117">(</span><span class="string" id="8622118">`&#34;val&#34;`</span><span class="op" id="8622125">)</span><span class="op" id="8622126">,</span>&nbsp;<span class="ident" id="8622128">nil</span><br>
<span class="lineno"></span><span class="op" id="8622132">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8622135">func</span>&nbsp;<span class="ident" id="8622140">TestRefValMarshal</span><span class="op" id="8622157">(</span><span class="ident" id="8622158">t</span>&nbsp;<span class="op" id="8622160">*</span><span class="ident" id="8622161">testing</span><span class="op" id="8622168">.</span><span class="ident" id="8622169">T</span><span class="op" id="8622170">)</span>&nbsp;<span class="op" id="8622172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622175">var</span>&nbsp;<span class="ident" id="8622179">s</span>&nbsp;<span class="op" id="8622181">=</span>&nbsp;<span class="keyword" id="8622183">struct</span>&nbsp;<span class="op" id="8622190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622194">R0</span>&nbsp;<span class="ident" id="8622197">Ref</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622203">R1</span>&nbsp;<span class="op" id="8622206">*</span><span class="ident" id="8622207">Ref</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622213">R2</span>&nbsp;<span class="ident" id="8622216">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622226">R3</span>&nbsp;<span class="op" id="8622229">*</span><span class="ident" id="8622230">RefText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622240">V0</span>&nbsp;<span class="ident" id="8622243">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622249">V1</span>&nbsp;<span class="op" id="8622252">*</span><span class="ident" id="8622253">Val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622259">V2</span>&nbsp;<span class="ident" id="8622262">ValText</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622272">V3</span>&nbsp;<span class="op" id="8622275">*</span><span class="ident" id="8622276">ValText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8622285">}</span><span class="op" id="8622286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622290">R0</span><span class="op" id="8622292">:</span>&nbsp;<span class="num" id="8622294">12</span><span class="op" id="8622296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622300">R1</span><span class="op" id="8622302">:</span>&nbsp;<span class="builtinfunc" id="8622304">new</span><span class="op" id="8622307">(</span><span class="ident" id="8622308">Ref</span><span class="op" id="8622311">)</span><span class="op" id="8622312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622316">R2</span><span class="op" id="8622318">:</span>&nbsp;<span class="num" id="8622320">14</span><span class="op" id="8622322">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622326">R3</span><span class="op" id="8622328">:</span>&nbsp;<span class="builtinfunc" id="8622330">new</span><span class="op" id="8622333">(</span><span class="ident" id="8622334">RefText</span><span class="op" id="8622341">)</span><span class="op" id="8622342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622346">V0</span><span class="op" id="8622348">:</span>&nbsp;<span class="num" id="8622350">13</span><span class="op" id="8622352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622356">V1</span><span class="op" id="8622358">:</span>&nbsp;<span class="builtinfunc" id="8622360">new</span><span class="op" id="8622363">(</span><span class="ident" id="8622364">Val</span><span class="op" id="8622367">)</span><span class="op" id="8622368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622372">V2</span><span class="op" id="8622374">:</span>&nbsp;<span class="num" id="8622376">15</span><span class="op" id="8622378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622382">V3</span><span class="op" id="8622384">:</span>&nbsp;<span class="builtinfunc" id="8622386">new</span><span class="op" id="8622389">(</span><span class="ident" id="8622390">ValText</span><span class="op" id="8622397">)</span><span class="op" id="8622398">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8622401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622404">const</span>&nbsp;<span class="ident" id="8622410">want</span>&nbsp;<span class="op" id="8622415">=</span>&nbsp;<span class="string" id="8622417">`{&#34;R0&#34;:&#34;ref&#34;,&#34;R1&#34;:&#34;ref&#34;,&#34;R2&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;R3&#34;:&#34;\&#34;ref\&#34;&#34;,&#34;V0&#34;:&#34;val&#34;,&#34;V1&#34;:&#34;val&#34;,&#34;V2&#34;:&#34;\&#34;val\&#34;&#34;,&#34;V3&#34;:&#34;\&#34;val\&#34;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622526">b</span><span class="op" id="8622527">,</span>&nbsp;<span class="ident" id="8622529">err</span>&nbsp;<span class="op" id="8622533">:=</span>&nbsp;<span class="ident" id="8622536">Marshal</span><span class="op" id="8622543">(</span><span class="op" id="8622544">&amp;</span><span class="ident" id="8622545">s</span><span class="op" id="8622546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622549">if</span>&nbsp;<span class="ident" id="8622552">err</span>&nbsp;<span class="op" id="8622556">!=</span>&nbsp;<span class="ident" id="8622559">nil</span>&nbsp;<span class="op" id="8622563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622567">t</span><span class="op" id="8622568">.</span><span class="ident" id="8622569">Fatalf</span><span class="op" id="8622575">(</span><span class="string" id="8622576">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8622589">,</span>&nbsp;<span class="ident" id="8622591">err</span><span class="op" id="8622594">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8622597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622600">if</span>&nbsp;<span class="ident" id="8622603">got</span>&nbsp;<span class="op" id="8622607">:=</span>&nbsp;<span class="builtintype" id="8622610">string</span><span class="op" id="8622616">(</span><span class="ident" id="8622617">b</span><span class="op" id="8622618">)</span><span class="op" id="8622619">;</span>&nbsp;<span class="ident" id="8622621">got</span>&nbsp;<span class="op" id="8622625">!=</span>&nbsp;<span class="ident" id="8622628">want</span>&nbsp;<span class="op" id="8622633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8622637">t</span><span class="op" id="8622638">.</span><span class="ident" id="8622639">Errorf</span><span class="op" id="8622645">(</span><span class="string" id="8622646">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8622663">,</span>&nbsp;<span class="ident" id="8622665">got</span><span class="op" id="8622668">,</span>&nbsp;<span class="ident" id="8622670">want</span><span class="op" id="8622674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8622677">}</span><br>
<span class="lineno"></span><span class="op" id="8622679">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="8622682">//&nbsp;C&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;JSON.</span><br>
<span class="lineno"></span><span class="keyword" id="8622736">type</span>&nbsp;<span class="ident" id="8622741">C</span>&nbsp;<span class="builtintype" id="8622743">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8622748">func</span>&nbsp;<span class="op" id="8622753">(</span><span class="ident" id="8622754">C</span><span class="op" id="8622755">)</span>&nbsp;<span class="ident" id="8622757">MarshalJSON</span><span class="op" id="8622768">(</span><span class="op" id="8622769">)</span>&nbsp;<span class="op" id="8622771">(</span><span class="op" id="8622772">[</span><span class="op" id="8622773">]</span><span class="builtintype" id="8622774">byte</span><span class="op" id="8622778">,</span>&nbsp;<span class="builtintype" id="8622780">error</span><span class="op" id="8622785">)</span>&nbsp;<span class="op" id="8622787">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622790">return</span>&nbsp;<span class="op" id="8622797">[</span><span class="op" id="8622798">]</span><span class="builtintype" id="8622799">byte</span><span class="op" id="8622803">(</span><span class="string" id="8622804">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8622811">)</span><span class="op" id="8622812">,</span>&nbsp;<span class="ident" id="8622814">nil</span><br>
<span class="lineno"></span><span class="op" id="8622818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8622821">//&nbsp;CText&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;returns&nbsp;unescaped&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="8622879">type</span>&nbsp;<span class="ident" id="8622884">CText</span>&nbsp;<span class="builtintype" id="8622890">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="8622895">func</span>&nbsp;<span class="op" id="8622900">(</span><span class="ident" id="8622901">CText</span><span class="op" id="8622906">)</span>&nbsp;<span class="ident" id="8622908">MarshalText</span><span class="op" id="8622919">(</span><span class="op" id="8622920">)</span>&nbsp;<span class="op" id="8622922">(</span><span class="op" id="8622923">[</span><span class="op" id="8622924">]</span><span class="builtintype" id="8622925">byte</span><span class="op" id="8622929">,</span>&nbsp;<span class="builtintype" id="8622931">error</span><span class="op" id="8622936">)</span>&nbsp;<span class="op" id="8622938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8622941">return</span>&nbsp;<span class="op" id="8622948">[</span><span class="op" id="8622949">]</span><span class="builtintype" id="8622950">byte</span><span class="op" id="8622954">(</span><span class="string" id="8622955">`&#34;&lt;&amp;&gt;&#34;`</span><span class="op" id="8622962">)</span><span class="op" id="8622963">,</span>&nbsp;<span class="ident" id="8622965">nil</span><br>
<span class="lineno"></span><span class="op" id="8622969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8622972">func</span>&nbsp;<span class="ident" id="8622977">TestMarshalerEscaping</span><span class="op" id="8622998">(</span><span class="ident" id="8622999">t</span>&nbsp;<span class="op" id="8623001">*</span><span class="ident" id="8623002">testing</span><span class="op" id="8623009">.</span><span class="ident" id="8623010">T</span><span class="op" id="8623011">)</span>&nbsp;<span class="op" id="8623013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623016">var</span>&nbsp;<span class="ident" id="8623020">c</span>&nbsp;<span class="ident" id="8623022">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623025">want</span>&nbsp;<span class="op" id="8623030">:=</span>&nbsp;<span class="string" id="8623033">`&#34;\u003c\u0026\u003e&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623057">b</span><span class="op" id="8623058">,</span>&nbsp;<span class="ident" id="8623060">err</span>&nbsp;<span class="op" id="8623064">:=</span>&nbsp;<span class="ident" id="8623067">Marshal</span><span class="op" id="8623074">(</span><span class="ident" id="8623075">c</span><span class="op" id="8623076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623079">if</span>&nbsp;<span class="ident" id="8623082">err</span>&nbsp;<span class="op" id="8623086">!=</span>&nbsp;<span class="ident" id="8623089">nil</span>&nbsp;<span class="op" id="8623093">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623097">t</span><span class="op" id="8623098">.</span><span class="ident" id="8623099">Fatalf</span><span class="op" id="8623105">(</span><span class="string" id="8623106">&#34;Marshal(c):&nbsp;%v&#34;</span><span class="op" id="8623122">,</span>&nbsp;<span class="ident" id="8623124">err</span><span class="op" id="8623127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623133">if</span>&nbsp;<span class="ident" id="8623136">got</span>&nbsp;<span class="op" id="8623140">:=</span>&nbsp;<span class="builtintype" id="8623143">string</span><span class="op" id="8623149">(</span><span class="ident" id="8623150">b</span><span class="op" id="8623151">)</span><span class="op" id="8623152">;</span>&nbsp;<span class="ident" id="8623154">got</span>&nbsp;<span class="op" id="8623158">!=</span>&nbsp;<span class="ident" id="8623161">want</span>&nbsp;<span class="op" id="8623166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623170">t</span><span class="op" id="8623171">.</span><span class="ident" id="8623172">Errorf</span><span class="op" id="8623178">(</span><span class="string" id="8623179">&#34;Marshal(c)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8623207">,</span>&nbsp;<span class="ident" id="8623209">got</span><span class="op" id="8623212">,</span>&nbsp;<span class="ident" id="8623214">want</span><span class="op" id="8623218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623221">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623225">var</span>&nbsp;<span class="ident" id="8623229">ct</span>&nbsp;<span class="ident" id="8623232">CText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623239">want</span>&nbsp;<span class="op" id="8623244">=</span>&nbsp;<span class="string" id="8623246">`&#34;\&#34;\u003c\u0026\u003e\&#34;&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623274">b</span><span class="op" id="8623275">,</span>&nbsp;<span class="ident" id="8623277">err</span>&nbsp;<span class="op" id="8623281">=</span>&nbsp;<span class="ident" id="8623283">Marshal</span><span class="op" id="8623290">(</span><span class="ident" id="8623291">ct</span><span class="op" id="8623293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623296">if</span>&nbsp;<span class="ident" id="8623299">err</span>&nbsp;<span class="op" id="8623303">!=</span>&nbsp;<span class="ident" id="8623306">nil</span>&nbsp;<span class="op" id="8623310">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623314">t</span><span class="op" id="8623315">.</span><span class="ident" id="8623316">Fatalf</span><span class="op" id="8623322">(</span><span class="string" id="8623323">&#34;Marshal(ct):&nbsp;%v&#34;</span><span class="op" id="8623340">,</span>&nbsp;<span class="ident" id="8623342">err</span><span class="op" id="8623345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623351">if</span>&nbsp;<span class="ident" id="8623354">got</span>&nbsp;<span class="op" id="8623358">:=</span>&nbsp;<span class="builtintype" id="8623361">string</span><span class="op" id="8623367">(</span><span class="ident" id="8623368">b</span><span class="op" id="8623369">)</span><span class="op" id="8623370">;</span>&nbsp;<span class="ident" id="8623372">got</span>&nbsp;<span class="op" id="8623376">!=</span>&nbsp;<span class="ident" id="8623379">want</span>&nbsp;<span class="op" id="8623384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623388">t</span><span class="op" id="8623389">.</span><span class="ident" id="8623390">Errorf</span><span class="op" id="8623396">(</span><span class="string" id="8623397">&#34;Marshal(ct)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8623426">,</span>&nbsp;<span class="ident" id="8623428">got</span><span class="op" id="8623431">,</span>&nbsp;<span class="ident" id="8623433">want</span><span class="op" id="8623437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623440">}</span><br>
<span class="lineno">250</span><span class="op" id="8623442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8623445">type</span>&nbsp;<span class="ident" id="8623450">IntType</span>&nbsp;<span class="builtintype" id="8623458">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8623463">type</span>&nbsp;<span class="ident" id="8623468">MyStruct</span>&nbsp;<span class="keyword" id="8623477">struct</span>&nbsp;<span class="op" id="8623484">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623487">IntType</span><br>
<span class="lineno"></span><span class="op" id="8623495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8623498">func</span>&nbsp;<span class="ident" id="8623503">TestAnonymousNonstruct</span><span class="op" id="8623525">(</span><span class="ident" id="8623526">t</span>&nbsp;<span class="op" id="8623528">*</span><span class="ident" id="8623529">testing</span><span class="op" id="8623536">.</span><span class="ident" id="8623537">T</span><span class="op" id="8623538">)</span>&nbsp;<span class="op" id="8623540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623543">var</span>&nbsp;<span class="ident" id="8623547">i</span>&nbsp;<span class="ident" id="8623549">IntType</span>&nbsp;<span class="op" id="8623557">=</span>&nbsp;<span class="num" id="8623559">11</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623563">a</span>&nbsp;<span class="op" id="8623565">:=</span>&nbsp;<span class="ident" id="8623568">MyStruct</span><span class="op" id="8623576">{</span><span class="ident" id="8623577">i</span><span class="op" id="8623578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623581">const</span>&nbsp;<span class="ident" id="8623587">want</span>&nbsp;<span class="op" id="8623592">=</span>&nbsp;<span class="string" id="8623594">`{&#34;IntType&#34;:11}`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623613">b</span><span class="op" id="8623614">,</span>&nbsp;<span class="ident" id="8623616">err</span>&nbsp;<span class="op" id="8623620">:=</span>&nbsp;<span class="ident" id="8623623">Marshal</span><span class="op" id="8623630">(</span><span class="ident" id="8623631">a</span><span class="op" id="8623632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623635">if</span>&nbsp;<span class="ident" id="8623638">err</span>&nbsp;<span class="op" id="8623642">!=</span>&nbsp;<span class="ident" id="8623645">nil</span>&nbsp;<span class="op" id="8623649">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623653">t</span><span class="op" id="8623654">.</span><span class="ident" id="8623655">Fatalf</span><span class="op" id="8623661">(</span><span class="string" id="8623662">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8623675">,</span>&nbsp;<span class="ident" id="8623677">err</span><span class="op" id="8623680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8623686">if</span>&nbsp;<span class="ident" id="8623689">got</span>&nbsp;<span class="op" id="8623693">:=</span>&nbsp;<span class="builtintype" id="8623696">string</span><span class="op" id="8623702">(</span><span class="ident" id="8623703">b</span><span class="op" id="8623704">)</span><span class="op" id="8623705">;</span>&nbsp;<span class="ident" id="8623707">got</span>&nbsp;<span class="op" id="8623711">!=</span>&nbsp;<span class="ident" id="8623714">want</span>&nbsp;<span class="op" id="8623719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623723">t</span><span class="op" id="8623724">.</span><span class="ident" id="8623725">Errorf</span><span class="op" id="8623731">(</span><span class="string" id="8623732">&#34;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8623749">,</span>&nbsp;<span class="ident" id="8623751">got</span><span class="op" id="8623754">,</span>&nbsp;<span class="ident" id="8623756">want</span><span class="op" id="8623760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8623763">}</span><br>
<span class="lineno">270</span><span class="op" id="8623765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8623768">type</span>&nbsp;<span class="ident" id="8623773">BugA</span>&nbsp;<span class="keyword" id="8623778">struct</span>&nbsp;<span class="op" id="8623785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623788">S</span>&nbsp;<span class="builtintype" id="8623790">string</span><br>
<span class="lineno"></span><span class="op" id="8623797">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="8623800">type</span>&nbsp;<span class="ident" id="8623805">BugB</span>&nbsp;<span class="keyword" id="8623810">struct</span>&nbsp;<span class="op" id="8623817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623820">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623826">S</span>&nbsp;<span class="builtintype" id="8623828">string</span><br>
<span class="lineno"></span><span class="op" id="8623835">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="8623838">type</span>&nbsp;<span class="ident" id="8623843">BugC</span>&nbsp;<span class="keyword" id="8623848">struct</span>&nbsp;<span class="op" id="8623855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623858">S</span>&nbsp;<span class="builtintype" id="8623860">string</span><br>
<span class="lineno"></span><span class="op" id="8623867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="8623870">//&nbsp;Legal&nbsp;Go:&nbsp;We&nbsp;never&nbsp;use&nbsp;the&nbsp;repeated&nbsp;embedded&nbsp;field&nbsp;(S).</span><br>
<span class="lineno"></span><span class="keyword" id="8623929">type</span>&nbsp;<span class="ident" id="8623934">BugX</span>&nbsp;<span class="keyword" id="8623939">struct</span>&nbsp;<span class="op" id="8623946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623949">A</span>&nbsp;<span class="builtintype" id="8623951">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623956">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8623962">BugB</span><br>
<span class="lineno">290</span><span class="op" id="8623967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8623970">//&nbsp;Issue&nbsp;5245.</span><br>
<span class="lineno"></span><span class="keyword" id="8623985">func</span>&nbsp;<span class="ident" id="8623990">TestEmbeddedBug</span><span class="op" id="8624005">(</span><span class="ident" id="8624006">t</span>&nbsp;<span class="op" id="8624008">*</span><span class="ident" id="8624009">testing</span><span class="op" id="8624016">.</span><span class="ident" id="8624017">T</span><span class="op" id="8624018">)</span>&nbsp;<span class="op" id="8624020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624023">v</span>&nbsp;<span class="op" id="8624025">:=</span>&nbsp;<span class="ident" id="8624028">BugB</span><span class="op" id="8624032">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624036">BugA</span><span class="op" id="8624040">{</span><span class="string" id="8624041">&#34;A&#34;</span><span class="op" id="8624044">}</span><span class="op" id="8624045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8624049">&#34;B&#34;</span><span class="op" id="8624052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624058">b</span><span class="op" id="8624059">,</span>&nbsp;<span class="ident" id="8624061">err</span>&nbsp;<span class="op" id="8624065">:=</span>&nbsp;<span class="ident" id="8624068">Marshal</span><span class="op" id="8624075">(</span><span class="ident" id="8624076">v</span><span class="op" id="8624077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624080">if</span>&nbsp;<span class="ident" id="8624083">err</span>&nbsp;<span class="op" id="8624087">!=</span>&nbsp;<span class="ident" id="8624090">nil</span>&nbsp;<span class="op" id="8624094">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624098">t</span><span class="op" id="8624099">.</span><span class="ident" id="8624100">Fatal</span><span class="op" id="8624105">(</span><span class="string" id="8624106">&#34;Marshal:&#34;</span><span class="op" id="8624116">,</span>&nbsp;<span class="ident" id="8624118">err</span><span class="op" id="8624121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624127">want</span>&nbsp;<span class="op" id="8624132">:=</span>&nbsp;<span class="string" id="8624135">`{&#34;S&#34;:&#34;B&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624148">got</span>&nbsp;<span class="op" id="8624152">:=</span>&nbsp;<span class="builtintype" id="8624155">string</span><span class="op" id="8624161">(</span><span class="ident" id="8624162">b</span><span class="op" id="8624163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624166">if</span>&nbsp;<span class="ident" id="8624169">got</span>&nbsp;<span class="op" id="8624173">!=</span>&nbsp;<span class="ident" id="8624176">want</span>&nbsp;<span class="op" id="8624181">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624185">t</span><span class="op" id="8624186">.</span><span class="ident" id="8624187">Fatalf</span><span class="op" id="8624193">(</span><span class="string" id="8624194">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8624219">,</span>&nbsp;<span class="ident" id="8624221">got</span><span class="op" id="8624224">,</span>&nbsp;<span class="ident" id="8624226">want</span><span class="op" id="8624230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8624236">//&nbsp;Now&nbsp;check&nbsp;that&nbsp;the&nbsp;duplicate&nbsp;field,&nbsp;S,&nbsp;does&nbsp;not&nbsp;appear.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624296">x</span>&nbsp;<span class="op" id="8624298">:=</span>&nbsp;<span class="ident" id="8624301">BugX</span><span class="op" id="8624305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624309">A</span><span class="op" id="8624310">:</span>&nbsp;<span class="num" id="8624312">23</span><span class="op" id="8624314">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624320">b</span><span class="op" id="8624321">,</span>&nbsp;<span class="ident" id="8624323">err</span>&nbsp;<span class="op" id="8624327">=</span>&nbsp;<span class="ident" id="8624329">Marshal</span><span class="op" id="8624336">(</span><span class="ident" id="8624337">x</span><span class="op" id="8624338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624341">if</span>&nbsp;<span class="ident" id="8624344">err</span>&nbsp;<span class="op" id="8624348">!=</span>&nbsp;<span class="ident" id="8624351">nil</span>&nbsp;<span class="op" id="8624355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624359">t</span><span class="op" id="8624360">.</span><span class="ident" id="8624361">Fatal</span><span class="op" id="8624366">(</span><span class="string" id="8624367">&#34;Marshal:&#34;</span><span class="op" id="8624377">,</span>&nbsp;<span class="ident" id="8624379">err</span><span class="op" id="8624382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624385">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624388">want</span>&nbsp;<span class="op" id="8624393">=</span>&nbsp;<span class="string" id="8624395">`{&#34;A&#34;:23}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624407">got</span>&nbsp;<span class="op" id="8624411">=</span>&nbsp;<span class="builtintype" id="8624413">string</span><span class="op" id="8624419">(</span><span class="ident" id="8624420">b</span><span class="op" id="8624421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624424">if</span>&nbsp;<span class="ident" id="8624427">got</span>&nbsp;<span class="op" id="8624431">!=</span>&nbsp;<span class="ident" id="8624434">want</span>&nbsp;<span class="op" id="8624439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624443">t</span><span class="op" id="8624444">.</span><span class="ident" id="8624445">Fatalf</span><span class="op" id="8624451">(</span><span class="string" id="8624452">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8624477">,</span>&nbsp;<span class="ident" id="8624479">got</span><span class="op" id="8624482">,</span>&nbsp;<span class="ident" id="8624484">want</span><span class="op" id="8624488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624491">}</span><br>
<span class="lineno">320</span><span class="op" id="8624493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8624496">type</span>&nbsp;<span class="ident" id="8624501">BugD</span>&nbsp;<span class="keyword" id="8624506">struct</span>&nbsp;<span class="op" id="8624513">{</span>&nbsp;<span class="comment" id="8624515">//&nbsp;Same&nbsp;as&nbsp;BugA&nbsp;after&nbsp;tagging.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624547">XXX</span>&nbsp;<span class="builtintype" id="8624551">string</span>&nbsp;<span class="string" id="8624558">`json:&#34;S&#34;`</span><br>
<span class="lineno"></span><span class="op" id="8624569">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="8624572">//&nbsp;BugD&#39;s&nbsp;tagged&nbsp;S&nbsp;field&nbsp;should&nbsp;dominate&nbsp;BugA&#39;s.</span><br>
<span class="lineno"></span><span class="keyword" id="8624621">type</span>&nbsp;<span class="ident" id="8624626">BugY</span>&nbsp;<span class="keyword" id="8624631">struct</span>&nbsp;<span class="op" id="8624638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624641">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624647">BugD</span><br>
<span class="lineno">330</span><span class="op" id="8624652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8624655">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;dominates&nbsp;untagged&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="8624714">func</span>&nbsp;<span class="ident" id="8624719">TestTaggedFieldDominates</span><span class="op" id="8624743">(</span><span class="ident" id="8624744">t</span>&nbsp;<span class="op" id="8624746">*</span><span class="ident" id="8624747">testing</span><span class="op" id="8624754">.</span><span class="ident" id="8624755">T</span><span class="op" id="8624756">)</span>&nbsp;<span class="op" id="8624758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624761">v</span>&nbsp;<span class="op" id="8624763">:=</span>&nbsp;<span class="ident" id="8624766">BugY</span><span class="op" id="8624770">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624774">BugA</span><span class="op" id="8624778">{</span><span class="string" id="8624779">&#34;BugA&#34;</span><span class="op" id="8624785">}</span><span class="op" id="8624786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624790">BugD</span><span class="op" id="8624794">{</span><span class="string" id="8624795">&#34;BugD&#34;</span><span class="op" id="8624801">}</span><span class="op" id="8624802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624808">b</span><span class="op" id="8624809">,</span>&nbsp;<span class="ident" id="8624811">err</span>&nbsp;<span class="op" id="8624815">:=</span>&nbsp;<span class="ident" id="8624818">Marshal</span><span class="op" id="8624825">(</span><span class="ident" id="8624826">v</span><span class="op" id="8624827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624830">if</span>&nbsp;<span class="ident" id="8624833">err</span>&nbsp;<span class="op" id="8624837">!=</span>&nbsp;<span class="ident" id="8624840">nil</span>&nbsp;<span class="op" id="8624844">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624848">t</span><span class="op" id="8624849">.</span><span class="ident" id="8624850">Fatal</span><span class="op" id="8624855">(</span><span class="string" id="8624856">&#34;Marshal:&#34;</span><span class="op" id="8624866">,</span>&nbsp;<span class="ident" id="8624868">err</span><span class="op" id="8624871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624877">want</span>&nbsp;<span class="op" id="8624882">:=</span>&nbsp;<span class="string" id="8624885">`{&#34;S&#34;:&#34;BugD&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624901">got</span>&nbsp;<span class="op" id="8624905">:=</span>&nbsp;<span class="builtintype" id="8624908">string</span><span class="op" id="8624914">(</span><span class="ident" id="8624915">b</span><span class="op" id="8624916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8624919">if</span>&nbsp;<span class="ident" id="8624922">got</span>&nbsp;<span class="op" id="8624926">!=</span>&nbsp;<span class="ident" id="8624929">want</span>&nbsp;<span class="op" id="8624934">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8624938">t</span><span class="op" id="8624939">.</span><span class="ident" id="8624940">Fatalf</span><span class="op" id="8624946">(</span><span class="string" id="8624947">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8624972">,</span>&nbsp;<span class="ident" id="8624974">got</span><span class="op" id="8624977">,</span>&nbsp;<span class="ident" id="8624979">want</span><span class="op" id="8624983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8624986">}</span><br>
<span class="lineno"></span><span class="op" id="8624988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8624991">//&nbsp;There&nbsp;are&nbsp;no&nbsp;tags&nbsp;here,&nbsp;so&nbsp;S&nbsp;should&nbsp;not&nbsp;appear.</span><br>
<span class="lineno">350</span><span class="keyword" id="8625042">type</span>&nbsp;<span class="ident" id="8625047">BugZ</span>&nbsp;<span class="keyword" id="8625052">struct</span>&nbsp;<span class="op" id="8625059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625062">BugA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625068">BugC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625074">BugY</span>&nbsp;<span class="comment" id="8625079">//&nbsp;Contains&nbsp;a&nbsp;tagged&nbsp;S&nbsp;field&nbsp;through&nbsp;BugD;&nbsp;should&nbsp;not&nbsp;dominate.</span><br>
<span class="lineno"></span><span class="op" id="8625143">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="8625146">func</span>&nbsp;<span class="ident" id="8625151">TestDuplicatedFieldDisappears</span><span class="op" id="8625180">(</span><span class="ident" id="8625181">t</span>&nbsp;<span class="op" id="8625183">*</span><span class="ident" id="8625184">testing</span><span class="op" id="8625191">.</span><span class="ident" id="8625192">T</span><span class="op" id="8625193">)</span>&nbsp;<span class="op" id="8625195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625198">v</span>&nbsp;<span class="op" id="8625200">:=</span>&nbsp;<span class="ident" id="8625203">BugZ</span><span class="op" id="8625207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625211">BugA</span><span class="op" id="8625215">{</span><span class="string" id="8625216">&#34;BugA&#34;</span><span class="op" id="8625222">}</span><span class="op" id="8625223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625227">BugC</span><span class="op" id="8625231">{</span><span class="string" id="8625232">&#34;BugC&#34;</span><span class="op" id="8625238">}</span><span class="op" id="8625239">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625243">BugY</span><span class="op" id="8625247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625252">BugA</span><span class="op" id="8625256">{</span><span class="string" id="8625257">&#34;nested&nbsp;BugA&#34;</span><span class="op" id="8625270">}</span><span class="op" id="8625271">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625276">BugD</span><span class="op" id="8625280">{</span><span class="string" id="8625281">&#34;nested&nbsp;BugD&#34;</span><span class="op" id="8625294">}</span><span class="op" id="8625295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625299">}</span><span class="op" id="8625300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625303">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625306">b</span><span class="op" id="8625307">,</span>&nbsp;<span class="ident" id="8625309">err</span>&nbsp;<span class="op" id="8625313">:=</span>&nbsp;<span class="ident" id="8625316">Marshal</span><span class="op" id="8625323">(</span><span class="ident" id="8625324">v</span><span class="op" id="8625325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625328">if</span>&nbsp;<span class="ident" id="8625331">err</span>&nbsp;<span class="op" id="8625335">!=</span>&nbsp;<span class="ident" id="8625338">nil</span>&nbsp;<span class="op" id="8625342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625346">t</span><span class="op" id="8625347">.</span><span class="ident" id="8625348">Fatal</span><span class="op" id="8625353">(</span><span class="string" id="8625354">&#34;Marshal:&#34;</span><span class="op" id="8625364">,</span>&nbsp;<span class="ident" id="8625366">err</span><span class="op" id="8625369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625375">want</span>&nbsp;<span class="op" id="8625380">:=</span>&nbsp;<span class="string" id="8625383">`{}`</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625389">got</span>&nbsp;<span class="op" id="8625393">:=</span>&nbsp;<span class="builtintype" id="8625396">string</span><span class="op" id="8625402">(</span><span class="ident" id="8625403">b</span><span class="op" id="8625404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625407">if</span>&nbsp;<span class="ident" id="8625410">got</span>&nbsp;<span class="op" id="8625414">!=</span>&nbsp;<span class="ident" id="8625417">want</span>&nbsp;<span class="op" id="8625422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625426">t</span><span class="op" id="8625427">.</span><span class="ident" id="8625428">Fatalf</span><span class="op" id="8625434">(</span><span class="string" id="8625435">&#34;Marshal:&nbsp;got&nbsp;%s&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8625460">,</span>&nbsp;<span class="ident" id="8625462">got</span><span class="op" id="8625465">,</span>&nbsp;<span class="ident" id="8625467">want</span><span class="op" id="8625471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625474">}</span><br>
<span class="lineno"></span><span class="op" id="8625476">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8625479">func</span>&nbsp;<span class="ident" id="8625484">TestStringBytes</span><span class="op" id="8625499">(</span><span class="ident" id="8625500">t</span>&nbsp;<span class="op" id="8625502">*</span><span class="ident" id="8625503">testing</span><span class="op" id="8625510">.</span><span class="ident" id="8625511">T</span><span class="op" id="8625512">)</span>&nbsp;<span class="op" id="8625514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8625517">//&nbsp;Test&nbsp;that&nbsp;encodeState.stringBytes&nbsp;and&nbsp;encodeState.string&nbsp;use&nbsp;the&nbsp;same&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625601">es</span>&nbsp;<span class="op" id="8625604">:=</span>&nbsp;<span class="op" id="8625607">&amp;</span><span class="ident" id="8625608">encodeState</span><span class="op" id="8625619">{</span><span class="op" id="8625620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625623">var</span>&nbsp;<span class="ident" id="8625627">r</span>&nbsp;<span class="op" id="8625629">[</span><span class="op" id="8625630">]</span><span class="builtintype" id="8625631">rune</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625637">for</span>&nbsp;<span class="ident" id="8625641">i</span>&nbsp;<span class="op" id="8625643">:=</span>&nbsp;<span class="string" id="8625646">&#39;\u0000&#39;</span><span class="op" id="8625654">;</span>&nbsp;<span class="ident" id="8625656">i</span>&nbsp;<span class="op" id="8625658">&lt;=</span>&nbsp;<span class="ident" id="8625661">unicode</span><span class="op" id="8625668">.</span><span class="ident" id="8625669">MaxRune</span><span class="op" id="8625676">;</span>&nbsp;<span class="ident" id="8625678">i</span><span class="op" id="8625679">++</span>&nbsp;<span class="op" id="8625682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625686">r</span>&nbsp;<span class="op" id="8625688">=</span>&nbsp;<span class="builtinfunc" id="8625690">append</span><span class="op" id="8625696">(</span><span class="ident" id="8625697">r</span><span class="op" id="8625698">,</span>&nbsp;<span class="ident" id="8625700">i</span><span class="op" id="8625701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625707">s</span>&nbsp;<span class="op" id="8625709">:=</span>&nbsp;<span class="builtintype" id="8625712">string</span><span class="op" id="8625718">(</span><span class="ident" id="8625719">r</span><span class="op" id="8625720">)</span>&nbsp;<span class="op" id="8625722">+</span>&nbsp;<span class="string" id="8625724">&#34;\xff\xff\xffhello&#34;</span>&nbsp;<span class="comment" id="8625744">//&nbsp;some&nbsp;invalid&nbsp;UTF-8&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625771">_</span><span class="op" id="8625772">,</span>&nbsp;<span class="ident" id="8625774">err</span>&nbsp;<span class="op" id="8625778">:=</span>&nbsp;<span class="ident" id="8625781">es</span><span class="op" id="8625783">.</span><span class="builtintype" id="8625784">string</span><span class="op" id="8625790">(</span><span class="ident" id="8625791">s</span><span class="op" id="8625792">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625795">if</span>&nbsp;<span class="ident" id="8625798">err</span>&nbsp;<span class="op" id="8625802">!=</span>&nbsp;<span class="ident" id="8625805">nil</span>&nbsp;<span class="op" id="8625809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625813">t</span><span class="op" id="8625814">.</span><span class="ident" id="8625815">Fatal</span><span class="op" id="8625820">(</span><span class="ident" id="8625821">err</span><span class="op" id="8625824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625831">esBytes</span>&nbsp;<span class="op" id="8625839">:=</span>&nbsp;<span class="op" id="8625842">&amp;</span><span class="ident" id="8625843">encodeState</span><span class="op" id="8625854">{</span><span class="op" id="8625855">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625858">_</span><span class="op" id="8625859">,</span>&nbsp;<span class="ident" id="8625861">err</span>&nbsp;<span class="op" id="8625865">=</span>&nbsp;<span class="ident" id="8625867">esBytes</span><span class="op" id="8625874">.</span><span class="ident" id="8625875">stringBytes</span><span class="op" id="8625886">(</span><span class="op" id="8625887">[</span><span class="op" id="8625888">]</span><span class="builtintype" id="8625889">byte</span><span class="op" id="8625893">(</span><span class="ident" id="8625894">s</span><span class="op" id="8625895">)</span><span class="op" id="8625896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625899">if</span>&nbsp;<span class="ident" id="8625902">err</span>&nbsp;<span class="op" id="8625906">!=</span>&nbsp;<span class="ident" id="8625909">nil</span>&nbsp;<span class="op" id="8625913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625917">t</span><span class="op" id="8625918">.</span><span class="ident" id="8625919">Fatal</span><span class="op" id="8625924">(</span><span class="ident" id="8625925">err</span><span class="op" id="8625928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8625931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625935">enc</span>&nbsp;<span class="op" id="8625939">:=</span>&nbsp;<span class="ident" id="8625942">es</span><span class="op" id="8625944">.</span><span class="ident" id="8625945">Buffer</span><span class="op" id="8625951">.</span><span class="ident" id="8625952">String</span><span class="op" id="8625958">(</span><span class="op" id="8625959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8625962">encBytes</span>&nbsp;<span class="op" id="8625971">:=</span>&nbsp;<span class="ident" id="8625974">esBytes</span><span class="op" id="8625981">.</span><span class="ident" id="8625982">Buffer</span><span class="op" id="8625988">.</span><span class="ident" id="8625989">String</span><span class="op" id="8625995">(</span><span class="op" id="8625996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8625999">if</span>&nbsp;<span class="ident" id="8626002">enc</span>&nbsp;<span class="op" id="8626006">!=</span>&nbsp;<span class="ident" id="8626009">encBytes</span>&nbsp;<span class="op" id="8626018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626022">i</span>&nbsp;<span class="op" id="8626024">:=</span>&nbsp;<span class="num" id="8626027">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626031">for</span>&nbsp;<span class="ident" id="8626035">i</span>&nbsp;<span class="op" id="8626037">&lt;</span>&nbsp;<span class="builtinfunc" id="8626039">len</span><span class="op" id="8626042">(</span><span class="ident" id="8626043">enc</span><span class="op" id="8626046">)</span>&nbsp;<span class="op" id="8626048">&amp;&amp;</span>&nbsp;<span class="ident" id="8626051">i</span>&nbsp;<span class="op" id="8626053">&lt;</span>&nbsp;<span class="builtinfunc" id="8626055">len</span><span class="op" id="8626058">(</span><span class="ident" id="8626059">encBytes</span><span class="op" id="8626067">)</span>&nbsp;<span class="op" id="8626069">&amp;&amp;</span>&nbsp;<span class="ident" id="8626072">enc</span><span class="op" id="8626075">[</span><span class="ident" id="8626076">i</span><span class="op" id="8626077">]</span>&nbsp;<span class="op" id="8626079">==</span>&nbsp;<span class="ident" id="8626082">encBytes</span><span class="op" id="8626090">[</span><span class="ident" id="8626091">i</span><span class="op" id="8626092">]</span>&nbsp;<span class="op" id="8626094">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626099">i</span><span class="op" id="8626100">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626109">enc</span>&nbsp;<span class="op" id="8626113">=</span>&nbsp;<span class="ident" id="8626115">enc</span><span class="op" id="8626118">[</span><span class="ident" id="8626119">i</span><span class="op" id="8626120">:</span><span class="op" id="8626121">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626125">encBytes</span>&nbsp;<span class="op" id="8626134">=</span>&nbsp;<span class="ident" id="8626136">encBytes</span><span class="op" id="8626144">[</span><span class="ident" id="8626145">i</span><span class="op" id="8626146">:</span><span class="op" id="8626147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626151">i</span>&nbsp;<span class="op" id="8626153">=</span>&nbsp;<span class="num" id="8626155">0</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626159">for</span>&nbsp;<span class="ident" id="8626163">i</span>&nbsp;<span class="op" id="8626165">&lt;</span>&nbsp;<span class="builtinfunc" id="8626167">len</span><span class="op" id="8626170">(</span><span class="ident" id="8626171">enc</span><span class="op" id="8626174">)</span>&nbsp;<span class="op" id="8626176">&amp;&amp;</span>&nbsp;<span class="ident" id="8626179">i</span>&nbsp;<span class="op" id="8626181">&lt;</span>&nbsp;<span class="builtinfunc" id="8626183">len</span><span class="op" id="8626186">(</span><span class="ident" id="8626187">encBytes</span><span class="op" id="8626195">)</span>&nbsp;<span class="op" id="8626197">&amp;&amp;</span>&nbsp;<span class="ident" id="8626200">enc</span><span class="op" id="8626203">[</span><span class="builtinfunc" id="8626204">len</span><span class="op" id="8626207">(</span><span class="ident" id="8626208">enc</span><span class="op" id="8626211">)</span><span class="op" id="8626212">-</span><span class="ident" id="8626213">i</span><span class="op" id="8626214">-</span><span class="num" id="8626215">1</span><span class="op" id="8626216">]</span>&nbsp;<span class="op" id="8626218">==</span>&nbsp;<span class="ident" id="8626221">encBytes</span><span class="op" id="8626229">[</span><span class="builtinfunc" id="8626230">len</span><span class="op" id="8626233">(</span><span class="ident" id="8626234">encBytes</span><span class="op" id="8626242">)</span><span class="op" id="8626243">-</span><span class="ident" id="8626244">i</span><span class="op" id="8626245">-</span><span class="num" id="8626246">1</span><span class="op" id="8626247">]</span>&nbsp;<span class="op" id="8626249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626254">i</span><span class="op" id="8626255">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626264">enc</span>&nbsp;<span class="op" id="8626268">=</span>&nbsp;<span class="ident" id="8626270">enc</span><span class="op" id="8626273">[</span><span class="op" id="8626274">:</span><span class="builtinfunc" id="8626275">len</span><span class="op" id="8626278">(</span><span class="ident" id="8626279">enc</span><span class="op" id="8626282">)</span><span class="op" id="8626283">-</span><span class="ident" id="8626284">i</span><span class="op" id="8626285">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626289">encBytes</span>&nbsp;<span class="op" id="8626298">=</span>&nbsp;<span class="ident" id="8626300">encBytes</span><span class="op" id="8626308">[</span><span class="op" id="8626309">:</span><span class="builtinfunc" id="8626310">len</span><span class="op" id="8626313">(</span><span class="ident" id="8626314">encBytes</span><span class="op" id="8626322">)</span><span class="op" id="8626323">-</span><span class="ident" id="8626324">i</span><span class="op" id="8626325">]</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626330">if</span>&nbsp;<span class="builtinfunc" id="8626333">len</span><span class="op" id="8626336">(</span><span class="ident" id="8626337">enc</span><span class="op" id="8626340">)</span>&nbsp;<span class="op" id="8626342">&gt;</span>&nbsp;<span class="num" id="8626344">20</span>&nbsp;<span class="op" id="8626347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626352">enc</span>&nbsp;<span class="op" id="8626356">=</span>&nbsp;<span class="ident" id="8626358">enc</span><span class="op" id="8626361">[</span><span class="op" id="8626362">:</span><span class="num" id="8626363">20</span><span class="op" id="8626365">]</span>&nbsp;<span class="op" id="8626367">+</span>&nbsp;<span class="string" id="8626369">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626381">if</span>&nbsp;<span class="builtinfunc" id="8626384">len</span><span class="op" id="8626387">(</span><span class="ident" id="8626388">encBytes</span><span class="op" id="8626396">)</span>&nbsp;<span class="op" id="8626398">&gt;</span>&nbsp;<span class="num" id="8626400">20</span>&nbsp;<span class="op" id="8626403">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626408">encBytes</span>&nbsp;<span class="op" id="8626417">=</span>&nbsp;<span class="ident" id="8626419">encBytes</span><span class="op" id="8626427">[</span><span class="op" id="8626428">:</span><span class="num" id="8626429">20</span><span class="op" id="8626431">]</span>&nbsp;<span class="op" id="8626433">+</span>&nbsp;<span class="string" id="8626435">&#34;...&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626448">t</span><span class="op" id="8626449">.</span><span class="ident" id="8626450">Errorf</span><span class="op" id="8626456">(</span><span class="string" id="8626457">&#34;encodings&nbsp;differ&nbsp;at&nbsp;%#q&nbsp;vs&nbsp;%#q&#34;</span><span class="op" id="8626489">,</span>&nbsp;<span class="ident" id="8626491">enc</span><span class="op" id="8626494">,</span>&nbsp;<span class="ident" id="8626496">encBytes</span><span class="op" id="8626504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626507">}</span><br>
<span class="lineno">420</span><span class="op" id="8626509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8626512">func</span>&nbsp;<span class="ident" id="8626517">TestIssue6458</span><span class="op" id="8626530">(</span><span class="ident" id="8626531">t</span>&nbsp;<span class="op" id="8626533">*</span><span class="ident" id="8626534">testing</span><span class="op" id="8626541">.</span><span class="ident" id="8626542">T</span><span class="op" id="8626543">)</span>&nbsp;<span class="op" id="8626545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626548">type</span>&nbsp;<span class="ident" id="8626553">Foo</span>&nbsp;<span class="keyword" id="8626557">struct</span>&nbsp;<span class="op" id="8626564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626568">M</span>&nbsp;<span class="ident" id="8626570">RawMessage</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626585">x</span>&nbsp;<span class="op" id="8626587">:=</span>&nbsp;<span class="ident" id="8626590">Foo</span><span class="op" id="8626593">{</span><span class="ident" id="8626594">RawMessage</span><span class="op" id="8626604">(</span><span class="string" id="8626605">`&#34;foo&#34;`</span><span class="op" id="8626612">)</span><span class="op" id="8626613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626617">b</span><span class="op" id="8626618">,</span>&nbsp;<span class="ident" id="8626620">err</span>&nbsp;<span class="op" id="8626624">:=</span>&nbsp;<span class="ident" id="8626627">Marshal</span><span class="op" id="8626634">(</span><span class="op" id="8626635">&amp;</span><span class="ident" id="8626636">x</span><span class="op" id="8626637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626640">if</span>&nbsp;<span class="ident" id="8626643">err</span>&nbsp;<span class="op" id="8626647">!=</span>&nbsp;<span class="ident" id="8626650">nil</span>&nbsp;<span class="op" id="8626654">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626658">t</span><span class="op" id="8626659">.</span><span class="ident" id="8626660">Fatal</span><span class="op" id="8626665">(</span><span class="ident" id="8626666">err</span><span class="op" id="8626669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626675">if</span>&nbsp;<span class="ident" id="8626678">want</span>&nbsp;<span class="op" id="8626683">:=</span>&nbsp;<span class="string" id="8626686">`{&#34;M&#34;:&#34;foo&#34;}`</span><span class="op" id="8626699">;</span>&nbsp;<span class="builtintype" id="8626701">string</span><span class="op" id="8626707">(</span><span class="ident" id="8626708">b</span><span class="op" id="8626709">)</span>&nbsp;<span class="op" id="8626711">!=</span>&nbsp;<span class="ident" id="8626714">want</span>&nbsp;<span class="op" id="8626719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626723">t</span><span class="op" id="8626724">.</span><span class="ident" id="8626725">Errorf</span><span class="op" id="8626731">(</span><span class="string" id="8626732">&#34;Marshal(&amp;x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8626761">,</span>&nbsp;<span class="ident" id="8626763">b</span><span class="op" id="8626764">,</span>&nbsp;<span class="ident" id="8626766">want</span><span class="op" id="8626770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626773">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626777">b</span><span class="op" id="8626778">,</span>&nbsp;<span class="ident" id="8626780">err</span>&nbsp;<span class="op" id="8626784">=</span>&nbsp;<span class="ident" id="8626786">Marshal</span><span class="op" id="8626793">(</span><span class="ident" id="8626794">x</span><span class="op" id="8626795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626798">if</span>&nbsp;<span class="ident" id="8626801">err</span>&nbsp;<span class="op" id="8626805">!=</span>&nbsp;<span class="ident" id="8626808">nil</span>&nbsp;<span class="op" id="8626812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626816">t</span><span class="op" id="8626817">.</span><span class="ident" id="8626818">Fatal</span><span class="op" id="8626823">(</span><span class="ident" id="8626824">err</span><span class="op" id="8626827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626830">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626834">if</span>&nbsp;<span class="ident" id="8626837">want</span>&nbsp;<span class="op" id="8626842">:=</span>&nbsp;<span class="string" id="8626845">`{&#34;M&#34;:&#34;ImZvbyI=&#34;}`</span><span class="op" id="8626863">;</span>&nbsp;<span class="builtintype" id="8626865">string</span><span class="op" id="8626871">(</span><span class="ident" id="8626872">b</span><span class="op" id="8626873">)</span>&nbsp;<span class="op" id="8626875">!=</span>&nbsp;<span class="ident" id="8626878">want</span>&nbsp;<span class="op" id="8626883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8626887">t</span><span class="op" id="8626888">.</span><span class="ident" id="8626889">Errorf</span><span class="op" id="8626895">(</span><span class="string" id="8626896">&#34;Marshal(x)&nbsp;=&nbsp;%#q;&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8626924">,</span>&nbsp;<span class="ident" id="8626926">b</span><span class="op" id="8626927">,</span>&nbsp;<span class="ident" id="8626929">want</span><span class="op" id="8626933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8626936">}</span><br>
<span class="lineno"></span><span class="op" id="8626938">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="8626941">func</span>&nbsp;<span class="ident" id="8626946">TestHTMLEscape</span><span class="op" id="8626960">(</span><span class="ident" id="8626961">t</span>&nbsp;<span class="op" id="8626963">*</span><span class="ident" id="8626964">testing</span><span class="op" id="8626971">.</span><span class="ident" id="8626972">T</span><span class="op" id="8626973">)</span>&nbsp;<span class="op" id="8626975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8626978">var</span>&nbsp;<span class="ident" id="8626982">b</span><span class="op" id="8626983">,</span>&nbsp;<span class="ident" id="8626985">want</span>&nbsp;<span class="ident" id="8626990">bytes</span><span class="op" id="8626995">.</span><span class="ident" id="8626996">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627004">m</span>&nbsp;<span class="op" id="8627006">:=</span>&nbsp;<span class="string" id="8627009">`{&#34;M&#34;:&#34;&lt;html&gt;foo&nbsp;&amp;`</span>&nbsp;<span class="op" id="8627029">+</span>&nbsp;<span class="string" id="8627031">&#34;\xe2\x80\xa8&nbsp;\xe2\x80\xa9&#34;</span>&nbsp;<span class="op" id="8627059">+</span>&nbsp;<span class="string" id="8627061">`&lt;/html&gt;&#34;}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627074">want</span><span class="op" id="8627078">.</span><span class="ident" id="8627079">Write</span><span class="op" id="8627084">(</span><span class="op" id="8627085">[</span><span class="op" id="8627086">]</span><span class="builtintype" id="8627087">byte</span><span class="op" id="8627091">(</span><span class="string" id="8627092">`{&#34;M&#34;:&#34;\u003chtml\u003efoo&nbsp;\u0026\u2028&nbsp;\u2029\u003c/html\u003e&#34;}`</span><span class="op" id="8627158">)</span><span class="op" id="8627159">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627162">HTMLEscape</span><span class="op" id="8627172">(</span><span class="op" id="8627173">&amp;</span><span class="ident" id="8627174">b</span><span class="op" id="8627175">,</span>&nbsp;<span class="op" id="8627177">[</span><span class="op" id="8627178">]</span><span class="builtintype" id="8627179">byte</span><span class="op" id="8627183">(</span><span class="ident" id="8627184">m</span><span class="op" id="8627185">)</span><span class="op" id="8627186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627189">if</span>&nbsp;<span class="op" id="8627192">!</span><span class="ident" id="8627193">bytes</span><span class="op" id="8627198">.</span><span class="ident" id="8627199">Equal</span><span class="op" id="8627204">(</span><span class="ident" id="8627205">b</span><span class="op" id="8627206">.</span><span class="ident" id="8627207">Bytes</span><span class="op" id="8627212">(</span><span class="op" id="8627213">)</span><span class="op" id="8627214">,</span>&nbsp;<span class="ident" id="8627216">want</span><span class="op" id="8627220">.</span><span class="ident" id="8627221">Bytes</span><span class="op" id="8627226">(</span><span class="op" id="8627227">)</span><span class="op" id="8627228">)</span>&nbsp;<span class="op" id="8627230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627234">t</span><span class="op" id="8627235">.</span><span class="ident" id="8627236">Errorf</span><span class="op" id="8627242">(</span><span class="string" id="8627243">&#34;HTMLEscape(&amp;b,&nbsp;[]byte(m))&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8627284">,</span>&nbsp;<span class="ident" id="8627286">b</span><span class="op" id="8627287">.</span><span class="ident" id="8627288">Bytes</span><span class="op" id="8627293">(</span><span class="op" id="8627294">)</span><span class="op" id="8627295">,</span>&nbsp;<span class="ident" id="8627297">want</span><span class="op" id="8627301">.</span><span class="ident" id="8627302">Bytes</span><span class="op" id="8627307">(</span><span class="op" id="8627308">)</span><span class="op" id="8627309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627312">}</span><br>
<span class="lineno"></span><span class="op" id="8627314">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="8627317">//&nbsp;golang.org/issue/8582</span><br>
<span class="lineno"></span><span class="keyword" id="8627342">func</span>&nbsp;<span class="ident" id="8627347">TestEncodePointerString</span><span class="op" id="8627370">(</span><span class="ident" id="8627371">t</span>&nbsp;<span class="op" id="8627373">*</span><span class="ident" id="8627374">testing</span><span class="op" id="8627381">.</span><span class="ident" id="8627382">T</span><span class="op" id="8627383">)</span>&nbsp;<span class="op" id="8627385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627388">type</span>&nbsp;<span class="ident" id="8627393">stringPointer</span>&nbsp;<span class="keyword" id="8627407">struct</span>&nbsp;<span class="op" id="8627414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627418">N</span>&nbsp;<span class="op" id="8627420">*</span><span class="ident" id="8627421">int64</span>&nbsp;<span class="string" id="8627427">`json:&#34;n,string&#34;`</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627449">var</span>&nbsp;<span class="ident" id="8627453">n</span>&nbsp;<span class="ident" id="8627455">int64</span>&nbsp;<span class="op" id="8627461">=</span>&nbsp;<span class="num" id="8627463">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627467">b</span><span class="op" id="8627468">,</span>&nbsp;<span class="ident" id="8627470">err</span>&nbsp;<span class="op" id="8627474">:=</span>&nbsp;<span class="ident" id="8627477">Marshal</span><span class="op" id="8627484">(</span><span class="ident" id="8627485">stringPointer</span><span class="op" id="8627498">{</span><span class="ident" id="8627499">N</span><span class="op" id="8627500">:</span>&nbsp;<span class="op" id="8627502">&amp;</span><span class="ident" id="8627503">n</span><span class="op" id="8627504">}</span><span class="op" id="8627505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627508">if</span>&nbsp;<span class="ident" id="8627511">err</span>&nbsp;<span class="op" id="8627515">!=</span>&nbsp;<span class="ident" id="8627518">nil</span>&nbsp;<span class="op" id="8627522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627526">t</span><span class="op" id="8627527">.</span><span class="ident" id="8627528">Fatalf</span><span class="op" id="8627534">(</span><span class="string" id="8627535">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="8627548">,</span>&nbsp;<span class="ident" id="8627550">err</span><span class="op" id="8627553">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627559">if</span>&nbsp;<span class="ident" id="8627562">got</span><span class="op" id="8627565">,</span>&nbsp;<span class="ident" id="8627567">want</span>&nbsp;<span class="op" id="8627572">:=</span>&nbsp;<span class="builtintype" id="8627575">string</span><span class="op" id="8627581">(</span><span class="ident" id="8627582">b</span><span class="op" id="8627583">)</span><span class="op" id="8627584">,</span>&nbsp;<span class="string" id="8627586">`{&#34;n&#34;:&#34;42&#34;}`</span><span class="op" id="8627598">;</span>&nbsp;<span class="ident" id="8627600">got</span>&nbsp;<span class="op" id="8627604">!=</span>&nbsp;<span class="ident" id="8627607">want</span>&nbsp;<span class="op" id="8627612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627616">t</span><span class="op" id="8627617">.</span><span class="ident" id="8627618">Errorf</span><span class="op" id="8627624">(</span><span class="string" id="8627625">&#34;Marshal&nbsp;=&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8627648">,</span>&nbsp;<span class="ident" id="8627650">got</span><span class="op" id="8627653">,</span>&nbsp;<span class="ident" id="8627655">want</span><span class="op" id="8627659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627665">var</span>&nbsp;<span class="ident" id="8627669">back</span>&nbsp;<span class="ident" id="8627674">stringPointer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627689">err</span>&nbsp;<span class="op" id="8627693">=</span>&nbsp;<span class="ident" id="8627695">Unmarshal</span><span class="op" id="8627704">(</span><span class="ident" id="8627705">b</span><span class="op" id="8627706">,</span>&nbsp;<span class="op" id="8627708">&amp;</span><span class="ident" id="8627709">back</span><span class="op" id="8627713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627716">if</span>&nbsp;<span class="ident" id="8627719">err</span>&nbsp;<span class="op" id="8627723">!=</span>&nbsp;<span class="ident" id="8627726">nil</span>&nbsp;<span class="op" id="8627730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627734">t</span><span class="op" id="8627735">.</span><span class="ident" id="8627736">Fatalf</span><span class="op" id="8627742">(</span><span class="string" id="8627743">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="8627758">,</span>&nbsp;<span class="ident" id="8627760">err</span><span class="op" id="8627763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627769">if</span>&nbsp;<span class="ident" id="8627772">back</span><span class="op" id="8627776">.</span><span class="ident" id="8627777">N</span>&nbsp;<span class="op" id="8627779">==</span>&nbsp;<span class="ident" id="8627782">nil</span>&nbsp;<span class="op" id="8627786">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627790">t</span><span class="op" id="8627791">.</span><span class="ident" id="8627792">Fatalf</span><span class="op" id="8627798">(</span><span class="string" id="8627799">&#34;Unmarshalled&nbsp;nil&nbsp;N&nbsp;field&#34;</span><span class="op" id="8627825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8627831">if</span>&nbsp;<span class="op" id="8627834">*</span><span class="ident" id="8627835">back</span><span class="op" id="8627839">.</span><span class="ident" id="8627840">N</span>&nbsp;<span class="op" id="8627842">!=</span>&nbsp;<span class="num" id="8627845">42</span>&nbsp;<span class="op" id="8627848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627852">t</span><span class="op" id="8627853">.</span><span class="ident" id="8627854">Fatalf</span><span class="op" id="8627860">(</span><span class="string" id="8627861">&#34;*N&nbsp;=&nbsp;%d;&nbsp;want&nbsp;42&#34;</span><span class="op" id="8627879">,</span>&nbsp;<span class="op" id="8627881">*</span><span class="ident" id="8627882">back</span><span class="op" id="8627886">.</span><span class="ident" id="8627887">N</span><span class="op" id="8627888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627891">}</span><br>
<span class="lineno">480</span><span class="op" id="8627893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8627896">var</span>&nbsp;<span class="ident" id="8627900">encodeStringTests</span>&nbsp;<span class="op" id="8627918">=</span>&nbsp;<span class="op" id="8627920">[</span><span class="op" id="8627921">]</span><span class="keyword" id="8627922">struct</span>&nbsp;<span class="op" id="8627929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627932">in</span>&nbsp;&nbsp;<span class="builtintype" id="8627936">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8627944">out</span>&nbsp;<span class="builtintype" id="8627948">string</span><br>
<span class="lineno">485</span><span class="op" id="8627955">}</span><span class="op" id="8627956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627959">{</span><span class="string" id="8627960">&#34;\x00&#34;</span><span class="op" id="8627966">,</span>&nbsp;<span class="string" id="8627968">`&#34;\u0000&#34;`</span><span class="op" id="8627978">}</span><span class="op" id="8627979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8627982">{</span><span class="string" id="8627983">&#34;\x01&#34;</span><span class="op" id="8627989">,</span>&nbsp;<span class="string" id="8627991">`&#34;\u0001&#34;`</span><span class="op" id="8628001">}</span><span class="op" id="8628002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628005">{</span><span class="string" id="8628006">&#34;\x02&#34;</span><span class="op" id="8628012">,</span>&nbsp;<span class="string" id="8628014">`&#34;\u0002&#34;`</span><span class="op" id="8628024">}</span><span class="op" id="8628025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628028">{</span><span class="string" id="8628029">&#34;\x03&#34;</span><span class="op" id="8628035">,</span>&nbsp;<span class="string" id="8628037">`&#34;\u0003&#34;`</span><span class="op" id="8628047">}</span><span class="op" id="8628048">,</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628051">{</span><span class="string" id="8628052">&#34;\x04&#34;</span><span class="op" id="8628058">,</span>&nbsp;<span class="string" id="8628060">`&#34;\u0004&#34;`</span><span class="op" id="8628070">}</span><span class="op" id="8628071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628074">{</span><span class="string" id="8628075">&#34;\x05&#34;</span><span class="op" id="8628081">,</span>&nbsp;<span class="string" id="8628083">`&#34;\u0005&#34;`</span><span class="op" id="8628093">}</span><span class="op" id="8628094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628097">{</span><span class="string" id="8628098">&#34;\x06&#34;</span><span class="op" id="8628104">,</span>&nbsp;<span class="string" id="8628106">`&#34;\u0006&#34;`</span><span class="op" id="8628116">}</span><span class="op" id="8628117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628120">{</span><span class="string" id="8628121">&#34;\x07&#34;</span><span class="op" id="8628127">,</span>&nbsp;<span class="string" id="8628129">`&#34;\u0007&#34;`</span><span class="op" id="8628139">}</span><span class="op" id="8628140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628143">{</span><span class="string" id="8628144">&#34;\x08&#34;</span><span class="op" id="8628150">,</span>&nbsp;<span class="string" id="8628152">`&#34;\u0008&#34;`</span><span class="op" id="8628162">}</span><span class="op" id="8628163">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628166">{</span><span class="string" id="8628167">&#34;\x09&#34;</span><span class="op" id="8628173">,</span>&nbsp;<span class="string" id="8628175">`&#34;\t&#34;`</span><span class="op" id="8628181">}</span><span class="op" id="8628182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628185">{</span><span class="string" id="8628186">&#34;\x0a&#34;</span><span class="op" id="8628192">,</span>&nbsp;<span class="string" id="8628194">`&#34;\n&#34;`</span><span class="op" id="8628200">}</span><span class="op" id="8628201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628204">{</span><span class="string" id="8628205">&#34;\x0b&#34;</span><span class="op" id="8628211">,</span>&nbsp;<span class="string" id="8628213">`&#34;\u000b&#34;`</span><span class="op" id="8628223">}</span><span class="op" id="8628224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628227">{</span><span class="string" id="8628228">&#34;\x0c&#34;</span><span class="op" id="8628234">,</span>&nbsp;<span class="string" id="8628236">`&#34;\u000c&#34;`</span><span class="op" id="8628246">}</span><span class="op" id="8628247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628250">{</span><span class="string" id="8628251">&#34;\x0d&#34;</span><span class="op" id="8628257">,</span>&nbsp;<span class="string" id="8628259">`&#34;\r&#34;`</span><span class="op" id="8628265">}</span><span class="op" id="8628266">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628269">{</span><span class="string" id="8628270">&#34;\x0e&#34;</span><span class="op" id="8628276">,</span>&nbsp;<span class="string" id="8628278">`&#34;\u000e&#34;`</span><span class="op" id="8628288">}</span><span class="op" id="8628289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628292">{</span><span class="string" id="8628293">&#34;\x0f&#34;</span><span class="op" id="8628299">,</span>&nbsp;<span class="string" id="8628301">`&#34;\u000f&#34;`</span><span class="op" id="8628311">}</span><span class="op" id="8628312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628315">{</span><span class="string" id="8628316">&#34;\x10&#34;</span><span class="op" id="8628322">,</span>&nbsp;<span class="string" id="8628324">`&#34;\u0010&#34;`</span><span class="op" id="8628334">}</span><span class="op" id="8628335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628338">{</span><span class="string" id="8628339">&#34;\x11&#34;</span><span class="op" id="8628345">,</span>&nbsp;<span class="string" id="8628347">`&#34;\u0011&#34;`</span><span class="op" id="8628357">}</span><span class="op" id="8628358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628361">{</span><span class="string" id="8628362">&#34;\x12&#34;</span><span class="op" id="8628368">,</span>&nbsp;<span class="string" id="8628370">`&#34;\u0012&#34;`</span><span class="op" id="8628380">}</span><span class="op" id="8628381">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628384">{</span><span class="string" id="8628385">&#34;\x13&#34;</span><span class="op" id="8628391">,</span>&nbsp;<span class="string" id="8628393">`&#34;\u0013&#34;`</span><span class="op" id="8628403">}</span><span class="op" id="8628404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628407">{</span><span class="string" id="8628408">&#34;\x14&#34;</span><span class="op" id="8628414">,</span>&nbsp;<span class="string" id="8628416">`&#34;\u0014&#34;`</span><span class="op" id="8628426">}</span><span class="op" id="8628427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628430">{</span><span class="string" id="8628431">&#34;\x15&#34;</span><span class="op" id="8628437">,</span>&nbsp;<span class="string" id="8628439">`&#34;\u0015&#34;`</span><span class="op" id="8628449">}</span><span class="op" id="8628450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628453">{</span><span class="string" id="8628454">&#34;\x16&#34;</span><span class="op" id="8628460">,</span>&nbsp;<span class="string" id="8628462">`&#34;\u0016&#34;`</span><span class="op" id="8628472">}</span><span class="op" id="8628473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628476">{</span><span class="string" id="8628477">&#34;\x17&#34;</span><span class="op" id="8628483">,</span>&nbsp;<span class="string" id="8628485">`&#34;\u0017&#34;`</span><span class="op" id="8628495">}</span><span class="op" id="8628496">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628499">{</span><span class="string" id="8628500">&#34;\x18&#34;</span><span class="op" id="8628506">,</span>&nbsp;<span class="string" id="8628508">`&#34;\u0018&#34;`</span><span class="op" id="8628518">}</span><span class="op" id="8628519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628522">{</span><span class="string" id="8628523">&#34;\x19&#34;</span><span class="op" id="8628529">,</span>&nbsp;<span class="string" id="8628531">`&#34;\u0019&#34;`</span><span class="op" id="8628541">}</span><span class="op" id="8628542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628545">{</span><span class="string" id="8628546">&#34;\x1a&#34;</span><span class="op" id="8628552">,</span>&nbsp;<span class="string" id="8628554">`&#34;\u001a&#34;`</span><span class="op" id="8628564">}</span><span class="op" id="8628565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628568">{</span><span class="string" id="8628569">&#34;\x1b&#34;</span><span class="op" id="8628575">,</span>&nbsp;<span class="string" id="8628577">`&#34;\u001b&#34;`</span><span class="op" id="8628587">}</span><span class="op" id="8628588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628591">{</span><span class="string" id="8628592">&#34;\x1c&#34;</span><span class="op" id="8628598">,</span>&nbsp;<span class="string" id="8628600">`&#34;\u001c&#34;`</span><span class="op" id="8628610">}</span><span class="op" id="8628611">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628614">{</span><span class="string" id="8628615">&#34;\x1d&#34;</span><span class="op" id="8628621">,</span>&nbsp;<span class="string" id="8628623">`&#34;\u001d&#34;`</span><span class="op" id="8628633">}</span><span class="op" id="8628634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628637">{</span><span class="string" id="8628638">&#34;\x1e&#34;</span><span class="op" id="8628644">,</span>&nbsp;<span class="string" id="8628646">`&#34;\u001e&#34;`</span><span class="op" id="8628656">}</span><span class="op" id="8628657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628660">{</span><span class="string" id="8628661">&#34;\x1f&#34;</span><span class="op" id="8628667">,</span>&nbsp;<span class="string" id="8628669">`&#34;\u001f&#34;`</span><span class="op" id="8628679">}</span><span class="op" id="8628680">,</span><br>
<span class="lineno"></span><span class="op" id="8628682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">520</span><span class="keyword" id="8628685">func</span>&nbsp;<span class="ident" id="8628690">TestEncodeString</span><span class="op" id="8628706">(</span><span class="ident" id="8628707">t</span>&nbsp;<span class="op" id="8628709">*</span><span class="ident" id="8628710">testing</span><span class="op" id="8628717">.</span><span class="ident" id="8628718">T</span><span class="op" id="8628719">)</span>&nbsp;<span class="op" id="8628721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8628724">for</span>&nbsp;<span class="ident" id="8628728">_</span><span class="op" id="8628729">,</span>&nbsp;<span class="ident" id="8628731">tt</span>&nbsp;<span class="op" id="8628734">:=</span>&nbsp;<span class="keyword" id="8628737">range</span>&nbsp;<span class="ident" id="8628743">encodeStringTests</span>&nbsp;<span class="op" id="8628761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628765">b</span><span class="op" id="8628766">,</span>&nbsp;<span class="ident" id="8628768">err</span>&nbsp;<span class="op" id="8628772">:=</span>&nbsp;<span class="ident" id="8628775">Marshal</span><span class="op" id="8628782">(</span><span class="ident" id="8628783">tt</span><span class="op" id="8628785">.</span><span class="ident" id="8628786">in</span><span class="op" id="8628788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8628792">if</span>&nbsp;<span class="ident" id="8628795">err</span>&nbsp;<span class="op" id="8628799">!=</span>&nbsp;<span class="ident" id="8628802">nil</span>&nbsp;<span class="op" id="8628806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628811">t</span><span class="op" id="8628812">.</span><span class="ident" id="8628813">Errorf</span><span class="op" id="8628819">(</span><span class="string" id="8628820">&#34;Marshal(%q):&nbsp;%v&#34;</span><span class="op" id="8628837">,</span>&nbsp;<span class="ident" id="8628839">tt</span><span class="op" id="8628841">.</span><span class="ident" id="8628842">in</span><span class="op" id="8628844">,</span>&nbsp;<span class="ident" id="8628846">err</span><span class="op" id="8628849">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8628854">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628869">out</span>&nbsp;<span class="op" id="8628873">:=</span>&nbsp;<span class="builtintype" id="8628876">string</span><span class="op" id="8628882">(</span><span class="ident" id="8628883">b</span><span class="op" id="8628884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8628888">if</span>&nbsp;<span class="ident" id="8628891">out</span>&nbsp;<span class="op" id="8628895">!=</span>&nbsp;<span class="ident" id="8628898">tt</span><span class="op" id="8628900">.</span><span class="ident" id="8628901">out</span>&nbsp;<span class="op" id="8628905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8628910">t</span><span class="op" id="8628911">.</span><span class="ident" id="8628912">Errorf</span><span class="op" id="8628918">(</span><span class="string" id="8628919">&#34;Marshal(%q)&nbsp;=&nbsp;%#q,&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="8628948">,</span>&nbsp;<span class="ident" id="8628950">tt</span><span class="op" id="8628952">.</span><span class="ident" id="8628953">in</span><span class="op" id="8628955">,</span>&nbsp;<span class="ident" id="8628957">out</span><span class="op" id="8628960">,</span>&nbsp;<span class="ident" id="8628962">tt</span><span class="op" id="8628964">.</span><span class="ident" id="8628965">out</span><span class="op" id="8628968">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8628975">}</span><br>
<span class="lineno"></span><span class="op" id="8628977">}</span>
</div>
</body>
</html>
