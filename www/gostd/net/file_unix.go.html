<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4060856">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4060911">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4060965">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4061016">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4061081">package</span>&nbsp;<span class="ident" id="4061089">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4061094">import</span>&nbsp;<span class="op" id="4061101">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4061104">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4061110">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="4061120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4061123">func</span>&nbsp;<span class="ident" id="4061128">newFileFD</span><span class="op" id="4061137">(</span><span class="ident" id="4061138">f</span>&nbsp;<span class="op" id="4061140">*</span><span class="ident" id="4061141">os</span><span class="op" id="4061143">.</span><span class="ident" id="4061144">File</span><span class="op" id="4061148">)</span>&nbsp;<span class="op" id="4061150">(</span><span class="op" id="4061151">*</span><span class="ident" id="4061152">netFD</span><span class="op" id="4061157">,</span>&nbsp;<span class="builtintype" id="4061159">error</span><span class="op" id="4061164">)</span>&nbsp;<span class="op" id="4061166">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061169">fd</span><span class="op" id="4061171">,</span>&nbsp;<span class="ident" id="4061173">err</span>&nbsp;<span class="op" id="4061177">:=</span>&nbsp;<span class="ident" id="4061180">dupCloseOnExec</span><span class="op" id="4061194">(</span><span class="builtintype" id="4061195">int</span><span class="op" id="4061198">(</span><span class="ident" id="4061199">f</span><span class="op" id="4061200">.</span><span class="ident" id="4061201">Fd</span><span class="op" id="4061203">(</span><span class="op" id="4061204">)</span><span class="op" id="4061205">)</span><span class="op" id="4061206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061209">if</span>&nbsp;<span class="ident" id="4061212">err</span>&nbsp;<span class="op" id="4061216">!=</span>&nbsp;<span class="ident" id="4061219">nil</span>&nbsp;<span class="op" id="4061223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061227">return</span>&nbsp;<span class="ident" id="4061234">nil</span><span class="op" id="4061237">,</span>&nbsp;<span class="ident" id="4061239">os</span><span class="op" id="4061241">.</span><span class="ident" id="4061242">NewSyscallError</span><span class="op" id="4061257">(</span><span class="string" id="4061258">&#34;dup&#34;</span><span class="op" id="4061263">,</span>&nbsp;<span class="ident" id="4061265">err</span><span class="op" id="4061268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061275">if</span>&nbsp;<span class="ident" id="4061278">err</span>&nbsp;<span class="op" id="4061282">=</span>&nbsp;<span class="ident" id="4061284">syscall</span><span class="op" id="4061291">.</span><span class="ident" id="4061292">SetNonblock</span><span class="op" id="4061303">(</span><span class="ident" id="4061304">fd</span><span class="op" id="4061306">,</span>&nbsp;<span class="builtintype" id="4061308">true</span><span class="op" id="4061312">)</span><span class="op" id="4061313">;</span>&nbsp;<span class="ident" id="4061315">err</span>&nbsp;<span class="op" id="4061319">!=</span>&nbsp;<span class="ident" id="4061322">nil</span>&nbsp;<span class="op" id="4061326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061330">closesocket</span><span class="op" id="4061341">(</span><span class="ident" id="4061342">fd</span><span class="op" id="4061344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061348">return</span>&nbsp;<span class="ident" id="4061355">nil</span><span class="op" id="4061358">,</span>&nbsp;<span class="ident" id="4061360">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061369">sotype</span><span class="op" id="4061375">,</span>&nbsp;<span class="ident" id="4061377">err</span>&nbsp;<span class="op" id="4061381">:=</span>&nbsp;<span class="ident" id="4061384">syscall</span><span class="op" id="4061391">.</span><span class="ident" id="4061392">GetsockoptInt</span><span class="op" id="4061405">(</span><span class="ident" id="4061406">fd</span><span class="op" id="4061408">,</span>&nbsp;<span class="ident" id="4061410">syscall</span><span class="op" id="4061417">.</span><span class="ident" id="4061418">SOL_SOCKET</span><span class="op" id="4061428">,</span>&nbsp;<span class="ident" id="4061430">syscall</span><span class="op" id="4061437">.</span><span class="ident" id="4061438">SO_TYPE</span><span class="op" id="4061445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061448">if</span>&nbsp;<span class="ident" id="4061451">err</span>&nbsp;<span class="op" id="4061455">!=</span>&nbsp;<span class="ident" id="4061458">nil</span>&nbsp;<span class="op" id="4061462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061466">closesocket</span><span class="op" id="4061477">(</span><span class="ident" id="4061478">fd</span><span class="op" id="4061480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061484">return</span>&nbsp;<span class="ident" id="4061491">nil</span><span class="op" id="4061494">,</span>&nbsp;<span class="ident" id="4061496">os</span><span class="op" id="4061498">.</span><span class="ident" id="4061499">NewSyscallError</span><span class="op" id="4061514">(</span><span class="string" id="4061515">&#34;getsockopt&#34;</span><span class="op" id="4061527">,</span>&nbsp;<span class="ident" id="4061529">err</span><span class="op" id="4061532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061535">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061539">family</span>&nbsp;<span class="op" id="4061546">:=</span>&nbsp;<span class="ident" id="4061549">syscall</span><span class="op" id="4061556">.</span><span class="ident" id="4061557">AF_UNSPEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061568">toAddr</span>&nbsp;<span class="op" id="4061575">:=</span>&nbsp;<span class="ident" id="4061578">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061593">lsa</span><span class="op" id="4061596">,</span>&nbsp;<span class="ident" id="4061598">_</span>&nbsp;<span class="op" id="4061600">:=</span>&nbsp;<span class="ident" id="4061603">syscall</span><span class="op" id="4061610">.</span><span class="ident" id="4061611">Getsockname</span><span class="op" id="4061622">(</span><span class="ident" id="4061623">fd</span><span class="op" id="4061625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061628">switch</span>&nbsp;<span class="ident" id="4061635">lsa</span><span class="op" id="4061638">.</span><span class="op" id="4061639">(</span><span class="keyword" id="4061640">type</span><span class="op" id="4061644">)</span>&nbsp;<span class="op" id="4061646">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061649">default</span><span class="op" id="4061656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061660">closesocket</span><span class="op" id="4061671">(</span><span class="ident" id="4061672">fd</span><span class="op" id="4061674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061678">return</span>&nbsp;<span class="ident" id="4061685">nil</span><span class="op" id="4061688">,</span>&nbsp;<span class="ident" id="4061690">syscall</span><span class="op" id="4061697">.</span><span class="ident" id="4061698">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061706">case</span>&nbsp;<span class="op" id="4061711">*</span><span class="ident" id="4061712">syscall</span><span class="op" id="4061719">.</span><span class="ident" id="4061720">SockaddrInet4</span><span class="op" id="4061733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061737">family</span>&nbsp;<span class="op" id="4061744">=</span>&nbsp;<span class="ident" id="4061746">syscall</span><span class="op" id="4061753">.</span><span class="ident" id="4061754">AF_INET</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061764">if</span>&nbsp;<span class="ident" id="4061767">sotype</span>&nbsp;<span class="op" id="4061774">==</span>&nbsp;<span class="ident" id="4061777">syscall</span><span class="op" id="4061784">.</span><span class="ident" id="4061785">SOCK_DGRAM</span>&nbsp;<span class="op" id="4061796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061801">toAddr</span>&nbsp;<span class="op" id="4061808">=</span>&nbsp;<span class="ident" id="4061810">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061826">}</span>&nbsp;<span class="keyword" id="4061828">else</span>&nbsp;<span class="keyword" id="4061833">if</span>&nbsp;<span class="ident" id="4061836">sotype</span>&nbsp;<span class="op" id="4061843">==</span>&nbsp;<span class="ident" id="4061846">syscall</span><span class="op" id="4061853">.</span><span class="ident" id="4061854">SOCK_RAW</span>&nbsp;<span class="op" id="4061863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061868">toAddr</span>&nbsp;<span class="op" id="4061875">=</span>&nbsp;<span class="ident" id="4061877">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4061892">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061895">case</span>&nbsp;<span class="op" id="4061900">*</span><span class="ident" id="4061901">syscall</span><span class="op" id="4061908">.</span><span class="ident" id="4061909">SockaddrInet6</span><span class="op" id="4061922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061926">family</span>&nbsp;<span class="op" id="4061933">=</span>&nbsp;<span class="ident" id="4061935">syscall</span><span class="op" id="4061942">.</span><span class="ident" id="4061943">AF_INET6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4061954">if</span>&nbsp;<span class="ident" id="4061957">sotype</span>&nbsp;<span class="op" id="4061964">==</span>&nbsp;<span class="ident" id="4061967">syscall</span><span class="op" id="4061974">.</span><span class="ident" id="4061975">SOCK_DGRAM</span>&nbsp;<span class="op" id="4061986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4061991">toAddr</span>&nbsp;<span class="op" id="4061998">=</span>&nbsp;<span class="ident" id="4062000">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062016">}</span>&nbsp;<span class="keyword" id="4062018">else</span>&nbsp;<span class="keyword" id="4062023">if</span>&nbsp;<span class="ident" id="4062026">sotype</span>&nbsp;<span class="op" id="4062033">==</span>&nbsp;<span class="ident" id="4062036">syscall</span><span class="op" id="4062043">.</span><span class="ident" id="4062044">SOCK_RAW</span>&nbsp;<span class="op" id="4062053">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062058">toAddr</span>&nbsp;<span class="op" id="4062065">=</span>&nbsp;<span class="ident" id="4062067">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062085">case</span>&nbsp;<span class="op" id="4062090">*</span><span class="ident" id="4062091">syscall</span><span class="op" id="4062098">.</span><span class="ident" id="4062099">SockaddrUnix</span><span class="op" id="4062111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062115">family</span>&nbsp;<span class="op" id="4062122">=</span>&nbsp;<span class="ident" id="4062124">syscall</span><span class="op" id="4062131">.</span><span class="ident" id="4062132">AF_UNIX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062142">toAddr</span>&nbsp;<span class="op" id="4062149">=</span>&nbsp;<span class="ident" id="4062151">sockaddrToUnix</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062168">if</span>&nbsp;<span class="ident" id="4062171">sotype</span>&nbsp;<span class="op" id="4062178">==</span>&nbsp;<span class="ident" id="4062181">syscall</span><span class="op" id="4062188">.</span><span class="ident" id="4062189">SOCK_DGRAM</span>&nbsp;<span class="op" id="4062200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062205">toAddr</span>&nbsp;<span class="op" id="4062212">=</span>&nbsp;<span class="ident" id="4062214">sockaddrToUnixgram</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062235">}</span>&nbsp;<span class="keyword" id="4062237">else</span>&nbsp;<span class="keyword" id="4062242">if</span>&nbsp;<span class="ident" id="4062245">sotype</span>&nbsp;<span class="op" id="4062252">==</span>&nbsp;<span class="ident" id="4062255">syscall</span><span class="op" id="4062262">.</span><span class="ident" id="4062263">SOCK_SEQPACKET</span>&nbsp;<span class="op" id="4062278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062283">toAddr</span>&nbsp;<span class="op" id="4062290">=</span>&nbsp;<span class="ident" id="4062292">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062315">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062321">laddr</span>&nbsp;<span class="op" id="4062327">:=</span>&nbsp;<span class="ident" id="4062330">toAddr</span><span class="op" id="4062336">(</span><span class="ident" id="4062337">lsa</span><span class="op" id="4062340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062343">rsa</span><span class="op" id="4062346">,</span>&nbsp;<span class="ident" id="4062348">_</span>&nbsp;<span class="op" id="4062350">:=</span>&nbsp;<span class="ident" id="4062353">syscall</span><span class="op" id="4062360">.</span><span class="ident" id="4062361">Getpeername</span><span class="op" id="4062372">(</span><span class="ident" id="4062373">fd</span><span class="op" id="4062375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062378">raddr</span>&nbsp;<span class="op" id="4062384">:=</span>&nbsp;<span class="ident" id="4062387">toAddr</span><span class="op" id="4062393">(</span><span class="ident" id="4062394">rsa</span><span class="op" id="4062397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062401">netfd</span><span class="op" id="4062406">,</span>&nbsp;<span class="ident" id="4062408">err</span>&nbsp;<span class="op" id="4062412">:=</span>&nbsp;<span class="ident" id="4062415">newFD</span><span class="op" id="4062420">(</span><span class="ident" id="4062421">fd</span><span class="op" id="4062423">,</span>&nbsp;<span class="ident" id="4062425">family</span><span class="op" id="4062431">,</span>&nbsp;<span class="ident" id="4062433">sotype</span><span class="op" id="4062439">,</span>&nbsp;<span class="ident" id="4062441">laddr</span><span class="op" id="4062446">.</span><span class="ident" id="4062447">Network</span><span class="op" id="4062454">(</span><span class="op" id="4062455">)</span><span class="op" id="4062456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062459">if</span>&nbsp;<span class="ident" id="4062462">err</span>&nbsp;<span class="op" id="4062466">!=</span>&nbsp;<span class="ident" id="4062469">nil</span>&nbsp;<span class="op" id="4062473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062477">closesocket</span><span class="op" id="4062488">(</span><span class="ident" id="4062489">fd</span><span class="op" id="4062491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062495">return</span>&nbsp;<span class="ident" id="4062502">nil</span><span class="op" id="4062505">,</span>&nbsp;<span class="ident" id="4062507">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062512">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062515">if</span>&nbsp;<span class="ident" id="4062518">err</span>&nbsp;<span class="op" id="4062522">:=</span>&nbsp;<span class="ident" id="4062525">netfd</span><span class="op" id="4062530">.</span><span class="ident" id="4062531">init</span><span class="op" id="4062535">(</span><span class="op" id="4062536">)</span><span class="op" id="4062537">;</span>&nbsp;<span class="ident" id="4062539">err</span>&nbsp;<span class="op" id="4062543">!=</span>&nbsp;<span class="ident" id="4062546">nil</span>&nbsp;<span class="op" id="4062550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062554">netfd</span><span class="op" id="4062559">.</span><span class="ident" id="4062560">Close</span><span class="op" id="4062565">(</span><span class="op" id="4062566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062570">return</span>&nbsp;<span class="ident" id="4062577">nil</span><span class="op" id="4062580">,</span>&nbsp;<span class="ident" id="4062582">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062590">netfd</span><span class="op" id="4062595">.</span><span class="ident" id="4062596">setAddr</span><span class="op" id="4062603">(</span><span class="ident" id="4062604">laddr</span><span class="op" id="4062609">,</span>&nbsp;<span class="ident" id="4062611">raddr</span><span class="op" id="4062616">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062619">return</span>&nbsp;<span class="ident" id="4062626">netfd</span><span class="op" id="4062631">,</span>&nbsp;<span class="ident" id="4062633">nil</span><br>
<span class="lineno"></span><span class="op" id="4062637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4062640">//&nbsp;FileConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;connection&nbsp;corresponding&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4062710">//&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when</span><br>
<span class="lineno">80</span><span class="comment" id="4062781">//&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4062847">//&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4062860">func</span>&nbsp;<span class="ident" id="4062865">FileConn</span><span class="op" id="4062873">(</span><span class="ident" id="4062874">f</span>&nbsp;<span class="op" id="4062876">*</span><span class="ident" id="4062877">os</span><span class="op" id="4062879">.</span><span class="ident" id="4062880">File</span><span class="op" id="4062884">)</span>&nbsp;<span class="op" id="4062886">(</span><span class="ident" id="4062887">c</span>&nbsp;<span class="ident" id="4062889">Conn</span><span class="op" id="4062893">,</span>&nbsp;<span class="ident" id="4062895">err</span>&nbsp;<span class="builtintype" id="4062899">error</span><span class="op" id="4062904">)</span>&nbsp;<span class="op" id="4062906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4062909">fd</span><span class="op" id="4062911">,</span>&nbsp;<span class="ident" id="4062913">err</span>&nbsp;<span class="op" id="4062917">:=</span>&nbsp;<span class="ident" id="4062920">newFileFD</span><span class="op" id="4062929">(</span><span class="ident" id="4062930">f</span><span class="op" id="4062931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062934">if</span>&nbsp;<span class="ident" id="4062937">err</span>&nbsp;<span class="op" id="4062941">!=</span>&nbsp;<span class="ident" id="4062944">nil</span>&nbsp;<span class="op" id="4062948">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062952">return</span>&nbsp;<span class="ident" id="4062959">nil</span><span class="op" id="4062962">,</span>&nbsp;<span class="ident" id="4062964">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4062969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062972">switch</span>&nbsp;<span class="ident" id="4062979">fd</span><span class="op" id="4062981">.</span><span class="ident" id="4062982">laddr</span><span class="op" id="4062987">.</span><span class="op" id="4062988">(</span><span class="keyword" id="4062989">type</span><span class="op" id="4062993">)</span>&nbsp;<span class="op" id="4062995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4062998">case</span>&nbsp;<span class="op" id="4063003">*</span><span class="ident" id="4063004">TCPAddr</span><span class="op" id="4063011">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063015">return</span>&nbsp;<span class="ident" id="4063022">newTCPConn</span><span class="op" id="4063032">(</span><span class="ident" id="4063033">fd</span><span class="op" id="4063035">)</span><span class="op" id="4063036">,</span>&nbsp;<span class="ident" id="4063038">nil</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063043">case</span>&nbsp;<span class="op" id="4063048">*</span><span class="ident" id="4063049">UDPAddr</span><span class="op" id="4063056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063060">return</span>&nbsp;<span class="ident" id="4063067">newUDPConn</span><span class="op" id="4063077">(</span><span class="ident" id="4063078">fd</span><span class="op" id="4063080">)</span><span class="op" id="4063081">,</span>&nbsp;<span class="ident" id="4063083">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063088">case</span>&nbsp;<span class="op" id="4063093">*</span><span class="ident" id="4063094">IPAddr</span><span class="op" id="4063100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063104">return</span>&nbsp;<span class="ident" id="4063111">newIPConn</span><span class="op" id="4063120">(</span><span class="ident" id="4063121">fd</span><span class="op" id="4063123">)</span><span class="op" id="4063124">,</span>&nbsp;<span class="ident" id="4063126">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063131">case</span>&nbsp;<span class="op" id="4063136">*</span><span class="ident" id="4063137">UnixAddr</span><span class="op" id="4063145">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063149">return</span>&nbsp;<span class="ident" id="4063156">newUnixConn</span><span class="op" id="4063167">(</span><span class="ident" id="4063168">fd</span><span class="op" id="4063170">)</span><span class="op" id="4063171">,</span>&nbsp;<span class="ident" id="4063173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063181">fd</span><span class="op" id="4063183">.</span><span class="ident" id="4063184">Close</span><span class="op" id="4063189">(</span><span class="op" id="4063190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063193">return</span>&nbsp;<span class="ident" id="4063200">nil</span><span class="op" id="4063203">,</span>&nbsp;<span class="ident" id="4063205">syscall</span><span class="op" id="4063212">.</span><span class="ident" id="4063213">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="4063220">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4063223">//&nbsp;FileListener&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;listener&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4063292">//&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;l</span><br>
<span class="lineno"></span><span class="comment" id="4063361">//&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4063432">//&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">105</span><span class="keyword" id="4063445">func</span>&nbsp;<span class="ident" id="4063450">FileListener</span><span class="op" id="4063462">(</span><span class="ident" id="4063463">f</span>&nbsp;<span class="op" id="4063465">*</span><span class="ident" id="4063466">os</span><span class="op" id="4063468">.</span><span class="ident" id="4063469">File</span><span class="op" id="4063473">)</span>&nbsp;<span class="op" id="4063475">(</span><span class="ident" id="4063476">l</span>&nbsp;<span class="ident" id="4063478">Listener</span><span class="op" id="4063486">,</span>&nbsp;<span class="ident" id="4063488">err</span>&nbsp;<span class="builtintype" id="4063492">error</span><span class="op" id="4063497">)</span>&nbsp;<span class="op" id="4063499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063502">fd</span><span class="op" id="4063504">,</span>&nbsp;<span class="ident" id="4063506">err</span>&nbsp;<span class="op" id="4063510">:=</span>&nbsp;<span class="ident" id="4063513">newFileFD</span><span class="op" id="4063522">(</span><span class="ident" id="4063523">f</span><span class="op" id="4063524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063527">if</span>&nbsp;<span class="ident" id="4063530">err</span>&nbsp;<span class="op" id="4063534">!=</span>&nbsp;<span class="ident" id="4063537">nil</span>&nbsp;<span class="op" id="4063541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063545">return</span>&nbsp;<span class="ident" id="4063552">nil</span><span class="op" id="4063555">,</span>&nbsp;<span class="ident" id="4063557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063562">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063565">switch</span>&nbsp;<span class="ident" id="4063572">laddr</span>&nbsp;<span class="op" id="4063578">:=</span>&nbsp;<span class="ident" id="4063581">fd</span><span class="op" id="4063583">.</span><span class="ident" id="4063584">laddr</span><span class="op" id="4063589">.</span><span class="op" id="4063590">(</span><span class="keyword" id="4063591">type</span><span class="op" id="4063595">)</span>&nbsp;<span class="op" id="4063597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063600">case</span>&nbsp;<span class="op" id="4063605">*</span><span class="ident" id="4063606">TCPAddr</span><span class="op" id="4063613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063617">return</span>&nbsp;<span class="op" id="4063624">&amp;</span><span class="ident" id="4063625">TCPListener</span><span class="op" id="4063636">{</span><span class="ident" id="4063637">fd</span><span class="op" id="4063639">}</span><span class="op" id="4063640">,</span>&nbsp;<span class="ident" id="4063642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063647">case</span>&nbsp;<span class="op" id="4063652">*</span><span class="ident" id="4063653">UnixAddr</span><span class="op" id="4063661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063665">return</span>&nbsp;<span class="op" id="4063672">&amp;</span><span class="ident" id="4063673">UnixListener</span><span class="op" id="4063685">{</span><span class="ident" id="4063686">fd</span><span class="op" id="4063688">,</span>&nbsp;<span class="ident" id="4063690">laddr</span><span class="op" id="4063695">.</span><span class="ident" id="4063696">Name</span><span class="op" id="4063700">}</span><span class="op" id="4063701">,</span>&nbsp;<span class="ident" id="4063703">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4063708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4063711">fd</span><span class="op" id="4063713">.</span><span class="ident" id="4063714">Close</span><span class="op" id="4063719">(</span><span class="op" id="4063720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4063723">return</span>&nbsp;<span class="ident" id="4063730">nil</span><span class="op" id="4063733">,</span>&nbsp;<span class="ident" id="4063735">syscall</span><span class="op" id="4063742">.</span><span class="ident" id="4063743">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="4063750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="4063753">//&nbsp;FilePacketConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;packet&nbsp;network&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4063819">//&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4063876">//&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect</span><br>
<span class="lineno"></span><span class="comment" id="4063947">//&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4063986">func</span>&nbsp;<span class="ident" id="4063991">FilePacketConn</span><span class="op" id="4064005">(</span><span class="ident" id="4064006">f</span>&nbsp;<span class="op" id="4064008">*</span><span class="ident" id="4064009">os</span><span class="op" id="4064011">.</span><span class="ident" id="4064012">File</span><span class="op" id="4064016">)</span>&nbsp;<span class="op" id="4064018">(</span><span class="ident" id="4064019">c</span>&nbsp;<span class="ident" id="4064021">PacketConn</span><span class="op" id="4064031">,</span>&nbsp;<span class="ident" id="4064033">err</span>&nbsp;<span class="builtintype" id="4064037">error</span><span class="op" id="4064042">)</span>&nbsp;<span class="op" id="4064044">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064047">fd</span><span class="op" id="4064049">,</span>&nbsp;<span class="ident" id="4064051">err</span>&nbsp;<span class="op" id="4064055">:=</span>&nbsp;<span class="ident" id="4064058">newFileFD</span><span class="op" id="4064067">(</span><span class="ident" id="4064068">f</span><span class="op" id="4064069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064072">if</span>&nbsp;<span class="ident" id="4064075">err</span>&nbsp;<span class="op" id="4064079">!=</span>&nbsp;<span class="ident" id="4064082">nil</span>&nbsp;<span class="op" id="4064086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064090">return</span>&nbsp;<span class="ident" id="4064097">nil</span><span class="op" id="4064100">,</span>&nbsp;<span class="ident" id="4064102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064110">switch</span>&nbsp;<span class="ident" id="4064117">fd</span><span class="op" id="4064119">.</span><span class="ident" id="4064120">laddr</span><span class="op" id="4064125">.</span><span class="op" id="4064126">(</span><span class="keyword" id="4064127">type</span><span class="op" id="4064131">)</span>&nbsp;<span class="op" id="4064133">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064136">case</span>&nbsp;<span class="op" id="4064141">*</span><span class="ident" id="4064142">UDPAddr</span><span class="op" id="4064149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064153">return</span>&nbsp;<span class="ident" id="4064160">newUDPConn</span><span class="op" id="4064170">(</span><span class="ident" id="4064171">fd</span><span class="op" id="4064173">)</span><span class="op" id="4064174">,</span>&nbsp;<span class="ident" id="4064176">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064181">case</span>&nbsp;<span class="op" id="4064186">*</span><span class="ident" id="4064187">IPAddr</span><span class="op" id="4064193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064197">return</span>&nbsp;<span class="ident" id="4064204">newIPConn</span><span class="op" id="4064213">(</span><span class="ident" id="4064214">fd</span><span class="op" id="4064216">)</span><span class="op" id="4064217">,</span>&nbsp;<span class="ident" id="4064219">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064224">case</span>&nbsp;<span class="op" id="4064229">*</span><span class="ident" id="4064230">UnixAddr</span><span class="op" id="4064238">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064242">return</span>&nbsp;<span class="ident" id="4064249">newUnixConn</span><span class="op" id="4064260">(</span><span class="ident" id="4064261">fd</span><span class="op" id="4064263">)</span><span class="op" id="4064264">,</span>&nbsp;<span class="ident" id="4064266">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4064271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4064274">fd</span><span class="op" id="4064276">.</span><span class="ident" id="4064277">Close</span><span class="op" id="4064282">(</span><span class="op" id="4064283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4064286">return</span>&nbsp;<span class="ident" id="4064293">nil</span><span class="op" id="4064296">,</span>&nbsp;<span class="ident" id="4064298">syscall</span><span class="op" id="4064305">.</span><span class="ident" id="4064306">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="4064313">}</span>
</div>
</body>
</html>
