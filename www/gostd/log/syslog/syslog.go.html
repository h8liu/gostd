<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>log/syslog</h2>
<ul>
<li><a href="/gostd/log/syslog/syslog.go.html">syslog.go</a></li>
<li><a href="/gostd/log/syslog/syslog_test.go.html">syslog_test.go</a></li>
<li><a href="/gostd/log/syslog/syslog_unix.go.html">syslog_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5568963">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5569018">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5569072">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5569123">//&nbsp;+build&nbsp;!windows,!nacl,!plan9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5569156">//&nbsp;Package&nbsp;syslog&nbsp;provides&nbsp;a&nbsp;simple&nbsp;interface&nbsp;to&nbsp;the&nbsp;system&nbsp;log</span><br>
<span class="lineno"></span><span class="comment" id="5569220">//&nbsp;service.&nbsp;It&nbsp;can&nbsp;send&nbsp;messages&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon&nbsp;using&nbsp;UNIX</span><br>
<span class="lineno"></span><span class="comment" id="5569285">//&nbsp;domain&nbsp;sockets,&nbsp;UDP&nbsp;or&nbsp;TCP.</span><br>
<span class="lineno">10</span><span class="comment" id="5569316">//</span><br>
<span class="lineno"></span><span class="comment" id="5569319">//&nbsp;Only&nbsp;one&nbsp;call&nbsp;to&nbsp;Dial&nbsp;is&nbsp;necessary.&nbsp;On&nbsp;write&nbsp;failures,</span><br>
<span class="lineno"></span><span class="comment" id="5569377">//&nbsp;the&nbsp;syslog&nbsp;client&nbsp;will&nbsp;attempt&nbsp;to&nbsp;reconnect&nbsp;to&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5569438">//&nbsp;and&nbsp;write&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="5569458">package</span>&nbsp;<span class="ident" id="5569466">syslog</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5569474">import</span>&nbsp;<span class="op" id="5569481">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569484">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569494">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569501">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569508">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569515">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569521">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569532">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5569540">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5569547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5569550">//&nbsp;The&nbsp;Priority&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;the&nbsp;syslog&nbsp;facility&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5569610">//&nbsp;severity.&nbsp;For&nbsp;example,&nbsp;LOG_ALERT&nbsp;|&nbsp;LOG_FTP&nbsp;sends&nbsp;an&nbsp;alert&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5569680">//&nbsp;message&nbsp;from&nbsp;the&nbsp;FTP&nbsp;facility.&nbsp;The&nbsp;default&nbsp;severity&nbsp;is&nbsp;LOG_EMERG;</span><br>
<span class="lineno">30</span><span class="comment" id="5569749">//&nbsp;the&nbsp;default&nbsp;facility&nbsp;is&nbsp;LOG_KERN.</span><br>
<span class="lineno"></span><span class="keyword" id="5569786">type</span>&nbsp;<span class="ident" id="5569791">Priority</span>&nbsp;<span class="builtintype" id="5569800">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5569805">const</span>&nbsp;<span class="ident" id="5569811">severityMask</span>&nbsp;<span class="op" id="5569824">=</span>&nbsp;<span class="num" id="5569826">0x07</span><br>
<span class="lineno"></span><span class="keyword" id="5569831">const</span>&nbsp;<span class="ident" id="5569837">facilityMask</span>&nbsp;<span class="op" id="5569850">=</span>&nbsp;<span class="num" id="5569852">0xf8</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="5569858">const</span>&nbsp;<span class="op" id="5569864">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569867">//&nbsp;Severity.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569882">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569918">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569966">LOG_EMERG</span>&nbsp;<span class="ident" id="5569976">Priority</span>&nbsp;<span class="op" id="5569985">=</span>&nbsp;<span class="ident" id="5569987">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569993">LOG_ALERT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570004">LOG_CRIT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570014">LOG_ERR</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570023">LOG_WARNING</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570036">LOG_NOTICE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570048">LOG_INFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570058">LOG_DEBUG</span><br>
<span class="lineno"></span><span class="op" id="5570068">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5570071">const</span>&nbsp;<span class="op" id="5570077">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570080">//&nbsp;Facility.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570095">//&nbsp;From&nbsp;/usr/include/sys/syslog.h.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570131">//&nbsp;These&nbsp;are&nbsp;the&nbsp;same&nbsp;up&nbsp;to&nbsp;LOG_FTP&nbsp;on&nbsp;Linux,&nbsp;BSD,&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570193">LOG_KERN</span>&nbsp;<span class="ident" id="5570202">Priority</span>&nbsp;<span class="op" id="5570211">=</span>&nbsp;<span class="ident" id="5570213">iota</span>&nbsp;<span class="op" id="5570218">&lt;&lt;</span>&nbsp;<span class="num" id="5570221">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570224">LOG_USER</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570234">LOG_MAIL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570244">LOG_DAEMON</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570256">LOG_AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570266">LOG_SYSLOG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570278">LOG_LPR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570287">LOG_NEWS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570297">LOG_UUCP</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570307">LOG_CRON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570317">LOG_AUTHPRIV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570331">LOG_FTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570340">_</span>&nbsp;<span class="comment" id="5570342">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570353">_</span>&nbsp;<span class="comment" id="5570355">//&nbsp;unused</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570366">_</span>&nbsp;<span class="comment" id="5570368">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570379">_</span>&nbsp;<span class="comment" id="5570381">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570392">LOG_LOCAL0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570404">LOG_LOCAL1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570416">LOG_LOCAL2</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570428">LOG_LOCAL3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570440">LOG_LOCAL4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570452">LOG_LOCAL5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570464">LOG_LOCAL6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570476">LOG_LOCAL7</span><br>
<span class="lineno">80</span><span class="op" id="5570487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5570490">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5570538">type</span>&nbsp;<span class="ident" id="5570543">Writer</span>&nbsp;<span class="keyword" id="5570550">struct</span>&nbsp;<span class="op" id="5570557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570560">priority</span>&nbsp;<span class="ident" id="5570569">Priority</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570579">tag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5570588">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570596">hostname</span>&nbsp;<span class="builtintype" id="5570605">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570613">network</span>&nbsp;&nbsp;<span class="builtintype" id="5570622">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570630">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5570639">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570648">mu</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5570653">sync</span><span class="op" id="5570657">.</span><span class="ident" id="5570658">Mutex</span>&nbsp;<span class="comment" id="5570664">//&nbsp;guards&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570680">conn</span>&nbsp;<span class="ident" id="5570685">serverConn</span><br>
<span class="lineno"></span><span class="op" id="5570696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5570699">//&nbsp;This&nbsp;interface&nbsp;and&nbsp;the&nbsp;separate&nbsp;syslog_unix.go&nbsp;file&nbsp;exist&nbsp;for</span><br>
<span class="lineno">95</span><span class="comment" id="5570764">//&nbsp;Solaris&nbsp;support&nbsp;as&nbsp;implemented&nbsp;by&nbsp;gccgo.&nbsp;&nbsp;On&nbsp;Solaris&nbsp;you&nbsp;can&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5570832">//&nbsp;simply&nbsp;open&nbsp;a&nbsp;TCP&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.&nbsp;&nbsp;The&nbsp;gccgo</span><br>
<span class="lineno"></span><span class="comment" id="5570897">//&nbsp;sources&nbsp;have&nbsp;a&nbsp;syslog_solaris.go&nbsp;file&nbsp;that&nbsp;implements&nbsp;unixSyslog&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5570968">//&nbsp;return&nbsp;a&nbsp;type&nbsp;that&nbsp;satisfies&nbsp;this&nbsp;interface&nbsp;and&nbsp;simply&nbsp;calls&nbsp;the&nbsp;C</span><br>
<span class="lineno"></span><span class="comment" id="5571038">//&nbsp;library&nbsp;syslog&nbsp;function.</span><br>
<span class="lineno">100</span><span class="keyword" id="5571066">type</span>&nbsp;<span class="ident" id="5571071">serverConn</span>&nbsp;<span class="keyword" id="5571082">interface</span>&nbsp;<span class="op" id="5571092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571095">writeString</span><span class="op" id="5571106">(</span><span class="ident" id="5571107">p</span>&nbsp;<span class="ident" id="5571109">Priority</span><span class="op" id="5571117">,</span>&nbsp;<span class="ident" id="5571119">hostname</span><span class="op" id="5571127">,</span>&nbsp;<span class="ident" id="5571129">tag</span><span class="op" id="5571132">,</span>&nbsp;<span class="ident" id="5571134">s</span><span class="op" id="5571135">,</span>&nbsp;<span class="ident" id="5571137">nl</span>&nbsp;<span class="builtintype" id="5571140">string</span><span class="op" id="5571146">)</span>&nbsp;<span class="builtintype" id="5571148">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5571155">close</span><span class="op" id="5571160">(</span><span class="op" id="5571161">)</span>&nbsp;<span class="builtintype" id="5571163">error</span><br>
<span class="lineno"></span><span class="op" id="5571169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="5571172">type</span>&nbsp;<span class="ident" id="5571177">netConn</span>&nbsp;<span class="keyword" id="5571185">struct</span>&nbsp;<span class="op" id="5571192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571195">local</span>&nbsp;<span class="builtintype" id="5571201">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571207">conn</span>&nbsp;&nbsp;<span class="ident" id="5571213">net</span><span class="op" id="5571216">.</span><span class="ident" id="5571217">Conn</span><br>
<span class="lineno"></span><span class="op" id="5571222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="5571225">//&nbsp;New&nbsp;establishes&nbsp;a&nbsp;new&nbsp;connection&nbsp;to&nbsp;the&nbsp;system&nbsp;log&nbsp;daemon.&nbsp;&nbsp;Each</span><br>
<span class="lineno"></span><span class="comment" id="5571293">//&nbsp;write&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5571360">//&nbsp;priority&nbsp;and&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="5571384">func</span>&nbsp;<span class="ident" id="5571389">New</span><span class="op" id="5571392">(</span><span class="ident" id="5571393">priority</span>&nbsp;<span class="ident" id="5571402">Priority</span><span class="op" id="5571410">,</span>&nbsp;<span class="ident" id="5571412">tag</span>&nbsp;<span class="builtintype" id="5571416">string</span><span class="op" id="5571422">)</span>&nbsp;<span class="op" id="5571424">(</span><span class="ident" id="5571425">w</span>&nbsp;<span class="op" id="5571427">*</span><span class="ident" id="5571428">Writer</span><span class="op" id="5571434">,</span>&nbsp;<span class="ident" id="5571436">err</span>&nbsp;<span class="builtintype" id="5571440">error</span><span class="op" id="5571445">)</span>&nbsp;<span class="op" id="5571447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571450">return</span>&nbsp;<span class="ident" id="5571457">Dial</span><span class="op" id="5571461">(</span><span class="string" id="5571462">&#34;&#34;</span><span class="op" id="5571464">,</span>&nbsp;<span class="string" id="5571466">&#34;&#34;</span><span class="op" id="5571468">,</span>&nbsp;<span class="ident" id="5571470">priority</span><span class="op" id="5571478">,</span>&nbsp;<span class="ident" id="5571480">tag</span><span class="op" id="5571483">)</span><br>
<span class="lineno">115</span><span class="op" id="5571485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5571488">//&nbsp;Dial&nbsp;establishes&nbsp;a&nbsp;connection&nbsp;to&nbsp;a&nbsp;log&nbsp;daemon&nbsp;by&nbsp;connecting&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5571554">//&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;specified&nbsp;network.&nbsp;&nbsp;Each&nbsp;write&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5571625">//&nbsp;writer&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;with&nbsp;the&nbsp;given&nbsp;facility,&nbsp;severity&nbsp;and</span><br>
<span class="lineno">120</span><span class="comment" id="5571693">//&nbsp;tag.</span><br>
<span class="lineno"></span><span class="comment" id="5571701">//&nbsp;If&nbsp;network&nbsp;is&nbsp;empty,&nbsp;Dial&nbsp;will&nbsp;connect&nbsp;to&nbsp;the&nbsp;local&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5571771">func</span>&nbsp;<span class="ident" id="5571776">Dial</span><span class="op" id="5571780">(</span><span class="ident" id="5571781">network</span><span class="op" id="5571788">,</span>&nbsp;<span class="ident" id="5571790">raddr</span>&nbsp;<span class="builtintype" id="5571796">string</span><span class="op" id="5571802">,</span>&nbsp;<span class="ident" id="5571804">priority</span>&nbsp;<span class="ident" id="5571813">Priority</span><span class="op" id="5571821">,</span>&nbsp;<span class="ident" id="5571823">tag</span>&nbsp;<span class="builtintype" id="5571827">string</span><span class="op" id="5571833">)</span>&nbsp;<span class="op" id="5571835">(</span><span class="op" id="5571836">*</span><span class="ident" id="5571837">Writer</span><span class="op" id="5571843">,</span>&nbsp;<span class="builtintype" id="5571845">error</span><span class="op" id="5571850">)</span>&nbsp;<span class="op" id="5571852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571855">if</span>&nbsp;<span class="ident" id="5571858">priority</span>&nbsp;<span class="op" id="5571867">&lt;</span>&nbsp;<span class="num" id="5571869">0</span>&nbsp;<span class="op" id="5571871">||</span>&nbsp;<span class="ident" id="5571874">priority</span>&nbsp;<span class="op" id="5571883">&gt;</span>&nbsp;<span class="ident" id="5571885">LOG_LOCAL7</span><span class="op" id="5571895">|</span><span class="ident" id="5571896">LOG_DEBUG</span>&nbsp;<span class="op" id="5571906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571910">return</span>&nbsp;<span class="ident" id="5571917">nil</span><span class="op" id="5571920">,</span>&nbsp;<span class="ident" id="5571922">errors</span><span class="op" id="5571928">.</span><span class="ident" id="5571929">New</span><span class="op" id="5571932">(</span><span class="string" id="5571933">&#34;log/syslog:&nbsp;invalid&nbsp;priority&#34;</span><span class="op" id="5571963">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571970">if</span>&nbsp;<span class="ident" id="5571973">tag</span>&nbsp;<span class="op" id="5571977">==</span>&nbsp;<span class="string" id="5571980">&#34;&#34;</span>&nbsp;<span class="op" id="5571983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571987">tag</span>&nbsp;<span class="op" id="5571991">=</span>&nbsp;<span class="ident" id="5571993">os</span><span class="op" id="5571995">.</span><span class="ident" id="5571996">Args</span><span class="op" id="5572000">[</span><span class="num" id="5572001">0</span><span class="op" id="5572002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572005">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572008">hostname</span><span class="op" id="5572016">,</span>&nbsp;<span class="ident" id="5572018">_</span>&nbsp;<span class="op" id="5572020">:=</span>&nbsp;<span class="ident" id="5572023">os</span><span class="op" id="5572025">.</span><span class="ident" id="5572026">Hostname</span><span class="op" id="5572034">(</span><span class="op" id="5572035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572039">w</span>&nbsp;<span class="op" id="5572041">:=</span>&nbsp;<span class="op" id="5572044">&amp;</span><span class="ident" id="5572045">Writer</span><span class="op" id="5572051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572055">priority</span><span class="op" id="5572063">:</span>&nbsp;<span class="ident" id="5572065">priority</span><span class="op" id="5572073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572077">tag</span><span class="op" id="5572080">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572087">tag</span><span class="op" id="5572090">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572094">hostname</span><span class="op" id="5572102">:</span>&nbsp;<span class="ident" id="5572104">hostname</span><span class="op" id="5572112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572116">network</span><span class="op" id="5572123">:</span>&nbsp;&nbsp;<span class="ident" id="5572126">network</span><span class="op" id="5572133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572137">raddr</span><span class="op" id="5572142">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5572147">raddr</span><span class="op" id="5572152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572159">w</span><span class="op" id="5572160">.</span><span class="ident" id="5572161">mu</span><span class="op" id="5572163">.</span><span class="ident" id="5572164">Lock</span><span class="op" id="5572168">(</span><span class="op" id="5572169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572172">defer</span>&nbsp;<span class="ident" id="5572178">w</span><span class="op" id="5572179">.</span><span class="ident" id="5572180">mu</span><span class="op" id="5572182">.</span><span class="ident" id="5572183">Unlock</span><span class="op" id="5572189">(</span><span class="op" id="5572190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572194">err</span>&nbsp;<span class="op" id="5572198">:=</span>&nbsp;<span class="ident" id="5572201">w</span><span class="op" id="5572202">.</span><span class="ident" id="5572203">connect</span><span class="op" id="5572210">(</span><span class="op" id="5572211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572214">if</span>&nbsp;<span class="ident" id="5572217">err</span>&nbsp;<span class="op" id="5572221">!=</span>&nbsp;<span class="ident" id="5572224">nil</span>&nbsp;<span class="op" id="5572228">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572232">return</span>&nbsp;<span class="ident" id="5572239">nil</span><span class="op" id="5572242">,</span>&nbsp;<span class="ident" id="5572244">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572252">return</span>&nbsp;<span class="ident" id="5572259">w</span><span class="op" id="5572260">,</span>&nbsp;<span class="ident" id="5572262">err</span><br>
<span class="lineno"></span><span class="op" id="5572266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5572269">//&nbsp;connect&nbsp;makes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5572321">//&nbsp;It&nbsp;must&nbsp;be&nbsp;called&nbsp;with&nbsp;w.mu&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5572358">func</span>&nbsp;<span class="op" id="5572363">(</span><span class="ident" id="5572364">w</span>&nbsp;<span class="op" id="5572366">*</span><span class="ident" id="5572367">Writer</span><span class="op" id="5572373">)</span>&nbsp;<span class="ident" id="5572375">connect</span><span class="op" id="5572382">(</span><span class="op" id="5572383">)</span>&nbsp;<span class="op" id="5572385">(</span><span class="ident" id="5572386">err</span>&nbsp;<span class="builtintype" id="5572390">error</span><span class="op" id="5572395">)</span>&nbsp;<span class="op" id="5572397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572400">if</span>&nbsp;<span class="ident" id="5572403">w</span><span class="op" id="5572404">.</span><span class="ident" id="5572405">conn</span>&nbsp;<span class="op" id="5572410">!=</span>&nbsp;<span class="ident" id="5572413">nil</span>&nbsp;<span class="op" id="5572417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572421">//&nbsp;ignore&nbsp;err&nbsp;from&nbsp;close,&nbsp;it&nbsp;makes&nbsp;sense&nbsp;to&nbsp;continue&nbsp;anyway</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572483">w</span><span class="op" id="5572484">.</span><span class="ident" id="5572485">conn</span><span class="op" id="5572489">.</span><span class="builtinfunc" id="5572490">close</span><span class="op" id="5572495">(</span><span class="op" id="5572496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572500">w</span><span class="op" id="5572501">.</span><span class="ident" id="5572502">conn</span>&nbsp;<span class="op" id="5572507">=</span>&nbsp;<span class="ident" id="5572509">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572518">if</span>&nbsp;<span class="ident" id="5572521">w</span><span class="op" id="5572522">.</span><span class="ident" id="5572523">network</span>&nbsp;<span class="op" id="5572531">==</span>&nbsp;<span class="string" id="5572534">&#34;&#34;</span>&nbsp;<span class="op" id="5572537">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572541">w</span><span class="op" id="5572542">.</span><span class="ident" id="5572543">conn</span><span class="op" id="5572547">,</span>&nbsp;<span class="ident" id="5572549">err</span>&nbsp;<span class="op" id="5572553">=</span>&nbsp;<span class="ident" id="5572555">unixSyslog</span><span class="op" id="5572565">(</span><span class="op" id="5572566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572570">if</span>&nbsp;<span class="ident" id="5572573">w</span><span class="op" id="5572574">.</span><span class="ident" id="5572575">hostname</span>&nbsp;<span class="op" id="5572584">==</span>&nbsp;<span class="string" id="5572587">&#34;&#34;</span>&nbsp;<span class="op" id="5572590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572595">w</span><span class="op" id="5572596">.</span><span class="ident" id="5572597">hostname</span>&nbsp;<span class="op" id="5572606">=</span>&nbsp;<span class="string" id="5572608">&#34;localhost&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572625">}</span>&nbsp;<span class="keyword" id="5572627">else</span>&nbsp;<span class="op" id="5572632">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572636">var</span>&nbsp;<span class="ident" id="5572640">c</span>&nbsp;<span class="ident" id="5572642">net</span><span class="op" id="5572645">.</span><span class="ident" id="5572646">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572653">c</span><span class="op" id="5572654">,</span>&nbsp;<span class="ident" id="5572656">err</span>&nbsp;<span class="op" id="5572660">=</span>&nbsp;<span class="ident" id="5572662">net</span><span class="op" id="5572665">.</span><span class="ident" id="5572666">Dial</span><span class="op" id="5572670">(</span><span class="ident" id="5572671">w</span><span class="op" id="5572672">.</span><span class="ident" id="5572673">network</span><span class="op" id="5572680">,</span>&nbsp;<span class="ident" id="5572682">w</span><span class="op" id="5572683">.</span><span class="ident" id="5572684">raddr</span><span class="op" id="5572689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572693">if</span>&nbsp;<span class="ident" id="5572696">err</span>&nbsp;<span class="op" id="5572700">==</span>&nbsp;<span class="ident" id="5572703">nil</span>&nbsp;<span class="op" id="5572707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572712">w</span><span class="op" id="5572713">.</span><span class="ident" id="5572714">conn</span>&nbsp;<span class="op" id="5572719">=</span>&nbsp;<span class="op" id="5572721">&amp;</span><span class="ident" id="5572722">netConn</span><span class="op" id="5572729">{</span><span class="ident" id="5572730">conn</span><span class="op" id="5572734">:</span>&nbsp;<span class="ident" id="5572736">c</span><span class="op" id="5572737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572742">if</span>&nbsp;<span class="ident" id="5572745">w</span><span class="op" id="5572746">.</span><span class="ident" id="5572747">hostname</span>&nbsp;<span class="op" id="5572756">==</span>&nbsp;<span class="string" id="5572759">&#34;&#34;</span>&nbsp;<span class="op" id="5572762">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572768">w</span><span class="op" id="5572769">.</span><span class="ident" id="5572770">hostname</span>&nbsp;<span class="op" id="5572779">=</span>&nbsp;<span class="ident" id="5572781">c</span><span class="op" id="5572782">.</span><span class="ident" id="5572783">LocalAddr</span><span class="op" id="5572792">(</span><span class="op" id="5572793">)</span><span class="op" id="5572794">.</span><span class="ident" id="5572795">String</span><span class="op" id="5572801">(</span><span class="op" id="5572802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572817">return</span><br>
<span class="lineno">175</span><span class="op" id="5572824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5572827">//&nbsp;Write&nbsp;sends&nbsp;a&nbsp;log&nbsp;message&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="5572878">func</span>&nbsp;<span class="op" id="5572883">(</span><span class="ident" id="5572884">w</span>&nbsp;<span class="op" id="5572886">*</span><span class="ident" id="5572887">Writer</span><span class="op" id="5572893">)</span>&nbsp;<span class="ident" id="5572895">Write</span><span class="op" id="5572900">(</span><span class="ident" id="5572901">b</span>&nbsp;<span class="op" id="5572903">[</span><span class="op" id="5572904">]</span><span class="builtintype" id="5572905">byte</span><span class="op" id="5572909">)</span>&nbsp;<span class="op" id="5572911">(</span><span class="builtintype" id="5572912">int</span><span class="op" id="5572915">,</span>&nbsp;<span class="builtintype" id="5572917">error</span><span class="op" id="5572922">)</span>&nbsp;<span class="op" id="5572924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572927">return</span>&nbsp;<span class="ident" id="5572934">w</span><span class="op" id="5572935">.</span><span class="ident" id="5572936">writeAndRetry</span><span class="op" id="5572949">(</span><span class="ident" id="5572950">w</span><span class="op" id="5572951">.</span><span class="ident" id="5572952">priority</span><span class="op" id="5572960">,</span>&nbsp;<span class="builtintype" id="5572962">string</span><span class="op" id="5572968">(</span><span class="ident" id="5572969">b</span><span class="op" id="5572970">)</span><span class="op" id="5572971">)</span><br>
<span class="lineno">180</span><span class="op" id="5572973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5572976">//&nbsp;Close&nbsp;closes&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;syslog&nbsp;daemon.</span><br>
<span class="lineno"></span><span class="keyword" id="5573027">func</span>&nbsp;<span class="op" id="5573032">(</span><span class="ident" id="5573033">w</span>&nbsp;<span class="op" id="5573035">*</span><span class="ident" id="5573036">Writer</span><span class="op" id="5573042">)</span>&nbsp;<span class="ident" id="5573044">Close</span><span class="op" id="5573049">(</span><span class="op" id="5573050">)</span>&nbsp;<span class="builtintype" id="5573052">error</span>&nbsp;<span class="op" id="5573058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573061">w</span><span class="op" id="5573062">.</span><span class="ident" id="5573063">mu</span><span class="op" id="5573065">.</span><span class="ident" id="5573066">Lock</span><span class="op" id="5573070">(</span><span class="op" id="5573071">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573074">defer</span>&nbsp;<span class="ident" id="5573080">w</span><span class="op" id="5573081">.</span><span class="ident" id="5573082">mu</span><span class="op" id="5573084">.</span><span class="ident" id="5573085">Unlock</span><span class="op" id="5573091">(</span><span class="op" id="5573092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573096">if</span>&nbsp;<span class="ident" id="5573099">w</span><span class="op" id="5573100">.</span><span class="ident" id="5573101">conn</span>&nbsp;<span class="op" id="5573106">!=</span>&nbsp;<span class="ident" id="5573109">nil</span>&nbsp;<span class="op" id="5573113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573117">err</span>&nbsp;<span class="op" id="5573121">:=</span>&nbsp;<span class="ident" id="5573124">w</span><span class="op" id="5573125">.</span><span class="ident" id="5573126">conn</span><span class="op" id="5573130">.</span><span class="builtinfunc" id="5573131">close</span><span class="op" id="5573136">(</span><span class="op" id="5573137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573141">w</span><span class="op" id="5573142">.</span><span class="ident" id="5573143">conn</span>&nbsp;<span class="op" id="5573148">=</span>&nbsp;<span class="ident" id="5573150">nil</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573156">return</span>&nbsp;<span class="ident" id="5573163">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573171">return</span>&nbsp;<span class="ident" id="5573178">nil</span><br>
<span class="lineno"></span><span class="op" id="5573182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="5573185">//&nbsp;Emerg&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_EMERG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5573256">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5573274">func</span>&nbsp;<span class="op" id="5573279">(</span><span class="ident" id="5573280">w</span>&nbsp;<span class="op" id="5573282">*</span><span class="ident" id="5573283">Writer</span><span class="op" id="5573289">)</span>&nbsp;<span class="ident" id="5573291">Emerg</span><span class="op" id="5573296">(</span><span class="ident" id="5573297">m</span>&nbsp;<span class="builtintype" id="5573299">string</span><span class="op" id="5573305">)</span>&nbsp;<span class="op" id="5573307">(</span><span class="ident" id="5573308">err</span>&nbsp;<span class="builtintype" id="5573312">error</span><span class="op" id="5573317">)</span>&nbsp;<span class="op" id="5573319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573322">_</span><span class="op" id="5573323">,</span>&nbsp;<span class="ident" id="5573325">err</span>&nbsp;<span class="op" id="5573329">=</span>&nbsp;<span class="ident" id="5573331">w</span><span class="op" id="5573332">.</span><span class="ident" id="5573333">writeAndRetry</span><span class="op" id="5573346">(</span><span class="ident" id="5573347">LOG_EMERG</span><span class="op" id="5573356">,</span>&nbsp;<span class="ident" id="5573358">m</span><span class="op" id="5573359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573362">return</span>&nbsp;<span class="ident" id="5573369">err</span><br>
<span class="lineno">200</span><span class="op" id="5573373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573376">//&nbsp;Alert&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ALERT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5573447">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5573465">func</span>&nbsp;<span class="op" id="5573470">(</span><span class="ident" id="5573471">w</span>&nbsp;<span class="op" id="5573473">*</span><span class="ident" id="5573474">Writer</span><span class="op" id="5573480">)</span>&nbsp;<span class="ident" id="5573482">Alert</span><span class="op" id="5573487">(</span><span class="ident" id="5573488">m</span>&nbsp;<span class="builtintype" id="5573490">string</span><span class="op" id="5573496">)</span>&nbsp;<span class="op" id="5573498">(</span><span class="ident" id="5573499">err</span>&nbsp;<span class="builtintype" id="5573503">error</span><span class="op" id="5573508">)</span>&nbsp;<span class="op" id="5573510">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573513">_</span><span class="op" id="5573514">,</span>&nbsp;<span class="ident" id="5573516">err</span>&nbsp;<span class="op" id="5573520">=</span>&nbsp;<span class="ident" id="5573522">w</span><span class="op" id="5573523">.</span><span class="ident" id="5573524">writeAndRetry</span><span class="op" id="5573537">(</span><span class="ident" id="5573538">LOG_ALERT</span><span class="op" id="5573547">,</span>&nbsp;<span class="ident" id="5573549">m</span><span class="op" id="5573550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573553">return</span>&nbsp;<span class="ident" id="5573560">err</span><br>
<span class="lineno"></span><span class="op" id="5573564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573567">//&nbsp;Crit&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_CRIT,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">210</span><span class="comment" id="5573636">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5573654">func</span>&nbsp;<span class="op" id="5573659">(</span><span class="ident" id="5573660">w</span>&nbsp;<span class="op" id="5573662">*</span><span class="ident" id="5573663">Writer</span><span class="op" id="5573669">)</span>&nbsp;<span class="ident" id="5573671">Crit</span><span class="op" id="5573675">(</span><span class="ident" id="5573676">m</span>&nbsp;<span class="builtintype" id="5573678">string</span><span class="op" id="5573684">)</span>&nbsp;<span class="op" id="5573686">(</span><span class="ident" id="5573687">err</span>&nbsp;<span class="builtintype" id="5573691">error</span><span class="op" id="5573696">)</span>&nbsp;<span class="op" id="5573698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573701">_</span><span class="op" id="5573702">,</span>&nbsp;<span class="ident" id="5573704">err</span>&nbsp;<span class="op" id="5573708">=</span>&nbsp;<span class="ident" id="5573710">w</span><span class="op" id="5573711">.</span><span class="ident" id="5573712">writeAndRetry</span><span class="op" id="5573725">(</span><span class="ident" id="5573726">LOG_CRIT</span><span class="op" id="5573734">,</span>&nbsp;<span class="ident" id="5573736">m</span><span class="op" id="5573737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573740">return</span>&nbsp;<span class="ident" id="5573747">err</span><br>
<span class="lineno"></span><span class="op" id="5573751">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="comment" id="5573754">//&nbsp;Err&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_ERR,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5573821">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5573839">func</span>&nbsp;<span class="op" id="5573844">(</span><span class="ident" id="5573845">w</span>&nbsp;<span class="op" id="5573847">*</span><span class="ident" id="5573848">Writer</span><span class="op" id="5573854">)</span>&nbsp;<span class="ident" id="5573856">Err</span><span class="op" id="5573859">(</span><span class="ident" id="5573860">m</span>&nbsp;<span class="builtintype" id="5573862">string</span><span class="op" id="5573868">)</span>&nbsp;<span class="op" id="5573870">(</span><span class="ident" id="5573871">err</span>&nbsp;<span class="builtintype" id="5573875">error</span><span class="op" id="5573880">)</span>&nbsp;<span class="op" id="5573882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573885">_</span><span class="op" id="5573886">,</span>&nbsp;<span class="ident" id="5573888">err</span>&nbsp;<span class="op" id="5573892">=</span>&nbsp;<span class="ident" id="5573894">w</span><span class="op" id="5573895">.</span><span class="ident" id="5573896">writeAndRetry</span><span class="op" id="5573909">(</span><span class="ident" id="5573910">LOG_ERR</span><span class="op" id="5573917">,</span>&nbsp;<span class="ident" id="5573919">m</span><span class="op" id="5573920">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573923">return</span>&nbsp;<span class="ident" id="5573930">err</span><br>
<span class="lineno"></span><span class="op" id="5573934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5573937">//&nbsp;Warning&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_WARNING,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5574003">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno">225</span><span class="keyword" id="5574030">func</span>&nbsp;<span class="op" id="5574035">(</span><span class="ident" id="5574036">w</span>&nbsp;<span class="op" id="5574038">*</span><span class="ident" id="5574039">Writer</span><span class="op" id="5574045">)</span>&nbsp;<span class="ident" id="5574047">Warning</span><span class="op" id="5574054">(</span><span class="ident" id="5574055">m</span>&nbsp;<span class="builtintype" id="5574057">string</span><span class="op" id="5574063">)</span>&nbsp;<span class="op" id="5574065">(</span><span class="ident" id="5574066">err</span>&nbsp;<span class="builtintype" id="5574070">error</span><span class="op" id="5574075">)</span>&nbsp;<span class="op" id="5574077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574080">_</span><span class="op" id="5574081">,</span>&nbsp;<span class="ident" id="5574083">err</span>&nbsp;<span class="op" id="5574087">=</span>&nbsp;<span class="ident" id="5574089">w</span><span class="op" id="5574090">.</span><span class="ident" id="5574091">writeAndRetry</span><span class="op" id="5574104">(</span><span class="ident" id="5574105">LOG_WARNING</span><span class="op" id="5574116">,</span>&nbsp;<span class="ident" id="5574118">m</span><span class="op" id="5574119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574122">return</span>&nbsp;<span class="ident" id="5574129">err</span><br>
<span class="lineno"></span><span class="op" id="5574133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="5574136">//&nbsp;Notice&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_NOTICE,&nbsp;ignoring&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5574200">//&nbsp;severity&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5574227">func</span>&nbsp;<span class="op" id="5574232">(</span><span class="ident" id="5574233">w</span>&nbsp;<span class="op" id="5574235">*</span><span class="ident" id="5574236">Writer</span><span class="op" id="5574242">)</span>&nbsp;<span class="ident" id="5574244">Notice</span><span class="op" id="5574250">(</span><span class="ident" id="5574251">m</span>&nbsp;<span class="builtintype" id="5574253">string</span><span class="op" id="5574259">)</span>&nbsp;<span class="op" id="5574261">(</span><span class="ident" id="5574262">err</span>&nbsp;<span class="builtintype" id="5574266">error</span><span class="op" id="5574271">)</span>&nbsp;<span class="op" id="5574273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574276">_</span><span class="op" id="5574277">,</span>&nbsp;<span class="ident" id="5574279">err</span>&nbsp;<span class="op" id="5574283">=</span>&nbsp;<span class="ident" id="5574285">w</span><span class="op" id="5574286">.</span><span class="ident" id="5574287">writeAndRetry</span><span class="op" id="5574300">(</span><span class="ident" id="5574301">LOG_NOTICE</span><span class="op" id="5574311">,</span>&nbsp;<span class="ident" id="5574313">m</span><span class="op" id="5574314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574317">return</span>&nbsp;<span class="ident" id="5574324">err</span><br>
<span class="lineno">235</span><span class="op" id="5574328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574331">//&nbsp;Info&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_INFO,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno"></span><span class="comment" id="5574400">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5574418">func</span>&nbsp;<span class="op" id="5574423">(</span><span class="ident" id="5574424">w</span>&nbsp;<span class="op" id="5574426">*</span><span class="ident" id="5574427">Writer</span><span class="op" id="5574433">)</span>&nbsp;<span class="ident" id="5574435">Info</span><span class="op" id="5574439">(</span><span class="ident" id="5574440">m</span>&nbsp;<span class="builtintype" id="5574442">string</span><span class="op" id="5574448">)</span>&nbsp;<span class="op" id="5574450">(</span><span class="ident" id="5574451">err</span>&nbsp;<span class="builtintype" id="5574455">error</span><span class="op" id="5574460">)</span>&nbsp;<span class="op" id="5574462">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574465">_</span><span class="op" id="5574466">,</span>&nbsp;<span class="ident" id="5574468">err</span>&nbsp;<span class="op" id="5574472">=</span>&nbsp;<span class="ident" id="5574474">w</span><span class="op" id="5574475">.</span><span class="ident" id="5574476">writeAndRetry</span><span class="op" id="5574489">(</span><span class="ident" id="5574490">LOG_INFO</span><span class="op" id="5574498">,</span>&nbsp;<span class="ident" id="5574500">m</span><span class="op" id="5574501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574504">return</span>&nbsp;<span class="ident" id="5574511">err</span><br>
<span class="lineno"></span><span class="op" id="5574515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574518">//&nbsp;Debug&nbsp;logs&nbsp;a&nbsp;message&nbsp;with&nbsp;severity&nbsp;LOG_DEBUG,&nbsp;ignoring&nbsp;the&nbsp;severity</span><br>
<span class="lineno">245</span><span class="comment" id="5574589">//&nbsp;passed&nbsp;to&nbsp;New.</span><br>
<span class="lineno"></span><span class="keyword" id="5574607">func</span>&nbsp;<span class="op" id="5574612">(</span><span class="ident" id="5574613">w</span>&nbsp;<span class="op" id="5574615">*</span><span class="ident" id="5574616">Writer</span><span class="op" id="5574622">)</span>&nbsp;<span class="ident" id="5574624">Debug</span><span class="op" id="5574629">(</span><span class="ident" id="5574630">m</span>&nbsp;<span class="builtintype" id="5574632">string</span><span class="op" id="5574638">)</span>&nbsp;<span class="op" id="5574640">(</span><span class="ident" id="5574641">err</span>&nbsp;<span class="builtintype" id="5574645">error</span><span class="op" id="5574650">)</span>&nbsp;<span class="op" id="5574652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574655">_</span><span class="op" id="5574656">,</span>&nbsp;<span class="ident" id="5574658">err</span>&nbsp;<span class="op" id="5574662">=</span>&nbsp;<span class="ident" id="5574664">w</span><span class="op" id="5574665">.</span><span class="ident" id="5574666">writeAndRetry</span><span class="op" id="5574679">(</span><span class="ident" id="5574680">LOG_DEBUG</span><span class="op" id="5574689">,</span>&nbsp;<span class="ident" id="5574691">m</span><span class="op" id="5574692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574695">return</span>&nbsp;<span class="ident" id="5574702">err</span><br>
<span class="lineno"></span><span class="op" id="5574706">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5574709">func</span>&nbsp;<span class="op" id="5574714">(</span><span class="ident" id="5574715">w</span>&nbsp;<span class="op" id="5574717">*</span><span class="ident" id="5574718">Writer</span><span class="op" id="5574724">)</span>&nbsp;<span class="ident" id="5574726">writeAndRetry</span><span class="op" id="5574739">(</span><span class="ident" id="5574740">p</span>&nbsp;<span class="ident" id="5574742">Priority</span><span class="op" id="5574750">,</span>&nbsp;<span class="ident" id="5574752">s</span>&nbsp;<span class="builtintype" id="5574754">string</span><span class="op" id="5574760">)</span>&nbsp;<span class="op" id="5574762">(</span><span class="builtintype" id="5574763">int</span><span class="op" id="5574766">,</span>&nbsp;<span class="builtintype" id="5574768">error</span><span class="op" id="5574773">)</span>&nbsp;<span class="op" id="5574775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574778">pr</span>&nbsp;<span class="op" id="5574781">:=</span>&nbsp;<span class="op" id="5574784">(</span><span class="ident" id="5574785">w</span><span class="op" id="5574786">.</span><span class="ident" id="5574787">priority</span>&nbsp;<span class="op" id="5574796">&amp;</span>&nbsp;<span class="ident" id="5574798">facilityMask</span><span class="op" id="5574810">)</span>&nbsp;<span class="op" id="5574812">|</span>&nbsp;<span class="op" id="5574814">(</span><span class="ident" id="5574815">p</span>&nbsp;<span class="op" id="5574817">&amp;</span>&nbsp;<span class="ident" id="5574819">severityMask</span><span class="op" id="5574831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574835">w</span><span class="op" id="5574836">.</span><span class="ident" id="5574837">mu</span><span class="op" id="5574839">.</span><span class="ident" id="5574840">Lock</span><span class="op" id="5574844">(</span><span class="op" id="5574845">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574848">defer</span>&nbsp;<span class="ident" id="5574854">w</span><span class="op" id="5574855">.</span><span class="ident" id="5574856">mu</span><span class="op" id="5574858">.</span><span class="ident" id="5574859">Unlock</span><span class="op" id="5574865">(</span><span class="op" id="5574866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574870">if</span>&nbsp;<span class="ident" id="5574873">w</span><span class="op" id="5574874">.</span><span class="ident" id="5574875">conn</span>&nbsp;<span class="op" id="5574880">!=</span>&nbsp;<span class="ident" id="5574883">nil</span>&nbsp;<span class="op" id="5574887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574891">if</span>&nbsp;<span class="ident" id="5574894">n</span><span class="op" id="5574895">,</span>&nbsp;<span class="ident" id="5574897">err</span>&nbsp;<span class="op" id="5574901">:=</span>&nbsp;<span class="ident" id="5574904">w</span><span class="op" id="5574905">.</span><span class="ident" id="5574906">write</span><span class="op" id="5574911">(</span><span class="ident" id="5574912">pr</span><span class="op" id="5574914">,</span>&nbsp;<span class="ident" id="5574916">s</span><span class="op" id="5574917">)</span><span class="op" id="5574918">;</span>&nbsp;<span class="ident" id="5574920">err</span>&nbsp;<span class="op" id="5574924">==</span>&nbsp;<span class="ident" id="5574927">nil</span>&nbsp;<span class="op" id="5574931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574936">return</span>&nbsp;<span class="ident" id="5574943">n</span><span class="op" id="5574944">,</span>&nbsp;<span class="ident" id="5574946">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574958">if</span>&nbsp;<span class="ident" id="5574961">err</span>&nbsp;<span class="op" id="5574965">:=</span>&nbsp;<span class="ident" id="5574968">w</span><span class="op" id="5574969">.</span><span class="ident" id="5574970">connect</span><span class="op" id="5574977">(</span><span class="op" id="5574978">)</span><span class="op" id="5574979">;</span>&nbsp;<span class="ident" id="5574981">err</span>&nbsp;<span class="op" id="5574985">!=</span>&nbsp;<span class="ident" id="5574988">nil</span>&nbsp;<span class="op" id="5574992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574996">return</span>&nbsp;<span class="num" id="5575003">0</span><span class="op" id="5575004">,</span>&nbsp;<span class="ident" id="5575006">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575011">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575014">return</span>&nbsp;<span class="ident" id="5575021">w</span><span class="op" id="5575022">.</span><span class="ident" id="5575023">write</span><span class="op" id="5575028">(</span><span class="ident" id="5575029">pr</span><span class="op" id="5575031">,</span>&nbsp;<span class="ident" id="5575033">s</span><span class="op" id="5575034">)</span><br>
<span class="lineno"></span><span class="op" id="5575036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575039">//&nbsp;write&nbsp;generates&nbsp;and&nbsp;writes&nbsp;a&nbsp;syslog&nbsp;formatted&nbsp;string.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5575100">//&nbsp;format&nbsp;is&nbsp;as&nbsp;follows:&nbsp;&lt;PRI&gt;TIMESTAMP&nbsp;HOSTNAME&nbsp;TAG[PID]:&nbsp;MSG</span><br>
<span class="lineno">270</span><span class="keyword" id="5575163">func</span>&nbsp;<span class="op" id="5575168">(</span><span class="ident" id="5575169">w</span>&nbsp;<span class="op" id="5575171">*</span><span class="ident" id="5575172">Writer</span><span class="op" id="5575178">)</span>&nbsp;<span class="ident" id="5575180">write</span><span class="op" id="5575185">(</span><span class="ident" id="5575186">p</span>&nbsp;<span class="ident" id="5575188">Priority</span><span class="op" id="5575196">,</span>&nbsp;<span class="ident" id="5575198">msg</span>&nbsp;<span class="builtintype" id="5575202">string</span><span class="op" id="5575208">)</span>&nbsp;<span class="op" id="5575210">(</span><span class="builtintype" id="5575211">int</span><span class="op" id="5575214">,</span>&nbsp;<span class="builtintype" id="5575216">error</span><span class="op" id="5575221">)</span>&nbsp;<span class="op" id="5575223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575226">//&nbsp;ensure&nbsp;it&nbsp;ends&nbsp;in&nbsp;a&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575253">nl</span>&nbsp;<span class="op" id="5575256">:=</span>&nbsp;<span class="string" id="5575259">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575263">if</span>&nbsp;<span class="op" id="5575266">!</span><span class="ident" id="5575267">strings</span><span class="op" id="5575274">.</span><span class="ident" id="5575275">HasSuffix</span><span class="op" id="5575284">(</span><span class="ident" id="5575285">msg</span><span class="op" id="5575288">,</span>&nbsp;<span class="string" id="5575290">&#34;\n&#34;</span><span class="op" id="5575294">)</span>&nbsp;<span class="op" id="5575296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575300">nl</span>&nbsp;<span class="op" id="5575303">=</span>&nbsp;<span class="string" id="5575305">&#34;\n&#34;</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575315">err</span>&nbsp;<span class="op" id="5575319">:=</span>&nbsp;<span class="ident" id="5575322">w</span><span class="op" id="5575323">.</span><span class="ident" id="5575324">conn</span><span class="op" id="5575328">.</span><span class="ident" id="5575329">writeString</span><span class="op" id="5575340">(</span><span class="ident" id="5575341">p</span><span class="op" id="5575342">,</span>&nbsp;<span class="ident" id="5575344">w</span><span class="op" id="5575345">.</span><span class="ident" id="5575346">hostname</span><span class="op" id="5575354">,</span>&nbsp;<span class="ident" id="5575356">w</span><span class="op" id="5575357">.</span><span class="ident" id="5575358">tag</span><span class="op" id="5575361">,</span>&nbsp;<span class="ident" id="5575363">msg</span><span class="op" id="5575366">,</span>&nbsp;<span class="ident" id="5575368">nl</span><span class="op" id="5575370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575373">if</span>&nbsp;<span class="ident" id="5575376">err</span>&nbsp;<span class="op" id="5575380">!=</span>&nbsp;<span class="ident" id="5575383">nil</span>&nbsp;<span class="op" id="5575387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575391">return</span>&nbsp;<span class="num" id="5575398">0</span><span class="op" id="5575399">,</span>&nbsp;<span class="ident" id="5575401">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575409">//&nbsp;Note:&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input,&nbsp;not&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575469">//&nbsp;bytes&nbsp;printed&nbsp;by&nbsp;Fprintf,&nbsp;because&nbsp;this&nbsp;must&nbsp;behave&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575529">//&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575547">return</span>&nbsp;<span class="builtinfunc" id="5575554">len</span><span class="op" id="5575557">(</span><span class="ident" id="5575558">msg</span><span class="op" id="5575561">)</span><span class="op" id="5575562">,</span>&nbsp;<span class="ident" id="5575564">nil</span><br>
<span class="lineno">285</span><span class="op" id="5575568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5575571">func</span>&nbsp;<span class="op" id="5575576">(</span><span class="ident" id="5575577">n</span>&nbsp;<span class="op" id="5575579">*</span><span class="ident" id="5575580">netConn</span><span class="op" id="5575587">)</span>&nbsp;<span class="ident" id="5575589">writeString</span><span class="op" id="5575600">(</span><span class="ident" id="5575601">p</span>&nbsp;<span class="ident" id="5575603">Priority</span><span class="op" id="5575611">,</span>&nbsp;<span class="ident" id="5575613">hostname</span><span class="op" id="5575621">,</span>&nbsp;<span class="ident" id="5575623">tag</span><span class="op" id="5575626">,</span>&nbsp;<span class="ident" id="5575628">msg</span><span class="op" id="5575631">,</span>&nbsp;<span class="ident" id="5575633">nl</span>&nbsp;<span class="builtintype" id="5575636">string</span><span class="op" id="5575642">)</span>&nbsp;<span class="builtintype" id="5575644">error</span>&nbsp;<span class="op" id="5575650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575653">if</span>&nbsp;<span class="ident" id="5575656">n</span><span class="op" id="5575657">.</span><span class="ident" id="5575658">local</span>&nbsp;<span class="op" id="5575664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575668">//&nbsp;Compared&nbsp;to&nbsp;the&nbsp;network&nbsp;form&nbsp;below,&nbsp;the&nbsp;changes&nbsp;are:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575726">//&nbsp;&nbsp;&nbsp;&nbsp1.&nbsp;Use&nbsp;time.Stamp&nbsp;instead&nbsp;of&nbsp;time.RFC3339.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5575774">//&nbsp;&nbsp;&nbsp;&nbsp2.&nbsp;Drop&nbsp;the&nbsp;hostname&nbsp;field&nbsp;from&nbsp;the&nbsp;Fprintf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575824">timestamp</span>&nbsp;<span class="op" id="5575834">:=</span>&nbsp;<span class="ident" id="5575837">time</span><span class="op" id="5575841">.</span><span class="ident" id="5575842">Now</span><span class="op" id="5575845">(</span><span class="op" id="5575846">)</span><span class="op" id="5575847">.</span><span class="ident" id="5575848">Format</span><span class="op" id="5575854">(</span><span class="ident" id="5575855">time</span><span class="op" id="5575859">.</span><span class="ident" id="5575860">Stamp</span><span class="op" id="5575865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575869">_</span><span class="op" id="5575870">,</span>&nbsp;<span class="ident" id="5575872">err</span>&nbsp;<span class="op" id="5575876">:=</span>&nbsp;<span class="ident" id="5575879">fmt</span><span class="op" id="5575882">.</span><span class="ident" id="5575883">Fprintf</span><span class="op" id="5575890">(</span><span class="ident" id="5575891">n</span><span class="op" id="5575892">.</span><span class="ident" id="5575893">conn</span><span class="op" id="5575897">,</span>&nbsp;<span class="string" id="5575899">&#34;&lt;%d&gt;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="5575920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575925">p</span><span class="op" id="5575926">,</span>&nbsp;<span class="ident" id="5575928">timestamp</span><span class="op" id="5575937">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575942">tag</span><span class="op" id="5575945">,</span>&nbsp;<span class="ident" id="5575947">os</span><span class="op" id="5575949">.</span><span class="ident" id="5575950">Getpid</span><span class="op" id="5575956">(</span><span class="op" id="5575957">)</span><span class="op" id="5575958">,</span>&nbsp;<span class="ident" id="5575960">msg</span><span class="op" id="5575963">,</span>&nbsp;<span class="ident" id="5575965">nl</span><span class="op" id="5575967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575971">return</span>&nbsp;<span class="ident" id="5575978">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575986">timestamp</span>&nbsp;<span class="op" id="5575996">:=</span>&nbsp;<span class="ident" id="5575999">time</span><span class="op" id="5576003">.</span><span class="ident" id="5576004">Now</span><span class="op" id="5576007">(</span><span class="op" id="5576008">)</span><span class="op" id="5576009">.</span><span class="ident" id="5576010">Format</span><span class="op" id="5576016">(</span><span class="ident" id="5576017">time</span><span class="op" id="5576021">.</span><span class="ident" id="5576022">RFC3339</span><span class="op" id="5576029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576032">_</span><span class="op" id="5576033">,</span>&nbsp;<span class="ident" id="5576035">err</span>&nbsp;<span class="op" id="5576039">:=</span>&nbsp;<span class="ident" id="5576042">fmt</span><span class="op" id="5576045">.</span><span class="ident" id="5576046">Fprintf</span><span class="op" id="5576053">(</span><span class="ident" id="5576054">n</span><span class="op" id="5576055">.</span><span class="ident" id="5576056">conn</span><span class="op" id="5576060">,</span>&nbsp;<span class="string" id="5576062">&#34;&lt;%d&gt;%s&nbsp;%s&nbsp;%s[%d]:&nbsp;%s%s&#34;</span><span class="op" id="5576086">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576090">p</span><span class="op" id="5576091">,</span>&nbsp;<span class="ident" id="5576093">timestamp</span><span class="op" id="5576102">,</span>&nbsp;<span class="ident" id="5576104">hostname</span><span class="op" id="5576112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576116">tag</span><span class="op" id="5576119">,</span>&nbsp;<span class="ident" id="5576121">os</span><span class="op" id="5576123">.</span><span class="ident" id="5576124">Getpid</span><span class="op" id="5576130">(</span><span class="op" id="5576131">)</span><span class="op" id="5576132">,</span>&nbsp;<span class="ident" id="5576134">msg</span><span class="op" id="5576137">,</span>&nbsp;<span class="ident" id="5576139">nl</span><span class="op" id="5576141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576144">return</span>&nbsp;<span class="ident" id="5576151">err</span><br>
<span class="lineno"></span><span class="op" id="5576155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="5576158">func</span>&nbsp;<span class="op" id="5576163">(</span><span class="ident" id="5576164">n</span>&nbsp;<span class="op" id="5576166">*</span><span class="ident" id="5576167">netConn</span><span class="op" id="5576174">)</span>&nbsp;<span class="builtinfunc" id="5576176">close</span><span class="op" id="5576181">(</span><span class="op" id="5576182">)</span>&nbsp;<span class="builtintype" id="5576184">error</span>&nbsp;<span class="op" id="5576190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576193">return</span>&nbsp;<span class="ident" id="5576200">n</span><span class="op" id="5576201">.</span><span class="ident" id="5576202">conn</span><span class="op" id="5576206">.</span><span class="ident" id="5576207">Close</span><span class="op" id="5576212">(</span><span class="op" id="5576213">)</span><br>
<span class="lineno"></span><span class="op" id="5576215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5576218">//&nbsp;NewLogger&nbsp;creates&nbsp;a&nbsp;log.Logger&nbsp;whose&nbsp;output&nbsp;is&nbsp;written&nbsp;to</span><br>
<span class="lineno">310</span><span class="comment" id="5576279">//&nbsp;the&nbsp;system&nbsp;log&nbsp;service&nbsp;with&nbsp;the&nbsp;specified&nbsp;priority.&nbsp;The&nbsp;logFlag</span><br>
<span class="lineno"></span><span class="comment" id="5576346">//&nbsp;argument&nbsp;is&nbsp;the&nbsp;flag&nbsp;set&nbsp;passed&nbsp;through&nbsp;to&nbsp;log.New&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="5576410">//&nbsp;the&nbsp;Logger.</span><br>
<span class="lineno"></span><span class="keyword" id="5576425">func</span>&nbsp;<span class="ident" id="5576430">NewLogger</span><span class="op" id="5576439">(</span><span class="ident" id="5576440">p</span>&nbsp;<span class="ident" id="5576442">Priority</span><span class="op" id="5576450">,</span>&nbsp;<span class="ident" id="5576452">logFlag</span>&nbsp;<span class="builtintype" id="5576460">int</span><span class="op" id="5576463">)</span>&nbsp;<span class="op" id="5576465">(</span><span class="op" id="5576466">*</span><span class="ident" id="5576467">log</span><span class="op" id="5576470">.</span><span class="ident" id="5576471">Logger</span><span class="op" id="5576477">,</span>&nbsp;<span class="builtintype" id="5576479">error</span><span class="op" id="5576484">)</span>&nbsp;<span class="op" id="5576486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576489">s</span><span class="op" id="5576490">,</span>&nbsp;<span class="ident" id="5576492">err</span>&nbsp;<span class="op" id="5576496">:=</span>&nbsp;<span class="ident" id="5576499">New</span><span class="op" id="5576502">(</span><span class="ident" id="5576503">p</span><span class="op" id="5576504">,</span>&nbsp;<span class="string" id="5576506">&#34;&#34;</span><span class="op" id="5576508">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576511">if</span>&nbsp;<span class="ident" id="5576514">err</span>&nbsp;<span class="op" id="5576518">!=</span>&nbsp;<span class="ident" id="5576521">nil</span>&nbsp;<span class="op" id="5576525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576529">return</span>&nbsp;<span class="ident" id="5576536">nil</span><span class="op" id="5576539">,</span>&nbsp;<span class="ident" id="5576541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576549">return</span>&nbsp;<span class="ident" id="5576556">log</span><span class="op" id="5576559">.</span><span class="ident" id="5576560">New</span><span class="op" id="5576563">(</span><span class="ident" id="5576564">s</span><span class="op" id="5576565">,</span>&nbsp;<span class="string" id="5576567">&#34;&#34;</span><span class="op" id="5576569">,</span>&nbsp;<span class="ident" id="5576571">logFlag</span><span class="op" id="5576578">)</span><span class="op" id="5576579">,</span>&nbsp;<span class="ident" id="5576581">nil</span><br>
<span class="lineno"></span><span class="op" id="5576585">}</span>
</div>
</body>
</html>
