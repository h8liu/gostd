<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3866585">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3866640">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3866694">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3866745">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3866809">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3866871">//</span><br>
<span class="lineno"></span><span class="comment" id="3866874">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3866896">//</span><br>
<span class="lineno">10</span><span class="comment" id="3866899">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3866931">//</span><br>
<span class="lineno"></span><span class="comment" id="3866934">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3866993">//</span><br>
<span class="lineno"></span><span class="comment" id="3866996">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3867059">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3867128">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3867182">//</span><br>
<span class="lineno"></span><span class="comment" id="3867185">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3867237">//</span><br>
<span class="lineno">20</span><span class="comment" id="3867240">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3867310">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3867379">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3867449">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3867518">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3867589">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3867661">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3867728">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3867801">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3867873">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3867942">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3867996">//</span><br>
<span class="lineno"></span><span class="comment" id="3867999">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3868082">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3868113">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3868180">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3868248">package</span>&nbsp;<span class="ident" id="3868256">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3868261">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3868328">func</span>&nbsp;<span class="ident" id="3868333">encryptBlockGo</span><span class="op" id="3868347">(</span><span class="ident" id="3868348">xk</span>&nbsp;<span class="op" id="3868351">[</span><span class="op" id="3868352">]</span><span class="builtintype" id="3868353">uint32</span><span class="op" id="3868359">,</span>&nbsp;<span class="ident" id="3868361">dst</span><span class="op" id="3868364">,</span>&nbsp;<span class="ident" id="3868366">src</span>&nbsp;<span class="op" id="3868370">[</span><span class="op" id="3868371">]</span><span class="builtintype" id="3868372">byte</span><span class="op" id="3868376">)</span>&nbsp;<span class="op" id="3868378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3868381">var</span>&nbsp;<span class="ident" id="3868385">s0</span><span class="op" id="3868387">,</span>&nbsp;<span class="ident" id="3868389">s1</span><span class="op" id="3868391">,</span>&nbsp;<span class="ident" id="3868393">s2</span><span class="op" id="3868395">,</span>&nbsp;<span class="ident" id="3868397">s3</span><span class="op" id="3868399">,</span>&nbsp;<span class="ident" id="3868401">t0</span><span class="op" id="3868403">,</span>&nbsp;<span class="ident" id="3868405">t1</span><span class="op" id="3868407">,</span>&nbsp;<span class="ident" id="3868409">t2</span><span class="op" id="3868411">,</span>&nbsp;<span class="ident" id="3868413">t3</span>&nbsp;<span class="builtintype" id="3868416">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868425">s0</span>&nbsp;<span class="op" id="3868428">=</span>&nbsp;<span class="builtintype" id="3868430">uint32</span><span class="op" id="3868436">(</span><span class="ident" id="3868437">src</span><span class="op" id="3868440">[</span><span class="num" id="3868441">0</span><span class="op" id="3868442">]</span><span class="op" id="3868443">)</span><span class="op" id="3868444">&lt;&lt;</span><span class="num" id="3868446">24</span>&nbsp;<span class="op" id="3868449">|</span>&nbsp;<span class="builtintype" id="3868451">uint32</span><span class="op" id="3868457">(</span><span class="ident" id="3868458">src</span><span class="op" id="3868461">[</span><span class="num" id="3868462">1</span><span class="op" id="3868463">]</span><span class="op" id="3868464">)</span><span class="op" id="3868465">&lt;&lt;</span><span class="num" id="3868467">16</span>&nbsp;<span class="op" id="3868470">|</span>&nbsp;<span class="builtintype" id="3868472">uint32</span><span class="op" id="3868478">(</span><span class="ident" id="3868479">src</span><span class="op" id="3868482">[</span><span class="num" id="3868483">2</span><span class="op" id="3868484">]</span><span class="op" id="3868485">)</span><span class="op" id="3868486">&lt;&lt;</span><span class="num" id="3868488">8</span>&nbsp;<span class="op" id="3868490">|</span>&nbsp;<span class="builtintype" id="3868492">uint32</span><span class="op" id="3868498">(</span><span class="ident" id="3868499">src</span><span class="op" id="3868502">[</span><span class="num" id="3868503">3</span><span class="op" id="3868504">]</span><span class="op" id="3868505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868508">s1</span>&nbsp;<span class="op" id="3868511">=</span>&nbsp;<span class="builtintype" id="3868513">uint32</span><span class="op" id="3868519">(</span><span class="ident" id="3868520">src</span><span class="op" id="3868523">[</span><span class="num" id="3868524">4</span><span class="op" id="3868525">]</span><span class="op" id="3868526">)</span><span class="op" id="3868527">&lt;&lt;</span><span class="num" id="3868529">24</span>&nbsp;<span class="op" id="3868532">|</span>&nbsp;<span class="builtintype" id="3868534">uint32</span><span class="op" id="3868540">(</span><span class="ident" id="3868541">src</span><span class="op" id="3868544">[</span><span class="num" id="3868545">5</span><span class="op" id="3868546">]</span><span class="op" id="3868547">)</span><span class="op" id="3868548">&lt;&lt;</span><span class="num" id="3868550">16</span>&nbsp;<span class="op" id="3868553">|</span>&nbsp;<span class="builtintype" id="3868555">uint32</span><span class="op" id="3868561">(</span><span class="ident" id="3868562">src</span><span class="op" id="3868565">[</span><span class="num" id="3868566">6</span><span class="op" id="3868567">]</span><span class="op" id="3868568">)</span><span class="op" id="3868569">&lt;&lt;</span><span class="num" id="3868571">8</span>&nbsp;<span class="op" id="3868573">|</span>&nbsp;<span class="builtintype" id="3868575">uint32</span><span class="op" id="3868581">(</span><span class="ident" id="3868582">src</span><span class="op" id="3868585">[</span><span class="num" id="3868586">7</span><span class="op" id="3868587">]</span><span class="op" id="3868588">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868591">s2</span>&nbsp;<span class="op" id="3868594">=</span>&nbsp;<span class="builtintype" id="3868596">uint32</span><span class="op" id="3868602">(</span><span class="ident" id="3868603">src</span><span class="op" id="3868606">[</span><span class="num" id="3868607">8</span><span class="op" id="3868608">]</span><span class="op" id="3868609">)</span><span class="op" id="3868610">&lt;&lt;</span><span class="num" id="3868612">24</span>&nbsp;<span class="op" id="3868615">|</span>&nbsp;<span class="builtintype" id="3868617">uint32</span><span class="op" id="3868623">(</span><span class="ident" id="3868624">src</span><span class="op" id="3868627">[</span><span class="num" id="3868628">9</span><span class="op" id="3868629">]</span><span class="op" id="3868630">)</span><span class="op" id="3868631">&lt;&lt;</span><span class="num" id="3868633">16</span>&nbsp;<span class="op" id="3868636">|</span>&nbsp;<span class="builtintype" id="3868638">uint32</span><span class="op" id="3868644">(</span><span class="ident" id="3868645">src</span><span class="op" id="3868648">[</span><span class="num" id="3868649">10</span><span class="op" id="3868651">]</span><span class="op" id="3868652">)</span><span class="op" id="3868653">&lt;&lt;</span><span class="num" id="3868655">8</span>&nbsp;<span class="op" id="3868657">|</span>&nbsp;<span class="builtintype" id="3868659">uint32</span><span class="op" id="3868665">(</span><span class="ident" id="3868666">src</span><span class="op" id="3868669">[</span><span class="num" id="3868670">11</span><span class="op" id="3868672">]</span><span class="op" id="3868673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868676">s3</span>&nbsp;<span class="op" id="3868679">=</span>&nbsp;<span class="builtintype" id="3868681">uint32</span><span class="op" id="3868687">(</span><span class="ident" id="3868688">src</span><span class="op" id="3868691">[</span><span class="num" id="3868692">12</span><span class="op" id="3868694">]</span><span class="op" id="3868695">)</span><span class="op" id="3868696">&lt;&lt;</span><span class="num" id="3868698">24</span>&nbsp;<span class="op" id="3868701">|</span>&nbsp;<span class="builtintype" id="3868703">uint32</span><span class="op" id="3868709">(</span><span class="ident" id="3868710">src</span><span class="op" id="3868713">[</span><span class="num" id="3868714">13</span><span class="op" id="3868716">]</span><span class="op" id="3868717">)</span><span class="op" id="3868718">&lt;&lt;</span><span class="num" id="3868720">16</span>&nbsp;<span class="op" id="3868723">|</span>&nbsp;<span class="builtintype" id="3868725">uint32</span><span class="op" id="3868731">(</span><span class="ident" id="3868732">src</span><span class="op" id="3868735">[</span><span class="num" id="3868736">14</span><span class="op" id="3868738">]</span><span class="op" id="3868739">)</span><span class="op" id="3868740">&lt;&lt;</span><span class="num" id="3868742">8</span>&nbsp;<span class="op" id="3868744">|</span>&nbsp;<span class="builtintype" id="3868746">uint32</span><span class="op" id="3868752">(</span><span class="ident" id="3868753">src</span><span class="op" id="3868756">[</span><span class="num" id="3868757">15</span><span class="op" id="3868759">]</span><span class="op" id="3868760">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3868764">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868806">s0</span>&nbsp;<span class="op" id="3868809">^=</span>&nbsp;<span class="ident" id="3868812">xk</span><span class="op" id="3868814">[</span><span class="num" id="3868815">0</span><span class="op" id="3868816">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868819">s1</span>&nbsp;<span class="op" id="3868822">^=</span>&nbsp;<span class="ident" id="3868825">xk</span><span class="op" id="3868827">[</span><span class="num" id="3868828">1</span><span class="op" id="3868829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868832">s2</span>&nbsp;<span class="op" id="3868835">^=</span>&nbsp;<span class="ident" id="3868838">xk</span><span class="op" id="3868840">[</span><span class="num" id="3868841">2</span><span class="op" id="3868842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868845">s3</span>&nbsp;<span class="op" id="3868848">^=</span>&nbsp;<span class="ident" id="3868851">xk</span><span class="op" id="3868853">[</span><span class="num" id="3868854">3</span><span class="op" id="3868855">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3868859">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3868899">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3868954">nr</span>&nbsp;<span class="op" id="3868957">:=</span>&nbsp;<span class="builtinfunc" id="3868960">len</span><span class="op" id="3868963">(</span><span class="ident" id="3868964">xk</span><span class="op" id="3868966">)</span><span class="op" id="3868967">/</span><span class="num" id="3868968">4</span>&nbsp;<span class="op" id="3868970">-</span>&nbsp;<span class="num" id="3868972">2</span>&nbsp;<span class="comment" id="3868974">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869009">k</span>&nbsp;<span class="op" id="3869011">:=</span>&nbsp;<span class="num" id="3869014">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3869017">for</span>&nbsp;<span class="ident" id="3869021">r</span>&nbsp;<span class="op" id="3869023">:=</span>&nbsp;<span class="num" id="3869026">0</span><span class="op" id="3869027">;</span>&nbsp;<span class="ident" id="3869029">r</span>&nbsp;<span class="op" id="3869031">&lt;</span>&nbsp;<span class="ident" id="3869033">nr</span><span class="op" id="3869035">;</span>&nbsp;<span class="ident" id="3869037">r</span><span class="op" id="3869038">++</span>&nbsp;<span class="op" id="3869041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869045">t0</span>&nbsp;<span class="op" id="3869048">=</span>&nbsp;<span class="ident" id="3869050">xk</span><span class="op" id="3869052">[</span><span class="ident" id="3869053">k</span><span class="op" id="3869054">+</span><span class="num" id="3869055">0</span><span class="op" id="3869056">]</span>&nbsp;<span class="op" id="3869058">^</span>&nbsp;<span class="ident" id="3869060">te0</span><span class="op" id="3869063">[</span><span class="builtintype" id="3869064">uint8</span><span class="op" id="3869069">(</span><span class="ident" id="3869070">s0</span><span class="op" id="3869072">&gt;&gt;</span><span class="num" id="3869074">24</span><span class="op" id="3869076">)</span><span class="op" id="3869077">]</span>&nbsp;<span class="op" id="3869079">^</span>&nbsp;<span class="ident" id="3869081">te1</span><span class="op" id="3869084">[</span><span class="builtintype" id="3869085">uint8</span><span class="op" id="3869090">(</span><span class="ident" id="3869091">s1</span><span class="op" id="3869093">&gt;&gt;</span><span class="num" id="3869095">16</span><span class="op" id="3869097">)</span><span class="op" id="3869098">]</span>&nbsp;<span class="op" id="3869100">^</span>&nbsp;<span class="ident" id="3869102">te2</span><span class="op" id="3869105">[</span><span class="builtintype" id="3869106">uint8</span><span class="op" id="3869111">(</span><span class="ident" id="3869112">s2</span><span class="op" id="3869114">&gt;&gt;</span><span class="num" id="3869116">8</span><span class="op" id="3869117">)</span><span class="op" id="3869118">]</span>&nbsp;<span class="op" id="3869120">^</span>&nbsp;<span class="ident" id="3869122">te3</span><span class="op" id="3869125">[</span><span class="builtintype" id="3869126">uint8</span><span class="op" id="3869131">(</span><span class="ident" id="3869132">s3</span><span class="op" id="3869134">)</span><span class="op" id="3869135">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869139">t1</span>&nbsp;<span class="op" id="3869142">=</span>&nbsp;<span class="ident" id="3869144">xk</span><span class="op" id="3869146">[</span><span class="ident" id="3869147">k</span><span class="op" id="3869148">+</span><span class="num" id="3869149">1</span><span class="op" id="3869150">]</span>&nbsp;<span class="op" id="3869152">^</span>&nbsp;<span class="ident" id="3869154">te0</span><span class="op" id="3869157">[</span><span class="builtintype" id="3869158">uint8</span><span class="op" id="3869163">(</span><span class="ident" id="3869164">s1</span><span class="op" id="3869166">&gt;&gt;</span><span class="num" id="3869168">24</span><span class="op" id="3869170">)</span><span class="op" id="3869171">]</span>&nbsp;<span class="op" id="3869173">^</span>&nbsp;<span class="ident" id="3869175">te1</span><span class="op" id="3869178">[</span><span class="builtintype" id="3869179">uint8</span><span class="op" id="3869184">(</span><span class="ident" id="3869185">s2</span><span class="op" id="3869187">&gt;&gt;</span><span class="num" id="3869189">16</span><span class="op" id="3869191">)</span><span class="op" id="3869192">]</span>&nbsp;<span class="op" id="3869194">^</span>&nbsp;<span class="ident" id="3869196">te2</span><span class="op" id="3869199">[</span><span class="builtintype" id="3869200">uint8</span><span class="op" id="3869205">(</span><span class="ident" id="3869206">s3</span><span class="op" id="3869208">&gt;&gt;</span><span class="num" id="3869210">8</span><span class="op" id="3869211">)</span><span class="op" id="3869212">]</span>&nbsp;<span class="op" id="3869214">^</span>&nbsp;<span class="ident" id="3869216">te3</span><span class="op" id="3869219">[</span><span class="builtintype" id="3869220">uint8</span><span class="op" id="3869225">(</span><span class="ident" id="3869226">s0</span><span class="op" id="3869228">)</span><span class="op" id="3869229">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869233">t2</span>&nbsp;<span class="op" id="3869236">=</span>&nbsp;<span class="ident" id="3869238">xk</span><span class="op" id="3869240">[</span><span class="ident" id="3869241">k</span><span class="op" id="3869242">+</span><span class="num" id="3869243">2</span><span class="op" id="3869244">]</span>&nbsp;<span class="op" id="3869246">^</span>&nbsp;<span class="ident" id="3869248">te0</span><span class="op" id="3869251">[</span><span class="builtintype" id="3869252">uint8</span><span class="op" id="3869257">(</span><span class="ident" id="3869258">s2</span><span class="op" id="3869260">&gt;&gt;</span><span class="num" id="3869262">24</span><span class="op" id="3869264">)</span><span class="op" id="3869265">]</span>&nbsp;<span class="op" id="3869267">^</span>&nbsp;<span class="ident" id="3869269">te1</span><span class="op" id="3869272">[</span><span class="builtintype" id="3869273">uint8</span><span class="op" id="3869278">(</span><span class="ident" id="3869279">s3</span><span class="op" id="3869281">&gt;&gt;</span><span class="num" id="3869283">16</span><span class="op" id="3869285">)</span><span class="op" id="3869286">]</span>&nbsp;<span class="op" id="3869288">^</span>&nbsp;<span class="ident" id="3869290">te2</span><span class="op" id="3869293">[</span><span class="builtintype" id="3869294">uint8</span><span class="op" id="3869299">(</span><span class="ident" id="3869300">s0</span><span class="op" id="3869302">&gt;&gt;</span><span class="num" id="3869304">8</span><span class="op" id="3869305">)</span><span class="op" id="3869306">]</span>&nbsp;<span class="op" id="3869308">^</span>&nbsp;<span class="ident" id="3869310">te3</span><span class="op" id="3869313">[</span><span class="builtintype" id="3869314">uint8</span><span class="op" id="3869319">(</span><span class="ident" id="3869320">s1</span><span class="op" id="3869322">)</span><span class="op" id="3869323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869327">t3</span>&nbsp;<span class="op" id="3869330">=</span>&nbsp;<span class="ident" id="3869332">xk</span><span class="op" id="3869334">[</span><span class="ident" id="3869335">k</span><span class="op" id="3869336">+</span><span class="num" id="3869337">3</span><span class="op" id="3869338">]</span>&nbsp;<span class="op" id="3869340">^</span>&nbsp;<span class="ident" id="3869342">te0</span><span class="op" id="3869345">[</span><span class="builtintype" id="3869346">uint8</span><span class="op" id="3869351">(</span><span class="ident" id="3869352">s3</span><span class="op" id="3869354">&gt;&gt;</span><span class="num" id="3869356">24</span><span class="op" id="3869358">)</span><span class="op" id="3869359">]</span>&nbsp;<span class="op" id="3869361">^</span>&nbsp;<span class="ident" id="3869363">te1</span><span class="op" id="3869366">[</span><span class="builtintype" id="3869367">uint8</span><span class="op" id="3869372">(</span><span class="ident" id="3869373">s0</span><span class="op" id="3869375">&gt;&gt;</span><span class="num" id="3869377">16</span><span class="op" id="3869379">)</span><span class="op" id="3869380">]</span>&nbsp;<span class="op" id="3869382">^</span>&nbsp;<span class="ident" id="3869384">te2</span><span class="op" id="3869387">[</span><span class="builtintype" id="3869388">uint8</span><span class="op" id="3869393">(</span><span class="ident" id="3869394">s1</span><span class="op" id="3869396">&gt;&gt;</span><span class="num" id="3869398">8</span><span class="op" id="3869399">)</span><span class="op" id="3869400">]</span>&nbsp;<span class="op" id="3869402">^</span>&nbsp;<span class="ident" id="3869404">te3</span><span class="op" id="3869407">[</span><span class="builtintype" id="3869408">uint8</span><span class="op" id="3869413">(</span><span class="ident" id="3869414">s2</span><span class="op" id="3869416">)</span><span class="op" id="3869417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869421">k</span>&nbsp;<span class="op" id="3869423">+=</span>&nbsp;<span class="num" id="3869426">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869430">s0</span><span class="op" id="3869432">,</span>&nbsp;<span class="ident" id="3869434">s1</span><span class="op" id="3869436">,</span>&nbsp;<span class="ident" id="3869438">s2</span><span class="op" id="3869440">,</span>&nbsp;<span class="ident" id="3869442">s3</span>&nbsp;<span class="op" id="3869445">=</span>&nbsp;<span class="ident" id="3869447">t0</span><span class="op" id="3869449">,</span>&nbsp;<span class="ident" id="3869451">t1</span><span class="op" id="3869453">,</span>&nbsp;<span class="ident" id="3869455">t2</span><span class="op" id="3869457">,</span>&nbsp;<span class="ident" id="3869459">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3869463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3869467">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869530">s0</span>&nbsp;<span class="op" id="3869533">=</span>&nbsp;<span class="builtintype" id="3869535">uint32</span><span class="op" id="3869541">(</span><span class="ident" id="3869542">sbox0</span><span class="op" id="3869547">[</span><span class="ident" id="3869548">t0</span><span class="op" id="3869550">&gt;&gt;</span><span class="num" id="3869552">24</span><span class="op" id="3869554">]</span><span class="op" id="3869555">)</span><span class="op" id="3869556">&lt;&lt;</span><span class="num" id="3869558">24</span>&nbsp;<span class="op" id="3869561">|</span>&nbsp;<span class="builtintype" id="3869563">uint32</span><span class="op" id="3869569">(</span><span class="ident" id="3869570">sbox0</span><span class="op" id="3869575">[</span><span class="ident" id="3869576">t1</span><span class="op" id="3869578">&gt;&gt;</span><span class="num" id="3869580">16</span><span class="op" id="3869582">&amp;</span><span class="num" id="3869583">0xff</span><span class="op" id="3869587">]</span><span class="op" id="3869588">)</span><span class="op" id="3869589">&lt;&lt;</span><span class="num" id="3869591">16</span>&nbsp;<span class="op" id="3869594">|</span>&nbsp;<span class="builtintype" id="3869596">uint32</span><span class="op" id="3869602">(</span><span class="ident" id="3869603">sbox0</span><span class="op" id="3869608">[</span><span class="ident" id="3869609">t2</span><span class="op" id="3869611">&gt;&gt;</span><span class="num" id="3869613">8</span><span class="op" id="3869614">&amp;</span><span class="num" id="3869615">0xff</span><span class="op" id="3869619">]</span><span class="op" id="3869620">)</span><span class="op" id="3869621">&lt;&lt;</span><span class="num" id="3869623">8</span>&nbsp;<span class="op" id="3869625">|</span>&nbsp;<span class="builtintype" id="3869627">uint32</span><span class="op" id="3869633">(</span><span class="ident" id="3869634">sbox0</span><span class="op" id="3869639">[</span><span class="ident" id="3869640">t3</span><span class="op" id="3869642">&amp;</span><span class="num" id="3869643">0xff</span><span class="op" id="3869647">]</span><span class="op" id="3869648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869651">s1</span>&nbsp;<span class="op" id="3869654">=</span>&nbsp;<span class="builtintype" id="3869656">uint32</span><span class="op" id="3869662">(</span><span class="ident" id="3869663">sbox0</span><span class="op" id="3869668">[</span><span class="ident" id="3869669">t1</span><span class="op" id="3869671">&gt;&gt;</span><span class="num" id="3869673">24</span><span class="op" id="3869675">]</span><span class="op" id="3869676">)</span><span class="op" id="3869677">&lt;&lt;</span><span class="num" id="3869679">24</span>&nbsp;<span class="op" id="3869682">|</span>&nbsp;<span class="builtintype" id="3869684">uint32</span><span class="op" id="3869690">(</span><span class="ident" id="3869691">sbox0</span><span class="op" id="3869696">[</span><span class="ident" id="3869697">t2</span><span class="op" id="3869699">&gt;&gt;</span><span class="num" id="3869701">16</span><span class="op" id="3869703">&amp;</span><span class="num" id="3869704">0xff</span><span class="op" id="3869708">]</span><span class="op" id="3869709">)</span><span class="op" id="3869710">&lt;&lt;</span><span class="num" id="3869712">16</span>&nbsp;<span class="op" id="3869715">|</span>&nbsp;<span class="builtintype" id="3869717">uint32</span><span class="op" id="3869723">(</span><span class="ident" id="3869724">sbox0</span><span class="op" id="3869729">[</span><span class="ident" id="3869730">t3</span><span class="op" id="3869732">&gt;&gt;</span><span class="num" id="3869734">8</span><span class="op" id="3869735">&amp;</span><span class="num" id="3869736">0xff</span><span class="op" id="3869740">]</span><span class="op" id="3869741">)</span><span class="op" id="3869742">&lt;&lt;</span><span class="num" id="3869744">8</span>&nbsp;<span class="op" id="3869746">|</span>&nbsp;<span class="builtintype" id="3869748">uint32</span><span class="op" id="3869754">(</span><span class="ident" id="3869755">sbox0</span><span class="op" id="3869760">[</span><span class="ident" id="3869761">t0</span><span class="op" id="3869763">&amp;</span><span class="num" id="3869764">0xff</span><span class="op" id="3869768">]</span><span class="op" id="3869769">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869772">s2</span>&nbsp;<span class="op" id="3869775">=</span>&nbsp;<span class="builtintype" id="3869777">uint32</span><span class="op" id="3869783">(</span><span class="ident" id="3869784">sbox0</span><span class="op" id="3869789">[</span><span class="ident" id="3869790">t2</span><span class="op" id="3869792">&gt;&gt;</span><span class="num" id="3869794">24</span><span class="op" id="3869796">]</span><span class="op" id="3869797">)</span><span class="op" id="3869798">&lt;&lt;</span><span class="num" id="3869800">24</span>&nbsp;<span class="op" id="3869803">|</span>&nbsp;<span class="builtintype" id="3869805">uint32</span><span class="op" id="3869811">(</span><span class="ident" id="3869812">sbox0</span><span class="op" id="3869817">[</span><span class="ident" id="3869818">t3</span><span class="op" id="3869820">&gt;&gt;</span><span class="num" id="3869822">16</span><span class="op" id="3869824">&amp;</span><span class="num" id="3869825">0xff</span><span class="op" id="3869829">]</span><span class="op" id="3869830">)</span><span class="op" id="3869831">&lt;&lt;</span><span class="num" id="3869833">16</span>&nbsp;<span class="op" id="3869836">|</span>&nbsp;<span class="builtintype" id="3869838">uint32</span><span class="op" id="3869844">(</span><span class="ident" id="3869845">sbox0</span><span class="op" id="3869850">[</span><span class="ident" id="3869851">t0</span><span class="op" id="3869853">&gt;&gt;</span><span class="num" id="3869855">8</span><span class="op" id="3869856">&amp;</span><span class="num" id="3869857">0xff</span><span class="op" id="3869861">]</span><span class="op" id="3869862">)</span><span class="op" id="3869863">&lt;&lt;</span><span class="num" id="3869865">8</span>&nbsp;<span class="op" id="3869867">|</span>&nbsp;<span class="builtintype" id="3869869">uint32</span><span class="op" id="3869875">(</span><span class="ident" id="3869876">sbox0</span><span class="op" id="3869881">[</span><span class="ident" id="3869882">t1</span><span class="op" id="3869884">&amp;</span><span class="num" id="3869885">0xff</span><span class="op" id="3869889">]</span><span class="op" id="3869890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3869893">s3</span>&nbsp;<span class="op" id="3869896">=</span>&nbsp;<span class="builtintype" id="3869898">uint32</span><span class="op" id="3869904">(</span><span class="ident" id="3869905">sbox0</span><span class="op" id="3869910">[</span><span class="ident" id="3869911">t3</span><span class="op" id="3869913">&gt;&gt;</span><span class="num" id="3869915">24</span><span class="op" id="3869917">]</span><span class="op" id="3869918">)</span><span class="op" id="3869919">&lt;&lt;</span><span class="num" id="3869921">24</span>&nbsp;<span class="op" id="3869924">|</span>&nbsp;<span class="builtintype" id="3869926">uint32</span><span class="op" id="3869932">(</span><span class="ident" id="3869933">sbox0</span><span class="op" id="3869938">[</span><span class="ident" id="3869939">t0</span><span class="op" id="3869941">&gt;&gt;</span><span class="num" id="3869943">16</span><span class="op" id="3869945">&amp;</span><span class="num" id="3869946">0xff</span><span class="op" id="3869950">]</span><span class="op" id="3869951">)</span><span class="op" id="3869952">&lt;&lt;</span><span class="num" id="3869954">16</span>&nbsp;<span class="op" id="3869957">|</span>&nbsp;<span class="builtintype" id="3869959">uint32</span><span class="op" id="3869965">(</span><span class="ident" id="3869966">sbox0</span><span class="op" id="3869971">[</span><span class="ident" id="3869972">t1</span><span class="op" id="3869974">&gt;&gt;</span><span class="num" id="3869976">8</span><span class="op" id="3869977">&amp;</span><span class="num" id="3869978">0xff</span><span class="op" id="3869982">]</span><span class="op" id="3869983">)</span><span class="op" id="3869984">&lt;&lt;</span><span class="num" id="3869986">8</span>&nbsp;<span class="op" id="3869988">|</span>&nbsp;<span class="builtintype" id="3869990">uint32</span><span class="op" id="3869996">(</span><span class="ident" id="3869997">sbox0</span><span class="op" id="3870002">[</span><span class="ident" id="3870003">t2</span><span class="op" id="3870005">&amp;</span><span class="num" id="3870006">0xff</span><span class="op" id="3870010">]</span><span class="op" id="3870011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870015">s0</span>&nbsp;<span class="op" id="3870018">^=</span>&nbsp;<span class="ident" id="3870021">xk</span><span class="op" id="3870023">[</span><span class="ident" id="3870024">k</span><span class="op" id="3870025">+</span><span class="num" id="3870026">0</span><span class="op" id="3870027">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870030">s1</span>&nbsp;<span class="op" id="3870033">^=</span>&nbsp;<span class="ident" id="3870036">xk</span><span class="op" id="3870038">[</span><span class="ident" id="3870039">k</span><span class="op" id="3870040">+</span><span class="num" id="3870041">1</span><span class="op" id="3870042">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870045">s2</span>&nbsp;<span class="op" id="3870048">^=</span>&nbsp;<span class="ident" id="3870051">xk</span><span class="op" id="3870053">[</span><span class="ident" id="3870054">k</span><span class="op" id="3870055">+</span><span class="num" id="3870056">2</span><span class="op" id="3870057">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870060">s3</span>&nbsp;<span class="op" id="3870063">^=</span>&nbsp;<span class="ident" id="3870066">xk</span><span class="op" id="3870068">[</span><span class="ident" id="3870069">k</span><span class="op" id="3870070">+</span><span class="num" id="3870071">3</span><span class="op" id="3870072">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870076">dst</span><span class="op" id="3870079">[</span><span class="num" id="3870080">0</span><span class="op" id="3870081">]</span><span class="op" id="3870082">,</span>&nbsp;<span class="ident" id="3870084">dst</span><span class="op" id="3870087">[</span><span class="num" id="3870088">1</span><span class="op" id="3870089">]</span><span class="op" id="3870090">,</span>&nbsp;<span class="ident" id="3870092">dst</span><span class="op" id="3870095">[</span><span class="num" id="3870096">2</span><span class="op" id="3870097">]</span><span class="op" id="3870098">,</span>&nbsp;<span class="ident" id="3870100">dst</span><span class="op" id="3870103">[</span><span class="num" id="3870104">3</span><span class="op" id="3870105">]</span>&nbsp;<span class="op" id="3870107">=</span>&nbsp;<span class="builtintype" id="3870109">byte</span><span class="op" id="3870113">(</span><span class="ident" id="3870114">s0</span><span class="op" id="3870116">&gt;&gt;</span><span class="num" id="3870118">24</span><span class="op" id="3870120">)</span><span class="op" id="3870121">,</span>&nbsp;<span class="builtintype" id="3870123">byte</span><span class="op" id="3870127">(</span><span class="ident" id="3870128">s0</span><span class="op" id="3870130">&gt;&gt;</span><span class="num" id="3870132">16</span><span class="op" id="3870134">)</span><span class="op" id="3870135">,</span>&nbsp;<span class="builtintype" id="3870137">byte</span><span class="op" id="3870141">(</span><span class="ident" id="3870142">s0</span><span class="op" id="3870144">&gt;&gt;</span><span class="num" id="3870146">8</span><span class="op" id="3870147">)</span><span class="op" id="3870148">,</span>&nbsp;<span class="builtintype" id="3870150">byte</span><span class="op" id="3870154">(</span><span class="ident" id="3870155">s0</span><span class="op" id="3870157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870160">dst</span><span class="op" id="3870163">[</span><span class="num" id="3870164">4</span><span class="op" id="3870165">]</span><span class="op" id="3870166">,</span>&nbsp;<span class="ident" id="3870168">dst</span><span class="op" id="3870171">[</span><span class="num" id="3870172">5</span><span class="op" id="3870173">]</span><span class="op" id="3870174">,</span>&nbsp;<span class="ident" id="3870176">dst</span><span class="op" id="3870179">[</span><span class="num" id="3870180">6</span><span class="op" id="3870181">]</span><span class="op" id="3870182">,</span>&nbsp;<span class="ident" id="3870184">dst</span><span class="op" id="3870187">[</span><span class="num" id="3870188">7</span><span class="op" id="3870189">]</span>&nbsp;<span class="op" id="3870191">=</span>&nbsp;<span class="builtintype" id="3870193">byte</span><span class="op" id="3870197">(</span><span class="ident" id="3870198">s1</span><span class="op" id="3870200">&gt;&gt;</span><span class="num" id="3870202">24</span><span class="op" id="3870204">)</span><span class="op" id="3870205">,</span>&nbsp;<span class="builtintype" id="3870207">byte</span><span class="op" id="3870211">(</span><span class="ident" id="3870212">s1</span><span class="op" id="3870214">&gt;&gt;</span><span class="num" id="3870216">16</span><span class="op" id="3870218">)</span><span class="op" id="3870219">,</span>&nbsp;<span class="builtintype" id="3870221">byte</span><span class="op" id="3870225">(</span><span class="ident" id="3870226">s1</span><span class="op" id="3870228">&gt;&gt;</span><span class="num" id="3870230">8</span><span class="op" id="3870231">)</span><span class="op" id="3870232">,</span>&nbsp;<span class="builtintype" id="3870234">byte</span><span class="op" id="3870238">(</span><span class="ident" id="3870239">s1</span><span class="op" id="3870241">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870244">dst</span><span class="op" id="3870247">[</span><span class="num" id="3870248">8</span><span class="op" id="3870249">]</span><span class="op" id="3870250">,</span>&nbsp;<span class="ident" id="3870252">dst</span><span class="op" id="3870255">[</span><span class="num" id="3870256">9</span><span class="op" id="3870257">]</span><span class="op" id="3870258">,</span>&nbsp;<span class="ident" id="3870260">dst</span><span class="op" id="3870263">[</span><span class="num" id="3870264">10</span><span class="op" id="3870266">]</span><span class="op" id="3870267">,</span>&nbsp;<span class="ident" id="3870269">dst</span><span class="op" id="3870272">[</span><span class="num" id="3870273">11</span><span class="op" id="3870275">]</span>&nbsp;<span class="op" id="3870277">=</span>&nbsp;<span class="builtintype" id="3870279">byte</span><span class="op" id="3870283">(</span><span class="ident" id="3870284">s2</span><span class="op" id="3870286">&gt;&gt;</span><span class="num" id="3870288">24</span><span class="op" id="3870290">)</span><span class="op" id="3870291">,</span>&nbsp;<span class="builtintype" id="3870293">byte</span><span class="op" id="3870297">(</span><span class="ident" id="3870298">s2</span><span class="op" id="3870300">&gt;&gt;</span><span class="num" id="3870302">16</span><span class="op" id="3870304">)</span><span class="op" id="3870305">,</span>&nbsp;<span class="builtintype" id="3870307">byte</span><span class="op" id="3870311">(</span><span class="ident" id="3870312">s2</span><span class="op" id="3870314">&gt;&gt;</span><span class="num" id="3870316">8</span><span class="op" id="3870317">)</span><span class="op" id="3870318">,</span>&nbsp;<span class="builtintype" id="3870320">byte</span><span class="op" id="3870324">(</span><span class="ident" id="3870325">s2</span><span class="op" id="3870327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870330">dst</span><span class="op" id="3870333">[</span><span class="num" id="3870334">12</span><span class="op" id="3870336">]</span><span class="op" id="3870337">,</span>&nbsp;<span class="ident" id="3870339">dst</span><span class="op" id="3870342">[</span><span class="num" id="3870343">13</span><span class="op" id="3870345">]</span><span class="op" id="3870346">,</span>&nbsp;<span class="ident" id="3870348">dst</span><span class="op" id="3870351">[</span><span class="num" id="3870352">14</span><span class="op" id="3870354">]</span><span class="op" id="3870355">,</span>&nbsp;<span class="ident" id="3870357">dst</span><span class="op" id="3870360">[</span><span class="num" id="3870361">15</span><span class="op" id="3870363">]</span>&nbsp;<span class="op" id="3870365">=</span>&nbsp;<span class="builtintype" id="3870367">byte</span><span class="op" id="3870371">(</span><span class="ident" id="3870372">s3</span><span class="op" id="3870374">&gt;&gt;</span><span class="num" id="3870376">24</span><span class="op" id="3870378">)</span><span class="op" id="3870379">,</span>&nbsp;<span class="builtintype" id="3870381">byte</span><span class="op" id="3870385">(</span><span class="ident" id="3870386">s3</span><span class="op" id="3870388">&gt;&gt;</span><span class="num" id="3870390">16</span><span class="op" id="3870392">)</span><span class="op" id="3870393">,</span>&nbsp;<span class="builtintype" id="3870395">byte</span><span class="op" id="3870399">(</span><span class="ident" id="3870400">s3</span><span class="op" id="3870402">&gt;&gt;</span><span class="num" id="3870404">8</span><span class="op" id="3870405">)</span><span class="op" id="3870406">,</span>&nbsp;<span class="builtintype" id="3870408">byte</span><span class="op" id="3870412">(</span><span class="ident" id="3870413">s3</span><span class="op" id="3870415">)</span><br>
<span class="lineno"></span><span class="op" id="3870417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3870420">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3870487">func</span>&nbsp;<span class="ident" id="3870492">decryptBlockGo</span><span class="op" id="3870506">(</span><span class="ident" id="3870507">xk</span>&nbsp;<span class="op" id="3870510">[</span><span class="op" id="3870511">]</span><span class="builtintype" id="3870512">uint32</span><span class="op" id="3870518">,</span>&nbsp;<span class="ident" id="3870520">dst</span><span class="op" id="3870523">,</span>&nbsp;<span class="ident" id="3870525">src</span>&nbsp;<span class="op" id="3870529">[</span><span class="op" id="3870530">]</span><span class="builtintype" id="3870531">byte</span><span class="op" id="3870535">)</span>&nbsp;<span class="op" id="3870537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3870540">var</span>&nbsp;<span class="ident" id="3870544">s0</span><span class="op" id="3870546">,</span>&nbsp;<span class="ident" id="3870548">s1</span><span class="op" id="3870550">,</span>&nbsp;<span class="ident" id="3870552">s2</span><span class="op" id="3870554">,</span>&nbsp;<span class="ident" id="3870556">s3</span><span class="op" id="3870558">,</span>&nbsp;<span class="ident" id="3870560">t0</span><span class="op" id="3870562">,</span>&nbsp;<span class="ident" id="3870564">t1</span><span class="op" id="3870566">,</span>&nbsp;<span class="ident" id="3870568">t2</span><span class="op" id="3870570">,</span>&nbsp;<span class="ident" id="3870572">t3</span>&nbsp;<span class="builtintype" id="3870575">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870584">s0</span>&nbsp;<span class="op" id="3870587">=</span>&nbsp;<span class="builtintype" id="3870589">uint32</span><span class="op" id="3870595">(</span><span class="ident" id="3870596">src</span><span class="op" id="3870599">[</span><span class="num" id="3870600">0</span><span class="op" id="3870601">]</span><span class="op" id="3870602">)</span><span class="op" id="3870603">&lt;&lt;</span><span class="num" id="3870605">24</span>&nbsp;<span class="op" id="3870608">|</span>&nbsp;<span class="builtintype" id="3870610">uint32</span><span class="op" id="3870616">(</span><span class="ident" id="3870617">src</span><span class="op" id="3870620">[</span><span class="num" id="3870621">1</span><span class="op" id="3870622">]</span><span class="op" id="3870623">)</span><span class="op" id="3870624">&lt;&lt;</span><span class="num" id="3870626">16</span>&nbsp;<span class="op" id="3870629">|</span>&nbsp;<span class="builtintype" id="3870631">uint32</span><span class="op" id="3870637">(</span><span class="ident" id="3870638">src</span><span class="op" id="3870641">[</span><span class="num" id="3870642">2</span><span class="op" id="3870643">]</span><span class="op" id="3870644">)</span><span class="op" id="3870645">&lt;&lt;</span><span class="num" id="3870647">8</span>&nbsp;<span class="op" id="3870649">|</span>&nbsp;<span class="builtintype" id="3870651">uint32</span><span class="op" id="3870657">(</span><span class="ident" id="3870658">src</span><span class="op" id="3870661">[</span><span class="num" id="3870662">3</span><span class="op" id="3870663">]</span><span class="op" id="3870664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870667">s1</span>&nbsp;<span class="op" id="3870670">=</span>&nbsp;<span class="builtintype" id="3870672">uint32</span><span class="op" id="3870678">(</span><span class="ident" id="3870679">src</span><span class="op" id="3870682">[</span><span class="num" id="3870683">4</span><span class="op" id="3870684">]</span><span class="op" id="3870685">)</span><span class="op" id="3870686">&lt;&lt;</span><span class="num" id="3870688">24</span>&nbsp;<span class="op" id="3870691">|</span>&nbsp;<span class="builtintype" id="3870693">uint32</span><span class="op" id="3870699">(</span><span class="ident" id="3870700">src</span><span class="op" id="3870703">[</span><span class="num" id="3870704">5</span><span class="op" id="3870705">]</span><span class="op" id="3870706">)</span><span class="op" id="3870707">&lt;&lt;</span><span class="num" id="3870709">16</span>&nbsp;<span class="op" id="3870712">|</span>&nbsp;<span class="builtintype" id="3870714">uint32</span><span class="op" id="3870720">(</span><span class="ident" id="3870721">src</span><span class="op" id="3870724">[</span><span class="num" id="3870725">6</span><span class="op" id="3870726">]</span><span class="op" id="3870727">)</span><span class="op" id="3870728">&lt;&lt;</span><span class="num" id="3870730">8</span>&nbsp;<span class="op" id="3870732">|</span>&nbsp;<span class="builtintype" id="3870734">uint32</span><span class="op" id="3870740">(</span><span class="ident" id="3870741">src</span><span class="op" id="3870744">[</span><span class="num" id="3870745">7</span><span class="op" id="3870746">]</span><span class="op" id="3870747">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870750">s2</span>&nbsp;<span class="op" id="3870753">=</span>&nbsp;<span class="builtintype" id="3870755">uint32</span><span class="op" id="3870761">(</span><span class="ident" id="3870762">src</span><span class="op" id="3870765">[</span><span class="num" id="3870766">8</span><span class="op" id="3870767">]</span><span class="op" id="3870768">)</span><span class="op" id="3870769">&lt;&lt;</span><span class="num" id="3870771">24</span>&nbsp;<span class="op" id="3870774">|</span>&nbsp;<span class="builtintype" id="3870776">uint32</span><span class="op" id="3870782">(</span><span class="ident" id="3870783">src</span><span class="op" id="3870786">[</span><span class="num" id="3870787">9</span><span class="op" id="3870788">]</span><span class="op" id="3870789">)</span><span class="op" id="3870790">&lt;&lt;</span><span class="num" id="3870792">16</span>&nbsp;<span class="op" id="3870795">|</span>&nbsp;<span class="builtintype" id="3870797">uint32</span><span class="op" id="3870803">(</span><span class="ident" id="3870804">src</span><span class="op" id="3870807">[</span><span class="num" id="3870808">10</span><span class="op" id="3870810">]</span><span class="op" id="3870811">)</span><span class="op" id="3870812">&lt;&lt;</span><span class="num" id="3870814">8</span>&nbsp;<span class="op" id="3870816">|</span>&nbsp;<span class="builtintype" id="3870818">uint32</span><span class="op" id="3870824">(</span><span class="ident" id="3870825">src</span><span class="op" id="3870828">[</span><span class="num" id="3870829">11</span><span class="op" id="3870831">]</span><span class="op" id="3870832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870835">s3</span>&nbsp;<span class="op" id="3870838">=</span>&nbsp;<span class="builtintype" id="3870840">uint32</span><span class="op" id="3870846">(</span><span class="ident" id="3870847">src</span><span class="op" id="3870850">[</span><span class="num" id="3870851">12</span><span class="op" id="3870853">]</span><span class="op" id="3870854">)</span><span class="op" id="3870855">&lt;&lt;</span><span class="num" id="3870857">24</span>&nbsp;<span class="op" id="3870860">|</span>&nbsp;<span class="builtintype" id="3870862">uint32</span><span class="op" id="3870868">(</span><span class="ident" id="3870869">src</span><span class="op" id="3870872">[</span><span class="num" id="3870873">13</span><span class="op" id="3870875">]</span><span class="op" id="3870876">)</span><span class="op" id="3870877">&lt;&lt;</span><span class="num" id="3870879">16</span>&nbsp;<span class="op" id="3870882">|</span>&nbsp;<span class="builtintype" id="3870884">uint32</span><span class="op" id="3870890">(</span><span class="ident" id="3870891">src</span><span class="op" id="3870894">[</span><span class="num" id="3870895">14</span><span class="op" id="3870897">]</span><span class="op" id="3870898">)</span><span class="op" id="3870899">&lt;&lt;</span><span class="num" id="3870901">8</span>&nbsp;<span class="op" id="3870903">|</span>&nbsp;<span class="builtintype" id="3870905">uint32</span><span class="op" id="3870911">(</span><span class="ident" id="3870912">src</span><span class="op" id="3870915">[</span><span class="num" id="3870916">15</span><span class="op" id="3870918">]</span><span class="op" id="3870919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3870923">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870965">s0</span>&nbsp;<span class="op" id="3870968">^=</span>&nbsp;<span class="ident" id="3870971">xk</span><span class="op" id="3870973">[</span><span class="num" id="3870974">0</span><span class="op" id="3870975">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870978">s1</span>&nbsp;<span class="op" id="3870981">^=</span>&nbsp;<span class="ident" id="3870984">xk</span><span class="op" id="3870986">[</span><span class="num" id="3870987">1</span><span class="op" id="3870988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3870991">s2</span>&nbsp;<span class="op" id="3870994">^=</span>&nbsp;<span class="ident" id="3870997">xk</span><span class="op" id="3870999">[</span><span class="num" id="3871000">2</span><span class="op" id="3871001">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871004">s3</span>&nbsp;<span class="op" id="3871007">^=</span>&nbsp;<span class="ident" id="3871010">xk</span><span class="op" id="3871012">[</span><span class="num" id="3871013">3</span><span class="op" id="3871014">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871018">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871058">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871113">nr</span>&nbsp;<span class="op" id="3871116">:=</span>&nbsp;<span class="builtinfunc" id="3871119">len</span><span class="op" id="3871122">(</span><span class="ident" id="3871123">xk</span><span class="op" id="3871125">)</span><span class="op" id="3871126">/</span><span class="num" id="3871127">4</span>&nbsp;<span class="op" id="3871129">-</span>&nbsp;<span class="num" id="3871131">2</span>&nbsp;<span class="comment" id="3871133">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871168">k</span>&nbsp;<span class="op" id="3871170">:=</span>&nbsp;<span class="num" id="3871173">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3871176">for</span>&nbsp;<span class="ident" id="3871180">r</span>&nbsp;<span class="op" id="3871182">:=</span>&nbsp;<span class="num" id="3871185">0</span><span class="op" id="3871186">;</span>&nbsp;<span class="ident" id="3871188">r</span>&nbsp;<span class="op" id="3871190">&lt;</span>&nbsp;<span class="ident" id="3871192">nr</span><span class="op" id="3871194">;</span>&nbsp;<span class="ident" id="3871196">r</span><span class="op" id="3871197">++</span>&nbsp;<span class="op" id="3871200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871204">t0</span>&nbsp;<span class="op" id="3871207">=</span>&nbsp;<span class="ident" id="3871209">xk</span><span class="op" id="3871211">[</span><span class="ident" id="3871212">k</span><span class="op" id="3871213">+</span><span class="num" id="3871214">0</span><span class="op" id="3871215">]</span>&nbsp;<span class="op" id="3871217">^</span>&nbsp;<span class="ident" id="3871219">td0</span><span class="op" id="3871222">[</span><span class="builtintype" id="3871223">uint8</span><span class="op" id="3871228">(</span><span class="ident" id="3871229">s0</span><span class="op" id="3871231">&gt;&gt;</span><span class="num" id="3871233">24</span><span class="op" id="3871235">)</span><span class="op" id="3871236">]</span>&nbsp;<span class="op" id="3871238">^</span>&nbsp;<span class="ident" id="3871240">td1</span><span class="op" id="3871243">[</span><span class="builtintype" id="3871244">uint8</span><span class="op" id="3871249">(</span><span class="ident" id="3871250">s3</span><span class="op" id="3871252">&gt;&gt;</span><span class="num" id="3871254">16</span><span class="op" id="3871256">)</span><span class="op" id="3871257">]</span>&nbsp;<span class="op" id="3871259">^</span>&nbsp;<span class="ident" id="3871261">td2</span><span class="op" id="3871264">[</span><span class="builtintype" id="3871265">uint8</span><span class="op" id="3871270">(</span><span class="ident" id="3871271">s2</span><span class="op" id="3871273">&gt;&gt;</span><span class="num" id="3871275">8</span><span class="op" id="3871276">)</span><span class="op" id="3871277">]</span>&nbsp;<span class="op" id="3871279">^</span>&nbsp;<span class="ident" id="3871281">td3</span><span class="op" id="3871284">[</span><span class="builtintype" id="3871285">uint8</span><span class="op" id="3871290">(</span><span class="ident" id="3871291">s1</span><span class="op" id="3871293">)</span><span class="op" id="3871294">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871298">t1</span>&nbsp;<span class="op" id="3871301">=</span>&nbsp;<span class="ident" id="3871303">xk</span><span class="op" id="3871305">[</span><span class="ident" id="3871306">k</span><span class="op" id="3871307">+</span><span class="num" id="3871308">1</span><span class="op" id="3871309">]</span>&nbsp;<span class="op" id="3871311">^</span>&nbsp;<span class="ident" id="3871313">td0</span><span class="op" id="3871316">[</span><span class="builtintype" id="3871317">uint8</span><span class="op" id="3871322">(</span><span class="ident" id="3871323">s1</span><span class="op" id="3871325">&gt;&gt;</span><span class="num" id="3871327">24</span><span class="op" id="3871329">)</span><span class="op" id="3871330">]</span>&nbsp;<span class="op" id="3871332">^</span>&nbsp;<span class="ident" id="3871334">td1</span><span class="op" id="3871337">[</span><span class="builtintype" id="3871338">uint8</span><span class="op" id="3871343">(</span><span class="ident" id="3871344">s0</span><span class="op" id="3871346">&gt;&gt;</span><span class="num" id="3871348">16</span><span class="op" id="3871350">)</span><span class="op" id="3871351">]</span>&nbsp;<span class="op" id="3871353">^</span>&nbsp;<span class="ident" id="3871355">td2</span><span class="op" id="3871358">[</span><span class="builtintype" id="3871359">uint8</span><span class="op" id="3871364">(</span><span class="ident" id="3871365">s3</span><span class="op" id="3871367">&gt;&gt;</span><span class="num" id="3871369">8</span><span class="op" id="3871370">)</span><span class="op" id="3871371">]</span>&nbsp;<span class="op" id="3871373">^</span>&nbsp;<span class="ident" id="3871375">td3</span><span class="op" id="3871378">[</span><span class="builtintype" id="3871379">uint8</span><span class="op" id="3871384">(</span><span class="ident" id="3871385">s2</span><span class="op" id="3871387">)</span><span class="op" id="3871388">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871392">t2</span>&nbsp;<span class="op" id="3871395">=</span>&nbsp;<span class="ident" id="3871397">xk</span><span class="op" id="3871399">[</span><span class="ident" id="3871400">k</span><span class="op" id="3871401">+</span><span class="num" id="3871402">2</span><span class="op" id="3871403">]</span>&nbsp;<span class="op" id="3871405">^</span>&nbsp;<span class="ident" id="3871407">td0</span><span class="op" id="3871410">[</span><span class="builtintype" id="3871411">uint8</span><span class="op" id="3871416">(</span><span class="ident" id="3871417">s2</span><span class="op" id="3871419">&gt;&gt;</span><span class="num" id="3871421">24</span><span class="op" id="3871423">)</span><span class="op" id="3871424">]</span>&nbsp;<span class="op" id="3871426">^</span>&nbsp;<span class="ident" id="3871428">td1</span><span class="op" id="3871431">[</span><span class="builtintype" id="3871432">uint8</span><span class="op" id="3871437">(</span><span class="ident" id="3871438">s1</span><span class="op" id="3871440">&gt;&gt;</span><span class="num" id="3871442">16</span><span class="op" id="3871444">)</span><span class="op" id="3871445">]</span>&nbsp;<span class="op" id="3871447">^</span>&nbsp;<span class="ident" id="3871449">td2</span><span class="op" id="3871452">[</span><span class="builtintype" id="3871453">uint8</span><span class="op" id="3871458">(</span><span class="ident" id="3871459">s0</span><span class="op" id="3871461">&gt;&gt;</span><span class="num" id="3871463">8</span><span class="op" id="3871464">)</span><span class="op" id="3871465">]</span>&nbsp;<span class="op" id="3871467">^</span>&nbsp;<span class="ident" id="3871469">td3</span><span class="op" id="3871472">[</span><span class="builtintype" id="3871473">uint8</span><span class="op" id="3871478">(</span><span class="ident" id="3871479">s3</span><span class="op" id="3871481">)</span><span class="op" id="3871482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871486">t3</span>&nbsp;<span class="op" id="3871489">=</span>&nbsp;<span class="ident" id="3871491">xk</span><span class="op" id="3871493">[</span><span class="ident" id="3871494">k</span><span class="op" id="3871495">+</span><span class="num" id="3871496">3</span><span class="op" id="3871497">]</span>&nbsp;<span class="op" id="3871499">^</span>&nbsp;<span class="ident" id="3871501">td0</span><span class="op" id="3871504">[</span><span class="builtintype" id="3871505">uint8</span><span class="op" id="3871510">(</span><span class="ident" id="3871511">s3</span><span class="op" id="3871513">&gt;&gt;</span><span class="num" id="3871515">24</span><span class="op" id="3871517">)</span><span class="op" id="3871518">]</span>&nbsp;<span class="op" id="3871520">^</span>&nbsp;<span class="ident" id="3871522">td1</span><span class="op" id="3871525">[</span><span class="builtintype" id="3871526">uint8</span><span class="op" id="3871531">(</span><span class="ident" id="3871532">s2</span><span class="op" id="3871534">&gt;&gt;</span><span class="num" id="3871536">16</span><span class="op" id="3871538">)</span><span class="op" id="3871539">]</span>&nbsp;<span class="op" id="3871541">^</span>&nbsp;<span class="ident" id="3871543">td2</span><span class="op" id="3871546">[</span><span class="builtintype" id="3871547">uint8</span><span class="op" id="3871552">(</span><span class="ident" id="3871553">s1</span><span class="op" id="3871555">&gt;&gt;</span><span class="num" id="3871557">8</span><span class="op" id="3871558">)</span><span class="op" id="3871559">]</span>&nbsp;<span class="op" id="3871561">^</span>&nbsp;<span class="ident" id="3871563">td3</span><span class="op" id="3871566">[</span><span class="builtintype" id="3871567">uint8</span><span class="op" id="3871572">(</span><span class="ident" id="3871573">s0</span><span class="op" id="3871575">)</span><span class="op" id="3871576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871580">k</span>&nbsp;<span class="op" id="3871582">+=</span>&nbsp;<span class="num" id="3871585">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871589">s0</span><span class="op" id="3871591">,</span>&nbsp;<span class="ident" id="3871593">s1</span><span class="op" id="3871595">,</span>&nbsp;<span class="ident" id="3871597">s2</span><span class="op" id="3871599">,</span>&nbsp;<span class="ident" id="3871601">s3</span>&nbsp;<span class="op" id="3871604">=</span>&nbsp;<span class="ident" id="3871606">t0</span><span class="op" id="3871608">,</span>&nbsp;<span class="ident" id="3871610">t1</span><span class="op" id="3871612">,</span>&nbsp;<span class="ident" id="3871614">t2</span><span class="op" id="3871616">,</span>&nbsp;<span class="ident" id="3871618">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3871622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3871626">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871689">s0</span>&nbsp;<span class="op" id="3871692">=</span>&nbsp;<span class="builtintype" id="3871694">uint32</span><span class="op" id="3871700">(</span><span class="ident" id="3871701">sbox1</span><span class="op" id="3871706">[</span><span class="ident" id="3871707">t0</span><span class="op" id="3871709">&gt;&gt;</span><span class="num" id="3871711">24</span><span class="op" id="3871713">]</span><span class="op" id="3871714">)</span><span class="op" id="3871715">&lt;&lt;</span><span class="num" id="3871717">24</span>&nbsp;<span class="op" id="3871720">|</span>&nbsp;<span class="builtintype" id="3871722">uint32</span><span class="op" id="3871728">(</span><span class="ident" id="3871729">sbox1</span><span class="op" id="3871734">[</span><span class="ident" id="3871735">t3</span><span class="op" id="3871737">&gt;&gt;</span><span class="num" id="3871739">16</span><span class="op" id="3871741">&amp;</span><span class="num" id="3871742">0xff</span><span class="op" id="3871746">]</span><span class="op" id="3871747">)</span><span class="op" id="3871748">&lt;&lt;</span><span class="num" id="3871750">16</span>&nbsp;<span class="op" id="3871753">|</span>&nbsp;<span class="builtintype" id="3871755">uint32</span><span class="op" id="3871761">(</span><span class="ident" id="3871762">sbox1</span><span class="op" id="3871767">[</span><span class="ident" id="3871768">t2</span><span class="op" id="3871770">&gt;&gt;</span><span class="num" id="3871772">8</span><span class="op" id="3871773">&amp;</span><span class="num" id="3871774">0xff</span><span class="op" id="3871778">]</span><span class="op" id="3871779">)</span><span class="op" id="3871780">&lt;&lt;</span><span class="num" id="3871782">8</span>&nbsp;<span class="op" id="3871784">|</span>&nbsp;<span class="builtintype" id="3871786">uint32</span><span class="op" id="3871792">(</span><span class="ident" id="3871793">sbox1</span><span class="op" id="3871798">[</span><span class="ident" id="3871799">t1</span><span class="op" id="3871801">&amp;</span><span class="num" id="3871802">0xff</span><span class="op" id="3871806">]</span><span class="op" id="3871807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871810">s1</span>&nbsp;<span class="op" id="3871813">=</span>&nbsp;<span class="builtintype" id="3871815">uint32</span><span class="op" id="3871821">(</span><span class="ident" id="3871822">sbox1</span><span class="op" id="3871827">[</span><span class="ident" id="3871828">t1</span><span class="op" id="3871830">&gt;&gt;</span><span class="num" id="3871832">24</span><span class="op" id="3871834">]</span><span class="op" id="3871835">)</span><span class="op" id="3871836">&lt;&lt;</span><span class="num" id="3871838">24</span>&nbsp;<span class="op" id="3871841">|</span>&nbsp;<span class="builtintype" id="3871843">uint32</span><span class="op" id="3871849">(</span><span class="ident" id="3871850">sbox1</span><span class="op" id="3871855">[</span><span class="ident" id="3871856">t0</span><span class="op" id="3871858">&gt;&gt;</span><span class="num" id="3871860">16</span><span class="op" id="3871862">&amp;</span><span class="num" id="3871863">0xff</span><span class="op" id="3871867">]</span><span class="op" id="3871868">)</span><span class="op" id="3871869">&lt;&lt;</span><span class="num" id="3871871">16</span>&nbsp;<span class="op" id="3871874">|</span>&nbsp;<span class="builtintype" id="3871876">uint32</span><span class="op" id="3871882">(</span><span class="ident" id="3871883">sbox1</span><span class="op" id="3871888">[</span><span class="ident" id="3871889">t3</span><span class="op" id="3871891">&gt;&gt;</span><span class="num" id="3871893">8</span><span class="op" id="3871894">&amp;</span><span class="num" id="3871895">0xff</span><span class="op" id="3871899">]</span><span class="op" id="3871900">)</span><span class="op" id="3871901">&lt;&lt;</span><span class="num" id="3871903">8</span>&nbsp;<span class="op" id="3871905">|</span>&nbsp;<span class="builtintype" id="3871907">uint32</span><span class="op" id="3871913">(</span><span class="ident" id="3871914">sbox1</span><span class="op" id="3871919">[</span><span class="ident" id="3871920">t2</span><span class="op" id="3871922">&amp;</span><span class="num" id="3871923">0xff</span><span class="op" id="3871927">]</span><span class="op" id="3871928">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3871931">s2</span>&nbsp;<span class="op" id="3871934">=</span>&nbsp;<span class="builtintype" id="3871936">uint32</span><span class="op" id="3871942">(</span><span class="ident" id="3871943">sbox1</span><span class="op" id="3871948">[</span><span class="ident" id="3871949">t2</span><span class="op" id="3871951">&gt;&gt;</span><span class="num" id="3871953">24</span><span class="op" id="3871955">]</span><span class="op" id="3871956">)</span><span class="op" id="3871957">&lt;&lt;</span><span class="num" id="3871959">24</span>&nbsp;<span class="op" id="3871962">|</span>&nbsp;<span class="builtintype" id="3871964">uint32</span><span class="op" id="3871970">(</span><span class="ident" id="3871971">sbox1</span><span class="op" id="3871976">[</span><span class="ident" id="3871977">t1</span><span class="op" id="3871979">&gt;&gt;</span><span class="num" id="3871981">16</span><span class="op" id="3871983">&amp;</span><span class="num" id="3871984">0xff</span><span class="op" id="3871988">]</span><span class="op" id="3871989">)</span><span class="op" id="3871990">&lt;&lt;</span><span class="num" id="3871992">16</span>&nbsp;<span class="op" id="3871995">|</span>&nbsp;<span class="builtintype" id="3871997">uint32</span><span class="op" id="3872003">(</span><span class="ident" id="3872004">sbox1</span><span class="op" id="3872009">[</span><span class="ident" id="3872010">t0</span><span class="op" id="3872012">&gt;&gt;</span><span class="num" id="3872014">8</span><span class="op" id="3872015">&amp;</span><span class="num" id="3872016">0xff</span><span class="op" id="3872020">]</span><span class="op" id="3872021">)</span><span class="op" id="3872022">&lt;&lt;</span><span class="num" id="3872024">8</span>&nbsp;<span class="op" id="3872026">|</span>&nbsp;<span class="builtintype" id="3872028">uint32</span><span class="op" id="3872034">(</span><span class="ident" id="3872035">sbox1</span><span class="op" id="3872040">[</span><span class="ident" id="3872041">t3</span><span class="op" id="3872043">&amp;</span><span class="num" id="3872044">0xff</span><span class="op" id="3872048">]</span><span class="op" id="3872049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872052">s3</span>&nbsp;<span class="op" id="3872055">=</span>&nbsp;<span class="builtintype" id="3872057">uint32</span><span class="op" id="3872063">(</span><span class="ident" id="3872064">sbox1</span><span class="op" id="3872069">[</span><span class="ident" id="3872070">t3</span><span class="op" id="3872072">&gt;&gt;</span><span class="num" id="3872074">24</span><span class="op" id="3872076">]</span><span class="op" id="3872077">)</span><span class="op" id="3872078">&lt;&lt;</span><span class="num" id="3872080">24</span>&nbsp;<span class="op" id="3872083">|</span>&nbsp;<span class="builtintype" id="3872085">uint32</span><span class="op" id="3872091">(</span><span class="ident" id="3872092">sbox1</span><span class="op" id="3872097">[</span><span class="ident" id="3872098">t2</span><span class="op" id="3872100">&gt;&gt;</span><span class="num" id="3872102">16</span><span class="op" id="3872104">&amp;</span><span class="num" id="3872105">0xff</span><span class="op" id="3872109">]</span><span class="op" id="3872110">)</span><span class="op" id="3872111">&lt;&lt;</span><span class="num" id="3872113">16</span>&nbsp;<span class="op" id="3872116">|</span>&nbsp;<span class="builtintype" id="3872118">uint32</span><span class="op" id="3872124">(</span><span class="ident" id="3872125">sbox1</span><span class="op" id="3872130">[</span><span class="ident" id="3872131">t1</span><span class="op" id="3872133">&gt;&gt;</span><span class="num" id="3872135">8</span><span class="op" id="3872136">&amp;</span><span class="num" id="3872137">0xff</span><span class="op" id="3872141">]</span><span class="op" id="3872142">)</span><span class="op" id="3872143">&lt;&lt;</span><span class="num" id="3872145">8</span>&nbsp;<span class="op" id="3872147">|</span>&nbsp;<span class="builtintype" id="3872149">uint32</span><span class="op" id="3872155">(</span><span class="ident" id="3872156">sbox1</span><span class="op" id="3872161">[</span><span class="ident" id="3872162">t0</span><span class="op" id="3872164">&amp;</span><span class="num" id="3872165">0xff</span><span class="op" id="3872169">]</span><span class="op" id="3872170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872174">s0</span>&nbsp;<span class="op" id="3872177">^=</span>&nbsp;<span class="ident" id="3872180">xk</span><span class="op" id="3872182">[</span><span class="ident" id="3872183">k</span><span class="op" id="3872184">+</span><span class="num" id="3872185">0</span><span class="op" id="3872186">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872189">s1</span>&nbsp;<span class="op" id="3872192">^=</span>&nbsp;<span class="ident" id="3872195">xk</span><span class="op" id="3872197">[</span><span class="ident" id="3872198">k</span><span class="op" id="3872199">+</span><span class="num" id="3872200">1</span><span class="op" id="3872201">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872204">s2</span>&nbsp;<span class="op" id="3872207">^=</span>&nbsp;<span class="ident" id="3872210">xk</span><span class="op" id="3872212">[</span><span class="ident" id="3872213">k</span><span class="op" id="3872214">+</span><span class="num" id="3872215">2</span><span class="op" id="3872216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872219">s3</span>&nbsp;<span class="op" id="3872222">^=</span>&nbsp;<span class="ident" id="3872225">xk</span><span class="op" id="3872227">[</span><span class="ident" id="3872228">k</span><span class="op" id="3872229">+</span><span class="num" id="3872230">3</span><span class="op" id="3872231">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872235">dst</span><span class="op" id="3872238">[</span><span class="num" id="3872239">0</span><span class="op" id="3872240">]</span><span class="op" id="3872241">,</span>&nbsp;<span class="ident" id="3872243">dst</span><span class="op" id="3872246">[</span><span class="num" id="3872247">1</span><span class="op" id="3872248">]</span><span class="op" id="3872249">,</span>&nbsp;<span class="ident" id="3872251">dst</span><span class="op" id="3872254">[</span><span class="num" id="3872255">2</span><span class="op" id="3872256">]</span><span class="op" id="3872257">,</span>&nbsp;<span class="ident" id="3872259">dst</span><span class="op" id="3872262">[</span><span class="num" id="3872263">3</span><span class="op" id="3872264">]</span>&nbsp;<span class="op" id="3872266">=</span>&nbsp;<span class="builtintype" id="3872268">byte</span><span class="op" id="3872272">(</span><span class="ident" id="3872273">s0</span><span class="op" id="3872275">&gt;&gt;</span><span class="num" id="3872277">24</span><span class="op" id="3872279">)</span><span class="op" id="3872280">,</span>&nbsp;<span class="builtintype" id="3872282">byte</span><span class="op" id="3872286">(</span><span class="ident" id="3872287">s0</span><span class="op" id="3872289">&gt;&gt;</span><span class="num" id="3872291">16</span><span class="op" id="3872293">)</span><span class="op" id="3872294">,</span>&nbsp;<span class="builtintype" id="3872296">byte</span><span class="op" id="3872300">(</span><span class="ident" id="3872301">s0</span><span class="op" id="3872303">&gt;&gt;</span><span class="num" id="3872305">8</span><span class="op" id="3872306">)</span><span class="op" id="3872307">,</span>&nbsp;<span class="builtintype" id="3872309">byte</span><span class="op" id="3872313">(</span><span class="ident" id="3872314">s0</span><span class="op" id="3872316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872319">dst</span><span class="op" id="3872322">[</span><span class="num" id="3872323">4</span><span class="op" id="3872324">]</span><span class="op" id="3872325">,</span>&nbsp;<span class="ident" id="3872327">dst</span><span class="op" id="3872330">[</span><span class="num" id="3872331">5</span><span class="op" id="3872332">]</span><span class="op" id="3872333">,</span>&nbsp;<span class="ident" id="3872335">dst</span><span class="op" id="3872338">[</span><span class="num" id="3872339">6</span><span class="op" id="3872340">]</span><span class="op" id="3872341">,</span>&nbsp;<span class="ident" id="3872343">dst</span><span class="op" id="3872346">[</span><span class="num" id="3872347">7</span><span class="op" id="3872348">]</span>&nbsp;<span class="op" id="3872350">=</span>&nbsp;<span class="builtintype" id="3872352">byte</span><span class="op" id="3872356">(</span><span class="ident" id="3872357">s1</span><span class="op" id="3872359">&gt;&gt;</span><span class="num" id="3872361">24</span><span class="op" id="3872363">)</span><span class="op" id="3872364">,</span>&nbsp;<span class="builtintype" id="3872366">byte</span><span class="op" id="3872370">(</span><span class="ident" id="3872371">s1</span><span class="op" id="3872373">&gt;&gt;</span><span class="num" id="3872375">16</span><span class="op" id="3872377">)</span><span class="op" id="3872378">,</span>&nbsp;<span class="builtintype" id="3872380">byte</span><span class="op" id="3872384">(</span><span class="ident" id="3872385">s1</span><span class="op" id="3872387">&gt;&gt;</span><span class="num" id="3872389">8</span><span class="op" id="3872390">)</span><span class="op" id="3872391">,</span>&nbsp;<span class="builtintype" id="3872393">byte</span><span class="op" id="3872397">(</span><span class="ident" id="3872398">s1</span><span class="op" id="3872400">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872403">dst</span><span class="op" id="3872406">[</span><span class="num" id="3872407">8</span><span class="op" id="3872408">]</span><span class="op" id="3872409">,</span>&nbsp;<span class="ident" id="3872411">dst</span><span class="op" id="3872414">[</span><span class="num" id="3872415">9</span><span class="op" id="3872416">]</span><span class="op" id="3872417">,</span>&nbsp;<span class="ident" id="3872419">dst</span><span class="op" id="3872422">[</span><span class="num" id="3872423">10</span><span class="op" id="3872425">]</span><span class="op" id="3872426">,</span>&nbsp;<span class="ident" id="3872428">dst</span><span class="op" id="3872431">[</span><span class="num" id="3872432">11</span><span class="op" id="3872434">]</span>&nbsp;<span class="op" id="3872436">=</span>&nbsp;<span class="builtintype" id="3872438">byte</span><span class="op" id="3872442">(</span><span class="ident" id="3872443">s2</span><span class="op" id="3872445">&gt;&gt;</span><span class="num" id="3872447">24</span><span class="op" id="3872449">)</span><span class="op" id="3872450">,</span>&nbsp;<span class="builtintype" id="3872452">byte</span><span class="op" id="3872456">(</span><span class="ident" id="3872457">s2</span><span class="op" id="3872459">&gt;&gt;</span><span class="num" id="3872461">16</span><span class="op" id="3872463">)</span><span class="op" id="3872464">,</span>&nbsp;<span class="builtintype" id="3872466">byte</span><span class="op" id="3872470">(</span><span class="ident" id="3872471">s2</span><span class="op" id="3872473">&gt;&gt;</span><span class="num" id="3872475">8</span><span class="op" id="3872476">)</span><span class="op" id="3872477">,</span>&nbsp;<span class="builtintype" id="3872479">byte</span><span class="op" id="3872483">(</span><span class="ident" id="3872484">s2</span><span class="op" id="3872486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3872489">dst</span><span class="op" id="3872492">[</span><span class="num" id="3872493">12</span><span class="op" id="3872495">]</span><span class="op" id="3872496">,</span>&nbsp;<span class="ident" id="3872498">dst</span><span class="op" id="3872501">[</span><span class="num" id="3872502">13</span><span class="op" id="3872504">]</span><span class="op" id="3872505">,</span>&nbsp;<span class="ident" id="3872507">dst</span><span class="op" id="3872510">[</span><span class="num" id="3872511">14</span><span class="op" id="3872513">]</span><span class="op" id="3872514">,</span>&nbsp;<span class="ident" id="3872516">dst</span><span class="op" id="3872519">[</span><span class="num" id="3872520">15</span><span class="op" id="3872522">]</span>&nbsp;<span class="op" id="3872524">=</span>&nbsp;<span class="builtintype" id="3872526">byte</span><span class="op" id="3872530">(</span><span class="ident" id="3872531">s3</span><span class="op" id="3872533">&gt;&gt;</span><span class="num" id="3872535">24</span><span class="op" id="3872537">)</span><span class="op" id="3872538">,</span>&nbsp;<span class="builtintype" id="3872540">byte</span><span class="op" id="3872544">(</span><span class="ident" id="3872545">s3</span><span class="op" id="3872547">&gt;&gt;</span><span class="num" id="3872549">16</span><span class="op" id="3872551">)</span><span class="op" id="3872552">,</span>&nbsp;<span class="builtintype" id="3872554">byte</span><span class="op" id="3872558">(</span><span class="ident" id="3872559">s3</span><span class="op" id="3872561">&gt;&gt;</span><span class="num" id="3872563">8</span><span class="op" id="3872564">)</span><span class="op" id="3872565">,</span>&nbsp;<span class="builtintype" id="3872567">byte</span><span class="op" id="3872571">(</span><span class="ident" id="3872572">s3</span><span class="op" id="3872574">)</span><br>
<span class="lineno"></span><span class="op" id="3872576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3872579">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3872613">func</span>&nbsp;<span class="ident" id="3872618">subw</span><span class="op" id="3872622">(</span><span class="ident" id="3872623">w</span>&nbsp;<span class="builtintype" id="3872625">uint32</span><span class="op" id="3872631">)</span>&nbsp;<span class="builtintype" id="3872633">uint32</span>&nbsp;<span class="op" id="3872640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3872643">return</span>&nbsp;<span class="builtintype" id="3872650">uint32</span><span class="op" id="3872656">(</span><span class="ident" id="3872657">sbox0</span><span class="op" id="3872662">[</span><span class="ident" id="3872663">w</span><span class="op" id="3872664">&gt;&gt;</span><span class="num" id="3872666">24</span><span class="op" id="3872668">]</span><span class="op" id="3872669">)</span><span class="op" id="3872670">&lt;&lt;</span><span class="num" id="3872672">24</span>&nbsp;<span class="op" id="3872675">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3872679">uint32</span><span class="op" id="3872685">(</span><span class="ident" id="3872686">sbox0</span><span class="op" id="3872691">[</span><span class="ident" id="3872692">w</span><span class="op" id="3872693">&gt;&gt;</span><span class="num" id="3872695">16</span><span class="op" id="3872697">&amp;</span><span class="num" id="3872698">0xff</span><span class="op" id="3872702">]</span><span class="op" id="3872703">)</span><span class="op" id="3872704">&lt;&lt;</span><span class="num" id="3872706">16</span>&nbsp;<span class="op" id="3872709">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3872713">uint32</span><span class="op" id="3872719">(</span><span class="ident" id="3872720">sbox0</span><span class="op" id="3872725">[</span><span class="ident" id="3872726">w</span><span class="op" id="3872727">&gt;&gt;</span><span class="num" id="3872729">8</span><span class="op" id="3872730">&amp;</span><span class="num" id="3872731">0xff</span><span class="op" id="3872735">]</span><span class="op" id="3872736">)</span><span class="op" id="3872737">&lt;&lt;</span><span class="num" id="3872739">8</span>&nbsp;<span class="op" id="3872741">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3872745">uint32</span><span class="op" id="3872751">(</span><span class="ident" id="3872752">sbox0</span><span class="op" id="3872757">[</span><span class="ident" id="3872758">w</span><span class="op" id="3872759">&amp;</span><span class="num" id="3872760">0xff</span><span class="op" id="3872764">]</span><span class="op" id="3872765">)</span><br>
<span class="lineno">135</span><span class="op" id="3872767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3872770">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3872780">func</span>&nbsp;<span class="ident" id="3872785">rotw</span><span class="op" id="3872789">(</span><span class="ident" id="3872790">w</span>&nbsp;<span class="builtintype" id="3872792">uint32</span><span class="op" id="3872798">)</span>&nbsp;<span class="builtintype" id="3872800">uint32</span>&nbsp;<span class="op" id="3872807">{</span>&nbsp;<span class="keyword" id="3872809">return</span>&nbsp;<span class="ident" id="3872816">w</span><span class="op" id="3872817">&lt;&lt;</span><span class="num" id="3872819">8</span>&nbsp;<span class="op" id="3872821">|</span>&nbsp;<span class="ident" id="3872823">w</span><span class="op" id="3872824">&gt;&gt;</span><span class="num" id="3872826">24</span>&nbsp;<span class="op" id="3872829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3872832">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3872886">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3872927">func</span>&nbsp;<span class="ident" id="3872932">expandKeyGo</span><span class="op" id="3872943">(</span><span class="ident" id="3872944">key</span>&nbsp;<span class="op" id="3872948">[</span><span class="op" id="3872949">]</span><span class="builtintype" id="3872950">byte</span><span class="op" id="3872954">,</span>&nbsp;<span class="ident" id="3872956">enc</span><span class="op" id="3872959">,</span>&nbsp;<span class="ident" id="3872961">dec</span>&nbsp;<span class="op" id="3872965">[</span><span class="op" id="3872966">]</span><span class="builtintype" id="3872967">uint32</span><span class="op" id="3872973">)</span>&nbsp;<span class="op" id="3872975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3872978">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873004">var</span>&nbsp;<span class="ident" id="3873008">i</span>&nbsp;<span class="builtintype" id="3873010">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873015">nk</span>&nbsp;<span class="op" id="3873018">:=</span>&nbsp;<span class="builtinfunc" id="3873021">len</span><span class="op" id="3873024">(</span><span class="ident" id="3873025">key</span><span class="op" id="3873028">)</span>&nbsp;<span class="op" id="3873030">/</span>&nbsp;<span class="num" id="3873032">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873035">for</span>&nbsp;<span class="ident" id="3873039">i</span>&nbsp;<span class="op" id="3873041">=</span>&nbsp;<span class="num" id="3873043">0</span><span class="op" id="3873044">;</span>&nbsp;<span class="ident" id="3873046">i</span>&nbsp;<span class="op" id="3873048">&lt;</span>&nbsp;<span class="ident" id="3873050">nk</span><span class="op" id="3873052">;</span>&nbsp;<span class="ident" id="3873054">i</span><span class="op" id="3873055">++</span>&nbsp;<span class="op" id="3873058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873062">enc</span><span class="op" id="3873065">[</span><span class="ident" id="3873066">i</span><span class="op" id="3873067">]</span>&nbsp;<span class="op" id="3873069">=</span>&nbsp;<span class="builtintype" id="3873071">uint32</span><span class="op" id="3873077">(</span><span class="ident" id="3873078">key</span><span class="op" id="3873081">[</span><span class="num" id="3873082">4</span><span class="op" id="3873083">*</span><span class="ident" id="3873084">i</span><span class="op" id="3873085">]</span><span class="op" id="3873086">)</span><span class="op" id="3873087">&lt;&lt;</span><span class="num" id="3873089">24</span>&nbsp;<span class="op" id="3873092">|</span>&nbsp;<span class="builtintype" id="3873094">uint32</span><span class="op" id="3873100">(</span><span class="ident" id="3873101">key</span><span class="op" id="3873104">[</span><span class="num" id="3873105">4</span><span class="op" id="3873106">*</span><span class="ident" id="3873107">i</span><span class="op" id="3873108">+</span><span class="num" id="3873109">1</span><span class="op" id="3873110">]</span><span class="op" id="3873111">)</span><span class="op" id="3873112">&lt;&lt;</span><span class="num" id="3873114">16</span>&nbsp;<span class="op" id="3873117">|</span>&nbsp;<span class="builtintype" id="3873119">uint32</span><span class="op" id="3873125">(</span><span class="ident" id="3873126">key</span><span class="op" id="3873129">[</span><span class="num" id="3873130">4</span><span class="op" id="3873131">*</span><span class="ident" id="3873132">i</span><span class="op" id="3873133">+</span><span class="num" id="3873134">2</span><span class="op" id="3873135">]</span><span class="op" id="3873136">)</span><span class="op" id="3873137">&lt;&lt;</span><span class="num" id="3873139">8</span>&nbsp;<span class="op" id="3873141">|</span>&nbsp;<span class="builtintype" id="3873143">uint32</span><span class="op" id="3873149">(</span><span class="ident" id="3873150">key</span><span class="op" id="3873153">[</span><span class="num" id="3873154">4</span><span class="op" id="3873155">*</span><span class="ident" id="3873156">i</span><span class="op" id="3873157">+</span><span class="num" id="3873158">3</span><span class="op" id="3873159">]</span><span class="op" id="3873160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873166">for</span>&nbsp;<span class="op" id="3873170">;</span>&nbsp;<span class="ident" id="3873172">i</span>&nbsp;<span class="op" id="3873174">&lt;</span>&nbsp;<span class="builtinfunc" id="3873176">len</span><span class="op" id="3873179">(</span><span class="ident" id="3873180">enc</span><span class="op" id="3873183">)</span><span class="op" id="3873184">;</span>&nbsp;<span class="ident" id="3873186">i</span><span class="op" id="3873187">++</span>&nbsp;<span class="op" id="3873190">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873194">t</span>&nbsp;<span class="op" id="3873196">:=</span>&nbsp;<span class="ident" id="3873199">enc</span><span class="op" id="3873202">[</span><span class="ident" id="3873203">i</span><span class="op" id="3873204">-</span><span class="num" id="3873205">1</span><span class="op" id="3873206">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873210">if</span>&nbsp;<span class="ident" id="3873213">i</span><span class="op" id="3873214">%</span><span class="ident" id="3873215">nk</span>&nbsp;<span class="op" id="3873218">==</span>&nbsp;<span class="num" id="3873221">0</span>&nbsp;<span class="op" id="3873223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873228">t</span>&nbsp;<span class="op" id="3873230">=</span>&nbsp;<span class="ident" id="3873232">subw</span><span class="op" id="3873236">(</span><span class="ident" id="3873237">rotw</span><span class="op" id="3873241">(</span><span class="ident" id="3873242">t</span><span class="op" id="3873243">)</span><span class="op" id="3873244">)</span>&nbsp;<span class="op" id="3873246">^</span>&nbsp;<span class="op" id="3873248">(</span><span class="builtintype" id="3873249">uint32</span><span class="op" id="3873255">(</span><span class="ident" id="3873256">powx</span><span class="op" id="3873260">[</span><span class="ident" id="3873261">i</span><span class="op" id="3873262">/</span><span class="ident" id="3873263">nk</span><span class="op" id="3873265">-</span><span class="num" id="3873266">1</span><span class="op" id="3873267">]</span><span class="op" id="3873268">)</span>&nbsp;<span class="op" id="3873270">&lt;&lt;</span>&nbsp;<span class="num" id="3873273">24</span><span class="op" id="3873275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873279">}</span>&nbsp;<span class="keyword" id="3873281">else</span>&nbsp;<span class="keyword" id="3873286">if</span>&nbsp;<span class="ident" id="3873289">nk</span>&nbsp;<span class="op" id="3873292">&gt;</span>&nbsp;<span class="num" id="3873294">6</span>&nbsp;<span class="op" id="3873296">&amp;&amp;</span>&nbsp;<span class="ident" id="3873299">i</span><span class="op" id="3873300">%</span><span class="ident" id="3873301">nk</span>&nbsp;<span class="op" id="3873304">==</span>&nbsp;<span class="num" id="3873307">4</span>&nbsp;<span class="op" id="3873309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873314">t</span>&nbsp;<span class="op" id="3873316">=</span>&nbsp;<span class="ident" id="3873318">subw</span><span class="op" id="3873322">(</span><span class="ident" id="3873323">t</span><span class="op" id="3873324">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873332">enc</span><span class="op" id="3873335">[</span><span class="ident" id="3873336">i</span><span class="op" id="3873337">]</span>&nbsp;<span class="op" id="3873339">=</span>&nbsp;<span class="ident" id="3873341">enc</span><span class="op" id="3873344">[</span><span class="ident" id="3873345">i</span><span class="op" id="3873346">-</span><span class="ident" id="3873347">nk</span><span class="op" id="3873349">]</span>&nbsp;<span class="op" id="3873351">^</span>&nbsp;<span class="ident" id="3873353">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873360">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873407">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3873470">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873543">if</span>&nbsp;<span class="ident" id="3873546">dec</span>&nbsp;<span class="op" id="3873550">==</span>&nbsp;<span class="ident" id="3873553">nil</span>&nbsp;<span class="op" id="3873557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873561">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873569">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873572">n</span>&nbsp;<span class="op" id="3873574">:=</span>&nbsp;<span class="builtinfunc" id="3873577">len</span><span class="op" id="3873580">(</span><span class="ident" id="3873581">enc</span><span class="op" id="3873584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873587">for</span>&nbsp;<span class="ident" id="3873591">i</span>&nbsp;<span class="op" id="3873593">:=</span>&nbsp;<span class="num" id="3873596">0</span><span class="op" id="3873597">;</span>&nbsp;<span class="ident" id="3873599">i</span>&nbsp;<span class="op" id="3873601">&lt;</span>&nbsp;<span class="ident" id="3873603">n</span><span class="op" id="3873604">;</span>&nbsp;<span class="ident" id="3873606">i</span>&nbsp;<span class="op" id="3873608">+=</span>&nbsp;<span class="num" id="3873611">4</span>&nbsp;<span class="op" id="3873613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873617">ei</span>&nbsp;<span class="op" id="3873620">:=</span>&nbsp;<span class="ident" id="3873623">n</span>&nbsp;<span class="op" id="3873625">-</span>&nbsp;<span class="ident" id="3873627">i</span>&nbsp;<span class="op" id="3873629">-</span>&nbsp;<span class="num" id="3873631">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873635">for</span>&nbsp;<span class="ident" id="3873639">j</span>&nbsp;<span class="op" id="3873641">:=</span>&nbsp;<span class="num" id="3873644">0</span><span class="op" id="3873645">;</span>&nbsp;<span class="ident" id="3873647">j</span>&nbsp;<span class="op" id="3873649">&lt;</span>&nbsp;<span class="num" id="3873651">4</span><span class="op" id="3873652">;</span>&nbsp;<span class="ident" id="3873654">j</span><span class="op" id="3873655">++</span>&nbsp;<span class="op" id="3873658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873663">x</span>&nbsp;<span class="op" id="3873665">:=</span>&nbsp;<span class="ident" id="3873668">enc</span><span class="op" id="3873671">[</span><span class="ident" id="3873672">ei</span><span class="op" id="3873674">+</span><span class="ident" id="3873675">j</span><span class="op" id="3873676">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3873681">if</span>&nbsp;<span class="ident" id="3873684">i</span>&nbsp;<span class="op" id="3873686">&gt;</span>&nbsp;<span class="num" id="3873688">0</span>&nbsp;<span class="op" id="3873690">&amp;&amp;</span>&nbsp;<span class="ident" id="3873693">i</span><span class="op" id="3873694">+</span><span class="num" id="3873695">4</span>&nbsp;<span class="op" id="3873697">&lt;</span>&nbsp;<span class="ident" id="3873699">n</span>&nbsp;<span class="op" id="3873701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873707">x</span>&nbsp;<span class="op" id="3873709">=</span>&nbsp;<span class="ident" id="3873711">td0</span><span class="op" id="3873714">[</span><span class="ident" id="3873715">sbox0</span><span class="op" id="3873720">[</span><span class="ident" id="3873721">x</span><span class="op" id="3873722">&gt;&gt;</span><span class="num" id="3873724">24</span><span class="op" id="3873726">]</span><span class="op" id="3873727">]</span>&nbsp;<span class="op" id="3873729">^</span>&nbsp;<span class="ident" id="3873731">td1</span><span class="op" id="3873734">[</span><span class="ident" id="3873735">sbox0</span><span class="op" id="3873740">[</span><span class="ident" id="3873741">x</span><span class="op" id="3873742">&gt;&gt;</span><span class="num" id="3873744">16</span><span class="op" id="3873746">&amp;</span><span class="num" id="3873747">0xff</span><span class="op" id="3873751">]</span><span class="op" id="3873752">]</span>&nbsp;<span class="op" id="3873754">^</span>&nbsp;<span class="ident" id="3873756">td2</span><span class="op" id="3873759">[</span><span class="ident" id="3873760">sbox0</span><span class="op" id="3873765">[</span><span class="ident" id="3873766">x</span><span class="op" id="3873767">&gt;&gt;</span><span class="num" id="3873769">8</span><span class="op" id="3873770">&amp;</span><span class="num" id="3873771">0xff</span><span class="op" id="3873775">]</span><span class="op" id="3873776">]</span>&nbsp;<span class="op" id="3873778">^</span>&nbsp;<span class="ident" id="3873780">td3</span><span class="op" id="3873783">[</span><span class="ident" id="3873784">sbox0</span><span class="op" id="3873789">[</span><span class="ident" id="3873790">x</span><span class="op" id="3873791">&amp;</span><span class="num" id="3873792">0xff</span><span class="op" id="3873796">]</span><span class="op" id="3873797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3873807">dec</span><span class="op" id="3873810">[</span><span class="ident" id="3873811">i</span><span class="op" id="3873812">+</span><span class="ident" id="3873813">j</span><span class="op" id="3873814">]</span>&nbsp;<span class="op" id="3873816">=</span>&nbsp;<span class="ident" id="3873818">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873822">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3873825">}</span><br>
<span class="lineno"></span><span class="op" id="3873827">}</span>
</div>
</body>
</html>
