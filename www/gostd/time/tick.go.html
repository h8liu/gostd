<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2434771">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2434826">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2434880">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2434931">package</span>&nbsp;<span class="ident" id="2434939">time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2434945">import</span>&nbsp;<span class="string" id="2434952">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2434962">//&nbsp;A&nbsp;Ticker&nbsp;holds&nbsp;a&nbsp;channel&nbsp;that&nbsp;delivers&nbsp;`ticks&#39;&nbsp;of&nbsp;a&nbsp;clock</span><br>
<span class="lineno">10</span><span class="comment" id="2435023">//&nbsp;at&nbsp;intervals.</span><br>
<span class="lineno"></span><span class="keyword" id="2435040">type</span>&nbsp;<span class="ident" id="2435045">Ticker</span>&nbsp;<span class="keyword" id="2435052">struct</span>&nbsp;<span class="op" id="2435059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435062">C</span>&nbsp;<span class="op" id="2435064">&lt;-</span><span class="keyword" id="2435066">chan</span>&nbsp;<span class="ident" id="2435071">Time</span>&nbsp;<span class="comment" id="2435076">//&nbsp;The&nbsp;channel&nbsp;on&nbsp;which&nbsp;the&nbsp;ticks&nbsp;are&nbsp;delivered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435126">r</span>&nbsp;<span class="ident" id="2435128">runtimeTimer</span><br>
<span class="lineno"></span><span class="op" id="2435141">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2435144">//&nbsp;NewTicker&nbsp;returns&nbsp;a&nbsp;new&nbsp;Ticker&nbsp;containing&nbsp;a&nbsp;channel&nbsp;that&nbsp;will&nbsp;send&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2435218">//&nbsp;time&nbsp;with&nbsp;a&nbsp;period&nbsp;specified&nbsp;by&nbsp;the&nbsp;duration&nbsp;argument.</span><br>
<span class="lineno"></span><span class="comment" id="2435276">//&nbsp;It&nbsp;adjusts&nbsp;the&nbsp;intervals&nbsp;or&nbsp;drops&nbsp;ticks&nbsp;to&nbsp;make&nbsp;up&nbsp;for&nbsp;slow&nbsp;receivers.</span><br>
<span class="lineno"></span><span class="comment" id="2435350">//&nbsp;The&nbsp;duration&nbsp;d&nbsp;must&nbsp;be&nbsp;greater&nbsp;than&nbsp;zero;&nbsp;if&nbsp;not,&nbsp;NewTicker&nbsp;will&nbsp;panic.</span><br>
<span class="lineno">20</span><span class="comment" id="2435425">//&nbsp;Stop&nbsp;the&nbsp;ticker&nbsp;to&nbsp;release&nbsp;associated&nbsp;resources.</span><br>
<span class="lineno"></span><span class="keyword" id="2435477">func</span>&nbsp;<span class="ident" id="2435482">NewTicker</span><span class="op" id="2435491">(</span><span class="ident" id="2435492">d</span>&nbsp;<span class="ident" id="2435494">Duration</span><span class="op" id="2435502">)</span>&nbsp;<span class="op" id="2435504">*</span><span class="ident" id="2435505">Ticker</span>&nbsp;<span class="op" id="2435512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435515">if</span>&nbsp;<span class="ident" id="2435518">d</span>&nbsp;<span class="op" id="2435520">&lt;=</span>&nbsp;<span class="num" id="2435523">0</span>&nbsp;<span class="op" id="2435525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2435529">panic</span><span class="op" id="2435534">(</span><span class="ident" id="2435535">errors</span><span class="op" id="2435541">.</span><span class="ident" id="2435542">New</span><span class="op" id="2435545">(</span><span class="string" id="2435546">&#34;non-positive&nbsp;interval&nbsp;for&nbsp;NewTicker&#34;</span><span class="op" id="2435583">)</span><span class="op" id="2435584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435587">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2435590">//&nbsp;Give&nbsp;the&nbsp;channel&nbsp;a&nbsp;1-element&nbsp;time&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2435636">//&nbsp;If&nbsp;the&nbsp;client&nbsp;falls&nbsp;behind&nbsp;while&nbsp;reading,&nbsp;we&nbsp;drop&nbsp;ticks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2435696">//&nbsp;on&nbsp;the&nbsp;floor&nbsp;until&nbsp;the&nbsp;client&nbsp;catches&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435742">c</span>&nbsp;<span class="op" id="2435744">:=</span>&nbsp;<span class="builtinfunc" id="2435747">make</span><span class="op" id="2435751">(</span><span class="keyword" id="2435752">chan</span>&nbsp;<span class="ident" id="2435757">Time</span><span class="op" id="2435761">,</span>&nbsp;<span class="num" id="2435763">1</span><span class="op" id="2435764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435767">t</span>&nbsp;<span class="op" id="2435769">:=</span>&nbsp;<span class="op" id="2435772">&amp;</span><span class="ident" id="2435773">Ticker</span><span class="op" id="2435779">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435783">C</span><span class="op" id="2435784">:</span>&nbsp;<span class="ident" id="2435786">c</span><span class="op" id="2435787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435791">r</span><span class="op" id="2435792">:</span>&nbsp;<span class="ident" id="2435794">runtimeTimer</span><span class="op" id="2435806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435811">when</span><span class="op" id="2435815">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2435819">when</span><span class="op" id="2435823">(</span><span class="ident" id="2435824">d</span><span class="op" id="2435825">)</span><span class="op" id="2435826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435831">period</span><span class="op" id="2435837">:</span>&nbsp;<span class="ident" id="2435839">int64</span><span class="op" id="2435844">(</span><span class="ident" id="2435845">d</span><span class="op" id="2435846">)</span><span class="op" id="2435847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435852">f</span><span class="op" id="2435853">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2435860">sendTime</span><span class="op" id="2435868">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435873">arg</span><span class="op" id="2435876">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2435881">c</span><span class="op" id="2435882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435886">}</span><span class="op" id="2435887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2435890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2435893">startTimer</span><span class="op" id="2435903">(</span><span class="op" id="2435904">&amp;</span><span class="ident" id="2435905">t</span><span class="op" id="2435906">.</span><span class="ident" id="2435907">r</span><span class="op" id="2435908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2435911">return</span>&nbsp;<span class="ident" id="2435918">t</span><br>
<span class="lineno">40</span><span class="op" id="2435920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2435923">//&nbsp;Stop&nbsp;turns&nbsp;off&nbsp;a&nbsp;ticker.&nbsp;&nbsp;After&nbsp;Stop,&nbsp;no&nbsp;more&nbsp;ticks&nbsp;will&nbsp;be&nbsp;sent.</span><br>
<span class="lineno"></span><span class="comment" id="2435992">//&nbsp;Stop&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;channel,&nbsp;to&nbsp;prevent&nbsp;a&nbsp;read&nbsp;from&nbsp;the&nbsp;channel&nbsp;succeeding</span><br>
<span class="lineno"></span><span class="comment" id="2436074">//&nbsp;incorrectly.</span><br>
<span class="lineno">45</span><span class="keyword" id="2436090">func</span>&nbsp;<span class="op" id="2436095">(</span><span class="ident" id="2436096">t</span>&nbsp;<span class="op" id="2436098">*</span><span class="ident" id="2436099">Ticker</span><span class="op" id="2436105">)</span>&nbsp;<span class="ident" id="2436107">Stop</span><span class="op" id="2436111">(</span><span class="op" id="2436112">)</span>&nbsp;<span class="op" id="2436114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2436117">stopTimer</span><span class="op" id="2436126">(</span><span class="op" id="2436127">&amp;</span><span class="ident" id="2436128">t</span><span class="op" id="2436129">.</span><span class="ident" id="2436130">r</span><span class="op" id="2436131">)</span><br>
<span class="lineno"></span><span class="op" id="2436133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2436136">//&nbsp;Tick&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;for&nbsp;NewTicker&nbsp;providing&nbsp;access&nbsp;to&nbsp;the&nbsp;ticking</span><br>
<span class="lineno">50</span><span class="comment" id="2436215">//&nbsp;channel&nbsp;only.&nbsp;&nbsp;Useful&nbsp;for&nbsp;clients&nbsp;that&nbsp;have&nbsp;no&nbsp;need&nbsp;to&nbsp;shut&nbsp;down&nbsp;the&nbsp;ticker.</span><br>
<span class="lineno"></span><span class="keyword" id="2436295">func</span>&nbsp;<span class="ident" id="2436300">Tick</span><span class="op" id="2436304">(</span><span class="ident" id="2436305">d</span>&nbsp;<span class="ident" id="2436307">Duration</span><span class="op" id="2436315">)</span>&nbsp;<span class="op" id="2436317">&lt;-</span><span class="keyword" id="2436319">chan</span>&nbsp;<span class="ident" id="2436324">Time</span>&nbsp;<span class="op" id="2436329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436332">if</span>&nbsp;<span class="ident" id="2436335">d</span>&nbsp;<span class="op" id="2436337">&lt;=</span>&nbsp;<span class="num" id="2436340">0</span>&nbsp;<span class="op" id="2436342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436346">return</span>&nbsp;<span class="ident" id="2436353">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2436358">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2436361">return</span>&nbsp;<span class="ident" id="2436368">NewTicker</span><span class="op" id="2436377">(</span><span class="ident" id="2436378">d</span><span class="op" id="2436379">)</span><span class="op" id="2436380">.</span><span class="ident" id="2436381">C</span><br>
<span class="lineno"></span><span class="op" id="2436383">}</span>
</div>
</body>
</html>
