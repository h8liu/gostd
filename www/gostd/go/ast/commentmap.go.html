<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4257524">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4257579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4257633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4257684">package</span>&nbsp;<span class="ident" id="4257692">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257697">import</span>&nbsp;<span class="op" id="4257704">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4257707">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4257716">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4257723">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4257735">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="4257742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4257745">type</span>&nbsp;<span class="ident" id="4257750">byPos</span>&nbsp;<span class="op" id="4257756">[</span><span class="op" id="4257757">]</span><span class="op" id="4257758">*</span><span class="ident" id="4257759">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4257773">func</span>&nbsp;<span class="op" id="4257778">(</span><span class="ident" id="4257779">a</span>&nbsp;<span class="ident" id="4257781">byPos</span><span class="op" id="4257786">)</span>&nbsp;<span class="ident" id="4257788">Len</span><span class="op" id="4257791">(</span><span class="op" id="4257792">)</span>&nbsp;<span class="builtintype" id="4257794">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257808">{</span>&nbsp;<span class="keyword" id="4257810">return</span>&nbsp;<span class="builtinfunc" id="4257817">len</span><span class="op" id="4257820">(</span><span class="ident" id="4257821">a</span><span class="op" id="4257822">)</span>&nbsp;<span class="op" id="4257824">}</span><br>
<span class="lineno"></span><span class="keyword" id="4257826">func</span>&nbsp;<span class="op" id="4257831">(</span><span class="ident" id="4257832">a</span>&nbsp;<span class="ident" id="4257834">byPos</span><span class="op" id="4257839">)</span>&nbsp;<span class="ident" id="4257841">Less</span><span class="op" id="4257845">(</span><span class="ident" id="4257846">i</span><span class="op" id="4257847">,</span>&nbsp;<span class="ident" id="4257849">j</span>&nbsp;<span class="builtintype" id="4257851">int</span><span class="op" id="4257854">)</span>&nbsp;<span class="builtintype" id="4257856">bool</span>&nbsp;<span class="op" id="4257861">{</span>&nbsp;<span class="keyword" id="4257863">return</span>&nbsp;<span class="ident" id="4257870">a</span><span class="op" id="4257871">[</span><span class="ident" id="4257872">i</span><span class="op" id="4257873">]</span><span class="op" id="4257874">.</span><span class="ident" id="4257875">Pos</span><span class="op" id="4257878">(</span><span class="op" id="4257879">)</span>&nbsp;<span class="op" id="4257881">&lt;</span>&nbsp;<span class="ident" id="4257883">a</span><span class="op" id="4257884">[</span><span class="ident" id="4257885">j</span><span class="op" id="4257886">]</span><span class="op" id="4257887">.</span><span class="ident" id="4257888">Pos</span><span class="op" id="4257891">(</span><span class="op" id="4257892">)</span>&nbsp;<span class="op" id="4257894">}</span><br>
<span class="lineno"></span><span class="keyword" id="4257896">func</span>&nbsp;<span class="op" id="4257901">(</span><span class="ident" id="4257902">a</span>&nbsp;<span class="ident" id="4257904">byPos</span><span class="op" id="4257909">)</span>&nbsp;<span class="ident" id="4257911">Swap</span><span class="op" id="4257915">(</span><span class="ident" id="4257916">i</span><span class="op" id="4257917">,</span>&nbsp;<span class="ident" id="4257919">j</span>&nbsp;<span class="builtintype" id="4257921">int</span><span class="op" id="4257924">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4257931">{</span>&nbsp;<span class="ident" id="4257933">a</span><span class="op" id="4257934">[</span><span class="ident" id="4257935">i</span><span class="op" id="4257936">]</span><span class="op" id="4257937">,</span>&nbsp;<span class="ident" id="4257939">a</span><span class="op" id="4257940">[</span><span class="ident" id="4257941">j</span><span class="op" id="4257942">]</span>&nbsp;<span class="op" id="4257944">=</span>&nbsp;<span class="ident" id="4257946">a</span><span class="op" id="4257947">[</span><span class="ident" id="4257948">j</span><span class="op" id="4257949">]</span><span class="op" id="4257950">,</span>&nbsp;<span class="ident" id="4257952">a</span><span class="op" id="4257953">[</span><span class="ident" id="4257954">i</span><span class="op" id="4257955">]</span>&nbsp;<span class="op" id="4257957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4257960">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4258026">//</span><br>
<span class="lineno"></span><span class="keyword" id="4258029">func</span>&nbsp;<span class="ident" id="4258034">sortComments</span><span class="op" id="4258046">(</span><span class="ident" id="4258047">list</span>&nbsp;<span class="op" id="4258052">[</span><span class="op" id="4258053">]</span><span class="op" id="4258054">*</span><span class="ident" id="4258055">CommentGroup</span><span class="op" id="4258067">)</span>&nbsp;<span class="op" id="4258069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258072">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258131">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4258189">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258218">if</span>&nbsp;<span class="ident" id="4258221">orderedList</span>&nbsp;<span class="op" id="4258233">:=</span>&nbsp;<span class="ident" id="4258236">byPos</span><span class="op" id="4258241">(</span><span class="ident" id="4258242">list</span><span class="op" id="4258246">)</span><span class="op" id="4258247">;</span>&nbsp;<span class="op" id="4258249">!</span><span class="ident" id="4258250">sort</span><span class="op" id="4258254">.</span><span class="ident" id="4258255">IsSorted</span><span class="op" id="4258263">(</span><span class="ident" id="4258264">orderedList</span><span class="op" id="4258275">)</span>&nbsp;<span class="op" id="4258277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258281">sort</span><span class="op" id="4258285">.</span><span class="ident" id="4258286">Sort</span><span class="op" id="4258290">(</span><span class="ident" id="4258291">orderedList</span><span class="op" id="4258302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258305">}</span><br>
<span class="lineno"></span><span class="op" id="4258307">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4258310">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4258371">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4258433">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="4258453">//</span><br>
<span class="lineno">35</span><span class="keyword" id="4258456">type</span>&nbsp;<span class="ident" id="4258461">CommentMap</span>&nbsp;<span class="keyword" id="4258472">map</span><span class="op" id="4258475">[</span><span class="ident" id="4258476">Node</span><span class="op" id="4258480">]</span><span class="op" id="4258481">[</span><span class="op" id="4258482">]</span><span class="op" id="4258483">*</span><span class="ident" id="4258484">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258498">func</span>&nbsp;<span class="op" id="4258503">(</span><span class="ident" id="4258504">cmap</span>&nbsp;<span class="ident" id="4258509">CommentMap</span><span class="op" id="4258519">)</span>&nbsp;<span class="ident" id="4258521">addComment</span><span class="op" id="4258531">(</span><span class="ident" id="4258532">n</span>&nbsp;<span class="ident" id="4258534">Node</span><span class="op" id="4258538">,</span>&nbsp;<span class="ident" id="4258540">c</span>&nbsp;<span class="op" id="4258542">*</span><span class="ident" id="4258543">CommentGroup</span><span class="op" id="4258555">)</span>&nbsp;<span class="op" id="4258557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258560">list</span>&nbsp;<span class="op" id="4258565">:=</span>&nbsp;<span class="ident" id="4258568">cmap</span><span class="op" id="4258572">[</span><span class="ident" id="4258573">n</span><span class="op" id="4258574">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258577">if</span>&nbsp;<span class="builtinfunc" id="4258580">len</span><span class="op" id="4258583">(</span><span class="ident" id="4258584">list</span><span class="op" id="4258588">)</span>&nbsp;<span class="op" id="4258590">==</span>&nbsp;<span class="num" id="4258593">0</span>&nbsp;<span class="op" id="4258595">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258599">list</span>&nbsp;<span class="op" id="4258604">=</span>&nbsp;<span class="op" id="4258606">[</span><span class="op" id="4258607">]</span><span class="op" id="4258608">*</span><span class="ident" id="4258609">CommentGroup</span><span class="op" id="4258621">{</span><span class="ident" id="4258622">c</span><span class="op" id="4258623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258626">}</span>&nbsp;<span class="keyword" id="4258628">else</span>&nbsp;<span class="op" id="4258633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258637">list</span>&nbsp;<span class="op" id="4258642">=</span>&nbsp;<span class="builtinfunc" id="4258644">append</span><span class="op" id="4258650">(</span><span class="ident" id="4258651">list</span><span class="op" id="4258655">,</span>&nbsp;<span class="ident" id="4258657">c</span><span class="op" id="4258658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4258661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258664">cmap</span><span class="op" id="4258668">[</span><span class="ident" id="4258669">n</span><span class="op" id="4258670">]</span>&nbsp;<span class="op" id="4258672">=</span>&nbsp;<span class="ident" id="4258674">list</span><br>
<span class="lineno">45</span><span class="op" id="4258679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258682">type</span>&nbsp;<span class="ident" id="4258687">byInterval</span>&nbsp;<span class="op" id="4258698">[</span><span class="op" id="4258699">]</span><span class="ident" id="4258700">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4258706">func</span>&nbsp;<span class="op" id="4258711">(</span><span class="ident" id="4258712">a</span>&nbsp;<span class="ident" id="4258714">byInterval</span><span class="op" id="4258724">)</span>&nbsp;<span class="ident" id="4258726">Len</span><span class="op" id="4258729">(</span><span class="op" id="4258730">)</span>&nbsp;<span class="builtintype" id="4258732">int</span>&nbsp;<span class="op" id="4258736">{</span>&nbsp;<span class="keyword" id="4258738">return</span>&nbsp;<span class="builtinfunc" id="4258745">len</span><span class="op" id="4258748">(</span><span class="ident" id="4258749">a</span><span class="op" id="4258750">)</span>&nbsp;<span class="op" id="4258752">}</span><br>
<span class="lineno">50</span><span class="keyword" id="4258754">func</span>&nbsp;<span class="op" id="4258759">(</span><span class="ident" id="4258760">a</span>&nbsp;<span class="ident" id="4258762">byInterval</span><span class="op" id="4258772">)</span>&nbsp;<span class="ident" id="4258774">Less</span><span class="op" id="4258778">(</span><span class="ident" id="4258779">i</span><span class="op" id="4258780">,</span>&nbsp;<span class="ident" id="4258782">j</span>&nbsp;<span class="builtintype" id="4258784">int</span><span class="op" id="4258787">)</span>&nbsp;<span class="builtintype" id="4258789">bool</span>&nbsp;<span class="op" id="4258794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4258797">pi</span><span class="op" id="4258799">,</span>&nbsp;<span class="ident" id="4258801">pj</span>&nbsp;<span class="op" id="4258804">:=</span>&nbsp;<span class="ident" id="4258807">a</span><span class="op" id="4258808">[</span><span class="ident" id="4258809">i</span><span class="op" id="4258810">]</span><span class="op" id="4258811">.</span><span class="ident" id="4258812">Pos</span><span class="op" id="4258815">(</span><span class="op" id="4258816">)</span><span class="op" id="4258817">,</span>&nbsp;<span class="ident" id="4258819">a</span><span class="op" id="4258820">[</span><span class="ident" id="4258821">j</span><span class="op" id="4258822">]</span><span class="op" id="4258823">.</span><span class="ident" id="4258824">Pos</span><span class="op" id="4258827">(</span><span class="op" id="4258828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4258831">return</span>&nbsp;<span class="ident" id="4258838">pi</span>&nbsp;<span class="op" id="4258841">&lt;</span>&nbsp;<span class="ident" id="4258843">pj</span>&nbsp;<span class="op" id="4258846">||</span>&nbsp;<span class="ident" id="4258849">pi</span>&nbsp;<span class="op" id="4258852">==</span>&nbsp;<span class="ident" id="4258855">pj</span>&nbsp;<span class="op" id="4258858">&amp;&amp;</span>&nbsp;<span class="ident" id="4258861">a</span><span class="op" id="4258862">[</span><span class="ident" id="4258863">i</span><span class="op" id="4258864">]</span><span class="op" id="4258865">.</span><span class="ident" id="4258866">End</span><span class="op" id="4258869">(</span><span class="op" id="4258870">)</span>&nbsp;<span class="op" id="4258872">&gt;</span>&nbsp;<span class="ident" id="4258874">a</span><span class="op" id="4258875">[</span><span class="ident" id="4258876">j</span><span class="op" id="4258877">]</span><span class="op" id="4258878">.</span><span class="ident" id="4258879">End</span><span class="op" id="4258882">(</span><span class="op" id="4258883">)</span><br>
<span class="lineno"></span><span class="op" id="4258885">}</span><br>
<span class="lineno"></span><span class="keyword" id="4258887">func</span>&nbsp;<span class="op" id="4258892">(</span><span class="ident" id="4258893">a</span>&nbsp;<span class="ident" id="4258895">byInterval</span><span class="op" id="4258905">)</span>&nbsp;<span class="ident" id="4258907">Swap</span><span class="op" id="4258911">(</span><span class="ident" id="4258912">i</span><span class="op" id="4258913">,</span>&nbsp;<span class="ident" id="4258915">j</span>&nbsp;<span class="builtintype" id="4258917">int</span><span class="op" id="4258920">)</span>&nbsp;<span class="op" id="4258922">{</span>&nbsp;<span class="ident" id="4258924">a</span><span class="op" id="4258925">[</span><span class="ident" id="4258926">i</span><span class="op" id="4258927">]</span><span class="op" id="4258928">,</span>&nbsp;<span class="ident" id="4258930">a</span><span class="op" id="4258931">[</span><span class="ident" id="4258932">j</span><span class="op" id="4258933">]</span>&nbsp;<span class="op" id="4258935">=</span>&nbsp;<span class="ident" id="4258937">a</span><span class="op" id="4258938">[</span><span class="ident" id="4258939">j</span><span class="op" id="4258940">]</span><span class="op" id="4258941">,</span>&nbsp;<span class="ident" id="4258943">a</span><span class="op" id="4258944">[</span><span class="ident" id="4258945">i</span><span class="op" id="4258946">]</span>&nbsp;<span class="op" id="4258948">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4258951">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4259019">//</span><br>
<span class="lineno"></span><span class="keyword" id="4259022">func</span>&nbsp;<span class="ident" id="4259027">nodeList</span><span class="op" id="4259035">(</span><span class="ident" id="4259036">n</span>&nbsp;<span class="ident" id="4259038">Node</span><span class="op" id="4259042">)</span>&nbsp;<span class="op" id="4259044">[</span><span class="op" id="4259045">]</span><span class="ident" id="4259046">Node</span>&nbsp;<span class="op" id="4259051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259054">var</span>&nbsp;<span class="ident" id="4259058">list</span>&nbsp;<span class="op" id="4259063">[</span><span class="op" id="4259064">]</span><span class="ident" id="4259065">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259071">Inspect</span><span class="op" id="4259078">(</span><span class="ident" id="4259079">n</span><span class="op" id="4259080">,</span>&nbsp;<span class="keyword" id="4259082">func</span><span class="op" id="4259086">(</span><span class="ident" id="4259087">n</span>&nbsp;<span class="ident" id="4259089">Node</span><span class="op" id="4259093">)</span>&nbsp;<span class="builtintype" id="4259095">bool</span>&nbsp;<span class="op" id="4259100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259104">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259132">switch</span>&nbsp;<span class="ident" id="4259139">n</span><span class="op" id="4259140">.</span><span class="op" id="4259141">(</span><span class="keyword" id="4259142">type</span><span class="op" id="4259146">)</span>&nbsp;<span class="op" id="4259148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259152">case</span>&nbsp;<span class="ident" id="4259157">nil</span><span class="op" id="4259160">,</span>&nbsp;<span class="op" id="4259162">*</span><span class="ident" id="4259163">CommentGroup</span><span class="op" id="4259175">,</span>&nbsp;<span class="op" id="4259177">*</span><span class="ident" id="4259178">Comment</span><span class="op" id="4259185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259190">return</span>&nbsp;<span class="builtintype" id="4259197">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259209">list</span>&nbsp;<span class="op" id="4259214">=</span>&nbsp;<span class="builtinfunc" id="4259216">append</span><span class="op" id="4259222">(</span><span class="ident" id="4259223">list</span><span class="op" id="4259227">,</span>&nbsp;<span class="ident" id="4259229">n</span><span class="op" id="4259230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259234">return</span>&nbsp;<span class="builtintype" id="4259241">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4259247">}</span><span class="op" id="4259248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259251">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259323">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259394">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259465">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4259485">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259517">return</span>&nbsp;<span class="ident" id="4259524">list</span><br>
<span class="lineno">75</span><span class="op" id="4259529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259532">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="4259605">//</span><br>
<span class="lineno"></span><span class="keyword" id="4259608">type</span>&nbsp;<span class="ident" id="4259613">commentListReader</span>&nbsp;<span class="keyword" id="4259631">struct</span>&nbsp;<span class="op" id="4259638">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259641">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259650">*</span><span class="ident" id="4259651">token</span><span class="op" id="4259656">.</span><span class="ident" id="4259657">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259666">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4259675">[</span><span class="op" id="4259676">]</span><span class="op" id="4259677">*</span><span class="ident" id="4259678">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259692">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4259701">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259706">comment</span>&nbsp;&nbsp;<span class="op" id="4259715">*</span><span class="ident" id="4259716">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="4259730">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259765">pos</span><span class="op" id="4259768">,</span>&nbsp;<span class="ident" id="4259770">end</span>&nbsp;<span class="ident" id="4259774">token</span><span class="op" id="4259779">.</span><span class="ident" id="4259780">Position</span>&nbsp;<span class="comment" id="4259789">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="4259842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4259845">func</span>&nbsp;<span class="op" id="4259850">(</span><span class="ident" id="4259851">r</span>&nbsp;<span class="op" id="4259853">*</span><span class="ident" id="4259854">commentListReader</span><span class="op" id="4259871">)</span>&nbsp;<span class="ident" id="4259873">eol</span><span class="op" id="4259876">(</span><span class="op" id="4259877">)</span>&nbsp;<span class="builtintype" id="4259879">bool</span>&nbsp;<span class="op" id="4259884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259887">return</span>&nbsp;<span class="ident" id="4259894">r</span><span class="op" id="4259895">.</span><span class="ident" id="4259896">index</span>&nbsp;<span class="op" id="4259902">&gt;=</span>&nbsp;<span class="builtinfunc" id="4259905">len</span><span class="op" id="4259908">(</span><span class="ident" id="4259909">r</span><span class="op" id="4259910">.</span><span class="ident" id="4259911">list</span><span class="op" id="4259915">)</span><br>
<span class="lineno"></span><span class="op" id="4259917">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4259920">func</span>&nbsp;<span class="op" id="4259925">(</span><span class="ident" id="4259926">r</span>&nbsp;<span class="op" id="4259928">*</span><span class="ident" id="4259929">commentListReader</span><span class="op" id="4259946">)</span>&nbsp;<span class="ident" id="4259948">next</span><span class="op" id="4259952">(</span><span class="op" id="4259953">)</span>&nbsp;<span class="op" id="4259955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4259958">if</span>&nbsp;<span class="op" id="4259961">!</span><span class="ident" id="4259962">r</span><span class="op" id="4259963">.</span><span class="ident" id="4259964">eol</span><span class="op" id="4259967">(</span><span class="op" id="4259968">)</span>&nbsp;<span class="op" id="4259970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4259974">r</span><span class="op" id="4259975">.</span><span class="ident" id="4259976">comment</span>&nbsp;<span class="op" id="4259984">=</span>&nbsp;<span class="ident" id="4259986">r</span><span class="op" id="4259987">.</span><span class="ident" id="4259988">list</span><span class="op" id="4259992">[</span><span class="ident" id="4259993">r</span><span class="op" id="4259994">.</span><span class="ident" id="4259995">index</span><span class="op" id="4260000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260004">r</span><span class="op" id="4260005">.</span><span class="ident" id="4260006">pos</span>&nbsp;<span class="op" id="4260010">=</span>&nbsp;<span class="ident" id="4260012">r</span><span class="op" id="4260013">.</span><span class="ident" id="4260014">fset</span><span class="op" id="4260018">.</span><span class="ident" id="4260019">Position</span><span class="op" id="4260027">(</span><span class="ident" id="4260028">r</span><span class="op" id="4260029">.</span><span class="ident" id="4260030">comment</span><span class="op" id="4260037">.</span><span class="ident" id="4260038">Pos</span><span class="op" id="4260041">(</span><span class="op" id="4260042">)</span><span class="op" id="4260043">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260047">r</span><span class="op" id="4260048">.</span><span class="ident" id="4260049">end</span>&nbsp;<span class="op" id="4260053">=</span>&nbsp;<span class="ident" id="4260055">r</span><span class="op" id="4260056">.</span><span class="ident" id="4260057">fset</span><span class="op" id="4260061">.</span><span class="ident" id="4260062">Position</span><span class="op" id="4260070">(</span><span class="ident" id="4260071">r</span><span class="op" id="4260072">.</span><span class="ident" id="4260073">comment</span><span class="op" id="4260080">.</span><span class="ident" id="4260081">End</span><span class="op" id="4260084">(</span><span class="op" id="4260085">)</span><span class="op" id="4260086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260090">r</span><span class="op" id="4260091">.</span><span class="ident" id="4260092">index</span><span class="op" id="4260097">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260101">}</span><br>
<span class="lineno"></span><span class="op" id="4260103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4260106">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4260150">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4260229">//</span><br>
<span class="lineno"></span><span class="keyword" id="4260232">type</span>&nbsp;<span class="ident" id="4260237">nodeStack</span>&nbsp;<span class="op" id="4260247">[</span><span class="op" id="4260248">]</span><span class="ident" id="4260249">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4260255">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4260309">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="4260344">//</span><br>
<span class="lineno"></span><span class="keyword" id="4260347">func</span>&nbsp;<span class="op" id="4260352">(</span><span class="ident" id="4260353">s</span>&nbsp;<span class="op" id="4260355">*</span><span class="ident" id="4260356">nodeStack</span><span class="op" id="4260365">)</span>&nbsp;<span class="ident" id="4260367">push</span><span class="op" id="4260371">(</span><span class="ident" id="4260372">n</span>&nbsp;<span class="ident" id="4260374">Node</span><span class="op" id="4260378">)</span>&nbsp;<span class="op" id="4260380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260383">s</span><span class="op" id="4260384">.</span><span class="ident" id="4260385">pop</span><span class="op" id="4260388">(</span><span class="ident" id="4260389">n</span><span class="op" id="4260390">.</span><span class="ident" id="4260391">Pos</span><span class="op" id="4260394">(</span><span class="op" id="4260395">)</span><span class="op" id="4260396">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260399">*</span><span class="ident" id="4260400">s</span>&nbsp;<span class="op" id="4260402">=</span>&nbsp;<span class="builtinfunc" id="4260404">append</span><span class="op" id="4260410">(</span><span class="op" id="4260411">(</span><span class="op" id="4260412">*</span><span class="ident" id="4260413">s</span><span class="op" id="4260414">)</span><span class="op" id="4260415">,</span>&nbsp;<span class="ident" id="4260417">n</span><span class="op" id="4260418">)</span><br>
<span class="lineno"></span><span class="op" id="4260420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260423">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4260478">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="4260538">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="4260574">//</span><br>
<span class="lineno"></span><span class="keyword" id="4260577">func</span>&nbsp;<span class="op" id="4260582">(</span><span class="ident" id="4260583">s</span>&nbsp;<span class="op" id="4260585">*</span><span class="ident" id="4260586">nodeStack</span><span class="op" id="4260595">)</span>&nbsp;<span class="ident" id="4260597">pop</span><span class="op" id="4260600">(</span><span class="ident" id="4260601">pos</span>&nbsp;<span class="ident" id="4260605">token</span><span class="op" id="4260610">.</span><span class="ident" id="4260611">Pos</span><span class="op" id="4260614">)</span>&nbsp;<span class="op" id="4260616">(</span><span class="ident" id="4260617">top</span>&nbsp;<span class="ident" id="4260621">Node</span><span class="op" id="4260625">)</span>&nbsp;<span class="op" id="4260627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260630">i</span>&nbsp;<span class="op" id="4260632">:=</span>&nbsp;<span class="builtinfunc" id="4260635">len</span><span class="op" id="4260638">(</span><span class="op" id="4260639">*</span><span class="ident" id="4260640">s</span><span class="op" id="4260641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260644">for</span>&nbsp;<span class="ident" id="4260648">i</span>&nbsp;<span class="op" id="4260650">&gt;</span>&nbsp;<span class="num" id="4260652">0</span>&nbsp;<span class="op" id="4260654">&amp;&amp;</span>&nbsp;<span class="op" id="4260657">(</span><span class="op" id="4260658">*</span><span class="ident" id="4260659">s</span><span class="op" id="4260660">)</span><span class="op" id="4260661">[</span><span class="ident" id="4260662">i</span><span class="op" id="4260663">-</span><span class="num" id="4260664">1</span><span class="op" id="4260665">]</span><span class="op" id="4260666">.</span><span class="ident" id="4260667">End</span><span class="op" id="4260670">(</span><span class="op" id="4260671">)</span>&nbsp;<span class="op" id="4260673">&lt;=</span>&nbsp;<span class="ident" id="4260676">pos</span>&nbsp;<span class="op" id="4260680">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260684">top</span>&nbsp;<span class="op" id="4260688">=</span>&nbsp;<span class="op" id="4260690">(</span><span class="op" id="4260691">*</span><span class="ident" id="4260692">s</span><span class="op" id="4260693">)</span><span class="op" id="4260694">[</span><span class="ident" id="4260695">i</span><span class="op" id="4260696">-</span><span class="num" id="4260697">1</span><span class="op" id="4260698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4260702">i</span><span class="op" id="4260703">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4260710">*</span><span class="ident" id="4260711">s</span>&nbsp;<span class="op" id="4260713">=</span>&nbsp;<span class="op" id="4260715">(</span><span class="op" id="4260716">*</span><span class="ident" id="4260717">s</span><span class="op" id="4260718">)</span><span class="op" id="4260719">[</span><span class="num" id="4260720">0</span><span class="op" id="4260721">:</span><span class="ident" id="4260722">i</span><span class="op" id="4260723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4260726">return</span>&nbsp;<span class="ident" id="4260733">top</span><br>
<span class="lineno">125</span><span class="op" id="4260737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260740">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="4260813">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4260882">//</span><br>
<span class="lineno">130</span><span class="comment" id="4260885">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="4260938">//</span><br>
<span class="lineno"></span><span class="comment" id="4260941">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="4260984">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4261050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="4261114">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="4261182">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="4261212">//</span><br>
<span class="lineno"></span><span class="comment" id="4261215">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4261284">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="4261349">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="4261418">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="4261485">//</span><br>
<span class="lineno"></span><span class="keyword" id="4261488">func</span>&nbsp;<span class="ident" id="4261493">NewCommentMap</span><span class="op" id="4261506">(</span><span class="ident" id="4261507">fset</span>&nbsp;<span class="op" id="4261512">*</span><span class="ident" id="4261513">token</span><span class="op" id="4261518">.</span><span class="ident" id="4261519">FileSet</span><span class="op" id="4261526">,</span>&nbsp;<span class="ident" id="4261528">node</span>&nbsp;<span class="ident" id="4261533">Node</span><span class="op" id="4261537">,</span>&nbsp;<span class="ident" id="4261539">comments</span>&nbsp;<span class="op" id="4261548">[</span><span class="op" id="4261549">]</span><span class="op" id="4261550">*</span><span class="ident" id="4261551">CommentGroup</span><span class="op" id="4261563">)</span>&nbsp;<span class="ident" id="4261565">CommentMap</span>&nbsp;<span class="op" id="4261576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261579">if</span>&nbsp;<span class="builtinfunc" id="4261582">len</span><span class="op" id="4261585">(</span><span class="ident" id="4261586">comments</span><span class="op" id="4261594">)</span>&nbsp;<span class="op" id="4261596">==</span>&nbsp;<span class="num" id="4261599">0</span>&nbsp;<span class="op" id="4261601">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4261605">return</span>&nbsp;<span class="ident" id="4261612">nil</span>&nbsp;<span class="comment" id="4261616">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4261639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261643">cmap</span>&nbsp;<span class="op" id="4261648">:=</span>&nbsp;<span class="builtinfunc" id="4261651">make</span><span class="op" id="4261655">(</span><span class="ident" id="4261656">CommentMap</span><span class="op" id="4261666">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4261670">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261698">tmp</span>&nbsp;<span class="op" id="4261702">:=</span>&nbsp;<span class="builtinfunc" id="4261705">make</span><span class="op" id="4261709">(</span><span class="op" id="4261710">[</span><span class="op" id="4261711">]</span><span class="op" id="4261712">*</span><span class="ident" id="4261713">CommentGroup</span><span class="op" id="4261725">,</span>&nbsp;<span class="builtinfunc" id="4261727">len</span><span class="op" id="4261730">(</span><span class="ident" id="4261731">comments</span><span class="op" id="4261739">)</span><span class="op" id="4261740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4261743">copy</span><span class="op" id="4261747">(</span><span class="ident" id="4261748">tmp</span><span class="op" id="4261751">,</span>&nbsp;<span class="ident" id="4261753">comments</span><span class="op" id="4261761">)</span>&nbsp;<span class="comment" id="4261763">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261798">sortComments</span><span class="op" id="4261810">(</span><span class="ident" id="4261811">tmp</span><span class="op" id="4261814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261817">r</span>&nbsp;<span class="op" id="4261819">:=</span>&nbsp;<span class="ident" id="4261822">commentListReader</span><span class="op" id="4261839">{</span><span class="ident" id="4261840">fset</span><span class="op" id="4261844">:</span>&nbsp;<span class="ident" id="4261846">fset</span><span class="op" id="4261850">,</span>&nbsp;<span class="ident" id="4261852">list</span><span class="op" id="4261856">:</span>&nbsp;<span class="ident" id="4261858">tmp</span><span class="op" id="4261861">}</span>&nbsp;<span class="comment" id="4261863">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261902">r</span><span class="op" id="4261903">.</span><span class="ident" id="4261904">next</span><span class="op" id="4261908">(</span><span class="op" id="4261909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4261913">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261951">nodes</span>&nbsp;<span class="op" id="4261957">:=</span>&nbsp;<span class="ident" id="4261960">nodeList</span><span class="op" id="4261968">(</span><span class="ident" id="4261969">node</span><span class="op" id="4261973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4261976">nodes</span>&nbsp;<span class="op" id="4261982">=</span>&nbsp;<span class="builtinfunc" id="4261984">append</span><span class="op" id="4261990">(</span><span class="ident" id="4261991">nodes</span><span class="op" id="4261996">,</span>&nbsp;<span class="ident" id="4261998">nil</span><span class="op" id="4262001">)</span>&nbsp;<span class="comment" id="4262003">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262024">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262055">var</span>&nbsp;<span class="op" id="4262059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262063">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262069">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262084">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262103">pend</span>&nbsp;&nbsp;<span class="ident" id="4262109">token</span><span class="op" id="4262114">.</span><span class="ident" id="4262115">Position</span>&nbsp;<span class="comment" id="4262124">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262138">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262144">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262159">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262218">pgend</span>&nbsp;<span class="ident" id="4262224">token</span><span class="op" id="4262229">.</span><span class="ident" id="4262230">Position</span>&nbsp;<span class="comment" id="4262239">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262254">stack</span>&nbsp;<span class="ident" id="4262260">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262275">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262304">for</span>&nbsp;<span class="ident" id="4262308">_</span><span class="op" id="4262309">,</span>&nbsp;<span class="ident" id="4262311">q</span>&nbsp;<span class="op" id="4262313">:=</span>&nbsp;<span class="keyword" id="4262316">range</span>&nbsp;<span class="ident" id="4262322">nodes</span>&nbsp;<span class="op" id="4262328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262332">var</span>&nbsp;<span class="ident" id="4262336">qpos</span>&nbsp;<span class="ident" id="4262341">token</span><span class="op" id="4262346">.</span><span class="ident" id="4262347">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262358">if</span>&nbsp;<span class="ident" id="4262361">q</span>&nbsp;<span class="op" id="4262363">!=</span>&nbsp;<span class="ident" id="4262366">nil</span>&nbsp;<span class="op" id="4262370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262375">qpos</span>&nbsp;<span class="op" id="4262380">=</span>&nbsp;<span class="ident" id="4262382">fset</span><span class="op" id="4262386">.</span><span class="ident" id="4262387">Position</span><span class="op" id="4262395">(</span><span class="ident" id="4262396">q</span><span class="op" id="4262397">.</span><span class="ident" id="4262398">Pos</span><span class="op" id="4262401">(</span><span class="op" id="4262402">)</span><span class="op" id="4262403">)</span>&nbsp;<span class="comment" id="4262405">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262432">}</span>&nbsp;<span class="keyword" id="4262434">else</span>&nbsp;<span class="op" id="4262439">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262444">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262497">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262550">const</span>&nbsp;<span class="ident" id="4262556">infinity</span>&nbsp;<span class="op" id="4262565">=</span>&nbsp;<span class="num" id="4262567">1</span>&nbsp;<span class="op" id="4262569">&lt;&lt;</span>&nbsp;<span class="num" id="4262572">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262578">qpos</span><span class="op" id="4262582">.</span><span class="ident" id="4262583">Offset</span>&nbsp;<span class="op" id="4262590">=</span>&nbsp;<span class="ident" id="4262592">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262604">qpos</span><span class="op" id="4262608">.</span><span class="ident" id="4262609">Line</span>&nbsp;<span class="op" id="4262614">=</span>&nbsp;<span class="ident" id="4262616">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262632">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262674">for</span>&nbsp;<span class="ident" id="4262678">r</span><span class="op" id="4262679">.</span><span class="ident" id="4262680">end</span><span class="op" id="4262683">.</span><span class="ident" id="4262684">Offset</span>&nbsp;<span class="op" id="4262691">&lt;=</span>&nbsp;<span class="ident" id="4262694">qpos</span><span class="op" id="4262698">.</span><span class="ident" id="4262699">Offset</span>&nbsp;<span class="op" id="4262706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262711">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4262745">if</span>&nbsp;<span class="ident" id="4262748">top</span>&nbsp;<span class="op" id="4262752">:=</span>&nbsp;<span class="ident" id="4262755">stack</span><span class="op" id="4262760">.</span><span class="ident" id="4262761">pop</span><span class="op" id="4262764">(</span><span class="ident" id="4262765">r</span><span class="op" id="4262766">.</span><span class="ident" id="4262767">comment</span><span class="op" id="4262774">.</span><span class="ident" id="4262775">Pos</span><span class="op" id="4262778">(</span><span class="op" id="4262779">)</span><span class="op" id="4262780">)</span><span class="op" id="4262781">;</span>&nbsp;<span class="ident" id="4262783">top</span>&nbsp;<span class="op" id="4262787">!=</span>&nbsp;<span class="ident" id="4262790">nil</span>&nbsp;<span class="op" id="4262794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262800">pg</span>&nbsp;<span class="op" id="4262803">=</span>&nbsp;<span class="ident" id="4262805">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4262813">pgend</span>&nbsp;<span class="op" id="4262819">=</span>&nbsp;<span class="ident" id="4262821">fset</span><span class="op" id="4262825">.</span><span class="ident" id="4262826">Position</span><span class="op" id="4262834">(</span><span class="ident" id="4262835">pg</span><span class="op" id="4262837">.</span><span class="ident" id="4262838">End</span><span class="op" id="4262841">(</span><span class="op" id="4262842">)</span><span class="op" id="4262843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4262848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262853">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262910">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4262970">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263032">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263044">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263092">var</span>&nbsp;<span class="ident" id="4263096">assoc</span>&nbsp;<span class="ident" id="4263102">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263110">switch</span>&nbsp;<span class="op" id="4263117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263122">case</span>&nbsp;<span class="ident" id="4263127">pg</span>&nbsp;<span class="op" id="4263130">!=</span>&nbsp;<span class="ident" id="4263133">nil</span>&nbsp;<span class="op" id="4263137">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263144">(</span><span class="ident" id="4263145">pgend</span><span class="op" id="4263150">.</span><span class="ident" id="4263151">Line</span>&nbsp;<span class="op" id="4263156">==</span>&nbsp;<span class="ident" id="4263159">r</span><span class="op" id="4263160">.</span><span class="ident" id="4263161">pos</span><span class="op" id="4263164">.</span><span class="ident" id="4263165">Line</span>&nbsp;<span class="op" id="4263170">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263178">pgend</span><span class="op" id="4263183">.</span><span class="ident" id="4263184">Line</span><span class="op" id="4263188">+</span><span class="num" id="4263189">1</span>&nbsp;<span class="op" id="4263191">==</span>&nbsp;<span class="ident" id="4263194">r</span><span class="op" id="4263195">.</span><span class="ident" id="4263196">pos</span><span class="op" id="4263199">.</span><span class="ident" id="4263200">Line</span>&nbsp;<span class="op" id="4263205">&amp;&amp;</span>&nbsp;<span class="ident" id="4263208">r</span><span class="op" id="4263209">.</span><span class="ident" id="4263210">end</span><span class="op" id="4263213">.</span><span class="ident" id="4263214">Line</span><span class="op" id="4263218">+</span><span class="num" id="4263219">1</span>&nbsp;<span class="op" id="4263221">&lt;</span>&nbsp;<span class="ident" id="4263223">qpos</span><span class="op" id="4263227">.</span><span class="ident" id="4263228">Line</span><span class="op" id="4263232">)</span><span class="op" id="4263233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263239">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263309">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263368">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263432">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263459">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263512">assoc</span>&nbsp;<span class="op" id="4263518">=</span>&nbsp;<span class="ident" id="4263520">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263526">case</span>&nbsp;<span class="ident" id="4263531">p</span>&nbsp;<span class="op" id="4263533">!=</span>&nbsp;<span class="ident" id="4263536">nil</span>&nbsp;<span class="op" id="4263540">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4263547">(</span><span class="ident" id="4263548">pend</span><span class="op" id="4263552">.</span><span class="ident" id="4263553">Line</span>&nbsp;<span class="op" id="4263558">==</span>&nbsp;<span class="ident" id="4263561">r</span><span class="op" id="4263562">.</span><span class="ident" id="4263563">pos</span><span class="op" id="4263566">.</span><span class="ident" id="4263567">Line</span>&nbsp;<span class="op" id="4263572">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263580">pend</span><span class="op" id="4263584">.</span><span class="ident" id="4263585">Line</span><span class="op" id="4263589">+</span><span class="num" id="4263590">1</span>&nbsp;<span class="op" id="4263592">==</span>&nbsp;<span class="ident" id="4263595">r</span><span class="op" id="4263596">.</span><span class="ident" id="4263597">pos</span><span class="op" id="4263600">.</span><span class="ident" id="4263601">Line</span>&nbsp;<span class="op" id="4263606">&amp;&amp;</span>&nbsp;<span class="ident" id="4263609">r</span><span class="op" id="4263610">.</span><span class="ident" id="4263611">end</span><span class="op" id="4263614">.</span><span class="ident" id="4263615">Line</span><span class="op" id="4263619">+</span><span class="num" id="4263620">1</span>&nbsp;<span class="op" id="4263622">&lt;</span>&nbsp;<span class="ident" id="4263624">qpos</span><span class="op" id="4263628">.</span><span class="ident" id="4263629">Line</span>&nbsp;<span class="op" id="4263634">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263642">q</span>&nbsp;<span class="op" id="4263644">==</span>&nbsp;<span class="ident" id="4263647">nil</span><span class="op" id="4263650">)</span><span class="op" id="4263651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263657">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263712">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4263777">assoc</span>&nbsp;<span class="op" id="4263783">=</span>&nbsp;<span class="ident" id="4263785">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263790">default</span><span class="op" id="4263797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263803">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4263857">if</span>&nbsp;<span class="ident" id="4263860">q</span>&nbsp;<span class="op" id="4263862">==</span>&nbsp;<span class="ident" id="4263865">nil</span>&nbsp;<span class="op" id="4263869">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263876">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4263925">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4263976">panic</span><span class="op" id="4263981">(</span><span class="string" id="4263982">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="4264046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264058">assoc</span>&nbsp;<span class="op" id="4264064">=</span>&nbsp;<span class="ident" id="4264066">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264076">cmap</span><span class="op" id="4264080">.</span><span class="ident" id="4264081">addComment</span><span class="op" id="4264091">(</span><span class="ident" id="4264092">assoc</span><span class="op" id="4264097">,</span>&nbsp;<span class="ident" id="4264099">r</span><span class="op" id="4264100">.</span><span class="ident" id="4264101">comment</span><span class="op" id="4264108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264113">if</span>&nbsp;<span class="ident" id="4264116">r</span><span class="op" id="4264117">.</span><span class="ident" id="4264118">eol</span><span class="op" id="4264121">(</span><span class="op" id="4264122">)</span>&nbsp;<span class="op" id="4264124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264130">return</span>&nbsp;<span class="ident" id="4264137">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264145">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264150">r</span><span class="op" id="4264151">.</span><span class="ident" id="4264152">next</span><span class="op" id="4264156">(</span><span class="op" id="4264157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264166">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264192">p</span>&nbsp;<span class="op" id="4264194">=</span>&nbsp;<span class="ident" id="4264196">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264200">pend</span>&nbsp;<span class="op" id="4264205">=</span>&nbsp;<span class="ident" id="4264207">fset</span><span class="op" id="4264211">.</span><span class="ident" id="4264212">Position</span><span class="op" id="4264220">(</span><span class="ident" id="4264221">p</span><span class="op" id="4264222">.</span><span class="ident" id="4264223">End</span><span class="op" id="4264226">(</span><span class="op" id="4264227">)</span><span class="op" id="4264228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4264233">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264295">switch</span>&nbsp;<span class="ident" id="4264302">q</span><span class="op" id="4264303">.</span><span class="op" id="4264304">(</span><span class="keyword" id="4264305">type</span><span class="op" id="4264309">)</span>&nbsp;<span class="op" id="4264311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264315">case</span>&nbsp;<span class="op" id="4264320">*</span><span class="ident" id="4264321">File</span><span class="op" id="4264325">,</span>&nbsp;<span class="op" id="4264327">*</span><span class="ident" id="4264328">Field</span><span class="op" id="4264333">,</span>&nbsp;<span class="ident" id="4264335">Decl</span><span class="op" id="4264339">,</span>&nbsp;<span class="ident" id="4264341">Spec</span><span class="op" id="4264345">,</span>&nbsp;<span class="ident" id="4264347">Stmt</span><span class="op" id="4264351">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264356">stack</span><span class="op" id="4264361">.</span><span class="ident" id="4264362">push</span><span class="op" id="4264366">(</span><span class="ident" id="4264367">q</span><span class="op" id="4264368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264379">return</span>&nbsp;<span class="ident" id="4264386">cmap</span><br>
<span class="lineno">240</span><span class="op" id="4264391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264394">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="4264462">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4264530">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="4264576">//</span><br>
<span class="lineno"></span><span class="keyword" id="4264579">func</span>&nbsp;<span class="op" id="4264584">(</span><span class="ident" id="4264585">cmap</span>&nbsp;<span class="ident" id="4264590">CommentMap</span><span class="op" id="4264600">)</span>&nbsp;<span class="ident" id="4264602">Update</span><span class="op" id="4264608">(</span><span class="ident" id="4264609">old</span><span class="op" id="4264612">,</span>&nbsp;<span class="builtinfunc" id="4264614">new</span>&nbsp;<span class="ident" id="4264618">Node</span><span class="op" id="4264622">)</span>&nbsp;<span class="ident" id="4264624">Node</span>&nbsp;<span class="op" id="4264629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264632">if</span>&nbsp;<span class="ident" id="4264635">list</span>&nbsp;<span class="op" id="4264640">:=</span>&nbsp;<span class="ident" id="4264643">cmap</span><span class="op" id="4264647">[</span><span class="ident" id="4264648">old</span><span class="op" id="4264651">]</span><span class="op" id="4264652">;</span>&nbsp;<span class="builtinfunc" id="4264654">len</span><span class="op" id="4264657">(</span><span class="ident" id="4264658">list</span><span class="op" id="4264662">)</span>&nbsp;<span class="op" id="4264664">&gt;</span>&nbsp;<span class="num" id="4264666">0</span>&nbsp;<span class="op" id="4264668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4264672">delete</span><span class="op" id="4264678">(</span><span class="ident" id="4264679">cmap</span><span class="op" id="4264683">,</span>&nbsp;<span class="ident" id="4264685">old</span><span class="op" id="4264688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264692">cmap</span><span class="op" id="4264696">[</span><span class="builtinfunc" id="4264697">new</span><span class="op" id="4264700">]</span>&nbsp;<span class="op" id="4264702">=</span>&nbsp;<span class="builtinfunc" id="4264704">append</span><span class="op" id="4264710">(</span><span class="ident" id="4264711">cmap</span><span class="op" id="4264715">[</span><span class="builtinfunc" id="4264716">new</span><span class="op" id="4264719">]</span><span class="op" id="4264720">,</span>&nbsp;<span class="ident" id="4264722">list</span><span class="op" id="4264726">...</span><span class="op" id="4264729">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4264732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4264735">return</span>&nbsp;<span class="builtinfunc" id="4264742">new</span><br>
<span class="lineno"></span><span class="op" id="4264746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4264749">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="4264810">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4264870">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="4264900">//</span><br>
<span class="lineno"></span><span class="keyword" id="4264903">func</span>&nbsp;<span class="op" id="4264908">(</span><span class="ident" id="4264909">cmap</span>&nbsp;<span class="ident" id="4264914">CommentMap</span><span class="op" id="4264924">)</span>&nbsp;<span class="ident" id="4264926">Filter</span><span class="op" id="4264932">(</span><span class="ident" id="4264933">node</span>&nbsp;<span class="ident" id="4264938">Node</span><span class="op" id="4264942">)</span>&nbsp;<span class="ident" id="4264944">CommentMap</span>&nbsp;<span class="op" id="4264955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264958">umap</span>&nbsp;<span class="op" id="4264963">:=</span>&nbsp;<span class="builtinfunc" id="4264966">make</span><span class="op" id="4264970">(</span><span class="ident" id="4264971">CommentMap</span><span class="op" id="4264981">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4264984">Inspect</span><span class="op" id="4264991">(</span><span class="ident" id="4264992">node</span><span class="op" id="4264996">,</span>&nbsp;<span class="keyword" id="4264998">func</span><span class="op" id="4265002">(</span><span class="ident" id="4265003">n</span>&nbsp;<span class="ident" id="4265005">Node</span><span class="op" id="4265009">)</span>&nbsp;<span class="builtintype" id="4265011">bool</span>&nbsp;<span class="op" id="4265016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265020">if</span>&nbsp;<span class="ident" id="4265023">g</span>&nbsp;<span class="op" id="4265025">:=</span>&nbsp;<span class="ident" id="4265028">cmap</span><span class="op" id="4265032">[</span><span class="ident" id="4265033">n</span><span class="op" id="4265034">]</span><span class="op" id="4265035">;</span>&nbsp;<span class="builtinfunc" id="4265037">len</span><span class="op" id="4265040">(</span><span class="ident" id="4265041">g</span><span class="op" id="4265042">)</span>&nbsp;<span class="op" id="4265044">&gt;</span>&nbsp;<span class="num" id="4265046">0</span>&nbsp;<span class="op" id="4265048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265053">umap</span><span class="op" id="4265057">[</span><span class="ident" id="4265058">n</span><span class="op" id="4265059">]</span>&nbsp;<span class="op" id="4265061">=</span>&nbsp;<span class="ident" id="4265063">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265071">return</span>&nbsp;<span class="builtintype" id="4265078">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265084">}</span><span class="op" id="4265085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265088">return</span>&nbsp;<span class="ident" id="4265095">umap</span><br>
<span class="lineno"></span><span class="op" id="4265100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265103">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="4265170">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="4265211">//</span><br>
<span class="lineno"></span><span class="keyword" id="4265214">func</span>&nbsp;<span class="op" id="4265219">(</span><span class="ident" id="4265220">cmap</span>&nbsp;<span class="ident" id="4265225">CommentMap</span><span class="op" id="4265235">)</span>&nbsp;<span class="ident" id="4265237">Comments</span><span class="op" id="4265245">(</span><span class="op" id="4265246">)</span>&nbsp;<span class="op" id="4265248">[</span><span class="op" id="4265249">]</span><span class="op" id="4265250">*</span><span class="ident" id="4265251">CommentGroup</span>&nbsp;<span class="op" id="4265264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265267">list</span>&nbsp;<span class="op" id="4265272">:=</span>&nbsp;<span class="builtinfunc" id="4265275">make</span><span class="op" id="4265279">(</span><span class="op" id="4265280">[</span><span class="op" id="4265281">]</span><span class="op" id="4265282">*</span><span class="ident" id="4265283">CommentGroup</span><span class="op" id="4265295">,</span>&nbsp;<span class="num" id="4265297">0</span><span class="op" id="4265298">,</span>&nbsp;<span class="builtinfunc" id="4265300">len</span><span class="op" id="4265303">(</span><span class="ident" id="4265304">cmap</span><span class="op" id="4265308">)</span><span class="op" id="4265309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265312">for</span>&nbsp;<span class="ident" id="4265316">_</span><span class="op" id="4265317">,</span>&nbsp;<span class="ident" id="4265319">e</span>&nbsp;<span class="op" id="4265321">:=</span>&nbsp;<span class="keyword" id="4265324">range</span>&nbsp;<span class="ident" id="4265330">cmap</span>&nbsp;<span class="op" id="4265335">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265339">list</span>&nbsp;<span class="op" id="4265344">=</span>&nbsp;<span class="builtinfunc" id="4265346">append</span><span class="op" id="4265352">(</span><span class="ident" id="4265353">list</span><span class="op" id="4265357">,</span>&nbsp;<span class="ident" id="4265359">e</span><span class="op" id="4265360">...</span><span class="op" id="4265363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265369">sortComments</span><span class="op" id="4265381">(</span><span class="ident" id="4265382">list</span><span class="op" id="4265386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265389">return</span>&nbsp;<span class="ident" id="4265396">list</span><br>
<span class="lineno"></span><span class="op" id="4265401">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="4265404">func</span>&nbsp;<span class="ident" id="4265409">summary</span><span class="op" id="4265416">(</span><span class="ident" id="4265417">list</span>&nbsp;<span class="op" id="4265422">[</span><span class="op" id="4265423">]</span><span class="op" id="4265424">*</span><span class="ident" id="4265425">CommentGroup</span><span class="op" id="4265437">)</span>&nbsp;<span class="builtintype" id="4265439">string</span>&nbsp;<span class="op" id="4265446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265449">const</span>&nbsp;<span class="ident" id="4265455">maxLen</span>&nbsp;<span class="op" id="4265462">=</span>&nbsp;<span class="num" id="4265464">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265468">var</span>&nbsp;<span class="ident" id="4265472">buf</span>&nbsp;<span class="ident" id="4265476">bytes</span><span class="op" id="4265481">.</span><span class="ident" id="4265482">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265491">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="4265516">loop</span><span class="op" id="4265520">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265523">for</span>&nbsp;<span class="ident" id="4265527">_</span><span class="op" id="4265528">,</span>&nbsp;<span class="ident" id="4265530">group</span>&nbsp;<span class="op" id="4265536">:=</span>&nbsp;<span class="keyword" id="4265539">range</span>&nbsp;<span class="ident" id="4265545">list</span>&nbsp;<span class="op" id="4265550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265554">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265616">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265676">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265710">for</span>&nbsp;<span class="ident" id="4265714">_</span><span class="op" id="4265715">,</span>&nbsp;<span class="ident" id="4265717">comment</span>&nbsp;<span class="op" id="4265725">:=</span>&nbsp;<span class="keyword" id="4265728">range</span>&nbsp;<span class="ident" id="4265734">group</span><span class="op" id="4265739">.</span><span class="ident" id="4265740">List</span>&nbsp;<span class="op" id="4265745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265750">if</span>&nbsp;<span class="ident" id="4265753">buf</span><span class="op" id="4265756">.</span><span class="ident" id="4265757">Len</span><span class="op" id="4265760">(</span><span class="op" id="4265761">)</span>&nbsp;<span class="op" id="4265763">&gt;=</span>&nbsp;<span class="ident" id="4265766">maxLen</span>&nbsp;<span class="op" id="4265773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265779">break</span>&nbsp;<span class="ident" id="4265785">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265793">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265798">buf</span><span class="op" id="4265801">.</span><span class="ident" id="4265802">WriteString</span><span class="op" id="4265813">(</span><span class="ident" id="4265814">comment</span><span class="op" id="4265821">.</span><span class="ident" id="4265822">Text</span><span class="op" id="4265826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265837">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4265862">if</span>&nbsp;<span class="ident" id="4265865">buf</span><span class="op" id="4265868">.</span><span class="ident" id="4265869">Len</span><span class="op" id="4265872">(</span><span class="op" id="4265873">)</span>&nbsp;<span class="op" id="4265875">&gt;</span>&nbsp;<span class="ident" id="4265877">maxLen</span>&nbsp;<span class="op" id="4265884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265888">buf</span><span class="op" id="4265891">.</span><span class="ident" id="4265892">Truncate</span><span class="op" id="4265900">(</span><span class="ident" id="4265901">maxLen</span>&nbsp;<span class="op" id="4265908">-</span>&nbsp;<span class="num" id="4265910">3</span><span class="op" id="4265911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265915">buf</span><span class="op" id="4265918">.</span><span class="ident" id="4265919">WriteString</span><span class="op" id="4265930">(</span><span class="string" id="4265931">&#34;...&#34;</span><span class="op" id="4265936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4265939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4265943">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4265982">bytes</span>&nbsp;<span class="op" id="4265988">:=</span>&nbsp;<span class="ident" id="4265991">buf</span><span class="op" id="4265994">.</span><span class="ident" id="4265995">Bytes</span><span class="op" id="4266000">(</span><span class="op" id="4266001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266004">for</span>&nbsp;<span class="ident" id="4266008">i</span><span class="op" id="4266009">,</span>&nbsp;<span class="ident" id="4266011">b</span>&nbsp;<span class="op" id="4266013">:=</span>&nbsp;<span class="keyword" id="4266016">range</span>&nbsp;<span class="ident" id="4266022">bytes</span>&nbsp;<span class="op" id="4266028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266032">switch</span>&nbsp;<span class="ident" id="4266039">b</span>&nbsp;<span class="op" id="4266041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266045">case</span>&nbsp;<span class="string" id="4266050">&#39;\t&#39;</span><span class="op" id="4266054">,</span>&nbsp;<span class="string" id="4266056">&#39;\n&#39;</span><span class="op" id="4266060">,</span>&nbsp;<span class="string" id="4266062">&#39;\r&#39;</span><span class="op" id="4266066">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266071">bytes</span><span class="op" id="4266076">[</span><span class="ident" id="4266077">i</span><span class="op" id="4266078">]</span>&nbsp;<span class="op" id="4266080">=</span>&nbsp;<span class="string" id="4266082">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266095">return</span>&nbsp;<span class="builtintype" id="4266102">string</span><span class="op" id="4266108">(</span><span class="ident" id="4266109">bytes</span><span class="op" id="4266114">)</span><br>
<span class="lineno">315</span><span class="op" id="4266116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4266119">func</span>&nbsp;<span class="op" id="4266124">(</span><span class="ident" id="4266125">cmap</span>&nbsp;<span class="ident" id="4266130">CommentMap</span><span class="op" id="4266140">)</span>&nbsp;<span class="ident" id="4266142">String</span><span class="op" id="4266148">(</span><span class="op" id="4266149">)</span>&nbsp;<span class="builtintype" id="4266151">string</span>&nbsp;<span class="op" id="4266158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266161">var</span>&nbsp;<span class="ident" id="4266165">buf</span>&nbsp;<span class="ident" id="4266169">bytes</span><span class="op" id="4266174">.</span><span class="ident" id="4266175">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266183">fmt</span><span class="op" id="4266186">.</span><span class="ident" id="4266187">Fprintln</span><span class="op" id="4266195">(</span><span class="op" id="4266196">&amp;</span><span class="ident" id="4266197">buf</span><span class="op" id="4266200">,</span>&nbsp;<span class="string" id="4266202">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="4266216">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266219">for</span>&nbsp;<span class="ident" id="4266223">node</span><span class="op" id="4266227">,</span>&nbsp;<span class="ident" id="4266229">comment</span>&nbsp;<span class="op" id="4266237">:=</span>&nbsp;<span class="keyword" id="4266240">range</span>&nbsp;<span class="ident" id="4266246">cmap</span>&nbsp;<span class="op" id="4266251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4266255">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266319">var</span>&nbsp;<span class="ident" id="4266323">s</span>&nbsp;<span class="builtintype" id="4266325">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266334">if</span>&nbsp;<span class="ident" id="4266337">ident</span><span class="op" id="4266342">,</span>&nbsp;<span class="ident" id="4266344">ok</span>&nbsp;<span class="op" id="4266347">:=</span>&nbsp;<span class="ident" id="4266350">node</span><span class="op" id="4266354">.</span><span class="op" id="4266355">(</span><span class="op" id="4266356">*</span><span class="ident" id="4266357">Ident</span><span class="op" id="4266362">)</span><span class="op" id="4266363">;</span>&nbsp;<span class="ident" id="4266365">ok</span>&nbsp;<span class="op" id="4266368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266373">s</span>&nbsp;<span class="op" id="4266375">=</span>&nbsp;<span class="ident" id="4266377">ident</span><span class="op" id="4266382">.</span><span class="ident" id="4266383">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266390">}</span>&nbsp;<span class="keyword" id="4266392">else</span>&nbsp;<span class="op" id="4266397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266402">s</span>&nbsp;<span class="op" id="4266404">=</span>&nbsp;<span class="ident" id="4266406">fmt</span><span class="op" id="4266409">.</span><span class="ident" id="4266410">Sprintf</span><span class="op" id="4266417">(</span><span class="string" id="4266418">&#34;%T&#34;</span><span class="op" id="4266422">,</span>&nbsp;<span class="ident" id="4266424">node</span><span class="op" id="4266428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266436">fmt</span><span class="op" id="4266439">.</span><span class="ident" id="4266440">Fprintf</span><span class="op" id="4266447">(</span><span class="op" id="4266448">&amp;</span><span class="ident" id="4266449">buf</span><span class="op" id="4266452">,</span>&nbsp;<span class="string" id="4266454">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="4266473">,</span>&nbsp;<span class="ident" id="4266475">node</span><span class="op" id="4266479">,</span>&nbsp;<span class="ident" id="4266481">s</span><span class="op" id="4266482">,</span>&nbsp;<span class="ident" id="4266484">summary</span><span class="op" id="4266491">(</span><span class="ident" id="4266492">comment</span><span class="op" id="4266499">)</span><span class="op" id="4266500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4266503">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4266506">fmt</span><span class="op" id="4266509">.</span><span class="ident" id="4266510">Fprintln</span><span class="op" id="4266518">(</span><span class="op" id="4266519">&amp;</span><span class="ident" id="4266520">buf</span><span class="op" id="4266523">,</span>&nbsp;<span class="string" id="4266525">&#34;}&#34;</span><span class="op" id="4266528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266531">return</span>&nbsp;<span class="ident" id="4266538">buf</span><span class="op" id="4266541">.</span><span class="ident" id="4266542">String</span><span class="op" id="4266548">(</span><span class="op" id="4266549">)</span><br>
<span class="lineno"></span><span class="op" id="4266551">}</span>
</div>
</body>
</html>
