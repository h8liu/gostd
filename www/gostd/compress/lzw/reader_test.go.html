<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8191982">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8192037">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8192091">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8192142">package</span>&nbsp;<span class="ident" id="8192150">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192155">import</span>&nbsp;<span class="op" id="8192162">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192165">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192174">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192180">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192193">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192204">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192215">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192226">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8192236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192239">type</span>&nbsp;<span class="ident" id="8192244">lzwTest</span>&nbsp;<span class="keyword" id="8192252">struct</span>&nbsp;<span class="op" id="8192259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192262">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8192273">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192281">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8192292">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192300">compressed</span>&nbsp;<span class="builtintype" id="8192311">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192319">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8192330">error</span><br>
<span class="lineno"></span><span class="op" id="8192336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8192339">var</span>&nbsp;<span class="ident" id="8192343">lzwTests</span>&nbsp;<span class="op" id="8192352">=</span>&nbsp;<span class="op" id="8192354">[</span><span class="op" id="8192355">]</span><span class="ident" id="8192356">lzwTest</span><span class="op" id="8192363">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192370">&#34;empty;LSB;8&#34;</span><span class="op" id="8192383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192387">&#34;&#34;</span><span class="op" id="8192389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192393">&#34;\x01\x01&#34;</span><span class="op" id="8192403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192407">nil</span><span class="op" id="8192410">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192413">}</span><span class="op" id="8192414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192421">&#34;empty;MSB;8&#34;</span><span class="op" id="8192434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192438">&#34;&#34;</span><span class="op" id="8192440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192444">&#34;\x80\x80&#34;</span><span class="op" id="8192454">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192458">nil</span><span class="op" id="8192461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192464">}</span><span class="op" id="8192465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192472">&#34;tobe;LSB;7&#34;</span><span class="op" id="8192484">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192488">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8192514">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192518">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8192588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192592">nil</span><span class="op" id="8192595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192598">}</span><span class="op" id="8192599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192606">&#34;tobe;LSB;8&#34;</span><span class="op" id="8192618">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192622">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8192648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192652">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="8192734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192738">nil</span><span class="op" id="8192741">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192744">}</span><span class="op" id="8192745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192748">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192752">&#34;tobe;MSB;7&#34;</span><span class="op" id="8192764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192768">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8192794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192798">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="8192868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8192872">nil</span><span class="op" id="8192875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192878">}</span><span class="op" id="8192879">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8192882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192886">&#34;tobe;MSB;8&#34;</span><span class="op" id="8192898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192902">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8192928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8192932">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="8193014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193018">nil</span><span class="op" id="8193021">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193024">}</span><span class="op" id="8193025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193032">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="8193054">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193058">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="8193084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193088">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="8193134">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193138">io</span><span class="op" id="8193140">.</span><span class="ident" id="8193141">ErrUnexpectedEOF</span><span class="op" id="8193157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193160">}</span><span class="op" id="8193161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8193164">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193254">&#34;gif;LSB;8&#34;</span><span class="op" id="8193265">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193269">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="8193331">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193335">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="8193381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193385">nil</span><span class="op" id="8193388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193391">}</span><span class="op" id="8193392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8193395">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193508">&#34;pdf;MSB;8&#34;</span><span class="op" id="8193519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193523">&#34;-----A---B&#34;</span><span class="op" id="8193535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8193539">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="8193577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193581">nil</span><span class="op" id="8193584">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193587">}</span><span class="op" id="8193588">,</span><br>
<span class="lineno"></span><span class="op" id="8193590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8193593">func</span>&nbsp;<span class="ident" id="8193598">TestReader</span><span class="op" id="8193608">(</span><span class="ident" id="8193609">t</span>&nbsp;<span class="op" id="8193611">*</span><span class="ident" id="8193612">testing</span><span class="op" id="8193619">.</span><span class="ident" id="8193620">T</span><span class="op" id="8193621">)</span>&nbsp;<span class="op" id="8193623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193626">var</span>&nbsp;<span class="ident" id="8193630">b</span>&nbsp;<span class="ident" id="8193632">bytes</span><span class="op" id="8193637">.</span><span class="ident" id="8193638">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193646">for</span>&nbsp;<span class="ident" id="8193650">_</span><span class="op" id="8193651">,</span>&nbsp;<span class="ident" id="8193653">tt</span>&nbsp;<span class="op" id="8193656">:=</span>&nbsp;<span class="keyword" id="8193659">range</span>&nbsp;<span class="ident" id="8193665">lzwTests</span>&nbsp;<span class="op" id="8193674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193678">d</span>&nbsp;<span class="op" id="8193680">:=</span>&nbsp;<span class="ident" id="8193683">strings</span><span class="op" id="8193690">.</span><span class="ident" id="8193691">Split</span><span class="op" id="8193696">(</span><span class="ident" id="8193697">tt</span><span class="op" id="8193699">.</span><span class="ident" id="8193700">desc</span><span class="op" id="8193704">,</span>&nbsp;<span class="string" id="8193706">&#34;;&#34;</span><span class="op" id="8193709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193713">var</span>&nbsp;<span class="ident" id="8193717">order</span>&nbsp;<span class="ident" id="8193723">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193731">switch</span>&nbsp;<span class="ident" id="8193738">d</span><span class="op" id="8193739">[</span><span class="num" id="8193740">1</span><span class="op" id="8193741">]</span>&nbsp;<span class="op" id="8193743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193747">case</span>&nbsp;<span class="string" id="8193752">&#34;LSB&#34;</span><span class="op" id="8193757">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193762">order</span>&nbsp;<span class="op" id="8193768">=</span>&nbsp;<span class="ident" id="8193770">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193776">case</span>&nbsp;<span class="string" id="8193781">&#34;MSB&#34;</span><span class="op" id="8193786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193791">order</span>&nbsp;<span class="op" id="8193797">=</span>&nbsp;<span class="ident" id="8193799">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193805">default</span><span class="op" id="8193812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193817">t</span><span class="op" id="8193818">.</span><span class="ident" id="8193819">Errorf</span><span class="op" id="8193825">(</span><span class="string" id="8193826">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="8193844">,</span>&nbsp;<span class="ident" id="8193846">tt</span><span class="op" id="8193848">.</span><span class="ident" id="8193849">desc</span><span class="op" id="8193853">,</span>&nbsp;<span class="ident" id="8193855">d</span><span class="op" id="8193856">[</span><span class="num" id="8193857">1</span><span class="op" id="8193858">]</span><span class="op" id="8193859">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8193863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193867">litWidth</span><span class="op" id="8193875">,</span>&nbsp;<span class="ident" id="8193877">_</span>&nbsp;<span class="op" id="8193879">:=</span>&nbsp;<span class="ident" id="8193882">strconv</span><span class="op" id="8193889">.</span><span class="ident" id="8193890">Atoi</span><span class="op" id="8193894">(</span><span class="ident" id="8193895">d</span><span class="op" id="8193896">[</span><span class="num" id="8193897">2</span><span class="op" id="8193898">]</span><span class="op" id="8193899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193903">rc</span>&nbsp;<span class="op" id="8193906">:=</span>&nbsp;<span class="ident" id="8193909">NewReader</span><span class="op" id="8193918">(</span><span class="ident" id="8193919">strings</span><span class="op" id="8193926">.</span><span class="ident" id="8193927">NewReader</span><span class="op" id="8193936">(</span><span class="ident" id="8193937">tt</span><span class="op" id="8193939">.</span><span class="ident" id="8193940">compressed</span><span class="op" id="8193950">)</span><span class="op" id="8193951">,</span>&nbsp;<span class="ident" id="8193953">order</span><span class="op" id="8193958">,</span>&nbsp;<span class="ident" id="8193960">litWidth</span><span class="op" id="8193968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8193972">defer</span>&nbsp;<span class="ident" id="8193978">rc</span><span class="op" id="8193980">.</span><span class="ident" id="8193981">Close</span><span class="op" id="8193986">(</span><span class="op" id="8193987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8193991">b</span><span class="op" id="8193992">.</span><span class="ident" id="8193993">Reset</span><span class="op" id="8193998">(</span><span class="op" id="8193999">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194003">n</span><span class="op" id="8194004">,</span>&nbsp;<span class="ident" id="8194006">err</span>&nbsp;<span class="op" id="8194010">:=</span>&nbsp;<span class="ident" id="8194013">io</span><span class="op" id="8194015">.</span><span class="ident" id="8194016">Copy</span><span class="op" id="8194020">(</span><span class="op" id="8194021">&amp;</span><span class="ident" id="8194022">b</span><span class="op" id="8194023">,</span>&nbsp;<span class="ident" id="8194025">rc</span><span class="op" id="8194027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194031">if</span>&nbsp;<span class="ident" id="8194034">err</span>&nbsp;<span class="op" id="8194038">!=</span>&nbsp;<span class="ident" id="8194041">nil</span>&nbsp;<span class="op" id="8194045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194050">if</span>&nbsp;<span class="ident" id="8194053">err</span>&nbsp;<span class="op" id="8194057">!=</span>&nbsp;<span class="ident" id="8194060">tt</span><span class="op" id="8194062">.</span><span class="ident" id="8194063">err</span>&nbsp;<span class="op" id="8194067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194073">t</span><span class="op" id="8194074">.</span><span class="ident" id="8194075">Errorf</span><span class="op" id="8194081">(</span><span class="string" id="8194082">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8194107">,</span>&nbsp;<span class="ident" id="8194109">tt</span><span class="op" id="8194111">.</span><span class="ident" id="8194112">desc</span><span class="op" id="8194116">,</span>&nbsp;<span class="ident" id="8194118">err</span><span class="op" id="8194121">,</span>&nbsp;<span class="ident" id="8194123">tt</span><span class="op" id="8194125">.</span><span class="ident" id="8194126">err</span><span class="op" id="8194129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194134">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194139">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194154">s</span>&nbsp;<span class="op" id="8194156">:=</span>&nbsp;<span class="ident" id="8194159">b</span><span class="op" id="8194160">.</span><span class="ident" id="8194161">String</span><span class="op" id="8194167">(</span><span class="op" id="8194168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194172">if</span>&nbsp;<span class="ident" id="8194175">s</span>&nbsp;<span class="op" id="8194177">!=</span>&nbsp;<span class="ident" id="8194180">tt</span><span class="op" id="8194182">.</span><span class="ident" id="8194183">raw</span>&nbsp;<span class="op" id="8194187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194192">t</span><span class="op" id="8194193">.</span><span class="ident" id="8194194">Errorf</span><span class="op" id="8194200">(</span><span class="string" id="8194201">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="8194237">,</span>&nbsp;<span class="ident" id="8194239">tt</span><span class="op" id="8194241">.</span><span class="ident" id="8194242">desc</span><span class="op" id="8194246">,</span>&nbsp;<span class="ident" id="8194248">n</span><span class="op" id="8194249">,</span>&nbsp;<span class="ident" id="8194251">s</span><span class="op" id="8194252">,</span>&nbsp;<span class="builtinfunc" id="8194254">len</span><span class="op" id="8194257">(</span><span class="ident" id="8194258">tt</span><span class="op" id="8194260">.</span><span class="ident" id="8194261">raw</span><span class="op" id="8194264">)</span><span class="op" id="8194265">,</span>&nbsp;<span class="ident" id="8194267">tt</span><span class="op" id="8194269">.</span><span class="ident" id="8194270">raw</span><span class="op" id="8194273">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194280">}</span><br>
<span class="lineno"></span><span class="op" id="8194282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8194285">func</span>&nbsp;<span class="ident" id="8194290">benchmarkDecoder</span><span class="op" id="8194306">(</span><span class="ident" id="8194307">b</span>&nbsp;<span class="op" id="8194309">*</span><span class="ident" id="8194310">testing</span><span class="op" id="8194317">.</span><span class="ident" id="8194318">B</span><span class="op" id="8194319">,</span>&nbsp;<span class="ident" id="8194321">n</span>&nbsp;<span class="builtintype" id="8194323">int</span><span class="op" id="8194326">)</span>&nbsp;<span class="op" id="8194328">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194331">b</span><span class="op" id="8194332">.</span><span class="ident" id="8194333">StopTimer</span><span class="op" id="8194342">(</span><span class="op" id="8194343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194346">b</span><span class="op" id="8194347">.</span><span class="ident" id="8194348">SetBytes</span><span class="op" id="8194356">(</span><span class="ident" id="8194357">int64</span><span class="op" id="8194362">(</span><span class="ident" id="8194363">n</span><span class="op" id="8194364">)</span><span class="op" id="8194365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194368">buf0</span><span class="op" id="8194372">,</span>&nbsp;<span class="ident" id="8194374">err</span>&nbsp;<span class="op" id="8194378">:=</span>&nbsp;<span class="ident" id="8194381">ioutil</span><span class="op" id="8194387">.</span><span class="ident" id="8194388">ReadFile</span><span class="op" id="8194396">(</span><span class="string" id="8194397">&#34;../testdata/e.txt&#34;</span><span class="op" id="8194416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194419">if</span>&nbsp;<span class="ident" id="8194422">err</span>&nbsp;<span class="op" id="8194426">!=</span>&nbsp;<span class="ident" id="8194429">nil</span>&nbsp;<span class="op" id="8194433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194437">b</span><span class="op" id="8194438">.</span><span class="ident" id="8194439">Fatal</span><span class="op" id="8194444">(</span><span class="ident" id="8194445">err</span><span class="op" id="8194448">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194454">if</span>&nbsp;<span class="builtinfunc" id="8194457">len</span><span class="op" id="8194460">(</span><span class="ident" id="8194461">buf0</span><span class="op" id="8194465">)</span>&nbsp;<span class="op" id="8194467">==</span>&nbsp;<span class="num" id="8194470">0</span>&nbsp;<span class="op" id="8194472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194476">b</span><span class="op" id="8194477">.</span><span class="ident" id="8194478">Fatalf</span><span class="op" id="8194484">(</span><span class="string" id="8194485">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="8194508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194514">compressed</span>&nbsp;<span class="op" id="8194525">:=</span>&nbsp;<span class="builtinfunc" id="8194528">new</span><span class="op" id="8194531">(</span><span class="ident" id="8194532">bytes</span><span class="op" id="8194537">.</span><span class="ident" id="8194538">Buffer</span><span class="op" id="8194544">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194547">w</span>&nbsp;<span class="op" id="8194549">:=</span>&nbsp;<span class="ident" id="8194552">NewWriter</span><span class="op" id="8194561">(</span><span class="ident" id="8194562">compressed</span><span class="op" id="8194572">,</span>&nbsp;<span class="ident" id="8194574">LSB</span><span class="op" id="8194577">,</span>&nbsp;<span class="num" id="8194579">8</span><span class="op" id="8194580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194583">for</span>&nbsp;<span class="ident" id="8194587">i</span>&nbsp;<span class="op" id="8194589">:=</span>&nbsp;<span class="num" id="8194592">0</span><span class="op" id="8194593">;</span>&nbsp;<span class="ident" id="8194595">i</span>&nbsp;<span class="op" id="8194597">&lt;</span>&nbsp;<span class="ident" id="8194599">n</span><span class="op" id="8194600">;</span>&nbsp;<span class="ident" id="8194602">i</span>&nbsp;<span class="op" id="8194604">+=</span>&nbsp;<span class="builtinfunc" id="8194607">len</span><span class="op" id="8194610">(</span><span class="ident" id="8194611">buf0</span><span class="op" id="8194615">)</span>&nbsp;<span class="op" id="8194617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194621">if</span>&nbsp;<span class="builtinfunc" id="8194624">len</span><span class="op" id="8194627">(</span><span class="ident" id="8194628">buf0</span><span class="op" id="8194632">)</span>&nbsp;<span class="op" id="8194634">&gt;</span>&nbsp;<span class="ident" id="8194636">n</span><span class="op" id="8194637">-</span><span class="ident" id="8194638">i</span>&nbsp;<span class="op" id="8194640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194645">buf0</span>&nbsp;<span class="op" id="8194650">=</span>&nbsp;<span class="ident" id="8194652">buf0</span><span class="op" id="8194656">[</span><span class="op" id="8194657">:</span><span class="ident" id="8194658">n</span><span class="op" id="8194659">-</span><span class="ident" id="8194660">i</span><span class="op" id="8194661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194665">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194669">w</span><span class="op" id="8194670">.</span><span class="ident" id="8194671">Write</span><span class="op" id="8194676">(</span><span class="ident" id="8194677">buf0</span><span class="op" id="8194681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194687">w</span><span class="op" id="8194688">.</span><span class="ident" id="8194689">Close</span><span class="op" id="8194694">(</span><span class="op" id="8194695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194698">buf1</span>&nbsp;<span class="op" id="8194703">:=</span>&nbsp;<span class="ident" id="8194706">compressed</span><span class="op" id="8194716">.</span><span class="ident" id="8194717">Bytes</span><span class="op" id="8194722">(</span><span class="op" id="8194723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194726">buf0</span><span class="op" id="8194730">,</span>&nbsp;<span class="ident" id="8194732">compressed</span><span class="op" id="8194742">,</span>&nbsp;<span class="ident" id="8194744">w</span>&nbsp;<span class="op" id="8194746">=</span>&nbsp;<span class="ident" id="8194748">nil</span><span class="op" id="8194751">,</span>&nbsp;<span class="ident" id="8194753">nil</span><span class="op" id="8194756">,</span>&nbsp;<span class="ident" id="8194758">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194763">runtime</span><span class="op" id="8194770">.</span><span class="ident" id="8194771">GC</span><span class="op" id="8194773">(</span><span class="op" id="8194774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194777">b</span><span class="op" id="8194778">.</span><span class="ident" id="8194779">StartTimer</span><span class="op" id="8194789">(</span><span class="op" id="8194790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8194793">for</span>&nbsp;<span class="ident" id="8194797">i</span>&nbsp;<span class="op" id="8194799">:=</span>&nbsp;<span class="num" id="8194802">0</span><span class="op" id="8194803">;</span>&nbsp;<span class="ident" id="8194805">i</span>&nbsp;<span class="op" id="8194807">&lt;</span>&nbsp;<span class="ident" id="8194809">b</span><span class="op" id="8194810">.</span><span class="ident" id="8194811">N</span><span class="op" id="8194812">;</span>&nbsp;<span class="ident" id="8194814">i</span><span class="op" id="8194815">++</span>&nbsp;<span class="op" id="8194818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194822">io</span><span class="op" id="8194824">.</span><span class="ident" id="8194825">Copy</span><span class="op" id="8194829">(</span><span class="ident" id="8194830">ioutil</span><span class="op" id="8194836">.</span><span class="ident" id="8194837">Discard</span><span class="op" id="8194844">,</span>&nbsp;<span class="ident" id="8194846">NewReader</span><span class="op" id="8194855">(</span><span class="ident" id="8194856">bytes</span><span class="op" id="8194861">.</span><span class="ident" id="8194862">NewReader</span><span class="op" id="8194871">(</span><span class="ident" id="8194872">buf1</span><span class="op" id="8194876">)</span><span class="op" id="8194877">,</span>&nbsp;<span class="ident" id="8194879">LSB</span><span class="op" id="8194882">,</span>&nbsp;<span class="num" id="8194884">8</span><span class="op" id="8194885">)</span><span class="op" id="8194886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8194889">}</span><br>
<span class="lineno">140</span><span class="op" id="8194891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8194894">func</span>&nbsp;<span class="ident" id="8194899">BenchmarkDecoder1e4</span><span class="op" id="8194918">(</span><span class="ident" id="8194919">b</span>&nbsp;<span class="op" id="8194921">*</span><span class="ident" id="8194922">testing</span><span class="op" id="8194929">.</span><span class="ident" id="8194930">B</span><span class="op" id="8194931">)</span>&nbsp;<span class="op" id="8194933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8194936">benchmarkDecoder</span><span class="op" id="8194952">(</span><span class="ident" id="8194953">b</span><span class="op" id="8194954">,</span>&nbsp;<span class="num" id="8194956">1e4</span><span class="op" id="8194959">)</span><br>
<span class="lineno"></span><span class="op" id="8194961">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="8194964">func</span>&nbsp;<span class="ident" id="8194969">BenchmarkDecoder1e5</span><span class="op" id="8194988">(</span><span class="ident" id="8194989">b</span>&nbsp;<span class="op" id="8194991">*</span><span class="ident" id="8194992">testing</span><span class="op" id="8194999">.</span><span class="ident" id="8195000">B</span><span class="op" id="8195001">)</span>&nbsp;<span class="op" id="8195003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195006">benchmarkDecoder</span><span class="op" id="8195022">(</span><span class="ident" id="8195023">b</span><span class="op" id="8195024">,</span>&nbsp;<span class="num" id="8195026">1e5</span><span class="op" id="8195029">)</span><br>
<span class="lineno"></span><span class="op" id="8195031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="8195034">func</span>&nbsp;<span class="ident" id="8195039">BenchmarkDecoder1e6</span><span class="op" id="8195058">(</span><span class="ident" id="8195059">b</span>&nbsp;<span class="op" id="8195061">*</span><span class="ident" id="8195062">testing</span><span class="op" id="8195069">.</span><span class="ident" id="8195070">B</span><span class="op" id="8195071">)</span>&nbsp;<span class="op" id="8195073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8195076">benchmarkDecoder</span><span class="op" id="8195092">(</span><span class="ident" id="8195093">b</span><span class="op" id="8195094">,</span>&nbsp;<span class="num" id="8195096">1e6</span><span class="op" id="8195099">)</span><br>
<span class="lineno"></span><span class="op" id="8195101">}</span>
</div>
</body>
</html>
