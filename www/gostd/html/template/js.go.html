<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5473050">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5473105">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5473159">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5473210">package</span>&nbsp;<span class="ident" id="5473218">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5473228">import</span>&nbsp;<span class="op" id="5473235">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473238">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473247">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473264">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473271">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473282">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5473293">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5473308">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5473311">//&nbsp;nextJSCtx&nbsp;returns&nbsp;the&nbsp;context&nbsp;that&nbsp;determines&nbsp;whether&nbsp;a&nbsp;slash&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5473386">//&nbsp;given&nbsp;run&nbsp;of&nbsp;tokens&nbsp;starts&nbsp;a&nbsp;regular&nbsp;expression&nbsp;instead&nbsp;of&nbsp;a&nbsp;division</span><br>
<span class="lineno"></span><span class="comment" id="5473459">//&nbsp;operator:&nbsp;/&nbsp;or&nbsp;/=.</span><br>
<span class="lineno"></span><span class="comment" id="5473481">//</span><br>
<span class="lineno">20</span><span class="comment" id="5473484">//&nbsp;This&nbsp;assumes&nbsp;that&nbsp;the&nbsp;token&nbsp;run&nbsp;does&nbsp;not&nbsp;include&nbsp;any&nbsp;string&nbsp;tokens,&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="5473563">//&nbsp;tokens,&nbsp;regular&nbsp;expression&nbsp;literal&nbsp;tokens,&nbsp;or&nbsp;division&nbsp;operators.</span><br>
<span class="lineno"></span><span class="comment" id="5473632">//</span><br>
<span class="lineno"></span><span class="comment" id="5473635">//&nbsp;This&nbsp;fails&nbsp;on&nbsp;some&nbsp;valid&nbsp;but&nbsp;nonsensical&nbsp;JavaScript&nbsp;programs&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="5473704">//&nbsp;&#34;x&nbsp;=&nbsp;++/foo/i&#34;&nbsp;which&nbsp;is&nbsp;quite&nbsp;different&nbsp;than&nbsp;&#34;x++/foo/i&#34;,&nbsp;but&nbsp;is&nbsp;not&nbsp;known&nbsp;to</span><br>
<span class="lineno">25</span><span class="comment" id="5473785">//&nbsp;fail&nbsp;on&nbsp;any&nbsp;known&nbsp;useful&nbsp;programs.&nbsp;It&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;draft</span><br>
<span class="lineno"></span><span class="comment" id="5473848">//&nbsp;JavaScript&nbsp;2.0&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;requires&nbsp;one&nbsp;token&nbsp;of&nbsp;lookbehind:</span><br>
<span class="lineno"></span><span class="comment" id="5473920">//&nbsp;http://www.mozilla.org/js/language/js20-2000-07/rationale/syntax.html</span><br>
<span class="lineno"></span><span class="keyword" id="5473993">func</span>&nbsp;<span class="ident" id="5473998">nextJSCtx</span><span class="op" id="5474007">(</span><span class="ident" id="5474008">s</span>&nbsp;<span class="op" id="5474010">[</span><span class="op" id="5474011">]</span><span class="builtintype" id="5474012">byte</span><span class="op" id="5474016">,</span>&nbsp;<span class="ident" id="5474018">preceding</span>&nbsp;<span class="ident" id="5474028">jsCtx</span><span class="op" id="5474033">)</span>&nbsp;<span class="ident" id="5474035">jsCtx</span>&nbsp;<span class="op" id="5474041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474044">s</span>&nbsp;<span class="op" id="5474046">=</span>&nbsp;<span class="ident" id="5474048">bytes</span><span class="op" id="5474053">.</span><span class="ident" id="5474054">TrimRight</span><span class="op" id="5474063">(</span><span class="ident" id="5474064">s</span><span class="op" id="5474065">,</span>&nbsp;<span class="string" id="5474067">&#34;\t\n\f\r&nbsp;\u2028\u2029&#34;</span><span class="op" id="5474090">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474093">if</span>&nbsp;<span class="builtinfunc" id="5474096">len</span><span class="op" id="5474099">(</span><span class="ident" id="5474100">s</span><span class="op" id="5474101">)</span>&nbsp;<span class="op" id="5474103">==</span>&nbsp;<span class="num" id="5474106">0</span>&nbsp;<span class="op" id="5474108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474112">return</span>&nbsp;<span class="ident" id="5474119">preceding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474134">//&nbsp;All&nbsp;cases&nbsp;below&nbsp;are&nbsp;in&nbsp;the&nbsp;single-byte&nbsp;UTF-8&nbsp;group.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474190">switch</span>&nbsp;<span class="ident" id="5474197">c</span><span class="op" id="5474198">,</span>&nbsp;<span class="ident" id="5474200">n</span>&nbsp;<span class="op" id="5474202">:=</span>&nbsp;<span class="ident" id="5474205">s</span><span class="op" id="5474206">[</span><span class="builtinfunc" id="5474207">len</span><span class="op" id="5474210">(</span><span class="ident" id="5474211">s</span><span class="op" id="5474212">)</span><span class="op" id="5474213">-</span><span class="num" id="5474214">1</span><span class="op" id="5474215">]</span><span class="op" id="5474216">,</span>&nbsp;<span class="builtinfunc" id="5474218">len</span><span class="op" id="5474221">(</span><span class="ident" id="5474222">s</span><span class="op" id="5474223">)</span><span class="op" id="5474224">;</span>&nbsp;<span class="ident" id="5474226">c</span>&nbsp;<span class="op" id="5474228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474231">case</span>&nbsp;<span class="string" id="5474236">&#39;+&#39;</span><span class="op" id="5474239">,</span>&nbsp;<span class="string" id="5474241">&#39;-&#39;</span><span class="op" id="5474244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474248">//&nbsp;++&nbsp;and&nbsp;--&nbsp;are&nbsp;not&nbsp;regexp&nbsp;preceders,&nbsp;but&nbsp;+&nbsp;and&nbsp;-&nbsp;are&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474313">//&nbsp;they&nbsp;are&nbsp;used&nbsp;as&nbsp;infix&nbsp;or&nbsp;prefix&nbsp;operators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474362">start</span>&nbsp;<span class="op" id="5474368">:=</span>&nbsp;<span class="ident" id="5474371">n</span>&nbsp;<span class="op" id="5474373">-</span>&nbsp;<span class="num" id="5474375">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474379">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;adjacent&nbsp;dashes&nbsp;or&nbsp;pluses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474431">for</span>&nbsp;<span class="ident" id="5474435">start</span>&nbsp;<span class="op" id="5474441">&gt;</span>&nbsp;<span class="num" id="5474443">0</span>&nbsp;<span class="op" id="5474445">&amp;&amp;</span>&nbsp;<span class="ident" id="5474448">s</span><span class="op" id="5474449">[</span><span class="ident" id="5474450">start</span><span class="op" id="5474455">-</span><span class="num" id="5474456">1</span><span class="op" id="5474457">]</span>&nbsp;<span class="op" id="5474459">==</span>&nbsp;<span class="ident" id="5474462">c</span>&nbsp;<span class="op" id="5474464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474469">start</span><span class="op" id="5474474">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474483">if</span>&nbsp;<span class="op" id="5474486">(</span><span class="ident" id="5474487">n</span><span class="op" id="5474488">-</span><span class="ident" id="5474489">start</span><span class="op" id="5474494">)</span><span class="op" id="5474495">&amp;</span><span class="num" id="5474496">1</span>&nbsp;<span class="op" id="5474498">==</span>&nbsp;<span class="num" id="5474501">1</span>&nbsp;<span class="op" id="5474503">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474508">//&nbsp;Reached&nbsp;for&nbsp;trailing&nbsp;minus&nbsp;signs&nbsp;since&nbsp;&#34;---&#34;&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474566">//&nbsp;same&nbsp;as&nbsp;&#34;--&nbsp;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474588">return</span>&nbsp;<span class="ident" id="5474595">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474613">return</span>&nbsp;<span class="ident" id="5474620">jsCtxDivOp</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474632">case</span>&nbsp;<span class="string" id="5474637">&#39;.&#39;</span><span class="op" id="5474640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474644">//&nbsp;Handle&nbsp;&#34;42.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474662">if</span>&nbsp;<span class="ident" id="5474665">n</span>&nbsp;<span class="op" id="5474667">!=</span>&nbsp;<span class="num" id="5474670">1</span>&nbsp;<span class="op" id="5474672">&amp;&amp;</span>&nbsp;<span class="string" id="5474675">&#39;0&#39;</span>&nbsp;<span class="op" id="5474679">&lt;=</span>&nbsp;<span class="ident" id="5474682">s</span><span class="op" id="5474683">[</span><span class="ident" id="5474684">n</span><span class="op" id="5474685">-</span><span class="num" id="5474686">2</span><span class="op" id="5474687">]</span>&nbsp;<span class="op" id="5474689">&amp;&amp;</span>&nbsp;<span class="ident" id="5474692">s</span><span class="op" id="5474693">[</span><span class="ident" id="5474694">n</span><span class="op" id="5474695">-</span><span class="num" id="5474696">2</span><span class="op" id="5474697">]</span>&nbsp;<span class="op" id="5474699">&lt;=</span>&nbsp;<span class="string" id="5474702">&#39;9&#39;</span>&nbsp;<span class="op" id="5474706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474711">return</span>&nbsp;<span class="ident" id="5474718">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474731">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474735">return</span>&nbsp;<span class="ident" id="5474742">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474755">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474826">//&nbsp;that&nbsp;only&nbsp;end&nbsp;binary&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474880">case</span>&nbsp;<span class="string" id="5474885">&#39;,&#39;</span><span class="op" id="5474888">,</span>&nbsp;<span class="string" id="5474890">&#39;&lt;&#39;</span><span class="op" id="5474893">,</span>&nbsp;<span class="string" id="5474895">&#39;&gt;&#39;</span><span class="op" id="5474898">,</span>&nbsp;<span class="string" id="5474900">&#39;=&#39;</span><span class="op" id="5474903">,</span>&nbsp;<span class="string" id="5474905">&#39;*&#39;</span><span class="op" id="5474908">,</span>&nbsp;<span class="string" id="5474910">&#39;%&#39;</span><span class="op" id="5474913">,</span>&nbsp;<span class="string" id="5474915">&#39;&amp;&#39;</span><span class="op" id="5474918">,</span>&nbsp;<span class="string" id="5474920">&#39;|&#39;</span><span class="op" id="5474923">,</span>&nbsp;<span class="string" id="5474925">&#39;^&#39;</span><span class="op" id="5474928">,</span>&nbsp;<span class="string" id="5474930">&#39;?&#39;</span><span class="op" id="5474933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474937">return</span>&nbsp;<span class="ident" id="5474944">jsCtxRegexp</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474957">//&nbsp;Suffixes&nbsp;for&nbsp;all&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475028">//&nbsp;that&nbsp;are&nbsp;prefix&nbsp;operators&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475077">case</span>&nbsp;<span class="string" id="5475082">&#39;!&#39;</span><span class="op" id="5475085">,</span>&nbsp;<span class="string" id="5475087">&#39;~&#39;</span><span class="op" id="5475090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475094">return</span>&nbsp;<span class="ident" id="5475101">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475114">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475184">//&nbsp;that&nbsp;are&nbsp;open&nbsp;brackets&nbsp;not&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475230">case</span>&nbsp;<span class="string" id="5475235">&#39;(&#39;</span><span class="op" id="5475238">,</span>&nbsp;<span class="string" id="5475240">&#39;[&#39;</span><span class="op" id="5475243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475247">return</span>&nbsp;<span class="ident" id="5475254">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475267">//&nbsp;Matches&nbsp;all&nbsp;the&nbsp;punctuators&nbsp;from&nbsp;section&nbsp;7.7&nbsp;of&nbsp;the&nbsp;language&nbsp;spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475337">//&nbsp;that&nbsp;precede&nbsp;expression&nbsp;starts.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475373">case</span>&nbsp;<span class="string" id="5475378">&#39;:&#39;</span><span class="op" id="5475381">,</span>&nbsp;<span class="string" id="5475383">&#39;;&#39;</span><span class="op" id="5475386">,</span>&nbsp;<span class="string" id="5475388">&#39;{&#39;</span><span class="op" id="5475391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475395">return</span>&nbsp;<span class="ident" id="5475402">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475415">//&nbsp;CAVEAT:&nbsp;the&nbsp;close&nbsp;punctuators&nbsp;(&#39;}&#39;,&nbsp;&#39;]&#39;,&nbsp;&#39;)&#39;)&nbsp;precede&nbsp;div&nbsp;ops&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475485">//&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;default&nbsp;except&nbsp;for&nbsp;&#39;}&#39;&nbsp;which&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475551">//&nbsp;division&nbsp;op&nbsp;as&nbsp;in</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475573">//&nbsp;&nbsp;&nbsp;&nbsp;({&nbsp;valueOf:&nbsp;function&nbsp;()&nbsp;{&nbsp;return&nbsp;42&nbsp;}&nbsp;}&nbsp;/&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475624">//&nbsp;which&nbsp;is&nbsp;valid,&nbsp;but,&nbsp;in&nbsp;practice,&nbsp;developers&nbsp;don&#39;t&nbsp;divide&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475693">//&nbsp;literals,&nbsp;so&nbsp;our&nbsp;heuristic&nbsp;works&nbsp;well&nbsp;for&nbsp;code&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475749">//&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;()&nbsp;{&nbsp;...&nbsp;}&nbsp;&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;sideEffect();</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475808">//&nbsp;The&nbsp;&#39;)&#39;&nbsp;punctuator&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression&nbsp;as&nbsp;in</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475870">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(b)&nbsp;/foo/.test(x)&nbsp;&amp;&amp;&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475906">//&nbsp;but&nbsp;this&nbsp;is&nbsp;much&nbsp;less&nbsp;likely&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475944">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a&nbsp;+&nbsp;b)&nbsp;/&nbsp;c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475964">case</span>&nbsp;<span class="string" id="5475969">&#39;}&#39;</span><span class="op" id="5475972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475976">return</span>&nbsp;<span class="ident" id="5475983">jsCtxRegexp</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475996">default</span><span class="op" id="5476003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476007">//&nbsp;Look&nbsp;for&nbsp;an&nbsp;IdentifierName&nbsp;and&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;a&nbsp;keyword&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476071">//&nbsp;can&nbsp;precede&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476110">j</span>&nbsp;<span class="op" id="5476112">:=</span>&nbsp;<span class="ident" id="5476115">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476119">for</span>&nbsp;<span class="ident" id="5476123">j</span>&nbsp;<span class="op" id="5476125">&gt;</span>&nbsp;<span class="num" id="5476127">0</span>&nbsp;<span class="op" id="5476129">&amp;&amp;</span>&nbsp;<span class="ident" id="5476132">isJSIdentPart</span><span class="op" id="5476145">(</span><span class="builtintype" id="5476146">rune</span><span class="op" id="5476150">(</span><span class="ident" id="5476151">s</span><span class="op" id="5476152">[</span><span class="ident" id="5476153">j</span><span class="op" id="5476154">-</span><span class="num" id="5476155">1</span><span class="op" id="5476156">]</span><span class="op" id="5476157">)</span><span class="op" id="5476158">)</span>&nbsp;<span class="op" id="5476160">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5476165">j</span><span class="op" id="5476166">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476175">if</span>&nbsp;<span class="ident" id="5476178">regexpPrecederKeywords</span><span class="op" id="5476200">[</span><span class="builtintype" id="5476201">string</span><span class="op" id="5476207">(</span><span class="ident" id="5476208">s</span><span class="op" id="5476209">[</span><span class="ident" id="5476210">j</span><span class="op" id="5476211">:</span><span class="op" id="5476212">]</span><span class="op" id="5476213">)</span><span class="op" id="5476214">]</span>&nbsp;<span class="op" id="5476216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476221">return</span>&nbsp;<span class="ident" id="5476228">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476242">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5476245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476248">//&nbsp;Otherwise&nbsp;is&nbsp;a&nbsp;punctuator&nbsp;not&nbsp;listed&nbsp;above,&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476299">//&nbsp;a&nbsp;string&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op,&nbsp;or&nbsp;an&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5476354">//&nbsp;which&nbsp;precedes&nbsp;a&nbsp;div&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5476383">return</span>&nbsp;<span class="ident" id="5476390">jsCtxDivOp</span><br>
<span class="lineno">100</span><span class="op" id="5476401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476404">//&nbsp;regexpPrecederKeywords&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;reserved&nbsp;JS&nbsp;keywords&nbsp;that&nbsp;can&nbsp;precede&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5476482">//&nbsp;regular&nbsp;expression&nbsp;in&nbsp;JS&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5476518">var</span>&nbsp;<span class="ident" id="5476522">regexpPrecederKeywords</span>&nbsp;<span class="op" id="5476545">=</span>&nbsp;<span class="keyword" id="5476547">map</span><span class="op" id="5476550">[</span><span class="builtintype" id="5476551">string</span><span class="op" id="5476557">]</span><span class="builtintype" id="5476558">bool</span><span class="op" id="5476562">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476565">&#34;break&#34;</span><span class="op" id="5476572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476579">true</span><span class="op" id="5476583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476586">&#34;case&#34;</span><span class="op" id="5476592">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476600">true</span><span class="op" id="5476604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476607">&#34;continue&#34;</span><span class="op" id="5476617">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476621">true</span><span class="op" id="5476625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476628">&#34;delete&#34;</span><span class="op" id="5476636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476642">true</span><span class="op" id="5476646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476649">&#34;do&#34;</span><span class="op" id="5476653">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476663">true</span><span class="op" id="5476667">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476670">&#34;else&#34;</span><span class="op" id="5476676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476684">true</span><span class="op" id="5476688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476691">&#34;finally&#34;</span><span class="op" id="5476700">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476705">true</span><span class="op" id="5476709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476712">&#34;in&#34;</span><span class="op" id="5476716">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476726">true</span><span class="op" id="5476730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476733">&#34;instanceof&#34;</span><span class="op" id="5476745">:</span>&nbsp;<span class="builtintype" id="5476747">true</span><span class="op" id="5476751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476754">&#34;return&#34;</span><span class="op" id="5476762">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476768">true</span><span class="op" id="5476772">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476775">&#34;throw&#34;</span><span class="op" id="5476782">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476789">true</span><span class="op" id="5476793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476796">&#34;try&#34;</span><span class="op" id="5476801">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476810">true</span><span class="op" id="5476814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476817">&#34;typeof&#34;</span><span class="op" id="5476825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476831">true</span><span class="op" id="5476835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5476838">&#34;void&#34;</span><span class="op" id="5476844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5476852">true</span><span class="op" id="5476856">,</span><br>
<span class="lineno"></span><span class="op" id="5476858">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="5476861">var</span>&nbsp;<span class="ident" id="5476865">jsonMarshalType</span>&nbsp;<span class="op" id="5476881">=</span>&nbsp;<span class="ident" id="5476883">reflect</span><span class="op" id="5476890">.</span><span class="ident" id="5476891">TypeOf</span><span class="op" id="5476897">(</span><span class="op" id="5476898">(</span><span class="op" id="5476899">*</span><span class="ident" id="5476900">json</span><span class="op" id="5476904">.</span><span class="ident" id="5476905">Marshaler</span><span class="op" id="5476914">)</span><span class="op" id="5476915">(</span><span class="ident" id="5476916">nil</span><span class="op" id="5476919">)</span><span class="op" id="5476920">)</span><span class="op" id="5476921">.</span><span class="ident" id="5476922">Elem</span><span class="op" id="5476926">(</span><span class="op" id="5476927">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5476930">//&nbsp;indirectToJSONMarshaler&nbsp;returns&nbsp;the&nbsp;value,&nbsp;after&nbsp;dereferencing&nbsp;as&nbsp;many&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="5477010">//&nbsp;as&nbsp;necessary&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type&nbsp;(or&nbsp;nil)&nbsp;or&nbsp;an&nbsp;implementation&nbsp;of&nbsp;json.Marshal.</span><br>
<span class="lineno">125</span><span class="keyword" id="5477096">func</span>&nbsp;<span class="ident" id="5477101">indirectToJSONMarshaler</span><span class="op" id="5477124">(</span><span class="ident" id="5477125">a</span>&nbsp;<span class="keyword" id="5477127">interface</span><span class="op" id="5477136">{</span><span class="op" id="5477137">}</span><span class="op" id="5477138">)</span>&nbsp;<span class="keyword" id="5477140">interface</span><span class="op" id="5477149">{</span><span class="op" id="5477150">}</span>&nbsp;<span class="op" id="5477152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477155">v</span>&nbsp;<span class="op" id="5477157">:=</span>&nbsp;<span class="ident" id="5477160">reflect</span><span class="op" id="5477167">.</span><span class="ident" id="5477168">ValueOf</span><span class="op" id="5477175">(</span><span class="ident" id="5477176">a</span><span class="op" id="5477177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477180">for</span>&nbsp;<span class="op" id="5477184">!</span><span class="ident" id="5477185">v</span><span class="op" id="5477186">.</span><span class="ident" id="5477187">Type</span><span class="op" id="5477191">(</span><span class="op" id="5477192">)</span><span class="op" id="5477193">.</span><span class="ident" id="5477194">Implements</span><span class="op" id="5477204">(</span><span class="ident" id="5477205">jsonMarshalType</span><span class="op" id="5477220">)</span>&nbsp;<span class="op" id="5477222">&amp;&amp;</span>&nbsp;<span class="ident" id="5477225">v</span><span class="op" id="5477226">.</span><span class="ident" id="5477227">Kind</span><span class="op" id="5477231">(</span><span class="op" id="5477232">)</span>&nbsp;<span class="op" id="5477234">==</span>&nbsp;<span class="ident" id="5477237">reflect</span><span class="op" id="5477244">.</span><span class="ident" id="5477245">Ptr</span>&nbsp;<span class="op" id="5477249">&amp;&amp;</span>&nbsp;<span class="op" id="5477252">!</span><span class="ident" id="5477253">v</span><span class="op" id="5477254">.</span><span class="ident" id="5477255">IsNil</span><span class="op" id="5477260">(</span><span class="op" id="5477261">)</span>&nbsp;<span class="op" id="5477263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477267">v</span>&nbsp;<span class="op" id="5477269">=</span>&nbsp;<span class="ident" id="5477271">v</span><span class="op" id="5477272">.</span><span class="ident" id="5477273">Elem</span><span class="op" id="5477277">(</span><span class="op" id="5477278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477281">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477284">return</span>&nbsp;<span class="ident" id="5477291">v</span><span class="op" id="5477292">.</span><span class="ident" id="5477293">Interface</span><span class="op" id="5477302">(</span><span class="op" id="5477303">)</span><br>
<span class="lineno"></span><span class="op" id="5477305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5477308">//&nbsp;jsValEscaper&nbsp;escapes&nbsp;its&nbsp;inputs&nbsp;to&nbsp;a&nbsp;JS&nbsp;Expression&nbsp;(section&nbsp;11.14)&nbsp;that&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5477387">//&nbsp;neither&nbsp;side-effects&nbsp;nor&nbsp;free&nbsp;variables&nbsp;outside&nbsp;(NaN,&nbsp;Infinity).</span><br>
<span class="lineno">135</span><span class="keyword" id="5477455">func</span>&nbsp;<span class="ident" id="5477460">jsValEscaper</span><span class="op" id="5477472">(</span><span class="ident" id="5477473">args</span>&nbsp;<span class="op" id="5477478">...</span><span class="keyword" id="5477481">interface</span><span class="op" id="5477490">{</span><span class="op" id="5477491">}</span><span class="op" id="5477492">)</span>&nbsp;<span class="builtintype" id="5477494">string</span>&nbsp;<span class="op" id="5477501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477504">var</span>&nbsp;<span class="ident" id="5477508">a</span>&nbsp;<span class="keyword" id="5477510">interface</span><span class="op" id="5477519">{</span><span class="op" id="5477520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477523">if</span>&nbsp;<span class="builtinfunc" id="5477526">len</span><span class="op" id="5477529">(</span><span class="ident" id="5477530">args</span><span class="op" id="5477534">)</span>&nbsp;<span class="op" id="5477536">==</span>&nbsp;<span class="num" id="5477539">1</span>&nbsp;<span class="op" id="5477541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477545">a</span>&nbsp;<span class="op" id="5477547">=</span>&nbsp;<span class="ident" id="5477549">indirectToJSONMarshaler</span><span class="op" id="5477572">(</span><span class="ident" id="5477573">args</span><span class="op" id="5477577">[</span><span class="num" id="5477578">0</span><span class="op" id="5477579">]</span><span class="op" id="5477580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477584">switch</span>&nbsp;<span class="ident" id="5477591">t</span>&nbsp;<span class="op" id="5477593">:=</span>&nbsp;<span class="ident" id="5477596">a</span><span class="op" id="5477597">.</span><span class="op" id="5477598">(</span><span class="keyword" id="5477599">type</span><span class="op" id="5477603">)</span>&nbsp;<span class="op" id="5477605">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477609">case</span>&nbsp;<span class="ident" id="5477614">JS</span><span class="op" id="5477616">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477621">return</span>&nbsp;<span class="builtintype" id="5477628">string</span><span class="op" id="5477634">(</span><span class="ident" id="5477635">t</span><span class="op" id="5477636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477640">case</span>&nbsp;<span class="ident" id="5477645">JSStr</span><span class="op" id="5477650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477655">//&nbsp;TODO:&nbsp;normalize&nbsp;quotes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477685">return</span>&nbsp;<span class="string" id="5477692">`&#34;`</span>&nbsp;<span class="op" id="5477696">+</span>&nbsp;<span class="builtintype" id="5477698">string</span><span class="op" id="5477704">(</span><span class="ident" id="5477705">t</span><span class="op" id="5477706">)</span>&nbsp;<span class="op" id="5477708">+</span>&nbsp;<span class="string" id="5477710">`&#34;`</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477716">case</span>&nbsp;<span class="ident" id="5477721">json</span><span class="op" id="5477725">.</span><span class="ident" id="5477726">Marshaler</span><span class="op" id="5477735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477740">//&nbsp;Do&nbsp;not&nbsp;treat&nbsp;as&nbsp;a&nbsp;Stringer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477773">case</span>&nbsp;<span class="ident" id="5477778">fmt</span><span class="op" id="5477781">.</span><span class="ident" id="5477782">Stringer</span><span class="op" id="5477790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477795">a</span>&nbsp;<span class="op" id="5477797">=</span>&nbsp;<span class="ident" id="5477799">t</span><span class="op" id="5477800">.</span><span class="ident" id="5477801">String</span><span class="op" id="5477807">(</span><span class="op" id="5477808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477812">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477815">}</span>&nbsp;<span class="keyword" id="5477817">else</span>&nbsp;<span class="op" id="5477822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5477826">for</span>&nbsp;<span class="ident" id="5477830">i</span><span class="op" id="5477831">,</span>&nbsp;<span class="ident" id="5477833">arg</span>&nbsp;<span class="op" id="5477837">:=</span>&nbsp;<span class="keyword" id="5477840">range</span>&nbsp;<span class="ident" id="5477846">args</span>&nbsp;<span class="op" id="5477851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477856">args</span><span class="op" id="5477860">[</span><span class="ident" id="5477861">i</span><span class="op" id="5477862">]</span>&nbsp;<span class="op" id="5477864">=</span>&nbsp;<span class="ident" id="5477866">indirectToJSONMarshaler</span><span class="op" id="5477889">(</span><span class="ident" id="5477890">arg</span><span class="op" id="5477893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5477901">a</span>&nbsp;<span class="op" id="5477903">=</span>&nbsp;<span class="ident" id="5477905">fmt</span><span class="op" id="5477908">.</span><span class="ident" id="5477909">Sprint</span><span class="op" id="5477915">(</span><span class="ident" id="5477916">args</span><span class="op" id="5477920">...</span><span class="op" id="5477923">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5477926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5477929">//&nbsp;TODO:&nbsp;detect&nbsp;cycles&nbsp;before&nbsp;calling&nbsp;Marshal&nbsp;which&nbsp;loops&nbsp;infinitely&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478002">//&nbsp;cyclic&nbsp;data.&nbsp;This&nbsp;may&nbsp;be&nbsp;an&nbsp;unacceptable&nbsp;DoS&nbsp;risk.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478058">b</span><span class="op" id="5478059">,</span>&nbsp;<span class="ident" id="5478061">err</span>&nbsp;<span class="op" id="5478065">:=</span>&nbsp;<span class="ident" id="5478068">json</span><span class="op" id="5478072">.</span><span class="ident" id="5478073">Marshal</span><span class="op" id="5478080">(</span><span class="ident" id="5478081">a</span><span class="op" id="5478082">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478085">if</span>&nbsp;<span class="ident" id="5478088">err</span>&nbsp;<span class="op" id="5478092">!=</span>&nbsp;<span class="ident" id="5478095">nil</span>&nbsp;<span class="op" id="5478099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478103">//&nbsp;Put&nbsp;a&nbsp;space&nbsp;before&nbsp;comment&nbsp;so&nbsp;that&nbsp;if&nbsp;it&nbsp;is&nbsp;flush&nbsp;against</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478166">//&nbsp;a&nbsp;division&nbsp;operator&nbsp;it&nbsp;is&nbsp;not&nbsp;turned&nbsp;into&nbsp;a&nbsp;line&nbsp;comment:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478229">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x/{{y}}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478246">//&nbsp;turning&nbsp;into</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478264">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x//*&nbsp;error&nbsp;marshalling&nbsp;y:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478299">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;second&nbsp;line&nbsp;of&nbsp;error&nbsp;message&nbsp;*/null</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478349">return</span>&nbsp;<span class="ident" id="5478356">fmt</span><span class="op" id="5478359">.</span><span class="ident" id="5478360">Sprintf</span><span class="op" id="5478367">(</span><span class="string" id="5478368">&#34;&nbsp;/*&nbsp;%s&nbsp;*/null&nbsp;&#34;</span><span class="op" id="5478384">,</span>&nbsp;<span class="ident" id="5478386">strings</span><span class="op" id="5478393">.</span><span class="ident" id="5478394">Replace</span><span class="op" id="5478401">(</span><span class="ident" id="5478402">err</span><span class="op" id="5478405">.</span><span class="ident" id="5478406">Error</span><span class="op" id="5478411">(</span><span class="op" id="5478412">)</span><span class="op" id="5478413">,</span>&nbsp;<span class="string" id="5478415">&#34;*/&#34;</span><span class="op" id="5478419">,</span>&nbsp;<span class="string" id="5478421">&#34;*&nbsp;/&#34;</span><span class="op" id="5478426">,</span>&nbsp;<span class="op" id="5478428">-</span><span class="num" id="5478429">1</span><span class="op" id="5478430">)</span><span class="op" id="5478431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478438">//&nbsp;TODO:&nbsp;maybe&nbsp;post-process&nbsp;output&nbsp;to&nbsp;prevent&nbsp;it&nbsp;from&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478504">//&nbsp;&#34;&lt;!--&#34;,&nbsp;&#34;--&gt;&#34;,&nbsp;&#34;&lt;![CDATA[&#34;,&nbsp;&#34;]]&gt;&#34;,&nbsp;or&nbsp;&#34;&lt;/script&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478557">//&nbsp;in&nbsp;case&nbsp;custom&nbsp;marshallers&nbsp;produce&nbsp;output&nbsp;containing&nbsp;those.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478622">//&nbsp;TODO:&nbsp;Maybe&nbsp;abbreviate&nbsp;\u00ab&nbsp;to&nbsp;\xab&nbsp;to&nbsp;produce&nbsp;more&nbsp;compact&nbsp;output.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478696">if</span>&nbsp;<span class="builtinfunc" id="5478699">len</span><span class="op" id="5478702">(</span><span class="ident" id="5478703">b</span><span class="op" id="5478704">)</span>&nbsp;<span class="op" id="5478706">==</span>&nbsp;<span class="num" id="5478709">0</span>&nbsp;<span class="op" id="5478711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478715">//&nbsp;In,&nbsp;`x=y/{{.}}*z`&nbsp;a&nbsp;json.Marshaler&nbsp;that&nbsp;produces&nbsp;&#34;&#34;&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478779">//&nbsp;not&nbsp;cause&nbsp;the&nbsp;output&nbsp;`x=y/*z`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478815">return</span>&nbsp;<span class="string" id="5478822">&#34;&nbsp;null&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5478832">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478835">first</span><span class="op" id="5478840">,</span>&nbsp;<span class="ident" id="5478842">_</span>&nbsp;<span class="op" id="5478844">:=</span>&nbsp;<span class="ident" id="5478847">utf8</span><span class="op" id="5478851">.</span><span class="ident" id="5478852">DecodeRune</span><span class="op" id="5478862">(</span><span class="ident" id="5478863">b</span><span class="op" id="5478864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5478867">last</span><span class="op" id="5478871">,</span>&nbsp;<span class="ident" id="5478873">_</span>&nbsp;<span class="op" id="5478875">:=</span>&nbsp;<span class="ident" id="5478878">utf8</span><span class="op" id="5478882">.</span><span class="ident" id="5478883">DecodeLastRune</span><span class="op" id="5478897">(</span><span class="ident" id="5478898">b</span><span class="op" id="5478899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5478902">var</span>&nbsp;<span class="ident" id="5478906">buf</span>&nbsp;<span class="ident" id="5478910">bytes</span><span class="op" id="5478915">.</span><span class="ident" id="5478916">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478924">//&nbsp;Prevent&nbsp;IdentifierNames&nbsp;and&nbsp;NumericLiterals&nbsp;from&nbsp;running&nbsp;into</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5478990">//&nbsp;keywords:&nbsp;in,&nbsp;instanceof,&nbsp;typeof,&nbsp;void</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479033">pad</span>&nbsp;<span class="op" id="5479037">:=</span>&nbsp;<span class="ident" id="5479040">isJSIdentPart</span><span class="op" id="5479053">(</span><span class="ident" id="5479054">first</span><span class="op" id="5479059">)</span>&nbsp;<span class="op" id="5479061">||</span>&nbsp;<span class="ident" id="5479064">isJSIdentPart</span><span class="op" id="5479077">(</span><span class="ident" id="5479078">last</span><span class="op" id="5479082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479085">if</span>&nbsp;<span class="ident" id="5479088">pad</span>&nbsp;<span class="op" id="5479092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479096">buf</span><span class="op" id="5479099">.</span><span class="ident" id="5479100">WriteByte</span><span class="op" id="5479109">(</span><span class="string" id="5479110">&#39;&nbsp;&#39;</span><span class="op" id="5479113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479119">written</span>&nbsp;<span class="op" id="5479127">:=</span>&nbsp;<span class="num" id="5479130">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479133">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;json.Marshal&nbsp;escapes&nbsp;codepoints&nbsp;U+2028&nbsp;&amp;&nbsp;U+2029</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5479200">//&nbsp;so&nbsp;it&nbsp;falls&nbsp;within&nbsp;the&nbsp;subset&nbsp;of&nbsp;JSON&nbsp;which&nbsp;is&nbsp;valid&nbsp;JS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479261">for</span>&nbsp;<span class="ident" id="5479265">i</span>&nbsp;<span class="op" id="5479267">:=</span>&nbsp;<span class="num" id="5479270">0</span><span class="op" id="5479271">;</span>&nbsp;<span class="ident" id="5479273">i</span>&nbsp;<span class="op" id="5479275">&lt;</span>&nbsp;<span class="builtinfunc" id="5479277">len</span><span class="op" id="5479280">(</span><span class="ident" id="5479281">b</span><span class="op" id="5479282">)</span><span class="op" id="5479283">;</span>&nbsp;<span class="op" id="5479285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5479289">rune</span><span class="op" id="5479293">,</span>&nbsp;<span class="ident" id="5479295">n</span>&nbsp;<span class="op" id="5479297">:=</span>&nbsp;<span class="ident" id="5479300">utf8</span><span class="op" id="5479304">.</span><span class="ident" id="5479305">DecodeRune</span><span class="op" id="5479315">(</span><span class="ident" id="5479316">b</span><span class="op" id="5479317">[</span><span class="ident" id="5479318">i</span><span class="op" id="5479319">:</span><span class="op" id="5479320">]</span><span class="op" id="5479321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479325">repl</span>&nbsp;<span class="op" id="5479330">:=</span>&nbsp;<span class="string" id="5479333">&#34;&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479338">if</span>&nbsp;<span class="builtintype" id="5479341">rune</span>&nbsp;<span class="op" id="5479346">==</span>&nbsp;<span class="num" id="5479349">0x2028</span>&nbsp;<span class="op" id="5479356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479361">repl</span>&nbsp;<span class="op" id="5479366">=</span>&nbsp;<span class="string" id="5479368">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479379">}</span>&nbsp;<span class="keyword" id="5479381">else</span>&nbsp;<span class="keyword" id="5479386">if</span>&nbsp;<span class="builtintype" id="5479389">rune</span>&nbsp;<span class="op" id="5479394">==</span>&nbsp;<span class="num" id="5479397">0x2029</span>&nbsp;<span class="op" id="5479404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479409">repl</span>&nbsp;<span class="op" id="5479414">=</span>&nbsp;<span class="string" id="5479416">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479427">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479431">if</span>&nbsp;<span class="ident" id="5479434">repl</span>&nbsp;<span class="op" id="5479439">!=</span>&nbsp;<span class="string" id="5479442">&#34;&#34;</span>&nbsp;<span class="op" id="5479445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479450">buf</span><span class="op" id="5479453">.</span><span class="ident" id="5479454">Write</span><span class="op" id="5479459">(</span><span class="ident" id="5479460">b</span><span class="op" id="5479461">[</span><span class="ident" id="5479462">written</span><span class="op" id="5479469">:</span><span class="ident" id="5479470">i</span><span class="op" id="5479471">]</span><span class="op" id="5479472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479477">buf</span><span class="op" id="5479480">.</span><span class="ident" id="5479481">WriteString</span><span class="op" id="5479492">(</span><span class="ident" id="5479493">repl</span><span class="op" id="5479497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479502">written</span>&nbsp;<span class="op" id="5479510">=</span>&nbsp;<span class="ident" id="5479512">i</span>&nbsp;<span class="op" id="5479514">+</span>&nbsp;<span class="ident" id="5479516">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479520">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479524">i</span>&nbsp;<span class="op" id="5479526">+=</span>&nbsp;<span class="ident" id="5479529">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479535">if</span>&nbsp;<span class="ident" id="5479538">buf</span><span class="op" id="5479541">.</span><span class="ident" id="5479542">Len</span><span class="op" id="5479545">(</span><span class="op" id="5479546">)</span>&nbsp;<span class="op" id="5479548">!=</span>&nbsp;<span class="num" id="5479551">0</span>&nbsp;<span class="op" id="5479553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479557">buf</span><span class="op" id="5479560">.</span><span class="ident" id="5479561">Write</span><span class="op" id="5479566">(</span><span class="ident" id="5479567">b</span><span class="op" id="5479568">[</span><span class="ident" id="5479569">written</span><span class="op" id="5479576">:</span><span class="op" id="5479577">]</span><span class="op" id="5479578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479582">if</span>&nbsp;<span class="ident" id="5479585">pad</span>&nbsp;<span class="op" id="5479589">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479594">buf</span><span class="op" id="5479597">.</span><span class="ident" id="5479598">WriteByte</span><span class="op" id="5479607">(</span><span class="string" id="5479608">&#39;&nbsp;&#39;</span><span class="op" id="5479611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479619">b</span>&nbsp;<span class="op" id="5479621">=</span>&nbsp;<span class="ident" id="5479623">buf</span><span class="op" id="5479626">.</span><span class="ident" id="5479627">Bytes</span><span class="op" id="5479632">(</span><span class="op" id="5479633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5479636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479639">return</span>&nbsp;<span class="builtintype" id="5479646">string</span><span class="op" id="5479652">(</span><span class="ident" id="5479653">b</span><span class="op" id="5479654">)</span><br>
<span class="lineno">215</span><span class="op" id="5479656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5479659">//&nbsp;jsStrEscaper&nbsp;produces&nbsp;a&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;included&nbsp;between&nbsp;quotes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5479732">//&nbsp;JavaScript&nbsp;source,&nbsp;in&nbsp;JavaScript&nbsp;embedded&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;&lt;script&gt;&nbsp;element,</span><br>
<span class="lineno"></span><span class="comment" id="5479807">//&nbsp;or&nbsp;in&nbsp;an&nbsp;HTML5&nbsp;event&nbsp;handler&nbsp;attribute&nbsp;such&nbsp;as&nbsp;onclick.</span><br>
<span class="lineno">220</span><span class="keyword" id="5479866">func</span>&nbsp;<span class="ident" id="5479871">jsStrEscaper</span><span class="op" id="5479883">(</span><span class="ident" id="5479884">args</span>&nbsp;<span class="op" id="5479889">...</span><span class="keyword" id="5479892">interface</span><span class="op" id="5479901">{</span><span class="op" id="5479902">}</span><span class="op" id="5479903">)</span>&nbsp;<span class="builtintype" id="5479905">string</span>&nbsp;<span class="op" id="5479912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5479915">s</span><span class="op" id="5479916">,</span>&nbsp;<span class="ident" id="5479918">t</span>&nbsp;<span class="op" id="5479920">:=</span>&nbsp;<span class="ident" id="5479923">stringify</span><span class="op" id="5479932">(</span><span class="ident" id="5479933">args</span><span class="op" id="5479937">...</span><span class="op" id="5479940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479943">if</span>&nbsp;<span class="ident" id="5479946">t</span>&nbsp;<span class="op" id="5479948">==</span>&nbsp;<span class="ident" id="5479951">contentTypeJSStr</span>&nbsp;<span class="op" id="5479968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5479972">return</span>&nbsp;<span class="ident" id="5479979">replace</span><span class="op" id="5479986">(</span><span class="ident" id="5479987">s</span><span class="op" id="5479988">,</span>&nbsp;<span class="ident" id="5479990">jsStrNormReplacementTable</span><span class="op" id="5480015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480018">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480021">return</span>&nbsp;<span class="ident" id="5480028">replace</span><span class="op" id="5480035">(</span><span class="ident" id="5480036">s</span><span class="op" id="5480037">,</span>&nbsp;<span class="ident" id="5480039">jsStrReplacementTable</span><span class="op" id="5480060">)</span><br>
<span class="lineno"></span><span class="op" id="5480062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480065">//&nbsp;jsRegexpEscaper&nbsp;behaves&nbsp;like&nbsp;jsStrEscaper&nbsp;but&nbsp;escapes&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="5480141">//&nbsp;specials&nbsp;so&nbsp;the&nbsp;result&nbsp;is&nbsp;treated&nbsp;literally&nbsp;when&nbsp;included&nbsp;in&nbsp;a&nbsp;regular</span><br>
<span class="lineno">230</span><span class="comment" id="5480215">//&nbsp;expression&nbsp;literal.&nbsp;/foo{{.X}}bar/&nbsp;matches&nbsp;the&nbsp;string&nbsp;&#34;foo&#34;&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5480290">//&nbsp;the&nbsp;literal&nbsp;text&nbsp;of&nbsp;{{.X}}&nbsp;followed&nbsp;by&nbsp;the&nbsp;string&nbsp;&#34;bar&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5480350">func</span>&nbsp;<span class="ident" id="5480355">jsRegexpEscaper</span><span class="op" id="5480370">(</span><span class="ident" id="5480371">args</span>&nbsp;<span class="op" id="5480376">...</span><span class="keyword" id="5480379">interface</span><span class="op" id="5480388">{</span><span class="op" id="5480389">}</span><span class="op" id="5480390">)</span>&nbsp;<span class="builtintype" id="5480392">string</span>&nbsp;<span class="op" id="5480399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480402">s</span><span class="op" id="5480403">,</span>&nbsp;<span class="ident" id="5480405">_</span>&nbsp;<span class="op" id="5480407">:=</span>&nbsp;<span class="ident" id="5480410">stringify</span><span class="op" id="5480419">(</span><span class="ident" id="5480420">args</span><span class="op" id="5480424">...</span><span class="op" id="5480427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480430">s</span>&nbsp;<span class="op" id="5480432">=</span>&nbsp;<span class="ident" id="5480434">replace</span><span class="op" id="5480441">(</span><span class="ident" id="5480442">s</span><span class="op" id="5480443">,</span>&nbsp;<span class="ident" id="5480445">jsRegexpReplacementTable</span><span class="op" id="5480469">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480472">if</span>&nbsp;<span class="ident" id="5480475">s</span>&nbsp;<span class="op" id="5480477">==</span>&nbsp;<span class="string" id="5480480">&#34;&#34;</span>&nbsp;<span class="op" id="5480483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5480487">//&nbsp;/{{.X}}/&nbsp;should&nbsp;not&nbsp;produce&nbsp;a&nbsp;line&nbsp;comment&nbsp;when&nbsp;.X&nbsp;==&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480550">return</span>&nbsp;<span class="string" id="5480557">&#34;(?:)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5480565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480568">return</span>&nbsp;<span class="ident" id="5480575">s</span><br>
<span class="lineno">240</span><span class="op" id="5480577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5480580">//&nbsp;replace&nbsp;replaces&nbsp;each&nbsp;rune&nbsp;r&nbsp;of&nbsp;s&nbsp;with&nbsp;replacementTable[r],&nbsp;provided&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5480657">//&nbsp;r&nbsp;&lt;&nbsp;len(replacementTable).&nbsp;If&nbsp;replacementTable[r]&nbsp;is&nbsp;the&nbsp;empty&nbsp;string&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5480735">//&nbsp;no&nbsp;replacement&nbsp;is&nbsp;made.</span><br>
<span class="lineno">245</span><span class="comment" id="5480762">//&nbsp;It&nbsp;also&nbsp;replaces&nbsp;runes&nbsp;U+2028&nbsp;and&nbsp;U+2029&nbsp;with&nbsp;the&nbsp;raw&nbsp;strings&nbsp;`\u2028`&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5480840">//&nbsp;`\u2029`.</span><br>
<span class="lineno"></span><span class="keyword" id="5480853">func</span>&nbsp;<span class="ident" id="5480858">replace</span><span class="op" id="5480865">(</span><span class="ident" id="5480866">s</span>&nbsp;<span class="builtintype" id="5480868">string</span><span class="op" id="5480874">,</span>&nbsp;<span class="ident" id="5480876">replacementTable</span>&nbsp;<span class="op" id="5480893">[</span><span class="op" id="5480894">]</span><span class="builtintype" id="5480895">string</span><span class="op" id="5480901">)</span>&nbsp;<span class="builtintype" id="5480903">string</span>&nbsp;<span class="op" id="5480910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480913">var</span>&nbsp;<span class="ident" id="5480917">b</span>&nbsp;<span class="ident" id="5480919">bytes</span><span class="op" id="5480924">.</span><span class="ident" id="5480925">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5480933">written</span>&nbsp;<span class="op" id="5480941">:=</span>&nbsp;<span class="num" id="5480944">0</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480947">for</span>&nbsp;<span class="ident" id="5480951">i</span><span class="op" id="5480952">,</span>&nbsp;<span class="ident" id="5480954">r</span>&nbsp;<span class="op" id="5480956">:=</span>&nbsp;<span class="keyword" id="5480959">range</span>&nbsp;<span class="ident" id="5480965">s</span>&nbsp;<span class="op" id="5480967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480971">var</span>&nbsp;<span class="ident" id="5480975">repl</span>&nbsp;<span class="builtintype" id="5480980">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5480989">switch</span>&nbsp;<span class="op" id="5480996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481000">case</span>&nbsp;<span class="builtintype" id="5481005">int</span><span class="op" id="5481008">(</span><span class="ident" id="5481009">r</span><span class="op" id="5481010">)</span>&nbsp;<span class="op" id="5481012">&lt;</span>&nbsp;<span class="builtinfunc" id="5481014">len</span><span class="op" id="5481017">(</span><span class="ident" id="5481018">replacementTable</span><span class="op" id="5481034">)</span>&nbsp;<span class="op" id="5481036">&amp;&amp;</span>&nbsp;<span class="ident" id="5481039">replacementTable</span><span class="op" id="5481055">[</span><span class="ident" id="5481056">r</span><span class="op" id="5481057">]</span>&nbsp;<span class="op" id="5481059">!=</span>&nbsp;<span class="string" id="5481062">&#34;&#34;</span><span class="op" id="5481064">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481069">repl</span>&nbsp;<span class="op" id="5481074">=</span>&nbsp;<span class="ident" id="5481076">replacementTable</span><span class="op" id="5481092">[</span><span class="ident" id="5481093">r</span><span class="op" id="5481094">]</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481098">case</span>&nbsp;<span class="ident" id="5481103">r</span>&nbsp;<span class="op" id="5481105">==</span>&nbsp;<span class="string" id="5481108">&#39;\u2028&#39;</span><span class="op" id="5481116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481121">repl</span>&nbsp;<span class="op" id="5481126">=</span>&nbsp;<span class="string" id="5481128">`\u2028`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481139">case</span>&nbsp;<span class="ident" id="5481144">r</span>&nbsp;<span class="op" id="5481146">==</span>&nbsp;<span class="string" id="5481149">&#39;\u2029&#39;</span><span class="op" id="5481157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481162">repl</span>&nbsp;<span class="op" id="5481167">=</span>&nbsp;<span class="string" id="5481169">`\u2029`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481180">default</span><span class="op" id="5481187">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481192">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481207">b</span><span class="op" id="5481208">.</span><span class="ident" id="5481209">WriteString</span><span class="op" id="5481220">(</span><span class="ident" id="5481221">s</span><span class="op" id="5481222">[</span><span class="ident" id="5481223">written</span><span class="op" id="5481230">:</span><span class="ident" id="5481231">i</span><span class="op" id="5481232">]</span><span class="op" id="5481233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481237">b</span><span class="op" id="5481238">.</span><span class="ident" id="5481239">WriteString</span><span class="op" id="5481250">(</span><span class="ident" id="5481251">repl</span><span class="op" id="5481255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481259">written</span>&nbsp;<span class="op" id="5481267">=</span>&nbsp;<span class="ident" id="5481269">i</span>&nbsp;<span class="op" id="5481271">+</span>&nbsp;<span class="ident" id="5481273">utf8</span><span class="op" id="5481277">.</span><span class="ident" id="5481278">RuneLen</span><span class="op" id="5481285">(</span><span class="ident" id="5481286">r</span><span class="op" id="5481287">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481293">if</span>&nbsp;<span class="ident" id="5481296">written</span>&nbsp;<span class="op" id="5481304">==</span>&nbsp;<span class="num" id="5481307">0</span>&nbsp;<span class="op" id="5481309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481313">return</span>&nbsp;<span class="ident" id="5481320">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5481323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5481326">b</span><span class="op" id="5481327">.</span><span class="ident" id="5481328">WriteString</span><span class="op" id="5481339">(</span><span class="ident" id="5481340">s</span><span class="op" id="5481341">[</span><span class="ident" id="5481342">written</span><span class="op" id="5481349">:</span><span class="op" id="5481350">]</span><span class="op" id="5481351">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5481354">return</span>&nbsp;<span class="ident" id="5481361">b</span><span class="op" id="5481362">.</span><span class="ident" id="5481363">String</span><span class="op" id="5481369">(</span><span class="op" id="5481370">)</span><br>
<span class="lineno"></span><span class="op" id="5481372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5481375">var</span>&nbsp;<span class="ident" id="5481379">jsStrReplacementTable</span>&nbsp;<span class="op" id="5481401">=</span>&nbsp;<span class="op" id="5481403">[</span><span class="op" id="5481404">]</span><span class="builtintype" id="5481405">string</span><span class="op" id="5481411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5481414">0</span><span class="op" id="5481415">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5481420">`\0`</span><span class="op" id="5481424">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481427">&#39;\t&#39;</span><span class="op" id="5481431">:</span>&nbsp;<span class="string" id="5481433">`\t`</span><span class="op" id="5481437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481440">&#39;\n&#39;</span><span class="op" id="5481444">:</span>&nbsp;<span class="string" id="5481446">`\n`</span><span class="op" id="5481450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481453">&#39;\v&#39;</span><span class="op" id="5481457">:</span>&nbsp;<span class="string" id="5481459">`\x0b`</span><span class="op" id="5481465">,</span>&nbsp;<span class="comment" id="5481467">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481492">&#39;\f&#39;</span><span class="op" id="5481496">:</span>&nbsp;<span class="string" id="5481498">`\f`</span><span class="op" id="5481502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481505">&#39;\r&#39;</span><span class="op" id="5481509">:</span>&nbsp;<span class="string" id="5481511">`\r`</span><span class="op" id="5481515">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481518">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5481580">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481629">&#39;&#34;&#39;</span><span class="op" id="5481632">:</span>&nbsp;&nbsp;<span class="string" id="5481635">`\x22`</span><span class="op" id="5481641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481644">&#39;&amp;&#39;</span><span class="op" id="5481647">:</span>&nbsp;&nbsp;<span class="string" id="5481650">`\x26`</span><span class="op" id="5481656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481659">&#39;\&#39;&#39;</span><span class="op" id="5481663">:</span>&nbsp;<span class="string" id="5481665">`\x27`</span><span class="op" id="5481671">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481674">&#39;+&#39;</span><span class="op" id="5481677">:</span>&nbsp;&nbsp;<span class="string" id="5481680">`\x2b`</span><span class="op" id="5481686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481689">&#39;/&#39;</span><span class="op" id="5481692">:</span>&nbsp;&nbsp;<span class="string" id="5481695">`\/`</span><span class="op" id="5481699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481702">&#39;&lt;&#39;</span><span class="op" id="5481705">:</span>&nbsp;&nbsp;<span class="string" id="5481708">`\x3c`</span><span class="op" id="5481714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481717">&#39;&gt;&#39;</span><span class="op" id="5481720">:</span>&nbsp;&nbsp;<span class="string" id="5481723">`\x3e`</span><span class="op" id="5481729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481732">&#39;\\&#39;</span><span class="op" id="5481736">:</span>&nbsp;<span class="string" id="5481738">`\\`</span><span class="op" id="5481742">,</span><br>
<span class="lineno">290</span><span class="op" id="5481744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5481747">//&nbsp;jsStrNormReplacementTable&nbsp;is&nbsp;like&nbsp;jsStrReplacementTable&nbsp;but&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="5481819">//&nbsp;overencode&nbsp;existing&nbsp;escapes&nbsp;since&nbsp;this&nbsp;table&nbsp;has&nbsp;no&nbsp;entry&nbsp;for&nbsp;`\`.</span><br>
<span class="lineno"></span><span class="keyword" id="5481889">var</span>&nbsp;<span class="ident" id="5481893">jsStrNormReplacementTable</span>&nbsp;<span class="op" id="5481919">=</span>&nbsp;<span class="op" id="5481921">[</span><span class="op" id="5481922">]</span><span class="builtintype" id="5481923">string</span><span class="op" id="5481929">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5481932">0</span><span class="op" id="5481933">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5481938">`\0`</span><span class="op" id="5481942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481945">&#39;\t&#39;</span><span class="op" id="5481949">:</span>&nbsp;<span class="string" id="5481951">`\t`</span><span class="op" id="5481955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481958">&#39;\n&#39;</span><span class="op" id="5481962">:</span>&nbsp;<span class="string" id="5481964">`\n`</span><span class="op" id="5481968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5481971">&#39;\v&#39;</span><span class="op" id="5481975">:</span>&nbsp;<span class="string" id="5481977">`\x0b`</span><span class="op" id="5481983">,</span>&nbsp;<span class="comment" id="5481985">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482010">&#39;\f&#39;</span><span class="op" id="5482014">:</span>&nbsp;<span class="string" id="5482016">`\f`</span><span class="op" id="5482020">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482023">&#39;\r&#39;</span><span class="op" id="5482027">:</span>&nbsp;<span class="string" id="5482029">`\r`</span><span class="op" id="5482033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5482036">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5482098">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482147">&#39;&#34;&#39;</span><span class="op" id="5482150">:</span>&nbsp;&nbsp;<span class="string" id="5482153">`\x22`</span><span class="op" id="5482159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482162">&#39;&amp;&#39;</span><span class="op" id="5482165">:</span>&nbsp;&nbsp;<span class="string" id="5482168">`\x26`</span><span class="op" id="5482174">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482177">&#39;\&#39;&#39;</span><span class="op" id="5482181">:</span>&nbsp;<span class="string" id="5482183">`\x27`</span><span class="op" id="5482189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482192">&#39;+&#39;</span><span class="op" id="5482195">:</span>&nbsp;&nbsp;<span class="string" id="5482198">`\x2b`</span><span class="op" id="5482204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482207">&#39;/&#39;</span><span class="op" id="5482210">:</span>&nbsp;&nbsp;<span class="string" id="5482213">`\/`</span><span class="op" id="5482217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482220">&#39;&lt;&#39;</span><span class="op" id="5482223">:</span>&nbsp;&nbsp;<span class="string" id="5482226">`\x3c`</span><span class="op" id="5482232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482235">&#39;&gt;&#39;</span><span class="op" id="5482238">:</span>&nbsp;&nbsp;<span class="string" id="5482241">`\x3e`</span><span class="op" id="5482247">,</span><br>
<span class="lineno">310</span><span class="op" id="5482249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5482252">var</span>&nbsp;<span class="ident" id="5482256">jsRegexpReplacementTable</span>&nbsp;<span class="op" id="5482281">=</span>&nbsp;<span class="op" id="5482283">[</span><span class="op" id="5482284">]</span><span class="builtintype" id="5482285">string</span><span class="op" id="5482291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5482294">0</span><span class="op" id="5482295">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5482300">`\0`</span><span class="op" id="5482304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482307">&#39;\t&#39;</span><span class="op" id="5482311">:</span>&nbsp;<span class="string" id="5482313">`\t`</span><span class="op" id="5482317">,</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482320">&#39;\n&#39;</span><span class="op" id="5482324">:</span>&nbsp;<span class="string" id="5482326">`\n`</span><span class="op" id="5482330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482333">&#39;\v&#39;</span><span class="op" id="5482337">:</span>&nbsp;<span class="string" id="5482339">`\x0b`</span><span class="op" id="5482345">,</span>&nbsp;<span class="comment" id="5482347">//&nbsp;&#34;\v&#34;&nbsp;==&nbsp;&#34;v&#34;&nbsp;on&nbsp;IE&nbsp;6.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482372">&#39;\f&#39;</span><span class="op" id="5482376">:</span>&nbsp;<span class="string" id="5482378">`\f`</span><span class="op" id="5482382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482385">&#39;\r&#39;</span><span class="op" id="5482389">:</span>&nbsp;<span class="string" id="5482391">`\r`</span><span class="op" id="5482395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5482398">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5482460">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482509">&#39;&#34;&#39;</span><span class="op" id="5482512">:</span>&nbsp;&nbsp;<span class="string" id="5482515">`\x22`</span><span class="op" id="5482521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482524">&#39;$&#39;</span><span class="op" id="5482527">:</span>&nbsp;&nbsp;<span class="string" id="5482530">`\$`</span><span class="op" id="5482534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482537">&#39;&amp;&#39;</span><span class="op" id="5482540">:</span>&nbsp;&nbsp;<span class="string" id="5482543">`\x26`</span><span class="op" id="5482549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482552">&#39;\&#39;&#39;</span><span class="op" id="5482556">:</span>&nbsp;<span class="string" id="5482558">`\x27`</span><span class="op" id="5482564">,</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482567">&#39;(&#39;</span><span class="op" id="5482570">:</span>&nbsp;&nbsp;<span class="string" id="5482573">`\(`</span><span class="op" id="5482577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482580">&#39;)&#39;</span><span class="op" id="5482583">:</span>&nbsp;&nbsp;<span class="string" id="5482586">`\)`</span><span class="op" id="5482590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482593">&#39;*&#39;</span><span class="op" id="5482596">:</span>&nbsp;&nbsp;<span class="string" id="5482599">`\*`</span><span class="op" id="5482603">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482606">&#39;+&#39;</span><span class="op" id="5482609">:</span>&nbsp;&nbsp;<span class="string" id="5482612">`\x2b`</span><span class="op" id="5482618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482621">&#39;-&#39;</span><span class="op" id="5482624">:</span>&nbsp;&nbsp;<span class="string" id="5482627">`\-`</span><span class="op" id="5482631">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482634">&#39;.&#39;</span><span class="op" id="5482637">:</span>&nbsp;&nbsp;<span class="string" id="5482640">`\.`</span><span class="op" id="5482644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482647">&#39;/&#39;</span><span class="op" id="5482650">:</span>&nbsp;&nbsp;<span class="string" id="5482653">`\/`</span><span class="op" id="5482657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482660">&#39;&lt;&#39;</span><span class="op" id="5482663">:</span>&nbsp;&nbsp;<span class="string" id="5482666">`\x3c`</span><span class="op" id="5482672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482675">&#39;&gt;&#39;</span><span class="op" id="5482678">:</span>&nbsp;&nbsp;<span class="string" id="5482681">`\x3e`</span><span class="op" id="5482687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482690">&#39;?&#39;</span><span class="op" id="5482693">:</span>&nbsp;&nbsp;<span class="string" id="5482696">`\?`</span><span class="op" id="5482700">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482703">&#39;[&#39;</span><span class="op" id="5482706">:</span>&nbsp;&nbsp;<span class="string" id="5482709">`\[`</span><span class="op" id="5482713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482716">&#39;\\&#39;</span><span class="op" id="5482720">:</span>&nbsp;<span class="string" id="5482722">`\\`</span><span class="op" id="5482726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482729">&#39;]&#39;</span><span class="op" id="5482732">:</span>&nbsp;&nbsp;<span class="string" id="5482735">`\]`</span><span class="op" id="5482739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482742">&#39;^&#39;</span><span class="op" id="5482745">:</span>&nbsp;&nbsp;<span class="string" id="5482748">`\^`</span><span class="op" id="5482752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482755">&#39;{&#39;</span><span class="op" id="5482758">:</span>&nbsp;&nbsp;<span class="string" id="5482761">`\{`</span><span class="op" id="5482765">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482768">&#39;|&#39;</span><span class="op" id="5482771">:</span>&nbsp;&nbsp;<span class="string" id="5482774">`\|`</span><span class="op" id="5482778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5482781">&#39;}&#39;</span><span class="op" id="5482784">:</span>&nbsp;&nbsp;<span class="string" id="5482787">`\}`</span><span class="op" id="5482791">,</span><br>
<span class="lineno"></span><span class="op" id="5482793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5482796">//&nbsp;isJSIdentPart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;rune&nbsp;is&nbsp;a&nbsp;JS&nbsp;identifier&nbsp;part.</span><br>
<span class="lineno">345</span><span class="comment" id="5482869">//&nbsp;It&nbsp;does&nbsp;not&nbsp;handle&nbsp;all&nbsp;the&nbsp;non-Latin&nbsp;letters,&nbsp;joiners,&nbsp;and&nbsp;combining&nbsp;marks,</span><br>
<span class="lineno"></span><span class="comment" id="5482948">//&nbsp;but&nbsp;it&nbsp;does&nbsp;handle&nbsp;every&nbsp;codepoint&nbsp;that&nbsp;can&nbsp;occur&nbsp;in&nbsp;a&nbsp;numeric&nbsp;literal&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5483025">//&nbsp;a&nbsp;keyword.</span><br>
<span class="lineno"></span><span class="keyword" id="5483039">func</span>&nbsp;<span class="ident" id="5483044">isJSIdentPart</span><span class="op" id="5483057">(</span><span class="ident" id="5483058">r</span>&nbsp;<span class="builtintype" id="5483060">rune</span><span class="op" id="5483064">)</span>&nbsp;<span class="builtintype" id="5483066">bool</span>&nbsp;<span class="op" id="5483071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483074">switch</span>&nbsp;<span class="op" id="5483081">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483084">case</span>&nbsp;<span class="ident" id="5483089">r</span>&nbsp;<span class="op" id="5483091">==</span>&nbsp;<span class="string" id="5483094">&#39;$&#39;</span><span class="op" id="5483097">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483101">return</span>&nbsp;<span class="builtintype" id="5483108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483114">case</span>&nbsp;<span class="string" id="5483119">&#39;0&#39;</span>&nbsp;<span class="op" id="5483123">&lt;=</span>&nbsp;<span class="ident" id="5483126">r</span>&nbsp;<span class="op" id="5483128">&amp;&amp;</span>&nbsp;<span class="ident" id="5483131">r</span>&nbsp;<span class="op" id="5483133">&lt;=</span>&nbsp;<span class="string" id="5483136">&#39;9&#39;</span><span class="op" id="5483139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483143">return</span>&nbsp;<span class="builtintype" id="5483150">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483156">case</span>&nbsp;<span class="string" id="5483161">&#39;A&#39;</span>&nbsp;<span class="op" id="5483165">&lt;=</span>&nbsp;<span class="ident" id="5483168">r</span>&nbsp;<span class="op" id="5483170">&amp;&amp;</span>&nbsp;<span class="ident" id="5483173">r</span>&nbsp;<span class="op" id="5483175">&lt;=</span>&nbsp;<span class="string" id="5483178">&#39;Z&#39;</span><span class="op" id="5483181">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483185">return</span>&nbsp;<span class="builtintype" id="5483192">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483198">case</span>&nbsp;<span class="ident" id="5483203">r</span>&nbsp;<span class="op" id="5483205">==</span>&nbsp;<span class="string" id="5483208">&#39;_&#39;</span><span class="op" id="5483211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483215">return</span>&nbsp;<span class="builtintype" id="5483222">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483228">case</span>&nbsp;<span class="string" id="5483233">&#39;a&#39;</span>&nbsp;<span class="op" id="5483237">&lt;=</span>&nbsp;<span class="ident" id="5483240">r</span>&nbsp;<span class="op" id="5483242">&amp;&amp;</span>&nbsp;<span class="ident" id="5483245">r</span>&nbsp;<span class="op" id="5483247">&lt;=</span>&nbsp;<span class="string" id="5483250">&#39;z&#39;</span><span class="op" id="5483253">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483257">return</span>&nbsp;<span class="builtintype" id="5483264">true</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5483270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5483273">return</span>&nbsp;<span class="builtintype" id="5483280">false</span><br>
<span class="lineno"></span><span class="op" id="5483286">}</span>
</div>
</body>
</html>
