<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6803769">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6803824">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6803878">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6803929">package</span>&nbsp;<span class="ident" id="6803937">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6803942">import</span>&nbsp;<span class="op" id="6803949">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6803952">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6803965">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6803976">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6803987">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6803994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6803997">func</span>&nbsp;<span class="ident" id="6804002">TestMutexLock</span><span class="op" id="6804015">(</span><span class="ident" id="6804016">t</span>&nbsp;<span class="op" id="6804018">*</span><span class="ident" id="6804019"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6804026">.</span><span class="ident" id="6804027">T</span><span class="op" id="6804028">)</span>&nbsp;<span class="op" id="6804030">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804033">var</span>&nbsp;<span class="ident" id="6804037">mu</span>&nbsp;<span class="ident" id="6804040"><a href="/net/fd_mutex.go.html#2567642">fdMutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804050">if</span>&nbsp;<span class="op" id="6804053">!</span><span class="ident" id="6804054"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804056">.</span><span class="ident" id="6804057">Incref</span><span class="op" id="6804063">(</span><span class="op" id="6804064">)</span>&nbsp;<span class="op" id="6804066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804070"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804071">.</span><span class="ident" id="6804072">Fatal</span><span class="op" id="6804077">(</span><span class="string" id="6804078">&#34;broken&#34;</span><span class="op" id="6804086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804089">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804092">if</span>&nbsp;<span class="ident" id="6804095"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804097">.</span><span class="ident" id="6804098">Decref</span><span class="op" id="6804104">(</span><span class="op" id="6804105">)</span>&nbsp;<span class="op" id="6804107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804111"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804112">.</span><span class="ident" id="6804113">Fatal</span><span class="op" id="6804118">(</span><span class="string" id="6804119">&#34;broken&#34;</span><span class="op" id="6804127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804134">if</span>&nbsp;<span class="op" id="6804137">!</span><span class="ident" id="6804138"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804140">.</span><span class="ident" id="6804141">RWLock</span><span class="op" id="6804147">(</span><span class="ident" id="6804148">true</span><span class="op" id="6804152">)</span>&nbsp;<span class="op" id="6804154">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804158"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804159">.</span><span class="ident" id="6804160">Fatal</span><span class="op" id="6804165">(</span><span class="string" id="6804166">&#34;broken&#34;</span><span class="op" id="6804174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804180">if</span>&nbsp;<span class="ident" id="6804183"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804185">.</span><span class="ident" id="6804186">RWUnlock</span><span class="op" id="6804194">(</span><span class="ident" id="6804195">true</span><span class="op" id="6804199">)</span>&nbsp;<span class="op" id="6804201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804205"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804206">.</span><span class="ident" id="6804207">Fatal</span><span class="op" id="6804212">(</span><span class="string" id="6804213">&#34;broken&#34;</span><span class="op" id="6804221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804224">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804228">if</span>&nbsp;<span class="op" id="6804231">!</span><span class="ident" id="6804232"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804234">.</span><span class="ident" id="6804235">RWLock</span><span class="op" id="6804241">(</span><span class="ident" id="6804242">false</span><span class="op" id="6804247">)</span>&nbsp;<span class="op" id="6804249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804253"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804254">.</span><span class="ident" id="6804255">Fatal</span><span class="op" id="6804260">(</span><span class="string" id="6804261">&#34;broken&#34;</span><span class="op" id="6804269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804275">if</span>&nbsp;<span class="ident" id="6804278"><a href="/net/fd_mutex_test.go.html#6804037">mu</a></span><span class="op" id="6804280">.</span><span class="ident" id="6804281">RWUnlock</span><span class="op" id="6804289">(</span><span class="ident" id="6804290">false</span><span class="op" id="6804295">)</span>&nbsp;<span class="op" id="6804297">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804301"><a href="/net/fd_mutex_test.go.html#6804016">t</a></span><span class="op" id="6804302">.</span><span class="ident" id="6804303">Fatal</span><span class="op" id="6804308">(</span><span class="string" id="6804309">&#34;broken&#34;</span><span class="op" id="6804317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804320">}</span><br>
<span class="lineno"></span><span class="op" id="6804322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6804325">func</span>&nbsp;<span class="ident" id="6804330">TestMutexClose</span><span class="op" id="6804344">(</span><span class="ident" id="6804345">t</span>&nbsp;<span class="op" id="6804347">*</span><span class="ident" id="6804348"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6804355">.</span><span class="ident" id="6804356">T</span><span class="op" id="6804357">)</span>&nbsp;<span class="op" id="6804359">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804362">var</span>&nbsp;<span class="ident" id="6804366">mu</span>&nbsp;<span class="ident" id="6804369"><a href="/net/fd_mutex.go.html#2567642">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804378">if</span>&nbsp;<span class="op" id="6804381">!</span><span class="ident" id="6804382"><a href="/net/fd_mutex_test.go.html#6804366">mu</a></span><span class="op" id="6804384">.</span><span class="ident" id="6804385">IncrefAndClose</span><span class="op" id="6804399">(</span><span class="op" id="6804400">)</span>&nbsp;<span class="op" id="6804402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804406"><a href="/net/fd_mutex_test.go.html#6804345">t</a></span><span class="op" id="6804407">.</span><span class="ident" id="6804408">Fatal</span><span class="op" id="6804413">(</span><span class="string" id="6804414">&#34;broken&#34;</span><span class="op" id="6804422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804429">if</span>&nbsp;<span class="ident" id="6804432"><a href="/net/fd_mutex_test.go.html#6804366">mu</a></span><span class="op" id="6804434">.</span><span class="ident" id="6804435">Incref</span><span class="op" id="6804441">(</span><span class="op" id="6804442">)</span>&nbsp;<span class="op" id="6804444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804448"><a href="/net/fd_mutex_test.go.html#6804345">t</a></span><span class="op" id="6804449">.</span><span class="ident" id="6804450">Fatal</span><span class="op" id="6804455">(</span><span class="string" id="6804456">&#34;broken&#34;</span><span class="op" id="6804464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804470">if</span>&nbsp;<span class="ident" id="6804473"><a href="/net/fd_mutex_test.go.html#6804366">mu</a></span><span class="op" id="6804475">.</span><span class="ident" id="6804476">RWLock</span><span class="op" id="6804482">(</span><span class="ident" id="6804483">true</span><span class="op" id="6804487">)</span>&nbsp;<span class="op" id="6804489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804493"><a href="/net/fd_mutex_test.go.html#6804345">t</a></span><span class="op" id="6804494">.</span><span class="ident" id="6804495">Fatal</span><span class="op" id="6804500">(</span><span class="string" id="6804501">&#34;broken&#34;</span><span class="op" id="6804509">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804515">if</span>&nbsp;<span class="ident" id="6804518"><a href="/net/fd_mutex_test.go.html#6804366">mu</a></span><span class="op" id="6804520">.</span><span class="ident" id="6804521">RWLock</span><span class="op" id="6804527">(</span><span class="ident" id="6804528">false</span><span class="op" id="6804533">)</span>&nbsp;<span class="op" id="6804535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804539"><a href="/net/fd_mutex_test.go.html#6804345">t</a></span><span class="op" id="6804540">.</span><span class="ident" id="6804541">Fatal</span><span class="op" id="6804546">(</span><span class="string" id="6804547">&#34;broken&#34;</span><span class="op" id="6804555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804561">if</span>&nbsp;<span class="ident" id="6804564"><a href="/net/fd_mutex_test.go.html#6804366">mu</a></span><span class="op" id="6804566">.</span><span class="ident" id="6804567">IncrefAndClose</span><span class="op" id="6804581">(</span><span class="op" id="6804582">)</span>&nbsp;<span class="op" id="6804584">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804588"><a href="/net/fd_mutex_test.go.html#6804345">t</a></span><span class="op" id="6804589">.</span><span class="ident" id="6804590">Fatal</span><span class="op" id="6804595">(</span><span class="string" id="6804596">&#34;broken&#34;</span><span class="op" id="6804604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804607">}</span><br>
<span class="lineno"></span><span class="op" id="6804609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6804612">func</span>&nbsp;<span class="ident" id="6804617">TestMutexCloseUnblock</span><span class="op" id="6804638">(</span><span class="ident" id="6804639">t</span>&nbsp;<span class="op" id="6804641">*</span><span class="ident" id="6804642"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6804649">.</span><span class="ident" id="6804650">T</span><span class="op" id="6804651">)</span>&nbsp;<span class="op" id="6804653">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804656">c</span>&nbsp;<span class="op" id="6804658">:=</span>&nbsp;<span class="builtinfunc" id="6804661">make</span><span class="op" id="6804665">(</span><span class="keyword" id="6804666">chan</span>&nbsp;<span class="builtintype" id="6804671">bool</span><span class="op" id="6804675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804678">var</span>&nbsp;<span class="ident" id="6804682">mu</span>&nbsp;<span class="ident" id="6804685"><a href="/net/fd_mutex.go.html#2567642">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804694"><a href="/net/fd_mutex_test.go.html#6804682">mu</a></span><span class="op" id="6804696">.</span><span class="ident" id="6804697">RWLock</span><span class="op" id="6804703">(</span><span class="ident" id="6804704">true</span><span class="op" id="6804708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804711">for</span>&nbsp;<span class="ident" id="6804715">i</span>&nbsp;<span class="op" id="6804717">:=</span>&nbsp;<span class="num" id="6804720">0</span><span class="op" id="6804721">;</span>&nbsp;<span class="ident" id="6804723"><a href="/net/fd_mutex_test.go.html#6804715">i</a></span>&nbsp;<span class="op" id="6804725">&lt;</span>&nbsp;<span class="num" id="6804727">4</span><span class="op" id="6804728">;</span>&nbsp;<span class="ident" id="6804730"><a href="/net/fd_mutex_test.go.html#6804715">i</a></span><span class="op" id="6804731">++</span>&nbsp;<span class="op" id="6804734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804738">go</span>&nbsp;<span class="keyword" id="6804741">func</span><span class="op" id="6804745">(</span><span class="op" id="6804746">)</span>&nbsp;<span class="op" id="6804748">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804753">if</span>&nbsp;<span class="ident" id="6804756"><a href="/net/fd_mutex_test.go.html#6804682">mu</a></span><span class="op" id="6804758">.</span><span class="ident" id="6804759">RWLock</span><span class="op" id="6804765">(</span><span class="ident" id="6804766">true</span><span class="op" id="6804770">)</span>&nbsp;<span class="op" id="6804772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804778"><a href="/net/fd_mutex_test.go.html#6804639">t</a></span><span class="op" id="6804779">.</span><span class="ident" id="6804780">Error</span><span class="op" id="6804785">(</span><span class="string" id="6804786">&#34;broken&#34;</span><span class="op" id="6804794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804800">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804815"><a href="/net/fd_mutex_test.go.html#6804656">c</a></span>&nbsp;<span class="op" id="6804817">&lt;-</span>&nbsp;<span class="ident" id="6804820">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804827">}</span><span class="op" id="6804828">(</span><span class="op" id="6804829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6804835">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804902"><a href="/net/fd_mutex_test.go.html#6803987">time</a></span><span class="op" id="6804906">.</span><span class="ident" id="6804907">Sleep</span><span class="op" id="6804912">(</span><span class="ident" id="6804913"><a href="/net/fd_mutex_test.go.html#6803987">time</a></span><span class="op" id="6804917">.</span><span class="ident" id="6804918">Millisecond</span><span class="op" id="6804929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804932">select</span>&nbsp;<span class="op" id="6804939">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804942">case</span>&nbsp;<span class="op" id="6804947">&lt;-</span><span class="ident" id="6804949"><a href="/net/fd_mutex_test.go.html#6804656">c</a></span><span class="op" id="6804950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804954"><a href="/net/fd_mutex_test.go.html#6804639">t</a></span><span class="op" id="6804955">.</span><span class="ident" id="6804956">Fatal</span><span class="op" id="6804961">(</span><span class="string" id="6804962">&#34;broken&#34;</span><span class="op" id="6804970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6804973">default</span><span class="op" id="6804980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6804983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6804986"><a href="/net/fd_mutex_test.go.html#6804682">mu</a></span><span class="op" id="6804988">.</span><span class="ident" id="6804989">IncrefAndClose</span><span class="op" id="6805003">(</span><span class="op" id="6805004">)</span>&nbsp;<span class="comment" id="6805006">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805036">for</span>&nbsp;<span class="ident" id="6805040">i</span>&nbsp;<span class="op" id="6805042">:=</span>&nbsp;<span class="num" id="6805045">0</span><span class="op" id="6805046">;</span>&nbsp;<span class="ident" id="6805048"><a href="/net/fd_mutex_test.go.html#6805040">i</a></span>&nbsp;<span class="op" id="6805050">&lt;</span>&nbsp;<span class="num" id="6805052">4</span><span class="op" id="6805053">;</span>&nbsp;<span class="ident" id="6805055"><a href="/net/fd_mutex_test.go.html#6805040">i</a></span><span class="op" id="6805056">++</span>&nbsp;<span class="op" id="6805059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805063">select</span>&nbsp;<span class="op" id="6805070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805074">case</span>&nbsp;<span class="op" id="6805079">&lt;-</span><span class="ident" id="6805081"><a href="/net/fd_mutex_test.go.html#6804656">c</a></span><span class="op" id="6805082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805086">case</span>&nbsp;<span class="op" id="6805091">&lt;-</span><span class="ident" id="6805093"><a href="/net/fd_mutex_test.go.html#6803987">time</a></span><span class="op" id="6805097">.</span><span class="ident" id="6805098">After</span><span class="op" id="6805103">(</span><span class="num" id="6805104">10</span>&nbsp;<span class="op" id="6805107">*</span>&nbsp;<span class="ident" id="6805109"><a href="/net/fd_mutex_test.go.html#6803987">time</a></span><span class="op" id="6805113">.</span><span class="ident" id="6805114">Second</span><span class="op" id="6805120">)</span><span class="op" id="6805121">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805126"><a href="/net/fd_mutex_test.go.html#6804639">t</a></span><span class="op" id="6805127">.</span><span class="ident" id="6805128">Fatal</span><span class="op" id="6805133">(</span><span class="string" id="6805134">&#34;broken&#34;</span><span class="op" id="6805142">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805152">if</span>&nbsp;<span class="ident" id="6805155"><a href="/net/fd_mutex_test.go.html#6804682">mu</a></span><span class="op" id="6805157">.</span><span class="ident" id="6805158">Decref</span><span class="op" id="6805164">(</span><span class="op" id="6805165">)</span>&nbsp;<span class="op" id="6805167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805171"><a href="/net/fd_mutex_test.go.html#6804639">t</a></span><span class="op" id="6805172">.</span><span class="ident" id="6805173">Fatal</span><span class="op" id="6805178">(</span><span class="string" id="6805179">&#34;broken&#34;</span><span class="op" id="6805187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805190">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805193">if</span>&nbsp;<span class="op" id="6805196">!</span><span class="ident" id="6805197"><a href="/net/fd_mutex_test.go.html#6804682">mu</a></span><span class="op" id="6805199">.</span><span class="ident" id="6805200">RWUnlock</span><span class="op" id="6805208">(</span><span class="ident" id="6805209">true</span><span class="op" id="6805213">)</span>&nbsp;<span class="op" id="6805215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805219"><a href="/net/fd_mutex_test.go.html#6804639">t</a></span><span class="op" id="6805220">.</span><span class="ident" id="6805221">Fatal</span><span class="op" id="6805226">(</span><span class="string" id="6805227">&#34;broken&#34;</span><span class="op" id="6805235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805238">}</span><br>
<span class="lineno"></span><span class="op" id="6805240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6805243">func</span>&nbsp;<span class="ident" id="6805248">TestMutexPanic</span><span class="op" id="6805262">(</span><span class="ident" id="6805263">t</span>&nbsp;<span class="op" id="6805265">*</span><span class="ident" id="6805266"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6805273">.</span><span class="ident" id="6805274">T</span><span class="op" id="6805275">)</span>&nbsp;<span class="op" id="6805277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805280">ensurePanics</span>&nbsp;<span class="op" id="6805293">:=</span>&nbsp;<span class="keyword" id="6805296">func</span><span class="op" id="6805300">(</span><span class="ident" id="6805301">f</span>&nbsp;<span class="keyword" id="6805303">func</span><span class="op" id="6805307">(</span><span class="op" id="6805308">)</span><span class="op" id="6805309">)</span>&nbsp;<span class="op" id="6805311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805315">defer</span>&nbsp;<span class="keyword" id="6805321">func</span><span class="op" id="6805325">(</span><span class="op" id="6805326">)</span>&nbsp;<span class="op" id="6805328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805333">if</span>&nbsp;<span class="builtinfunc" id="6805336">recover</span><span class="op" id="6805343">(</span><span class="op" id="6805344">)</span>&nbsp;<span class="op" id="6805346">==</span>&nbsp;<span class="ident" id="6805349">nil</span>&nbsp;<span class="op" id="6805353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805359"><a href="/net/fd_mutex_test.go.html#6805263">t</a></span><span class="op" id="6805360">.</span><span class="ident" id="6805361">Fatal</span><span class="op" id="6805366">(</span><span class="string" id="6805367">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6805383">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805392">}</span><span class="op" id="6805393">(</span><span class="op" id="6805394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805398"><a href="/net/fd_mutex_test.go.html#6805301">f</a></span><span class="op" id="6805399">(</span><span class="op" id="6805400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6805403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805407">var</span>&nbsp;<span class="ident" id="6805411">mu</span>&nbsp;<span class="ident" id="6805414"><a href="/net/fd_mutex.go.html#2567642">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805423"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805435">(</span><span class="keyword" id="6805436">func</span><span class="op" id="6805440">(</span><span class="op" id="6805441">)</span>&nbsp;<span class="op" id="6805443">{</span>&nbsp;<span class="ident" id="6805445"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805447">.</span><span class="ident" id="6805448">Decref</span><span class="op" id="6805454">(</span><span class="op" id="6805455">)</span>&nbsp;<span class="op" id="6805457">}</span><span class="op" id="6805458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805461"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805473">(</span><span class="keyword" id="6805474">func</span><span class="op" id="6805478">(</span><span class="op" id="6805479">)</span>&nbsp;<span class="op" id="6805481">{</span>&nbsp;<span class="ident" id="6805483"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805485">.</span><span class="ident" id="6805486">RWUnlock</span><span class="op" id="6805494">(</span><span class="ident" id="6805495">true</span><span class="op" id="6805499">)</span>&nbsp;<span class="op" id="6805501">}</span><span class="op" id="6805502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805505"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805517">(</span><span class="keyword" id="6805518">func</span><span class="op" id="6805522">(</span><span class="op" id="6805523">)</span>&nbsp;<span class="op" id="6805525">{</span>&nbsp;<span class="ident" id="6805527"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805529">.</span><span class="ident" id="6805530">RWUnlock</span><span class="op" id="6805538">(</span><span class="ident" id="6805539">false</span><span class="op" id="6805544">)</span>&nbsp;<span class="op" id="6805546">}</span><span class="op" id="6805547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805551"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805563">(</span><span class="keyword" id="6805564">func</span><span class="op" id="6805568">(</span><span class="op" id="6805569">)</span>&nbsp;<span class="op" id="6805571">{</span>&nbsp;<span class="ident" id="6805573"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805575">.</span><span class="ident" id="6805576">Incref</span><span class="op" id="6805582">(</span><span class="op" id="6805583">)</span><span class="op" id="6805584">;</span>&nbsp;<span class="ident" id="6805586"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805588">.</span><span class="ident" id="6805589">Decref</span><span class="op" id="6805595">(</span><span class="op" id="6805596">)</span><span class="op" id="6805597">;</span>&nbsp;<span class="ident" id="6805599"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805601">.</span><span class="ident" id="6805602">Decref</span><span class="op" id="6805608">(</span><span class="op" id="6805609">)</span>&nbsp;<span class="op" id="6805611">}</span><span class="op" id="6805612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805615"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805627">(</span><span class="keyword" id="6805628">func</span><span class="op" id="6805632">(</span><span class="op" id="6805633">)</span>&nbsp;<span class="op" id="6805635">{</span>&nbsp;<span class="ident" id="6805637"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805639">.</span><span class="ident" id="6805640">RWLock</span><span class="op" id="6805646">(</span><span class="ident" id="6805647">true</span><span class="op" id="6805651">)</span><span class="op" id="6805652">;</span>&nbsp;<span class="ident" id="6805654"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805656">.</span><span class="ident" id="6805657">RWUnlock</span><span class="op" id="6805665">(</span><span class="ident" id="6805666">true</span><span class="op" id="6805670">)</span><span class="op" id="6805671">;</span>&nbsp;<span class="ident" id="6805673"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805675">.</span><span class="ident" id="6805676">RWUnlock</span><span class="op" id="6805684">(</span><span class="ident" id="6805685">true</span><span class="op" id="6805689">)</span>&nbsp;<span class="op" id="6805691">}</span><span class="op" id="6805692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805695"><a href="/net/fd_mutex_test.go.html#6805280">ensurePanics</a></span><span class="op" id="6805707">(</span><span class="keyword" id="6805708">func</span><span class="op" id="6805712">(</span><span class="op" id="6805713">)</span>&nbsp;<span class="op" id="6805715">{</span>&nbsp;<span class="ident" id="6805717"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805719">.</span><span class="ident" id="6805720">RWLock</span><span class="op" id="6805726">(</span><span class="ident" id="6805727">false</span><span class="op" id="6805732">)</span><span class="op" id="6805733">;</span>&nbsp;<span class="ident" id="6805735"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805737">.</span><span class="ident" id="6805738">RWUnlock</span><span class="op" id="6805746">(</span><span class="ident" id="6805747">false</span><span class="op" id="6805752">)</span><span class="op" id="6805753">;</span>&nbsp;<span class="ident" id="6805755"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805757">.</span><span class="ident" id="6805758">RWUnlock</span><span class="op" id="6805766">(</span><span class="ident" id="6805767">false</span><span class="op" id="6805772">)</span>&nbsp;<span class="op" id="6805774">}</span><span class="op" id="6805775">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6805779">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805817"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805819">.</span><span class="ident" id="6805820">Incref</span><span class="op" id="6805826">(</span><span class="op" id="6805827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805830"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805832">.</span><span class="ident" id="6805833">Decref</span><span class="op" id="6805839">(</span><span class="op" id="6805840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805843"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805845">.</span><span class="ident" id="6805846">RWLock</span><span class="op" id="6805852">(</span><span class="ident" id="6805853">true</span><span class="op" id="6805857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805860"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805862">.</span><span class="ident" id="6805863">RWUnlock</span><span class="op" id="6805871">(</span><span class="ident" id="6805872">true</span><span class="op" id="6805876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805879"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805881">.</span><span class="ident" id="6805882">RWLock</span><span class="op" id="6805888">(</span><span class="ident" id="6805889">false</span><span class="op" id="6805894">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805897"><a href="/net/fd_mutex_test.go.html#6805411">mu</a></span><span class="op" id="6805899">.</span><span class="ident" id="6805900">RWUnlock</span><span class="op" id="6805908">(</span><span class="ident" id="6805909">false</span><span class="op" id="6805914">)</span><br>
<span class="lineno"></span><span class="op" id="6805916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6805919">func</span>&nbsp;<span class="ident" id="6805924">TestMutexStress</span><span class="op" id="6805939">(</span><span class="ident" id="6805940">t</span>&nbsp;<span class="op" id="6805942">*</span><span class="ident" id="6805943"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6805950">.</span><span class="ident" id="6805951">T</span><span class="op" id="6805952">)</span>&nbsp;<span class="op" id="6805954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805957">P</span>&nbsp;<span class="op" id="6805959">:=</span>&nbsp;<span class="num" id="6805962">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6805965">N</span>&nbsp;<span class="op" id="6805967">:=</span>&nbsp;<span class="builtintype" id="6805970">int</span><span class="op" id="6805973">(</span><span class="num" id="6805974">1e6</span><span class="op" id="6805977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6805980">if</span>&nbsp;<span class="ident" id="6805983"><a href="/net/fd_mutex_test.go.html#6803976">testing</a></span><span class="op" id="6805990">.</span><span class="ident" id="6805991">Short</span><span class="op" id="6805996">(</span><span class="op" id="6805997">)</span>&nbsp;<span class="op" id="6805999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806003"><a href="/net/fd_mutex_test.go.html#6805957">P</a></span>&nbsp;<span class="op" id="6806005">=</span>&nbsp;<span class="num" id="6806007">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806011"><a href="/net/fd_mutex_test.go.html#6805965">N</a></span>&nbsp;<span class="op" id="6806013">=</span>&nbsp;<span class="num" id="6806015">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806020">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806023">defer</span>&nbsp;<span class="ident" id="6806029"><a href="/net/fd_mutex_test.go.html#6803965">runtime</a></span><span class="op" id="6806036">.</span><span class="ident" id="6806037">GOMAXPROCS</span><span class="op" id="6806047">(</span><span class="ident" id="6806048"><a href="/net/fd_mutex_test.go.html#6803965">runtime</a></span><span class="op" id="6806055">.</span><span class="ident" id="6806056">GOMAXPROCS</span><span class="op" id="6806066">(</span><span class="ident" id="6806067"><a href="/net/fd_mutex_test.go.html#6805957">P</a></span><span class="op" id="6806068">)</span><span class="op" id="6806069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806072">done</span>&nbsp;<span class="op" id="6806077">:=</span>&nbsp;<span class="builtinfunc" id="6806080">make</span><span class="op" id="6806084">(</span><span class="keyword" id="6806085">chan</span>&nbsp;<span class="builtintype" id="6806090">bool</span><span class="op" id="6806094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806097">var</span>&nbsp;<span class="ident" id="6806101">mu</span>&nbsp;<span class="ident" id="6806104"><a href="/net/fd_mutex.go.html#2567642">fdMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806113">var</span>&nbsp;<span class="ident" id="6806117">readState</span>&nbsp;<span class="op" id="6806127">[</span><span class="num" id="6806128">2</span><span class="op" id="6806129">]</span><span class="ident" id="6806130">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806138">var</span>&nbsp;<span class="ident" id="6806142">writeState</span>&nbsp;<span class="op" id="6806153">[</span><span class="num" id="6806154">2</span><span class="op" id="6806155">]</span><span class="ident" id="6806156">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806164">for</span>&nbsp;<span class="ident" id="6806168">p</span>&nbsp;<span class="op" id="6806170">:=</span>&nbsp;<span class="num" id="6806173">0</span><span class="op" id="6806174">;</span>&nbsp;<span class="ident" id="6806176"><a href="/net/fd_mutex_test.go.html#6806168">p</a></span>&nbsp;<span class="op" id="6806178">&lt;</span>&nbsp;<span class="ident" id="6806180"><a href="/net/fd_mutex_test.go.html#6805957">P</a></span><span class="op" id="6806181">;</span>&nbsp;<span class="ident" id="6806183"><a href="/net/fd_mutex_test.go.html#6806168">p</a></span><span class="op" id="6806184">++</span>&nbsp;<span class="op" id="6806187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806191">go</span>&nbsp;<span class="keyword" id="6806194">func</span><span class="op" id="6806198">(</span><span class="op" id="6806199">)</span>&nbsp;<span class="op" id="6806201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806206">r</span>&nbsp;<span class="op" id="6806208">:=</span>&nbsp;<span class="ident" id="6806211"><a href="/net/fd_mutex_test.go.html#6803952">rand</a></span><span class="op" id="6806215">.</span><span class="ident" id="6806216">New</span><span class="op" id="6806219">(</span><span class="ident" id="6806220"><a href="/net/fd_mutex_test.go.html#6803952">rand</a></span><span class="op" id="6806224">.</span><span class="ident" id="6806225">NewSource</span><span class="op" id="6806234">(</span><span class="ident" id="6806235"><a href="/net/fd_mutex_test.go.html#6803952">rand</a></span><span class="op" id="6806239">.</span><span class="ident" id="6806240">Int63</span><span class="op" id="6806245">(</span><span class="op" id="6806246">)</span><span class="op" id="6806247">)</span><span class="op" id="6806248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806253">for</span>&nbsp;<span class="ident" id="6806257">i</span>&nbsp;<span class="op" id="6806259">:=</span>&nbsp;<span class="num" id="6806262">0</span><span class="op" id="6806263">;</span>&nbsp;<span class="ident" id="6806265"><a href="/net/fd_mutex_test.go.html#6806257">i</a></span>&nbsp;<span class="op" id="6806267">&lt;</span>&nbsp;<span class="ident" id="6806269"><a href="/net/fd_mutex_test.go.html#6805965">N</a></span><span class="op" id="6806270">;</span>&nbsp;<span class="ident" id="6806272"><a href="/net/fd_mutex_test.go.html#6806257">i</a></span><span class="op" id="6806273">++</span>&nbsp;<span class="op" id="6806276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806282">switch</span>&nbsp;<span class="ident" id="6806289"><a href="/net/fd_mutex_test.go.html#6806206">r</a></span><span class="op" id="6806290">.</span><span class="ident" id="6806291">Intn</span><span class="op" id="6806295">(</span><span class="num" id="6806296">3</span><span class="op" id="6806297">)</span>&nbsp;<span class="op" id="6806299">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806305">case</span>&nbsp;<span class="num" id="6806310">0</span><span class="op" id="6806311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806318">if</span>&nbsp;<span class="op" id="6806321">!</span><span class="ident" id="6806322"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6806324">.</span><span class="ident" id="6806325">Incref</span><span class="op" id="6806331">(</span><span class="op" id="6806332">)</span>&nbsp;<span class="op" id="6806334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806342"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806343">.</span><span class="ident" id="6806344">Error</span><span class="op" id="6806349">(</span><span class="string" id="6806350">&#34;broken&#34;</span><span class="op" id="6806358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806366">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806378">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806385">if</span>&nbsp;<span class="ident" id="6806388"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6806390">.</span><span class="ident" id="6806391">Decref</span><span class="op" id="6806397">(</span><span class="op" id="6806398">)</span>&nbsp;<span class="op" id="6806400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806408"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806409">.</span><span class="ident" id="6806410">Error</span><span class="op" id="6806415">(</span><span class="string" id="6806416">&#34;broken&#34;</span><span class="op" id="6806424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806432">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806450">case</span>&nbsp;<span class="num" id="6806455">1</span><span class="op" id="6806456">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806463">if</span>&nbsp;<span class="op" id="6806466">!</span><span class="ident" id="6806467"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6806469">.</span><span class="ident" id="6806470">RWLock</span><span class="op" id="6806476">(</span><span class="ident" id="6806477">true</span><span class="op" id="6806481">)</span>&nbsp;<span class="op" id="6806483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806491"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806492">.</span><span class="ident" id="6806493">Error</span><span class="op" id="6806498">(</span><span class="string" id="6806499">&#34;broken&#34;</span><span class="op" id="6806507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806515">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6806534">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806596">if</span>&nbsp;<span class="ident" id="6806599"><a href="/net/fd_mutex_test.go.html#6806117">readState</a></span><span class="op" id="6806608">[</span><span class="num" id="6806609">0</span><span class="op" id="6806610">]</span>&nbsp;<span class="op" id="6806612">!=</span>&nbsp;<span class="ident" id="6806615"><a href="/net/fd_mutex_test.go.html#6806117">readState</a></span><span class="op" id="6806624">[</span><span class="num" id="6806625">1</span><span class="op" id="6806626">]</span>&nbsp;<span class="op" id="6806628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806636"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806637">.</span><span class="ident" id="6806638">Error</span><span class="op" id="6806643">(</span><span class="string" id="6806644">&#34;broken&#34;</span><span class="op" id="6806652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806679"><a href="/net/fd_mutex_test.go.html#6806117">readState</a></span><span class="op" id="6806688">[</span><span class="num" id="6806689">0</span><span class="op" id="6806690">]</span><span class="op" id="6806691">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806699"><a href="/net/fd_mutex_test.go.html#6806117">readState</a></span><span class="op" id="6806708">[</span><span class="num" id="6806709">1</span><span class="op" id="6806710">]</span><span class="op" id="6806711">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806719">if</span>&nbsp;<span class="ident" id="6806722"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6806724">.</span><span class="ident" id="6806725">RWUnlock</span><span class="op" id="6806733">(</span><span class="ident" id="6806734">true</span><span class="op" id="6806738">)</span>&nbsp;<span class="op" id="6806740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806748"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806749">.</span><span class="ident" id="6806750">Error</span><span class="op" id="6806755">(</span><span class="string" id="6806756">&#34;broken&#34;</span><span class="op" id="6806764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806772">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806784">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806790">case</span>&nbsp;<span class="num" id="6806795">2</span><span class="op" id="6806796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806803">if</span>&nbsp;<span class="op" id="6806806">!</span><span class="ident" id="6806807"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6806809">.</span><span class="ident" id="6806810">RWLock</span><span class="op" id="6806816">(</span><span class="ident" id="6806817">false</span><span class="op" id="6806822">)</span>&nbsp;<span class="op" id="6806824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806832"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806833">.</span><span class="ident" id="6806834">Error</span><span class="op" id="6806839">(</span><span class="string" id="6806840">&#34;broken&#34;</span><span class="op" id="6806848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806856">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6806868">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6806875">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6806937">if</span>&nbsp;<span class="ident" id="6806940"><a href="/net/fd_mutex_test.go.html#6806142">writeState</a></span><span class="op" id="6806950">[</span><span class="num" id="6806951">0</span><span class="op" id="6806952">]</span>&nbsp;<span class="op" id="6806954">!=</span>&nbsp;<span class="ident" id="6806957"><a href="/net/fd_mutex_test.go.html#6806142">writeState</a></span><span class="op" id="6806967">[</span><span class="num" id="6806968">1</span><span class="op" id="6806969">]</span>&nbsp;<span class="op" id="6806971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6806979"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6806980">.</span><span class="ident" id="6806981">Error</span><span class="op" id="6806986">(</span><span class="string" id="6806987">&#34;broken&#34;</span><span class="op" id="6806995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807015">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807022"><a href="/net/fd_mutex_test.go.html#6806142">writeState</a></span><span class="op" id="6807032">[</span><span class="num" id="6807033">0</span><span class="op" id="6807034">]</span><span class="op" id="6807035">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807043"><a href="/net/fd_mutex_test.go.html#6806142">writeState</a></span><span class="op" id="6807053">[</span><span class="num" id="6807054">1</span><span class="op" id="6807055">]</span><span class="op" id="6807056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807064">if</span>&nbsp;<span class="ident" id="6807067"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6807069">.</span><span class="ident" id="6807070">RWUnlock</span><span class="op" id="6807078">(</span><span class="ident" id="6807079">false</span><span class="op" id="6807084">)</span>&nbsp;<span class="op" id="6807086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807094"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6807095">.</span><span class="ident" id="6807096">Error</span><span class="op" id="6807101">(</span><span class="string" id="6807102">&#34;broken&#34;</span><span class="op" id="6807110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807118">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807146"><a href="/net/fd_mutex_test.go.html#6806072">done</a></span>&nbsp;<span class="op" id="6807151">&lt;-</span>&nbsp;<span class="ident" id="6807154">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807161">}</span><span class="op" id="6807162">(</span><span class="op" id="6807163">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807169">for</span>&nbsp;<span class="ident" id="6807173">p</span>&nbsp;<span class="op" id="6807175">:=</span>&nbsp;<span class="num" id="6807178">0</span><span class="op" id="6807179">;</span>&nbsp;<span class="ident" id="6807181"><a href="/net/fd_mutex_test.go.html#6807173">p</a></span>&nbsp;<span class="op" id="6807183">&lt;</span>&nbsp;<span class="ident" id="6807185"><a href="/net/fd_mutex_test.go.html#6805957">P</a></span><span class="op" id="6807186">;</span>&nbsp;<span class="ident" id="6807188"><a href="/net/fd_mutex_test.go.html#6807173">p</a></span><span class="op" id="6807189">++</span>&nbsp;<span class="op" id="6807192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807196">&lt;-</span><span class="ident" id="6807198"><a href="/net/fd_mutex_test.go.html#6806072">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807207">if</span>&nbsp;<span class="op" id="6807210">!</span><span class="ident" id="6807211"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6807213">.</span><span class="ident" id="6807214">IncrefAndClose</span><span class="op" id="6807228">(</span><span class="op" id="6807229">)</span>&nbsp;<span class="op" id="6807231">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807235"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6807236">.</span><span class="ident" id="6807237">Fatal</span><span class="op" id="6807242">(</span><span class="string" id="6807243">&#34;broken&#34;</span><span class="op" id="6807251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6807257">if</span>&nbsp;<span class="op" id="6807260">!</span><span class="ident" id="6807261"><a href="/net/fd_mutex_test.go.html#6806101">mu</a></span><span class="op" id="6807263">.</span><span class="ident" id="6807264">Decref</span><span class="op" id="6807270">(</span><span class="op" id="6807271">)</span>&nbsp;<span class="op" id="6807273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6807277"><a href="/net/fd_mutex_test.go.html#6805940">t</a></span><span class="op" id="6807278">.</span><span class="ident" id="6807279">Fatal</span><span class="op" id="6807284">(</span><span class="string" id="6807285">&#34;broken&#34;</span><span class="op" id="6807293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6807296">}</span><br>
<span class="lineno">195</span><span class="op" id="6807298">}</span>
</div>
</body>
</html>
