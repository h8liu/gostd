<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4380819">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4380874">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4380928">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4380979">package</span>&nbsp;<span class="ident" id="4380987">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4380997">import</span>&nbsp;<span class="op" id="4381004">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4381007">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4381016">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4381026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4381029">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4381108">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4381186">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="4381264">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4381274">var</span>&nbsp;<span class="ident" id="4381278">transitionFunc</span>&nbsp;<span class="op" id="4381293">=</span>&nbsp;<span class="op" id="4381295">[</span><span class="op" id="4381296">...</span><span class="op" id="4381299">]</span><span class="keyword" id="4381300">func</span><span class="op" id="4381304">(</span><span class="ident" id="4381305">context</span><span class="op" id="4381312">,</span>&nbsp;<span class="op" id="4381314">[</span><span class="op" id="4381315">]</span><span class="builtintype" id="4381316">byte</span><span class="op" id="4381320">)</span>&nbsp;<span class="op" id="4381322">(</span><span class="ident" id="4381323">context</span><span class="op" id="4381330">,</span>&nbsp;<span class="builtintype" id="4381332">int</span><span class="op" id="4381335">)</span><span class="op" id="4381336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381339">stateText</span><span class="op" id="4381348">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381357">tText</span><span class="op" id="4381362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381365">stateTag</span><span class="op" id="4381373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381383">tTag</span><span class="op" id="4381387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381390">stateAttrName</span><span class="op" id="4381403">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381408">tAttrName</span><span class="op" id="4381417">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381420">stateAfterName</span><span class="op" id="4381434">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4381438">tAfterName</span><span class="op" id="4381448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381451">stateBeforeValue</span><span class="op" id="4381467">:</span>&nbsp;<span class="ident" id="4381469">tBeforeValue</span><span class="op" id="4381481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381484">stateHTMLCmt</span><span class="op" id="4381496">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381502">tHTMLCmt</span><span class="op" id="4381510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381513">stateRCDATA</span><span class="op" id="4381524">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381531">tSpecialTagEnd</span><span class="op" id="4381545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381548">stateAttr</span><span class="op" id="4381557">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381566">tAttr</span><span class="op" id="4381571">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381574">stateURL</span><span class="op" id="4381582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381592">tURL</span><span class="op" id="4381596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381599">stateJS</span><span class="op" id="4381606">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381617">tJS</span><span class="op" id="4381620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381623">stateJSDqStr</span><span class="op" id="4381635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381641">tJSDelimited</span><span class="op" id="4381653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381656">stateJSSqStr</span><span class="op" id="4381668">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381674">tJSDelimited</span><span class="op" id="4381686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381689">stateJSRegexp</span><span class="op" id="4381702">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381707">tJSDelimited</span><span class="op" id="4381719">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381722">stateJSBlockCmt</span><span class="op" id="4381737">:</span>&nbsp;&nbsp;<span class="ident" id="4381740">tBlockCmt</span><span class="op" id="4381749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381752">stateJSLineCmt</span><span class="op" id="4381766">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4381770">tLineCmt</span><span class="op" id="4381778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381781">stateCSS</span><span class="op" id="4381789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381799">tCSS</span><span class="op" id="4381803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381806">stateCSSDqStr</span><span class="op" id="4381819">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381824">tCSSStr</span><span class="op" id="4381831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381834">stateCSSSqStr</span><span class="op" id="4381847">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381852">tCSSStr</span><span class="op" id="4381859">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381862">stateCSSDqURL</span><span class="op" id="4381875">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381880">tCSSStr</span><span class="op" id="4381887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381890">stateCSSSqURL</span><span class="op" id="4381903">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381908">tCSSStr</span><span class="op" id="4381915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381918">stateCSSURL</span><span class="op" id="4381929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381936">tCSSStr</span><span class="op" id="4381943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381946">stateCSSBlockCmt</span><span class="op" id="4381962">:</span>&nbsp;<span class="ident" id="4381964">tBlockCmt</span><span class="op" id="4381973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4381976">stateCSSLineCmt</span><span class="op" id="4381991">:</span>&nbsp;&nbsp;<span class="ident" id="4381994">tLineCmt</span><span class="op" id="4382002">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382005">stateError</span><span class="op" id="4382015">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382023">tError</span><span class="op" id="4382029">,</span><br>
<span class="lineno"></span><span class="op" id="4382031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4382034">var</span>&nbsp;<span class="ident" id="4382038">commentStart</span>&nbsp;<span class="op" id="4382051">=</span>&nbsp;<span class="op" id="4382053">[</span><span class="op" id="4382054">]</span><span class="builtintype" id="4382055">byte</span><span class="op" id="4382059">(</span><span class="string" id="4382060">&#34;&lt;!--&#34;</span><span class="op" id="4382066">)</span><br>
<span class="lineno"></span><span class="keyword" id="4382068">var</span>&nbsp;<span class="ident" id="4382072">commentEnd</span>&nbsp;<span class="op" id="4382083">=</span>&nbsp;<span class="op" id="4382085">[</span><span class="op" id="4382086">]</span><span class="builtintype" id="4382087">byte</span><span class="op" id="4382091">(</span><span class="string" id="4382092">&#34;--&gt;&#34;</span><span class="op" id="4382097">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4382100">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4382164">func</span>&nbsp;<span class="ident" id="4382169">tText</span><span class="op" id="4382174">(</span><span class="ident" id="4382175">c</span>&nbsp;<span class="ident" id="4382177">context</span><span class="op" id="4382184">,</span>&nbsp;<span class="ident" id="4382186">s</span>&nbsp;<span class="op" id="4382188">[</span><span class="op" id="4382189">]</span><span class="builtintype" id="4382190">byte</span><span class="op" id="4382194">)</span>&nbsp;<span class="op" id="4382196">(</span><span class="ident" id="4382197">context</span><span class="op" id="4382204">,</span>&nbsp;<span class="builtintype" id="4382206">int</span><span class="op" id="4382209">)</span>&nbsp;<span class="op" id="4382211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382214">k</span>&nbsp;<span class="op" id="4382216">:=</span>&nbsp;<span class="num" id="4382219">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382222">for</span>&nbsp;<span class="op" id="4382226">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382230">i</span>&nbsp;<span class="op" id="4382232">:=</span>&nbsp;<span class="ident" id="4382235">k</span>&nbsp;<span class="op" id="4382237">+</span>&nbsp;<span class="ident" id="4382239">bytes</span><span class="op" id="4382244">.</span><span class="ident" id="4382245">IndexByte</span><span class="op" id="4382254">(</span><span class="ident" id="4382255">s</span><span class="op" id="4382256">[</span><span class="ident" id="4382257">k</span><span class="op" id="4382258">:</span><span class="op" id="4382259">]</span><span class="op" id="4382260">,</span>&nbsp;<span class="string" id="4382262">&#39;&lt;&#39;</span><span class="op" id="4382265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382269">if</span>&nbsp;<span class="ident" id="4382272">i</span>&nbsp;<span class="op" id="4382274">&lt;</span>&nbsp;<span class="ident" id="4382276">k</span>&nbsp;<span class="op" id="4382278">||</span>&nbsp;<span class="ident" id="4382281">i</span><span class="op" id="4382282">+</span><span class="num" id="4382283">1</span>&nbsp;<span class="op" id="4382285">==</span>&nbsp;<span class="builtinfunc" id="4382288">len</span><span class="op" id="4382291">(</span><span class="ident" id="4382292">s</span><span class="op" id="4382293">)</span>&nbsp;<span class="op" id="4382295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382300">return</span>&nbsp;<span class="ident" id="4382307">c</span><span class="op" id="4382308">,</span>&nbsp;<span class="builtinfunc" id="4382310">len</span><span class="op" id="4382313">(</span><span class="ident" id="4382314">s</span><span class="op" id="4382315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382319">}</span>&nbsp;<span class="keyword" id="4382321">else</span>&nbsp;<span class="keyword" id="4382326">if</span>&nbsp;<span class="ident" id="4382329">i</span><span class="op" id="4382330">+</span><span class="num" id="4382331">4</span>&nbsp;<span class="op" id="4382333">&lt;=</span>&nbsp;<span class="builtinfunc" id="4382336">len</span><span class="op" id="4382339">(</span><span class="ident" id="4382340">s</span><span class="op" id="4382341">)</span>&nbsp;<span class="op" id="4382343">&amp;&amp;</span>&nbsp;<span class="ident" id="4382346">bytes</span><span class="op" id="4382351">.</span><span class="ident" id="4382352">Equal</span><span class="op" id="4382357">(</span><span class="ident" id="4382358">commentStart</span><span class="op" id="4382370">,</span>&nbsp;<span class="ident" id="4382372">s</span><span class="op" id="4382373">[</span><span class="ident" id="4382374">i</span><span class="op" id="4382375">:</span><span class="ident" id="4382376">i</span><span class="op" id="4382377">+</span><span class="num" id="4382378">4</span><span class="op" id="4382379">]</span><span class="op" id="4382380">)</span>&nbsp;<span class="op" id="4382382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382387">return</span>&nbsp;<span class="ident" id="4382394">context</span><span class="op" id="4382401">{</span><span class="ident" id="4382402">state</span><span class="op" id="4382407">:</span>&nbsp;<span class="ident" id="4382409">stateHTMLCmt</span><span class="op" id="4382421">}</span><span class="op" id="4382422">,</span>&nbsp;<span class="ident" id="4382424">i</span>&nbsp;<span class="op" id="4382426">+</span>&nbsp;<span class="num" id="4382428">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382436">i</span><span class="op" id="4382437">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382442">end</span>&nbsp;<span class="op" id="4382446">:=</span>&nbsp;<span class="builtintype" id="4382449">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382457">if</span>&nbsp;<span class="ident" id="4382460">s</span><span class="op" id="4382461">[</span><span class="ident" id="4382462">i</span><span class="op" id="4382463">]</span>&nbsp;<span class="op" id="4382465">==</span>&nbsp;<span class="string" id="4382468">&#39;/&#39;</span>&nbsp;<span class="op" id="4382472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382477">if</span>&nbsp;<span class="ident" id="4382480">i</span><span class="op" id="4382481">+</span><span class="num" id="4382482">1</span>&nbsp;<span class="op" id="4382484">==</span>&nbsp;<span class="builtinfunc" id="4382487">len</span><span class="op" id="4382490">(</span><span class="ident" id="4382491">s</span><span class="op" id="4382492">)</span>&nbsp;<span class="op" id="4382494">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382500">return</span>&nbsp;<span class="ident" id="4382507">c</span><span class="op" id="4382508">,</span>&nbsp;<span class="builtinfunc" id="4382510">len</span><span class="op" id="4382513">(</span><span class="ident" id="4382514">s</span><span class="op" id="4382515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382525">end</span><span class="op" id="4382528">,</span>&nbsp;<span class="ident" id="4382530">i</span>&nbsp;<span class="op" id="4382532">=</span>&nbsp;<span class="builtintype" id="4382534">true</span><span class="op" id="4382538">,</span>&nbsp;<span class="ident" id="4382540">i</span><span class="op" id="4382541">+</span><span class="num" id="4382542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382550">j</span><span class="op" id="4382551">,</span>&nbsp;<span class="ident" id="4382553">e</span>&nbsp;<span class="op" id="4382555">:=</span>&nbsp;<span class="ident" id="4382558">eatTagName</span><span class="op" id="4382568">(</span><span class="ident" id="4382569">s</span><span class="op" id="4382570">,</span>&nbsp;<span class="ident" id="4382572">i</span><span class="op" id="4382573">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382577">if</span>&nbsp;<span class="ident" id="4382580">j</span>&nbsp;<span class="op" id="4382582">!=</span>&nbsp;<span class="ident" id="4382585">i</span>&nbsp;<span class="op" id="4382587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382592">if</span>&nbsp;<span class="ident" id="4382595">end</span>&nbsp;<span class="op" id="4382599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382605">e</span>&nbsp;<span class="op" id="4382607">=</span>&nbsp;<span class="ident" id="4382609">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4382629">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4382660">return</span>&nbsp;<span class="ident" id="4382667">context</span><span class="op" id="4382674">{</span><span class="ident" id="4382675">state</span><span class="op" id="4382680">:</span>&nbsp;<span class="ident" id="4382682">stateTag</span><span class="op" id="4382690">,</span>&nbsp;<span class="ident" id="4382692">element</span><span class="op" id="4382699">:</span>&nbsp;<span class="ident" id="4382701">e</span><span class="op" id="4382702">}</span><span class="op" id="4382703">,</span>&nbsp;<span class="ident" id="4382705">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382713">k</span>&nbsp;<span class="op" id="4382715">=</span>&nbsp;<span class="ident" id="4382717">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4382720">}</span><br>
<span class="lineno"></span><span class="op" id="4382722">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="4382725">var</span>&nbsp;<span class="ident" id="4382729">elementContentType</span>&nbsp;<span class="op" id="4382748">=</span>&nbsp;<span class="op" id="4382750">[</span><span class="op" id="4382751">...</span><span class="op" id="4382754">]</span><span class="ident" id="4382755">state</span><span class="op" id="4382760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382763">elementNone</span><span class="op" id="4382774">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382780">stateText</span><span class="op" id="4382789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382792">elementScript</span><span class="op" id="4382805">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4382809">stateJS</span><span class="op" id="4382816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382819">elementStyle</span><span class="op" id="4382831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382836">stateCSS</span><span class="op" id="4382844">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382847">elementTextarea</span><span class="op" id="4382862">:</span>&nbsp;<span class="ident" id="4382864">stateRCDATA</span><span class="op" id="4382875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382878">elementTitle</span><span class="op" id="4382890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4382895">stateRCDATA</span><span class="op" id="4382906">,</span><br>
<span class="lineno"></span><span class="op" id="4382908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4382911">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="4382973">func</span>&nbsp;<span class="ident" id="4382978">tTag</span><span class="op" id="4382982">(</span><span class="ident" id="4382983">c</span>&nbsp;<span class="ident" id="4382985">context</span><span class="op" id="4382992">,</span>&nbsp;<span class="ident" id="4382994">s</span>&nbsp;<span class="op" id="4382996">[</span><span class="op" id="4382997">]</span><span class="builtintype" id="4382998">byte</span><span class="op" id="4383002">)</span>&nbsp;<span class="op" id="4383004">(</span><span class="ident" id="4383005">context</span><span class="op" id="4383012">,</span>&nbsp;<span class="builtintype" id="4383014">int</span><span class="op" id="4383017">)</span>&nbsp;<span class="op" id="4383019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4383022">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383051">i</span>&nbsp;<span class="op" id="4383053">:=</span>&nbsp;<span class="ident" id="4383056">eatWhiteSpace</span><span class="op" id="4383069">(</span><span class="ident" id="4383070">s</span><span class="op" id="4383071">,</span>&nbsp;<span class="num" id="4383073">0</span><span class="op" id="4383074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383077">if</span>&nbsp;<span class="ident" id="4383080">i</span>&nbsp;<span class="op" id="4383082">==</span>&nbsp;<span class="builtinfunc" id="4383085">len</span><span class="op" id="4383088">(</span><span class="ident" id="4383089">s</span><span class="op" id="4383090">)</span>&nbsp;<span class="op" id="4383092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383096">return</span>&nbsp;<span class="ident" id="4383103">c</span><span class="op" id="4383104">,</span>&nbsp;<span class="builtinfunc" id="4383106">len</span><span class="op" id="4383109">(</span><span class="ident" id="4383110">s</span><span class="op" id="4383111">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383117">if</span>&nbsp;<span class="ident" id="4383120">s</span><span class="op" id="4383121">[</span><span class="ident" id="4383122">i</span><span class="op" id="4383123">]</span>&nbsp;<span class="op" id="4383125">==</span>&nbsp;<span class="string" id="4383128">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4383132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383136">return</span>&nbsp;<span class="ident" id="4383143">context</span><span class="op" id="4383150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383155">state</span><span class="op" id="4383160">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4383164">elementContentType</span><span class="op" id="4383182">[</span><span class="ident" id="4383183">c</span><span class="op" id="4383184">.</span><span class="ident" id="4383185">element</span><span class="op" id="4383192">]</span><span class="op" id="4383193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383198">element</span><span class="op" id="4383205">:</span>&nbsp;<span class="ident" id="4383207">c</span><span class="op" id="4383208">.</span><span class="ident" id="4383209">element</span><span class="op" id="4383216">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383220">}</span><span class="op" id="4383221">,</span>&nbsp;<span class="ident" id="4383223">i</span>&nbsp;<span class="op" id="4383225">+</span>&nbsp;<span class="num" id="4383227">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383233">j</span><span class="op" id="4383234">,</span>&nbsp;<span class="ident" id="4383236">err</span>&nbsp;<span class="op" id="4383240">:=</span>&nbsp;<span class="ident" id="4383243">eatAttrName</span><span class="op" id="4383254">(</span><span class="ident" id="4383255">s</span><span class="op" id="4383256">,</span>&nbsp;<span class="ident" id="4383258">i</span><span class="op" id="4383259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383262">if</span>&nbsp;<span class="ident" id="4383265">err</span>&nbsp;<span class="op" id="4383269">!=</span>&nbsp;<span class="builtintype" id="4383272">nil</span>&nbsp;<span class="op" id="4383276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383280">return</span>&nbsp;<span class="ident" id="4383287">context</span><span class="op" id="4383294">{</span><span class="ident" id="4383295">state</span><span class="op" id="4383300">:</span>&nbsp;<span class="ident" id="4383302">stateError</span><span class="op" id="4383312">,</span>&nbsp;<span class="ident" id="4383314">err</span><span class="op" id="4383317">:</span>&nbsp;<span class="ident" id="4383319">err</span><span class="op" id="4383322">}</span><span class="op" id="4383323">,</span>&nbsp;<span class="builtinfunc" id="4383325">len</span><span class="op" id="4383328">(</span><span class="ident" id="4383329">s</span><span class="op" id="4383330">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383336">state</span><span class="op" id="4383341">,</span>&nbsp;<span class="ident" id="4383343">attr</span>&nbsp;<span class="op" id="4383348">:=</span>&nbsp;<span class="ident" id="4383351">stateTag</span><span class="op" id="4383359">,</span>&nbsp;<span class="ident" id="4383361">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383371">if</span>&nbsp;<span class="ident" id="4383374">i</span>&nbsp;<span class="op" id="4383376">==</span>&nbsp;<span class="ident" id="4383379">j</span>&nbsp;<span class="op" id="4383381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383385">return</span>&nbsp;<span class="ident" id="4383392">context</span><span class="op" id="4383399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383404">state</span><span class="op" id="4383409">:</span>&nbsp;<span class="ident" id="4383411">stateError</span><span class="op" id="4383421">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383426">err</span><span class="op" id="4383429">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4383433">errorf</span><span class="op" id="4383439">(</span><span class="ident" id="4383440">ErrBadHTML</span><span class="op" id="4383450">,</span>&nbsp;<span class="builtintype" id="4383452">nil</span><span class="op" id="4383455">,</span>&nbsp;<span class="num" id="4383457">0</span><span class="op" id="4383458">,</span>&nbsp;<span class="string" id="4383460">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="4383514">,</span>&nbsp;<span class="ident" id="4383516">s</span><span class="op" id="4383517">[</span><span class="ident" id="4383518">i</span><span class="op" id="4383519">:</span><span class="op" id="4383520">]</span><span class="op" id="4383521">)</span><span class="op" id="4383522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383526">}</span><span class="op" id="4383527">,</span>&nbsp;<span class="builtinfunc" id="4383529">len</span><span class="op" id="4383532">(</span><span class="ident" id="4383533">s</span><span class="op" id="4383534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383540">switch</span>&nbsp;<span class="ident" id="4383547">attrType</span><span class="op" id="4383555">(</span><span class="builtintype" id="4383556">string</span><span class="op" id="4383562">(</span><span class="ident" id="4383563">s</span><span class="op" id="4383564">[</span><span class="ident" id="4383565">i</span><span class="op" id="4383566">:</span><span class="ident" id="4383567">j</span><span class="op" id="4383568">]</span><span class="op" id="4383569">)</span><span class="op" id="4383570">)</span>&nbsp;<span class="op" id="4383572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383575">case</span>&nbsp;<span class="ident" id="4383580">contentTypeURL</span><span class="op" id="4383594">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383598">attr</span>&nbsp;<span class="op" id="4383603">=</span>&nbsp;<span class="ident" id="4383605">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383614">case</span>&nbsp;<span class="ident" id="4383619">contentTypeCSS</span><span class="op" id="4383633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383637">attr</span>&nbsp;<span class="op" id="4383642">=</span>&nbsp;<span class="ident" id="4383644">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383655">case</span>&nbsp;<span class="ident" id="4383660">contentTypeJS</span><span class="op" id="4383673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383677">attr</span>&nbsp;<span class="op" id="4383682">=</span>&nbsp;<span class="ident" id="4383684">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383699">if</span>&nbsp;<span class="ident" id="4383702">j</span>&nbsp;<span class="op" id="4383704">==</span>&nbsp;<span class="builtinfunc" id="4383707">len</span><span class="op" id="4383710">(</span><span class="ident" id="4383711">s</span><span class="op" id="4383712">)</span>&nbsp;<span class="op" id="4383714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383718">state</span>&nbsp;<span class="op" id="4383724">=</span>&nbsp;<span class="ident" id="4383726">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383741">}</span>&nbsp;<span class="keyword" id="4383743">else</span>&nbsp;<span class="op" id="4383748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383752">state</span>&nbsp;<span class="op" id="4383758">=</span>&nbsp;<span class="ident" id="4383760">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4383776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383779">return</span>&nbsp;<span class="ident" id="4383786">context</span><span class="op" id="4383793">{</span><span class="ident" id="4383794">state</span><span class="op" id="4383799">:</span>&nbsp;<span class="ident" id="4383801">state</span><span class="op" id="4383806">,</span>&nbsp;<span class="ident" id="4383808">element</span><span class="op" id="4383815">:</span>&nbsp;<span class="ident" id="4383817">c</span><span class="op" id="4383818">.</span><span class="ident" id="4383819">element</span><span class="op" id="4383826">,</span>&nbsp;<span class="ident" id="4383828">attr</span><span class="op" id="4383832">:</span>&nbsp;<span class="ident" id="4383834">attr</span><span class="op" id="4383838">}</span><span class="op" id="4383839">,</span>&nbsp;<span class="ident" id="4383841">j</span><br>
<span class="lineno"></span><span class="op" id="4383843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4383846">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="4383913">func</span>&nbsp;<span class="ident" id="4383918">tAttrName</span><span class="op" id="4383927">(</span><span class="ident" id="4383928">c</span>&nbsp;<span class="ident" id="4383930">context</span><span class="op" id="4383937">,</span>&nbsp;<span class="ident" id="4383939">s</span>&nbsp;<span class="op" id="4383941">[</span><span class="op" id="4383942">]</span><span class="builtintype" id="4383943">byte</span><span class="op" id="4383947">)</span>&nbsp;<span class="op" id="4383949">(</span><span class="ident" id="4383950">context</span><span class="op" id="4383957">,</span>&nbsp;<span class="builtintype" id="4383959">int</span><span class="op" id="4383962">)</span>&nbsp;<span class="op" id="4383964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4383967">i</span><span class="op" id="4383968">,</span>&nbsp;<span class="ident" id="4383970">err</span>&nbsp;<span class="op" id="4383974">:=</span>&nbsp;<span class="ident" id="4383977">eatAttrName</span><span class="op" id="4383988">(</span><span class="ident" id="4383989">s</span><span class="op" id="4383990">,</span>&nbsp;<span class="num" id="4383992">0</span><span class="op" id="4383993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4383996">if</span>&nbsp;<span class="ident" id="4383999">err</span>&nbsp;<span class="op" id="4384003">!=</span>&nbsp;<span class="builtintype" id="4384006">nil</span>&nbsp;<span class="op" id="4384010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384014">return</span>&nbsp;<span class="ident" id="4384021">context</span><span class="op" id="4384028">{</span><span class="ident" id="4384029">state</span><span class="op" id="4384034">:</span>&nbsp;<span class="ident" id="4384036">stateError</span><span class="op" id="4384046">,</span>&nbsp;<span class="ident" id="4384048">err</span><span class="op" id="4384051">:</span>&nbsp;<span class="ident" id="4384053">err</span><span class="op" id="4384056">}</span><span class="op" id="4384057">,</span>&nbsp;<span class="builtinfunc" id="4384059">len</span><span class="op" id="4384062">(</span><span class="ident" id="4384063">s</span><span class="op" id="4384064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384067">}</span>&nbsp;<span class="keyword" id="4384069">else</span>&nbsp;<span class="keyword" id="4384074">if</span>&nbsp;<span class="ident" id="4384077">i</span>&nbsp;<span class="op" id="4384079">!=</span>&nbsp;<span class="builtinfunc" id="4384082">len</span><span class="op" id="4384085">(</span><span class="ident" id="4384086">s</span><span class="op" id="4384087">)</span>&nbsp;<span class="op" id="4384089">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384093">c</span><span class="op" id="4384094">.</span><span class="ident" id="4384095">state</span>&nbsp;<span class="op" id="4384101">=</span>&nbsp;<span class="ident" id="4384103">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384122">return</span>&nbsp;<span class="ident" id="4384129">c</span><span class="op" id="4384130">,</span>&nbsp;<span class="ident" id="4384132">i</span><br>
<span class="lineno"></span><span class="op" id="4384134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="4384137">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="4384206">func</span>&nbsp;<span class="ident" id="4384211">tAfterName</span><span class="op" id="4384221">(</span><span class="ident" id="4384222">c</span>&nbsp;<span class="ident" id="4384224">context</span><span class="op" id="4384231">,</span>&nbsp;<span class="ident" id="4384233">s</span>&nbsp;<span class="op" id="4384235">[</span><span class="op" id="4384236">]</span><span class="builtintype" id="4384237">byte</span><span class="op" id="4384241">)</span>&nbsp;<span class="op" id="4384243">(</span><span class="ident" id="4384244">context</span><span class="op" id="4384251">,</span>&nbsp;<span class="builtintype" id="4384253">int</span><span class="op" id="4384256">)</span>&nbsp;<span class="op" id="4384258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384261">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384298">i</span>&nbsp;<span class="op" id="4384300">:=</span>&nbsp;<span class="ident" id="4384303">eatWhiteSpace</span><span class="op" id="4384316">(</span><span class="ident" id="4384317">s</span><span class="op" id="4384318">,</span>&nbsp;<span class="num" id="4384320">0</span><span class="op" id="4384321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384324">if</span>&nbsp;<span class="ident" id="4384327">i</span>&nbsp;<span class="op" id="4384329">==</span>&nbsp;<span class="builtinfunc" id="4384332">len</span><span class="op" id="4384335">(</span><span class="ident" id="4384336">s</span><span class="op" id="4384337">)</span>&nbsp;<span class="op" id="4384339">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384343">return</span>&nbsp;<span class="ident" id="4384350">c</span><span class="op" id="4384351">,</span>&nbsp;<span class="builtinfunc" id="4384353">len</span><span class="op" id="4384356">(</span><span class="ident" id="4384357">s</span><span class="op" id="4384358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384361">}</span>&nbsp;<span class="keyword" id="4384363">else</span>&nbsp;<span class="keyword" id="4384368">if</span>&nbsp;<span class="ident" id="4384371">s</span><span class="op" id="4384372">[</span><span class="ident" id="4384373">i</span><span class="op" id="4384374">]</span>&nbsp;<span class="op" id="4384376">!=</span>&nbsp;<span class="string" id="4384379">&#39;=&#39;</span>&nbsp;<span class="op" id="4384383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384387">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384447">c</span><span class="op" id="4384448">.</span><span class="ident" id="4384449">state</span>&nbsp;<span class="op" id="4384455">=</span>&nbsp;<span class="ident" id="4384457">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384468">return</span>&nbsp;<span class="ident" id="4384475">c</span><span class="op" id="4384476">,</span>&nbsp;<span class="ident" id="4384478">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384484">c</span><span class="op" id="4384485">.</span><span class="ident" id="4384486">state</span>&nbsp;<span class="op" id="4384492">=</span>&nbsp;<span class="ident" id="4384494">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384512">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384533">return</span>&nbsp;<span class="ident" id="4384540">c</span><span class="op" id="4384541">,</span>&nbsp;<span class="ident" id="4384543">i</span>&nbsp;<span class="op" id="4384545">+</span>&nbsp;<span class="num" id="4384547">1</span><br>
<span class="lineno"></span><span class="op" id="4384549">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4384552">var</span>&nbsp;<span class="ident" id="4384556">attrStartStates</span>&nbsp;<span class="op" id="4384572">=</span>&nbsp;<span class="op" id="4384574">[</span><span class="op" id="4384575">...</span><span class="op" id="4384578">]</span><span class="ident" id="4384579">state</span><span class="op" id="4384584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384587">attrNone</span><span class="op" id="4384595">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4384599">stateAttr</span><span class="op" id="4384608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384611">attrScript</span><span class="op" id="4384621">:</span>&nbsp;<span class="ident" id="4384623">stateJS</span><span class="op" id="4384630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384633">attrStyle</span><span class="op" id="4384642">:</span>&nbsp;&nbsp;<span class="ident" id="4384645">stateCSS</span><span class="op" id="4384653">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384656">attrURL</span><span class="op" id="4384663">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384668">stateURL</span><span class="op" id="4384676">,</span><br>
<span class="lineno"></span><span class="op" id="4384678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4384681">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="4384754">func</span>&nbsp;<span class="ident" id="4384759">tBeforeValue</span><span class="op" id="4384771">(</span><span class="ident" id="4384772">c</span>&nbsp;<span class="ident" id="4384774">context</span><span class="op" id="4384781">,</span>&nbsp;<span class="ident" id="4384783">s</span>&nbsp;<span class="op" id="4384785">[</span><span class="op" id="4384786">]</span><span class="builtintype" id="4384787">byte</span><span class="op" id="4384791">)</span>&nbsp;<span class="op" id="4384793">(</span><span class="ident" id="4384794">context</span><span class="op" id="4384801">,</span>&nbsp;<span class="builtintype" id="4384803">int</span><span class="op" id="4384806">)</span>&nbsp;<span class="op" id="4384808">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384811">i</span>&nbsp;<span class="op" id="4384813">:=</span>&nbsp;<span class="ident" id="4384816">eatWhiteSpace</span><span class="op" id="4384829">(</span><span class="ident" id="4384830">s</span><span class="op" id="4384831">,</span>&nbsp;<span class="num" id="4384833">0</span><span class="op" id="4384834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384837">if</span>&nbsp;<span class="ident" id="4384840">i</span>&nbsp;<span class="op" id="4384842">==</span>&nbsp;<span class="builtinfunc" id="4384845">len</span><span class="op" id="4384848">(</span><span class="ident" id="4384849">s</span><span class="op" id="4384850">)</span>&nbsp;<span class="op" id="4384852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384856">return</span>&nbsp;<span class="ident" id="4384863">c</span><span class="op" id="4384864">,</span>&nbsp;<span class="builtinfunc" id="4384866">len</span><span class="op" id="4384869">(</span><span class="ident" id="4384870">s</span><span class="op" id="4384871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4384874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4384877">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384911">delim</span>&nbsp;<span class="op" id="4384917">:=</span>&nbsp;<span class="ident" id="4384920">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384940">switch</span>&nbsp;<span class="ident" id="4384947">s</span><span class="op" id="4384948">[</span><span class="ident" id="4384949">i</span><span class="op" id="4384950">]</span>&nbsp;<span class="op" id="4384952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4384955">case</span>&nbsp;<span class="string" id="4384960">&#39;\&#39;&#39;</span><span class="op" id="4384964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4384968">delim</span><span class="op" id="4384973">,</span>&nbsp;<span class="ident" id="4384975">i</span>&nbsp;<span class="op" id="4384977">=</span>&nbsp;<span class="ident" id="4384979">delimSingleQuote</span><span class="op" id="4384995">,</span>&nbsp;<span class="ident" id="4384997">i</span><span class="op" id="4384998">+</span><span class="num" id="4384999">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385002">case</span>&nbsp;<span class="string" id="4385007">&#39;&#34;&#39;</span><span class="op" id="4385010">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385014">delim</span><span class="op" id="4385019">,</span>&nbsp;<span class="ident" id="4385021">i</span>&nbsp;<span class="op" id="4385023">=</span>&nbsp;<span class="ident" id="4385025">delimDoubleQuote</span><span class="op" id="4385041">,</span>&nbsp;<span class="ident" id="4385043">i</span><span class="op" id="4385044">+</span><span class="num" id="4385045">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385051">c</span><span class="op" id="4385052">.</span><span class="ident" id="4385053">state</span><span class="op" id="4385058">,</span>&nbsp;<span class="ident" id="4385060">c</span><span class="op" id="4385061">.</span><span class="ident" id="4385062">delim</span><span class="op" id="4385067">,</span>&nbsp;<span class="ident" id="4385069">c</span><span class="op" id="4385070">.</span><span class="ident" id="4385071">attr</span>&nbsp;<span class="op" id="4385076">=</span>&nbsp;<span class="ident" id="4385078">attrStartStates</span><span class="op" id="4385093">[</span><span class="ident" id="4385094">c</span><span class="op" id="4385095">.</span><span class="ident" id="4385096">attr</span><span class="op" id="4385100">]</span><span class="op" id="4385101">,</span>&nbsp;<span class="ident" id="4385103">delim</span><span class="op" id="4385108">,</span>&nbsp;<span class="ident" id="4385110">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385120">return</span>&nbsp;<span class="ident" id="4385127">c</span><span class="op" id="4385128">,</span>&nbsp;<span class="ident" id="4385130">i</span><br>
<span class="lineno"></span><span class="op" id="4385132">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4385135">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4385200">func</span>&nbsp;<span class="ident" id="4385205">tHTMLCmt</span><span class="op" id="4385213">(</span><span class="ident" id="4385214">c</span>&nbsp;<span class="ident" id="4385216">context</span><span class="op" id="4385223">,</span>&nbsp;<span class="ident" id="4385225">s</span>&nbsp;<span class="op" id="4385227">[</span><span class="op" id="4385228">]</span><span class="builtintype" id="4385229">byte</span><span class="op" id="4385233">)</span>&nbsp;<span class="op" id="4385235">(</span><span class="ident" id="4385236">context</span><span class="op" id="4385243">,</span>&nbsp;<span class="builtintype" id="4385245">int</span><span class="op" id="4385248">)</span>&nbsp;<span class="op" id="4385250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385253">if</span>&nbsp;<span class="ident" id="4385256">i</span>&nbsp;<span class="op" id="4385258">:=</span>&nbsp;<span class="ident" id="4385261">bytes</span><span class="op" id="4385266">.</span><span class="ident" id="4385267">Index</span><span class="op" id="4385272">(</span><span class="ident" id="4385273">s</span><span class="op" id="4385274">,</span>&nbsp;<span class="ident" id="4385276">commentEnd</span><span class="op" id="4385286">)</span><span class="op" id="4385287">;</span>&nbsp;<span class="ident" id="4385289">i</span>&nbsp;<span class="op" id="4385291">!=</span>&nbsp;<span class="op" id="4385294">-</span><span class="num" id="4385295">1</span>&nbsp;<span class="op" id="4385297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385301">return</span>&nbsp;<span class="ident" id="4385308">context</span><span class="op" id="4385315">{</span><span class="op" id="4385316">}</span><span class="op" id="4385317">,</span>&nbsp;<span class="ident" id="4385319">i</span>&nbsp;<span class="op" id="4385321">+</span>&nbsp;<span class="num" id="4385323">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385329">return</span>&nbsp;<span class="ident" id="4385336">c</span><span class="op" id="4385337">,</span>&nbsp;<span class="builtinfunc" id="4385339">len</span><span class="op" id="4385342">(</span><span class="ident" id="4385343">s</span><span class="op" id="4385344">)</span><br>
<span class="lineno"></span><span class="op" id="4385346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4385349">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="4385423">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4385486">var</span>&nbsp;<span class="ident" id="4385490">specialTagEndMarkers</span>&nbsp;<span class="op" id="4385511">=</span>&nbsp;<span class="op" id="4385513">[</span><span class="op" id="4385514">...</span><span class="op" id="4385517">]</span><span class="builtintype" id="4385518">string</span><span class="op" id="4385524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385527">elementScript</span><span class="op" id="4385540">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4385544">&#34;&lt;/script&#34;</span><span class="op" id="4385554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385557">elementStyle</span><span class="op" id="4385569">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4385574">&#34;&lt;/style&#34;</span><span class="op" id="4385583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385586">elementTextarea</span><span class="op" id="4385601">:</span>&nbsp;<span class="string" id="4385603">&#34;&lt;/textarea&#34;</span><span class="op" id="4385615">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4385618">elementTitle</span><span class="op" id="4385630">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4385635">&#34;&lt;/title&#34;</span><span class="op" id="4385644">,</span><br>
<span class="lineno"></span><span class="op" id="4385646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4385649">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="4385726">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="4385745">func</span>&nbsp;<span class="ident" id="4385750">tSpecialTagEnd</span><span class="op" id="4385764">(</span><span class="ident" id="4385765">c</span>&nbsp;<span class="ident" id="4385767">context</span><span class="op" id="4385774">,</span>&nbsp;<span class="ident" id="4385776">s</span>&nbsp;<span class="op" id="4385778">[</span><span class="op" id="4385779">]</span><span class="builtintype" id="4385780">byte</span><span class="op" id="4385784">)</span>&nbsp;<span class="op" id="4385786">(</span><span class="ident" id="4385787">context</span><span class="op" id="4385794">,</span>&nbsp;<span class="builtintype" id="4385796">int</span><span class="op" id="4385799">)</span>&nbsp;<span class="op" id="4385801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385804">if</span>&nbsp;<span class="ident" id="4385807">c</span><span class="op" id="4385808">.</span><span class="ident" id="4385809">element</span>&nbsp;<span class="op" id="4385817">!=</span>&nbsp;<span class="ident" id="4385820">elementNone</span>&nbsp;<span class="op" id="4385832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385836">if</span>&nbsp;<span class="ident" id="4385839">i</span>&nbsp;<span class="op" id="4385841">:=</span>&nbsp;<span class="ident" id="4385844">strings</span><span class="op" id="4385851">.</span><span class="ident" id="4385852">Index</span><span class="op" id="4385857">(</span><span class="ident" id="4385858">strings</span><span class="op" id="4385865">.</span><span class="ident" id="4385866">ToLower</span><span class="op" id="4385873">(</span><span class="builtintype" id="4385874">string</span><span class="op" id="4385880">(</span><span class="ident" id="4385881">s</span><span class="op" id="4385882">)</span><span class="op" id="4385883">)</span><span class="op" id="4385884">,</span>&nbsp;<span class="ident" id="4385886">specialTagEndMarkers</span><span class="op" id="4385906">[</span><span class="ident" id="4385907">c</span><span class="op" id="4385908">.</span><span class="ident" id="4385909">element</span><span class="op" id="4385916">]</span><span class="op" id="4385917">)</span><span class="op" id="4385918">;</span>&nbsp;<span class="ident" id="4385920">i</span>&nbsp;<span class="op" id="4385922">!=</span>&nbsp;<span class="op" id="4385925">-</span><span class="num" id="4385926">1</span>&nbsp;<span class="op" id="4385928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385933">return</span>&nbsp;<span class="ident" id="4385940">context</span><span class="op" id="4385947">{</span><span class="op" id="4385948">}</span><span class="op" id="4385949">,</span>&nbsp;<span class="ident" id="4385951">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385955">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4385958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4385961">return</span>&nbsp;<span class="ident" id="4385968">c</span><span class="op" id="4385969">,</span>&nbsp;<span class="builtinfunc" id="4385971">len</span><span class="op" id="4385974">(</span><span class="ident" id="4385975">s</span><span class="op" id="4385976">)</span><br>
<span class="lineno"></span><span class="op" id="4385978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4385981">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="4386050">func</span>&nbsp;<span class="ident" id="4386055">tAttr</span><span class="op" id="4386060">(</span><span class="ident" id="4386061">c</span>&nbsp;<span class="ident" id="4386063">context</span><span class="op" id="4386070">,</span>&nbsp;<span class="ident" id="4386072">s</span>&nbsp;<span class="op" id="4386074">[</span><span class="op" id="4386075">]</span><span class="builtintype" id="4386076">byte</span><span class="op" id="4386080">)</span>&nbsp;<span class="op" id="4386082">(</span><span class="ident" id="4386083">context</span><span class="op" id="4386090">,</span>&nbsp;<span class="builtintype" id="4386092">int</span><span class="op" id="4386095">)</span>&nbsp;<span class="op" id="4386097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386100">return</span>&nbsp;<span class="ident" id="4386107">c</span><span class="op" id="4386108">,</span>&nbsp;<span class="builtinfunc" id="4386110">len</span><span class="op" id="4386113">(</span><span class="ident" id="4386114">s</span><span class="op" id="4386115">)</span><br>
<span class="lineno"></span><span class="op" id="4386117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4386120">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="4386182">func</span>&nbsp;<span class="ident" id="4386187">tURL</span><span class="op" id="4386191">(</span><span class="ident" id="4386192">c</span>&nbsp;<span class="ident" id="4386194">context</span><span class="op" id="4386201">,</span>&nbsp;<span class="ident" id="4386203">s</span>&nbsp;<span class="op" id="4386205">[</span><span class="op" id="4386206">]</span><span class="builtintype" id="4386207">byte</span><span class="op" id="4386211">)</span>&nbsp;<span class="op" id="4386213">(</span><span class="ident" id="4386214">context</span><span class="op" id="4386221">,</span>&nbsp;<span class="builtintype" id="4386223">int</span><span class="op" id="4386226">)</span>&nbsp;<span class="op" id="4386228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386231">if</span>&nbsp;<span class="ident" id="4386234">bytes</span><span class="op" id="4386239">.</span><span class="ident" id="4386240">IndexAny</span><span class="op" id="4386248">(</span><span class="ident" id="4386249">s</span><span class="op" id="4386250">,</span>&nbsp;<span class="string" id="4386252">&#34;#?&#34;</span><span class="op" id="4386256">)</span>&nbsp;<span class="op" id="4386258">&gt;=</span>&nbsp;<span class="num" id="4386261">0</span>&nbsp;<span class="op" id="4386263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386267">c</span><span class="op" id="4386268">.</span><span class="ident" id="4386269">urlPart</span>&nbsp;<span class="op" id="4386277">=</span>&nbsp;<span class="ident" id="4386279">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386299">}</span>&nbsp;<span class="keyword" id="4386301">else</span>&nbsp;<span class="keyword" id="4386306">if</span>&nbsp;<span class="builtinfunc" id="4386309">len</span><span class="op" id="4386312">(</span><span class="ident" id="4386313">s</span><span class="op" id="4386314">)</span>&nbsp;<span class="op" id="4386316">!=</span>&nbsp;<span class="ident" id="4386319">eatWhiteSpace</span><span class="op" id="4386332">(</span><span class="ident" id="4386333">s</span><span class="op" id="4386334">,</span>&nbsp;<span class="num" id="4386336">0</span><span class="op" id="4386337">)</span>&nbsp;<span class="op" id="4386339">&amp;&amp;</span>&nbsp;<span class="ident" id="4386342">c</span><span class="op" id="4386343">.</span><span class="ident" id="4386344">urlPart</span>&nbsp;<span class="op" id="4386352">==</span>&nbsp;<span class="ident" id="4386355">urlPartNone</span>&nbsp;<span class="op" id="4386367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4386371">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4386436">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386499">c</span><span class="op" id="4386500">.</span><span class="ident" id="4386501">urlPart</span>&nbsp;<span class="op" id="4386509">=</span>&nbsp;<span class="ident" id="4386511">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386531">return</span>&nbsp;<span class="ident" id="4386538">c</span><span class="op" id="4386539">,</span>&nbsp;<span class="builtinfunc" id="4386541">len</span><span class="op" id="4386544">(</span><span class="ident" id="4386545">s</span><span class="op" id="4386546">)</span><br>
<span class="lineno"></span><span class="op" id="4386548">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4386551">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4386611">func</span>&nbsp;<span class="ident" id="4386616">tJS</span><span class="op" id="4386619">(</span><span class="ident" id="4386620">c</span>&nbsp;<span class="ident" id="4386622">context</span><span class="op" id="4386629">,</span>&nbsp;<span class="ident" id="4386631">s</span>&nbsp;<span class="op" id="4386633">[</span><span class="op" id="4386634">]</span><span class="builtintype" id="4386635">byte</span><span class="op" id="4386639">)</span>&nbsp;<span class="op" id="4386641">(</span><span class="ident" id="4386642">context</span><span class="op" id="4386649">,</span>&nbsp;<span class="builtintype" id="4386651">int</span><span class="op" id="4386654">)</span>&nbsp;<span class="op" id="4386656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386659">i</span>&nbsp;<span class="op" id="4386661">:=</span>&nbsp;<span class="ident" id="4386664">bytes</span><span class="op" id="4386669">.</span><span class="ident" id="4386670">IndexAny</span><span class="op" id="4386678">(</span><span class="ident" id="4386679">s</span><span class="op" id="4386680">,</span>&nbsp;<span class="string" id="4386682">`&#34;&#39;/`</span><span class="op" id="4386687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386690">if</span>&nbsp;<span class="ident" id="4386693">i</span>&nbsp;<span class="op" id="4386695">==</span>&nbsp;<span class="op" id="4386698">-</span><span class="num" id="4386699">1</span>&nbsp;<span class="op" id="4386701">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4386705">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386762">c</span><span class="op" id="4386763">.</span><span class="ident" id="4386764">jsCtx</span>&nbsp;<span class="op" id="4386770">=</span>&nbsp;<span class="ident" id="4386772">nextJSCtx</span><span class="op" id="4386781">(</span><span class="ident" id="4386782">s</span><span class="op" id="4386783">,</span>&nbsp;<span class="ident" id="4386785">c</span><span class="op" id="4386786">.</span><span class="ident" id="4386787">jsCtx</span><span class="op" id="4386792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386796">return</span>&nbsp;<span class="ident" id="4386803">c</span><span class="op" id="4386804">,</span>&nbsp;<span class="builtinfunc" id="4386806">len</span><span class="op" id="4386809">(</span><span class="ident" id="4386810">s</span><span class="op" id="4386811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4386814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386817">c</span><span class="op" id="4386818">.</span><span class="ident" id="4386819">jsCtx</span>&nbsp;<span class="op" id="4386825">=</span>&nbsp;<span class="ident" id="4386827">nextJSCtx</span><span class="op" id="4386836">(</span><span class="ident" id="4386837">s</span><span class="op" id="4386838">[</span><span class="op" id="4386839">:</span><span class="ident" id="4386840">i</span><span class="op" id="4386841">]</span><span class="op" id="4386842">,</span>&nbsp;<span class="ident" id="4386844">c</span><span class="op" id="4386845">.</span><span class="ident" id="4386846">jsCtx</span><span class="op" id="4386851">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386854">switch</span>&nbsp;<span class="ident" id="4386861">s</span><span class="op" id="4386862">[</span><span class="ident" id="4386863">i</span><span class="op" id="4386864">]</span>&nbsp;<span class="op" id="4386866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386869">case</span>&nbsp;<span class="string" id="4386874">&#39;&#34;&#39;</span><span class="op" id="4386877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386881">c</span><span class="op" id="4386882">.</span><span class="ident" id="4386883">state</span><span class="op" id="4386888">,</span>&nbsp;<span class="ident" id="4386890">c</span><span class="op" id="4386891">.</span><span class="ident" id="4386892">jsCtx</span>&nbsp;<span class="op" id="4386898">=</span>&nbsp;<span class="ident" id="4386900">stateJSDqStr</span><span class="op" id="4386912">,</span>&nbsp;<span class="ident" id="4386914">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386927">case</span>&nbsp;<span class="string" id="4386932">&#39;\&#39;&#39;</span><span class="op" id="4386936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4386940">c</span><span class="op" id="4386941">.</span><span class="ident" id="4386942">state</span><span class="op" id="4386947">,</span>&nbsp;<span class="ident" id="4386949">c</span><span class="op" id="4386950">.</span><span class="ident" id="4386951">jsCtx</span>&nbsp;<span class="op" id="4386957">=</span>&nbsp;<span class="ident" id="4386959">stateJSSqStr</span><span class="op" id="4386971">,</span>&nbsp;<span class="ident" id="4386973">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386986">case</span>&nbsp;<span class="string" id="4386991">&#39;/&#39;</span><span class="op" id="4386994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4386998">switch</span>&nbsp;<span class="op" id="4387005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387009">case</span>&nbsp;<span class="ident" id="4387014">i</span><span class="op" id="4387015">+</span><span class="num" id="4387016">1</span>&nbsp;<span class="op" id="4387018">&lt;</span>&nbsp;<span class="builtinfunc" id="4387020">len</span><span class="op" id="4387023">(</span><span class="ident" id="4387024">s</span><span class="op" id="4387025">)</span>&nbsp;<span class="op" id="4387027">&amp;&amp;</span>&nbsp;<span class="ident" id="4387030">s</span><span class="op" id="4387031">[</span><span class="ident" id="4387032">i</span><span class="op" id="4387033">+</span><span class="num" id="4387034">1</span><span class="op" id="4387035">]</span>&nbsp;<span class="op" id="4387037">==</span>&nbsp;<span class="string" id="4387040">&#39;/&#39;</span><span class="op" id="4387043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387048">c</span><span class="op" id="4387049">.</span><span class="ident" id="4387050">state</span><span class="op" id="4387055">,</span>&nbsp;<span class="ident" id="4387057">i</span>&nbsp;<span class="op" id="4387059">=</span>&nbsp;<span class="ident" id="4387061">stateJSLineCmt</span><span class="op" id="4387075">,</span>&nbsp;<span class="ident" id="4387077">i</span><span class="op" id="4387078">+</span><span class="num" id="4387079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387083">case</span>&nbsp;<span class="ident" id="4387088">i</span><span class="op" id="4387089">+</span><span class="num" id="4387090">1</span>&nbsp;<span class="op" id="4387092">&lt;</span>&nbsp;<span class="builtinfunc" id="4387094">len</span><span class="op" id="4387097">(</span><span class="ident" id="4387098">s</span><span class="op" id="4387099">)</span>&nbsp;<span class="op" id="4387101">&amp;&amp;</span>&nbsp;<span class="ident" id="4387104">s</span><span class="op" id="4387105">[</span><span class="ident" id="4387106">i</span><span class="op" id="4387107">+</span><span class="num" id="4387108">1</span><span class="op" id="4387109">]</span>&nbsp;<span class="op" id="4387111">==</span>&nbsp;<span class="string" id="4387114">&#39;*&#39;</span><span class="op" id="4387117">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387122">c</span><span class="op" id="4387123">.</span><span class="ident" id="4387124">state</span><span class="op" id="4387129">,</span>&nbsp;<span class="ident" id="4387131">i</span>&nbsp;<span class="op" id="4387133">=</span>&nbsp;<span class="ident" id="4387135">stateJSBlockCmt</span><span class="op" id="4387150">,</span>&nbsp;<span class="ident" id="4387152">i</span><span class="op" id="4387153">+</span><span class="num" id="4387154">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387158">case</span>&nbsp;<span class="ident" id="4387163">c</span><span class="op" id="4387164">.</span><span class="ident" id="4387165">jsCtx</span>&nbsp;<span class="op" id="4387171">==</span>&nbsp;<span class="ident" id="4387174">jsCtxRegexp</span><span class="op" id="4387185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387190">c</span><span class="op" id="4387191">.</span><span class="ident" id="4387192">state</span>&nbsp;<span class="op" id="4387198">=</span>&nbsp;<span class="ident" id="4387200">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387216">case</span>&nbsp;<span class="ident" id="4387221">c</span><span class="op" id="4387222">.</span><span class="ident" id="4387223">jsCtx</span>&nbsp;<span class="op" id="4387229">==</span>&nbsp;<span class="ident" id="4387232">jsCtxDivOp</span><span class="op" id="4387242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387247">c</span><span class="op" id="4387248">.</span><span class="ident" id="4387249">jsCtx</span>&nbsp;<span class="op" id="4387255">=</span>&nbsp;<span class="ident" id="4387257">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387271">default</span><span class="op" id="4387278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387283">return</span>&nbsp;<span class="ident" id="4387290">context</span><span class="op" id="4387297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387303">state</span><span class="op" id="4387308">:</span>&nbsp;<span class="ident" id="4387310">stateError</span><span class="op" id="4387320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387326">err</span><span class="op" id="4387329">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4387333">errorf</span><span class="op" id="4387339">(</span><span class="ident" id="4387340">ErrSlashAmbig</span><span class="op" id="4387353">,</span>&nbsp;<span class="builtintype" id="4387355">nil</span><span class="op" id="4387358">,</span>&nbsp;<span class="num" id="4387360">0</span><span class="op" id="4387361">,</span>&nbsp;<span class="string" id="4387363">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="4387408">,</span>&nbsp;<span class="ident" id="4387410">s</span><span class="op" id="4387411">[</span><span class="ident" id="4387412">i</span><span class="op" id="4387413">:</span><span class="op" id="4387414">]</span><span class="op" id="4387415">)</span><span class="op" id="4387416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387421">}</span><span class="op" id="4387422">,</span>&nbsp;<span class="builtinfunc" id="4387424">len</span><span class="op" id="4387427">(</span><span class="ident" id="4387428">s</span><span class="op" id="4387429">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387436">default</span><span class="op" id="4387443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4387447">panic</span><span class="op" id="4387452">(</span><span class="string" id="4387453">&#34;unreachable&#34;</span><span class="op" id="4387466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387472">return</span>&nbsp;<span class="ident" id="4387479">c</span><span class="op" id="4387480">,</span>&nbsp;<span class="ident" id="4387482">i</span>&nbsp;<span class="op" id="4387484">+</span>&nbsp;<span class="num" id="4387486">1</span><br>
<span class="lineno">255</span><span class="op" id="4387488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4387491">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4387571">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4387582">func</span>&nbsp;<span class="ident" id="4387587">tJSDelimited</span><span class="op" id="4387599">(</span><span class="ident" id="4387600">c</span>&nbsp;<span class="ident" id="4387602">context</span><span class="op" id="4387609">,</span>&nbsp;<span class="ident" id="4387611">s</span>&nbsp;<span class="op" id="4387613">[</span><span class="op" id="4387614">]</span><span class="builtintype" id="4387615">byte</span><span class="op" id="4387619">)</span>&nbsp;<span class="op" id="4387621">(</span><span class="ident" id="4387622">context</span><span class="op" id="4387629">,</span>&nbsp;<span class="builtintype" id="4387631">int</span><span class="op" id="4387634">)</span>&nbsp;<span class="op" id="4387636">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387639">specials</span>&nbsp;<span class="op" id="4387648">:=</span>&nbsp;<span class="string" id="4387651">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387657">switch</span>&nbsp;<span class="ident" id="4387664">c</span><span class="op" id="4387665">.</span><span class="ident" id="4387666">state</span>&nbsp;<span class="op" id="4387672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387675">case</span>&nbsp;<span class="ident" id="4387680">stateJSSqStr</span><span class="op" id="4387692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387696">specials</span>&nbsp;<span class="op" id="4387705">=</span>&nbsp;<span class="string" id="4387707">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387713">case</span>&nbsp;<span class="ident" id="4387718">stateJSRegexp</span><span class="op" id="4387731">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387735">specials</span>&nbsp;<span class="op" id="4387744">=</span>&nbsp;<span class="string" id="4387746">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387758">k</span><span class="op" id="4387759">,</span>&nbsp;<span class="ident" id="4387761">inCharset</span>&nbsp;<span class="op" id="4387771">:=</span>&nbsp;<span class="num" id="4387774">0</span><span class="op" id="4387775">,</span>&nbsp;<span class="builtintype" id="4387777">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387784">for</span>&nbsp;<span class="op" id="4387788">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387792">i</span>&nbsp;<span class="op" id="4387794">:=</span>&nbsp;<span class="ident" id="4387797">k</span>&nbsp;<span class="op" id="4387799">+</span>&nbsp;<span class="ident" id="4387801">bytes</span><span class="op" id="4387806">.</span><span class="ident" id="4387807">IndexAny</span><span class="op" id="4387815">(</span><span class="ident" id="4387816">s</span><span class="op" id="4387817">[</span><span class="ident" id="4387818">k</span><span class="op" id="4387819">:</span><span class="op" id="4387820">]</span><span class="op" id="4387821">,</span>&nbsp;<span class="ident" id="4387823">specials</span><span class="op" id="4387831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387835">if</span>&nbsp;<span class="ident" id="4387838">i</span>&nbsp;<span class="op" id="4387840">&lt;</span>&nbsp;<span class="ident" id="4387842">k</span>&nbsp;<span class="op" id="4387844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387849">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4387857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387861">switch</span>&nbsp;<span class="ident" id="4387868">s</span><span class="op" id="4387869">[</span><span class="ident" id="4387870">i</span><span class="op" id="4387871">]</span>&nbsp;<span class="op" id="4387873">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387877">case</span>&nbsp;<span class="string" id="4387882">&#39;\\&#39;</span><span class="op" id="4387886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387891">i</span><span class="op" id="4387892">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387898">if</span>&nbsp;<span class="ident" id="4387901">i</span>&nbsp;<span class="op" id="4387903">==</span>&nbsp;<span class="builtinfunc" id="4387906">len</span><span class="op" id="4387909">(</span><span class="ident" id="4387910">s</span><span class="op" id="4387911">)</span>&nbsp;<span class="op" id="4387913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4387919">return</span>&nbsp;<span class="ident" id="4387926">context</span><span class="op" id="4387933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387940">state</span><span class="op" id="4387945">:</span>&nbsp;<span class="ident" id="4387947">stateError</span><span class="op" id="4387957">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4387964">err</span><span class="op" id="4387967">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4387971">errorf</span><span class="op" id="4387977">(</span><span class="ident" id="4387978">ErrPartialEscape</span><span class="op" id="4387994">,</span>&nbsp;<span class="builtintype" id="4387996">nil</span><span class="op" id="4387999">,</span>&nbsp;<span class="num" id="4388001">0</span><span class="op" id="4388002">,</span>&nbsp;<span class="string" id="4388004">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4388049">,</span>&nbsp;<span class="ident" id="4388051">s</span><span class="op" id="4388052">)</span><span class="op" id="4388053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388059">}</span><span class="op" id="4388060">,</span>&nbsp;<span class="builtinfunc" id="4388062">len</span><span class="op" id="4388065">(</span><span class="ident" id="4388066">s</span><span class="op" id="4388067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388076">case</span>&nbsp;<span class="string" id="4388081">&#39;[&#39;</span><span class="op" id="4388084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388089">inCharset</span>&nbsp;<span class="op" id="4388099">=</span>&nbsp;<span class="builtintype" id="4388101">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388108">case</span>&nbsp;<span class="string" id="4388113">&#39;]&#39;</span><span class="op" id="4388116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388121">inCharset</span>&nbsp;<span class="op" id="4388131">=</span>&nbsp;<span class="builtintype" id="4388133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388141">default</span><span class="op" id="4388148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388153">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388173">if</span>&nbsp;<span class="op" id="4388176">!</span><span class="ident" id="4388177">inCharset</span>&nbsp;<span class="op" id="4388187">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388193">c</span><span class="op" id="4388194">.</span><span class="ident" id="4388195">state</span><span class="op" id="4388200">,</span>&nbsp;<span class="ident" id="4388202">c</span><span class="op" id="4388203">.</span><span class="ident" id="4388204">jsCtx</span>&nbsp;<span class="op" id="4388210">=</span>&nbsp;<span class="ident" id="4388212">stateJS</span><span class="op" id="4388219">,</span>&nbsp;<span class="ident" id="4388221">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388236">return</span>&nbsp;<span class="ident" id="4388243">c</span><span class="op" id="4388244">,</span>&nbsp;<span class="ident" id="4388246">i</span>&nbsp;<span class="op" id="4388248">+</span>&nbsp;<span class="num" id="4388250">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388263">k</span>&nbsp;<span class="op" id="4388265">=</span>&nbsp;<span class="ident" id="4388267">i</span>&nbsp;<span class="op" id="4388269">+</span>&nbsp;<span class="num" id="4388271">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388278">if</span>&nbsp;<span class="ident" id="4388281">inCharset</span>&nbsp;<span class="op" id="4388291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388295">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4388360">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388391">return</span>&nbsp;<span class="ident" id="4388398">context</span><span class="op" id="4388405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388410">state</span><span class="op" id="4388415">:</span>&nbsp;<span class="ident" id="4388417">stateError</span><span class="op" id="4388427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388432">err</span><span class="op" id="4388435">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4388439">errorf</span><span class="op" id="4388445">(</span><span class="ident" id="4388446">ErrPartialCharset</span><span class="op" id="4388463">,</span>&nbsp;<span class="builtintype" id="4388465">nil</span><span class="op" id="4388468">,</span>&nbsp;<span class="num" id="4388470">0</span><span class="op" id="4388471">,</span>&nbsp;<span class="string" id="4388473">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="4388507">,</span>&nbsp;<span class="ident" id="4388509">s</span><span class="op" id="4388510">)</span><span class="op" id="4388511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388515">}</span><span class="op" id="4388516">,</span>&nbsp;<span class="builtinfunc" id="4388518">len</span><span class="op" id="4388521">(</span><span class="ident" id="4388522">s</span><span class="op" id="4388523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388526">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388530">return</span>&nbsp;<span class="ident" id="4388537">c</span><span class="op" id="4388538">,</span>&nbsp;<span class="builtinfunc" id="4388540">len</span><span class="op" id="4388543">(</span><span class="ident" id="4388544">s</span><span class="op" id="4388545">)</span><br>
<span class="lineno"></span><span class="op" id="4388547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4388550">var</span>&nbsp;<span class="ident" id="4388554">blockCommentEnd</span>&nbsp;<span class="op" id="4388570">=</span>&nbsp;<span class="op" id="4388572">[</span><span class="op" id="4388573">]</span><span class="builtintype" id="4388574">byte</span><span class="op" id="4388578">(</span><span class="string" id="4388579">&#34;*/&#34;</span><span class="op" id="4388583">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="4388586">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4388658">func</span>&nbsp;<span class="ident" id="4388663">tBlockCmt</span><span class="op" id="4388672">(</span><span class="ident" id="4388673">c</span>&nbsp;<span class="ident" id="4388675">context</span><span class="op" id="4388682">,</span>&nbsp;<span class="ident" id="4388684">s</span>&nbsp;<span class="op" id="4388686">[</span><span class="op" id="4388687">]</span><span class="builtintype" id="4388688">byte</span><span class="op" id="4388692">)</span>&nbsp;<span class="op" id="4388694">(</span><span class="ident" id="4388695">context</span><span class="op" id="4388702">,</span>&nbsp;<span class="builtintype" id="4388704">int</span><span class="op" id="4388707">)</span>&nbsp;<span class="op" id="4388709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388712">i</span>&nbsp;<span class="op" id="4388714">:=</span>&nbsp;<span class="ident" id="4388717">bytes</span><span class="op" id="4388722">.</span><span class="ident" id="4388723">Index</span><span class="op" id="4388728">(</span><span class="ident" id="4388729">s</span><span class="op" id="4388730">,</span>&nbsp;<span class="ident" id="4388732">blockCommentEnd</span><span class="op" id="4388747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388750">if</span>&nbsp;<span class="ident" id="4388753">i</span>&nbsp;<span class="op" id="4388755">==</span>&nbsp;<span class="op" id="4388758">-</span><span class="num" id="4388759">1</span>&nbsp;<span class="op" id="4388761">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388765">return</span>&nbsp;<span class="ident" id="4388772">c</span><span class="op" id="4388773">,</span>&nbsp;<span class="builtinfunc" id="4388775">len</span><span class="op" id="4388778">(</span><span class="ident" id="4388779">s</span><span class="op" id="4388780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388786">switch</span>&nbsp;<span class="ident" id="4388793">c</span><span class="op" id="4388794">.</span><span class="ident" id="4388795">state</span>&nbsp;<span class="op" id="4388801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388804">case</span>&nbsp;<span class="ident" id="4388809">stateJSBlockCmt</span><span class="op" id="4388824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388828">c</span><span class="op" id="4388829">.</span><span class="ident" id="4388830">state</span>&nbsp;<span class="op" id="4388836">=</span>&nbsp;<span class="ident" id="4388838">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388847">case</span>&nbsp;<span class="ident" id="4388852">stateCSSBlockCmt</span><span class="op" id="4388868">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4388872">c</span><span class="op" id="4388873">.</span><span class="ident" id="4388874">state</span>&nbsp;<span class="op" id="4388880">=</span>&nbsp;<span class="ident" id="4388882">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388892">default</span><span class="op" id="4388899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4388903">panic</span><span class="op" id="4388908">(</span><span class="ident" id="4388909">c</span><span class="op" id="4388910">.</span><span class="ident" id="4388911">state</span><span class="op" id="4388916">.</span><span class="ident" id="4388917">String</span><span class="op" id="4388923">(</span><span class="op" id="4388924">)</span><span class="op" id="4388925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4388928">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4388931">return</span>&nbsp;<span class="ident" id="4388938">c</span><span class="op" id="4388939">,</span>&nbsp;<span class="ident" id="4388941">i</span>&nbsp;<span class="op" id="4388943">+</span>&nbsp;<span class="num" id="4388945">2</span><br>
<span class="lineno"></span><span class="op" id="4388947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4388950">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4389019">func</span>&nbsp;<span class="ident" id="4389024">tLineCmt</span><span class="op" id="4389032">(</span><span class="ident" id="4389033">c</span>&nbsp;<span class="ident" id="4389035">context</span><span class="op" id="4389042">,</span>&nbsp;<span class="ident" id="4389044">s</span>&nbsp;<span class="op" id="4389046">[</span><span class="op" id="4389047">]</span><span class="builtintype" id="4389048">byte</span><span class="op" id="4389052">)</span>&nbsp;<span class="op" id="4389054">(</span><span class="ident" id="4389055">context</span><span class="op" id="4389062">,</span>&nbsp;<span class="builtintype" id="4389064">int</span><span class="op" id="4389067">)</span>&nbsp;<span class="op" id="4389069">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389072">var</span>&nbsp;<span class="ident" id="4389076">lineTerminators</span>&nbsp;<span class="builtintype" id="4389092">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389100">var</span>&nbsp;<span class="ident" id="4389104">endState</span>&nbsp;<span class="ident" id="4389113">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389120">switch</span>&nbsp;<span class="ident" id="4389127">c</span><span class="op" id="4389128">.</span><span class="ident" id="4389129">state</span>&nbsp;<span class="op" id="4389135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389138">case</span>&nbsp;<span class="ident" id="4389143">stateJSLineCmt</span><span class="op" id="4389157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389161">lineTerminators</span><span class="op" id="4389176">,</span>&nbsp;<span class="ident" id="4389178">endState</span>&nbsp;<span class="op" id="4389187">=</span>&nbsp;<span class="string" id="4389189">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4389207">,</span>&nbsp;<span class="ident" id="4389209">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389218">case</span>&nbsp;<span class="ident" id="4389223">stateCSSLineCmt</span><span class="op" id="4389238">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389242">lineTerminators</span><span class="op" id="4389257">,</span>&nbsp;<span class="ident" id="4389259">endState</span>&nbsp;<span class="op" id="4389268">=</span>&nbsp;<span class="string" id="4389270">&#34;\n\f\r&#34;</span><span class="op" id="4389278">,</span>&nbsp;<span class="ident" id="4389280">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389291">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389357">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389401">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389436">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389477">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389540">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389555">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389596">default</span><span class="op" id="4389603">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4389607">panic</span><span class="op" id="4389612">(</span><span class="ident" id="4389613">c</span><span class="op" id="4389614">.</span><span class="ident" id="4389615">state</span><span class="op" id="4389620">.</span><span class="ident" id="4389621">String</span><span class="op" id="4389627">(</span><span class="op" id="4389628">)</span><span class="op" id="4389629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4389632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389636">i</span>&nbsp;<span class="op" id="4389638">:=</span>&nbsp;<span class="ident" id="4389641">bytes</span><span class="op" id="4389646">.</span><span class="ident" id="4389647">IndexAny</span><span class="op" id="4389655">(</span><span class="ident" id="4389656">s</span><span class="op" id="4389657">,</span>&nbsp;<span class="ident" id="4389659">lineTerminators</span><span class="op" id="4389674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389677">if</span>&nbsp;<span class="ident" id="4389680">i</span>&nbsp;<span class="op" id="4389682">==</span>&nbsp;<span class="op" id="4389685">-</span><span class="num" id="4389686">1</span>&nbsp;<span class="op" id="4389688">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4389692">return</span>&nbsp;<span class="ident" id="4389699">c</span><span class="op" id="4389700">,</span>&nbsp;<span class="builtinfunc" id="4389702">len</span><span class="op" id="4389705">(</span><span class="ident" id="4389706">s</span><span class="op" id="4389707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4389710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4389713">c</span><span class="op" id="4389714">.</span><span class="ident" id="4389715">state</span>&nbsp;<span class="op" id="4389721">=</span>&nbsp;<span class="ident" id="4389723">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389733">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389799">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389862">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389922">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4389988">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4390052">return</span>&nbsp;<span class="ident" id="4390059">c</span><span class="op" id="4390060">,</span>&nbsp;<span class="ident" id="4390062">i</span><br>
<span class="lineno"></span><span class="op" id="4390064">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4390067">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4390129">func</span>&nbsp;<span class="ident" id="4390134">tCSS</span><span class="op" id="4390138">(</span><span class="ident" id="4390139">c</span>&nbsp;<span class="ident" id="4390141">context</span><span class="op" id="4390148">,</span>&nbsp;<span class="ident" id="4390150">s</span>&nbsp;<span class="op" id="4390152">[</span><span class="op" id="4390153">]</span><span class="builtintype" id="4390154">byte</span><span class="op" id="4390158">)</span>&nbsp;<span class="op" id="4390160">(</span><span class="ident" id="4390161">context</span><span class="op" id="4390168">,</span>&nbsp;<span class="builtintype" id="4390170">int</span><span class="op" id="4390173">)</span>&nbsp;<span class="op" id="4390175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390178">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390235">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390277">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390343">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390405">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390420">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390473">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390519">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390570">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390631">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390647">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390704">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390774">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390778">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390841">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390876">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390880">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4390934">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391003">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391075">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391096">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391164">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391234">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391295">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391366">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391435">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391474">k</span>&nbsp;<span class="op" id="4391476">:=</span>&nbsp;<span class="num" id="4391479">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391482">for</span>&nbsp;<span class="op" id="4391486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391490">i</span>&nbsp;<span class="op" id="4391492">:=</span>&nbsp;<span class="ident" id="4391495">k</span>&nbsp;<span class="op" id="4391497">+</span>&nbsp;<span class="ident" id="4391499">bytes</span><span class="op" id="4391504">.</span><span class="ident" id="4391505">IndexAny</span><span class="op" id="4391513">(</span><span class="ident" id="4391514">s</span><span class="op" id="4391515">[</span><span class="ident" id="4391516">k</span><span class="op" id="4391517">:</span><span class="op" id="4391518">]</span><span class="op" id="4391519">,</span>&nbsp;<span class="string" id="4391521">`(&#34;&#39;/`</span><span class="op" id="4391527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391531">if</span>&nbsp;<span class="ident" id="4391534">i</span>&nbsp;<span class="op" id="4391536">&lt;</span>&nbsp;<span class="ident" id="4391538">k</span>&nbsp;<span class="op" id="4391540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391545">return</span>&nbsp;<span class="ident" id="4391552">c</span><span class="op" id="4391553">,</span>&nbsp;<span class="builtinfunc" id="4391555">len</span><span class="op" id="4391558">(</span><span class="ident" id="4391559">s</span><span class="op" id="4391560">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391568">switch</span>&nbsp;<span class="ident" id="4391575">s</span><span class="op" id="4391576">[</span><span class="ident" id="4391577">i</span><span class="op" id="4391578">]</span>&nbsp;<span class="op" id="4391580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391584">case</span>&nbsp;<span class="string" id="4391589">&#39;(&#39;</span><span class="op" id="4391592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4391597">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391629">p</span>&nbsp;<span class="op" id="4391631">:=</span>&nbsp;<span class="ident" id="4391634">bytes</span><span class="op" id="4391639">.</span><span class="ident" id="4391640">TrimRight</span><span class="op" id="4391649">(</span><span class="ident" id="4391650">s</span><span class="op" id="4391651">[</span><span class="op" id="4391652">:</span><span class="ident" id="4391653">i</span><span class="op" id="4391654">]</span><span class="op" id="4391655">,</span>&nbsp;<span class="string" id="4391657">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4391668">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391673">if</span>&nbsp;<span class="ident" id="4391676">endsWithCSSKeyword</span><span class="op" id="4391694">(</span><span class="ident" id="4391695">p</span><span class="op" id="4391696">,</span>&nbsp;<span class="string" id="4391698">&#34;url&#34;</span><span class="op" id="4391703">)</span>&nbsp;<span class="op" id="4391705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391711">j</span>&nbsp;<span class="op" id="4391713">:=</span>&nbsp;<span class="builtinfunc" id="4391716">len</span><span class="op" id="4391719">(</span><span class="ident" id="4391720">s</span><span class="op" id="4391721">)</span>&nbsp;<span class="op" id="4391723">-</span>&nbsp;<span class="builtinfunc" id="4391725">len</span><span class="op" id="4391728">(</span><span class="ident" id="4391729">bytes</span><span class="op" id="4391734">.</span><span class="ident" id="4391735">TrimLeft</span><span class="op" id="4391743">(</span><span class="ident" id="4391744">s</span><span class="op" id="4391745">[</span><span class="ident" id="4391746">i</span><span class="op" id="4391747">+</span><span class="num" id="4391748">1</span><span class="op" id="4391749">:</span><span class="op" id="4391750">]</span><span class="op" id="4391751">,</span>&nbsp;<span class="string" id="4391753">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4391764">)</span><span class="op" id="4391765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391771">switch</span>&nbsp;<span class="op" id="4391778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391784">case</span>&nbsp;<span class="ident" id="4391789">j</span>&nbsp;<span class="op" id="4391791">!=</span>&nbsp;<span class="builtinfunc" id="4391794">len</span><span class="op" id="4391797">(</span><span class="ident" id="4391798">s</span><span class="op" id="4391799">)</span>&nbsp;<span class="op" id="4391801">&amp;&amp;</span>&nbsp;<span class="ident" id="4391804">s</span><span class="op" id="4391805">[</span><span class="ident" id="4391806">j</span><span class="op" id="4391807">]</span>&nbsp;<span class="op" id="4391809">==</span>&nbsp;<span class="string" id="4391812">&#39;&#34;&#39;</span><span class="op" id="4391815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391822">c</span><span class="op" id="4391823">.</span><span class="ident" id="4391824">state</span><span class="op" id="4391829">,</span>&nbsp;<span class="ident" id="4391831">j</span>&nbsp;<span class="op" id="4391833">=</span>&nbsp;<span class="ident" id="4391835">stateCSSDqURL</span><span class="op" id="4391848">,</span>&nbsp;<span class="ident" id="4391850">j</span><span class="op" id="4391851">+</span><span class="num" id="4391852">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391858">case</span>&nbsp;<span class="ident" id="4391863">j</span>&nbsp;<span class="op" id="4391865">!=</span>&nbsp;<span class="builtinfunc" id="4391868">len</span><span class="op" id="4391871">(</span><span class="ident" id="4391872">s</span><span class="op" id="4391873">)</span>&nbsp;<span class="op" id="4391875">&amp;&amp;</span>&nbsp;<span class="ident" id="4391878">s</span><span class="op" id="4391879">[</span><span class="ident" id="4391880">j</span><span class="op" id="4391881">]</span>&nbsp;<span class="op" id="4391883">==</span>&nbsp;<span class="string" id="4391886">&#39;\&#39;&#39;</span><span class="op" id="4391890">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391897">c</span><span class="op" id="4391898">.</span><span class="ident" id="4391899">state</span><span class="op" id="4391904">,</span>&nbsp;<span class="ident" id="4391906">j</span>&nbsp;<span class="op" id="4391908">=</span>&nbsp;<span class="ident" id="4391910">stateCSSSqURL</span><span class="op" id="4391923">,</span>&nbsp;<span class="ident" id="4391925">j</span><span class="op" id="4391926">+</span><span class="num" id="4391927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391933">default</span><span class="op" id="4391940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4391947">c</span><span class="op" id="4391948">.</span><span class="ident" id="4391949">state</span>&nbsp;<span class="op" id="4391955">=</span>&nbsp;<span class="ident" id="4391957">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391973">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391979">return</span>&nbsp;<span class="ident" id="4391986">c</span><span class="op" id="4391987">,</span>&nbsp;<span class="ident" id="4391989">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4391994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4391998">case</span>&nbsp;<span class="string" id="4392003">&#39;/&#39;</span><span class="op" id="4392006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392011">if</span>&nbsp;<span class="ident" id="4392014">i</span><span class="op" id="4392015">+</span><span class="num" id="4392016">1</span>&nbsp;<span class="op" id="4392018">&lt;</span>&nbsp;<span class="builtinfunc" id="4392020">len</span><span class="op" id="4392023">(</span><span class="ident" id="4392024">s</span><span class="op" id="4392025">)</span>&nbsp;<span class="op" id="4392027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392033">switch</span>&nbsp;<span class="ident" id="4392040">s</span><span class="op" id="4392041">[</span><span class="ident" id="4392042">i</span><span class="op" id="4392043">+</span><span class="num" id="4392044">1</span><span class="op" id="4392045">]</span>&nbsp;<span class="op" id="4392047">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392053">case</span>&nbsp;<span class="string" id="4392058">&#39;/&#39;</span><span class="op" id="4392061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392068">c</span><span class="op" id="4392069">.</span><span class="ident" id="4392070">state</span>&nbsp;<span class="op" id="4392076">=</span>&nbsp;<span class="ident" id="4392078">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392099">return</span>&nbsp;<span class="ident" id="4392106">c</span><span class="op" id="4392107">,</span>&nbsp;<span class="ident" id="4392109">i</span>&nbsp;<span class="op" id="4392111">+</span>&nbsp;<span class="num" id="4392113">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392119">case</span>&nbsp;<span class="string" id="4392124">&#39;*&#39;</span><span class="op" id="4392127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392134">c</span><span class="op" id="4392135">.</span><span class="ident" id="4392136">state</span>&nbsp;<span class="op" id="4392142">=</span>&nbsp;<span class="ident" id="4392144">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392166">return</span>&nbsp;<span class="ident" id="4392173">c</span><span class="op" id="4392174">,</span>&nbsp;<span class="ident" id="4392176">i</span>&nbsp;<span class="op" id="4392178">+</span>&nbsp;<span class="num" id="4392180">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392195">case</span>&nbsp;<span class="string" id="4392200">&#39;&#34;&#39;</span><span class="op" id="4392203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392208">c</span><span class="op" id="4392209">.</span><span class="ident" id="4392210">state</span>&nbsp;<span class="op" id="4392216">=</span>&nbsp;<span class="ident" id="4392218">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392235">return</span>&nbsp;<span class="ident" id="4392242">c</span><span class="op" id="4392243">,</span>&nbsp;<span class="ident" id="4392245">i</span>&nbsp;<span class="op" id="4392247">+</span>&nbsp;<span class="num" id="4392249">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392253">case</span>&nbsp;<span class="string" id="4392258">&#39;\&#39;&#39;</span><span class="op" id="4392262">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392267">c</span><span class="op" id="4392268">.</span><span class="ident" id="4392269">state</span>&nbsp;<span class="op" id="4392275">=</span>&nbsp;<span class="ident" id="4392277">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392294">return</span>&nbsp;<span class="ident" id="4392301">c</span><span class="op" id="4392302">,</span>&nbsp;<span class="ident" id="4392304">i</span>&nbsp;<span class="op" id="4392306">+</span>&nbsp;<span class="num" id="4392308">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392312">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392316">k</span>&nbsp;<span class="op" id="4392318">=</span>&nbsp;<span class="ident" id="4392320">i</span>&nbsp;<span class="op" id="4392322">+</span>&nbsp;<span class="num" id="4392324">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392327">}</span><br>
<span class="lineno"></span><span class="op" id="4392329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4392332">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="4392413">func</span>&nbsp;<span class="ident" id="4392418">tCSSStr</span><span class="op" id="4392425">(</span><span class="ident" id="4392426">c</span>&nbsp;<span class="ident" id="4392428">context</span><span class="op" id="4392435">,</span>&nbsp;<span class="ident" id="4392437">s</span>&nbsp;<span class="op" id="4392439">[</span><span class="op" id="4392440">]</span><span class="builtintype" id="4392441">byte</span><span class="op" id="4392445">)</span>&nbsp;<span class="op" id="4392447">(</span><span class="ident" id="4392448">context</span><span class="op" id="4392455">,</span>&nbsp;<span class="builtintype" id="4392457">int</span><span class="op" id="4392460">)</span>&nbsp;<span class="op" id="4392462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392465">var</span>&nbsp;<span class="ident" id="4392469">endAndEsc</span>&nbsp;<span class="builtintype" id="4392479">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392487">switch</span>&nbsp;<span class="ident" id="4392494">c</span><span class="op" id="4392495">.</span><span class="ident" id="4392496">state</span>&nbsp;<span class="op" id="4392502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392505">case</span>&nbsp;<span class="ident" id="4392510">stateCSSDqStr</span><span class="op" id="4392523">,</span>&nbsp;<span class="ident" id="4392525">stateCSSDqURL</span><span class="op" id="4392538">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392542">endAndEsc</span>&nbsp;<span class="op" id="4392552">=</span>&nbsp;<span class="string" id="4392554">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392560">case</span>&nbsp;<span class="ident" id="4392565">stateCSSSqStr</span><span class="op" id="4392578">,</span>&nbsp;<span class="ident" id="4392580">stateCSSSqURL</span><span class="op" id="4392593">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392597">endAndEsc</span>&nbsp;<span class="op" id="4392607">=</span>&nbsp;<span class="string" id="4392609">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392615">case</span>&nbsp;<span class="ident" id="4392620">stateCSSURL</span><span class="op" id="4392631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392635">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4392695">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392757">endAndEsc</span>&nbsp;<span class="op" id="4392767">=</span>&nbsp;<span class="string" id="4392769">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392785">default</span><span class="op" id="4392792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4392796">panic</span><span class="op" id="4392801">(</span><span class="ident" id="4392802">c</span><span class="op" id="4392803">.</span><span class="ident" id="4392804">state</span><span class="op" id="4392809">.</span><span class="ident" id="4392810">String</span><span class="op" id="4392816">(</span><span class="op" id="4392817">)</span><span class="op" id="4392818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392825">k</span>&nbsp;<span class="op" id="4392827">:=</span>&nbsp;<span class="num" id="4392830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392833">for</span>&nbsp;<span class="op" id="4392837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392841">i</span>&nbsp;<span class="op" id="4392843">:=</span>&nbsp;<span class="ident" id="4392846">k</span>&nbsp;<span class="op" id="4392848">+</span>&nbsp;<span class="ident" id="4392850">bytes</span><span class="op" id="4392855">.</span><span class="ident" id="4392856">IndexAny</span><span class="op" id="4392864">(</span><span class="ident" id="4392865">s</span><span class="op" id="4392866">[</span><span class="ident" id="4392867">k</span><span class="op" id="4392868">:</span><span class="op" id="4392869">]</span><span class="op" id="4392870">,</span>&nbsp;<span class="ident" id="4392872">endAndEsc</span><span class="op" id="4392881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392885">if</span>&nbsp;<span class="ident" id="4392888">i</span>&nbsp;<span class="op" id="4392890">&lt;</span>&nbsp;<span class="ident" id="4392892">k</span>&nbsp;<span class="op" id="4392894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392899">c</span><span class="op" id="4392900">,</span>&nbsp;<span class="ident" id="4392902">nread</span>&nbsp;<span class="op" id="4392908">:=</span>&nbsp;<span class="ident" id="4392911">tURL</span><span class="op" id="4392915">(</span><span class="ident" id="4392916">c</span><span class="op" id="4392917">,</span>&nbsp;<span class="ident" id="4392919">decodeCSS</span><span class="op" id="4392928">(</span><span class="ident" id="4392929">s</span><span class="op" id="4392930">[</span><span class="ident" id="4392931">k</span><span class="op" id="4392932">:</span><span class="op" id="4392933">]</span><span class="op" id="4392934">)</span><span class="op" id="4392935">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392940">return</span>&nbsp;<span class="ident" id="4392947">c</span><span class="op" id="4392948">,</span>&nbsp;<span class="ident" id="4392950">k</span>&nbsp;<span class="op" id="4392952">+</span>&nbsp;<span class="ident" id="4392954">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4392962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392966">if</span>&nbsp;<span class="ident" id="4392969">s</span><span class="op" id="4392970">[</span><span class="ident" id="4392971">i</span><span class="op" id="4392972">]</span>&nbsp;<span class="op" id="4392974">==</span>&nbsp;<span class="string" id="4392977">&#39;\\&#39;</span>&nbsp;<span class="op" id="4392982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4392987">i</span><span class="op" id="4392988">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4392994">if</span>&nbsp;<span class="ident" id="4392997">i</span>&nbsp;<span class="op" id="4392999">==</span>&nbsp;<span class="builtinfunc" id="4393002">len</span><span class="op" id="4393005">(</span><span class="ident" id="4393006">s</span><span class="op" id="4393007">)</span>&nbsp;<span class="op" id="4393009">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393015">return</span>&nbsp;<span class="ident" id="4393022">context</span><span class="op" id="4393029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393036">state</span><span class="op" id="4393041">:</span>&nbsp;<span class="ident" id="4393043">stateError</span><span class="op" id="4393053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393060">err</span><span class="op" id="4393063">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4393067">errorf</span><span class="op" id="4393073">(</span><span class="ident" id="4393074">ErrPartialEscape</span><span class="op" id="4393090">,</span>&nbsp;<span class="builtintype" id="4393092">nil</span><span class="op" id="4393095">,</span>&nbsp;<span class="num" id="4393097">0</span><span class="op" id="4393098">,</span>&nbsp;<span class="string" id="4393100">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4393146">,</span>&nbsp;<span class="ident" id="4393148">s</span><span class="op" id="4393149">)</span><span class="op" id="4393150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393156">}</span><span class="op" id="4393157">,</span>&nbsp;<span class="builtinfunc" id="4393159">len</span><span class="op" id="4393162">(</span><span class="ident" id="4393163">s</span><span class="op" id="4393164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393169">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393173">}</span>&nbsp;<span class="keyword" id="4393175">else</span>&nbsp;<span class="op" id="4393180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393185">c</span><span class="op" id="4393186">.</span><span class="ident" id="4393187">state</span>&nbsp;<span class="op" id="4393193">=</span>&nbsp;<span class="ident" id="4393195">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393207">return</span>&nbsp;<span class="ident" id="4393214">c</span><span class="op" id="4393215">,</span>&nbsp;<span class="ident" id="4393217">i</span>&nbsp;<span class="op" id="4393219">+</span>&nbsp;<span class="num" id="4393221">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393229">c</span><span class="op" id="4393230">,</span>&nbsp;<span class="ident" id="4393232">_</span>&nbsp;<span class="op" id="4393234">=</span>&nbsp;<span class="ident" id="4393236">tURL</span><span class="op" id="4393240">(</span><span class="ident" id="4393241">c</span><span class="op" id="4393242">,</span>&nbsp;<span class="ident" id="4393244">decodeCSS</span><span class="op" id="4393253">(</span><span class="ident" id="4393254">s</span><span class="op" id="4393255">[</span><span class="op" id="4393256">:</span><span class="ident" id="4393257">i</span><span class="op" id="4393258">+</span><span class="num" id="4393259">1</span><span class="op" id="4393260">]</span><span class="op" id="4393261">)</span><span class="op" id="4393262">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4393266">k</span>&nbsp;<span class="op" id="4393268">=</span>&nbsp;<span class="ident" id="4393270">i</span>&nbsp;<span class="op" id="4393272">+</span>&nbsp;<span class="num" id="4393274">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4393277">}</span><br>
<span class="lineno"></span><span class="op" id="4393279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4393282">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="4393348">func</span>&nbsp;<span class="ident" id="4393353">tError</span><span class="op" id="4393359">(</span><span class="ident" id="4393360">c</span>&nbsp;<span class="ident" id="4393362">context</span><span class="op" id="4393369">,</span>&nbsp;<span class="ident" id="4393371">s</span>&nbsp;<span class="op" id="4393373">[</span><span class="op" id="4393374">]</span><span class="builtintype" id="4393375">byte</span><span class="op" id="4393379">)</span>&nbsp;<span class="op" id="4393381">(</span><span class="ident" id="4393382">context</span><span class="op" id="4393389">,</span>&nbsp;<span class="builtintype" id="4393391">int</span><span class="op" id="4393394">)</span>&nbsp;<span class="op" id="4393396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393399">return</span>&nbsp;<span class="ident" id="4393406">c</span><span class="op" id="4393407">,</span>&nbsp;<span class="builtinfunc" id="4393409">len</span><span class="op" id="4393412">(</span><span class="ident" id="4393413">s</span><span class="op" id="4393414">)</span><br>
<span class="lineno"></span><span class="op" id="4393416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4393419">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="4393495">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4393564">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="4393637">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="4393653">func</span>&nbsp;<span class="ident" id="4393658">eatAttrName</span><span class="op" id="4393669">(</span><span class="ident" id="4393670">s</span>&nbsp;<span class="op" id="4393672">[</span><span class="op" id="4393673">]</span><span class="builtintype" id="4393674">byte</span><span class="op" id="4393678">,</span>&nbsp;<span class="ident" id="4393680">i</span>&nbsp;<span class="builtintype" id="4393682">int</span><span class="op" id="4393685">)</span>&nbsp;<span class="op" id="4393687">(</span><span class="builtintype" id="4393688">int</span><span class="op" id="4393691">,</span>&nbsp;<span class="op" id="4393693">*</span><span class="ident" id="4393694">Error</span><span class="op" id="4393699">)</span>&nbsp;<span class="op" id="4393701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393704">for</span>&nbsp;<span class="ident" id="4393708">j</span>&nbsp;<span class="op" id="4393710">:=</span>&nbsp;<span class="ident" id="4393713">i</span><span class="op" id="4393714">;</span>&nbsp;<span class="ident" id="4393716">j</span>&nbsp;<span class="op" id="4393718">&lt;</span>&nbsp;<span class="builtinfunc" id="4393720">len</span><span class="op" id="4393723">(</span><span class="ident" id="4393724">s</span><span class="op" id="4393725">)</span><span class="op" id="4393726">;</span>&nbsp;<span class="ident" id="4393728">j</span><span class="op" id="4393729">++</span>&nbsp;<span class="op" id="4393732">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393736">switch</span>&nbsp;<span class="ident" id="4393743">s</span><span class="op" id="4393744">[</span><span class="ident" id="4393745">j</span><span class="op" id="4393746">]</span>&nbsp;<span class="op" id="4393748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393752">case</span>&nbsp;<span class="string" id="4393757">&#39;&nbsp;&#39;</span><span class="op" id="4393760">,</span>&nbsp;<span class="string" id="4393762">&#39;\t&#39;</span><span class="op" id="4393766">,</span>&nbsp;<span class="string" id="4393768">&#39;\n&#39;</span><span class="op" id="4393772">,</span>&nbsp;<span class="string" id="4393774">&#39;\f&#39;</span><span class="op" id="4393778">,</span>&nbsp;<span class="string" id="4393780">&#39;\r&#39;</span><span class="op" id="4393784">,</span>&nbsp;<span class="string" id="4393786">&#39;=&#39;</span><span class="op" id="4393789">,</span>&nbsp;<span class="string" id="4393791">&#39;&gt;&#39;</span><span class="op" id="4393794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393799">return</span>&nbsp;<span class="ident" id="4393806">j</span><span class="op" id="4393807">,</span>&nbsp;<span class="builtintype" id="4393809">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393815">case</span>&nbsp;<span class="string" id="4393820">&#39;\&#39;&#39;</span><span class="op" id="4393824">,</span>&nbsp;<span class="string" id="4393826">&#39;&#34;&#39;</span><span class="op" id="4393829">,</span>&nbsp;<span class="string" id="4393831">&#39;&lt;&#39;</span><span class="op" id="4393834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4393839">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4393894">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4393950">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4393976">return</span>&nbsp;<span class="op" id="4393983">-</span><span class="num" id="4393984">1</span><span class="op" id="4393985">,</span>&nbsp;<span class="ident" id="4393987">errorf</span><span class="op" id="4393993">(</span><span class="ident" id="4393994">ErrBadHTML</span><span class="op" id="4394004">,</span>&nbsp;<span class="builtintype" id="4394006">nil</span><span class="op" id="4394009">,</span>&nbsp;<span class="num" id="4394011">0</span><span class="op" id="4394012">,</span>&nbsp;<span class="string" id="4394014">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="4394043">,</span>&nbsp;<span class="ident" id="4394045">s</span><span class="op" id="4394046">[</span><span class="ident" id="4394047">j</span><span class="op" id="4394048">:</span><span class="ident" id="4394049">j</span><span class="op" id="4394050">+</span><span class="num" id="4394051">1</span><span class="op" id="4394052">]</span><span class="op" id="4394053">,</span>&nbsp;<span class="ident" id="4394055">s</span><span class="op" id="4394056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394060">default</span><span class="op" id="4394067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394072">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394090">return</span>&nbsp;<span class="builtinfunc" id="4394097">len</span><span class="op" id="4394100">(</span><span class="ident" id="4394101">s</span><span class="op" id="4394102">)</span><span class="op" id="4394103">,</span>&nbsp;<span class="builtintype" id="4394105">nil</span><br>
<span class="lineno"></span><span class="op" id="4394109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4394112">var</span>&nbsp;<span class="ident" id="4394116">elementNameMap</span>&nbsp;<span class="op" id="4394131">=</span>&nbsp;<span class="keyword" id="4394133">map</span><span class="op" id="4394136">[</span><span class="builtintype" id="4394137">string</span><span class="op" id="4394143">]</span><span class="ident" id="4394144">element</span><span class="op" id="4394151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4394154">&#34;script&#34;</span><span class="op" id="4394162">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4394166">elementScript</span><span class="op" id="4394179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4394182">&#34;style&#34;</span><span class="op" id="4394189">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394194">elementStyle</span><span class="op" id="4394206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4394209">&#34;textarea&#34;</span><span class="op" id="4394219">:</span>&nbsp;<span class="ident" id="4394221">elementTextarea</span><span class="op" id="4394236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4394239">&#34;title&#34;</span><span class="op" id="4394246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394251">elementTitle</span><span class="op" id="4394263">,</span><br>
<span class="lineno">505</span><span class="op" id="4394265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394268">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="4394320">func</span>&nbsp;<span class="ident" id="4394325">asciiAlpha</span><span class="op" id="4394335">(</span><span class="ident" id="4394336">c</span>&nbsp;<span class="builtintype" id="4394338">byte</span><span class="op" id="4394342">)</span>&nbsp;<span class="builtintype" id="4394344">bool</span>&nbsp;<span class="op" id="4394349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394352">return</span>&nbsp;<span class="string" id="4394359">&#39;A&#39;</span>&nbsp;<span class="op" id="4394363">&lt;=</span>&nbsp;<span class="ident" id="4394366">c</span>&nbsp;<span class="op" id="4394368">&amp;&amp;</span>&nbsp;<span class="ident" id="4394371">c</span>&nbsp;<span class="op" id="4394373">&lt;=</span>&nbsp;<span class="string" id="4394376">&#39;Z&#39;</span>&nbsp;<span class="op" id="4394380">||</span>&nbsp;<span class="string" id="4394383">&#39;a&#39;</span>&nbsp;<span class="op" id="4394387">&lt;=</span>&nbsp;<span class="ident" id="4394390">c</span>&nbsp;<span class="op" id="4394392">&amp;&amp;</span>&nbsp;<span class="ident" id="4394395">c</span>&nbsp;<span class="op" id="4394397">&lt;=</span>&nbsp;<span class="string" id="4394400">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="4394404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394407">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4394471">func</span>&nbsp;<span class="ident" id="4394476">asciiAlphaNum</span><span class="op" id="4394489">(</span><span class="ident" id="4394490">c</span>&nbsp;<span class="builtintype" id="4394492">byte</span><span class="op" id="4394496">)</span>&nbsp;<span class="builtintype" id="4394498">bool</span>&nbsp;<span class="op" id="4394503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394506">return</span>&nbsp;<span class="ident" id="4394513">asciiAlpha</span><span class="op" id="4394523">(</span><span class="ident" id="4394524">c</span><span class="op" id="4394525">)</span>&nbsp;<span class="op" id="4394527">||</span>&nbsp;<span class="string" id="4394530">&#39;0&#39;</span>&nbsp;<span class="op" id="4394534">&lt;=</span>&nbsp;<span class="ident" id="4394537">c</span>&nbsp;<span class="op" id="4394539">&amp;&amp;</span>&nbsp;<span class="ident" id="4394542">c</span>&nbsp;<span class="op" id="4394544">&lt;=</span>&nbsp;<span class="string" id="4394547">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="4394551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4394554">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4394639">func</span>&nbsp;<span class="ident" id="4394644">eatTagName</span><span class="op" id="4394654">(</span><span class="ident" id="4394655">s</span>&nbsp;<span class="op" id="4394657">[</span><span class="op" id="4394658">]</span><span class="builtintype" id="4394659">byte</span><span class="op" id="4394663">,</span>&nbsp;<span class="ident" id="4394665">i</span>&nbsp;<span class="builtintype" id="4394667">int</span><span class="op" id="4394670">)</span>&nbsp;<span class="op" id="4394672">(</span><span class="builtintype" id="4394673">int</span><span class="op" id="4394676">,</span>&nbsp;<span class="ident" id="4394678">element</span><span class="op" id="4394685">)</span>&nbsp;<span class="op" id="4394687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394690">if</span>&nbsp;<span class="ident" id="4394693">i</span>&nbsp;<span class="op" id="4394695">==</span>&nbsp;<span class="builtinfunc" id="4394698">len</span><span class="op" id="4394701">(</span><span class="ident" id="4394702">s</span><span class="op" id="4394703">)</span>&nbsp;<span class="op" id="4394705">||</span>&nbsp;<span class="op" id="4394708">!</span><span class="ident" id="4394709">asciiAlpha</span><span class="op" id="4394719">(</span><span class="ident" id="4394720">s</span><span class="op" id="4394721">[</span><span class="ident" id="4394722">i</span><span class="op" id="4394723">]</span><span class="op" id="4394724">)</span>&nbsp;<span class="op" id="4394726">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394730">return</span>&nbsp;<span class="ident" id="4394737">i</span><span class="op" id="4394738">,</span>&nbsp;<span class="ident" id="4394740">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394756">j</span>&nbsp;<span class="op" id="4394758">:=</span>&nbsp;<span class="ident" id="4394761">i</span>&nbsp;<span class="op" id="4394763">+</span>&nbsp;<span class="num" id="4394765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394768">for</span>&nbsp;<span class="ident" id="4394772">j</span>&nbsp;<span class="op" id="4394774">&lt;</span>&nbsp;<span class="builtinfunc" id="4394776">len</span><span class="op" id="4394779">(</span><span class="ident" id="4394780">s</span><span class="op" id="4394781">)</span>&nbsp;<span class="op" id="4394783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394787">x</span>&nbsp;<span class="op" id="4394789">:=</span>&nbsp;<span class="ident" id="4394792">s</span><span class="op" id="4394793">[</span><span class="ident" id="4394794">j</span><span class="op" id="4394795">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394799">if</span>&nbsp;<span class="ident" id="4394802">asciiAlphaNum</span><span class="op" id="4394815">(</span><span class="ident" id="4394816">x</span><span class="op" id="4394817">)</span>&nbsp;<span class="op" id="4394819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394824">j</span><span class="op" id="4394825">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394831">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4394846">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394903">if</span>&nbsp;<span class="op" id="4394906">(</span><span class="ident" id="4394907">x</span>&nbsp;<span class="op" id="4394909">==</span>&nbsp;<span class="string" id="4394912">&#39;:&#39;</span>&nbsp;<span class="op" id="4394916">||</span>&nbsp;<span class="ident" id="4394919">x</span>&nbsp;<span class="op" id="4394921">==</span>&nbsp;<span class="string" id="4394924">&#39;-&#39;</span><span class="op" id="4394927">)</span>&nbsp;<span class="op" id="4394929">&amp;&amp;</span>&nbsp;<span class="ident" id="4394932">j</span><span class="op" id="4394933">+</span><span class="num" id="4394934">1</span>&nbsp;<span class="op" id="4394936">&lt;</span>&nbsp;<span class="builtinfunc" id="4394938">len</span><span class="op" id="4394941">(</span><span class="ident" id="4394942">s</span><span class="op" id="4394943">)</span>&nbsp;<span class="op" id="4394945">&amp;&amp;</span>&nbsp;<span class="ident" id="4394948">asciiAlphaNum</span><span class="op" id="4394961">(</span><span class="ident" id="4394962">s</span><span class="op" id="4394963">[</span><span class="ident" id="4394964">j</span><span class="op" id="4394965">+</span><span class="num" id="4394966">1</span><span class="op" id="4394967">]</span><span class="op" id="4394968">)</span>&nbsp;<span class="op" id="4394970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4394975">j</span>&nbsp;<span class="op" id="4394977">+=</span>&nbsp;<span class="num" id="4394980">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4394985">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4394996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395000">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4395007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395010">return</span>&nbsp;<span class="ident" id="4395017">j</span><span class="op" id="4395018">,</span>&nbsp;<span class="ident" id="4395020">elementNameMap</span><span class="op" id="4395034">[</span><span class="ident" id="4395035">strings</span><span class="op" id="4395042">.</span><span class="ident" id="4395043">ToLower</span><span class="op" id="4395050">(</span><span class="builtintype" id="4395051">string</span><span class="op" id="4395057">(</span><span class="ident" id="4395058">s</span><span class="op" id="4395059">[</span><span class="ident" id="4395060">i</span><span class="op" id="4395061">:</span><span class="ident" id="4395062">j</span><span class="op" id="4395063">]</span><span class="op" id="4395064">)</span><span class="op" id="4395065">)</span><span class="op" id="4395066">]</span><br>
<span class="lineno"></span><span class="op" id="4395068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4395071">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="4395143">func</span>&nbsp;<span class="ident" id="4395148">eatWhiteSpace</span><span class="op" id="4395161">(</span><span class="ident" id="4395162">s</span>&nbsp;<span class="op" id="4395164">[</span><span class="op" id="4395165">]</span><span class="builtintype" id="4395166">byte</span><span class="op" id="4395170">,</span>&nbsp;<span class="ident" id="4395172">i</span>&nbsp;<span class="builtintype" id="4395174">int</span><span class="op" id="4395177">)</span>&nbsp;<span class="builtintype" id="4395179">int</span>&nbsp;<span class="op" id="4395183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395186">for</span>&nbsp;<span class="ident" id="4395190">j</span>&nbsp;<span class="op" id="4395192">:=</span>&nbsp;<span class="ident" id="4395195">i</span><span class="op" id="4395196">;</span>&nbsp;<span class="ident" id="4395198">j</span>&nbsp;<span class="op" id="4395200">&lt;</span>&nbsp;<span class="builtinfunc" id="4395202">len</span><span class="op" id="4395205">(</span><span class="ident" id="4395206">s</span><span class="op" id="4395207">)</span><span class="op" id="4395208">;</span>&nbsp;<span class="ident" id="4395210">j</span><span class="op" id="4395211">++</span>&nbsp;<span class="op" id="4395214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395218">switch</span>&nbsp;<span class="ident" id="4395225">s</span><span class="op" id="4395226">[</span><span class="ident" id="4395227">j</span><span class="op" id="4395228">]</span>&nbsp;<span class="op" id="4395230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395234">case</span>&nbsp;<span class="string" id="4395239">&#39;&nbsp;&#39;</span><span class="op" id="4395242">,</span>&nbsp;<span class="string" id="4395244">&#39;\t&#39;</span><span class="op" id="4395248">,</span>&nbsp;<span class="string" id="4395250">&#39;\n&#39;</span><span class="op" id="4395254">,</span>&nbsp;<span class="string" id="4395256">&#39;\f&#39;</span><span class="op" id="4395260">,</span>&nbsp;<span class="string" id="4395262">&#39;\r&#39;</span><span class="op" id="4395266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4395271">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395283">default</span><span class="op" id="4395290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395295">return</span>&nbsp;<span class="ident" id="4395302">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4395306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4395309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4395312">return</span>&nbsp;<span class="builtinfunc" id="4395319">len</span><span class="op" id="4395322">(</span><span class="ident" id="4395323">s</span><span class="op" id="4395324">)</span><br>
<span class="lineno">550</span><span class="op" id="4395326">}</span>
</div>
</body>
</html>
