<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5960882">package</span>&nbsp;<span class="ident" id="5960890">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5960897">//&nbsp;Inst&nbsp;is&nbsp;an&nbsp;interface&nbsp;for&nbsp;executing&nbsp;one&nbsp;single&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="5960958">type</span>&nbsp;<span class="ident" id="5960963">inst</span>&nbsp;<span class="keyword" id="5960968">interface</span>&nbsp;<span class="op" id="5960978">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5960981">I</span><span class="op" id="5960982">(</span><span class="ident" id="5960983">cpu</span>&nbsp;<span class="op" id="5960987">*</span><span class="ident" id="5960988"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5960991">,</span>&nbsp;<span class="ident" id="5960993">in</span>&nbsp;<span class="builtintype" id="5960996">uint32</span><span class="op" id="5961002">)</span>&nbsp;<span class="op" id="5961004">*</span><span class="ident" id="5961005"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span><br>
<span class="lineno"></span><span class="op" id="5961011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961014">//&nbsp;CPU&nbsp;defines&nbsp;the&nbsp;structure&nbsp;of&nbsp;a&nbsp;processing&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5961065">type</span>&nbsp;<span class="ident" id="5961070">cpu</span>&nbsp;<span class="keyword" id="5961074">struct</span>&nbsp;<span class="op" id="5961081">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961084">regs</span>&nbsp;<span class="op" id="5961089">[</span><span class="op" id="5961090">]</span><span class="builtintype" id="5961091">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961099">ring</span>&nbsp;<span class="builtintype" id="5961104">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961111">phyMem</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961121">*</span><span class="ident" id="5961122"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5984438">phyMemory</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961133">virtMem</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5961143">*</span><span class="ident" id="5961144"><a href="/lonnie.io/e8vm/arch8/virt_memory.go.html#5992388">virtMemory</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961156">interrupt</span>&nbsp;<span class="op" id="5961166">*</span><span class="ident" id="5961167"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5972706">interrupt</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961179">inst</span>&nbsp;&nbsp;<span class="ident" id="5961185"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5960963">inst</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961191">index</span>&nbsp;<span class="builtintype" id="5961197">byte</span><br>
<span class="lineno"></span><span class="op" id="5961202">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5961205">//&nbsp;InitPC&nbsp;points&nbsp;the&nbsp;default&nbsp;starting&nbsp;value&nbsp;of&nbsp;the&nbsp;program&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="5961273">const</span>&nbsp;<span class="ident" id="5961279">InitPC</span>&nbsp;<span class="op" id="5961286">=</span>&nbsp;<span class="num" id="5961288">0x8000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961296">//&nbsp;NewCPU&nbsp;creates&nbsp;a&nbsp;CPU&nbsp;with&nbsp;memroy&nbsp;and&nbsp;instruction&nbsp;binding</span><br>
<span class="lineno">25</span><span class="keyword" id="5961356">func</span>&nbsp;<span class="ident" id="5961361">newCPU</span><span class="op" id="5961367">(</span><span class="ident" id="5961368">mem</span>&nbsp;<span class="op" id="5961372">*</span><span class="ident" id="5961373"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5984438">phyMemory</a></span><span class="op" id="5961382">,</span>&nbsp;<span class="ident" id="5961384">i</span>&nbsp;<span class="ident" id="5961386"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5960963">inst</a></span><span class="op" id="5961390">,</span>&nbsp;<span class="ident" id="5961392">index</span>&nbsp;<span class="builtintype" id="5961398">byte</span><span class="op" id="5961402">)</span>&nbsp;<span class="op" id="5961404">*</span><span class="ident" id="5961405"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span>&nbsp;<span class="op" id="5961409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961412">if</span>&nbsp;<span class="ident" id="5961415"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961392">index</a></span>&nbsp;<span class="op" id="5961421">&gt;=</span>&nbsp;<span class="num" id="5961424">32</span>&nbsp;<span class="op" id="5961427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5961431">panic</span><span class="op" id="5961436">(</span><span class="string" id="5961437">&#34;too&nbsp;many&nbsp;cores&#34;</span><span class="op" id="5961453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961460">ret</span>&nbsp;<span class="op" id="5961464">:=</span>&nbsp;<span class="builtinfunc" id="5961467">new</span><span class="op" id="5961470">(</span><span class="ident" id="5961471"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5961474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961477"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961480">.</span><span class="ident" id="5961481">regs</span>&nbsp;<span class="op" id="5961486">=</span>&nbsp;<span class="ident" id="5961488"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986869">makeRegs</a></span><span class="op" id="5961496">(</span><span class="op" id="5961497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961500"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961503">.</span><span class="ident" id="5961504">phyMem</span>&nbsp;<span class="op" id="5961511">=</span>&nbsp;<span class="ident" id="5961513"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961368">mem</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961518"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961521">.</span><span class="ident" id="5961522">virtMem</span>&nbsp;<span class="op" id="5961530">=</span>&nbsp;<span class="ident" id="5961532"><a href="/lonnie.io/e8vm/arch8/virt_memory.go.html#5992527">newVirtMemory</a></span><span class="op" id="5961545">(</span><span class="ident" id="5961546"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961549">.</span><span class="ident" id="5961550">phyMem</span><span class="op" id="5961556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961559"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961562">.</span><span class="ident" id="5961563">index</span>&nbsp;<span class="op" id="5961569">=</span>&nbsp;<span class="ident" id="5961571"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961392">index</a></span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961579">intPage</span>&nbsp;<span class="op" id="5961587">:=</span>&nbsp;<span class="ident" id="5961590"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961593">.</span><span class="ident" id="5961594">phyMem</span><span class="op" id="5961600">.</span><span class="ident" id="5961601">Page</span><span class="op" id="5961605">(</span><span class="ident" id="5961606"><a href="/lonnie.io/e8vm/arch8/phy_memory.go.html#5984526">pageInterrupt</a></span><span class="op" id="5961619">)</span>&nbsp;<span class="comment" id="5961621">//&nbsp;page&nbsp;1&nbsp;is&nbsp;the&nbsp;interrupt&nbsp;page</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961654">if</span>&nbsp;<span class="ident" id="5961657"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961579">intPage</a></span>&nbsp;<span class="op" id="5961665">==</span>&nbsp;<span class="ident" id="5961668">nil</span>&nbsp;<span class="op" id="5961672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5961676">panic</span><span class="op" id="5961681">(</span><span class="string" id="5961682">&#34;memory&nbsp;too&nbsp;small&#34;</span><span class="op" id="5961700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5961703">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961706"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961709">.</span><span class="ident" id="5961710">interrupt</span>&nbsp;<span class="op" id="5961720">=</span>&nbsp;<span class="ident" id="5961722"><a href="/lonnie.io/e8vm/arch8/interrupt.go.html#5973315">newInterrupt</a></span><span class="op" id="5961734">(</span><span class="ident" id="5961735"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961579">intPage</a></span><span class="op" id="5961742">,</span>&nbsp;<span class="ident" id="5961744"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961392">index</a></span><span class="op" id="5961749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961752"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961755">.</span><span class="ident" id="5961756">inst</span>&nbsp;<span class="op" id="5961761">=</span>&nbsp;<span class="ident" id="5961763"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961384">i</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5961767"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><span class="op" id="5961770">.</span><span class="ident" id="5961771">regs</span><span class="op" id="5961775">[</span><span class="ident" id="5961776"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5961778">]</span>&nbsp;<span class="op" id="5961780">=</span>&nbsp;<span class="ident" id="5961782"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961279">InitPC</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961791">return</span>&nbsp;<span class="ident" id="5961798"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961460">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5961802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961805">//&nbsp;UserMode&nbsp;returns&nbsp;trun&nbsp;when&nbsp;the&nbsp;CPU&nbsp;is&nbsp;in&nbsp;user&nbsp;mode.</span><br>
<span class="lineno"></span><span class="keyword" id="5961860">func</span>&nbsp;<span class="op" id="5961865">(</span><span class="ident" id="5961866">c</span>&nbsp;<span class="op" id="5961868">*</span><span class="ident" id="5961869"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5961872">)</span>&nbsp;<span class="ident" id="5961874">UserMode</span><span class="op" id="5961882">(</span><span class="op" id="5961883">)</span>&nbsp;<span class="builtintype" id="5961885">bool</span>&nbsp;<span class="op" id="5961890">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5961893">return</span>&nbsp;<span class="ident" id="5961900"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961866">c</a></span><span class="op" id="5961901">.</span><span class="ident" id="5961902">ring</span>&nbsp;<span class="op" id="5961907">&gt;</span>&nbsp;<span class="num" id="5961909">0</span><br>
<span class="lineno"></span><span class="op" id="5961911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5961914">//&nbsp;Reset&nbsp;resets&nbsp;the&nbsp;CPU&#39;s&nbsp;internal&nbsp;states,&nbsp;i.e.,&nbsp;registers,</span><br>
<span class="lineno"></span><span class="comment" id="5961974">//&nbsp;the&nbsp;page&nbsp;table,&nbsp;and&nbsp;disables&nbsp;interrupt</span><br>
<span class="lineno">55</span><span class="keyword" id="5962016">func</span>&nbsp;<span class="op" id="5962021">(</span><span class="ident" id="5962022">c</span>&nbsp;<span class="op" id="5962024">*</span><span class="ident" id="5962025"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962028">)</span>&nbsp;<span class="ident" id="5962030">Reset</span><span class="op" id="5962035">(</span><span class="op" id="5962036">)</span>&nbsp;<span class="op" id="5962038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962041">for</span>&nbsp;<span class="ident" id="5962045">i</span>&nbsp;<span class="op" id="5962047">:=</span>&nbsp;<span class="num" id="5962050">0</span><span class="op" id="5962051">;</span>&nbsp;<span class="ident" id="5962053"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962045">i</a></span>&nbsp;<span class="op" id="5962055">&lt;</span>&nbsp;<span class="ident" id="5962057"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986757">Nreg</a></span><span class="op" id="5962061">;</span>&nbsp;<span class="ident" id="5962063"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962045">i</a></span><span class="op" id="5962064">++</span>&nbsp;<span class="op" id="5962067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962071"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962022">c</a></span><span class="op" id="5962072">.</span><span class="ident" id="5962073">regs</span><span class="op" id="5962077">[</span><span class="ident" id="5962078"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962045">i</a></span><span class="op" id="5962079">]</span>&nbsp;<span class="op" id="5962081">=</span>&nbsp;<span class="num" id="5962083">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962089"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962022">c</a></span><span class="op" id="5962090">.</span><span class="ident" id="5962091">regs</span><span class="op" id="5962095">[</span><span class="ident" id="5962096"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5962098">]</span>&nbsp;<span class="op" id="5962100">=</span>&nbsp;<span class="ident" id="5962102"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961279">InitPC</a></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962110"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962022">c</a></span><span class="op" id="5962111">.</span><span class="ident" id="5962112">virtMem</span><span class="op" id="5962119">.</span><span class="ident" id="5962120">SetTable</span><span class="op" id="5962128">(</span><span class="num" id="5962129">0</span><span class="op" id="5962130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962133"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962022">c</a></span><span class="op" id="5962134">.</span><span class="ident" id="5962135">ring</span>&nbsp;<span class="op" id="5962140">=</span>&nbsp;<span class="num" id="5962142">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962145"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962022">c</a></span><span class="op" id="5962146">.</span><span class="ident" id="5962147">interrupt</span><span class="op" id="5962156">.</span><span class="ident" id="5962157">Disable</span><span class="op" id="5962164">(</span><span class="op" id="5962165">)</span><br>
<span class="lineno"></span><span class="op" id="5962167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="5962170">func</span>&nbsp;<span class="op" id="5962175">(</span><span class="ident" id="5962176">c</span>&nbsp;<span class="op" id="5962178">*</span><span class="ident" id="5962179"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962182">)</span>&nbsp;<span class="ident" id="5962184">tick</span><span class="op" id="5962188">(</span><span class="op" id="5962189">)</span>&nbsp;<span class="op" id="5962191">*</span><span class="ident" id="5962192"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5962198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962201">pc</span>&nbsp;<span class="op" id="5962204">:=</span>&nbsp;<span class="ident" id="5962207"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962208">.</span><span class="ident" id="5962209">regs</span><span class="op" id="5962213">[</span><span class="ident" id="5962214"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5962216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962219">inst</span><span class="op" id="5962223">,</span>&nbsp;<span class="ident" id="5962225">e</span>&nbsp;<span class="op" id="5962227">:=</span>&nbsp;<span class="ident" id="5962230"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962231">.</span><span class="ident" id="5962232">readWord</span><span class="op" id="5962240">(</span><span class="ident" id="5962241"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962201">pc</a></span><span class="op" id="5962243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962246">if</span>&nbsp;<span class="ident" id="5962249"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962225">e</a></span>&nbsp;<span class="op" id="5962251">!=</span>&nbsp;<span class="ident" id="5962254">nil</span>&nbsp;<span class="op" id="5962258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962262">return</span>&nbsp;<span class="ident" id="5962269"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962225">e</a></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962276"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962277">.</span><span class="ident" id="5962278">regs</span><span class="op" id="5962282">[</span><span class="ident" id="5962283"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5962285">]</span>&nbsp;<span class="op" id="5962287">=</span>&nbsp;<span class="ident" id="5962289"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962201">pc</a></span>&nbsp;<span class="op" id="5962292">+</span>&nbsp;<span class="num" id="5962294">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962297">if</span>&nbsp;<span class="ident" id="5962300"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962301">.</span><span class="ident" id="5962302">inst</span>&nbsp;<span class="op" id="5962307">!=</span>&nbsp;<span class="ident" id="5962310">nil</span>&nbsp;<span class="op" id="5962314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962318"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962225">e</a></span>&nbsp;<span class="op" id="5962320">=</span>&nbsp;<span class="ident" id="5962322"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962323">.</span><span class="ident" id="5962324">inst</span><span class="op" id="5962328">.</span><span class="ident" id="5962329">I</span><span class="op" id="5962330">(</span><span class="ident" id="5962331"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962332">,</span>&nbsp;<span class="ident" id="5962334"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962219">inst</a></span><span class="op" id="5962338">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962343">if</span>&nbsp;<span class="ident" id="5962346"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962225">e</a></span>&nbsp;<span class="op" id="5962348">!=</span>&nbsp;<span class="ident" id="5962351">nil</span>&nbsp;<span class="op" id="5962355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962360"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962176">c</a></span><span class="op" id="5962361">.</span><span class="ident" id="5962362">regs</span><span class="op" id="5962366">[</span><span class="ident" id="5962367"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5962369">]</span>&nbsp;<span class="op" id="5962371">=</span>&nbsp;<span class="ident" id="5962373"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962201">pc</a></span>&nbsp;<span class="comment" id="5962376">//&nbsp;restore&nbsp;saved&nbsp;original&nbsp;PC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962408">return</span>&nbsp;<span class="ident" id="5962415"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962225">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962419">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5962422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962426">return</span>&nbsp;<span class="ident" id="5962433">nil</span><br>
<span class="lineno"></span><span class="op" id="5962437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="5962440">const</span>&nbsp;<span class="op" id="5962446">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962449">intFrameSP</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5962462">=</span>&nbsp;<span class="num" id="5962464">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962467">intFrameRET</span>&nbsp;&nbsp;<span class="op" id="5962480">=</span>&nbsp;<span class="num" id="5962482">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962485">intFrameArg</span>&nbsp;&nbsp;<span class="op" id="5962498">=</span>&nbsp;<span class="num" id="5962500">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962503">intFrameCode</span>&nbsp;<span class="op" id="5962516">=</span>&nbsp;<span class="num" id="5962518">12</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962522">intFrameRing</span>&nbsp;<span class="op" id="5962535">=</span>&nbsp;<span class="num" id="5962537">13</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962542">intFrameSize</span>&nbsp;<span class="op" id="5962555">=</span>&nbsp;<span class="num" id="5962557">16</span><br>
<span class="lineno"></span><span class="op" id="5962560">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5962563">//&nbsp;Interrupt&nbsp;issues&nbsp;an&nbsp;interrupt&nbsp;to&nbsp;the&nbsp;core</span><br>
<span class="lineno"></span><span class="keyword" id="5962608">func</span>&nbsp;<span class="op" id="5962613">(</span><span class="ident" id="5962614">c</span>&nbsp;<span class="op" id="5962616">*</span><span class="ident" id="5962617"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962620">)</span>&nbsp;<span class="ident" id="5962622">Interrupt</span><span class="op" id="5962631">(</span><span class="ident" id="5962632">code</span>&nbsp;<span class="builtintype" id="5962637">byte</span><span class="op" id="5962641">)</span>&nbsp;<span class="op" id="5962643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5962646"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962614">c</a></span><span class="op" id="5962647">.</span><span class="ident" id="5962648">interrupt</span><span class="op" id="5962657">.</span><span class="ident" id="5962658">Issue</span><span class="op" id="5962663">(</span><span class="ident" id="5962664"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962632">code</a></span><span class="op" id="5962668">)</span><br>
<span class="lineno"></span><span class="op" id="5962670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5962673">func</span>&nbsp;<span class="op" id="5962678">(</span><span class="ident" id="5962679">c</span>&nbsp;<span class="op" id="5962681">*</span><span class="ident" id="5962682"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962685">)</span>&nbsp;<span class="ident" id="5962687">readWord</span><span class="op" id="5962695">(</span><span class="ident" id="5962696">addr</span>&nbsp;<span class="builtintype" id="5962701">uint32</span><span class="op" id="5962707">)</span>&nbsp;<span class="op" id="5962709">(</span><span class="builtintype" id="5962710">uint32</span><span class="op" id="5962716">,</span>&nbsp;<span class="op" id="5962718">*</span><span class="ident" id="5962719"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span><span class="op" id="5962724">)</span>&nbsp;<span class="op" id="5962726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962729">return</span>&nbsp;<span class="ident" id="5962736"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962679">c</a></span><span class="op" id="5962737">.</span><span class="ident" id="5962738">virtMem</span><span class="op" id="5962745">.</span><span class="ident" id="5962746">ReadWord</span><span class="op" id="5962754">(</span><span class="ident" id="5962755"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962696">addr</a></span><span class="op" id="5962759">,</span>&nbsp;<span class="ident" id="5962761"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962679">c</a></span><span class="op" id="5962762">.</span><span class="ident" id="5962763">ring</span><span class="op" id="5962767">)</span><br>
<span class="lineno"></span><span class="op" id="5962769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5962772">func</span>&nbsp;<span class="op" id="5962777">(</span><span class="ident" id="5962778">c</span>&nbsp;<span class="op" id="5962780">*</span><span class="ident" id="5962781"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962784">)</span>&nbsp;<span class="ident" id="5962786">readByte</span><span class="op" id="5962794">(</span><span class="ident" id="5962795">addr</span>&nbsp;<span class="builtintype" id="5962800">uint32</span><span class="op" id="5962806">)</span>&nbsp;<span class="op" id="5962808">(</span><span class="builtintype" id="5962809">uint8</span><span class="op" id="5962814">,</span>&nbsp;<span class="op" id="5962816">*</span><span class="ident" id="5962817"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span><span class="op" id="5962822">)</span>&nbsp;<span class="op" id="5962824">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962827">return</span>&nbsp;<span class="ident" id="5962834"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962778">c</a></span><span class="op" id="5962835">.</span><span class="ident" id="5962836">virtMem</span><span class="op" id="5962843">.</span><span class="ident" id="5962844">ReadByte</span><span class="op" id="5962852">(</span><span class="ident" id="5962853"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962795">addr</a></span><span class="op" id="5962857">,</span>&nbsp;<span class="ident" id="5962859"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962778">c</a></span><span class="op" id="5962860">.</span><span class="ident" id="5962861">ring</span><span class="op" id="5962865">)</span><br>
<span class="lineno"></span><span class="op" id="5962867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5962870">func</span>&nbsp;<span class="op" id="5962875">(</span><span class="ident" id="5962876">c</span>&nbsp;<span class="op" id="5962878">*</span><span class="ident" id="5962879"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962882">)</span>&nbsp;<span class="ident" id="5962884">writeWord</span><span class="op" id="5962893">(</span><span class="ident" id="5962894">addr</span>&nbsp;<span class="builtintype" id="5962899">uint32</span><span class="op" id="5962905">,</span>&nbsp;<span class="ident" id="5962907">v</span>&nbsp;<span class="builtintype" id="5962909">uint32</span><span class="op" id="5962915">)</span>&nbsp;<span class="op" id="5962917">*</span><span class="ident" id="5962918"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5962924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5962927">return</span>&nbsp;<span class="ident" id="5962934"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962876">c</a></span><span class="op" id="5962935">.</span><span class="ident" id="5962936">virtMem</span><span class="op" id="5962943">.</span><span class="ident" id="5962944">WriteWord</span><span class="op" id="5962953">(</span><span class="ident" id="5962954"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962894">addr</a></span><span class="op" id="5962958">,</span>&nbsp;<span class="ident" id="5962960"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962876">c</a></span><span class="op" id="5962961">.</span><span class="ident" id="5962962">ring</span><span class="op" id="5962966">,</span>&nbsp;<span class="ident" id="5962968"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962907">v</a></span><span class="op" id="5962969">)</span><br>
<span class="lineno">110</span><span class="op" id="5962971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5962974">func</span>&nbsp;<span class="op" id="5962979">(</span><span class="ident" id="5962980">c</span>&nbsp;<span class="op" id="5962982">*</span><span class="ident" id="5962983"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5962986">)</span>&nbsp;<span class="ident" id="5962988">writeByte</span><span class="op" id="5962997">(</span><span class="ident" id="5962998">addr</span>&nbsp;<span class="builtintype" id="5963003">uint32</span><span class="op" id="5963009">,</span>&nbsp;<span class="ident" id="5963011">v</span>&nbsp;<span class="builtintype" id="5963013">uint8</span><span class="op" id="5963018">)</span>&nbsp;<span class="op" id="5963020">*</span><span class="ident" id="5963021"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5963027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963030">return</span>&nbsp;<span class="ident" id="5963037"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962980">c</a></span><span class="op" id="5963038">.</span><span class="ident" id="5963039">virtMem</span><span class="op" id="5963046">.</span><span class="ident" id="5963047">WriteByte</span><span class="op" id="5963056">(</span><span class="ident" id="5963057"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962998">addr</a></span><span class="op" id="5963061">,</span>&nbsp;<span class="ident" id="5963063"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962980">c</a></span><span class="op" id="5963064">.</span><span class="ident" id="5963065">ring</span><span class="op" id="5963069">,</span>&nbsp;<span class="ident" id="5963071"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963011">v</a></span><span class="op" id="5963072">)</span><br>
<span class="lineno"></span><span class="op" id="5963074">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="5963077">//&nbsp;Ienter&nbsp;enters&nbsp;a&nbsp;interrupt&nbsp;routine.</span><br>
<span class="lineno"></span><span class="keyword" id="5963115">func</span>&nbsp;<span class="op" id="5963120">(</span><span class="ident" id="5963121">c</span>&nbsp;<span class="op" id="5963123">*</span><span class="ident" id="5963124"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5963127">)</span>&nbsp;<span class="ident" id="5963129">Ienter</span><span class="op" id="5963135">(</span><span class="ident" id="5963136">code</span>&nbsp;<span class="builtintype" id="5963141">byte</span><span class="op" id="5963145">,</span>&nbsp;<span class="ident" id="5963147">arg</span>&nbsp;<span class="builtintype" id="5963151">uint32</span><span class="op" id="5963157">)</span>&nbsp;<span class="op" id="5963159">*</span><span class="ident" id="5963160"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5963166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963169">ksp</span>&nbsp;<span class="op" id="5963173">:=</span>&nbsp;<span class="ident" id="5963176"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963177">.</span><span class="ident" id="5963178">interrupt</span><span class="op" id="5963187">.</span><span class="ident" id="5963188">kernelSP</span><span class="op" id="5963196">(</span><span class="op" id="5963197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963200">base</span>&nbsp;<span class="op" id="5963205">:=</span>&nbsp;<span class="ident" id="5963208"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963169">ksp</a></span>&nbsp;<span class="op" id="5963212">-</span>&nbsp;<span class="ident" id="5963214"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962542">intFrameSize</a></span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963229">writeWord</span>&nbsp;<span class="op" id="5963239">:=</span>&nbsp;<span class="keyword" id="5963242">func</span><span class="op" id="5963246">(</span><span class="ident" id="5963247">off</span>&nbsp;<span class="builtintype" id="5963251">uint32</span><span class="op" id="5963257">,</span>&nbsp;<span class="ident" id="5963259">v</span>&nbsp;<span class="builtintype" id="5963261">uint32</span><span class="op" id="5963267">)</span>&nbsp;<span class="op" id="5963269">*</span><span class="ident" id="5963270"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5963276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963280">return</span>&nbsp;<span class="ident" id="5963287"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963288">.</span><span class="ident" id="5963289">virtMem</span><span class="op" id="5963296">.</span><span class="ident" id="5963297">WriteWord</span><span class="op" id="5963306">(</span><span class="ident" id="5963307"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963200">base</a></span><span class="op" id="5963311">+</span><span class="ident" id="5963312"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963247">off</a></span><span class="op" id="5963315">,</span>&nbsp;<span class="num" id="5963317">0</span><span class="op" id="5963318">,</span>&nbsp;<span class="ident" id="5963320"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963259">v</a></span><span class="op" id="5963321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963327">writeByte</span>&nbsp;<span class="op" id="5963337">:=</span>&nbsp;<span class="keyword" id="5963340">func</span><span class="op" id="5963344">(</span><span class="ident" id="5963345">off</span>&nbsp;<span class="builtintype" id="5963349">uint32</span><span class="op" id="5963355">,</span>&nbsp;<span class="ident" id="5963357">b</span>&nbsp;<span class="builtintype" id="5963359">uint8</span><span class="op" id="5963364">)</span>&nbsp;<span class="op" id="5963366">*</span><span class="ident" id="5963367"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5963373">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963377">return</span>&nbsp;<span class="ident" id="5963384"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963385">.</span><span class="ident" id="5963386">virtMem</span><span class="op" id="5963393">.</span><span class="ident" id="5963394">WriteByte</span><span class="op" id="5963403">(</span><span class="ident" id="5963404"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963200">base</a></span><span class="op" id="5963408">+</span><span class="ident" id="5963409"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963345">off</a></span><span class="op" id="5963412">,</span>&nbsp;<span class="num" id="5963414">0</span><span class="op" id="5963415">,</span>&nbsp;<span class="ident" id="5963417"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963357">b</a></span><span class="op" id="5963418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963424">if</span>&nbsp;<span class="ident" id="5963427">e</span>&nbsp;<span class="op" id="5963429">:=</span>&nbsp;<span class="ident" id="5963432"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963229">writeWord</a></span><span class="op" id="5963441">(</span><span class="ident" id="5963442"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962449">intFrameSP</a></span><span class="op" id="5963452">,</span>&nbsp;<span class="ident" id="5963454"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963455">.</span><span class="ident" id="5963456">regs</span><span class="op" id="5963460">[</span><span class="ident" id="5963461"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986835">SP</a></span><span class="op" id="5963463">]</span><span class="op" id="5963464">)</span><span class="op" id="5963465">;</span>&nbsp;<span class="ident" id="5963467"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963427">e</a></span>&nbsp;<span class="op" id="5963469">!=</span>&nbsp;<span class="ident" id="5963472">nil</span>&nbsp;<span class="op" id="5963476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963480">return</span>&nbsp;<span class="ident" id="5963487"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963427">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963490">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963493">if</span>&nbsp;<span class="ident" id="5963496">e</span>&nbsp;<span class="op" id="5963498">:=</span>&nbsp;<span class="ident" id="5963501"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963229">writeWord</a></span><span class="op" id="5963510">(</span><span class="ident" id="5963511"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962467">intFrameRET</a></span><span class="op" id="5963522">,</span>&nbsp;<span class="ident" id="5963524"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963525">.</span><span class="ident" id="5963526">regs</span><span class="op" id="5963530">[</span><span class="ident" id="5963531"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986844">RET</a></span><span class="op" id="5963534">]</span><span class="op" id="5963535">)</span><span class="op" id="5963536">;</span>&nbsp;<span class="ident" id="5963538"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963496">e</a></span>&nbsp;<span class="op" id="5963540">!=</span>&nbsp;<span class="ident" id="5963543">nil</span>&nbsp;<span class="op" id="5963547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963551">return</span>&nbsp;<span class="ident" id="5963558"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963496">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963564">if</span>&nbsp;<span class="ident" id="5963567">e</span>&nbsp;<span class="op" id="5963569">:=</span>&nbsp;<span class="ident" id="5963572"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963229">writeWord</a></span><span class="op" id="5963581">(</span><span class="ident" id="5963582"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962485">intFrameArg</a></span><span class="op" id="5963593">,</span>&nbsp;<span class="ident" id="5963595"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963147">arg</a></span><span class="op" id="5963598">)</span><span class="op" id="5963599">;</span>&nbsp;<span class="ident" id="5963601"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963567">e</a></span>&nbsp;<span class="op" id="5963603">!=</span>&nbsp;<span class="ident" id="5963606">nil</span>&nbsp;<span class="op" id="5963610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963614">return</span>&nbsp;<span class="ident" id="5963621"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963567">e</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963627">if</span>&nbsp;<span class="ident" id="5963630">e</span>&nbsp;<span class="op" id="5963632">:=</span>&nbsp;<span class="ident" id="5963635"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963327">writeByte</a></span><span class="op" id="5963644">(</span><span class="ident" id="5963645"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962503">intFrameCode</a></span><span class="op" id="5963657">,</span>&nbsp;<span class="ident" id="5963659"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963136">code</a></span><span class="op" id="5963663">)</span><span class="op" id="5963664">;</span>&nbsp;<span class="ident" id="5963666"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963630">e</a></span>&nbsp;<span class="op" id="5963668">!=</span>&nbsp;<span class="ident" id="5963671">nil</span>&nbsp;<span class="op" id="5963675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963679">return</span>&nbsp;<span class="ident" id="5963686"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963630">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963692">if</span>&nbsp;<span class="ident" id="5963695">e</span>&nbsp;<span class="op" id="5963697">:=</span>&nbsp;<span class="ident" id="5963700"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963327">writeByte</a></span><span class="op" id="5963709">(</span><span class="ident" id="5963710"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962522">intFrameRing</a></span><span class="op" id="5963722">,</span>&nbsp;<span class="ident" id="5963724"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963725">.</span><span class="ident" id="5963726">ring</span><span class="op" id="5963730">)</span><span class="op" id="5963731">;</span>&nbsp;<span class="ident" id="5963733"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963695">e</a></span>&nbsp;<span class="op" id="5963735">!=</span>&nbsp;<span class="ident" id="5963738">nil</span>&nbsp;<span class="op" id="5963742">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963746">return</span>&nbsp;<span class="ident" id="5963753"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963695">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5963756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963760"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963761">.</span><span class="ident" id="5963762">interrupt</span><span class="op" id="5963771">.</span><span class="ident" id="5963772">Disable</span><span class="op" id="5963779">(</span><span class="op" id="5963780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963783"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963784">.</span><span class="ident" id="5963785">regs</span><span class="op" id="5963789">[</span><span class="ident" id="5963790"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986835">SP</a></span><span class="op" id="5963792">]</span>&nbsp;<span class="op" id="5963794">=</span>&nbsp;<span class="ident" id="5963796"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963169">ksp</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963801"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963802">.</span><span class="ident" id="5963803">regs</span><span class="op" id="5963807">[</span><span class="ident" id="5963808"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986844">RET</a></span><span class="op" id="5963811">]</span>&nbsp;<span class="op" id="5963813">=</span>&nbsp;<span class="ident" id="5963815"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963816">.</span><span class="ident" id="5963817">regs</span><span class="op" id="5963821">[</span><span class="ident" id="5963822"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5963824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963827"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963828">.</span><span class="ident" id="5963829">regs</span><span class="op" id="5963833">[</span><span class="ident" id="5963834"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5963836">]</span>&nbsp;<span class="op" id="5963838">=</span>&nbsp;<span class="ident" id="5963840"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963841">.</span><span class="ident" id="5963842">interrupt</span><span class="op" id="5963851">.</span><span class="ident" id="5963852">handlerPC</span><span class="op" id="5963861">(</span><span class="op" id="5963862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963865"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963121">c</a></span><span class="op" id="5963866">.</span><span class="ident" id="5963867">ring</span>&nbsp;<span class="op" id="5963872">=</span>&nbsp;<span class="num" id="5963874">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5963878">return</span>&nbsp;<span class="ident" id="5963885">nil</span><br>
<span class="lineno">150</span><span class="op" id="5963889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5963892">//&nbsp;Syscall&nbsp;jumps&nbsp;to&nbsp;the&nbsp;system&nbsp;call&nbsp;handler&nbsp;and&nbsp;switches&nbsp;to&nbsp;ring&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="5963960">func</span>&nbsp;<span class="op" id="5963965">(</span><span class="ident" id="5963966">c</span>&nbsp;<span class="op" id="5963968">*</span><span class="ident" id="5963969"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5963972">)</span>&nbsp;<span class="ident" id="5963974">Syscall</span><span class="op" id="5963981">(</span><span class="op" id="5963982">)</span>&nbsp;<span class="op" id="5963984">*</span><span class="ident" id="5963985"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5963991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5963994"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963966">c</a></span><span class="op" id="5963995">.</span><span class="ident" id="5963996">regs</span><span class="op" id="5964000">[</span><span class="ident" id="5964001"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5964003">]</span>&nbsp;<span class="op" id="5964005">=</span>&nbsp;<span class="ident" id="5964007"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963966">c</a></span><span class="op" id="5964008">.</span><span class="ident" id="5964009">interrupt</span><span class="op" id="5964018">.</span><span class="ident" id="5964019">syscallPC</span><span class="op" id="5964028">(</span><span class="op" id="5964029">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964032"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5963966">c</a></span><span class="op" id="5964033">.</span><span class="ident" id="5964034">ring</span>&nbsp;<span class="op" id="5964039">=</span>&nbsp;<span class="num" id="5964041">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964044">return</span>&nbsp;<span class="ident" id="5964051">nil</span><br>
<span class="lineno"></span><span class="op" id="5964055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5964058">//&nbsp;Iret&nbsp;restores&nbsp;from&nbsp;an&nbsp;interrupt.</span><br>
<span class="lineno">160</span><span class="comment" id="5964094">//&nbsp;It&nbsp;restores&nbsp;the&nbsp;SP,&nbsp;RET,&nbsp;PC&nbsp;registers,&nbsp;restores&nbsp;the&nbsp;ring&nbsp;level,</span><br>
<span class="lineno"></span><span class="comment" id="5964161">//&nbsp;clears&nbsp;the&nbsp;served&nbsp;interrupt&nbsp;bit&nbsp;and&nbsp;enables&nbsp;interrupt&nbsp;again.</span><br>
<span class="lineno"></span><span class="keyword" id="5964225">func</span>&nbsp;<span class="op" id="5964230">(</span><span class="ident" id="5964231">c</span>&nbsp;<span class="op" id="5964233">*</span><span class="ident" id="5964234"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5964237">)</span>&nbsp;<span class="ident" id="5964239">Iret</span><span class="op" id="5964243">(</span><span class="op" id="5964244">)</span>&nbsp;<span class="op" id="5964246">*</span><span class="ident" id="5964247"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5964253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964256">if</span>&nbsp;<span class="ident" id="5964259"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964260">.</span><span class="ident" id="5964261">ring</span>&nbsp;<span class="op" id="5964266">!=</span>&nbsp;<span class="num" id="5964269">0</span>&nbsp;<span class="op" id="5964271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5964275">panic</span><span class="op" id="5964280">(</span><span class="string" id="5964281">&#34;iret&nbsp;in&nbsp;userland&#34;</span><span class="op" id="5964299">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964306">ksp</span>&nbsp;<span class="op" id="5964310">:=</span>&nbsp;<span class="ident" id="5964313"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964314">.</span><span class="ident" id="5964315">interrupt</span><span class="op" id="5964324">.</span><span class="ident" id="5964325">kernelSP</span><span class="op" id="5964333">(</span><span class="op" id="5964334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964337">base</span>&nbsp;<span class="op" id="5964342">:=</span>&nbsp;<span class="ident" id="5964345"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964306">ksp</a></span>&nbsp;<span class="op" id="5964349">-</span>&nbsp;<span class="ident" id="5964351"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962542">intFrameSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964365">sp</span><span class="op" id="5964367">,</span>&nbsp;<span class="ident" id="5964369">e</span>&nbsp;<span class="op" id="5964371">:=</span>&nbsp;<span class="ident" id="5964374"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964375">.</span><span class="ident" id="5964376">readWord</span><span class="op" id="5964384">(</span><span class="ident" id="5964385"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964337">base</a></span>&nbsp;<span class="op" id="5964390">+</span>&nbsp;<span class="ident" id="5964392"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962449">intFrameSP</a></span><span class="op" id="5964402">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964405">if</span>&nbsp;<span class="ident" id="5964408"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964410">!=</span>&nbsp;<span class="ident" id="5964413">nil</span>&nbsp;<span class="op" id="5964417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964421">return</span>&nbsp;<span class="ident" id="5964428"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964434">ret</span><span class="op" id="5964437">,</span>&nbsp;<span class="ident" id="5964439"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964441">:=</span>&nbsp;<span class="ident" id="5964444"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964445">.</span><span class="ident" id="5964446">readWord</span><span class="op" id="5964454">(</span><span class="ident" id="5964455"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964337">base</a></span>&nbsp;<span class="op" id="5964460">+</span>&nbsp;<span class="ident" id="5964462"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962467">intFrameRET</a></span><span class="op" id="5964473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964476">if</span>&nbsp;<span class="ident" id="5964479"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964481">!=</span>&nbsp;<span class="ident" id="5964484">nil</span>&nbsp;<span class="op" id="5964488">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964492">return</span>&nbsp;<span class="ident" id="5964499"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964505">code</span><span class="op" id="5964509">,</span>&nbsp;<span class="ident" id="5964511"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964513">:=</span>&nbsp;<span class="ident" id="5964516"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964517">.</span><span class="ident" id="5964518">readByte</span><span class="op" id="5964526">(</span><span class="ident" id="5964527"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964337">base</a></span>&nbsp;<span class="op" id="5964532">+</span>&nbsp;<span class="ident" id="5964534"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962503">intFrameCode</a></span><span class="op" id="5964546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964549">if</span>&nbsp;<span class="ident" id="5964552"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964554">!=</span>&nbsp;<span class="ident" id="5964557">nil</span>&nbsp;<span class="op" id="5964561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964565">return</span>&nbsp;<span class="ident" id="5964572"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964578">ring</span><span class="op" id="5964582">,</span>&nbsp;<span class="ident" id="5964584"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964586">:=</span>&nbsp;<span class="ident" id="5964589"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964590">.</span><span class="ident" id="5964591">readByte</span><span class="op" id="5964599">(</span><span class="ident" id="5964600"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964337">base</a></span>&nbsp;<span class="op" id="5964605">+</span>&nbsp;<span class="ident" id="5964607"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5962522">intFrameRing</a></span><span class="op" id="5964619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964622">if</span>&nbsp;<span class="ident" id="5964625"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span>&nbsp;<span class="op" id="5964627">!=</span>&nbsp;<span class="ident" id="5964630">nil</span>&nbsp;<span class="op" id="5964634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964638">return</span>&nbsp;<span class="ident" id="5964645"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964369">e</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5964648">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964652"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964653">.</span><span class="ident" id="5964654">regs</span><span class="op" id="5964658">[</span><span class="ident" id="5964659"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986853">PC</a></span><span class="op" id="5964661">]</span>&nbsp;<span class="op" id="5964663">=</span>&nbsp;<span class="ident" id="5964665"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964666">.</span><span class="ident" id="5964667">regs</span><span class="op" id="5964671">[</span><span class="ident" id="5964672"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986844">RET</a></span><span class="op" id="5964675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964678"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964679">.</span><span class="ident" id="5964680">regs</span><span class="op" id="5964684">[</span><span class="ident" id="5964685"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986844">RET</a></span><span class="op" id="5964688">]</span>&nbsp;<span class="op" id="5964690">=</span>&nbsp;<span class="ident" id="5964692"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964434">ret</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964697"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964698">.</span><span class="ident" id="5964699">regs</span><span class="op" id="5964703">[</span><span class="ident" id="5964704"><a href="/lonnie.io/e8vm/arch8/regs.go.html#5986835">SP</a></span><span class="op" id="5964706">]</span>&nbsp;<span class="op" id="5964708">=</span>&nbsp;<span class="ident" id="5964710"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964365">sp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964714"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964715">.</span><span class="ident" id="5964716">ring</span>&nbsp;<span class="op" id="5964721">=</span>&nbsp;<span class="ident" id="5964723"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964578">ring</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964729"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964730">.</span><span class="ident" id="5964731">interrupt</span><span class="op" id="5964740">.</span><span class="ident" id="5964741">Clear</span><span class="op" id="5964746">(</span><span class="ident" id="5964747"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964505">code</a></span><span class="op" id="5964751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964754"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964231">c</a></span><span class="op" id="5964755">.</span><span class="ident" id="5964756">interrupt</span><span class="op" id="5964765">.</span><span class="ident" id="5964766">Enable</span><span class="op" id="5964772">(</span><span class="op" id="5964773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964777">return</span>&nbsp;<span class="ident" id="5964784">nil</span><br>
<span class="lineno"></span><span class="op" id="5964788">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5964791">//&nbsp;Tick&nbsp;executes&nbsp;one&nbsp;instruction,&nbsp;and&nbsp;increases&nbsp;the&nbsp;program&nbsp;counter</span><br>
<span class="lineno"></span><span class="comment" id="5964859">//&nbsp;by&nbsp;4&nbsp;by&nbsp;default.&nbsp;If&nbsp;an&nbsp;exception&nbsp;is&nbsp;met,&nbsp;it&nbsp;will&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5964922">func</span>&nbsp;<span class="op" id="5964927">(</span><span class="ident" id="5964928">c</span>&nbsp;<span class="op" id="5964930">*</span><span class="ident" id="5964931"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5961070">cpu</a></span><span class="op" id="5964934">)</span>&nbsp;<span class="ident" id="5964936">Tick</span><span class="op" id="5964940">(</span><span class="op" id="5964941">)</span>&nbsp;<span class="op" id="5964943">*</span><span class="ident" id="5964944"><a href="/lonnie.io/e8vm/arch8/exception.go.html#5965541">Excep</a></span>&nbsp;<span class="op" id="5964950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5964953">poll</span><span class="op" id="5964957">,</span>&nbsp;<span class="ident" id="5964959">code</span>&nbsp;<span class="op" id="5964964">:=</span>&nbsp;<span class="ident" id="5964967"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5964968">.</span><span class="ident" id="5964969">interrupt</span><span class="op" id="5964978">.</span><span class="ident" id="5964979">Poll</span><span class="op" id="5964983">(</span><span class="op" id="5964984">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964987">if</span>&nbsp;<span class="ident" id="5964990"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964953">poll</a></span>&nbsp;<span class="op" id="5964995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5964999">return</span>&nbsp;<span class="ident" id="5965006"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5965007">.</span><span class="ident" id="5965008">Ienter</span><span class="op" id="5965014">(</span><span class="ident" id="5965015"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964959">code</a></span><span class="op" id="5965019">,</span>&nbsp;<span class="num" id="5965021">0</span><span class="op" id="5965022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965029">//&nbsp;no&nbsp;interrupt&nbsp;to&nbsp;dispatch,&nbsp;let&#39;s&nbsp;proceed</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965073">e</span>&nbsp;<span class="op" id="5965075">:=</span>&nbsp;<span class="ident" id="5965078"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5965079">.</span><span class="ident" id="5965080">tick</span><span class="op" id="5965084">(</span><span class="op" id="5965085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965088">if</span>&nbsp;<span class="ident" id="5965091"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965073">e</a></span>&nbsp;<span class="op" id="5965093">!=</span>&nbsp;<span class="ident" id="5965096">nil</span>&nbsp;<span class="op" id="5965100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5965104">//&nbsp;proceed&nbsp;attempt&nbsp;failed,&nbsp;handle&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965150"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5965151">.</span><span class="ident" id="5965152">interrupt</span><span class="op" id="5965161">.</span><span class="ident" id="5965162">Issue</span><span class="op" id="5965167">(</span><span class="ident" id="5965168"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965073">e</a></span><span class="op" id="5965169">.</span><span class="ident" id="5965170">Code</span><span class="op" id="5965174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965178">poll</span><span class="op" id="5965182">,</span>&nbsp;<span class="ident" id="5965184">code</span>&nbsp;<span class="op" id="5965189">:=</span>&nbsp;<span class="ident" id="5965192"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5965193">.</span><span class="ident" id="5965194">interrupt</span><span class="op" id="5965203">.</span><span class="ident" id="5965204">Poll</span><span class="op" id="5965208">(</span><span class="op" id="5965209">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965213">if</span>&nbsp;<span class="ident" id="5965216"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965178">poll</a></span>&nbsp;<span class="op" id="5965221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965226">if</span>&nbsp;<span class="ident" id="5965229"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965184">code</a></span>&nbsp;<span class="op" id="5965234">!=</span>&nbsp;<span class="ident" id="5965237"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965073">e</a></span><span class="op" id="5965238">.</span><span class="ident" id="5965239">Code</span>&nbsp;<span class="op" id="5965244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5965250">panic</span><span class="op" id="5965255">(</span><span class="string" id="5965256">&#34;interrupt&nbsp;code&nbsp;is&nbsp;different&#34;</span><span class="op" id="5965285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965295">return</span>&nbsp;<span class="ident" id="5965302"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5964928">c</a></span><span class="op" id="5965303">.</span><span class="ident" id="5965304">Ienter</span><span class="op" id="5965310">(</span><span class="ident" id="5965311"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965184">code</a></span><span class="op" id="5965315">,</span>&nbsp;<span class="ident" id="5965317"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965073">e</a></span><span class="op" id="5965318">.</span><span class="ident" id="5965319">Arg</span><span class="op" id="5965322">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965333">return</span>&nbsp;<span class="ident" id="5965340"><a href="/lonnie.io/e8vm/arch8/cpu.go.html#5965073">e</a></span><br>
<span class="lineno"></span><span class="op" id="5965342">}</span>
</div>
</body>
</html>
