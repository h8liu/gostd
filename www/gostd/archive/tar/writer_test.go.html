<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6990574">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6990629">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6990683">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6990734">package</span>&nbsp;<span class="ident" id="6990742">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6990747">import</span>&nbsp;<span class="op" id="6990754">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990757">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990766">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990773">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990779">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990792">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990798">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990809">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990820">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990831">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6990849">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6990856">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6990859">type</span>&nbsp;<span class="ident" id="6990864">writerTestEntry</span>&nbsp;<span class="keyword" id="6990880">struct</span>&nbsp;<span class="op" id="6990887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990890">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6990899">*</span><span class="ident" id="6990900">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990908">contents</span>&nbsp;<span class="builtintype" id="6990917">string</span><br>
<span class="lineno"></span><span class="op" id="6990924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6990927">type</span>&nbsp;<span class="ident" id="6990932">writerTest</span>&nbsp;<span class="keyword" id="6990943">struct</span>&nbsp;<span class="op" id="6990950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6990953">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6990961">string</span>&nbsp;<span class="comment" id="6990968">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991000">entries</span>&nbsp;<span class="op" id="6991008">[</span><span class="op" id="6991009">]</span><span class="op" id="6991010">*</span><span class="ident" id="6991011">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="6991027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6991030">var</span>&nbsp;<span class="ident" id="6991034">writerTests</span>&nbsp;<span class="op" id="6991046">=</span>&nbsp;<span class="op" id="6991048">[</span><span class="op" id="6991049">]</span><span class="op" id="6991050">*</span><span class="ident" id="6991051">writerTest</span><span class="op" id="6991061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6991064">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6991121">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6991144">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6991175">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991256">file</span><span class="op" id="6991260">:</span>&nbsp;<span class="string" id="6991262">&#34;testdata/writer.tar&#34;</span><span class="op" id="6991283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991287">entries</span><span class="op" id="6991294">:</span>&nbsp;<span class="op" id="6991296">[</span><span class="op" id="6991297">]</span><span class="op" id="6991298">*</span><span class="ident" id="6991299">writerTestEntry</span><span class="op" id="6991314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991325">header</span><span class="op" id="6991331">:</span>&nbsp;<span class="op" id="6991333">&amp;</span><span class="ident" id="6991334">Header</span><span class="op" id="6991340">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991347">Name</span><span class="op" id="6991351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991357">&#34;small.txt&#34;</span><span class="op" id="6991368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991375">Mode</span><span class="op" id="6991379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991385">0640</span><span class="op" id="6991389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991396">Uid</span><span class="op" id="6991399">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991406">73025</span><span class="op" id="6991411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991418">Gid</span><span class="op" id="6991421">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991428">5000</span><span class="op" id="6991432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991439">Size</span><span class="op" id="6991443">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991449">5</span><span class="op" id="6991450">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991457">ModTime</span><span class="op" id="6991464">:</span>&nbsp;&nbsp;<span class="ident" id="6991467">time</span><span class="op" id="6991471">.</span><span class="ident" id="6991472">Unix</span><span class="op" id="6991476">(</span><span class="num" id="6991477">1246508266</span><span class="op" id="6991487">,</span>&nbsp;<span class="num" id="6991489">0</span><span class="op" id="6991490">)</span><span class="op" id="6991491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991498">Typeflag</span><span class="op" id="6991506">:</span>&nbsp;<span class="string" id="6991508">&#39;0&#39;</span><span class="op" id="6991511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991518">Uname</span><span class="op" id="6991523">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991528">&#34;dsymonds&#34;</span><span class="op" id="6991538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991545">Gname</span><span class="op" id="6991550">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991555">&#34;eng&#34;</span><span class="op" id="6991560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991566">}</span><span class="op" id="6991567">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991573">contents</span><span class="op" id="6991581">:</span>&nbsp;<span class="string" id="6991583">&#34;Kilts&#34;</span><span class="op" id="6991590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991595">}</span><span class="op" id="6991596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991607">header</span><span class="op" id="6991613">:</span>&nbsp;<span class="op" id="6991615">&amp;</span><span class="ident" id="6991616">Header</span><span class="op" id="6991622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991629">Name</span><span class="op" id="6991633">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991639">&#34;small2.txt&#34;</span><span class="op" id="6991651">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991658">Mode</span><span class="op" id="6991662">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991668">0640</span><span class="op" id="6991672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991679">Uid</span><span class="op" id="6991682">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991689">73025</span><span class="op" id="6991694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991701">Gid</span><span class="op" id="6991704">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991711">5000</span><span class="op" id="6991715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991722">Size</span><span class="op" id="6991726">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991732">11</span><span class="op" id="6991734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991741">ModTime</span><span class="op" id="6991748">:</span>&nbsp;&nbsp;<span class="ident" id="6991751">time</span><span class="op" id="6991755">.</span><span class="ident" id="6991756">Unix</span><span class="op" id="6991760">(</span><span class="num" id="6991761">1245217492</span><span class="op" id="6991771">,</span>&nbsp;<span class="num" id="6991773">0</span><span class="op" id="6991774">)</span><span class="op" id="6991775">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991782">Typeflag</span><span class="op" id="6991790">:</span>&nbsp;<span class="string" id="6991792">&#39;0&#39;</span><span class="op" id="6991795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991802">Uname</span><span class="op" id="6991807">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991812">&#34;dsymonds&#34;</span><span class="op" id="6991822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991829">Gname</span><span class="op" id="6991834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991839">&#34;eng&#34;</span><span class="op" id="6991844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991850">}</span><span class="op" id="6991851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991857">contents</span><span class="op" id="6991865">:</span>&nbsp;<span class="string" id="6991867">&#34;Google.com\n&#34;</span><span class="op" id="6991881">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991886">}</span><span class="op" id="6991887">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6991892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991898">header</span><span class="op" id="6991904">:</span>&nbsp;<span class="op" id="6991906">&amp;</span><span class="ident" id="6991907">Header</span><span class="op" id="6991913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991920">Name</span><span class="op" id="6991924">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6991930">&#34;link.txt&#34;</span><span class="op" id="6991940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991947">Mode</span><span class="op" id="6991951">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991957">0777</span><span class="op" id="6991961">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991968">Uid</span><span class="op" id="6991971">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991978">1000</span><span class="op" id="6991982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6991989">Gid</span><span class="op" id="6991992">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6991999">1000</span><span class="op" id="6992003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992010">Size</span><span class="op" id="6992014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6992020">0</span><span class="op" id="6992021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992028">ModTime</span><span class="op" id="6992035">:</span>&nbsp;&nbsp;<span class="ident" id="6992038">time</span><span class="op" id="6992042">.</span><span class="ident" id="6992043">Unix</span><span class="op" id="6992047">(</span><span class="num" id="6992048">1314603082</span><span class="op" id="6992058">,</span>&nbsp;<span class="num" id="6992060">0</span><span class="op" id="6992061">)</span><span class="op" id="6992062">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992069">Typeflag</span><span class="op" id="6992077">:</span>&nbsp;<span class="string" id="6992079">&#39;2&#39;</span><span class="op" id="6992082">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992089">Linkname</span><span class="op" id="6992097">:</span>&nbsp;<span class="string" id="6992099">&#34;small.txt&#34;</span><span class="op" id="6992110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992117">Uname</span><span class="op" id="6992122">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6992127">&#34;strings&#34;</span><span class="op" id="6992136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992143">Gname</span><span class="op" id="6992148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6992153">&#34;strings&#34;</span><span class="op" id="6992162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992168">}</span><span class="op" id="6992169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992175">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992193">}</span><span class="op" id="6992194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992198">}</span><span class="op" id="6992199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992202">}</span><span class="op" id="6992203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992206">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992269">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992331">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992409">file</span><span class="op" id="6992413">:</span>&nbsp;<span class="string" id="6992415">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6992440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992444">entries</span><span class="op" id="6992451">:</span>&nbsp;<span class="op" id="6992453">[</span><span class="op" id="6992454">]</span><span class="op" id="6992455">*</span><span class="ident" id="6992456">writerTestEntry</span><span class="op" id="6992471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992476">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992482">header</span><span class="op" id="6992488">:</span>&nbsp;<span class="op" id="6992490">&amp;</span><span class="ident" id="6992491">Header</span><span class="op" id="6992497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992504">Name</span><span class="op" id="6992508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6992514">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6992529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992536">Mode</span><span class="op" id="6992540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6992546">0640</span><span class="op" id="6992550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992557">Uid</span><span class="op" id="6992560">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6992567">73025</span><span class="op" id="6992572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992579">Gid</span><span class="op" id="6992582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6992589">5000</span><span class="op" id="6992593">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992600">Size</span><span class="op" id="6992604">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6992610">16</span>&nbsp;<span class="op" id="6992613">&lt;&lt;</span>&nbsp;<span class="num" id="6992616">30</span><span class="op" id="6992618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992625">ModTime</span><span class="op" id="6992632">:</span>&nbsp;&nbsp;<span class="ident" id="6992635">time</span><span class="op" id="6992639">.</span><span class="ident" id="6992640">Unix</span><span class="op" id="6992644">(</span><span class="num" id="6992645">1254699560</span><span class="op" id="6992655">,</span>&nbsp;<span class="num" id="6992657">0</span><span class="op" id="6992658">)</span><span class="op" id="6992659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992666">Typeflag</span><span class="op" id="6992674">:</span>&nbsp;<span class="string" id="6992676">&#39;0&#39;</span><span class="op" id="6992679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992686">Uname</span><span class="op" id="6992691">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6992696">&#34;dsymonds&#34;</span><span class="op" id="6992706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992713">Gname</span><span class="op" id="6992718">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6992723">&#34;eng&#34;</span><span class="op" id="6992728">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992734">}</span><span class="op" id="6992735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992741">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6992762">contents</span><span class="op" id="6992770">:</span>&nbsp;<span class="ident" id="6992772">strings</span><span class="op" id="6992779">.</span><span class="ident" id="6992780">Repeat</span><span class="op" id="6992786">(</span><span class="string" id="6992787">&#34;\x00&#34;</span><span class="op" id="6992793">,</span>&nbsp;<span class="num" id="6992795">4</span><span class="op" id="6992796">&lt;&lt;</span><span class="num" id="6992798">10</span><span class="op" id="6992800">)</span><span class="op" id="6992801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992806">}</span><span class="op" id="6992807">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992811">}</span><span class="op" id="6992812">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6992815">}</span><span class="op" id="6992816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992819">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992882">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6992955">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993045">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993049">file</span><span class="op" id="6993053">:</span>&nbsp;<span class="string" id="6993055">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6993085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993089">entries</span><span class="op" id="6993096">:</span>&nbsp;<span class="op" id="6993098">[</span><span class="op" id="6993099">]</span><span class="op" id="6993100">*</span><span class="ident" id="6993101">writerTestEntry</span><span class="op" id="6993116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993127">header</span><span class="op" id="6993133">:</span>&nbsp;<span class="op" id="6993135">&amp;</span><span class="ident" id="6993136">Header</span><span class="op" id="6993142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993149">Name</span><span class="op" id="6993153">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993159">strings</span><span class="op" id="6993166">.</span><span class="ident" id="6993167">Repeat</span><span class="op" id="6993173">(</span><span class="string" id="6993174">&#34;longname/&#34;</span><span class="op" id="6993185">,</span>&nbsp;<span class="num" id="6993187">15</span><span class="op" id="6993189">)</span>&nbsp;<span class="op" id="6993191">+</span>&nbsp;<span class="string" id="6993193">&#34;16gig.txt&#34;</span><span class="op" id="6993204">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993211">Mode</span><span class="op" id="6993215">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993221">0644</span><span class="op" id="6993225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993232">Uid</span><span class="op" id="6993235">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993242">1000</span><span class="op" id="6993246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993253">Gid</span><span class="op" id="6993256">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993263">1000</span><span class="op" id="6993267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993274">Size</span><span class="op" id="6993278">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993284">16</span>&nbsp;<span class="op" id="6993287">&lt;&lt;</span>&nbsp;<span class="num" id="6993290">30</span><span class="op" id="6993292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993299">ModTime</span><span class="op" id="6993306">:</span>&nbsp;&nbsp;<span class="ident" id="6993309">time</span><span class="op" id="6993313">.</span><span class="ident" id="6993314">Unix</span><span class="op" id="6993318">(</span><span class="num" id="6993319">1399583047</span><span class="op" id="6993329">,</span>&nbsp;<span class="num" id="6993331">0</span><span class="op" id="6993332">)</span><span class="op" id="6993333">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993340">Typeflag</span><span class="op" id="6993348">:</span>&nbsp;<span class="string" id="6993350">&#39;0&#39;</span><span class="op" id="6993353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993360">Uname</span><span class="op" id="6993365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993370">&#34;guillaume&#34;</span><span class="op" id="6993381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993388">Gname</span><span class="op" id="6993393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993398">&#34;guillaume&#34;</span><span class="op" id="6993409">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993415">}</span><span class="op" id="6993416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6993422">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993443">contents</span><span class="op" id="6993451">:</span>&nbsp;<span class="ident" id="6993453">strings</span><span class="op" id="6993460">.</span><span class="ident" id="6993461">Repeat</span><span class="op" id="6993467">(</span><span class="string" id="6993468">&#34;\x00&#34;</span><span class="op" id="6993474">,</span>&nbsp;<span class="num" id="6993476">4</span><span class="op" id="6993477">&lt;&lt;</span><span class="num" id="6993479">10</span><span class="op" id="6993481">)</span><span class="op" id="6993482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993487">}</span><span class="op" id="6993488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993492">}</span><span class="op" id="6993493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993496">}</span><span class="op" id="6993497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6993500">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6993546">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993608">file</span><span class="op" id="6993612">:</span>&nbsp;<span class="string" id="6993614">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6993634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993638">entries</span><span class="op" id="6993645">:</span>&nbsp;<span class="op" id="6993647">[</span><span class="op" id="6993648">]</span><span class="op" id="6993649">*</span><span class="ident" id="6993650">writerTestEntry</span><span class="op" id="6993665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993670">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993676">header</span><span class="op" id="6993682">:</span>&nbsp;<span class="op" id="6993684">&amp;</span><span class="ident" id="6993685">Header</span><span class="op" id="6993691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993698">Name</span><span class="op" id="6993702">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993708">strings</span><span class="op" id="6993715">.</span><span class="ident" id="6993716">Repeat</span><span class="op" id="6993722">(</span><span class="string" id="6993723">&#34;longname/&#34;</span><span class="op" id="6993734">,</span>&nbsp;<span class="num" id="6993736">15</span><span class="op" id="6993738">)</span>&nbsp;<span class="op" id="6993740">+</span>&nbsp;<span class="string" id="6993742">&#34;file.txt&#34;</span><span class="op" id="6993752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993759">Mode</span><span class="op" id="6993763">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993769">0644</span><span class="op" id="6993773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993780">Uid</span><span class="op" id="6993783">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993790">0765</span><span class="op" id="6993794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993801">Gid</span><span class="op" id="6993804">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993811">024</span><span class="op" id="6993814">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993821">Size</span><span class="op" id="6993825">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6993831">06</span><span class="op" id="6993833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993840">ModTime</span><span class="op" id="6993847">:</span>&nbsp;&nbsp;<span class="ident" id="6993850">time</span><span class="op" id="6993854">.</span><span class="ident" id="6993855">Unix</span><span class="op" id="6993859">(</span><span class="num" id="6993860">1360135598</span><span class="op" id="6993870">,</span>&nbsp;<span class="num" id="6993872">0</span><span class="op" id="6993873">)</span><span class="op" id="6993874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993881">Typeflag</span><span class="op" id="6993889">:</span>&nbsp;<span class="string" id="6993891">&#39;0&#39;</span><span class="op" id="6993894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993901">Uname</span><span class="op" id="6993906">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993911">&#34;shane&#34;</span><span class="op" id="6993918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993925">Gname</span><span class="op" id="6993930">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6993935">&#34;staff&#34;</span><span class="op" id="6993942">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993948">}</span><span class="op" id="6993949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6993955">contents</span><span class="op" id="6993963">:</span>&nbsp;<span class="string" id="6993965">&#34;hello\n&#34;</span><span class="op" id="6993974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993979">}</span><span class="op" id="6993980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993984">}</span><span class="op" id="6993985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6993988">}</span><span class="op" id="6993989">,</span><br>
<span class="lineno">150</span><span class="op" id="6993991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6993994">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6994089">func</span>&nbsp;<span class="ident" id="6994094">bytestr</span><span class="op" id="6994101">(</span><span class="ident" id="6994102">offset</span>&nbsp;<span class="builtintype" id="6994109">int</span><span class="op" id="6994112">,</span>&nbsp;<span class="ident" id="6994114">b</span>&nbsp;<span class="op" id="6994116">[</span><span class="op" id="6994117">]</span><span class="builtintype" id="6994118">byte</span><span class="op" id="6994122">)</span>&nbsp;<span class="builtintype" id="6994124">string</span>&nbsp;<span class="op" id="6994131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994134">const</span>&nbsp;<span class="ident" id="6994140">rowLen</span>&nbsp;<span class="op" id="6994147">=</span>&nbsp;<span class="num" id="6994149">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994153">s</span>&nbsp;<span class="op" id="6994155">:=</span>&nbsp;<span class="ident" id="6994158">fmt</span><span class="op" id="6994161">.</span><span class="ident" id="6994162">Sprintf</span><span class="op" id="6994169">(</span><span class="string" id="6994170">&#34;%04x&nbsp;&#34;</span><span class="op" id="6994177">,</span>&nbsp;<span class="ident" id="6994179">offset</span><span class="op" id="6994185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994188">for</span>&nbsp;<span class="ident" id="6994192">_</span><span class="op" id="6994193">,</span>&nbsp;<span class="ident" id="6994195">ch</span>&nbsp;<span class="op" id="6994198">:=</span>&nbsp;<span class="keyword" id="6994201">range</span>&nbsp;<span class="ident" id="6994207">b</span>&nbsp;<span class="op" id="6994209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994213">switch</span>&nbsp;<span class="op" id="6994220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994224">case</span>&nbsp;<span class="string" id="6994229">&#39;0&#39;</span>&nbsp;<span class="op" id="6994233">&lt;=</span>&nbsp;<span class="ident" id="6994236">ch</span>&nbsp;<span class="op" id="6994239">&amp;&amp;</span>&nbsp;<span class="ident" id="6994242">ch</span>&nbsp;<span class="op" id="6994245">&lt;=</span>&nbsp;<span class="string" id="6994248">&#39;9&#39;</span><span class="op" id="6994251">,</span>&nbsp;<span class="string" id="6994253">&#39;A&#39;</span>&nbsp;<span class="op" id="6994257">&lt;=</span>&nbsp;<span class="ident" id="6994260">ch</span>&nbsp;<span class="op" id="6994263">&amp;&amp;</span>&nbsp;<span class="ident" id="6994266">ch</span>&nbsp;<span class="op" id="6994269">&lt;=</span>&nbsp;<span class="string" id="6994272">&#39;Z&#39;</span><span class="op" id="6994275">,</span>&nbsp;<span class="string" id="6994277">&#39;a&#39;</span>&nbsp;<span class="op" id="6994281">&lt;=</span>&nbsp;<span class="ident" id="6994284">ch</span>&nbsp;<span class="op" id="6994287">&amp;&amp;</span>&nbsp;<span class="ident" id="6994290">ch</span>&nbsp;<span class="op" id="6994293">&lt;=</span>&nbsp;<span class="string" id="6994296">&#39;z&#39;</span><span class="op" id="6994299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994304">s</span>&nbsp;<span class="op" id="6994306">+=</span>&nbsp;<span class="ident" id="6994309">fmt</span><span class="op" id="6994312">.</span><span class="ident" id="6994313">Sprintf</span><span class="op" id="6994320">(</span><span class="string" id="6994321">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6994327">,</span>&nbsp;<span class="ident" id="6994329">ch</span><span class="op" id="6994331">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994335">default</span><span class="op" id="6994342">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994347">s</span>&nbsp;<span class="op" id="6994349">+=</span>&nbsp;<span class="ident" id="6994352">fmt</span><span class="op" id="6994355">.</span><span class="ident" id="6994356">Sprintf</span><span class="op" id="6994363">(</span><span class="string" id="6994364">&#34;&nbsp;%02x&#34;</span><span class="op" id="6994371">,</span>&nbsp;<span class="ident" id="6994373">ch</span><span class="op" id="6994375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994385">return</span>&nbsp;<span class="ident" id="6994392">s</span><br>
<span class="lineno">165</span><span class="op" id="6994394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6994397">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6994450">func</span>&nbsp;<span class="ident" id="6994455">bytediff</span><span class="op" id="6994463">(</span><span class="ident" id="6994464">a</span>&nbsp;<span class="op" id="6994466">[</span><span class="op" id="6994467">]</span><span class="builtintype" id="6994468">byte</span><span class="op" id="6994472">,</span>&nbsp;<span class="ident" id="6994474">b</span>&nbsp;<span class="op" id="6994476">[</span><span class="op" id="6994477">]</span><span class="builtintype" id="6994478">byte</span><span class="op" id="6994482">)</span>&nbsp;<span class="builtintype" id="6994484">string</span>&nbsp;<span class="op" id="6994491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994494">const</span>&nbsp;<span class="ident" id="6994500">rowLen</span>&nbsp;<span class="op" id="6994507">=</span>&nbsp;<span class="num" id="6994509">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994513">s</span>&nbsp;<span class="op" id="6994515">:=</span>&nbsp;<span class="ident" id="6994518">fmt</span><span class="op" id="6994521">.</span><span class="ident" id="6994522">Sprintf</span><span class="op" id="6994529">(</span><span class="string" id="6994530">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6994557">,</span>&nbsp;<span class="builtinfunc" id="6994559">len</span><span class="op" id="6994562">(</span><span class="ident" id="6994563">a</span><span class="op" id="6994564">)</span><span class="op" id="6994565">,</span>&nbsp;<span class="builtinfunc" id="6994567">len</span><span class="op" id="6994570">(</span><span class="ident" id="6994571">b</span><span class="op" id="6994572">)</span><span class="op" id="6994573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994576">for</span>&nbsp;<span class="ident" id="6994580">offset</span>&nbsp;<span class="op" id="6994587">:=</span>&nbsp;<span class="num" id="6994590">0</span><span class="op" id="6994591">;</span>&nbsp;<span class="builtinfunc" id="6994593">len</span><span class="op" id="6994596">(</span><span class="ident" id="6994597">a</span><span class="op" id="6994598">)</span><span class="op" id="6994599">+</span><span class="builtinfunc" id="6994600">len</span><span class="op" id="6994603">(</span><span class="ident" id="6994604">b</span><span class="op" id="6994605">)</span>&nbsp;<span class="op" id="6994607">&gt;</span>&nbsp;<span class="num" id="6994609">0</span><span class="op" id="6994610">;</span>&nbsp;<span class="ident" id="6994612">offset</span>&nbsp;<span class="op" id="6994619">+=</span>&nbsp;<span class="ident" id="6994622">rowLen</span>&nbsp;<span class="op" id="6994629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994633">na</span><span class="op" id="6994635">,</span>&nbsp;<span class="ident" id="6994637">nb</span>&nbsp;<span class="op" id="6994640">:=</span>&nbsp;<span class="ident" id="6994643">rowLen</span><span class="op" id="6994649">,</span>&nbsp;<span class="ident" id="6994651">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994660">if</span>&nbsp;<span class="ident" id="6994663">na</span>&nbsp;<span class="op" id="6994666">&gt;</span>&nbsp;<span class="builtinfunc" id="6994668">len</span><span class="op" id="6994671">(</span><span class="ident" id="6994672">a</span><span class="op" id="6994673">)</span>&nbsp;<span class="op" id="6994675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994680">na</span>&nbsp;<span class="op" id="6994683">=</span>&nbsp;<span class="builtinfunc" id="6994685">len</span><span class="op" id="6994688">(</span><span class="ident" id="6994689">a</span><span class="op" id="6994690">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994698">if</span>&nbsp;<span class="ident" id="6994701">nb</span>&nbsp;<span class="op" id="6994704">&gt;</span>&nbsp;<span class="builtinfunc" id="6994706">len</span><span class="op" id="6994709">(</span><span class="ident" id="6994710">b</span><span class="op" id="6994711">)</span>&nbsp;<span class="op" id="6994713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994718">nb</span>&nbsp;<span class="op" id="6994721">=</span>&nbsp;<span class="builtinfunc" id="6994723">len</span><span class="op" id="6994726">(</span><span class="ident" id="6994727">b</span><span class="op" id="6994728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994736">sa</span>&nbsp;<span class="op" id="6994739">:=</span>&nbsp;<span class="ident" id="6994742">bytestr</span><span class="op" id="6994749">(</span><span class="ident" id="6994750">offset</span><span class="op" id="6994756">,</span>&nbsp;<span class="ident" id="6994758">a</span><span class="op" id="6994759">[</span><span class="num" id="6994760">0</span><span class="op" id="6994761">:</span><span class="ident" id="6994762">na</span><span class="op" id="6994764">]</span><span class="op" id="6994765">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994769">sb</span>&nbsp;<span class="op" id="6994772">:=</span>&nbsp;<span class="ident" id="6994775">bytestr</span><span class="op" id="6994782">(</span><span class="ident" id="6994783">offset</span><span class="op" id="6994789">,</span>&nbsp;<span class="ident" id="6994791">b</span><span class="op" id="6994792">[</span><span class="num" id="6994793">0</span><span class="op" id="6994794">:</span><span class="ident" id="6994795">nb</span><span class="op" id="6994797">]</span><span class="op" id="6994798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994802">if</span>&nbsp;<span class="ident" id="6994805">sa</span>&nbsp;<span class="op" id="6994808">!=</span>&nbsp;<span class="ident" id="6994811">sb</span>&nbsp;<span class="op" id="6994814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994819">s</span>&nbsp;<span class="op" id="6994821">+=</span>&nbsp;<span class="ident" id="6994824">fmt</span><span class="op" id="6994827">.</span><span class="ident" id="6994828">Sprintf</span><span class="op" id="6994835">(</span><span class="string" id="6994836">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6994848">,</span>&nbsp;<span class="ident" id="6994850">sa</span><span class="op" id="6994852">,</span>&nbsp;<span class="ident" id="6994854">sb</span><span class="op" id="6994856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994864">a</span>&nbsp;<span class="op" id="6994866">=</span>&nbsp;<span class="ident" id="6994868">a</span><span class="op" id="6994869">[</span><span class="ident" id="6994870">na</span><span class="op" id="6994872">:</span><span class="op" id="6994873">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994877">b</span>&nbsp;<span class="op" id="6994879">=</span>&nbsp;<span class="ident" id="6994881">b</span><span class="op" id="6994882">[</span><span class="ident" id="6994883">nb</span><span class="op" id="6994885">:</span><span class="op" id="6994886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6994889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994892">return</span>&nbsp;<span class="ident" id="6994899">s</span><br>
<span class="lineno"></span><span class="op" id="6994901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6994904">func</span>&nbsp;<span class="ident" id="6994909">TestWriter</span><span class="op" id="6994919">(</span><span class="ident" id="6994920">t</span>&nbsp;<span class="op" id="6994922">*</span><span class="ident" id="6994923">testing</span><span class="op" id="6994930">.</span><span class="ident" id="6994931">T</span><span class="op" id="6994932">)</span>&nbsp;<span class="op" id="6994934">{</span><br>
<span class="lineno"></span><span class="ident" id="6994936">testLoop</span><span class="op" id="6994944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6994947">for</span>&nbsp;<span class="ident" id="6994951">i</span><span class="op" id="6994952">,</span>&nbsp;<span class="ident" id="6994954">test</span>&nbsp;<span class="op" id="6994959">:=</span>&nbsp;<span class="keyword" id="6994962">range</span>&nbsp;<span class="ident" id="6994968">writerTests</span>&nbsp;<span class="op" id="6994980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6994984">expected</span><span class="op" id="6994992">,</span>&nbsp;<span class="ident" id="6994994">err</span>&nbsp;<span class="op" id="6994998">:=</span>&nbsp;<span class="ident" id="6995001">ioutil</span><span class="op" id="6995007">.</span><span class="ident" id="6995008">ReadFile</span><span class="op" id="6995016">(</span><span class="ident" id="6995017">test</span><span class="op" id="6995021">.</span><span class="ident" id="6995022">file</span><span class="op" id="6995026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995030">if</span>&nbsp;<span class="ident" id="6995033">err</span>&nbsp;<span class="op" id="6995037">!=</span>&nbsp;<span class="builtintype" id="6995040">nil</span>&nbsp;<span class="op" id="6995044">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995049">t</span><span class="op" id="6995050">.</span><span class="ident" id="6995051">Errorf</span><span class="op" id="6995057">(</span><span class="string" id="6995058">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6995089">,</span>&nbsp;<span class="ident" id="6995091">i</span><span class="op" id="6995092">,</span>&nbsp;<span class="ident" id="6995094">err</span><span class="op" id="6995097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995102">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6995113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995118">buf</span>&nbsp;<span class="op" id="6995122">:=</span>&nbsp;<span class="builtinfunc" id="6995125">new</span><span class="op" id="6995128">(</span><span class="ident" id="6995129">bytes</span><span class="op" id="6995134">.</span><span class="ident" id="6995135">Buffer</span><span class="op" id="6995141">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995145">tw</span>&nbsp;<span class="op" id="6995148">:=</span>&nbsp;<span class="ident" id="6995151">NewWriter</span><span class="op" id="6995160">(</span><span class="ident" id="6995161">iotest</span><span class="op" id="6995167">.</span><span class="ident" id="6995168">TruncateWriter</span><span class="op" id="6995182">(</span><span class="ident" id="6995183">buf</span><span class="op" id="6995186">,</span>&nbsp;<span class="num" id="6995188">4</span><span class="op" id="6995189">&lt;&lt;</span><span class="num" id="6995191">10</span><span class="op" id="6995193">)</span><span class="op" id="6995194">)</span>&nbsp;<span class="comment" id="6995196">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995227">big</span>&nbsp;<span class="op" id="6995231">:=</span>&nbsp;<span class="builtintype" id="6995234">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995242">for</span>&nbsp;<span class="ident" id="6995246">j</span><span class="op" id="6995247">,</span>&nbsp;<span class="ident" id="6995249">entry</span>&nbsp;<span class="op" id="6995255">:=</span>&nbsp;<span class="keyword" id="6995258">range</span>&nbsp;<span class="ident" id="6995264">test</span><span class="op" id="6995268">.</span><span class="ident" id="6995269">entries</span>&nbsp;<span class="op" id="6995277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995282">big</span>&nbsp;<span class="op" id="6995286">=</span>&nbsp;<span class="ident" id="6995288">big</span>&nbsp;<span class="op" id="6995292">||</span>&nbsp;<span class="ident" id="6995295">entry</span><span class="op" id="6995300">.</span><span class="ident" id="6995301">header</span><span class="op" id="6995307">.</span><span class="ident" id="6995308">Size</span>&nbsp;<span class="op" id="6995313">&gt;</span>&nbsp;<span class="num" id="6995315">1</span><span class="op" id="6995316">&lt;&lt;</span><span class="num" id="6995318">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995324">if</span>&nbsp;<span class="ident" id="6995327">err</span>&nbsp;<span class="op" id="6995331">:=</span>&nbsp;<span class="ident" id="6995334">tw</span><span class="op" id="6995336">.</span><span class="ident" id="6995337">WriteHeader</span><span class="op" id="6995348">(</span><span class="ident" id="6995349">entry</span><span class="op" id="6995354">.</span><span class="ident" id="6995355">header</span><span class="op" id="6995361">)</span><span class="op" id="6995362">;</span>&nbsp;<span class="ident" id="6995364">err</span>&nbsp;<span class="op" id="6995368">!=</span>&nbsp;<span class="builtintype" id="6995371">nil</span>&nbsp;<span class="op" id="6995375">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995381">t</span><span class="op" id="6995382">.</span><span class="ident" id="6995383">Errorf</span><span class="op" id="6995389">(</span><span class="string" id="6995390">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6995436">,</span>&nbsp;<span class="ident" id="6995438">i</span><span class="op" id="6995439">,</span>&nbsp;<span class="ident" id="6995441">j</span><span class="op" id="6995442">,</span>&nbsp;<span class="ident" id="6995444">err</span><span class="op" id="6995447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995453">continue</span>&nbsp;<span class="ident" id="6995462">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6995474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995479">if</span>&nbsp;<span class="ident" id="6995482">_</span><span class="op" id="6995483">,</span>&nbsp;<span class="ident" id="6995485">err</span>&nbsp;<span class="op" id="6995489">:=</span>&nbsp;<span class="ident" id="6995492">io</span><span class="op" id="6995494">.</span><span class="ident" id="6995495">WriteString</span><span class="op" id="6995506">(</span><span class="ident" id="6995507">tw</span><span class="op" id="6995509">,</span>&nbsp;<span class="ident" id="6995511">entry</span><span class="op" id="6995516">.</span><span class="ident" id="6995517">contents</span><span class="op" id="6995525">)</span><span class="op" id="6995526">;</span>&nbsp;<span class="ident" id="6995528">err</span>&nbsp;<span class="op" id="6995532">!=</span>&nbsp;<span class="builtintype" id="6995535">nil</span>&nbsp;<span class="op" id="6995539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995545">t</span><span class="op" id="6995546">.</span><span class="ident" id="6995547">Errorf</span><span class="op" id="6995553">(</span><span class="string" id="6995554">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6995602">,</span>&nbsp;<span class="ident" id="6995604">i</span><span class="op" id="6995605">,</span>&nbsp;<span class="ident" id="6995607">j</span><span class="op" id="6995608">,</span>&nbsp;<span class="ident" id="6995610">err</span><span class="op" id="6995613">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995619">continue</span>&nbsp;<span class="ident" id="6995628">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6995640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6995644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6995648">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995708">if</span>&nbsp;<span class="ident" id="6995711">err</span>&nbsp;<span class="op" id="6995715">:=</span>&nbsp;<span class="ident" id="6995718">tw</span><span class="op" id="6995720">.</span><span class="ident" id="6995721">Close</span><span class="op" id="6995726">(</span><span class="op" id="6995727">)</span><span class="op" id="6995728">;</span>&nbsp;<span class="ident" id="6995730">err</span>&nbsp;<span class="op" id="6995734">!=</span>&nbsp;<span class="builtintype" id="6995737">nil</span>&nbsp;<span class="op" id="6995741">&amp;&amp;</span>&nbsp;<span class="op" id="6995744">!</span><span class="ident" id="6995745">big</span>&nbsp;<span class="op" id="6995749">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995754">t</span><span class="op" id="6995755">.</span><span class="ident" id="6995756">Errorf</span><span class="op" id="6995762">(</span><span class="string" id="6995763">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6995800">,</span>&nbsp;<span class="ident" id="6995802">i</span><span class="op" id="6995803">,</span>&nbsp;<span class="ident" id="6995805">err</span><span class="op" id="6995808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995813">continue</span>&nbsp;<span class="ident" id="6995822">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6995833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995838">actual</span>&nbsp;<span class="op" id="6995845">:=</span>&nbsp;<span class="ident" id="6995848">buf</span><span class="op" id="6995851">.</span><span class="ident" id="6995852">Bytes</span><span class="op" id="6995857">(</span><span class="op" id="6995858">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6995862">if</span>&nbsp;<span class="op" id="6995865">!</span><span class="ident" id="6995866">bytes</span><span class="op" id="6995871">.</span><span class="ident" id="6995872">Equal</span><span class="op" id="6995877">(</span><span class="ident" id="6995878">expected</span><span class="op" id="6995886">,</span>&nbsp;<span class="ident" id="6995888">actual</span><span class="op" id="6995894">)</span>&nbsp;<span class="op" id="6995896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995901">t</span><span class="op" id="6995902">.</span><span class="ident" id="6995903">Errorf</span><span class="op" id="6995909">(</span><span class="string" id="6995910">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6995965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6995971">i</span><span class="op" id="6995972">,</span>&nbsp;<span class="ident" id="6995974">bytediff</span><span class="op" id="6995982">(</span><span class="ident" id="6995983">expected</span><span class="op" id="6995991">,</span>&nbsp;<span class="ident" id="6995993">actual</span><span class="op" id="6995999">)</span><span class="op" id="6996000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996008">if</span>&nbsp;<span class="ident" id="6996011">testing</span><span class="op" id="6996018">.</span><span class="ident" id="6996019">Short</span><span class="op" id="6996024">(</span><span class="op" id="6996025">)</span>&nbsp;<span class="op" id="6996027">{</span>&nbsp;<span class="comment" id="6996029">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996065">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996076">}</span><br>
<span class="lineno"></span><span class="op" id="6996078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6996081">func</span>&nbsp;<span class="ident" id="6996086">TestPax</span><span class="op" id="6996093">(</span><span class="ident" id="6996094">t</span>&nbsp;<span class="op" id="6996096">*</span><span class="ident" id="6996097">testing</span><span class="op" id="6996104">.</span><span class="ident" id="6996105">T</span><span class="op" id="6996106">)</span>&nbsp;<span class="op" id="6996108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6996111">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996151">fileinfo</span><span class="op" id="6996159">,</span>&nbsp;<span class="ident" id="6996161">err</span>&nbsp;<span class="op" id="6996165">:=</span>&nbsp;<span class="ident" id="6996168">os</span><span class="op" id="6996170">.</span><span class="ident" id="6996171">Stat</span><span class="op" id="6996175">(</span><span class="string" id="6996176">&#34;testdata/small.txt&#34;</span><span class="op" id="6996196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996199">if</span>&nbsp;<span class="ident" id="6996202">err</span>&nbsp;<span class="op" id="6996206">!=</span>&nbsp;<span class="builtintype" id="6996209">nil</span>&nbsp;<span class="op" id="6996213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996217">t</span><span class="op" id="6996218">.</span><span class="ident" id="6996219">Fatal</span><span class="op" id="6996224">(</span><span class="ident" id="6996225">err</span><span class="op" id="6996228">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996234">hdr</span><span class="op" id="6996237">,</span>&nbsp;<span class="ident" id="6996239">err</span>&nbsp;<span class="op" id="6996243">:=</span>&nbsp;<span class="ident" id="6996246">FileInfoHeader</span><span class="op" id="6996260">(</span><span class="ident" id="6996261">fileinfo</span><span class="op" id="6996269">,</span>&nbsp;<span class="string" id="6996271">&#34;&#34;</span><span class="op" id="6996273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996276">if</span>&nbsp;<span class="ident" id="6996279">err</span>&nbsp;<span class="op" id="6996283">!=</span>&nbsp;<span class="builtintype" id="6996286">nil</span>&nbsp;<span class="op" id="6996290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996294">t</span><span class="op" id="6996295">.</span><span class="ident" id="6996296">Fatalf</span><span class="op" id="6996302">(</span><span class="string" id="6996303">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6996316">,</span>&nbsp;<span class="ident" id="6996318">err</span><span class="op" id="6996321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996324">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6996327">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996367">longName</span>&nbsp;<span class="op" id="6996376">:=</span>&nbsp;<span class="ident" id="6996379">strings</span><span class="op" id="6996386">.</span><span class="ident" id="6996387">Repeat</span><span class="op" id="6996393">(</span><span class="string" id="6996394">&#34;ab&#34;</span><span class="op" id="6996398">,</span>&nbsp;<span class="num" id="6996400">100</span><span class="op" id="6996403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996406">contents</span>&nbsp;<span class="op" id="6996415">:=</span>&nbsp;<span class="ident" id="6996418">strings</span><span class="op" id="6996425">.</span><span class="ident" id="6996426">Repeat</span><span class="op" id="6996432">(</span><span class="string" id="6996433">&#34;&nbsp;&#34;</span><span class="op" id="6996436">,</span>&nbsp;<span class="builtintype" id="6996438">int</span><span class="op" id="6996441">(</span><span class="ident" id="6996442">hdr</span><span class="op" id="6996445">.</span><span class="ident" id="6996446">Size</span><span class="op" id="6996450">)</span><span class="op" id="6996451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996454">hdr</span><span class="op" id="6996457">.</span><span class="ident" id="6996458">Name</span>&nbsp;<span class="op" id="6996463">=</span>&nbsp;<span class="ident" id="6996465">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996475">var</span>&nbsp;<span class="ident" id="6996479">buf</span>&nbsp;<span class="ident" id="6996483">bytes</span><span class="op" id="6996488">.</span><span class="ident" id="6996489">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996497">writer</span>&nbsp;<span class="op" id="6996504">:=</span>&nbsp;<span class="ident" id="6996507">NewWriter</span><span class="op" id="6996516">(</span><span class="op" id="6996517">&amp;</span><span class="ident" id="6996518">buf</span><span class="op" id="6996521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996524">if</span>&nbsp;<span class="ident" id="6996527">err</span>&nbsp;<span class="op" id="6996531">:=</span>&nbsp;<span class="ident" id="6996534">writer</span><span class="op" id="6996540">.</span><span class="ident" id="6996541">WriteHeader</span><span class="op" id="6996552">(</span><span class="ident" id="6996553">hdr</span><span class="op" id="6996556">)</span><span class="op" id="6996557">;</span>&nbsp;<span class="ident" id="6996559">err</span>&nbsp;<span class="op" id="6996563">!=</span>&nbsp;<span class="builtintype" id="6996566">nil</span>&nbsp;<span class="op" id="6996570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996574">t</span><span class="op" id="6996575">.</span><span class="ident" id="6996576">Fatal</span><span class="op" id="6996581">(</span><span class="ident" id="6996582">err</span><span class="op" id="6996585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996591">if</span>&nbsp;<span class="ident" id="6996594">_</span><span class="op" id="6996595">,</span>&nbsp;<span class="ident" id="6996597">err</span>&nbsp;<span class="op" id="6996601">=</span>&nbsp;<span class="ident" id="6996603">writer</span><span class="op" id="6996609">.</span><span class="ident" id="6996610">Write</span><span class="op" id="6996615">(</span><span class="op" id="6996616">[</span><span class="op" id="6996617">]</span><span class="builtintype" id="6996618">byte</span><span class="op" id="6996622">(</span><span class="ident" id="6996623">contents</span><span class="op" id="6996631">)</span><span class="op" id="6996632">)</span><span class="op" id="6996633">;</span>&nbsp;<span class="ident" id="6996635">err</span>&nbsp;<span class="op" id="6996639">!=</span>&nbsp;<span class="builtintype" id="6996642">nil</span>&nbsp;<span class="op" id="6996646">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996650">t</span><span class="op" id="6996651">.</span><span class="ident" id="6996652">Fatal</span><span class="op" id="6996657">(</span><span class="ident" id="6996658">err</span><span class="op" id="6996661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996667">if</span>&nbsp;<span class="ident" id="6996670">err</span>&nbsp;<span class="op" id="6996674">:=</span>&nbsp;<span class="ident" id="6996677">writer</span><span class="op" id="6996683">.</span><span class="ident" id="6996684">Close</span><span class="op" id="6996689">(</span><span class="op" id="6996690">)</span><span class="op" id="6996691">;</span>&nbsp;<span class="ident" id="6996693">err</span>&nbsp;<span class="op" id="6996697">!=</span>&nbsp;<span class="builtintype" id="6996700">nil</span>&nbsp;<span class="op" id="6996704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996708">t</span><span class="op" id="6996709">.</span><span class="ident" id="6996710">Fatal</span><span class="op" id="6996715">(</span><span class="ident" id="6996716">err</span><span class="op" id="6996719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996722">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6996725">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6996783">if</span>&nbsp;<span class="op" id="6996786">!</span><span class="ident" id="6996787">bytes</span><span class="op" id="6996792">.</span><span class="ident" id="6996793">Contains</span><span class="op" id="6996801">(</span><span class="ident" id="6996802">buf</span><span class="op" id="6996805">.</span><span class="ident" id="6996806">Bytes</span><span class="op" id="6996811">(</span><span class="op" id="6996812">)</span><span class="op" id="6996813">,</span>&nbsp;<span class="op" id="6996815">[</span><span class="op" id="6996816">]</span><span class="builtintype" id="6996817">byte</span><span class="op" id="6996821">(</span><span class="string" id="6996822">&#34;PaxHeaders.&#34;</span><span class="op" id="6996835">)</span><span class="op" id="6996836">)</span>&nbsp;<span class="op" id="6996838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996842">t</span><span class="op" id="6996843">.</span><span class="ident" id="6996844">Fatal</span><span class="op" id="6996849">(</span><span class="string" id="6996850">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6996899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6996902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6996905">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996967">reader</span>&nbsp;<span class="op" id="6996974">:=</span>&nbsp;<span class="ident" id="6996977">NewReader</span><span class="op" id="6996986">(</span><span class="op" id="6996987">&amp;</span><span class="ident" id="6996988">buf</span><span class="op" id="6996991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6996994">hdr</span><span class="op" id="6996997">,</span>&nbsp;<span class="ident" id="6996999">err</span>&nbsp;<span class="op" id="6997003">=</span>&nbsp;<span class="ident" id="6997005">reader</span><span class="op" id="6997011">.</span><span class="ident" id="6997012">Next</span><span class="op" id="6997016">(</span><span class="op" id="6997017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997020">if</span>&nbsp;<span class="ident" id="6997023">err</span>&nbsp;<span class="op" id="6997027">!=</span>&nbsp;<span class="builtintype" id="6997030">nil</span>&nbsp;<span class="op" id="6997034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997038">t</span><span class="op" id="6997039">.</span><span class="ident" id="6997040">Fatal</span><span class="op" id="6997045">(</span><span class="ident" id="6997046">err</span><span class="op" id="6997049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997052">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997055">if</span>&nbsp;<span class="ident" id="6997058">hdr</span><span class="op" id="6997061">.</span><span class="ident" id="6997062">Name</span>&nbsp;<span class="op" id="6997067">!=</span>&nbsp;<span class="ident" id="6997070">longName</span>&nbsp;<span class="op" id="6997079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997083">t</span><span class="op" id="6997084">.</span><span class="ident" id="6997085">Fatal</span><span class="op" id="6997090">(</span><span class="string" id="6997091">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6997124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997127">}</span><br>
<span class="lineno"></span><span class="op" id="6997129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6997132">func</span>&nbsp;<span class="ident" id="6997137">TestPaxSymlink</span><span class="op" id="6997151">(</span><span class="ident" id="6997152">t</span>&nbsp;<span class="op" id="6997154">*</span><span class="ident" id="6997155">testing</span><span class="op" id="6997162">.</span><span class="ident" id="6997163">T</span><span class="op" id="6997164">)</span>&nbsp;<span class="op" id="6997166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6997169">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997213">fileinfo</span><span class="op" id="6997221">,</span>&nbsp;<span class="ident" id="6997223">err</span>&nbsp;<span class="op" id="6997227">:=</span>&nbsp;<span class="ident" id="6997230">os</span><span class="op" id="6997232">.</span><span class="ident" id="6997233">Stat</span><span class="op" id="6997237">(</span><span class="string" id="6997238">&#34;testdata/small.txt&#34;</span><span class="op" id="6997258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997261">if</span>&nbsp;<span class="ident" id="6997264">err</span>&nbsp;<span class="op" id="6997268">!=</span>&nbsp;<span class="builtintype" id="6997271">nil</span>&nbsp;<span class="op" id="6997275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997279">t</span><span class="op" id="6997280">.</span><span class="ident" id="6997281">Fatal</span><span class="op" id="6997286">(</span><span class="ident" id="6997287">err</span><span class="op" id="6997290">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997296">hdr</span><span class="op" id="6997299">,</span>&nbsp;<span class="ident" id="6997301">err</span>&nbsp;<span class="op" id="6997305">:=</span>&nbsp;<span class="ident" id="6997308">FileInfoHeader</span><span class="op" id="6997322">(</span><span class="ident" id="6997323">fileinfo</span><span class="op" id="6997331">,</span>&nbsp;<span class="string" id="6997333">&#34;&#34;</span><span class="op" id="6997335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997338">hdr</span><span class="op" id="6997341">.</span><span class="ident" id="6997342">Typeflag</span>&nbsp;<span class="op" id="6997351">=</span>&nbsp;<span class="ident" id="6997353">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997366">if</span>&nbsp;<span class="ident" id="6997369">err</span>&nbsp;<span class="op" id="6997373">!=</span>&nbsp;<span class="builtintype" id="6997376">nil</span>&nbsp;<span class="op" id="6997380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997384">t</span><span class="op" id="6997385">.</span><span class="ident" id="6997386">Fatalf</span><span class="op" id="6997392">(</span><span class="string" id="6997393">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6997407">,</span>&nbsp;<span class="ident" id="6997409">err</span><span class="op" id="6997412">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6997418">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997462">longLinkname</span>&nbsp;<span class="op" id="6997475">:=</span>&nbsp;<span class="ident" id="6997478">strings</span><span class="op" id="6997485">.</span><span class="ident" id="6997486">Repeat</span><span class="op" id="6997492">(</span><span class="string" id="6997493">&#34;1234567890/1234567890&#34;</span><span class="op" id="6997516">,</span>&nbsp;<span class="num" id="6997518">10</span><span class="op" id="6997520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997523">hdr</span><span class="op" id="6997526">.</span><span class="ident" id="6997527">Linkname</span>&nbsp;<span class="op" id="6997536">=</span>&nbsp;<span class="ident" id="6997538">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997553">hdr</span><span class="op" id="6997556">.</span><span class="ident" id="6997557">Size</span>&nbsp;<span class="op" id="6997562">=</span>&nbsp;<span class="num" id="6997564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997567">var</span>&nbsp;<span class="ident" id="6997571">buf</span>&nbsp;<span class="ident" id="6997575">bytes</span><span class="op" id="6997580">.</span><span class="ident" id="6997581">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997589">writer</span>&nbsp;<span class="op" id="6997596">:=</span>&nbsp;<span class="ident" id="6997599">NewWriter</span><span class="op" id="6997608">(</span><span class="op" id="6997609">&amp;</span><span class="ident" id="6997610">buf</span><span class="op" id="6997613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997616">if</span>&nbsp;<span class="ident" id="6997619">err</span>&nbsp;<span class="op" id="6997623">:=</span>&nbsp;<span class="ident" id="6997626">writer</span><span class="op" id="6997632">.</span><span class="ident" id="6997633">WriteHeader</span><span class="op" id="6997644">(</span><span class="ident" id="6997645">hdr</span><span class="op" id="6997648">)</span><span class="op" id="6997649">;</span>&nbsp;<span class="ident" id="6997651">err</span>&nbsp;<span class="op" id="6997655">!=</span>&nbsp;<span class="builtintype" id="6997658">nil</span>&nbsp;<span class="op" id="6997662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997666">t</span><span class="op" id="6997667">.</span><span class="ident" id="6997668">Fatal</span><span class="op" id="6997673">(</span><span class="ident" id="6997674">err</span><span class="op" id="6997677">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997683">if</span>&nbsp;<span class="ident" id="6997686">err</span>&nbsp;<span class="op" id="6997690">:=</span>&nbsp;<span class="ident" id="6997693">writer</span><span class="op" id="6997699">.</span><span class="ident" id="6997700">Close</span><span class="op" id="6997705">(</span><span class="op" id="6997706">)</span><span class="op" id="6997707">;</span>&nbsp;<span class="ident" id="6997709">err</span>&nbsp;<span class="op" id="6997713">!=</span>&nbsp;<span class="builtintype" id="6997716">nil</span>&nbsp;<span class="op" id="6997720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997724">t</span><span class="op" id="6997725">.</span><span class="ident" id="6997726">Fatal</span><span class="op" id="6997731">(</span><span class="ident" id="6997732">err</span><span class="op" id="6997735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6997741">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6997799">if</span>&nbsp;<span class="op" id="6997802">!</span><span class="ident" id="6997803">bytes</span><span class="op" id="6997808">.</span><span class="ident" id="6997809">Contains</span><span class="op" id="6997817">(</span><span class="ident" id="6997818">buf</span><span class="op" id="6997821">.</span><span class="ident" id="6997822">Bytes</span><span class="op" id="6997827">(</span><span class="op" id="6997828">)</span><span class="op" id="6997829">,</span>&nbsp;<span class="op" id="6997831">[</span><span class="op" id="6997832">]</span><span class="builtintype" id="6997833">byte</span><span class="op" id="6997837">(</span><span class="string" id="6997838">&#34;PaxHeaders.&#34;</span><span class="op" id="6997851">)</span><span class="op" id="6997852">)</span>&nbsp;<span class="op" id="6997854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997858">t</span><span class="op" id="6997859">.</span><span class="ident" id="6997860">Fatal</span><span class="op" id="6997865">(</span><span class="string" id="6997866">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6997915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6997918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6997921">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6997983">reader</span>&nbsp;<span class="op" id="6997990">:=</span>&nbsp;<span class="ident" id="6997993">NewReader</span><span class="op" id="6998002">(</span><span class="op" id="6998003">&amp;</span><span class="ident" id="6998004">buf</span><span class="op" id="6998007">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998010">hdr</span><span class="op" id="6998013">,</span>&nbsp;<span class="ident" id="6998015">err</span>&nbsp;<span class="op" id="6998019">=</span>&nbsp;<span class="ident" id="6998021">reader</span><span class="op" id="6998027">.</span><span class="ident" id="6998028">Next</span><span class="op" id="6998032">(</span><span class="op" id="6998033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998036">if</span>&nbsp;<span class="ident" id="6998039">err</span>&nbsp;<span class="op" id="6998043">!=</span>&nbsp;<span class="builtintype" id="6998046">nil</span>&nbsp;<span class="op" id="6998050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998054">t</span><span class="op" id="6998055">.</span><span class="ident" id="6998056">Fatal</span><span class="op" id="6998061">(</span><span class="ident" id="6998062">err</span><span class="op" id="6998065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998071">if</span>&nbsp;<span class="ident" id="6998074">hdr</span><span class="op" id="6998077">.</span><span class="ident" id="6998078">Linkname</span>&nbsp;<span class="op" id="6998087">!=</span>&nbsp;<span class="ident" id="6998090">longLinkname</span>&nbsp;<span class="op" id="6998103">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998107">t</span><span class="op" id="6998108">.</span><span class="ident" id="6998109">Fatal</span><span class="op" id="6998114">(</span><span class="string" id="6998115">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6998148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998151">}</span><br>
<span class="lineno"></span><span class="op" id="6998153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6998156">func</span>&nbsp;<span class="ident" id="6998161">TestPaxNonAscii</span><span class="op" id="6998176">(</span><span class="ident" id="6998177">t</span>&nbsp;<span class="op" id="6998179">*</span><span class="ident" id="6998180">testing</span><span class="op" id="6998187">.</span><span class="ident" id="6998188">T</span><span class="op" id="6998189">)</span>&nbsp;<span class="op" id="6998191">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6998194">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6998266">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998321">fileinfo</span><span class="op" id="6998329">,</span>&nbsp;<span class="ident" id="6998331">err</span>&nbsp;<span class="op" id="6998335">:=</span>&nbsp;<span class="ident" id="6998338">os</span><span class="op" id="6998340">.</span><span class="ident" id="6998341">Stat</span><span class="op" id="6998345">(</span><span class="string" id="6998346">&#34;testdata/small.txt&#34;</span><span class="op" id="6998366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998369">if</span>&nbsp;<span class="ident" id="6998372">err</span>&nbsp;<span class="op" id="6998376">!=</span>&nbsp;<span class="builtintype" id="6998379">nil</span>&nbsp;<span class="op" id="6998383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998387">t</span><span class="op" id="6998388">.</span><span class="ident" id="6998389">Fatal</span><span class="op" id="6998394">(</span><span class="ident" id="6998395">err</span><span class="op" id="6998398">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998405">hdr</span><span class="op" id="6998408">,</span>&nbsp;<span class="ident" id="6998410">err</span>&nbsp;<span class="op" id="6998414">:=</span>&nbsp;<span class="ident" id="6998417">FileInfoHeader</span><span class="op" id="6998431">(</span><span class="ident" id="6998432">fileinfo</span><span class="op" id="6998440">,</span>&nbsp;<span class="string" id="6998442">&#34;&#34;</span><span class="op" id="6998444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998447">if</span>&nbsp;<span class="ident" id="6998450">err</span>&nbsp;<span class="op" id="6998454">!=</span>&nbsp;<span class="builtintype" id="6998457">nil</span>&nbsp;<span class="op" id="6998461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998465">t</span><span class="op" id="6998466">.</span><span class="ident" id="6998467">Fatalf</span><span class="op" id="6998473">(</span><span class="string" id="6998474">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6998488">,</span>&nbsp;<span class="ident" id="6998490">err</span><span class="op" id="6998493">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6998500">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998521">chineseFilename</span>&nbsp;<span class="op" id="6998537">:=</span>&nbsp;<span class="string" id="6998540">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998553">chineseGroupname</span>&nbsp;<span class="op" id="6998570">:=</span>&nbsp;<span class="string" id="6998573">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998580">chineseUsername</span>&nbsp;<span class="op" id="6998596">:=</span>&nbsp;<span class="string" id="6998599">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998613">hdr</span><span class="op" id="6998616">.</span><span class="ident" id="6998617">Name</span>&nbsp;<span class="op" id="6998622">=</span>&nbsp;<span class="ident" id="6998624">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998641">hdr</span><span class="op" id="6998644">.</span><span class="ident" id="6998645">Gname</span>&nbsp;<span class="op" id="6998651">=</span>&nbsp;<span class="ident" id="6998653">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998671">hdr</span><span class="op" id="6998674">.</span><span class="ident" id="6998675">Uname</span>&nbsp;<span class="op" id="6998681">=</span>&nbsp;<span class="ident" id="6998683">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998701">contents</span>&nbsp;<span class="op" id="6998710">:=</span>&nbsp;<span class="ident" id="6998713">strings</span><span class="op" id="6998720">.</span><span class="ident" id="6998721">Repeat</span><span class="op" id="6998727">(</span><span class="string" id="6998728">&#34;&nbsp;&#34;</span><span class="op" id="6998731">,</span>&nbsp;<span class="builtintype" id="6998733">int</span><span class="op" id="6998736">(</span><span class="ident" id="6998737">hdr</span><span class="op" id="6998740">.</span><span class="ident" id="6998741">Size</span><span class="op" id="6998745">)</span><span class="op" id="6998746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998750">var</span>&nbsp;<span class="ident" id="6998754">buf</span>&nbsp;<span class="ident" id="6998758">bytes</span><span class="op" id="6998763">.</span><span class="ident" id="6998764">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998772">writer</span>&nbsp;<span class="op" id="6998779">:=</span>&nbsp;<span class="ident" id="6998782">NewWriter</span><span class="op" id="6998791">(</span><span class="op" id="6998792">&amp;</span><span class="ident" id="6998793">buf</span><span class="op" id="6998796">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998799">if</span>&nbsp;<span class="ident" id="6998802">err</span>&nbsp;<span class="op" id="6998806">:=</span>&nbsp;<span class="ident" id="6998809">writer</span><span class="op" id="6998815">.</span><span class="ident" id="6998816">WriteHeader</span><span class="op" id="6998827">(</span><span class="ident" id="6998828">hdr</span><span class="op" id="6998831">)</span><span class="op" id="6998832">;</span>&nbsp;<span class="ident" id="6998834">err</span>&nbsp;<span class="op" id="6998838">!=</span>&nbsp;<span class="builtintype" id="6998841">nil</span>&nbsp;<span class="op" id="6998845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998849">t</span><span class="op" id="6998850">.</span><span class="ident" id="6998851">Fatal</span><span class="op" id="6998856">(</span><span class="ident" id="6998857">err</span><span class="op" id="6998860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998866">if</span>&nbsp;<span class="ident" id="6998869">_</span><span class="op" id="6998870">,</span>&nbsp;<span class="ident" id="6998872">err</span>&nbsp;<span class="op" id="6998876">=</span>&nbsp;<span class="ident" id="6998878">writer</span><span class="op" id="6998884">.</span><span class="ident" id="6998885">Write</span><span class="op" id="6998890">(</span><span class="op" id="6998891">[</span><span class="op" id="6998892">]</span><span class="builtintype" id="6998893">byte</span><span class="op" id="6998897">(</span><span class="ident" id="6998898">contents</span><span class="op" id="6998906">)</span><span class="op" id="6998907">)</span><span class="op" id="6998908">;</span>&nbsp;<span class="ident" id="6998910">err</span>&nbsp;<span class="op" id="6998914">!=</span>&nbsp;<span class="builtintype" id="6998917">nil</span>&nbsp;<span class="op" id="6998921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998925">t</span><span class="op" id="6998926">.</span><span class="ident" id="6998927">Fatal</span><span class="op" id="6998932">(</span><span class="ident" id="6998933">err</span><span class="op" id="6998936">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6998942">if</span>&nbsp;<span class="ident" id="6998945">err</span>&nbsp;<span class="op" id="6998949">:=</span>&nbsp;<span class="ident" id="6998952">writer</span><span class="op" id="6998958">.</span><span class="ident" id="6998959">Close</span><span class="op" id="6998964">(</span><span class="op" id="6998965">)</span><span class="op" id="6998966">;</span>&nbsp;<span class="ident" id="6998968">err</span>&nbsp;<span class="op" id="6998972">!=</span>&nbsp;<span class="builtintype" id="6998975">nil</span>&nbsp;<span class="op" id="6998979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6998983">t</span><span class="op" id="6998984">.</span><span class="ident" id="6998985">Fatal</span><span class="op" id="6998990">(</span><span class="ident" id="6998991">err</span><span class="op" id="6998994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6998997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6999000">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999058">if</span>&nbsp;<span class="op" id="6999061">!</span><span class="ident" id="6999062">bytes</span><span class="op" id="6999067">.</span><span class="ident" id="6999068">Contains</span><span class="op" id="6999076">(</span><span class="ident" id="6999077">buf</span><span class="op" id="6999080">.</span><span class="ident" id="6999081">Bytes</span><span class="op" id="6999086">(</span><span class="op" id="6999087">)</span><span class="op" id="6999088">,</span>&nbsp;<span class="op" id="6999090">[</span><span class="op" id="6999091">]</span><span class="builtintype" id="6999092">byte</span><span class="op" id="6999096">(</span><span class="string" id="6999097">&#34;PaxHeaders.&#34;</span><span class="op" id="6999110">)</span><span class="op" id="6999111">)</span>&nbsp;<span class="op" id="6999113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999117">t</span><span class="op" id="6999118">.</span><span class="ident" id="6999119">Fatal</span><span class="op" id="6999124">(</span><span class="string" id="6999125">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6999174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6999180">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999242">reader</span>&nbsp;<span class="op" id="6999249">:=</span>&nbsp;<span class="ident" id="6999252">NewReader</span><span class="op" id="6999261">(</span><span class="op" id="6999262">&amp;</span><span class="ident" id="6999263">buf</span><span class="op" id="6999266">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999269">hdr</span><span class="op" id="6999272">,</span>&nbsp;<span class="ident" id="6999274">err</span>&nbsp;<span class="op" id="6999278">=</span>&nbsp;<span class="ident" id="6999280">reader</span><span class="op" id="6999286">.</span><span class="ident" id="6999287">Next</span><span class="op" id="6999291">(</span><span class="op" id="6999292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999295">if</span>&nbsp;<span class="ident" id="6999298">err</span>&nbsp;<span class="op" id="6999302">!=</span>&nbsp;<span class="builtintype" id="6999305">nil</span>&nbsp;<span class="op" id="6999309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999313">t</span><span class="op" id="6999314">.</span><span class="ident" id="6999315">Fatal</span><span class="op" id="6999320">(</span><span class="ident" id="6999321">err</span><span class="op" id="6999324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999330">if</span>&nbsp;<span class="ident" id="6999333">hdr</span><span class="op" id="6999336">.</span><span class="ident" id="6999337">Name</span>&nbsp;<span class="op" id="6999342">!=</span>&nbsp;<span class="ident" id="6999345">chineseFilename</span>&nbsp;<span class="op" id="6999361">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999365">t</span><span class="op" id="6999366">.</span><span class="ident" id="6999367">Fatal</span><span class="op" id="6999372">(</span><span class="string" id="6999373">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6999404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999410">if</span>&nbsp;<span class="ident" id="6999413">hdr</span><span class="op" id="6999416">.</span><span class="ident" id="6999417">Gname</span>&nbsp;<span class="op" id="6999423">!=</span>&nbsp;<span class="ident" id="6999426">chineseGroupname</span>&nbsp;<span class="op" id="6999443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999447">t</span><span class="op" id="6999448">.</span><span class="ident" id="6999449">Fatal</span><span class="op" id="6999454">(</span><span class="string" id="6999455">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6999487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999490">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999493">if</span>&nbsp;<span class="ident" id="6999496">hdr</span><span class="op" id="6999499">.</span><span class="ident" id="6999500">Uname</span>&nbsp;<span class="op" id="6999506">!=</span>&nbsp;<span class="ident" id="6999509">chineseUsername</span>&nbsp;<span class="op" id="6999525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999529">t</span><span class="op" id="6999530">.</span><span class="ident" id="6999531">Fatal</span><span class="op" id="6999536">(</span><span class="string" id="6999537">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6999568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999571">}</span><br>
<span class="lineno"></span><span class="op" id="6999573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6999576">func</span>&nbsp;<span class="ident" id="6999581">TestPaxXattrs</span><span class="op" id="6999594">(</span><span class="ident" id="6999595">t</span>&nbsp;<span class="op" id="6999597">*</span><span class="ident" id="6999598">testing</span><span class="op" id="6999605">.</span><span class="ident" id="6999606">T</span><span class="op" id="6999607">)</span>&nbsp;<span class="op" id="6999609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999612">xattrs</span>&nbsp;<span class="op" id="6999619">:=</span>&nbsp;<span class="keyword" id="6999622">map</span><span class="op" id="6999625">[</span><span class="builtintype" id="6999626">string</span><span class="op" id="6999632">]</span><span class="builtintype" id="6999633">string</span><span class="op" id="6999639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6999643">&#34;user.key&#34;</span><span class="op" id="6999653">:</span>&nbsp;<span class="string" id="6999655">&#34;value&#34;</span><span class="op" id="6999662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6999669">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999705">fileinfo</span><span class="op" id="6999713">,</span>&nbsp;<span class="ident" id="6999715">err</span>&nbsp;<span class="op" id="6999719">:=</span>&nbsp;<span class="ident" id="6999722">os</span><span class="op" id="6999724">.</span><span class="ident" id="6999725">Stat</span><span class="op" id="6999729">(</span><span class="string" id="6999730">&#34;testdata/small.txt&#34;</span><span class="op" id="6999750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999753">if</span>&nbsp;<span class="ident" id="6999756">err</span>&nbsp;<span class="op" id="6999760">!=</span>&nbsp;<span class="builtintype" id="6999763">nil</span>&nbsp;<span class="op" id="6999767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999771">t</span><span class="op" id="6999772">.</span><span class="ident" id="6999773">Fatal</span><span class="op" id="6999778">(</span><span class="ident" id="6999779">err</span><span class="op" id="6999782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999785">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999788">hdr</span><span class="op" id="6999791">,</span>&nbsp;<span class="ident" id="6999793">err</span>&nbsp;<span class="op" id="6999797">:=</span>&nbsp;<span class="ident" id="6999800">FileInfoHeader</span><span class="op" id="6999814">(</span><span class="ident" id="6999815">fileinfo</span><span class="op" id="6999823">,</span>&nbsp;<span class="string" id="6999825">&#34;&#34;</span><span class="op" id="6999827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999830">if</span>&nbsp;<span class="ident" id="6999833">err</span>&nbsp;<span class="op" id="6999837">!=</span>&nbsp;<span class="builtintype" id="6999840">nil</span>&nbsp;<span class="op" id="6999844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999848">t</span><span class="op" id="6999849">.</span><span class="ident" id="6999850">Fatalf</span><span class="op" id="6999856">(</span><span class="string" id="6999857">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6999870">,</span>&nbsp;<span class="ident" id="6999872">err</span><span class="op" id="6999875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6999878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999881">contents</span>&nbsp;<span class="op" id="6999890">:=</span>&nbsp;<span class="string" id="6999893">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999902">hdr</span><span class="op" id="6999905">.</span><span class="ident" id="6999906">Xattrs</span>&nbsp;<span class="op" id="6999913">=</span>&nbsp;<span class="ident" id="6999915">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999923">var</span>&nbsp;<span class="ident" id="6999927">buf</span>&nbsp;<span class="ident" id="6999931">bytes</span><span class="op" id="6999936">.</span><span class="ident" id="6999937">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6999945">writer</span>&nbsp;<span class="op" id="6999952">:=</span>&nbsp;<span class="ident" id="6999955">NewWriter</span><span class="op" id="6999964">(</span><span class="op" id="6999965">&amp;</span><span class="ident" id="6999966">buf</span><span class="op" id="6999969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6999972">if</span>&nbsp;<span class="ident" id="6999975">err</span>&nbsp;<span class="op" id="6999979">:=</span>&nbsp;<span class="ident" id="6999982">writer</span><span class="op" id="6999988">.</span><span class="ident" id="6999989">WriteHeader</span><span class="op" id="7000000">(</span><span class="ident" id="7000001">hdr</span><span class="op" id="7000004">)</span><span class="op" id="7000005">;</span>&nbsp;<span class="ident" id="7000007">err</span>&nbsp;<span class="op" id="7000011">!=</span>&nbsp;<span class="builtintype" id="7000014">nil</span>&nbsp;<span class="op" id="7000018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000022">t</span><span class="op" id="7000023">.</span><span class="ident" id="7000024">Fatal</span><span class="op" id="7000029">(</span><span class="ident" id="7000030">err</span><span class="op" id="7000033">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000039">if</span>&nbsp;<span class="ident" id="7000042">_</span><span class="op" id="7000043">,</span>&nbsp;<span class="ident" id="7000045">err</span>&nbsp;<span class="op" id="7000049">=</span>&nbsp;<span class="ident" id="7000051">writer</span><span class="op" id="7000057">.</span><span class="ident" id="7000058">Write</span><span class="op" id="7000063">(</span><span class="op" id="7000064">[</span><span class="op" id="7000065">]</span><span class="builtintype" id="7000066">byte</span><span class="op" id="7000070">(</span><span class="ident" id="7000071">contents</span><span class="op" id="7000079">)</span><span class="op" id="7000080">)</span><span class="op" id="7000081">;</span>&nbsp;<span class="ident" id="7000083">err</span>&nbsp;<span class="op" id="7000087">!=</span>&nbsp;<span class="builtintype" id="7000090">nil</span>&nbsp;<span class="op" id="7000094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000098">t</span><span class="op" id="7000099">.</span><span class="ident" id="7000100">Fatal</span><span class="op" id="7000105">(</span><span class="ident" id="7000106">err</span><span class="op" id="7000109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000115">if</span>&nbsp;<span class="ident" id="7000118">err</span>&nbsp;<span class="op" id="7000122">:=</span>&nbsp;<span class="ident" id="7000125">writer</span><span class="op" id="7000131">.</span><span class="ident" id="7000132">Close</span><span class="op" id="7000137">(</span><span class="op" id="7000138">)</span><span class="op" id="7000139">;</span>&nbsp;<span class="ident" id="7000141">err</span>&nbsp;<span class="op" id="7000145">!=</span>&nbsp;<span class="builtintype" id="7000148">nil</span>&nbsp;<span class="op" id="7000152">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000156">t</span><span class="op" id="7000157">.</span><span class="ident" id="7000158">Fatal</span><span class="op" id="7000163">(</span><span class="ident" id="7000164">err</span><span class="op" id="7000167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7000173">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000234">reader</span>&nbsp;<span class="op" id="7000241">:=</span>&nbsp;<span class="ident" id="7000244">NewReader</span><span class="op" id="7000253">(</span><span class="op" id="7000254">&amp;</span><span class="ident" id="7000255">buf</span><span class="op" id="7000258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000261">hdr</span><span class="op" id="7000264">,</span>&nbsp;<span class="ident" id="7000266">err</span>&nbsp;<span class="op" id="7000270">=</span>&nbsp;<span class="ident" id="7000272">reader</span><span class="op" id="7000278">.</span><span class="ident" id="7000279">Next</span><span class="op" id="7000283">(</span><span class="op" id="7000284">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000287">if</span>&nbsp;<span class="ident" id="7000290">err</span>&nbsp;<span class="op" id="7000294">!=</span>&nbsp;<span class="builtintype" id="7000297">nil</span>&nbsp;<span class="op" id="7000301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000305">t</span><span class="op" id="7000306">.</span><span class="ident" id="7000307">Fatal</span><span class="op" id="7000312">(</span><span class="ident" id="7000313">err</span><span class="op" id="7000316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000322">if</span>&nbsp;<span class="op" id="7000325">!</span><span class="ident" id="7000326">reflect</span><span class="op" id="7000333">.</span><span class="ident" id="7000334">DeepEqual</span><span class="op" id="7000343">(</span><span class="ident" id="7000344">hdr</span><span class="op" id="7000347">.</span><span class="ident" id="7000348">Xattrs</span><span class="op" id="7000354">,</span>&nbsp;<span class="ident" id="7000356">xattrs</span><span class="op" id="7000362">)</span>&nbsp;<span class="op" id="7000364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000368">t</span><span class="op" id="7000369">.</span><span class="ident" id="7000370">Fatalf</span><span class="op" id="7000376">(</span><span class="string" id="7000377">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7000431">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000436">hdr</span><span class="op" id="7000439">.</span><span class="ident" id="7000440">Xattrs</span><span class="op" id="7000446">,</span>&nbsp;<span class="ident" id="7000448">xattrs</span><span class="op" id="7000454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000457">}</span><br>
<span class="lineno"></span><span class="op" id="7000459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7000462">func</span>&nbsp;<span class="ident" id="7000467">TestPAXHeader</span><span class="op" id="7000480">(</span><span class="ident" id="7000481">t</span>&nbsp;<span class="op" id="7000483">*</span><span class="ident" id="7000484">testing</span><span class="op" id="7000491">.</span><span class="ident" id="7000492">T</span><span class="op" id="7000493">)</span>&nbsp;<span class="op" id="7000495">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000498">medName</span>&nbsp;<span class="op" id="7000506">:=</span>&nbsp;<span class="ident" id="7000509">strings</span><span class="op" id="7000516">.</span><span class="ident" id="7000517">Repeat</span><span class="op" id="7000523">(</span><span class="string" id="7000524">&#34;CD&#34;</span><span class="op" id="7000528">,</span>&nbsp;<span class="num" id="7000530">50</span><span class="op" id="7000532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000535">longName</span>&nbsp;<span class="op" id="7000544">:=</span>&nbsp;<span class="ident" id="7000547">strings</span><span class="op" id="7000554">.</span><span class="ident" id="7000555">Repeat</span><span class="op" id="7000561">(</span><span class="string" id="7000562">&#34;AB&#34;</span><span class="op" id="7000566">,</span>&nbsp;<span class="num" id="7000568">100</span><span class="op" id="7000571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000574">paxTests</span>&nbsp;<span class="op" id="7000583">:=</span>&nbsp;<span class="op" id="7000586">[</span><span class="op" id="7000587">]</span><span class="op" id="7000588">[</span><span class="num" id="7000589">2</span><span class="op" id="7000590">]</span><span class="builtintype" id="7000591">string</span><span class="op" id="7000597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000601">{</span><span class="ident" id="7000602">paxPath</span>&nbsp;<span class="op" id="7000610">+</span>&nbsp;<span class="string" id="7000612">&#34;=/etc/hosts&#34;</span><span class="op" id="7000625">,</span>&nbsp;<span class="string" id="7000627">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7000649">}</span><span class="op" id="7000650">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000654">{</span><span class="string" id="7000655">&#34;a=b&#34;</span><span class="op" id="7000660">,</span>&nbsp;<span class="string" id="7000662">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7000671">}</span><span class="op" id="7000672">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7000683">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000708">{</span><span class="string" id="7000709">&#34;a=names&#34;</span><span class="op" id="7000718">,</span>&nbsp;<span class="string" id="7000720">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7000734">}</span><span class="op" id="7000735">,</span>&nbsp;<span class="comment" id="7000737">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000770">{</span><span class="ident" id="7000771">paxPath</span>&nbsp;<span class="op" id="7000779">+</span>&nbsp;<span class="string" id="7000781">&#34;=&#34;</span>&nbsp;<span class="op" id="7000785">+</span>&nbsp;<span class="ident" id="7000787">longName</span><span class="op" id="7000795">,</span>&nbsp;<span class="ident" id="7000797">fmt</span><span class="op" id="7000800">.</span><span class="ident" id="7000801">Sprintf</span><span class="op" id="7000808">(</span><span class="string" id="7000809">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7000824">,</span>&nbsp;<span class="ident" id="7000826">longName</span><span class="op" id="7000834">)</span><span class="op" id="7000835">}</span><span class="op" id="7000836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7000840">{</span><span class="ident" id="7000841">paxPath</span>&nbsp;<span class="op" id="7000849">+</span>&nbsp;<span class="string" id="7000851">&#34;=&#34;</span>&nbsp;<span class="op" id="7000855">+</span>&nbsp;<span class="ident" id="7000857">medName</span><span class="op" id="7000864">,</span>&nbsp;<span class="ident" id="7000866">fmt</span><span class="op" id="7000869">.</span><span class="ident" id="7000870">Sprintf</span><span class="op" id="7000877">(</span><span class="string" id="7000878">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7000893">,</span>&nbsp;<span class="ident" id="7000895">medName</span><span class="op" id="7000902">)</span><span class="op" id="7000903">}</span><span class="op" id="7000904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000908">for</span>&nbsp;<span class="ident" id="7000912">_</span><span class="op" id="7000913">,</span>&nbsp;<span class="ident" id="7000915">test</span>&nbsp;<span class="op" id="7000920">:=</span>&nbsp;<span class="keyword" id="7000923">range</span>&nbsp;<span class="ident" id="7000929">paxTests</span>&nbsp;<span class="op" id="7000938">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7000942">key</span><span class="op" id="7000945">,</span>&nbsp;<span class="ident" id="7000947">expected</span>&nbsp;<span class="op" id="7000956">:=</span>&nbsp;<span class="ident" id="7000959">test</span><span class="op" id="7000963">[</span><span class="num" id="7000964">0</span><span class="op" id="7000965">]</span><span class="op" id="7000966">,</span>&nbsp;<span class="ident" id="7000968">test</span><span class="op" id="7000972">[</span><span class="num" id="7000973">1</span><span class="op" id="7000974">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7000978">if</span>&nbsp;<span class="ident" id="7000981">result</span>&nbsp;<span class="op" id="7000988">:=</span>&nbsp;<span class="ident" id="7000991">paxHeader</span><span class="op" id="7001000">(</span><span class="ident" id="7001001">key</span><span class="op" id="7001004">)</span><span class="op" id="7001005">;</span>&nbsp;<span class="ident" id="7001007">result</span>&nbsp;<span class="op" id="7001014">!=</span>&nbsp;<span class="ident" id="7001017">expected</span>&nbsp;<span class="op" id="7001026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001031">t</span><span class="op" id="7001032">.</span><span class="ident" id="7001033">Fatalf</span><span class="op" id="7001039">(</span><span class="string" id="7001040">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7001072">,</span>&nbsp;<span class="ident" id="7001074">result</span><span class="op" id="7001080">,</span>&nbsp;<span class="ident" id="7001082">expected</span><span class="op" id="7001090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001097">}</span><br>
<span class="lineno">420</span><span class="op" id="7001099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7001102">func</span>&nbsp;<span class="ident" id="7001107">TestUSTARLongName</span><span class="op" id="7001124">(</span><span class="ident" id="7001125">t</span>&nbsp;<span class="op" id="7001127">*</span><span class="ident" id="7001128">testing</span><span class="op" id="7001135">.</span><span class="ident" id="7001136">T</span><span class="op" id="7001137">)</span>&nbsp;<span class="op" id="7001139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7001142">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001240">fileinfo</span><span class="op" id="7001248">,</span>&nbsp;<span class="ident" id="7001250">err</span>&nbsp;<span class="op" id="7001254">:=</span>&nbsp;<span class="ident" id="7001257">os</span><span class="op" id="7001259">.</span><span class="ident" id="7001260">Stat</span><span class="op" id="7001264">(</span><span class="string" id="7001265">&#34;testdata/small.txt&#34;</span><span class="op" id="7001285">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001288">if</span>&nbsp;<span class="ident" id="7001291">err</span>&nbsp;<span class="op" id="7001295">!=</span>&nbsp;<span class="builtintype" id="7001298">nil</span>&nbsp;<span class="op" id="7001302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001306">t</span><span class="op" id="7001307">.</span><span class="ident" id="7001308">Fatal</span><span class="op" id="7001313">(</span><span class="ident" id="7001314">err</span><span class="op" id="7001317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001323">hdr</span><span class="op" id="7001326">,</span>&nbsp;<span class="ident" id="7001328">err</span>&nbsp;<span class="op" id="7001332">:=</span>&nbsp;<span class="ident" id="7001335">FileInfoHeader</span><span class="op" id="7001349">(</span><span class="ident" id="7001350">fileinfo</span><span class="op" id="7001358">,</span>&nbsp;<span class="string" id="7001360">&#34;&#34;</span><span class="op" id="7001362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001365">hdr</span><span class="op" id="7001368">.</span><span class="ident" id="7001369">Typeflag</span>&nbsp;<span class="op" id="7001378">=</span>&nbsp;<span class="ident" id="7001380">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001389">if</span>&nbsp;<span class="ident" id="7001392">err</span>&nbsp;<span class="op" id="7001396">!=</span>&nbsp;<span class="builtintype" id="7001399">nil</span>&nbsp;<span class="op" id="7001403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001407">t</span><span class="op" id="7001408">.</span><span class="ident" id="7001409">Fatalf</span><span class="op" id="7001415">(</span><span class="string" id="7001416">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7001430">,</span>&nbsp;<span class="ident" id="7001432">err</span><span class="op" id="7001435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7001438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7001441">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7001526">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001605">longName</span>&nbsp;<span class="op" id="7001614">:=</span>&nbsp;<span class="string" id="7001617">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001876">hdr</span><span class="op" id="7001879">.</span><span class="ident" id="7001880">Name</span>&nbsp;<span class="op" id="7001885">=</span>&nbsp;<span class="ident" id="7001887">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001898">hdr</span><span class="op" id="7001901">.</span><span class="ident" id="7001902">Size</span>&nbsp;<span class="op" id="7001907">=</span>&nbsp;<span class="num" id="7001909">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001912">var</span>&nbsp;<span class="ident" id="7001916">buf</span>&nbsp;<span class="ident" id="7001920">bytes</span><span class="op" id="7001925">.</span><span class="ident" id="7001926">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7001934">writer</span>&nbsp;<span class="op" id="7001941">:=</span>&nbsp;<span class="ident" id="7001944">NewWriter</span><span class="op" id="7001953">(</span><span class="op" id="7001954">&amp;</span><span class="ident" id="7001955">buf</span><span class="op" id="7001958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7001961">if</span>&nbsp;<span class="ident" id="7001964">err</span>&nbsp;<span class="op" id="7001968">:=</span>&nbsp;<span class="ident" id="7001971">writer</span><span class="op" id="7001977">.</span><span class="ident" id="7001978">WriteHeader</span><span class="op" id="7001989">(</span><span class="ident" id="7001990">hdr</span><span class="op" id="7001993">)</span><span class="op" id="7001994">;</span>&nbsp;<span class="ident" id="7001996">err</span>&nbsp;<span class="op" id="7002000">!=</span>&nbsp;<span class="builtintype" id="7002003">nil</span>&nbsp;<span class="op" id="7002007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002011">t</span><span class="op" id="7002012">.</span><span class="ident" id="7002013">Fatal</span><span class="op" id="7002018">(</span><span class="ident" id="7002019">err</span><span class="op" id="7002022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002028">if</span>&nbsp;<span class="ident" id="7002031">err</span>&nbsp;<span class="op" id="7002035">:=</span>&nbsp;<span class="ident" id="7002038">writer</span><span class="op" id="7002044">.</span><span class="ident" id="7002045">Close</span><span class="op" id="7002050">(</span><span class="op" id="7002051">)</span><span class="op" id="7002052">;</span>&nbsp;<span class="ident" id="7002054">err</span>&nbsp;<span class="op" id="7002058">!=</span>&nbsp;<span class="builtintype" id="7002061">nil</span>&nbsp;<span class="op" id="7002065">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002069">t</span><span class="op" id="7002070">.</span><span class="ident" id="7002071">Fatal</span><span class="op" id="7002076">(</span><span class="ident" id="7002077">err</span><span class="op" id="7002080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7002086">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002148">reader</span>&nbsp;<span class="op" id="7002155">:=</span>&nbsp;<span class="ident" id="7002158">NewReader</span><span class="op" id="7002167">(</span><span class="op" id="7002168">&amp;</span><span class="ident" id="7002169">buf</span><span class="op" id="7002172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002175">hdr</span><span class="op" id="7002178">,</span>&nbsp;<span class="ident" id="7002180">err</span>&nbsp;<span class="op" id="7002184">=</span>&nbsp;<span class="ident" id="7002186">reader</span><span class="op" id="7002192">.</span><span class="ident" id="7002193">Next</span><span class="op" id="7002197">(</span><span class="op" id="7002198">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002201">if</span>&nbsp;<span class="ident" id="7002204">err</span>&nbsp;<span class="op" id="7002208">!=</span>&nbsp;<span class="builtintype" id="7002211">nil</span>&nbsp;<span class="op" id="7002215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002219">t</span><span class="op" id="7002220">.</span><span class="ident" id="7002221">Fatal</span><span class="op" id="7002226">(</span><span class="ident" id="7002227">err</span><span class="op" id="7002230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002236">if</span>&nbsp;<span class="ident" id="7002239">hdr</span><span class="op" id="7002242">.</span><span class="ident" id="7002243">Name</span>&nbsp;<span class="op" id="7002248">!=</span>&nbsp;<span class="ident" id="7002251">longName</span>&nbsp;<span class="op" id="7002260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002264">t</span><span class="op" id="7002265">.</span><span class="ident" id="7002266">Fatal</span><span class="op" id="7002271">(</span><span class="string" id="7002272">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7002300">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002303">}</span><br>
<span class="lineno"></span><span class="op" id="7002305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7002308">func</span>&nbsp;<span class="ident" id="7002313">TestValidTypeflagWithPAXHeader</span><span class="op" id="7002343">(</span><span class="ident" id="7002344">t</span>&nbsp;<span class="op" id="7002346">*</span><span class="ident" id="7002347">testing</span><span class="op" id="7002354">.</span><span class="ident" id="7002355">T</span><span class="op" id="7002356">)</span>&nbsp;<span class="op" id="7002358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002361">var</span>&nbsp;<span class="ident" id="7002365">buffer</span>&nbsp;<span class="ident" id="7002372">bytes</span><span class="op" id="7002377">.</span><span class="ident" id="7002378">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002386">tw</span>&nbsp;<span class="op" id="7002389">:=</span>&nbsp;<span class="ident" id="7002392">NewWriter</span><span class="op" id="7002401">(</span><span class="op" id="7002402">&amp;</span><span class="ident" id="7002403">buffer</span><span class="op" id="7002409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002413">fileName</span>&nbsp;<span class="op" id="7002422">:=</span>&nbsp;<span class="ident" id="7002425">strings</span><span class="op" id="7002432">.</span><span class="ident" id="7002433">Repeat</span><span class="op" id="7002439">(</span><span class="string" id="7002440">&#34;ab&#34;</span><span class="op" id="7002444">,</span>&nbsp;<span class="num" id="7002446">100</span><span class="op" id="7002449">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002453">hdr</span>&nbsp;<span class="op" id="7002457">:=</span>&nbsp;<span class="op" id="7002460">&amp;</span><span class="ident" id="7002461">Header</span><span class="op" id="7002467">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002471">Name</span><span class="op" id="7002475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002481">fileName</span><span class="op" id="7002489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002493">Size</span><span class="op" id="7002497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7002503">4</span><span class="op" id="7002504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002508">Typeflag</span><span class="op" id="7002516">:</span>&nbsp;<span class="num" id="7002518">0</span><span class="op" id="7002519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002525">if</span>&nbsp;<span class="ident" id="7002528">err</span>&nbsp;<span class="op" id="7002532">:=</span>&nbsp;<span class="ident" id="7002535">tw</span><span class="op" id="7002537">.</span><span class="ident" id="7002538">WriteHeader</span><span class="op" id="7002549">(</span><span class="ident" id="7002550">hdr</span><span class="op" id="7002553">)</span><span class="op" id="7002554">;</span>&nbsp;<span class="ident" id="7002556">err</span>&nbsp;<span class="op" id="7002560">!=</span>&nbsp;<span class="builtintype" id="7002563">nil</span>&nbsp;<span class="op" id="7002567">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002571">t</span><span class="op" id="7002572">.</span><span class="ident" id="7002573">Fatalf</span><span class="op" id="7002579">(</span><span class="string" id="7002580">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7002608">,</span>&nbsp;<span class="ident" id="7002610">err</span><span class="op" id="7002613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002619">if</span>&nbsp;<span class="ident" id="7002622">_</span><span class="op" id="7002623">,</span>&nbsp;<span class="ident" id="7002625">err</span>&nbsp;<span class="op" id="7002629">:=</span>&nbsp;<span class="ident" id="7002632">tw</span><span class="op" id="7002634">.</span><span class="ident" id="7002635">Write</span><span class="op" id="7002640">(</span><span class="op" id="7002641">[</span><span class="op" id="7002642">]</span><span class="builtintype" id="7002643">byte</span><span class="op" id="7002647">(</span><span class="string" id="7002648">&#34;fooo&#34;</span><span class="op" id="7002654">)</span><span class="op" id="7002655">)</span><span class="op" id="7002656">;</span>&nbsp;<span class="ident" id="7002658">err</span>&nbsp;<span class="op" id="7002662">!=</span>&nbsp;<span class="builtintype" id="7002665">nil</span>&nbsp;<span class="op" id="7002669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002673">t</span><span class="op" id="7002674">.</span><span class="ident" id="7002675">Fatalf</span><span class="op" id="7002681">(</span><span class="string" id="7002682">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7002719">,</span>&nbsp;<span class="ident" id="7002721">err</span><span class="op" id="7002724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002727">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002730">tw</span><span class="op" id="7002732">.</span><span class="ident" id="7002733">Close</span><span class="op" id="7002738">(</span><span class="op" id="7002739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002743">tr</span>&nbsp;<span class="op" id="7002746">:=</span>&nbsp;<span class="ident" id="7002749">NewReader</span><span class="op" id="7002758">(</span><span class="op" id="7002759">&amp;</span><span class="ident" id="7002760">buffer</span><span class="op" id="7002766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002770">for</span>&nbsp;<span class="op" id="7002774">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002778">header</span><span class="op" id="7002784">,</span>&nbsp;<span class="ident" id="7002786">err</span>&nbsp;<span class="op" id="7002790">:=</span>&nbsp;<span class="ident" id="7002793">tr</span><span class="op" id="7002795">.</span><span class="ident" id="7002796">Next</span><span class="op" id="7002800">(</span><span class="op" id="7002801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002805">if</span>&nbsp;<span class="ident" id="7002808">err</span>&nbsp;<span class="op" id="7002812">==</span>&nbsp;<span class="ident" id="7002815">io</span><span class="op" id="7002817">.</span><span class="ident" id="7002818">EOF</span>&nbsp;<span class="op" id="7002822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002827">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002839">if</span>&nbsp;<span class="ident" id="7002842">err</span>&nbsp;<span class="op" id="7002846">!=</span>&nbsp;<span class="builtintype" id="7002849">nil</span>&nbsp;<span class="op" id="7002853">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002858">t</span><span class="op" id="7002859">.</span><span class="ident" id="7002860">Fatalf</span><span class="op" id="7002866">(</span><span class="string" id="7002867">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7002894">,</span>&nbsp;<span class="ident" id="7002896">err</span><span class="op" id="7002899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7002903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7002907">if</span>&nbsp;<span class="ident" id="7002910">header</span><span class="op" id="7002916">.</span><span class="ident" id="7002917">Typeflag</span>&nbsp;<span class="op" id="7002926">!=</span>&nbsp;<span class="num" id="7002929">0</span>&nbsp;<span class="op" id="7002931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7002936">t</span><span class="op" id="7002937">.</span><span class="ident" id="7002938">Fatalf</span><span class="op" id="7002944">(</span><span class="string" id="7002945">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7002982">,</span>&nbsp;<span class="ident" id="7002984">header</span><span class="op" id="7002990">.</span><span class="ident" id="7002991">Typeflag</span><span class="op" id="7002999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7003003">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7003006">}</span><br>
<span class="lineno"></span><span class="op" id="7003008">}</span>
</div>
</body>
</html>
