<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7950155">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7950210">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7950264">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7950315">package</span>&nbsp;<span class="ident" id="7950323">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950328">import</span>&nbsp;<span class="op" id="7950335">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7950338">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7950346">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7950353">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7950364">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7950371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7950374">var</span>&nbsp;<span class="ident" id="7950378">testDNSFlood</span>&nbsp;<span class="op" id="7950391">=</span>&nbsp;<span class="ident" id="7950393">flag</span><span class="op" id="7950397">.</span><span class="ident" id="7950398">Bool</span><span class="op" id="7950402">(</span><span class="string" id="7950403">&#34;dnsflood&#34;</span><span class="op" id="7950413">,</span>&nbsp;<span class="builtintype" id="7950415">false</span><span class="op" id="7950420">,</span>&nbsp;<span class="string" id="7950422">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="7950458">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7950461">func</span>&nbsp;<span class="ident" id="7950466">TestDNSThreadLimit</span><span class="op" id="7950484">(</span><span class="ident" id="7950485">t</span>&nbsp;<span class="op" id="7950487">*</span><span class="ident" id="7950488">testing</span><span class="op" id="7950495">.</span><span class="ident" id="7950496">T</span><span class="op" id="7950497">)</span>&nbsp;<span class="op" id="7950499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950502">if</span>&nbsp;<span class="op" id="7950505">!</span><span class="op" id="7950506">*</span><span class="ident" id="7950507">testDNSFlood</span>&nbsp;<span class="op" id="7950520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950524">t</span><span class="op" id="7950525">.</span><span class="ident" id="7950526">Skip</span><span class="op" id="7950530">(</span><span class="string" id="7950531">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7950571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950574">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950578">const</span>&nbsp;<span class="ident" id="7950584">N</span>&nbsp;<span class="op" id="7950586">=</span>&nbsp;<span class="num" id="7950588">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950595">c</span>&nbsp;<span class="op" id="7950597">:=</span>&nbsp;<span class="builtinfunc" id="7950600">make</span><span class="op" id="7950604">(</span><span class="keyword" id="7950605">chan</span>&nbsp;<span class="builtintype" id="7950610">int</span><span class="op" id="7950613">,</span>&nbsp;<span class="ident" id="7950615">N</span><span class="op" id="7950616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950619">for</span>&nbsp;<span class="ident" id="7950623">i</span>&nbsp;<span class="op" id="7950625">:=</span>&nbsp;<span class="num" id="7950628">0</span><span class="op" id="7950629">;</span>&nbsp;<span class="ident" id="7950631">i</span>&nbsp;<span class="op" id="7950633">&lt;</span>&nbsp;<span class="ident" id="7950635">N</span><span class="op" id="7950636">;</span>&nbsp;<span class="ident" id="7950638">i</span><span class="op" id="7950639">++</span>&nbsp;<span class="op" id="7950642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950646">go</span>&nbsp;<span class="keyword" id="7950649">func</span><span class="op" id="7950653">(</span><span class="ident" id="7950654">i</span>&nbsp;<span class="builtintype" id="7950656">int</span><span class="op" id="7950659">)</span>&nbsp;<span class="op" id="7950661">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950666">LookupIP</span><span class="op" id="7950674">(</span><span class="ident" id="7950675">fmt</span><span class="op" id="7950678">.</span><span class="ident" id="7950679">Sprintf</span><span class="op" id="7950686">(</span><span class="string" id="7950687">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="7950711">,</span>&nbsp;<span class="ident" id="7950713">i</span><span class="op" id="7950714">)</span><span class="op" id="7950715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7950720">c</span>&nbsp;<span class="op" id="7950722">&lt;-</span>&nbsp;<span class="num" id="7950725">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950729">}</span><span class="op" id="7950730">(</span><span class="ident" id="7950731">i</span><span class="op" id="7950732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950738">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950798">for</span>&nbsp;<span class="ident" id="7950802">i</span>&nbsp;<span class="op" id="7950804">:=</span>&nbsp;<span class="num" id="7950807">0</span><span class="op" id="7950808">;</span>&nbsp;<span class="ident" id="7950810">i</span>&nbsp;<span class="op" id="7950812">&lt;</span>&nbsp;<span class="ident" id="7950814">N</span><span class="op" id="7950815">*</span><span class="num" id="7950816">9</span><span class="op" id="7950817">/</span><span class="num" id="7950818">10</span><span class="op" id="7950820">;</span>&nbsp;<span class="ident" id="7950822">i</span><span class="op" id="7950823">++</span>&nbsp;<span class="op" id="7950826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950830">if</span>&nbsp;<span class="ident" id="7950833">i</span><span class="op" id="7950834">%</span><span class="num" id="7950835">100</span>&nbsp;<span class="op" id="7950839">==</span>&nbsp;<span class="num" id="7950842">0</span>&nbsp;<span class="op" id="7950844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950849">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950891">&lt;-</span><span class="ident" id="7950893">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7950896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7950900">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="7950935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="7950938">func</span>&nbsp;<span class="ident" id="7950943">TestLookupIPDeadline</span><span class="op" id="7950963">(</span><span class="ident" id="7950964">t</span>&nbsp;<span class="op" id="7950966">*</span><span class="ident" id="7950967">testing</span><span class="op" id="7950974">.</span><span class="ident" id="7950975">T</span><span class="op" id="7950976">)</span>&nbsp;<span class="op" id="7950978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7950981">if</span>&nbsp;<span class="op" id="7950984">!</span><span class="op" id="7950985">*</span><span class="ident" id="7950986">testDNSFlood</span>&nbsp;<span class="op" id="7950999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951003">t</span><span class="op" id="7951004">.</span><span class="ident" id="7951005">Skip</span><span class="op" id="7951009">(</span><span class="string" id="7951010">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7951050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951057">const</span>&nbsp;<span class="ident" id="7951063">N</span>&nbsp;<span class="op" id="7951065">=</span>&nbsp;<span class="num" id="7951067">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951073">const</span>&nbsp;<span class="ident" id="7951079">timeout</span>&nbsp;<span class="op" id="7951087">=</span>&nbsp;<span class="num" id="7951089">3</span>&nbsp;<span class="op" id="7951091">*</span>&nbsp;<span class="ident" id="7951093">time</span><span class="op" id="7951097">.</span><span class="ident" id="7951098">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951106">c</span>&nbsp;<span class="op" id="7951108">:=</span>&nbsp;<span class="builtinfunc" id="7951111">make</span><span class="op" id="7951115">(</span><span class="keyword" id="7951116">chan</span>&nbsp;<span class="builtintype" id="7951121">error</span><span class="op" id="7951126">,</span>&nbsp;<span class="num" id="7951128">2</span><span class="op" id="7951129">*</span><span class="ident" id="7951130">N</span><span class="op" id="7951131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951134">for</span>&nbsp;<span class="ident" id="7951138">i</span>&nbsp;<span class="op" id="7951140">:=</span>&nbsp;<span class="num" id="7951143">0</span><span class="op" id="7951144">;</span>&nbsp;<span class="ident" id="7951146">i</span>&nbsp;<span class="op" id="7951148">&lt;</span>&nbsp;<span class="ident" id="7951150">N</span><span class="op" id="7951151">;</span>&nbsp;<span class="ident" id="7951153">i</span><span class="op" id="7951154">++</span>&nbsp;<span class="op" id="7951157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951161">name</span>&nbsp;<span class="op" id="7951166">:=</span>&nbsp;<span class="ident" id="7951169">fmt</span><span class="op" id="7951172">.</span><span class="ident" id="7951173">Sprintf</span><span class="op" id="7951180">(</span><span class="string" id="7951181">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="7951205">,</span>&nbsp;<span class="ident" id="7951207">i</span><span class="op" id="7951208">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951212">go</span>&nbsp;<span class="keyword" id="7951215">func</span><span class="op" id="7951219">(</span><span class="op" id="7951220">)</span>&nbsp;<span class="op" id="7951222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951227">_</span><span class="op" id="7951228">,</span>&nbsp;<span class="ident" id="7951230">err</span>&nbsp;<span class="op" id="7951234">:=</span>&nbsp;<span class="ident" id="7951237">lookupIPDeadline</span><span class="op" id="7951253">(</span><span class="ident" id="7951254">name</span><span class="op" id="7951258">,</span>&nbsp;<span class="ident" id="7951260">time</span><span class="op" id="7951264">.</span><span class="ident" id="7951265">Now</span><span class="op" id="7951268">(</span><span class="op" id="7951269">)</span><span class="op" id="7951270">.</span><span class="ident" id="7951271">Add</span><span class="op" id="7951274">(</span><span class="ident" id="7951275">timeout</span><span class="op" id="7951282">/</span><span class="num" id="7951283">2</span><span class="op" id="7951284">)</span><span class="op" id="7951285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951290">c</span>&nbsp;<span class="op" id="7951292">&lt;-</span>&nbsp;<span class="ident" id="7951295">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951301">}</span><span class="op" id="7951302">(</span><span class="op" id="7951303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951307">go</span>&nbsp;<span class="keyword" id="7951310">func</span><span class="op" id="7951314">(</span><span class="op" id="7951315">)</span>&nbsp;<span class="op" id="7951317">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951322">_</span><span class="op" id="7951323">,</span>&nbsp;<span class="ident" id="7951325">err</span>&nbsp;<span class="op" id="7951329">:=</span>&nbsp;<span class="ident" id="7951332">lookupIPDeadline</span><span class="op" id="7951348">(</span><span class="ident" id="7951349">name</span><span class="op" id="7951353">,</span>&nbsp;<span class="ident" id="7951355">time</span><span class="op" id="7951359">.</span><span class="ident" id="7951360">Now</span><span class="op" id="7951363">(</span><span class="op" id="7951364">)</span><span class="op" id="7951365">.</span><span class="ident" id="7951366">Add</span><span class="op" id="7951369">(</span><span class="ident" id="7951370">timeout</span><span class="op" id="7951377">)</span><span class="op" id="7951378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951383">c</span>&nbsp;<span class="op" id="7951385">&lt;-</span>&nbsp;<span class="ident" id="7951388">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951394">}</span><span class="op" id="7951395">(</span><span class="op" id="7951396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951402">qstats</span>&nbsp;<span class="op" id="7951409">:=</span>&nbsp;<span class="keyword" id="7951412">struct</span>&nbsp;<span class="op" id="7951419">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951423">succeeded</span><span class="op" id="7951432">,</span>&nbsp;<span class="ident" id="7951434">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7951449">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951455">timeout</span><span class="op" id="7951462">,</span>&nbsp;<span class="ident" id="7951464">temporary</span><span class="op" id="7951473">,</span>&nbsp;<span class="ident" id="7951475">other</span>&nbsp;<span class="builtintype" id="7951481">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951487">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7951513">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951518">}</span><span class="op" id="7951519">{</span><span class="op" id="7951520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951523">deadline</span>&nbsp;<span class="op" id="7951532">:=</span>&nbsp;<span class="ident" id="7951535">time</span><span class="op" id="7951539">.</span><span class="ident" id="7951540">After</span><span class="op" id="7951545">(</span><span class="ident" id="7951546">timeout</span>&nbsp;<span class="op" id="7951554">+</span>&nbsp;<span class="ident" id="7951556">time</span><span class="op" id="7951560">.</span><span class="ident" id="7951561">Second</span><span class="op" id="7951567">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951570">for</span>&nbsp;<span class="ident" id="7951574">i</span>&nbsp;<span class="op" id="7951576">:=</span>&nbsp;<span class="num" id="7951579">0</span><span class="op" id="7951580">;</span>&nbsp;<span class="ident" id="7951582">i</span>&nbsp;<span class="op" id="7951584">&lt;</span>&nbsp;<span class="num" id="7951586">2</span><span class="op" id="7951587">*</span><span class="ident" id="7951588">N</span><span class="op" id="7951589">;</span>&nbsp;<span class="ident" id="7951591">i</span><span class="op" id="7951592">++</span>&nbsp;<span class="op" id="7951595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951599">select</span>&nbsp;<span class="op" id="7951606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951610">case</span>&nbsp;<span class="op" id="7951615">&lt;-</span><span class="ident" id="7951617">deadline</span><span class="op" id="7951625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951630">t</span><span class="op" id="7951631">.</span><span class="ident" id="7951632">Fatal</span><span class="op" id="7951637">(</span><span class="string" id="7951638">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="7951657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951661">case</span>&nbsp;<span class="ident" id="7951666">err</span>&nbsp;<span class="op" id="7951670">:=</span>&nbsp;<span class="op" id="7951673">&lt;-</span><span class="ident" id="7951675">c</span><span class="op" id="7951676">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951681">switch</span>&nbsp;<span class="ident" id="7951688">err</span>&nbsp;<span class="op" id="7951692">:=</span>&nbsp;<span class="ident" id="7951695">err</span><span class="op" id="7951698">.</span><span class="op" id="7951699">(</span><span class="keyword" id="7951700">type</span><span class="op" id="7951704">)</span>&nbsp;<span class="op" id="7951706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951711">case</span>&nbsp;<span class="ident" id="7951716">nil</span><span class="op" id="7951719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951725">qstats</span><span class="op" id="7951731">.</span><span class="ident" id="7951732">succeeded</span><span class="op" id="7951741">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951747">case</span>&nbsp;<span class="ident" id="7951752">Error</span><span class="op" id="7951757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951763">qstats</span><span class="op" id="7951769">.</span><span class="ident" id="7951770">failed</span><span class="op" id="7951776">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951783">if</span>&nbsp;<span class="ident" id="7951786">err</span><span class="op" id="7951789">.</span><span class="ident" id="7951790">Timeout</span><span class="op" id="7951797">(</span><span class="op" id="7951798">)</span>&nbsp;<span class="op" id="7951800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951807">qstats</span><span class="op" id="7951813">.</span><span class="ident" id="7951814">timeout</span><span class="op" id="7951821">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951834">if</span>&nbsp;<span class="ident" id="7951837">err</span><span class="op" id="7951840">.</span><span class="ident" id="7951841">Temporary</span><span class="op" id="7951850">(</span><span class="op" id="7951851">)</span>&nbsp;<span class="op" id="7951853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951860">qstats</span><span class="op" id="7951866">.</span><span class="ident" id="7951867">temporary</span><span class="op" id="7951876">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951889">if</span>&nbsp;<span class="op" id="7951892">!</span><span class="ident" id="7951893">err</span><span class="op" id="7951896">.</span><span class="ident" id="7951897">Timeout</span><span class="op" id="7951904">(</span><span class="op" id="7951905">)</span>&nbsp;<span class="op" id="7951907">&amp;&amp;</span>&nbsp;<span class="op" id="7951910">!</span><span class="ident" id="7951911">err</span><span class="op" id="7951914">.</span><span class="ident" id="7951915">Temporary</span><span class="op" id="7951924">(</span><span class="op" id="7951925">)</span>&nbsp;<span class="op" id="7951927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951934">qstats</span><span class="op" id="7951940">.</span><span class="ident" id="7951941">other</span><span class="op" id="7951946">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7951953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7951958">default</span><span class="op" id="7951965">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951971">qstats</span><span class="op" id="7951977">.</span><span class="ident" id="7951978">failed</span><span class="op" id="7951984">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7951991">qstats</span><span class="op" id="7951997">.</span><span class="ident" id="7951998">unknown</span><span class="op" id="7952005">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7952018">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952022">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952084">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952147">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952205">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952268">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952326">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7952389">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7952427">t</span><span class="op" id="7952428">.</span><span class="ident" id="7952429">Logf</span><span class="op" id="7952433">(</span><span class="string" id="7952434">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="7952508">,</span>&nbsp;<span class="ident" id="7952510">qstats</span><span class="op" id="7952516">.</span><span class="ident" id="7952517">succeeded</span><span class="op" id="7952526">,</span>&nbsp;<span class="ident" id="7952528">qstats</span><span class="op" id="7952534">.</span><span class="ident" id="7952535">failed</span><span class="op" id="7952541">,</span>&nbsp;<span class="ident" id="7952543">qstats</span><span class="op" id="7952549">.</span><span class="ident" id="7952550">timeout</span><span class="op" id="7952557">,</span>&nbsp;<span class="ident" id="7952559">qstats</span><span class="op" id="7952565">.</span><span class="ident" id="7952566">temporary</span><span class="op" id="7952575">,</span>&nbsp;<span class="ident" id="7952577">qstats</span><span class="op" id="7952583">.</span><span class="ident" id="7952584">other</span><span class="op" id="7952589">,</span>&nbsp;<span class="ident" id="7952591">qstats</span><span class="op" id="7952597">.</span><span class="ident" id="7952598">unknown</span><span class="op" id="7952605">)</span><br>
<span class="lineno"></span><span class="op" id="7952607">}</span>
</div>
</body>
</html>
