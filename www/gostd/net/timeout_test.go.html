<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html" class="current">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6789705">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6789760">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6789814">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6789865">package</span>&nbsp;<span class="ident" id="6789873">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6789878">import</span>&nbsp;<span class="op" id="6789885">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789888">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789895">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789901">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789914">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789925">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6789936">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6789943">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6789946">func</span>&nbsp;<span class="ident" id="6789951">isTimeout</span><span class="op" id="6789960">(</span><span class="ident" id="6789961">err</span>&nbsp;<span class="builtintype" id="6789965">error</span><span class="op" id="6789970">)</span>&nbsp;<span class="builtintype" id="6789972">bool</span>&nbsp;<span class="op" id="6789977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6789980">e</span><span class="op" id="6789981">,</span>&nbsp;<span class="ident" id="6789983">ok</span>&nbsp;<span class="op" id="6789986">:=</span>&nbsp;<span class="ident" id="6789989">err</span><span class="op" id="6789992">.</span><span class="op" id="6789993">(</span><span class="ident" id="6789994">Error</span><span class="op" id="6789999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790002">return</span>&nbsp;<span class="ident" id="6790009">ok</span>&nbsp;<span class="op" id="6790012">&amp;&amp;</span>&nbsp;<span class="ident" id="6790015">e</span><span class="op" id="6790016">.</span><span class="ident" id="6790017">Timeout</span><span class="op" id="6790024">(</span><span class="op" id="6790025">)</span><br>
<span class="lineno"></span><span class="op" id="6790027">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6790030">type</span>&nbsp;<span class="ident" id="6790035">copyRes</span>&nbsp;<span class="keyword" id="6790043">struct</span>&nbsp;<span class="op" id="6790050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790053">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6790057">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790064">err</span>&nbsp;<span class="builtintype" id="6790068">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790075">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6790079">time</span><span class="op" id="6790083">.</span><span class="ident" id="6790084">Duration</span><br>
<span class="lineno">25</span><span class="op" id="6790093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6790096">func</span>&nbsp;<span class="ident" id="6790101">TestAcceptTimeout</span><span class="op" id="6790118">(</span><span class="ident" id="6790119">t</span>&nbsp;<span class="op" id="6790121">*</span><span class="ident" id="6790122">testing</span><span class="op" id="6790129">.</span><span class="ident" id="6790130">T</span><span class="op" id="6790131">)</span>&nbsp;<span class="op" id="6790133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790136">switch</span>&nbsp;<span class="ident" id="6790143">runtime</span><span class="op" id="6790150">.</span><span class="ident" id="6790151">GOOS</span>&nbsp;<span class="op" id="6790156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790159">case</span>&nbsp;<span class="string" id="6790164">&#34;plan9&#34;</span><span class="op" id="6790171">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790175">t</span><span class="op" id="6790176">.</span><span class="ident" id="6790177">Skipf</span><span class="op" id="6790182">(</span><span class="string" id="6790183">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6790204">,</span>&nbsp;<span class="ident" id="6790206">runtime</span><span class="op" id="6790213">.</span><span class="ident" id="6790214">GOOS</span><span class="op" id="6790218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790225">ln</span>&nbsp;<span class="op" id="6790228">:=</span>&nbsp;<span class="ident" id="6790231">newLocalListener</span><span class="op" id="6790247">(</span><span class="ident" id="6790248">t</span><span class="op" id="6790249">)</span><span class="op" id="6790250">.</span><span class="op" id="6790251">(</span><span class="op" id="6790252">*</span><span class="ident" id="6790253">TCPListener</span><span class="op" id="6790264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790267">defer</span>&nbsp;<span class="ident" id="6790273">ln</span><span class="op" id="6790275">.</span><span class="ident" id="6790276">Close</span><span class="op" id="6790281">(</span><span class="op" id="6790282">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790285">ln</span><span class="op" id="6790287">.</span><span class="ident" id="6790288">SetDeadline</span><span class="op" id="6790299">(</span><span class="ident" id="6790300">time</span><span class="op" id="6790304">.</span><span class="ident" id="6790305">Now</span><span class="op" id="6790308">(</span><span class="op" id="6790309">)</span><span class="op" id="6790310">.</span><span class="ident" id="6790311">Add</span><span class="op" id="6790314">(</span><span class="op" id="6790315">-</span><span class="num" id="6790316">1</span>&nbsp;<span class="op" id="6790318">*</span>&nbsp;<span class="ident" id="6790320">time</span><span class="op" id="6790324">.</span><span class="ident" id="6790325">Second</span><span class="op" id="6790331">)</span><span class="op" id="6790332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790335">if</span>&nbsp;<span class="ident" id="6790338">_</span><span class="op" id="6790339">,</span>&nbsp;<span class="ident" id="6790341">err</span>&nbsp;<span class="op" id="6790345">:=</span>&nbsp;<span class="ident" id="6790348">ln</span><span class="op" id="6790350">.</span><span class="ident" id="6790351">Accept</span><span class="op" id="6790357">(</span><span class="op" id="6790358">)</span><span class="op" id="6790359">;</span>&nbsp;<span class="op" id="6790361">!</span><span class="ident" id="6790362">isTimeout</span><span class="op" id="6790371">(</span><span class="ident" id="6790372">err</span><span class="op" id="6790375">)</span>&nbsp;<span class="op" id="6790377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790381">t</span><span class="op" id="6790382">.</span><span class="ident" id="6790383">Fatalf</span><span class="op" id="6790389">(</span><span class="string" id="6790390">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6790423">,</span>&nbsp;<span class="ident" id="6790425">errTimeout</span><span class="op" id="6790435">,</span>&nbsp;<span class="ident" id="6790437">err</span><span class="op" id="6790440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790446">if</span>&nbsp;<span class="ident" id="6790449">_</span><span class="op" id="6790450">,</span>&nbsp;<span class="ident" id="6790452">err</span>&nbsp;<span class="op" id="6790456">:=</span>&nbsp;<span class="ident" id="6790459">ln</span><span class="op" id="6790461">.</span><span class="ident" id="6790462">Accept</span><span class="op" id="6790468">(</span><span class="op" id="6790469">)</span><span class="op" id="6790470">;</span>&nbsp;<span class="op" id="6790472">!</span><span class="ident" id="6790473">isTimeout</span><span class="op" id="6790482">(</span><span class="ident" id="6790483">err</span><span class="op" id="6790486">)</span>&nbsp;<span class="op" id="6790488">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790492">t</span><span class="op" id="6790493">.</span><span class="ident" id="6790494">Fatalf</span><span class="op" id="6790500">(</span><span class="string" id="6790501">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6790534">,</span>&nbsp;<span class="ident" id="6790536">errTimeout</span><span class="op" id="6790546">,</span>&nbsp;<span class="ident" id="6790548">err</span><span class="op" id="6790551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790557">ln</span><span class="op" id="6790559">.</span><span class="ident" id="6790560">SetDeadline</span><span class="op" id="6790571">(</span><span class="ident" id="6790572">time</span><span class="op" id="6790576">.</span><span class="ident" id="6790577">Now</span><span class="op" id="6790580">(</span><span class="op" id="6790581">)</span><span class="op" id="6790582">.</span><span class="ident" id="6790583">Add</span><span class="op" id="6790586">(</span><span class="num" id="6790587">100</span>&nbsp;<span class="op" id="6790591">*</span>&nbsp;<span class="ident" id="6790593">time</span><span class="op" id="6790597">.</span><span class="ident" id="6790598">Millisecond</span><span class="op" id="6790609">)</span><span class="op" id="6790610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790613">if</span>&nbsp;<span class="ident" id="6790616">_</span><span class="op" id="6790617">,</span>&nbsp;<span class="ident" id="6790619">err</span>&nbsp;<span class="op" id="6790623">:=</span>&nbsp;<span class="ident" id="6790626">ln</span><span class="op" id="6790628">.</span><span class="ident" id="6790629">Accept</span><span class="op" id="6790635">(</span><span class="op" id="6790636">)</span><span class="op" id="6790637">;</span>&nbsp;<span class="op" id="6790639">!</span><span class="ident" id="6790640">isTimeout</span><span class="op" id="6790649">(</span><span class="ident" id="6790650">err</span><span class="op" id="6790653">)</span>&nbsp;<span class="op" id="6790655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790659">t</span><span class="op" id="6790660">.</span><span class="ident" id="6790661">Fatalf</span><span class="op" id="6790667">(</span><span class="string" id="6790668">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6790701">,</span>&nbsp;<span class="ident" id="6790703">errTimeout</span><span class="op" id="6790713">,</span>&nbsp;<span class="ident" id="6790715">err</span><span class="op" id="6790718">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790724">if</span>&nbsp;<span class="ident" id="6790727">_</span><span class="op" id="6790728">,</span>&nbsp;<span class="ident" id="6790730">err</span>&nbsp;<span class="op" id="6790734">:=</span>&nbsp;<span class="ident" id="6790737">ln</span><span class="op" id="6790739">.</span><span class="ident" id="6790740">Accept</span><span class="op" id="6790746">(</span><span class="op" id="6790747">)</span><span class="op" id="6790748">;</span>&nbsp;<span class="op" id="6790750">!</span><span class="ident" id="6790751">isTimeout</span><span class="op" id="6790760">(</span><span class="ident" id="6790761">err</span><span class="op" id="6790764">)</span>&nbsp;<span class="op" id="6790766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790770">t</span><span class="op" id="6790771">.</span><span class="ident" id="6790772">Fatalf</span><span class="op" id="6790778">(</span><span class="string" id="6790779">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6790812">,</span>&nbsp;<span class="ident" id="6790814">errTimeout</span><span class="op" id="6790824">,</span>&nbsp;<span class="ident" id="6790826">err</span><span class="op" id="6790829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790835">ln</span><span class="op" id="6790837">.</span><span class="ident" id="6790838">SetDeadline</span><span class="op" id="6790849">(</span><span class="ident" id="6790850">noDeadline</span><span class="op" id="6790860">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790863">errc</span>&nbsp;<span class="op" id="6790868">:=</span>&nbsp;<span class="builtinfunc" id="6790871">make</span><span class="op" id="6790875">(</span><span class="keyword" id="6790876">chan</span>&nbsp;<span class="builtintype" id="6790881">error</span><span class="op" id="6790886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790889">go</span>&nbsp;<span class="keyword" id="6790892">func</span><span class="op" id="6790896">(</span><span class="op" id="6790897">)</span>&nbsp;<span class="op" id="6790899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790903">_</span><span class="op" id="6790904">,</span>&nbsp;<span class="ident" id="6790906">err</span>&nbsp;<span class="op" id="6790910">:=</span>&nbsp;<span class="ident" id="6790913">ln</span><span class="op" id="6790915">.</span><span class="ident" id="6790916">Accept</span><span class="op" id="6790922">(</span><span class="op" id="6790923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790927">errc</span>&nbsp;<span class="op" id="6790932">&lt;-</span>&nbsp;<span class="ident" id="6790935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6790940">}</span><span class="op" id="6790941">(</span><span class="op" id="6790942">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6790945">time</span><span class="op" id="6790949">.</span><span class="ident" id="6790950">Sleep</span><span class="op" id="6790955">(</span><span class="num" id="6790956">100</span>&nbsp;<span class="op" id="6790960">*</span>&nbsp;<span class="ident" id="6790962">time</span><span class="op" id="6790966">.</span><span class="ident" id="6790967">Millisecond</span><span class="op" id="6790978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790981">select</span>&nbsp;<span class="op" id="6790988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6790991">case</span>&nbsp;<span class="ident" id="6790996">err</span>&nbsp;<span class="op" id="6791000">:=</span>&nbsp;<span class="op" id="6791003">&lt;-</span><span class="ident" id="6791005">errc</span><span class="op" id="6791009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791013">t</span><span class="op" id="6791014">.</span><span class="ident" id="6791015">Fatalf</span><span class="op" id="6791021">(</span><span class="string" id="6791022">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6791082">,</span>&nbsp;<span class="ident" id="6791084">err</span><span class="op" id="6791087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791090">default</span><span class="op" id="6791097">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791103">ln</span><span class="op" id="6791105">.</span><span class="ident" id="6791106">Close</span><span class="op" id="6791111">(</span><span class="op" id="6791112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791115">switch</span>&nbsp;<span class="ident" id="6791122">nerr</span>&nbsp;<span class="op" id="6791127">:=</span>&nbsp;<span class="op" id="6791130">&lt;-</span><span class="ident" id="6791132">errc</span><span class="op" id="6791136">;</span>&nbsp;<span class="ident" id="6791138">err</span>&nbsp;<span class="op" id="6791142">:=</span>&nbsp;<span class="ident" id="6791145">nerr</span><span class="op" id="6791149">.</span><span class="op" id="6791150">(</span><span class="keyword" id="6791151">type</span><span class="op" id="6791155">)</span>&nbsp;<span class="op" id="6791157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791160">case</span>&nbsp;<span class="op" id="6791165">*</span><span class="ident" id="6791166">OpError</span><span class="op" id="6791173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791177">if</span>&nbsp;<span class="ident" id="6791180">err</span><span class="op" id="6791183">.</span><span class="ident" id="6791184">Err</span>&nbsp;<span class="op" id="6791188">!=</span>&nbsp;<span class="ident" id="6791191">errClosing</span>&nbsp;<span class="op" id="6791202">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791207">t</span><span class="op" id="6791208">.</span><span class="ident" id="6791209">Fatalf</span><span class="op" id="6791215">(</span><span class="string" id="6791216">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6791249">,</span>&nbsp;<span class="ident" id="6791251">errClosing</span><span class="op" id="6791261">,</span>&nbsp;<span class="ident" id="6791263">err</span><span class="op" id="6791266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791273">default</span><span class="op" id="6791280">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791284">if</span>&nbsp;<span class="ident" id="6791287">err</span>&nbsp;<span class="op" id="6791291">!=</span>&nbsp;<span class="ident" id="6791294">errClosing</span>&nbsp;<span class="op" id="6791305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791310">t</span><span class="op" id="6791311">.</span><span class="ident" id="6791312">Fatalf</span><span class="op" id="6791318">(</span><span class="string" id="6791319">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6791352">,</span>&nbsp;<span class="ident" id="6791354">errClosing</span><span class="op" id="6791364">,</span>&nbsp;<span class="ident" id="6791366">err</span><span class="op" id="6791369">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791376">}</span><br>
<span class="lineno"></span><span class="op" id="6791378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6791381">func</span>&nbsp;<span class="ident" id="6791386">TestReadTimeout</span><span class="op" id="6791401">(</span><span class="ident" id="6791402">t</span>&nbsp;<span class="op" id="6791404">*</span><span class="ident" id="6791405">testing</span><span class="op" id="6791412">.</span><span class="ident" id="6791413">T</span><span class="op" id="6791414">)</span>&nbsp;<span class="op" id="6791416">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791419">switch</span>&nbsp;<span class="ident" id="6791426">runtime</span><span class="op" id="6791433">.</span><span class="ident" id="6791434">GOOS</span>&nbsp;<span class="op" id="6791439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791442">case</span>&nbsp;<span class="string" id="6791447">&#34;plan9&#34;</span><span class="op" id="6791454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791458">t</span><span class="op" id="6791459">.</span><span class="ident" id="6791460">Skipf</span><span class="op" id="6791465">(</span><span class="string" id="6791466">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6791487">,</span>&nbsp;<span class="ident" id="6791489">runtime</span><span class="op" id="6791496">.</span><span class="ident" id="6791497">GOOS</span><span class="op" id="6791501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791508">ln</span>&nbsp;<span class="op" id="6791511">:=</span>&nbsp;<span class="ident" id="6791514">newLocalListener</span><span class="op" id="6791530">(</span><span class="ident" id="6791531">t</span><span class="op" id="6791532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791535">defer</span>&nbsp;<span class="ident" id="6791541">ln</span><span class="op" id="6791543">.</span><span class="ident" id="6791544">Close</span><span class="op" id="6791549">(</span><span class="op" id="6791550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791553">c</span><span class="op" id="6791554">,</span>&nbsp;<span class="ident" id="6791556">err</span>&nbsp;<span class="op" id="6791560">:=</span>&nbsp;<span class="ident" id="6791563">DialTCP</span><span class="op" id="6791570">(</span><span class="string" id="6791571">&#34;tcp&#34;</span><span class="op" id="6791576">,</span>&nbsp;<span class="builtintype" id="6791578">nil</span><span class="op" id="6791581">,</span>&nbsp;<span class="ident" id="6791583">ln</span><span class="op" id="6791585">.</span><span class="ident" id="6791586">Addr</span><span class="op" id="6791590">(</span><span class="op" id="6791591">)</span><span class="op" id="6791592">.</span><span class="op" id="6791593">(</span><span class="op" id="6791594">*</span><span class="ident" id="6791595">TCPAddr</span><span class="op" id="6791602">)</span><span class="op" id="6791603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791606">if</span>&nbsp;<span class="ident" id="6791609">err</span>&nbsp;<span class="op" id="6791613">!=</span>&nbsp;<span class="builtintype" id="6791616">nil</span>&nbsp;<span class="op" id="6791620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791624">t</span><span class="op" id="6791625">.</span><span class="ident" id="6791626">Fatalf</span><span class="op" id="6791632">(</span><span class="string" id="6791633">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6791646">,</span>&nbsp;<span class="ident" id="6791648">err</span><span class="op" id="6791651">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791657">defer</span>&nbsp;<span class="ident" id="6791663">c</span><span class="op" id="6791664">.</span><span class="ident" id="6791665">Close</span><span class="op" id="6791670">(</span><span class="op" id="6791671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791674">c</span><span class="op" id="6791675">.</span><span class="ident" id="6791676">SetDeadline</span><span class="op" id="6791687">(</span><span class="ident" id="6791688">time</span><span class="op" id="6791692">.</span><span class="ident" id="6791693">Now</span><span class="op" id="6791696">(</span><span class="op" id="6791697">)</span><span class="op" id="6791698">.</span><span class="ident" id="6791699">Add</span><span class="op" id="6791702">(</span><span class="ident" id="6791703">time</span><span class="op" id="6791707">.</span><span class="ident" id="6791708">Hour</span><span class="op" id="6791712">)</span><span class="op" id="6791713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791716">c</span><span class="op" id="6791717">.</span><span class="ident" id="6791718">SetReadDeadline</span><span class="op" id="6791733">(</span><span class="ident" id="6791734">time</span><span class="op" id="6791738">.</span><span class="ident" id="6791739">Now</span><span class="op" id="6791742">(</span><span class="op" id="6791743">)</span><span class="op" id="6791744">.</span><span class="ident" id="6791745">Add</span><span class="op" id="6791748">(</span><span class="op" id="6791749">-</span><span class="num" id="6791750">1</span>&nbsp;<span class="op" id="6791752">*</span>&nbsp;<span class="ident" id="6791754">time</span><span class="op" id="6791758">.</span><span class="ident" id="6791759">Second</span><span class="op" id="6791765">)</span><span class="op" id="6791766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791769">buf</span>&nbsp;<span class="op" id="6791773">:=</span>&nbsp;<span class="builtinfunc" id="6791776">make</span><span class="op" id="6791780">(</span><span class="op" id="6791781">[</span><span class="op" id="6791782">]</span><span class="builtintype" id="6791783">byte</span><span class="op" id="6791787">,</span>&nbsp;<span class="num" id="6791789">1</span><span class="op" id="6791790">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791793">if</span>&nbsp;<span class="ident" id="6791796">_</span><span class="op" id="6791797">,</span>&nbsp;<span class="ident" id="6791799">err</span>&nbsp;<span class="op" id="6791803">=</span>&nbsp;<span class="ident" id="6791805">c</span><span class="op" id="6791806">.</span><span class="ident" id="6791807">Read</span><span class="op" id="6791811">(</span><span class="ident" id="6791812">buf</span><span class="op" id="6791815">)</span><span class="op" id="6791816">;</span>&nbsp;<span class="op" id="6791818">!</span><span class="ident" id="6791819">isTimeout</span><span class="op" id="6791828">(</span><span class="ident" id="6791829">err</span><span class="op" id="6791832">)</span>&nbsp;<span class="op" id="6791834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791838">t</span><span class="op" id="6791839">.</span><span class="ident" id="6791840">Fatalf</span><span class="op" id="6791846">(</span><span class="string" id="6791847">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6791878">,</span>&nbsp;<span class="ident" id="6791880">errTimeout</span><span class="op" id="6791890">,</span>&nbsp;<span class="ident" id="6791892">err</span><span class="op" id="6791895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6791898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6791901">if</span>&nbsp;<span class="ident" id="6791904">_</span><span class="op" id="6791905">,</span>&nbsp;<span class="ident" id="6791907">err</span>&nbsp;<span class="op" id="6791911">=</span>&nbsp;<span class="ident" id="6791913">c</span><span class="op" id="6791914">.</span><span class="ident" id="6791915">Read</span><span class="op" id="6791919">(</span><span class="ident" id="6791920">buf</span><span class="op" id="6791923">)</span><span class="op" id="6791924">;</span>&nbsp;<span class="op" id="6791926">!</span><span class="ident" id="6791927">isTimeout</span><span class="op" id="6791936">(</span><span class="ident" id="6791937">err</span><span class="op" id="6791940">)</span>&nbsp;<span class="op" id="6791942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6791946">t</span><span class="op" id="6791947">.</span><span class="ident" id="6791948">Fatalf</span><span class="op" id="6791954">(</span><span class="string" id="6791955">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6791986">,</span>&nbsp;<span class="ident" id="6791988">errTimeout</span><span class="op" id="6791998">,</span>&nbsp;<span class="ident" id="6792000">err</span><span class="op" id="6792003">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792009">c</span><span class="op" id="6792010">.</span><span class="ident" id="6792011">SetDeadline</span><span class="op" id="6792022">(</span><span class="ident" id="6792023">time</span><span class="op" id="6792027">.</span><span class="ident" id="6792028">Now</span><span class="op" id="6792031">(</span><span class="op" id="6792032">)</span><span class="op" id="6792033">.</span><span class="ident" id="6792034">Add</span><span class="op" id="6792037">(</span><span class="num" id="6792038">100</span>&nbsp;<span class="op" id="6792042">*</span>&nbsp;<span class="ident" id="6792044">time</span><span class="op" id="6792048">.</span><span class="ident" id="6792049">Millisecond</span><span class="op" id="6792060">)</span><span class="op" id="6792061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792064">if</span>&nbsp;<span class="ident" id="6792067">_</span><span class="op" id="6792068">,</span>&nbsp;<span class="ident" id="6792070">err</span>&nbsp;<span class="op" id="6792074">=</span>&nbsp;<span class="ident" id="6792076">c</span><span class="op" id="6792077">.</span><span class="ident" id="6792078">Read</span><span class="op" id="6792082">(</span><span class="ident" id="6792083">buf</span><span class="op" id="6792086">)</span><span class="op" id="6792087">;</span>&nbsp;<span class="op" id="6792089">!</span><span class="ident" id="6792090">isTimeout</span><span class="op" id="6792099">(</span><span class="ident" id="6792100">err</span><span class="op" id="6792103">)</span>&nbsp;<span class="op" id="6792105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792109">t</span><span class="op" id="6792110">.</span><span class="ident" id="6792111">Fatalf</span><span class="op" id="6792117">(</span><span class="string" id="6792118">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6792149">,</span>&nbsp;<span class="ident" id="6792151">errTimeout</span><span class="op" id="6792161">,</span>&nbsp;<span class="ident" id="6792163">err</span><span class="op" id="6792166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792169">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792172">if</span>&nbsp;<span class="ident" id="6792175">_</span><span class="op" id="6792176">,</span>&nbsp;<span class="ident" id="6792178">err</span>&nbsp;<span class="op" id="6792182">=</span>&nbsp;<span class="ident" id="6792184">c</span><span class="op" id="6792185">.</span><span class="ident" id="6792186">Read</span><span class="op" id="6792190">(</span><span class="ident" id="6792191">buf</span><span class="op" id="6792194">)</span><span class="op" id="6792195">;</span>&nbsp;<span class="op" id="6792197">!</span><span class="ident" id="6792198">isTimeout</span><span class="op" id="6792207">(</span><span class="ident" id="6792208">err</span><span class="op" id="6792211">)</span>&nbsp;<span class="op" id="6792213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792217">t</span><span class="op" id="6792218">.</span><span class="ident" id="6792219">Fatalf</span><span class="op" id="6792225">(</span><span class="string" id="6792226">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6792257">,</span>&nbsp;<span class="ident" id="6792259">errTimeout</span><span class="op" id="6792269">,</span>&nbsp;<span class="ident" id="6792271">err</span><span class="op" id="6792274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792280">c</span><span class="op" id="6792281">.</span><span class="ident" id="6792282">SetReadDeadline</span><span class="op" id="6792297">(</span><span class="ident" id="6792298">noDeadline</span><span class="op" id="6792308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792311">c</span><span class="op" id="6792312">.</span><span class="ident" id="6792313">SetWriteDeadline</span><span class="op" id="6792329">(</span><span class="ident" id="6792330">time</span><span class="op" id="6792334">.</span><span class="ident" id="6792335">Now</span><span class="op" id="6792338">(</span><span class="op" id="6792339">)</span><span class="op" id="6792340">.</span><span class="ident" id="6792341">Add</span><span class="op" id="6792344">(</span><span class="op" id="6792345">-</span><span class="num" id="6792346">1</span>&nbsp;<span class="op" id="6792348">*</span>&nbsp;<span class="ident" id="6792350">time</span><span class="op" id="6792354">.</span><span class="ident" id="6792355">Second</span><span class="op" id="6792361">)</span><span class="op" id="6792362">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792365">errc</span>&nbsp;<span class="op" id="6792370">:=</span>&nbsp;<span class="builtinfunc" id="6792373">make</span><span class="op" id="6792377">(</span><span class="keyword" id="6792378">chan</span>&nbsp;<span class="builtintype" id="6792383">error</span><span class="op" id="6792388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792391">go</span>&nbsp;<span class="keyword" id="6792394">func</span><span class="op" id="6792398">(</span><span class="op" id="6792399">)</span>&nbsp;<span class="op" id="6792401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792405">_</span><span class="op" id="6792406">,</span>&nbsp;<span class="ident" id="6792408">err</span>&nbsp;<span class="op" id="6792412">:=</span>&nbsp;<span class="ident" id="6792415">c</span><span class="op" id="6792416">.</span><span class="ident" id="6792417">Read</span><span class="op" id="6792421">(</span><span class="ident" id="6792422">buf</span><span class="op" id="6792425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792429">errc</span>&nbsp;<span class="op" id="6792434">&lt;-</span>&nbsp;<span class="ident" id="6792437">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792442">}</span><span class="op" id="6792443">(</span><span class="op" id="6792444">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792447">time</span><span class="op" id="6792451">.</span><span class="ident" id="6792452">Sleep</span><span class="op" id="6792457">(</span><span class="num" id="6792458">100</span>&nbsp;<span class="op" id="6792462">*</span>&nbsp;<span class="ident" id="6792464">time</span><span class="op" id="6792468">.</span><span class="ident" id="6792469">Millisecond</span><span class="op" id="6792480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792483">select</span>&nbsp;<span class="op" id="6792490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792493">case</span>&nbsp;<span class="ident" id="6792498">err</span>&nbsp;<span class="op" id="6792502">:=</span>&nbsp;<span class="op" id="6792505">&lt;-</span><span class="ident" id="6792507">errc</span><span class="op" id="6792511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792515">t</span><span class="op" id="6792516">.</span><span class="ident" id="6792517">Fatalf</span><span class="op" id="6792523">(</span><span class="string" id="6792524">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6792582">,</span>&nbsp;<span class="ident" id="6792584">err</span><span class="op" id="6792587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792590">default</span><span class="op" id="6792597">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792603">c</span><span class="op" id="6792604">.</span><span class="ident" id="6792605">Close</span><span class="op" id="6792610">(</span><span class="op" id="6792611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792614">switch</span>&nbsp;<span class="ident" id="6792621">nerr</span>&nbsp;<span class="op" id="6792626">:=</span>&nbsp;<span class="op" id="6792629">&lt;-</span><span class="ident" id="6792631">errc</span><span class="op" id="6792635">;</span>&nbsp;<span class="ident" id="6792637">err</span>&nbsp;<span class="op" id="6792641">:=</span>&nbsp;<span class="ident" id="6792644">nerr</span><span class="op" id="6792648">.</span><span class="op" id="6792649">(</span><span class="keyword" id="6792650">type</span><span class="op" id="6792654">)</span>&nbsp;<span class="op" id="6792656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792659">case</span>&nbsp;<span class="op" id="6792664">*</span><span class="ident" id="6792665">OpError</span><span class="op" id="6792672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792676">if</span>&nbsp;<span class="ident" id="6792679">err</span><span class="op" id="6792682">.</span><span class="ident" id="6792683">Err</span>&nbsp;<span class="op" id="6792687">!=</span>&nbsp;<span class="ident" id="6792690">errClosing</span>&nbsp;<span class="op" id="6792701">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792706">t</span><span class="op" id="6792707">.</span><span class="ident" id="6792708">Fatalf</span><span class="op" id="6792714">(</span><span class="string" id="6792715">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6792746">,</span>&nbsp;<span class="ident" id="6792748">errClosing</span><span class="op" id="6792758">,</span>&nbsp;<span class="ident" id="6792760">err</span><span class="op" id="6792763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792770">default</span><span class="op" id="6792777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792781">if</span>&nbsp;<span class="ident" id="6792784">err</span>&nbsp;<span class="op" id="6792788">==</span>&nbsp;<span class="ident" id="6792791">io</span><span class="op" id="6792793">.</span><span class="ident" id="6792794">EOF</span>&nbsp;<span class="op" id="6792798">&amp;&amp;</span>&nbsp;<span class="ident" id="6792801">runtime</span><span class="op" id="6792808">.</span><span class="ident" id="6792809">GOOS</span>&nbsp;<span class="op" id="6792814">==</span>&nbsp;<span class="string" id="6792817">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6792824">{</span>&nbsp;<span class="comment" id="6792826">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792868">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6792880">if</span>&nbsp;<span class="ident" id="6792883">err</span>&nbsp;<span class="op" id="6792887">!=</span>&nbsp;<span class="ident" id="6792890">errClosing</span>&nbsp;<span class="op" id="6792901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6792906">t</span><span class="op" id="6792907">.</span><span class="ident" id="6792908">Fatalf</span><span class="op" id="6792914">(</span><span class="string" id="6792915">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6792946">,</span>&nbsp;<span class="ident" id="6792948">errClosing</span><span class="op" id="6792958">,</span>&nbsp;<span class="ident" id="6792960">err</span><span class="op" id="6792963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6792970">}</span><br>
<span class="lineno">130</span><span class="op" id="6792972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6792975">func</span>&nbsp;<span class="ident" id="6792980">TestWriteTimeout</span><span class="op" id="6792996">(</span><span class="ident" id="6792997">t</span>&nbsp;<span class="op" id="6792999">*</span><span class="ident" id="6793000">testing</span><span class="op" id="6793007">.</span><span class="ident" id="6793008">T</span><span class="op" id="6793009">)</span>&nbsp;<span class="op" id="6793011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793014">switch</span>&nbsp;<span class="ident" id="6793021">runtime</span><span class="op" id="6793028">.</span><span class="ident" id="6793029">GOOS</span>&nbsp;<span class="op" id="6793034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793037">case</span>&nbsp;<span class="string" id="6793042">&#34;plan9&#34;</span><span class="op" id="6793049">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793053">t</span><span class="op" id="6793054">.</span><span class="ident" id="6793055">Skipf</span><span class="op" id="6793060">(</span><span class="string" id="6793061">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6793082">,</span>&nbsp;<span class="ident" id="6793084">runtime</span><span class="op" id="6793091">.</span><span class="ident" id="6793092">GOOS</span><span class="op" id="6793096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793103">ln</span>&nbsp;<span class="op" id="6793106">:=</span>&nbsp;<span class="ident" id="6793109">newLocalListener</span><span class="op" id="6793125">(</span><span class="ident" id="6793126">t</span><span class="op" id="6793127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793130">defer</span>&nbsp;<span class="ident" id="6793136">ln</span><span class="op" id="6793138">.</span><span class="ident" id="6793139">Close</span><span class="op" id="6793144">(</span><span class="op" id="6793145">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793148">c</span><span class="op" id="6793149">,</span>&nbsp;<span class="ident" id="6793151">err</span>&nbsp;<span class="op" id="6793155">:=</span>&nbsp;<span class="ident" id="6793158">DialTCP</span><span class="op" id="6793165">(</span><span class="string" id="6793166">&#34;tcp&#34;</span><span class="op" id="6793171">,</span>&nbsp;<span class="builtintype" id="6793173">nil</span><span class="op" id="6793176">,</span>&nbsp;<span class="ident" id="6793178">ln</span><span class="op" id="6793180">.</span><span class="ident" id="6793181">Addr</span><span class="op" id="6793185">(</span><span class="op" id="6793186">)</span><span class="op" id="6793187">.</span><span class="op" id="6793188">(</span><span class="op" id="6793189">*</span><span class="ident" id="6793190">TCPAddr</span><span class="op" id="6793197">)</span><span class="op" id="6793198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793201">if</span>&nbsp;<span class="ident" id="6793204">err</span>&nbsp;<span class="op" id="6793208">!=</span>&nbsp;<span class="builtintype" id="6793211">nil</span>&nbsp;<span class="op" id="6793215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793219">t</span><span class="op" id="6793220">.</span><span class="ident" id="6793221">Fatalf</span><span class="op" id="6793227">(</span><span class="string" id="6793228">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6793241">,</span>&nbsp;<span class="ident" id="6793243">err</span><span class="op" id="6793246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793252">defer</span>&nbsp;<span class="ident" id="6793258">c</span><span class="op" id="6793259">.</span><span class="ident" id="6793260">Close</span><span class="op" id="6793265">(</span><span class="op" id="6793266">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793269">c</span><span class="op" id="6793270">.</span><span class="ident" id="6793271">SetDeadline</span><span class="op" id="6793282">(</span><span class="ident" id="6793283">time</span><span class="op" id="6793287">.</span><span class="ident" id="6793288">Now</span><span class="op" id="6793291">(</span><span class="op" id="6793292">)</span><span class="op" id="6793293">.</span><span class="ident" id="6793294">Add</span><span class="op" id="6793297">(</span><span class="ident" id="6793298">time</span><span class="op" id="6793302">.</span><span class="ident" id="6793303">Hour</span><span class="op" id="6793307">)</span><span class="op" id="6793308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793311">c</span><span class="op" id="6793312">.</span><span class="ident" id="6793313">SetWriteDeadline</span><span class="op" id="6793329">(</span><span class="ident" id="6793330">time</span><span class="op" id="6793334">.</span><span class="ident" id="6793335">Now</span><span class="op" id="6793338">(</span><span class="op" id="6793339">)</span><span class="op" id="6793340">.</span><span class="ident" id="6793341">Add</span><span class="op" id="6793344">(</span><span class="op" id="6793345">-</span><span class="num" id="6793346">1</span>&nbsp;<span class="op" id="6793348">*</span>&nbsp;<span class="ident" id="6793350">time</span><span class="op" id="6793354">.</span><span class="ident" id="6793355">Second</span><span class="op" id="6793361">)</span><span class="op" id="6793362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793365">buf</span>&nbsp;<span class="op" id="6793369">:=</span>&nbsp;<span class="builtinfunc" id="6793372">make</span><span class="op" id="6793376">(</span><span class="op" id="6793377">[</span><span class="op" id="6793378">]</span><span class="builtintype" id="6793379">byte</span><span class="op" id="6793383">,</span>&nbsp;<span class="num" id="6793385">4096</span><span class="op" id="6793389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793392">writeUntilTimeout</span>&nbsp;<span class="op" id="6793410">:=</span>&nbsp;<span class="keyword" id="6793413">func</span><span class="op" id="6793417">(</span><span class="op" id="6793418">)</span>&nbsp;<span class="op" id="6793420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793424">for</span>&nbsp;<span class="op" id="6793428">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793433">_</span><span class="op" id="6793434">,</span>&nbsp;<span class="ident" id="6793436">err</span>&nbsp;<span class="op" id="6793440">:=</span>&nbsp;<span class="ident" id="6793443">c</span><span class="op" id="6793444">.</span><span class="ident" id="6793445">Write</span><span class="op" id="6793450">(</span><span class="ident" id="6793451">buf</span><span class="op" id="6793454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793459">if</span>&nbsp;<span class="ident" id="6793462">err</span>&nbsp;<span class="op" id="6793466">!=</span>&nbsp;<span class="builtintype" id="6793469">nil</span>&nbsp;<span class="op" id="6793473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793479">if</span>&nbsp;<span class="ident" id="6793482">isTimeout</span><span class="op" id="6793491">(</span><span class="ident" id="6793492">err</span><span class="op" id="6793495">)</span>&nbsp;<span class="op" id="6793497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793515">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793521">t</span><span class="op" id="6793522">.</span><span class="ident" id="6793523">Fatalf</span><span class="op" id="6793529">(</span><span class="string" id="6793530">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6793562">,</span>&nbsp;<span class="ident" id="6793564">errTimeout</span><span class="op" id="6793574">,</span>&nbsp;<span class="ident" id="6793576">err</span><span class="op" id="6793579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793594">writeUntilTimeout</span><span class="op" id="6793611">(</span><span class="op" id="6793612">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793615">c</span><span class="op" id="6793616">.</span><span class="ident" id="6793617">SetDeadline</span><span class="op" id="6793628">(</span><span class="ident" id="6793629">time</span><span class="op" id="6793633">.</span><span class="ident" id="6793634">Now</span><span class="op" id="6793637">(</span><span class="op" id="6793638">)</span><span class="op" id="6793639">.</span><span class="ident" id="6793640">Add</span><span class="op" id="6793643">(</span><span class="num" id="6793644">10</span>&nbsp;<span class="op" id="6793647">*</span>&nbsp;<span class="ident" id="6793649">time</span><span class="op" id="6793653">.</span><span class="ident" id="6793654">Millisecond</span><span class="op" id="6793665">)</span><span class="op" id="6793666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793669">writeUntilTimeout</span><span class="op" id="6793686">(</span><span class="op" id="6793687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793690">writeUntilTimeout</span><span class="op" id="6793707">(</span><span class="op" id="6793708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793711">c</span><span class="op" id="6793712">.</span><span class="ident" id="6793713">SetWriteDeadline</span><span class="op" id="6793729">(</span><span class="ident" id="6793730">noDeadline</span><span class="op" id="6793740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793743">c</span><span class="op" id="6793744">.</span><span class="ident" id="6793745">SetReadDeadline</span><span class="op" id="6793760">(</span><span class="ident" id="6793761">time</span><span class="op" id="6793765">.</span><span class="ident" id="6793766">Now</span><span class="op" id="6793769">(</span><span class="op" id="6793770">)</span><span class="op" id="6793771">.</span><span class="ident" id="6793772">Add</span><span class="op" id="6793775">(</span><span class="op" id="6793776">-</span><span class="num" id="6793777">1</span>&nbsp;<span class="op" id="6793779">*</span>&nbsp;<span class="ident" id="6793781">time</span><span class="op" id="6793785">.</span><span class="ident" id="6793786">Second</span><span class="op" id="6793792">)</span><span class="op" id="6793793">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793796">errc</span>&nbsp;<span class="op" id="6793801">:=</span>&nbsp;<span class="builtinfunc" id="6793804">make</span><span class="op" id="6793808">(</span><span class="keyword" id="6793809">chan</span>&nbsp;<span class="builtintype" id="6793814">error</span><span class="op" id="6793819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793822">go</span>&nbsp;<span class="keyword" id="6793825">func</span><span class="op" id="6793829">(</span><span class="op" id="6793830">)</span>&nbsp;<span class="op" id="6793832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793836">for</span>&nbsp;<span class="op" id="6793840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793845">_</span><span class="op" id="6793846">,</span>&nbsp;<span class="ident" id="6793848">err</span>&nbsp;<span class="op" id="6793852">:=</span>&nbsp;<span class="ident" id="6793855">c</span><span class="op" id="6793856">.</span><span class="ident" id="6793857">Write</span><span class="op" id="6793862">(</span><span class="ident" id="6793863">buf</span><span class="op" id="6793866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793871">if</span>&nbsp;<span class="ident" id="6793874">err</span>&nbsp;<span class="op" id="6793878">!=</span>&nbsp;<span class="builtintype" id="6793881">nil</span>&nbsp;<span class="op" id="6793885">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793891">errc</span>&nbsp;<span class="op" id="6793896">&lt;-</span>&nbsp;<span class="ident" id="6793899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6793913">}</span><span class="op" id="6793914">(</span><span class="op" id="6793915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793918">time</span><span class="op" id="6793922">.</span><span class="ident" id="6793923">Sleep</span><span class="op" id="6793928">(</span><span class="num" id="6793929">100</span>&nbsp;<span class="op" id="6793933">*</span>&nbsp;<span class="ident" id="6793935">time</span><span class="op" id="6793939">.</span><span class="ident" id="6793940">Millisecond</span><span class="op" id="6793951">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793954">select</span>&nbsp;<span class="op" id="6793961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6793964">case</span>&nbsp;<span class="ident" id="6793969">err</span>&nbsp;<span class="op" id="6793973">:=</span>&nbsp;<span class="op" id="6793976">&lt;-</span><span class="ident" id="6793978">errc</span><span class="op" id="6793982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6793986">t</span><span class="op" id="6793987">.</span><span class="ident" id="6793988">Fatalf</span><span class="op" id="6793994">(</span><span class="string" id="6793995">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6794054">,</span>&nbsp;<span class="ident" id="6794056">err</span><span class="op" id="6794059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794062">default</span><span class="op" id="6794069">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794072">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794075">c</span><span class="op" id="6794076">.</span><span class="ident" id="6794077">Close</span><span class="op" id="6794082">(</span><span class="op" id="6794083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794086">switch</span>&nbsp;<span class="ident" id="6794093">nerr</span>&nbsp;<span class="op" id="6794098">:=</span>&nbsp;<span class="op" id="6794101">&lt;-</span><span class="ident" id="6794103">errc</span><span class="op" id="6794107">;</span>&nbsp;<span class="ident" id="6794109">err</span>&nbsp;<span class="op" id="6794113">:=</span>&nbsp;<span class="ident" id="6794116">nerr</span><span class="op" id="6794120">.</span><span class="op" id="6794121">(</span><span class="keyword" id="6794122">type</span><span class="op" id="6794126">)</span>&nbsp;<span class="op" id="6794128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794131">case</span>&nbsp;<span class="op" id="6794136">*</span><span class="ident" id="6794137">OpError</span><span class="op" id="6794144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794148">if</span>&nbsp;<span class="ident" id="6794151">err</span><span class="op" id="6794154">.</span><span class="ident" id="6794155">Err</span>&nbsp;<span class="op" id="6794159">!=</span>&nbsp;<span class="ident" id="6794162">errClosing</span>&nbsp;<span class="op" id="6794173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794178">t</span><span class="op" id="6794179">.</span><span class="ident" id="6794180">Fatalf</span><span class="op" id="6794186">(</span><span class="string" id="6794187">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6794219">,</span>&nbsp;<span class="ident" id="6794221">errClosing</span><span class="op" id="6794231">,</span>&nbsp;<span class="ident" id="6794233">err</span><span class="op" id="6794236">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794243">default</span><span class="op" id="6794250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794254">if</span>&nbsp;<span class="ident" id="6794257">err</span>&nbsp;<span class="op" id="6794261">!=</span>&nbsp;<span class="ident" id="6794264">errClosing</span>&nbsp;<span class="op" id="6794275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794280">t</span><span class="op" id="6794281">.</span><span class="ident" id="6794282">Fatalf</span><span class="op" id="6794288">(</span><span class="string" id="6794289">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6794321">,</span>&nbsp;<span class="ident" id="6794323">errClosing</span><span class="op" id="6794333">,</span>&nbsp;<span class="ident" id="6794335">err</span><span class="op" id="6794338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794342">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794345">}</span><br>
<span class="lineno"></span><span class="op" id="6794347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6794350">func</span>&nbsp;<span class="ident" id="6794355">testTimeout</span><span class="op" id="6794366">(</span><span class="ident" id="6794367">t</span>&nbsp;<span class="op" id="6794369">*</span><span class="ident" id="6794370">testing</span><span class="op" id="6794377">.</span><span class="ident" id="6794378">T</span><span class="op" id="6794379">,</span>&nbsp;<span class="ident" id="6794381">net</span><span class="op" id="6794384">,</span>&nbsp;<span class="ident" id="6794386">addr</span>&nbsp;<span class="builtintype" id="6794391">string</span><span class="op" id="6794397">,</span>&nbsp;<span class="ident" id="6794399">readFrom</span>&nbsp;<span class="builtintype" id="6794408">bool</span><span class="op" id="6794412">)</span>&nbsp;<span class="op" id="6794414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794417">c</span><span class="op" id="6794418">,</span>&nbsp;<span class="ident" id="6794420">err</span>&nbsp;<span class="op" id="6794424">:=</span>&nbsp;<span class="ident" id="6794427">Dial</span><span class="op" id="6794431">(</span><span class="ident" id="6794432">net</span><span class="op" id="6794435">,</span>&nbsp;<span class="ident" id="6794437">addr</span><span class="op" id="6794441">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794444">if</span>&nbsp;<span class="ident" id="6794447">err</span>&nbsp;<span class="op" id="6794451">!=</span>&nbsp;<span class="builtintype" id="6794454">nil</span>&nbsp;<span class="op" id="6794458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794462">t</span><span class="op" id="6794463">.</span><span class="ident" id="6794464">Errorf</span><span class="op" id="6794470">(</span><span class="string" id="6794471">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6794496">,</span>&nbsp;<span class="ident" id="6794498">net</span><span class="op" id="6794501">,</span>&nbsp;<span class="ident" id="6794503">addr</span><span class="op" id="6794507">,</span>&nbsp;<span class="ident" id="6794509">err</span><span class="op" id="6794512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794516">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794527">defer</span>&nbsp;<span class="ident" id="6794533">c</span><span class="op" id="6794534">.</span><span class="ident" id="6794535">Close</span><span class="op" id="6794540">(</span><span class="op" id="6794541">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794544">what</span>&nbsp;<span class="op" id="6794549">:=</span>&nbsp;<span class="string" id="6794552">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794560">if</span>&nbsp;<span class="ident" id="6794563">readFrom</span>&nbsp;<span class="op" id="6794572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794576">what</span>&nbsp;<span class="op" id="6794581">=</span>&nbsp;<span class="string" id="6794583">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794599">errc</span>&nbsp;<span class="op" id="6794604">:=</span>&nbsp;<span class="builtinfunc" id="6794607">make</span><span class="op" id="6794611">(</span><span class="keyword" id="6794612">chan</span>&nbsp;<span class="builtintype" id="6794617">error</span><span class="op" id="6794622">,</span>&nbsp;<span class="num" id="6794624">1</span><span class="op" id="6794625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794628">go</span>&nbsp;<span class="keyword" id="6794631">func</span><span class="op" id="6794635">(</span><span class="op" id="6794636">)</span>&nbsp;<span class="op" id="6794638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794642">t0</span>&nbsp;<span class="op" id="6794645">:=</span>&nbsp;<span class="ident" id="6794648">time</span><span class="op" id="6794652">.</span><span class="ident" id="6794653">Now</span><span class="op" id="6794656">(</span><span class="op" id="6794657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794661">c</span><span class="op" id="6794662">.</span><span class="ident" id="6794663">SetReadDeadline</span><span class="op" id="6794678">(</span><span class="ident" id="6794679">time</span><span class="op" id="6794683">.</span><span class="ident" id="6794684">Now</span><span class="op" id="6794687">(</span><span class="op" id="6794688">)</span><span class="op" id="6794689">.</span><span class="ident" id="6794690">Add</span><span class="op" id="6794693">(</span><span class="num" id="6794694">100</span>&nbsp;<span class="op" id="6794698">*</span>&nbsp;<span class="ident" id="6794700">time</span><span class="op" id="6794704">.</span><span class="ident" id="6794705">Millisecond</span><span class="op" id="6794716">)</span><span class="op" id="6794717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794721">var</span>&nbsp;<span class="ident" id="6794725">b</span>&nbsp;<span class="op" id="6794727">[</span><span class="num" id="6794728">100</span><span class="op" id="6794731">]</span><span class="builtintype" id="6794732">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794739">var</span>&nbsp;<span class="ident" id="6794743">n</span>&nbsp;<span class="builtintype" id="6794745">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794751">var</span>&nbsp;<span class="ident" id="6794755">err</span>&nbsp;<span class="builtintype" id="6794759">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794767">if</span>&nbsp;<span class="ident" id="6794770">readFrom</span>&nbsp;<span class="op" id="6794779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794784">n</span><span class="op" id="6794785">,</span>&nbsp;<span class="ident" id="6794787">_</span><span class="op" id="6794788">,</span>&nbsp;<span class="ident" id="6794790">err</span>&nbsp;<span class="op" id="6794794">=</span>&nbsp;<span class="ident" id="6794796">c</span><span class="op" id="6794797">.</span><span class="op" id="6794798">(</span><span class="ident" id="6794799">PacketConn</span><span class="op" id="6794809">)</span><span class="op" id="6794810">.</span><span class="ident" id="6794811">ReadFrom</span><span class="op" id="6794819">(</span><span class="ident" id="6794820">b</span><span class="op" id="6794821">[</span><span class="num" id="6794822">0</span><span class="op" id="6794823">:</span><span class="op" id="6794824">]</span><span class="op" id="6794825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794829">}</span>&nbsp;<span class="keyword" id="6794831">else</span>&nbsp;<span class="op" id="6794836">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794841">n</span><span class="op" id="6794842">,</span>&nbsp;<span class="ident" id="6794844">err</span>&nbsp;<span class="op" id="6794848">=</span>&nbsp;<span class="ident" id="6794850">c</span><span class="op" id="6794851">.</span><span class="ident" id="6794852">Read</span><span class="op" id="6794856">(</span><span class="ident" id="6794857">b</span><span class="op" id="6794858">[</span><span class="num" id="6794859">0</span><span class="op" id="6794860">:</span><span class="op" id="6794861">]</span><span class="op" id="6794862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6794866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794870">t1</span>&nbsp;<span class="op" id="6794873">:=</span>&nbsp;<span class="ident" id="6794876">time</span><span class="op" id="6794880">.</span><span class="ident" id="6794881">Now</span><span class="op" id="6794884">(</span><span class="op" id="6794885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6794889">if</span>&nbsp;<span class="ident" id="6794892">n</span>&nbsp;<span class="op" id="6794894">!=</span>&nbsp;<span class="num" id="6794897">0</span>&nbsp;<span class="op" id="6794899">||</span>&nbsp;<span class="ident" id="6794902">err</span>&nbsp;<span class="op" id="6794906">==</span>&nbsp;<span class="builtintype" id="6794909">nil</span>&nbsp;<span class="op" id="6794913">||</span>&nbsp;<span class="op" id="6794916">!</span><span class="ident" id="6794917">err</span><span class="op" id="6794920">.</span><span class="op" id="6794921">(</span><span class="ident" id="6794922">Error</span><span class="op" id="6794927">)</span><span class="op" id="6794928">.</span><span class="ident" id="6794929">Timeout</span><span class="op" id="6794936">(</span><span class="op" id="6794937">)</span>&nbsp;<span class="op" id="6794939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6794944">errc</span>&nbsp;<span class="op" id="6794949">&lt;-</span>&nbsp;<span class="ident" id="6794952">fmt</span><span class="op" id="6794955">.</span><span class="ident" id="6794956">Errorf</span><span class="op" id="6794962">(</span><span class="string" id="6794963">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6795009">,</span>&nbsp;<span class="ident" id="6795011">what</span><span class="op" id="6795015">,</span>&nbsp;<span class="ident" id="6795017">net</span><span class="op" id="6795020">,</span>&nbsp;<span class="ident" id="6795022">addr</span><span class="op" id="6795026">,</span>&nbsp;<span class="ident" id="6795028">n</span><span class="op" id="6795029">,</span>&nbsp;<span class="ident" id="6795031">err</span><span class="op" id="6795034">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795052">if</span>&nbsp;<span class="ident" id="6795055">dt</span>&nbsp;<span class="op" id="6795058">:=</span>&nbsp;<span class="ident" id="6795061">t1</span><span class="op" id="6795063">.</span><span class="ident" id="6795064">Sub</span><span class="op" id="6795067">(</span><span class="ident" id="6795068">t0</span><span class="op" id="6795070">)</span><span class="op" id="6795071">;</span>&nbsp;<span class="ident" id="6795073">dt</span>&nbsp;<span class="op" id="6795076">&lt;</span>&nbsp;<span class="num" id="6795078">50</span><span class="op" id="6795080">*</span><span class="ident" id="6795081">time</span><span class="op" id="6795085">.</span><span class="ident" id="6795086">Millisecond</span>&nbsp;<span class="op" id="6795098">||</span>&nbsp;<span class="op" id="6795101">!</span><span class="ident" id="6795102">testing</span><span class="op" id="6795109">.</span><span class="ident" id="6795110">Short</span><span class="op" id="6795115">(</span><span class="op" id="6795116">)</span>&nbsp;<span class="op" id="6795118">&amp;&amp;</span>&nbsp;<span class="ident" id="6795121">dt</span>&nbsp;<span class="op" id="6795124">&gt;</span>&nbsp;<span class="num" id="6795126">250</span><span class="op" id="6795129">*</span><span class="ident" id="6795130">time</span><span class="op" id="6795134">.</span><span class="ident" id="6795135">Millisecond</span>&nbsp;<span class="op" id="6795147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795152">errc</span>&nbsp;<span class="op" id="6795157">&lt;-</span>&nbsp;<span class="ident" id="6795160">fmt</span><span class="op" id="6795163">.</span><span class="ident" id="6795164">Errorf</span><span class="op" id="6795170">(</span><span class="string" id="6795171">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6795206">,</span>&nbsp;<span class="ident" id="6795208">what</span><span class="op" id="6795212">,</span>&nbsp;<span class="ident" id="6795214">net</span><span class="op" id="6795217">,</span>&nbsp;<span class="ident" id="6795219">addr</span><span class="op" id="6795223">,</span>&nbsp;<span class="ident" id="6795225">dt</span><span class="op" id="6795227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795232">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795245">errc</span>&nbsp;<span class="op" id="6795250">&lt;-</span>&nbsp;<span class="builtintype" id="6795253">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795258">}</span><span class="op" id="6795259">(</span><span class="op" id="6795260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795263">select</span>&nbsp;<span class="op" id="6795270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795273">case</span>&nbsp;<span class="ident" id="6795278">err</span>&nbsp;<span class="op" id="6795282">:=</span>&nbsp;<span class="op" id="6795285">&lt;-</span><span class="ident" id="6795287">errc</span><span class="op" id="6795291">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795295">if</span>&nbsp;<span class="ident" id="6795298">err</span>&nbsp;<span class="op" id="6795302">!=</span>&nbsp;<span class="builtintype" id="6795305">nil</span>&nbsp;<span class="op" id="6795309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795314">t</span><span class="op" id="6795315">.</span><span class="ident" id="6795316">Error</span><span class="op" id="6795321">(</span><span class="ident" id="6795322">err</span><span class="op" id="6795325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795332">case</span>&nbsp;<span class="op" id="6795337">&lt;-</span><span class="ident" id="6795339">time</span><span class="op" id="6795343">.</span><span class="ident" id="6795344">After</span><span class="op" id="6795349">(</span><span class="num" id="6795350">1</span>&nbsp;<span class="op" id="6795352">*</span>&nbsp;<span class="ident" id="6795354">time</span><span class="op" id="6795358">.</span><span class="ident" id="6795359">Second</span><span class="op" id="6795365">)</span><span class="op" id="6795366">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795370">t</span><span class="op" id="6795371">.</span><span class="ident" id="6795372">Errorf</span><span class="op" id="6795378">(</span><span class="string" id="6795379">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6795425">,</span>&nbsp;<span class="ident" id="6795427">what</span><span class="op" id="6795431">,</span>&nbsp;<span class="ident" id="6795433">net</span><span class="op" id="6795436">,</span>&nbsp;<span class="ident" id="6795438">addr</span><span class="op" id="6795442">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795445">}</span><br>
<span class="lineno"></span><span class="op" id="6795447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6795450">func</span>&nbsp;<span class="ident" id="6795455">TestTimeoutUDP</span><span class="op" id="6795469">(</span><span class="ident" id="6795470">t</span>&nbsp;<span class="op" id="6795472">*</span><span class="ident" id="6795473">testing</span><span class="op" id="6795480">.</span><span class="ident" id="6795481">T</span><span class="op" id="6795482">)</span>&nbsp;<span class="op" id="6795484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795487">switch</span>&nbsp;<span class="ident" id="6795494">runtime</span><span class="op" id="6795501">.</span><span class="ident" id="6795502">GOOS</span>&nbsp;<span class="op" id="6795507">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795510">case</span>&nbsp;<span class="string" id="6795515">&#34;plan9&#34;</span><span class="op" id="6795522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795526">t</span><span class="op" id="6795527">.</span><span class="ident" id="6795528">Skipf</span><span class="op" id="6795533">(</span><span class="string" id="6795534">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6795555">,</span>&nbsp;<span class="ident" id="6795557">runtime</span><span class="op" id="6795564">.</span><span class="ident" id="6795565">GOOS</span><span class="op" id="6795569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6795576">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795619">listening</span>&nbsp;<span class="op" id="6795629">:=</span>&nbsp;<span class="builtinfunc" id="6795632">make</span><span class="op" id="6795636">(</span><span class="keyword" id="6795637">chan</span>&nbsp;<span class="builtintype" id="6795642">string</span><span class="op" id="6795648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795651">done</span>&nbsp;<span class="op" id="6795656">:=</span>&nbsp;<span class="builtinfunc" id="6795659">make</span><span class="op" id="6795663">(</span><span class="keyword" id="6795664">chan</span>&nbsp;<span class="builtintype" id="6795669">int</span><span class="op" id="6795672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795675">go</span>&nbsp;<span class="ident" id="6795678">runDatagramPacketConnServer</span><span class="op" id="6795705">(</span><span class="ident" id="6795706">t</span><span class="op" id="6795707">,</span>&nbsp;<span class="string" id="6795709">&#34;udp&#34;</span><span class="op" id="6795714">,</span>&nbsp;<span class="string" id="6795716">&#34;127.0.0.1:0&#34;</span><span class="op" id="6795729">,</span>&nbsp;<span class="ident" id="6795731">listening</span><span class="op" id="6795740">,</span>&nbsp;<span class="ident" id="6795742">done</span><span class="op" id="6795746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795749">addr</span>&nbsp;<span class="op" id="6795754">:=</span>&nbsp;<span class="op" id="6795757">&lt;-</span><span class="ident" id="6795759">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795771">testTimeout</span><span class="op" id="6795782">(</span><span class="ident" id="6795783">t</span><span class="op" id="6795784">,</span>&nbsp;<span class="string" id="6795786">&#34;udp&#34;</span><span class="op" id="6795791">,</span>&nbsp;<span class="ident" id="6795793">addr</span><span class="op" id="6795797">,</span>&nbsp;<span class="builtintype" id="6795799">false</span><span class="op" id="6795804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795807">testTimeout</span><span class="op" id="6795818">(</span><span class="ident" id="6795819">t</span><span class="op" id="6795820">,</span>&nbsp;<span class="string" id="6795822">&#34;udp&#34;</span><span class="op" id="6795827">,</span>&nbsp;<span class="ident" id="6795829">addr</span><span class="op" id="6795833">,</span>&nbsp;<span class="builtintype" id="6795835">true</span><span class="op" id="6795839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795842">&lt;-</span><span class="ident" id="6795844">done</span><br>
<span class="lineno"></span><span class="op" id="6795849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6795852">func</span>&nbsp;<span class="ident" id="6795857">TestTimeoutTCP</span><span class="op" id="6795871">(</span><span class="ident" id="6795872">t</span>&nbsp;<span class="op" id="6795874">*</span><span class="ident" id="6795875">testing</span><span class="op" id="6795882">.</span><span class="ident" id="6795883">T</span><span class="op" id="6795884">)</span>&nbsp;<span class="op" id="6795886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795889">switch</span>&nbsp;<span class="ident" id="6795896">runtime</span><span class="op" id="6795903">.</span><span class="ident" id="6795904">GOOS</span>&nbsp;<span class="op" id="6795909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6795912">case</span>&nbsp;<span class="string" id="6795917">&#34;plan9&#34;</span><span class="op" id="6795924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6795928">t</span><span class="op" id="6795929">.</span><span class="ident" id="6795930">Skipf</span><span class="op" id="6795935">(</span><span class="string" id="6795936">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6795957">,</span>&nbsp;<span class="ident" id="6795959">runtime</span><span class="op" id="6795966">.</span><span class="ident" id="6795967">GOOS</span><span class="op" id="6795971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6795974">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6795978">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796021">listening</span>&nbsp;<span class="op" id="6796031">:=</span>&nbsp;<span class="builtinfunc" id="6796034">make</span><span class="op" id="6796038">(</span><span class="keyword" id="6796039">chan</span>&nbsp;<span class="builtintype" id="6796044">string</span><span class="op" id="6796050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796053">done</span>&nbsp;<span class="op" id="6796058">:=</span>&nbsp;<span class="builtinfunc" id="6796061">make</span><span class="op" id="6796065">(</span><span class="keyword" id="6796066">chan</span>&nbsp;<span class="builtintype" id="6796071">int</span><span class="op" id="6796074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796077">go</span>&nbsp;<span class="ident" id="6796080">runStreamConnServer</span><span class="op" id="6796099">(</span><span class="ident" id="6796100">t</span><span class="op" id="6796101">,</span>&nbsp;<span class="string" id="6796103">&#34;tcp&#34;</span><span class="op" id="6796108">,</span>&nbsp;<span class="string" id="6796110">&#34;127.0.0.1:0&#34;</span><span class="op" id="6796123">,</span>&nbsp;<span class="ident" id="6796125">listening</span><span class="op" id="6796134">,</span>&nbsp;<span class="ident" id="6796136">done</span><span class="op" id="6796140">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796143">addr</span>&nbsp;<span class="op" id="6796148">:=</span>&nbsp;<span class="op" id="6796151">&lt;-</span><span class="ident" id="6796153">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796165">testTimeout</span><span class="op" id="6796176">(</span><span class="ident" id="6796177">t</span><span class="op" id="6796178">,</span>&nbsp;<span class="string" id="6796180">&#34;tcp&#34;</span><span class="op" id="6796185">,</span>&nbsp;<span class="ident" id="6796187">addr</span><span class="op" id="6796191">,</span>&nbsp;<span class="builtintype" id="6796193">false</span><span class="op" id="6796198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796201">&lt;-</span><span class="ident" id="6796203">done</span><br>
<span class="lineno"></span><span class="op" id="6796208">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6796211">func</span>&nbsp;<span class="ident" id="6796216">TestDeadlineReset</span><span class="op" id="6796233">(</span><span class="ident" id="6796234">t</span>&nbsp;<span class="op" id="6796236">*</span><span class="ident" id="6796237">testing</span><span class="op" id="6796244">.</span><span class="ident" id="6796245">T</span><span class="op" id="6796246">)</span>&nbsp;<span class="op" id="6796248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796251">switch</span>&nbsp;<span class="ident" id="6796258">runtime</span><span class="op" id="6796265">.</span><span class="ident" id="6796266">GOOS</span>&nbsp;<span class="op" id="6796271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796274">case</span>&nbsp;<span class="string" id="6796279">&#34;plan9&#34;</span><span class="op" id="6796286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796290">t</span><span class="op" id="6796291">.</span><span class="ident" id="6796292">Skipf</span><span class="op" id="6796297">(</span><span class="string" id="6796298">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6796319">,</span>&nbsp;<span class="ident" id="6796321">runtime</span><span class="op" id="6796328">.</span><span class="ident" id="6796329">GOOS</span><span class="op" id="6796333">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796339">ln</span><span class="op" id="6796341">,</span>&nbsp;<span class="ident" id="6796343">err</span>&nbsp;<span class="op" id="6796347">:=</span>&nbsp;<span class="ident" id="6796350">Listen</span><span class="op" id="6796356">(</span><span class="string" id="6796357">&#34;tcp&#34;</span><span class="op" id="6796362">,</span>&nbsp;<span class="string" id="6796364">&#34;127.0.0.1:0&#34;</span><span class="op" id="6796377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796380">if</span>&nbsp;<span class="ident" id="6796383">err</span>&nbsp;<span class="op" id="6796387">!=</span>&nbsp;<span class="builtintype" id="6796390">nil</span>&nbsp;<span class="op" id="6796394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796398">t</span><span class="op" id="6796399">.</span><span class="ident" id="6796400">Fatal</span><span class="op" id="6796405">(</span><span class="ident" id="6796406">err</span><span class="op" id="6796409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796412">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796415">defer</span>&nbsp;<span class="ident" id="6796421">ln</span><span class="op" id="6796423">.</span><span class="ident" id="6796424">Close</span><span class="op" id="6796429">(</span><span class="op" id="6796430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796433">tl</span>&nbsp;<span class="op" id="6796436">:=</span>&nbsp;<span class="ident" id="6796439">ln</span><span class="op" id="6796441">.</span><span class="op" id="6796442">(</span><span class="op" id="6796443">*</span><span class="ident" id="6796444">TCPListener</span><span class="op" id="6796455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796458">tl</span><span class="op" id="6796460">.</span><span class="ident" id="6796461">SetDeadline</span><span class="op" id="6796472">(</span><span class="ident" id="6796473">time</span><span class="op" id="6796477">.</span><span class="ident" id="6796478">Now</span><span class="op" id="6796481">(</span><span class="op" id="6796482">)</span><span class="op" id="6796483">.</span><span class="ident" id="6796484">Add</span><span class="op" id="6796487">(</span><span class="num" id="6796488">1</span>&nbsp;<span class="op" id="6796490">*</span>&nbsp;<span class="ident" id="6796492">time</span><span class="op" id="6796496">.</span><span class="ident" id="6796497">Minute</span><span class="op" id="6796503">)</span><span class="op" id="6796504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796507">tl</span><span class="op" id="6796509">.</span><span class="ident" id="6796510">SetDeadline</span><span class="op" id="6796521">(</span><span class="ident" id="6796522">noDeadline</span><span class="op" id="6796532">)</span>&nbsp;<span class="comment" id="6796534">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796547">errc</span>&nbsp;<span class="op" id="6796552">:=</span>&nbsp;<span class="builtinfunc" id="6796555">make</span><span class="op" id="6796559">(</span><span class="keyword" id="6796560">chan</span>&nbsp;<span class="builtintype" id="6796565">error</span><span class="op" id="6796570">,</span>&nbsp;<span class="num" id="6796572">1</span><span class="op" id="6796573">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796576">go</span>&nbsp;<span class="keyword" id="6796579">func</span><span class="op" id="6796583">(</span><span class="op" id="6796584">)</span>&nbsp;<span class="op" id="6796586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796590">_</span><span class="op" id="6796591">,</span>&nbsp;<span class="ident" id="6796593">err</span>&nbsp;<span class="op" id="6796597">:=</span>&nbsp;<span class="ident" id="6796600">ln</span><span class="op" id="6796602">.</span><span class="ident" id="6796603">Accept</span><span class="op" id="6796609">(</span><span class="op" id="6796610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796614">errc</span>&nbsp;<span class="op" id="6796619">&lt;-</span>&nbsp;<span class="ident" id="6796622">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796627">}</span><span class="op" id="6796628">(</span><span class="op" id="6796629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796632">select</span>&nbsp;<span class="op" id="6796639">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796642">case</span>&nbsp;<span class="op" id="6796647">&lt;-</span><span class="ident" id="6796649">time</span><span class="op" id="6796653">.</span><span class="ident" id="6796654">After</span><span class="op" id="6796659">(</span><span class="num" id="6796660">50</span>&nbsp;<span class="op" id="6796663">*</span>&nbsp;<span class="ident" id="6796665">time</span><span class="op" id="6796669">.</span><span class="ident" id="6796670">Millisecond</span><span class="op" id="6796681">)</span><span class="op" id="6796682">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6796686">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796696">case</span>&nbsp;<span class="ident" id="6796701">err</span>&nbsp;<span class="op" id="6796705">:=</span>&nbsp;<span class="op" id="6796708">&lt;-</span><span class="ident" id="6796710">errc</span><span class="op" id="6796714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6796718">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6796760">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796782">t</span><span class="op" id="6796783">.</span><span class="ident" id="6796784">Errorf</span><span class="op" id="6796790">(</span><span class="string" id="6796791">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="6796830">,</span>&nbsp;<span class="ident" id="6796832">err</span><span class="op" id="6796835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796838">}</span><br>
<span class="lineno"></span><span class="op" id="6796840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6796843">func</span>&nbsp;<span class="ident" id="6796848">TestTimeoutAccept</span><span class="op" id="6796865">(</span><span class="ident" id="6796866">t</span>&nbsp;<span class="op" id="6796868">*</span><span class="ident" id="6796869">testing</span><span class="op" id="6796876">.</span><span class="ident" id="6796877">T</span><span class="op" id="6796878">)</span>&nbsp;<span class="op" id="6796880">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796883">switch</span>&nbsp;<span class="ident" id="6796890">runtime</span><span class="op" id="6796897">.</span><span class="ident" id="6796898">GOOS</span>&nbsp;<span class="op" id="6796903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6796906">case</span>&nbsp;<span class="string" id="6796911">&#34;plan9&#34;</span><span class="op" id="6796918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796922">t</span><span class="op" id="6796923">.</span><span class="ident" id="6796924">Skipf</span><span class="op" id="6796929">(</span><span class="string" id="6796930">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6796951">,</span>&nbsp;<span class="ident" id="6796953">runtime</span><span class="op" id="6796960">.</span><span class="ident" id="6796961">GOOS</span><span class="op" id="6796965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6796968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6796971">ln</span><span class="op" id="6796973">,</span>&nbsp;<span class="ident" id="6796975">err</span>&nbsp;<span class="op" id="6796979">:=</span>&nbsp;<span class="ident" id="6796982">Listen</span><span class="op" id="6796988">(</span><span class="string" id="6796989">&#34;tcp&#34;</span><span class="op" id="6796994">,</span>&nbsp;<span class="string" id="6796996">&#34;127.0.0.1:0&#34;</span><span class="op" id="6797009">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797012">if</span>&nbsp;<span class="ident" id="6797015">err</span>&nbsp;<span class="op" id="6797019">!=</span>&nbsp;<span class="builtintype" id="6797022">nil</span>&nbsp;<span class="op" id="6797026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797030">t</span><span class="op" id="6797031">.</span><span class="ident" id="6797032">Fatal</span><span class="op" id="6797037">(</span><span class="ident" id="6797038">err</span><span class="op" id="6797041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797047">defer</span>&nbsp;<span class="ident" id="6797053">ln</span><span class="op" id="6797055">.</span><span class="ident" id="6797056">Close</span><span class="op" id="6797061">(</span><span class="op" id="6797062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797065">tl</span>&nbsp;<span class="op" id="6797068">:=</span>&nbsp;<span class="ident" id="6797071">ln</span><span class="op" id="6797073">.</span><span class="op" id="6797074">(</span><span class="op" id="6797075">*</span><span class="ident" id="6797076">TCPListener</span><span class="op" id="6797087">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797090">tl</span><span class="op" id="6797092">.</span><span class="ident" id="6797093">SetDeadline</span><span class="op" id="6797104">(</span><span class="ident" id="6797105">time</span><span class="op" id="6797109">.</span><span class="ident" id="6797110">Now</span><span class="op" id="6797113">(</span><span class="op" id="6797114">)</span><span class="op" id="6797115">.</span><span class="ident" id="6797116">Add</span><span class="op" id="6797119">(</span><span class="num" id="6797120">100</span>&nbsp;<span class="op" id="6797124">*</span>&nbsp;<span class="ident" id="6797126">time</span><span class="op" id="6797130">.</span><span class="ident" id="6797131">Millisecond</span><span class="op" id="6797142">)</span><span class="op" id="6797143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797146">errc</span>&nbsp;<span class="op" id="6797151">:=</span>&nbsp;<span class="builtinfunc" id="6797154">make</span><span class="op" id="6797158">(</span><span class="keyword" id="6797159">chan</span>&nbsp;<span class="builtintype" id="6797164">error</span><span class="op" id="6797169">,</span>&nbsp;<span class="num" id="6797171">1</span><span class="op" id="6797172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797175">go</span>&nbsp;<span class="keyword" id="6797178">func</span><span class="op" id="6797182">(</span><span class="op" id="6797183">)</span>&nbsp;<span class="op" id="6797185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797189">_</span><span class="op" id="6797190">,</span>&nbsp;<span class="ident" id="6797192">err</span>&nbsp;<span class="op" id="6797196">:=</span>&nbsp;<span class="ident" id="6797199">ln</span><span class="op" id="6797201">.</span><span class="ident" id="6797202">Accept</span><span class="op" id="6797208">(</span><span class="op" id="6797209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797213">errc</span>&nbsp;<span class="op" id="6797218">&lt;-</span>&nbsp;<span class="ident" id="6797221">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797226">}</span><span class="op" id="6797227">(</span><span class="op" id="6797228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797231">select</span>&nbsp;<span class="op" id="6797238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797241">case</span>&nbsp;<span class="op" id="6797246">&lt;-</span><span class="ident" id="6797248">time</span><span class="op" id="6797252">.</span><span class="ident" id="6797253">After</span><span class="op" id="6797258">(</span><span class="num" id="6797259">1</span>&nbsp;<span class="op" id="6797261">*</span>&nbsp;<span class="ident" id="6797263">time</span><span class="op" id="6797267">.</span><span class="ident" id="6797268">Second</span><span class="op" id="6797274">)</span><span class="op" id="6797275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6797279">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797320">t</span><span class="op" id="6797321">.</span><span class="ident" id="6797322">Errorf</span><span class="op" id="6797328">(</span><span class="string" id="6797329">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="6797371">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797374">case</span>&nbsp;<span class="op" id="6797379">&lt;-</span><span class="ident" id="6797381">errc</span><span class="op" id="6797385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6797389">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797399">}</span><br>
<span class="lineno"></span><span class="op" id="6797401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6797404">func</span>&nbsp;<span class="ident" id="6797409">TestReadWriteDeadline</span><span class="op" id="6797430">(</span><span class="ident" id="6797431">t</span>&nbsp;<span class="op" id="6797433">*</span><span class="ident" id="6797434">testing</span><span class="op" id="6797441">.</span><span class="ident" id="6797442">T</span><span class="op" id="6797443">)</span>&nbsp;<span class="op" id="6797445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797448">switch</span>&nbsp;<span class="ident" id="6797455">runtime</span><span class="op" id="6797462">.</span><span class="ident" id="6797463">GOOS</span>&nbsp;<span class="op" id="6797468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797471">case</span>&nbsp;<span class="string" id="6797476">&#34;plan9&#34;</span><span class="op" id="6797483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797487">t</span><span class="op" id="6797488">.</span><span class="ident" id="6797489">Skipf</span><span class="op" id="6797494">(</span><span class="string" id="6797495">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6797516">,</span>&nbsp;<span class="ident" id="6797518">runtime</span><span class="op" id="6797525">.</span><span class="ident" id="6797526">GOOS</span><span class="op" id="6797530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797533">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797537">const</span>&nbsp;<span class="op" id="6797543">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797547">readTimeout</span>&nbsp;&nbsp;<span class="op" id="6797560">=</span>&nbsp;<span class="num" id="6797562">50</span>&nbsp;<span class="op" id="6797565">*</span>&nbsp;<span class="ident" id="6797567">time</span><span class="op" id="6797571">.</span><span class="ident" id="6797572">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797586">writeTimeout</span>&nbsp;<span class="op" id="6797599">=</span>&nbsp;<span class="num" id="6797601">250</span>&nbsp;<span class="op" id="6797605">*</span>&nbsp;<span class="ident" id="6797607">time</span><span class="op" id="6797611">.</span><span class="ident" id="6797612">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797625">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797628">checkTimeout</span>&nbsp;<span class="op" id="6797641">:=</span>&nbsp;<span class="keyword" id="6797644">func</span><span class="op" id="6797648">(</span><span class="ident" id="6797649">command</span>&nbsp;<span class="builtintype" id="6797657">string</span><span class="op" id="6797663">,</span>&nbsp;<span class="ident" id="6797665">start</span>&nbsp;<span class="ident" id="6797671">time</span><span class="op" id="6797675">.</span><span class="ident" id="6797676">Time</span><span class="op" id="6797680">,</span>&nbsp;<span class="ident" id="6797682">should</span>&nbsp;<span class="ident" id="6797689">time</span><span class="op" id="6797693">.</span><span class="ident" id="6797694">Duration</span><span class="op" id="6797702">)</span>&nbsp;<span class="op" id="6797704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797708">is</span>&nbsp;<span class="op" id="6797711">:=</span>&nbsp;<span class="ident" id="6797714">time</span><span class="op" id="6797718">.</span><span class="ident" id="6797719">Now</span><span class="op" id="6797722">(</span><span class="op" id="6797723">)</span><span class="op" id="6797724">.</span><span class="ident" id="6797725">Sub</span><span class="op" id="6797728">(</span><span class="ident" id="6797729">start</span><span class="op" id="6797734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797738">d</span>&nbsp;<span class="op" id="6797740">:=</span>&nbsp;<span class="ident" id="6797743">is</span>&nbsp;<span class="op" id="6797746">-</span>&nbsp;<span class="ident" id="6797748">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797757">if</span>&nbsp;<span class="ident" id="6797760">d</span>&nbsp;<span class="op" id="6797762">&lt;</span>&nbsp;<span class="op" id="6797764">-</span><span class="num" id="6797765">30</span><span class="op" id="6797767">*</span><span class="ident" id="6797768">time</span><span class="op" id="6797772">.</span><span class="ident" id="6797773">Millisecond</span>&nbsp;<span class="op" id="6797785">||</span>&nbsp;<span class="op" id="6797788">!</span><span class="ident" id="6797789">testing</span><span class="op" id="6797796">.</span><span class="ident" id="6797797">Short</span><span class="op" id="6797802">(</span><span class="op" id="6797803">)</span>&nbsp;<span class="op" id="6797805">&amp;&amp;</span>&nbsp;<span class="num" id="6797808">150</span><span class="op" id="6797811">*</span><span class="ident" id="6797812">time</span><span class="op" id="6797816">.</span><span class="ident" id="6797817">Millisecond</span>&nbsp;<span class="op" id="6797829">&lt;</span>&nbsp;<span class="ident" id="6797831">d</span>&nbsp;<span class="op" id="6797833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797838">t</span><span class="op" id="6797839">.</span><span class="ident" id="6797840">Errorf</span><span class="op" id="6797846">(</span><span class="string" id="6797847">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="6797890">,</span>&nbsp;<span class="ident" id="6797892">command</span><span class="op" id="6797899">,</span>&nbsp;<span class="ident" id="6797901">is</span><span class="op" id="6797903">,</span>&nbsp;<span class="ident" id="6797905">should</span><span class="op" id="6797911">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6797918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797922">ln</span><span class="op" id="6797924">,</span>&nbsp;<span class="ident" id="6797926">err</span>&nbsp;<span class="op" id="6797930">:=</span>&nbsp;<span class="ident" id="6797933">Listen</span><span class="op" id="6797939">(</span><span class="string" id="6797940">&#34;tcp&#34;</span><span class="op" id="6797945">,</span>&nbsp;<span class="string" id="6797947">&#34;127.0.0.1:0&#34;</span><span class="op" id="6797960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6797963">if</span>&nbsp;<span class="ident" id="6797966">err</span>&nbsp;<span class="op" id="6797970">!=</span>&nbsp;<span class="builtintype" id="6797973">nil</span>&nbsp;<span class="op" id="6797977">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6797981">t</span><span class="op" id="6797982">.</span><span class="ident" id="6797983">Fatalf</span><span class="op" id="6797989">(</span><span class="string" id="6797990">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6798011">,</span>&nbsp;<span class="ident" id="6798013">err</span><span class="op" id="6798016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798022">defer</span>&nbsp;<span class="ident" id="6798028">ln</span><span class="op" id="6798030">.</span><span class="ident" id="6798031">Close</span><span class="op" id="6798036">(</span><span class="op" id="6798037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798041">lnquit</span>&nbsp;<span class="op" id="6798048">:=</span>&nbsp;<span class="builtinfunc" id="6798051">make</span><span class="op" id="6798055">(</span><span class="keyword" id="6798056">chan</span>&nbsp;<span class="builtintype" id="6798061">bool</span><span class="op" id="6798065">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798069">go</span>&nbsp;<span class="keyword" id="6798072">func</span><span class="op" id="6798076">(</span><span class="op" id="6798077">)</span>&nbsp;<span class="op" id="6798079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798083">c</span><span class="op" id="6798084">,</span>&nbsp;<span class="ident" id="6798086">err</span>&nbsp;<span class="op" id="6798090">:=</span>&nbsp;<span class="ident" id="6798093">ln</span><span class="op" id="6798095">.</span><span class="ident" id="6798096">Accept</span><span class="op" id="6798102">(</span><span class="op" id="6798103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798107">if</span>&nbsp;<span class="ident" id="6798110">err</span>&nbsp;<span class="op" id="6798114">!=</span>&nbsp;<span class="builtintype" id="6798117">nil</span>&nbsp;<span class="op" id="6798121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798126">t</span><span class="op" id="6798127">.</span><span class="ident" id="6798128">Errorf</span><span class="op" id="6798134">(</span><span class="string" id="6798135">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6798147">,</span>&nbsp;<span class="ident" id="6798149">err</span><span class="op" id="6798152">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798157">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798170">defer</span>&nbsp;<span class="ident" id="6798176">c</span><span class="op" id="6798177">.</span><span class="ident" id="6798178">Close</span><span class="op" id="6798183">(</span><span class="op" id="6798184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798188">lnquit</span>&nbsp;<span class="op" id="6798195">&lt;-</span>&nbsp;<span class="builtintype" id="6798198">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798204">}</span><span class="op" id="6798205">(</span><span class="op" id="6798206">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798210">c</span><span class="op" id="6798211">,</span>&nbsp;<span class="ident" id="6798213">err</span>&nbsp;<span class="op" id="6798217">:=</span>&nbsp;<span class="ident" id="6798220">Dial</span><span class="op" id="6798224">(</span><span class="string" id="6798225">&#34;tcp&#34;</span><span class="op" id="6798230">,</span>&nbsp;<span class="ident" id="6798232">ln</span><span class="op" id="6798234">.</span><span class="ident" id="6798235">Addr</span><span class="op" id="6798239">(</span><span class="op" id="6798240">)</span><span class="op" id="6798241">.</span><span class="ident" id="6798242">String</span><span class="op" id="6798248">(</span><span class="op" id="6798249">)</span><span class="op" id="6798250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798253">if</span>&nbsp;<span class="ident" id="6798256">err</span>&nbsp;<span class="op" id="6798260">!=</span>&nbsp;<span class="builtintype" id="6798263">nil</span>&nbsp;<span class="op" id="6798267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798271">t</span><span class="op" id="6798272">.</span><span class="ident" id="6798273">Fatalf</span><span class="op" id="6798279">(</span><span class="string" id="6798280">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6798290">,</span>&nbsp;<span class="ident" id="6798292">err</span><span class="op" id="6798295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798298">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798301">defer</span>&nbsp;<span class="ident" id="6798307">c</span><span class="op" id="6798308">.</span><span class="ident" id="6798309">Close</span><span class="op" id="6798314">(</span><span class="op" id="6798315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798319">start</span>&nbsp;<span class="op" id="6798325">:=</span>&nbsp;<span class="ident" id="6798328">time</span><span class="op" id="6798332">.</span><span class="ident" id="6798333">Now</span><span class="op" id="6798336">(</span><span class="op" id="6798337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798340">err</span>&nbsp;<span class="op" id="6798344">=</span>&nbsp;<span class="ident" id="6798346">c</span><span class="op" id="6798347">.</span><span class="ident" id="6798348">SetReadDeadline</span><span class="op" id="6798363">(</span><span class="ident" id="6798364">start</span><span class="op" id="6798369">.</span><span class="ident" id="6798370">Add</span><span class="op" id="6798373">(</span><span class="ident" id="6798374">readTimeout</span><span class="op" id="6798385">)</span><span class="op" id="6798386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798389">if</span>&nbsp;<span class="ident" id="6798392">err</span>&nbsp;<span class="op" id="6798396">!=</span>&nbsp;<span class="builtintype" id="6798399">nil</span>&nbsp;<span class="op" id="6798403">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798407">t</span><span class="op" id="6798408">.</span><span class="ident" id="6798409">Fatalf</span><span class="op" id="6798415">(</span><span class="string" id="6798416">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="6798437">,</span>&nbsp;<span class="ident" id="6798439">err</span><span class="op" id="6798442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798448">err</span>&nbsp;<span class="op" id="6798452">=</span>&nbsp;<span class="ident" id="6798454">c</span><span class="op" id="6798455">.</span><span class="ident" id="6798456">SetWriteDeadline</span><span class="op" id="6798472">(</span><span class="ident" id="6798473">start</span><span class="op" id="6798478">.</span><span class="ident" id="6798479">Add</span><span class="op" id="6798482">(</span><span class="ident" id="6798483">writeTimeout</span><span class="op" id="6798495">)</span><span class="op" id="6798496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798499">if</span>&nbsp;<span class="ident" id="6798502">err</span>&nbsp;<span class="op" id="6798506">!=</span>&nbsp;<span class="builtintype" id="6798509">nil</span>&nbsp;<span class="op" id="6798513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798517">t</span><span class="op" id="6798518">.</span><span class="ident" id="6798519">Fatalf</span><span class="op" id="6798525">(</span><span class="string" id="6798526">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="6798548">,</span>&nbsp;<span class="ident" id="6798550">err</span><span class="op" id="6798553">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798560">quit</span>&nbsp;<span class="op" id="6798565">:=</span>&nbsp;<span class="builtinfunc" id="6798568">make</span><span class="op" id="6798572">(</span><span class="keyword" id="6798573">chan</span>&nbsp;<span class="builtintype" id="6798578">bool</span><span class="op" id="6798582">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798586">go</span>&nbsp;<span class="keyword" id="6798589">func</span><span class="op" id="6798593">(</span><span class="op" id="6798594">)</span>&nbsp;<span class="op" id="6798596">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798600">var</span>&nbsp;<span class="ident" id="6798604">buf</span>&nbsp;<span class="op" id="6798608">[</span><span class="num" id="6798609">10</span><span class="op" id="6798611">]</span><span class="builtintype" id="6798612">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798619">_</span><span class="op" id="6798620">,</span>&nbsp;<span class="ident" id="6798622">err</span>&nbsp;<span class="op" id="6798626">:=</span>&nbsp;<span class="ident" id="6798629">c</span><span class="op" id="6798630">.</span><span class="ident" id="6798631">Read</span><span class="op" id="6798635">(</span><span class="ident" id="6798636">buf</span><span class="op" id="6798639">[</span><span class="op" id="6798640">:</span><span class="op" id="6798641">]</span><span class="op" id="6798642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798646">if</span>&nbsp;<span class="ident" id="6798649">err</span>&nbsp;<span class="op" id="6798653">==</span>&nbsp;<span class="builtintype" id="6798656">nil</span>&nbsp;<span class="op" id="6798660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798665">t</span><span class="op" id="6798666">.</span><span class="ident" id="6798667">Errorf</span><span class="op" id="6798673">(</span><span class="string" id="6798674">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="6798699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798703">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798707">checkTimeout</span><span class="op" id="6798719">(</span><span class="string" id="6798720">&#34;Read&#34;</span><span class="op" id="6798726">,</span>&nbsp;<span class="ident" id="6798728">start</span><span class="op" id="6798733">,</span>&nbsp;<span class="ident" id="6798735">readTimeout</span><span class="op" id="6798746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798750">quit</span>&nbsp;<span class="op" id="6798755">&lt;-</span>&nbsp;<span class="builtintype" id="6798758">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798764">}</span><span class="op" id="6798765">(</span><span class="op" id="6798766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798770">go</span>&nbsp;<span class="keyword" id="6798773">func</span><span class="op" id="6798777">(</span><span class="op" id="6798778">)</span>&nbsp;<span class="op" id="6798780">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798784">var</span>&nbsp;<span class="ident" id="6798788">buf</span>&nbsp;<span class="op" id="6798792">[</span><span class="num" id="6798793">10000</span><span class="op" id="6798798">]</span><span class="builtintype" id="6798799">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798806">for</span>&nbsp;<span class="op" id="6798810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798815">_</span><span class="op" id="6798816">,</span>&nbsp;<span class="ident" id="6798818">err</span>&nbsp;<span class="op" id="6798822">:=</span>&nbsp;<span class="ident" id="6798825">c</span><span class="op" id="6798826">.</span><span class="ident" id="6798827">Write</span><span class="op" id="6798832">(</span><span class="ident" id="6798833">buf</span><span class="op" id="6798836">[</span><span class="op" id="6798837">:</span><span class="op" id="6798838">]</span><span class="op" id="6798839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798844">if</span>&nbsp;<span class="ident" id="6798847">err</span>&nbsp;<span class="op" id="6798851">!=</span>&nbsp;<span class="builtintype" id="6798854">nil</span>&nbsp;<span class="op" id="6798858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6798864">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798881">checkTimeout</span><span class="op" id="6798893">(</span><span class="string" id="6798894">&#34;Write&#34;</span><span class="op" id="6798901">,</span>&nbsp;<span class="ident" id="6798903">start</span><span class="op" id="6798908">,</span>&nbsp;<span class="ident" id="6798910">writeTimeout</span><span class="op" id="6798922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6798926">quit</span>&nbsp;<span class="op" id="6798931">&lt;-</span>&nbsp;<span class="builtintype" id="6798934">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798940">}</span><span class="op" id="6798941">(</span><span class="op" id="6798942">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798946">&lt;-</span><span class="ident" id="6798948">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798954">&lt;-</span><span class="ident" id="6798956">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6798962">&lt;-</span><span class="ident" id="6798964">lnquit</span><br>
<span class="lineno"></span><span class="op" id="6798971">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="6798974">type</span>&nbsp;<span class="ident" id="6798979">neverEnding</span>&nbsp;<span class="builtintype" id="6798991">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6798997">func</span>&nbsp;<span class="op" id="6799002">(</span><span class="ident" id="6799003">b</span>&nbsp;<span class="ident" id="6799005">neverEnding</span><span class="op" id="6799016">)</span>&nbsp;<span class="ident" id="6799018">Read</span><span class="op" id="6799022">(</span><span class="ident" id="6799023">p</span>&nbsp;<span class="op" id="6799025">[</span><span class="op" id="6799026">]</span><span class="builtintype" id="6799027">byte</span><span class="op" id="6799031">)</span>&nbsp;<span class="op" id="6799033">(</span><span class="ident" id="6799034">n</span>&nbsp;<span class="builtintype" id="6799036">int</span><span class="op" id="6799039">,</span>&nbsp;<span class="ident" id="6799041">err</span>&nbsp;<span class="builtintype" id="6799045">error</span><span class="op" id="6799050">)</span>&nbsp;<span class="op" id="6799052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799055">for</span>&nbsp;<span class="ident" id="6799059">i</span>&nbsp;<span class="op" id="6799061">:=</span>&nbsp;<span class="keyword" id="6799064">range</span>&nbsp;<span class="ident" id="6799070">p</span>&nbsp;<span class="op" id="6799072">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799076">p</span><span class="op" id="6799077">[</span><span class="ident" id="6799078">i</span><span class="op" id="6799079">]</span>&nbsp;<span class="op" id="6799081">=</span>&nbsp;<span class="builtintype" id="6799083">byte</span><span class="op" id="6799087">(</span><span class="ident" id="6799088">b</span><span class="op" id="6799089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799095">return</span>&nbsp;<span class="builtinfunc" id="6799102">len</span><span class="op" id="6799105">(</span><span class="ident" id="6799106">p</span><span class="op" id="6799107">)</span><span class="op" id="6799108">,</span>&nbsp;<span class="builtintype" id="6799110">nil</span><br>
<span class="lineno"></span><span class="op" id="6799114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6799117">func</span>&nbsp;<span class="ident" id="6799122">TestVariousDeadlines1Proc</span><span class="op" id="6799147">(</span><span class="ident" id="6799148">t</span>&nbsp;<span class="op" id="6799150">*</span><span class="ident" id="6799151">testing</span><span class="op" id="6799158">.</span><span class="ident" id="6799159">T</span><span class="op" id="6799160">)</span>&nbsp;<span class="op" id="6799162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799165">testVariousDeadlines</span><span class="op" id="6799185">(</span><span class="ident" id="6799186">t</span><span class="op" id="6799187">,</span>&nbsp;<span class="num" id="6799189">1</span><span class="op" id="6799190">)</span><br>
<span class="lineno"></span><span class="op" id="6799192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6799195">func</span>&nbsp;<span class="ident" id="6799200">TestVariousDeadlines4Proc</span><span class="op" id="6799225">(</span><span class="ident" id="6799226">t</span>&nbsp;<span class="op" id="6799228">*</span><span class="ident" id="6799229">testing</span><span class="op" id="6799236">.</span><span class="ident" id="6799237">T</span><span class="op" id="6799238">)</span>&nbsp;<span class="op" id="6799240">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799243">testVariousDeadlines</span><span class="op" id="6799263">(</span><span class="ident" id="6799264">t</span><span class="op" id="6799265">,</span>&nbsp;<span class="num" id="6799267">4</span><span class="op" id="6799268">)</span><br>
<span class="lineno"></span><span class="op" id="6799270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6799273">func</span>&nbsp;<span class="ident" id="6799278">testVariousDeadlines</span><span class="op" id="6799298">(</span><span class="ident" id="6799299">t</span>&nbsp;<span class="op" id="6799301">*</span><span class="ident" id="6799302">testing</span><span class="op" id="6799309">.</span><span class="ident" id="6799310">T</span><span class="op" id="6799311">,</span>&nbsp;<span class="ident" id="6799313">maxProcs</span>&nbsp;<span class="builtintype" id="6799322">int</span><span class="op" id="6799325">)</span>&nbsp;<span class="op" id="6799327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799330">switch</span>&nbsp;<span class="ident" id="6799337">runtime</span><span class="op" id="6799344">.</span><span class="ident" id="6799345">GOOS</span>&nbsp;<span class="op" id="6799350">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799353">case</span>&nbsp;<span class="string" id="6799358">&#34;plan9&#34;</span><span class="op" id="6799365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799369">t</span><span class="op" id="6799370">.</span><span class="ident" id="6799371">Skipf</span><span class="op" id="6799376">(</span><span class="string" id="6799377">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6799398">,</span>&nbsp;<span class="ident" id="6799400">runtime</span><span class="op" id="6799407">.</span><span class="ident" id="6799408">GOOS</span><span class="op" id="6799412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799419">defer</span>&nbsp;<span class="ident" id="6799425">runtime</span><span class="op" id="6799432">.</span><span class="ident" id="6799433">GOMAXPROCS</span><span class="op" id="6799443">(</span><span class="ident" id="6799444">runtime</span><span class="op" id="6799451">.</span><span class="ident" id="6799452">GOMAXPROCS</span><span class="op" id="6799462">(</span><span class="ident" id="6799463">maxProcs</span><span class="op" id="6799471">)</span><span class="op" id="6799472">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799475">ln</span>&nbsp;<span class="op" id="6799478">:=</span>&nbsp;<span class="ident" id="6799481">newLocalListener</span><span class="op" id="6799497">(</span><span class="ident" id="6799498">t</span><span class="op" id="6799499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799502">defer</span>&nbsp;<span class="ident" id="6799508">ln</span><span class="op" id="6799510">.</span><span class="ident" id="6799511">Close</span><span class="op" id="6799516">(</span><span class="op" id="6799517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799520">acceptc</span>&nbsp;<span class="op" id="6799528">:=</span>&nbsp;<span class="builtinfunc" id="6799531">make</span><span class="op" id="6799535">(</span><span class="keyword" id="6799536">chan</span>&nbsp;<span class="builtintype" id="6799541">error</span><span class="op" id="6799546">,</span>&nbsp;<span class="num" id="6799548">1</span><span class="op" id="6799549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6799553">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6799623">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799646">servec</span>&nbsp;<span class="op" id="6799653">:=</span>&nbsp;<span class="builtinfunc" id="6799656">make</span><span class="op" id="6799660">(</span><span class="keyword" id="6799661">chan</span>&nbsp;<span class="ident" id="6799666">copyRes</span><span class="op" id="6799673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799676">go</span>&nbsp;<span class="keyword" id="6799679">func</span><span class="op" id="6799683">(</span><span class="op" id="6799684">)</span>&nbsp;<span class="op" id="6799686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799690">for</span>&nbsp;<span class="op" id="6799694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799699">c</span><span class="op" id="6799700">,</span>&nbsp;<span class="ident" id="6799702">err</span>&nbsp;<span class="op" id="6799706">:=</span>&nbsp;<span class="ident" id="6799709">ln</span><span class="op" id="6799711">.</span><span class="ident" id="6799712">Accept</span><span class="op" id="6799718">(</span><span class="op" id="6799719">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799724">if</span>&nbsp;<span class="ident" id="6799727">err</span>&nbsp;<span class="op" id="6799731">!=</span>&nbsp;<span class="builtintype" id="6799734">nil</span>&nbsp;<span class="op" id="6799738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799744">acceptc</span>&nbsp;<span class="op" id="6799752">&lt;-</span>&nbsp;<span class="ident" id="6799755">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799763">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799778">go</span>&nbsp;<span class="keyword" id="6799781">func</span><span class="op" id="6799785">(</span><span class="op" id="6799786">)</span>&nbsp;<span class="op" id="6799788">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799794">t0</span>&nbsp;<span class="op" id="6799797">:=</span>&nbsp;<span class="ident" id="6799800">time</span><span class="op" id="6799804">.</span><span class="ident" id="6799805">Now</span><span class="op" id="6799808">(</span><span class="op" id="6799809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799815">n</span><span class="op" id="6799816">,</span>&nbsp;<span class="ident" id="6799818">err</span>&nbsp;<span class="op" id="6799822">:=</span>&nbsp;<span class="ident" id="6799825">io</span><span class="op" id="6799827">.</span><span class="ident" id="6799828">Copy</span><span class="op" id="6799832">(</span><span class="ident" id="6799833">c</span><span class="op" id="6799834">,</span>&nbsp;<span class="ident" id="6799836">neverEnding</span><span class="op" id="6799847">(</span><span class="string" id="6799848">&#39;a&#39;</span><span class="op" id="6799851">)</span><span class="op" id="6799852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799858">d</span>&nbsp;<span class="op" id="6799860">:=</span>&nbsp;<span class="ident" id="6799863">time</span><span class="op" id="6799867">.</span><span class="ident" id="6799868">Since</span><span class="op" id="6799873">(</span><span class="ident" id="6799874">t0</span><span class="op" id="6799876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799882">c</span><span class="op" id="6799883">.</span><span class="ident" id="6799884">Close</span><span class="op" id="6799889">(</span><span class="op" id="6799890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6799896">servec</span>&nbsp;<span class="op" id="6799903">&lt;-</span>&nbsp;<span class="ident" id="6799906">copyRes</span><span class="op" id="6799913">{</span><span class="ident" id="6799914">n</span><span class="op" id="6799915">,</span>&nbsp;<span class="ident" id="6799917">err</span><span class="op" id="6799920">,</span>&nbsp;<span class="ident" id="6799922">d</span><span class="op" id="6799923">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799928">}</span><span class="op" id="6799929">(</span><span class="op" id="6799930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6799937">}</span><span class="op" id="6799938">(</span><span class="op" id="6799939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6799943">for</span>&nbsp;<span class="ident" id="6799947">_</span><span class="op" id="6799948">,</span>&nbsp;<span class="ident" id="6799950">timeout</span>&nbsp;<span class="op" id="6799958">:=</span>&nbsp;<span class="keyword" id="6799961">range</span>&nbsp;<span class="op" id="6799967">[</span><span class="op" id="6799968">]</span><span class="ident" id="6799969">time</span><span class="op" id="6799973">.</span><span class="ident" id="6799974">Duration</span><span class="op" id="6799982">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6799986">1</span>&nbsp;<span class="op" id="6799988">*</span>&nbsp;<span class="ident" id="6799990">time</span><span class="op" id="6799994">.</span><span class="ident" id="6799995">Nanosecond</span><span class="op" id="6800005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800009">2</span>&nbsp;<span class="op" id="6800011">*</span>&nbsp;<span class="ident" id="6800013">time</span><span class="op" id="6800017">.</span><span class="ident" id="6800018">Nanosecond</span><span class="op" id="6800028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800032">5</span>&nbsp;<span class="op" id="6800034">*</span>&nbsp;<span class="ident" id="6800036">time</span><span class="op" id="6800040">.</span><span class="ident" id="6800041">Nanosecond</span><span class="op" id="6800051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800055">50</span>&nbsp;<span class="op" id="6800058">*</span>&nbsp;<span class="ident" id="6800060">time</span><span class="op" id="6800064">.</span><span class="ident" id="6800065">Nanosecond</span><span class="op" id="6800075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800079">100</span>&nbsp;<span class="op" id="6800083">*</span>&nbsp;<span class="ident" id="6800085">time</span><span class="op" id="6800089">.</span><span class="ident" id="6800090">Nanosecond</span><span class="op" id="6800100">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800104">200</span>&nbsp;<span class="op" id="6800108">*</span>&nbsp;<span class="ident" id="6800110">time</span><span class="op" id="6800114">.</span><span class="ident" id="6800115">Nanosecond</span><span class="op" id="6800125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800129">500</span>&nbsp;<span class="op" id="6800133">*</span>&nbsp;<span class="ident" id="6800135">time</span><span class="op" id="6800139">.</span><span class="ident" id="6800140">Nanosecond</span><span class="op" id="6800150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800154">750</span>&nbsp;<span class="op" id="6800158">*</span>&nbsp;<span class="ident" id="6800160">time</span><span class="op" id="6800164">.</span><span class="ident" id="6800165">Nanosecond</span><span class="op" id="6800175">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800179">1</span>&nbsp;<span class="op" id="6800181">*</span>&nbsp;<span class="ident" id="6800183">time</span><span class="op" id="6800187">.</span><span class="ident" id="6800188">Microsecond</span><span class="op" id="6800199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800203">5</span>&nbsp;<span class="op" id="6800205">*</span>&nbsp;<span class="ident" id="6800207">time</span><span class="op" id="6800211">.</span><span class="ident" id="6800212">Microsecond</span><span class="op" id="6800223">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800227">25</span>&nbsp;<span class="op" id="6800230">*</span>&nbsp;<span class="ident" id="6800232">time</span><span class="op" id="6800236">.</span><span class="ident" id="6800237">Microsecond</span><span class="op" id="6800248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800252">250</span>&nbsp;<span class="op" id="6800256">*</span>&nbsp;<span class="ident" id="6800258">time</span><span class="op" id="6800262">.</span><span class="ident" id="6800263">Microsecond</span><span class="op" id="6800274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800278">500</span>&nbsp;<span class="op" id="6800282">*</span>&nbsp;<span class="ident" id="6800284">time</span><span class="op" id="6800288">.</span><span class="ident" id="6800289">Microsecond</span><span class="op" id="6800300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800304">1</span>&nbsp;<span class="op" id="6800306">*</span>&nbsp;<span class="ident" id="6800308">time</span><span class="op" id="6800312">.</span><span class="ident" id="6800313">Millisecond</span><span class="op" id="6800324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800328">5</span>&nbsp;<span class="op" id="6800330">*</span>&nbsp;<span class="ident" id="6800332">time</span><span class="op" id="6800336">.</span><span class="ident" id="6800337">Millisecond</span><span class="op" id="6800348">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800352">100</span>&nbsp;<span class="op" id="6800356">*</span>&nbsp;<span class="ident" id="6800358">time</span><span class="op" id="6800362">.</span><span class="ident" id="6800363">Millisecond</span><span class="op" id="6800374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800378">250</span>&nbsp;<span class="op" id="6800382">*</span>&nbsp;<span class="ident" id="6800384">time</span><span class="op" id="6800388">.</span><span class="ident" id="6800389">Millisecond</span><span class="op" id="6800400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800404">500</span>&nbsp;<span class="op" id="6800408">*</span>&nbsp;<span class="ident" id="6800410">time</span><span class="op" id="6800414">.</span><span class="ident" id="6800415">Millisecond</span><span class="op" id="6800426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6800430">1</span>&nbsp;<span class="op" id="6800432">*</span>&nbsp;<span class="ident" id="6800434">time</span><span class="op" id="6800438">.</span><span class="ident" id="6800439">Second</span><span class="op" id="6800445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800448">}</span>&nbsp;<span class="op" id="6800450">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800454">numRuns</span>&nbsp;<span class="op" id="6800462">:=</span>&nbsp;<span class="num" id="6800465">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800469">if</span>&nbsp;<span class="ident" id="6800472">testing</span><span class="op" id="6800479">.</span><span class="ident" id="6800480">Short</span><span class="op" id="6800485">(</span><span class="op" id="6800486">)</span>&nbsp;<span class="op" id="6800488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800493">numRuns</span>&nbsp;<span class="op" id="6800501">=</span>&nbsp;<span class="num" id="6800503">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800508">if</span>&nbsp;<span class="ident" id="6800511">timeout</span>&nbsp;<span class="op" id="6800519">&gt;</span>&nbsp;<span class="num" id="6800521">500</span><span class="op" id="6800524">*</span><span class="ident" id="6800525">time</span><span class="op" id="6800529">.</span><span class="ident" id="6800530">Microsecond</span>&nbsp;<span class="op" id="6800542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800548">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800568">for</span>&nbsp;<span class="ident" id="6800572">run</span>&nbsp;<span class="op" id="6800576">:=</span>&nbsp;<span class="num" id="6800579">0</span><span class="op" id="6800580">;</span>&nbsp;<span class="ident" id="6800582">run</span>&nbsp;<span class="op" id="6800586">&lt;</span>&nbsp;<span class="ident" id="6800588">numRuns</span><span class="op" id="6800595">;</span>&nbsp;<span class="ident" id="6800597">run</span><span class="op" id="6800600">++</span>&nbsp;<span class="op" id="6800603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800608">name</span>&nbsp;<span class="op" id="6800613">:=</span>&nbsp;<span class="ident" id="6800616">fmt</span><span class="op" id="6800619">.</span><span class="ident" id="6800620">Sprintf</span><span class="op" id="6800627">(</span><span class="string" id="6800628">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="6800642">,</span>&nbsp;<span class="ident" id="6800644">timeout</span><span class="op" id="6800651">,</span>&nbsp;<span class="ident" id="6800653">run</span><span class="op" id="6800656">+</span><span class="num" id="6800657">1</span><span class="op" id="6800658">,</span>&nbsp;<span class="ident" id="6800660">numRuns</span><span class="op" id="6800667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800672">t</span><span class="op" id="6800673">.</span><span class="ident" id="6800674">Log</span><span class="op" id="6800677">(</span><span class="ident" id="6800678">name</span><span class="op" id="6800682">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800688">c</span><span class="op" id="6800689">,</span>&nbsp;<span class="ident" id="6800691">err</span>&nbsp;<span class="op" id="6800695">:=</span>&nbsp;<span class="ident" id="6800698">Dial</span><span class="op" id="6800702">(</span><span class="string" id="6800703">&#34;tcp&#34;</span><span class="op" id="6800708">,</span>&nbsp;<span class="ident" id="6800710">ln</span><span class="op" id="6800712">.</span><span class="ident" id="6800713">Addr</span><span class="op" id="6800717">(</span><span class="op" id="6800718">)</span><span class="op" id="6800719">.</span><span class="ident" id="6800720">String</span><span class="op" id="6800726">(</span><span class="op" id="6800727">)</span><span class="op" id="6800728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800733">if</span>&nbsp;<span class="ident" id="6800736">err</span>&nbsp;<span class="op" id="6800740">!=</span>&nbsp;<span class="builtintype" id="6800743">nil</span>&nbsp;<span class="op" id="6800747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800753">t</span><span class="op" id="6800754">.</span><span class="ident" id="6800755">Fatalf</span><span class="op" id="6800761">(</span><span class="string" id="6800762">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6800772">,</span>&nbsp;<span class="ident" id="6800774">err</span><span class="op" id="6800777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6800782">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800787">clientc</span>&nbsp;<span class="op" id="6800795">:=</span>&nbsp;<span class="builtinfunc" id="6800798">make</span><span class="op" id="6800802">(</span><span class="keyword" id="6800803">chan</span>&nbsp;<span class="ident" id="6800808">copyRes</span><span class="op" id="6800815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6800820">go</span>&nbsp;<span class="keyword" id="6800823">func</span><span class="op" id="6800827">(</span><span class="op" id="6800828">)</span>&nbsp;<span class="op" id="6800830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800836">t0</span>&nbsp;<span class="op" id="6800839">:=</span>&nbsp;<span class="ident" id="6800842">time</span><span class="op" id="6800846">.</span><span class="ident" id="6800847">Now</span><span class="op" id="6800850">(</span><span class="op" id="6800851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800857">c</span><span class="op" id="6800858">.</span><span class="ident" id="6800859">SetDeadline</span><span class="op" id="6800870">(</span><span class="ident" id="6800871">t0</span><span class="op" id="6800873">.</span><span class="ident" id="6800874">Add</span><span class="op" id="6800877">(</span><span class="ident" id="6800878">timeout</span><span class="op" id="6800885">)</span><span class="op" id="6800886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800892">n</span><span class="op" id="6800893">,</span>&nbsp;<span class="ident" id="6800895">err</span>&nbsp;<span class="op" id="6800899">:=</span>&nbsp;<span class="ident" id="6800902">io</span><span class="op" id="6800904">.</span><span class="ident" id="6800905">Copy</span><span class="op" id="6800909">(</span><span class="ident" id="6800910">ioutil</span><span class="op" id="6800916">.</span><span class="ident" id="6800917">Discard</span><span class="op" id="6800924">,</span>&nbsp;<span class="ident" id="6800926">c</span><span class="op" id="6800927">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800933">d</span>&nbsp;<span class="op" id="6800935">:=</span>&nbsp;<span class="ident" id="6800938">time</span><span class="op" id="6800942">.</span><span class="ident" id="6800943">Since</span><span class="op" id="6800948">(</span><span class="ident" id="6800949">t0</span><span class="op" id="6800951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800957">c</span><span class="op" id="6800958">.</span><span class="ident" id="6800959">Close</span><span class="op" id="6800964">(</span><span class="op" id="6800965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6800971">clientc</span>&nbsp;<span class="op" id="6800979">&lt;-</span>&nbsp;<span class="ident" id="6800982">copyRes</span><span class="op" id="6800989">{</span><span class="ident" id="6800990">n</span><span class="op" id="6800991">,</span>&nbsp;<span class="ident" id="6800993">err</span><span class="op" id="6800996">,</span>&nbsp;<span class="ident" id="6800998">d</span><span class="op" id="6800999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801004">}</span><span class="op" id="6801005">(</span><span class="op" id="6801006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801012">tooLong</span>&nbsp;<span class="op" id="6801020">:=</span>&nbsp;<span class="num" id="6801023">5</span>&nbsp;<span class="op" id="6801025">*</span>&nbsp;<span class="ident" id="6801027">time</span><span class="op" id="6801031">.</span><span class="ident" id="6801032">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801042">select</span>&nbsp;<span class="op" id="6801049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801054">case</span>&nbsp;<span class="ident" id="6801059">res</span>&nbsp;<span class="op" id="6801063">:=</span>&nbsp;<span class="op" id="6801066">&lt;-</span><span class="ident" id="6801068">clientc</span><span class="op" id="6801075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801081">if</span>&nbsp;<span class="ident" id="6801084">isTimeout</span><span class="op" id="6801093">(</span><span class="ident" id="6801094">res</span><span class="op" id="6801097">.</span><span class="ident" id="6801098">err</span><span class="op" id="6801101">)</span>&nbsp;<span class="op" id="6801103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801110">t</span><span class="op" id="6801111">.</span><span class="ident" id="6801112">Logf</span><span class="op" id="6801116">(</span><span class="string" id="6801117">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6801173">,</span>&nbsp;<span class="ident" id="6801175">name</span><span class="op" id="6801179">,</span>&nbsp;<span class="ident" id="6801181">res</span><span class="op" id="6801184">.</span><span class="ident" id="6801185">d</span><span class="op" id="6801186">,</span>&nbsp;<span class="ident" id="6801188">res</span><span class="op" id="6801191">.</span><span class="ident" id="6801192">n</span><span class="op" id="6801193">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801199">}</span>&nbsp;<span class="keyword" id="6801201">else</span>&nbsp;<span class="op" id="6801206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801213">t</span><span class="op" id="6801214">.</span><span class="ident" id="6801215">Fatalf</span><span class="op" id="6801221">(</span><span class="string" id="6801222">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="6801267">,</span>&nbsp;<span class="ident" id="6801269">name</span><span class="op" id="6801273">,</span>&nbsp;<span class="ident" id="6801275">res</span><span class="op" id="6801278">.</span><span class="ident" id="6801279">n</span><span class="op" id="6801280">,</span>&nbsp;<span class="ident" id="6801282">res</span><span class="op" id="6801285">.</span><span class="ident" id="6801286">err</span><span class="op" id="6801289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801300">case</span>&nbsp;<span class="op" id="6801305">&lt;-</span><span class="ident" id="6801307">time</span><span class="op" id="6801311">.</span><span class="ident" id="6801312">After</span><span class="op" id="6801317">(</span><span class="ident" id="6801318">tooLong</span><span class="op" id="6801325">)</span><span class="op" id="6801326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801332">t</span><span class="op" id="6801333">.</span><span class="ident" id="6801334">Fatalf</span><span class="op" id="6801340">(</span><span class="string" id="6801341">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="6801406">,</span>&nbsp;<span class="ident" id="6801408">name</span><span class="op" id="6801412">,</span>&nbsp;<span class="ident" id="6801414">tooLong</span><span class="op" id="6801421">,</span>&nbsp;<span class="ident" id="6801423">timeout</span><span class="op" id="6801430">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801441">select</span>&nbsp;<span class="op" id="6801448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801453">case</span>&nbsp;<span class="ident" id="6801458">res</span>&nbsp;<span class="op" id="6801462">:=</span>&nbsp;<span class="op" id="6801465">&lt;-</span><span class="ident" id="6801467">servec</span><span class="op" id="6801473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801479">t</span><span class="op" id="6801480">.</span><span class="ident" id="6801481">Logf</span><span class="op" id="6801485">(</span><span class="string" id="6801486">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="6801521">,</span>&nbsp;<span class="ident" id="6801523">name</span><span class="op" id="6801527">,</span>&nbsp;<span class="ident" id="6801529">res</span><span class="op" id="6801532">.</span><span class="ident" id="6801533">d</span><span class="op" id="6801534">,</span>&nbsp;<span class="ident" id="6801536">res</span><span class="op" id="6801539">.</span><span class="ident" id="6801540">n</span><span class="op" id="6801541">,</span>&nbsp;<span class="ident" id="6801543">res</span><span class="op" id="6801546">.</span><span class="ident" id="6801547">err</span><span class="op" id="6801550">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801555">case</span>&nbsp;<span class="ident" id="6801560">err</span>&nbsp;<span class="op" id="6801564">:=</span>&nbsp;<span class="op" id="6801567">&lt;-</span><span class="ident" id="6801569">acceptc</span><span class="op" id="6801576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801582">t</span><span class="op" id="6801583">.</span><span class="ident" id="6801584">Fatalf</span><span class="op" id="6801590">(</span><span class="string" id="6801591">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6801619">,</span>&nbsp;<span class="ident" id="6801621">name</span><span class="op" id="6801625">,</span>&nbsp;<span class="ident" id="6801627">err</span><span class="op" id="6801630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801635">case</span>&nbsp;<span class="op" id="6801640">&lt;-</span><span class="ident" id="6801642">time</span><span class="op" id="6801646">.</span><span class="ident" id="6801647">After</span><span class="op" id="6801652">(</span><span class="ident" id="6801653">tooLong</span><span class="op" id="6801660">)</span><span class="op" id="6801661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801667">t</span><span class="op" id="6801668">.</span><span class="ident" id="6801669">Fatalf</span><span class="op" id="6801675">(</span><span class="string" id="6801676">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="6801730">,</span>&nbsp;<span class="ident" id="6801732">name</span><span class="op" id="6801736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801741">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801748">}</span><br>
<span class="lineno"></span><span class="op" id="6801750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6801753">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="6801823">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6801860">func</span>&nbsp;<span class="ident" id="6801865">TestReadDeadlineDataAvailable</span><span class="op" id="6801894">(</span><span class="ident" id="6801895">t</span>&nbsp;<span class="op" id="6801897">*</span><span class="ident" id="6801898">testing</span><span class="op" id="6801905">.</span><span class="ident" id="6801906">T</span><span class="op" id="6801907">)</span>&nbsp;<span class="op" id="6801909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801912">switch</span>&nbsp;<span class="ident" id="6801919">runtime</span><span class="op" id="6801926">.</span><span class="ident" id="6801927">GOOS</span>&nbsp;<span class="op" id="6801932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6801935">case</span>&nbsp;<span class="string" id="6801940">&#34;plan9&#34;</span><span class="op" id="6801947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6801951">t</span><span class="op" id="6801952">.</span><span class="ident" id="6801953">Skipf</span><span class="op" id="6801958">(</span><span class="string" id="6801959">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6801980">,</span>&nbsp;<span class="ident" id="6801982">runtime</span><span class="op" id="6801989">.</span><span class="ident" id="6801990">GOOS</span><span class="op" id="6801994">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6801997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802001">ln</span>&nbsp;<span class="op" id="6802004">:=</span>&nbsp;<span class="ident" id="6802007">newLocalListener</span><span class="op" id="6802023">(</span><span class="ident" id="6802024">t</span><span class="op" id="6802025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802028">defer</span>&nbsp;<span class="ident" id="6802034">ln</span><span class="op" id="6802036">.</span><span class="ident" id="6802037">Close</span><span class="op" id="6802042">(</span><span class="op" id="6802043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802047">servec</span>&nbsp;<span class="op" id="6802054">:=</span>&nbsp;<span class="builtinfunc" id="6802057">make</span><span class="op" id="6802061">(</span><span class="keyword" id="6802062">chan</span>&nbsp;<span class="ident" id="6802067">copyRes</span><span class="op" id="6802074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802077">const</span>&nbsp;<span class="ident" id="6802083">msg</span>&nbsp;<span class="op" id="6802087">=</span>&nbsp;<span class="string" id="6802089">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802149">go</span>&nbsp;<span class="keyword" id="6802152">func</span><span class="op" id="6802156">(</span><span class="op" id="6802157">)</span>&nbsp;<span class="op" id="6802159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802163">c</span><span class="op" id="6802164">,</span>&nbsp;<span class="ident" id="6802166">err</span>&nbsp;<span class="op" id="6802170">:=</span>&nbsp;<span class="ident" id="6802173">ln</span><span class="op" id="6802175">.</span><span class="ident" id="6802176">Accept</span><span class="op" id="6802182">(</span><span class="op" id="6802183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802187">if</span>&nbsp;<span class="ident" id="6802190">err</span>&nbsp;<span class="op" id="6802194">!=</span>&nbsp;<span class="builtintype" id="6802197">nil</span>&nbsp;<span class="op" id="6802201">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802206">t</span><span class="op" id="6802207">.</span><span class="ident" id="6802208">Errorf</span><span class="op" id="6802214">(</span><span class="string" id="6802215">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6802227">,</span>&nbsp;<span class="ident" id="6802229">err</span><span class="op" id="6802232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802237">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802250">defer</span>&nbsp;<span class="ident" id="6802256">c</span><span class="op" id="6802257">.</span><span class="ident" id="6802258">Close</span><span class="op" id="6802263">(</span><span class="op" id="6802264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802268">n</span><span class="op" id="6802269">,</span>&nbsp;<span class="ident" id="6802271">err</span>&nbsp;<span class="op" id="6802275">:=</span>&nbsp;<span class="ident" id="6802278">c</span><span class="op" id="6802279">.</span><span class="ident" id="6802280">Write</span><span class="op" id="6802285">(</span><span class="op" id="6802286">[</span><span class="op" id="6802287">]</span><span class="builtintype" id="6802288">byte</span><span class="op" id="6802292">(</span><span class="ident" id="6802293">msg</span><span class="op" id="6802296">)</span><span class="op" id="6802297">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802301">servec</span>&nbsp;<span class="op" id="6802308">&lt;-</span>&nbsp;<span class="ident" id="6802311">copyRes</span><span class="op" id="6802318">{</span><span class="ident" id="6802319">n</span><span class="op" id="6802320">:</span>&nbsp;<span class="ident" id="6802322">int64</span><span class="op" id="6802327">(</span><span class="ident" id="6802328">n</span><span class="op" id="6802329">)</span><span class="op" id="6802330">,</span>&nbsp;<span class="ident" id="6802332">err</span><span class="op" id="6802335">:</span>&nbsp;<span class="ident" id="6802337">err</span><span class="op" id="6802340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802343">}</span><span class="op" id="6802344">(</span><span class="op" id="6802345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802349">c</span><span class="op" id="6802350">,</span>&nbsp;<span class="ident" id="6802352">err</span>&nbsp;<span class="op" id="6802356">:=</span>&nbsp;<span class="ident" id="6802359">Dial</span><span class="op" id="6802363">(</span><span class="string" id="6802364">&#34;tcp&#34;</span><span class="op" id="6802369">,</span>&nbsp;<span class="ident" id="6802371">ln</span><span class="op" id="6802373">.</span><span class="ident" id="6802374">Addr</span><span class="op" id="6802378">(</span><span class="op" id="6802379">)</span><span class="op" id="6802380">.</span><span class="ident" id="6802381">String</span><span class="op" id="6802387">(</span><span class="op" id="6802388">)</span><span class="op" id="6802389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802392">if</span>&nbsp;<span class="ident" id="6802395">err</span>&nbsp;<span class="op" id="6802399">!=</span>&nbsp;<span class="builtintype" id="6802402">nil</span>&nbsp;<span class="op" id="6802406">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802410">t</span><span class="op" id="6802411">.</span><span class="ident" id="6802412">Fatalf</span><span class="op" id="6802418">(</span><span class="string" id="6802419">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6802429">,</span>&nbsp;<span class="ident" id="6802431">err</span><span class="op" id="6802434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802440">defer</span>&nbsp;<span class="ident" id="6802446">c</span><span class="op" id="6802447">.</span><span class="ident" id="6802448">Close</span><span class="op" id="6802453">(</span><span class="op" id="6802454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802457">if</span>&nbsp;<span class="ident" id="6802460">res</span>&nbsp;<span class="op" id="6802464">:=</span>&nbsp;<span class="op" id="6802467">&lt;-</span><span class="ident" id="6802469">servec</span><span class="op" id="6802475">;</span>&nbsp;<span class="ident" id="6802477">res</span><span class="op" id="6802480">.</span><span class="ident" id="6802481">err</span>&nbsp;<span class="op" id="6802485">!=</span>&nbsp;<span class="builtintype" id="6802488">nil</span>&nbsp;<span class="op" id="6802492">||</span>&nbsp;<span class="ident" id="6802495">res</span><span class="op" id="6802498">.</span><span class="ident" id="6802499">n</span>&nbsp;<span class="op" id="6802501">!=</span>&nbsp;<span class="ident" id="6802504">int64</span><span class="op" id="6802509">(</span><span class="builtinfunc" id="6802510">len</span><span class="op" id="6802513">(</span><span class="ident" id="6802514">msg</span><span class="op" id="6802517">)</span><span class="op" id="6802518">)</span>&nbsp;<span class="op" id="6802520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802524">t</span><span class="op" id="6802525">.</span><span class="ident" id="6802526">Fatalf</span><span class="op" id="6802532">(</span><span class="string" id="6802533">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="6802592">,</span>&nbsp;<span class="ident" id="6802594">res</span><span class="op" id="6802597">.</span><span class="ident" id="6802598">n</span><span class="op" id="6802599">,</span>&nbsp;<span class="ident" id="6802601">res</span><span class="op" id="6802604">.</span><span class="ident" id="6802605">err</span><span class="op" id="6802608">,</span>&nbsp;<span class="builtinfunc" id="6802610">len</span><span class="op" id="6802613">(</span><span class="ident" id="6802614">msg</span><span class="op" id="6802617">)</span><span class="op" id="6802618">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802624">c</span><span class="op" id="6802625">.</span><span class="ident" id="6802626">SetReadDeadline</span><span class="op" id="6802641">(</span><span class="ident" id="6802642">time</span><span class="op" id="6802646">.</span><span class="ident" id="6802647">Now</span><span class="op" id="6802650">(</span><span class="op" id="6802651">)</span><span class="op" id="6802652">.</span><span class="ident" id="6802653">Add</span><span class="op" id="6802656">(</span><span class="op" id="6802657">-</span><span class="num" id="6802658">5</span>&nbsp;<span class="op" id="6802660">*</span>&nbsp;<span class="ident" id="6802662">time</span><span class="op" id="6802666">.</span><span class="ident" id="6802667">Second</span><span class="op" id="6802673">)</span><span class="op" id="6802674">)</span>&nbsp;<span class="comment" id="6802676">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802693">buf</span>&nbsp;<span class="op" id="6802697">:=</span>&nbsp;<span class="builtinfunc" id="6802700">make</span><span class="op" id="6802704">(</span><span class="op" id="6802705">[</span><span class="op" id="6802706">]</span><span class="builtintype" id="6802707">byte</span><span class="op" id="6802711">,</span>&nbsp;<span class="builtinfunc" id="6802713">len</span><span class="op" id="6802716">(</span><span class="ident" id="6802717">msg</span><span class="op" id="6802720">)</span><span class="op" id="6802721">/</span><span class="num" id="6802722">2</span><span class="op" id="6802723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802726">n</span><span class="op" id="6802727">,</span>&nbsp;<span class="ident" id="6802729">err</span>&nbsp;<span class="op" id="6802733">:=</span>&nbsp;<span class="ident" id="6802736">c</span><span class="op" id="6802737">.</span><span class="ident" id="6802738">Read</span><span class="op" id="6802742">(</span><span class="ident" id="6802743">buf</span><span class="op" id="6802746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6802749">if</span>&nbsp;<span class="ident" id="6802752">n</span>&nbsp;<span class="op" id="6802754">&gt;</span>&nbsp;<span class="num" id="6802756">0</span>&nbsp;<span class="op" id="6802758">||</span>&nbsp;<span class="op" id="6802761">!</span><span class="ident" id="6802762">isTimeout</span><span class="op" id="6802771">(</span><span class="ident" id="6802772">err</span><span class="op" id="6802775">)</span>&nbsp;<span class="op" id="6802777">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6802781">t</span><span class="op" id="6802782">.</span><span class="ident" id="6802783">Fatalf</span><span class="op" id="6802789">(</span><span class="string" id="6802790">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="6802837">,</span>&nbsp;<span class="ident" id="6802839">n</span><span class="op" id="6802840">,</span>&nbsp;<span class="ident" id="6802842">buf</span><span class="op" id="6802845">[</span><span class="op" id="6802846">:</span><span class="ident" id="6802847">n</span><span class="op" id="6802848">]</span><span class="op" id="6802849">,</span>&nbsp;<span class="ident" id="6802851">err</span><span class="op" id="6802854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6802857">}</span><br>
<span class="lineno"></span><span class="op" id="6802859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6802862">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="6802936">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="6802983">func</span>&nbsp;<span class="ident" id="6802988">TestWriteDeadlineBufferAvailable</span><span class="op" id="6803020">(</span><span class="ident" id="6803021">t</span>&nbsp;<span class="op" id="6803023">*</span><span class="ident" id="6803024">testing</span><span class="op" id="6803031">.</span><span class="ident" id="6803032">T</span><span class="op" id="6803033">)</span>&nbsp;<span class="op" id="6803035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803038">switch</span>&nbsp;<span class="ident" id="6803045">runtime</span><span class="op" id="6803052">.</span><span class="ident" id="6803053">GOOS</span>&nbsp;<span class="op" id="6803058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803061">case</span>&nbsp;<span class="string" id="6803066">&#34;plan9&#34;</span><span class="op" id="6803073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803077">t</span><span class="op" id="6803078">.</span><span class="ident" id="6803079">Skipf</span><span class="op" id="6803084">(</span><span class="string" id="6803085">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6803106">,</span>&nbsp;<span class="ident" id="6803108">runtime</span><span class="op" id="6803115">.</span><span class="ident" id="6803116">GOOS</span><span class="op" id="6803120">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803127">ln</span>&nbsp;<span class="op" id="6803130">:=</span>&nbsp;<span class="ident" id="6803133">newLocalListener</span><span class="op" id="6803149">(</span><span class="ident" id="6803150">t</span><span class="op" id="6803151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803154">defer</span>&nbsp;<span class="ident" id="6803160">ln</span><span class="op" id="6803162">.</span><span class="ident" id="6803163">Close</span><span class="op" id="6803168">(</span><span class="op" id="6803169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803173">servec</span>&nbsp;<span class="op" id="6803180">:=</span>&nbsp;<span class="builtinfunc" id="6803183">make</span><span class="op" id="6803187">(</span><span class="keyword" id="6803188">chan</span>&nbsp;<span class="ident" id="6803193">copyRes</span><span class="op" id="6803200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803203">go</span>&nbsp;<span class="keyword" id="6803206">func</span><span class="op" id="6803210">(</span><span class="op" id="6803211">)</span>&nbsp;<span class="op" id="6803213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803217">c</span><span class="op" id="6803218">,</span>&nbsp;<span class="ident" id="6803220">err</span>&nbsp;<span class="op" id="6803224">:=</span>&nbsp;<span class="ident" id="6803227">ln</span><span class="op" id="6803229">.</span><span class="ident" id="6803230">Accept</span><span class="op" id="6803236">(</span><span class="op" id="6803237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803241">if</span>&nbsp;<span class="ident" id="6803244">err</span>&nbsp;<span class="op" id="6803248">!=</span>&nbsp;<span class="builtintype" id="6803251">nil</span>&nbsp;<span class="op" id="6803255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803260">t</span><span class="op" id="6803261">.</span><span class="ident" id="6803262">Errorf</span><span class="op" id="6803268">(</span><span class="string" id="6803269">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6803281">,</span>&nbsp;<span class="ident" id="6803283">err</span><span class="op" id="6803286">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803291">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803304">defer</span>&nbsp;<span class="ident" id="6803310">c</span><span class="op" id="6803311">.</span><span class="ident" id="6803312">Close</span><span class="op" id="6803317">(</span><span class="op" id="6803318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803322">c</span><span class="op" id="6803323">.</span><span class="ident" id="6803324">SetWriteDeadline</span><span class="op" id="6803340">(</span><span class="ident" id="6803341">time</span><span class="op" id="6803345">.</span><span class="ident" id="6803346">Now</span><span class="op" id="6803349">(</span><span class="op" id="6803350">)</span><span class="op" id="6803351">.</span><span class="ident" id="6803352">Add</span><span class="op" id="6803355">(</span><span class="op" id="6803356">-</span><span class="num" id="6803357">5</span>&nbsp;<span class="op" id="6803359">*</span>&nbsp;<span class="ident" id="6803361">time</span><span class="op" id="6803365">.</span><span class="ident" id="6803366">Second</span><span class="op" id="6803372">)</span><span class="op" id="6803373">)</span>&nbsp;<span class="comment" id="6803375">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803392">n</span><span class="op" id="6803393">,</span>&nbsp;<span class="ident" id="6803395">err</span>&nbsp;<span class="op" id="6803399">:=</span>&nbsp;<span class="ident" id="6803402">c</span><span class="op" id="6803403">.</span><span class="ident" id="6803404">Write</span><span class="op" id="6803409">(</span><span class="op" id="6803410">[</span><span class="op" id="6803411">]</span><span class="builtintype" id="6803412">byte</span><span class="op" id="6803416">{</span><span class="string" id="6803417">&#39;x&#39;</span><span class="op" id="6803420">}</span><span class="op" id="6803421">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803425">servec</span>&nbsp;<span class="op" id="6803432">&lt;-</span>&nbsp;<span class="ident" id="6803435">copyRes</span><span class="op" id="6803442">{</span><span class="ident" id="6803443">n</span><span class="op" id="6803444">:</span>&nbsp;<span class="ident" id="6803446">int64</span><span class="op" id="6803451">(</span><span class="ident" id="6803452">n</span><span class="op" id="6803453">)</span><span class="op" id="6803454">,</span>&nbsp;<span class="ident" id="6803456">err</span><span class="op" id="6803459">:</span>&nbsp;<span class="ident" id="6803461">err</span><span class="op" id="6803464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803467">}</span><span class="op" id="6803468">(</span><span class="op" id="6803469">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803473">c</span><span class="op" id="6803474">,</span>&nbsp;<span class="ident" id="6803476">err</span>&nbsp;<span class="op" id="6803480">:=</span>&nbsp;<span class="ident" id="6803483">Dial</span><span class="op" id="6803487">(</span><span class="string" id="6803488">&#34;tcp&#34;</span><span class="op" id="6803493">,</span>&nbsp;<span class="ident" id="6803495">ln</span><span class="op" id="6803497">.</span><span class="ident" id="6803498">Addr</span><span class="op" id="6803502">(</span><span class="op" id="6803503">)</span><span class="op" id="6803504">.</span><span class="ident" id="6803505">String</span><span class="op" id="6803511">(</span><span class="op" id="6803512">)</span><span class="op" id="6803513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803516">if</span>&nbsp;<span class="ident" id="6803519">err</span>&nbsp;<span class="op" id="6803523">!=</span>&nbsp;<span class="builtintype" id="6803526">nil</span>&nbsp;<span class="op" id="6803530">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803534">t</span><span class="op" id="6803535">.</span><span class="ident" id="6803536">Fatalf</span><span class="op" id="6803542">(</span><span class="string" id="6803543">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6803553">,</span>&nbsp;<span class="ident" id="6803555">err</span><span class="op" id="6803558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803564">defer</span>&nbsp;<span class="ident" id="6803570">c</span><span class="op" id="6803571">.</span><span class="ident" id="6803572">Close</span><span class="op" id="6803577">(</span><span class="op" id="6803578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803581">res</span>&nbsp;<span class="op" id="6803585">:=</span>&nbsp;<span class="op" id="6803588">&lt;-</span><span class="ident" id="6803590">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803598">if</span>&nbsp;<span class="ident" id="6803601">res</span><span class="op" id="6803604">.</span><span class="ident" id="6803605">n</span>&nbsp;<span class="op" id="6803607">!=</span>&nbsp;<span class="num" id="6803610">0</span>&nbsp;<span class="op" id="6803612">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803616">t</span><span class="op" id="6803617">.</span><span class="ident" id="6803618">Errorf</span><span class="op" id="6803624">(</span><span class="string" id="6803625">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6803645">,</span>&nbsp;<span class="ident" id="6803647">res</span><span class="op" id="6803650">.</span><span class="ident" id="6803651">n</span><span class="op" id="6803652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803658">if</span>&nbsp;<span class="op" id="6803661">!</span><span class="ident" id="6803662">isTimeout</span><span class="op" id="6803671">(</span><span class="ident" id="6803672">res</span><span class="op" id="6803675">.</span><span class="ident" id="6803676">err</span><span class="op" id="6803679">)</span>&nbsp;<span class="op" id="6803681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803685">t</span><span class="op" id="6803686">.</span><span class="ident" id="6803687">Errorf</span><span class="op" id="6803693">(</span><span class="string" id="6803694">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6803726">,</span>&nbsp;<span class="ident" id="6803728">res</span><span class="op" id="6803731">.</span><span class="ident" id="6803732">err</span><span class="op" id="6803735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6803738">}</span><br>
<span class="lineno">600</span><span class="op" id="6803740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6803743">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="6803823">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="6803869">func</span>&nbsp;<span class="ident" id="6803874">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="6803911">(</span><span class="ident" id="6803912">t</span>&nbsp;<span class="op" id="6803914">*</span><span class="ident" id="6803915">testing</span><span class="op" id="6803922">.</span><span class="ident" id="6803923">T</span><span class="op" id="6803924">)</span>&nbsp;<span class="op" id="6803926">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803929">switch</span>&nbsp;<span class="ident" id="6803936">runtime</span><span class="op" id="6803943">.</span><span class="ident" id="6803944">GOOS</span>&nbsp;<span class="op" id="6803949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6803952">case</span>&nbsp;<span class="string" id="6803957">&#34;plan9&#34;</span><span class="op" id="6803964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6803968">t</span><span class="op" id="6803969">.</span><span class="ident" id="6803970">Skipf</span><span class="op" id="6803975">(</span><span class="string" id="6803976">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6803997">,</span>&nbsp;<span class="ident" id="6803999">runtime</span><span class="op" id="6804006">.</span><span class="ident" id="6804007">GOOS</span><span class="op" id="6804011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804018">ln</span>&nbsp;<span class="op" id="6804021">:=</span>&nbsp;<span class="ident" id="6804024">newLocalListener</span><span class="op" id="6804040">(</span><span class="ident" id="6804041">t</span><span class="op" id="6804042">)</span><span class="op" id="6804043">.</span><span class="op" id="6804044">(</span><span class="op" id="6804045">*</span><span class="ident" id="6804046">TCPListener</span><span class="op" id="6804057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804060">defer</span>&nbsp;<span class="ident" id="6804066">ln</span><span class="op" id="6804068">.</span><span class="ident" id="6804069">Close</span><span class="op" id="6804074">(</span><span class="op" id="6804075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804079">go</span>&nbsp;<span class="keyword" id="6804082">func</span><span class="op" id="6804086">(</span><span class="op" id="6804087">)</span>&nbsp;<span class="op" id="6804089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804093">c</span><span class="op" id="6804094">,</span>&nbsp;<span class="ident" id="6804096">err</span>&nbsp;<span class="op" id="6804100">:=</span>&nbsp;<span class="ident" id="6804103">Dial</span><span class="op" id="6804107">(</span><span class="string" id="6804108">&#34;tcp&#34;</span><span class="op" id="6804113">,</span>&nbsp;<span class="ident" id="6804115">ln</span><span class="op" id="6804117">.</span><span class="ident" id="6804118">Addr</span><span class="op" id="6804122">(</span><span class="op" id="6804123">)</span><span class="op" id="6804124">.</span><span class="ident" id="6804125">String</span><span class="op" id="6804131">(</span><span class="op" id="6804132">)</span><span class="op" id="6804133">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804137">if</span>&nbsp;<span class="ident" id="6804140">err</span>&nbsp;<span class="op" id="6804144">!=</span>&nbsp;<span class="builtintype" id="6804147">nil</span>&nbsp;<span class="op" id="6804151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804156">t</span><span class="op" id="6804157">.</span><span class="ident" id="6804158">Errorf</span><span class="op" id="6804164">(</span><span class="string" id="6804165">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6804175">,</span>&nbsp;<span class="ident" id="6804177">err</span><span class="op" id="6804180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804185">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804198">defer</span>&nbsp;<span class="ident" id="6804204">c</span><span class="op" id="6804205">.</span><span class="ident" id="6804206">Close</span><span class="op" id="6804211">(</span><span class="op" id="6804212">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804216">var</span>&nbsp;<span class="ident" id="6804220">buf</span>&nbsp;<span class="op" id="6804224">[</span><span class="num" id="6804225">1</span><span class="op" id="6804226">]</span><span class="builtintype" id="6804227">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804234">c</span><span class="op" id="6804235">.</span><span class="ident" id="6804236">Read</span><span class="op" id="6804240">(</span><span class="ident" id="6804241">buf</span><span class="op" id="6804244">[</span><span class="op" id="6804245">:</span><span class="op" id="6804246">]</span><span class="op" id="6804247">)</span>&nbsp;<span class="comment" id="6804249">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804302">}</span><span class="op" id="6804303">(</span><span class="op" id="6804304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804307">time</span><span class="op" id="6804311">.</span><span class="ident" id="6804312">Sleep</span><span class="op" id="6804317">(</span><span class="num" id="6804318">10</span>&nbsp;<span class="op" id="6804321">*</span>&nbsp;<span class="ident" id="6804323">time</span><span class="op" id="6804327">.</span><span class="ident" id="6804328">Millisecond</span><span class="op" id="6804339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804342">ln</span><span class="op" id="6804344">.</span><span class="ident" id="6804345">SetDeadline</span><span class="op" id="6804356">(</span><span class="ident" id="6804357">time</span><span class="op" id="6804361">.</span><span class="ident" id="6804362">Now</span><span class="op" id="6804365">(</span><span class="op" id="6804366">)</span><span class="op" id="6804367">.</span><span class="ident" id="6804368">Add</span><span class="op" id="6804371">(</span><span class="op" id="6804372">-</span><span class="num" id="6804373">5</span>&nbsp;<span class="op" id="6804375">*</span>&nbsp;<span class="ident" id="6804377">time</span><span class="op" id="6804381">.</span><span class="ident" id="6804382">Second</span><span class="op" id="6804388">)</span><span class="op" id="6804389">)</span>&nbsp;<span class="comment" id="6804391">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804407">c</span><span class="op" id="6804408">,</span>&nbsp;<span class="ident" id="6804410">err</span>&nbsp;<span class="op" id="6804414">:=</span>&nbsp;<span class="ident" id="6804417">ln</span><span class="op" id="6804419">.</span><span class="ident" id="6804420">Accept</span><span class="op" id="6804426">(</span><span class="op" id="6804427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804430">if</span>&nbsp;<span class="ident" id="6804433">err</span>&nbsp;<span class="op" id="6804437">==</span>&nbsp;<span class="builtintype" id="6804440">nil</span>&nbsp;<span class="op" id="6804444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804448">defer</span>&nbsp;<span class="ident" id="6804454">c</span><span class="op" id="6804455">.</span><span class="ident" id="6804456">Close</span><span class="op" id="6804461">(</span><span class="op" id="6804462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804468">if</span>&nbsp;<span class="op" id="6804471">!</span><span class="ident" id="6804472">isTimeout</span><span class="op" id="6804481">(</span><span class="ident" id="6804482">err</span><span class="op" id="6804485">)</span>&nbsp;<span class="op" id="6804487">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804491">t</span><span class="op" id="6804492">.</span><span class="ident" id="6804493">Fatalf</span><span class="op" id="6804499">(</span><span class="string" id="6804500">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6804530">,</span>&nbsp;<span class="ident" id="6804532">err</span><span class="op" id="6804535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804538">}</span><br>
<span class="lineno"></span><span class="op" id="6804540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6804543">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="6804615">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6804669">func</span>&nbsp;<span class="ident" id="6804674">TestConnectDeadlineInThePast</span><span class="op" id="6804702">(</span><span class="ident" id="6804703">t</span>&nbsp;<span class="op" id="6804705">*</span><span class="ident" id="6804706">testing</span><span class="op" id="6804713">.</span><span class="ident" id="6804714">T</span><span class="op" id="6804715">)</span>&nbsp;<span class="op" id="6804717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804720">switch</span>&nbsp;<span class="ident" id="6804727">runtime</span><span class="op" id="6804734">.</span><span class="ident" id="6804735">GOOS</span>&nbsp;<span class="op" id="6804740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804743">case</span>&nbsp;<span class="string" id="6804748">&#34;plan9&#34;</span><span class="op" id="6804755">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804759">t</span><span class="op" id="6804760">.</span><span class="ident" id="6804761">Skipf</span><span class="op" id="6804766">(</span><span class="string" id="6804767">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6804788">,</span>&nbsp;<span class="ident" id="6804790">runtime</span><span class="op" id="6804797">.</span><span class="ident" id="6804798">GOOS</span><span class="op" id="6804802">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804809">ln</span>&nbsp;<span class="op" id="6804812">:=</span>&nbsp;<span class="ident" id="6804815">newLocalListener</span><span class="op" id="6804831">(</span><span class="ident" id="6804832">t</span><span class="op" id="6804833">)</span><span class="op" id="6804834">.</span><span class="op" id="6804835">(</span><span class="op" id="6804836">*</span><span class="ident" id="6804837">TCPListener</span><span class="op" id="6804848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804851">defer</span>&nbsp;<span class="ident" id="6804857">ln</span><span class="op" id="6804859">.</span><span class="ident" id="6804860">Close</span><span class="op" id="6804865">(</span><span class="op" id="6804866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804870">go</span>&nbsp;<span class="keyword" id="6804873">func</span><span class="op" id="6804877">(</span><span class="op" id="6804878">)</span>&nbsp;<span class="op" id="6804880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804884">c</span><span class="op" id="6804885">,</span>&nbsp;<span class="ident" id="6804887">err</span>&nbsp;<span class="op" id="6804891">:=</span>&nbsp;<span class="ident" id="6804894">ln</span><span class="op" id="6804896">.</span><span class="ident" id="6804897">Accept</span><span class="op" id="6804903">(</span><span class="op" id="6804904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804908">if</span>&nbsp;<span class="ident" id="6804911">err</span>&nbsp;<span class="op" id="6804915">==</span>&nbsp;<span class="builtintype" id="6804918">nil</span>&nbsp;<span class="op" id="6804922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6804927">defer</span>&nbsp;<span class="ident" id="6804933">c</span><span class="op" id="6804934">.</span><span class="ident" id="6804935">Close</span><span class="op" id="6804940">(</span><span class="op" id="6804941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804945">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6804948">}</span><span class="op" id="6804949">(</span><span class="op" id="6804950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804953">time</span><span class="op" id="6804957">.</span><span class="ident" id="6804958">Sleep</span><span class="op" id="6804963">(</span><span class="num" id="6804964">10</span>&nbsp;<span class="op" id="6804967">*</span>&nbsp;<span class="ident" id="6804969">time</span><span class="op" id="6804973">.</span><span class="ident" id="6804974">Millisecond</span><span class="op" id="6804985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6804988">c</span><span class="op" id="6804989">,</span>&nbsp;<span class="ident" id="6804991">err</span>&nbsp;<span class="op" id="6804995">:=</span>&nbsp;<span class="ident" id="6804998">DialTimeout</span><span class="op" id="6805009">(</span><span class="string" id="6805010">&#34;tcp&#34;</span><span class="op" id="6805015">,</span>&nbsp;<span class="ident" id="6805017">ln</span><span class="op" id="6805019">.</span><span class="ident" id="6805020">Addr</span><span class="op" id="6805024">(</span><span class="op" id="6805025">)</span><span class="op" id="6805026">.</span><span class="ident" id="6805027">String</span><span class="op" id="6805033">(</span><span class="op" id="6805034">)</span><span class="op" id="6805035">,</span>&nbsp;<span class="op" id="6805037">-</span><span class="num" id="6805038">5</span><span class="op" id="6805039">*</span><span class="ident" id="6805040">time</span><span class="op" id="6805044">.</span><span class="ident" id="6805045">Second</span><span class="op" id="6805051">)</span>&nbsp;<span class="comment" id="6805053">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805069">if</span>&nbsp;<span class="ident" id="6805072">err</span>&nbsp;<span class="op" id="6805076">==</span>&nbsp;<span class="builtintype" id="6805079">nil</span>&nbsp;<span class="op" id="6805083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805087">defer</span>&nbsp;<span class="ident" id="6805093">c</span><span class="op" id="6805094">.</span><span class="ident" id="6805095">Close</span><span class="op" id="6805100">(</span><span class="op" id="6805101">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805107">if</span>&nbsp;<span class="op" id="6805110">!</span><span class="ident" id="6805111">isTimeout</span><span class="op" id="6805120">(</span><span class="ident" id="6805121">err</span><span class="op" id="6805124">)</span>&nbsp;<span class="op" id="6805126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805130">t</span><span class="op" id="6805131">.</span><span class="ident" id="6805132">Fatalf</span><span class="op" id="6805138">(</span><span class="string" id="6805139">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6805174">,</span>&nbsp;<span class="ident" id="6805176">err</span><span class="op" id="6805179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805182">}</span><br>
<span class="lineno"></span><span class="op" id="6805184">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="6805187">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="6805249">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="6805291">func</span>&nbsp;<span class="ident" id="6805296">TestProlongTimeout</span><span class="op" id="6805314">(</span><span class="ident" id="6805315">t</span>&nbsp;<span class="op" id="6805317">*</span><span class="ident" id="6805318">testing</span><span class="op" id="6805325">.</span><span class="ident" id="6805326">T</span><span class="op" id="6805327">)</span>&nbsp;<span class="op" id="6805329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805332">switch</span>&nbsp;<span class="ident" id="6805339">runtime</span><span class="op" id="6805346">.</span><span class="ident" id="6805347">GOOS</span>&nbsp;<span class="op" id="6805352">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805355">case</span>&nbsp;<span class="string" id="6805360">&#34;plan9&#34;</span><span class="op" id="6805367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805371">t</span><span class="op" id="6805372">.</span><span class="ident" id="6805373">Skipf</span><span class="op" id="6805378">(</span><span class="string" id="6805379">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6805400">,</span>&nbsp;<span class="ident" id="6805402">runtime</span><span class="op" id="6805409">.</span><span class="ident" id="6805410">GOOS</span><span class="op" id="6805414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805421">ln</span>&nbsp;<span class="op" id="6805424">:=</span>&nbsp;<span class="ident" id="6805427">newLocalListener</span><span class="op" id="6805443">(</span><span class="ident" id="6805444">t</span><span class="op" id="6805445">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805448">defer</span>&nbsp;<span class="ident" id="6805454">ln</span><span class="op" id="6805456">.</span><span class="ident" id="6805457">Close</span><span class="op" id="6805462">(</span><span class="op" id="6805463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805466">connected</span>&nbsp;<span class="op" id="6805476">:=</span>&nbsp;<span class="builtinfunc" id="6805479">make</span><span class="op" id="6805483">(</span><span class="keyword" id="6805484">chan</span>&nbsp;<span class="builtintype" id="6805489">bool</span><span class="op" id="6805493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805496">go</span>&nbsp;<span class="keyword" id="6805499">func</span><span class="op" id="6805503">(</span><span class="op" id="6805504">)</span>&nbsp;<span class="op" id="6805506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805510">s</span><span class="op" id="6805511">,</span>&nbsp;<span class="ident" id="6805513">err</span>&nbsp;<span class="op" id="6805517">:=</span>&nbsp;<span class="ident" id="6805520">ln</span><span class="op" id="6805522">.</span><span class="ident" id="6805523">Accept</span><span class="op" id="6805529">(</span><span class="op" id="6805530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805534">connected</span>&nbsp;<span class="op" id="6805544">&lt;-</span>&nbsp;<span class="builtintype" id="6805547">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805554">if</span>&nbsp;<span class="ident" id="6805557">err</span>&nbsp;<span class="op" id="6805561">!=</span>&nbsp;<span class="builtintype" id="6805564">nil</span>&nbsp;<span class="op" id="6805568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805573">t</span><span class="op" id="6805574">.</span><span class="ident" id="6805575">Errorf</span><span class="op" id="6805581">(</span><span class="string" id="6805582">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="6805597">,</span>&nbsp;<span class="ident" id="6805599">err</span><span class="op" id="6805602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805607">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805620">defer</span>&nbsp;<span class="ident" id="6805626">s</span><span class="op" id="6805627">.</span><span class="ident" id="6805628">Close</span><span class="op" id="6805633">(</span><span class="op" id="6805634">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805638">s</span><span class="op" id="6805639">.</span><span class="ident" id="6805640">SetDeadline</span><span class="op" id="6805651">(</span><span class="ident" id="6805652">time</span><span class="op" id="6805656">.</span><span class="ident" id="6805657">Now</span><span class="op" id="6805660">(</span><span class="op" id="6805661">)</span><span class="op" id="6805662">.</span><span class="ident" id="6805663">Add</span><span class="op" id="6805666">(</span><span class="ident" id="6805667">time</span><span class="op" id="6805671">.</span><span class="ident" id="6805672">Hour</span><span class="op" id="6805676">)</span><span class="op" id="6805677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805681">go</span>&nbsp;<span class="keyword" id="6805684">func</span><span class="op" id="6805688">(</span><span class="op" id="6805689">)</span>&nbsp;<span class="op" id="6805691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805696">var</span>&nbsp;<span class="ident" id="6805700">buf</span>&nbsp;<span class="op" id="6805704">[</span><span class="num" id="6805705">4096</span><span class="op" id="6805709">]</span><span class="builtintype" id="6805710">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805718">for</span>&nbsp;<span class="op" id="6805722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805728">_</span><span class="op" id="6805729">,</span>&nbsp;<span class="ident" id="6805731">err</span>&nbsp;<span class="op" id="6805735">:=</span>&nbsp;<span class="ident" id="6805738">s</span><span class="op" id="6805739">.</span><span class="ident" id="6805740">Write</span><span class="op" id="6805745">(</span><span class="ident" id="6805746">buf</span><span class="op" id="6805749">[</span><span class="op" id="6805750">:</span><span class="op" id="6805751">]</span><span class="op" id="6805752">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805758">if</span>&nbsp;<span class="ident" id="6805761">err</span>&nbsp;<span class="op" id="6805765">!=</span>&nbsp;<span class="builtintype" id="6805768">nil</span>&nbsp;<span class="op" id="6805772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805779">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805795">s</span><span class="op" id="6805796">.</span><span class="ident" id="6805797">SetDeadline</span><span class="op" id="6805808">(</span><span class="ident" id="6805809">time</span><span class="op" id="6805813">.</span><span class="ident" id="6805814">Now</span><span class="op" id="6805817">(</span><span class="op" id="6805818">)</span><span class="op" id="6805819">.</span><span class="ident" id="6805820">Add</span><span class="op" id="6805823">(</span><span class="ident" id="6805824">time</span><span class="op" id="6805828">.</span><span class="ident" id="6805829">Hour</span><span class="op" id="6805833">)</span><span class="op" id="6805834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805839">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805843">}</span><span class="op" id="6805844">(</span><span class="op" id="6805845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805849">buf</span>&nbsp;<span class="op" id="6805853">:=</span>&nbsp;<span class="builtinfunc" id="6805856">make</span><span class="op" id="6805860">(</span><span class="op" id="6805861">[</span><span class="op" id="6805862">]</span><span class="builtintype" id="6805863">byte</span><span class="op" id="6805867">,</span>&nbsp;<span class="num" id="6805869">1</span><span class="op" id="6805870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805874">for</span>&nbsp;<span class="op" id="6805878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805883">_</span><span class="op" id="6805884">,</span>&nbsp;<span class="ident" id="6805886">err</span>&nbsp;<span class="op" id="6805890">:=</span>&nbsp;<span class="ident" id="6805893">s</span><span class="op" id="6805894">.</span><span class="ident" id="6805895">Read</span><span class="op" id="6805899">(</span><span class="ident" id="6805900">buf</span><span class="op" id="6805903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805908">if</span>&nbsp;<span class="ident" id="6805911">err</span>&nbsp;<span class="op" id="6805915">!=</span>&nbsp;<span class="builtintype" id="6805918">nil</span>&nbsp;<span class="op" id="6805922">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6805928">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805942">s</span><span class="op" id="6805943">.</span><span class="ident" id="6805944">SetDeadline</span><span class="op" id="6805955">(</span><span class="ident" id="6805956">time</span><span class="op" id="6805960">.</span><span class="ident" id="6805961">Now</span><span class="op" id="6805964">(</span><span class="op" id="6805965">)</span><span class="op" id="6805966">.</span><span class="ident" id="6805967">Add</span><span class="op" id="6805970">(</span><span class="ident" id="6805971">time</span><span class="op" id="6805975">.</span><span class="ident" id="6805976">Hour</span><span class="op" id="6805980">)</span><span class="op" id="6805981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6805988">}</span><span class="op" id="6805989">(</span><span class="op" id="6805990">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6805993">c</span><span class="op" id="6805994">,</span>&nbsp;<span class="ident" id="6805996">err</span>&nbsp;<span class="op" id="6806000">:=</span>&nbsp;<span class="ident" id="6806003">Dial</span><span class="op" id="6806007">(</span><span class="string" id="6806008">&#34;tcp&#34;</span><span class="op" id="6806013">,</span>&nbsp;<span class="ident" id="6806015">ln</span><span class="op" id="6806017">.</span><span class="ident" id="6806018">Addr</span><span class="op" id="6806022">(</span><span class="op" id="6806023">)</span><span class="op" id="6806024">.</span><span class="ident" id="6806025">String</span><span class="op" id="6806031">(</span><span class="op" id="6806032">)</span><span class="op" id="6806033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806036">if</span>&nbsp;<span class="ident" id="6806039">err</span>&nbsp;<span class="op" id="6806043">!=</span>&nbsp;<span class="builtintype" id="6806046">nil</span>&nbsp;<span class="op" id="6806050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806054">t</span><span class="op" id="6806055">.</span><span class="ident" id="6806056">Fatalf</span><span class="op" id="6806062">(</span><span class="string" id="6806063">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="6806076">,</span>&nbsp;<span class="ident" id="6806078">err</span><span class="op" id="6806081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806087">defer</span>&nbsp;<span class="ident" id="6806093">c</span><span class="op" id="6806094">.</span><span class="ident" id="6806095">Close</span><span class="op" id="6806100">(</span><span class="op" id="6806101">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806104">&lt;-</span><span class="ident" id="6806106">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806117">for</span>&nbsp;<span class="ident" id="6806121">i</span>&nbsp;<span class="op" id="6806123">:=</span>&nbsp;<span class="num" id="6806126">0</span><span class="op" id="6806127">;</span>&nbsp;<span class="ident" id="6806129">i</span>&nbsp;<span class="op" id="6806131">&lt;</span>&nbsp;<span class="num" id="6806133">1024</span><span class="op" id="6806137">;</span>&nbsp;<span class="ident" id="6806139">i</span><span class="op" id="6806140">++</span>&nbsp;<span class="op" id="6806143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806147">var</span>&nbsp;<span class="ident" id="6806151">buf</span>&nbsp;<span class="op" id="6806155">[</span><span class="num" id="6806156">1</span><span class="op" id="6806157">]</span><span class="builtintype" id="6806158">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806165">c</span><span class="op" id="6806166">.</span><span class="ident" id="6806167">Write</span><span class="op" id="6806172">(</span><span class="ident" id="6806173">buf</span><span class="op" id="6806176">[</span><span class="op" id="6806177">:</span><span class="op" id="6806178">]</span><span class="op" id="6806179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806182">}</span><br>
<span class="lineno">710</span><span class="op" id="6806184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6806187">func</span>&nbsp;<span class="ident" id="6806192">TestDeadlineRace</span><span class="op" id="6806208">(</span><span class="ident" id="6806209">t</span>&nbsp;<span class="op" id="6806211">*</span><span class="ident" id="6806212">testing</span><span class="op" id="6806219">.</span><span class="ident" id="6806220">T</span><span class="op" id="6806221">)</span>&nbsp;<span class="op" id="6806223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806226">switch</span>&nbsp;<span class="ident" id="6806233">runtime</span><span class="op" id="6806240">.</span><span class="ident" id="6806241">GOOS</span>&nbsp;<span class="op" id="6806246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806249">case</span>&nbsp;<span class="string" id="6806254">&#34;nacl&#34;</span><span class="op" id="6806260">,</span>&nbsp;<span class="string" id="6806262">&#34;plan9&#34;</span><span class="op" id="6806269">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806273">t</span><span class="op" id="6806274">.</span><span class="ident" id="6806275">Skipf</span><span class="op" id="6806280">(</span><span class="string" id="6806281">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6806302">,</span>&nbsp;<span class="ident" id="6806304">runtime</span><span class="op" id="6806311">.</span><span class="ident" id="6806312">GOOS</span><span class="op" id="6806316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806323">N</span>&nbsp;<span class="op" id="6806325">:=</span>&nbsp;<span class="num" id="6806328">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806334">if</span>&nbsp;<span class="ident" id="6806337">testing</span><span class="op" id="6806344">.</span><span class="ident" id="6806345">Short</span><span class="op" id="6806350">(</span><span class="op" id="6806351">)</span>&nbsp;<span class="op" id="6806353">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806357">N</span>&nbsp;<span class="op" id="6806359">=</span>&nbsp;<span class="num" id="6806361">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806368">defer</span>&nbsp;<span class="ident" id="6806374">runtime</span><span class="op" id="6806381">.</span><span class="ident" id="6806382">GOMAXPROCS</span><span class="op" id="6806392">(</span><span class="ident" id="6806393">runtime</span><span class="op" id="6806400">.</span><span class="ident" id="6806401">GOMAXPROCS</span><span class="op" id="6806411">(</span><span class="num" id="6806412">4</span><span class="op" id="6806413">)</span><span class="op" id="6806414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806417">ln</span>&nbsp;<span class="op" id="6806420">:=</span>&nbsp;<span class="ident" id="6806423">newLocalListener</span><span class="op" id="6806439">(</span><span class="ident" id="6806440">t</span><span class="op" id="6806441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806444">defer</span>&nbsp;<span class="ident" id="6806450">ln</span><span class="op" id="6806452">.</span><span class="ident" id="6806453">Close</span><span class="op" id="6806458">(</span><span class="op" id="6806459">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806462">c</span><span class="op" id="6806463">,</span>&nbsp;<span class="ident" id="6806465">err</span>&nbsp;<span class="op" id="6806469">:=</span>&nbsp;<span class="ident" id="6806472">Dial</span><span class="op" id="6806476">(</span><span class="string" id="6806477">&#34;tcp&#34;</span><span class="op" id="6806482">,</span>&nbsp;<span class="ident" id="6806484">ln</span><span class="op" id="6806486">.</span><span class="ident" id="6806487">Addr</span><span class="op" id="6806491">(</span><span class="op" id="6806492">)</span><span class="op" id="6806493">.</span><span class="ident" id="6806494">String</span><span class="op" id="6806500">(</span><span class="op" id="6806501">)</span><span class="op" id="6806502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806505">if</span>&nbsp;<span class="ident" id="6806508">err</span>&nbsp;<span class="op" id="6806512">!=</span>&nbsp;<span class="builtintype" id="6806515">nil</span>&nbsp;<span class="op" id="6806519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806523">t</span><span class="op" id="6806524">.</span><span class="ident" id="6806525">Fatalf</span><span class="op" id="6806531">(</span><span class="string" id="6806532">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6806542">,</span>&nbsp;<span class="ident" id="6806544">err</span><span class="op" id="6806547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806553">defer</span>&nbsp;<span class="ident" id="6806559">c</span><span class="op" id="6806560">.</span><span class="ident" id="6806561">Close</span><span class="op" id="6806566">(</span><span class="op" id="6806567">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806570">done</span>&nbsp;<span class="op" id="6806575">:=</span>&nbsp;<span class="builtinfunc" id="6806578">make</span><span class="op" id="6806582">(</span><span class="keyword" id="6806583">chan</span>&nbsp;<span class="builtintype" id="6806588">bool</span><span class="op" id="6806592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806595">go</span>&nbsp;<span class="keyword" id="6806598">func</span><span class="op" id="6806602">(</span><span class="op" id="6806603">)</span>&nbsp;<span class="op" id="6806605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806609">t</span>&nbsp;<span class="op" id="6806611">:=</span>&nbsp;<span class="ident" id="6806614">time</span><span class="op" id="6806618">.</span><span class="ident" id="6806619">NewTicker</span><span class="op" id="6806628">(</span><span class="num" id="6806629">2</span>&nbsp;<span class="op" id="6806631">*</span>&nbsp;<span class="ident" id="6806633">time</span><span class="op" id="6806637">.</span><span class="ident" id="6806638">Microsecond</span><span class="op" id="6806649">)</span><span class="op" id="6806650">.</span><span class="ident" id="6806651">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806655">for</span>&nbsp;<span class="ident" id="6806659">i</span>&nbsp;<span class="op" id="6806661">:=</span>&nbsp;<span class="num" id="6806664">0</span><span class="op" id="6806665">;</span>&nbsp;<span class="ident" id="6806667">i</span>&nbsp;<span class="op" id="6806669">&lt;</span>&nbsp;<span class="ident" id="6806671">N</span><span class="op" id="6806672">;</span>&nbsp;<span class="ident" id="6806674">i</span><span class="op" id="6806675">++</span>&nbsp;<span class="op" id="6806678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806683">if</span>&nbsp;<span class="ident" id="6806686">err</span>&nbsp;<span class="op" id="6806690">:=</span>&nbsp;<span class="ident" id="6806693">c</span><span class="op" id="6806694">.</span><span class="ident" id="6806695">SetDeadline</span><span class="op" id="6806706">(</span><span class="ident" id="6806707">time</span><span class="op" id="6806711">.</span><span class="ident" id="6806712">Now</span><span class="op" id="6806715">(</span><span class="op" id="6806716">)</span><span class="op" id="6806717">.</span><span class="ident" id="6806718">Add</span><span class="op" id="6806721">(</span><span class="num" id="6806722">2</span>&nbsp;<span class="op" id="6806724">*</span>&nbsp;<span class="ident" id="6806726">time</span><span class="op" id="6806730">.</span><span class="ident" id="6806731">Microsecond</span><span class="op" id="6806742">)</span><span class="op" id="6806743">)</span><span class="op" id="6806744">;</span>&nbsp;<span class="ident" id="6806746">err</span>&nbsp;<span class="op" id="6806750">!=</span>&nbsp;<span class="builtintype" id="6806753">nil</span>&nbsp;<span class="op" id="6806757">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806763">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806777">&lt;-</span><span class="ident" id="6806779">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806787">done</span>&nbsp;<span class="op" id="6806792">&lt;-</span>&nbsp;<span class="builtintype" id="6806795">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806801">}</span><span class="op" id="6806802">(</span><span class="op" id="6806803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806806">var</span>&nbsp;<span class="ident" id="6806810">buf</span>&nbsp;<span class="op" id="6806814">[</span><span class="num" id="6806815">1</span><span class="op" id="6806816">]</span><span class="builtintype" id="6806817">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6806823">for</span>&nbsp;<span class="ident" id="6806827">i</span>&nbsp;<span class="op" id="6806829">:=</span>&nbsp;<span class="num" id="6806832">0</span><span class="op" id="6806833">;</span>&nbsp;<span class="ident" id="6806835">i</span>&nbsp;<span class="op" id="6806837">&lt;</span>&nbsp;<span class="ident" id="6806839">N</span><span class="op" id="6806840">;</span>&nbsp;<span class="ident" id="6806842">i</span><span class="op" id="6806843">++</span>&nbsp;<span class="op" id="6806846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806850">c</span><span class="op" id="6806851">.</span><span class="ident" id="6806852">Read</span><span class="op" id="6806856">(</span><span class="ident" id="6806857">buf</span><span class="op" id="6806860">[</span><span class="op" id="6806861">:</span><span class="op" id="6806862">]</span><span class="op" id="6806863">)</span>&nbsp;<span class="comment" id="6806865">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806900">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6806903">c</span><span class="op" id="6806904">.</span><span class="ident" id="6806905">Close</span><span class="op" id="6806910">(</span><span class="op" id="6806911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6806914">&lt;-</span><span class="ident" id="6806916">done</span><br>
<span class="lineno"></span><span class="op" id="6806921">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
