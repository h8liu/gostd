<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5319984">package</span>&nbsp;<span class="ident" id="5319992">asm8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319998">import</span>&nbsp;<span class="op" id="5320005">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5320008">&#34;lonnie.io/e8vm/lex8&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5320031">&#34;lonnie.io/e8vm/link8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5320054">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320057">//&nbsp;buildFunc&nbsp;builds&nbsp;a&nbsp;function&nbsp;object&nbsp;from&nbsp;a&nbsp;function&nbsp;AST&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5320121">func</span>&nbsp;<span class="ident" id="5320126">buildFunc</span><span class="op" id="5320135">(</span><span class="ident" id="5320136">b</span>&nbsp;<span class="op" id="5320138">*</span><span class="ident" id="5320139"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5320146">,</span>&nbsp;<span class="ident" id="5320148">f</span>&nbsp;<span class="op" id="5320150">*</span><span class="ident" id="5320151"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#5329902">funcDecl</a></span><span class="op" id="5320159">)</span>&nbsp;<span class="op" id="5320161">*</span><span class="ident" id="5320162"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5320167">.</span><span class="ident" id="5320168">Func</span>&nbsp;<span class="op" id="5320173">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320176"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320177">.</span><span class="ident" id="5320178">scope</span><span class="op" id="5320183">.</span><span class="ident" id="5320184">Push</span><span class="op" id="5320188">(</span><span class="op" id="5320189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320192">defer</span>&nbsp;<span class="ident" id="5320198"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320199">.</span><span class="ident" id="5320200">scope</span><span class="op" id="5320205">.</span><span class="ident" id="5320206">Pop</span><span class="op" id="5320209">(</span><span class="op" id="5320210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320214"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320215">.</span><span class="ident" id="5320216">clearErr</span><span class="op" id="5320224">(</span><span class="op" id="5320225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320228"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320441">declareLabels</a></span><span class="op" id="5320241">(</span><span class="ident" id="5320242"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320243">,</span>&nbsp;<span class="ident" id="5320245"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320148">f</a></span><span class="op" id="5320246">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320249">if</span>&nbsp;<span class="op" id="5320252">!</span><span class="ident" id="5320253"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320254">.</span><span class="ident" id="5320255">hasError</span>&nbsp;<span class="op" id="5320264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320268"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320930">setOffsets</a></span><span class="op" id="5320278">(</span><span class="ident" id="5320279"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320280">,</span>&nbsp;<span class="ident" id="5320282"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320148">f</a></span><span class="op" id="5320283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320287"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321632">fillLabels</a></span><span class="op" id="5320297">(</span><span class="ident" id="5320298"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320299">,</span>&nbsp;<span class="ident" id="5320301"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320148">f</a></span><span class="op" id="5320302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320309">return</span>&nbsp;<span class="ident" id="5320316"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324493">makeFuncObj</a></span><span class="op" id="5320327">(</span><span class="ident" id="5320328"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320136">b</a></span><span class="op" id="5320329">,</span>&nbsp;<span class="ident" id="5320331"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320148">f</a></span><span class="op" id="5320332">)</span><br>
<span class="lineno"></span><span class="op" id="5320334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320337">//&nbsp;declareLabels&nbsp;adds&nbsp;the&nbsp;labels&nbsp;into&nbsp;the&nbsp;scope,</span><br>
<span class="lineno"></span><span class="comment" id="5320386">//&nbsp;so&nbsp;that&nbsp;later&nbsp;they&nbsp;can&nbsp;be&nbsp;queried&nbsp;for&nbsp;filling.</span><br>
<span class="lineno">25</span><span class="keyword" id="5320436">func</span>&nbsp;<span class="ident" id="5320441">declareLabels</span><span class="op" id="5320454">(</span><span class="ident" id="5320455">b</span>&nbsp;<span class="op" id="5320457">*</span><span class="ident" id="5320458"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5320465">,</span>&nbsp;<span class="ident" id="5320467">f</span>&nbsp;<span class="op" id="5320469">*</span><span class="ident" id="5320470"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#5329902">funcDecl</a></span><span class="op" id="5320478">)</span>&nbsp;<span class="op" id="5320480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320483">for</span>&nbsp;<span class="ident" id="5320487">_</span><span class="op" id="5320488">,</span>&nbsp;<span class="ident" id="5320490">stmt</span>&nbsp;<span class="op" id="5320495">:=</span>&nbsp;<span class="keyword" id="5320498">range</span>&nbsp;<span class="ident" id="5320504"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320467">f</a></span><span class="op" id="5320505">.</span><span class="ident" id="5320506">stmts</span>&nbsp;<span class="op" id="5320512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320516">if</span>&nbsp;<span class="op" id="5320519">!</span><span class="ident" id="5320520"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320490">stmt</a></span><span class="op" id="5320524">.</span><span class="ident" id="5320525">isLabel</span><span class="op" id="5320532">(</span><span class="op" id="5320533">)</span>&nbsp;<span class="op" id="5320535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320540">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320551">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320556">lab</span>&nbsp;<span class="op" id="5320560">:=</span>&nbsp;<span class="ident" id="5320563"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320490">stmt</a></span><span class="op" id="5320567">.</span><span class="ident" id="5320568">label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320576">op</span>&nbsp;<span class="op" id="5320579">:=</span>&nbsp;<span class="ident" id="5320582"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320490">stmt</a></span><span class="op" id="5320586">.</span><span class="ident" id="5320587">ops</span><span class="op" id="5320590">[</span><span class="num" id="5320591">0</span><span class="op" id="5320592">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320596">sym</span>&nbsp;<span class="op" id="5320600">:=</span>&nbsp;<span class="op" id="5320603">&amp;</span><span class="ident" id="5320604"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5358916">symbol</a></span><span class="op" id="5320610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320615">Name</span><span class="op" id="5320619">:</span>&nbsp;<span class="ident" id="5320621"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320556">lab</a></span><span class="op" id="5320624">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320629">Type</span><span class="op" id="5320633">:</span>&nbsp;<span class="ident" id="5320635"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359324">SymLabel</a></span><span class="op" id="5320643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320648">Item</span><span class="op" id="5320652">:</span>&nbsp;<span class="ident" id="5320654"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320490">stmt</a></span><span class="op" id="5320658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320663">Pos</span><span class="op" id="5320666">:</span>&nbsp;&nbsp;<span class="ident" id="5320669"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320576">op</a></span><span class="op" id="5320671">.</span><span class="ident" id="5320672">Pos</span><span class="op" id="5320675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320684">decl</span>&nbsp;<span class="op" id="5320689">:=</span>&nbsp;<span class="ident" id="5320692"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320455">b</a></span><span class="op" id="5320693">.</span><span class="ident" id="5320694">scope</span><span class="op" id="5320699">.</span><span class="ident" id="5320700">Declare</span><span class="op" id="5320707">(</span><span class="ident" id="5320708"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320596">sym</a></span><span class="op" id="5320711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320715">if</span>&nbsp;<span class="ident" id="5320718"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320684">decl</a></span>&nbsp;<span class="op" id="5320723">!=</span>&nbsp;<span class="ident" id="5320726">nil</span>&nbsp;<span class="op" id="5320730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320735"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320455">b</a></span><span class="op" id="5320736">.</span><span class="ident" id="5320737">err</span><span class="op" id="5320740">(</span><span class="ident" id="5320741"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320576">op</a></span><span class="op" id="5320743">.</span><span class="ident" id="5320744">Pos</span><span class="op" id="5320747">,</span>&nbsp;<span class="string" id="5320749">&#34;%q&nbsp;already&nbsp;declared&#34;</span><span class="op" id="5320770">,</span>&nbsp;<span class="ident" id="5320772"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320556">lab</a></span><span class="op" id="5320775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320780"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320455">b</a></span><span class="op" id="5320781">.</span><span class="ident" id="5320782">err</span><span class="op" id="5320785">(</span><span class="ident" id="5320786"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320684">decl</a></span><span class="op" id="5320790">.</span><span class="ident" id="5320791">Pos</span><span class="op" id="5320794">,</span>&nbsp;<span class="string" id="5320796">&#34;&nbsp;&nbsp;here&nbsp;as&nbsp;a&nbsp;%s&#34;</span><span class="op" id="5320812">,</span>&nbsp;<span class="ident" id="5320814"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359371">symStr</a></span><span class="op" id="5320820">(</span><span class="ident" id="5320821"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320684">decl</a></span><span class="op" id="5320825">.</span><span class="ident" id="5320826">Type</span><span class="op" id="5320830">)</span><span class="op" id="5320831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320836">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5320850">}</span><br>
<span class="lineno"></span><span class="op" id="5320852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5320855">//&nbsp;setOffsets&nbsp;calculates&nbsp;the&nbsp;offset&nbsp;in&nbsp;function&nbsp;for&nbsp;each&nbsp;instruction.</span><br>
<span class="lineno">50</span><span class="keyword" id="5320925">func</span>&nbsp;<span class="ident" id="5320930">setOffsets</span><span class="op" id="5320940">(</span><span class="ident" id="5320941">b</span>&nbsp;<span class="op" id="5320943">*</span><span class="ident" id="5320944"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5320951">,</span>&nbsp;<span class="ident" id="5320953">f</span>&nbsp;<span class="op" id="5320955">*</span><span class="ident" id="5320956"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#5329902">funcDecl</a></span><span class="op" id="5320964">)</span>&nbsp;<span class="op" id="5320966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5320969">offset</span>&nbsp;<span class="op" id="5320976">:=</span>&nbsp;<span class="builtintype" id="5320979">uint32</span><span class="op" id="5320985">(</span><span class="num" id="5320986">0</span><span class="op" id="5320987">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5320991">for</span>&nbsp;<span class="ident" id="5320995">_</span><span class="op" id="5320996">,</span>&nbsp;<span class="ident" id="5320998">s</span>&nbsp;<span class="op" id="5321000">:=</span>&nbsp;<span class="keyword" id="5321003">range</span>&nbsp;<span class="ident" id="5321009"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320953">f</a></span><span class="op" id="5321010">.</span><span class="ident" id="5321011">stmts</span>&nbsp;<span class="op" id="5321017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321021"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320998">s</a></span><span class="op" id="5321022">.</span><span class="ident" id="5321023">offset</span>&nbsp;<span class="op" id="5321030">=</span>&nbsp;<span class="ident" id="5321032"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320969">offset</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321041">if</span>&nbsp;<span class="ident" id="5321044"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320998">s</a></span><span class="op" id="5321045">.</span><span class="ident" id="5321046">isLabel</span><span class="op" id="5321053">(</span><span class="op" id="5321054">)</span>&nbsp;<span class="op" id="5321056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321061">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321077"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320969">offset</a></span>&nbsp;<span class="op" id="5321084">+=</span>&nbsp;<span class="num" id="5321087">4</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321090">}</span><br>
<span class="lineno"></span><span class="op" id="5321092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5321095">//&nbsp;fillDelta&nbsp;will&nbsp;fill&nbsp;the&nbsp;particular&nbsp;instruction</span><br>
<span class="lineno"></span><span class="comment" id="5321145">//&nbsp;with&nbsp;a&nbsp;jumping/branching&nbsp;offset&nbsp;d.</span><br>
<span class="lineno">65</span><span class="keyword" id="5321183">func</span>&nbsp;<span class="ident" id="5321188">fillDelta</span><span class="op" id="5321197">(</span><span class="ident" id="5321198">b</span>&nbsp;<span class="op" id="5321200">*</span><span class="ident" id="5321201"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5321208">,</span>&nbsp;<span class="ident" id="5321210">t</span>&nbsp;<span class="op" id="5321212">*</span><span class="ident" id="5321213"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320008">lex8</a></span><span class="op" id="5321217">.</span><span class="ident" id="5321218">Token</span><span class="op" id="5321223">,</span>&nbsp;<span class="ident" id="5321225">inst</span>&nbsp;<span class="op" id="5321230">*</span><span class="builtintype" id="5321231">uint32</span><span class="op" id="5321237">,</span>&nbsp;<span class="ident" id="5321239">d</span>&nbsp;<span class="builtintype" id="5321241">uint32</span><span class="op" id="5321247">)</span>&nbsp;<span class="op" id="5321249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321252">if</span>&nbsp;<span class="ident" id="5321255"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330534">isJump</a></span><span class="op" id="5321261">(</span><span class="op" id="5321262">*</span><span class="ident" id="5321263"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321225">inst</a></span><span class="op" id="5321267">)</span>&nbsp;<span class="op" id="5321269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321273">*</span><span class="ident" id="5321274"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321225">inst</a></span>&nbsp;<span class="op" id="5321279">|=</span>&nbsp;<span class="ident" id="5321282"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321239">d</a></span>&nbsp;<span class="op" id="5321284">&amp;</span>&nbsp;<span class="num" id="5321286">0x3fffffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321298">}</span>&nbsp;<span class="keyword" id="5321300">else</span>&nbsp;<span class="op" id="5321305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5321309">//&nbsp;it&nbsp;is&nbsp;a&nbsp;branch</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321329">if</span>&nbsp;<span class="op" id="5321332">!</span><span class="ident" id="5321333"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330594">inBrRange</a></span><span class="op" id="5321342">(</span><span class="ident" id="5321343"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321239">d</a></span><span class="op" id="5321344">)</span>&nbsp;<span class="op" id="5321346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321351"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321198">b</a></span><span class="op" id="5321352">.</span><span class="ident" id="5321353">err</span><span class="op" id="5321356">(</span><span class="ident" id="5321357"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321210">t</a></span><span class="op" id="5321358">.</span><span class="ident" id="5321359">Pos</span><span class="op" id="5321362">,</span>&nbsp;<span class="string" id="5321364">&#34;%q&nbsp;is&nbsp;out&nbsp;of&nbsp;branch&nbsp;range&#34;</span><span class="op" id="5321391">,</span>&nbsp;<span class="ident" id="5321393"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321210">t</a></span><span class="op" id="5321394">.</span><span class="ident" id="5321395">Lit</span><span class="op" id="5321398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321406">*</span><span class="ident" id="5321407"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321225">inst</a></span>&nbsp;<span class="op" id="5321412">|=</span>&nbsp;<span class="ident" id="5321415"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321239">d</a></span>&nbsp;<span class="op" id="5321417">&amp;</span>&nbsp;<span class="num" id="5321419">0x3ffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321428">}</span><br>
<span class="lineno">75</span><span class="op" id="5321430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5321433">//&nbsp;fillLabels&nbsp;fills&nbsp;all&nbsp;the&nbsp;labels&nbsp;in&nbsp;the&nbsp;function.&nbsp;After&nbsp;the&nbsp;filling,&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5321512">//&nbsp;symbols&nbsp;left&nbsp;will&nbsp;be&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;and&nbsp;all&nbsp;branches&nbsp;(which</span><br>
<span class="lineno"></span><span class="comment" id="5321591">//&nbsp;must&nbsp;use&nbsp;labels)&nbsp;will&nbsp;be&nbsp;filled.</span><br>
<span class="lineno">80</span><span class="keyword" id="5321627">func</span>&nbsp;<span class="ident" id="5321632">fillLabels</span><span class="op" id="5321642">(</span><span class="ident" id="5321643">b</span>&nbsp;<span class="op" id="5321645">*</span><span class="ident" id="5321646"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5321653">,</span>&nbsp;<span class="ident" id="5321655">f</span>&nbsp;<span class="op" id="5321657">*</span><span class="ident" id="5321658"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#5329902">funcDecl</a></span><span class="op" id="5321666">)</span>&nbsp;<span class="op" id="5321668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321671">for</span>&nbsp;<span class="ident" id="5321675">_</span><span class="op" id="5321676">,</span>&nbsp;<span class="ident" id="5321678">s</span>&nbsp;<span class="op" id="5321680">:=</span>&nbsp;<span class="keyword" id="5321683">range</span>&nbsp;<span class="ident" id="5321689"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321655">f</a></span><span class="op" id="5321690">.</span><span class="ident" id="5321691">stmts</span>&nbsp;<span class="op" id="5321697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321701">if</span>&nbsp;<span class="ident" id="5321704"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5321705">.</span><span class="ident" id="5321706">isLabel</span><span class="op" id="5321713">(</span><span class="op" id="5321714">)</span>&nbsp;<span class="op" id="5321716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321721">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321732">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321736">if</span>&nbsp;<span class="ident" id="5321739"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5321740">.</span><span class="ident" id="5321741">fill</span>&nbsp;<span class="op" id="5321746">!=</span>&nbsp;<span class="ident" id="5321749"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330516">fillLabel</a></span>&nbsp;<span class="op" id="5321759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321764">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321779">if</span>&nbsp;<span class="ident" id="5321782"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5321783">.</span><span class="ident" id="5321784">pack</span>&nbsp;<span class="op" id="5321789">!=</span>&nbsp;<span class="string" id="5321792">&#34;&#34;</span>&nbsp;<span class="op" id="5321795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5321800">panic</span><span class="op" id="5321805">(</span><span class="string" id="5321806">&#34;fill&nbsp;label&nbsp;with&nbsp;pack&nbsp;symbol&#34;</span><span class="op" id="5321835">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321844">t</span>&nbsp;<span class="op" id="5321846">:=</span>&nbsp;<span class="ident" id="5321849"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5321850">.</span><span class="ident" id="5321851">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321861">sym</span>&nbsp;<span class="op" id="5321865">:=</span>&nbsp;<span class="ident" id="5321868"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321643">b</a></span><span class="op" id="5321869">.</span><span class="ident" id="5321870">scope</span><span class="op" id="5321875">.</span><span class="ident" id="5321876">Query</span><span class="op" id="5321881">(</span><span class="ident" id="5321882"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5321883">.</span><span class="ident" id="5321884">symbol</span><span class="op" id="5321890">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321894">if</span>&nbsp;<span class="ident" id="5321897"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321861">sym</a></span>&nbsp;<span class="op" id="5321901">==</span>&nbsp;<span class="ident" id="5321904">nil</span>&nbsp;<span class="op" id="5321908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5321913"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321643">b</a></span><span class="op" id="5321914">.</span><span class="ident" id="5321915">err</span><span class="op" id="5321918">(</span><span class="ident" id="5321919"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321844">t</a></span><span class="op" id="5321920">.</span><span class="ident" id="5321921">Pos</span><span class="op" id="5321924">,</span>&nbsp;<span class="string" id="5321926">&#34;label&nbsp;%q&nbsp;not&nbsp;declared&#34;</span><span class="op" id="5321949">,</span>&nbsp;<span class="ident" id="5321951"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321844">t</a></span><span class="op" id="5321952">.</span><span class="ident" id="5321953">Lit</span><span class="op" id="5321956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321961">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5321972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5321977">if</span>&nbsp;<span class="ident" id="5321980"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321861">sym</a></span><span class="op" id="5321983">.</span><span class="ident" id="5321984">Type</span>&nbsp;<span class="op" id="5321989">!=</span>&nbsp;<span class="ident" id="5321992"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359324">SymLabel</a></span>&nbsp;<span class="op" id="5322001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5322006">panic</span><span class="op" id="5322011">(</span><span class="string" id="5322012">&#34;not&nbsp;a&nbsp;label&#34;</span><span class="op" id="5322025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322034">lab</span>&nbsp;<span class="op" id="5322038">:=</span>&nbsp;<span class="ident" id="5322041"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321861">sym</a></span><span class="op" id="5322044">.</span><span class="ident" id="5322045">Item</span><span class="op" id="5322049">.</span><span class="op" id="5322050">(</span><span class="op" id="5322051">*</span><span class="ident" id="5322052"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#5330101">funcStmt</a></span><span class="op" id="5322060">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322064">delta</span>&nbsp;<span class="op" id="5322070">:=</span>&nbsp;<span class="builtintype" id="5322073">uint32</span><span class="op" id="5322079">(</span><span class="builtintype" id="5322080">int32</span><span class="op" id="5322085">(</span><span class="ident" id="5322086"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322034">lab</a></span><span class="op" id="5322089">.</span><span class="ident" id="5322090">offset</span><span class="op" id="5322096">-</span><span class="ident" id="5322097"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5322098">.</span><span class="ident" id="5322099">offset</span><span class="op" id="5322105">-</span><span class="num" id="5322106">4</span><span class="op" id="5322107">)</span>&nbsp;<span class="op" id="5322109">&gt;&gt;</span>&nbsp;<span class="num" id="5322112">2</span><span class="op" id="5322113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322117"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321188">fillDelta</a></span><span class="op" id="5322126">(</span><span class="ident" id="5322127"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321643">b</a></span><span class="op" id="5322128">,</span>&nbsp;<span class="ident" id="5322130"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321844">t</a></span><span class="op" id="5322131">,</span>&nbsp;<span class="op" id="5322133">&amp;</span><span class="ident" id="5322134"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5321678">s</a></span><span class="op" id="5322135">.</span><span class="ident" id="5322136">inst</span><span class="op" id="5322140">.</span><span class="ident" id="5322141">inst</span><span class="op" id="5322145">,</span>&nbsp;<span class="ident" id="5322147"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322064">delta</a></span><span class="op" id="5322152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322155">}</span><br>
<span class="lineno"></span><span class="op" id="5322157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="5322160">func</span>&nbsp;<span class="ident" id="5322165">queryPkg</span><span class="op" id="5322173">(</span><span class="ident" id="5322174">b</span>&nbsp;<span class="op" id="5322176">*</span><span class="ident" id="5322177"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5322184">,</span>&nbsp;<span class="ident" id="5322186">t</span>&nbsp;<span class="op" id="5322188">*</span><span class="ident" id="5322189"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320008">lex8</a></span><span class="op" id="5322193">.</span><span class="ident" id="5322194">Token</span><span class="op" id="5322199">,</span>&nbsp;<span class="ident" id="5322201">pack</span>&nbsp;<span class="builtintype" id="5322206">string</span><span class="op" id="5322212">)</span>&nbsp;<span class="op" id="5322214">*</span><span class="ident" id="5322215"><a href="/lonnie.io/e8vm/asm8/lib.go.html#5343119">lib</a></span>&nbsp;<span class="op" id="5322219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322222">sym</span>&nbsp;<span class="op" id="5322226">:=</span>&nbsp;<span class="ident" id="5322229"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322174">b</a></span><span class="op" id="5322230">.</span><span class="ident" id="5322231">scope</span><span class="op" id="5322236">.</span><span class="ident" id="5322237">Query</span><span class="op" id="5322242">(</span><span class="ident" id="5322243"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322201">pack</a></span><span class="op" id="5322247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322250">if</span>&nbsp;<span class="ident" id="5322253"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322222">sym</a></span>&nbsp;<span class="op" id="5322257">==</span>&nbsp;<span class="ident" id="5322260">nil</span>&nbsp;<span class="op" id="5322264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322268"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322174">b</a></span><span class="op" id="5322269">.</span><span class="ident" id="5322270">err</span><span class="op" id="5322273">(</span><span class="ident" id="5322274"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322186">t</a></span><span class="op" id="5322275">.</span><span class="ident" id="5322276">Pos</span><span class="op" id="5322279">,</span>&nbsp;<span class="string" id="5322281">&#34;package&nbsp;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="5322303">,</span>&nbsp;<span class="ident" id="5322305"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322201">pack</a></span><span class="op" id="5322309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322313">return</span>&nbsp;<span class="ident" id="5322320">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322325">}</span>&nbsp;<span class="keyword" id="5322327">else</span>&nbsp;<span class="keyword" id="5322332">if</span>&nbsp;<span class="ident" id="5322335"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322222">sym</a></span><span class="op" id="5322338">.</span><span class="ident" id="5322339">Type</span>&nbsp;<span class="op" id="5322344">!=</span>&nbsp;<span class="ident" id="5322347"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359162">SymImport</a></span>&nbsp;<span class="op" id="5322357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322361"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322174">b</a></span><span class="op" id="5322362">.</span><span class="ident" id="5322363">err</span><span class="op" id="5322366">(</span><span class="ident" id="5322367"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322186">t</a></span><span class="op" id="5322368">.</span><span class="ident" id="5322369">Pos</span><span class="op" id="5322372">,</span>&nbsp;<span class="string" id="5322374">&#34;%q&nbsp;is&nbsp;a&nbsp;%s,&nbsp;not&nbsp;a&nbsp;package&#34;</span><span class="op" id="5322401">,</span>&nbsp;<span class="ident" id="5322403"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322186">t</a></span><span class="op" id="5322404">.</span><span class="ident" id="5322405">Lit</span><span class="op" id="5322408">,</span>&nbsp;<span class="ident" id="5322410"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359371">symStr</a></span><span class="op" id="5322416">(</span><span class="ident" id="5322417"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322222">sym</a></span><span class="op" id="5322420">.</span><span class="ident" id="5322421">Type</span><span class="op" id="5322425">)</span><span class="op" id="5322426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322430">return</span>&nbsp;<span class="ident" id="5322437">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322445">return</span>&nbsp;<span class="ident" id="5322452"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322222">sym</a></span><span class="op" id="5322455">.</span><span class="ident" id="5322456">Item</span><span class="op" id="5322460">.</span><span class="op" id="5322461">(</span><span class="op" id="5322462">*</span><span class="ident" id="5322463"><a href="/lonnie.io/e8vm/asm8/lib.go.html#5343119">lib</a></span><span class="op" id="5322466">)</span><br>
<span class="lineno">120</span><span class="op" id="5322468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5322471">func</span>&nbsp;<span class="ident" id="5322476">init</span><span class="op" id="5322480">(</span><span class="op" id="5322481">)</span>&nbsp;<span class="op" id="5322483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322486">as</span>&nbsp;<span class="op" id="5322489">:=</span>&nbsp;<span class="keyword" id="5322492">func</span><span class="op" id="5322496">(</span><span class="ident" id="5322497">b</span>&nbsp;<span class="builtintype" id="5322499">bool</span><span class="op" id="5322503">)</span>&nbsp;<span class="op" id="5322505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322509">if</span>&nbsp;<span class="op" id="5322512">!</span><span class="ident" id="5322513"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322497">b</a></span>&nbsp;<span class="op" id="5322515">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5322520">panic</span><span class="op" id="5322525">(</span><span class="string" id="5322526">&#34;bug&#34;</span><span class="op" id="5322531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5322538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322541"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322486">as</a></span><span class="op" id="5322543">(</span><span class="ident" id="5322544"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330415">fillNone</a></span>&nbsp;<span class="op" id="5322553">==</span>&nbsp;<span class="num" id="5322556">0</span>&nbsp;<span class="op" id="5322558">&amp;&amp;</span>&nbsp;<span class="ident" id="5322561"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330516">fillLabel</a></span>&nbsp;<span class="op" id="5322571">==</span>&nbsp;<span class="num" id="5322574">4</span><span class="op" id="5322575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322578"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322486">as</a></span><span class="op" id="5322580">(</span><span class="ident" id="5322581"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330432">fillLink</a></span>&nbsp;<span class="op" id="5322590">==</span>&nbsp;<span class="ident" id="5322593"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5322598">.</span><span class="ident" id="5322599">FillLink</span><span class="op" id="5322607">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322610"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322486">as</a></span><span class="op" id="5322612">(</span><span class="ident" id="5322613"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330495">fillHigh</a></span>&nbsp;<span class="op" id="5322622">==</span>&nbsp;<span class="ident" id="5322625"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5322630">.</span><span class="ident" id="5322631">FillHigh</span><span class="op" id="5322639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322642"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322486">as</a></span><span class="op" id="5322644">(</span><span class="ident" id="5322645"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330455">fillLow</a></span>&nbsp;<span class="op" id="5322653">==</span>&nbsp;<span class="ident" id="5322656"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5322661">.</span><span class="ident" id="5322662">FillLow</span><span class="op" id="5322669">)</span><br>
<span class="lineno"></span><span class="op" id="5322671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5322674">//&nbsp;resolveSymbol&nbsp;resolves&nbsp;the&nbsp;symbol&nbsp;in&nbsp;the&nbsp;statement,</span><br>
<span class="lineno">135</span><span class="comment" id="5322729">//&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;linking&nbsp;object&nbsp;and&nbsp;its&nbsp;&lt;sym,&nbsp;pkg&gt;&nbsp;index&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5322796">//&nbsp;in&nbsp;the&nbsp;current&nbsp;package&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5322831">func</span>&nbsp;<span class="ident" id="5322836">resolveSymbol</span><span class="op" id="5322849">(</span><span class="ident" id="5322850">b</span>&nbsp;<span class="op" id="5322852">*</span><span class="ident" id="5322853"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5322860">,</span>&nbsp;<span class="ident" id="5322862">s</span>&nbsp;<span class="op" id="5322864">*</span><span class="ident" id="5322865"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#5330101">funcStmt</a></span><span class="op" id="5322873">)</span>&nbsp;<span class="op" id="5322875">(</span><span class="ident" id="5322876">ret</span>&nbsp;<span class="op" id="5322880">*</span><span class="ident" id="5322881"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5358916">symbol</a></span><span class="op" id="5322887">,</span>&nbsp;<span class="ident" id="5322889">pkg</span><span class="op" id="5322892">,</span>&nbsp;<span class="ident" id="5322894">index</span>&nbsp;<span class="builtintype" id="5322900">uint32</span><span class="op" id="5322906">)</span>&nbsp;<span class="op" id="5322908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322911">t</span>&nbsp;<span class="op" id="5322913">:=</span>&nbsp;<span class="ident" id="5322916"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322862">s</a></span><span class="op" id="5322917">.</span><span class="ident" id="5322918">symTok</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5322927">if</span>&nbsp;<span class="ident" id="5322930"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322862">s</a></span><span class="op" id="5322931">.</span><span class="ident" id="5322932">pack</span>&nbsp;<span class="op" id="5322937">==</span>&nbsp;<span class="string" id="5322940">&#34;&#34;</span>&nbsp;<span class="op" id="5322943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5322947"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span>&nbsp;<span class="op" id="5322951">=</span>&nbsp;<span class="ident" id="5322953"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5322954">.</span><span class="ident" id="5322955">scope</span><span class="op" id="5322960">.</span><span class="ident" id="5322961">Query</span><span class="op" id="5322966">(</span><span class="ident" id="5322967"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322862">s</a></span><span class="op" id="5322968">.</span><span class="ident" id="5322969">symbol</span><span class="op" id="5322975">)</span>&nbsp;<span class="comment" id="5322977">//&nbsp;find&nbsp;the&nbsp;symbol&nbsp;in&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323007">if</span>&nbsp;<span class="ident" id="5323010"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span>&nbsp;<span class="op" id="5323014">!=</span>&nbsp;<span class="ident" id="5323017">nil</span>&nbsp;<span class="op" id="5323021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323026">var</span>&nbsp;<span class="ident" id="5323030">p</span>&nbsp;<span class="op" id="5323032">*</span><span class="ident" id="5323033"><a href="/lonnie.io/e8vm/asm8/lib.go.html#5343119">lib</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323040"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323030">p</a></span><span class="op" id="5323041">,</span>&nbsp;<span class="ident" id="5323043"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322889">pkg</a></span>&nbsp;<span class="op" id="5323047">=</span>&nbsp;<span class="ident" id="5323049"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5323050">.</span><span class="ident" id="5323051">curPkg</span><span class="op" id="5323057">.</span><span class="ident" id="5323058">LibIndex</span><span class="op" id="5323066">(</span><span class="ident" id="5323067"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323070">.</span><span class="ident" id="5323071">Package</span><span class="op" id="5323078">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323083"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322894">index</a></span>&nbsp;<span class="op" id="5323089">=</span>&nbsp;<span class="ident" id="5323091"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323030">p</a></span><span class="op" id="5323092">.</span><span class="ident" id="5323093">SymIndex</span><span class="op" id="5323101">(</span><span class="ident" id="5323102"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323105">.</span><span class="ident" id="5323106">Name</span><span class="op" id="5323110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323117">}</span>&nbsp;<span class="keyword" id="5323119">else</span>&nbsp;<span class="op" id="5323124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323128">p</span>&nbsp;<span class="op" id="5323130">:=</span>&nbsp;<span class="ident" id="5323133"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322165">queryPkg</a></span><span class="op" id="5323141">(</span><span class="ident" id="5323142"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5323143">,</span>&nbsp;<span class="ident" id="5323145"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322911">t</a></span><span class="op" id="5323146">,</span>&nbsp;<span class="ident" id="5323148"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322862">s</a></span><span class="op" id="5323149">.</span><span class="ident" id="5323150">pack</span><span class="op" id="5323154">)</span>&nbsp;<span class="comment" id="5323156">//&nbsp;find&nbsp;the&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323178">if</span>&nbsp;<span class="ident" id="5323181"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323128">p</a></span>&nbsp;<span class="op" id="5323183">==</span>&nbsp;<span class="ident" id="5323186">nil</span>&nbsp;<span class="op" id="5323190">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323195">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323209">path</span>&nbsp;<span class="op" id="5323214">:=</span>&nbsp;<span class="ident" id="5323217"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323128">p</a></span><span class="op" id="5323218">.</span><span class="ident" id="5323219">Path</span><span class="op" id="5323223">(</span><span class="op" id="5323224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323228">_</span><span class="op" id="5323229">,</span>&nbsp;<span class="ident" id="5323231"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322889">pkg</a></span>&nbsp;<span class="op" id="5323235">=</span>&nbsp;<span class="ident" id="5323237"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5323238">.</span><span class="ident" id="5323239">curPkg</span><span class="op" id="5323245">.</span><span class="ident" id="5323246">LibIndex</span><span class="op" id="5323254">(</span><span class="ident" id="5323255"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323209">path</a></span><span class="op" id="5323259">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323263"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323266">,</span>&nbsp;<span class="ident" id="5323268"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322894">index</a></span>&nbsp;<span class="op" id="5323274">=</span>&nbsp;<span class="ident" id="5323276"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323128">p</a></span><span class="op" id="5323277">.</span><span class="ident" id="5323278">Query</span><span class="op" id="5323283">(</span><span class="ident" id="5323284"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322862">s</a></span><span class="op" id="5323285">.</span><span class="ident" id="5323286">symbol</span><span class="op" id="5323292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323296">if</span>&nbsp;<span class="ident" id="5323299"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span>&nbsp;<span class="op" id="5323303">!=</span>&nbsp;<span class="ident" id="5323306">nil</span>&nbsp;<span class="op" id="5323310">&amp;&amp;</span>&nbsp;<span class="ident" id="5323313"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323316">.</span><span class="ident" id="5323317">Package</span>&nbsp;<span class="op" id="5323325">!=</span>&nbsp;<span class="ident" id="5323328"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323209">path</a></span>&nbsp;<span class="op" id="5323333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5323338">panic</span><span class="op" id="5323343">(</span><span class="string" id="5323344">&#34;bug&#34;</span><span class="op" id="5323349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323356">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323360">if</span>&nbsp;<span class="ident" id="5323363"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span>&nbsp;<span class="op" id="5323367">==</span>&nbsp;<span class="ident" id="5323370">nil</span>&nbsp;<span class="op" id="5323374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323378"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5323379">.</span><span class="ident" id="5323380">err</span><span class="op" id="5323383">(</span><span class="ident" id="5323384"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322911">t</a></span><span class="op" id="5323385">.</span><span class="ident" id="5323386">Pos</span><span class="op" id="5323389">,</span>&nbsp;<span class="string" id="5323391">&#34;%q&nbsp;not&nbsp;found&#34;</span><span class="op" id="5323405">,</span>&nbsp;<span class="ident" id="5323407"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322911">t</a></span><span class="op" id="5323408">.</span><span class="ident" id="5323409">Lit</span><span class="op" id="5323412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323416">return</span>&nbsp;<span class="ident" id="5323423">nil</span><span class="op" id="5323426">,</span>&nbsp;<span class="num" id="5323428">0</span><span class="op" id="5323429">,</span>&nbsp;<span class="num" id="5323431">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323434">}</span>&nbsp;<span class="keyword" id="5323436">else</span>&nbsp;<span class="keyword" id="5323441">if</span>&nbsp;<span class="ident" id="5323444"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323447">.</span><span class="ident" id="5323448">Type</span>&nbsp;<span class="op" id="5323453">==</span>&nbsp;<span class="ident" id="5323456"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359244">SymConst</a></span>&nbsp;<span class="op" id="5323465">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323469">return</span>&nbsp;<span class="ident" id="5323476">nil</span><span class="op" id="5323479">,</span>&nbsp;<span class="num" id="5323481">0</span><span class="op" id="5323482">,</span>&nbsp;<span class="num" id="5323484">0</span>&nbsp;<span class="comment" id="5323486">//&nbsp;not&nbsp;my&nbsp;job&nbsp;to&nbsp;fill&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323514">}</span>&nbsp;<span class="keyword" id="5323516">else</span>&nbsp;<span class="keyword" id="5323521">if</span>&nbsp;<span class="ident" id="5323524"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323527">.</span><span class="ident" id="5323528">Type</span>&nbsp;<span class="op" id="5323533">==</span>&nbsp;<span class="ident" id="5323536"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359162">SymImport</a></span>&nbsp;<span class="op" id="5323546">||</span>&nbsp;<span class="ident" id="5323549"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323552">.</span><span class="ident" id="5323553">Type</span>&nbsp;<span class="op" id="5323558">==</span>&nbsp;<span class="ident" id="5323561"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359324">SymLabel</a></span>&nbsp;<span class="op" id="5323570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323574"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322850">b</a></span><span class="op" id="5323575">.</span><span class="ident" id="5323576">err</span><span class="op" id="5323579">(</span><span class="ident" id="5323580"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322911">t</a></span><span class="op" id="5323581">.</span><span class="ident" id="5323582">Pos</span><span class="op" id="5323585">,</span>&nbsp;<span class="string" id="5323587">&#34;%s&nbsp;%q&nbsp;not&nbsp;a&nbsp;symbol&#34;</span><span class="op" id="5323607">,</span>&nbsp;<span class="ident" id="5323609"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359371">symStr</a></span><span class="op" id="5323615">(</span><span class="ident" id="5323616"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322876">ret</a></span><span class="op" id="5323619">.</span><span class="ident" id="5323620">Type</span><span class="op" id="5323624">)</span><span class="op" id="5323625">,</span>&nbsp;<span class="ident" id="5323627"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322911">t</a></span><span class="op" id="5323628">.</span><span class="ident" id="5323629">Lit</span><span class="op" id="5323632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323636">return</span>&nbsp;<span class="ident" id="5323643">nil</span><span class="op" id="5323646">,</span>&nbsp;<span class="num" id="5323648">0</span><span class="op" id="5323649">,</span>&nbsp;<span class="num" id="5323651">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323654">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323658">return</span><br>
<span class="lineno"></span><span class="op" id="5323665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5323668">func</span>&nbsp;<span class="ident" id="5323673">linkSymbol</span><span class="op" id="5323683">(</span><span class="ident" id="5323684">b</span>&nbsp;<span class="op" id="5323686">*</span><span class="ident" id="5323687"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5323694">,</span>&nbsp;<span class="ident" id="5323696">s</span>&nbsp;<span class="op" id="5323698">*</span><span class="ident" id="5323699"><a href="/lonnie.io/e8vm/asm8/func_stmt.go.html#5330101">funcStmt</a></span><span class="op" id="5323707">,</span>&nbsp;<span class="ident" id="5323709">f</span>&nbsp;<span class="op" id="5323711">*</span><span class="ident" id="5323712"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5323717">.</span><span class="ident" id="5323718">Func</span><span class="op" id="5323722">)</span>&nbsp;<span class="op" id="5323724">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323727">t</span>&nbsp;<span class="op" id="5323729">:=</span>&nbsp;<span class="ident" id="5323732"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323696">s</a></span><span class="op" id="5323733">.</span><span class="ident" id="5323734">symTok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323742">if</span>&nbsp;<span class="ident" id="5323745"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323684">b</a></span><span class="op" id="5323746">.</span><span class="ident" id="5323747">curPkg</span>&nbsp;<span class="op" id="5323754">==</span>&nbsp;<span class="ident" id="5323757">nil</span>&nbsp;<span class="op" id="5323761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323765"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323684">b</a></span><span class="op" id="5323766">.</span><span class="ident" id="5323767">err</span><span class="op" id="5323770">(</span><span class="ident" id="5323771"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5323772">.</span><span class="ident" id="5323773">Pos</span><span class="op" id="5323776">,</span>&nbsp;<span class="string" id="5323778">&#34;no&nbsp;context&nbsp;for&nbsp;resolving&nbsp;%q&#34;</span><span class="op" id="5323807">,</span>&nbsp;<span class="ident" id="5323809"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5323810">.</span><span class="ident" id="5323811">Lit</span><span class="op" id="5323814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323818">return</span>&nbsp;<span class="comment" id="5323825">//&nbsp;this&nbsp;may&nbsp;happen&nbsp;for&nbsp;bare&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323863">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323867">sym</span><span class="op" id="5323870">,</span>&nbsp;<span class="ident" id="5323872">pkg</span><span class="op" id="5323875">,</span>&nbsp;<span class="ident" id="5323877">index</span>&nbsp;<span class="op" id="5323883">:=</span>&nbsp;<span class="ident" id="5323886"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5322836">resolveSymbol</a></span><span class="op" id="5323899">(</span><span class="ident" id="5323900"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323684">b</a></span><span class="op" id="5323901">,</span>&nbsp;<span class="ident" id="5323903"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323696">s</a></span><span class="op" id="5323904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323907">if</span>&nbsp;<span class="ident" id="5323910"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323867">sym</a></span>&nbsp;<span class="op" id="5323914">==</span>&nbsp;<span class="ident" id="5323917">nil</span>&nbsp;<span class="op" id="5323921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323925">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5323933">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5323937">if</span>&nbsp;<span class="ident" id="5323940"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323696">s</a></span><span class="op" id="5323941">.</span><span class="ident" id="5323942">fill</span>&nbsp;<span class="op" id="5323947">==</span>&nbsp;<span class="ident" id="5323950"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330432">fillLink</a></span>&nbsp;<span class="op" id="5323959">&amp;&amp;</span>&nbsp;<span class="ident" id="5323962"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323867">sym</a></span><span class="op" id="5323965">.</span><span class="ident" id="5323966">Type</span>&nbsp;<span class="op" id="5323971">!=</span>&nbsp;<span class="ident" id="5323974"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359204">SymFunc</a></span>&nbsp;<span class="op" id="5323982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5323986"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323684">b</a></span><span class="op" id="5323987">.</span><span class="ident" id="5323988">err</span><span class="op" id="5323991">(</span><span class="ident" id="5323992"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5323993">.</span><span class="ident" id="5323994">Pos</span><span class="op" id="5323997">,</span>&nbsp;<span class="string" id="5323999">&#34;%s&nbsp;%q&nbsp;is&nbsp;not&nbsp;a&nbsp;function&#34;</span><span class="op" id="5324024">,</span>&nbsp;<span class="ident" id="5324026"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359371">symStr</a></span><span class="op" id="5324032">(</span><span class="ident" id="5324033"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323867">sym</a></span><span class="op" id="5324036">.</span><span class="ident" id="5324037">Type</span><span class="op" id="5324041">)</span><span class="op" id="5324042">,</span>&nbsp;<span class="ident" id="5324044"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5324045">.</span><span class="ident" id="5324046">Lit</span><span class="op" id="5324049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324053">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324061">}</span>&nbsp;<span class="keyword" id="5324063">else</span>&nbsp;<span class="keyword" id="5324068">if</span>&nbsp;<span class="ident" id="5324071"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323872">pkg</a></span>&nbsp;<span class="op" id="5324075">&gt;</span>&nbsp;<span class="num" id="5324077">0</span>&nbsp;<span class="op" id="5324079">&amp;&amp;</span>&nbsp;<span class="op" id="5324082">!</span><span class="ident" id="5324083"><a href="/lonnie.io/e8vm/asm8/symbol.go.html#5359655">isPublic</a></span><span class="op" id="5324091">(</span><span class="ident" id="5324092"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323867">sym</a></span><span class="op" id="5324095">.</span><span class="ident" id="5324096">Name</span><span class="op" id="5324100">)</span>&nbsp;<span class="op" id="5324102">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324106">//&nbsp;for&nbsp;imported&nbsp;package,&nbsp;check&nbsp;if&nbsp;it&nbsp;is&nbsp;public</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324155"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323684">b</a></span><span class="op" id="5324156">.</span><span class="ident" id="5324157">err</span><span class="op" id="5324160">(</span><span class="ident" id="5324161"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5324162">.</span><span class="ident" id="5324163">Pos</span><span class="op" id="5324166">,</span>&nbsp;<span class="string" id="5324168">&#34;%q&nbsp;is&nbsp;not&nbsp;public&#34;</span><span class="op" id="5324186">,</span>&nbsp;<span class="ident" id="5324188"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323727">t</a></span><span class="op" id="5324189">.</span><span class="ident" id="5324190">Lit</span><span class="op" id="5324193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324197">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5324209">//&nbsp;save&nbsp;the&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324227"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323709">f</a></span><span class="op" id="5324228">.</span><span class="ident" id="5324229">AddLink</span><span class="op" id="5324236">(</span><span class="ident" id="5324237"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323696">s</a></span><span class="op" id="5324238">.</span><span class="ident" id="5324239">fill</span><span class="op" id="5324243">,</span>&nbsp;<span class="ident" id="5324245"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323872">pkg</a></span><span class="op" id="5324248">,</span>&nbsp;<span class="ident" id="5324250"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323877">index</a></span><span class="op" id="5324255">)</span><br>
<span class="lineno"></span><span class="op" id="5324257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5324260">//&nbsp;makeFuncObj&nbsp;converts&nbsp;a&nbsp;function&nbsp;AST&nbsp;node&nbsp;f&nbsp;into&nbsp;a&nbsp;function&nbsp;object.&nbsp;It</span><br>
<span class="lineno">200</span><span class="comment" id="5324333">//&nbsp;resolves&nbsp;the&nbsp;symbols&nbsp;of&nbsp;fillLink,&nbsp;fillHigh&nbsp;and&nbsp;fillLow&nbsp;into&nbsp;&lt;pack,&nbsp;sym&gt;</span><br>
<span class="lineno"></span><span class="comment" id="5324408">//&nbsp;index&nbsp;pairs,&nbsp;using&nbsp;the&nbsp;symbol&nbsp;scope&nbsp;and&nbsp;the&nbsp;curPkg&nbsp;context&nbsp;in&nbsp;the&nbsp;Builder&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="5324488">func</span>&nbsp;<span class="ident" id="5324493">makeFuncObj</span><span class="op" id="5324504">(</span><span class="ident" id="5324505">b</span>&nbsp;<span class="op" id="5324507">*</span><span class="ident" id="5324508"><a href="/lonnie.io/e8vm/asm8/builder.go.html#5326899">builder</a></span><span class="op" id="5324515">,</span>&nbsp;<span class="ident" id="5324517">f</span>&nbsp;<span class="op" id="5324519">*</span><span class="ident" id="5324520"><a href="/lonnie.io/e8vm/asm8/func_decl.go.html#5329902">funcDecl</a></span><span class="op" id="5324528">)</span>&nbsp;<span class="op" id="5324530">*</span><span class="ident" id="5324531"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5324536">.</span><span class="ident" id="5324537">Func</span>&nbsp;<span class="op" id="5324542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324545">ret</span>&nbsp;<span class="op" id="5324549">:=</span>&nbsp;<span class="ident" id="5324552"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5320031">link8</a></span><span class="op" id="5324557">.</span><span class="ident" id="5324558">NewFunc</span><span class="op" id="5324565">(</span><span class="op" id="5324566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324569">for</span>&nbsp;<span class="ident" id="5324573">_</span><span class="op" id="5324574">,</span>&nbsp;<span class="ident" id="5324576">s</span>&nbsp;<span class="op" id="5324578">:=</span>&nbsp;<span class="keyword" id="5324581">range</span>&nbsp;<span class="ident" id="5324587"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324517">f</a></span><span class="op" id="5324588">.</span><span class="ident" id="5324589">stmts</span>&nbsp;<span class="op" id="5324595">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324599">if</span>&nbsp;<span class="ident" id="5324602"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324576">s</a></span><span class="op" id="5324603">.</span><span class="ident" id="5324604">isLabel</span><span class="op" id="5324611">(</span><span class="op" id="5324612">)</span>&nbsp;<span class="op" id="5324614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324619">continue</span>&nbsp;<span class="comment" id="5324628">//&nbsp;skip&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324649"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324545">ret</a></span><span class="op" id="5324652">.</span><span class="ident" id="5324653">AddInst</span><span class="op" id="5324660">(</span><span class="ident" id="5324661"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324576">s</a></span><span class="op" id="5324662">.</span><span class="ident" id="5324663">inst</span><span class="op" id="5324667">.</span><span class="ident" id="5324668">inst</span><span class="op" id="5324672">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324677">if</span>&nbsp;<span class="op" id="5324680">!</span><span class="op" id="5324681">(</span><span class="ident" id="5324682"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324576">s</a></span><span class="op" id="5324683">.</span><span class="ident" id="5324684">fill</span>&nbsp;<span class="op" id="5324689">&gt;</span>&nbsp;<span class="ident" id="5324691"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330415">fillNone</a></span>&nbsp;<span class="op" id="5324700">&amp;&amp;</span>&nbsp;<span class="ident" id="5324703"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324576">s</a></span><span class="op" id="5324704">.</span><span class="ident" id="5324705">fill</span>&nbsp;<span class="op" id="5324710">&lt;</span>&nbsp;<span class="ident" id="5324712"><a href="/lonnie.io/e8vm/asm8/inst.go.html#5330516">fillLabel</a></span><span class="op" id="5324721">)</span>&nbsp;<span class="op" id="5324723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324728">continue</span>&nbsp;<span class="comment" id="5324737">//&nbsp;only&nbsp;care&nbsp;about&nbsp;fillHigh,&nbsp;fillLow&nbsp;and&nbsp;fillLink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324794"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5323673">linkSymbol</a></span><span class="op" id="5324804">(</span><span class="ident" id="5324805"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324505">b</a></span><span class="op" id="5324806">,</span>&nbsp;<span class="ident" id="5324808"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324576">s</a></span><span class="op" id="5324809">,</span>&nbsp;<span class="ident" id="5324811"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324545">ret</a></span><span class="op" id="5324814">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324821">if</span>&nbsp;<span class="ident" id="5324824"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324545">ret</a></span><span class="op" id="5324827">.</span><span class="ident" id="5324828">TooLarge</span><span class="op" id="5324836">(</span><span class="op" id="5324837">)</span>&nbsp;<span class="op" id="5324839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5324843"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324505">b</a></span><span class="op" id="5324844">.</span><span class="ident" id="5324845">err</span><span class="op" id="5324848">(</span><span class="ident" id="5324849"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324517">f</a></span><span class="op" id="5324850">.</span><span class="ident" id="5324851">name</span><span class="op" id="5324855">.</span><span class="ident" id="5324856">Pos</span><span class="op" id="5324859">,</span>&nbsp;<span class="string" id="5324861">&#34;too&nbsp;many&nbsp;instructions&nbsp;in&nbsp;func&#34;</span><span class="op" id="5324892">,</span>&nbsp;<span class="ident" id="5324894"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324517">f</a></span><span class="op" id="5324895">.</span><span class="ident" id="5324896">name</span><span class="op" id="5324900">.</span><span class="ident" id="5324901">Lit</span><span class="op" id="5324904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5324907">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5324911">return</span>&nbsp;<span class="ident" id="5324918"><a href="/lonnie.io/e8vm/asm8/build_func.go.html#5324545">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5324922">}</span>
</div>
</body>
</html>
