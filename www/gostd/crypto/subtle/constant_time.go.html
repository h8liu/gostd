<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3832459">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3832514">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3832568">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3832619">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3832697">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3832751">package</span>&nbsp;<span class="ident" id="3832759">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3832767">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3832822">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3832899">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3832949">func</span>&nbsp;<span class="ident" id="3832954">ConstantTimeCompare</span><span class="op" id="3832973">(</span><span class="ident" id="3832974">x</span><span class="op" id="3832975">,</span>&nbsp;<span class="ident" id="3832977">y</span>&nbsp;<span class="op" id="3832979">[</span><span class="op" id="3832980">]</span><span class="builtintype" id="3832981">byte</span><span class="op" id="3832985">)</span>&nbsp;<span class="builtintype" id="3832987">int</span>&nbsp;<span class="op" id="3832991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3832994">if</span>&nbsp;<span class="builtinfunc" id="3832997">len</span><span class="op" id="3833000">(</span><span class="ident" id="3833001">x</span><span class="op" id="3833002">)</span>&nbsp;<span class="op" id="3833004">!=</span>&nbsp;<span class="builtinfunc" id="3833007">len</span><span class="op" id="3833010">(</span><span class="ident" id="3833011">y</span><span class="op" id="3833012">)</span>&nbsp;<span class="op" id="3833014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833018">return</span>&nbsp;<span class="num" id="3833025">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3833028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833032">var</span>&nbsp;<span class="ident" id="3833036">v</span>&nbsp;<span class="builtintype" id="3833038">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833045">for</span>&nbsp;<span class="ident" id="3833049">i</span>&nbsp;<span class="op" id="3833051">:=</span>&nbsp;<span class="num" id="3833054">0</span><span class="op" id="3833055">;</span>&nbsp;<span class="ident" id="3833057">i</span>&nbsp;<span class="op" id="3833059">&lt;</span>&nbsp;<span class="builtinfunc" id="3833061">len</span><span class="op" id="3833064">(</span><span class="ident" id="3833065">x</span><span class="op" id="3833066">)</span><span class="op" id="3833067">;</span>&nbsp;<span class="ident" id="3833069">i</span><span class="op" id="3833070">++</span>&nbsp;<span class="op" id="3833073">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833077">v</span>&nbsp;<span class="op" id="3833079">|=</span>&nbsp;<span class="ident" id="3833082">x</span><span class="op" id="3833083">[</span><span class="ident" id="3833084">i</span><span class="op" id="3833085">]</span>&nbsp;<span class="op" id="3833087">^</span>&nbsp;<span class="ident" id="3833089">y</span><span class="op" id="3833090">[</span><span class="ident" id="3833091">i</span><span class="op" id="3833092">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3833095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833099">return</span>&nbsp;<span class="ident" id="3833106">ConstantTimeByteEq</span><span class="op" id="3833124">(</span><span class="ident" id="3833125">v</span><span class="op" id="3833126">,</span>&nbsp;<span class="num" id="3833128">0</span><span class="op" id="3833129">)</span><br>
<span class="lineno"></span><span class="op" id="3833131">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3833134">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3833193">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3833250">func</span>&nbsp;<span class="ident" id="3833255">ConstantTimeSelect</span><span class="op" id="3833273">(</span><span class="ident" id="3833274">v</span><span class="op" id="3833275">,</span>&nbsp;<span class="ident" id="3833277">x</span><span class="op" id="3833278">,</span>&nbsp;<span class="ident" id="3833280">y</span>&nbsp;<span class="builtintype" id="3833282">int</span><span class="op" id="3833285">)</span>&nbsp;<span class="builtintype" id="3833287">int</span>&nbsp;<span class="op" id="3833291">{</span>&nbsp;<span class="keyword" id="3833293">return</span>&nbsp;<span class="op" id="3833300">^</span><span class="op" id="3833301">(</span><span class="ident" id="3833302">v</span><span class="op" id="3833303">-</span><span class="num" id="3833304">1</span><span class="op" id="3833305">)</span><span class="op" id="3833306">&amp;</span><span class="ident" id="3833307">x</span>&nbsp;<span class="op" id="3833309">|</span>&nbsp;<span class="op" id="3833311">(</span><span class="ident" id="3833312">v</span><span class="op" id="3833313">-</span><span class="num" id="3833314">1</span><span class="op" id="3833315">)</span><span class="op" id="3833316">&amp;</span><span class="ident" id="3833317">y</span>&nbsp;<span class="op" id="3833319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3833322">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3833381">func</span>&nbsp;<span class="ident" id="3833386">ConstantTimeByteEq</span><span class="op" id="3833404">(</span><span class="ident" id="3833405">x</span><span class="op" id="3833406">,</span>&nbsp;<span class="ident" id="3833408">y</span>&nbsp;<span class="builtintype" id="3833410">uint8</span><span class="op" id="3833415">)</span>&nbsp;<span class="builtintype" id="3833417">int</span>&nbsp;<span class="op" id="3833421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833424">z</span>&nbsp;<span class="op" id="3833426">:=</span>&nbsp;<span class="op" id="3833429">^</span><span class="op" id="3833430">(</span><span class="ident" id="3833431">x</span>&nbsp;<span class="op" id="3833433">^</span>&nbsp;<span class="ident" id="3833435">y</span><span class="op" id="3833436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833439">z</span>&nbsp;<span class="op" id="3833441">&amp;=</span>&nbsp;<span class="ident" id="3833444">z</span>&nbsp;<span class="op" id="3833446">&gt;&gt;</span>&nbsp;<span class="num" id="3833449">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833452">z</span>&nbsp;<span class="op" id="3833454">&amp;=</span>&nbsp;<span class="ident" id="3833457">z</span>&nbsp;<span class="op" id="3833459">&gt;&gt;</span>&nbsp;<span class="num" id="3833462">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833465">z</span>&nbsp;<span class="op" id="3833467">&amp;=</span>&nbsp;<span class="ident" id="3833470">z</span>&nbsp;<span class="op" id="3833472">&gt;&gt;</span>&nbsp;<span class="num" id="3833475">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833479">return</span>&nbsp;<span class="builtintype" id="3833486">int</span><span class="op" id="3833489">(</span><span class="ident" id="3833490">z</span><span class="op" id="3833491">)</span><br>
<span class="lineno"></span><span class="op" id="3833493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3833496">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3833551">func</span>&nbsp;<span class="ident" id="3833556">ConstantTimeEq</span><span class="op" id="3833570">(</span><span class="ident" id="3833571">x</span><span class="op" id="3833572">,</span>&nbsp;<span class="ident" id="3833574">y</span>&nbsp;<span class="builtintype" id="3833576">int32</span><span class="op" id="3833581">)</span>&nbsp;<span class="builtintype" id="3833583">int</span>&nbsp;<span class="op" id="3833587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833590">z</span>&nbsp;<span class="op" id="3833592">:=</span>&nbsp;<span class="op" id="3833595">^</span><span class="op" id="3833596">(</span><span class="ident" id="3833597">x</span>&nbsp;<span class="op" id="3833599">^</span>&nbsp;<span class="ident" id="3833601">y</span><span class="op" id="3833602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833605">z</span>&nbsp;<span class="op" id="3833607">&amp;=</span>&nbsp;<span class="ident" id="3833610">z</span>&nbsp;<span class="op" id="3833612">&gt;&gt;</span>&nbsp;<span class="num" id="3833615">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833619">z</span>&nbsp;<span class="op" id="3833621">&amp;=</span>&nbsp;<span class="ident" id="3833624">z</span>&nbsp;<span class="op" id="3833626">&gt;&gt;</span>&nbsp;<span class="num" id="3833629">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833632">z</span>&nbsp;<span class="op" id="3833634">&amp;=</span>&nbsp;<span class="ident" id="3833637">z</span>&nbsp;<span class="op" id="3833639">&gt;&gt;</span>&nbsp;<span class="num" id="3833642">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833645">z</span>&nbsp;<span class="op" id="3833647">&amp;=</span>&nbsp;<span class="ident" id="3833650">z</span>&nbsp;<span class="op" id="3833652">&gt;&gt;</span>&nbsp;<span class="num" id="3833655">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833658">z</span>&nbsp;<span class="op" id="3833660">&amp;=</span>&nbsp;<span class="ident" id="3833663">z</span>&nbsp;<span class="op" id="3833665">&gt;&gt;</span>&nbsp;<span class="num" id="3833668">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833672">return</span>&nbsp;<span class="builtintype" id="3833679">int</span><span class="op" id="3833682">(</span><span class="ident" id="3833683">z</span>&nbsp;<span class="op" id="3833685">&amp;</span>&nbsp;<span class="num" id="3833687">1</span><span class="op" id="3833688">)</span><br>
<span class="lineno">50</span><span class="op" id="3833690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3833693">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3833771">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3833848">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3833874">func</span>&nbsp;<span class="ident" id="3833879">ConstantTimeCopy</span><span class="op" id="3833895">(</span><span class="ident" id="3833896">v</span>&nbsp;<span class="builtintype" id="3833898">int</span><span class="op" id="3833901">,</span>&nbsp;<span class="ident" id="3833903">x</span><span class="op" id="3833904">,</span>&nbsp;<span class="ident" id="3833906">y</span>&nbsp;<span class="op" id="3833908">[</span><span class="op" id="3833909">]</span><span class="builtintype" id="3833910">byte</span><span class="op" id="3833914">)</span>&nbsp;<span class="op" id="3833916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3833919">if</span>&nbsp;<span class="builtinfunc" id="3833922">len</span><span class="op" id="3833925">(</span><span class="ident" id="3833926">x</span><span class="op" id="3833927">)</span>&nbsp;<span class="op" id="3833929">!=</span>&nbsp;<span class="builtinfunc" id="3833932">len</span><span class="op" id="3833935">(</span><span class="ident" id="3833936">y</span><span class="op" id="3833937">)</span>&nbsp;<span class="op" id="3833939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3833943">panic</span><span class="op" id="3833948">(</span><span class="string" id="3833949">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3833988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3833991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3833995">xmask</span>&nbsp;<span class="op" id="3834001">:=</span>&nbsp;<span class="builtintype" id="3834004">byte</span><span class="op" id="3834008">(</span><span class="ident" id="3834009">v</span>&nbsp;<span class="op" id="3834011">-</span>&nbsp;<span class="num" id="3834013">1</span><span class="op" id="3834014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3834017">ymask</span>&nbsp;<span class="op" id="3834023">:=</span>&nbsp;<span class="builtintype" id="3834026">byte</span><span class="op" id="3834030">(</span><span class="op" id="3834031">^</span><span class="op" id="3834032">(</span><span class="ident" id="3834033">v</span>&nbsp;<span class="op" id="3834035">-</span>&nbsp;<span class="num" id="3834037">1</span><span class="op" id="3834038">)</span><span class="op" id="3834039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3834042">for</span>&nbsp;<span class="ident" id="3834046">i</span>&nbsp;<span class="op" id="3834048">:=</span>&nbsp;<span class="num" id="3834051">0</span><span class="op" id="3834052">;</span>&nbsp;<span class="ident" id="3834054">i</span>&nbsp;<span class="op" id="3834056">&lt;</span>&nbsp;<span class="builtinfunc" id="3834058">len</span><span class="op" id="3834061">(</span><span class="ident" id="3834062">x</span><span class="op" id="3834063">)</span><span class="op" id="3834064">;</span>&nbsp;<span class="ident" id="3834066">i</span><span class="op" id="3834067">++</span>&nbsp;<span class="op" id="3834070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3834074">x</span><span class="op" id="3834075">[</span><span class="ident" id="3834076">i</span><span class="op" id="3834077">]</span>&nbsp;<span class="op" id="3834079">=</span>&nbsp;<span class="ident" id="3834081">x</span><span class="op" id="3834082">[</span><span class="ident" id="3834083">i</span><span class="op" id="3834084">]</span><span class="op" id="3834085">&amp;</span><span class="ident" id="3834086">xmask</span>&nbsp;<span class="op" id="3834092">|</span>&nbsp;<span class="ident" id="3834094">y</span><span class="op" id="3834095">[</span><span class="ident" id="3834096">i</span><span class="op" id="3834097">]</span><span class="op" id="3834098">&amp;</span><span class="ident" id="3834099">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3834106">}</span><br>
<span class="lineno">65</span><span class="op" id="3834108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3834111">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3834172">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3834240">func</span>&nbsp;<span class="ident" id="3834245">ConstantTimeLessOrEq</span><span class="op" id="3834265">(</span><span class="ident" id="3834266">x</span><span class="op" id="3834267">,</span>&nbsp;<span class="ident" id="3834269">y</span>&nbsp;<span class="builtintype" id="3834271">int</span><span class="op" id="3834274">)</span>&nbsp;<span class="builtintype" id="3834276">int</span>&nbsp;<span class="op" id="3834280">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3834283">x32</span>&nbsp;<span class="op" id="3834287">:=</span>&nbsp;<span class="builtintype" id="3834290">int32</span><span class="op" id="3834295">(</span><span class="ident" id="3834296">x</span><span class="op" id="3834297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3834300">y32</span>&nbsp;<span class="op" id="3834304">:=</span>&nbsp;<span class="builtintype" id="3834307">int32</span><span class="op" id="3834312">(</span><span class="ident" id="3834313">y</span><span class="op" id="3834314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3834317">return</span>&nbsp;<span class="builtintype" id="3834324">int</span><span class="op" id="3834327">(</span><span class="op" id="3834328">(</span><span class="op" id="3834329">(</span><span class="ident" id="3834330">x32</span>&nbsp;<span class="op" id="3834334">-</span>&nbsp;<span class="ident" id="3834336">y32</span>&nbsp;<span class="op" id="3834340">-</span>&nbsp;<span class="num" id="3834342">1</span><span class="op" id="3834343">)</span>&nbsp;<span class="op" id="3834345">&gt;&gt;</span>&nbsp;<span class="num" id="3834348">31</span><span class="op" id="3834350">)</span>&nbsp;<span class="op" id="3834352">&amp;</span>&nbsp;<span class="num" id="3834354">1</span><span class="op" id="3834355">)</span><br>
<span class="lineno"></span><span class="op" id="3834357">}</span>
</div>
</body>
</html>
