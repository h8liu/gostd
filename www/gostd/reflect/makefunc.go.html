<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>reflect</h2>
<ul>
<li><a href="/gostd/reflect/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/reflect/deepequal.go.html">deepequal.go</a></li>
<li><a href="/gostd/reflect/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/reflect/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/reflect/makefunc.go.html" class="current">makefunc.go</a></li>
<li><a href="/gostd/reflect/set_test.go.html">set_test.go</a></li>
<li><a href="/gostd/reflect/tostring_test.go.html">tostring_test.go</a></li>
<li><a href="/gostd/reflect/type.go.html">type.go</a></li>
<li><a href="/gostd/reflect/value.go.html">value.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2775703">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2775759">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2775813">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2775864">//&nbsp;MakeFunc&nbsp;implementation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2775893">package</span>&nbsp;<span class="ident" id="2775901">reflect</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2775910">import</span>&nbsp;<span class="op" id="2775917">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2775920">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2775929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2775932">//&nbsp;makeFuncImpl&nbsp;is&nbsp;the&nbsp;closure&nbsp;value&nbsp;implementing&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2775995">//&nbsp;returned&nbsp;by&nbsp;MakeFunc.</span><br>
<span class="lineno">15</span><span class="keyword" id="2776020">type</span>&nbsp;<span class="ident" id="2776025">makeFuncImpl</span>&nbsp;<span class="keyword" id="2776038">struct</span>&nbsp;<span class="op" id="2776045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2776048">code</span>&nbsp;&nbsp;<span class="builtintype" id="2776054">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2776063">stack</span>&nbsp;<span class="op" id="2776069">*</span><span class="ident" id="2776070"><a href="/gostd/reflect/type.go.html#2831088">bitVector</a></span>&nbsp;<span class="comment" id="2776080">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2776132">typ</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2776138">*</span><span class="ident" id="2776139"><a href="/gostd/reflect/type.go.html#2790989">funcType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2776149">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2776155">func</span><span class="op" id="2776159">(</span><span class="op" id="2776160">[</span><span class="op" id="2776161">]</span><span class="ident" id="2776162"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2776167">)</span>&nbsp;<span class="op" id="2776169">[</span><span class="op" id="2776170">]</span><span class="ident" id="2776171"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><br>
<span class="lineno">20</span><span class="op" id="2776177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2776180">//&nbsp;MakeFunc&nbsp;returns&nbsp;a&nbsp;new&nbsp;function&nbsp;of&nbsp;the&nbsp;given&nbsp;Type</span><br>
<span class="lineno"></span><span class="comment" id="2776233">//&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;fn.&nbsp;When&nbsp;called,&nbsp;that&nbsp;new&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2776295">//&nbsp;does&nbsp;the&nbsp;following:</span><br>
<span class="lineno">25</span><span class="comment" id="2776318">//</span><br>
<span class="lineno"></span><span class="comment" id="2776321">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;converts&nbsp;its&nbsp;arguments&nbsp;to&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values.</span><br>
<span class="lineno"></span><span class="comment" id="2776371">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;runs&nbsp;results&nbsp;:=&nbsp;fn(args).</span><br>
<span class="lineno"></span><span class="comment" id="2776402">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;returns&nbsp;the&nbsp;results&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values,&nbsp;one&nbsp;per&nbsp;formal&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="2776472">//</span><br>
<span class="lineno">30</span><span class="comment" id="2776475">//&nbsp;The&nbsp;implementation&nbsp;fn&nbsp;can&nbsp;assume&nbsp;that&nbsp;the&nbsp;argument&nbsp;Value&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2776541">//&nbsp;has&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;arguments&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2776595">//&nbsp;If&nbsp;typ&nbsp;describes&nbsp;a&nbsp;variadic&nbsp;function,&nbsp;the&nbsp;final&nbsp;Value&nbsp;is&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2776662">//&nbsp;a&nbsp;slice&nbsp;representing&nbsp;the&nbsp;variadic&nbsp;arguments,&nbsp;as&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2776720">//&nbsp;body&nbsp;of&nbsp;a&nbsp;variadic&nbsp;function.&nbsp;The&nbsp;result&nbsp;Value&nbsp;slice&nbsp;returned&nbsp;by&nbsp;fn</span><br>
<span class="lineno">35</span><span class="comment" id="2776790">//&nbsp;must&nbsp;have&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;results&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2776848">//</span><br>
<span class="lineno"></span><span class="comment" id="2776851">//&nbsp;The&nbsp;Value.Call&nbsp;method&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;invoke&nbsp;a&nbsp;typed&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2776921">//&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values;&nbsp;in&nbsp;contrast,&nbsp;MakeFunc&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="2776997">//&nbsp;a&nbsp;typed&nbsp;function&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values.</span><br>
<span class="lineno">40</span><span class="comment" id="2777037">//</span><br>
<span class="lineno"></span><span class="comment" id="2777040">//&nbsp;The&nbsp;Examples&nbsp;section&nbsp;of&nbsp;the&nbsp;documentation&nbsp;includes&nbsp;an&nbsp;illustration</span><br>
<span class="lineno"></span><span class="comment" id="2777110">//&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;MakeFunc&nbsp;to&nbsp;build&nbsp;a&nbsp;swap&nbsp;function&nbsp;for&nbsp;different&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="2777182">//</span><br>
<span class="lineno"></span><span class="keyword" id="2777185">func</span>&nbsp;<span class="ident" id="2777190">MakeFunc</span><span class="op" id="2777198">(</span><span class="ident" id="2777199">typ</span>&nbsp;<span class="ident" id="2777203"><a href="/gostd/reflect/type.go.html#2781467">Type</a></span><span class="op" id="2777207">,</span>&nbsp;<span class="ident" id="2777209">fn</span>&nbsp;<span class="keyword" id="2777212">func</span><span class="op" id="2777216">(</span><span class="ident" id="2777217">args</span>&nbsp;<span class="op" id="2777222">[</span><span class="op" id="2777223">]</span><span class="ident" id="2777224"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2777229">)</span>&nbsp;<span class="op" id="2777231">(</span><span class="ident" id="2777232">results</span>&nbsp;<span class="op" id="2777240">[</span><span class="op" id="2777241">]</span><span class="ident" id="2777242"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2777247">)</span><span class="op" id="2777248">)</span>&nbsp;<span class="ident" id="2777250"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span>&nbsp;<span class="op" id="2777256">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2777259">if</span>&nbsp;<span class="ident" id="2777262"><a href="/gostd/reflect/makefunc.go.html#2777199">typ</a></span><span class="op" id="2777265">.</span><span class="ident" id="2777266"><a href="/gostd/reflect/type.go.html#2783619">Kind</a></span><span class="op" id="2777270">(</span><span class="op" id="2777271">)</span>&nbsp;<span class="op" id="2777273">!=</span>&nbsp;<span class="ident" id="2777276"><a href="/gostd/reflect/type.go.html#2788035">Func</a></span>&nbsp;<span class="op" id="2777281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2777285">panic</span><span class="op" id="2777290">(</span><span class="string" id="2777291">&#34;reflect:&nbsp;call&nbsp;of&nbsp;MakeFunc&nbsp;with&nbsp;non-Func&nbsp;type&#34;</span><span class="op" id="2777337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2777340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777344">t</span>&nbsp;<span class="op" id="2777346">:=</span>&nbsp;<span class="ident" id="2777349"><a href="/gostd/reflect/makefunc.go.html#2777199">typ</a></span><span class="op" id="2777352">.</span><span class="ident" id="2777353"><a href="/gostd/reflect/type.go.html#2786995">common</a></span><span class="op" id="2777359">(</span><span class="op" id="2777360">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777363">ftyp</span>&nbsp;<span class="op" id="2777368">:=</span>&nbsp;<span class="op" id="2777371">(</span><span class="op" id="2777372">*</span><span class="ident" id="2777373"><a href="/gostd/reflect/type.go.html#2790989">funcType</a></span><span class="op" id="2777381">)</span><span class="op" id="2777382">(</span><span class="ident" id="2777383"><a href="/gostd/reflect/makefunc.go.html#2775920">unsafe</a></span><span class="op" id="2777389">.</span><span class="ident" id="2777390">Pointer</span><span class="op" id="2777397">(</span><span class="ident" id="2777398"><a href="/gostd/reflect/makefunc.go.html#2777344">t</a></span><span class="op" id="2777399">)</span><span class="op" id="2777400">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2777404">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2777449">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2777504">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777564">dummy</span>&nbsp;<span class="op" id="2777570">:=</span>&nbsp;<span class="ident" id="2777573"><a href="/gostd/reflect/makefunc.go.html#2778190">makeFuncStub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777587">code</span>&nbsp;<span class="op" id="2777592">:=</span>&nbsp;<span class="op" id="2777595">*</span><span class="op" id="2777596">*</span><span class="op" id="2777597">(</span><span class="op" id="2777598">*</span><span class="op" id="2777599">*</span><span class="builtintype" id="2777600">uintptr</span><span class="op" id="2777607">)</span><span class="op" id="2777608">(</span><span class="ident" id="2777609"><a href="/gostd/reflect/makefunc.go.html#2775920">unsafe</a></span><span class="op" id="2777615">.</span><span class="ident" id="2777616">Pointer</span><span class="op" id="2777623">(</span><span class="op" id="2777624">&amp;</span><span class="ident" id="2777625"><a href="/gostd/reflect/makefunc.go.html#2777564">dummy</a></span><span class="op" id="2777630">)</span><span class="op" id="2777631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2777635">//&nbsp;makeFuncImpl&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777696">_</span><span class="op" id="2777697">,</span>&nbsp;<span class="ident" id="2777699">_</span><span class="op" id="2777700">,</span>&nbsp;<span class="ident" id="2777702">_</span><span class="op" id="2777703">,</span>&nbsp;<span class="ident" id="2777705">stack</span>&nbsp;<span class="op" id="2777711">:=</span>&nbsp;<span class="ident" id="2777714"><a href="/gostd/reflect/type.go.html#2828689">funcLayout</a></span><span class="op" id="2777724">(</span><span class="ident" id="2777725"><a href="/gostd/reflect/makefunc.go.html#2777344">t</a></span><span class="op" id="2777726">,</span>&nbsp;<span class="builtintype" id="2777728">nil</span><span class="op" id="2777731">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2777735">impl</span>&nbsp;<span class="op" id="2777740">:=</span>&nbsp;<span class="op" id="2777743">&amp;</span><span class="ident" id="2777744"><a href="/gostd/reflect/makefunc.go.html#2776025">makeFuncImpl</a></span><span class="op" id="2777756">{</span><span class="ident" id="2777757"><a href="/gostd/reflect/makefunc.go.html#2776048">code</a></span><span class="op" id="2777761">:</span>&nbsp;<span class="ident" id="2777763"><a href="/gostd/reflect/makefunc.go.html#2777587">code</a></span><span class="op" id="2777767">,</span>&nbsp;<span class="ident" id="2777769"><a href="/gostd/reflect/makefunc.go.html#2776063">stack</a></span><span class="op" id="2777774">:</span>&nbsp;<span class="ident" id="2777776"><a href="/gostd/reflect/makefunc.go.html#2777705">stack</a></span><span class="op" id="2777781">,</span>&nbsp;<span class="ident" id="2777783"><a href="/gostd/reflect/makefunc.go.html#2776132">typ</a></span><span class="op" id="2777786">:</span>&nbsp;<span class="ident" id="2777788"><a href="/gostd/reflect/makefunc.go.html#2777363">ftyp</a></span><span class="op" id="2777792">,</span>&nbsp;<span class="ident" id="2777794"><a href="/gostd/reflect/makefunc.go.html#2776149">fn</a></span><span class="op" id="2777796">:</span>&nbsp;<span class="ident" id="2777798"><a href="/gostd/reflect/makefunc.go.html#2777209">fn</a></span><span class="op" id="2777800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2777804">return</span>&nbsp;<span class="ident" id="2777811"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2777816">{</span><span class="ident" id="2777817"><a href="/gostd/reflect/makefunc.go.html#2777344">t</a></span><span class="op" id="2777818">,</span>&nbsp;<span class="ident" id="2777820"><a href="/gostd/reflect/makefunc.go.html#2775920">unsafe</a></span><span class="op" id="2777826">.</span><span class="ident" id="2777827">Pointer</span><span class="op" id="2777834">(</span><span class="ident" id="2777835"><a href="/gostd/reflect/makefunc.go.html#2777735">impl</a></span><span class="op" id="2777839">)</span><span class="op" id="2777840">,</span>&nbsp;<span class="ident" id="2777842"><a href="/gostd/reflect/value.go.html#2834688">flag</a></span><span class="op" id="2777846">(</span><span class="ident" id="2777847"><a href="/gostd/reflect/type.go.html#2788035">Func</a></span><span class="op" id="2777851">)</span><span class="op" id="2777852">}</span><br>
<span class="lineno"></span><span class="op" id="2777854">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2777857">//&nbsp;makeFuncStub&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2777922">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;MakeFunc.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*callReflectFunc</span><br>
<span class="lineno"></span><span class="comment" id="2777992">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callReflect(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2778070">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno">70</span><span class="comment" id="2778144">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2778185">func</span>&nbsp;<span class="ident" id="2778190">makeFuncStub</span><span class="op" id="2778202">(</span><span class="op" id="2778203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2778206">type</span>&nbsp;<span class="ident" id="2778211">methodValue</span>&nbsp;<span class="keyword" id="2778223">struct</span>&nbsp;<span class="op" id="2778230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2778233">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2778240">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2778249">stack</span>&nbsp;&nbsp;<span class="op" id="2778256">*</span><span class="ident" id="2778257"><a href="/gostd/reflect/type.go.html#2831088">bitVector</a></span>&nbsp;<span class="comment" id="2778267">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2778319">method</span>&nbsp;<span class="builtintype" id="2778326">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2778331">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2778338"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><br>
<span class="lineno"></span><span class="op" id="2778344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2778347">//&nbsp;makeMethodValue&nbsp;converts&nbsp;v&nbsp;from&nbsp;the&nbsp;rcvr+method&nbsp;index&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="2778419">//&nbsp;of&nbsp;a&nbsp;method&nbsp;value&nbsp;to&nbsp;an&nbsp;actual&nbsp;method&nbsp;func&nbsp;value,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2778481">//&nbsp;basically&nbsp;the&nbsp;receiver&nbsp;value&nbsp;with&nbsp;a&nbsp;special&nbsp;bit&nbsp;set,&nbsp;into&nbsp;a&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="2778549">//&nbsp;func&nbsp;value&nbsp;-&nbsp;a&nbsp;value&nbsp;holding&nbsp;an&nbsp;actual&nbsp;func.&nbsp;The&nbsp;output&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2778611">//&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;input&nbsp;as&nbsp;far&nbsp;as&nbsp;the&nbsp;user&nbsp;of&nbsp;package</span><br>
<span class="lineno">85</span><span class="comment" id="2778681">//&nbsp;reflect&nbsp;can&nbsp;tell,&nbsp;but&nbsp;the&nbsp;true&nbsp;func&nbsp;representation&nbsp;can&nbsp;be&nbsp;handled</span><br>
<span class="lineno"></span><span class="comment" id="2778750">//&nbsp;by&nbsp;code&nbsp;like&nbsp;Convert&nbsp;and&nbsp;Interface&nbsp;and&nbsp;Assign.</span><br>
<span class="lineno"></span><span class="keyword" id="2778800">func</span>&nbsp;<span class="ident" id="2778805">makeMethodValue</span><span class="op" id="2778820">(</span><span class="ident" id="2778821">op</span>&nbsp;<span class="builtintype" id="2778824">string</span><span class="op" id="2778830">,</span>&nbsp;<span class="ident" id="2778832">v</span>&nbsp;<span class="ident" id="2778834"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2778839">)</span>&nbsp;<span class="ident" id="2778841"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span>&nbsp;<span class="op" id="2778847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2778850">if</span>&nbsp;<span class="ident" id="2778853"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2778854">.</span><span class="ident" id="2778855"><a href="/gostd/reflect/value.go.html#2834380">flag</a></span><span class="op" id="2778859">&amp;</span><span class="ident" id="2778860"><a href="/gostd/reflect/value.go.html#2834897">flagMethod</a></span>&nbsp;<span class="op" id="2778871">==</span>&nbsp;<span class="num" id="2778874">0</span>&nbsp;<span class="op" id="2778876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2778880">panic</span><span class="op" id="2778885">(</span><span class="string" id="2778886">&#34;reflect:&nbsp;internal&nbsp;error:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;makeMethodValue&#34;</span><span class="op" id="2778943">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2778946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2778950">//&nbsp;Ignoring&nbsp;the&nbsp;flagMethod&nbsp;bit,&nbsp;v&nbsp;describes&nbsp;the&nbsp;receiver,&nbsp;not&nbsp;the&nbsp;method&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779030">fl</span>&nbsp;<span class="op" id="2779033">:=</span>&nbsp;<span class="ident" id="2779036"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779037">.</span><span class="ident" id="2779038"><a href="/gostd/reflect/value.go.html#2834380">flag</a></span>&nbsp;<span class="op" id="2779043">&amp;</span>&nbsp;<span class="op" id="2779045">(</span><span class="ident" id="2779046"><a href="/gostd/reflect/value.go.html#2834804">flagRO</a></span>&nbsp;<span class="op" id="2779053">|</span>&nbsp;<span class="ident" id="2779055"><a href="/gostd/reflect/value.go.html#2834866">flagAddr</a></span>&nbsp;<span class="op" id="2779064">|</span>&nbsp;<span class="ident" id="2779066"><a href="/gostd/reflect/value.go.html#2834835">flagIndir</a></span><span class="op" id="2779075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779078"><a href="/gostd/reflect/makefunc.go.html#2779030">fl</a></span>&nbsp;<span class="op" id="2779081">|=</span>&nbsp;<span class="ident" id="2779084"><a href="/gostd/reflect/value.go.html#2834688">flag</a></span><span class="op" id="2779088">(</span><span class="ident" id="2779089"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779090">.</span><span class="ident" id="2779091"><a href="/gostd/reflect/value.go.html#2833633">typ</a></span><span class="op" id="2779094">.</span><span class="ident" id="2779095"><a href="/gostd/reflect/type.go.html#2795201">Kind</a></span><span class="op" id="2779099">(</span><span class="op" id="2779100">)</span><span class="op" id="2779101">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779104">rcvr</span>&nbsp;<span class="op" id="2779109">:=</span>&nbsp;<span class="ident" id="2779112"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2779117">{</span><span class="ident" id="2779118"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779119">.</span><span class="ident" id="2779120"><a href="/gostd/reflect/value.go.html#2833633">typ</a></span><span class="op" id="2779123">,</span>&nbsp;<span class="ident" id="2779125"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779126">.</span><span class="ident" id="2779127"><a href="/gostd/reflect/value.go.html#2833778">ptr</a></span><span class="op" id="2779130">,</span>&nbsp;<span class="ident" id="2779132"><a href="/gostd/reflect/makefunc.go.html#2779030">fl</a></span><span class="op" id="2779134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779138">//&nbsp;v.Type&nbsp;returns&nbsp;the&nbsp;actual&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779194">funcType</span>&nbsp;<span class="op" id="2779203">:=</span>&nbsp;<span class="ident" id="2779206"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779207">.</span><span class="ident" id="2779208"><a href="/gostd/reflect/value.go.html#2880910">Type</a></span><span class="op" id="2779212">(</span><span class="op" id="2779213">)</span><span class="op" id="2779214">.</span><span class="op" id="2779215">(</span><span class="op" id="2779216">*</span><span class="ident" id="2779217"><a href="/gostd/reflect/type.go.html#2788350">rtype</a></span><span class="op" id="2779222">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779226">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779271">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779326">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779386">dummy</span>&nbsp;<span class="op" id="2779392">:=</span>&nbsp;<span class="ident" id="2779395"><a href="/gostd/reflect/makefunc.go.html#2780311">methodValueCall</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779412">code</span>&nbsp;<span class="op" id="2779417">:=</span>&nbsp;<span class="op" id="2779420">*</span><span class="op" id="2779421">*</span><span class="op" id="2779422">(</span><span class="op" id="2779423">*</span><span class="op" id="2779424">*</span><span class="builtintype" id="2779425">uintptr</span><span class="op" id="2779432">)</span><span class="op" id="2779433">(</span><span class="ident" id="2779434"><a href="/gostd/reflect/makefunc.go.html#2775920">unsafe</a></span><span class="op" id="2779440">.</span><span class="ident" id="2779441">Pointer</span><span class="op" id="2779448">(</span><span class="op" id="2779449">&amp;</span><span class="ident" id="2779450"><a href="/gostd/reflect/makefunc.go.html#2779386">dummy</a></span><span class="op" id="2779455">)</span><span class="op" id="2779456">)</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779460">//&nbsp;methodValue&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779520">_</span><span class="op" id="2779521">,</span>&nbsp;<span class="ident" id="2779523">_</span><span class="op" id="2779524">,</span>&nbsp;<span class="ident" id="2779526">_</span><span class="op" id="2779527">,</span>&nbsp;<span class="ident" id="2779529">stack</span>&nbsp;<span class="op" id="2779535">:=</span>&nbsp;<span class="ident" id="2779538"><a href="/gostd/reflect/type.go.html#2828689">funcLayout</a></span><span class="op" id="2779548">(</span><span class="ident" id="2779549"><a href="/gostd/reflect/makefunc.go.html#2779194">funcType</a></span><span class="op" id="2779557">,</span>&nbsp;<span class="builtintype" id="2779559">nil</span><span class="op" id="2779562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779566">fv</span>&nbsp;<span class="op" id="2779569">:=</span>&nbsp;<span class="op" id="2779572">&amp;</span><span class="ident" id="2779573"><a href="/gostd/reflect/makefunc.go.html#2778211">methodValue</a></span><span class="op" id="2779584">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779588"><a href="/gostd/reflect/makefunc.go.html#2778233">fn</a></span><span class="op" id="2779590">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779596"><a href="/gostd/reflect/makefunc.go.html#2779412">code</a></span><span class="op" id="2779600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779604"><a href="/gostd/reflect/makefunc.go.html#2778249">stack</a></span><span class="op" id="2779609">:</span>&nbsp;&nbsp;<span class="ident" id="2779612"><a href="/gostd/reflect/makefunc.go.html#2779529">stack</a></span><span class="op" id="2779617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779621"><a href="/gostd/reflect/makefunc.go.html#2778319">method</a></span><span class="op" id="2779627">:</span>&nbsp;<span class="builtintype" id="2779629">int</span><span class="op" id="2779632">(</span><span class="ident" id="2779633"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779634">.</span><span class="ident" id="2779635"><a href="/gostd/reflect/value.go.html#2834380">flag</a></span><span class="op" id="2779639">)</span>&nbsp;<span class="op" id="2779641">&gt;&gt;</span>&nbsp;<span class="ident" id="2779644"><a href="/gostd/reflect/value.go.html#2834928">flagMethodShift</a></span><span class="op" id="2779659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779663"><a href="/gostd/reflect/makefunc.go.html#2778331">rcvr</a></span><span class="op" id="2779667">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2779671"><a href="/gostd/reflect/makefunc.go.html#2779104">rcvr</a></span><span class="op" id="2779675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2779678">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779682">//&nbsp;Cause&nbsp;panic&nbsp;if&nbsp;method&nbsp;is&nbsp;not&nbsp;appropriate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779728">//&nbsp;The&nbsp;panic&nbsp;would&nbsp;still&nbsp;happen&nbsp;during&nbsp;the&nbsp;call&nbsp;if&nbsp;we&nbsp;omit&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2779794">//&nbsp;but&nbsp;we&nbsp;want&nbsp;Interface()&nbsp;and&nbsp;other&nbsp;operations&nbsp;to&nbsp;fail&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2779858"><a href="/gostd/reflect/value.go.html#2848286">methodReceiver</a></span><span class="op" id="2779872">(</span><span class="ident" id="2779873"><a href="/gostd/reflect/makefunc.go.html#2778821">op</a></span><span class="op" id="2779875">,</span>&nbsp;<span class="ident" id="2779877"><a href="/gostd/reflect/makefunc.go.html#2779566">fv</a></span><span class="op" id="2779879">.</span><span class="ident" id="2779880"><a href="/gostd/reflect/makefunc.go.html#2778331">rcvr</a></span><span class="op" id="2779884">,</span>&nbsp;<span class="ident" id="2779886"><a href="/gostd/reflect/makefunc.go.html#2779566">fv</a></span><span class="op" id="2779888">.</span><span class="ident" id="2779889"><a href="/gostd/reflect/makefunc.go.html#2778319">method</a></span><span class="op" id="2779895">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2779899">return</span>&nbsp;<span class="ident" id="2779906"><a href="/gostd/reflect/value.go.html#2833557">Value</a></span><span class="op" id="2779911">{</span><span class="ident" id="2779912"><a href="/gostd/reflect/makefunc.go.html#2779194">funcType</a></span><span class="op" id="2779920">,</span>&nbsp;<span class="ident" id="2779922"><a href="/gostd/reflect/makefunc.go.html#2775920">unsafe</a></span><span class="op" id="2779928">.</span><span class="ident" id="2779929">Pointer</span><span class="op" id="2779936">(</span><span class="ident" id="2779937"><a href="/gostd/reflect/makefunc.go.html#2779566">fv</a></span><span class="op" id="2779939">)</span><span class="op" id="2779940">,</span>&nbsp;<span class="ident" id="2779942"><a href="/gostd/reflect/makefunc.go.html#2778832">v</a></span><span class="op" id="2779943">.</span><span class="ident" id="2779944"><a href="/gostd/reflect/value.go.html#2834380">flag</a></span><span class="op" id="2779948">&amp;</span><span class="ident" id="2779949"><a href="/gostd/reflect/value.go.html#2834804">flagRO</a></span>&nbsp;<span class="op" id="2779956">|</span>&nbsp;<span class="ident" id="2779958"><a href="/gostd/reflect/value.go.html#2834688">flag</a></span><span class="op" id="2779962">(</span><span class="ident" id="2779963"><a href="/gostd/reflect/type.go.html#2788035">Func</a></span><span class="op" id="2779967">)</span><span class="op" id="2779968">}</span><br>
<span class="lineno"></span><span class="op" id="2779970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2779973">//&nbsp;methodValueCall&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno">125</span><span class="comment" id="2780041">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;makeMethodValue.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*methodValue</span><br>
<span class="lineno"></span><span class="comment" id="2780114">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callMethod(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2780191">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2780265">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2780306">func</span>&nbsp;<span class="ident" id="2780311">methodValueCall</span><span class="op" id="2780326">(</span><span class="op" id="2780327">)</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
