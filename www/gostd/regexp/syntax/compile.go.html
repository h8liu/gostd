<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3426358">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3426413">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3426467">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3426518">package</span>&nbsp;<span class="ident" id="3426526">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3426534">import</span>&nbsp;<span class="string" id="3426541">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3426552">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="3426638">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="3426717">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="3426788">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="3426854">//</span><br>
<span class="lineno"></span><span class="comment" id="3426857">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="3426935">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="3426996">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="3427043">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="3427113">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3427190">type</span>&nbsp;<span class="ident" id="3427195">patchList</span>&nbsp;<span class="builtintype" id="3427205">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3427213">func</span>&nbsp;<span class="op" id="3427218">(</span><span class="ident" id="3427219">l</span>&nbsp;<span class="ident" id="3427221">patchList</span><span class="op" id="3427230">)</span>&nbsp;<span class="ident" id="3427232">next</span><span class="op" id="3427236">(</span><span class="ident" id="3427237">p</span>&nbsp;<span class="op" id="3427239">*</span><span class="ident" id="3427240">Prog</span><span class="op" id="3427244">)</span>&nbsp;<span class="ident" id="3427246">patchList</span>&nbsp;<span class="op" id="3427256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427259">i</span>&nbsp;<span class="op" id="3427261">:=</span>&nbsp;<span class="op" id="3427264">&amp;</span><span class="ident" id="3427265">p</span><span class="op" id="3427266">.</span><span class="ident" id="3427267">Inst</span><span class="op" id="3427271">[</span><span class="ident" id="3427272">l</span><span class="op" id="3427273">&gt;&gt;</span><span class="num" id="3427275">1</span><span class="op" id="3427276">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427279">if</span>&nbsp;<span class="ident" id="3427282">l</span><span class="op" id="3427283">&amp;</span><span class="num" id="3427284">1</span>&nbsp;<span class="op" id="3427286">==</span>&nbsp;<span class="num" id="3427289">0</span>&nbsp;<span class="op" id="3427291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427295">return</span>&nbsp;<span class="ident" id="3427302">patchList</span><span class="op" id="3427311">(</span><span class="ident" id="3427312">i</span><span class="op" id="3427313">.</span><span class="ident" id="3427314">Out</span><span class="op" id="3427317">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427323">return</span>&nbsp;<span class="ident" id="3427330">patchList</span><span class="op" id="3427339">(</span><span class="ident" id="3427340">i</span><span class="op" id="3427341">.</span><span class="ident" id="3427342">Arg</span><span class="op" id="3427345">)</span><br>
<span class="lineno"></span><span class="op" id="3427347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3427350">func</span>&nbsp;<span class="op" id="3427355">(</span><span class="ident" id="3427356">l</span>&nbsp;<span class="ident" id="3427358">patchList</span><span class="op" id="3427367">)</span>&nbsp;<span class="ident" id="3427369">patch</span><span class="op" id="3427374">(</span><span class="ident" id="3427375">p</span>&nbsp;<span class="op" id="3427377">*</span><span class="ident" id="3427378">Prog</span><span class="op" id="3427382">,</span>&nbsp;<span class="ident" id="3427384">val</span>&nbsp;<span class="builtintype" id="3427388">uint32</span><span class="op" id="3427394">)</span>&nbsp;<span class="op" id="3427396">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427399">for</span>&nbsp;<span class="ident" id="3427403">l</span>&nbsp;<span class="op" id="3427405">!=</span>&nbsp;<span class="num" id="3427408">0</span>&nbsp;<span class="op" id="3427410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427414">i</span>&nbsp;<span class="op" id="3427416">:=</span>&nbsp;<span class="op" id="3427419">&amp;</span><span class="ident" id="3427420">p</span><span class="op" id="3427421">.</span><span class="ident" id="3427422">Inst</span><span class="op" id="3427426">[</span><span class="ident" id="3427427">l</span><span class="op" id="3427428">&gt;&gt;</span><span class="num" id="3427430">1</span><span class="op" id="3427431">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427435">if</span>&nbsp;<span class="ident" id="3427438">l</span><span class="op" id="3427439">&amp;</span><span class="num" id="3427440">1</span>&nbsp;<span class="op" id="3427442">==</span>&nbsp;<span class="num" id="3427445">0</span>&nbsp;<span class="op" id="3427447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427452">l</span>&nbsp;<span class="op" id="3427454">=</span>&nbsp;<span class="ident" id="3427456">patchList</span><span class="op" id="3427465">(</span><span class="ident" id="3427466">i</span><span class="op" id="3427467">.</span><span class="ident" id="3427468">Out</span><span class="op" id="3427471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427476">i</span><span class="op" id="3427477">.</span><span class="ident" id="3427478">Out</span>&nbsp;<span class="op" id="3427482">=</span>&nbsp;<span class="ident" id="3427484">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427490">}</span>&nbsp;<span class="keyword" id="3427492">else</span>&nbsp;<span class="op" id="3427497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427502">l</span>&nbsp;<span class="op" id="3427504">=</span>&nbsp;<span class="ident" id="3427506">patchList</span><span class="op" id="3427515">(</span><span class="ident" id="3427516">i</span><span class="op" id="3427517">.</span><span class="ident" id="3427518">Arg</span><span class="op" id="3427521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427526">i</span><span class="op" id="3427527">.</span><span class="ident" id="3427528">Arg</span>&nbsp;<span class="op" id="3427532">=</span>&nbsp;<span class="ident" id="3427534">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427543">}</span><br>
<span class="lineno">40</span><span class="op" id="3427545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3427548">func</span>&nbsp;<span class="op" id="3427553">(</span><span class="ident" id="3427554">l1</span>&nbsp;<span class="ident" id="3427557">patchList</span><span class="op" id="3427566">)</span>&nbsp;<span class="builtinfunc" id="3427568">append</span><span class="op" id="3427574">(</span><span class="ident" id="3427575">p</span>&nbsp;<span class="op" id="3427577">*</span><span class="ident" id="3427578">Prog</span><span class="op" id="3427582">,</span>&nbsp;<span class="ident" id="3427584">l2</span>&nbsp;<span class="ident" id="3427587">patchList</span><span class="op" id="3427596">)</span>&nbsp;<span class="ident" id="3427598">patchList</span>&nbsp;<span class="op" id="3427608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427611">if</span>&nbsp;<span class="ident" id="3427614">l1</span>&nbsp;<span class="op" id="3427617">==</span>&nbsp;<span class="num" id="3427620">0</span>&nbsp;<span class="op" id="3427622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427626">return</span>&nbsp;<span class="ident" id="3427633">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427640">if</span>&nbsp;<span class="ident" id="3427643">l2</span>&nbsp;<span class="op" id="3427646">==</span>&nbsp;<span class="num" id="3427649">0</span>&nbsp;<span class="op" id="3427651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427655">return</span>&nbsp;<span class="ident" id="3427662">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427670">last</span>&nbsp;<span class="op" id="3427675">:=</span>&nbsp;<span class="ident" id="3427678">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427682">for</span>&nbsp;<span class="op" id="3427686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427690">next</span>&nbsp;<span class="op" id="3427695">:=</span>&nbsp;<span class="ident" id="3427698">last</span><span class="op" id="3427702">.</span><span class="ident" id="3427703">next</span><span class="op" id="3427707">(</span><span class="ident" id="3427708">p</span><span class="op" id="3427709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427713">if</span>&nbsp;<span class="ident" id="3427716">next</span>&nbsp;<span class="op" id="3427721">==</span>&nbsp;<span class="num" id="3427724">0</span>&nbsp;<span class="op" id="3427726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427731">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427743">last</span>&nbsp;<span class="op" id="3427748">=</span>&nbsp;<span class="ident" id="3427750">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427760">i</span>&nbsp;<span class="op" id="3427762">:=</span>&nbsp;<span class="op" id="3427765">&amp;</span><span class="ident" id="3427766">p</span><span class="op" id="3427767">.</span><span class="ident" id="3427768">Inst</span><span class="op" id="3427772">[</span><span class="ident" id="3427773">last</span><span class="op" id="3427777">&gt;&gt;</span><span class="num" id="3427779">1</span><span class="op" id="3427780">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427783">if</span>&nbsp;<span class="ident" id="3427786">last</span><span class="op" id="3427790">&amp;</span><span class="num" id="3427791">1</span>&nbsp;<span class="op" id="3427793">==</span>&nbsp;<span class="num" id="3427796">0</span>&nbsp;<span class="op" id="3427798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427802">i</span><span class="op" id="3427803">.</span><span class="ident" id="3427804">Out</span>&nbsp;<span class="op" id="3427808">=</span>&nbsp;<span class="builtintype" id="3427810">uint32</span><span class="op" id="3427816">(</span><span class="ident" id="3427817">l2</span><span class="op" id="3427819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427822">}</span>&nbsp;<span class="keyword" id="3427824">else</span>&nbsp;<span class="op" id="3427829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427833">i</span><span class="op" id="3427834">.</span><span class="ident" id="3427835">Arg</span>&nbsp;<span class="op" id="3427839">=</span>&nbsp;<span class="builtintype" id="3427841">uint32</span><span class="op" id="3427847">(</span><span class="ident" id="3427848">l2</span><span class="op" id="3427850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3427853">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3427856">return</span>&nbsp;<span class="ident" id="3427863">l1</span><br>
<span class="lineno"></span><span class="op" id="3427866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3427869">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="3427919">type</span>&nbsp;<span class="ident" id="3427924">frag</span>&nbsp;<span class="keyword" id="3427929">struct</span>&nbsp;<span class="op" id="3427936">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427939">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3427943">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3427953">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3427984">out</span>&nbsp;<span class="ident" id="3427988">patchList</span>&nbsp;<span class="comment" id="3427998">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="3428033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3428036">type</span>&nbsp;<span class="ident" id="3428041">compiler</span>&nbsp;<span class="keyword" id="3428050">struct</span>&nbsp;<span class="op" id="3428057">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428060">p</span>&nbsp;<span class="op" id="3428062">*</span><span class="ident" id="3428063">Prog</span><br>
<span class="lineno"></span><span class="op" id="3428068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3428071">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="3428133">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="3428212">func</span>&nbsp;<span class="ident" id="3428217">Compile</span><span class="op" id="3428224">(</span><span class="ident" id="3428225">re</span>&nbsp;<span class="op" id="3428228">*</span><span class="ident" id="3428229">Regexp</span><span class="op" id="3428235">)</span>&nbsp;<span class="op" id="3428237">(</span><span class="op" id="3428238">*</span><span class="ident" id="3428239">Prog</span><span class="op" id="3428243">,</span>&nbsp;<span class="builtintype" id="3428245">error</span><span class="op" id="3428250">)</span>&nbsp;<span class="op" id="3428252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428255">var</span>&nbsp;<span class="ident" id="3428259">c</span>&nbsp;<span class="ident" id="3428261">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428271">c</span><span class="op" id="3428272">.</span><span class="ident" id="3428273">init</span><span class="op" id="3428277">(</span><span class="op" id="3428278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428281">f</span>&nbsp;<span class="op" id="3428283">:=</span>&nbsp;<span class="ident" id="3428286">c</span><span class="op" id="3428287">.</span><span class="ident" id="3428288">compile</span><span class="op" id="3428295">(</span><span class="ident" id="3428296">re</span><span class="op" id="3428298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428301">f</span><span class="op" id="3428302">.</span><span class="ident" id="3428303">out</span><span class="op" id="3428306">.</span><span class="ident" id="3428307">patch</span><span class="op" id="3428312">(</span><span class="ident" id="3428313">c</span><span class="op" id="3428314">.</span><span class="ident" id="3428315">p</span><span class="op" id="3428316">,</span>&nbsp;<span class="ident" id="3428318">c</span><span class="op" id="3428319">.</span><span class="ident" id="3428320">inst</span><span class="op" id="3428324">(</span><span class="ident" id="3428325">InstMatch</span><span class="op" id="3428334">)</span><span class="op" id="3428335">.</span><span class="ident" id="3428336">i</span><span class="op" id="3428337">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428340">c</span><span class="op" id="3428341">.</span><span class="ident" id="3428342">p</span><span class="op" id="3428343">.</span><span class="ident" id="3428344">Start</span>&nbsp;<span class="op" id="3428350">=</span>&nbsp;<span class="builtintype" id="3428352">int</span><span class="op" id="3428355">(</span><span class="ident" id="3428356">f</span><span class="op" id="3428357">.</span><span class="ident" id="3428358">i</span><span class="op" id="3428359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428362">return</span>&nbsp;<span class="ident" id="3428369">c</span><span class="op" id="3428370">.</span><span class="ident" id="3428371">p</span><span class="op" id="3428372">,</span>&nbsp;<span class="ident" id="3428374">nil</span><br>
<span class="lineno"></span><span class="op" id="3428378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3428381">func</span>&nbsp;<span class="op" id="3428386">(</span><span class="ident" id="3428387">c</span>&nbsp;<span class="op" id="3428389">*</span><span class="ident" id="3428390">compiler</span><span class="op" id="3428398">)</span>&nbsp;<span class="ident" id="3428400">init</span><span class="op" id="3428404">(</span><span class="op" id="3428405">)</span>&nbsp;<span class="op" id="3428407">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428410">c</span><span class="op" id="3428411">.</span><span class="ident" id="3428412">p</span>&nbsp;<span class="op" id="3428414">=</span>&nbsp;<span class="builtinfunc" id="3428416">new</span><span class="op" id="3428419">(</span><span class="ident" id="3428420">Prog</span><span class="op" id="3428424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428427">c</span><span class="op" id="3428428">.</span><span class="ident" id="3428429">p</span><span class="op" id="3428430">.</span><span class="ident" id="3428431">NumCap</span>&nbsp;<span class="op" id="3428438">=</span>&nbsp;<span class="num" id="3428440">2</span>&nbsp;<span class="comment" id="3428442">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428482">c</span><span class="op" id="3428483">.</span><span class="ident" id="3428484">inst</span><span class="op" id="3428488">(</span><span class="ident" id="3428489">InstFail</span><span class="op" id="3428497">)</span><br>
<span class="lineno"></span><span class="op" id="3428499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3428502">var</span>&nbsp;<span class="ident" id="3428506">anyRuneNotNL</span>&nbsp;<span class="op" id="3428519">=</span>&nbsp;<span class="op" id="3428521">[</span><span class="op" id="3428522">]</span><span class="builtintype" id="3428523">rune</span><span class="op" id="3428527">{</span><span class="num" id="3428528">0</span><span class="op" id="3428529">,</span>&nbsp;<span class="string" id="3428531">&#39;\n&#39;</span>&nbsp;<span class="op" id="3428536">-</span>&nbsp;<span class="num" id="3428538">1</span><span class="op" id="3428539">,</span>&nbsp;<span class="string" id="3428541">&#39;\n&#39;</span>&nbsp;<span class="op" id="3428546">+</span>&nbsp;<span class="num" id="3428548">1</span><span class="op" id="3428549">,</span>&nbsp;<span class="ident" id="3428551">unicode</span><span class="op" id="3428558">.</span><span class="ident" id="3428559">MaxRune</span><span class="op" id="3428566">}</span><br>
<span class="lineno"></span><span class="keyword" id="3428568">var</span>&nbsp;<span class="ident" id="3428572">anyRune</span>&nbsp;<span class="op" id="3428580">=</span>&nbsp;<span class="op" id="3428582">[</span><span class="op" id="3428583">]</span><span class="builtintype" id="3428584">rune</span><span class="op" id="3428588">{</span><span class="num" id="3428589">0</span><span class="op" id="3428590">,</span>&nbsp;<span class="ident" id="3428592">unicode</span><span class="op" id="3428599">.</span><span class="ident" id="3428600">MaxRune</span><span class="op" id="3428607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3428610">func</span>&nbsp;<span class="op" id="3428615">(</span><span class="ident" id="3428616">c</span>&nbsp;<span class="op" id="3428618">*</span><span class="ident" id="3428619">compiler</span><span class="op" id="3428627">)</span>&nbsp;<span class="ident" id="3428629">compile</span><span class="op" id="3428636">(</span><span class="ident" id="3428637">re</span>&nbsp;<span class="op" id="3428640">*</span><span class="ident" id="3428641">Regexp</span><span class="op" id="3428647">)</span>&nbsp;<span class="ident" id="3428649">frag</span>&nbsp;<span class="op" id="3428654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428657">switch</span>&nbsp;<span class="ident" id="3428664">re</span><span class="op" id="3428666">.</span><span class="ident" id="3428667">Op</span>&nbsp;<span class="op" id="3428670">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428673">case</span>&nbsp;<span class="ident" id="3428678">OpNoMatch</span><span class="op" id="3428687">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428691">return</span>&nbsp;<span class="ident" id="3428698">c</span><span class="op" id="3428699">.</span><span class="ident" id="3428700">fail</span><span class="op" id="3428704">(</span><span class="op" id="3428705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428708">case</span>&nbsp;<span class="ident" id="3428713">OpEmptyMatch</span><span class="op" id="3428725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428729">return</span>&nbsp;<span class="ident" id="3428736">c</span><span class="op" id="3428737">.</span><span class="ident" id="3428738">nop</span><span class="op" id="3428741">(</span><span class="op" id="3428742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428745">case</span>&nbsp;<span class="ident" id="3428750">OpLiteral</span><span class="op" id="3428759">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428763">if</span>&nbsp;<span class="builtinfunc" id="3428766">len</span><span class="op" id="3428769">(</span><span class="ident" id="3428770">re</span><span class="op" id="3428772">.</span><span class="ident" id="3428773">Rune</span><span class="op" id="3428777">)</span>&nbsp;<span class="op" id="3428779">==</span>&nbsp;<span class="num" id="3428782">0</span>&nbsp;<span class="op" id="3428784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428789">return</span>&nbsp;<span class="ident" id="3428796">c</span><span class="op" id="3428797">.</span><span class="ident" id="3428798">nop</span><span class="op" id="3428801">(</span><span class="op" id="3428802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428810">var</span>&nbsp;<span class="ident" id="3428814">f</span>&nbsp;<span class="ident" id="3428816">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428823">for</span>&nbsp;<span class="ident" id="3428827">j</span>&nbsp;<span class="op" id="3428829">:=</span>&nbsp;<span class="keyword" id="3428832">range</span>&nbsp;<span class="ident" id="3428838">re</span><span class="op" id="3428840">.</span><span class="ident" id="3428841">Rune</span>&nbsp;<span class="op" id="3428846">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428851">f1</span>&nbsp;<span class="op" id="3428854">:=</span>&nbsp;<span class="ident" id="3428857">c</span><span class="op" id="3428858">.</span><span class="builtintype" id="3428859">rune</span><span class="op" id="3428863">(</span><span class="ident" id="3428864">re</span><span class="op" id="3428866">.</span><span class="ident" id="3428867">Rune</span><span class="op" id="3428871">[</span><span class="ident" id="3428872">j</span><span class="op" id="3428873">:</span><span class="ident" id="3428874">j</span><span class="op" id="3428875">+</span><span class="num" id="3428876">1</span><span class="op" id="3428877">]</span><span class="op" id="3428878">,</span>&nbsp;<span class="ident" id="3428880">re</span><span class="op" id="3428882">.</span><span class="ident" id="3428883">Flags</span><span class="op" id="3428888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428893">if</span>&nbsp;<span class="ident" id="3428896">j</span>&nbsp;<span class="op" id="3428898">==</span>&nbsp;<span class="num" id="3428901">0</span>&nbsp;<span class="op" id="3428903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428909">f</span>&nbsp;<span class="op" id="3428911">=</span>&nbsp;<span class="ident" id="3428913">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428919">}</span>&nbsp;<span class="keyword" id="3428921">else</span>&nbsp;<span class="op" id="3428926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3428932">f</span>&nbsp;<span class="op" id="3428934">=</span>&nbsp;<span class="ident" id="3428936">c</span><span class="op" id="3428937">.</span><span class="ident" id="3428938">cat</span><span class="op" id="3428941">(</span><span class="ident" id="3428942">f</span><span class="op" id="3428943">,</span>&nbsp;<span class="ident" id="3428945">f1</span><span class="op" id="3428947">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3428956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428960">return</span>&nbsp;<span class="ident" id="3428967">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428970">case</span>&nbsp;<span class="ident" id="3428975">OpCharClass</span><span class="op" id="3428986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3428990">return</span>&nbsp;<span class="ident" id="3428997">c</span><span class="op" id="3428998">.</span><span class="builtintype" id="3428999">rune</span><span class="op" id="3429003">(</span><span class="ident" id="3429004">re</span><span class="op" id="3429006">.</span><span class="ident" id="3429007">Rune</span><span class="op" id="3429011">,</span>&nbsp;<span class="ident" id="3429013">re</span><span class="op" id="3429015">.</span><span class="ident" id="3429016">Flags</span><span class="op" id="3429021">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429024">case</span>&nbsp;<span class="ident" id="3429029">OpAnyCharNotNL</span><span class="op" id="3429043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429047">return</span>&nbsp;<span class="ident" id="3429054">c</span><span class="op" id="3429055">.</span><span class="builtintype" id="3429056">rune</span><span class="op" id="3429060">(</span><span class="ident" id="3429061">anyRuneNotNL</span><span class="op" id="3429073">,</span>&nbsp;<span class="num" id="3429075">0</span><span class="op" id="3429076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429079">case</span>&nbsp;<span class="ident" id="3429084">OpAnyChar</span><span class="op" id="3429093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429097">return</span>&nbsp;<span class="ident" id="3429104">c</span><span class="op" id="3429105">.</span><span class="builtintype" id="3429106">rune</span><span class="op" id="3429110">(</span><span class="ident" id="3429111">anyRune</span><span class="op" id="3429118">,</span>&nbsp;<span class="num" id="3429120">0</span><span class="op" id="3429121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429124">case</span>&nbsp;<span class="ident" id="3429129">OpBeginLine</span><span class="op" id="3429140">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429144">return</span>&nbsp;<span class="ident" id="3429151">c</span><span class="op" id="3429152">.</span><span class="ident" id="3429153">empty</span><span class="op" id="3429158">(</span><span class="ident" id="3429159">EmptyBeginLine</span><span class="op" id="3429173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429176">case</span>&nbsp;<span class="ident" id="3429181">OpEndLine</span><span class="op" id="3429190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429194">return</span>&nbsp;<span class="ident" id="3429201">c</span><span class="op" id="3429202">.</span><span class="ident" id="3429203">empty</span><span class="op" id="3429208">(</span><span class="ident" id="3429209">EmptyEndLine</span><span class="op" id="3429221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429224">case</span>&nbsp;<span class="ident" id="3429229">OpBeginText</span><span class="op" id="3429240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429244">return</span>&nbsp;<span class="ident" id="3429251">c</span><span class="op" id="3429252">.</span><span class="ident" id="3429253">empty</span><span class="op" id="3429258">(</span><span class="ident" id="3429259">EmptyBeginText</span><span class="op" id="3429273">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429276">case</span>&nbsp;<span class="ident" id="3429281">OpEndText</span><span class="op" id="3429290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429294">return</span>&nbsp;<span class="ident" id="3429301">c</span><span class="op" id="3429302">.</span><span class="ident" id="3429303">empty</span><span class="op" id="3429308">(</span><span class="ident" id="3429309">EmptyEndText</span><span class="op" id="3429321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429324">case</span>&nbsp;<span class="ident" id="3429329">OpWordBoundary</span><span class="op" id="3429343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429347">return</span>&nbsp;<span class="ident" id="3429354">c</span><span class="op" id="3429355">.</span><span class="ident" id="3429356">empty</span><span class="op" id="3429361">(</span><span class="ident" id="3429362">EmptyWordBoundary</span><span class="op" id="3429379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429382">case</span>&nbsp;<span class="ident" id="3429387">OpNoWordBoundary</span><span class="op" id="3429403">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429407">return</span>&nbsp;<span class="ident" id="3429414">c</span><span class="op" id="3429415">.</span><span class="ident" id="3429416">empty</span><span class="op" id="3429421">(</span><span class="ident" id="3429422">EmptyNoWordBoundary</span><span class="op" id="3429441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429444">case</span>&nbsp;<span class="ident" id="3429449">OpCapture</span><span class="op" id="3429458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429462">bra</span>&nbsp;<span class="op" id="3429466">:=</span>&nbsp;<span class="ident" id="3429469">c</span><span class="op" id="3429470">.</span><span class="builtinfunc" id="3429471">cap</span><span class="op" id="3429474">(</span><span class="builtintype" id="3429475">uint32</span><span class="op" id="3429481">(</span><span class="ident" id="3429482">re</span><span class="op" id="3429484">.</span><span class="ident" id="3429485">Cap</span>&nbsp;<span class="op" id="3429489">&lt;&lt;</span>&nbsp;<span class="num" id="3429492">1</span><span class="op" id="3429493">)</span><span class="op" id="3429494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429498">sub</span>&nbsp;<span class="op" id="3429502">:=</span>&nbsp;<span class="ident" id="3429505">c</span><span class="op" id="3429506">.</span><span class="ident" id="3429507">compile</span><span class="op" id="3429514">(</span><span class="ident" id="3429515">re</span><span class="op" id="3429517">.</span><span class="ident" id="3429518">Sub</span><span class="op" id="3429521">[</span><span class="num" id="3429522">0</span><span class="op" id="3429523">]</span><span class="op" id="3429524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429528">ket</span>&nbsp;<span class="op" id="3429532">:=</span>&nbsp;<span class="ident" id="3429535">c</span><span class="op" id="3429536">.</span><span class="builtinfunc" id="3429537">cap</span><span class="op" id="3429540">(</span><span class="builtintype" id="3429541">uint32</span><span class="op" id="3429547">(</span><span class="ident" id="3429548">re</span><span class="op" id="3429550">.</span><span class="ident" id="3429551">Cap</span><span class="op" id="3429554">&lt;&lt;</span><span class="num" id="3429556">1</span>&nbsp;<span class="op" id="3429558">|</span>&nbsp;<span class="num" id="3429560">1</span><span class="op" id="3429561">)</span><span class="op" id="3429562">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429566">return</span>&nbsp;<span class="ident" id="3429573">c</span><span class="op" id="3429574">.</span><span class="ident" id="3429575">cat</span><span class="op" id="3429578">(</span><span class="ident" id="3429579">c</span><span class="op" id="3429580">.</span><span class="ident" id="3429581">cat</span><span class="op" id="3429584">(</span><span class="ident" id="3429585">bra</span><span class="op" id="3429588">,</span>&nbsp;<span class="ident" id="3429590">sub</span><span class="op" id="3429593">)</span><span class="op" id="3429594">,</span>&nbsp;<span class="ident" id="3429596">ket</span><span class="op" id="3429599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429602">case</span>&nbsp;<span class="ident" id="3429607">OpStar</span><span class="op" id="3429613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429617">return</span>&nbsp;<span class="ident" id="3429624">c</span><span class="op" id="3429625">.</span><span class="ident" id="3429626">star</span><span class="op" id="3429630">(</span><span class="ident" id="3429631">c</span><span class="op" id="3429632">.</span><span class="ident" id="3429633">compile</span><span class="op" id="3429640">(</span><span class="ident" id="3429641">re</span><span class="op" id="3429643">.</span><span class="ident" id="3429644">Sub</span><span class="op" id="3429647">[</span><span class="num" id="3429648">0</span><span class="op" id="3429649">]</span><span class="op" id="3429650">)</span><span class="op" id="3429651">,</span>&nbsp;<span class="ident" id="3429653">re</span><span class="op" id="3429655">.</span><span class="ident" id="3429656">Flags</span><span class="op" id="3429661">&amp;</span><span class="ident" id="3429662">NonGreedy</span>&nbsp;<span class="op" id="3429672">!=</span>&nbsp;<span class="num" id="3429675">0</span><span class="op" id="3429676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429679">case</span>&nbsp;<span class="ident" id="3429684">OpPlus</span><span class="op" id="3429690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429694">return</span>&nbsp;<span class="ident" id="3429701">c</span><span class="op" id="3429702">.</span><span class="ident" id="3429703">plus</span><span class="op" id="3429707">(</span><span class="ident" id="3429708">c</span><span class="op" id="3429709">.</span><span class="ident" id="3429710">compile</span><span class="op" id="3429717">(</span><span class="ident" id="3429718">re</span><span class="op" id="3429720">.</span><span class="ident" id="3429721">Sub</span><span class="op" id="3429724">[</span><span class="num" id="3429725">0</span><span class="op" id="3429726">]</span><span class="op" id="3429727">)</span><span class="op" id="3429728">,</span>&nbsp;<span class="ident" id="3429730">re</span><span class="op" id="3429732">.</span><span class="ident" id="3429733">Flags</span><span class="op" id="3429738">&amp;</span><span class="ident" id="3429739">NonGreedy</span>&nbsp;<span class="op" id="3429749">!=</span>&nbsp;<span class="num" id="3429752">0</span><span class="op" id="3429753">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429756">case</span>&nbsp;<span class="ident" id="3429761">OpQuest</span><span class="op" id="3429768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429772">return</span>&nbsp;<span class="ident" id="3429779">c</span><span class="op" id="3429780">.</span><span class="ident" id="3429781">quest</span><span class="op" id="3429786">(</span><span class="ident" id="3429787">c</span><span class="op" id="3429788">.</span><span class="ident" id="3429789">compile</span><span class="op" id="3429796">(</span><span class="ident" id="3429797">re</span><span class="op" id="3429799">.</span><span class="ident" id="3429800">Sub</span><span class="op" id="3429803">[</span><span class="num" id="3429804">0</span><span class="op" id="3429805">]</span><span class="op" id="3429806">)</span><span class="op" id="3429807">,</span>&nbsp;<span class="ident" id="3429809">re</span><span class="op" id="3429811">.</span><span class="ident" id="3429812">Flags</span><span class="op" id="3429817">&amp;</span><span class="ident" id="3429818">NonGreedy</span>&nbsp;<span class="op" id="3429828">!=</span>&nbsp;<span class="num" id="3429831">0</span><span class="op" id="3429832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429835">case</span>&nbsp;<span class="ident" id="3429840">OpConcat</span><span class="op" id="3429848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429852">if</span>&nbsp;<span class="builtinfunc" id="3429855">len</span><span class="op" id="3429858">(</span><span class="ident" id="3429859">re</span><span class="op" id="3429861">.</span><span class="ident" id="3429862">Sub</span><span class="op" id="3429865">)</span>&nbsp;<span class="op" id="3429867">==</span>&nbsp;<span class="num" id="3429870">0</span>&nbsp;<span class="op" id="3429872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429877">return</span>&nbsp;<span class="ident" id="3429884">c</span><span class="op" id="3429885">.</span><span class="ident" id="3429886">nop</span><span class="op" id="3429889">(</span><span class="op" id="3429890">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429898">var</span>&nbsp;<span class="ident" id="3429902">f</span>&nbsp;<span class="ident" id="3429904">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429911">for</span>&nbsp;<span class="ident" id="3429915">i</span><span class="op" id="3429916">,</span>&nbsp;<span class="ident" id="3429918">sub</span>&nbsp;<span class="op" id="3429922">:=</span>&nbsp;<span class="keyword" id="3429925">range</span>&nbsp;<span class="ident" id="3429931">re</span><span class="op" id="3429933">.</span><span class="ident" id="3429934">Sub</span>&nbsp;<span class="op" id="3429938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3429943">if</span>&nbsp;<span class="ident" id="3429946">i</span>&nbsp;<span class="op" id="3429948">==</span>&nbsp;<span class="num" id="3429951">0</span>&nbsp;<span class="op" id="3429953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429959">f</span>&nbsp;<span class="op" id="3429961">=</span>&nbsp;<span class="ident" id="3429963">c</span><span class="op" id="3429964">.</span><span class="ident" id="3429965">compile</span><span class="op" id="3429972">(</span><span class="ident" id="3429973">sub</span><span class="op" id="3429976">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3429981">}</span>&nbsp;<span class="keyword" id="3429983">else</span>&nbsp;<span class="op" id="3429988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3429994">f</span>&nbsp;<span class="op" id="3429996">=</span>&nbsp;<span class="ident" id="3429998">c</span><span class="op" id="3429999">.</span><span class="ident" id="3430000">cat</span><span class="op" id="3430003">(</span><span class="ident" id="3430004">f</span><span class="op" id="3430005">,</span>&nbsp;<span class="ident" id="3430007">c</span><span class="op" id="3430008">.</span><span class="ident" id="3430009">compile</span><span class="op" id="3430016">(</span><span class="ident" id="3430017">sub</span><span class="op" id="3430020">)</span><span class="op" id="3430021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430034">return</span>&nbsp;<span class="ident" id="3430041">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430044">case</span>&nbsp;<span class="ident" id="3430049">OpAlternate</span><span class="op" id="3430060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430064">var</span>&nbsp;<span class="ident" id="3430068">f</span>&nbsp;<span class="ident" id="3430070">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430077">for</span>&nbsp;<span class="ident" id="3430081">_</span><span class="op" id="3430082">,</span>&nbsp;<span class="ident" id="3430084">sub</span>&nbsp;<span class="op" id="3430088">:=</span>&nbsp;<span class="keyword" id="3430091">range</span>&nbsp;<span class="ident" id="3430097">re</span><span class="op" id="3430099">.</span><span class="ident" id="3430100">Sub</span>&nbsp;<span class="op" id="3430104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430109">f</span>&nbsp;<span class="op" id="3430111">=</span>&nbsp;<span class="ident" id="3430113">c</span><span class="op" id="3430114">.</span><span class="ident" id="3430115">alt</span><span class="op" id="3430118">(</span><span class="ident" id="3430119">f</span><span class="op" id="3430120">,</span>&nbsp;<span class="ident" id="3430122">c</span><span class="op" id="3430123">.</span><span class="ident" id="3430124">compile</span><span class="op" id="3430131">(</span><span class="ident" id="3430132">sub</span><span class="op" id="3430135">)</span><span class="op" id="3430136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430140">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430144">return</span>&nbsp;<span class="ident" id="3430151">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3430157">panic</span><span class="op" id="3430162">(</span><span class="string" id="3430163">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="3430198">)</span><br>
<span class="lineno"></span><span class="op" id="3430200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3430203">func</span>&nbsp;<span class="op" id="3430208">(</span><span class="ident" id="3430209">c</span>&nbsp;<span class="op" id="3430211">*</span><span class="ident" id="3430212">compiler</span><span class="op" id="3430220">)</span>&nbsp;<span class="ident" id="3430222">inst</span><span class="op" id="3430226">(</span><span class="ident" id="3430227">op</span>&nbsp;<span class="ident" id="3430230">InstOp</span><span class="op" id="3430236">)</span>&nbsp;<span class="ident" id="3430238">frag</span>&nbsp;<span class="op" id="3430243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430246">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430276">f</span>&nbsp;<span class="op" id="3430278">:=</span>&nbsp;<span class="ident" id="3430281">frag</span><span class="op" id="3430285">{</span><span class="ident" id="3430286">i</span><span class="op" id="3430287">:</span>&nbsp;<span class="builtintype" id="3430289">uint32</span><span class="op" id="3430295">(</span><span class="builtinfunc" id="3430296">len</span><span class="op" id="3430299">(</span><span class="ident" id="3430300">c</span><span class="op" id="3430301">.</span><span class="ident" id="3430302">p</span><span class="op" id="3430303">.</span><span class="ident" id="3430304">Inst</span><span class="op" id="3430308">)</span><span class="op" id="3430309">)</span><span class="op" id="3430310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430313">c</span><span class="op" id="3430314">.</span><span class="ident" id="3430315">p</span><span class="op" id="3430316">.</span><span class="ident" id="3430317">Inst</span>&nbsp;<span class="op" id="3430322">=</span>&nbsp;<span class="builtinfunc" id="3430324">append</span><span class="op" id="3430330">(</span><span class="ident" id="3430331">c</span><span class="op" id="3430332">.</span><span class="ident" id="3430333">p</span><span class="op" id="3430334">.</span><span class="ident" id="3430335">Inst</span><span class="op" id="3430339">,</span>&nbsp;<span class="ident" id="3430341">Inst</span><span class="op" id="3430345">{</span><span class="ident" id="3430346">Op</span><span class="op" id="3430348">:</span>&nbsp;<span class="ident" id="3430350">op</span><span class="op" id="3430352">}</span><span class="op" id="3430353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430356">return</span>&nbsp;<span class="ident" id="3430363">f</span><br>
<span class="lineno">175</span><span class="op" id="3430365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430368">func</span>&nbsp;<span class="op" id="3430373">(</span><span class="ident" id="3430374">c</span>&nbsp;<span class="op" id="3430376">*</span><span class="ident" id="3430377">compiler</span><span class="op" id="3430385">)</span>&nbsp;<span class="ident" id="3430387">nop</span><span class="op" id="3430390">(</span><span class="op" id="3430391">)</span>&nbsp;<span class="ident" id="3430393">frag</span>&nbsp;<span class="op" id="3430398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430401">f</span>&nbsp;<span class="op" id="3430403">:=</span>&nbsp;<span class="ident" id="3430406">c</span><span class="op" id="3430407">.</span><span class="ident" id="3430408">inst</span><span class="op" id="3430412">(</span><span class="ident" id="3430413">InstNop</span><span class="op" id="3430420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430423">f</span><span class="op" id="3430424">.</span><span class="ident" id="3430425">out</span>&nbsp;<span class="op" id="3430429">=</span>&nbsp;<span class="ident" id="3430431">patchList</span><span class="op" id="3430440">(</span><span class="ident" id="3430441">f</span><span class="op" id="3430442">.</span><span class="ident" id="3430443">i</span>&nbsp;<span class="op" id="3430445">&lt;&lt;</span>&nbsp;<span class="num" id="3430448">1</span><span class="op" id="3430449">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430452">return</span>&nbsp;<span class="ident" id="3430459">f</span><br>
<span class="lineno"></span><span class="op" id="3430461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430464">func</span>&nbsp;<span class="op" id="3430469">(</span><span class="ident" id="3430470">c</span>&nbsp;<span class="op" id="3430472">*</span><span class="ident" id="3430473">compiler</span><span class="op" id="3430481">)</span>&nbsp;<span class="ident" id="3430483">fail</span><span class="op" id="3430487">(</span><span class="op" id="3430488">)</span>&nbsp;<span class="ident" id="3430490">frag</span>&nbsp;<span class="op" id="3430495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430498">return</span>&nbsp;<span class="ident" id="3430505">frag</span><span class="op" id="3430509">{</span><span class="op" id="3430510">}</span><br>
<span class="lineno">185</span><span class="op" id="3430512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430515">func</span>&nbsp;<span class="op" id="3430520">(</span><span class="ident" id="3430521">c</span>&nbsp;<span class="op" id="3430523">*</span><span class="ident" id="3430524">compiler</span><span class="op" id="3430532">)</span>&nbsp;<span class="builtinfunc" id="3430534">cap</span><span class="op" id="3430537">(</span><span class="ident" id="3430538">arg</span>&nbsp;<span class="builtintype" id="3430542">uint32</span><span class="op" id="3430548">)</span>&nbsp;<span class="ident" id="3430550">frag</span>&nbsp;<span class="op" id="3430555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430558">f</span>&nbsp;<span class="op" id="3430560">:=</span>&nbsp;<span class="ident" id="3430563">c</span><span class="op" id="3430564">.</span><span class="ident" id="3430565">inst</span><span class="op" id="3430569">(</span><span class="ident" id="3430570">InstCapture</span><span class="op" id="3430581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430584">f</span><span class="op" id="3430585">.</span><span class="ident" id="3430586">out</span>&nbsp;<span class="op" id="3430590">=</span>&nbsp;<span class="ident" id="3430592">patchList</span><span class="op" id="3430601">(</span><span class="ident" id="3430602">f</span><span class="op" id="3430603">.</span><span class="ident" id="3430604">i</span>&nbsp;<span class="op" id="3430606">&lt;&lt;</span>&nbsp;<span class="num" id="3430609">1</span><span class="op" id="3430610">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430613">c</span><span class="op" id="3430614">.</span><span class="ident" id="3430615">p</span><span class="op" id="3430616">.</span><span class="ident" id="3430617">Inst</span><span class="op" id="3430621">[</span><span class="ident" id="3430622">f</span><span class="op" id="3430623">.</span><span class="ident" id="3430624">i</span><span class="op" id="3430625">]</span><span class="op" id="3430626">.</span><span class="ident" id="3430627">Arg</span>&nbsp;<span class="op" id="3430631">=</span>&nbsp;<span class="ident" id="3430633">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430639">if</span>&nbsp;<span class="ident" id="3430642">c</span><span class="op" id="3430643">.</span><span class="ident" id="3430644">p</span><span class="op" id="3430645">.</span><span class="ident" id="3430646">NumCap</span>&nbsp;<span class="op" id="3430653">&lt;</span>&nbsp;<span class="builtintype" id="3430655">int</span><span class="op" id="3430658">(</span><span class="ident" id="3430659">arg</span><span class="op" id="3430662">)</span><span class="op" id="3430663">+</span><span class="num" id="3430664">1</span>&nbsp;<span class="op" id="3430666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430670">c</span><span class="op" id="3430671">.</span><span class="ident" id="3430672">p</span><span class="op" id="3430673">.</span><span class="ident" id="3430674">NumCap</span>&nbsp;<span class="op" id="3430681">=</span>&nbsp;<span class="builtintype" id="3430683">int</span><span class="op" id="3430686">(</span><span class="ident" id="3430687">arg</span><span class="op" id="3430690">)</span>&nbsp;<span class="op" id="3430692">+</span>&nbsp;<span class="num" id="3430694">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430697">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430700">return</span>&nbsp;<span class="ident" id="3430707">f</span><br>
<span class="lineno"></span><span class="op" id="3430709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3430712">func</span>&nbsp;<span class="op" id="3430717">(</span><span class="ident" id="3430718">c</span>&nbsp;<span class="op" id="3430720">*</span><span class="ident" id="3430721">compiler</span><span class="op" id="3430729">)</span>&nbsp;<span class="ident" id="3430731">cat</span><span class="op" id="3430734">(</span><span class="ident" id="3430735">f1</span><span class="op" id="3430737">,</span>&nbsp;<span class="ident" id="3430739">f2</span>&nbsp;<span class="ident" id="3430742">frag</span><span class="op" id="3430746">)</span>&nbsp;<span class="ident" id="3430748">frag</span>&nbsp;<span class="op" id="3430753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430756">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430789">if</span>&nbsp;<span class="ident" id="3430792">f1</span><span class="op" id="3430794">.</span><span class="ident" id="3430795">i</span>&nbsp;<span class="op" id="3430797">==</span>&nbsp;<span class="num" id="3430800">0</span>&nbsp;<span class="op" id="3430802">||</span>&nbsp;<span class="ident" id="3430805">f2</span><span class="op" id="3430807">.</span><span class="ident" id="3430808">i</span>&nbsp;<span class="op" id="3430810">==</span>&nbsp;<span class="num" id="3430813">0</span>&nbsp;<span class="op" id="3430815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430819">return</span>&nbsp;<span class="ident" id="3430826">frag</span><span class="op" id="3430830">{</span><span class="op" id="3430831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3430834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430838">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3430859">f1</span><span class="op" id="3430861">.</span><span class="ident" id="3430862">out</span><span class="op" id="3430865">.</span><span class="ident" id="3430866">patch</span><span class="op" id="3430871">(</span><span class="ident" id="3430872">c</span><span class="op" id="3430873">.</span><span class="ident" id="3430874">p</span><span class="op" id="3430875">,</span>&nbsp;<span class="ident" id="3430877">f2</span><span class="op" id="3430879">.</span><span class="ident" id="3430880">i</span><span class="op" id="3430881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430884">return</span>&nbsp;<span class="ident" id="3430891">frag</span><span class="op" id="3430895">{</span><span class="ident" id="3430896">f1</span><span class="op" id="3430898">.</span><span class="ident" id="3430899">i</span><span class="op" id="3430900">,</span>&nbsp;<span class="ident" id="3430902">f2</span><span class="op" id="3430904">.</span><span class="ident" id="3430905">out</span><span class="op" id="3430908">}</span><br>
<span class="lineno"></span><span class="op" id="3430910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3430913">func</span>&nbsp;<span class="op" id="3430918">(</span><span class="ident" id="3430919">c</span>&nbsp;<span class="op" id="3430921">*</span><span class="ident" id="3430922">compiler</span><span class="op" id="3430930">)</span>&nbsp;<span class="ident" id="3430932">alt</span><span class="op" id="3430935">(</span><span class="ident" id="3430936">f1</span><span class="op" id="3430938">,</span>&nbsp;<span class="ident" id="3430940">f2</span>&nbsp;<span class="ident" id="3430943">frag</span><span class="op" id="3430947">)</span>&nbsp;<span class="ident" id="3430949">frag</span>&nbsp;<span class="op" id="3430954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3430957">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3430985">if</span>&nbsp;<span class="ident" id="3430988">f1</span><span class="op" id="3430990">.</span><span class="ident" id="3430991">i</span>&nbsp;<span class="op" id="3430993">==</span>&nbsp;<span class="num" id="3430996">0</span>&nbsp;<span class="op" id="3430998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431002">return</span>&nbsp;<span class="ident" id="3431009">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431013">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431016">if</span>&nbsp;<span class="ident" id="3431019">f2</span><span class="op" id="3431021">.</span><span class="ident" id="3431022">i</span>&nbsp;<span class="op" id="3431024">==</span>&nbsp;<span class="num" id="3431027">0</span>&nbsp;<span class="op" id="3431029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431033">return</span>&nbsp;<span class="ident" id="3431040">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431048">f</span>&nbsp;<span class="op" id="3431050">:=</span>&nbsp;<span class="ident" id="3431053">c</span><span class="op" id="3431054">.</span><span class="ident" id="3431055">inst</span><span class="op" id="3431059">(</span><span class="ident" id="3431060">InstAlt</span><span class="op" id="3431067">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431070">i</span>&nbsp;<span class="op" id="3431072">:=</span>&nbsp;<span class="op" id="3431075">&amp;</span><span class="ident" id="3431076">c</span><span class="op" id="3431077">.</span><span class="ident" id="3431078">p</span><span class="op" id="3431079">.</span><span class="ident" id="3431080">Inst</span><span class="op" id="3431084">[</span><span class="ident" id="3431085">f</span><span class="op" id="3431086">.</span><span class="ident" id="3431087">i</span><span class="op" id="3431088">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431091">i</span><span class="op" id="3431092">.</span><span class="ident" id="3431093">Out</span>&nbsp;<span class="op" id="3431097">=</span>&nbsp;<span class="ident" id="3431099">f1</span><span class="op" id="3431101">.</span><span class="ident" id="3431102">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431105">i</span><span class="op" id="3431106">.</span><span class="ident" id="3431107">Arg</span>&nbsp;<span class="op" id="3431111">=</span>&nbsp;<span class="ident" id="3431113">f2</span><span class="op" id="3431115">.</span><span class="ident" id="3431116">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431119">f</span><span class="op" id="3431120">.</span><span class="ident" id="3431121">out</span>&nbsp;<span class="op" id="3431125">=</span>&nbsp;<span class="ident" id="3431127">f1</span><span class="op" id="3431129">.</span><span class="ident" id="3431130">out</span><span class="op" id="3431133">.</span><span class="builtinfunc" id="3431134">append</span><span class="op" id="3431140">(</span><span class="ident" id="3431141">c</span><span class="op" id="3431142">.</span><span class="ident" id="3431143">p</span><span class="op" id="3431144">,</span>&nbsp;<span class="ident" id="3431146">f2</span><span class="op" id="3431148">.</span><span class="ident" id="3431149">out</span><span class="op" id="3431152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431155">return</span>&nbsp;<span class="ident" id="3431162">f</span><br>
<span class="lineno">225</span><span class="op" id="3431164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3431167">func</span>&nbsp;<span class="op" id="3431172">(</span><span class="ident" id="3431173">c</span>&nbsp;<span class="op" id="3431175">*</span><span class="ident" id="3431176">compiler</span><span class="op" id="3431184">)</span>&nbsp;<span class="ident" id="3431186">quest</span><span class="op" id="3431191">(</span><span class="ident" id="3431192">f1</span>&nbsp;<span class="ident" id="3431195">frag</span><span class="op" id="3431199">,</span>&nbsp;<span class="ident" id="3431201">nongreedy</span>&nbsp;<span class="builtintype" id="3431211">bool</span><span class="op" id="3431215">)</span>&nbsp;<span class="ident" id="3431217">frag</span>&nbsp;<span class="op" id="3431222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431225">f</span>&nbsp;<span class="op" id="3431227">:=</span>&nbsp;<span class="ident" id="3431230">c</span><span class="op" id="3431231">.</span><span class="ident" id="3431232">inst</span><span class="op" id="3431236">(</span><span class="ident" id="3431237">InstAlt</span><span class="op" id="3431244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431247">i</span>&nbsp;<span class="op" id="3431249">:=</span>&nbsp;<span class="op" id="3431252">&amp;</span><span class="ident" id="3431253">c</span><span class="op" id="3431254">.</span><span class="ident" id="3431255">p</span><span class="op" id="3431256">.</span><span class="ident" id="3431257">Inst</span><span class="op" id="3431261">[</span><span class="ident" id="3431262">f</span><span class="op" id="3431263">.</span><span class="ident" id="3431264">i</span><span class="op" id="3431265">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431268">if</span>&nbsp;<span class="ident" id="3431271">nongreedy</span>&nbsp;<span class="op" id="3431281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431285">i</span><span class="op" id="3431286">.</span><span class="ident" id="3431287">Arg</span>&nbsp;<span class="op" id="3431291">=</span>&nbsp;<span class="ident" id="3431293">f1</span><span class="op" id="3431295">.</span><span class="ident" id="3431296">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431300">f</span><span class="op" id="3431301">.</span><span class="ident" id="3431302">out</span>&nbsp;<span class="op" id="3431306">=</span>&nbsp;<span class="ident" id="3431308">patchList</span><span class="op" id="3431317">(</span><span class="ident" id="3431318">f</span><span class="op" id="3431319">.</span><span class="ident" id="3431320">i</span>&nbsp;<span class="op" id="3431322">&lt;&lt;</span>&nbsp;<span class="num" id="3431325">1</span><span class="op" id="3431326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431329">}</span>&nbsp;<span class="keyword" id="3431331">else</span>&nbsp;<span class="op" id="3431336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431340">i</span><span class="op" id="3431341">.</span><span class="ident" id="3431342">Out</span>&nbsp;<span class="op" id="3431346">=</span>&nbsp;<span class="ident" id="3431348">f1</span><span class="op" id="3431350">.</span><span class="ident" id="3431351">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431355">f</span><span class="op" id="3431356">.</span><span class="ident" id="3431357">out</span>&nbsp;<span class="op" id="3431361">=</span>&nbsp;<span class="ident" id="3431363">patchList</span><span class="op" id="3431372">(</span><span class="ident" id="3431373">f</span><span class="op" id="3431374">.</span><span class="ident" id="3431375">i</span><span class="op" id="3431376">&lt;&lt;</span><span class="num" id="3431378">1</span>&nbsp;<span class="op" id="3431380">|</span>&nbsp;<span class="num" id="3431382">1</span><span class="op" id="3431383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431389">f</span><span class="op" id="3431390">.</span><span class="ident" id="3431391">out</span>&nbsp;<span class="op" id="3431395">=</span>&nbsp;<span class="ident" id="3431397">f</span><span class="op" id="3431398">.</span><span class="ident" id="3431399">out</span><span class="op" id="3431402">.</span><span class="builtinfunc" id="3431403">append</span><span class="op" id="3431409">(</span><span class="ident" id="3431410">c</span><span class="op" id="3431411">.</span><span class="ident" id="3431412">p</span><span class="op" id="3431413">,</span>&nbsp;<span class="ident" id="3431415">f1</span><span class="op" id="3431417">.</span><span class="ident" id="3431418">out</span><span class="op" id="3431421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431424">return</span>&nbsp;<span class="ident" id="3431431">f</span><br>
<span class="lineno"></span><span class="op" id="3431433">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="3431436">func</span>&nbsp;<span class="op" id="3431441">(</span><span class="ident" id="3431442">c</span>&nbsp;<span class="op" id="3431444">*</span><span class="ident" id="3431445">compiler</span><span class="op" id="3431453">)</span>&nbsp;<span class="ident" id="3431455">star</span><span class="op" id="3431459">(</span><span class="ident" id="3431460">f1</span>&nbsp;<span class="ident" id="3431463">frag</span><span class="op" id="3431467">,</span>&nbsp;<span class="ident" id="3431469">nongreedy</span>&nbsp;<span class="builtintype" id="3431479">bool</span><span class="op" id="3431483">)</span>&nbsp;<span class="ident" id="3431485">frag</span>&nbsp;<span class="op" id="3431490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431493">f</span>&nbsp;<span class="op" id="3431495">:=</span>&nbsp;<span class="ident" id="3431498">c</span><span class="op" id="3431499">.</span><span class="ident" id="3431500">inst</span><span class="op" id="3431504">(</span><span class="ident" id="3431505">InstAlt</span><span class="op" id="3431512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431515">i</span>&nbsp;<span class="op" id="3431517">:=</span>&nbsp;<span class="op" id="3431520">&amp;</span><span class="ident" id="3431521">c</span><span class="op" id="3431522">.</span><span class="ident" id="3431523">p</span><span class="op" id="3431524">.</span><span class="ident" id="3431525">Inst</span><span class="op" id="3431529">[</span><span class="ident" id="3431530">f</span><span class="op" id="3431531">.</span><span class="ident" id="3431532">i</span><span class="op" id="3431533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431536">if</span>&nbsp;<span class="ident" id="3431539">nongreedy</span>&nbsp;<span class="op" id="3431549">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431553">i</span><span class="op" id="3431554">.</span><span class="ident" id="3431555">Arg</span>&nbsp;<span class="op" id="3431559">=</span>&nbsp;<span class="ident" id="3431561">f1</span><span class="op" id="3431563">.</span><span class="ident" id="3431564">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431568">f</span><span class="op" id="3431569">.</span><span class="ident" id="3431570">out</span>&nbsp;<span class="op" id="3431574">=</span>&nbsp;<span class="ident" id="3431576">patchList</span><span class="op" id="3431585">(</span><span class="ident" id="3431586">f</span><span class="op" id="3431587">.</span><span class="ident" id="3431588">i</span>&nbsp;<span class="op" id="3431590">&lt;&lt;</span>&nbsp;<span class="num" id="3431593">1</span><span class="op" id="3431594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431597">}</span>&nbsp;<span class="keyword" id="3431599">else</span>&nbsp;<span class="op" id="3431604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431608">i</span><span class="op" id="3431609">.</span><span class="ident" id="3431610">Out</span>&nbsp;<span class="op" id="3431614">=</span>&nbsp;<span class="ident" id="3431616">f1</span><span class="op" id="3431618">.</span><span class="ident" id="3431619">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431623">f</span><span class="op" id="3431624">.</span><span class="ident" id="3431625">out</span>&nbsp;<span class="op" id="3431629">=</span>&nbsp;<span class="ident" id="3431631">patchList</span><span class="op" id="3431640">(</span><span class="ident" id="3431641">f</span><span class="op" id="3431642">.</span><span class="ident" id="3431643">i</span><span class="op" id="3431644">&lt;&lt;</span><span class="num" id="3431646">1</span>&nbsp;<span class="op" id="3431648">|</span>&nbsp;<span class="num" id="3431650">1</span><span class="op" id="3431651">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3431654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431657">f1</span><span class="op" id="3431659">.</span><span class="ident" id="3431660">out</span><span class="op" id="3431663">.</span><span class="ident" id="3431664">patch</span><span class="op" id="3431669">(</span><span class="ident" id="3431670">c</span><span class="op" id="3431671">.</span><span class="ident" id="3431672">p</span><span class="op" id="3431673">,</span>&nbsp;<span class="ident" id="3431675">f</span><span class="op" id="3431676">.</span><span class="ident" id="3431677">i</span><span class="op" id="3431678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431681">return</span>&nbsp;<span class="ident" id="3431688">f</span><br>
<span class="lineno"></span><span class="op" id="3431690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3431693">func</span>&nbsp;<span class="op" id="3431698">(</span><span class="ident" id="3431699">c</span>&nbsp;<span class="op" id="3431701">*</span><span class="ident" id="3431702">compiler</span><span class="op" id="3431710">)</span>&nbsp;<span class="ident" id="3431712">plus</span><span class="op" id="3431716">(</span><span class="ident" id="3431717">f1</span>&nbsp;<span class="ident" id="3431720">frag</span><span class="op" id="3431724">,</span>&nbsp;<span class="ident" id="3431726">nongreedy</span>&nbsp;<span class="builtintype" id="3431736">bool</span><span class="op" id="3431740">)</span>&nbsp;<span class="ident" id="3431742">frag</span>&nbsp;<span class="op" id="3431747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431750">return</span>&nbsp;<span class="ident" id="3431757">frag</span><span class="op" id="3431761">{</span><span class="ident" id="3431762">f1</span><span class="op" id="3431764">.</span><span class="ident" id="3431765">i</span><span class="op" id="3431766">,</span>&nbsp;<span class="ident" id="3431768">c</span><span class="op" id="3431769">.</span><span class="ident" id="3431770">star</span><span class="op" id="3431774">(</span><span class="ident" id="3431775">f1</span><span class="op" id="3431777">,</span>&nbsp;<span class="ident" id="3431779">nongreedy</span><span class="op" id="3431788">)</span><span class="op" id="3431789">.</span><span class="ident" id="3431790">out</span><span class="op" id="3431793">}</span><br>
<span class="lineno"></span><span class="op" id="3431795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3431798">func</span>&nbsp;<span class="op" id="3431803">(</span><span class="ident" id="3431804">c</span>&nbsp;<span class="op" id="3431806">*</span><span class="ident" id="3431807">compiler</span><span class="op" id="3431815">)</span>&nbsp;<span class="ident" id="3431817">empty</span><span class="op" id="3431822">(</span><span class="ident" id="3431823">op</span>&nbsp;<span class="ident" id="3431826">EmptyOp</span><span class="op" id="3431833">)</span>&nbsp;<span class="ident" id="3431835">frag</span>&nbsp;<span class="op" id="3431840">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431843">f</span>&nbsp;<span class="op" id="3431845">:=</span>&nbsp;<span class="ident" id="3431848">c</span><span class="op" id="3431849">.</span><span class="ident" id="3431850">inst</span><span class="op" id="3431854">(</span><span class="ident" id="3431855">InstEmptyWidth</span><span class="op" id="3431869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431872">c</span><span class="op" id="3431873">.</span><span class="ident" id="3431874">p</span><span class="op" id="3431875">.</span><span class="ident" id="3431876">Inst</span><span class="op" id="3431880">[</span><span class="ident" id="3431881">f</span><span class="op" id="3431882">.</span><span class="ident" id="3431883">i</span><span class="op" id="3431884">]</span><span class="op" id="3431885">.</span><span class="ident" id="3431886">Arg</span>&nbsp;<span class="op" id="3431890">=</span>&nbsp;<span class="builtintype" id="3431892">uint32</span><span class="op" id="3431898">(</span><span class="ident" id="3431899">op</span><span class="op" id="3431901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3431904">f</span><span class="op" id="3431905">.</span><span class="ident" id="3431906">out</span>&nbsp;<span class="op" id="3431910">=</span>&nbsp;<span class="ident" id="3431912">patchList</span><span class="op" id="3431921">(</span><span class="ident" id="3431922">f</span><span class="op" id="3431923">.</span><span class="ident" id="3431924">i</span>&nbsp;<span class="op" id="3431926">&lt;&lt;</span>&nbsp;<span class="num" id="3431929">1</span><span class="op" id="3431930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3431933">return</span>&nbsp;<span class="ident" id="3431940">f</span><br>
<span class="lineno"></span><span class="op" id="3431942">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="3431945">func</span>&nbsp;<span class="op" id="3431950">(</span><span class="ident" id="3431951">c</span>&nbsp;<span class="op" id="3431953">*</span><span class="ident" id="3431954">compiler</span><span class="op" id="3431962">)</span>&nbsp;<span class="builtintype" id="3431964">rune</span><span class="op" id="3431968">(</span><span class="ident" id="3431969">r</span>&nbsp;<span class="op" id="3431971">[</span><span class="op" id="3431972">]</span><span class="builtintype" id="3431973">rune</span><span class="op" id="3431977">,</span>&nbsp;<span class="ident" id="3431979">flags</span>&nbsp;<span class="ident" id="3431985">Flags</span><span class="op" id="3431990">)</span>&nbsp;<span class="ident" id="3431992">frag</span>&nbsp;<span class="op" id="3431997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432000">f</span>&nbsp;<span class="op" id="3432002">:=</span>&nbsp;<span class="ident" id="3432005">c</span><span class="op" id="3432006">.</span><span class="ident" id="3432007">inst</span><span class="op" id="3432011">(</span><span class="ident" id="3432012">InstRune</span><span class="op" id="3432020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432023">i</span>&nbsp;<span class="op" id="3432025">:=</span>&nbsp;<span class="op" id="3432028">&amp;</span><span class="ident" id="3432029">c</span><span class="op" id="3432030">.</span><span class="ident" id="3432031">p</span><span class="op" id="3432032">.</span><span class="ident" id="3432033">Inst</span><span class="op" id="3432037">[</span><span class="ident" id="3432038">f</span><span class="op" id="3432039">.</span><span class="ident" id="3432040">i</span><span class="op" id="3432041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432044">i</span><span class="op" id="3432045">.</span><span class="ident" id="3432046">Rune</span>&nbsp;<span class="op" id="3432051">=</span>&nbsp;<span class="ident" id="3432053">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432056">flags</span>&nbsp;<span class="op" id="3432062">&amp;=</span>&nbsp;<span class="ident" id="3432065">FoldCase</span>&nbsp;<span class="comment" id="3432074">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432109">if</span>&nbsp;<span class="builtinfunc" id="3432112">len</span><span class="op" id="3432115">(</span><span class="ident" id="3432116">r</span><span class="op" id="3432117">)</span>&nbsp;<span class="op" id="3432119">!=</span>&nbsp;<span class="num" id="3432122">1</span>&nbsp;<span class="op" id="3432124">||</span>&nbsp;<span class="ident" id="3432127">unicode</span><span class="op" id="3432134">.</span><span class="ident" id="3432135">SimpleFold</span><span class="op" id="3432145">(</span><span class="ident" id="3432146">r</span><span class="op" id="3432147">[</span><span class="num" id="3432148">0</span><span class="op" id="3432149">]</span><span class="op" id="3432150">)</span>&nbsp;<span class="op" id="3432152">==</span>&nbsp;<span class="ident" id="3432155">r</span><span class="op" id="3432156">[</span><span class="num" id="3432157">0</span><span class="op" id="3432158">]</span>&nbsp;<span class="op" id="3432160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3432164">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432197">flags</span>&nbsp;<span class="op" id="3432203">&amp;^=</span>&nbsp;<span class="ident" id="3432207">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432217">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432220">i</span><span class="op" id="3432221">.</span><span class="ident" id="3432222">Arg</span>&nbsp;<span class="op" id="3432226">=</span>&nbsp;<span class="builtintype" id="3432228">uint32</span><span class="op" id="3432234">(</span><span class="ident" id="3432235">flags</span><span class="op" id="3432240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432243">f</span><span class="op" id="3432244">.</span><span class="ident" id="3432245">out</span>&nbsp;<span class="op" id="3432249">=</span>&nbsp;<span class="ident" id="3432251">patchList</span><span class="op" id="3432260">(</span><span class="ident" id="3432261">f</span><span class="op" id="3432262">.</span><span class="ident" id="3432263">i</span>&nbsp;<span class="op" id="3432265">&lt;&lt;</span>&nbsp;<span class="num" id="3432268">1</span><span class="op" id="3432269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3432273">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432309">switch</span>&nbsp;<span class="op" id="3432316">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432319">case</span>&nbsp;<span class="ident" id="3432324">flags</span><span class="op" id="3432329">&amp;</span><span class="ident" id="3432330">FoldCase</span>&nbsp;<span class="op" id="3432339">==</span>&nbsp;<span class="num" id="3432342">0</span>&nbsp;<span class="op" id="3432344">&amp;&amp;</span>&nbsp;<span class="op" id="3432347">(</span><span class="builtinfunc" id="3432348">len</span><span class="op" id="3432351">(</span><span class="ident" id="3432352">r</span><span class="op" id="3432353">)</span>&nbsp;<span class="op" id="3432355">==</span>&nbsp;<span class="num" id="3432358">1</span>&nbsp;<span class="op" id="3432360">||</span>&nbsp;<span class="builtinfunc" id="3432363">len</span><span class="op" id="3432366">(</span><span class="ident" id="3432367">r</span><span class="op" id="3432368">)</span>&nbsp;<span class="op" id="3432370">==</span>&nbsp;<span class="num" id="3432373">2</span>&nbsp;<span class="op" id="3432375">&amp;&amp;</span>&nbsp;<span class="ident" id="3432378">r</span><span class="op" id="3432379">[</span><span class="num" id="3432380">0</span><span class="op" id="3432381">]</span>&nbsp;<span class="op" id="3432383">==</span>&nbsp;<span class="ident" id="3432386">r</span><span class="op" id="3432387">[</span><span class="num" id="3432388">1</span><span class="op" id="3432389">]</span><span class="op" id="3432390">)</span><span class="op" id="3432391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432395">i</span><span class="op" id="3432396">.</span><span class="ident" id="3432397">Op</span>&nbsp;<span class="op" id="3432400">=</span>&nbsp;<span class="ident" id="3432402">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432413">case</span>&nbsp;<span class="builtinfunc" id="3432418">len</span><span class="op" id="3432421">(</span><span class="ident" id="3432422">r</span><span class="op" id="3432423">)</span>&nbsp;<span class="op" id="3432425">==</span>&nbsp;<span class="num" id="3432428">2</span>&nbsp;<span class="op" id="3432430">&amp;&amp;</span>&nbsp;<span class="ident" id="3432433">r</span><span class="op" id="3432434">[</span><span class="num" id="3432435">0</span><span class="op" id="3432436">]</span>&nbsp;<span class="op" id="3432438">==</span>&nbsp;<span class="num" id="3432441">0</span>&nbsp;<span class="op" id="3432443">&amp;&amp;</span>&nbsp;<span class="ident" id="3432446">r</span><span class="op" id="3432447">[</span><span class="num" id="3432448">1</span><span class="op" id="3432449">]</span>&nbsp;<span class="op" id="3432451">==</span>&nbsp;<span class="ident" id="3432454">unicode</span><span class="op" id="3432461">.</span><span class="ident" id="3432462">MaxRune</span><span class="op" id="3432469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432473">i</span><span class="op" id="3432474">.</span><span class="ident" id="3432475">Op</span>&nbsp;<span class="op" id="3432478">=</span>&nbsp;<span class="ident" id="3432480">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432493">case</span>&nbsp;<span class="builtinfunc" id="3432498">len</span><span class="op" id="3432501">(</span><span class="ident" id="3432502">r</span><span class="op" id="3432503">)</span>&nbsp;<span class="op" id="3432505">==</span>&nbsp;<span class="num" id="3432508">4</span>&nbsp;<span class="op" id="3432510">&amp;&amp;</span>&nbsp;<span class="ident" id="3432513">r</span><span class="op" id="3432514">[</span><span class="num" id="3432515">0</span><span class="op" id="3432516">]</span>&nbsp;<span class="op" id="3432518">==</span>&nbsp;<span class="num" id="3432521">0</span>&nbsp;<span class="op" id="3432523">&amp;&amp;</span>&nbsp;<span class="ident" id="3432526">r</span><span class="op" id="3432527">[</span><span class="num" id="3432528">1</span><span class="op" id="3432529">]</span>&nbsp;<span class="op" id="3432531">==</span>&nbsp;<span class="string" id="3432534">&#39;\n&#39;</span><span class="op" id="3432538">-</span><span class="num" id="3432539">1</span>&nbsp;<span class="op" id="3432541">&amp;&amp;</span>&nbsp;<span class="ident" id="3432544">r</span><span class="op" id="3432545">[</span><span class="num" id="3432546">2</span><span class="op" id="3432547">]</span>&nbsp;<span class="op" id="3432549">==</span>&nbsp;<span class="string" id="3432552">&#39;\n&#39;</span><span class="op" id="3432556">+</span><span class="num" id="3432557">1</span>&nbsp;<span class="op" id="3432559">&amp;&amp;</span>&nbsp;<span class="ident" id="3432562">r</span><span class="op" id="3432563">[</span><span class="num" id="3432564">3</span><span class="op" id="3432565">]</span>&nbsp;<span class="op" id="3432567">==</span>&nbsp;<span class="ident" id="3432570">unicode</span><span class="op" id="3432577">.</span><span class="ident" id="3432578">MaxRune</span><span class="op" id="3432585">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3432589">i</span><span class="op" id="3432590">.</span><span class="ident" id="3432591">Op</span>&nbsp;<span class="op" id="3432594">=</span>&nbsp;<span class="ident" id="3432596">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3432614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3432618">return</span>&nbsp;<span class="ident" id="3432625">f</span><br>
<span class="lineno"></span><span class="op" id="3432627">}</span>
</div>
</body>
</html>
