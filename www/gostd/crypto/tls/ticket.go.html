<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html" class="current">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3862357">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3862412">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3862466">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3862517">package</span>&nbsp;<span class="ident" id="3862525">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862530">import</span>&nbsp;<span class="op" id="3862537">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862540">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862549">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862563">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862580">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862595">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862612">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862629">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3862639">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3862644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3862647">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="3862722">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="3862771">type</span>&nbsp;<span class="ident" id="3862776">sessionState</span>&nbsp;<span class="keyword" id="3862789">struct</span>&nbsp;<span class="op" id="3862796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862799">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3862812">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862820">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="3862833">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862841">masterSecret</span>&nbsp;<span class="op" id="3862854">[</span><span class="op" id="3862855">]</span><span class="builtintype" id="3862856">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862862">certificates</span>&nbsp;<span class="op" id="3862875">[</span><span class="op" id="3862876">]</span><span class="op" id="3862877">[</span><span class="op" id="3862878">]</span><span class="builtintype" id="3862879">byte</span><br>
<span class="lineno">25</span><span class="op" id="3862884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3862887">func</span>&nbsp;<span class="op" id="3862892">(</span><span class="ident" id="3862893">s</span>&nbsp;<span class="op" id="3862895">*</span><span class="ident" id="3862896">sessionState</span><span class="op" id="3862908">)</span>&nbsp;<span class="ident" id="3862910">equal</span><span class="op" id="3862915">(</span><span class="ident" id="3862916">i</span>&nbsp;<span class="keyword" id="3862918">interface</span><span class="op" id="3862927">{</span><span class="op" id="3862928">}</span><span class="op" id="3862929">)</span>&nbsp;<span class="builtintype" id="3862931">bool</span>&nbsp;<span class="op" id="3862936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3862939">s1</span><span class="op" id="3862941">,</span>&nbsp;<span class="ident" id="3862943">ok</span>&nbsp;<span class="op" id="3862946">:=</span>&nbsp;<span class="ident" id="3862949">i</span><span class="op" id="3862950">.</span><span class="op" id="3862951">(</span><span class="op" id="3862952">*</span><span class="ident" id="3862953">sessionState</span><span class="op" id="3862965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862968">if</span>&nbsp;<span class="op" id="3862971">!</span><span class="ident" id="3862972">ok</span>&nbsp;<span class="op" id="3862975">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862979">return</span>&nbsp;<span class="builtintype" id="3862986">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3862993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3862997">if</span>&nbsp;<span class="ident" id="3863000">s</span><span class="op" id="3863001">.</span><span class="ident" id="3863002">vers</span>&nbsp;<span class="op" id="3863007">!=</span>&nbsp;<span class="ident" id="3863010">s1</span><span class="op" id="3863012">.</span><span class="ident" id="3863013">vers</span>&nbsp;<span class="op" id="3863018">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863023">s</span><span class="op" id="3863024">.</span><span class="ident" id="3863025">cipherSuite</span>&nbsp;<span class="op" id="3863037">!=</span>&nbsp;<span class="ident" id="3863040">s1</span><span class="op" id="3863042">.</span><span class="ident" id="3863043">cipherSuite</span>&nbsp;<span class="op" id="3863055">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863060">!</span><span class="ident" id="3863061">bytes</span><span class="op" id="3863066">.</span><span class="ident" id="3863067">Equal</span><span class="op" id="3863072">(</span><span class="ident" id="3863073">s</span><span class="op" id="3863074">.</span><span class="ident" id="3863075">masterSecret</span><span class="op" id="3863087">,</span>&nbsp;<span class="ident" id="3863089">s1</span><span class="op" id="3863091">.</span><span class="ident" id="3863092">masterSecret</span><span class="op" id="3863104">)</span>&nbsp;<span class="op" id="3863106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863110">return</span>&nbsp;<span class="builtintype" id="3863117">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863128">if</span>&nbsp;<span class="builtinfunc" id="3863131">len</span><span class="op" id="3863134">(</span><span class="ident" id="3863135">s</span><span class="op" id="3863136">.</span><span class="ident" id="3863137">certificates</span><span class="op" id="3863149">)</span>&nbsp;<span class="op" id="3863151">!=</span>&nbsp;<span class="builtinfunc" id="3863154">len</span><span class="op" id="3863157">(</span><span class="ident" id="3863158">s1</span><span class="op" id="3863160">.</span><span class="ident" id="3863161">certificates</span><span class="op" id="3863173">)</span>&nbsp;<span class="op" id="3863175">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863179">return</span>&nbsp;<span class="builtintype" id="3863186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863197">for</span>&nbsp;<span class="ident" id="3863201">i</span>&nbsp;<span class="op" id="3863203">:=</span>&nbsp;<span class="keyword" id="3863206">range</span>&nbsp;<span class="ident" id="3863212">s</span><span class="op" id="3863213">.</span><span class="ident" id="3863214">certificates</span>&nbsp;<span class="op" id="3863227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863231">if</span>&nbsp;<span class="op" id="3863234">!</span><span class="ident" id="3863235">bytes</span><span class="op" id="3863240">.</span><span class="ident" id="3863241">Equal</span><span class="op" id="3863246">(</span><span class="ident" id="3863247">s</span><span class="op" id="3863248">.</span><span class="ident" id="3863249">certificates</span><span class="op" id="3863261">[</span><span class="ident" id="3863262">i</span><span class="op" id="3863263">]</span><span class="op" id="3863264">,</span>&nbsp;<span class="ident" id="3863266">s1</span><span class="op" id="3863268">.</span><span class="ident" id="3863269">certificates</span><span class="op" id="3863281">[</span><span class="ident" id="3863282">i</span><span class="op" id="3863283">]</span><span class="op" id="3863284">)</span>&nbsp;<span class="op" id="3863286">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863291">return</span>&nbsp;<span class="builtintype" id="3863298">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863313">return</span>&nbsp;<span class="builtintype" id="3863320">true</span><br>
<span class="lineno">50</span><span class="op" id="3863325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3863328">func</span>&nbsp;<span class="op" id="3863333">(</span><span class="ident" id="3863334">s</span>&nbsp;<span class="op" id="3863336">*</span><span class="ident" id="3863337">sessionState</span><span class="op" id="3863349">)</span>&nbsp;<span class="ident" id="3863351">marshal</span><span class="op" id="3863358">(</span><span class="op" id="3863359">)</span>&nbsp;<span class="op" id="3863361">[</span><span class="op" id="3863362">]</span><span class="builtintype" id="3863363">byte</span>&nbsp;<span class="op" id="3863368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863371">length</span>&nbsp;<span class="op" id="3863378">:=</span>&nbsp;<span class="num" id="3863381">2</span>&nbsp;<span class="op" id="3863383">+</span>&nbsp;<span class="num" id="3863385">2</span>&nbsp;<span class="op" id="3863387">+</span>&nbsp;<span class="num" id="3863389">2</span>&nbsp;<span class="op" id="3863391">+</span>&nbsp;<span class="builtinfunc" id="3863393">len</span><span class="op" id="3863396">(</span><span class="ident" id="3863397">s</span><span class="op" id="3863398">.</span><span class="ident" id="3863399">masterSecret</span><span class="op" id="3863411">)</span>&nbsp;<span class="op" id="3863413">+</span>&nbsp;<span class="num" id="3863415">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863418">for</span>&nbsp;<span class="ident" id="3863422">_</span><span class="op" id="3863423">,</span>&nbsp;<span class="ident" id="3863425">cert</span>&nbsp;<span class="op" id="3863430">:=</span>&nbsp;<span class="keyword" id="3863433">range</span>&nbsp;<span class="ident" id="3863439">s</span><span class="op" id="3863440">.</span><span class="ident" id="3863441">certificates</span>&nbsp;<span class="op" id="3863454">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863458">length</span>&nbsp;<span class="op" id="3863465">+=</span>&nbsp;<span class="num" id="3863468">4</span>&nbsp;<span class="op" id="3863470">+</span>&nbsp;<span class="builtinfunc" id="3863472">len</span><span class="op" id="3863475">(</span><span class="ident" id="3863476">cert</span><span class="op" id="3863480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3863483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863487">ret</span>&nbsp;<span class="op" id="3863491">:=</span>&nbsp;<span class="builtinfunc" id="3863494">make</span><span class="op" id="3863498">(</span><span class="op" id="3863499">[</span><span class="op" id="3863500">]</span><span class="builtintype" id="3863501">byte</span><span class="op" id="3863505">,</span>&nbsp;<span class="ident" id="3863507">length</span><span class="op" id="3863513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863516">x</span>&nbsp;<span class="op" id="3863518">:=</span>&nbsp;<span class="ident" id="3863521">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863526">x</span><span class="op" id="3863527">[</span><span class="num" id="3863528">0</span><span class="op" id="3863529">]</span>&nbsp;<span class="op" id="3863531">=</span>&nbsp;<span class="builtintype" id="3863533">byte</span><span class="op" id="3863537">(</span><span class="ident" id="3863538">s</span><span class="op" id="3863539">.</span><span class="ident" id="3863540">vers</span>&nbsp;<span class="op" id="3863545">&gt;&gt;</span>&nbsp;<span class="num" id="3863548">8</span><span class="op" id="3863549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863552">x</span><span class="op" id="3863553">[</span><span class="num" id="3863554">1</span><span class="op" id="3863555">]</span>&nbsp;<span class="op" id="3863557">=</span>&nbsp;<span class="builtintype" id="3863559">byte</span><span class="op" id="3863563">(</span><span class="ident" id="3863564">s</span><span class="op" id="3863565">.</span><span class="ident" id="3863566">vers</span><span class="op" id="3863570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863573">x</span><span class="op" id="3863574">[</span><span class="num" id="3863575">2</span><span class="op" id="3863576">]</span>&nbsp;<span class="op" id="3863578">=</span>&nbsp;<span class="builtintype" id="3863580">byte</span><span class="op" id="3863584">(</span><span class="ident" id="3863585">s</span><span class="op" id="3863586">.</span><span class="ident" id="3863587">cipherSuite</span>&nbsp;<span class="op" id="3863599">&gt;&gt;</span>&nbsp;<span class="num" id="3863602">8</span><span class="op" id="3863603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863606">x</span><span class="op" id="3863607">[</span><span class="num" id="3863608">3</span><span class="op" id="3863609">]</span>&nbsp;<span class="op" id="3863611">=</span>&nbsp;<span class="builtintype" id="3863613">byte</span><span class="op" id="3863617">(</span><span class="ident" id="3863618">s</span><span class="op" id="3863619">.</span><span class="ident" id="3863620">cipherSuite</span><span class="op" id="3863631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863634">x</span><span class="op" id="3863635">[</span><span class="num" id="3863636">4</span><span class="op" id="3863637">]</span>&nbsp;<span class="op" id="3863639">=</span>&nbsp;<span class="builtintype" id="3863641">byte</span><span class="op" id="3863645">(</span><span class="builtinfunc" id="3863646">len</span><span class="op" id="3863649">(</span><span class="ident" id="3863650">s</span><span class="op" id="3863651">.</span><span class="ident" id="3863652">masterSecret</span><span class="op" id="3863664">)</span>&nbsp;<span class="op" id="3863666">&gt;&gt;</span>&nbsp;<span class="num" id="3863669">8</span><span class="op" id="3863670">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863673">x</span><span class="op" id="3863674">[</span><span class="num" id="3863675">5</span><span class="op" id="3863676">]</span>&nbsp;<span class="op" id="3863678">=</span>&nbsp;<span class="builtintype" id="3863680">byte</span><span class="op" id="3863684">(</span><span class="builtinfunc" id="3863685">len</span><span class="op" id="3863688">(</span><span class="ident" id="3863689">s</span><span class="op" id="3863690">.</span><span class="ident" id="3863691">masterSecret</span><span class="op" id="3863703">)</span><span class="op" id="3863704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863707">x</span>&nbsp;<span class="op" id="3863709">=</span>&nbsp;<span class="ident" id="3863711">x</span><span class="op" id="3863712">[</span><span class="num" id="3863713">6</span><span class="op" id="3863714">:</span><span class="op" id="3863715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3863718">copy</span><span class="op" id="3863722">(</span><span class="ident" id="3863723">x</span><span class="op" id="3863724">,</span>&nbsp;<span class="ident" id="3863726">s</span><span class="op" id="3863727">.</span><span class="ident" id="3863728">masterSecret</span><span class="op" id="3863740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863743">x</span>&nbsp;<span class="op" id="3863745">=</span>&nbsp;<span class="ident" id="3863747">x</span><span class="op" id="3863748">[</span><span class="builtinfunc" id="3863749">len</span><span class="op" id="3863752">(</span><span class="ident" id="3863753">s</span><span class="op" id="3863754">.</span><span class="ident" id="3863755">masterSecret</span><span class="op" id="3863767">)</span><span class="op" id="3863768">:</span><span class="op" id="3863769">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863773">x</span><span class="op" id="3863774">[</span><span class="num" id="3863775">0</span><span class="op" id="3863776">]</span>&nbsp;<span class="op" id="3863778">=</span>&nbsp;<span class="builtintype" id="3863780">byte</span><span class="op" id="3863784">(</span><span class="builtinfunc" id="3863785">len</span><span class="op" id="3863788">(</span><span class="ident" id="3863789">s</span><span class="op" id="3863790">.</span><span class="ident" id="3863791">certificates</span><span class="op" id="3863803">)</span>&nbsp;<span class="op" id="3863805">&gt;&gt;</span>&nbsp;<span class="num" id="3863808">8</span><span class="op" id="3863809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863812">x</span><span class="op" id="3863813">[</span><span class="num" id="3863814">1</span><span class="op" id="3863815">]</span>&nbsp;<span class="op" id="3863817">=</span>&nbsp;<span class="builtintype" id="3863819">byte</span><span class="op" id="3863823">(</span><span class="builtinfunc" id="3863824">len</span><span class="op" id="3863827">(</span><span class="ident" id="3863828">s</span><span class="op" id="3863829">.</span><span class="ident" id="3863830">certificates</span><span class="op" id="3863842">)</span><span class="op" id="3863843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863846">x</span>&nbsp;<span class="op" id="3863848">=</span>&nbsp;<span class="ident" id="3863850">x</span><span class="op" id="3863851">[</span><span class="num" id="3863852">2</span><span class="op" id="3863853">:</span><span class="op" id="3863854">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3863858">for</span>&nbsp;<span class="ident" id="3863862">_</span><span class="op" id="3863863">,</span>&nbsp;<span class="ident" id="3863865">cert</span>&nbsp;<span class="op" id="3863870">:=</span>&nbsp;<span class="keyword" id="3863873">range</span>&nbsp;<span class="ident" id="3863879">s</span><span class="op" id="3863880">.</span><span class="ident" id="3863881">certificates</span>&nbsp;<span class="op" id="3863894">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863898">x</span><span class="op" id="3863899">[</span><span class="num" id="3863900">0</span><span class="op" id="3863901">]</span>&nbsp;<span class="op" id="3863903">=</span>&nbsp;<span class="builtintype" id="3863905">byte</span><span class="op" id="3863909">(</span><span class="builtinfunc" id="3863910">len</span><span class="op" id="3863913">(</span><span class="ident" id="3863914">cert</span><span class="op" id="3863918">)</span>&nbsp;<span class="op" id="3863920">&gt;&gt;</span>&nbsp;<span class="num" id="3863923">24</span><span class="op" id="3863925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863929">x</span><span class="op" id="3863930">[</span><span class="num" id="3863931">1</span><span class="op" id="3863932">]</span>&nbsp;<span class="op" id="3863934">=</span>&nbsp;<span class="builtintype" id="3863936">byte</span><span class="op" id="3863940">(</span><span class="builtinfunc" id="3863941">len</span><span class="op" id="3863944">(</span><span class="ident" id="3863945">cert</span><span class="op" id="3863949">)</span>&nbsp;<span class="op" id="3863951">&gt;&gt;</span>&nbsp;<span class="num" id="3863954">16</span><span class="op" id="3863956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863960">x</span><span class="op" id="3863961">[</span><span class="num" id="3863962">2</span><span class="op" id="3863963">]</span>&nbsp;<span class="op" id="3863965">=</span>&nbsp;<span class="builtintype" id="3863967">byte</span><span class="op" id="3863971">(</span><span class="builtinfunc" id="3863972">len</span><span class="op" id="3863975">(</span><span class="ident" id="3863976">cert</span><span class="op" id="3863980">)</span>&nbsp;<span class="op" id="3863982">&gt;&gt;</span>&nbsp;<span class="num" id="3863985">8</span><span class="op" id="3863986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3863990">x</span><span class="op" id="3863991">[</span><span class="num" id="3863992">3</span><span class="op" id="3863993">]</span>&nbsp;<span class="op" id="3863995">=</span>&nbsp;<span class="builtintype" id="3863997">byte</span><span class="op" id="3864001">(</span><span class="builtinfunc" id="3864002">len</span><span class="op" id="3864005">(</span><span class="ident" id="3864006">cert</span><span class="op" id="3864010">)</span><span class="op" id="3864011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3864015">copy</span><span class="op" id="3864019">(</span><span class="ident" id="3864020">x</span><span class="op" id="3864021">[</span><span class="num" id="3864022">4</span><span class="op" id="3864023">:</span><span class="op" id="3864024">]</span><span class="op" id="3864025">,</span>&nbsp;<span class="ident" id="3864027">cert</span><span class="op" id="3864031">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864035">x</span>&nbsp;<span class="op" id="3864037">=</span>&nbsp;<span class="ident" id="3864039">x</span><span class="op" id="3864040">[</span><span class="num" id="3864041">4</span><span class="op" id="3864042">+</span><span class="builtinfunc" id="3864043">len</span><span class="op" id="3864046">(</span><span class="ident" id="3864047">cert</span><span class="op" id="3864051">)</span><span class="op" id="3864052">:</span><span class="op" id="3864053">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864060">return</span>&nbsp;<span class="ident" id="3864067">ret</span><br>
<span class="lineno"></span><span class="op" id="3864071">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3864074">func</span>&nbsp;<span class="op" id="3864079">(</span><span class="ident" id="3864080">s</span>&nbsp;<span class="op" id="3864082">*</span><span class="ident" id="3864083">sessionState</span><span class="op" id="3864095">)</span>&nbsp;<span class="ident" id="3864097">unmarshal</span><span class="op" id="3864106">(</span><span class="ident" id="3864107">data</span>&nbsp;<span class="op" id="3864112">[</span><span class="op" id="3864113">]</span><span class="builtintype" id="3864114">byte</span><span class="op" id="3864118">)</span>&nbsp;<span class="builtintype" id="3864120">bool</span>&nbsp;<span class="op" id="3864125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864128">if</span>&nbsp;<span class="builtinfunc" id="3864131">len</span><span class="op" id="3864134">(</span><span class="ident" id="3864135">data</span><span class="op" id="3864139">)</span>&nbsp;<span class="op" id="3864141">&lt;</span>&nbsp;<span class="num" id="3864143">8</span>&nbsp;<span class="op" id="3864145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864149">return</span>&nbsp;<span class="builtintype" id="3864156">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864163">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864167">s</span><span class="op" id="3864168">.</span><span class="ident" id="3864169">vers</span>&nbsp;<span class="op" id="3864174">=</span>&nbsp;<span class="builtintype" id="3864176">uint16</span><span class="op" id="3864182">(</span><span class="ident" id="3864183">data</span><span class="op" id="3864187">[</span><span class="num" id="3864188">0</span><span class="op" id="3864189">]</span><span class="op" id="3864190">)</span><span class="op" id="3864191">&lt;&lt;</span><span class="num" id="3864193">8</span>&nbsp;<span class="op" id="3864195">|</span>&nbsp;<span class="builtintype" id="3864197">uint16</span><span class="op" id="3864203">(</span><span class="ident" id="3864204">data</span><span class="op" id="3864208">[</span><span class="num" id="3864209">1</span><span class="op" id="3864210">]</span><span class="op" id="3864211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864214">s</span><span class="op" id="3864215">.</span><span class="ident" id="3864216">cipherSuite</span>&nbsp;<span class="op" id="3864228">=</span>&nbsp;<span class="builtintype" id="3864230">uint16</span><span class="op" id="3864236">(</span><span class="ident" id="3864237">data</span><span class="op" id="3864241">[</span><span class="num" id="3864242">2</span><span class="op" id="3864243">]</span><span class="op" id="3864244">)</span><span class="op" id="3864245">&lt;&lt;</span><span class="num" id="3864247">8</span>&nbsp;<span class="op" id="3864249">|</span>&nbsp;<span class="builtintype" id="3864251">uint16</span><span class="op" id="3864257">(</span><span class="ident" id="3864258">data</span><span class="op" id="3864262">[</span><span class="num" id="3864263">3</span><span class="op" id="3864264">]</span><span class="op" id="3864265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864268">masterSecretLen</span>&nbsp;<span class="op" id="3864284">:=</span>&nbsp;<span class="builtintype" id="3864287">int</span><span class="op" id="3864290">(</span><span class="ident" id="3864291">data</span><span class="op" id="3864295">[</span><span class="num" id="3864296">4</span><span class="op" id="3864297">]</span><span class="op" id="3864298">)</span><span class="op" id="3864299">&lt;&lt;</span><span class="num" id="3864301">8</span>&nbsp;<span class="op" id="3864303">|</span>&nbsp;<span class="builtintype" id="3864305">int</span><span class="op" id="3864308">(</span><span class="ident" id="3864309">data</span><span class="op" id="3864313">[</span><span class="num" id="3864314">5</span><span class="op" id="3864315">]</span><span class="op" id="3864316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864319">data</span>&nbsp;<span class="op" id="3864324">=</span>&nbsp;<span class="ident" id="3864326">data</span><span class="op" id="3864330">[</span><span class="num" id="3864331">6</span><span class="op" id="3864332">:</span><span class="op" id="3864333">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864336">if</span>&nbsp;<span class="builtinfunc" id="3864339">len</span><span class="op" id="3864342">(</span><span class="ident" id="3864343">data</span><span class="op" id="3864347">)</span>&nbsp;<span class="op" id="3864349">&lt;</span>&nbsp;<span class="ident" id="3864351">masterSecretLen</span>&nbsp;<span class="op" id="3864367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864371">return</span>&nbsp;<span class="builtintype" id="3864378">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864389">s</span><span class="op" id="3864390">.</span><span class="ident" id="3864391">masterSecret</span>&nbsp;<span class="op" id="3864404">=</span>&nbsp;<span class="ident" id="3864406">data</span><span class="op" id="3864410">[</span><span class="op" id="3864411">:</span><span class="ident" id="3864412">masterSecretLen</span><span class="op" id="3864427">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864430">data</span>&nbsp;<span class="op" id="3864435">=</span>&nbsp;<span class="ident" id="3864437">data</span><span class="op" id="3864441">[</span><span class="ident" id="3864442">masterSecretLen</span><span class="op" id="3864457">:</span><span class="op" id="3864458">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864462">if</span>&nbsp;<span class="builtinfunc" id="3864465">len</span><span class="op" id="3864468">(</span><span class="ident" id="3864469">data</span><span class="op" id="3864473">)</span>&nbsp;<span class="op" id="3864475">&lt;</span>&nbsp;<span class="num" id="3864477">2</span>&nbsp;<span class="op" id="3864479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864483">return</span>&nbsp;<span class="builtintype" id="3864490">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864497">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864501">numCerts</span>&nbsp;<span class="op" id="3864510">:=</span>&nbsp;<span class="builtintype" id="3864513">int</span><span class="op" id="3864516">(</span><span class="ident" id="3864517">data</span><span class="op" id="3864521">[</span><span class="num" id="3864522">0</span><span class="op" id="3864523">]</span><span class="op" id="3864524">)</span><span class="op" id="3864525">&lt;&lt;</span><span class="num" id="3864527">8</span>&nbsp;<span class="op" id="3864529">|</span>&nbsp;<span class="builtintype" id="3864531">int</span><span class="op" id="3864534">(</span><span class="ident" id="3864535">data</span><span class="op" id="3864539">[</span><span class="num" id="3864540">1</span><span class="op" id="3864541">]</span><span class="op" id="3864542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864545">data</span>&nbsp;<span class="op" id="3864550">=</span>&nbsp;<span class="ident" id="3864552">data</span><span class="op" id="3864556">[</span><span class="num" id="3864557">2</span><span class="op" id="3864558">:</span><span class="op" id="3864559">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864563">s</span><span class="op" id="3864564">.</span><span class="ident" id="3864565">certificates</span>&nbsp;<span class="op" id="3864578">=</span>&nbsp;<span class="builtinfunc" id="3864580">make</span><span class="op" id="3864584">(</span><span class="op" id="3864585">[</span><span class="op" id="3864586">]</span><span class="op" id="3864587">[</span><span class="op" id="3864588">]</span><span class="builtintype" id="3864589">byte</span><span class="op" id="3864593">,</span>&nbsp;<span class="ident" id="3864595">numCerts</span><span class="op" id="3864603">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864606">for</span>&nbsp;<span class="ident" id="3864610">i</span>&nbsp;<span class="op" id="3864612">:=</span>&nbsp;<span class="keyword" id="3864615">range</span>&nbsp;<span class="ident" id="3864621">s</span><span class="op" id="3864622">.</span><span class="ident" id="3864623">certificates</span>&nbsp;<span class="op" id="3864636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864640">if</span>&nbsp;<span class="builtinfunc" id="3864643">len</span><span class="op" id="3864646">(</span><span class="ident" id="3864647">data</span><span class="op" id="3864651">)</span>&nbsp;<span class="op" id="3864653">&lt;</span>&nbsp;<span class="num" id="3864655">4</span>&nbsp;<span class="op" id="3864657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864662">return</span>&nbsp;<span class="builtintype" id="3864669">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864681">certLen</span>&nbsp;<span class="op" id="3864689">:=</span>&nbsp;<span class="builtintype" id="3864692">int</span><span class="op" id="3864695">(</span><span class="ident" id="3864696">data</span><span class="op" id="3864700">[</span><span class="num" id="3864701">0</span><span class="op" id="3864702">]</span><span class="op" id="3864703">)</span><span class="op" id="3864704">&lt;&lt;</span><span class="num" id="3864706">24</span>&nbsp;<span class="op" id="3864709">|</span>&nbsp;<span class="builtintype" id="3864711">int</span><span class="op" id="3864714">(</span><span class="ident" id="3864715">data</span><span class="op" id="3864719">[</span><span class="num" id="3864720">1</span><span class="op" id="3864721">]</span><span class="op" id="3864722">)</span><span class="op" id="3864723">&lt;&lt;</span><span class="num" id="3864725">16</span>&nbsp;<span class="op" id="3864728">|</span>&nbsp;<span class="builtintype" id="3864730">int</span><span class="op" id="3864733">(</span><span class="ident" id="3864734">data</span><span class="op" id="3864738">[</span><span class="num" id="3864739">2</span><span class="op" id="3864740">]</span><span class="op" id="3864741">)</span><span class="op" id="3864742">&lt;&lt;</span><span class="num" id="3864744">8</span>&nbsp;<span class="op" id="3864746">|</span>&nbsp;<span class="builtintype" id="3864748">int</span><span class="op" id="3864751">(</span><span class="ident" id="3864752">data</span><span class="op" id="3864756">[</span><span class="num" id="3864757">3</span><span class="op" id="3864758">]</span><span class="op" id="3864759">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864763">data</span>&nbsp;<span class="op" id="3864768">=</span>&nbsp;<span class="ident" id="3864770">data</span><span class="op" id="3864774">[</span><span class="num" id="3864775">4</span><span class="op" id="3864776">:</span><span class="op" id="3864777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864781">if</span>&nbsp;<span class="ident" id="3864784">certLen</span>&nbsp;<span class="op" id="3864792">&lt;</span>&nbsp;<span class="num" id="3864794">0</span>&nbsp;<span class="op" id="3864796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864801">return</span>&nbsp;<span class="builtintype" id="3864808">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864820">if</span>&nbsp;<span class="builtinfunc" id="3864823">len</span><span class="op" id="3864826">(</span><span class="ident" id="3864827">data</span><span class="op" id="3864831">)</span>&nbsp;<span class="op" id="3864833">&lt;</span>&nbsp;<span class="ident" id="3864835">certLen</span>&nbsp;<span class="op" id="3864843">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864848">return</span>&nbsp;<span class="builtintype" id="3864855">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864867">s</span><span class="op" id="3864868">.</span><span class="ident" id="3864869">certificates</span><span class="op" id="3864881">[</span><span class="ident" id="3864882">i</span><span class="op" id="3864883">]</span>&nbsp;<span class="op" id="3864885">=</span>&nbsp;<span class="ident" id="3864887">data</span><span class="op" id="3864891">[</span><span class="op" id="3864892">:</span><span class="ident" id="3864893">certLen</span><span class="op" id="3864900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3864904">data</span>&nbsp;<span class="op" id="3864909">=</span>&nbsp;<span class="ident" id="3864911">data</span><span class="op" id="3864915">[</span><span class="ident" id="3864916">certLen</span><span class="op" id="3864923">:</span><span class="op" id="3864924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864927">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864931">if</span>&nbsp;<span class="builtinfunc" id="3864934">len</span><span class="op" id="3864937">(</span><span class="ident" id="3864938">data</span><span class="op" id="3864942">)</span>&nbsp;<span class="op" id="3864944">&gt;</span>&nbsp;<span class="num" id="3864946">0</span>&nbsp;<span class="op" id="3864948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864952">return</span>&nbsp;<span class="builtintype" id="3864959">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3864966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3864970">return</span>&nbsp;<span class="builtintype" id="3864977">true</span><br>
<span class="lineno"></span><span class="op" id="3864982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3864985">func</span>&nbsp;<span class="op" id="3864990">(</span><span class="ident" id="3864991">c</span>&nbsp;<span class="op" id="3864993">*</span><span class="ident" id="3864994">Conn</span><span class="op" id="3864998">)</span>&nbsp;<span class="ident" id="3865000">encryptTicket</span><span class="op" id="3865013">(</span><span class="ident" id="3865014">state</span>&nbsp;<span class="op" id="3865020">*</span><span class="ident" id="3865021">sessionState</span><span class="op" id="3865033">)</span>&nbsp;<span class="op" id="3865035">(</span><span class="op" id="3865036">[</span><span class="op" id="3865037">]</span><span class="builtintype" id="3865038">byte</span><span class="op" id="3865042">,</span>&nbsp;<span class="builtintype" id="3865044">error</span><span class="op" id="3865049">)</span>&nbsp;<span class="op" id="3865051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865054">serialized</span>&nbsp;<span class="op" id="3865065">:=</span>&nbsp;<span class="ident" id="3865068">state</span><span class="op" id="3865073">.</span><span class="ident" id="3865074">marshal</span><span class="op" id="3865081">(</span><span class="op" id="3865082">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865085">encrypted</span>&nbsp;<span class="op" id="3865095">:=</span>&nbsp;<span class="builtinfunc" id="3865098">make</span><span class="op" id="3865102">(</span><span class="op" id="3865103">[</span><span class="op" id="3865104">]</span><span class="builtintype" id="3865105">byte</span><span class="op" id="3865109">,</span>&nbsp;<span class="ident" id="3865111">aes</span><span class="op" id="3865114">.</span><span class="ident" id="3865115">BlockSize</span><span class="op" id="3865124">+</span><span class="builtinfunc" id="3865125">len</span><span class="op" id="3865128">(</span><span class="ident" id="3865129">serialized</span><span class="op" id="3865139">)</span><span class="op" id="3865140">+</span><span class="ident" id="3865141">sha256</span><span class="op" id="3865147">.</span><span class="ident" id="3865148">Size</span><span class="op" id="3865152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865155">iv</span>&nbsp;<span class="op" id="3865158">:=</span>&nbsp;<span class="ident" id="3865161">encrypted</span><span class="op" id="3865170">[</span><span class="op" id="3865171">:</span><span class="ident" id="3865172">aes</span><span class="op" id="3865175">.</span><span class="ident" id="3865176">BlockSize</span><span class="op" id="3865185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865188">macBytes</span>&nbsp;<span class="op" id="3865197">:=</span>&nbsp;<span class="ident" id="3865200">encrypted</span><span class="op" id="3865209">[</span><span class="builtinfunc" id="3865210">len</span><span class="op" id="3865213">(</span><span class="ident" id="3865214">encrypted</span><span class="op" id="3865223">)</span><span class="op" id="3865224">-</span><span class="ident" id="3865225">sha256</span><span class="op" id="3865231">.</span><span class="ident" id="3865232">Size</span><span class="op" id="3865236">:</span><span class="op" id="3865237">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865241">if</span>&nbsp;<span class="ident" id="3865244">_</span><span class="op" id="3865245">,</span>&nbsp;<span class="ident" id="3865247">err</span>&nbsp;<span class="op" id="3865251">:=</span>&nbsp;<span class="ident" id="3865254">io</span><span class="op" id="3865256">.</span><span class="ident" id="3865257">ReadFull</span><span class="op" id="3865265">(</span><span class="ident" id="3865266">c</span><span class="op" id="3865267">.</span><span class="ident" id="3865268">config</span><span class="op" id="3865274">.</span><span class="ident" id="3865275">rand</span><span class="op" id="3865279">(</span><span class="op" id="3865280">)</span><span class="op" id="3865281">,</span>&nbsp;<span class="ident" id="3865283">iv</span><span class="op" id="3865285">)</span><span class="op" id="3865286">;</span>&nbsp;<span class="ident" id="3865288">err</span>&nbsp;<span class="op" id="3865292">!=</span>&nbsp;<span class="builtintype" id="3865295">nil</span>&nbsp;<span class="op" id="3865299">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865303">return</span>&nbsp;<span class="builtintype" id="3865310">nil</span><span class="op" id="3865313">,</span>&nbsp;<span class="ident" id="3865315">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865323">block</span><span class="op" id="3865328">,</span>&nbsp;<span class="ident" id="3865330">err</span>&nbsp;<span class="op" id="3865334">:=</span>&nbsp;<span class="ident" id="3865337">aes</span><span class="op" id="3865340">.</span><span class="ident" id="3865341">NewCipher</span><span class="op" id="3865350">(</span><span class="ident" id="3865351">c</span><span class="op" id="3865352">.</span><span class="ident" id="3865353">config</span><span class="op" id="3865359">.</span><span class="ident" id="3865360">SessionTicketKey</span><span class="op" id="3865376">[</span><span class="op" id="3865377">:</span><span class="num" id="3865378">16</span><span class="op" id="3865380">]</span><span class="op" id="3865381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865384">if</span>&nbsp;<span class="ident" id="3865387">err</span>&nbsp;<span class="op" id="3865391">!=</span>&nbsp;<span class="builtintype" id="3865394">nil</span>&nbsp;<span class="op" id="3865398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865402">return</span>&nbsp;<span class="builtintype" id="3865409">nil</span><span class="op" id="3865412">,</span>&nbsp;<span class="ident" id="3865414">errors</span><span class="op" id="3865420">.</span><span class="ident" id="3865421">New</span><span class="op" id="3865424">(</span><span class="string" id="3865425">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="3865482">+</span>&nbsp;<span class="ident" id="3865484">err</span><span class="op" id="3865487">.</span><span class="ident" id="3865488">Error</span><span class="op" id="3865493">(</span><span class="op" id="3865494">)</span><span class="op" id="3865495">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865501">cipher</span><span class="op" id="3865507">.</span><span class="ident" id="3865508">NewCTR</span><span class="op" id="3865514">(</span><span class="ident" id="3865515">block</span><span class="op" id="3865520">,</span>&nbsp;<span class="ident" id="3865522">iv</span><span class="op" id="3865524">)</span><span class="op" id="3865525">.</span><span class="ident" id="3865526">XORKeyStream</span><span class="op" id="3865538">(</span><span class="ident" id="3865539">encrypted</span><span class="op" id="3865548">[</span><span class="ident" id="3865549">aes</span><span class="op" id="3865552">.</span><span class="ident" id="3865553">BlockSize</span><span class="op" id="3865562">:</span><span class="op" id="3865563">]</span><span class="op" id="3865564">,</span>&nbsp;<span class="ident" id="3865566">serialized</span><span class="op" id="3865576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865580">mac</span>&nbsp;<span class="op" id="3865584">:=</span>&nbsp;<span class="ident" id="3865587">hmac</span><span class="op" id="3865591">.</span><span class="ident" id="3865592">New</span><span class="op" id="3865595">(</span><span class="ident" id="3865596">sha256</span><span class="op" id="3865602">.</span><span class="ident" id="3865603">New</span><span class="op" id="3865606">,</span>&nbsp;<span class="ident" id="3865608">c</span><span class="op" id="3865609">.</span><span class="ident" id="3865610">config</span><span class="op" id="3865616">.</span><span class="ident" id="3865617">SessionTicketKey</span><span class="op" id="3865633">[</span><span class="num" id="3865634">16</span><span class="op" id="3865636">:</span><span class="num" id="3865637">32</span><span class="op" id="3865639">]</span><span class="op" id="3865640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865643">mac</span><span class="op" id="3865646">.</span><span class="ident" id="3865647">Write</span><span class="op" id="3865652">(</span><span class="ident" id="3865653">encrypted</span><span class="op" id="3865662">[</span><span class="op" id="3865663">:</span><span class="builtinfunc" id="3865664">len</span><span class="op" id="3865667">(</span><span class="ident" id="3865668">encrypted</span><span class="op" id="3865677">)</span><span class="op" id="3865678">-</span><span class="ident" id="3865679">sha256</span><span class="op" id="3865685">.</span><span class="ident" id="3865686">Size</span><span class="op" id="3865690">]</span><span class="op" id="3865691">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865694">mac</span><span class="op" id="3865697">.</span><span class="ident" id="3865698">Sum</span><span class="op" id="3865701">(</span><span class="ident" id="3865702">macBytes</span><span class="op" id="3865710">[</span><span class="op" id="3865711">:</span><span class="num" id="3865712">0</span><span class="op" id="3865713">]</span><span class="op" id="3865714">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865718">return</span>&nbsp;<span class="ident" id="3865725">encrypted</span><span class="op" id="3865734">,</span>&nbsp;<span class="builtintype" id="3865736">nil</span><br>
<span class="lineno"></span><span class="op" id="3865740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="3865743">func</span>&nbsp;<span class="op" id="3865748">(</span><span class="ident" id="3865749">c</span>&nbsp;<span class="op" id="3865751">*</span><span class="ident" id="3865752">Conn</span><span class="op" id="3865756">)</span>&nbsp;<span class="ident" id="3865758">decryptTicket</span><span class="op" id="3865771">(</span><span class="ident" id="3865772">encrypted</span>&nbsp;<span class="op" id="3865782">[</span><span class="op" id="3865783">]</span><span class="builtintype" id="3865784">byte</span><span class="op" id="3865788">)</span>&nbsp;<span class="op" id="3865790">(</span><span class="op" id="3865791">*</span><span class="ident" id="3865792">sessionState</span><span class="op" id="3865804">,</span>&nbsp;<span class="builtintype" id="3865806">bool</span><span class="op" id="3865810">)</span>&nbsp;<span class="op" id="3865812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865815">if</span>&nbsp;<span class="ident" id="3865818">c</span><span class="op" id="3865819">.</span><span class="ident" id="3865820">config</span><span class="op" id="3865826">.</span><span class="ident" id="3865827">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3865850">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3865855">len</span><span class="op" id="3865858">(</span><span class="ident" id="3865859">encrypted</span><span class="op" id="3865868">)</span>&nbsp;<span class="op" id="3865870">&lt;</span>&nbsp;<span class="ident" id="3865872">aes</span><span class="op" id="3865875">.</span><span class="ident" id="3865876">BlockSize</span><span class="op" id="3865885">+</span><span class="ident" id="3865886">sha256</span><span class="op" id="3865892">.</span><span class="ident" id="3865893">Size</span>&nbsp;<span class="op" id="3865898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3865902">return</span>&nbsp;<span class="builtintype" id="3865909">nil</span><span class="op" id="3865912">,</span>&nbsp;<span class="builtintype" id="3865914">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3865921">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865925">iv</span>&nbsp;<span class="op" id="3865928">:=</span>&nbsp;<span class="ident" id="3865931">encrypted</span><span class="op" id="3865940">[</span><span class="op" id="3865941">:</span><span class="ident" id="3865942">aes</span><span class="op" id="3865945">.</span><span class="ident" id="3865946">BlockSize</span><span class="op" id="3865955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3865958">macBytes</span>&nbsp;<span class="op" id="3865967">:=</span>&nbsp;<span class="ident" id="3865970">encrypted</span><span class="op" id="3865979">[</span><span class="builtinfunc" id="3865980">len</span><span class="op" id="3865983">(</span><span class="ident" id="3865984">encrypted</span><span class="op" id="3865993">)</span><span class="op" id="3865994">-</span><span class="ident" id="3865995">sha256</span><span class="op" id="3866001">.</span><span class="ident" id="3866002">Size</span><span class="op" id="3866006">:</span><span class="op" id="3866007">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866011">mac</span>&nbsp;<span class="op" id="3866015">:=</span>&nbsp;<span class="ident" id="3866018">hmac</span><span class="op" id="3866022">.</span><span class="ident" id="3866023">New</span><span class="op" id="3866026">(</span><span class="ident" id="3866027">sha256</span><span class="op" id="3866033">.</span><span class="ident" id="3866034">New</span><span class="op" id="3866037">,</span>&nbsp;<span class="ident" id="3866039">c</span><span class="op" id="3866040">.</span><span class="ident" id="3866041">config</span><span class="op" id="3866047">.</span><span class="ident" id="3866048">SessionTicketKey</span><span class="op" id="3866064">[</span><span class="num" id="3866065">16</span><span class="op" id="3866067">:</span><span class="num" id="3866068">32</span><span class="op" id="3866070">]</span><span class="op" id="3866071">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866074">mac</span><span class="op" id="3866077">.</span><span class="ident" id="3866078">Write</span><span class="op" id="3866083">(</span><span class="ident" id="3866084">encrypted</span><span class="op" id="3866093">[</span><span class="op" id="3866094">:</span><span class="builtinfunc" id="3866095">len</span><span class="op" id="3866098">(</span><span class="ident" id="3866099">encrypted</span><span class="op" id="3866108">)</span><span class="op" id="3866109">-</span><span class="ident" id="3866110">sha256</span><span class="op" id="3866116">.</span><span class="ident" id="3866117">Size</span><span class="op" id="3866121">]</span><span class="op" id="3866122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866125">expected</span>&nbsp;<span class="op" id="3866134">:=</span>&nbsp;<span class="ident" id="3866137">mac</span><span class="op" id="3866140">.</span><span class="ident" id="3866141">Sum</span><span class="op" id="3866144">(</span><span class="builtintype" id="3866145">nil</span><span class="op" id="3866148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866152">if</span>&nbsp;<span class="ident" id="3866155">subtle</span><span class="op" id="3866161">.</span><span class="ident" id="3866162">ConstantTimeCompare</span><span class="op" id="3866181">(</span><span class="ident" id="3866182">macBytes</span><span class="op" id="3866190">,</span>&nbsp;<span class="ident" id="3866192">expected</span><span class="op" id="3866200">)</span>&nbsp;<span class="op" id="3866202">!=</span>&nbsp;<span class="num" id="3866205">1</span>&nbsp;<span class="op" id="3866207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866211">return</span>&nbsp;<span class="builtintype" id="3866218">nil</span><span class="op" id="3866221">,</span>&nbsp;<span class="builtintype" id="3866223">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866234">block</span><span class="op" id="3866239">,</span>&nbsp;<span class="ident" id="3866241">err</span>&nbsp;<span class="op" id="3866245">:=</span>&nbsp;<span class="ident" id="3866248">aes</span><span class="op" id="3866251">.</span><span class="ident" id="3866252">NewCipher</span><span class="op" id="3866261">(</span><span class="ident" id="3866262">c</span><span class="op" id="3866263">.</span><span class="ident" id="3866264">config</span><span class="op" id="3866270">.</span><span class="ident" id="3866271">SessionTicketKey</span><span class="op" id="3866287">[</span><span class="op" id="3866288">:</span><span class="num" id="3866289">16</span><span class="op" id="3866291">]</span><span class="op" id="3866292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866295">if</span>&nbsp;<span class="ident" id="3866298">err</span>&nbsp;<span class="op" id="3866302">!=</span>&nbsp;<span class="builtintype" id="3866305">nil</span>&nbsp;<span class="op" id="3866309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866313">return</span>&nbsp;<span class="builtintype" id="3866320">nil</span><span class="op" id="3866323">,</span>&nbsp;<span class="builtintype" id="3866325">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3866332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866335">ciphertext</span>&nbsp;<span class="op" id="3866346">:=</span>&nbsp;<span class="ident" id="3866349">encrypted</span><span class="op" id="3866358">[</span><span class="ident" id="3866359">aes</span><span class="op" id="3866362">.</span><span class="ident" id="3866363">BlockSize</span>&nbsp;<span class="op" id="3866373">:</span>&nbsp;<span class="builtinfunc" id="3866375">len</span><span class="op" id="3866378">(</span><span class="ident" id="3866379">encrypted</span><span class="op" id="3866388">)</span><span class="op" id="3866389">-</span><span class="ident" id="3866390">sha256</span><span class="op" id="3866396">.</span><span class="ident" id="3866397">Size</span><span class="op" id="3866401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866404">plaintext</span>&nbsp;<span class="op" id="3866414">:=</span>&nbsp;<span class="ident" id="3866417">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866429">cipher</span><span class="op" id="3866435">.</span><span class="ident" id="3866436">NewCTR</span><span class="op" id="3866442">(</span><span class="ident" id="3866443">block</span><span class="op" id="3866448">,</span>&nbsp;<span class="ident" id="3866450">iv</span><span class="op" id="3866452">)</span><span class="op" id="3866453">.</span><span class="ident" id="3866454">XORKeyStream</span><span class="op" id="3866466">(</span><span class="ident" id="3866467">plaintext</span><span class="op" id="3866476">,</span>&nbsp;<span class="ident" id="3866478">ciphertext</span><span class="op" id="3866488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866492">state</span>&nbsp;<span class="op" id="3866498">:=</span>&nbsp;<span class="builtinfunc" id="3866501">new</span><span class="op" id="3866504">(</span><span class="ident" id="3866505">sessionState</span><span class="op" id="3866517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3866520">ok</span>&nbsp;<span class="op" id="3866523">:=</span>&nbsp;<span class="ident" id="3866526">state</span><span class="op" id="3866531">.</span><span class="ident" id="3866532">unmarshal</span><span class="op" id="3866541">(</span><span class="ident" id="3866542">plaintext</span><span class="op" id="3866551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3866554">return</span>&nbsp;<span class="ident" id="3866561">state</span><span class="op" id="3866566">,</span>&nbsp;<span class="ident" id="3866568">ok</span><br>
<span class="lineno"></span><span class="op" id="3866571">}</span>
</div>
</body>
</html>
