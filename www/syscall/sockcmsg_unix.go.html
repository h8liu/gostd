<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2277369">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2277425">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2277479">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2277530">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277595">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2277623">package</span>&nbsp;<span class="ident" id="2277631">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2277640">import</span>&nbsp;<span class="string" id="2277647">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277657">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2277720">func</span>&nbsp;<span class="ident" id="2277725">cmsgAlignOf</span><span class="op" id="2277736">(</span><span class="ident" id="2277737">salen</span>&nbsp;<span class="builtintype" id="2277743">int</span><span class="op" id="2277746">)</span>&nbsp;<span class="builtintype" id="2277748">int</span>&nbsp;<span class="op" id="2277752">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277755">salign</span>&nbsp;<span class="op" id="2277762">:=</span>&nbsp;<span class="ident" id="2277765">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277776">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277840">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277902">if</span>&nbsp;<span class="ident" id="2277905">darwin64Bit</span>&nbsp;<span class="op" id="2277917">||</span>&nbsp;<span class="ident" id="2277920">dragonfly64Bit</span>&nbsp;<span class="op" id="2277935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277939">salign</span>&nbsp;<span class="op" id="2277946">=</span>&nbsp;<span class="num" id="2277948">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277954">return</span>&nbsp;<span class="op" id="2277961">(</span><span class="ident" id="2277962">salen</span>&nbsp;<span class="op" id="2277968">+</span>&nbsp;<span class="ident" id="2277970">salign</span>&nbsp;<span class="op" id="2277977">-</span>&nbsp;<span class="num" id="2277979">1</span><span class="op" id="2277980">)</span>&nbsp;<span class="op" id="2277982">&amp;</span>&nbsp;<span class="op" id="2277984">^</span><span class="op" id="2277985">(</span><span class="ident" id="2277986">salign</span>&nbsp;<span class="op" id="2277993">-</span>&nbsp;<span class="num" id="2277995">1</span><span class="op" id="2277996">)</span><br>
<span class="lineno"></span><span class="op" id="2277998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2278001">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2278071">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2278130">func</span>&nbsp;<span class="ident" id="2278135">CmsgLen</span><span class="op" id="2278142">(</span><span class="ident" id="2278143">datalen</span>&nbsp;<span class="builtintype" id="2278151">int</span><span class="op" id="2278154">)</span>&nbsp;<span class="builtintype" id="2278156">int</span>&nbsp;<span class="op" id="2278160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278163">return</span>&nbsp;<span class="ident" id="2278170">cmsgAlignOf</span><span class="op" id="2278181">(</span><span class="ident" id="2278182">SizeofCmsghdr</span><span class="op" id="2278195">)</span>&nbsp;<span class="op" id="2278197">+</span>&nbsp;<span class="ident" id="2278199">datalen</span><br>
<span class="lineno"></span><span class="op" id="2278207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2278210">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2278277">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2278324">func</span>&nbsp;<span class="ident" id="2278329">CmsgSpace</span><span class="op" id="2278338">(</span><span class="ident" id="2278339">datalen</span>&nbsp;<span class="builtintype" id="2278347">int</span><span class="op" id="2278350">)</span>&nbsp;<span class="builtintype" id="2278352">int</span>&nbsp;<span class="op" id="2278356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278359">return</span>&nbsp;<span class="ident" id="2278366">cmsgAlignOf</span><span class="op" id="2278377">(</span><span class="ident" id="2278378">SizeofCmsghdr</span><span class="op" id="2278391">)</span>&nbsp;<span class="op" id="2278393">+</span>&nbsp;<span class="ident" id="2278395">cmsgAlignOf</span><span class="op" id="2278406">(</span><span class="ident" id="2278407">datalen</span><span class="op" id="2278414">)</span><br>
<span class="lineno"></span><span class="op" id="2278416">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2278419">func</span>&nbsp;<span class="ident" id="2278424">cmsgData</span><span class="op" id="2278432">(</span><span class="ident" id="2278433">h</span>&nbsp;<span class="op" id="2278435">*</span><span class="ident" id="2278436">Cmsghdr</span><span class="op" id="2278443">)</span>&nbsp;<span class="ident" id="2278445">unsafe</span><span class="op" id="2278451">.</span><span class="ident" id="2278452">Pointer</span>&nbsp;<span class="op" id="2278460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278463">return</span>&nbsp;<span class="ident" id="2278470">unsafe</span><span class="op" id="2278476">.</span><span class="ident" id="2278477">Pointer</span><span class="op" id="2278484">(</span><span class="builtintype" id="2278485">uintptr</span><span class="op" id="2278492">(</span><span class="ident" id="2278493">unsafe</span><span class="op" id="2278499">.</span><span class="ident" id="2278500">Pointer</span><span class="op" id="2278507">(</span><span class="ident" id="2278508">h</span><span class="op" id="2278509">)</span><span class="op" id="2278510">)</span>&nbsp;<span class="op" id="2278512">+</span>&nbsp;<span class="builtintype" id="2278514">uintptr</span><span class="op" id="2278521">(</span><span class="ident" id="2278522">cmsgAlignOf</span><span class="op" id="2278533">(</span><span class="ident" id="2278534">SizeofCmsghdr</span><span class="op" id="2278547">)</span><span class="op" id="2278548">)</span><span class="op" id="2278549">)</span><br>
<span class="lineno"></span><span class="op" id="2278551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2278554">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2278615">type</span>&nbsp;<span class="ident" id="2278620">SocketControlMessage</span>&nbsp;<span class="keyword" id="2278641">struct</span>&nbsp;<span class="op" id="2278648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278651">Header</span>&nbsp;<span class="ident" id="2278658">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278667">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2278674">[</span><span class="op" id="2278675">]</span><span class="builtintype" id="2278676">byte</span><br>
<span class="lineno"></span><span class="op" id="2278681">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2278684">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2278752">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2278765">func</span>&nbsp;<span class="ident" id="2278770">ParseSocketControlMessage</span><span class="op" id="2278795">(</span><span class="ident" id="2278796">b</span>&nbsp;<span class="op" id="2278798">[</span><span class="op" id="2278799">]</span><span class="builtintype" id="2278800">byte</span><span class="op" id="2278804">)</span>&nbsp;<span class="op" id="2278806">(</span><span class="op" id="2278807">[</span><span class="op" id="2278808">]</span><span class="ident" id="2278809">SocketControlMessage</span><span class="op" id="2278829">,</span>&nbsp;<span class="builtintype" id="2278831">error</span><span class="op" id="2278836">)</span>&nbsp;<span class="op" id="2278838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278841">var</span>&nbsp;<span class="ident" id="2278845">msgs</span>&nbsp;<span class="op" id="2278850">[</span><span class="op" id="2278851">]</span><span class="ident" id="2278852">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278874">i</span>&nbsp;<span class="op" id="2278876">:=</span>&nbsp;<span class="num" id="2278879">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278882">for</span>&nbsp;<span class="ident" id="2278886">i</span><span class="op" id="2278887">+</span><span class="ident" id="2278888">CmsgLen</span><span class="op" id="2278895">(</span><span class="num" id="2278896">0</span><span class="op" id="2278897">)</span>&nbsp;<span class="op" id="2278899">&lt;=</span>&nbsp;<span class="builtinfunc" id="2278902">len</span><span class="op" id="2278905">(</span><span class="ident" id="2278906">b</span><span class="op" id="2278907">)</span>&nbsp;<span class="op" id="2278909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278913">h</span><span class="op" id="2278914">,</span>&nbsp;<span class="ident" id="2278916">dbuf</span><span class="op" id="2278920">,</span>&nbsp;<span class="ident" id="2278922">err</span>&nbsp;<span class="op" id="2278926">:=</span>&nbsp;<span class="ident" id="2278929">socketControlMessageHeaderAndData</span><span class="op" id="2278962">(</span><span class="ident" id="2278963">b</span><span class="op" id="2278964">[</span><span class="ident" id="2278965">i</span><span class="op" id="2278966">:</span><span class="op" id="2278967">]</span><span class="op" id="2278968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278972">if</span>&nbsp;<span class="ident" id="2278975">err</span>&nbsp;<span class="op" id="2278979">!=</span>&nbsp;<span class="ident" id="2278982">nil</span>&nbsp;<span class="op" id="2278986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278991">return</span>&nbsp;<span class="ident" id="2278998">nil</span><span class="op" id="2279001">,</span>&nbsp;<span class="ident" id="2279003">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279013">m</span>&nbsp;<span class="op" id="2279015">:=</span>&nbsp;<span class="ident" id="2279018">SocketControlMessage</span><span class="op" id="2279038">{</span><span class="ident" id="2279039">Header</span><span class="op" id="2279045">:</span>&nbsp;<span class="op" id="2279047">*</span><span class="ident" id="2279048">h</span><span class="op" id="2279049">,</span>&nbsp;<span class="ident" id="2279051">Data</span><span class="op" id="2279055">:</span>&nbsp;<span class="ident" id="2279057">dbuf</span><span class="op" id="2279061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279065">msgs</span>&nbsp;<span class="op" id="2279070">=</span>&nbsp;<span class="builtinfunc" id="2279072">append</span><span class="op" id="2279078">(</span><span class="ident" id="2279079">msgs</span><span class="op" id="2279083">,</span>&nbsp;<span class="ident" id="2279085">m</span><span class="op" id="2279086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279090">i</span>&nbsp;<span class="op" id="2279092">+=</span>&nbsp;<span class="ident" id="2279095">cmsgAlignOf</span><span class="op" id="2279106">(</span><span class="builtintype" id="2279107">int</span><span class="op" id="2279110">(</span><span class="ident" id="2279111">h</span><span class="op" id="2279112">.</span><span class="ident" id="2279113">Len</span><span class="op" id="2279116">)</span><span class="op" id="2279117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279120">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279123">return</span>&nbsp;<span class="ident" id="2279130">msgs</span><span class="op" id="2279134">,</span>&nbsp;<span class="ident" id="2279136">nil</span><br>
<span class="lineno"></span><span class="op" id="2279140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2279143">func</span>&nbsp;<span class="ident" id="2279148">socketControlMessageHeaderAndData</span><span class="op" id="2279181">(</span><span class="ident" id="2279182">b</span>&nbsp;<span class="op" id="2279184">[</span><span class="op" id="2279185">]</span><span class="builtintype" id="2279186">byte</span><span class="op" id="2279190">)</span>&nbsp;<span class="op" id="2279192">(</span><span class="op" id="2279193">*</span><span class="ident" id="2279194">Cmsghdr</span><span class="op" id="2279201">,</span>&nbsp;<span class="op" id="2279203">[</span><span class="op" id="2279204">]</span><span class="builtintype" id="2279205">byte</span><span class="op" id="2279209">,</span>&nbsp;<span class="builtintype" id="2279211">error</span><span class="op" id="2279216">)</span>&nbsp;<span class="op" id="2279218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279221">h</span>&nbsp;<span class="op" id="2279223">:=</span>&nbsp;<span class="op" id="2279226">(</span><span class="op" id="2279227">*</span><span class="ident" id="2279228">Cmsghdr</span><span class="op" id="2279235">)</span><span class="op" id="2279236">(</span><span class="ident" id="2279237">unsafe</span><span class="op" id="2279243">.</span><span class="ident" id="2279244">Pointer</span><span class="op" id="2279251">(</span><span class="op" id="2279252">&amp;</span><span class="ident" id="2279253">b</span><span class="op" id="2279254">[</span><span class="num" id="2279255">0</span><span class="op" id="2279256">]</span><span class="op" id="2279257">)</span><span class="op" id="2279258">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279261">if</span>&nbsp;<span class="ident" id="2279264">h</span><span class="op" id="2279265">.</span><span class="ident" id="2279266">Len</span>&nbsp;<span class="op" id="2279270">&lt;</span>&nbsp;<span class="ident" id="2279272">SizeofCmsghdr</span>&nbsp;<span class="op" id="2279286">||</span>&nbsp;<span class="builtintype" id="2279289">int</span><span class="op" id="2279292">(</span><span class="ident" id="2279293">h</span><span class="op" id="2279294">.</span><span class="ident" id="2279295">Len</span><span class="op" id="2279298">)</span>&nbsp;<span class="op" id="2279300">&gt;</span>&nbsp;<span class="builtinfunc" id="2279302">len</span><span class="op" id="2279305">(</span><span class="ident" id="2279306">b</span><span class="op" id="2279307">)</span>&nbsp;<span class="op" id="2279309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279313">return</span>&nbsp;<span class="ident" id="2279320">nil</span><span class="op" id="2279323">,</span>&nbsp;<span class="ident" id="2279325">nil</span><span class="op" id="2279328">,</span>&nbsp;<span class="ident" id="2279330">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279341">return</span>&nbsp;<span class="ident" id="2279348">h</span><span class="op" id="2279349">,</span>&nbsp;<span class="ident" id="2279351">b</span><span class="op" id="2279352">[</span><span class="ident" id="2279353">cmsgAlignOf</span><span class="op" id="2279364">(</span><span class="ident" id="2279365">SizeofCmsghdr</span><span class="op" id="2279378">)</span><span class="op" id="2279379">:</span><span class="ident" id="2279380">h</span><span class="op" id="2279381">.</span><span class="ident" id="2279382">Len</span><span class="op" id="2279385">]</span><span class="op" id="2279386">,</span>&nbsp;<span class="ident" id="2279388">nil</span><br>
<span class="lineno"></span><span class="op" id="2279392">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2279395">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2279462">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2279513">func</span>&nbsp;<span class="ident" id="2279518">UnixRights</span><span class="op" id="2279528">(</span><span class="ident" id="2279529">fds</span>&nbsp;<span class="op" id="2279533">...</span><span class="builtintype" id="2279536">int</span><span class="op" id="2279539">)</span>&nbsp;<span class="op" id="2279541">[</span><span class="op" id="2279542">]</span><span class="builtintype" id="2279543">byte</span>&nbsp;<span class="op" id="2279548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279551">datalen</span>&nbsp;<span class="op" id="2279559">:=</span>&nbsp;<span class="builtinfunc" id="2279562">len</span><span class="op" id="2279565">(</span><span class="ident" id="2279566">fds</span><span class="op" id="2279569">)</span>&nbsp;<span class="op" id="2279571">*</span>&nbsp;<span class="num" id="2279573">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279576">b</span>&nbsp;<span class="op" id="2279578">:=</span>&nbsp;<span class="builtinfunc" id="2279581">make</span><span class="op" id="2279585">(</span><span class="op" id="2279586">[</span><span class="op" id="2279587">]</span><span class="builtintype" id="2279588">byte</span><span class="op" id="2279592">,</span>&nbsp;<span class="ident" id="2279594">CmsgSpace</span><span class="op" id="2279603">(</span><span class="ident" id="2279604">datalen</span><span class="op" id="2279611">)</span><span class="op" id="2279612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279615">h</span>&nbsp;<span class="op" id="2279617">:=</span>&nbsp;<span class="op" id="2279620">(</span><span class="op" id="2279621">*</span><span class="ident" id="2279622">Cmsghdr</span><span class="op" id="2279629">)</span><span class="op" id="2279630">(</span><span class="ident" id="2279631">unsafe</span><span class="op" id="2279637">.</span><span class="ident" id="2279638">Pointer</span><span class="op" id="2279645">(</span><span class="op" id="2279646">&amp;</span><span class="ident" id="2279647">b</span><span class="op" id="2279648">[</span><span class="num" id="2279649">0</span><span class="op" id="2279650">]</span><span class="op" id="2279651">)</span><span class="op" id="2279652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279655">h</span><span class="op" id="2279656">.</span><span class="ident" id="2279657">Level</span>&nbsp;<span class="op" id="2279663">=</span>&nbsp;<span class="ident" id="2279665">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279677">h</span><span class="op" id="2279678">.</span><span class="ident" id="2279679">Type</span>&nbsp;<span class="op" id="2279684">=</span>&nbsp;<span class="ident" id="2279686">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279698">h</span><span class="op" id="2279699">.</span><span class="ident" id="2279700">SetLen</span><span class="op" id="2279706">(</span><span class="ident" id="2279707">CmsgLen</span><span class="op" id="2279714">(</span><span class="ident" id="2279715">datalen</span><span class="op" id="2279722">)</span><span class="op" id="2279723">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279726">data</span>&nbsp;<span class="op" id="2279731">:=</span>&nbsp;<span class="builtintype" id="2279734">uintptr</span><span class="op" id="2279741">(</span><span class="ident" id="2279742">cmsgData</span><span class="op" id="2279750">(</span><span class="ident" id="2279751">h</span><span class="op" id="2279752">)</span><span class="op" id="2279753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279756">for</span>&nbsp;<span class="ident" id="2279760">_</span><span class="op" id="2279761">,</span>&nbsp;<span class="ident" id="2279763">fd</span>&nbsp;<span class="op" id="2279766">:=</span>&nbsp;<span class="keyword" id="2279769">range</span>&nbsp;<span class="ident" id="2279775">fds</span>&nbsp;<span class="op" id="2279779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279783">*</span><span class="op" id="2279784">(</span><span class="op" id="2279785">*</span><span class="builtintype" id="2279786">int32</span><span class="op" id="2279791">)</span><span class="op" id="2279792">(</span><span class="ident" id="2279793">unsafe</span><span class="op" id="2279799">.</span><span class="ident" id="2279800">Pointer</span><span class="op" id="2279807">(</span><span class="ident" id="2279808">data</span><span class="op" id="2279812">)</span><span class="op" id="2279813">)</span>&nbsp;<span class="op" id="2279815">=</span>&nbsp;<span class="builtintype" id="2279817">int32</span><span class="op" id="2279822">(</span><span class="ident" id="2279823">fd</span><span class="op" id="2279825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279829">data</span>&nbsp;<span class="op" id="2279834">+=</span>&nbsp;<span class="num" id="2279837">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279840">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279843">return</span>&nbsp;<span class="ident" id="2279850">b</span><br>
<span class="lineno"></span><span class="op" id="2279852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2279855">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2279924">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2279988">func</span>&nbsp;<span class="ident" id="2279993">ParseUnixRights</span><span class="op" id="2280008">(</span><span class="ident" id="2280009">m</span>&nbsp;<span class="op" id="2280011">*</span><span class="ident" id="2280012">SocketControlMessage</span><span class="op" id="2280032">)</span>&nbsp;<span class="op" id="2280034">(</span><span class="op" id="2280035">[</span><span class="op" id="2280036">]</span><span class="builtintype" id="2280037">int</span><span class="op" id="2280040">,</span>&nbsp;<span class="builtintype" id="2280042">error</span><span class="op" id="2280047">)</span>&nbsp;<span class="op" id="2280049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280052">if</span>&nbsp;<span class="ident" id="2280055">m</span><span class="op" id="2280056">.</span><span class="ident" id="2280057">Header</span><span class="op" id="2280063">.</span><span class="ident" id="2280064">Level</span>&nbsp;<span class="op" id="2280070">!=</span>&nbsp;<span class="ident" id="2280073">SOL_SOCKET</span>&nbsp;<span class="op" id="2280084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280088">return</span>&nbsp;<span class="ident" id="2280095">nil</span><span class="op" id="2280098">,</span>&nbsp;<span class="ident" id="2280100">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280111">if</span>&nbsp;<span class="ident" id="2280114">m</span><span class="op" id="2280115">.</span><span class="ident" id="2280116">Header</span><span class="op" id="2280122">.</span><span class="ident" id="2280123">Type</span>&nbsp;<span class="op" id="2280128">!=</span>&nbsp;<span class="ident" id="2280131">SCM_RIGHTS</span>&nbsp;<span class="op" id="2280142">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280146">return</span>&nbsp;<span class="ident" id="2280153">nil</span><span class="op" id="2280156">,</span>&nbsp;<span class="ident" id="2280158">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280169">fds</span>&nbsp;<span class="op" id="2280173">:=</span>&nbsp;<span class="builtinfunc" id="2280176">make</span><span class="op" id="2280180">(</span><span class="op" id="2280181">[</span><span class="op" id="2280182">]</span><span class="builtintype" id="2280183">int</span><span class="op" id="2280186">,</span>&nbsp;<span class="builtinfunc" id="2280188">len</span><span class="op" id="2280191">(</span><span class="ident" id="2280192">m</span><span class="op" id="2280193">.</span><span class="ident" id="2280194">Data</span><span class="op" id="2280198">)</span><span class="op" id="2280199">&gt;&gt;</span><span class="num" id="2280201">2</span><span class="op" id="2280202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280205">for</span>&nbsp;<span class="ident" id="2280209">i</span><span class="op" id="2280210">,</span>&nbsp;<span class="ident" id="2280212">j</span>&nbsp;<span class="op" id="2280214">:=</span>&nbsp;<span class="num" id="2280217">0</span><span class="op" id="2280218">,</span>&nbsp;<span class="num" id="2280220">0</span><span class="op" id="2280221">;</span>&nbsp;<span class="ident" id="2280223">i</span>&nbsp;<span class="op" id="2280225">&lt;</span>&nbsp;<span class="builtinfunc" id="2280227">len</span><span class="op" id="2280230">(</span><span class="ident" id="2280231">m</span><span class="op" id="2280232">.</span><span class="ident" id="2280233">Data</span><span class="op" id="2280237">)</span><span class="op" id="2280238">;</span>&nbsp;<span class="ident" id="2280240">i</span>&nbsp;<span class="op" id="2280242">+=</span>&nbsp;<span class="num" id="2280245">4</span>&nbsp;<span class="op" id="2280247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280251">fds</span><span class="op" id="2280254">[</span><span class="ident" id="2280255">j</span><span class="op" id="2280256">]</span>&nbsp;<span class="op" id="2280258">=</span>&nbsp;<span class="builtintype" id="2280260">int</span><span class="op" id="2280263">(</span><span class="op" id="2280264">*</span><span class="op" id="2280265">(</span><span class="op" id="2280266">*</span><span class="builtintype" id="2280267">int32</span><span class="op" id="2280272">)</span><span class="op" id="2280273">(</span><span class="ident" id="2280274">unsafe</span><span class="op" id="2280280">.</span><span class="ident" id="2280281">Pointer</span><span class="op" id="2280288">(</span><span class="op" id="2280289">&amp;</span><span class="ident" id="2280290">m</span><span class="op" id="2280291">.</span><span class="ident" id="2280292">Data</span><span class="op" id="2280296">[</span><span class="ident" id="2280297">i</span><span class="op" id="2280298">]</span><span class="op" id="2280299">)</span><span class="op" id="2280300">)</span><span class="op" id="2280301">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280305">j</span><span class="op" id="2280306">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280313">return</span>&nbsp;<span class="ident" id="2280320">fds</span><span class="op" id="2280323">,</span>&nbsp;<span class="ident" id="2280325">nil</span><br>
<span class="lineno"></span><span class="op" id="2280329">}</span>
</div>
</body>
</html>
