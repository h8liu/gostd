<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7607499">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7607554">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7607608">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7607659">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="7607723">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7607757">package</span>&nbsp;<span class="ident" id="7607765">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="7607774">import</span>&nbsp;<span class="op" id="7607781">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607784">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607793">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607803">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607816">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607822">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607835">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7607842">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7607852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7607855">var</span>&nbsp;<span class="ident" id="7607859">testfile</span>&nbsp;<span class="op" id="7607868">*</span><span class="ident" id="7607869">ast</span><span class="op" id="7607872">.</span><span class="ident" id="7607873">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7607879">func</span>&nbsp;<span class="ident" id="7607884">testprint</span><span class="op" id="7607893">(</span><span class="ident" id="7607894">out</span>&nbsp;<span class="ident" id="7607898">io</span><span class="op" id="7607900">.</span><span class="ident" id="7607901">Writer</span><span class="op" id="7607907">,</span>&nbsp;<span class="ident" id="7607909">file</span>&nbsp;<span class="op" id="7607914">*</span><span class="ident" id="7607915">ast</span><span class="op" id="7607918">.</span><span class="ident" id="7607919">File</span><span class="op" id="7607923">)</span>&nbsp;<span class="op" id="7607925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7607928">if</span>&nbsp;<span class="ident" id="7607931">err</span>&nbsp;<span class="op" id="7607935">:=</span>&nbsp;<span class="op" id="7607938">(</span><span class="op" id="7607939">&amp;</span><span class="ident" id="7607940">Config</span><span class="op" id="7607946">{</span><span class="ident" id="7607947">TabIndent</span>&nbsp;<span class="op" id="7607957">|</span>&nbsp;<span class="ident" id="7607959">UseSpaces</span><span class="op" id="7607968">,</span>&nbsp;<span class="num" id="7607970">8</span><span class="op" id="7607971">,</span>&nbsp;<span class="num" id="7607973">0</span><span class="op" id="7607974">}</span><span class="op" id="7607975">)</span><span class="op" id="7607976">.</span><span class="ident" id="7607977">Fprint</span><span class="op" id="7607983">(</span><span class="ident" id="7607984">out</span><span class="op" id="7607987">,</span>&nbsp;<span class="ident" id="7607989">fset</span><span class="op" id="7607993">,</span>&nbsp;<span class="ident" id="7607995">file</span><span class="op" id="7607999">)</span><span class="op" id="7608000">;</span>&nbsp;<span class="ident" id="7608002">err</span>&nbsp;<span class="op" id="7608006">!=</span>&nbsp;<span class="ident" id="7608009">nil</span>&nbsp;<span class="op" id="7608013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608017">log</span><span class="op" id="7608020">.</span><span class="ident" id="7608021">Fatalf</span><span class="op" id="7608027">(</span><span class="string" id="7608028">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7608045">,</span>&nbsp;<span class="ident" id="7608047">err</span><span class="op" id="7608050">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608053">}</span><br>
<span class="lineno"></span><span class="op" id="7608055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7608058">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="7608133">func</span>&nbsp;<span class="ident" id="7608138">initialize</span><span class="op" id="7608148">(</span><span class="op" id="7608149">)</span>&nbsp;<span class="op" id="7608151">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608154">const</span>&nbsp;<span class="ident" id="7608160">filename</span>&nbsp;<span class="op" id="7608169">=</span>&nbsp;<span class="string" id="7608171">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608194">src</span><span class="op" id="7608197">,</span>&nbsp;<span class="ident" id="7608199">err</span>&nbsp;<span class="op" id="7608203">:=</span>&nbsp;<span class="ident" id="7608206">ioutil</span><span class="op" id="7608212">.</span><span class="ident" id="7608213">ReadFile</span><span class="op" id="7608221">(</span><span class="ident" id="7608222">filename</span><span class="op" id="7608230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608233">if</span>&nbsp;<span class="ident" id="7608236">err</span>&nbsp;<span class="op" id="7608240">!=</span>&nbsp;<span class="ident" id="7608243">nil</span>&nbsp;<span class="op" id="7608247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608251">log</span><span class="op" id="7608254">.</span><span class="ident" id="7608255">Fatalf</span><span class="op" id="7608261">(</span><span class="string" id="7608262">&#34;%s&#34;</span><span class="op" id="7608266">,</span>&nbsp;<span class="ident" id="7608268">err</span><span class="op" id="7608271">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608278">file</span><span class="op" id="7608282">,</span>&nbsp;<span class="ident" id="7608284">err</span>&nbsp;<span class="op" id="7608288">:=</span>&nbsp;<span class="ident" id="7608291">parser</span><span class="op" id="7608297">.</span><span class="ident" id="7608298">ParseFile</span><span class="op" id="7608307">(</span><span class="ident" id="7608308">fset</span><span class="op" id="7608312">,</span>&nbsp;<span class="ident" id="7608314">filename</span><span class="op" id="7608322">,</span>&nbsp;<span class="ident" id="7608324">src</span><span class="op" id="7608327">,</span>&nbsp;<span class="ident" id="7608329">parser</span><span class="op" id="7608335">.</span><span class="ident" id="7608336">ParseComments</span><span class="op" id="7608349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608352">if</span>&nbsp;<span class="ident" id="7608355">err</span>&nbsp;<span class="op" id="7608359">!=</span>&nbsp;<span class="ident" id="7608362">nil</span>&nbsp;<span class="op" id="7608366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608370">log</span><span class="op" id="7608373">.</span><span class="ident" id="7608374">Fatalf</span><span class="op" id="7608380">(</span><span class="string" id="7608381">&#34;%s&#34;</span><span class="op" id="7608385">,</span>&nbsp;<span class="ident" id="7608387">err</span><span class="op" id="7608390">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608397">var</span>&nbsp;<span class="ident" id="7608401">buf</span>&nbsp;<span class="ident" id="7608405">bytes</span><span class="op" id="7608410">.</span><span class="ident" id="7608411">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608419">testprint</span><span class="op" id="7608428">(</span><span class="op" id="7608429">&amp;</span><span class="ident" id="7608430">buf</span><span class="op" id="7608433">,</span>&nbsp;<span class="ident" id="7608435">file</span><span class="op" id="7608439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608442">if</span>&nbsp;<span class="op" id="7608445">!</span><span class="ident" id="7608446">bytes</span><span class="op" id="7608451">.</span><span class="ident" id="7608452">Equal</span><span class="op" id="7608457">(</span><span class="ident" id="7608458">buf</span><span class="op" id="7608461">.</span><span class="ident" id="7608462">Bytes</span><span class="op" id="7608467">(</span><span class="op" id="7608468">)</span><span class="op" id="7608469">,</span>&nbsp;<span class="ident" id="7608471">src</span><span class="op" id="7608474">)</span>&nbsp;<span class="op" id="7608476">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608480">log</span><span class="op" id="7608483">.</span><span class="ident" id="7608484">Fatalf</span><span class="op" id="7608490">(</span><span class="string" id="7608491">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="7608523">,</span>&nbsp;<span class="ident" id="7608525">filename</span><span class="op" id="7608533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608540">testfile</span>&nbsp;<span class="op" id="7608549">=</span>&nbsp;<span class="ident" id="7608551">file</span><br>
<span class="lineno"></span><span class="op" id="7608556">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="7608559">func</span>&nbsp;<span class="ident" id="7608564">BenchmarkPrint</span><span class="op" id="7608578">(</span><span class="ident" id="7608579">b</span>&nbsp;<span class="op" id="7608581">*</span><span class="ident" id="7608582">testing</span><span class="op" id="7608589">.</span><span class="ident" id="7608590">B</span><span class="op" id="7608591">)</span>&nbsp;<span class="op" id="7608593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608596">if</span>&nbsp;<span class="ident" id="7608599">testfile</span>&nbsp;<span class="op" id="7608608">==</span>&nbsp;<span class="ident" id="7608611">nil</span>&nbsp;<span class="op" id="7608615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608619">initialize</span><span class="op" id="7608629">(</span><span class="op" id="7608630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608633">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7608636">for</span>&nbsp;<span class="ident" id="7608640">i</span>&nbsp;<span class="op" id="7608642">:=</span>&nbsp;<span class="num" id="7608645">0</span><span class="op" id="7608646">;</span>&nbsp;<span class="ident" id="7608648">i</span>&nbsp;<span class="op" id="7608650">&lt;</span>&nbsp;<span class="ident" id="7608652">b</span><span class="op" id="7608653">.</span><span class="ident" id="7608654">N</span><span class="op" id="7608655">;</span>&nbsp;<span class="ident" id="7608657">i</span><span class="op" id="7608658">++</span>&nbsp;<span class="op" id="7608661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7608665">testprint</span><span class="op" id="7608674">(</span><span class="ident" id="7608675">ioutil</span><span class="op" id="7608681">.</span><span class="ident" id="7608682">Discard</span><span class="op" id="7608689">,</span>&nbsp;<span class="ident" id="7608691">testfile</span><span class="op" id="7608699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7608702">}</span><br>
<span class="lineno"></span><span class="op" id="7608704">}</span>
</div>
</body>
</html>
