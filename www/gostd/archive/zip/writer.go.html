<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5965328">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5965383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5965437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5965488">package</span>&nbsp;<span class="ident" id="5965496">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965501">import</span>&nbsp;<span class="op" id="5965508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965511">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965520">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965539">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965549">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965557">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5965571">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5965576">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5965579">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="5965619">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965667">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="5965707">type</span>&nbsp;<span class="ident" id="5965712">Writer</span>&nbsp;<span class="keyword" id="5965719">struct</span>&nbsp;<span class="op" id="5965726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965729">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965736">*</span><span class="ident" id="5965737">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965750">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5965757">[</span><span class="op" id="5965758">]</span><span class="op" id="5965759">*</span><span class="ident" id="5965760">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965768">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5965775">*</span><span class="ident" id="5965776">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965788">closed</span>&nbsp;<span class="builtintype" id="5965795">bool</span><br>
<span class="lineno">25</span><span class="op" id="5965800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5965803">type</span>&nbsp;<span class="ident" id="5965808">header</span>&nbsp;<span class="keyword" id="5965815">struct</span>&nbsp;<span class="op" id="5965822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5965825">*</span><span class="ident" id="5965826">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5965838">offset</span>&nbsp;<span class="ident" id="5965845">uint64</span><br>
<span class="lineno">30</span><span class="op" id="5965852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5965855">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5965914">func</span>&nbsp;<span class="ident" id="5965919">NewWriter</span><span class="op" id="5965928">(</span><span class="ident" id="5965929">w</span>&nbsp;<span class="ident" id="5965931">io</span><span class="op" id="5965933">.</span><span class="ident" id="5965934">Writer</span><span class="op" id="5965940">)</span>&nbsp;<span class="op" id="5965942">*</span><span class="ident" id="5965943">Writer</span>&nbsp;<span class="op" id="5965950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5965953">return</span>&nbsp;<span class="op" id="5965960">&amp;</span><span class="ident" id="5965961">Writer</span><span class="op" id="5965967">{</span><span class="ident" id="5965968">cw</span><span class="op" id="5965970">:</span>&nbsp;<span class="op" id="5965972">&amp;</span><span class="ident" id="5965973">countWriter</span><span class="op" id="5965984">{</span><span class="ident" id="5965985">w</span><span class="op" id="5965986">:</span>&nbsp;<span class="ident" id="5965988">bufio</span><span class="op" id="5965993">.</span><span class="ident" id="5965994">NewWriter</span><span class="op" id="5966003">(</span><span class="ident" id="5966004">w</span><span class="op" id="5966005">)</span><span class="op" id="5966006">}</span><span class="op" id="5966007">}</span><br>
<span class="lineno">35</span><span class="op" id="5966009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5966012">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5966073">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="5966146">func</span>&nbsp;<span class="op" id="5966151">(</span><span class="ident" id="5966152">w</span>&nbsp;<span class="op" id="5966154">*</span><span class="ident" id="5966155">Writer</span><span class="op" id="5966161">)</span>&nbsp;<span class="ident" id="5966163">Flush</span><span class="op" id="5966168">(</span><span class="op" id="5966169">)</span>&nbsp;<span class="builtintype" id="5966171">error</span>&nbsp;<span class="op" id="5966177">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966180">return</span>&nbsp;<span class="ident" id="5966187">w</span><span class="op" id="5966188">.</span><span class="ident" id="5966189">cw</span><span class="op" id="5966191">.</span><span class="ident" id="5966192">w</span><span class="op" id="5966193">.</span><span class="op" id="5966194">(</span><span class="op" id="5966195">*</span><span class="ident" id="5966196">bufio</span><span class="op" id="5966201">.</span><span class="ident" id="5966202">Writer</span><span class="op" id="5966208">)</span><span class="op" id="5966209">.</span><span class="ident" id="5966210">Flush</span><span class="op" id="5966215">(</span><span class="op" id="5966216">)</span><br>
<span class="lineno"></span><span class="op" id="5966218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5966221">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="5966294">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="5966352">func</span>&nbsp;<span class="op" id="5966357">(</span><span class="ident" id="5966358">w</span>&nbsp;<span class="op" id="5966360">*</span><span class="ident" id="5966361">Writer</span><span class="op" id="5966367">)</span>&nbsp;<span class="ident" id="5966369">Close</span><span class="op" id="5966374">(</span><span class="op" id="5966375">)</span>&nbsp;<span class="builtintype" id="5966377">error</span>&nbsp;<span class="op" id="5966383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966386">if</span>&nbsp;<span class="ident" id="5966389">w</span><span class="op" id="5966390">.</span><span class="ident" id="5966391">last</span>&nbsp;<span class="op" id="5966396">!=</span>&nbsp;<span class="ident" id="5966399">nil</span>&nbsp;<span class="op" id="5966403">&amp;&amp;</span>&nbsp;<span class="op" id="5966406">!</span><span class="ident" id="5966407">w</span><span class="op" id="5966408">.</span><span class="ident" id="5966409">last</span><span class="op" id="5966413">.</span><span class="ident" id="5966414">closed</span>&nbsp;<span class="op" id="5966421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966425">if</span>&nbsp;<span class="ident" id="5966428">err</span>&nbsp;<span class="op" id="5966432">:=</span>&nbsp;<span class="ident" id="5966435">w</span><span class="op" id="5966436">.</span><span class="ident" id="5966437">last</span><span class="op" id="5966441">.</span><span class="builtinfunc" id="5966442">close</span><span class="op" id="5966447">(</span><span class="op" id="5966448">)</span><span class="op" id="5966449">;</span>&nbsp;<span class="ident" id="5966451">err</span>&nbsp;<span class="op" id="5966455">!=</span>&nbsp;<span class="ident" id="5966458">nil</span>&nbsp;<span class="op" id="5966462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966467">return</span>&nbsp;<span class="ident" id="5966474">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966480">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966484">w</span><span class="op" id="5966485">.</span><span class="ident" id="5966486">last</span>&nbsp;<span class="op" id="5966491">=</span>&nbsp;<span class="ident" id="5966493">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966501">if</span>&nbsp;<span class="ident" id="5966504">w</span><span class="op" id="5966505">.</span><span class="ident" id="5966506">closed</span>&nbsp;<span class="op" id="5966513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966517">return</span>&nbsp;<span class="ident" id="5966524">errors</span><span class="op" id="5966530">.</span><span class="ident" id="5966531">New</span><span class="op" id="5966534">(</span><span class="string" id="5966535">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5966561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966564">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966567">w</span><span class="op" id="5966568">.</span><span class="ident" id="5966569">closed</span>&nbsp;<span class="op" id="5966576">=</span>&nbsp;<span class="builtintype" id="5966578">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5966585">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966613">start</span>&nbsp;<span class="op" id="5966619">:=</span>&nbsp;<span class="ident" id="5966622">w</span><span class="op" id="5966623">.</span><span class="ident" id="5966624">cw</span><span class="op" id="5966626">.</span><span class="ident" id="5966627">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966634">for</span>&nbsp;<span class="ident" id="5966638">_</span><span class="op" id="5966639">,</span>&nbsp;<span class="ident" id="5966641">h</span>&nbsp;<span class="op" id="5966643">:=</span>&nbsp;<span class="keyword" id="5966646">range</span>&nbsp;<span class="ident" id="5966652">w</span><span class="op" id="5966653">.</span><span class="ident" id="5966654">dir</span>&nbsp;<span class="op" id="5966658">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966662">var</span>&nbsp;<span class="ident" id="5966666">buf</span>&nbsp;<span class="op" id="5966670">[</span><span class="ident" id="5966671">directoryHeaderLen</span><span class="op" id="5966689">]</span><span class="builtintype" id="5966690">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966697">b</span>&nbsp;<span class="op" id="5966699">:=</span>&nbsp;<span class="ident" id="5966702">writeBuf</span><span class="op" id="5966710">(</span><span class="ident" id="5966711">buf</span><span class="op" id="5966714">[</span><span class="op" id="5966715">:</span><span class="op" id="5966716">]</span><span class="op" id="5966717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966721">b</span><span class="op" id="5966722">.</span><span class="builtintype" id="5966723">uint32</span><span class="op" id="5966729">(</span><span class="builtintype" id="5966730">uint32</span><span class="op" id="5966736">(</span><span class="ident" id="5966737">directoryHeaderSignature</span><span class="op" id="5966761">)</span><span class="op" id="5966762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966766">b</span><span class="op" id="5966767">.</span><span class="builtintype" id="5966768">uint16</span><span class="op" id="5966774">(</span><span class="ident" id="5966775">h</span><span class="op" id="5966776">.</span><span class="ident" id="5966777">CreatorVersion</span><span class="op" id="5966791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966795">b</span><span class="op" id="5966796">.</span><span class="builtintype" id="5966797">uint16</span><span class="op" id="5966803">(</span><span class="ident" id="5966804">h</span><span class="op" id="5966805">.</span><span class="ident" id="5966806">ReaderVersion</span><span class="op" id="5966819">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966823">b</span><span class="op" id="5966824">.</span><span class="builtintype" id="5966825">uint16</span><span class="op" id="5966831">(</span><span class="ident" id="5966832">h</span><span class="op" id="5966833">.</span><span class="ident" id="5966834">Flags</span><span class="op" id="5966839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966843">b</span><span class="op" id="5966844">.</span><span class="builtintype" id="5966845">uint16</span><span class="op" id="5966851">(</span><span class="ident" id="5966852">h</span><span class="op" id="5966853">.</span><span class="ident" id="5966854">Method</span><span class="op" id="5966860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966864">b</span><span class="op" id="5966865">.</span><span class="builtintype" id="5966866">uint16</span><span class="op" id="5966872">(</span><span class="ident" id="5966873">h</span><span class="op" id="5966874">.</span><span class="ident" id="5966875">ModifiedTime</span><span class="op" id="5966887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966891">b</span><span class="op" id="5966892">.</span><span class="builtintype" id="5966893">uint16</span><span class="op" id="5966899">(</span><span class="ident" id="5966900">h</span><span class="op" id="5966901">.</span><span class="ident" id="5966902">ModifiedDate</span><span class="op" id="5966914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5966918">b</span><span class="op" id="5966919">.</span><span class="builtintype" id="5966920">uint32</span><span class="op" id="5966926">(</span><span class="ident" id="5966927">h</span><span class="op" id="5966928">.</span><span class="ident" id="5966929">CRC32</span><span class="op" id="5966934">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966938">if</span>&nbsp;<span class="ident" id="5966941">h</span><span class="op" id="5966942">.</span><span class="ident" id="5966943">isZip64</span><span class="op" id="5966950">(</span><span class="op" id="5966951">)</span>&nbsp;<span class="op" id="5966953">||</span>&nbsp;<span class="ident" id="5966956">h</span><span class="op" id="5966957">.</span><span class="ident" id="5966958">offset</span>&nbsp;<span class="op" id="5966965">&gt;</span>&nbsp;<span class="ident" id="5966967">uint32max</span>&nbsp;<span class="op" id="5966977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5966982">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967040">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967103">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967144">b</span><span class="op" id="5967145">.</span><span class="builtintype" id="5967146">uint32</span><span class="op" id="5967152">(</span><span class="ident" id="5967153">uint32max</span><span class="op" id="5967162">)</span>&nbsp;<span class="comment" id="5967164">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967186">b</span><span class="op" id="5967187">.</span><span class="builtintype" id="5967188">uint32</span><span class="op" id="5967194">(</span><span class="ident" id="5967195">uint32max</span><span class="op" id="5967204">)</span>&nbsp;<span class="comment" id="5967206">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967231">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967273">var</span>&nbsp;<span class="ident" id="5967277">buf</span>&nbsp;<span class="op" id="5967281">[</span><span class="num" id="5967282">28</span><span class="op" id="5967284">]</span><span class="builtintype" id="5967285">byte</span>&nbsp;<span class="comment" id="5967290">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967318">eb</span>&nbsp;<span class="op" id="5967321">:=</span>&nbsp;<span class="ident" id="5967324">writeBuf</span><span class="op" id="5967332">(</span><span class="ident" id="5967333">buf</span><span class="op" id="5967336">[</span><span class="op" id="5967337">:</span><span class="op" id="5967338">]</span><span class="op" id="5967339">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967344">eb</span><span class="op" id="5967346">.</span><span class="builtintype" id="5967347">uint16</span><span class="op" id="5967353">(</span><span class="ident" id="5967354">zip64ExtraId</span><span class="op" id="5967366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967371">eb</span><span class="op" id="5967373">.</span><span class="builtintype" id="5967374">uint16</span><span class="op" id="5967380">(</span><span class="num" id="5967381">24</span><span class="op" id="5967383">)</span>&nbsp;<span class="comment" id="5967385">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967408">eb</span><span class="op" id="5967410">.</span><span class="ident" id="5967411">uint64</span><span class="op" id="5967417">(</span><span class="ident" id="5967418">h</span><span class="op" id="5967419">.</span><span class="ident" id="5967420">UncompressedSize64</span><span class="op" id="5967438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967443">eb</span><span class="op" id="5967445">.</span><span class="ident" id="5967446">uint64</span><span class="op" id="5967452">(</span><span class="ident" id="5967453">h</span><span class="op" id="5967454">.</span><span class="ident" id="5967455">CompressedSize64</span><span class="op" id="5967471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967476">eb</span><span class="op" id="5967478">.</span><span class="ident" id="5967479">uint64</span><span class="op" id="5967485">(</span><span class="ident" id="5967486">h</span><span class="op" id="5967487">.</span><span class="ident" id="5967488">offset</span><span class="op" id="5967494">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967499">h</span><span class="op" id="5967500">.</span><span class="ident" id="5967501">Extra</span>&nbsp;<span class="op" id="5967507">=</span>&nbsp;<span class="builtinfunc" id="5967509">append</span><span class="op" id="5967515">(</span><span class="ident" id="5967516">h</span><span class="op" id="5967517">.</span><span class="ident" id="5967518">Extra</span><span class="op" id="5967523">,</span>&nbsp;<span class="ident" id="5967525">buf</span><span class="op" id="5967528">[</span><span class="op" id="5967529">:</span><span class="op" id="5967530">]</span><span class="op" id="5967531">...</span><span class="op" id="5967534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967538">}</span>&nbsp;<span class="keyword" id="5967540">else</span>&nbsp;<span class="op" id="5967545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967550">b</span><span class="op" id="5967551">.</span><span class="builtintype" id="5967552">uint32</span><span class="op" id="5967558">(</span><span class="ident" id="5967559">h</span><span class="op" id="5967560">.</span><span class="ident" id="5967561">CompressedSize</span><span class="op" id="5967575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967580">b</span><span class="op" id="5967581">.</span><span class="builtintype" id="5967582">uint32</span><span class="op" id="5967588">(</span><span class="ident" id="5967589">h</span><span class="op" id="5967590">.</span><span class="ident" id="5967591">UncompressedSize</span><span class="op" id="5967607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967611">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967615">b</span><span class="op" id="5967616">.</span><span class="builtintype" id="5967617">uint16</span><span class="op" id="5967623">(</span><span class="builtintype" id="5967624">uint16</span><span class="op" id="5967630">(</span><span class="builtinfunc" id="5967631">len</span><span class="op" id="5967634">(</span><span class="ident" id="5967635">h</span><span class="op" id="5967636">.</span><span class="ident" id="5967637">Name</span><span class="op" id="5967641">)</span><span class="op" id="5967642">)</span><span class="op" id="5967643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967647">b</span><span class="op" id="5967648">.</span><span class="builtintype" id="5967649">uint16</span><span class="op" id="5967655">(</span><span class="builtintype" id="5967656">uint16</span><span class="op" id="5967662">(</span><span class="builtinfunc" id="5967663">len</span><span class="op" id="5967666">(</span><span class="ident" id="5967667">h</span><span class="op" id="5967668">.</span><span class="ident" id="5967669">Extra</span><span class="op" id="5967674">)</span><span class="op" id="5967675">)</span><span class="op" id="5967676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967680">b</span><span class="op" id="5967681">.</span><span class="builtintype" id="5967682">uint16</span><span class="op" id="5967688">(</span><span class="builtintype" id="5967689">uint16</span><span class="op" id="5967695">(</span><span class="builtinfunc" id="5967696">len</span><span class="op" id="5967699">(</span><span class="ident" id="5967700">h</span><span class="op" id="5967701">.</span><span class="ident" id="5967702">Comment</span><span class="op" id="5967709">)</span><span class="op" id="5967710">)</span><span class="op" id="5967711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967715">b</span>&nbsp;<span class="op" id="5967717">=</span>&nbsp;<span class="ident" id="5967719">b</span><span class="op" id="5967720">[</span><span class="num" id="5967721">4</span><span class="op" id="5967722">:</span><span class="op" id="5967723">]</span>&nbsp;<span class="comment" id="5967725">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967788">b</span><span class="op" id="5967789">.</span><span class="builtintype" id="5967790">uint32</span><span class="op" id="5967796">(</span><span class="ident" id="5967797">h</span><span class="op" id="5967798">.</span><span class="ident" id="5967799">ExternalAttrs</span><span class="op" id="5967812">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967816">if</span>&nbsp;<span class="ident" id="5967819">h</span><span class="op" id="5967820">.</span><span class="ident" id="5967821">offset</span>&nbsp;<span class="op" id="5967828">&gt;</span>&nbsp;<span class="ident" id="5967830">uint32max</span>&nbsp;<span class="op" id="5967840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967845">b</span><span class="op" id="5967846">.</span><span class="builtintype" id="5967847">uint32</span><span class="op" id="5967853">(</span><span class="ident" id="5967854">uint32max</span><span class="op" id="5967863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967867">}</span>&nbsp;<span class="keyword" id="5967869">else</span>&nbsp;<span class="op" id="5967874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967879">b</span><span class="op" id="5967880">.</span><span class="builtintype" id="5967881">uint32</span><span class="op" id="5967887">(</span><span class="builtintype" id="5967888">uint32</span><span class="op" id="5967894">(</span><span class="ident" id="5967895">h</span><span class="op" id="5967896">.</span><span class="ident" id="5967897">offset</span><span class="op" id="5967903">)</span><span class="op" id="5967904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967908">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967912">if</span>&nbsp;<span class="ident" id="5967915">_</span><span class="op" id="5967916">,</span>&nbsp;<span class="ident" id="5967918">err</span>&nbsp;<span class="op" id="5967922">:=</span>&nbsp;<span class="ident" id="5967925">w</span><span class="op" id="5967926">.</span><span class="ident" id="5967927">cw</span><span class="op" id="5967929">.</span><span class="ident" id="5967930">Write</span><span class="op" id="5967935">(</span><span class="ident" id="5967936">buf</span><span class="op" id="5967939">[</span><span class="op" id="5967940">:</span><span class="op" id="5967941">]</span><span class="op" id="5967942">)</span><span class="op" id="5967943">;</span>&nbsp;<span class="ident" id="5967945">err</span>&nbsp;<span class="op" id="5967949">!=</span>&nbsp;<span class="ident" id="5967952">nil</span>&nbsp;<span class="op" id="5967956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967961">return</span>&nbsp;<span class="ident" id="5967968">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5967978">if</span>&nbsp;<span class="ident" id="5967981">_</span><span class="op" id="5967982">,</span>&nbsp;<span class="ident" id="5967984">err</span>&nbsp;<span class="op" id="5967988">:=</span>&nbsp;<span class="ident" id="5967991">io</span><span class="op" id="5967993">.</span><span class="ident" id="5967994">WriteString</span><span class="op" id="5968005">(</span><span class="ident" id="5968006">w</span><span class="op" id="5968007">.</span><span class="ident" id="5968008">cw</span><span class="op" id="5968010">,</span>&nbsp;<span class="ident" id="5968012">h</span><span class="op" id="5968013">.</span><span class="ident" id="5968014">Name</span><span class="op" id="5968018">)</span><span class="op" id="5968019">;</span>&nbsp;<span class="ident" id="5968021">err</span>&nbsp;<span class="op" id="5968025">!=</span>&nbsp;<span class="ident" id="5968028">nil</span>&nbsp;<span class="op" id="5968032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968037">return</span>&nbsp;<span class="ident" id="5968044">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968054">if</span>&nbsp;<span class="ident" id="5968057">_</span><span class="op" id="5968058">,</span>&nbsp;<span class="ident" id="5968060">err</span>&nbsp;<span class="op" id="5968064">:=</span>&nbsp;<span class="ident" id="5968067">w</span><span class="op" id="5968068">.</span><span class="ident" id="5968069">cw</span><span class="op" id="5968071">.</span><span class="ident" id="5968072">Write</span><span class="op" id="5968077">(</span><span class="ident" id="5968078">h</span><span class="op" id="5968079">.</span><span class="ident" id="5968080">Extra</span><span class="op" id="5968085">)</span><span class="op" id="5968086">;</span>&nbsp;<span class="ident" id="5968088">err</span>&nbsp;<span class="op" id="5968092">!=</span>&nbsp;<span class="ident" id="5968095">nil</span>&nbsp;<span class="op" id="5968099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968104">return</span>&nbsp;<span class="ident" id="5968111">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968121">if</span>&nbsp;<span class="ident" id="5968124">_</span><span class="op" id="5968125">,</span>&nbsp;<span class="ident" id="5968127">err</span>&nbsp;<span class="op" id="5968131">:=</span>&nbsp;<span class="ident" id="5968134">io</span><span class="op" id="5968136">.</span><span class="ident" id="5968137">WriteString</span><span class="op" id="5968148">(</span><span class="ident" id="5968149">w</span><span class="op" id="5968150">.</span><span class="ident" id="5968151">cw</span><span class="op" id="5968153">,</span>&nbsp;<span class="ident" id="5968155">h</span><span class="op" id="5968156">.</span><span class="ident" id="5968157">Comment</span><span class="op" id="5968164">)</span><span class="op" id="5968165">;</span>&nbsp;<span class="ident" id="5968167">err</span>&nbsp;<span class="op" id="5968171">!=</span>&nbsp;<span class="ident" id="5968174">nil</span>&nbsp;<span class="op" id="5968178">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968183">return</span>&nbsp;<span class="ident" id="5968190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968202">end</span>&nbsp;<span class="op" id="5968206">:=</span>&nbsp;<span class="ident" id="5968209">w</span><span class="op" id="5968210">.</span><span class="ident" id="5968211">cw</span><span class="op" id="5968213">.</span><span class="ident" id="5968214">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968222">records</span>&nbsp;<span class="op" id="5968230">:=</span>&nbsp;<span class="ident" id="5968233">uint64</span><span class="op" id="5968239">(</span><span class="builtinfunc" id="5968240">len</span><span class="op" id="5968243">(</span><span class="ident" id="5968244">w</span><span class="op" id="5968245">.</span><span class="ident" id="5968246">dir</span><span class="op" id="5968249">)</span><span class="op" id="5968250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968253">size</span>&nbsp;<span class="op" id="5968258">:=</span>&nbsp;<span class="ident" id="5968261">uint64</span><span class="op" id="5968267">(</span><span class="ident" id="5968268">end</span>&nbsp;<span class="op" id="5968272">-</span>&nbsp;<span class="ident" id="5968274">start</span><span class="op" id="5968279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968282">offset</span>&nbsp;<span class="op" id="5968289">:=</span>&nbsp;<span class="ident" id="5968292">uint64</span><span class="op" id="5968298">(</span><span class="ident" id="5968299">start</span><span class="op" id="5968304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968308">if</span>&nbsp;<span class="ident" id="5968311">records</span>&nbsp;<span class="op" id="5968319">&gt;</span>&nbsp;<span class="ident" id="5968321">uint16max</span>&nbsp;<span class="op" id="5968331">||</span>&nbsp;<span class="ident" id="5968334">size</span>&nbsp;<span class="op" id="5968339">&gt;</span>&nbsp;<span class="ident" id="5968341">uint32max</span>&nbsp;<span class="op" id="5968351">||</span>&nbsp;<span class="ident" id="5968354">offset</span>&nbsp;<span class="op" id="5968361">&gt;</span>&nbsp;<span class="ident" id="5968363">uint32max</span>&nbsp;<span class="op" id="5968373">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5968377">var</span>&nbsp;<span class="ident" id="5968381">buf</span>&nbsp;<span class="op" id="5968385">[</span><span class="ident" id="5968386">directory64EndLen</span>&nbsp;<span class="op" id="5968404">+</span>&nbsp;<span class="ident" id="5968406">directory64LocLen</span><span class="op" id="5968423">]</span><span class="builtintype" id="5968424">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968431">b</span>&nbsp;<span class="op" id="5968433">:=</span>&nbsp;<span class="ident" id="5968436">writeBuf</span><span class="op" id="5968444">(</span><span class="ident" id="5968445">buf</span><span class="op" id="5968448">[</span><span class="op" id="5968449">:</span><span class="op" id="5968450">]</span><span class="op" id="5968451">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968456">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968499">b</span><span class="op" id="5968500">.</span><span class="builtintype" id="5968501">uint32</span><span class="op" id="5968507">(</span><span class="ident" id="5968508">directory64EndSignature</span><span class="op" id="5968531">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968535">b</span><span class="op" id="5968536">.</span><span class="ident" id="5968537">uint64</span><span class="op" id="5968543">(</span><span class="ident" id="5968544">directory64EndLen</span><span class="op" id="5968561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968565">b</span><span class="op" id="5968566">.</span><span class="builtintype" id="5968567">uint16</span><span class="op" id="5968573">(</span><span class="ident" id="5968574">zipVersion45</span><span class="op" id="5968586">)</span>&nbsp;<span class="comment" id="5968588">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968609">b</span><span class="op" id="5968610">.</span><span class="builtintype" id="5968611">uint16</span><span class="op" id="5968617">(</span><span class="ident" id="5968618">zipVersion45</span><span class="op" id="5968630">)</span>&nbsp;<span class="comment" id="5968632">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968663">b</span><span class="op" id="5968664">.</span><span class="builtintype" id="5968665">uint32</span><span class="op" id="5968671">(</span><span class="num" id="5968672">0</span><span class="op" id="5968673">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968686">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968711">b</span><span class="op" id="5968712">.</span><span class="builtintype" id="5968713">uint32</span><span class="op" id="5968719">(</span><span class="num" id="5968720">0</span><span class="op" id="5968721">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968734">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968798">b</span><span class="op" id="5968799">.</span><span class="ident" id="5968800">uint64</span><span class="op" id="5968806">(</span><span class="ident" id="5968807">records</span><span class="op" id="5968814">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968821">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968888">b</span><span class="op" id="5968889">.</span><span class="ident" id="5968890">uint64</span><span class="op" id="5968896">(</span><span class="ident" id="5968897">records</span><span class="op" id="5968904">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968911">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968965">b</span><span class="op" id="5968966">.</span><span class="ident" id="5968967">uint64</span><span class="op" id="5968973">(</span><span class="ident" id="5968974">size</span><span class="op" id="5968978">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5968988">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969023">b</span><span class="op" id="5969024">.</span><span class="ident" id="5969025">uint64</span><span class="op" id="5969031">(</span><span class="ident" id="5969032">offset</span><span class="op" id="5969038">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969046">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969130">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969174">b</span><span class="op" id="5969175">.</span><span class="builtintype" id="5969176">uint32</span><span class="op" id="5969182">(</span><span class="ident" id="5969183">directory64LocSignature</span><span class="op" id="5969206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969210">b</span><span class="op" id="5969211">.</span><span class="builtintype" id="5969212">uint32</span><span class="op" id="5969218">(</span><span class="num" id="5969219">0</span><span class="op" id="5969220">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969232">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969309">b</span><span class="op" id="5969310">.</span><span class="ident" id="5969311">uint64</span><span class="op" id="5969317">(</span><span class="ident" id="5969318">uint64</span><span class="op" id="5969324">(</span><span class="ident" id="5969325">end</span><span class="op" id="5969328">)</span><span class="op" id="5969329">)</span>&nbsp;<span class="comment" id="5969331">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969397">b</span><span class="op" id="5969398">.</span><span class="builtintype" id="5969399">uint32</span><span class="op" id="5969405">(</span><span class="num" id="5969406">1</span><span class="op" id="5969407">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969419">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969447">if</span>&nbsp;<span class="ident" id="5969450">_</span><span class="op" id="5969451">,</span>&nbsp;<span class="ident" id="5969453">err</span>&nbsp;<span class="op" id="5969457">:=</span>&nbsp;<span class="ident" id="5969460">w</span><span class="op" id="5969461">.</span><span class="ident" id="5969462">cw</span><span class="op" id="5969464">.</span><span class="ident" id="5969465">Write</span><span class="op" id="5969470">(</span><span class="ident" id="5969471">buf</span><span class="op" id="5969474">[</span><span class="op" id="5969475">:</span><span class="op" id="5969476">]</span><span class="op" id="5969477">)</span><span class="op" id="5969478">;</span>&nbsp;<span class="ident" id="5969480">err</span>&nbsp;<span class="op" id="5969484">!=</span>&nbsp;<span class="ident" id="5969487">nil</span>&nbsp;<span class="op" id="5969491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969496">return</span>&nbsp;<span class="ident" id="5969503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969514">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969577">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969627">records</span>&nbsp;<span class="op" id="5969635">=</span>&nbsp;<span class="ident" id="5969637">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969649">size</span>&nbsp;<span class="op" id="5969654">=</span>&nbsp;<span class="ident" id="5969656">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969668">offset</span>&nbsp;<span class="op" id="5969675">=</span>&nbsp;<span class="ident" id="5969677">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969692">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5969713">var</span>&nbsp;<span class="ident" id="5969717">buf</span>&nbsp;<span class="op" id="5969721">[</span><span class="ident" id="5969722">directoryEndLen</span><span class="op" id="5969737">]</span><span class="builtintype" id="5969738">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969744">b</span>&nbsp;<span class="op" id="5969746">:=</span>&nbsp;<span class="ident" id="5969749">writeBuf</span><span class="op" id="5969757">(</span><span class="ident" id="5969758">buf</span><span class="op" id="5969761">[</span><span class="op" id="5969762">:</span><span class="op" id="5969763">]</span><span class="op" id="5969764">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969767">b</span><span class="op" id="5969768">.</span><span class="builtintype" id="5969769">uint32</span><span class="op" id="5969775">(</span><span class="builtintype" id="5969776">uint32</span><span class="op" id="5969782">(</span><span class="ident" id="5969783">directoryEndSignature</span><span class="op" id="5969804">)</span><span class="op" id="5969805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969808">b</span>&nbsp;<span class="op" id="5969810">=</span>&nbsp;<span class="ident" id="5969812">b</span><span class="op" id="5969813">[</span><span class="num" id="5969814">4</span><span class="op" id="5969815">:</span><span class="op" id="5969816">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5969834">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969894">b</span><span class="op" id="5969895">.</span><span class="builtintype" id="5969896">uint16</span><span class="op" id="5969902">(</span><span class="builtintype" id="5969903">uint16</span><span class="op" id="5969909">(</span><span class="ident" id="5969910">records</span><span class="op" id="5969917">)</span><span class="op" id="5969918">)</span>&nbsp;<span class="comment" id="5969920">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5969952">b</span><span class="op" id="5969953">.</span><span class="builtintype" id="5969954">uint16</span><span class="op" id="5969960">(</span><span class="builtintype" id="5969961">uint16</span><span class="op" id="5969967">(</span><span class="ident" id="5969968">records</span><span class="op" id="5969975">)</span><span class="op" id="5969976">)</span>&nbsp;<span class="comment" id="5969978">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970006">b</span><span class="op" id="5970007">.</span><span class="builtintype" id="5970008">uint32</span><span class="op" id="5970014">(</span><span class="builtintype" id="5970015">uint32</span><span class="op" id="5970021">(</span><span class="ident" id="5970022">size</span><span class="op" id="5970026">)</span><span class="op" id="5970027">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5970032">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970054">b</span><span class="op" id="5970055">.</span><span class="builtintype" id="5970056">uint32</span><span class="op" id="5970062">(</span><span class="builtintype" id="5970063">uint32</span><span class="op" id="5970069">(</span><span class="ident" id="5970070">offset</span><span class="op" id="5970076">)</span><span class="op" id="5970077">)</span>&nbsp;&nbsp;<span class="comment" id="5970080">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970103">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970145">if</span>&nbsp;<span class="ident" id="5970148">_</span><span class="op" id="5970149">,</span>&nbsp;<span class="ident" id="5970151">err</span>&nbsp;<span class="op" id="5970155">:=</span>&nbsp;<span class="ident" id="5970158">w</span><span class="op" id="5970159">.</span><span class="ident" id="5970160">cw</span><span class="op" id="5970162">.</span><span class="ident" id="5970163">Write</span><span class="op" id="5970168">(</span><span class="ident" id="5970169">buf</span><span class="op" id="5970172">[</span><span class="op" id="5970173">:</span><span class="op" id="5970174">]</span><span class="op" id="5970175">)</span><span class="op" id="5970176">;</span>&nbsp;<span class="ident" id="5970178">err</span>&nbsp;<span class="op" id="5970182">!=</span>&nbsp;<span class="ident" id="5970185">nil</span>&nbsp;<span class="op" id="5970189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970193">return</span>&nbsp;<span class="ident" id="5970200">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970205">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970209">return</span>&nbsp;<span class="ident" id="5970216">w</span><span class="op" id="5970217">.</span><span class="ident" id="5970218">cw</span><span class="op" id="5970220">.</span><span class="ident" id="5970221">w</span><span class="op" id="5970222">.</span><span class="op" id="5970223">(</span><span class="op" id="5970224">*</span><span class="ident" id="5970225">bufio</span><span class="op" id="5970230">.</span><span class="ident" id="5970231">Writer</span><span class="op" id="5970237">)</span><span class="op" id="5970238">.</span><span class="ident" id="5970239">Flush</span><span class="op" id="5970244">(</span><span class="op" id="5970245">)</span><br>
<span class="lineno"></span><span class="op" id="5970247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5970250">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="5970313">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5970382">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="5970450">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5970517">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="5970529">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="5970601">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5970644">func</span>&nbsp;<span class="op" id="5970649">(</span><span class="ident" id="5970650">w</span>&nbsp;<span class="op" id="5970652">*</span><span class="ident" id="5970653">Writer</span><span class="op" id="5970659">)</span>&nbsp;<span class="ident" id="5970661">Create</span><span class="op" id="5970667">(</span><span class="ident" id="5970668">name</span>&nbsp;<span class="builtintype" id="5970673">string</span><span class="op" id="5970679">)</span>&nbsp;<span class="op" id="5970681">(</span><span class="ident" id="5970682">io</span><span class="op" id="5970684">.</span><span class="ident" id="5970685">Writer</span><span class="op" id="5970691">,</span>&nbsp;<span class="builtintype" id="5970693">error</span><span class="op" id="5970698">)</span>&nbsp;<span class="op" id="5970700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970703">header</span>&nbsp;<span class="op" id="5970710">:=</span>&nbsp;<span class="op" id="5970713">&amp;</span><span class="ident" id="5970714">FileHeader</span><span class="op" id="5970724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970728">Name</span><span class="op" id="5970732">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5970736">name</span><span class="op" id="5970740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5970744">Method</span><span class="op" id="5970750">:</span>&nbsp;<span class="ident" id="5970752">Deflate</span><span class="op" id="5970759">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5970765">return</span>&nbsp;<span class="ident" id="5970772">w</span><span class="op" id="5970773">.</span><span class="ident" id="5970774">CreateHeader</span><span class="op" id="5970786">(</span><span class="ident" id="5970787">header</span><span class="op" id="5970793">)</span><br>
<span class="lineno"></span><span class="op" id="5970795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5970798">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="5970872">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="5970898">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="5970967">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="5971039">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5971082">func</span>&nbsp;<span class="op" id="5971087">(</span><span class="ident" id="5971088">w</span>&nbsp;<span class="op" id="5971090">*</span><span class="ident" id="5971091">Writer</span><span class="op" id="5971097">)</span>&nbsp;<span class="ident" id="5971099">CreateHeader</span><span class="op" id="5971111">(</span><span class="ident" id="5971112">fh</span>&nbsp;<span class="op" id="5971115">*</span><span class="ident" id="5971116">FileHeader</span><span class="op" id="5971126">)</span>&nbsp;<span class="op" id="5971128">(</span><span class="ident" id="5971129">io</span><span class="op" id="5971131">.</span><span class="ident" id="5971132">Writer</span><span class="op" id="5971138">,</span>&nbsp;<span class="builtintype" id="5971140">error</span><span class="op" id="5971145">)</span>&nbsp;<span class="op" id="5971147">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971150">if</span>&nbsp;<span class="ident" id="5971153">w</span><span class="op" id="5971154">.</span><span class="ident" id="5971155">last</span>&nbsp;<span class="op" id="5971160">!=</span>&nbsp;<span class="ident" id="5971163">nil</span>&nbsp;<span class="op" id="5971167">&amp;&amp;</span>&nbsp;<span class="op" id="5971170">!</span><span class="ident" id="5971171">w</span><span class="op" id="5971172">.</span><span class="ident" id="5971173">last</span><span class="op" id="5971177">.</span><span class="ident" id="5971178">closed</span>&nbsp;<span class="op" id="5971185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971189">if</span>&nbsp;<span class="ident" id="5971192">err</span>&nbsp;<span class="op" id="5971196">:=</span>&nbsp;<span class="ident" id="5971199">w</span><span class="op" id="5971200">.</span><span class="ident" id="5971201">last</span><span class="op" id="5971205">.</span><span class="builtinfunc" id="5971206">close</span><span class="op" id="5971211">(</span><span class="op" id="5971212">)</span><span class="op" id="5971213">;</span>&nbsp;<span class="ident" id="5971215">err</span>&nbsp;<span class="op" id="5971219">!=</span>&nbsp;<span class="ident" id="5971222">nil</span>&nbsp;<span class="op" id="5971226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971231">return</span>&nbsp;<span class="ident" id="5971238">nil</span><span class="op" id="5971241">,</span>&nbsp;<span class="ident" id="5971243">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971252">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971256">fh</span><span class="op" id="5971258">.</span><span class="ident" id="5971259">Flags</span>&nbsp;<span class="op" id="5971265">|=</span>&nbsp;<span class="num" id="5971268">0x8</span>&nbsp;<span class="comment" id="5971272">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971309">fh</span><span class="op" id="5971311">.</span><span class="ident" id="5971312">CreatorVersion</span>&nbsp;<span class="op" id="5971327">=</span>&nbsp;<span class="ident" id="5971329">fh</span><span class="op" id="5971331">.</span><span class="ident" id="5971332">CreatorVersion</span><span class="op" id="5971346">&amp;</span><span class="num" id="5971347">0xff00</span>&nbsp;<span class="op" id="5971354">|</span>&nbsp;<span class="ident" id="5971356">zipVersion20</span>&nbsp;<span class="comment" id="5971369">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971401">fh</span><span class="op" id="5971403">.</span><span class="ident" id="5971404">ReaderVersion</span>&nbsp;<span class="op" id="5971418">=</span>&nbsp;<span class="ident" id="5971420">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971435">fw</span>&nbsp;<span class="op" id="5971438">:=</span>&nbsp;<span class="op" id="5971441">&amp;</span><span class="ident" id="5971442">fileWriter</span><span class="op" id="5971452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971456">zipw</span><span class="op" id="5971460">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971467">w</span><span class="op" id="5971468">.</span><span class="ident" id="5971469">cw</span><span class="op" id="5971471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971475">compCount</span><span class="op" id="5971484">:</span>&nbsp;<span class="op" id="5971486">&amp;</span><span class="ident" id="5971487">countWriter</span><span class="op" id="5971498">{</span><span class="ident" id="5971499">w</span><span class="op" id="5971500">:</span>&nbsp;<span class="ident" id="5971502">w</span><span class="op" id="5971503">.</span><span class="ident" id="5971504">cw</span><span class="op" id="5971506">}</span><span class="op" id="5971507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971511">crc32</span><span class="op" id="5971516">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971522">crc32</span><span class="op" id="5971527">.</span><span class="ident" id="5971528">NewIEEE</span><span class="op" id="5971535">(</span><span class="op" id="5971536">)</span><span class="op" id="5971537">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971543">comp</span>&nbsp;<span class="op" id="5971548">:=</span>&nbsp;<span class="ident" id="5971551">compressor</span><span class="op" id="5971561">(</span><span class="ident" id="5971562">fh</span><span class="op" id="5971564">.</span><span class="ident" id="5971565">Method</span><span class="op" id="5971571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971574">if</span>&nbsp;<span class="ident" id="5971577">comp</span>&nbsp;<span class="op" id="5971582">==</span>&nbsp;<span class="ident" id="5971585">nil</span>&nbsp;<span class="op" id="5971589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971593">return</span>&nbsp;<span class="ident" id="5971600">nil</span><span class="op" id="5971603">,</span>&nbsp;<span class="ident" id="5971605">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971619">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971622">var</span>&nbsp;<span class="ident" id="5971626">err</span>&nbsp;<span class="builtintype" id="5971630">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971637">fw</span><span class="op" id="5971639">.</span><span class="ident" id="5971640">comp</span><span class="op" id="5971644">,</span>&nbsp;<span class="ident" id="5971646">err</span>&nbsp;<span class="op" id="5971650">=</span>&nbsp;<span class="ident" id="5971652">comp</span><span class="op" id="5971656">(</span><span class="ident" id="5971657">fw</span><span class="op" id="5971659">.</span><span class="ident" id="5971660">compCount</span><span class="op" id="5971669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971672">if</span>&nbsp;<span class="ident" id="5971675">err</span>&nbsp;<span class="op" id="5971679">!=</span>&nbsp;<span class="ident" id="5971682">nil</span>&nbsp;<span class="op" id="5971686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971690">return</span>&nbsp;<span class="ident" id="5971697">nil</span><span class="op" id="5971700">,</span>&nbsp;<span class="ident" id="5971702">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971707">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971710">fw</span><span class="op" id="5971712">.</span><span class="ident" id="5971713">rawCount</span>&nbsp;<span class="op" id="5971722">=</span>&nbsp;<span class="op" id="5971724">&amp;</span><span class="ident" id="5971725">countWriter</span><span class="op" id="5971736">{</span><span class="ident" id="5971737">w</span><span class="op" id="5971738">:</span>&nbsp;<span class="ident" id="5971740">fw</span><span class="op" id="5971742">.</span><span class="ident" id="5971743">comp</span><span class="op" id="5971747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971751">h</span>&nbsp;<span class="op" id="5971753">:=</span>&nbsp;<span class="op" id="5971756">&amp;</span><span class="ident" id="5971757">header</span><span class="op" id="5971763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971767">FileHeader</span><span class="op" id="5971777">:</span>&nbsp;<span class="ident" id="5971779">fh</span><span class="op" id="5971781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971785">offset</span><span class="op" id="5971791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5971797">uint64</span><span class="op" id="5971803">(</span><span class="ident" id="5971804">w</span><span class="op" id="5971805">.</span><span class="ident" id="5971806">cw</span><span class="op" id="5971808">.</span><span class="ident" id="5971809">count</span><span class="op" id="5971814">)</span><span class="op" id="5971815">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971821">w</span><span class="op" id="5971822">.</span><span class="ident" id="5971823">dir</span>&nbsp;<span class="op" id="5971827">=</span>&nbsp;<span class="builtinfunc" id="5971829">append</span><span class="op" id="5971835">(</span><span class="ident" id="5971836">w</span><span class="op" id="5971837">.</span><span class="ident" id="5971838">dir</span><span class="op" id="5971841">,</span>&nbsp;<span class="ident" id="5971843">h</span><span class="op" id="5971844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971847">fw</span><span class="op" id="5971849">.</span><span class="ident" id="5971850">header</span>&nbsp;<span class="op" id="5971857">=</span>&nbsp;<span class="ident" id="5971859">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971863">if</span>&nbsp;<span class="ident" id="5971866">err</span>&nbsp;<span class="op" id="5971870">:=</span>&nbsp;<span class="ident" id="5971873">writeHeader</span><span class="op" id="5971884">(</span><span class="ident" id="5971885">w</span><span class="op" id="5971886">.</span><span class="ident" id="5971887">cw</span><span class="op" id="5971889">,</span>&nbsp;<span class="ident" id="5971891">fh</span><span class="op" id="5971893">)</span><span class="op" id="5971894">;</span>&nbsp;<span class="ident" id="5971896">err</span>&nbsp;<span class="op" id="5971900">!=</span>&nbsp;<span class="ident" id="5971903">nil</span>&nbsp;<span class="op" id="5971907">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971911">return</span>&nbsp;<span class="ident" id="5971918">nil</span><span class="op" id="5971921">,</span>&nbsp;<span class="ident" id="5971923">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971932">w</span><span class="op" id="5971933">.</span><span class="ident" id="5971934">last</span>&nbsp;<span class="op" id="5971939">=</span>&nbsp;<span class="ident" id="5971941">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971945">return</span>&nbsp;<span class="ident" id="5971952">fw</span><span class="op" id="5971954">,</span>&nbsp;<span class="ident" id="5971956">nil</span><br>
<span class="lineno">230</span><span class="op" id="5971960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5971963">func</span>&nbsp;<span class="ident" id="5971968">writeHeader</span><span class="op" id="5971979">(</span><span class="ident" id="5971980">w</span>&nbsp;<span class="ident" id="5971982">io</span><span class="op" id="5971984">.</span><span class="ident" id="5971985">Writer</span><span class="op" id="5971991">,</span>&nbsp;<span class="ident" id="5971993">h</span>&nbsp;<span class="op" id="5971995">*</span><span class="ident" id="5971996">FileHeader</span><span class="op" id="5972006">)</span>&nbsp;<span class="builtintype" id="5972008">error</span>&nbsp;<span class="op" id="5972014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972017">var</span>&nbsp;<span class="ident" id="5972021">buf</span>&nbsp;<span class="op" id="5972025">[</span><span class="ident" id="5972026">fileHeaderLen</span><span class="op" id="5972039">]</span><span class="builtintype" id="5972040">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972046">b</span>&nbsp;<span class="op" id="5972048">:=</span>&nbsp;<span class="ident" id="5972051">writeBuf</span><span class="op" id="5972059">(</span><span class="ident" id="5972060">buf</span><span class="op" id="5972063">[</span><span class="op" id="5972064">:</span><span class="op" id="5972065">]</span><span class="op" id="5972066">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972069">b</span><span class="op" id="5972070">.</span><span class="builtintype" id="5972071">uint32</span><span class="op" id="5972077">(</span><span class="builtintype" id="5972078">uint32</span><span class="op" id="5972084">(</span><span class="ident" id="5972085">fileHeaderSignature</span><span class="op" id="5972104">)</span><span class="op" id="5972105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972108">b</span><span class="op" id="5972109">.</span><span class="builtintype" id="5972110">uint16</span><span class="op" id="5972116">(</span><span class="ident" id="5972117">h</span><span class="op" id="5972118">.</span><span class="ident" id="5972119">ReaderVersion</span><span class="op" id="5972132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972135">b</span><span class="op" id="5972136">.</span><span class="builtintype" id="5972137">uint16</span><span class="op" id="5972143">(</span><span class="ident" id="5972144">h</span><span class="op" id="5972145">.</span><span class="ident" id="5972146">Flags</span><span class="op" id="5972151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972154">b</span><span class="op" id="5972155">.</span><span class="builtintype" id="5972156">uint16</span><span class="op" id="5972162">(</span><span class="ident" id="5972163">h</span><span class="op" id="5972164">.</span><span class="ident" id="5972165">Method</span><span class="op" id="5972171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972174">b</span><span class="op" id="5972175">.</span><span class="builtintype" id="5972176">uint16</span><span class="op" id="5972182">(</span><span class="ident" id="5972183">h</span><span class="op" id="5972184">.</span><span class="ident" id="5972185">ModifiedTime</span><span class="op" id="5972197">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972200">b</span><span class="op" id="5972201">.</span><span class="builtintype" id="5972202">uint16</span><span class="op" id="5972208">(</span><span class="ident" id="5972209">h</span><span class="op" id="5972210">.</span><span class="ident" id="5972211">ModifiedDate</span><span class="op" id="5972223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972226">b</span><span class="op" id="5972227">.</span><span class="builtintype" id="5972228">uint32</span><span class="op" id="5972234">(</span><span class="num" id="5972235">0</span><span class="op" id="5972236">)</span>&nbsp;<span class="comment" id="5972238">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972288">b</span><span class="op" id="5972289">.</span><span class="builtintype" id="5972290">uint32</span><span class="op" id="5972296">(</span><span class="num" id="5972297">0</span><span class="op" id="5972298">)</span>&nbsp;<span class="comment" id="5972300">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972321">b</span><span class="op" id="5972322">.</span><span class="builtintype" id="5972323">uint32</span><span class="op" id="5972329">(</span><span class="num" id="5972330">0</span><span class="op" id="5972331">)</span>&nbsp;<span class="comment" id="5972333">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972374">b</span><span class="op" id="5972375">.</span><span class="builtintype" id="5972376">uint16</span><span class="op" id="5972382">(</span><span class="builtintype" id="5972383">uint16</span><span class="op" id="5972389">(</span><span class="builtinfunc" id="5972390">len</span><span class="op" id="5972393">(</span><span class="ident" id="5972394">h</span><span class="op" id="5972395">.</span><span class="ident" id="5972396">Name</span><span class="op" id="5972400">)</span><span class="op" id="5972401">)</span><span class="op" id="5972402">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972405">b</span><span class="op" id="5972406">.</span><span class="builtintype" id="5972407">uint16</span><span class="op" id="5972413">(</span><span class="builtintype" id="5972414">uint16</span><span class="op" id="5972420">(</span><span class="builtinfunc" id="5972421">len</span><span class="op" id="5972424">(</span><span class="ident" id="5972425">h</span><span class="op" id="5972426">.</span><span class="ident" id="5972427">Extra</span><span class="op" id="5972432">)</span><span class="op" id="5972433">)</span><span class="op" id="5972434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972437">if</span>&nbsp;<span class="ident" id="5972440">_</span><span class="op" id="5972441">,</span>&nbsp;<span class="ident" id="5972443">err</span>&nbsp;<span class="op" id="5972447">:=</span>&nbsp;<span class="ident" id="5972450">w</span><span class="op" id="5972451">.</span><span class="ident" id="5972452">Write</span><span class="op" id="5972457">(</span><span class="ident" id="5972458">buf</span><span class="op" id="5972461">[</span><span class="op" id="5972462">:</span><span class="op" id="5972463">]</span><span class="op" id="5972464">)</span><span class="op" id="5972465">;</span>&nbsp;<span class="ident" id="5972467">err</span>&nbsp;<span class="op" id="5972471">!=</span>&nbsp;<span class="ident" id="5972474">nil</span>&nbsp;<span class="op" id="5972478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972482">return</span>&nbsp;<span class="ident" id="5972489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972497">if</span>&nbsp;<span class="ident" id="5972500">_</span><span class="op" id="5972501">,</span>&nbsp;<span class="ident" id="5972503">err</span>&nbsp;<span class="op" id="5972507">:=</span>&nbsp;<span class="ident" id="5972510">io</span><span class="op" id="5972512">.</span><span class="ident" id="5972513">WriteString</span><span class="op" id="5972524">(</span><span class="ident" id="5972525">w</span><span class="op" id="5972526">,</span>&nbsp;<span class="ident" id="5972528">h</span><span class="op" id="5972529">.</span><span class="ident" id="5972530">Name</span><span class="op" id="5972534">)</span><span class="op" id="5972535">;</span>&nbsp;<span class="ident" id="5972537">err</span>&nbsp;<span class="op" id="5972541">!=</span>&nbsp;<span class="ident" id="5972544">nil</span>&nbsp;<span class="op" id="5972548">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972552">return</span>&nbsp;<span class="ident" id="5972559">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972567">_</span><span class="op" id="5972568">,</span>&nbsp;<span class="ident" id="5972570">err</span>&nbsp;<span class="op" id="5972574">:=</span>&nbsp;<span class="ident" id="5972577">w</span><span class="op" id="5972578">.</span><span class="ident" id="5972579">Write</span><span class="op" id="5972584">(</span><span class="ident" id="5972585">h</span><span class="op" id="5972586">.</span><span class="ident" id="5972587">Extra</span><span class="op" id="5972592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972595">return</span>&nbsp;<span class="ident" id="5972602">err</span><br>
<span class="lineno"></span><span class="op" id="5972606">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5972609">type</span>&nbsp;<span class="ident" id="5972614">fileWriter</span>&nbsp;<span class="keyword" id="5972625">struct</span>&nbsp;<span class="op" id="5972632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972635">*</span><span class="ident" id="5972636">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972644">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972654">io</span><span class="op" id="5972656">.</span><span class="ident" id="5972657">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972665">rawCount</span>&nbsp;&nbsp;<span class="op" id="5972675">*</span><span class="ident" id="5972676">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972689">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972699">io</span><span class="op" id="5972701">.</span><span class="ident" id="5972702">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972715">compCount</span>&nbsp;<span class="op" id="5972725">*</span><span class="ident" id="5972726">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972739">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5972749">hash</span><span class="op" id="5972753">.</span><span class="ident" id="5972754">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972762">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5972772">bool</span><br>
<span class="lineno"></span><span class="op" id="5972777">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5972780">func</span>&nbsp;<span class="op" id="5972785">(</span><span class="ident" id="5972786">w</span>&nbsp;<span class="op" id="5972788">*</span><span class="ident" id="5972789">fileWriter</span><span class="op" id="5972799">)</span>&nbsp;<span class="ident" id="5972801">Write</span><span class="op" id="5972806">(</span><span class="ident" id="5972807">p</span>&nbsp;<span class="op" id="5972809">[</span><span class="op" id="5972810">]</span><span class="builtintype" id="5972811">byte</span><span class="op" id="5972815">)</span>&nbsp;<span class="op" id="5972817">(</span><span class="builtintype" id="5972818">int</span><span class="op" id="5972821">,</span>&nbsp;<span class="builtintype" id="5972823">error</span><span class="op" id="5972828">)</span>&nbsp;<span class="op" id="5972830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972833">if</span>&nbsp;<span class="ident" id="5972836">w</span><span class="op" id="5972837">.</span><span class="ident" id="5972838">closed</span>&nbsp;<span class="op" id="5972845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972849">return</span>&nbsp;<span class="num" id="5972856">0</span><span class="op" id="5972857">,</span>&nbsp;<span class="ident" id="5972859">errors</span><span class="op" id="5972865">.</span><span class="ident" id="5972866">New</span><span class="op" id="5972869">(</span><span class="string" id="5972870">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="5972897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972900">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972903">w</span><span class="op" id="5972904">.</span><span class="ident" id="5972905">crc32</span><span class="op" id="5972910">.</span><span class="ident" id="5972911">Write</span><span class="op" id="5972916">(</span><span class="ident" id="5972917">p</span><span class="op" id="5972918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972921">return</span>&nbsp;<span class="ident" id="5972928">w</span><span class="op" id="5972929">.</span><span class="ident" id="5972930">rawCount</span><span class="op" id="5972938">.</span><span class="ident" id="5972939">Write</span><span class="op" id="5972944">(</span><span class="ident" id="5972945">p</span><span class="op" id="5972946">)</span><br>
<span class="lineno"></span><span class="op" id="5972948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5972951">func</span>&nbsp;<span class="op" id="5972956">(</span><span class="ident" id="5972957">w</span>&nbsp;<span class="op" id="5972959">*</span><span class="ident" id="5972960">fileWriter</span><span class="op" id="5972970">)</span>&nbsp;<span class="builtinfunc" id="5972972">close</span><span class="op" id="5972977">(</span><span class="op" id="5972978">)</span>&nbsp;<span class="builtintype" id="5972980">error</span>&nbsp;<span class="op" id="5972986">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972989">if</span>&nbsp;<span class="ident" id="5972992">w</span><span class="op" id="5972993">.</span><span class="ident" id="5972994">closed</span>&nbsp;<span class="op" id="5973001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973005">return</span>&nbsp;<span class="ident" id="5973012">errors</span><span class="op" id="5973018">.</span><span class="ident" id="5973019">New</span><span class="op" id="5973022">(</span><span class="string" id="5973023">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="5973047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973053">w</span><span class="op" id="5973054">.</span><span class="ident" id="5973055">closed</span>&nbsp;<span class="op" id="5973062">=</span>&nbsp;<span class="builtintype" id="5973064">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973070">if</span>&nbsp;<span class="ident" id="5973073">err</span>&nbsp;<span class="op" id="5973077">:=</span>&nbsp;<span class="ident" id="5973080">w</span><span class="op" id="5973081">.</span><span class="ident" id="5973082">comp</span><span class="op" id="5973086">.</span><span class="ident" id="5973087">Close</span><span class="op" id="5973092">(</span><span class="op" id="5973093">)</span><span class="op" id="5973094">;</span>&nbsp;<span class="ident" id="5973096">err</span>&nbsp;<span class="op" id="5973100">!=</span>&nbsp;<span class="ident" id="5973103">nil</span>&nbsp;<span class="op" id="5973107">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973111">return</span>&nbsp;<span class="ident" id="5973118">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973127">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973149">fh</span>&nbsp;<span class="op" id="5973152">:=</span>&nbsp;<span class="ident" id="5973155">w</span><span class="op" id="5973156">.</span><span class="ident" id="5973157">header</span><span class="op" id="5973163">.</span><span class="ident" id="5973164">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973176">fh</span><span class="op" id="5973178">.</span><span class="ident" id="5973179">CRC32</span>&nbsp;<span class="op" id="5973185">=</span>&nbsp;<span class="ident" id="5973187">w</span><span class="op" id="5973188">.</span><span class="ident" id="5973189">crc32</span><span class="op" id="5973194">.</span><span class="ident" id="5973195">Sum32</span><span class="op" id="5973200">(</span><span class="op" id="5973201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973204">fh</span><span class="op" id="5973206">.</span><span class="ident" id="5973207">CompressedSize64</span>&nbsp;<span class="op" id="5973224">=</span>&nbsp;<span class="ident" id="5973226">uint64</span><span class="op" id="5973232">(</span><span class="ident" id="5973233">w</span><span class="op" id="5973234">.</span><span class="ident" id="5973235">compCount</span><span class="op" id="5973244">.</span><span class="ident" id="5973245">count</span><span class="op" id="5973250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973253">fh</span><span class="op" id="5973255">.</span><span class="ident" id="5973256">UncompressedSize64</span>&nbsp;<span class="op" id="5973275">=</span>&nbsp;<span class="ident" id="5973277">uint64</span><span class="op" id="5973283">(</span><span class="ident" id="5973284">w</span><span class="op" id="5973285">.</span><span class="ident" id="5973286">rawCount</span><span class="op" id="5973294">.</span><span class="ident" id="5973295">count</span><span class="op" id="5973300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973304">if</span>&nbsp;<span class="ident" id="5973307">fh</span><span class="op" id="5973309">.</span><span class="ident" id="5973310">isZip64</span><span class="op" id="5973317">(</span><span class="op" id="5973318">)</span>&nbsp;<span class="op" id="5973320">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973324">fh</span><span class="op" id="5973326">.</span><span class="ident" id="5973327">CompressedSize</span>&nbsp;<span class="op" id="5973342">=</span>&nbsp;<span class="ident" id="5973344">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973356">fh</span><span class="op" id="5973358">.</span><span class="ident" id="5973359">UncompressedSize</span>&nbsp;<span class="op" id="5973376">=</span>&nbsp;<span class="ident" id="5973378">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973390">fh</span><span class="op" id="5973392">.</span><span class="ident" id="5973393">ReaderVersion</span>&nbsp;<span class="op" id="5973407">=</span>&nbsp;<span class="ident" id="5973409">zipVersion45</span>&nbsp;<span class="comment" id="5973422">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973475">}</span>&nbsp;<span class="keyword" id="5973477">else</span>&nbsp;<span class="op" id="5973482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973486">fh</span><span class="op" id="5973488">.</span><span class="ident" id="5973489">CompressedSize</span>&nbsp;<span class="op" id="5973504">=</span>&nbsp;<span class="builtintype" id="5973506">uint32</span><span class="op" id="5973512">(</span><span class="ident" id="5973513">fh</span><span class="op" id="5973515">.</span><span class="ident" id="5973516">CompressedSize64</span><span class="op" id="5973532">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973536">fh</span><span class="op" id="5973538">.</span><span class="ident" id="5973539">UncompressedSize</span>&nbsp;<span class="op" id="5973556">=</span>&nbsp;<span class="builtintype" id="5973558">uint32</span><span class="op" id="5973564">(</span><span class="ident" id="5973565">fh</span><span class="op" id="5973567">.</span><span class="ident" id="5973568">UncompressedSize64</span><span class="op" id="5973586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973593">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973660">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973720">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973784">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5973849">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973913">var</span>&nbsp;<span class="ident" id="5973917">buf</span>&nbsp;<span class="op" id="5973921">[</span><span class="op" id="5973922">]</span><span class="builtintype" id="5973923">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973929">if</span>&nbsp;<span class="ident" id="5973932">fh</span><span class="op" id="5973934">.</span><span class="ident" id="5973935">isZip64</span><span class="op" id="5973942">(</span><span class="op" id="5973943">)</span>&nbsp;<span class="op" id="5973945">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973949">buf</span>&nbsp;<span class="op" id="5973953">=</span>&nbsp;<span class="builtinfunc" id="5973955">make</span><span class="op" id="5973959">(</span><span class="op" id="5973960">[</span><span class="op" id="5973961">]</span><span class="builtintype" id="5973962">byte</span><span class="op" id="5973966">,</span>&nbsp;<span class="ident" id="5973968">dataDescriptor64Len</span><span class="op" id="5973987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973990">}</span>&nbsp;<span class="keyword" id="5973992">else</span>&nbsp;<span class="op" id="5973997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974001">buf</span>&nbsp;<span class="op" id="5974005">=</span>&nbsp;<span class="builtinfunc" id="5974007">make</span><span class="op" id="5974011">(</span><span class="op" id="5974012">[</span><span class="op" id="5974013">]</span><span class="builtintype" id="5974014">byte</span><span class="op" id="5974018">,</span>&nbsp;<span class="ident" id="5974020">dataDescriptorLen</span><span class="op" id="5974037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974043">b</span>&nbsp;<span class="op" id="5974045">:=</span>&nbsp;<span class="ident" id="5974048">writeBuf</span><span class="op" id="5974056">(</span><span class="ident" id="5974057">buf</span><span class="op" id="5974060">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974063">b</span><span class="op" id="5974064">.</span><span class="builtintype" id="5974065">uint32</span><span class="op" id="5974071">(</span><span class="ident" id="5974072">dataDescriptorSignature</span><span class="op" id="5974095">)</span>&nbsp;<span class="comment" id="5974097">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974137">b</span><span class="op" id="5974138">.</span><span class="builtintype" id="5974139">uint32</span><span class="op" id="5974145">(</span><span class="ident" id="5974146">fh</span><span class="op" id="5974148">.</span><span class="ident" id="5974149">CRC32</span><span class="op" id="5974154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974157">if</span>&nbsp;<span class="ident" id="5974160">fh</span><span class="op" id="5974162">.</span><span class="ident" id="5974163">isZip64</span><span class="op" id="5974170">(</span><span class="op" id="5974171">)</span>&nbsp;<span class="op" id="5974173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974177">b</span><span class="op" id="5974178">.</span><span class="ident" id="5974179">uint64</span><span class="op" id="5974185">(</span><span class="ident" id="5974186">fh</span><span class="op" id="5974188">.</span><span class="ident" id="5974189">CompressedSize64</span><span class="op" id="5974205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974209">b</span><span class="op" id="5974210">.</span><span class="ident" id="5974211">uint64</span><span class="op" id="5974217">(</span><span class="ident" id="5974218">fh</span><span class="op" id="5974220">.</span><span class="ident" id="5974221">UncompressedSize64</span><span class="op" id="5974239">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974242">}</span>&nbsp;<span class="keyword" id="5974244">else</span>&nbsp;<span class="op" id="5974249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974253">b</span><span class="op" id="5974254">.</span><span class="builtintype" id="5974255">uint32</span><span class="op" id="5974261">(</span><span class="ident" id="5974262">fh</span><span class="op" id="5974264">.</span><span class="ident" id="5974265">CompressedSize</span><span class="op" id="5974279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974283">b</span><span class="op" id="5974284">.</span><span class="builtintype" id="5974285">uint32</span><span class="op" id="5974291">(</span><span class="ident" id="5974292">fh</span><span class="op" id="5974294">.</span><span class="ident" id="5974295">UncompressedSize</span><span class="op" id="5974311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974317">_</span><span class="op" id="5974318">,</span>&nbsp;<span class="ident" id="5974320">err</span>&nbsp;<span class="op" id="5974324">:=</span>&nbsp;<span class="ident" id="5974327">w</span><span class="op" id="5974328">.</span><span class="ident" id="5974329">zipw</span><span class="op" id="5974333">.</span><span class="ident" id="5974334">Write</span><span class="op" id="5974339">(</span><span class="ident" id="5974340">buf</span><span class="op" id="5974343">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974346">return</span>&nbsp;<span class="ident" id="5974353">err</span><br>
<span class="lineno"></span><span class="op" id="5974357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974360">type</span>&nbsp;<span class="ident" id="5974365">countWriter</span>&nbsp;<span class="keyword" id="5974377">struct</span>&nbsp;<span class="op" id="5974384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974387">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5974393">io</span><span class="op" id="5974395">.</span><span class="ident" id="5974396">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974404">count</span>&nbsp;<span class="ident" id="5974410">int64</span><br>
<span class="lineno"></span><span class="op" id="5974416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974419">func</span>&nbsp;<span class="op" id="5974424">(</span><span class="ident" id="5974425">w</span>&nbsp;<span class="op" id="5974427">*</span><span class="ident" id="5974428">countWriter</span><span class="op" id="5974439">)</span>&nbsp;<span class="ident" id="5974441">Write</span><span class="op" id="5974446">(</span><span class="ident" id="5974447">p</span>&nbsp;<span class="op" id="5974449">[</span><span class="op" id="5974450">]</span><span class="builtintype" id="5974451">byte</span><span class="op" id="5974455">)</span>&nbsp;<span class="op" id="5974457">(</span><span class="builtintype" id="5974458">int</span><span class="op" id="5974461">,</span>&nbsp;<span class="builtintype" id="5974463">error</span><span class="op" id="5974468">)</span>&nbsp;<span class="op" id="5974470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974473">n</span><span class="op" id="5974474">,</span>&nbsp;<span class="ident" id="5974476">err</span>&nbsp;<span class="op" id="5974480">:=</span>&nbsp;<span class="ident" id="5974483">w</span><span class="op" id="5974484">.</span><span class="ident" id="5974485">w</span><span class="op" id="5974486">.</span><span class="ident" id="5974487">Write</span><span class="op" id="5974492">(</span><span class="ident" id="5974493">p</span><span class="op" id="5974494">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974497">w</span><span class="op" id="5974498">.</span><span class="ident" id="5974499">count</span>&nbsp;<span class="op" id="5974505">+=</span>&nbsp;<span class="ident" id="5974508">int64</span><span class="op" id="5974513">(</span><span class="ident" id="5974514">n</span><span class="op" id="5974515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974518">return</span>&nbsp;<span class="ident" id="5974525">n</span><span class="op" id="5974526">,</span>&nbsp;<span class="ident" id="5974528">err</span><br>
<span class="lineno"></span><span class="op" id="5974532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974535">type</span>&nbsp;<span class="ident" id="5974540">nopCloser</span>&nbsp;<span class="keyword" id="5974550">struct</span>&nbsp;<span class="op" id="5974557">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974560">io</span><span class="op" id="5974562">.</span><span class="ident" id="5974563">Writer</span><br>
<span class="lineno"></span><span class="op" id="5974570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974573">func</span>&nbsp;<span class="op" id="5974578">(</span><span class="ident" id="5974579">w</span>&nbsp;<span class="ident" id="5974581">nopCloser</span><span class="op" id="5974590">)</span>&nbsp;<span class="ident" id="5974592">Close</span><span class="op" id="5974597">(</span><span class="op" id="5974598">)</span>&nbsp;<span class="builtintype" id="5974600">error</span>&nbsp;<span class="op" id="5974606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974609">return</span>&nbsp;<span class="ident" id="5974616">nil</span><br>
<span class="lineno">340</span><span class="op" id="5974620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974623">type</span>&nbsp;<span class="ident" id="5974628">writeBuf</span>&nbsp;<span class="op" id="5974637">[</span><span class="op" id="5974638">]</span><span class="builtintype" id="5974639">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974645">func</span>&nbsp;<span class="op" id="5974650">(</span><span class="ident" id="5974651">b</span>&nbsp;<span class="op" id="5974653">*</span><span class="ident" id="5974654">writeBuf</span><span class="op" id="5974662">)</span>&nbsp;<span class="builtintype" id="5974664">uint16</span><span class="op" id="5974670">(</span><span class="ident" id="5974671">v</span>&nbsp;<span class="builtintype" id="5974673">uint16</span><span class="op" id="5974679">)</span>&nbsp;<span class="op" id="5974681">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974684">binary</span><span class="op" id="5974690">.</span><span class="ident" id="5974691">LittleEndian</span><span class="op" id="5974703">.</span><span class="ident" id="5974704">PutUint16</span><span class="op" id="5974713">(</span><span class="op" id="5974714">*</span><span class="ident" id="5974715">b</span><span class="op" id="5974716">,</span>&nbsp;<span class="ident" id="5974718">v</span><span class="op" id="5974719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974722">*</span><span class="ident" id="5974723">b</span>&nbsp;<span class="op" id="5974725">=</span>&nbsp;<span class="op" id="5974727">(</span><span class="op" id="5974728">*</span><span class="ident" id="5974729">b</span><span class="op" id="5974730">)</span><span class="op" id="5974731">[</span><span class="num" id="5974732">2</span><span class="op" id="5974733">:</span><span class="op" id="5974734">]</span><br>
<span class="lineno"></span><span class="op" id="5974736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974739">func</span>&nbsp;<span class="op" id="5974744">(</span><span class="ident" id="5974745">b</span>&nbsp;<span class="op" id="5974747">*</span><span class="ident" id="5974748">writeBuf</span><span class="op" id="5974756">)</span>&nbsp;<span class="builtintype" id="5974758">uint32</span><span class="op" id="5974764">(</span><span class="ident" id="5974765">v</span>&nbsp;<span class="builtintype" id="5974767">uint32</span><span class="op" id="5974773">)</span>&nbsp;<span class="op" id="5974775">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974778">binary</span><span class="op" id="5974784">.</span><span class="ident" id="5974785">LittleEndian</span><span class="op" id="5974797">.</span><span class="ident" id="5974798">PutUint32</span><span class="op" id="5974807">(</span><span class="op" id="5974808">*</span><span class="ident" id="5974809">b</span><span class="op" id="5974810">,</span>&nbsp;<span class="ident" id="5974812">v</span><span class="op" id="5974813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974816">*</span><span class="ident" id="5974817">b</span>&nbsp;<span class="op" id="5974819">=</span>&nbsp;<span class="op" id="5974821">(</span><span class="op" id="5974822">*</span><span class="ident" id="5974823">b</span><span class="op" id="5974824">)</span><span class="op" id="5974825">[</span><span class="num" id="5974826">4</span><span class="op" id="5974827">:</span><span class="op" id="5974828">]</span><br>
<span class="lineno"></span><span class="op" id="5974830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5974833">func</span>&nbsp;<span class="op" id="5974838">(</span><span class="ident" id="5974839">b</span>&nbsp;<span class="op" id="5974841">*</span><span class="ident" id="5974842">writeBuf</span><span class="op" id="5974850">)</span>&nbsp;<span class="ident" id="5974852">uint64</span><span class="op" id="5974858">(</span><span class="ident" id="5974859">v</span>&nbsp;<span class="ident" id="5974861">uint64</span><span class="op" id="5974867">)</span>&nbsp;<span class="op" id="5974869">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974872">binary</span><span class="op" id="5974878">.</span><span class="ident" id="5974879">LittleEndian</span><span class="op" id="5974891">.</span><span class="ident" id="5974892">PutUint64</span><span class="op" id="5974901">(</span><span class="op" id="5974902">*</span><span class="ident" id="5974903">b</span><span class="op" id="5974904">,</span>&nbsp;<span class="ident" id="5974906">v</span><span class="op" id="5974907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974910">*</span><span class="ident" id="5974911">b</span>&nbsp;<span class="op" id="5974913">=</span>&nbsp;<span class="op" id="5974915">(</span><span class="op" id="5974916">*</span><span class="ident" id="5974917">b</span><span class="op" id="5974918">)</span><span class="op" id="5974919">[</span><span class="num" id="5974920">8</span><span class="op" id="5974921">:</span><span class="op" id="5974922">]</span><br>
<span class="lineno"></span><span class="op" id="5974924">}</span>
</div>
</body>
</html>
