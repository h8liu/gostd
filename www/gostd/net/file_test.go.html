<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html" class="current">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8003438">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8003493">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8003547">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8003598">package</span>&nbsp;<span class="ident" id="8003606">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003611">import</span>&nbsp;<span class="op" id="8003618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8003621">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8003627">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8003638">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8003649">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8003659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003662">type</span>&nbsp;<span class="ident" id="8003667">listenerFile</span>&nbsp;<span class="keyword" id="8003680">interface</span>&nbsp;<span class="op" id="8003690">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003693">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003703">File</span><span class="op" id="8003707">(</span><span class="op" id="8003708">)</span>&nbsp;<span class="op" id="8003710">(</span><span class="ident" id="8003711">f</span>&nbsp;<span class="op" id="8003713">*</span><span class="ident" id="8003714">os</span><span class="op" id="8003716">.</span><span class="ident" id="8003717">File</span><span class="op" id="8003721">,</span>&nbsp;<span class="ident" id="8003723">err</span>&nbsp;<span class="builtintype" id="8003727">error</span><span class="op" id="8003732">)</span><br>
<span class="lineno"></span><span class="op" id="8003734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003737">type</span>&nbsp;<span class="ident" id="8003742">packetConnFile</span>&nbsp;<span class="keyword" id="8003757">interface</span>&nbsp;<span class="op" id="8003767">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003770">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003782">File</span><span class="op" id="8003786">(</span><span class="op" id="8003787">)</span>&nbsp;<span class="op" id="8003789">(</span><span class="ident" id="8003790">f</span>&nbsp;<span class="op" id="8003792">*</span><span class="ident" id="8003793">os</span><span class="op" id="8003795">.</span><span class="ident" id="8003796">File</span><span class="op" id="8003800">,</span>&nbsp;<span class="ident" id="8003802">err</span>&nbsp;<span class="builtintype" id="8003806">error</span><span class="op" id="8003811">)</span><br>
<span class="lineno"></span><span class="op" id="8003813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003816">type</span>&nbsp;<span class="ident" id="8003821">connFile</span>&nbsp;<span class="keyword" id="8003830">interface</span>&nbsp;<span class="op" id="8003840">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003843">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003849">File</span><span class="op" id="8003853">(</span><span class="op" id="8003854">)</span>&nbsp;<span class="op" id="8003856">(</span><span class="ident" id="8003857">f</span>&nbsp;<span class="op" id="8003859">*</span><span class="ident" id="8003860">os</span><span class="op" id="8003862">.</span><span class="ident" id="8003863">File</span><span class="op" id="8003867">,</span>&nbsp;<span class="ident" id="8003869">err</span>&nbsp;<span class="builtintype" id="8003873">error</span><span class="op" id="8003878">)</span><br>
<span class="lineno"></span><span class="op" id="8003880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8003883">func</span>&nbsp;<span class="ident" id="8003888">testFileListener</span><span class="op" id="8003904">(</span><span class="ident" id="8003905">t</span>&nbsp;<span class="op" id="8003907">*</span><span class="ident" id="8003908">testing</span><span class="op" id="8003915">.</span><span class="ident" id="8003916">T</span><span class="op" id="8003917">,</span>&nbsp;<span class="ident" id="8003919">net</span><span class="op" id="8003922">,</span>&nbsp;<span class="ident" id="8003924">laddr</span>&nbsp;<span class="builtintype" id="8003930">string</span><span class="op" id="8003936">)</span>&nbsp;<span class="op" id="8003938">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8003941">switch</span>&nbsp;<span class="ident" id="8003948">net</span>&nbsp;<span class="op" id="8003952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8003955">case</span>&nbsp;<span class="string" id="8003960">&#34;tcp&#34;</span><span class="op" id="8003965">,</span>&nbsp;<span class="string" id="8003967">&#34;tcp4&#34;</span><span class="op" id="8003973">,</span>&nbsp;<span class="string" id="8003975">&#34;tcp6&#34;</span><span class="op" id="8003981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8003985">laddr</span>&nbsp;<span class="op" id="8003991">+=</span>&nbsp;<span class="string" id="8003994">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8003999">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004025">l</span><span class="op" id="8004026">,</span>&nbsp;<span class="ident" id="8004028">err</span>&nbsp;<span class="op" id="8004032">:=</span>&nbsp;<span class="ident" id="8004035">Listen</span><span class="op" id="8004041">(</span><span class="ident" id="8004042">net</span><span class="op" id="8004045">,</span>&nbsp;<span class="ident" id="8004047">laddr</span><span class="op" id="8004052">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004055">if</span>&nbsp;<span class="ident" id="8004058">err</span>&nbsp;<span class="op" id="8004062">!=</span>&nbsp;<span class="ident" id="8004065">nil</span>&nbsp;<span class="op" id="8004069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004073">t</span><span class="op" id="8004074">.</span><span class="ident" id="8004075">Fatalf</span><span class="op" id="8004081">(</span><span class="string" id="8004082">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004101">,</span>&nbsp;<span class="ident" id="8004103">err</span><span class="op" id="8004106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004112">defer</span>&nbsp;<span class="ident" id="8004118">l</span><span class="op" id="8004119">.</span><span class="ident" id="8004120">Close</span><span class="op" id="8004125">(</span><span class="op" id="8004126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004129">lf</span>&nbsp;<span class="op" id="8004132">:=</span>&nbsp;<span class="ident" id="8004135">l</span><span class="op" id="8004136">.</span><span class="op" id="8004137">(</span><span class="ident" id="8004138">listenerFile</span><span class="op" id="8004150">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004153">f</span><span class="op" id="8004154">,</span>&nbsp;<span class="ident" id="8004156">err</span>&nbsp;<span class="op" id="8004160">:=</span>&nbsp;<span class="ident" id="8004163">lf</span><span class="op" id="8004165">.</span><span class="ident" id="8004166">File</span><span class="op" id="8004170">(</span><span class="op" id="8004171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004174">if</span>&nbsp;<span class="ident" id="8004177">err</span>&nbsp;<span class="op" id="8004181">!=</span>&nbsp;<span class="ident" id="8004184">nil</span>&nbsp;<span class="op" id="8004188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004192">t</span><span class="op" id="8004193">.</span><span class="ident" id="8004194">Fatalf</span><span class="op" id="8004200">(</span><span class="string" id="8004201">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004218">,</span>&nbsp;<span class="ident" id="8004220">err</span><span class="op" id="8004223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004229">c</span><span class="op" id="8004230">,</span>&nbsp;<span class="ident" id="8004232">err</span>&nbsp;<span class="op" id="8004236">:=</span>&nbsp;<span class="ident" id="8004239">FileListener</span><span class="op" id="8004251">(</span><span class="ident" id="8004252">f</span><span class="op" id="8004253">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004256">if</span>&nbsp;<span class="ident" id="8004259">err</span>&nbsp;<span class="op" id="8004263">!=</span>&nbsp;<span class="ident" id="8004266">nil</span>&nbsp;<span class="op" id="8004270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004274">t</span><span class="op" id="8004275">.</span><span class="ident" id="8004276">Fatalf</span><span class="op" id="8004282">(</span><span class="string" id="8004283">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004308">,</span>&nbsp;<span class="ident" id="8004310">err</span><span class="op" id="8004313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004319">if</span>&nbsp;<span class="op" id="8004322">!</span><span class="ident" id="8004323">reflect</span><span class="op" id="8004330">.</span><span class="ident" id="8004331">DeepEqual</span><span class="op" id="8004340">(</span><span class="ident" id="8004341">l</span><span class="op" id="8004342">.</span><span class="ident" id="8004343">Addr</span><span class="op" id="8004347">(</span><span class="op" id="8004348">)</span><span class="op" id="8004349">,</span>&nbsp;<span class="ident" id="8004351">c</span><span class="op" id="8004352">.</span><span class="ident" id="8004353">Addr</span><span class="op" id="8004357">(</span><span class="op" id="8004358">)</span><span class="op" id="8004359">)</span>&nbsp;<span class="op" id="8004361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004365">t</span><span class="op" id="8004366">.</span><span class="ident" id="8004367">Fatalf</span><span class="op" id="8004373">(</span><span class="string" id="8004374">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8004403">,</span>&nbsp;<span class="ident" id="8004405">l</span><span class="op" id="8004406">.</span><span class="ident" id="8004407">Addr</span><span class="op" id="8004411">(</span><span class="op" id="8004412">)</span><span class="op" id="8004413">,</span>&nbsp;<span class="ident" id="8004415">c</span><span class="op" id="8004416">.</span><span class="ident" id="8004417">Addr</span><span class="op" id="8004421">(</span><span class="op" id="8004422">)</span><span class="op" id="8004423">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004429">if</span>&nbsp;<span class="ident" id="8004432">err</span>&nbsp;<span class="op" id="8004436">:=</span>&nbsp;<span class="ident" id="8004439">c</span><span class="op" id="8004440">.</span><span class="ident" id="8004441">Close</span><span class="op" id="8004446">(</span><span class="op" id="8004447">)</span><span class="op" id="8004448">;</span>&nbsp;<span class="ident" id="8004450">err</span>&nbsp;<span class="op" id="8004454">!=</span>&nbsp;<span class="ident" id="8004457">nil</span>&nbsp;<span class="op" id="8004461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004465">t</span><span class="op" id="8004466">.</span><span class="ident" id="8004467">Fatalf</span><span class="op" id="8004473">(</span><span class="string" id="8004474">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004492">,</span>&nbsp;<span class="ident" id="8004494">err</span><span class="op" id="8004497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8004503">if</span>&nbsp;<span class="ident" id="8004506">err</span>&nbsp;<span class="op" id="8004510">:=</span>&nbsp;<span class="ident" id="8004513">f</span><span class="op" id="8004514">.</span><span class="ident" id="8004515">Close</span><span class="op" id="8004520">(</span><span class="op" id="8004521">)</span><span class="op" id="8004522">;</span>&nbsp;<span class="ident" id="8004524">err</span>&nbsp;<span class="op" id="8004528">!=</span>&nbsp;<span class="ident" id="8004531">nil</span>&nbsp;<span class="op" id="8004535">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004539">t</span><span class="op" id="8004540">.</span><span class="ident" id="8004541">Fatalf</span><span class="op" id="8004547">(</span><span class="string" id="8004548">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004566">,</span>&nbsp;<span class="ident" id="8004568">err</span><span class="op" id="8004571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004574">}</span><br>
<span class="lineno"></span><span class="op" id="8004576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8004579">var</span>&nbsp;<span class="ident" id="8004583">fileListenerTests</span>&nbsp;<span class="op" id="8004601">=</span>&nbsp;<span class="op" id="8004603">[</span><span class="op" id="8004604">]</span><span class="keyword" id="8004605">struct</span>&nbsp;<span class="op" id="8004612">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004615">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8004621">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004629">laddr</span>&nbsp;<span class="builtintype" id="8004635">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004643">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8004649">bool</span>&nbsp;<span class="comment" id="8004654">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8004695">linux</span>&nbsp;<span class="builtintype" id="8004701">bool</span>&nbsp;<span class="comment" id="8004706">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8004760">}</span><span class="op" id="8004761">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004764">{</span><span class="ident" id="8004765">net</span><span class="op" id="8004768">:</span>&nbsp;<span class="string" id="8004770">&#34;tcp&#34;</span><span class="op" id="8004775">,</span>&nbsp;<span class="ident" id="8004777">laddr</span><span class="op" id="8004782">:</span>&nbsp;<span class="string" id="8004784">&#34;&#34;</span><span class="op" id="8004786">}</span><span class="op" id="8004787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004790">{</span><span class="ident" id="8004791">net</span><span class="op" id="8004794">:</span>&nbsp;<span class="string" id="8004796">&#34;tcp&#34;</span><span class="op" id="8004801">,</span>&nbsp;<span class="ident" id="8004803">laddr</span><span class="op" id="8004808">:</span>&nbsp;<span class="string" id="8004810">&#34;0.0.0.0&#34;</span><span class="op" id="8004819">}</span><span class="op" id="8004820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004823">{</span><span class="ident" id="8004824">net</span><span class="op" id="8004827">:</span>&nbsp;<span class="string" id="8004829">&#34;tcp&#34;</span><span class="op" id="8004834">,</span>&nbsp;<span class="ident" id="8004836">laddr</span><span class="op" id="8004841">:</span>&nbsp;<span class="string" id="8004843">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8004861">}</span><span class="op" id="8004862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004865">{</span><span class="ident" id="8004866">net</span><span class="op" id="8004869">:</span>&nbsp;<span class="string" id="8004871">&#34;tcp&#34;</span><span class="op" id="8004876">,</span>&nbsp;<span class="ident" id="8004878">laddr</span><span class="op" id="8004883">:</span>&nbsp;<span class="string" id="8004885">&#34;[::]&#34;</span><span class="op" id="8004891">,</span>&nbsp;<span class="ident" id="8004893">ipv6</span><span class="op" id="8004897">:</span>&nbsp;<span class="builtintype" id="8004899">true</span><span class="op" id="8004903">}</span><span class="op" id="8004904">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004908">{</span><span class="ident" id="8004909">net</span><span class="op" id="8004912">:</span>&nbsp;<span class="string" id="8004914">&#34;tcp&#34;</span><span class="op" id="8004919">,</span>&nbsp;<span class="ident" id="8004921">laddr</span><span class="op" id="8004926">:</span>&nbsp;<span class="string" id="8004928">&#34;127.0.0.1&#34;</span><span class="op" id="8004939">}</span><span class="op" id="8004940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004943">{</span><span class="ident" id="8004944">net</span><span class="op" id="8004947">:</span>&nbsp;<span class="string" id="8004949">&#34;tcp&#34;</span><span class="op" id="8004954">,</span>&nbsp;<span class="ident" id="8004956">laddr</span><span class="op" id="8004961">:</span>&nbsp;<span class="string" id="8004963">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8004983">}</span><span class="op" id="8004984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8004987">{</span><span class="ident" id="8004988">net</span><span class="op" id="8004991">:</span>&nbsp;<span class="string" id="8004993">&#34;tcp&#34;</span><span class="op" id="8004998">,</span>&nbsp;<span class="ident" id="8005000">laddr</span><span class="op" id="8005005">:</span>&nbsp;<span class="string" id="8005007">&#34;[::1]&#34;</span><span class="op" id="8005014">,</span>&nbsp;<span class="ident" id="8005016">ipv6</span><span class="op" id="8005020">:</span>&nbsp;<span class="builtintype" id="8005022">true</span><span class="op" id="8005026">}</span><span class="op" id="8005027">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005031">{</span><span class="ident" id="8005032">net</span><span class="op" id="8005035">:</span>&nbsp;<span class="string" id="8005037">&#34;tcp4&#34;</span><span class="op" id="8005043">,</span>&nbsp;<span class="ident" id="8005045">laddr</span><span class="op" id="8005050">:</span>&nbsp;<span class="string" id="8005052">&#34;&#34;</span><span class="op" id="8005054">}</span><span class="op" id="8005055">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005058">{</span><span class="ident" id="8005059">net</span><span class="op" id="8005062">:</span>&nbsp;<span class="string" id="8005064">&#34;tcp4&#34;</span><span class="op" id="8005070">,</span>&nbsp;<span class="ident" id="8005072">laddr</span><span class="op" id="8005077">:</span>&nbsp;<span class="string" id="8005079">&#34;0.0.0.0&#34;</span><span class="op" id="8005088">}</span><span class="op" id="8005089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005092">{</span><span class="ident" id="8005093">net</span><span class="op" id="8005096">:</span>&nbsp;<span class="string" id="8005098">&#34;tcp4&#34;</span><span class="op" id="8005104">,</span>&nbsp;<span class="ident" id="8005106">laddr</span><span class="op" id="8005111">:</span>&nbsp;<span class="string" id="8005113">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8005131">}</span><span class="op" id="8005132">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005136">{</span><span class="ident" id="8005137">net</span><span class="op" id="8005140">:</span>&nbsp;<span class="string" id="8005142">&#34;tcp4&#34;</span><span class="op" id="8005148">,</span>&nbsp;<span class="ident" id="8005150">laddr</span><span class="op" id="8005155">:</span>&nbsp;<span class="string" id="8005157">&#34;127.0.0.1&#34;</span><span class="op" id="8005168">}</span><span class="op" id="8005169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005172">{</span><span class="ident" id="8005173">net</span><span class="op" id="8005176">:</span>&nbsp;<span class="string" id="8005178">&#34;tcp4&#34;</span><span class="op" id="8005184">,</span>&nbsp;<span class="ident" id="8005186">laddr</span><span class="op" id="8005191">:</span>&nbsp;<span class="string" id="8005193">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8005213">}</span><span class="op" id="8005214">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005218">{</span><span class="ident" id="8005219">net</span><span class="op" id="8005222">:</span>&nbsp;<span class="string" id="8005224">&#34;tcp6&#34;</span><span class="op" id="8005230">,</span>&nbsp;<span class="ident" id="8005232">laddr</span><span class="op" id="8005237">:</span>&nbsp;<span class="string" id="8005239">&#34;&#34;</span><span class="op" id="8005241">,</span>&nbsp;<span class="ident" id="8005243">ipv6</span><span class="op" id="8005247">:</span>&nbsp;<span class="builtintype" id="8005249">true</span><span class="op" id="8005253">}</span><span class="op" id="8005254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005257">{</span><span class="ident" id="8005258">net</span><span class="op" id="8005261">:</span>&nbsp;<span class="string" id="8005263">&#34;tcp6&#34;</span><span class="op" id="8005269">,</span>&nbsp;<span class="ident" id="8005271">laddr</span><span class="op" id="8005276">:</span>&nbsp;<span class="string" id="8005278">&#34;[::]&#34;</span><span class="op" id="8005284">,</span>&nbsp;<span class="ident" id="8005286">ipv6</span><span class="op" id="8005290">:</span>&nbsp;<span class="builtintype" id="8005292">true</span><span class="op" id="8005296">}</span><span class="op" id="8005297">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005301">{</span><span class="ident" id="8005302">net</span><span class="op" id="8005305">:</span>&nbsp;<span class="string" id="8005307">&#34;tcp6&#34;</span><span class="op" id="8005313">,</span>&nbsp;<span class="ident" id="8005315">laddr</span><span class="op" id="8005320">:</span>&nbsp;<span class="string" id="8005322">&#34;[::1]&#34;</span><span class="op" id="8005329">,</span>&nbsp;<span class="ident" id="8005331">ipv6</span><span class="op" id="8005335">:</span>&nbsp;<span class="builtintype" id="8005337">true</span><span class="op" id="8005341">}</span><span class="op" id="8005342">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005346">{</span><span class="ident" id="8005347">net</span><span class="op" id="8005350">:</span>&nbsp;<span class="string" id="8005352">&#34;unix&#34;</span><span class="op" id="8005358">,</span>&nbsp;<span class="ident" id="8005360">laddr</span><span class="op" id="8005365">:</span>&nbsp;<span class="string" id="8005367">&#34;@gotest/net&#34;</span><span class="op" id="8005380">,</span>&nbsp;<span class="ident" id="8005382">linux</span><span class="op" id="8005387">:</span>&nbsp;<span class="builtintype" id="8005389">true</span><span class="op" id="8005393">}</span><span class="op" id="8005394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005397">{</span><span class="ident" id="8005398">net</span><span class="op" id="8005401">:</span>&nbsp;<span class="string" id="8005403">&#34;unixpacket&#34;</span><span class="op" id="8005415">,</span>&nbsp;<span class="ident" id="8005417">laddr</span><span class="op" id="8005422">:</span>&nbsp;<span class="string" id="8005424">&#34;@gotest/net&#34;</span><span class="op" id="8005437">,</span>&nbsp;<span class="ident" id="8005439">linux</span><span class="op" id="8005444">:</span>&nbsp;<span class="builtintype" id="8005446">true</span><span class="op" id="8005450">}</span><span class="op" id="8005451">,</span><br>
<span class="lineno"></span><span class="op" id="8005453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8005456">func</span>&nbsp;<span class="ident" id="8005461">TestFileListener</span><span class="op" id="8005477">(</span><span class="ident" id="8005478">t</span>&nbsp;<span class="op" id="8005480">*</span><span class="ident" id="8005481">testing</span><span class="op" id="8005488">.</span><span class="ident" id="8005489">T</span><span class="op" id="8005490">)</span>&nbsp;<span class="op" id="8005492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005495">switch</span>&nbsp;<span class="ident" id="8005502">runtime</span><span class="op" id="8005509">.</span><span class="ident" id="8005510">GOOS</span>&nbsp;<span class="op" id="8005515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005518">case</span>&nbsp;<span class="string" id="8005523">&#34;nacl&#34;</span><span class="op" id="8005529">,</span>&nbsp;<span class="string" id="8005531">&#34;windows&#34;</span><span class="op" id="8005540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8005544">t</span><span class="op" id="8005545">.</span><span class="ident" id="8005546">Skipf</span><span class="op" id="8005551">(</span><span class="string" id="8005552">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8005573">,</span>&nbsp;<span class="ident" id="8005575">runtime</span><span class="op" id="8005582">.</span><span class="ident" id="8005583">GOOS</span><span class="op" id="8005587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005590">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005594">for</span>&nbsp;<span class="ident" id="8005598">_</span><span class="op" id="8005599">,</span>&nbsp;<span class="ident" id="8005601">tt</span>&nbsp;<span class="op" id="8005604">:=</span>&nbsp;<span class="keyword" id="8005607">range</span>&nbsp;<span class="ident" id="8005613">fileListenerTests</span>&nbsp;<span class="op" id="8005631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005635">if</span>&nbsp;<span class="ident" id="8005638">skipServerTest</span><span class="op" id="8005652">(</span><span class="ident" id="8005653">tt</span><span class="op" id="8005655">.</span><span class="ident" id="8005656">net</span><span class="op" id="8005659">,</span>&nbsp;<span class="string" id="8005661">&#34;unix&#34;</span><span class="op" id="8005667">,</span>&nbsp;<span class="ident" id="8005669">tt</span><span class="op" id="8005671">.</span><span class="ident" id="8005672">laddr</span><span class="op" id="8005677">,</span>&nbsp;<span class="ident" id="8005679">tt</span><span class="op" id="8005681">.</span><span class="ident" id="8005682">ipv6</span><span class="op" id="8005686">,</span>&nbsp;<span class="builtintype" id="8005688">false</span><span class="op" id="8005693">,</span>&nbsp;<span class="ident" id="8005695">tt</span><span class="op" id="8005697">.</span><span class="ident" id="8005698">linux</span><span class="op" id="8005703">)</span>&nbsp;<span class="op" id="8005705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005710">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005721">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005725">if</span>&nbsp;<span class="ident" id="8005728">skipServerTest</span><span class="op" id="8005742">(</span><span class="ident" id="8005743">tt</span><span class="op" id="8005745">.</span><span class="ident" id="8005746">net</span><span class="op" id="8005749">,</span>&nbsp;<span class="string" id="8005751">&#34;unixpacket&#34;</span><span class="op" id="8005763">,</span>&nbsp;<span class="ident" id="8005765">tt</span><span class="op" id="8005767">.</span><span class="ident" id="8005768">laddr</span><span class="op" id="8005773">,</span>&nbsp;<span class="ident" id="8005775">tt</span><span class="op" id="8005777">.</span><span class="ident" id="8005778">ipv6</span><span class="op" id="8005782">,</span>&nbsp;<span class="builtintype" id="8005784">false</span><span class="op" id="8005789">,</span>&nbsp;<span class="ident" id="8005791">tt</span><span class="op" id="8005793">.</span><span class="ident" id="8005794">linux</span><span class="op" id="8005799">)</span>&nbsp;<span class="op" id="8005801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005806">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8005821">testFileListener</span><span class="op" id="8005837">(</span><span class="ident" id="8005838">t</span><span class="op" id="8005839">,</span>&nbsp;<span class="ident" id="8005841">tt</span><span class="op" id="8005843">.</span><span class="ident" id="8005844">net</span><span class="op" id="8005847">,</span>&nbsp;<span class="ident" id="8005849">tt</span><span class="op" id="8005851">.</span><span class="ident" id="8005852">laddr</span><span class="op" id="8005857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8005860">}</span><br>
<span class="lineno">105</span><span class="op" id="8005862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8005865">func</span>&nbsp;<span class="ident" id="8005870">testFilePacketConn</span><span class="op" id="8005888">(</span><span class="ident" id="8005889">t</span>&nbsp;<span class="op" id="8005891">*</span><span class="ident" id="8005892">testing</span><span class="op" id="8005899">.</span><span class="ident" id="8005900">T</span><span class="op" id="8005901">,</span>&nbsp;<span class="ident" id="8005903">pcf</span>&nbsp;<span class="ident" id="8005907">packetConnFile</span><span class="op" id="8005921">,</span>&nbsp;<span class="ident" id="8005923">listen</span>&nbsp;<span class="builtintype" id="8005930">bool</span><span class="op" id="8005934">)</span>&nbsp;<span class="op" id="8005936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8005939">f</span><span class="op" id="8005940">,</span>&nbsp;<span class="ident" id="8005942">err</span>&nbsp;<span class="op" id="8005946">:=</span>&nbsp;<span class="ident" id="8005949">pcf</span><span class="op" id="8005952">.</span><span class="ident" id="8005953">File</span><span class="op" id="8005957">(</span><span class="op" id="8005958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8005961">if</span>&nbsp;<span class="ident" id="8005964">err</span>&nbsp;<span class="op" id="8005968">!=</span>&nbsp;<span class="ident" id="8005971">nil</span>&nbsp;<span class="op" id="8005975">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8005979">t</span><span class="op" id="8005980">.</span><span class="ident" id="8005981">Fatalf</span><span class="op" id="8005987">(</span><span class="string" id="8005988">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006005">,</span>&nbsp;<span class="ident" id="8006007">err</span><span class="op" id="8006010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006016">c</span><span class="op" id="8006017">,</span>&nbsp;<span class="ident" id="8006019">err</span>&nbsp;<span class="op" id="8006023">:=</span>&nbsp;<span class="ident" id="8006026">FilePacketConn</span><span class="op" id="8006040">(</span><span class="ident" id="8006041">f</span><span class="op" id="8006042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006045">if</span>&nbsp;<span class="ident" id="8006048">err</span>&nbsp;<span class="op" id="8006052">!=</span>&nbsp;<span class="ident" id="8006055">nil</span>&nbsp;<span class="op" id="8006059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006063">t</span><span class="op" id="8006064">.</span><span class="ident" id="8006065">Fatalf</span><span class="op" id="8006071">(</span><span class="string" id="8006072">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006099">,</span>&nbsp;<span class="ident" id="8006101">err</span><span class="op" id="8006104">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006110">if</span>&nbsp;<span class="op" id="8006113">!</span><span class="ident" id="8006114">reflect</span><span class="op" id="8006121">.</span><span class="ident" id="8006122">DeepEqual</span><span class="op" id="8006131">(</span><span class="ident" id="8006132">pcf</span><span class="op" id="8006135">.</span><span class="ident" id="8006136">LocalAddr</span><span class="op" id="8006145">(</span><span class="op" id="8006146">)</span><span class="op" id="8006147">,</span>&nbsp;<span class="ident" id="8006149">c</span><span class="op" id="8006150">.</span><span class="ident" id="8006151">LocalAddr</span><span class="op" id="8006160">(</span><span class="op" id="8006161">)</span><span class="op" id="8006162">)</span>&nbsp;<span class="op" id="8006164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006168">t</span><span class="op" id="8006169">.</span><span class="ident" id="8006170">Fatalf</span><span class="op" id="8006176">(</span><span class="string" id="8006177">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="8006211">,</span>&nbsp;<span class="ident" id="8006213">pcf</span><span class="op" id="8006216">.</span><span class="ident" id="8006217">LocalAddr</span><span class="op" id="8006226">(</span><span class="op" id="8006227">)</span><span class="op" id="8006228">,</span>&nbsp;<span class="ident" id="8006230">c</span><span class="op" id="8006231">.</span><span class="ident" id="8006232">LocalAddr</span><span class="op" id="8006241">(</span><span class="op" id="8006242">)</span><span class="op" id="8006243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006249">if</span>&nbsp;<span class="ident" id="8006252">listen</span>&nbsp;<span class="op" id="8006259">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006263">if</span>&nbsp;<span class="ident" id="8006266">_</span><span class="op" id="8006267">,</span>&nbsp;<span class="ident" id="8006269">err</span>&nbsp;<span class="op" id="8006273">:=</span>&nbsp;<span class="ident" id="8006276">c</span><span class="op" id="8006277">.</span><span class="ident" id="8006278">WriteTo</span><span class="op" id="8006285">(</span><span class="op" id="8006286">[</span><span class="op" id="8006287">]</span><span class="builtintype" id="8006288">byte</span><span class="op" id="8006292">{</span><span class="op" id="8006293">}</span><span class="op" id="8006294">,</span>&nbsp;<span class="ident" id="8006296">c</span><span class="op" id="8006297">.</span><span class="ident" id="8006298">LocalAddr</span><span class="op" id="8006307">(</span><span class="op" id="8006308">)</span><span class="op" id="8006309">)</span><span class="op" id="8006310">;</span>&nbsp;<span class="ident" id="8006312">err</span>&nbsp;<span class="op" id="8006316">!=</span>&nbsp;<span class="ident" id="8006319">nil</span>&nbsp;<span class="op" id="8006323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006328">t</span><span class="op" id="8006329">.</span><span class="ident" id="8006330">Fatalf</span><span class="op" id="8006336">(</span><span class="string" id="8006337">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006357">,</span>&nbsp;<span class="ident" id="8006359">err</span><span class="op" id="8006362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006372">if</span>&nbsp;<span class="ident" id="8006375">err</span>&nbsp;<span class="op" id="8006379">:=</span>&nbsp;<span class="ident" id="8006382">c</span><span class="op" id="8006383">.</span><span class="ident" id="8006384">Close</span><span class="op" id="8006389">(</span><span class="op" id="8006390">)</span><span class="op" id="8006391">;</span>&nbsp;<span class="ident" id="8006393">err</span>&nbsp;<span class="op" id="8006397">!=</span>&nbsp;<span class="ident" id="8006400">nil</span>&nbsp;<span class="op" id="8006404">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006408">t</span><span class="op" id="8006409">.</span><span class="ident" id="8006410">Fatalf</span><span class="op" id="8006416">(</span><span class="string" id="8006417">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006435">,</span>&nbsp;<span class="ident" id="8006437">err</span><span class="op" id="8006440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006446">if</span>&nbsp;<span class="ident" id="8006449">err</span>&nbsp;<span class="op" id="8006453">:=</span>&nbsp;<span class="ident" id="8006456">f</span><span class="op" id="8006457">.</span><span class="ident" id="8006458">Close</span><span class="op" id="8006463">(</span><span class="op" id="8006464">)</span><span class="op" id="8006465">;</span>&nbsp;<span class="ident" id="8006467">err</span>&nbsp;<span class="op" id="8006471">!=</span>&nbsp;<span class="ident" id="8006474">nil</span>&nbsp;<span class="op" id="8006478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006482">t</span><span class="op" id="8006483">.</span><span class="ident" id="8006484">Fatalf</span><span class="op" id="8006490">(</span><span class="string" id="8006491">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006509">,</span>&nbsp;<span class="ident" id="8006511">err</span><span class="op" id="8006514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006517">}</span><br>
<span class="lineno">130</span><span class="op" id="8006519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006522">func</span>&nbsp;<span class="ident" id="8006527">testFilePacketConnListen</span><span class="op" id="8006551">(</span><span class="ident" id="8006552">t</span>&nbsp;<span class="op" id="8006554">*</span><span class="ident" id="8006555">testing</span><span class="op" id="8006562">.</span><span class="ident" id="8006563">T</span><span class="op" id="8006564">,</span>&nbsp;<span class="ident" id="8006566">net</span><span class="op" id="8006569">,</span>&nbsp;<span class="ident" id="8006571">laddr</span>&nbsp;<span class="builtintype" id="8006577">string</span><span class="op" id="8006583">)</span>&nbsp;<span class="op" id="8006585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006588">switch</span>&nbsp;<span class="ident" id="8006595">net</span>&nbsp;<span class="op" id="8006599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006602">case</span>&nbsp;<span class="string" id="8006607">&#34;udp&#34;</span><span class="op" id="8006612">,</span>&nbsp;<span class="string" id="8006614">&#34;udp4&#34;</span><span class="op" id="8006620">,</span>&nbsp;<span class="string" id="8006622">&#34;udp6&#34;</span><span class="op" id="8006628">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006632">laddr</span>&nbsp;<span class="op" id="8006638">+=</span>&nbsp;<span class="string" id="8006641">&#34;:0&#34;</span>&nbsp;<span class="comment" id="8006646">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006672">l</span><span class="op" id="8006673">,</span>&nbsp;<span class="ident" id="8006675">err</span>&nbsp;<span class="op" id="8006679">:=</span>&nbsp;<span class="ident" id="8006682">ListenPacket</span><span class="op" id="8006694">(</span><span class="ident" id="8006695">net</span><span class="op" id="8006698">,</span>&nbsp;<span class="ident" id="8006700">laddr</span><span class="op" id="8006705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006708">if</span>&nbsp;<span class="ident" id="8006711">err</span>&nbsp;<span class="op" id="8006715">!=</span>&nbsp;<span class="ident" id="8006718">nil</span>&nbsp;<span class="op" id="8006722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006726">t</span><span class="op" id="8006727">.</span><span class="ident" id="8006728">Fatalf</span><span class="op" id="8006734">(</span><span class="string" id="8006735">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006760">,</span>&nbsp;<span class="ident" id="8006762">err</span><span class="op" id="8006765">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006771">testFilePacketConn</span><span class="op" id="8006789">(</span><span class="ident" id="8006790">t</span><span class="op" id="8006791">,</span>&nbsp;<span class="ident" id="8006793">l</span><span class="op" id="8006794">.</span><span class="op" id="8006795">(</span><span class="ident" id="8006796">packetConnFile</span><span class="op" id="8006810">)</span><span class="op" id="8006811">,</span>&nbsp;<span class="builtintype" id="8006813">true</span><span class="op" id="8006817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006820">if</span>&nbsp;<span class="ident" id="8006823">err</span>&nbsp;<span class="op" id="8006827">:=</span>&nbsp;<span class="ident" id="8006830">l</span><span class="op" id="8006831">.</span><span class="ident" id="8006832">Close</span><span class="op" id="8006837">(</span><span class="op" id="8006838">)</span><span class="op" id="8006839">;</span>&nbsp;<span class="ident" id="8006841">err</span>&nbsp;<span class="op" id="8006845">!=</span>&nbsp;<span class="ident" id="8006848">nil</span>&nbsp;<span class="op" id="8006852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8006856">t</span><span class="op" id="8006857">.</span><span class="ident" id="8006858">Fatalf</span><span class="op" id="8006864">(</span><span class="string" id="8006865">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8006883">,</span>&nbsp;<span class="ident" id="8006885">err</span><span class="op" id="8006888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8006891">}</span><br>
<span class="lineno">145</span><span class="op" id="8006893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8006896">func</span>&nbsp;<span class="ident" id="8006901">testFilePacketConnDial</span><span class="op" id="8006923">(</span><span class="ident" id="8006924">t</span>&nbsp;<span class="op" id="8006926">*</span><span class="ident" id="8006927">testing</span><span class="op" id="8006934">.</span><span class="ident" id="8006935">T</span><span class="op" id="8006936">,</span>&nbsp;<span class="ident" id="8006938">net</span><span class="op" id="8006941">,</span>&nbsp;<span class="ident" id="8006943">raddr</span>&nbsp;<span class="builtintype" id="8006949">string</span><span class="op" id="8006955">)</span>&nbsp;<span class="op" id="8006957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006960">switch</span>&nbsp;<span class="ident" id="8006967">net</span>&nbsp;<span class="op" id="8006971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8006974">case</span>&nbsp;<span class="string" id="8006979">&#34;udp&#34;</span><span class="op" id="8006984">,</span>&nbsp;<span class="string" id="8006986">&#34;udp4&#34;</span><span class="op" id="8006992">,</span>&nbsp;<span class="string" id="8006994">&#34;udp6&#34;</span><span class="op" id="8007000">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007004">raddr</span>&nbsp;<span class="op" id="8007010">+=</span>&nbsp;<span class="string" id="8007013">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007026">c</span><span class="op" id="8007027">,</span>&nbsp;<span class="ident" id="8007029">err</span>&nbsp;<span class="op" id="8007033">:=</span>&nbsp;<span class="ident" id="8007036">Dial</span><span class="op" id="8007040">(</span><span class="ident" id="8007041">net</span><span class="op" id="8007044">,</span>&nbsp;<span class="ident" id="8007046">raddr</span><span class="op" id="8007051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007054">if</span>&nbsp;<span class="ident" id="8007057">err</span>&nbsp;<span class="op" id="8007061">!=</span>&nbsp;<span class="ident" id="8007064">nil</span>&nbsp;<span class="op" id="8007068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007072">t</span><span class="op" id="8007073">.</span><span class="ident" id="8007074">Fatalf</span><span class="op" id="8007080">(</span><span class="string" id="8007081">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8007098">,</span>&nbsp;<span class="ident" id="8007100">err</span><span class="op" id="8007103">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007109">testFilePacketConn</span><span class="op" id="8007127">(</span><span class="ident" id="8007128">t</span><span class="op" id="8007129">,</span>&nbsp;<span class="ident" id="8007131">c</span><span class="op" id="8007132">.</span><span class="op" id="8007133">(</span><span class="ident" id="8007134">packetConnFile</span><span class="op" id="8007148">)</span><span class="op" id="8007149">,</span>&nbsp;<span class="builtintype" id="8007151">false</span><span class="op" id="8007156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007159">if</span>&nbsp;<span class="ident" id="8007162">err</span>&nbsp;<span class="op" id="8007166">:=</span>&nbsp;<span class="ident" id="8007169">c</span><span class="op" id="8007170">.</span><span class="ident" id="8007171">Close</span><span class="op" id="8007176">(</span><span class="op" id="8007177">)</span><span class="op" id="8007178">;</span>&nbsp;<span class="ident" id="8007180">err</span>&nbsp;<span class="op" id="8007184">!=</span>&nbsp;<span class="ident" id="8007187">nil</span>&nbsp;<span class="op" id="8007191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007195">t</span><span class="op" id="8007196">.</span><span class="ident" id="8007197">Fatalf</span><span class="op" id="8007203">(</span><span class="string" id="8007204">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8007222">,</span>&nbsp;<span class="ident" id="8007224">err</span><span class="op" id="8007227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007230">}</span><br>
<span class="lineno">160</span><span class="op" id="8007232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8007235">var</span>&nbsp;<span class="ident" id="8007239">filePacketConnTests</span>&nbsp;<span class="op" id="8007259">=</span>&nbsp;<span class="op" id="8007261">[</span><span class="op" id="8007262">]</span><span class="keyword" id="8007263">struct</span>&nbsp;<span class="op" id="8007270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007273">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8007279">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007287">addr</span>&nbsp;&nbsp;<span class="builtintype" id="8007293">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007301">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="8007307">bool</span>&nbsp;<span class="comment" id="8007312">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007353">linux</span>&nbsp;<span class="builtintype" id="8007359">bool</span>&nbsp;<span class="comment" id="8007364">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="8007418">}</span><span class="op" id="8007419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007422">{</span><span class="ident" id="8007423">net</span><span class="op" id="8007426">:</span>&nbsp;<span class="string" id="8007428">&#34;udp&#34;</span><span class="op" id="8007433">,</span>&nbsp;<span class="ident" id="8007435">addr</span><span class="op" id="8007439">:</span>&nbsp;<span class="string" id="8007441">&#34;127.0.0.1&#34;</span><span class="op" id="8007452">}</span><span class="op" id="8007453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007456">{</span><span class="ident" id="8007457">net</span><span class="op" id="8007460">:</span>&nbsp;<span class="string" id="8007462">&#34;udp&#34;</span><span class="op" id="8007467">,</span>&nbsp;<span class="ident" id="8007469">addr</span><span class="op" id="8007473">:</span>&nbsp;<span class="string" id="8007475">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8007495">}</span><span class="op" id="8007496">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007499">{</span><span class="ident" id="8007500">net</span><span class="op" id="8007503">:</span>&nbsp;<span class="string" id="8007505">&#34;udp&#34;</span><span class="op" id="8007510">,</span>&nbsp;<span class="ident" id="8007512">addr</span><span class="op" id="8007516">:</span>&nbsp;<span class="string" id="8007518">&#34;[::1]&#34;</span><span class="op" id="8007525">,</span>&nbsp;<span class="ident" id="8007527">ipv6</span><span class="op" id="8007531">:</span>&nbsp;<span class="builtintype" id="8007533">true</span><span class="op" id="8007537">}</span><span class="op" id="8007538">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007542">{</span><span class="ident" id="8007543">net</span><span class="op" id="8007546">:</span>&nbsp;<span class="string" id="8007548">&#34;udp4&#34;</span><span class="op" id="8007554">,</span>&nbsp;<span class="ident" id="8007556">addr</span><span class="op" id="8007560">:</span>&nbsp;<span class="string" id="8007562">&#34;127.0.0.1&#34;</span><span class="op" id="8007573">}</span><span class="op" id="8007574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007577">{</span><span class="ident" id="8007578">net</span><span class="op" id="8007581">:</span>&nbsp;<span class="string" id="8007583">&#34;udp4&#34;</span><span class="op" id="8007589">,</span>&nbsp;<span class="ident" id="8007591">addr</span><span class="op" id="8007595">:</span>&nbsp;<span class="string" id="8007597">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="8007617">}</span><span class="op" id="8007618">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007622">{</span><span class="ident" id="8007623">net</span><span class="op" id="8007626">:</span>&nbsp;<span class="string" id="8007628">&#34;udp6&#34;</span><span class="op" id="8007634">,</span>&nbsp;<span class="ident" id="8007636">addr</span><span class="op" id="8007640">:</span>&nbsp;<span class="string" id="8007642">&#34;[::1]&#34;</span><span class="op" id="8007649">,</span>&nbsp;<span class="ident" id="8007651">ipv6</span><span class="op" id="8007655">:</span>&nbsp;<span class="builtintype" id="8007657">true</span><span class="op" id="8007661">}</span><span class="op" id="8007662">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007666">{</span><span class="ident" id="8007667">net</span><span class="op" id="8007670">:</span>&nbsp;<span class="string" id="8007672">&#34;ip4:icmp&#34;</span><span class="op" id="8007682">,</span>&nbsp;<span class="ident" id="8007684">addr</span><span class="op" id="8007688">:</span>&nbsp;<span class="string" id="8007690">&#34;127.0.0.1&#34;</span><span class="op" id="8007701">}</span><span class="op" id="8007702">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007706">{</span><span class="ident" id="8007707">net</span><span class="op" id="8007710">:</span>&nbsp;<span class="string" id="8007712">&#34;unixgram&#34;</span><span class="op" id="8007722">,</span>&nbsp;<span class="ident" id="8007724">addr</span><span class="op" id="8007728">:</span>&nbsp;<span class="string" id="8007730">&#34;@gotest3/net&#34;</span><span class="op" id="8007744">,</span>&nbsp;<span class="ident" id="8007746">linux</span><span class="op" id="8007751">:</span>&nbsp;<span class="builtintype" id="8007753">true</span><span class="op" id="8007757">}</span><span class="op" id="8007758">,</span><br>
<span class="lineno">180</span><span class="op" id="8007760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8007763">func</span>&nbsp;<span class="ident" id="8007768">TestFilePacketConn</span><span class="op" id="8007786">(</span><span class="ident" id="8007787">t</span>&nbsp;<span class="op" id="8007789">*</span><span class="ident" id="8007790">testing</span><span class="op" id="8007797">.</span><span class="ident" id="8007798">T</span><span class="op" id="8007799">)</span>&nbsp;<span class="op" id="8007801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007804">switch</span>&nbsp;<span class="ident" id="8007811">runtime</span><span class="op" id="8007818">.</span><span class="ident" id="8007819">GOOS</span>&nbsp;<span class="op" id="8007824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007827">case</span>&nbsp;<span class="string" id="8007832">&#34;nacl&#34;</span><span class="op" id="8007838">,</span>&nbsp;<span class="string" id="8007840">&#34;plan9&#34;</span><span class="op" id="8007847">,</span>&nbsp;<span class="string" id="8007849">&#34;windows&#34;</span><span class="op" id="8007858">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8007862">t</span><span class="op" id="8007863">.</span><span class="ident" id="8007864">Skipf</span><span class="op" id="8007869">(</span><span class="string" id="8007870">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8007891">,</span>&nbsp;<span class="ident" id="8007893">runtime</span><span class="op" id="8007900">.</span><span class="ident" id="8007901">GOOS</span><span class="op" id="8007905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8007908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007912">for</span>&nbsp;<span class="ident" id="8007916">_</span><span class="op" id="8007917">,</span>&nbsp;<span class="ident" id="8007919">tt</span>&nbsp;<span class="op" id="8007922">:=</span>&nbsp;<span class="keyword" id="8007925">range</span>&nbsp;<span class="ident" id="8007931">filePacketConnTests</span>&nbsp;<span class="op" id="8007951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8007955">if</span>&nbsp;<span class="ident" id="8007958">skipServerTest</span><span class="op" id="8007972">(</span><span class="ident" id="8007973">tt</span><span class="op" id="8007975">.</span><span class="ident" id="8007976">net</span><span class="op" id="8007979">,</span>&nbsp;<span class="string" id="8007981">&#34;unixgram&#34;</span><span class="op" id="8007991">,</span>&nbsp;<span class="ident" id="8007993">tt</span><span class="op" id="8007995">.</span><span class="ident" id="8007996">addr</span><span class="op" id="8008000">,</span>&nbsp;<span class="ident" id="8008002">tt</span><span class="op" id="8008004">.</span><span class="ident" id="8008005">ipv6</span><span class="op" id="8008009">,</span>&nbsp;<span class="builtintype" id="8008011">false</span><span class="op" id="8008016">,</span>&nbsp;<span class="ident" id="8008018">tt</span><span class="op" id="8008020">.</span><span class="ident" id="8008021">linux</span><span class="op" id="8008026">)</span>&nbsp;<span class="op" id="8008028">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8008044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008048">if</span>&nbsp;<span class="ident" id="8008051">os</span><span class="op" id="8008053">.</span><span class="ident" id="8008054">Getuid</span><span class="op" id="8008060">(</span><span class="op" id="8008061">)</span>&nbsp;<span class="op" id="8008063">!=</span>&nbsp;<span class="num" id="8008066">0</span>&nbsp;<span class="op" id="8008068">&amp;&amp;</span>&nbsp;<span class="ident" id="8008071">tt</span><span class="op" id="8008073">.</span><span class="ident" id="8008074">net</span>&nbsp;<span class="op" id="8008078">==</span>&nbsp;<span class="string" id="8008081">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="8008092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8008097">t</span><span class="op" id="8008098">.</span><span class="ident" id="8008099">Log</span><span class="op" id="8008102">(</span><span class="string" id="8008103">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="8008132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008137">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8008148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8008152">testFilePacketConnListen</span><span class="op" id="8008176">(</span><span class="ident" id="8008177">t</span><span class="op" id="8008178">,</span>&nbsp;<span class="ident" id="8008180">tt</span><span class="op" id="8008182">.</span><span class="ident" id="8008183">net</span><span class="op" id="8008186">,</span>&nbsp;<span class="ident" id="8008188">tt</span><span class="op" id="8008190">.</span><span class="ident" id="8008191">addr</span><span class="op" id="8008195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008199">switch</span>&nbsp;<span class="ident" id="8008206">tt</span><span class="op" id="8008208">.</span><span class="ident" id="8008209">addr</span>&nbsp;<span class="op" id="8008214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008218">case</span>&nbsp;<span class="string" id="8008223">&#34;&#34;</span><span class="op" id="8008225">,</span>&nbsp;<span class="string" id="8008227">&#34;0.0.0.0&#34;</span><span class="op" id="8008236">,</span>&nbsp;<span class="string" id="8008238">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="8008256">,</span>&nbsp;<span class="string" id="8008258">&#34;[::]&#34;</span><span class="op" id="8008264">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008268">default</span><span class="op" id="8008275">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8008280">if</span>&nbsp;<span class="ident" id="8008283">tt</span><span class="op" id="8008285">.</span><span class="ident" id="8008286">net</span>&nbsp;<span class="op" id="8008290">!=</span>&nbsp;<span class="string" id="8008293">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="8008304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8008310">testFilePacketConnDial</span><span class="op" id="8008332">(</span><span class="ident" id="8008333">t</span><span class="op" id="8008334">,</span>&nbsp;<span class="ident" id="8008336">tt</span><span class="op" id="8008338">.</span><span class="ident" id="8008339">net</span><span class="op" id="8008342">,</span>&nbsp;<span class="ident" id="8008344">tt</span><span class="op" id="8008346">.</span><span class="ident" id="8008347">addr</span><span class="op" id="8008351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8008356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8008360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8008363">}</span><br>
<span class="lineno">205</span><span class="op" id="8008365">}</span>
</div>
</body>
</html>
