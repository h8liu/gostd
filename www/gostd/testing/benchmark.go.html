<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6181543">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6181598">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6181652">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6181703">package</span>&nbsp;<span class="ident" id="6181711">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6181720">import</span>&nbsp;<span class="op" id="6181727">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181730">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181738">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181745">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181751">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181762">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181770">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6181785">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6181792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6181795">var</span>&nbsp;<span class="ident" id="6181799">matchBenchmarks</span>&nbsp;<span class="op" id="6181815">=</span>&nbsp;<span class="ident" id="6181817">flag</span><span class="op" id="6181821">.</span><span class="ident" id="6181822">String</span><span class="op" id="6181828">(</span><span class="string" id="6181829">&#34;test.bench&#34;</span><span class="op" id="6181841">,</span>&nbsp;<span class="string" id="6181843">&#34;&#34;</span><span class="op" id="6181845">,</span>&nbsp;<span class="string" id="6181847">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6181895">)</span><br>
<span class="lineno"></span><span class="keyword" id="6181897">var</span>&nbsp;<span class="ident" id="6181901">benchTime</span>&nbsp;<span class="op" id="6181911">=</span>&nbsp;<span class="ident" id="6181913">flag</span><span class="op" id="6181917">.</span><span class="ident" id="6181918">Duration</span><span class="op" id="6181926">(</span><span class="string" id="6181927">&#34;test.benchtime&#34;</span><span class="op" id="6181943">,</span>&nbsp;<span class="num" id="6181945">1</span><span class="op" id="6181946">*</span><span class="ident" id="6181947">time</span><span class="op" id="6181951">.</span><span class="ident" id="6181952">Second</span><span class="op" id="6181958">,</span>&nbsp;<span class="string" id="6181960">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6182001">)</span><br>
<span class="lineno"></span><span class="keyword" id="6182003">var</span>&nbsp;<span class="ident" id="6182007">benchmarkMemory</span>&nbsp;<span class="op" id="6182023">=</span>&nbsp;<span class="ident" id="6182025">flag</span><span class="op" id="6182029">.</span><span class="ident" id="6182030">Bool</span><span class="op" id="6182034">(</span><span class="string" id="6182035">&#34;test.benchmem&#34;</span><span class="op" id="6182050">,</span>&nbsp;<span class="builtintype" id="6182052">false</span><span class="op" id="6182057">,</span>&nbsp;<span class="string" id="6182059">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6182100">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6182103">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6182163">var</span>&nbsp;<span class="ident" id="6182167">benchmarkLock</span>&nbsp;<span class="ident" id="6182181">sync</span><span class="op" id="6182185">.</span><span class="ident" id="6182186">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182193">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6182243">var</span>&nbsp;<span class="ident" id="6182247">memStats</span>&nbsp;<span class="ident" id="6182256">runtime</span><span class="op" id="6182263">.</span><span class="ident" id="6182264">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182274">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6182363">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6182392">type</span>&nbsp;<span class="ident" id="6182397">InternalBenchmark</span>&nbsp;<span class="keyword" id="6182415">struct</span>&nbsp;<span class="op" id="6182422">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182425">Name</span>&nbsp;<span class="builtintype" id="6182430">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182438">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182443">func</span><span class="op" id="6182447">(</span><span class="ident" id="6182448">b</span>&nbsp;<span class="op" id="6182450">*</span><span class="ident" id="6182451">B</span><span class="op" id="6182452">)</span><br>
<span class="lineno"></span><span class="op" id="6182454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6182457">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6182522">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6182580">type</span>&nbsp;<span class="ident" id="6182585">B</span>&nbsp;<span class="keyword" id="6182587">struct</span>&nbsp;<span class="op" id="6182594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182597">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182605">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6182622">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182627">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6182644">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6182658">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182703">previousDuration</span>&nbsp;<span class="ident" id="6182720">time</span><span class="op" id="6182724">.</span><span class="ident" id="6182725">Duration</span>&nbsp;<span class="comment" id="6182734">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182773">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182790">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182809">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182826">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182833">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6182850">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182856">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6182873">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182879">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182896">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6182913">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6182930">int</span>&nbsp;<span class="comment" id="6182934">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6182992">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183060">startAllocs</span>&nbsp;<span class="ident" id="6183072">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183080">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6183092">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6183100">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183148">netAllocs</span>&nbsp;<span class="ident" id="6183158">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183166">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6183176">uint64</span><br>
<span class="lineno"></span><span class="op" id="6183183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6183186">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6183261">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6183335">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6183359">func</span>&nbsp;<span class="op" id="6183364">(</span><span class="ident" id="6183365">b</span>&nbsp;<span class="op" id="6183367">*</span><span class="ident" id="6183368">B</span><span class="op" id="6183369">)</span>&nbsp;<span class="ident" id="6183371">StartTimer</span><span class="op" id="6183381">(</span><span class="op" id="6183382">)</span>&nbsp;<span class="op" id="6183384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183387">if</span>&nbsp;<span class="op" id="6183390">!</span><span class="ident" id="6183391">b</span><span class="op" id="6183392">.</span><span class="ident" id="6183393">timerOn</span>&nbsp;<span class="op" id="6183401">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183405">runtime</span><span class="op" id="6183412">.</span><span class="ident" id="6183413">ReadMemStats</span><span class="op" id="6183425">(</span><span class="op" id="6183426">&amp;</span><span class="ident" id="6183427">memStats</span><span class="op" id="6183435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183439">b</span><span class="op" id="6183440">.</span><span class="ident" id="6183441">startAllocs</span>&nbsp;<span class="op" id="6183453">=</span>&nbsp;<span class="ident" id="6183455">memStats</span><span class="op" id="6183463">.</span><span class="ident" id="6183464">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183474">b</span><span class="op" id="6183475">.</span><span class="ident" id="6183476">startBytes</span>&nbsp;<span class="op" id="6183487">=</span>&nbsp;<span class="ident" id="6183489">memStats</span><span class="op" id="6183497">.</span><span class="ident" id="6183498">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183511">b</span><span class="op" id="6183512">.</span><span class="ident" id="6183513">start</span>&nbsp;<span class="op" id="6183519">=</span>&nbsp;<span class="ident" id="6183521">time</span><span class="op" id="6183525">.</span><span class="ident" id="6183526">Now</span><span class="op" id="6183529">(</span><span class="op" id="6183530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183534">b</span><span class="op" id="6183535">.</span><span class="ident" id="6183536">timerOn</span>&nbsp;<span class="op" id="6183544">=</span>&nbsp;<span class="builtintype" id="6183546">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183552">}</span><br>
<span class="lineno"></span><span class="op" id="6183554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6183557">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6183628">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6183686">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6183706">func</span>&nbsp;<span class="op" id="6183711">(</span><span class="ident" id="6183712">b</span>&nbsp;<span class="op" id="6183714">*</span><span class="ident" id="6183715">B</span><span class="op" id="6183716">)</span>&nbsp;<span class="ident" id="6183718">StopTimer</span><span class="op" id="6183727">(</span><span class="op" id="6183728">)</span>&nbsp;<span class="op" id="6183730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6183733">if</span>&nbsp;<span class="ident" id="6183736">b</span><span class="op" id="6183737">.</span><span class="ident" id="6183738">timerOn</span>&nbsp;<span class="op" id="6183746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183750">b</span><span class="op" id="6183751">.</span><span class="ident" id="6183752">duration</span>&nbsp;<span class="op" id="6183761">+=</span>&nbsp;<span class="ident" id="6183764">time</span><span class="op" id="6183768">.</span><span class="ident" id="6183769">Now</span><span class="op" id="6183772">(</span><span class="op" id="6183773">)</span><span class="op" id="6183774">.</span><span class="ident" id="6183775">Sub</span><span class="op" id="6183778">(</span><span class="ident" id="6183779">b</span><span class="op" id="6183780">.</span><span class="ident" id="6183781">start</span><span class="op" id="6183786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183790">runtime</span><span class="op" id="6183797">.</span><span class="ident" id="6183798">ReadMemStats</span><span class="op" id="6183810">(</span><span class="op" id="6183811">&amp;</span><span class="ident" id="6183812">memStats</span><span class="op" id="6183820">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183824">b</span><span class="op" id="6183825">.</span><span class="ident" id="6183826">netAllocs</span>&nbsp;<span class="op" id="6183836">+=</span>&nbsp;<span class="ident" id="6183839">memStats</span><span class="op" id="6183847">.</span><span class="ident" id="6183848">Mallocs</span>&nbsp;<span class="op" id="6183856">-</span>&nbsp;<span class="ident" id="6183858">b</span><span class="op" id="6183859">.</span><span class="ident" id="6183860">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183874">b</span><span class="op" id="6183875">.</span><span class="ident" id="6183876">netBytes</span>&nbsp;<span class="op" id="6183885">+=</span>&nbsp;<span class="ident" id="6183888">memStats</span><span class="op" id="6183896">.</span><span class="ident" id="6183897">TotalAlloc</span>&nbsp;<span class="op" id="6183908">-</span>&nbsp;<span class="ident" id="6183910">b</span><span class="op" id="6183911">.</span><span class="ident" id="6183912">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6183925">b</span><span class="op" id="6183926">.</span><span class="ident" id="6183927">timerOn</span>&nbsp;<span class="op" id="6183935">=</span>&nbsp;<span class="builtintype" id="6183937">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6183944">}</span><br>
<span class="lineno"></span><span class="op" id="6183946">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6183949">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6184028">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6184080">func</span>&nbsp;<span class="op" id="6184085">(</span><span class="ident" id="6184086">b</span>&nbsp;<span class="op" id="6184088">*</span><span class="ident" id="6184089">B</span><span class="op" id="6184090">)</span>&nbsp;<span class="ident" id="6184092">ResetTimer</span><span class="op" id="6184102">(</span><span class="op" id="6184103">)</span>&nbsp;<span class="op" id="6184105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184108">if</span>&nbsp;<span class="ident" id="6184111">b</span><span class="op" id="6184112">.</span><span class="ident" id="6184113">timerOn</span>&nbsp;<span class="op" id="6184121">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184125">runtime</span><span class="op" id="6184132">.</span><span class="ident" id="6184133">ReadMemStats</span><span class="op" id="6184145">(</span><span class="op" id="6184146">&amp;</span><span class="ident" id="6184147">memStats</span><span class="op" id="6184155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184159">b</span><span class="op" id="6184160">.</span><span class="ident" id="6184161">startAllocs</span>&nbsp;<span class="op" id="6184173">=</span>&nbsp;<span class="ident" id="6184175">memStats</span><span class="op" id="6184183">.</span><span class="ident" id="6184184">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184194">b</span><span class="op" id="6184195">.</span><span class="ident" id="6184196">startBytes</span>&nbsp;<span class="op" id="6184207">=</span>&nbsp;<span class="ident" id="6184209">memStats</span><span class="op" id="6184217">.</span><span class="ident" id="6184218">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184231">b</span><span class="op" id="6184232">.</span><span class="ident" id="6184233">start</span>&nbsp;<span class="op" id="6184239">=</span>&nbsp;<span class="ident" id="6184241">time</span><span class="op" id="6184245">.</span><span class="ident" id="6184246">Now</span><span class="op" id="6184249">(</span><span class="op" id="6184250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184253">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184256">b</span><span class="op" id="6184257">.</span><span class="ident" id="6184258">duration</span>&nbsp;<span class="op" id="6184267">=</span>&nbsp;<span class="num" id="6184269">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184272">b</span><span class="op" id="6184273">.</span><span class="ident" id="6184274">netAllocs</span>&nbsp;<span class="op" id="6184284">=</span>&nbsp;<span class="num" id="6184286">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184289">b</span><span class="op" id="6184290">.</span><span class="ident" id="6184291">netBytes</span>&nbsp;<span class="op" id="6184300">=</span>&nbsp;<span class="num" id="6184302">0</span><br>
<span class="lineno"></span><span class="op" id="6184304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6184307">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6184380">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6184444">func</span>&nbsp;<span class="op" id="6184449">(</span><span class="ident" id="6184450">b</span>&nbsp;<span class="op" id="6184452">*</span><span class="ident" id="6184453">B</span><span class="op" id="6184454">)</span>&nbsp;<span class="ident" id="6184456">SetBytes</span><span class="op" id="6184464">(</span><span class="ident" id="6184465">n</span>&nbsp;<span class="ident" id="6184467">int64</span><span class="op" id="6184472">)</span>&nbsp;<span class="op" id="6184474">{</span>&nbsp;<span class="ident" id="6184476">b</span><span class="op" id="6184477">.</span><span class="ident" id="6184478">bytes</span>&nbsp;<span class="op" id="6184484">=</span>&nbsp;<span class="ident" id="6184486">n</span>&nbsp;<span class="op" id="6184488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184491">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6184553">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6184624">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6184671">func</span>&nbsp;<span class="op" id="6184676">(</span><span class="ident" id="6184677">b</span>&nbsp;<span class="op" id="6184679">*</span><span class="ident" id="6184680">B</span><span class="op" id="6184681">)</span>&nbsp;<span class="ident" id="6184683">ReportAllocs</span><span class="op" id="6184695">(</span><span class="op" id="6184696">)</span>&nbsp;<span class="op" id="6184698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184701">b</span><span class="op" id="6184702">.</span><span class="ident" id="6184703">showAllocResult</span>&nbsp;<span class="op" id="6184719">=</span>&nbsp;<span class="builtintype" id="6184721">true</span><br>
<span class="lineno"></span><span class="op" id="6184726">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6184729">func</span>&nbsp;<span class="op" id="6184734">(</span><span class="ident" id="6184735">b</span>&nbsp;<span class="op" id="6184737">*</span><span class="ident" id="6184738">B</span><span class="op" id="6184739">)</span>&nbsp;<span class="ident" id="6184741">nsPerOp</span><span class="op" id="6184748">(</span><span class="op" id="6184749">)</span>&nbsp;<span class="ident" id="6184751">int64</span>&nbsp;<span class="op" id="6184757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184760">if</span>&nbsp;<span class="ident" id="6184763">b</span><span class="op" id="6184764">.</span><span class="ident" id="6184765">N</span>&nbsp;<span class="op" id="6184767">&lt;=</span>&nbsp;<span class="num" id="6184770">0</span>&nbsp;<span class="op" id="6184772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184776">return</span>&nbsp;<span class="num" id="6184783">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6184786">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184789">return</span>&nbsp;<span class="ident" id="6184796">b</span><span class="op" id="6184797">.</span><span class="ident" id="6184798">duration</span><span class="op" id="6184806">.</span><span class="ident" id="6184807">Nanoseconds</span><span class="op" id="6184818">(</span><span class="op" id="6184819">)</span>&nbsp;<span class="op" id="6184821">/</span>&nbsp;<span class="ident" id="6184823">int64</span><span class="op" id="6184828">(</span><span class="ident" id="6184829">b</span><span class="op" id="6184830">.</span><span class="ident" id="6184831">N</span><span class="op" id="6184832">)</span><br>
<span class="lineno"></span><span class="op" id="6184834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6184837">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6184909">func</span>&nbsp;<span class="op" id="6184914">(</span><span class="ident" id="6184915">b</span>&nbsp;<span class="op" id="6184917">*</span><span class="ident" id="6184918">B</span><span class="op" id="6184919">)</span>&nbsp;<span class="ident" id="6184921">runN</span><span class="op" id="6184925">(</span><span class="ident" id="6184926">n</span>&nbsp;<span class="builtintype" id="6184928">int</span><span class="op" id="6184931">)</span>&nbsp;<span class="op" id="6184933">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6184936">benchmarkLock</span><span class="op" id="6184949">.</span><span class="ident" id="6184950">Lock</span><span class="op" id="6184954">(</span><span class="op" id="6184955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6184958">defer</span>&nbsp;<span class="ident" id="6184964">benchmarkLock</span><span class="op" id="6184977">.</span><span class="ident" id="6184978">Unlock</span><span class="op" id="6184984">(</span><span class="op" id="6184985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6184988">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6185041">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185085">runtime</span><span class="op" id="6185092">.</span><span class="ident" id="6185093">GC</span><span class="op" id="6185095">(</span><span class="op" id="6185096">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185099">b</span><span class="op" id="6185100">.</span><span class="ident" id="6185101">N</span>&nbsp;<span class="op" id="6185103">=</span>&nbsp;<span class="ident" id="6185105">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185108">b</span><span class="op" id="6185109">.</span><span class="ident" id="6185110">parallelism</span>&nbsp;<span class="op" id="6185122">=</span>&nbsp;<span class="num" id="6185124">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185127">b</span><span class="op" id="6185128">.</span><span class="ident" id="6185129">ResetTimer</span><span class="op" id="6185139">(</span><span class="op" id="6185140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185143">b</span><span class="op" id="6185144">.</span><span class="ident" id="6185145">StartTimer</span><span class="op" id="6185155">(</span><span class="op" id="6185156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185159">b</span><span class="op" id="6185160">.</span><span class="ident" id="6185161">benchmark</span><span class="op" id="6185170">.</span><span class="ident" id="6185171">F</span><span class="op" id="6185172">(</span><span class="ident" id="6185173">b</span><span class="op" id="6185174">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185177">b</span><span class="op" id="6185178">.</span><span class="ident" id="6185179">StopTimer</span><span class="op" id="6185188">(</span><span class="op" id="6185189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185192">b</span><span class="op" id="6185193">.</span><span class="ident" id="6185194">previousN</span>&nbsp;<span class="op" id="6185204">=</span>&nbsp;<span class="ident" id="6185206">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185209">b</span><span class="op" id="6185210">.</span><span class="ident" id="6185211">previousDuration</span>&nbsp;<span class="op" id="6185228">=</span>&nbsp;<span class="ident" id="6185230">b</span><span class="op" id="6185231">.</span><span class="ident" id="6185232">duration</span><br>
<span class="lineno"></span><span class="op" id="6185241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6185244">func</span>&nbsp;<span class="ident" id="6185249">min</span><span class="op" id="6185252">(</span><span class="ident" id="6185253">x</span><span class="op" id="6185254">,</span>&nbsp;<span class="ident" id="6185256">y</span>&nbsp;<span class="builtintype" id="6185258">int</span><span class="op" id="6185261">)</span>&nbsp;<span class="builtintype" id="6185263">int</span>&nbsp;<span class="op" id="6185267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185270">if</span>&nbsp;<span class="ident" id="6185273">x</span>&nbsp;<span class="op" id="6185275">&gt;</span>&nbsp;<span class="ident" id="6185277">y</span>&nbsp;<span class="op" id="6185279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185283">return</span>&nbsp;<span class="ident" id="6185290">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185296">return</span>&nbsp;<span class="ident" id="6185303">x</span><br>
<span class="lineno">135</span><span class="op" id="6185305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6185308">func</span>&nbsp;<span class="ident" id="6185313">max</span><span class="op" id="6185316">(</span><span class="ident" id="6185317">x</span><span class="op" id="6185318">,</span>&nbsp;<span class="ident" id="6185320">y</span>&nbsp;<span class="builtintype" id="6185322">int</span><span class="op" id="6185325">)</span>&nbsp;<span class="builtintype" id="6185327">int</span>&nbsp;<span class="op" id="6185331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185334">if</span>&nbsp;<span class="ident" id="6185337">x</span>&nbsp;<span class="op" id="6185339">&lt;</span>&nbsp;<span class="ident" id="6185341">y</span>&nbsp;<span class="op" id="6185343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185347">return</span>&nbsp;<span class="ident" id="6185354">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185360">return</span>&nbsp;<span class="ident" id="6185367">x</span><br>
<span class="lineno"></span><span class="op" id="6185369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185372">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6185436">func</span>&nbsp;<span class="ident" id="6185441">roundDown10</span><span class="op" id="6185452">(</span><span class="ident" id="6185453">n</span>&nbsp;<span class="builtintype" id="6185455">int</span><span class="op" id="6185458">)</span>&nbsp;<span class="builtintype" id="6185460">int</span>&nbsp;<span class="op" id="6185464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185467">var</span>&nbsp;<span class="ident" id="6185471">tens</span>&nbsp;<span class="op" id="6185476">=</span>&nbsp;<span class="num" id="6185478">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6185481">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185509">for</span>&nbsp;<span class="ident" id="6185513">n</span>&nbsp;<span class="op" id="6185515">&gt;=</span>&nbsp;<span class="num" id="6185518">10</span>&nbsp;<span class="op" id="6185521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185525">n</span>&nbsp;<span class="op" id="6185527">=</span>&nbsp;<span class="ident" id="6185529">n</span>&nbsp;<span class="op" id="6185531">/</span>&nbsp;<span class="num" id="6185533">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185538">tens</span><span class="op" id="6185542">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6185549">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185570">result</span>&nbsp;<span class="op" id="6185577">:=</span>&nbsp;<span class="num" id="6185580">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185583">for</span>&nbsp;<span class="ident" id="6185587">i</span>&nbsp;<span class="op" id="6185589">:=</span>&nbsp;<span class="num" id="6185592">0</span><span class="op" id="6185593">;</span>&nbsp;<span class="ident" id="6185595">i</span>&nbsp;<span class="op" id="6185597">&lt;</span>&nbsp;<span class="ident" id="6185599">tens</span><span class="op" id="6185603">;</span>&nbsp;<span class="ident" id="6185605">i</span><span class="op" id="6185606">++</span>&nbsp;<span class="op" id="6185609">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185613">result</span>&nbsp;<span class="op" id="6185620">*=</span>&nbsp;<span class="num" id="6185623">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185630">return</span>&nbsp;<span class="ident" id="6185637">result</span><br>
<span class="lineno"></span><span class="op" id="6185644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6185647">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6185716">func</span>&nbsp;<span class="ident" id="6185721">roundUp</span><span class="op" id="6185728">(</span><span class="ident" id="6185729">n</span>&nbsp;<span class="builtintype" id="6185731">int</span><span class="op" id="6185734">)</span>&nbsp;<span class="builtintype" id="6185736">int</span>&nbsp;<span class="op" id="6185740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6185743">base</span>&nbsp;<span class="op" id="6185748">:=</span>&nbsp;<span class="ident" id="6185751">roundDown10</span><span class="op" id="6185762">(</span><span class="ident" id="6185763">n</span><span class="op" id="6185764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185767">switch</span>&nbsp;<span class="op" id="6185774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185777">case</span>&nbsp;<span class="ident" id="6185782">n</span>&nbsp;<span class="op" id="6185784">&lt;=</span>&nbsp;<span class="ident" id="6185787">base</span><span class="op" id="6185791">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185795">return</span>&nbsp;<span class="ident" id="6185802">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185808">case</span>&nbsp;<span class="ident" id="6185813">n</span>&nbsp;<span class="op" id="6185815">&lt;=</span>&nbsp;<span class="op" id="6185818">(</span><span class="num" id="6185819">2</span>&nbsp;<span class="op" id="6185821">*</span>&nbsp;<span class="ident" id="6185823">base</span><span class="op" id="6185827">)</span><span class="op" id="6185828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185832">return</span>&nbsp;<span class="num" id="6185839">2</span>&nbsp;<span class="op" id="6185841">*</span>&nbsp;<span class="ident" id="6185843">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185849">case</span>&nbsp;<span class="ident" id="6185854">n</span>&nbsp;<span class="op" id="6185856">&lt;=</span>&nbsp;<span class="op" id="6185859">(</span><span class="num" id="6185860">3</span>&nbsp;<span class="op" id="6185862">*</span>&nbsp;<span class="ident" id="6185864">base</span><span class="op" id="6185868">)</span><span class="op" id="6185869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185873">return</span>&nbsp;<span class="num" id="6185880">3</span>&nbsp;<span class="op" id="6185882">*</span>&nbsp;<span class="ident" id="6185884">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185890">case</span>&nbsp;<span class="ident" id="6185895">n</span>&nbsp;<span class="op" id="6185897">&lt;=</span>&nbsp;<span class="op" id="6185900">(</span><span class="num" id="6185901">5</span>&nbsp;<span class="op" id="6185903">*</span>&nbsp;<span class="ident" id="6185905">base</span><span class="op" id="6185909">)</span><span class="op" id="6185910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185914">return</span>&nbsp;<span class="num" id="6185921">5</span>&nbsp;<span class="op" id="6185923">*</span>&nbsp;<span class="ident" id="6185925">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185931">default</span><span class="op" id="6185938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6185942">return</span>&nbsp;<span class="num" id="6185949">10</span>&nbsp;<span class="op" id="6185952">*</span>&nbsp;<span class="ident" id="6185954">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6185960">}</span><br>
<span class="lineno">175</span><span class="op" id="6185962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6185965">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6186026">func</span>&nbsp;<span class="op" id="6186031">(</span><span class="ident" id="6186032">b</span>&nbsp;<span class="op" id="6186034">*</span><span class="ident" id="6186035">B</span><span class="op" id="6186036">)</span>&nbsp;<span class="ident" id="6186038">run</span><span class="op" id="6186041">(</span><span class="op" id="6186042">)</span>&nbsp;<span class="ident" id="6186044">BenchmarkResult</span>&nbsp;<span class="op" id="6186060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186063">go</span>&nbsp;<span class="ident" id="6186066">b</span><span class="op" id="6186067">.</span><span class="ident" id="6186068">launch</span><span class="op" id="6186074">(</span><span class="op" id="6186075">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186078">&lt;-</span><span class="ident" id="6186080">b</span><span class="op" id="6186081">.</span><span class="ident" id="6186082">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186090">return</span>&nbsp;<span class="ident" id="6186097">b</span><span class="op" id="6186098">.</span><span class="ident" id="6186099">result</span><br>
<span class="lineno"></span><span class="op" id="6186106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6186109">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6186187">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6186268">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6186313">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6186357">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6186419">func</span>&nbsp;<span class="op" id="6186424">(</span><span class="ident" id="6186425">b</span>&nbsp;<span class="op" id="6186427">*</span><span class="ident" id="6186428">B</span><span class="op" id="6186429">)</span>&nbsp;<span class="ident" id="6186431">launch</span><span class="op" id="6186437">(</span><span class="op" id="6186438">)</span>&nbsp;<span class="op" id="6186440">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186443">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186512">n</span>&nbsp;<span class="op" id="6186514">:=</span>&nbsp;<span class="num" id="6186517">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186521">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186575">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186611">defer</span>&nbsp;<span class="keyword" id="6186617">func</span><span class="op" id="6186621">(</span><span class="op" id="6186622">)</span>&nbsp;<span class="op" id="6186624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186628">b</span><span class="op" id="6186629">.</span><span class="ident" id="6186630">signal</span>&nbsp;<span class="op" id="6186637">&lt;-</span>&nbsp;<span class="ident" id="6186640">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186643">}</span><span class="op" id="6186644">(</span><span class="op" id="6186645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186649">b</span><span class="op" id="6186650">.</span><span class="ident" id="6186651">runN</span><span class="op" id="6186655">(</span><span class="ident" id="6186656">n</span><span class="op" id="6186657">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186660">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186725">d</span>&nbsp;<span class="op" id="6186727">:=</span>&nbsp;<span class="op" id="6186730">*</span><span class="ident" id="6186731">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186742">for</span>&nbsp;<span class="op" id="6186746">!</span><span class="ident" id="6186747">b</span><span class="op" id="6186748">.</span><span class="ident" id="6186749">failed</span>&nbsp;<span class="op" id="6186756">&amp;&amp;</span>&nbsp;<span class="ident" id="6186759">b</span><span class="op" id="6186760">.</span><span class="ident" id="6186761">duration</span>&nbsp;<span class="op" id="6186770">&lt;</span>&nbsp;<span class="ident" id="6186772">d</span>&nbsp;<span class="op" id="6186774">&amp;&amp;</span>&nbsp;<span class="ident" id="6186777">n</span>&nbsp;<span class="op" id="6186779">&lt;</span>&nbsp;<span class="num" id="6186781">1e9</span>&nbsp;<span class="op" id="6186785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186789">last</span>&nbsp;<span class="op" id="6186794">:=</span>&nbsp;<span class="ident" id="6186797">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186801">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6186835">if</span>&nbsp;<span class="ident" id="6186838">b</span><span class="op" id="6186839">.</span><span class="ident" id="6186840">nsPerOp</span><span class="op" id="6186847">(</span><span class="op" id="6186848">)</span>&nbsp;<span class="op" id="6186850">==</span>&nbsp;<span class="num" id="6186853">0</span>&nbsp;<span class="op" id="6186855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186860">n</span>&nbsp;<span class="op" id="6186862">=</span>&nbsp;<span class="num" id="6186864">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186870">}</span>&nbsp;<span class="keyword" id="6186872">else</span>&nbsp;<span class="op" id="6186877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6186882">n</span>&nbsp;<span class="op" id="6186884">=</span>&nbsp;<span class="builtintype" id="6186886">int</span><span class="op" id="6186889">(</span><span class="ident" id="6186890">d</span><span class="op" id="6186891">.</span><span class="ident" id="6186892">Nanoseconds</span><span class="op" id="6186903">(</span><span class="op" id="6186904">)</span>&nbsp;<span class="op" id="6186906">/</span>&nbsp;<span class="ident" id="6186908">b</span><span class="op" id="6186909">.</span><span class="ident" id="6186910">nsPerOp</span><span class="op" id="6186917">(</span><span class="op" id="6186918">)</span><span class="op" id="6186919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6186923">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186927">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6186985">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187051">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187105">n</span>&nbsp;<span class="op" id="6187107">=</span>&nbsp;<span class="ident" id="6187109">max</span><span class="op" id="6187112">(</span><span class="ident" id="6187113">min</span><span class="op" id="6187116">(</span><span class="ident" id="6187117">n</span><span class="op" id="6187118">+</span><span class="ident" id="6187119">n</span><span class="op" id="6187120">/</span><span class="num" id="6187121">5</span><span class="op" id="6187122">,</span>&nbsp;<span class="num" id="6187124">100</span><span class="op" id="6187127">*</span><span class="ident" id="6187128">last</span><span class="op" id="6187132">)</span><span class="op" id="6187133">,</span>&nbsp;<span class="ident" id="6187135">last</span><span class="op" id="6187139">+</span><span class="num" id="6187140">1</span><span class="op" id="6187141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6187145">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187186">n</span>&nbsp;<span class="op" id="6187188">=</span>&nbsp;<span class="ident" id="6187190">roundUp</span><span class="op" id="6187197">(</span><span class="ident" id="6187198">n</span><span class="op" id="6187199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187203">b</span><span class="op" id="6187204">.</span><span class="ident" id="6187205">runN</span><span class="op" id="6187209">(</span><span class="ident" id="6187210">n</span><span class="op" id="6187211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187217">b</span><span class="op" id="6187218">.</span><span class="ident" id="6187219">result</span>&nbsp;<span class="op" id="6187226">=</span>&nbsp;<span class="ident" id="6187228">BenchmarkResult</span><span class="op" id="6187243">{</span><span class="ident" id="6187244">b</span><span class="op" id="6187245">.</span><span class="ident" id="6187246">N</span><span class="op" id="6187247">,</span>&nbsp;<span class="ident" id="6187249">b</span><span class="op" id="6187250">.</span><span class="ident" id="6187251">duration</span><span class="op" id="6187259">,</span>&nbsp;<span class="ident" id="6187261">b</span><span class="op" id="6187262">.</span><span class="ident" id="6187263">bytes</span><span class="op" id="6187268">,</span>&nbsp;<span class="ident" id="6187270">b</span><span class="op" id="6187271">.</span><span class="ident" id="6187272">netAllocs</span><span class="op" id="6187281">,</span>&nbsp;<span class="ident" id="6187283">b</span><span class="op" id="6187284">.</span><span class="ident" id="6187285">netBytes</span><span class="op" id="6187293">}</span><br>
<span class="lineno"></span><span class="op" id="6187295">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6187298">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6187333">type</span>&nbsp;<span class="ident" id="6187338">BenchmarkResult</span>&nbsp;<span class="keyword" id="6187354">struct</span>&nbsp;<span class="op" id="6187361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187364">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6187374">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6187388">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187418">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6187428">time</span><span class="op" id="6187432">.</span><span class="ident" id="6187433">Duration</span>&nbsp;<span class="comment" id="6187442">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187468">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6187478">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6187492">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187530">MemAllocs</span>&nbsp;<span class="ident" id="6187540">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6187554">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6187598">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6187608">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6187622">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6187662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6187665">func</span>&nbsp;<span class="op" id="6187670">(</span><span class="ident" id="6187671">r</span>&nbsp;<span class="ident" id="6187673">BenchmarkResult</span><span class="op" id="6187688">)</span>&nbsp;<span class="ident" id="6187690">NsPerOp</span><span class="op" id="6187697">(</span><span class="op" id="6187698">)</span>&nbsp;<span class="ident" id="6187700">int64</span>&nbsp;<span class="op" id="6187706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187709">if</span>&nbsp;<span class="ident" id="6187712">r</span><span class="op" id="6187713">.</span><span class="ident" id="6187714">N</span>&nbsp;<span class="op" id="6187716">&lt;=</span>&nbsp;<span class="num" id="6187719">0</span>&nbsp;<span class="op" id="6187721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187725">return</span>&nbsp;<span class="num" id="6187732">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187738">return</span>&nbsp;<span class="ident" id="6187745">r</span><span class="op" id="6187746">.</span><span class="ident" id="6187747">T</span><span class="op" id="6187748">.</span><span class="ident" id="6187749">Nanoseconds</span><span class="op" id="6187760">(</span><span class="op" id="6187761">)</span>&nbsp;<span class="op" id="6187763">/</span>&nbsp;<span class="ident" id="6187765">int64</span><span class="op" id="6187770">(</span><span class="ident" id="6187771">r</span><span class="op" id="6187772">.</span><span class="ident" id="6187773">N</span><span class="op" id="6187774">)</span><br>
<span class="lineno">235</span><span class="op" id="6187776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6187779">func</span>&nbsp;<span class="op" id="6187784">(</span><span class="ident" id="6187785">r</span>&nbsp;<span class="ident" id="6187787">BenchmarkResult</span><span class="op" id="6187802">)</span>&nbsp;<span class="ident" id="6187804">mbPerSec</span><span class="op" id="6187812">(</span><span class="op" id="6187813">)</span>&nbsp;<span class="builtintype" id="6187815">float64</span>&nbsp;<span class="op" id="6187823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187826">if</span>&nbsp;<span class="ident" id="6187829">r</span><span class="op" id="6187830">.</span><span class="ident" id="6187831">Bytes</span>&nbsp;<span class="op" id="6187837">&lt;=</span>&nbsp;<span class="num" id="6187840">0</span>&nbsp;<span class="op" id="6187842">||</span>&nbsp;<span class="ident" id="6187845">r</span><span class="op" id="6187846">.</span><span class="ident" id="6187847">T</span>&nbsp;<span class="op" id="6187849">&lt;=</span>&nbsp;<span class="num" id="6187852">0</span>&nbsp;<span class="op" id="6187854">||</span>&nbsp;<span class="ident" id="6187857">r</span><span class="op" id="6187858">.</span><span class="ident" id="6187859">N</span>&nbsp;<span class="op" id="6187861">&lt;=</span>&nbsp;<span class="num" id="6187864">0</span>&nbsp;<span class="op" id="6187866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187870">return</span>&nbsp;<span class="num" id="6187877">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6187880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187883">return</span>&nbsp;<span class="op" id="6187890">(</span><span class="builtintype" id="6187891">float64</span><span class="op" id="6187898">(</span><span class="ident" id="6187899">r</span><span class="op" id="6187900">.</span><span class="ident" id="6187901">Bytes</span><span class="op" id="6187906">)</span>&nbsp;<span class="op" id="6187908">*</span>&nbsp;<span class="builtintype" id="6187910">float64</span><span class="op" id="6187917">(</span><span class="ident" id="6187918">r</span><span class="op" id="6187919">.</span><span class="ident" id="6187920">N</span><span class="op" id="6187921">)</span>&nbsp;<span class="op" id="6187923">/</span>&nbsp;<span class="num" id="6187925">1e6</span><span class="op" id="6187928">)</span>&nbsp;<span class="op" id="6187930">/</span>&nbsp;<span class="ident" id="6187932">r</span><span class="op" id="6187933">.</span><span class="ident" id="6187934">T</span><span class="op" id="6187935">.</span><span class="ident" id="6187936">Seconds</span><span class="op" id="6187943">(</span><span class="op" id="6187944">)</span><br>
<span class="lineno"></span><span class="op" id="6187946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6187949">func</span>&nbsp;<span class="op" id="6187954">(</span><span class="ident" id="6187955">r</span>&nbsp;<span class="ident" id="6187957">BenchmarkResult</span><span class="op" id="6187972">)</span>&nbsp;<span class="ident" id="6187974">AllocsPerOp</span><span class="op" id="6187985">(</span><span class="op" id="6187986">)</span>&nbsp;<span class="ident" id="6187988">int64</span>&nbsp;<span class="op" id="6187994">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6187997">if</span>&nbsp;<span class="ident" id="6188000">r</span><span class="op" id="6188001">.</span><span class="ident" id="6188002">N</span>&nbsp;<span class="op" id="6188004">&lt;=</span>&nbsp;<span class="num" id="6188007">0</span>&nbsp;<span class="op" id="6188009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188013">return</span>&nbsp;<span class="num" id="6188020">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188026">return</span>&nbsp;<span class="ident" id="6188033">int64</span><span class="op" id="6188038">(</span><span class="ident" id="6188039">r</span><span class="op" id="6188040">.</span><span class="ident" id="6188041">MemAllocs</span><span class="op" id="6188050">)</span>&nbsp;<span class="op" id="6188052">/</span>&nbsp;<span class="ident" id="6188054">int64</span><span class="op" id="6188059">(</span><span class="ident" id="6188060">r</span><span class="op" id="6188061">.</span><span class="ident" id="6188062">N</span><span class="op" id="6188063">)</span><br>
<span class="lineno"></span><span class="op" id="6188065">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6188068">func</span>&nbsp;<span class="op" id="6188073">(</span><span class="ident" id="6188074">r</span>&nbsp;<span class="ident" id="6188076">BenchmarkResult</span><span class="op" id="6188091">)</span>&nbsp;<span class="ident" id="6188093">AllocedBytesPerOp</span><span class="op" id="6188110">(</span><span class="op" id="6188111">)</span>&nbsp;<span class="ident" id="6188113">int64</span>&nbsp;<span class="op" id="6188119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188122">if</span>&nbsp;<span class="ident" id="6188125">r</span><span class="op" id="6188126">.</span><span class="ident" id="6188127">N</span>&nbsp;<span class="op" id="6188129">&lt;=</span>&nbsp;<span class="num" id="6188132">0</span>&nbsp;<span class="op" id="6188134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188138">return</span>&nbsp;<span class="num" id="6188145">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188148">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188151">return</span>&nbsp;<span class="ident" id="6188158">int64</span><span class="op" id="6188163">(</span><span class="ident" id="6188164">r</span><span class="op" id="6188165">.</span><span class="ident" id="6188166">MemBytes</span><span class="op" id="6188174">)</span>&nbsp;<span class="op" id="6188176">/</span>&nbsp;<span class="ident" id="6188178">int64</span><span class="op" id="6188183">(</span><span class="ident" id="6188184">r</span><span class="op" id="6188185">.</span><span class="ident" id="6188186">N</span><span class="op" id="6188187">)</span><br>
<span class="lineno"></span><span class="op" id="6188189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6188192">func</span>&nbsp;<span class="op" id="6188197">(</span><span class="ident" id="6188198">r</span>&nbsp;<span class="ident" id="6188200">BenchmarkResult</span><span class="op" id="6188215">)</span>&nbsp;<span class="ident" id="6188217">String</span><span class="op" id="6188223">(</span><span class="op" id="6188224">)</span>&nbsp;<span class="builtintype" id="6188226">string</span>&nbsp;<span class="op" id="6188233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188236">mbs</span>&nbsp;<span class="op" id="6188240">:=</span>&nbsp;<span class="ident" id="6188243">r</span><span class="op" id="6188244">.</span><span class="ident" id="6188245">mbPerSec</span><span class="op" id="6188253">(</span><span class="op" id="6188254">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188257">mb</span>&nbsp;<span class="op" id="6188260">:=</span>&nbsp;<span class="string" id="6188263">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188267">if</span>&nbsp;<span class="ident" id="6188270">mbs</span>&nbsp;<span class="op" id="6188274">!=</span>&nbsp;<span class="num" id="6188277">0</span>&nbsp;<span class="op" id="6188279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188283">mb</span>&nbsp;<span class="op" id="6188286">=</span>&nbsp;<span class="ident" id="6188288">fmt</span><span class="op" id="6188291">.</span><span class="ident" id="6188292">Sprintf</span><span class="op" id="6188299">(</span><span class="string" id="6188300">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6188314">,</span>&nbsp;<span class="ident" id="6188316">mbs</span><span class="op" id="6188319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188325">nsop</span>&nbsp;<span class="op" id="6188330">:=</span>&nbsp;<span class="ident" id="6188333">r</span><span class="op" id="6188334">.</span><span class="ident" id="6188335">NsPerOp</span><span class="op" id="6188342">(</span><span class="op" id="6188343">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188346">ns</span>&nbsp;<span class="op" id="6188349">:=</span>&nbsp;<span class="ident" id="6188352">fmt</span><span class="op" id="6188355">.</span><span class="ident" id="6188356">Sprintf</span><span class="op" id="6188363">(</span><span class="string" id="6188364">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6188376">,</span>&nbsp;<span class="ident" id="6188378">nsop</span><span class="op" id="6188382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188385">if</span>&nbsp;<span class="ident" id="6188388">r</span><span class="op" id="6188389">.</span><span class="ident" id="6188390">N</span>&nbsp;<span class="op" id="6188392">&gt;</span>&nbsp;<span class="num" id="6188394">0</span>&nbsp;<span class="op" id="6188396">&amp;&amp;</span>&nbsp;<span class="ident" id="6188399">nsop</span>&nbsp;<span class="op" id="6188404">&lt;</span>&nbsp;<span class="num" id="6188406">100</span>&nbsp;<span class="op" id="6188410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188414">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6188461">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188522">if</span>&nbsp;<span class="ident" id="6188525">nsop</span>&nbsp;<span class="op" id="6188530">&lt;</span>&nbsp;<span class="num" id="6188532">10</span>&nbsp;<span class="op" id="6188535">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188540">ns</span>&nbsp;<span class="op" id="6188543">=</span>&nbsp;<span class="ident" id="6188545">fmt</span><span class="op" id="6188548">.</span><span class="ident" id="6188549">Sprintf</span><span class="op" id="6188556">(</span><span class="string" id="6188557">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6188571">,</span>&nbsp;<span class="builtintype" id="6188573">float64</span><span class="op" id="6188580">(</span><span class="ident" id="6188581">r</span><span class="op" id="6188582">.</span><span class="ident" id="6188583">T</span><span class="op" id="6188584">.</span><span class="ident" id="6188585">Nanoseconds</span><span class="op" id="6188596">(</span><span class="op" id="6188597">)</span><span class="op" id="6188598">)</span><span class="op" id="6188599">/</span><span class="builtintype" id="6188600">float64</span><span class="op" id="6188607">(</span><span class="ident" id="6188608">r</span><span class="op" id="6188609">.</span><span class="ident" id="6188610">N</span><span class="op" id="6188611">)</span><span class="op" id="6188612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188616">}</span>&nbsp;<span class="keyword" id="6188618">else</span>&nbsp;<span class="op" id="6188623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188628">ns</span>&nbsp;<span class="op" id="6188631">=</span>&nbsp;<span class="ident" id="6188633">fmt</span><span class="op" id="6188636">.</span><span class="ident" id="6188637">Sprintf</span><span class="op" id="6188644">(</span><span class="string" id="6188645">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6188659">,</span>&nbsp;<span class="builtintype" id="6188661">float64</span><span class="op" id="6188668">(</span><span class="ident" id="6188669">r</span><span class="op" id="6188670">.</span><span class="ident" id="6188671">T</span><span class="op" id="6188672">.</span><span class="ident" id="6188673">Nanoseconds</span><span class="op" id="6188684">(</span><span class="op" id="6188685">)</span><span class="op" id="6188686">)</span><span class="op" id="6188687">/</span><span class="builtintype" id="6188688">float64</span><span class="op" id="6188695">(</span><span class="ident" id="6188696">r</span><span class="op" id="6188697">.</span><span class="ident" id="6188698">N</span><span class="op" id="6188699">)</span><span class="op" id="6188700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6188707">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188710">return</span>&nbsp;<span class="ident" id="6188717">fmt</span><span class="op" id="6188720">.</span><span class="ident" id="6188721">Sprintf</span><span class="op" id="6188728">(</span><span class="string" id="6188729">&#34;%8d\t%s%s&#34;</span><span class="op" id="6188740">,</span>&nbsp;<span class="ident" id="6188742">r</span><span class="op" id="6188743">.</span><span class="ident" id="6188744">N</span><span class="op" id="6188745">,</span>&nbsp;<span class="ident" id="6188747">ns</span><span class="op" id="6188749">,</span>&nbsp;<span class="ident" id="6188751">mb</span><span class="op" id="6188753">)</span><br>
<span class="lineno"></span><span class="op" id="6188755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6188758">func</span>&nbsp;<span class="op" id="6188763">(</span><span class="ident" id="6188764">r</span>&nbsp;<span class="ident" id="6188766">BenchmarkResult</span><span class="op" id="6188781">)</span>&nbsp;<span class="ident" id="6188783">MemString</span><span class="op" id="6188792">(</span><span class="op" id="6188793">)</span>&nbsp;<span class="builtintype" id="6188795">string</span>&nbsp;<span class="op" id="6188802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6188805">return</span>&nbsp;<span class="ident" id="6188812">fmt</span><span class="op" id="6188815">.</span><span class="ident" id="6188816">Sprintf</span><span class="op" id="6188823">(</span><span class="string" id="6188824">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6188849">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6188853">r</span><span class="op" id="6188854">.</span><span class="ident" id="6188855">AllocedBytesPerOp</span><span class="op" id="6188872">(</span><span class="op" id="6188873">)</span><span class="op" id="6188874">,</span>&nbsp;<span class="ident" id="6188876">r</span><span class="op" id="6188877">.</span><span class="ident" id="6188878">AllocsPerOp</span><span class="op" id="6188889">(</span><span class="op" id="6188890">)</span><span class="op" id="6188891">)</span><br>
<span class="lineno"></span><span class="op" id="6188893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6188896">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6188989">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6189018">func</span>&nbsp;<span class="ident" id="6189023">RunBenchmarks</span><span class="op" id="6189036">(</span><span class="ident" id="6189037">matchString</span>&nbsp;<span class="keyword" id="6189049">func</span><span class="op" id="6189053">(</span><span class="ident" id="6189054">pat</span><span class="op" id="6189057">,</span>&nbsp;<span class="ident" id="6189059">str</span>&nbsp;<span class="builtintype" id="6189063">string</span><span class="op" id="6189069">)</span>&nbsp;<span class="op" id="6189071">(</span><span class="builtintype" id="6189072">bool</span><span class="op" id="6189076">,</span>&nbsp;<span class="builtintype" id="6189078">error</span><span class="op" id="6189083">)</span><span class="op" id="6189084">,</span>&nbsp;<span class="ident" id="6189086">benchmarks</span>&nbsp;<span class="op" id="6189097">[</span><span class="op" id="6189098">]</span><span class="ident" id="6189099">InternalBenchmark</span><span class="op" id="6189116">)</span>&nbsp;<span class="op" id="6189118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6189121">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189173">if</span>&nbsp;<span class="builtinfunc" id="6189176">len</span><span class="op" id="6189179">(</span><span class="op" id="6189180">*</span><span class="ident" id="6189181">matchBenchmarks</span><span class="op" id="6189196">)</span>&nbsp;<span class="op" id="6189198">==</span>&nbsp;<span class="num" id="6189201">0</span>&nbsp;<span class="op" id="6189203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189207">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189215">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189218">for</span>&nbsp;<span class="ident" id="6189222">_</span><span class="op" id="6189223">,</span>&nbsp;<span class="ident" id="6189225">Benchmark</span>&nbsp;<span class="op" id="6189235">:=</span>&nbsp;<span class="keyword" id="6189238">range</span>&nbsp;<span class="ident" id="6189244">benchmarks</span>&nbsp;<span class="op" id="6189255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189259">matched</span><span class="op" id="6189266">,</span>&nbsp;<span class="ident" id="6189268">err</span>&nbsp;<span class="op" id="6189272">:=</span>&nbsp;<span class="ident" id="6189275">matchString</span><span class="op" id="6189286">(</span><span class="op" id="6189287">*</span><span class="ident" id="6189288">matchBenchmarks</span><span class="op" id="6189303">,</span>&nbsp;<span class="ident" id="6189305">Benchmark</span><span class="op" id="6189314">.</span><span class="ident" id="6189315">Name</span><span class="op" id="6189319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189323">if</span>&nbsp;<span class="ident" id="6189326">err</span>&nbsp;<span class="op" id="6189330">!=</span>&nbsp;<span class="ident" id="6189333">nil</span>&nbsp;<span class="op" id="6189337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189342">fmt</span><span class="op" id="6189345">.</span><span class="ident" id="6189346">Fprintf</span><span class="op" id="6189353">(</span><span class="ident" id="6189354">os</span><span class="op" id="6189356">.</span><span class="ident" id="6189357">Stderr</span><span class="op" id="6189363">,</span>&nbsp;<span class="string" id="6189365">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6189412">,</span>&nbsp;<span class="ident" id="6189414">err</span><span class="op" id="6189417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189422">os</span><span class="op" id="6189424">.</span><span class="ident" id="6189425">Exit</span><span class="op" id="6189429">(</span><span class="num" id="6189430">1</span><span class="op" id="6189431">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189439">if</span>&nbsp;<span class="op" id="6189442">!</span><span class="ident" id="6189443">matched</span>&nbsp;<span class="op" id="6189451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189456">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189471">for</span>&nbsp;<span class="ident" id="6189475">_</span><span class="op" id="6189476">,</span>&nbsp;<span class="ident" id="6189478">procs</span>&nbsp;<span class="op" id="6189484">:=</span>&nbsp;<span class="keyword" id="6189487">range</span>&nbsp;<span class="ident" id="6189493">cpuList</span>&nbsp;<span class="op" id="6189501">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189506">runtime</span><span class="op" id="6189513">.</span><span class="ident" id="6189514">GOMAXPROCS</span><span class="op" id="6189524">(</span><span class="ident" id="6189525">procs</span><span class="op" id="6189530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189535">b</span>&nbsp;<span class="op" id="6189537">:=</span>&nbsp;<span class="op" id="6189540">&amp;</span><span class="ident" id="6189541">B</span><span class="op" id="6189542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189548">common</span><span class="op" id="6189554">:</span>&nbsp;<span class="ident" id="6189556">common</span><span class="op" id="6189562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189569">signal</span><span class="op" id="6189575">:</span>&nbsp;<span class="builtinfunc" id="6189577">make</span><span class="op" id="6189581">(</span><span class="keyword" id="6189582">chan</span>&nbsp;<span class="keyword" id="6189587">interface</span><span class="op" id="6189596">{</span><span class="op" id="6189597">}</span><span class="op" id="6189598">)</span><span class="op" id="6189599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189605">}</span><span class="op" id="6189606">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189612">benchmark</span><span class="op" id="6189621">:</span>&nbsp;<span class="ident" id="6189623">Benchmark</span><span class="op" id="6189632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189642">benchName</span>&nbsp;<span class="op" id="6189652">:=</span>&nbsp;<span class="ident" id="6189655">Benchmark</span><span class="op" id="6189664">.</span><span class="ident" id="6189665">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189673">if</span>&nbsp;<span class="ident" id="6189676">procs</span>&nbsp;<span class="op" id="6189682">!=</span>&nbsp;<span class="num" id="6189685">1</span>&nbsp;<span class="op" id="6189687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189693">benchName</span>&nbsp;<span class="op" id="6189703">=</span>&nbsp;<span class="ident" id="6189705">fmt</span><span class="op" id="6189708">.</span><span class="ident" id="6189709">Sprintf</span><span class="op" id="6189716">(</span><span class="string" id="6189717">&#34;%s-%d&#34;</span><span class="op" id="6189724">,</span>&nbsp;<span class="ident" id="6189726">Benchmark</span><span class="op" id="6189735">.</span><span class="ident" id="6189736">Name</span><span class="op" id="6189740">,</span>&nbsp;<span class="ident" id="6189742">procs</span><span class="op" id="6189747">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6189752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189757">fmt</span><span class="op" id="6189760">.</span><span class="ident" id="6189761">Printf</span><span class="op" id="6189767">(</span><span class="string" id="6189768">&#34;%s\t&#34;</span><span class="op" id="6189774">,</span>&nbsp;<span class="ident" id="6189776">benchName</span><span class="op" id="6189785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189790">r</span>&nbsp;<span class="op" id="6189792">:=</span>&nbsp;<span class="ident" id="6189795">b</span><span class="op" id="6189796">.</span><span class="ident" id="6189797">run</span><span class="op" id="6189800">(</span><span class="op" id="6189801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6189806">if</span>&nbsp;<span class="ident" id="6189809">b</span><span class="op" id="6189810">.</span><span class="ident" id="6189811">failed</span>&nbsp;<span class="op" id="6189818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6189824">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6189887">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6189964">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6189993">fmt</span><span class="op" id="6189996">.</span><span class="ident" id="6189997">Printf</span><span class="op" id="6190003">(</span><span class="string" id="6190004">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6190022">,</span>&nbsp;<span class="ident" id="6190024">benchName</span><span class="op" id="6190033">,</span>&nbsp;<span class="ident" id="6190035">b</span><span class="op" id="6190036">.</span><span class="ident" id="6190037">output</span><span class="op" id="6190043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190049">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190061">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190066">results</span>&nbsp;<span class="op" id="6190074">:=</span>&nbsp;<span class="ident" id="6190077">r</span><span class="op" id="6190078">.</span><span class="ident" id="6190079">String</span><span class="op" id="6190085">(</span><span class="op" id="6190086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190091">if</span>&nbsp;<span class="op" id="6190094">*</span><span class="ident" id="6190095">benchmarkMemory</span>&nbsp;<span class="op" id="6190111">||</span>&nbsp;<span class="ident" id="6190114">b</span><span class="op" id="6190115">.</span><span class="ident" id="6190116">showAllocResult</span>&nbsp;<span class="op" id="6190132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190138">results</span>&nbsp;<span class="op" id="6190146">+=</span>&nbsp;<span class="string" id="6190149">&#34;\t&#34;</span>&nbsp;<span class="op" id="6190154">+</span>&nbsp;<span class="ident" id="6190156">r</span><span class="op" id="6190157">.</span><span class="ident" id="6190158">MemString</span><span class="op" id="6190167">(</span><span class="op" id="6190168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190178">fmt</span><span class="op" id="6190181">.</span><span class="ident" id="6190182">Println</span><span class="op" id="6190189">(</span><span class="ident" id="6190190">results</span><span class="op" id="6190197">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190202">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190282">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190355">if</span>&nbsp;<span class="builtinfunc" id="6190358">len</span><span class="op" id="6190361">(</span><span class="ident" id="6190362">b</span><span class="op" id="6190363">.</span><span class="ident" id="6190364">output</span><span class="op" id="6190370">)</span>&nbsp;<span class="op" id="6190372">&gt;</span>&nbsp;<span class="num" id="6190374">0</span>&nbsp;<span class="op" id="6190376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190382">b</span><span class="op" id="6190383">.</span><span class="ident" id="6190384">trimOutput</span><span class="op" id="6190394">(</span><span class="op" id="6190395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190401">fmt</span><span class="op" id="6190404">.</span><span class="ident" id="6190405">Printf</span><span class="op" id="6190411">(</span><span class="string" id="6190412">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6190431">,</span>&nbsp;<span class="ident" id="6190433">benchName</span><span class="op" id="6190442">,</span>&nbsp;<span class="ident" id="6190444">b</span><span class="op" id="6190445">.</span><span class="ident" id="6190446">output</span><span class="op" id="6190452">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190462">if</span>&nbsp;<span class="ident" id="6190465">p</span>&nbsp;<span class="op" id="6190467">:=</span>&nbsp;<span class="ident" id="6190470">runtime</span><span class="op" id="6190477">.</span><span class="ident" id="6190478">GOMAXPROCS</span><span class="op" id="6190488">(</span><span class="op" id="6190489">-</span><span class="num" id="6190490">1</span><span class="op" id="6190491">)</span><span class="op" id="6190492">;</span>&nbsp;<span class="ident" id="6190494">p</span>&nbsp;<span class="op" id="6190496">!=</span>&nbsp;<span class="ident" id="6190499">procs</span>&nbsp;<span class="op" id="6190505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6190511">fmt</span><span class="op" id="6190514">.</span><span class="ident" id="6190515">Fprintf</span><span class="op" id="6190522">(</span><span class="ident" id="6190523">os</span><span class="op" id="6190525">.</span><span class="ident" id="6190526">Stderr</span><span class="op" id="6190532">,</span>&nbsp;<span class="string" id="6190534">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6190575">,</span>&nbsp;<span class="ident" id="6190577">benchName</span><span class="op" id="6190586">,</span>&nbsp;<span class="ident" id="6190588">p</span><span class="op" id="6190589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190598">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6190601">}</span><br>
<span class="lineno"></span><span class="op" id="6190603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6190606">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6190682">func</span>&nbsp;<span class="op" id="6190687">(</span><span class="ident" id="6190688">b</span>&nbsp;<span class="op" id="6190690">*</span><span class="ident" id="6190691">B</span><span class="op" id="6190692">)</span>&nbsp;<span class="ident" id="6190694">trimOutput</span><span class="op" id="6190704">(</span><span class="op" id="6190705">)</span>&nbsp;<span class="op" id="6190707">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190710">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190782">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6190862">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190946">const</span>&nbsp;<span class="ident" id="6190952">maxNewlines</span>&nbsp;<span class="op" id="6190964">=</span>&nbsp;<span class="num" id="6190966">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6190970">for</span>&nbsp;<span class="ident" id="6190974">nlCount</span><span class="op" id="6190981">,</span>&nbsp;<span class="ident" id="6190983">j</span>&nbsp;<span class="op" id="6190985">:=</span>&nbsp;<span class="num" id="6190988">0</span><span class="op" id="6190989">,</span>&nbsp;<span class="num" id="6190991">0</span><span class="op" id="6190992">;</span>&nbsp;<span class="ident" id="6190994">j</span>&nbsp;<span class="op" id="6190996">&lt;</span>&nbsp;<span class="builtinfunc" id="6190998">len</span><span class="op" id="6191001">(</span><span class="ident" id="6191002">b</span><span class="op" id="6191003">.</span><span class="ident" id="6191004">output</span><span class="op" id="6191010">)</span><span class="op" id="6191011">;</span>&nbsp;<span class="ident" id="6191013">j</span><span class="op" id="6191014">++</span>&nbsp;<span class="op" id="6191017">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191021">if</span>&nbsp;<span class="ident" id="6191024">b</span><span class="op" id="6191025">.</span><span class="ident" id="6191026">output</span><span class="op" id="6191032">[</span><span class="ident" id="6191033">j</span><span class="op" id="6191034">]</span>&nbsp;<span class="op" id="6191036">==</span>&nbsp;<span class="string" id="6191039">&#39;\n&#39;</span>&nbsp;<span class="op" id="6191044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191049">nlCount</span><span class="op" id="6191056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191062">if</span>&nbsp;<span class="ident" id="6191065">nlCount</span>&nbsp;<span class="op" id="6191073">&gt;=</span>&nbsp;<span class="ident" id="6191076">maxNewlines</span>&nbsp;<span class="op" id="6191088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191094">b</span><span class="op" id="6191095">.</span><span class="ident" id="6191096">output</span>&nbsp;<span class="op" id="6191103">=</span>&nbsp;<span class="builtinfunc" id="6191105">append</span><span class="op" id="6191111">(</span><span class="ident" id="6191112">b</span><span class="op" id="6191113">.</span><span class="ident" id="6191114">output</span><span class="op" id="6191120">[</span><span class="op" id="6191121">:</span><span class="ident" id="6191122">j</span><span class="op" id="6191123">]</span><span class="op" id="6191124">,</span>&nbsp;<span class="string" id="6191126">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6191156">...</span><span class="op" id="6191159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191165">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191181">}</span><br>
<span class="lineno"></span><span class="op" id="6191183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6191186">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6191250">type</span>&nbsp;<span class="ident" id="6191255">PB</span>&nbsp;<span class="keyword" id="6191258">struct</span>&nbsp;<span class="op" id="6191265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191268">globalN</span>&nbsp;<span class="op" id="6191276">*</span><span class="ident" id="6191277">uint64</span>&nbsp;<span class="comment" id="6191284">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191343">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6191351">uint64</span>&nbsp;&nbsp;<span class="comment" id="6191359">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191413">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6191421">uint64</span>&nbsp;&nbsp;<span class="comment" id="6191429">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191468">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6191476">uint64</span>&nbsp;&nbsp;<span class="comment" id="6191484">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6191531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6191534">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6191596">func</span>&nbsp;<span class="op" id="6191601">(</span><span class="ident" id="6191602">pb</span>&nbsp;<span class="op" id="6191605">*</span><span class="ident" id="6191606">PB</span><span class="op" id="6191608">)</span>&nbsp;<span class="ident" id="6191610">Next</span><span class="op" id="6191614">(</span><span class="op" id="6191615">)</span>&nbsp;<span class="builtintype" id="6191617">bool</span>&nbsp;<span class="op" id="6191622">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191625">if</span>&nbsp;<span class="ident" id="6191628">pb</span><span class="op" id="6191630">.</span><span class="ident" id="6191631">cache</span>&nbsp;<span class="op" id="6191637">==</span>&nbsp;<span class="num" id="6191640">0</span>&nbsp;<span class="op" id="6191642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191646">n</span>&nbsp;<span class="op" id="6191648">:=</span>&nbsp;<span class="ident" id="6191651">atomic</span><span class="op" id="6191657">.</span><span class="ident" id="6191658">AddUint64</span><span class="op" id="6191667">(</span><span class="ident" id="6191668">pb</span><span class="op" id="6191670">.</span><span class="ident" id="6191671">globalN</span><span class="op" id="6191678">,</span>&nbsp;<span class="ident" id="6191680">pb</span><span class="op" id="6191682">.</span><span class="ident" id="6191683">grain</span><span class="op" id="6191688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191692">if</span>&nbsp;<span class="ident" id="6191695">n</span>&nbsp;<span class="op" id="6191697">&lt;=</span>&nbsp;<span class="ident" id="6191700">pb</span><span class="op" id="6191702">.</span><span class="ident" id="6191703">bN</span>&nbsp;<span class="op" id="6191706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191711">pb</span><span class="op" id="6191713">.</span><span class="ident" id="6191714">cache</span>&nbsp;<span class="op" id="6191720">=</span>&nbsp;<span class="ident" id="6191722">pb</span><span class="op" id="6191724">.</span><span class="ident" id="6191725">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191733">}</span>&nbsp;<span class="keyword" id="6191735">else</span>&nbsp;<span class="keyword" id="6191740">if</span>&nbsp;<span class="ident" id="6191743">n</span>&nbsp;<span class="op" id="6191745">&lt;</span>&nbsp;<span class="ident" id="6191747">pb</span><span class="op" id="6191749">.</span><span class="ident" id="6191750">bN</span><span class="op" id="6191752">+</span><span class="ident" id="6191753">pb</span><span class="op" id="6191755">.</span><span class="ident" id="6191756">grain</span>&nbsp;<span class="op" id="6191762">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191767">pb</span><span class="op" id="6191769">.</span><span class="ident" id="6191770">cache</span>&nbsp;<span class="op" id="6191776">=</span>&nbsp;<span class="ident" id="6191778">pb</span><span class="op" id="6191780">.</span><span class="ident" id="6191781">bN</span>&nbsp;<span class="op" id="6191784">+</span>&nbsp;<span class="ident" id="6191786">pb</span><span class="op" id="6191788">.</span><span class="ident" id="6191789">grain</span>&nbsp;<span class="op" id="6191795">-</span>&nbsp;<span class="ident" id="6191797">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191801">}</span>&nbsp;<span class="keyword" id="6191803">else</span>&nbsp;<span class="op" id="6191808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191813">return</span>&nbsp;<span class="builtintype" id="6191820">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6191831">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6191834">pb</span><span class="op" id="6191836">.</span><span class="ident" id="6191837">cache</span><span class="op" id="6191842">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6191846">return</span>&nbsp;<span class="builtintype" id="6191853">true</span><br>
<span class="lineno"></span><span class="op" id="6191858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6191861">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6191906">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6191983">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6192063">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6192132">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6192191">//</span><br>
<span class="lineno">385</span><span class="comment" id="6192194">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6192267">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6192338">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6192411">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6192447">func</span>&nbsp;<span class="op" id="6192452">(</span><span class="ident" id="6192453">b</span>&nbsp;<span class="op" id="6192455">*</span><span class="ident" id="6192456">B</span><span class="op" id="6192457">)</span>&nbsp;<span class="ident" id="6192459">RunParallel</span><span class="op" id="6192470">(</span><span class="ident" id="6192471">body</span>&nbsp;<span class="keyword" id="6192476">func</span><span class="op" id="6192480">(</span><span class="op" id="6192481">*</span><span class="ident" id="6192482">PB</span><span class="op" id="6192484">)</span><span class="op" id="6192485">)</span>&nbsp;<span class="op" id="6192487">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192490">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192558">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192627">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192655">grain</span>&nbsp;<span class="op" id="6192661">:=</span>&nbsp;<span class="ident" id="6192664">uint64</span><span class="op" id="6192670">(</span><span class="num" id="6192671">0</span><span class="op" id="6192672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192675">if</span>&nbsp;<span class="ident" id="6192678">b</span><span class="op" id="6192679">.</span><span class="ident" id="6192680">previousN</span>&nbsp;<span class="op" id="6192690">&gt;</span>&nbsp;<span class="num" id="6192692">0</span>&nbsp;<span class="op" id="6192694">&amp;&amp;</span>&nbsp;<span class="ident" id="6192697">b</span><span class="op" id="6192698">.</span><span class="ident" id="6192699">previousDuration</span>&nbsp;<span class="op" id="6192716">&gt;</span>&nbsp;<span class="num" id="6192718">0</span>&nbsp;<span class="op" id="6192720">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192724">grain</span>&nbsp;<span class="op" id="6192730">=</span>&nbsp;<span class="num" id="6192732">1e5</span>&nbsp;<span class="op" id="6192736">*</span>&nbsp;<span class="ident" id="6192738">uint64</span><span class="op" id="6192744">(</span><span class="ident" id="6192745">b</span><span class="op" id="6192746">.</span><span class="ident" id="6192747">previousN</span><span class="op" id="6192756">)</span>&nbsp;<span class="op" id="6192758">/</span>&nbsp;<span class="ident" id="6192760">uint64</span><span class="op" id="6192766">(</span><span class="ident" id="6192767">b</span><span class="op" id="6192768">.</span><span class="ident" id="6192769">previousDuration</span><span class="op" id="6192785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192791">if</span>&nbsp;<span class="ident" id="6192794">grain</span>&nbsp;<span class="op" id="6192800">&lt;</span>&nbsp;<span class="num" id="6192802">1</span>&nbsp;<span class="op" id="6192804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192808">grain</span>&nbsp;<span class="op" id="6192814">=</span>&nbsp;<span class="num" id="6192816">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192819">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192822">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6192892">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6192947">if</span>&nbsp;<span class="ident" id="6192950">grain</span>&nbsp;<span class="op" id="6192956">&gt;</span>&nbsp;<span class="num" id="6192958">1e4</span>&nbsp;<span class="op" id="6192962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192966">grain</span>&nbsp;<span class="op" id="6192972">=</span>&nbsp;<span class="num" id="6192974">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6192979">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192983">n</span>&nbsp;<span class="op" id="6192985">:=</span>&nbsp;<span class="ident" id="6192988">uint64</span><span class="op" id="6192994">(</span><span class="num" id="6192995">0</span><span class="op" id="6192996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6192999">numProcs</span>&nbsp;<span class="op" id="6193008">:=</span>&nbsp;<span class="ident" id="6193011">b</span><span class="op" id="6193012">.</span><span class="ident" id="6193013">parallelism</span>&nbsp;<span class="op" id="6193025">*</span>&nbsp;<span class="ident" id="6193027">runtime</span><span class="op" id="6193034">.</span><span class="ident" id="6193035">GOMAXPROCS</span><span class="op" id="6193045">(</span><span class="num" id="6193046">0</span><span class="op" id="6193047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193050">var</span>&nbsp;<span class="ident" id="6193054">wg</span>&nbsp;<span class="ident" id="6193057">sync</span><span class="op" id="6193061">.</span><span class="ident" id="6193062">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193073">wg</span><span class="op" id="6193075">.</span><span class="ident" id="6193076">Add</span><span class="op" id="6193079">(</span><span class="ident" id="6193080">numProcs</span><span class="op" id="6193088">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193091">for</span>&nbsp;<span class="ident" id="6193095">p</span>&nbsp;<span class="op" id="6193097">:=</span>&nbsp;<span class="num" id="6193100">0</span><span class="op" id="6193101">;</span>&nbsp;<span class="ident" id="6193103">p</span>&nbsp;<span class="op" id="6193105">&lt;</span>&nbsp;<span class="ident" id="6193107">numProcs</span><span class="op" id="6193115">;</span>&nbsp;<span class="ident" id="6193117">p</span><span class="op" id="6193118">++</span>&nbsp;<span class="op" id="6193121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193125">go</span>&nbsp;<span class="keyword" id="6193128">func</span><span class="op" id="6193132">(</span><span class="op" id="6193133">)</span>&nbsp;<span class="op" id="6193135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193140">defer</span>&nbsp;<span class="ident" id="6193146">wg</span><span class="op" id="6193148">.</span><span class="ident" id="6193149">Done</span><span class="op" id="6193153">(</span><span class="op" id="6193154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193159">pb</span>&nbsp;<span class="op" id="6193162">:=</span>&nbsp;<span class="op" id="6193165">&amp;</span><span class="ident" id="6193166">PB</span><span class="op" id="6193168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193174">globalN</span><span class="op" id="6193181">:</span>&nbsp;<span class="op" id="6193183">&amp;</span><span class="ident" id="6193184">n</span><span class="op" id="6193185">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193191">grain</span><span class="op" id="6193196">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6193200">grain</span><span class="op" id="6193205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193211">bN</span><span class="op" id="6193213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6193220">uint64</span><span class="op" id="6193226">(</span><span class="ident" id="6193227">b</span><span class="op" id="6193228">.</span><span class="ident" id="6193229">N</span><span class="op" id="6193230">)</span><span class="op" id="6193231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193241">body</span><span class="op" id="6193245">(</span><span class="ident" id="6193246">pb</span><span class="op" id="6193248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193252">}</span><span class="op" id="6193253">(</span><span class="op" id="6193254">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193260">wg</span><span class="op" id="6193262">.</span><span class="ident" id="6193263">Wait</span><span class="op" id="6193267">(</span><span class="op" id="6193268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193271">if</span>&nbsp;<span class="ident" id="6193274">n</span>&nbsp;<span class="op" id="6193276">&lt;=</span>&nbsp;<span class="ident" id="6193279">uint64</span><span class="op" id="6193285">(</span><span class="ident" id="6193286">b</span><span class="op" id="6193287">.</span><span class="ident" id="6193288">N</span><span class="op" id="6193289">)</span>&nbsp;<span class="op" id="6193291">&amp;&amp;</span>&nbsp;<span class="op" id="6193294">!</span><span class="ident" id="6193295">b</span><span class="op" id="6193296">.</span><span class="ident" id="6193297">Failed</span><span class="op" id="6193303">(</span><span class="op" id="6193304">)</span>&nbsp;<span class="op" id="6193306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193310">b</span><span class="op" id="6193311">.</span><span class="ident" id="6193312">Fatal</span><span class="op" id="6193317">(</span><span class="string" id="6193318">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6193371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193374">}</span><br>
<span class="lineno">425</span><span class="op" id="6193376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6193379">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6193464">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6193541">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6193596">func</span>&nbsp;<span class="op" id="6193601">(</span><span class="ident" id="6193602">b</span>&nbsp;<span class="op" id="6193604">*</span><span class="ident" id="6193605">B</span><span class="op" id="6193606">)</span>&nbsp;<span class="ident" id="6193608">SetParallelism</span><span class="op" id="6193622">(</span><span class="ident" id="6193623">p</span>&nbsp;<span class="builtintype" id="6193625">int</span><span class="op" id="6193628">)</span>&nbsp;<span class="op" id="6193630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193633">if</span>&nbsp;<span class="ident" id="6193636">p</span>&nbsp;<span class="op" id="6193638">&gt;=</span>&nbsp;<span class="num" id="6193641">1</span>&nbsp;<span class="op" id="6193643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193647">b</span><span class="op" id="6193648">.</span><span class="ident" id="6193649">parallelism</span>&nbsp;<span class="op" id="6193661">=</span>&nbsp;<span class="ident" id="6193663">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193666">}</span><br>
<span class="lineno"></span><span class="op" id="6193668">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6193671">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6193734">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6193794">func</span>&nbsp;<span class="ident" id="6193799">Benchmark</span><span class="op" id="6193808">(</span><span class="ident" id="6193809">f</span>&nbsp;<span class="keyword" id="6193811">func</span><span class="op" id="6193815">(</span><span class="ident" id="6193816">b</span>&nbsp;<span class="op" id="6193818">*</span><span class="ident" id="6193819">B</span><span class="op" id="6193820">)</span><span class="op" id="6193821">)</span>&nbsp;<span class="ident" id="6193823">BenchmarkResult</span>&nbsp;<span class="op" id="6193839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193842">b</span>&nbsp;<span class="op" id="6193844">:=</span>&nbsp;<span class="op" id="6193847">&amp;</span><span class="ident" id="6193848">B</span><span class="op" id="6193849">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193853">common</span><span class="op" id="6193859">:</span>&nbsp;<span class="ident" id="6193861">common</span><span class="op" id="6193867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193872">signal</span><span class="op" id="6193878">:</span>&nbsp;<span class="builtinfunc" id="6193880">make</span><span class="op" id="6193884">(</span><span class="keyword" id="6193885">chan</span>&nbsp;<span class="keyword" id="6193890">interface</span><span class="op" id="6193899">{</span><span class="op" id="6193900">}</span><span class="op" id="6193901">)</span><span class="op" id="6193902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193906">}</span><span class="op" id="6193907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6193911">benchmark</span><span class="op" id="6193920">:</span>&nbsp;<span class="ident" id="6193922">InternalBenchmark</span><span class="op" id="6193939">{</span><span class="string" id="6193940">&#34;&#34;</span><span class="op" id="6193942">,</span>&nbsp;<span class="ident" id="6193944">f</span><span class="op" id="6193945">}</span><span class="op" id="6193946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6193949">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6193952">return</span>&nbsp;<span class="ident" id="6193959">b</span><span class="op" id="6193960">.</span><span class="ident" id="6193961">run</span><span class="op" id="6193964">(</span><span class="op" id="6193965">)</span><br>
<span class="lineno"></span><span class="op" id="6193967">}</span>
</div>
</body>
</html>
