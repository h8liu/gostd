<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3585331">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3585386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3585440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3585491">package</span>&nbsp;<span class="ident" id="3585499">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3585505">import</span>&nbsp;<span class="op" id="3585512">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3585515">&#34;crypto/x509/pkix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3585535">&#34;encoding/asn1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3585552">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3585562">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="3585568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3585571">//&nbsp;pkcs8&nbsp;reflects&nbsp;an&nbsp;ASN.1,&nbsp;PKCS#8&nbsp;PrivateKey.&nbsp;See</span><br>
<span class="lineno">15</span><span class="comment" id="3585622">//&nbsp;ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-8/pkcs-8v1_2.asn</span><br>
<span class="lineno"></span><span class="comment" id="3585682">//&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="3585698">type</span>&nbsp;<span class="ident" id="3585703">pkcs8</span>&nbsp;<span class="keyword" id="3585709">struct</span>&nbsp;<span class="op" id="3585716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585719">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3585730">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585735">Algo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3585746">pkix</span><span class="op" id="3585750">.</span><span class="ident" id="3585751">AlgorithmIdentifier</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3585772">PrivateKey</span>&nbsp;<span class="op" id="3585783">[</span><span class="op" id="3585784">]</span><span class="builtintype" id="3585785">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3585791">//&nbsp;optional&nbsp;attributes&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="op" id="3585823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3585826">//&nbsp;ParsePKCS8PrivateKey&nbsp;parses&nbsp;an&nbsp;unencrypted,&nbsp;PKCS#8&nbsp;private&nbsp;key.&nbsp;See</span><br>
<span class="lineno">25</span><span class="comment" id="3585897">//&nbsp;http://www.rsa.com/rsalabs/node.asp?id=2130&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="3585957">func</span>&nbsp;<span class="ident" id="3585962">ParsePKCS8PrivateKey</span><span class="op" id="3585982">(</span><span class="ident" id="3585983">der</span>&nbsp;<span class="op" id="3585987">[</span><span class="op" id="3585988">]</span><span class="builtintype" id="3585989">byte</span><span class="op" id="3585993">)</span>&nbsp;<span class="op" id="3585995">(</span><span class="ident" id="3585996">key</span>&nbsp;<span class="keyword" id="3586000">interface</span><span class="op" id="3586009">{</span><span class="op" id="3586010">}</span><span class="op" id="3586011">,</span>&nbsp;<span class="ident" id="3586013">err</span>&nbsp;<span class="builtintype" id="3586017">error</span><span class="op" id="3586022">)</span>&nbsp;<span class="op" id="3586024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586027">var</span>&nbsp;<span class="ident" id="3586031">privKey</span>&nbsp;<span class="ident" id="3586039">pkcs8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586046">if</span>&nbsp;<span class="ident" id="3586049">_</span><span class="op" id="3586050">,</span>&nbsp;<span class="ident" id="3586052">err</span>&nbsp;<span class="op" id="3586056">:=</span>&nbsp;<span class="ident" id="3586059">asn1</span><span class="op" id="3586063">.</span><span class="ident" id="3586064">Unmarshal</span><span class="op" id="3586073">(</span><span class="ident" id="3586074">der</span><span class="op" id="3586077">,</span>&nbsp;<span class="op" id="3586079">&amp;</span><span class="ident" id="3586080">privKey</span><span class="op" id="3586087">)</span><span class="op" id="3586088">;</span>&nbsp;<span class="ident" id="3586090">err</span>&nbsp;<span class="op" id="3586094">!=</span>&nbsp;<span class="ident" id="3586097">nil</span>&nbsp;<span class="op" id="3586101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586105">return</span>&nbsp;<span class="ident" id="3586112">nil</span><span class="op" id="3586115">,</span>&nbsp;<span class="ident" id="3586117">err</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586125">switch</span>&nbsp;<span class="op" id="3586132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586135">case</span>&nbsp;<span class="ident" id="3586140">privKey</span><span class="op" id="3586147">.</span><span class="ident" id="3586148">Algo</span><span class="op" id="3586152">.</span><span class="ident" id="3586153">Algorithm</span><span class="op" id="3586162">.</span><span class="ident" id="3586163">Equal</span><span class="op" id="3586168">(</span><span class="ident" id="3586169">oidPublicKeyRSA</span><span class="op" id="3586184">)</span><span class="op" id="3586185">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586189">key</span><span class="op" id="3586192">,</span>&nbsp;<span class="ident" id="3586194">err</span>&nbsp;<span class="op" id="3586198">=</span>&nbsp;<span class="ident" id="3586200">ParsePKCS1PrivateKey</span><span class="op" id="3586220">(</span><span class="ident" id="3586221">privKey</span><span class="op" id="3586228">.</span><span class="ident" id="3586229">PrivateKey</span><span class="op" id="3586239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586243">if</span>&nbsp;<span class="ident" id="3586246">err</span>&nbsp;<span class="op" id="3586250">!=</span>&nbsp;<span class="ident" id="3586253">nil</span>&nbsp;<span class="op" id="3586257">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586262">return</span>&nbsp;<span class="ident" id="3586269">nil</span><span class="op" id="3586272">,</span>&nbsp;<span class="ident" id="3586274">errors</span><span class="op" id="3586280">.</span><span class="ident" id="3586281">New</span><span class="op" id="3586284">(</span><span class="string" id="3586285">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;RSA&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="3586346">+</span>&nbsp;<span class="ident" id="3586348">err</span><span class="op" id="3586351">.</span><span class="ident" id="3586352">Error</span><span class="op" id="3586357">(</span><span class="op" id="3586358">)</span><span class="op" id="3586359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586367">return</span>&nbsp;<span class="ident" id="3586374">key</span><span class="op" id="3586377">,</span>&nbsp;<span class="ident" id="3586379">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586385">case</span>&nbsp;<span class="ident" id="3586390">privKey</span><span class="op" id="3586397">.</span><span class="ident" id="3586398">Algo</span><span class="op" id="3586402">.</span><span class="ident" id="3586403">Algorithm</span><span class="op" id="3586412">.</span><span class="ident" id="3586413">Equal</span><span class="op" id="3586418">(</span><span class="ident" id="3586419">oidPublicKeyECDSA</span><span class="op" id="3586436">)</span><span class="op" id="3586437">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586441">bytes</span>&nbsp;<span class="op" id="3586447">:=</span>&nbsp;<span class="ident" id="3586450">privKey</span><span class="op" id="3586457">.</span><span class="ident" id="3586458">Algo</span><span class="op" id="3586462">.</span><span class="ident" id="3586463">Parameters</span><span class="op" id="3586473">.</span><span class="ident" id="3586474">FullBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586486">namedCurveOID</span>&nbsp;<span class="op" id="3586500">:=</span>&nbsp;<span class="builtinfunc" id="3586503">new</span><span class="op" id="3586506">(</span><span class="ident" id="3586507">asn1</span><span class="op" id="3586511">.</span><span class="ident" id="3586512">ObjectIdentifier</span><span class="op" id="3586528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586532">if</span>&nbsp;<span class="ident" id="3586535">_</span><span class="op" id="3586536">,</span>&nbsp;<span class="ident" id="3586538">err</span>&nbsp;<span class="op" id="3586542">:=</span>&nbsp;<span class="ident" id="3586545">asn1</span><span class="op" id="3586549">.</span><span class="ident" id="3586550">Unmarshal</span><span class="op" id="3586559">(</span><span class="ident" id="3586560">bytes</span><span class="op" id="3586565">,</span>&nbsp;<span class="ident" id="3586567">namedCurveOID</span><span class="op" id="3586580">)</span><span class="op" id="3586581">;</span>&nbsp;<span class="ident" id="3586583">err</span>&nbsp;<span class="op" id="3586587">!=</span>&nbsp;<span class="ident" id="3586590">nil</span>&nbsp;<span class="op" id="3586594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586599">namedCurveOID</span>&nbsp;<span class="op" id="3586613">=</span>&nbsp;<span class="ident" id="3586615">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586621">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3586625">key</span><span class="op" id="3586628">,</span>&nbsp;<span class="ident" id="3586630">err</span>&nbsp;<span class="op" id="3586634">=</span>&nbsp;<span class="ident" id="3586636">parseECPrivateKey</span><span class="op" id="3586653">(</span><span class="ident" id="3586654">namedCurveOID</span><span class="op" id="3586667">,</span>&nbsp;<span class="ident" id="3586669">privKey</span><span class="op" id="3586676">.</span><span class="ident" id="3586677">PrivateKey</span><span class="op" id="3586687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586691">if</span>&nbsp;<span class="ident" id="3586694">err</span>&nbsp;<span class="op" id="3586698">!=</span>&nbsp;<span class="ident" id="3586701">nil</span>&nbsp;<span class="op" id="3586705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586710">return</span>&nbsp;<span class="ident" id="3586717">nil</span><span class="op" id="3586720">,</span>&nbsp;<span class="ident" id="3586722">errors</span><span class="op" id="3586728">.</span><span class="ident" id="3586729">New</span><span class="op" id="3586732">(</span><span class="string" id="3586733">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;EC&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="3586793">+</span>&nbsp;<span class="ident" id="3586795">err</span><span class="op" id="3586798">.</span><span class="ident" id="3586799">Error</span><span class="op" id="3586804">(</span><span class="op" id="3586805">)</span><span class="op" id="3586806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586814">return</span>&nbsp;<span class="ident" id="3586821">key</span><span class="op" id="3586824">,</span>&nbsp;<span class="ident" id="3586826">nil</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586832">default</span><span class="op" id="3586839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3586843">return</span>&nbsp;<span class="ident" id="3586850">nil</span><span class="op" id="3586853">,</span>&nbsp;<span class="ident" id="3586855">fmt</span><span class="op" id="3586858">.</span><span class="ident" id="3586859">Errorf</span><span class="op" id="3586865">(</span><span class="string" id="3586866">&#34;x509:&nbsp;PKCS#8&nbsp;wrapping&nbsp;contained&nbsp;private&nbsp;key&nbsp;with&nbsp;unknown&nbsp;algorithm:&nbsp;%v&#34;</span><span class="op" id="3586938">,</span>&nbsp;<span class="ident" id="3586940">privKey</span><span class="op" id="3586947">.</span><span class="ident" id="3586948">Algo</span><span class="op" id="3586952">.</span><span class="ident" id="3586953">Algorithm</span><span class="op" id="3586962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3586965">}</span><br>
<span class="lineno"></span><span class="op" id="3586967">}</span>
</div>
</body>
</html>
