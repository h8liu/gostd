<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6019327">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6019382">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6019436">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6019487">package</span>&nbsp;<span class="ident" id="6019495">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6019500">import</span>&nbsp;<span class="op" id="6019507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6019510">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6019519">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6019529">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6019536">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6019541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6019544">//&nbsp;A&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered,&nbsp;flushable&nbsp;writer.</span><br>
<span class="lineno">15</span><span class="keyword" id="6019589">type</span>&nbsp;<span class="ident" id="6019594">writer</span>&nbsp;<span class="keyword" id="6019601">interface</span>&nbsp;<span class="op" id="6019611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019614">io</span><span class="op" id="6019616">.</span><span class="ident" id="6019617">ByteWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019629">Flush</span><span class="op" id="6019634">(</span><span class="op" id="6019635">)</span>&nbsp;<span class="builtintype" id="6019637">error</span><br>
<span class="lineno"></span><span class="op" id="6019643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6019646">//&nbsp;An&nbsp;errWriteCloser&nbsp;is&nbsp;an&nbsp;io.WriteCloser&nbsp;that&nbsp;always&nbsp;returns&nbsp;a&nbsp;given&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6019723">type</span>&nbsp;<span class="ident" id="6019728">errWriteCloser</span>&nbsp;<span class="keyword" id="6019743">struct</span>&nbsp;<span class="op" id="6019750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6019753">err</span>&nbsp;<span class="builtintype" id="6019757">error</span><br>
<span class="lineno"></span><span class="op" id="6019763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6019766">func</span>&nbsp;<span class="op" id="6019771">(</span><span class="ident" id="6019772">e</span>&nbsp;<span class="op" id="6019774">*</span><span class="ident" id="6019775">errWriteCloser</span><span class="op" id="6019789">)</span>&nbsp;<span class="ident" id="6019791">Write</span><span class="op" id="6019796">(</span><span class="op" id="6019797">[</span><span class="op" id="6019798">]</span><span class="builtintype" id="6019799">byte</span><span class="op" id="6019803">)</span>&nbsp;<span class="op" id="6019805">(</span><span class="builtintype" id="6019806">int</span><span class="op" id="6019809">,</span>&nbsp;<span class="builtintype" id="6019811">error</span><span class="op" id="6019816">)</span>&nbsp;<span class="op" id="6019818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019821">return</span>&nbsp;<span class="num" id="6019828">0</span><span class="op" id="6019829">,</span>&nbsp;<span class="ident" id="6019831">e</span><span class="op" id="6019832">.</span><span class="ident" id="6019833">err</span><br>
<span class="lineno"></span><span class="op" id="6019837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6019840">func</span>&nbsp;<span class="op" id="6019845">(</span><span class="ident" id="6019846">e</span>&nbsp;<span class="op" id="6019848">*</span><span class="ident" id="6019849">errWriteCloser</span><span class="op" id="6019863">)</span>&nbsp;<span class="ident" id="6019865">Close</span><span class="op" id="6019870">(</span><span class="op" id="6019871">)</span>&nbsp;<span class="builtintype" id="6019873">error</span>&nbsp;<span class="op" id="6019879">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6019882">return</span>&nbsp;<span class="ident" id="6019889">e</span><span class="op" id="6019890">.</span><span class="ident" id="6019891">err</span><br>
<span class="lineno"></span><span class="op" id="6019895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6019898">const</span>&nbsp;<span class="op" id="6019904">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019907">//&nbsp;A&nbsp;code&nbsp;is&nbsp;a&nbsp;12&nbsp;bit&nbsp;value,&nbsp;stored&nbsp;as&nbsp;a&nbsp;uint32&nbsp;when&nbsp;encoding&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6019979">//&nbsp;type&nbsp;conversions&nbsp;when&nbsp;shifting&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020020">maxCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6020032">=</span>&nbsp;<span class="num" id="6020034">1</span><span class="op" id="6020035">&lt;&lt;</span><span class="num" id="6020037">12</span>&nbsp;<span class="op" id="6020040">-</span>&nbsp;<span class="num" id="6020042">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020045">invalidCode</span>&nbsp;<span class="op" id="6020057">=</span>&nbsp;<span class="num" id="6020059">1</span><span class="op" id="6020060">&lt;&lt;</span><span class="num" id="6020062">32</span>&nbsp;<span class="op" id="6020065">-</span>&nbsp;<span class="num" id="6020067">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020070">//&nbsp;There&nbsp;are&nbsp;1&lt;&lt;12&nbsp;possible&nbsp;codes,&nbsp;which&nbsp;is&nbsp;an&nbsp;upper&nbsp;bound&nbsp;on&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020147">//&nbsp;valid&nbsp;hash&nbsp;table&nbsp;entries&nbsp;at&nbsp;any&nbsp;given&nbsp;point&nbsp;in&nbsp;time.&nbsp;tableSize&nbsp;is&nbsp;4x&nbsp;that.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020226">tableSize</span>&nbsp;<span class="op" id="6020236">=</span>&nbsp;<span class="num" id="6020238">4</span>&nbsp;<span class="op" id="6020240">*</span>&nbsp;<span class="num" id="6020242">1</span>&nbsp;<span class="op" id="6020244">&lt;&lt;</span>&nbsp;<span class="num" id="6020247">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020251">tableMask</span>&nbsp;<span class="op" id="6020261">=</span>&nbsp;<span class="ident" id="6020263">tableSize</span>&nbsp;<span class="op" id="6020273">-</span>&nbsp;<span class="num" id="6020275">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020278">//&nbsp;A&nbsp;hash&nbsp;table&nbsp;entry&nbsp;is&nbsp;a&nbsp;uint32.&nbsp;Zero&nbsp;is&nbsp;an&nbsp;invalid&nbsp;entry&nbsp;since&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020349">//&nbsp;lower&nbsp;12&nbsp;bits&nbsp;of&nbsp;a&nbsp;valid&nbsp;entry&nbsp;must&nbsp;be&nbsp;a&nbsp;non-literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020412">invalidEntry</span>&nbsp;<span class="op" id="6020425">=</span>&nbsp;<span class="num" id="6020427">0</span><br>
<span class="lineno">45</span><span class="op" id="6020429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6020432">//&nbsp;encoder&nbsp;is&nbsp;LZW&nbsp;compressor.</span><br>
<span class="lineno"></span><span class="keyword" id="6020462">type</span>&nbsp;<span class="ident" id="6020467">encoder</span>&nbsp;<span class="keyword" id="6020475">struct</span>&nbsp;<span class="op" id="6020482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020485">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;that&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;written&nbsp;to.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020543">w</span>&nbsp;<span class="ident" id="6020545">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020553">//&nbsp;order,&nbsp;write,&nbsp;bits,&nbsp;nBits&nbsp;and&nbsp;width&nbsp;are&nbsp;the&nbsp;state&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020611">//&nbsp;converting&nbsp;a&nbsp;code&nbsp;stream&nbsp;into&nbsp;a&nbsp;byte&nbsp;stream.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020660">order</span>&nbsp;<span class="ident" id="6020666">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020673">write</span>&nbsp;<span class="keyword" id="6020679">func</span><span class="op" id="6020683">(</span><span class="op" id="6020684">*</span><span class="ident" id="6020685">encoder</span><span class="op" id="6020692">,</span>&nbsp;<span class="builtintype" id="6020694">uint32</span><span class="op" id="6020700">)</span>&nbsp;<span class="builtintype" id="6020702">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020709">bits</span>&nbsp;&nbsp;<span class="builtintype" id="6020715">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020723">nBits</span>&nbsp;<span class="builtintype" id="6020729">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020735">width</span>&nbsp;<span class="builtintype" id="6020741">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020747">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020799">litWidth</span>&nbsp;<span class="builtintype" id="6020808">uint</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020814">//&nbsp;hi&nbsp;is&nbsp;the&nbsp;code&nbsp;implied&nbsp;by&nbsp;the&nbsp;next&nbsp;code&nbsp;emission.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020868">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6020931">hi</span><span class="op" id="6020933">,</span>&nbsp;<span class="ident" id="6020935">overflow</span>&nbsp;<span class="builtintype" id="6020944">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6020952">//&nbsp;savedCode&nbsp;is&nbsp;the&nbsp;accumulated&nbsp;code&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;most&nbsp;recent&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021026">//&nbsp;call.&nbsp;It&nbsp;is&nbsp;equal&nbsp;to&nbsp;invalidCode&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;such&nbsp;call.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021090">savedCode</span>&nbsp;<span class="builtintype" id="6021100">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021108">//&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during&nbsp;writing.&nbsp;Closing&nbsp;the&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021183">//&nbsp;will&nbsp;make&nbsp;any&nbsp;future&nbsp;Write&nbsp;calls&nbsp;return&nbsp;errClosed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021237">err</span>&nbsp;<span class="builtintype" id="6021241">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021248">//&nbsp;table&nbsp;is&nbsp;the&nbsp;hash&nbsp;table&nbsp;from&nbsp;20-bit&nbsp;keys&nbsp;to&nbsp;12-bit&nbsp;values.&nbsp;Each&nbsp;table</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021322">//&nbsp;entry&nbsp;contains&nbsp;key&lt;&lt;12|val&nbsp;and&nbsp;collisions&nbsp;resolve&nbsp;by&nbsp;linear&nbsp;probing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021395">//&nbsp;The&nbsp;keys&nbsp;consist&nbsp;of&nbsp;a&nbsp;12-bit&nbsp;code&nbsp;prefix&nbsp;and&nbsp;an&nbsp;8-bit&nbsp;byte&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6021466">//&nbsp;The&nbsp;values&nbsp;are&nbsp;a&nbsp;12-bit&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021500">table</span>&nbsp;<span class="op" id="6021506">[</span><span class="ident" id="6021507">tableSize</span><span class="op" id="6021516">]</span><span class="builtintype" id="6021517">uint32</span><br>
<span class="lineno"></span><span class="op" id="6021524">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="6021527">//&nbsp;writeLSB&nbsp;writes&nbsp;the&nbsp;code&nbsp;c&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6021598">func</span>&nbsp;<span class="op" id="6021603">(</span><span class="ident" id="6021604">e</span>&nbsp;<span class="op" id="6021606">*</span><span class="ident" id="6021607">encoder</span><span class="op" id="6021614">)</span>&nbsp;<span class="ident" id="6021616">writeLSB</span><span class="op" id="6021624">(</span><span class="ident" id="6021625">c</span>&nbsp;<span class="builtintype" id="6021627">uint32</span><span class="op" id="6021633">)</span>&nbsp;<span class="builtintype" id="6021635">error</span>&nbsp;<span class="op" id="6021641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021644">e</span><span class="op" id="6021645">.</span><span class="ident" id="6021646">bits</span>&nbsp;<span class="op" id="6021651">|=</span>&nbsp;<span class="ident" id="6021654">c</span>&nbsp;<span class="op" id="6021656">&lt;&lt;</span>&nbsp;<span class="ident" id="6021659">e</span><span class="op" id="6021660">.</span><span class="ident" id="6021661">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021668">e</span><span class="op" id="6021669">.</span><span class="ident" id="6021670">nBits</span>&nbsp;<span class="op" id="6021676">+=</span>&nbsp;<span class="ident" id="6021679">e</span><span class="op" id="6021680">.</span><span class="ident" id="6021681">width</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021688">for</span>&nbsp;<span class="ident" id="6021692">e</span><span class="op" id="6021693">.</span><span class="ident" id="6021694">nBits</span>&nbsp;<span class="op" id="6021700">&gt;=</span>&nbsp;<span class="num" id="6021703">8</span>&nbsp;<span class="op" id="6021705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021709">if</span>&nbsp;<span class="ident" id="6021712">err</span>&nbsp;<span class="op" id="6021716">:=</span>&nbsp;<span class="ident" id="6021719">e</span><span class="op" id="6021720">.</span><span class="ident" id="6021721">w</span><span class="op" id="6021722">.</span><span class="ident" id="6021723">WriteByte</span><span class="op" id="6021732">(</span><span class="builtintype" id="6021733">uint8</span><span class="op" id="6021738">(</span><span class="ident" id="6021739">e</span><span class="op" id="6021740">.</span><span class="ident" id="6021741">bits</span><span class="op" id="6021745">)</span><span class="op" id="6021746">)</span><span class="op" id="6021747">;</span>&nbsp;<span class="ident" id="6021749">err</span>&nbsp;<span class="op" id="6021753">!=</span>&nbsp;<span class="ident" id="6021756">nil</span>&nbsp;<span class="op" id="6021760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021765">return</span>&nbsp;<span class="ident" id="6021772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021782">e</span><span class="op" id="6021783">.</span><span class="ident" id="6021784">bits</span>&nbsp;<span class="op" id="6021789">&gt;&gt;=</span>&nbsp;<span class="num" id="6021793">8</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021797">e</span><span class="op" id="6021798">.</span><span class="ident" id="6021799">nBits</span>&nbsp;<span class="op" id="6021805">-=</span>&nbsp;<span class="num" id="6021808">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6021811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6021814">return</span>&nbsp;<span class="ident" id="6021821">nil</span><br>
<span class="lineno"></span><span class="op" id="6021825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6021828">//&nbsp;writeMSB&nbsp;writes&nbsp;the&nbsp;code&nbsp;c&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="6021898">func</span>&nbsp;<span class="op" id="6021903">(</span><span class="ident" id="6021904">e</span>&nbsp;<span class="op" id="6021906">*</span><span class="ident" id="6021907">encoder</span><span class="op" id="6021914">)</span>&nbsp;<span class="ident" id="6021916">writeMSB</span><span class="op" id="6021924">(</span><span class="ident" id="6021925">c</span>&nbsp;<span class="builtintype" id="6021927">uint32</span><span class="op" id="6021933">)</span>&nbsp;<span class="builtintype" id="6021935">error</span>&nbsp;<span class="op" id="6021941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021944">e</span><span class="op" id="6021945">.</span><span class="ident" id="6021946">bits</span>&nbsp;<span class="op" id="6021951">|=</span>&nbsp;<span class="ident" id="6021954">c</span>&nbsp;<span class="op" id="6021956">&lt;&lt;</span>&nbsp;<span class="op" id="6021959">(</span><span class="num" id="6021960">32</span>&nbsp;<span class="op" id="6021963">-</span>&nbsp;<span class="ident" id="6021965">e</span><span class="op" id="6021966">.</span><span class="ident" id="6021967">width</span>&nbsp;<span class="op" id="6021973">-</span>&nbsp;<span class="ident" id="6021975">e</span><span class="op" id="6021976">.</span><span class="ident" id="6021977">nBits</span><span class="op" id="6021982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6021985">e</span><span class="op" id="6021986">.</span><span class="ident" id="6021987">nBits</span>&nbsp;<span class="op" id="6021993">+=</span>&nbsp;<span class="ident" id="6021996">e</span><span class="op" id="6021997">.</span><span class="ident" id="6021998">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022005">for</span>&nbsp;<span class="ident" id="6022009">e</span><span class="op" id="6022010">.</span><span class="ident" id="6022011">nBits</span>&nbsp;<span class="op" id="6022017">&gt;=</span>&nbsp;<span class="num" id="6022020">8</span>&nbsp;<span class="op" id="6022022">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022026">if</span>&nbsp;<span class="ident" id="6022029">err</span>&nbsp;<span class="op" id="6022033">:=</span>&nbsp;<span class="ident" id="6022036">e</span><span class="op" id="6022037">.</span><span class="ident" id="6022038">w</span><span class="op" id="6022039">.</span><span class="ident" id="6022040">WriteByte</span><span class="op" id="6022049">(</span><span class="builtintype" id="6022050">uint8</span><span class="op" id="6022055">(</span><span class="ident" id="6022056">e</span><span class="op" id="6022057">.</span><span class="ident" id="6022058">bits</span>&nbsp;<span class="op" id="6022063">&gt;&gt;</span>&nbsp;<span class="num" id="6022066">24</span><span class="op" id="6022068">)</span><span class="op" id="6022069">)</span><span class="op" id="6022070">;</span>&nbsp;<span class="ident" id="6022072">err</span>&nbsp;<span class="op" id="6022076">!=</span>&nbsp;<span class="ident" id="6022079">nil</span>&nbsp;<span class="op" id="6022083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022088">return</span>&nbsp;<span class="ident" id="6022095">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022105">e</span><span class="op" id="6022106">.</span><span class="ident" id="6022107">bits</span>&nbsp;<span class="op" id="6022112">&lt;&lt;=</span>&nbsp;<span class="num" id="6022116">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022120">e</span><span class="op" id="6022121">.</span><span class="ident" id="6022122">nBits</span>&nbsp;<span class="op" id="6022128">-=</span>&nbsp;<span class="num" id="6022131">8</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022137">return</span>&nbsp;<span class="ident" id="6022144">nil</span><br>
<span class="lineno"></span><span class="op" id="6022148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022151">//&nbsp;errOutOfCodes&nbsp;is&nbsp;an&nbsp;internal&nbsp;error&nbsp;that&nbsp;means&nbsp;that&nbsp;the&nbsp;encoder&nbsp;has&nbsp;run&nbsp;out</span><br>
<span class="lineno">105</span><span class="comment" id="6022229">//&nbsp;of&nbsp;unused&nbsp;codes&nbsp;and&nbsp;a&nbsp;clear&nbsp;code&nbsp;needs&nbsp;to&nbsp;be&nbsp;sent&nbsp;next.</span><br>
<span class="lineno"></span><span class="keyword" id="6022288">var</span>&nbsp;<span class="ident" id="6022292">errOutOfCodes</span>&nbsp;<span class="op" id="6022306">=</span>&nbsp;<span class="ident" id="6022308">errors</span><span class="op" id="6022314">.</span><span class="ident" id="6022315">New</span><span class="op" id="6022318">(</span><span class="string" id="6022319">&#34;lzw:&nbsp;out&nbsp;of&nbsp;codes&#34;</span><span class="op" id="6022338">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022341">//&nbsp;incHi&nbsp;increments&nbsp;e.hi&nbsp;and&nbsp;checks&nbsp;for&nbsp;both&nbsp;overflow&nbsp;and&nbsp;running&nbsp;out&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6022414">//&nbsp;unused&nbsp;codes.&nbsp;In&nbsp;the&nbsp;latter&nbsp;case,&nbsp;incHi&nbsp;sends&nbsp;a&nbsp;clear&nbsp;code,&nbsp;resets&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6022488">//&nbsp;encoder&nbsp;state&nbsp;and&nbsp;returns&nbsp;errOutOfCodes.</span><br>
<span class="lineno"></span><span class="keyword" id="6022532">func</span>&nbsp;<span class="op" id="6022537">(</span><span class="ident" id="6022538">e</span>&nbsp;<span class="op" id="6022540">*</span><span class="ident" id="6022541">encoder</span><span class="op" id="6022548">)</span>&nbsp;<span class="ident" id="6022550">incHi</span><span class="op" id="6022555">(</span><span class="op" id="6022556">)</span>&nbsp;<span class="builtintype" id="6022558">error</span>&nbsp;<span class="op" id="6022564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022567">e</span><span class="op" id="6022568">.</span><span class="ident" id="6022569">hi</span><span class="op" id="6022571">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022575">if</span>&nbsp;<span class="ident" id="6022578">e</span><span class="op" id="6022579">.</span><span class="ident" id="6022580">hi</span>&nbsp;<span class="op" id="6022583">==</span>&nbsp;<span class="ident" id="6022586">e</span><span class="op" id="6022587">.</span><span class="ident" id="6022588">overflow</span>&nbsp;<span class="op" id="6022597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022601">e</span><span class="op" id="6022602">.</span><span class="ident" id="6022603">width</span><span class="op" id="6022608">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022613">e</span><span class="op" id="6022614">.</span><span class="ident" id="6022615">overflow</span>&nbsp;<span class="op" id="6022624">&lt;&lt;=</span>&nbsp;<span class="num" id="6022628">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022634">if</span>&nbsp;<span class="ident" id="6022637">e</span><span class="op" id="6022638">.</span><span class="ident" id="6022639">hi</span>&nbsp;<span class="op" id="6022642">==</span>&nbsp;<span class="ident" id="6022645">maxCode</span>&nbsp;<span class="op" id="6022653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022657">clear</span>&nbsp;<span class="op" id="6022663">:=</span>&nbsp;<span class="builtintype" id="6022666">uint32</span><span class="op" id="6022672">(</span><span class="num" id="6022673">1</span><span class="op" id="6022674">)</span>&nbsp;<span class="op" id="6022676">&lt;&lt;</span>&nbsp;<span class="ident" id="6022679">e</span><span class="op" id="6022680">.</span><span class="ident" id="6022681">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022692">if</span>&nbsp;<span class="ident" id="6022695">err</span>&nbsp;<span class="op" id="6022699">:=</span>&nbsp;<span class="ident" id="6022702">e</span><span class="op" id="6022703">.</span><span class="ident" id="6022704">write</span><span class="op" id="6022709">(</span><span class="ident" id="6022710">e</span><span class="op" id="6022711">,</span>&nbsp;<span class="ident" id="6022713">clear</span><span class="op" id="6022718">)</span><span class="op" id="6022719">;</span>&nbsp;<span class="ident" id="6022721">err</span>&nbsp;<span class="op" id="6022725">!=</span>&nbsp;<span class="ident" id="6022728">nil</span>&nbsp;<span class="op" id="6022732">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022737">return</span>&nbsp;<span class="ident" id="6022744">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022754">e</span><span class="op" id="6022755">.</span><span class="ident" id="6022756">width</span>&nbsp;<span class="op" id="6022762">=</span>&nbsp;<span class="builtintype" id="6022764">uint</span><span class="op" id="6022768">(</span><span class="ident" id="6022769">e</span><span class="op" id="6022770">.</span><span class="ident" id="6022771">litWidth</span><span class="op" id="6022779">)</span>&nbsp;<span class="op" id="6022781">+</span>&nbsp;<span class="num" id="6022783">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022787">e</span><span class="op" id="6022788">.</span><span class="ident" id="6022789">hi</span>&nbsp;<span class="op" id="6022792">=</span>&nbsp;<span class="ident" id="6022794">clear</span>&nbsp;<span class="op" id="6022800">+</span>&nbsp;<span class="num" id="6022802">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022806">e</span><span class="op" id="6022807">.</span><span class="ident" id="6022808">overflow</span>&nbsp;<span class="op" id="6022817">=</span>&nbsp;<span class="ident" id="6022819">clear</span>&nbsp;<span class="op" id="6022825">&lt;&lt;</span>&nbsp;<span class="num" id="6022828">1</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022832">for</span>&nbsp;<span class="ident" id="6022836">i</span>&nbsp;<span class="op" id="6022838">:=</span>&nbsp;<span class="keyword" id="6022841">range</span>&nbsp;<span class="ident" id="6022847">e</span><span class="op" id="6022848">.</span><span class="ident" id="6022849">table</span>&nbsp;<span class="op" id="6022855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6022860">e</span><span class="op" id="6022861">.</span><span class="ident" id="6022862">table</span><span class="op" id="6022867">[</span><span class="ident" id="6022868">i</span><span class="op" id="6022869">]</span>&nbsp;<span class="op" id="6022871">=</span>&nbsp;<span class="ident" id="6022873">invalidEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022892">return</span>&nbsp;<span class="ident" id="6022899">errOutOfCodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6022914">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6022917">return</span>&nbsp;<span class="ident" id="6022924">nil</span><br>
<span class="lineno"></span><span class="op" id="6022928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6022931">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;representation&nbsp;of&nbsp;p&nbsp;to&nbsp;e&#39;s&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6023006">func</span>&nbsp;<span class="op" id="6023011">(</span><span class="ident" id="6023012">e</span>&nbsp;<span class="op" id="6023014">*</span><span class="ident" id="6023015">encoder</span><span class="op" id="6023022">)</span>&nbsp;<span class="ident" id="6023024">Write</span><span class="op" id="6023029">(</span><span class="ident" id="6023030">p</span>&nbsp;<span class="op" id="6023032">[</span><span class="op" id="6023033">]</span><span class="builtintype" id="6023034">byte</span><span class="op" id="6023038">)</span>&nbsp;<span class="op" id="6023040">(</span><span class="ident" id="6023041">n</span>&nbsp;<span class="builtintype" id="6023043">int</span><span class="op" id="6023046">,</span>&nbsp;<span class="ident" id="6023048">err</span>&nbsp;<span class="builtintype" id="6023052">error</span><span class="op" id="6023057">)</span>&nbsp;<span class="op" id="6023059">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023062">if</span>&nbsp;<span class="ident" id="6023065">e</span><span class="op" id="6023066">.</span><span class="ident" id="6023067">err</span>&nbsp;<span class="op" id="6023071">!=</span>&nbsp;<span class="ident" id="6023074">nil</span>&nbsp;<span class="op" id="6023078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023082">return</span>&nbsp;<span class="num" id="6023089">0</span><span class="op" id="6023090">,</span>&nbsp;<span class="ident" id="6023092">e</span><span class="op" id="6023093">.</span><span class="ident" id="6023094">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023102">if</span>&nbsp;<span class="builtinfunc" id="6023105">len</span><span class="op" id="6023108">(</span><span class="ident" id="6023109">p</span><span class="op" id="6023110">)</span>&nbsp;<span class="op" id="6023112">==</span>&nbsp;<span class="num" id="6023115">0</span>&nbsp;<span class="op" id="6023117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023121">return</span>&nbsp;<span class="num" id="6023128">0</span><span class="op" id="6023129">,</span>&nbsp;<span class="ident" id="6023131">nil</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023139">n</span>&nbsp;<span class="op" id="6023141">=</span>&nbsp;<span class="builtinfunc" id="6023143">len</span><span class="op" id="6023146">(</span><span class="ident" id="6023147">p</span><span class="op" id="6023148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023151">litMask</span>&nbsp;<span class="op" id="6023159">:=</span>&nbsp;<span class="builtintype" id="6023162">uint32</span><span class="op" id="6023168">(</span><span class="num" id="6023169">1</span><span class="op" id="6023170">&lt;&lt;</span><span class="ident" id="6023172">e</span><span class="op" id="6023173">.</span><span class="ident" id="6023174">litWidth</span>&nbsp;<span class="op" id="6023183">-</span>&nbsp;<span class="num" id="6023185">1</span><span class="op" id="6023186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023189">code</span>&nbsp;<span class="op" id="6023194">:=</span>&nbsp;<span class="ident" id="6023197">e</span><span class="op" id="6023198">.</span><span class="ident" id="6023199">savedCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023210">if</span>&nbsp;<span class="ident" id="6023213">code</span>&nbsp;<span class="op" id="6023218">==</span>&nbsp;<span class="ident" id="6023221">invalidCode</span>&nbsp;<span class="op" id="6023233">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023237">//&nbsp;The&nbsp;first&nbsp;code&nbsp;sent&nbsp;is&nbsp;always&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023288">code</span><span class="op" id="6023292">,</span>&nbsp;<span class="ident" id="6023294">p</span>&nbsp;<span class="op" id="6023296">=</span>&nbsp;<span class="builtintype" id="6023298">uint32</span><span class="op" id="6023304">(</span><span class="ident" id="6023305">p</span><span class="op" id="6023306">[</span><span class="num" id="6023307">0</span><span class="op" id="6023308">]</span><span class="op" id="6023309">)</span><span class="op" id="6023310">&amp;</span><span class="ident" id="6023311">litMask</span><span class="op" id="6023318">,</span>&nbsp;<span class="ident" id="6023320">p</span><span class="op" id="6023321">[</span><span class="num" id="6023322">1</span><span class="op" id="6023323">:</span><span class="op" id="6023324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023327">}</span><br>
<span class="lineno"></span><span class="ident" id="6023329">loop</span><span class="op" id="6023333">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023336">for</span>&nbsp;<span class="ident" id="6023340">_</span><span class="op" id="6023341">,</span>&nbsp;<span class="ident" id="6023343">x</span>&nbsp;<span class="op" id="6023345">:=</span>&nbsp;<span class="keyword" id="6023348">range</span>&nbsp;<span class="ident" id="6023354">p</span>&nbsp;<span class="op" id="6023356">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023360">literal</span>&nbsp;<span class="op" id="6023368">:=</span>&nbsp;<span class="builtintype" id="6023371">uint32</span><span class="op" id="6023377">(</span><span class="ident" id="6023378">x</span><span class="op" id="6023379">)</span>&nbsp;<span class="op" id="6023381">&amp;</span>&nbsp;<span class="ident" id="6023383">litMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023393">key</span>&nbsp;<span class="op" id="6023397">:=</span>&nbsp;<span class="ident" id="6023400">code</span><span class="op" id="6023404">&lt;&lt;</span><span class="num" id="6023406">8</span>&nbsp;<span class="op" id="6023408">|</span>&nbsp;<span class="ident" id="6023410">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023420">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;hash&nbsp;table&nbsp;hit&nbsp;for&nbsp;this&nbsp;key&nbsp;then&nbsp;we&nbsp;continue&nbsp;the&nbsp;loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023493">//&nbsp;and&nbsp;do&nbsp;not&nbsp;emit&nbsp;a&nbsp;code&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023526">hash</span>&nbsp;<span class="op" id="6023531">:=</span>&nbsp;<span class="op" id="6023534">(</span><span class="ident" id="6023535">key</span><span class="op" id="6023538">&gt;&gt;</span><span class="num" id="6023540">12</span>&nbsp;<span class="op" id="6023543">^</span>&nbsp;<span class="ident" id="6023545">key</span><span class="op" id="6023548">)</span>&nbsp;<span class="op" id="6023550">&amp;</span>&nbsp;<span class="ident" id="6023552">tableMask</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023564">for</span>&nbsp;<span class="ident" id="6023568">h</span><span class="op" id="6023569">,</span>&nbsp;<span class="ident" id="6023571">t</span>&nbsp;<span class="op" id="6023573">:=</span>&nbsp;<span class="ident" id="6023576">hash</span><span class="op" id="6023580">,</span>&nbsp;<span class="ident" id="6023582">e</span><span class="op" id="6023583">.</span><span class="ident" id="6023584">table</span><span class="op" id="6023589">[</span><span class="ident" id="6023590">hash</span><span class="op" id="6023594">]</span><span class="op" id="6023595">;</span>&nbsp;<span class="ident" id="6023597">t</span>&nbsp;<span class="op" id="6023599">!=</span>&nbsp;<span class="ident" id="6023602">invalidEntry</span><span class="op" id="6023614">;</span>&nbsp;<span class="op" id="6023616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023621">if</span>&nbsp;<span class="ident" id="6023624">key</span>&nbsp;<span class="op" id="6023628">==</span>&nbsp;<span class="ident" id="6023631">t</span><span class="op" id="6023632">&gt;&gt;</span><span class="num" id="6023634">12</span>&nbsp;<span class="op" id="6023637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023643">code</span>&nbsp;<span class="op" id="6023648">=</span>&nbsp;<span class="ident" id="6023650">t</span>&nbsp;<span class="op" id="6023652">&amp;</span>&nbsp;<span class="ident" id="6023654">maxCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023666">continue</span>&nbsp;<span class="ident" id="6023675">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023683">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023688">h</span>&nbsp;<span class="op" id="6023690">=</span>&nbsp;<span class="op" id="6023692">(</span><span class="ident" id="6023693">h</span>&nbsp;<span class="op" id="6023695">+</span>&nbsp;<span class="num" id="6023697">1</span><span class="op" id="6023698">)</span>&nbsp;<span class="op" id="6023700">&amp;</span>&nbsp;<span class="ident" id="6023702">tableMask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023715">t</span>&nbsp;<span class="op" id="6023717">=</span>&nbsp;<span class="ident" id="6023719">e</span><span class="op" id="6023720">.</span><span class="ident" id="6023721">table</span><span class="op" id="6023726">[</span><span class="ident" id="6023727">h</span><span class="op" id="6023728">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023736">//&nbsp;Otherwise,&nbsp;write&nbsp;the&nbsp;current&nbsp;code,&nbsp;and&nbsp;literal&nbsp;becomes&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023809">//&nbsp;the&nbsp;next&nbsp;emitted&nbsp;code.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023837">if</span>&nbsp;<span class="ident" id="6023840">e</span><span class="op" id="6023841">.</span><span class="ident" id="6023842">err</span>&nbsp;<span class="op" id="6023846">=</span>&nbsp;<span class="ident" id="6023848">e</span><span class="op" id="6023849">.</span><span class="ident" id="6023850">write</span><span class="op" id="6023855">(</span><span class="ident" id="6023856">e</span><span class="op" id="6023857">,</span>&nbsp;<span class="ident" id="6023859">code</span><span class="op" id="6023863">)</span><span class="op" id="6023864">;</span>&nbsp;<span class="ident" id="6023866">e</span><span class="op" id="6023867">.</span><span class="ident" id="6023868">err</span>&nbsp;<span class="op" id="6023872">!=</span>&nbsp;<span class="ident" id="6023875">nil</span>&nbsp;<span class="op" id="6023879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6023884">return</span>&nbsp;<span class="num" id="6023891">0</span><span class="op" id="6023892">,</span>&nbsp;<span class="ident" id="6023894">e</span><span class="op" id="6023895">.</span><span class="ident" id="6023896">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6023902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6023906">code</span>&nbsp;<span class="op" id="6023911">=</span>&nbsp;<span class="ident" id="6023913">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023923">//&nbsp;Increment&nbsp;e.hi,&nbsp;the&nbsp;next&nbsp;implied&nbsp;code.&nbsp;If&nbsp;we&nbsp;run&nbsp;out&nbsp;of&nbsp;codes,&nbsp;reset</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6023997">//&nbsp;the&nbsp;encoder&nbsp;state&nbsp;(including&nbsp;clearing&nbsp;the&nbsp;hash&nbsp;table)&nbsp;and&nbsp;continue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024070">if</span>&nbsp;<span class="ident" id="6024073">err1</span>&nbsp;<span class="op" id="6024078">:=</span>&nbsp;<span class="ident" id="6024081">e</span><span class="op" id="6024082">.</span><span class="ident" id="6024083">incHi</span><span class="op" id="6024088">(</span><span class="op" id="6024089">)</span><span class="op" id="6024090">;</span>&nbsp;<span class="ident" id="6024092">err1</span>&nbsp;<span class="op" id="6024097">!=</span>&nbsp;<span class="ident" id="6024100">nil</span>&nbsp;<span class="op" id="6024104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024109">if</span>&nbsp;<span class="ident" id="6024112">err1</span>&nbsp;<span class="op" id="6024117">==</span>&nbsp;<span class="ident" id="6024120">errOutOfCodes</span>&nbsp;<span class="op" id="6024134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024140">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024152">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024157">e</span><span class="op" id="6024158">.</span><span class="ident" id="6024159">err</span>&nbsp;<span class="op" id="6024163">=</span>&nbsp;<span class="ident" id="6024165">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024173">return</span>&nbsp;<span class="num" id="6024180">0</span><span class="op" id="6024181">,</span>&nbsp;<span class="ident" id="6024183">e</span><span class="op" id="6024184">.</span><span class="ident" id="6024185">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024195">//&nbsp;Otherwise,&nbsp;insert&nbsp;key&nbsp;-&gt;&nbsp;e.hi&nbsp;into&nbsp;the&nbsp;map&nbsp;that&nbsp;e.table&nbsp;represents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024268">for</span>&nbsp;<span class="op" id="6024272">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024277">if</span>&nbsp;<span class="ident" id="6024280">e</span><span class="op" id="6024281">.</span><span class="ident" id="6024282">table</span><span class="op" id="6024287">[</span><span class="ident" id="6024288">hash</span><span class="op" id="6024292">]</span>&nbsp;<span class="op" id="6024294">==</span>&nbsp;<span class="ident" id="6024297">invalidEntry</span>&nbsp;<span class="op" id="6024310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024316">e</span><span class="op" id="6024317">.</span><span class="ident" id="6024318">table</span><span class="op" id="6024323">[</span><span class="ident" id="6024324">hash</span><span class="op" id="6024328">]</span>&nbsp;<span class="op" id="6024330">=</span>&nbsp;<span class="op" id="6024332">(</span><span class="ident" id="6024333">key</span>&nbsp;<span class="op" id="6024337">&lt;&lt;</span>&nbsp;<span class="num" id="6024340">12</span><span class="op" id="6024342">)</span>&nbsp;<span class="op" id="6024344">|</span>&nbsp;<span class="ident" id="6024346">e</span><span class="op" id="6024347">.</span><span class="ident" id="6024348">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024355">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024369">hash</span>&nbsp;<span class="op" id="6024374">=</span>&nbsp;<span class="op" id="6024376">(</span><span class="ident" id="6024377">hash</span>&nbsp;<span class="op" id="6024382">+</span>&nbsp;<span class="num" id="6024384">1</span><span class="op" id="6024385">)</span>&nbsp;<span class="op" id="6024387">&amp;</span>&nbsp;<span class="ident" id="6024389">tableMask</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024407">e</span><span class="op" id="6024408">.</span><span class="ident" id="6024409">savedCode</span>&nbsp;<span class="op" id="6024419">=</span>&nbsp;<span class="ident" id="6024421">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024427">return</span>&nbsp;<span class="ident" id="6024434">n</span><span class="op" id="6024435">,</span>&nbsp;<span class="ident" id="6024437">nil</span><br>
<span class="lineno"></span><span class="op" id="6024441">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="6024444">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;encoder,&nbsp;flushing&nbsp;any&nbsp;pending&nbsp;output.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6024523">//&nbsp;flush&nbsp;e&#39;s&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6024555">func</span>&nbsp;<span class="op" id="6024560">(</span><span class="ident" id="6024561">e</span>&nbsp;<span class="op" id="6024563">*</span><span class="ident" id="6024564">encoder</span><span class="op" id="6024571">)</span>&nbsp;<span class="ident" id="6024573">Close</span><span class="op" id="6024578">(</span><span class="op" id="6024579">)</span>&nbsp;<span class="builtintype" id="6024581">error</span>&nbsp;<span class="op" id="6024587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024590">if</span>&nbsp;<span class="ident" id="6024593">e</span><span class="op" id="6024594">.</span><span class="ident" id="6024595">err</span>&nbsp;<span class="op" id="6024599">!=</span>&nbsp;<span class="ident" id="6024602">nil</span>&nbsp;<span class="op" id="6024606">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024610">if</span>&nbsp;<span class="ident" id="6024613">e</span><span class="op" id="6024614">.</span><span class="ident" id="6024615">err</span>&nbsp;<span class="op" id="6024619">==</span>&nbsp;<span class="ident" id="6024622">errClosed</span>&nbsp;<span class="op" id="6024632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024637">return</span>&nbsp;<span class="ident" id="6024644">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024654">return</span>&nbsp;<span class="ident" id="6024661">e</span><span class="op" id="6024662">.</span><span class="ident" id="6024663">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024668">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024671">//&nbsp;Make&nbsp;any&nbsp;future&nbsp;calls&nbsp;to&nbsp;Write&nbsp;return&nbsp;errClosed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024724">e</span><span class="op" id="6024725">.</span><span class="ident" id="6024726">err</span>&nbsp;<span class="op" id="6024730">=</span>&nbsp;<span class="ident" id="6024732">errClosed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024743">//&nbsp;Write&nbsp;the&nbsp;savedCode&nbsp;if&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024777">if</span>&nbsp;<span class="ident" id="6024780">e</span><span class="op" id="6024781">.</span><span class="ident" id="6024782">savedCode</span>&nbsp;<span class="op" id="6024792">!=</span>&nbsp;<span class="ident" id="6024795">invalidCode</span>&nbsp;<span class="op" id="6024807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024811">if</span>&nbsp;<span class="ident" id="6024814">err</span>&nbsp;<span class="op" id="6024818">:=</span>&nbsp;<span class="ident" id="6024821">e</span><span class="op" id="6024822">.</span><span class="ident" id="6024823">write</span><span class="op" id="6024828">(</span><span class="ident" id="6024829">e</span><span class="op" id="6024830">,</span>&nbsp;<span class="ident" id="6024832">e</span><span class="op" id="6024833">.</span><span class="ident" id="6024834">savedCode</span><span class="op" id="6024843">)</span><span class="op" id="6024844">;</span>&nbsp;<span class="ident" id="6024846">err</span>&nbsp;<span class="op" id="6024850">!=</span>&nbsp;<span class="ident" id="6024853">nil</span>&nbsp;<span class="op" id="6024857">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024862">return</span>&nbsp;<span class="ident" id="6024869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024879">if</span>&nbsp;<span class="ident" id="6024882">err</span>&nbsp;<span class="op" id="6024886">:=</span>&nbsp;<span class="ident" id="6024889">e</span><span class="op" id="6024890">.</span><span class="ident" id="6024891">incHi</span><span class="op" id="6024896">(</span><span class="op" id="6024897">)</span><span class="op" id="6024898">;</span>&nbsp;<span class="ident" id="6024900">err</span>&nbsp;<span class="op" id="6024904">!=</span>&nbsp;<span class="ident" id="6024907">nil</span>&nbsp;<span class="op" id="6024911">&amp;&amp;</span>&nbsp;<span class="ident" id="6024914">err</span>&nbsp;<span class="op" id="6024918">!=</span>&nbsp;<span class="ident" id="6024921">errOutOfCodes</span>&nbsp;<span class="op" id="6024935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6024940">return</span>&nbsp;<span class="ident" id="6024947">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024953">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6024956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6024959">//&nbsp;Write&nbsp;the&nbsp;eof&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6024983">eof</span>&nbsp;<span class="op" id="6024987">:=</span>&nbsp;<span class="builtintype" id="6024990">uint32</span><span class="op" id="6024996">(</span><span class="num" id="6024997">1</span><span class="op" id="6024998">)</span><span class="op" id="6024999">&lt;&lt;</span><span class="ident" id="6025001">e</span><span class="op" id="6025002">.</span><span class="ident" id="6025003">litWidth</span>&nbsp;<span class="op" id="6025012">+</span>&nbsp;<span class="num" id="6025014">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025017">if</span>&nbsp;<span class="ident" id="6025020">err</span>&nbsp;<span class="op" id="6025024">:=</span>&nbsp;<span class="ident" id="6025027">e</span><span class="op" id="6025028">.</span><span class="ident" id="6025029">write</span><span class="op" id="6025034">(</span><span class="ident" id="6025035">e</span><span class="op" id="6025036">,</span>&nbsp;<span class="ident" id="6025038">eof</span><span class="op" id="6025041">)</span><span class="op" id="6025042">;</span>&nbsp;<span class="ident" id="6025044">err</span>&nbsp;<span class="op" id="6025048">!=</span>&nbsp;<span class="ident" id="6025051">nil</span>&nbsp;<span class="op" id="6025055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025059">return</span>&nbsp;<span class="ident" id="6025066">err</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6025074">//&nbsp;Write&nbsp;the&nbsp;final&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025100">if</span>&nbsp;<span class="ident" id="6025103">e</span><span class="op" id="6025104">.</span><span class="ident" id="6025105">nBits</span>&nbsp;<span class="op" id="6025111">&gt;</span>&nbsp;<span class="num" id="6025113">0</span>&nbsp;<span class="op" id="6025115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025119">if</span>&nbsp;<span class="ident" id="6025122">e</span><span class="op" id="6025123">.</span><span class="ident" id="6025124">order</span>&nbsp;<span class="op" id="6025130">==</span>&nbsp;<span class="ident" id="6025133">MSB</span>&nbsp;<span class="op" id="6025137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025142">e</span><span class="op" id="6025143">.</span><span class="ident" id="6025144">bits</span>&nbsp;<span class="op" id="6025149">&gt;&gt;=</span>&nbsp;<span class="num" id="6025153">24</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025162">if</span>&nbsp;<span class="ident" id="6025165">err</span>&nbsp;<span class="op" id="6025169">:=</span>&nbsp;<span class="ident" id="6025172">e</span><span class="op" id="6025173">.</span><span class="ident" id="6025174">w</span><span class="op" id="6025175">.</span><span class="ident" id="6025176">WriteByte</span><span class="op" id="6025185">(</span><span class="builtintype" id="6025186">uint8</span><span class="op" id="6025191">(</span><span class="ident" id="6025192">e</span><span class="op" id="6025193">.</span><span class="ident" id="6025194">bits</span><span class="op" id="6025198">)</span><span class="op" id="6025199">)</span><span class="op" id="6025200">;</span>&nbsp;<span class="ident" id="6025202">err</span>&nbsp;<span class="op" id="6025206">!=</span>&nbsp;<span class="ident" id="6025209">nil</span>&nbsp;<span class="op" id="6025213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025218">return</span>&nbsp;<span class="ident" id="6025225">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025234">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025237">return</span>&nbsp;<span class="ident" id="6025244">e</span><span class="op" id="6025245">.</span><span class="ident" id="6025246">w</span><span class="op" id="6025247">.</span><span class="ident" id="6025248">Flush</span><span class="op" id="6025253">(</span><span class="op" id="6025254">)</span><br>
<span class="lineno"></span><span class="op" id="6025256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6025259">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="6025302">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;io.WriteCloser&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">230</span><span class="comment" id="6025376">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="6025451">//&nbsp;finished&nbsp;writing.</span><br>
<span class="lineno"></span><span class="comment" id="6025472">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6025545">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="6025580">func</span>&nbsp;<span class="ident" id="6025585">NewWriter</span><span class="op" id="6025594">(</span><span class="ident" id="6025595">w</span>&nbsp;<span class="ident" id="6025597">io</span><span class="op" id="6025599">.</span><span class="ident" id="6025600">Writer</span><span class="op" id="6025606">,</span>&nbsp;<span class="ident" id="6025608">order</span>&nbsp;<span class="ident" id="6025614">Order</span><span class="op" id="6025619">,</span>&nbsp;<span class="ident" id="6025621">litWidth</span>&nbsp;<span class="builtintype" id="6025630">int</span><span class="op" id="6025633">)</span>&nbsp;<span class="ident" id="6025635">io</span><span class="op" id="6025637">.</span><span class="ident" id="6025638">WriteCloser</span>&nbsp;<span class="op" id="6025650">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025653">var</span>&nbsp;<span class="ident" id="6025657">write</span>&nbsp;<span class="keyword" id="6025663">func</span><span class="op" id="6025667">(</span><span class="op" id="6025668">*</span><span class="ident" id="6025669">encoder</span><span class="op" id="6025676">,</span>&nbsp;<span class="builtintype" id="6025678">uint32</span><span class="op" id="6025684">)</span>&nbsp;<span class="builtintype" id="6025686">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025693">switch</span>&nbsp;<span class="ident" id="6025700">order</span>&nbsp;<span class="op" id="6025706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025709">case</span>&nbsp;<span class="ident" id="6025714">LSB</span><span class="op" id="6025717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025721">write</span>&nbsp;<span class="op" id="6025727">=</span>&nbsp;<span class="op" id="6025729">(</span><span class="op" id="6025730">*</span><span class="ident" id="6025731">encoder</span><span class="op" id="6025738">)</span><span class="op" id="6025739">.</span><span class="ident" id="6025740">writeLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025750">case</span>&nbsp;<span class="ident" id="6025755">MSB</span><span class="op" id="6025758">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025762">write</span>&nbsp;<span class="op" id="6025768">=</span>&nbsp;<span class="op" id="6025770">(</span><span class="op" id="6025771">*</span><span class="ident" id="6025772">encoder</span><span class="op" id="6025779">)</span><span class="op" id="6025780">.</span><span class="ident" id="6025781">writeMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025791">default</span><span class="op" id="6025798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025802">return</span>&nbsp;<span class="op" id="6025809">&amp;</span><span class="ident" id="6025810">errWriteCloser</span><span class="op" id="6025824">{</span><span class="ident" id="6025825">errors</span><span class="op" id="6025831">.</span><span class="ident" id="6025832">New</span><span class="op" id="6025835">(</span><span class="string" id="6025836">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="6025856">)</span><span class="op" id="6025857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025863">if</span>&nbsp;<span class="ident" id="6025866">litWidth</span>&nbsp;<span class="op" id="6025875">&lt;</span>&nbsp;<span class="num" id="6025877">2</span>&nbsp;<span class="op" id="6025879">||</span>&nbsp;<span class="num" id="6025882">8</span>&nbsp;<span class="op" id="6025884">&lt;</span>&nbsp;<span class="ident" id="6025886">litWidth</span>&nbsp;<span class="op" id="6025895">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6025899">return</span>&nbsp;<span class="op" id="6025906">&amp;</span><span class="ident" id="6025907">errWriteCloser</span><span class="op" id="6025921">{</span><span class="ident" id="6025922">fmt</span><span class="op" id="6025925">.</span><span class="ident" id="6025926">Errorf</span><span class="op" id="6025932">(</span><span class="string" id="6025933">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="6025964">,</span>&nbsp;<span class="ident" id="6025966">litWidth</span><span class="op" id="6025974">)</span><span class="op" id="6025975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6025978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6025981">bw</span><span class="op" id="6025983">,</span>&nbsp;<span class="ident" id="6025985">ok</span>&nbsp;<span class="op" id="6025988">:=</span>&nbsp;<span class="ident" id="6025991">w</span><span class="op" id="6025992">.</span><span class="op" id="6025993">(</span><span class="ident" id="6025994">writer</span><span class="op" id="6026000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026003">if</span>&nbsp;<span class="op" id="6026006">!</span><span class="ident" id="6026007">ok</span>&nbsp;<span class="op" id="6026010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026014">bw</span>&nbsp;<span class="op" id="6026017">=</span>&nbsp;<span class="ident" id="6026019">bufio</span><span class="op" id="6026024">.</span><span class="ident" id="6026025">NewWriter</span><span class="op" id="6026034">(</span><span class="ident" id="6026035">w</span><span class="op" id="6026036">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026042">lw</span>&nbsp;<span class="op" id="6026045">:=</span>&nbsp;<span class="builtintype" id="6026048">uint</span><span class="op" id="6026052">(</span><span class="ident" id="6026053">litWidth</span><span class="op" id="6026061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6026064">return</span>&nbsp;<span class="op" id="6026071">&amp;</span><span class="ident" id="6026072">encoder</span><span class="op" id="6026079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026083">w</span><span class="op" id="6026084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026094">bw</span><span class="op" id="6026096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026100">order</span><span class="op" id="6026105">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026111">order</span><span class="op" id="6026116">,</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026120">write</span><span class="op" id="6026125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6026131">write</span><span class="op" id="6026136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026140">width</span><span class="op" id="6026145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6026151">1</span>&nbsp;<span class="op" id="6026153">+</span>&nbsp;<span class="ident" id="6026155">lw</span><span class="op" id="6026157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026161">litWidth</span><span class="op" id="6026169">:</span>&nbsp;&nbsp;<span class="ident" id="6026172">lw</span><span class="op" id="6026174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026178">hi</span><span class="op" id="6026180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6026189">1</span><span class="op" id="6026190">&lt;&lt;</span><span class="ident" id="6026192">lw</span>&nbsp;<span class="op" id="6026195">+</span>&nbsp;<span class="num" id="6026197">1</span><span class="op" id="6026198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026202">overflow</span><span class="op" id="6026210">:</span>&nbsp;&nbsp;<span class="num" id="6026213">1</span>&nbsp;<span class="op" id="6026215">&lt;&lt;</span>&nbsp;<span class="op" id="6026218">(</span><span class="ident" id="6026219">lw</span>&nbsp;<span class="op" id="6026222">+</span>&nbsp;<span class="num" id="6026224">1</span><span class="op" id="6026225">)</span><span class="op" id="6026226">,</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6026230">savedCode</span><span class="op" id="6026239">:</span>&nbsp;<span class="ident" id="6026241">invalidCode</span><span class="op" id="6026252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6026255">}</span><br>
<span class="lineno"></span><span class="op" id="6026257">}</span>
</div>
</body>
</html>
