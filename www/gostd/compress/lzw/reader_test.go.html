<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/lzw</h2>
<ul>
<li><a href="/gostd/compress/lzw/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/lzw/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/compress/lzw/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/lzw/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7470915">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7470970">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7471024">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7471075">package</span>&nbsp;<span class="ident" id="7471083">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7471088">import</span>&nbsp;<span class="op" id="7471095">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471098">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471107">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471113">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471126">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471137">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471148">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471159">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7471169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7471172">type</span>&nbsp;<span class="ident" id="7471177">lzwTest</span>&nbsp;<span class="keyword" id="7471185">struct</span>&nbsp;<span class="op" id="7471192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471195">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7471206">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471214">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7471225">string</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471233">compressed</span>&nbsp;<span class="builtintype" id="7471244">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471252">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7471263">error</span><br>
<span class="lineno"></span><span class="op" id="7471269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7471272">var</span>&nbsp;<span class="ident" id="7471276">lzwTests</span>&nbsp;<span class="op" id="7471285">=</span>&nbsp;<span class="op" id="7471287">[</span><span class="op" id="7471288">]</span><span class="ident" id="7471289">lzwTest</span><span class="op" id="7471296">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471303">&#34;empty;LSB;8&#34;</span><span class="op" id="7471316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471320">&#34;&#34;</span><span class="op" id="7471322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471326">&#34;\x01\x01&#34;</span><span class="op" id="7471336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471340">nil</span><span class="op" id="7471343">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471346">}</span><span class="op" id="7471347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471354">&#34;empty;MSB;8&#34;</span><span class="op" id="7471367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471371">&#34;&#34;</span><span class="op" id="7471373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471377">&#34;\x80\x80&#34;</span><span class="op" id="7471387">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471391">nil</span><span class="op" id="7471394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471397">}</span><span class="op" id="7471398">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471405">&#34;tobe;LSB;7&#34;</span><span class="op" id="7471417">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471421">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="7471447">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471451">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="7471521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471525">nil</span><span class="op" id="7471528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471531">}</span><span class="op" id="7471532">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471539">&#34;tobe;LSB;8&#34;</span><span class="op" id="7471551">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471555">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="7471581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471585">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04\x12\x34\xb8\xb0\xe0\xc1\x84\x01\x01&#34;</span><span class="op" id="7471667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471671">nil</span><span class="op" id="7471674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471677">}</span><span class="op" id="7471678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471681">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471685">&#34;tobe;MSB;7&#34;</span><span class="op" id="7471697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471701">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="7471727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471731">&#34;\x54\x4f\x42\x45\x4f\x52\x4e\x4f\x54\x82\x84\x86\x8b\x85\x87\x89\x81&#34;</span><span class="op" id="7471801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471805">nil</span><span class="op" id="7471808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471811">}</span><span class="op" id="7471812">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471819">&#34;tobe;MSB;8&#34;</span><span class="op" id="7471831">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471835">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="7471861">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471865">&#34;\x2a\x13\xc8\x44\x52\x79\x48\x9c\x4f\x2a\x40\xa0\x90\x68\x5c\x16\x0f\x09\x80\x80&#34;</span><span class="op" id="7471947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7471951">nil</span><span class="op" id="7471954">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471957">}</span><span class="op" id="7471958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7471961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471965">&#34;tobe-truncated;LSB;8&#34;</span><span class="op" id="7471987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7471991">&#34;TOBEORNOTTOBEORTOBEORNOT&#34;</span><span class="op" id="7472017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472021">&#34;\x54\x9e\x08\x29\xf2\x44\x8a\x93\x27\x54\x04&#34;</span><span class="op" id="7472067">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472071">io</span><span class="op" id="7472073">.</span><span class="ident" id="7472074">ErrUnexpectedEOF</span><span class="op" id="7472090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472093">}</span><span class="op" id="7472094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7472097">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://en.wikipedia.org/wiki/Graphics_Interchange_Format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472187">&#34;gif;LSB;8&#34;</span><span class="op" id="7472198">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472202">&#34;\x28\xff\xff\xff\x28\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff&#34;</span><span class="op" id="7472264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472268">&#34;\x00\x51\xfc\x1b\x28\x70\xa0\xc1\x83\x01\x01&#34;</span><span class="op" id="7472314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472318">nil</span><span class="op" id="7472321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472324">}</span><span class="op" id="7472325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7472328">//&nbsp;This&nbsp;example&nbsp;comes&nbsp;from&nbsp;http://compgroups.net/comp.lang.ruby/Decompressing-LZW-compression-from-PDF-file</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472441">&#34;pdf;MSB;8&#34;</span><span class="op" id="7472452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472456">&#34;-----A---B&#34;</span><span class="op" id="7472468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7472472">&#34;\x80\x0b\x60\x50\x22\x0c\x0c\x85\x01&#34;</span><span class="op" id="7472510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472514">nil</span><span class="op" id="7472517">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472520">}</span><span class="op" id="7472521">,</span><br>
<span class="lineno"></span><span class="op" id="7472523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7472526">func</span>&nbsp;<span class="ident" id="7472531">TestReader</span><span class="op" id="7472541">(</span><span class="ident" id="7472542">t</span>&nbsp;<span class="op" id="7472544">*</span><span class="ident" id="7472545">testing</span><span class="op" id="7472552">.</span><span class="ident" id="7472553">T</span><span class="op" id="7472554">)</span>&nbsp;<span class="op" id="7472556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472559">var</span>&nbsp;<span class="ident" id="7472563">b</span>&nbsp;<span class="ident" id="7472565">bytes</span><span class="op" id="7472570">.</span><span class="ident" id="7472571">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472579">for</span>&nbsp;<span class="ident" id="7472583">_</span><span class="op" id="7472584">,</span>&nbsp;<span class="ident" id="7472586">tt</span>&nbsp;<span class="op" id="7472589">:=</span>&nbsp;<span class="keyword" id="7472592">range</span>&nbsp;<span class="ident" id="7472598">lzwTests</span>&nbsp;<span class="op" id="7472607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472611">d</span>&nbsp;<span class="op" id="7472613">:=</span>&nbsp;<span class="ident" id="7472616">strings</span><span class="op" id="7472623">.</span><span class="ident" id="7472624">Split</span><span class="op" id="7472629">(</span><span class="ident" id="7472630">tt</span><span class="op" id="7472632">.</span><span class="ident" id="7472633">desc</span><span class="op" id="7472637">,</span>&nbsp;<span class="string" id="7472639">&#34;;&#34;</span><span class="op" id="7472642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472646">var</span>&nbsp;<span class="ident" id="7472650">order</span>&nbsp;<span class="ident" id="7472656">Order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472664">switch</span>&nbsp;<span class="ident" id="7472671">d</span><span class="op" id="7472672">[</span><span class="num" id="7472673">1</span><span class="op" id="7472674">]</span>&nbsp;<span class="op" id="7472676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472680">case</span>&nbsp;<span class="string" id="7472685">&#34;LSB&#34;</span><span class="op" id="7472690">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472695">order</span>&nbsp;<span class="op" id="7472701">=</span>&nbsp;<span class="ident" id="7472703">LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472709">case</span>&nbsp;<span class="string" id="7472714">&#34;MSB&#34;</span><span class="op" id="7472719">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472724">order</span>&nbsp;<span class="op" id="7472730">=</span>&nbsp;<span class="ident" id="7472732">MSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472738">default</span><span class="op" id="7472745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472750">t</span><span class="op" id="7472751">.</span><span class="ident" id="7472752">Errorf</span><span class="op" id="7472758">(</span><span class="string" id="7472759">&#34;%s:&nbsp;bad&nbsp;order&nbsp;%q&#34;</span><span class="op" id="7472777">,</span>&nbsp;<span class="ident" id="7472779">tt</span><span class="op" id="7472781">.</span><span class="ident" id="7472782">desc</span><span class="op" id="7472786">,</span>&nbsp;<span class="ident" id="7472788">d</span><span class="op" id="7472789">[</span><span class="num" id="7472790">1</span><span class="op" id="7472791">]</span><span class="op" id="7472792">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7472796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472800">litWidth</span><span class="op" id="7472808">,</span>&nbsp;<span class="ident" id="7472810">_</span>&nbsp;<span class="op" id="7472812">:=</span>&nbsp;<span class="ident" id="7472815">strconv</span><span class="op" id="7472822">.</span><span class="ident" id="7472823">Atoi</span><span class="op" id="7472827">(</span><span class="ident" id="7472828">d</span><span class="op" id="7472829">[</span><span class="num" id="7472830">2</span><span class="op" id="7472831">]</span><span class="op" id="7472832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472836">rc</span>&nbsp;<span class="op" id="7472839">:=</span>&nbsp;<span class="ident" id="7472842">NewReader</span><span class="op" id="7472851">(</span><span class="ident" id="7472852">strings</span><span class="op" id="7472859">.</span><span class="ident" id="7472860">NewReader</span><span class="op" id="7472869">(</span><span class="ident" id="7472870">tt</span><span class="op" id="7472872">.</span><span class="ident" id="7472873">compressed</span><span class="op" id="7472883">)</span><span class="op" id="7472884">,</span>&nbsp;<span class="ident" id="7472886">order</span><span class="op" id="7472891">,</span>&nbsp;<span class="ident" id="7472893">litWidth</span><span class="op" id="7472901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472905">defer</span>&nbsp;<span class="ident" id="7472911">rc</span><span class="op" id="7472913">.</span><span class="ident" id="7472914">Close</span><span class="op" id="7472919">(</span><span class="op" id="7472920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472924">b</span><span class="op" id="7472925">.</span><span class="ident" id="7472926">Reset</span><span class="op" id="7472931">(</span><span class="op" id="7472932">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7472936">n</span><span class="op" id="7472937">,</span>&nbsp;<span class="ident" id="7472939">err</span>&nbsp;<span class="op" id="7472943">:=</span>&nbsp;<span class="ident" id="7472946">io</span><span class="op" id="7472948">.</span><span class="ident" id="7472949">Copy</span><span class="op" id="7472953">(</span><span class="op" id="7472954">&amp;</span><span class="ident" id="7472955">b</span><span class="op" id="7472956">,</span>&nbsp;<span class="ident" id="7472958">rc</span><span class="op" id="7472960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472964">if</span>&nbsp;<span class="ident" id="7472967">err</span>&nbsp;<span class="op" id="7472971">!=</span>&nbsp;<span class="ident" id="7472974">nil</span>&nbsp;<span class="op" id="7472978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7472983">if</span>&nbsp;<span class="ident" id="7472986">err</span>&nbsp;<span class="op" id="7472990">!=</span>&nbsp;<span class="ident" id="7472993">tt</span><span class="op" id="7472995">.</span><span class="ident" id="7472996">err</span>&nbsp;<span class="op" id="7473000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473006">t</span><span class="op" id="7473007">.</span><span class="ident" id="7473008">Errorf</span><span class="op" id="7473014">(</span><span class="string" id="7473015">&#34;%s:&nbsp;io.Copy:&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7473040">,</span>&nbsp;<span class="ident" id="7473042">tt</span><span class="op" id="7473044">.</span><span class="ident" id="7473045">desc</span><span class="op" id="7473049">,</span>&nbsp;<span class="ident" id="7473051">err</span><span class="op" id="7473054">,</span>&nbsp;<span class="ident" id="7473056">tt</span><span class="op" id="7473058">.</span><span class="ident" id="7473059">err</span><span class="op" id="7473062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473067">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473072">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473087">s</span>&nbsp;<span class="op" id="7473089">:=</span>&nbsp;<span class="ident" id="7473092">b</span><span class="op" id="7473093">.</span><span class="ident" id="7473094">String</span><span class="op" id="7473100">(</span><span class="op" id="7473101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473105">if</span>&nbsp;<span class="ident" id="7473108">s</span>&nbsp;<span class="op" id="7473110">!=</span>&nbsp;<span class="ident" id="7473113">tt</span><span class="op" id="7473115">.</span><span class="ident" id="7473116">raw</span>&nbsp;<span class="op" id="7473120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473125">t</span><span class="op" id="7473126">.</span><span class="ident" id="7473127">Errorf</span><span class="op" id="7473133">(</span><span class="string" id="7473134">&#34;%s:&nbsp;got&nbsp;%d-byte&nbsp;%q&nbsp;want&nbsp;%d-byte&nbsp;%q&#34;</span><span class="op" id="7473170">,</span>&nbsp;<span class="ident" id="7473172">tt</span><span class="op" id="7473174">.</span><span class="ident" id="7473175">desc</span><span class="op" id="7473179">,</span>&nbsp;<span class="ident" id="7473181">n</span><span class="op" id="7473182">,</span>&nbsp;<span class="ident" id="7473184">s</span><span class="op" id="7473185">,</span>&nbsp;<span class="builtinfunc" id="7473187">len</span><span class="op" id="7473190">(</span><span class="ident" id="7473191">tt</span><span class="op" id="7473193">.</span><span class="ident" id="7473194">raw</span><span class="op" id="7473197">)</span><span class="op" id="7473198">,</span>&nbsp;<span class="ident" id="7473200">tt</span><span class="op" id="7473202">.</span><span class="ident" id="7473203">raw</span><span class="op" id="7473206">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473213">}</span><br>
<span class="lineno"></span><span class="op" id="7473215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7473218">func</span>&nbsp;<span class="ident" id="7473223">benchmarkDecoder</span><span class="op" id="7473239">(</span><span class="ident" id="7473240">b</span>&nbsp;<span class="op" id="7473242">*</span><span class="ident" id="7473243">testing</span><span class="op" id="7473250">.</span><span class="ident" id="7473251">B</span><span class="op" id="7473252">,</span>&nbsp;<span class="ident" id="7473254">n</span>&nbsp;<span class="builtintype" id="7473256">int</span><span class="op" id="7473259">)</span>&nbsp;<span class="op" id="7473261">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473264">b</span><span class="op" id="7473265">.</span><span class="ident" id="7473266">StopTimer</span><span class="op" id="7473275">(</span><span class="op" id="7473276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473279">b</span><span class="op" id="7473280">.</span><span class="ident" id="7473281">SetBytes</span><span class="op" id="7473289">(</span><span class="ident" id="7473290">int64</span><span class="op" id="7473295">(</span><span class="ident" id="7473296">n</span><span class="op" id="7473297">)</span><span class="op" id="7473298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473301">buf0</span><span class="op" id="7473305">,</span>&nbsp;<span class="ident" id="7473307">err</span>&nbsp;<span class="op" id="7473311">:=</span>&nbsp;<span class="ident" id="7473314">ioutil</span><span class="op" id="7473320">.</span><span class="ident" id="7473321">ReadFile</span><span class="op" id="7473329">(</span><span class="string" id="7473330">&#34;../testdata/e.txt&#34;</span><span class="op" id="7473349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473352">if</span>&nbsp;<span class="ident" id="7473355">err</span>&nbsp;<span class="op" id="7473359">!=</span>&nbsp;<span class="ident" id="7473362">nil</span>&nbsp;<span class="op" id="7473366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473370">b</span><span class="op" id="7473371">.</span><span class="ident" id="7473372">Fatal</span><span class="op" id="7473377">(</span><span class="ident" id="7473378">err</span><span class="op" id="7473381">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473387">if</span>&nbsp;<span class="builtinfunc" id="7473390">len</span><span class="op" id="7473393">(</span><span class="ident" id="7473394">buf0</span><span class="op" id="7473398">)</span>&nbsp;<span class="op" id="7473400">==</span>&nbsp;<span class="num" id="7473403">0</span>&nbsp;<span class="op" id="7473405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473409">b</span><span class="op" id="7473410">.</span><span class="ident" id="7473411">Fatalf</span><span class="op" id="7473417">(</span><span class="string" id="7473418">&#34;test&nbsp;file&nbsp;has&nbsp;no&nbsp;data&#34;</span><span class="op" id="7473441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473447">compressed</span>&nbsp;<span class="op" id="7473458">:=</span>&nbsp;<span class="builtinfunc" id="7473461">new</span><span class="op" id="7473464">(</span><span class="ident" id="7473465">bytes</span><span class="op" id="7473470">.</span><span class="ident" id="7473471">Buffer</span><span class="op" id="7473477">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473480">w</span>&nbsp;<span class="op" id="7473482">:=</span>&nbsp;<span class="ident" id="7473485">NewWriter</span><span class="op" id="7473494">(</span><span class="ident" id="7473495">compressed</span><span class="op" id="7473505">,</span>&nbsp;<span class="ident" id="7473507">LSB</span><span class="op" id="7473510">,</span>&nbsp;<span class="num" id="7473512">8</span><span class="op" id="7473513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473516">for</span>&nbsp;<span class="ident" id="7473520">i</span>&nbsp;<span class="op" id="7473522">:=</span>&nbsp;<span class="num" id="7473525">0</span><span class="op" id="7473526">;</span>&nbsp;<span class="ident" id="7473528">i</span>&nbsp;<span class="op" id="7473530">&lt;</span>&nbsp;<span class="ident" id="7473532">n</span><span class="op" id="7473533">;</span>&nbsp;<span class="ident" id="7473535">i</span>&nbsp;<span class="op" id="7473537">+=</span>&nbsp;<span class="builtinfunc" id="7473540">len</span><span class="op" id="7473543">(</span><span class="ident" id="7473544">buf0</span><span class="op" id="7473548">)</span>&nbsp;<span class="op" id="7473550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473554">if</span>&nbsp;<span class="builtinfunc" id="7473557">len</span><span class="op" id="7473560">(</span><span class="ident" id="7473561">buf0</span><span class="op" id="7473565">)</span>&nbsp;<span class="op" id="7473567">&gt;</span>&nbsp;<span class="ident" id="7473569">n</span><span class="op" id="7473570">-</span><span class="ident" id="7473571">i</span>&nbsp;<span class="op" id="7473573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473578">buf0</span>&nbsp;<span class="op" id="7473583">=</span>&nbsp;<span class="ident" id="7473585">buf0</span><span class="op" id="7473589">[</span><span class="op" id="7473590">:</span><span class="ident" id="7473591">n</span><span class="op" id="7473592">-</span><span class="ident" id="7473593">i</span><span class="op" id="7473594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473598">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473602">w</span><span class="op" id="7473603">.</span><span class="ident" id="7473604">Write</span><span class="op" id="7473609">(</span><span class="ident" id="7473610">buf0</span><span class="op" id="7473614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473620">w</span><span class="op" id="7473621">.</span><span class="ident" id="7473622">Close</span><span class="op" id="7473627">(</span><span class="op" id="7473628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473631">buf1</span>&nbsp;<span class="op" id="7473636">:=</span>&nbsp;<span class="ident" id="7473639">compressed</span><span class="op" id="7473649">.</span><span class="ident" id="7473650">Bytes</span><span class="op" id="7473655">(</span><span class="op" id="7473656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473659">buf0</span><span class="op" id="7473663">,</span>&nbsp;<span class="ident" id="7473665">compressed</span><span class="op" id="7473675">,</span>&nbsp;<span class="ident" id="7473677">w</span>&nbsp;<span class="op" id="7473679">=</span>&nbsp;<span class="ident" id="7473681">nil</span><span class="op" id="7473684">,</span>&nbsp;<span class="ident" id="7473686">nil</span><span class="op" id="7473689">,</span>&nbsp;<span class="ident" id="7473691">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473696">runtime</span><span class="op" id="7473703">.</span><span class="ident" id="7473704">GC</span><span class="op" id="7473706">(</span><span class="op" id="7473707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473710">b</span><span class="op" id="7473711">.</span><span class="ident" id="7473712">StartTimer</span><span class="op" id="7473722">(</span><span class="op" id="7473723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7473726">for</span>&nbsp;<span class="ident" id="7473730">i</span>&nbsp;<span class="op" id="7473732">:=</span>&nbsp;<span class="num" id="7473735">0</span><span class="op" id="7473736">;</span>&nbsp;<span class="ident" id="7473738">i</span>&nbsp;<span class="op" id="7473740">&lt;</span>&nbsp;<span class="ident" id="7473742">b</span><span class="op" id="7473743">.</span><span class="ident" id="7473744">N</span><span class="op" id="7473745">;</span>&nbsp;<span class="ident" id="7473747">i</span><span class="op" id="7473748">++</span>&nbsp;<span class="op" id="7473751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473755">io</span><span class="op" id="7473757">.</span><span class="ident" id="7473758">Copy</span><span class="op" id="7473762">(</span><span class="ident" id="7473763">ioutil</span><span class="op" id="7473769">.</span><span class="ident" id="7473770">Discard</span><span class="op" id="7473777">,</span>&nbsp;<span class="ident" id="7473779">NewReader</span><span class="op" id="7473788">(</span><span class="ident" id="7473789">bytes</span><span class="op" id="7473794">.</span><span class="ident" id="7473795">NewReader</span><span class="op" id="7473804">(</span><span class="ident" id="7473805">buf1</span><span class="op" id="7473809">)</span><span class="op" id="7473810">,</span>&nbsp;<span class="ident" id="7473812">LSB</span><span class="op" id="7473815">,</span>&nbsp;<span class="num" id="7473817">8</span><span class="op" id="7473818">)</span><span class="op" id="7473819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7473822">}</span><br>
<span class="lineno">140</span><span class="op" id="7473824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7473827">func</span>&nbsp;<span class="ident" id="7473832">BenchmarkDecoder1e4</span><span class="op" id="7473851">(</span><span class="ident" id="7473852">b</span>&nbsp;<span class="op" id="7473854">*</span><span class="ident" id="7473855">testing</span><span class="op" id="7473862">.</span><span class="ident" id="7473863">B</span><span class="op" id="7473864">)</span>&nbsp;<span class="op" id="7473866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473869">benchmarkDecoder</span><span class="op" id="7473885">(</span><span class="ident" id="7473886">b</span><span class="op" id="7473887">,</span>&nbsp;<span class="num" id="7473889">1e4</span><span class="op" id="7473892">)</span><br>
<span class="lineno"></span><span class="op" id="7473894">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7473897">func</span>&nbsp;<span class="ident" id="7473902">BenchmarkDecoder1e5</span><span class="op" id="7473921">(</span><span class="ident" id="7473922">b</span>&nbsp;<span class="op" id="7473924">*</span><span class="ident" id="7473925">testing</span><span class="op" id="7473932">.</span><span class="ident" id="7473933">B</span><span class="op" id="7473934">)</span>&nbsp;<span class="op" id="7473936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7473939">benchmarkDecoder</span><span class="op" id="7473955">(</span><span class="ident" id="7473956">b</span><span class="op" id="7473957">,</span>&nbsp;<span class="num" id="7473959">1e5</span><span class="op" id="7473962">)</span><br>
<span class="lineno"></span><span class="op" id="7473964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="keyword" id="7473967">func</span>&nbsp;<span class="ident" id="7473972">BenchmarkDecoder1e6</span><span class="op" id="7473991">(</span><span class="ident" id="7473992">b</span>&nbsp;<span class="op" id="7473994">*</span><span class="ident" id="7473995">testing</span><span class="op" id="7474002">.</span><span class="ident" id="7474003">B</span><span class="op" id="7474004">)</span>&nbsp;<span class="op" id="7474006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7474009">benchmarkDecoder</span><span class="op" id="7474025">(</span><span class="ident" id="7474026">b</span><span class="op" id="7474027">,</span>&nbsp;<span class="num" id="7474029">1e6</span><span class="op" id="7474032">)</span><br>
<span class="lineno"></span><span class="op" id="7474034">}</span>
</div>
</body>
</html>
