<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4581092">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4581147">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4581201">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4581252">package</span>&nbsp;<span class="ident" id="4581260">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4581267">import</span>&nbsp;<span class="op" id="4581274">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581277">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581285">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4581292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4581295">type</span>&nbsp;<span class="ident" id="4581300">huffmanEncoder</span>&nbsp;<span class="keyword" id="4581315">struct</span>&nbsp;<span class="op" id="4581322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581325">codeBits</span>&nbsp;<span class="op" id="4581334">[</span><span class="op" id="4581335">]</span><span class="builtintype" id="4581336">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581343">code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4581352">[</span><span class="op" id="4581353">]</span><span class="builtintype" id="4581354">uint16</span><br>
<span class="lineno">15</span><span class="op" id="4581361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4581364">type</span>&nbsp;<span class="ident" id="4581369">literalNode</span>&nbsp;<span class="keyword" id="4581381">struct</span>&nbsp;<span class="op" id="4581388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581391">literal</span>&nbsp;<span class="builtintype" id="4581399">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581407">freq</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4581415">int32</span><br>
<span class="lineno">20</span><span class="op" id="4581421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4581424">//&nbsp;A&nbsp;levelInfo&nbsp;describes&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;constructed&nbsp;tree&nbsp;for&nbsp;a&nbsp;given&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="4581502">type</span>&nbsp;<span class="ident" id="4581507">levelInfo</span>&nbsp;<span class="keyword" id="4581517">struct</span>&nbsp;<span class="op" id="4581524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581527">//&nbsp;Our&nbsp;level.&nbsp;&nbsp;for&nbsp;better&nbsp;printing</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581563">level</span>&nbsp;<span class="builtintype" id="4581569">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581577">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;last&nbsp;node&nbsp;at&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581626">lastFreq</span>&nbsp;<span class="builtintype" id="4581635">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581643">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;character&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581704">nextCharFreq</span>&nbsp;<span class="builtintype" id="4581717">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581725">//&nbsp;The&nbsp;frequency&nbsp;of&nbsp;the&nbsp;next&nbsp;pair&nbsp;(from&nbsp;level&nbsp;below)&nbsp;to&nbsp;add&nbsp;to&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581801">//&nbsp;Only&nbsp;valid&nbsp;if&nbsp;the&nbsp;&#34;needed&#34;&nbsp;value&nbsp;of&nbsp;the&nbsp;next&nbsp;lower&nbsp;level&nbsp;is&nbsp;0.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581868">nextPairFreq</span>&nbsp;<span class="builtintype" id="4581881">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581889">//&nbsp;The&nbsp;number&nbsp;of&nbsp;chains&nbsp;remaining&nbsp;to&nbsp;generate&nbsp;for&nbsp;this&nbsp;level&nbsp;before&nbsp;moving</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581965">//&nbsp;up&nbsp;to&nbsp;the&nbsp;next&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581990">needed</span>&nbsp;<span class="builtintype" id="4581997">int32</span><br>
<span class="lineno">40</span><span class="op" id="4582003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4582006">func</span>&nbsp;<span class="ident" id="4582011">maxNode</span><span class="op" id="4582018">(</span><span class="op" id="4582019">)</span>&nbsp;<span class="ident" id="4582021">literalNode</span>&nbsp;<span class="op" id="4582033">{</span>&nbsp;<span class="keyword" id="4582035">return</span>&nbsp;<span class="ident" id="4582042">literalNode</span><span class="op" id="4582053">{</span><span class="ident" id="4582054">math</span><span class="op" id="4582058">.</span><span class="ident" id="4582059">MaxUint16</span><span class="op" id="4582068">,</span>&nbsp;<span class="ident" id="4582070">math</span><span class="op" id="4582074">.</span><span class="ident" id="4582075">MaxInt32</span><span class="op" id="4582083">}</span>&nbsp;<span class="op" id="4582085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4582088">func</span>&nbsp;<span class="ident" id="4582093">newHuffmanEncoder</span><span class="op" id="4582110">(</span><span class="ident" id="4582111">size</span>&nbsp;<span class="builtintype" id="4582116">int</span><span class="op" id="4582119">)</span>&nbsp;<span class="op" id="4582121">*</span><span class="ident" id="4582122">huffmanEncoder</span>&nbsp;<span class="op" id="4582137">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582140">return</span>&nbsp;<span class="op" id="4582147">&amp;</span><span class="ident" id="4582148">huffmanEncoder</span><span class="op" id="4582162">{</span><span class="builtinfunc" id="4582163">make</span><span class="op" id="4582167">(</span><span class="op" id="4582168">[</span><span class="op" id="4582169">]</span><span class="builtintype" id="4582170">uint8</span><span class="op" id="4582175">,</span>&nbsp;<span class="ident" id="4582177">size</span><span class="op" id="4582181">)</span><span class="op" id="4582182">,</span>&nbsp;<span class="builtinfunc" id="4582184">make</span><span class="op" id="4582188">(</span><span class="op" id="4582189">[</span><span class="op" id="4582190">]</span><span class="builtintype" id="4582191">uint16</span><span class="op" id="4582197">,</span>&nbsp;<span class="ident" id="4582199">size</span><span class="op" id="4582203">)</span><span class="op" id="4582204">}</span><br>
<span class="lineno"></span><span class="op" id="4582206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4582209">//&nbsp;Generates&nbsp;a&nbsp;HuffmanCode&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;fixed&nbsp;literal&nbsp;table</span><br>
<span class="lineno"></span><span class="keyword" id="4582277">func</span>&nbsp;<span class="ident" id="4582282">generateFixedLiteralEncoding</span><span class="op" id="4582310">(</span><span class="op" id="4582311">)</span>&nbsp;<span class="op" id="4582313">*</span><span class="ident" id="4582314">huffmanEncoder</span>&nbsp;<span class="op" id="4582329">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582332">h</span>&nbsp;<span class="op" id="4582334">:=</span>&nbsp;<span class="ident" id="4582337">newHuffmanEncoder</span><span class="op" id="4582354">(</span><span class="ident" id="4582355">maxLit</span><span class="op" id="4582361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582364">codeBits</span>&nbsp;<span class="op" id="4582373">:=</span>&nbsp;<span class="ident" id="4582376">h</span><span class="op" id="4582377">.</span><span class="ident" id="4582378">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582388">code</span>&nbsp;<span class="op" id="4582393">:=</span>&nbsp;<span class="ident" id="4582396">h</span><span class="op" id="4582397">.</span><span class="ident" id="4582398">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582404">var</span>&nbsp;<span class="ident" id="4582408">ch</span>&nbsp;<span class="builtintype" id="4582411">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582419">for</span>&nbsp;<span class="ident" id="4582423">ch</span>&nbsp;<span class="op" id="4582426">=</span>&nbsp;<span class="num" id="4582428">0</span><span class="op" id="4582429">;</span>&nbsp;<span class="ident" id="4582431">ch</span>&nbsp;<span class="op" id="4582434">&lt;</span>&nbsp;<span class="ident" id="4582436">maxLit</span><span class="op" id="4582442">;</span>&nbsp;<span class="ident" id="4582444">ch</span><span class="op" id="4582446">++</span>&nbsp;<span class="op" id="4582449">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582453">var</span>&nbsp;<span class="ident" id="4582457">bits</span>&nbsp;<span class="builtintype" id="4582462">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582471">var</span>&nbsp;<span class="ident" id="4582475">size</span>&nbsp;<span class="builtintype" id="4582480">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582488">switch</span>&nbsp;<span class="op" id="4582495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582499">case</span>&nbsp;<span class="ident" id="4582504">ch</span>&nbsp;<span class="op" id="4582507">&lt;</span>&nbsp;<span class="num" id="4582509">144</span><span class="op" id="4582512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4582517">//&nbsp;size&nbsp;8,&nbsp;000110000&nbsp;&nbsp;..&nbsp;10111111</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582554">bits</span>&nbsp;<span class="op" id="4582559">=</span>&nbsp;<span class="ident" id="4582561">ch</span>&nbsp;<span class="op" id="4582564">+</span>&nbsp;<span class="num" id="4582566">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582572">size</span>&nbsp;<span class="op" id="4582577">=</span>&nbsp;<span class="num" id="4582579">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582584">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582592">case</span>&nbsp;<span class="ident" id="4582597">ch</span>&nbsp;<span class="op" id="4582600">&lt;</span>&nbsp;<span class="num" id="4582602">256</span><span class="op" id="4582605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4582610">//&nbsp;size&nbsp;9,&nbsp;110010000&nbsp;..&nbsp;111111111</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582647">bits</span>&nbsp;<span class="op" id="4582652">=</span>&nbsp;<span class="ident" id="4582654">ch</span>&nbsp;<span class="op" id="4582657">+</span>&nbsp;<span class="num" id="4582659">400</span>&nbsp;<span class="op" id="4582663">-</span>&nbsp;<span class="num" id="4582665">144</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582672">size</span>&nbsp;<span class="op" id="4582677">=</span>&nbsp;<span class="num" id="4582679">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582684">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582692">case</span>&nbsp;<span class="ident" id="4582697">ch</span>&nbsp;<span class="op" id="4582700">&lt;</span>&nbsp;<span class="num" id="4582702">280</span><span class="op" id="4582705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4582710">//&nbsp;size&nbsp;7,&nbsp;0000000&nbsp;..&nbsp;0010111</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582743">bits</span>&nbsp;<span class="op" id="4582748">=</span>&nbsp;<span class="ident" id="4582750">ch</span>&nbsp;<span class="op" id="4582753">-</span>&nbsp;<span class="num" id="4582755">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582762">size</span>&nbsp;<span class="op" id="4582767">=</span>&nbsp;<span class="num" id="4582769">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582774">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582782">default</span><span class="op" id="4582789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4582794">//&nbsp;size&nbsp;8,&nbsp;11000000&nbsp;..&nbsp;11000111</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582829">bits</span>&nbsp;<span class="op" id="4582834">=</span>&nbsp;<span class="ident" id="4582836">ch</span>&nbsp;<span class="op" id="4582839">+</span>&nbsp;<span class="num" id="4582841">192</span>&nbsp;<span class="op" id="4582845">-</span>&nbsp;<span class="num" id="4582847">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582854">size</span>&nbsp;<span class="op" id="4582859">=</span>&nbsp;<span class="num" id="4582861">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4582865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582869">codeBits</span><span class="op" id="4582877">[</span><span class="ident" id="4582878">ch</span><span class="op" id="4582880">]</span>&nbsp;<span class="op" id="4582882">=</span>&nbsp;<span class="ident" id="4582884">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582891">code</span><span class="op" id="4582895">[</span><span class="ident" id="4582896">ch</span><span class="op" id="4582898">]</span>&nbsp;<span class="op" id="4582900">=</span>&nbsp;<span class="ident" id="4582902">reverseBits</span><span class="op" id="4582913">(</span><span class="ident" id="4582914">bits</span><span class="op" id="4582918">,</span>&nbsp;<span class="ident" id="4582920">size</span><span class="op" id="4582924">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4582927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4582930">return</span>&nbsp;<span class="ident" id="4582937">h</span><br>
<span class="lineno"></span><span class="op" id="4582939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4582942">func</span>&nbsp;<span class="ident" id="4582947">generateFixedOffsetEncoding</span><span class="op" id="4582974">(</span><span class="op" id="4582975">)</span>&nbsp;<span class="op" id="4582977">*</span><span class="ident" id="4582978">huffmanEncoder</span>&nbsp;<span class="op" id="4582993">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4582996">h</span>&nbsp;<span class="op" id="4582998">:=</span>&nbsp;<span class="ident" id="4583001">newHuffmanEncoder</span><span class="op" id="4583018">(</span><span class="num" id="4583019">30</span><span class="op" id="4583021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4583024">codeBits</span>&nbsp;<span class="op" id="4583033">:=</span>&nbsp;<span class="ident" id="4583036">h</span><span class="op" id="4583037">.</span><span class="ident" id="4583038">codeBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4583048">code</span>&nbsp;<span class="op" id="4583053">:=</span>&nbsp;<span class="ident" id="4583056">h</span><span class="op" id="4583057">.</span><span class="ident" id="4583058">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583064">for</span>&nbsp;<span class="ident" id="4583068">ch</span>&nbsp;<span class="op" id="4583071">:=</span>&nbsp;<span class="builtintype" id="4583074">uint16</span><span class="op" id="4583080">(</span><span class="num" id="4583081">0</span><span class="op" id="4583082">)</span><span class="op" id="4583083">;</span>&nbsp;<span class="ident" id="4583085">ch</span>&nbsp;<span class="op" id="4583088">&lt;</span>&nbsp;<span class="num" id="4583090">30</span><span class="op" id="4583092">;</span>&nbsp;<span class="ident" id="4583094">ch</span><span class="op" id="4583096">++</span>&nbsp;<span class="op" id="4583099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4583103">codeBits</span><span class="op" id="4583111">[</span><span class="ident" id="4583112">ch</span><span class="op" id="4583114">]</span>&nbsp;<span class="op" id="4583116">=</span>&nbsp;<span class="num" id="4583118">5</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4583122">code</span><span class="op" id="4583126">[</span><span class="ident" id="4583127">ch</span><span class="op" id="4583129">]</span>&nbsp;<span class="op" id="4583131">=</span>&nbsp;<span class="ident" id="4583133">reverseBits</span><span class="op" id="4583144">(</span><span class="ident" id="4583145">ch</span><span class="op" id="4583147">,</span>&nbsp;<span class="num" id="4583149">5</span><span class="op" id="4583150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4583153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583156">return</span>&nbsp;<span class="ident" id="4583163">h</span><br>
<span class="lineno"></span><span class="op" id="4583165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4583168">var</span>&nbsp;<span class="ident" id="4583172">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4583193">*</span><span class="ident" id="4583194">huffmanEncoder</span>&nbsp;<span class="op" id="4583209">=</span>&nbsp;<span class="ident" id="4583211">generateFixedLiteralEncoding</span><span class="op" id="4583239">(</span><span class="op" id="4583240">)</span><br>
<span class="lineno"></span><span class="keyword" id="4583242">var</span>&nbsp;<span class="ident" id="4583246">fixedOffsetEncoding</span>&nbsp;<span class="op" id="4583266">*</span><span class="ident" id="4583267">huffmanEncoder</span>&nbsp;<span class="op" id="4583282">=</span>&nbsp;<span class="ident" id="4583284">generateFixedOffsetEncoding</span><span class="op" id="4583311">(</span><span class="op" id="4583312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4583315">func</span>&nbsp;<span class="op" id="4583320">(</span><span class="ident" id="4583321">h</span>&nbsp;<span class="op" id="4583323">*</span><span class="ident" id="4583324">huffmanEncoder</span><span class="op" id="4583338">)</span>&nbsp;<span class="ident" id="4583340">bitLength</span><span class="op" id="4583349">(</span><span class="ident" id="4583350">freq</span>&nbsp;<span class="op" id="4583355">[</span><span class="op" id="4583356">]</span><span class="builtintype" id="4583357">int32</span><span class="op" id="4583362">)</span>&nbsp;<span class="ident" id="4583364">int64</span>&nbsp;<span class="op" id="4583370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583373">var</span>&nbsp;<span class="ident" id="4583377">total</span>&nbsp;<span class="ident" id="4583383">int64</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583390">for</span>&nbsp;<span class="ident" id="4583394">i</span><span class="op" id="4583395">,</span>&nbsp;<span class="ident" id="4583397">f</span>&nbsp;<span class="op" id="4583399">:=</span>&nbsp;<span class="keyword" id="4583402">range</span>&nbsp;<span class="ident" id="4583408">freq</span>&nbsp;<span class="op" id="4583413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583417">if</span>&nbsp;<span class="ident" id="4583420">f</span>&nbsp;<span class="op" id="4583422">!=</span>&nbsp;<span class="num" id="4583425">0</span>&nbsp;<span class="op" id="4583427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4583432">total</span>&nbsp;<span class="op" id="4583438">+=</span>&nbsp;<span class="ident" id="4583441">int64</span><span class="op" id="4583446">(</span><span class="ident" id="4583447">f</span><span class="op" id="4583448">)</span>&nbsp;<span class="op" id="4583450">*</span>&nbsp;<span class="ident" id="4583452">int64</span><span class="op" id="4583457">(</span><span class="ident" id="4583458">h</span><span class="op" id="4583459">.</span><span class="ident" id="4583460">codeBits</span><span class="op" id="4583468">[</span><span class="ident" id="4583469">i</span><span class="op" id="4583470">]</span><span class="op" id="4583471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4583475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4583478">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4583481">return</span>&nbsp;<span class="ident" id="4583488">total</span><br>
<span class="lineno"></span><span class="op" id="4583494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4583497">const</span>&nbsp;<span class="ident" id="4583503">maxBitsLimit</span>&nbsp;<span class="op" id="4583516">=</span>&nbsp;<span class="num" id="4583518">16</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="4583522">//&nbsp;Return&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;assigned&nbsp;to&nbsp;each&nbsp;bit&nbsp;size&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="4583605">//</span><br>
<span class="lineno"></span><span class="comment" id="4583608">//&nbsp;This&nbsp;method&nbsp;is&nbsp;only&nbsp;called&nbsp;when&nbsp;list.length&nbsp;&gt;=&nbsp;3</span><br>
<span class="lineno"></span><span class="comment" id="4583660">//&nbsp;The&nbsp;cases&nbsp;of&nbsp;0,&nbsp;1,&nbsp;and&nbsp;2&nbsp;literals&nbsp;are&nbsp;handled&nbsp;by&nbsp;special&nbsp;case&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4583731">//</span><br>
<span class="lineno">115</span><span class="comment" id="4583734">//&nbsp;list&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;the&nbsp;literals&nbsp;with&nbsp;non-zero&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4583794">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;their&nbsp;associated&nbsp;frequencies.&nbsp;&nbsp;The&nbsp;array&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing</span><br>
<span class="lineno"></span><span class="comment" id="4583880">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frequency,&nbsp;and&nbsp;has&nbsp;as&nbsp;its&nbsp;last&nbsp;element&nbsp;a&nbsp;special&nbsp;element&nbsp;with&nbsp;frequency</span><br>
<span class="lineno"></span><span class="comment" id="4583967">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MaxInt32</span><br>
<span class="lineno"></span><span class="comment" id="4583991">//&nbsp;maxBits&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;that&nbsp;should&nbsp;be&nbsp;used&nbsp;to&nbsp;encode&nbsp;any&nbsp;literal.</span><br>
<span class="lineno">120</span><span class="comment" id="4584076">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Must&nbsp;be&nbsp;less&nbsp;than&nbsp;16.</span><br>
<span class="lineno"></span><span class="comment" id="4584113">//&nbsp;return&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;An&nbsp;integer&nbsp;array&nbsp;in&nbsp;which&nbsp;array[i]&nbsp;indicates&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span><span class="comment" id="4584196">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;should&nbsp;be&nbsp;encoded&nbsp;in&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4584245">func</span>&nbsp;<span class="op" id="4584250">(</span><span class="ident" id="4584251">h</span>&nbsp;<span class="op" id="4584253">*</span><span class="ident" id="4584254">huffmanEncoder</span><span class="op" id="4584268">)</span>&nbsp;<span class="ident" id="4584270">bitCounts</span><span class="op" id="4584279">(</span><span class="ident" id="4584280">list</span>&nbsp;<span class="op" id="4584285">[</span><span class="op" id="4584286">]</span><span class="ident" id="4584287">literalNode</span><span class="op" id="4584298">,</span>&nbsp;<span class="ident" id="4584300">maxBits</span>&nbsp;<span class="builtintype" id="4584308">int32</span><span class="op" id="4584313">)</span>&nbsp;<span class="op" id="4584315">[</span><span class="op" id="4584316">]</span><span class="builtintype" id="4584317">int32</span>&nbsp;<span class="op" id="4584323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584326">if</span>&nbsp;<span class="ident" id="4584329">maxBits</span>&nbsp;<span class="op" id="4584337">&gt;=</span>&nbsp;<span class="ident" id="4584340">maxBitsLimit</span>&nbsp;<span class="op" id="4584353">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4584357">panic</span><span class="op" id="4584362">(</span><span class="string" id="4584363">&#34;flate:&nbsp;maxBits&nbsp;too&nbsp;large&#34;</span><span class="op" id="4584389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584395">n</span>&nbsp;<span class="op" id="4584397">:=</span>&nbsp;<span class="builtintype" id="4584400">int32</span><span class="op" id="4584405">(</span><span class="builtinfunc" id="4584406">len</span><span class="op" id="4584409">(</span><span class="ident" id="4584410">list</span><span class="op" id="4584414">)</span><span class="op" id="4584415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584418">list</span>&nbsp;<span class="op" id="4584423">=</span>&nbsp;<span class="ident" id="4584425">list</span><span class="op" id="4584429">[</span><span class="num" id="4584430">0</span>&nbsp;<span class="op" id="4584432">:</span>&nbsp;<span class="ident" id="4584434">n</span><span class="op" id="4584435">+</span><span class="num" id="4584436">1</span><span class="op" id="4584437">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584440">list</span><span class="op" id="4584444">[</span><span class="ident" id="4584445">n</span><span class="op" id="4584446">]</span>&nbsp;<span class="op" id="4584448">=</span>&nbsp;<span class="ident" id="4584450">maxNode</span><span class="op" id="4584457">(</span><span class="op" id="4584458">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584462">//&nbsp;The&nbsp;tree&nbsp;can&#39;t&nbsp;have&nbsp;greater&nbsp;depth&nbsp;than&nbsp;n&nbsp;-&nbsp;1,&nbsp;no&nbsp;matter&nbsp;what.&nbsp;&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584534">//&nbsp;saves&nbsp;a&nbsp;little&nbsp;bit&nbsp;of&nbsp;work&nbsp;in&nbsp;some&nbsp;small&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584585">if</span>&nbsp;<span class="ident" id="4584588">maxBits</span>&nbsp;<span class="op" id="4584596">&gt;</span>&nbsp;<span class="ident" id="4584598">n</span><span class="op" id="4584599">-</span><span class="num" id="4584600">1</span>&nbsp;<span class="op" id="4584602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584606">maxBits</span>&nbsp;<span class="op" id="4584614">=</span>&nbsp;<span class="ident" id="4584616">n</span>&nbsp;<span class="op" id="4584618">-</span>&nbsp;<span class="num" id="4584620">1</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584627">//&nbsp;Create&nbsp;information&nbsp;about&nbsp;each&nbsp;of&nbsp;the&nbsp;levels.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584676">//&nbsp;A&nbsp;bogus&nbsp;&#34;Level&nbsp;0&#34;&nbsp;whose&nbsp;sole&nbsp;purpose&nbsp;is&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584728">//&nbsp;level1.prev.needed==0.&nbsp;&nbsp;This&nbsp;makes&nbsp;level1.nextPairFreq</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584787">//&nbsp;be&nbsp;a&nbsp;legitimate&nbsp;value&nbsp;that&nbsp;never&nbsp;gets&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584837">var</span>&nbsp;<span class="ident" id="4584841">levels</span>&nbsp;<span class="op" id="4584848">[</span><span class="ident" id="4584849">maxBitsLimit</span><span class="op" id="4584861">]</span><span class="ident" id="4584862">levelInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584873">//&nbsp;leafCounts[i]&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584933">//&nbsp;of&nbsp;ancestors&nbsp;of&nbsp;the&nbsp;rightmost&nbsp;node&nbsp;at&nbsp;level&nbsp;i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584984">//&nbsp;leafCounts[i][j]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;at&nbsp;the&nbsp;left</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585043">//&nbsp;of&nbsp;the&nbsp;level&nbsp;j&nbsp;ancestor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585072">var</span>&nbsp;<span class="ident" id="4585076">leafCounts</span>&nbsp;<span class="op" id="4585087">[</span><span class="ident" id="4585088">maxBitsLimit</span><span class="op" id="4585100">]</span><span class="op" id="4585101">[</span><span class="ident" id="4585102">maxBitsLimit</span><span class="op" id="4585114">]</span><span class="builtintype" id="4585115">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585123">for</span>&nbsp;<span class="ident" id="4585127">level</span>&nbsp;<span class="op" id="4585133">:=</span>&nbsp;<span class="builtintype" id="4585136">int32</span><span class="op" id="4585141">(</span><span class="num" id="4585142">1</span><span class="op" id="4585143">)</span><span class="op" id="4585144">;</span>&nbsp;<span class="ident" id="4585146">level</span>&nbsp;<span class="op" id="4585152">&lt;=</span>&nbsp;<span class="ident" id="4585155">maxBits</span><span class="op" id="4585162">;</span>&nbsp;<span class="ident" id="4585164">level</span><span class="op" id="4585169">++</span>&nbsp;<span class="op" id="4585172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585176">//&nbsp;For&nbsp;every&nbsp;level,&nbsp;the&nbsp;first&nbsp;two&nbsp;items&nbsp;are&nbsp;the&nbsp;first&nbsp;two&nbsp;characters.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585248">//&nbsp;We&nbsp;initialize&nbsp;the&nbsp;levels&nbsp;as&nbsp;if&nbsp;we&nbsp;had&nbsp;already&nbsp;figured&nbsp;this&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585317">levels</span><span class="op" id="4585323">[</span><span class="ident" id="4585324">level</span><span class="op" id="4585329">]</span>&nbsp;<span class="op" id="4585331">=</span>&nbsp;<span class="ident" id="4585333">levelInfo</span><span class="op" id="4585342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585347">level</span><span class="op" id="4585352">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585361">level</span><span class="op" id="4585366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585371">lastFreq</span><span class="op" id="4585379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585385">list</span><span class="op" id="4585389">[</span><span class="num" id="4585390">1</span><span class="op" id="4585391">]</span><span class="op" id="4585392">.</span><span class="ident" id="4585393">freq</span><span class="op" id="4585397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585402">nextCharFreq</span><span class="op" id="4585414">:</span>&nbsp;<span class="ident" id="4585416">list</span><span class="op" id="4585420">[</span><span class="num" id="4585421">2</span><span class="op" id="4585422">]</span><span class="op" id="4585423">.</span><span class="ident" id="4585424">freq</span><span class="op" id="4585428">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585433">nextPairFreq</span><span class="op" id="4585445">:</span>&nbsp;<span class="ident" id="4585447">list</span><span class="op" id="4585451">[</span><span class="num" id="4585452">0</span><span class="op" id="4585453">]</span><span class="op" id="4585454">.</span><span class="ident" id="4585455">freq</span>&nbsp;<span class="op" id="4585460">+</span>&nbsp;<span class="ident" id="4585462">list</span><span class="op" id="4585466">[</span><span class="num" id="4585467">1</span><span class="op" id="4585468">]</span><span class="op" id="4585469">.</span><span class="ident" id="4585470">freq</span><span class="op" id="4585474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585482">leafCounts</span><span class="op" id="4585492">[</span><span class="ident" id="4585493">level</span><span class="op" id="4585498">]</span><span class="op" id="4585499">[</span><span class="ident" id="4585500">level</span><span class="op" id="4585505">]</span>&nbsp;<span class="op" id="4585507">=</span>&nbsp;<span class="num" id="4585509">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585513">if</span>&nbsp;<span class="ident" id="4585516">level</span>&nbsp;<span class="op" id="4585522">==</span>&nbsp;<span class="num" id="4585525">1</span>&nbsp;<span class="op" id="4585527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585532">levels</span><span class="op" id="4585538">[</span><span class="ident" id="4585539">level</span><span class="op" id="4585544">]</span><span class="op" id="4585545">.</span><span class="ident" id="4585546">nextPairFreq</span>&nbsp;<span class="op" id="4585559">=</span>&nbsp;<span class="ident" id="4585561">math</span><span class="op" id="4585565">.</span><span class="ident" id="4585566">MaxInt32</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585584">//&nbsp;We&nbsp;need&nbsp;a&nbsp;total&nbsp;of&nbsp;2*n&nbsp;-&nbsp;2&nbsp;items&nbsp;at&nbsp;top&nbsp;level&nbsp;and&nbsp;have&nbsp;already&nbsp;generated&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585664">levels</span><span class="op" id="4585670">[</span><span class="ident" id="4585671">maxBits</span><span class="op" id="4585678">]</span><span class="op" id="4585679">.</span><span class="ident" id="4585680">needed</span>&nbsp;<span class="op" id="4585687">=</span>&nbsp;<span class="num" id="4585689">2</span><span class="op" id="4585690">*</span><span class="ident" id="4585691">n</span>&nbsp;<span class="op" id="4585693">-</span>&nbsp;<span class="num" id="4585695">4</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585699">level</span>&nbsp;<span class="op" id="4585705">:=</span>&nbsp;<span class="ident" id="4585708">maxBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585717">for</span>&nbsp;<span class="op" id="4585721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585725">l</span>&nbsp;<span class="op" id="4585727">:=</span>&nbsp;<span class="op" id="4585730">&amp;</span><span class="ident" id="4585731">levels</span><span class="op" id="4585737">[</span><span class="ident" id="4585738">level</span><span class="op" id="4585743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585747">if</span>&nbsp;<span class="ident" id="4585750">l</span><span class="op" id="4585751">.</span><span class="ident" id="4585752">nextPairFreq</span>&nbsp;<span class="op" id="4585765">==</span>&nbsp;<span class="ident" id="4585768">math</span><span class="op" id="4585772">.</span><span class="ident" id="4585773">MaxInt32</span>&nbsp;<span class="op" id="4585782">&amp;&amp;</span>&nbsp;<span class="ident" id="4585785">l</span><span class="op" id="4585786">.</span><span class="ident" id="4585787">nextCharFreq</span>&nbsp;<span class="op" id="4585800">==</span>&nbsp;<span class="ident" id="4585803">math</span><span class="op" id="4585807">.</span><span class="ident" id="4585808">MaxInt32</span>&nbsp;<span class="op" id="4585817">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585822">//&nbsp;We&#39;ve&nbsp;run&nbsp;out&nbsp;of&nbsp;both&nbsp;leafs&nbsp;and&nbsp;pairs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585867">//&nbsp;End&nbsp;all&nbsp;calculations&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585910">//&nbsp;To&nbsp;make&nbsp;sure&nbsp;we&nbsp;never&nbsp;come&nbsp;back&nbsp;to&nbsp;this&nbsp;level&nbsp;or&nbsp;any&nbsp;lower&nbsp;level,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585982">//&nbsp;set&nbsp;nextPairFreq&nbsp;impossibly&nbsp;large.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586023">l</span><span class="op" id="4586024">.</span><span class="ident" id="4586025">needed</span>&nbsp;<span class="op" id="4586032">=</span>&nbsp;<span class="num" id="4586034">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586039">levels</span><span class="op" id="4586045">[</span><span class="ident" id="4586046">level</span><span class="op" id="4586051">+</span><span class="num" id="4586052">1</span><span class="op" id="4586053">]</span><span class="op" id="4586054">.</span><span class="ident" id="4586055">nextPairFreq</span>&nbsp;<span class="op" id="4586068">=</span>&nbsp;<span class="ident" id="4586070">math</span><span class="op" id="4586074">.</span><span class="ident" id="4586075">MaxInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586087">level</span><span class="op" id="4586092">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586114">prevFreq</span>&nbsp;<span class="op" id="4586123">:=</span>&nbsp;<span class="ident" id="4586126">l</span><span class="op" id="4586127">.</span><span class="ident" id="4586128">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586139">if</span>&nbsp;<span class="ident" id="4586142">l</span><span class="op" id="4586143">.</span><span class="ident" id="4586144">nextCharFreq</span>&nbsp;<span class="op" id="4586157">&lt;</span>&nbsp;<span class="ident" id="4586159">l</span><span class="op" id="4586160">.</span><span class="ident" id="4586161">nextPairFreq</span>&nbsp;<span class="op" id="4586174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586179">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;leaf&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586227">n</span>&nbsp;<span class="op" id="4586229">:=</span>&nbsp;<span class="ident" id="4586232">leafCounts</span><span class="op" id="4586242">[</span><span class="ident" id="4586243">level</span><span class="op" id="4586248">]</span><span class="op" id="4586249">[</span><span class="ident" id="4586250">level</span><span class="op" id="4586255">]</span>&nbsp;<span class="op" id="4586257">+</span>&nbsp;<span class="num" id="4586259">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586264">l</span><span class="op" id="4586265">.</span><span class="ident" id="4586266">lastFreq</span>&nbsp;<span class="op" id="4586275">=</span>&nbsp;<span class="ident" id="4586277">l</span><span class="op" id="4586278">.</span><span class="ident" id="4586279">nextCharFreq</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586295">//&nbsp;Lower&nbsp;leafCounts&nbsp;are&nbsp;the&nbsp;same&nbsp;of&nbsp;the&nbsp;previous&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586353">leafCounts</span><span class="op" id="4586363">[</span><span class="ident" id="4586364">level</span><span class="op" id="4586369">]</span><span class="op" id="4586370">[</span><span class="ident" id="4586371">level</span><span class="op" id="4586376">]</span>&nbsp;<span class="op" id="4586378">=</span>&nbsp;<span class="ident" id="4586380">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586385">l</span><span class="op" id="4586386">.</span><span class="ident" id="4586387">nextCharFreq</span>&nbsp;<span class="op" id="4586400">=</span>&nbsp;<span class="ident" id="4586402">list</span><span class="op" id="4586406">[</span><span class="ident" id="4586407">n</span><span class="op" id="4586408">]</span><span class="op" id="4586409">.</span><span class="ident" id="4586410">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586417">}</span>&nbsp;<span class="keyword" id="4586419">else</span>&nbsp;<span class="op" id="4586424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586429">//&nbsp;The&nbsp;next&nbsp;item&nbsp;on&nbsp;this&nbsp;row&nbsp;is&nbsp;a&nbsp;pair&nbsp;from&nbsp;the&nbsp;previous&nbsp;row.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586494">//&nbsp;nextPairFreq&nbsp;isn&#39;t&nbsp;valid&nbsp;until&nbsp;we&nbsp;generate&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586547">//&nbsp;more&nbsp;values&nbsp;in&nbsp;the&nbsp;level&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586584">l</span><span class="op" id="4586585">.</span><span class="ident" id="4586586">lastFreq</span>&nbsp;<span class="op" id="4586595">=</span>&nbsp;<span class="ident" id="4586597">l</span><span class="op" id="4586598">.</span><span class="ident" id="4586599">nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586615">//&nbsp;Take&nbsp;leaf&nbsp;counts&nbsp;from&nbsp;the&nbsp;lower&nbsp;level,&nbsp;except&nbsp;counts[level]&nbsp;remains&nbsp;the&nbsp;same.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4586699">copy</span><span class="op" id="4586703">(</span><span class="ident" id="4586704">leafCounts</span><span class="op" id="4586714">[</span><span class="ident" id="4586715">level</span><span class="op" id="4586720">]</span><span class="op" id="4586721">[</span><span class="op" id="4586722">:</span><span class="ident" id="4586723">level</span><span class="op" id="4586728">]</span><span class="op" id="4586729">,</span>&nbsp;<span class="ident" id="4586731">leafCounts</span><span class="op" id="4586741">[</span><span class="ident" id="4586742">level</span><span class="op" id="4586747">-</span><span class="num" id="4586748">1</span><span class="op" id="4586749">]</span><span class="op" id="4586750">[</span><span class="op" id="4586751">:</span><span class="ident" id="4586752">level</span><span class="op" id="4586757">]</span><span class="op" id="4586758">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586763">levels</span><span class="op" id="4586769">[</span><span class="ident" id="4586770">l</span><span class="op" id="4586771">.</span><span class="ident" id="4586772">level</span><span class="op" id="4586777">-</span><span class="num" id="4586778">1</span><span class="op" id="4586779">]</span><span class="op" id="4586780">.</span><span class="ident" id="4586781">needed</span>&nbsp;<span class="op" id="4586788">=</span>&nbsp;<span class="num" id="4586790">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586799">if</span>&nbsp;<span class="ident" id="4586802">l</span><span class="op" id="4586803">.</span><span class="ident" id="4586804">needed</span><span class="op" id="4586810">--</span><span class="op" id="4586812">;</span>&nbsp;<span class="ident" id="4586814">l</span><span class="op" id="4586815">.</span><span class="ident" id="4586816">needed</span>&nbsp;<span class="op" id="4586823">==</span>&nbsp;<span class="num" id="4586826">0</span>&nbsp;<span class="op" id="4586828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586833">//&nbsp;We&#39;ve&nbsp;done&nbsp;everything&nbsp;we&nbsp;need&nbsp;to&nbsp;do&nbsp;for&nbsp;this&nbsp;level.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586891">//&nbsp;Continue&nbsp;calculating&nbsp;one&nbsp;level&nbsp;up.&nbsp;&nbsp;Fill&nbsp;in&nbsp;nextPairFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586954">//&nbsp;of&nbsp;that&nbsp;level&nbsp;with&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;two&nbsp;nodes&nbsp;we&#39;ve&nbsp;just&nbsp;calculated&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587029">//&nbsp;this&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587047">if</span>&nbsp;<span class="ident" id="4587050">l</span><span class="op" id="4587051">.</span><span class="ident" id="4587052">level</span>&nbsp;<span class="op" id="4587058">==</span>&nbsp;<span class="ident" id="4587061">maxBits</span>&nbsp;<span class="op" id="4587069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587075">//&nbsp;All&nbsp;done!</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587106">levels</span><span class="op" id="4587112">[</span><span class="ident" id="4587113">l</span><span class="op" id="4587114">.</span><span class="ident" id="4587115">level</span><span class="op" id="4587120">+</span><span class="num" id="4587121">1</span><span class="op" id="4587122">]</span><span class="op" id="4587123">.</span><span class="ident" id="4587124">nextPairFreq</span>&nbsp;<span class="op" id="4587137">=</span>&nbsp;<span class="ident" id="4587139">prevFreq</span>&nbsp;<span class="op" id="4587148">+</span>&nbsp;<span class="ident" id="4587150">l</span><span class="op" id="4587151">.</span><span class="ident" id="4587152">lastFreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587164">level</span><span class="op" id="4587169">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587174">}</span>&nbsp;<span class="keyword" id="4587176">else</span>&nbsp;<span class="op" id="4587181">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587186">//&nbsp;If&nbsp;we&nbsp;stole&nbsp;from&nbsp;below,&nbsp;move&nbsp;down&nbsp;temporarily&nbsp;to&nbsp;replenish&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587255">for</span>&nbsp;<span class="ident" id="4587259">levels</span><span class="op" id="4587265">[</span><span class="ident" id="4587266">level</span><span class="op" id="4587271">-</span><span class="num" id="4587272">1</span><span class="op" id="4587273">]</span><span class="op" id="4587274">.</span><span class="ident" id="4587275">needed</span>&nbsp;<span class="op" id="4587282">&gt;</span>&nbsp;<span class="num" id="4587284">0</span>&nbsp;<span class="op" id="4587286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587292">level</span><span class="op" id="4587297">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587307">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587314">//&nbsp;Somethings&nbsp;is&nbsp;wrong&nbsp;if&nbsp;at&nbsp;the&nbsp;end,&nbsp;the&nbsp;top&nbsp;level&nbsp;is&nbsp;null&nbsp;or&nbsp;hasn&#39;t&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587390">//&nbsp;all&nbsp;of&nbsp;the&nbsp;leaves.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587413">if</span>&nbsp;<span class="ident" id="4587416">leafCounts</span><span class="op" id="4587426">[</span><span class="ident" id="4587427">maxBits</span><span class="op" id="4587434">]</span><span class="op" id="4587435">[</span><span class="ident" id="4587436">maxBits</span><span class="op" id="4587443">]</span>&nbsp;<span class="op" id="4587445">!=</span>&nbsp;<span class="ident" id="4587448">n</span>&nbsp;<span class="op" id="4587450">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4587454">panic</span><span class="op" id="4587459">(</span><span class="string" id="4587460">&#34;leafCounts[maxBits][maxBits]&nbsp;!=&nbsp;n&#34;</span><span class="op" id="4587495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587502">bitCount</span>&nbsp;<span class="op" id="4587511">:=</span>&nbsp;<span class="builtinfunc" id="4587514">make</span><span class="op" id="4587518">(</span><span class="op" id="4587519">[</span><span class="op" id="4587520">]</span><span class="builtintype" id="4587521">int32</span><span class="op" id="4587526">,</span>&nbsp;<span class="ident" id="4587528">maxBits</span><span class="op" id="4587535">+</span><span class="num" id="4587536">1</span><span class="op" id="4587537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587540">bits</span>&nbsp;<span class="op" id="4587545">:=</span>&nbsp;<span class="num" id="4587548">1</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587551">counts</span>&nbsp;<span class="op" id="4587558">:=</span>&nbsp;<span class="op" id="4587561">&amp;</span><span class="ident" id="4587562">leafCounts</span><span class="op" id="4587572">[</span><span class="ident" id="4587573">maxBits</span><span class="op" id="4587580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587583">for</span>&nbsp;<span class="ident" id="4587587">level</span>&nbsp;<span class="op" id="4587593">:=</span>&nbsp;<span class="ident" id="4587596">maxBits</span><span class="op" id="4587603">;</span>&nbsp;<span class="ident" id="4587605">level</span>&nbsp;<span class="op" id="4587611">&gt;</span>&nbsp;<span class="num" id="4587613">0</span><span class="op" id="4587614">;</span>&nbsp;<span class="ident" id="4587616">level</span><span class="op" id="4587621">--</span>&nbsp;<span class="op" id="4587624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587628">//&nbsp;chain.leafCount&nbsp;gives&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;requiring&nbsp;at&nbsp;least&nbsp;&#34;bits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4587704">//&nbsp;bits&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587725">bitCount</span><span class="op" id="4587733">[</span><span class="ident" id="4587734">bits</span><span class="op" id="4587738">]</span>&nbsp;<span class="op" id="4587740">=</span>&nbsp;<span class="ident" id="4587742">counts</span><span class="op" id="4587748">[</span><span class="ident" id="4587749">level</span><span class="op" id="4587754">]</span>&nbsp;<span class="op" id="4587756">-</span>&nbsp;<span class="ident" id="4587758">counts</span><span class="op" id="4587764">[</span><span class="ident" id="4587765">level</span><span class="op" id="4587770">-</span><span class="num" id="4587771">1</span><span class="op" id="4587772">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587776">bits</span><span class="op" id="4587780">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4587784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587787">return</span>&nbsp;<span class="ident" id="4587794">bitCount</span><br>
<span class="lineno"></span><span class="op" id="4587803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="4587806">//&nbsp;Look&nbsp;at&nbsp;the&nbsp;leaves&nbsp;and&nbsp;assign&nbsp;them&nbsp;a&nbsp;bit&nbsp;count&nbsp;and&nbsp;an&nbsp;encoding&nbsp;as&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="4587885">//&nbsp;in&nbsp;RFC&nbsp;1951&nbsp;3.2.2</span><br>
<span class="lineno"></span><span class="keyword" id="4587906">func</span>&nbsp;<span class="op" id="4587911">(</span><span class="ident" id="4587912">h</span>&nbsp;<span class="op" id="4587914">*</span><span class="ident" id="4587915">huffmanEncoder</span><span class="op" id="4587929">)</span>&nbsp;<span class="ident" id="4587931">assignEncodingAndSize</span><span class="op" id="4587952">(</span><span class="ident" id="4587953">bitCount</span>&nbsp;<span class="op" id="4587962">[</span><span class="op" id="4587963">]</span><span class="builtintype" id="4587964">int32</span><span class="op" id="4587969">,</span>&nbsp;<span class="ident" id="4587971">list</span>&nbsp;<span class="op" id="4587976">[</span><span class="op" id="4587977">]</span><span class="ident" id="4587978">literalNode</span><span class="op" id="4587989">)</span>&nbsp;<span class="op" id="4587991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4587994">code</span>&nbsp;<span class="op" id="4587999">:=</span>&nbsp;<span class="builtintype" id="4588002">uint16</span><span class="op" id="4588008">(</span><span class="num" id="4588009">0</span><span class="op" id="4588010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4588013">for</span>&nbsp;<span class="ident" id="4588017">n</span><span class="op" id="4588018">,</span>&nbsp;<span class="ident" id="4588020">bits</span>&nbsp;<span class="op" id="4588025">:=</span>&nbsp;<span class="keyword" id="4588028">range</span>&nbsp;<span class="ident" id="4588034">bitCount</span>&nbsp;<span class="op" id="4588043">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588047">code</span>&nbsp;<span class="op" id="4588052">&lt;&lt;=</span>&nbsp;<span class="num" id="4588056">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4588060">if</span>&nbsp;<span class="ident" id="4588063">n</span>&nbsp;<span class="op" id="4588065">==</span>&nbsp;<span class="num" id="4588068">0</span>&nbsp;<span class="op" id="4588070">||</span>&nbsp;<span class="ident" id="4588073">bits</span>&nbsp;<span class="op" id="4588078">==</span>&nbsp;<span class="num" id="4588081">0</span>&nbsp;<span class="op" id="4588083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4588088">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4588099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588103">//&nbsp;The&nbsp;literals&nbsp;list[len(list)-bits]&nbsp;..&nbsp;list[len(list)-bits]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588166">//&nbsp;are&nbsp;encoded&nbsp;using&nbsp;&#34;bits&#34;&nbsp;bits,&nbsp;and&nbsp;get&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588221">//&nbsp;code,&nbsp;code&nbsp;+&nbsp;1,&nbsp;....&nbsp;&nbsp;The&nbsp;code&nbsp;values&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588268">//&nbsp;assigned&nbsp;in&nbsp;literal&nbsp;order&nbsp;(not&nbsp;frequency&nbsp;order).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588322">chunk</span>&nbsp;<span class="op" id="4588328">:=</span>&nbsp;<span class="ident" id="4588331">list</span><span class="op" id="4588335">[</span><span class="builtinfunc" id="4588336">len</span><span class="op" id="4588339">(</span><span class="ident" id="4588340">list</span><span class="op" id="4588344">)</span><span class="op" id="4588345">-</span><span class="builtintype" id="4588346">int</span><span class="op" id="4588349">(</span><span class="ident" id="4588350">bits</span><span class="op" id="4588354">)</span><span class="op" id="4588355">:</span><span class="op" id="4588356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588360">sortByLiteral</span><span class="op" id="4588373">(</span><span class="ident" id="4588374">chunk</span><span class="op" id="4588379">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4588383">for</span>&nbsp;<span class="ident" id="4588387">_</span><span class="op" id="4588388">,</span>&nbsp;<span class="ident" id="4588390">node</span>&nbsp;<span class="op" id="4588395">:=</span>&nbsp;<span class="keyword" id="4588398">range</span>&nbsp;<span class="ident" id="4588404">chunk</span>&nbsp;<span class="op" id="4588410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588415">h</span><span class="op" id="4588416">.</span><span class="ident" id="4588417">codeBits</span><span class="op" id="4588425">[</span><span class="ident" id="4588426">node</span><span class="op" id="4588430">.</span><span class="ident" id="4588431">literal</span><span class="op" id="4588438">]</span>&nbsp;<span class="op" id="4588440">=</span>&nbsp;<span class="builtintype" id="4588442">uint8</span><span class="op" id="4588447">(</span><span class="ident" id="4588448">n</span><span class="op" id="4588449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588454">h</span><span class="op" id="4588455">.</span><span class="ident" id="4588456">code</span><span class="op" id="4588460">[</span><span class="ident" id="4588461">node</span><span class="op" id="4588465">.</span><span class="ident" id="4588466">literal</span><span class="op" id="4588473">]</span>&nbsp;<span class="op" id="4588475">=</span>&nbsp;<span class="ident" id="4588477">reverseBits</span><span class="op" id="4588488">(</span><span class="ident" id="4588489">code</span><span class="op" id="4588493">,</span>&nbsp;<span class="builtintype" id="4588495">uint8</span><span class="op" id="4588500">(</span><span class="ident" id="4588501">n</span><span class="op" id="4588502">)</span><span class="op" id="4588503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588508">code</span><span class="op" id="4588512">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4588517">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588521">list</span>&nbsp;<span class="op" id="4588526">=</span>&nbsp;<span class="ident" id="4588528">list</span><span class="op" id="4588532">[</span><span class="num" id="4588533">0</span>&nbsp;<span class="op" id="4588535">:</span>&nbsp;<span class="builtinfunc" id="4588537">len</span><span class="op" id="4588540">(</span><span class="ident" id="4588541">list</span><span class="op" id="4588545">)</span><span class="op" id="4588546">-</span><span class="builtintype" id="4588547">int</span><span class="op" id="4588550">(</span><span class="ident" id="4588551">bits</span><span class="op" id="4588555">)</span><span class="op" id="4588556">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4588559">}</span><br>
<span class="lineno"></span><span class="op" id="4588561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4588564">//&nbsp;Update&nbsp;this&nbsp;Huffman&nbsp;Code&nbsp;object&nbsp;to&nbsp;be&nbsp;the&nbsp;minimum&nbsp;code&nbsp;for&nbsp;the&nbsp;specified&nbsp;frequency&nbsp;count.</span><br>
<span class="lineno">260</span><span class="comment" id="4588657">//</span><br>
<span class="lineno"></span><span class="comment" id="4588660">//&nbsp;freq&nbsp;&nbsp;An&nbsp;array&nbsp;of&nbsp;frequencies,&nbsp;in&nbsp;which&nbsp;frequency[i]&nbsp;gives&nbsp;the&nbsp;frequency&nbsp;of&nbsp;literal&nbsp;i.</span><br>
<span class="lineno"></span><span class="comment" id="4588750">//&nbsp;maxBits&nbsp;&nbsp;The&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;any&nbsp;literal.</span><br>
<span class="lineno"></span><span class="keyword" id="4588813">func</span>&nbsp;<span class="op" id="4588818">(</span><span class="ident" id="4588819">h</span>&nbsp;<span class="op" id="4588821">*</span><span class="ident" id="4588822">huffmanEncoder</span><span class="op" id="4588836">)</span>&nbsp;<span class="ident" id="4588838">generate</span><span class="op" id="4588846">(</span><span class="ident" id="4588847">freq</span>&nbsp;<span class="op" id="4588852">[</span><span class="op" id="4588853">]</span><span class="builtintype" id="4588854">int32</span><span class="op" id="4588859">,</span>&nbsp;<span class="ident" id="4588861">maxBits</span>&nbsp;<span class="builtintype" id="4588869">int32</span><span class="op" id="4588874">)</span>&nbsp;<span class="op" id="4588876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588879">list</span>&nbsp;<span class="op" id="4588884">:=</span>&nbsp;<span class="builtinfunc" id="4588887">make</span><span class="op" id="4588891">(</span><span class="op" id="4588892">[</span><span class="op" id="4588893">]</span><span class="ident" id="4588894">literalNode</span><span class="op" id="4588905">,</span>&nbsp;<span class="builtinfunc" id="4588907">len</span><span class="op" id="4588910">(</span><span class="ident" id="4588911">freq</span><span class="op" id="4588915">)</span><span class="op" id="4588916">+</span><span class="num" id="4588917">1</span><span class="op" id="4588918">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588921">//&nbsp;Number&nbsp;of&nbsp;non-zero&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4588953">count</span>&nbsp;<span class="op" id="4588959">:=</span>&nbsp;<span class="num" id="4588962">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4588965">//&nbsp;Set&nbsp;list&nbsp;to&nbsp;be&nbsp;the&nbsp;set&nbsp;of&nbsp;all&nbsp;non-zero&nbsp;literals&nbsp;and&nbsp;their&nbsp;frequencies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4589039">for</span>&nbsp;<span class="ident" id="4589043">i</span><span class="op" id="4589044">,</span>&nbsp;<span class="ident" id="4589046">f</span>&nbsp;<span class="op" id="4589048">:=</span>&nbsp;<span class="keyword" id="4589051">range</span>&nbsp;<span class="ident" id="4589057">freq</span>&nbsp;<span class="op" id="4589062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4589066">if</span>&nbsp;<span class="ident" id="4589069">f</span>&nbsp;<span class="op" id="4589071">!=</span>&nbsp;<span class="num" id="4589074">0</span>&nbsp;<span class="op" id="4589076">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589081">list</span><span class="op" id="4589085">[</span><span class="ident" id="4589086">count</span><span class="op" id="4589091">]</span>&nbsp;<span class="op" id="4589093">=</span>&nbsp;<span class="ident" id="4589095">literalNode</span><span class="op" id="4589106">{</span><span class="builtintype" id="4589107">uint16</span><span class="op" id="4589113">(</span><span class="ident" id="4589114">i</span><span class="op" id="4589115">)</span><span class="op" id="4589116">,</span>&nbsp;<span class="ident" id="4589118">f</span><span class="op" id="4589119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589124">count</span><span class="op" id="4589129">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4589134">}</span>&nbsp;<span class="keyword" id="4589136">else</span>&nbsp;<span class="op" id="4589141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589146">h</span><span class="op" id="4589147">.</span><span class="ident" id="4589148">codeBits</span><span class="op" id="4589156">[</span><span class="ident" id="4589157">i</span><span class="op" id="4589158">]</span>&nbsp;<span class="op" id="4589160">=</span>&nbsp;<span class="num" id="4589162">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4589166">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4589169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589172">//&nbsp;If&nbsp;freq[]&nbsp;is&nbsp;shorter&nbsp;than&nbsp;codeBits[],&nbsp;fill&nbsp;rest&nbsp;of&nbsp;codeBits[]&nbsp;with&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589249">h</span><span class="op" id="4589250">.</span><span class="ident" id="4589251">codeBits</span>&nbsp;<span class="op" id="4589260">=</span>&nbsp;<span class="ident" id="4589262">h</span><span class="op" id="4589263">.</span><span class="ident" id="4589264">codeBits</span><span class="op" id="4589272">[</span><span class="num" id="4589273">0</span><span class="op" id="4589274">:</span><span class="builtinfunc" id="4589275">len</span><span class="op" id="4589278">(</span><span class="ident" id="4589279">freq</span><span class="op" id="4589283">)</span><span class="op" id="4589284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589287">list</span>&nbsp;<span class="op" id="4589292">=</span>&nbsp;<span class="ident" id="4589294">list</span><span class="op" id="4589298">[</span><span class="num" id="4589299">0</span><span class="op" id="4589300">:</span><span class="ident" id="4589301">count</span><span class="op" id="4589306">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4589309">if</span>&nbsp;<span class="ident" id="4589312">count</span>&nbsp;<span class="op" id="4589318">&lt;=</span>&nbsp;<span class="num" id="4589321">2</span>&nbsp;<span class="op" id="4589323">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589327">//&nbsp;Handle&nbsp;the&nbsp;small&nbsp;cases&nbsp;here,&nbsp;because&nbsp;they&nbsp;are&nbsp;awkward&nbsp;for&nbsp;the&nbsp;general&nbsp;case&nbsp;code.&nbsp;&nbsp;With</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589419">//&nbsp;two&nbsp;or&nbsp;fewer&nbsp;literals,&nbsp;everything&nbsp;has&nbsp;bit&nbsp;length&nbsp;1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4589476">for</span>&nbsp;<span class="ident" id="4589480">i</span><span class="op" id="4589481">,</span>&nbsp;<span class="ident" id="4589483">node</span>&nbsp;<span class="op" id="4589488">:=</span>&nbsp;<span class="keyword" id="4589491">range</span>&nbsp;<span class="ident" id="4589497">list</span>&nbsp;<span class="op" id="4589502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589507">//&nbsp;&#34;list&#34;&nbsp;is&nbsp;in&nbsp;order&nbsp;of&nbsp;increasing&nbsp;literal&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589561">h</span><span class="op" id="4589562">.</span><span class="ident" id="4589563">codeBits</span><span class="op" id="4589571">[</span><span class="ident" id="4589572">node</span><span class="op" id="4589576">.</span><span class="ident" id="4589577">literal</span><span class="op" id="4589584">]</span>&nbsp;<span class="op" id="4589586">=</span>&nbsp;<span class="num" id="4589588">1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589593">h</span><span class="op" id="4589594">.</span><span class="ident" id="4589595">code</span><span class="op" id="4589599">[</span><span class="ident" id="4589600">node</span><span class="op" id="4589604">.</span><span class="ident" id="4589605">literal</span><span class="op" id="4589612">]</span>&nbsp;<span class="op" id="4589614">=</span>&nbsp;<span class="builtintype" id="4589616">uint16</span><span class="op" id="4589622">(</span><span class="ident" id="4589623">i</span><span class="op" id="4589624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4589628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4589632">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4589640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589643">sortByFreq</span><span class="op" id="4589653">(</span><span class="ident" id="4589654">list</span><span class="op" id="4589658">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589662">//&nbsp;Get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals&nbsp;for&nbsp;each&nbsp;bit&nbsp;count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589712">bitCount</span>&nbsp;<span class="op" id="4589721">:=</span>&nbsp;<span class="ident" id="4589724">h</span><span class="op" id="4589725">.</span><span class="ident" id="4589726">bitCounts</span><span class="op" id="4589735">(</span><span class="ident" id="4589736">list</span><span class="op" id="4589740">,</span>&nbsp;<span class="ident" id="4589742">maxBits</span><span class="op" id="4589749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4589752">//&nbsp;And&nbsp;do&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589778">h</span><span class="op" id="4589779">.</span><span class="ident" id="4589780">assignEncodingAndSize</span><span class="op" id="4589801">(</span><span class="ident" id="4589802">bitCount</span><span class="op" id="4589810">,</span>&nbsp;<span class="ident" id="4589812">list</span><span class="op" id="4589816">)</span><br>
<span class="lineno">295</span><span class="op" id="4589818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4589821">type</span>&nbsp;<span class="ident" id="4589826">literalNodeSorter</span>&nbsp;<span class="keyword" id="4589844">struct</span>&nbsp;<span class="op" id="4589851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589854">a</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589859">[</span><span class="op" id="4589860">]</span><span class="ident" id="4589861">literalNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4589874">less</span>&nbsp;<span class="keyword" id="4589879">func</span><span class="op" id="4589883">(</span><span class="ident" id="4589884">i</span><span class="op" id="4589885">,</span>&nbsp;<span class="ident" id="4589887">j</span>&nbsp;<span class="builtintype" id="4589889">int</span><span class="op" id="4589892">)</span>&nbsp;<span class="builtintype" id="4589894">bool</span><br>
<span class="lineno">300</span><span class="op" id="4589899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4589902">func</span>&nbsp;<span class="op" id="4589907">(</span><span class="ident" id="4589908">s</span>&nbsp;<span class="ident" id="4589910">literalNodeSorter</span><span class="op" id="4589927">)</span>&nbsp;<span class="ident" id="4589929">Len</span><span class="op" id="4589932">(</span><span class="op" id="4589933">)</span>&nbsp;<span class="builtintype" id="4589935">int</span>&nbsp;<span class="op" id="4589939">{</span>&nbsp;<span class="keyword" id="4589941">return</span>&nbsp;<span class="builtinfunc" id="4589948">len</span><span class="op" id="4589951">(</span><span class="ident" id="4589952">s</span><span class="op" id="4589953">.</span><span class="ident" id="4589954">a</span><span class="op" id="4589955">)</span>&nbsp;<span class="op" id="4589957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4589960">func</span>&nbsp;<span class="op" id="4589965">(</span><span class="ident" id="4589966">s</span>&nbsp;<span class="ident" id="4589968">literalNodeSorter</span><span class="op" id="4589985">)</span>&nbsp;<span class="ident" id="4589987">Less</span><span class="op" id="4589991">(</span><span class="ident" id="4589992">i</span><span class="op" id="4589993">,</span>&nbsp;<span class="ident" id="4589995">j</span>&nbsp;<span class="builtintype" id="4589997">int</span><span class="op" id="4590000">)</span>&nbsp;<span class="builtintype" id="4590002">bool</span>&nbsp;<span class="op" id="4590007">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4590010">return</span>&nbsp;<span class="ident" id="4590017">s</span><span class="op" id="4590018">.</span><span class="ident" id="4590019">less</span><span class="op" id="4590023">(</span><span class="ident" id="4590024">i</span><span class="op" id="4590025">,</span>&nbsp;<span class="ident" id="4590027">j</span><span class="op" id="4590028">)</span><br>
<span class="lineno"></span><span class="op" id="4590030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4590033">func</span>&nbsp;<span class="op" id="4590038">(</span><span class="ident" id="4590039">s</span>&nbsp;<span class="ident" id="4590041">literalNodeSorter</span><span class="op" id="4590058">)</span>&nbsp;<span class="ident" id="4590060">Swap</span><span class="op" id="4590064">(</span><span class="ident" id="4590065">i</span><span class="op" id="4590066">,</span>&nbsp;<span class="ident" id="4590068">j</span>&nbsp;<span class="builtintype" id="4590070">int</span><span class="op" id="4590073">)</span>&nbsp;<span class="op" id="4590075">{</span>&nbsp;<span class="ident" id="4590077">s</span><span class="op" id="4590078">.</span><span class="ident" id="4590079">a</span><span class="op" id="4590080">[</span><span class="ident" id="4590081">i</span><span class="op" id="4590082">]</span><span class="op" id="4590083">,</span>&nbsp;<span class="ident" id="4590085">s</span><span class="op" id="4590086">.</span><span class="ident" id="4590087">a</span><span class="op" id="4590088">[</span><span class="ident" id="4590089">j</span><span class="op" id="4590090">]</span>&nbsp;<span class="op" id="4590092">=</span>&nbsp;<span class="ident" id="4590094">s</span><span class="op" id="4590095">.</span><span class="ident" id="4590096">a</span><span class="op" id="4590097">[</span><span class="ident" id="4590098">j</span><span class="op" id="4590099">]</span><span class="op" id="4590100">,</span>&nbsp;<span class="ident" id="4590102">s</span><span class="op" id="4590103">.</span><span class="ident" id="4590104">a</span><span class="op" id="4590105">[</span><span class="ident" id="4590106">i</span><span class="op" id="4590107">]</span>&nbsp;<span class="op" id="4590109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="4590112">func</span>&nbsp;<span class="ident" id="4590117">sortByFreq</span><span class="op" id="4590127">(</span><span class="ident" id="4590128">a</span>&nbsp;<span class="op" id="4590130">[</span><span class="op" id="4590131">]</span><span class="ident" id="4590132">literalNode</span><span class="op" id="4590143">)</span>&nbsp;<span class="op" id="4590145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590148">s</span>&nbsp;<span class="op" id="4590150">:=</span>&nbsp;<span class="op" id="4590153">&amp;</span><span class="ident" id="4590154">literalNodeSorter</span><span class="op" id="4590171">{</span><span class="ident" id="4590172">a</span><span class="op" id="4590173">,</span>&nbsp;<span class="keyword" id="4590175">func</span><span class="op" id="4590179">(</span><span class="ident" id="4590180">i</span><span class="op" id="4590181">,</span>&nbsp;<span class="ident" id="4590183">j</span>&nbsp;<span class="builtintype" id="4590185">int</span><span class="op" id="4590188">)</span>&nbsp;<span class="builtintype" id="4590190">bool</span>&nbsp;<span class="op" id="4590195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4590199">if</span>&nbsp;<span class="ident" id="4590202">a</span><span class="op" id="4590203">[</span><span class="ident" id="4590204">i</span><span class="op" id="4590205">]</span><span class="op" id="4590206">.</span><span class="ident" id="4590207">freq</span>&nbsp;<span class="op" id="4590212">==</span>&nbsp;<span class="ident" id="4590215">a</span><span class="op" id="4590216">[</span><span class="ident" id="4590217">j</span><span class="op" id="4590218">]</span><span class="op" id="4590219">.</span><span class="ident" id="4590220">freq</span>&nbsp;<span class="op" id="4590225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4590230">return</span>&nbsp;<span class="ident" id="4590237">a</span><span class="op" id="4590238">[</span><span class="ident" id="4590239">i</span><span class="op" id="4590240">]</span><span class="op" id="4590241">.</span><span class="ident" id="4590242">literal</span>&nbsp;<span class="op" id="4590250">&lt;</span>&nbsp;<span class="ident" id="4590252">a</span><span class="op" id="4590253">[</span><span class="ident" id="4590254">j</span><span class="op" id="4590255">]</span><span class="op" id="4590256">.</span><span class="ident" id="4590257">literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4590267">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4590271">return</span>&nbsp;<span class="ident" id="4590278">a</span><span class="op" id="4590279">[</span><span class="ident" id="4590280">i</span><span class="op" id="4590281">]</span><span class="op" id="4590282">.</span><span class="ident" id="4590283">freq</span>&nbsp;<span class="op" id="4590288">&lt;</span>&nbsp;<span class="ident" id="4590290">a</span><span class="op" id="4590291">[</span><span class="ident" id="4590292">j</span><span class="op" id="4590293">]</span><span class="op" id="4590294">.</span><span class="ident" id="4590295">freq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4590301">}</span><span class="op" id="4590302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590305">sort</span><span class="op" id="4590309">.</span><span class="ident" id="4590310">Sort</span><span class="op" id="4590314">(</span><span class="ident" id="4590315">s</span><span class="op" id="4590316">)</span><br>
<span class="lineno"></span><span class="op" id="4590318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span><span class="keyword" id="4590321">func</span>&nbsp;<span class="ident" id="4590326">sortByLiteral</span><span class="op" id="4590339">(</span><span class="ident" id="4590340">a</span>&nbsp;<span class="op" id="4590342">[</span><span class="op" id="4590343">]</span><span class="ident" id="4590344">literalNode</span><span class="op" id="4590355">)</span>&nbsp;<span class="op" id="4590357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590360">s</span>&nbsp;<span class="op" id="4590362">:=</span>&nbsp;<span class="op" id="4590365">&amp;</span><span class="ident" id="4590366">literalNodeSorter</span><span class="op" id="4590383">{</span><span class="ident" id="4590384">a</span><span class="op" id="4590385">,</span>&nbsp;<span class="keyword" id="4590387">func</span><span class="op" id="4590391">(</span><span class="ident" id="4590392">i</span><span class="op" id="4590393">,</span>&nbsp;<span class="ident" id="4590395">j</span>&nbsp;<span class="builtintype" id="4590397">int</span><span class="op" id="4590400">)</span>&nbsp;<span class="builtintype" id="4590402">bool</span>&nbsp;<span class="op" id="4590407">{</span>&nbsp;<span class="keyword" id="4590409">return</span>&nbsp;<span class="ident" id="4590416">a</span><span class="op" id="4590417">[</span><span class="ident" id="4590418">i</span><span class="op" id="4590419">]</span><span class="op" id="4590420">.</span><span class="ident" id="4590421">literal</span>&nbsp;<span class="op" id="4590429">&lt;</span>&nbsp;<span class="ident" id="4590431">a</span><span class="op" id="4590432">[</span><span class="ident" id="4590433">j</span><span class="op" id="4590434">]</span><span class="op" id="4590435">.</span><span class="ident" id="4590436">literal</span>&nbsp;<span class="op" id="4590444">}</span><span class="op" id="4590445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4590448">sort</span><span class="op" id="4590452">.</span><span class="ident" id="4590453">Sort</span><span class="op" id="4590457">(</span><span class="ident" id="4590458">s</span><span class="op" id="4590459">)</span><br>
<span class="lineno"></span><span class="op" id="4590461">}</span>
</div>
</body>
</html>
