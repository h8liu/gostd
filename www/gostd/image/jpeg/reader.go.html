<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5580205">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5580260">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5580314">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5580365">//&nbsp;Package&nbsp;jpeg&nbsp;implements&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5580426">//</span><br>
<span class="lineno"></span><span class="comment" id="5580429">//&nbsp;JPEG&nbsp;is&nbsp;defined&nbsp;in&nbsp;ITU-T&nbsp;T.81:&nbsp;http://www.w3.org/Graphics/JPEG/itu-t81.pdf.</span><br>
<span class="lineno"></span><span class="keyword" id="5580508">package</span>&nbsp;<span class="ident" id="5580516">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5580522">import</span>&nbsp;<span class="op" id="5580529">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5580532">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5580541">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5580556">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5580561">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5580564">//&nbsp;TODO(nigeltao):&nbsp;fix&nbsp;up&nbsp;the&nbsp;doc&nbsp;comment&nbsp;style&nbsp;so&nbsp;that&nbsp;sentences&nbsp;start&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5580641">//&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;or&nbsp;function&nbsp;that&nbsp;they&nbsp;annotate.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5580698">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;JPEG.</span><br>
<span class="lineno">20</span><span class="keyword" id="5580759">type</span>&nbsp;<span class="ident" id="5580764">FormatError</span>&nbsp;<span class="builtintype" id="5580776">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580784">func</span>&nbsp;<span class="op" id="5580789">(</span><span class="ident" id="5580790">e</span>&nbsp;<span class="ident" id="5580792">FormatError</span><span class="op" id="5580803">)</span>&nbsp;<span class="ident" id="5580805">Error</span><span class="op" id="5580810">(</span><span class="op" id="5580811">)</span>&nbsp;<span class="builtintype" id="5580813">string</span>&nbsp;<span class="op" id="5580820">{</span>&nbsp;<span class="keyword" id="5580822">return</span>&nbsp;<span class="string" id="5580829">&#34;invalid&nbsp;JPEG&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5580853">+</span>&nbsp;<span class="builtintype" id="5580855">string</span><span class="op" id="5580861">(</span><span class="ident" id="5580862">e</span><span class="op" id="5580863">)</span>&nbsp;<span class="op" id="5580865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5580868">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;JPEG&nbsp;feature.</span><br>
<span class="lineno">25</span><span class="keyword" id="5580959">type</span>&nbsp;<span class="ident" id="5580964">UnsupportedError</span>&nbsp;<span class="builtintype" id="5580981">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5580989">func</span>&nbsp;<span class="op" id="5580994">(</span><span class="ident" id="5580995">e</span>&nbsp;<span class="ident" id="5580997">UnsupportedError</span><span class="op" id="5581013">)</span>&nbsp;<span class="ident" id="5581015">Error</span><span class="op" id="5581020">(</span><span class="op" id="5581021">)</span>&nbsp;<span class="builtintype" id="5581023">string</span>&nbsp;<span class="op" id="5581030">{</span>&nbsp;<span class="keyword" id="5581032">return</span>&nbsp;<span class="string" id="5581039">&#34;unsupported&nbsp;JPEG&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5581068">+</span>&nbsp;<span class="builtintype" id="5581070">string</span><span class="op" id="5581076">(</span><span class="ident" id="5581077">e</span><span class="op" id="5581078">)</span>&nbsp;<span class="op" id="5581080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5581083">//&nbsp;Component&nbsp;specification,&nbsp;specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno">30</span><span class="keyword" id="5581139">type</span>&nbsp;<span class="ident" id="5581144">component</span>&nbsp;<span class="keyword" id="5581154">struct</span>&nbsp;<span class="op" id="5581161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581164">h</span>&nbsp;&nbsp;<span class="builtintype" id="5581167">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5581173">//&nbsp;Horizontal&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581205">v</span>&nbsp;&nbsp;<span class="builtintype" id="5581208">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5581214">//&nbsp;Vertical&nbsp;sampling&nbsp;factor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581244">c</span>&nbsp;&nbsp;<span class="builtintype" id="5581247">uint8</span>&nbsp;<span class="comment" id="5581253">//&nbsp;Component&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581279">tq</span>&nbsp;<span class="builtintype" id="5581282">uint8</span>&nbsp;<span class="comment" id="5581288">//&nbsp;Quantization&nbsp;table&nbsp;destination&nbsp;selector.</span><br>
<span class="lineno">35</span><span class="op" id="5581332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5581335">const</span>&nbsp;<span class="op" id="5581341">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581344">dcTable</span>&nbsp;<span class="op" id="5581352">=</span>&nbsp;<span class="num" id="5581354">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581357">acTable</span>&nbsp;<span class="op" id="5581365">=</span>&nbsp;<span class="num" id="5581367">1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581370">maxTc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581378">=</span>&nbsp;<span class="num" id="5581380">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581383">maxTh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581391">=</span>&nbsp;<span class="num" id="5581393">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581396">maxTq</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581404">=</span>&nbsp;<span class="num" id="5581406">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581410">//&nbsp;A&nbsp;grayscale&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;a&nbsp;Y&nbsp;component.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581461">nGrayComponent</span>&nbsp;<span class="op" id="5581476">=</span>&nbsp;<span class="num" id="5581478">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581481">//&nbsp;A&nbsp;color&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;Y,&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581533">nColorComponent</span>&nbsp;<span class="op" id="5581549">=</span>&nbsp;<span class="num" id="5581551">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581555">//&nbsp;We&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;and&nbsp;4:2:0&nbsp;downsampling,&nbsp;and&nbsp;therefore&nbsp;the</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581637">//&nbsp;number&nbsp;of&nbsp;luma&nbsp;samples&nbsp;per&nbsp;chroma&nbsp;sample&nbsp;is&nbsp;at&nbsp;most&nbsp;2&nbsp;in&nbsp;the&nbsp;horizontal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5581713">//&nbsp;and&nbsp;2&nbsp;in&nbsp;the&nbsp;vertical&nbsp;direction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581750">maxH</span>&nbsp;<span class="op" id="5581755">=</span>&nbsp;<span class="num" id="5581757">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581760">maxV</span>&nbsp;<span class="op" id="5581765">=</span>&nbsp;<span class="num" id="5581767">2</span><br>
<span class="lineno"></span><span class="op" id="5581769">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="5581772">const</span>&nbsp;<span class="op" id="5581778">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581781">soiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581793">=</span>&nbsp;<span class="num" id="5581795">0xd8</span>&nbsp;<span class="comment" id="5581800">//&nbsp;Start&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581820">eoiMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581832">=</span>&nbsp;<span class="num" id="5581834">0xd9</span>&nbsp;<span class="comment" id="5581839">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581857">sof0Marker</span>&nbsp;&nbsp;<span class="op" id="5581869">=</span>&nbsp;<span class="num" id="5581871">0xc0</span>&nbsp;<span class="comment" id="5581876">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline).</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581907">sof2Marker</span>&nbsp;&nbsp;<span class="op" id="5581919">=</span>&nbsp;<span class="num" id="5581921">0xc2</span>&nbsp;<span class="comment" id="5581926">//&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Progressive).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5581960">dhtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5581972">=</span>&nbsp;<span class="num" id="5581974">0xc4</span>&nbsp;<span class="comment" id="5581979">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582005">dqtMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5582017">=</span>&nbsp;<span class="num" id="5582019">0xdb</span>&nbsp;<span class="comment" id="5582024">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582055">sosMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5582067">=</span>&nbsp;<span class="num" id="5582069">0xda</span>&nbsp;<span class="comment" id="5582074">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582093">driMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5582105">=</span>&nbsp;<span class="num" id="5582107">0xdd</span>&nbsp;<span class="comment" id="5582112">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582141">rst0Marker</span>&nbsp;&nbsp;<span class="op" id="5582153">=</span>&nbsp;<span class="num" id="5582155">0xd0</span>&nbsp;<span class="comment" id="5582160">//&nbsp;ReSTart&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582177">rst7Marker</span>&nbsp;&nbsp;<span class="op" id="5582189">=</span>&nbsp;<span class="num" id="5582191">0xd7</span>&nbsp;<span class="comment" id="5582196">//&nbsp;ReSTart&nbsp;(7).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582213">app0Marker</span>&nbsp;&nbsp;<span class="op" id="5582225">=</span>&nbsp;<span class="num" id="5582227">0xe0</span>&nbsp;<span class="comment" id="5582232">//&nbsp;APPlication&nbsp;specific&nbsp;(0).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582262">app15Marker</span>&nbsp;<span class="op" id="5582274">=</span>&nbsp;<span class="num" id="5582276">0xef</span>&nbsp;<span class="comment" id="5582281">//&nbsp;APPlication&nbsp;specific&nbsp;(15).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582312">comMarker</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5582324">=</span>&nbsp;<span class="num" id="5582326">0xfe</span>&nbsp;<span class="comment" id="5582331">//&nbsp;COMment.</span><br>
<span class="lineno">70</span><span class="op" id="5582343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5582346">//&nbsp;unzig&nbsp;maps&nbsp;from&nbsp;the&nbsp;zig-zag&nbsp;ordering&nbsp;to&nbsp;the&nbsp;natural&nbsp;ordering.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5582424">//&nbsp;unzig[3]&nbsp;is&nbsp;the&nbsp;column&nbsp;and&nbsp;row&nbsp;of&nbsp;the&nbsp;fourth&nbsp;element&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5582502">//&nbsp;value&nbsp;is&nbsp;16,&nbsp;which&nbsp;means&nbsp;first&nbsp;column&nbsp;(16%8&nbsp;==&nbsp;0)&nbsp;and&nbsp;third&nbsp;row&nbsp;(16/8&nbsp;==&nbsp;2).</span><br>
<span class="lineno">75</span><span class="keyword" id="5582582">var</span>&nbsp;<span class="ident" id="5582586">unzig</span>&nbsp;<span class="op" id="5582592">=</span>&nbsp;<span class="op" id="5582594">[</span><span class="ident" id="5582595">blockSize</span><span class="op" id="5582604">]</span><span class="builtintype" id="5582605">int</span><span class="op" id="5582608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582611">0</span><span class="op" id="5582612">,</span>&nbsp;<span class="num" id="5582614">1</span><span class="op" id="5582615">,</span>&nbsp;<span class="num" id="5582617">8</span><span class="op" id="5582618">,</span>&nbsp;<span class="num" id="5582620">16</span><span class="op" id="5582622">,</span>&nbsp;<span class="num" id="5582624">9</span><span class="op" id="5582625">,</span>&nbsp;<span class="num" id="5582627">2</span><span class="op" id="5582628">,</span>&nbsp;<span class="num" id="5582630">3</span><span class="op" id="5582631">,</span>&nbsp;<span class="num" id="5582633">10</span><span class="op" id="5582635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582638">17</span><span class="op" id="5582640">,</span>&nbsp;<span class="num" id="5582642">24</span><span class="op" id="5582644">,</span>&nbsp;<span class="num" id="5582646">32</span><span class="op" id="5582648">,</span>&nbsp;<span class="num" id="5582650">25</span><span class="op" id="5582652">,</span>&nbsp;<span class="num" id="5582654">18</span><span class="op" id="5582656">,</span>&nbsp;<span class="num" id="5582658">11</span><span class="op" id="5582660">,</span>&nbsp;<span class="num" id="5582662">4</span><span class="op" id="5582663">,</span>&nbsp;<span class="num" id="5582665">5</span><span class="op" id="5582666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582669">12</span><span class="op" id="5582671">,</span>&nbsp;<span class="num" id="5582673">19</span><span class="op" id="5582675">,</span>&nbsp;<span class="num" id="5582677">26</span><span class="op" id="5582679">,</span>&nbsp;<span class="num" id="5582681">33</span><span class="op" id="5582683">,</span>&nbsp;<span class="num" id="5582685">40</span><span class="op" id="5582687">,</span>&nbsp;<span class="num" id="5582689">48</span><span class="op" id="5582691">,</span>&nbsp;<span class="num" id="5582693">41</span><span class="op" id="5582695">,</span>&nbsp;<span class="num" id="5582697">34</span><span class="op" id="5582699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582702">27</span><span class="op" id="5582704">,</span>&nbsp;<span class="num" id="5582706">20</span><span class="op" id="5582708">,</span>&nbsp;<span class="num" id="5582710">13</span><span class="op" id="5582712">,</span>&nbsp;<span class="num" id="5582714">6</span><span class="op" id="5582715">,</span>&nbsp;<span class="num" id="5582717">7</span><span class="op" id="5582718">,</span>&nbsp;<span class="num" id="5582720">14</span><span class="op" id="5582722">,</span>&nbsp;<span class="num" id="5582724">21</span><span class="op" id="5582726">,</span>&nbsp;<span class="num" id="5582728">28</span><span class="op" id="5582730">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582733">35</span><span class="op" id="5582735">,</span>&nbsp;<span class="num" id="5582737">42</span><span class="op" id="5582739">,</span>&nbsp;<span class="num" id="5582741">49</span><span class="op" id="5582743">,</span>&nbsp;<span class="num" id="5582745">56</span><span class="op" id="5582747">,</span>&nbsp;<span class="num" id="5582749">57</span><span class="op" id="5582751">,</span>&nbsp;<span class="num" id="5582753">50</span><span class="op" id="5582755">,</span>&nbsp;<span class="num" id="5582757">43</span><span class="op" id="5582759">,</span>&nbsp;<span class="num" id="5582761">36</span><span class="op" id="5582763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582766">29</span><span class="op" id="5582768">,</span>&nbsp;<span class="num" id="5582770">22</span><span class="op" id="5582772">,</span>&nbsp;<span class="num" id="5582774">15</span><span class="op" id="5582776">,</span>&nbsp;<span class="num" id="5582778">23</span><span class="op" id="5582780">,</span>&nbsp;<span class="num" id="5582782">30</span><span class="op" id="5582784">,</span>&nbsp;<span class="num" id="5582786">37</span><span class="op" id="5582788">,</span>&nbsp;<span class="num" id="5582790">44</span><span class="op" id="5582792">,</span>&nbsp;<span class="num" id="5582794">51</span><span class="op" id="5582796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582799">58</span><span class="op" id="5582801">,</span>&nbsp;<span class="num" id="5582803">59</span><span class="op" id="5582805">,</span>&nbsp;<span class="num" id="5582807">52</span><span class="op" id="5582809">,</span>&nbsp;<span class="num" id="5582811">45</span><span class="op" id="5582813">,</span>&nbsp;<span class="num" id="5582815">38</span><span class="op" id="5582817">,</span>&nbsp;<span class="num" id="5582819">31</span><span class="op" id="5582821">,</span>&nbsp;<span class="num" id="5582823">39</span><span class="op" id="5582825">,</span>&nbsp;<span class="num" id="5582827">46</span><span class="op" id="5582829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="5582832">53</span><span class="op" id="5582834">,</span>&nbsp;<span class="num" id="5582836">60</span><span class="op" id="5582838">,</span>&nbsp;<span class="num" id="5582840">61</span><span class="op" id="5582842">,</span>&nbsp;<span class="num" id="5582844">54</span><span class="op" id="5582846">,</span>&nbsp;<span class="num" id="5582848">47</span><span class="op" id="5582850">,</span>&nbsp;<span class="num" id="5582852">55</span><span class="op" id="5582854">,</span>&nbsp;<span class="num" id="5582856">62</span><span class="op" id="5582858">,</span>&nbsp;<span class="num" id="5582860">63</span><span class="op" id="5582862">,</span><br>
<span class="lineno"></span><span class="op" id="5582864">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5582867">//&nbsp;Reader&nbsp;is&nbsp;deprecated.</span><br>
<span class="lineno"></span><span class="keyword" id="5582892">type</span>&nbsp;<span class="ident" id="5582897">Reader</span>&nbsp;<span class="keyword" id="5582904">interface</span>&nbsp;<span class="op" id="5582914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582917">io</span><span class="op" id="5582919">.</span><span class="ident" id="5582920">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5582932">io</span><span class="op" id="5582934">.</span><span class="ident" id="5582935">Reader</span><br>
<span class="lineno">90</span><span class="op" id="5582942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5582945">//&nbsp;bits&nbsp;holds&nbsp;the&nbsp;unprocessed&nbsp;bits&nbsp;that&nbsp;have&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;byte-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5583023">//&nbsp;The&nbsp;n&nbsp;least&nbsp;significant&nbsp;bits&nbsp;of&nbsp;a&nbsp;form&nbsp;the&nbsp;unread&nbsp;bits,&nbsp;to&nbsp;be&nbsp;read&nbsp;in&nbsp;MSB&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5583103">//&nbsp;LSB&nbsp;order.</span><br>
<span class="lineno">95</span><span class="keyword" id="5583117">type</span>&nbsp;<span class="ident" id="5583122">bits</span>&nbsp;<span class="keyword" id="5583127">struct</span>&nbsp;<span class="op" id="5583134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583137">a</span>&nbsp;<span class="builtintype" id="5583139">uint32</span>&nbsp;<span class="comment" id="5583146">//&nbsp;accumulator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583163">m</span>&nbsp;<span class="builtintype" id="5583165">uint32</span>&nbsp;<span class="comment" id="5583172">//&nbsp;mask.&nbsp;m==1&lt;&lt;(n-1)&nbsp;when&nbsp;n&gt;0,&nbsp;with&nbsp;m==0&nbsp;when&nbsp;n==0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583225">n</span>&nbsp;<span class="builtintype" id="5583227">int32</span>&nbsp;&nbsp;<span class="comment" id="5583234">//&nbsp;the&nbsp;number&nbsp;of&nbsp;unread&nbsp;bits&nbsp;in&nbsp;a.</span><br>
<span class="lineno"></span><span class="op" id="5583269">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="5583272">type</span>&nbsp;<span class="ident" id="5583277">decoder</span>&nbsp;<span class="keyword" id="5583285">struct</span>&nbsp;<span class="op" id="5583292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583295">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583300">io</span><span class="op" id="5583302">.</span><span class="ident" id="5583303">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583311">bits</span>&nbsp;<span class="ident" id="5583316">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583322">//&nbsp;bytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;buffer,&nbsp;similar&nbsp;to&nbsp;a&nbsp;bufio.Reader,&nbsp;except&nbsp;that&nbsp;it</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583392">//&nbsp;has&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;unread&nbsp;more&nbsp;than&nbsp;1&nbsp;byte,&nbsp;due&nbsp;to&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583461">//&nbsp;Byte&nbsp;stuffing&nbsp;is&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583512">bytes</span>&nbsp;<span class="keyword" id="5583518">struct</span>&nbsp;<span class="op" id="5583525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583529">//&nbsp;buf[i:j]&nbsp;are&nbsp;the&nbsp;buffered&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583591">//&nbsp;io.Reader&nbsp;that&nbsp;haven&#39;t&nbsp;yet&nbsp;been&nbsp;passed&nbsp;further&nbsp;on.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583647">buf</span>&nbsp;&nbsp;<span class="op" id="5583652">[</span><span class="num" id="5583653">4096</span><span class="op" id="5583657">]</span><span class="builtintype" id="5583658">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583665">i</span><span class="op" id="5583666">,</span>&nbsp;<span class="ident" id="5583668">j</span>&nbsp;<span class="builtintype" id="5583670">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583676">//&nbsp;nUnreadable&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;back&nbsp;up&nbsp;i&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5583735">//&nbsp;overshooting.&nbsp;It&nbsp;can&nbsp;be&nbsp;0,&nbsp;1&nbsp;or&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583775">nUnreadable</span>&nbsp;<span class="builtintype" id="5583787">int</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583795">width</span><span class="op" id="5583800">,</span>&nbsp;<span class="ident" id="5583802">height</span>&nbsp;<span class="builtintype" id="5583809">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583814">img1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583828">*</span><span class="ident" id="5583829">image</span><span class="op" id="5583834">.</span><span class="ident" id="5583835">Gray</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583841">img3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5583855">*</span><span class="ident" id="5583856">image</span><span class="op" id="5583861">.</span><span class="ident" id="5583862">YCbCr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583869">ri</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5583883">int</span>&nbsp;<span class="comment" id="5583887">//&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583909">nComp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5583923">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583928">progressive</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5583942">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5583948">eobRun</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5583962">uint16</span>&nbsp;<span class="comment" id="5583969">//&nbsp;End-of-Band&nbsp;run,&nbsp;specified&nbsp;in&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584020">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584034">[</span><span class="ident" id="5584035">nColorComponent</span><span class="op" id="5584050">]</span><span class="ident" id="5584051">component</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584062">progCoeffs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584076">[</span><span class="ident" id="5584077">nColorComponent</span><span class="op" id="5584092">]</span><span class="op" id="5584093">[</span><span class="op" id="5584094">]</span><span class="ident" id="5584095">block</span>&nbsp;<span class="comment" id="5584101">//&nbsp;Saved&nbsp;state&nbsp;between&nbsp;progressive-mode&nbsp;scans.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584149">huff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584163">[</span><span class="ident" id="5584164">maxTc</span>&nbsp;<span class="op" id="5584170">+</span>&nbsp;<span class="num" id="5584172">1</span><span class="op" id="5584173">]</span><span class="op" id="5584174">[</span><span class="ident" id="5584175">maxTh</span>&nbsp;<span class="op" id="5584181">+</span>&nbsp;<span class="num" id="5584183">1</span><span class="op" id="5584184">]</span><span class="ident" id="5584185">huffman</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584194">quant</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584208">[</span><span class="ident" id="5584209">maxTq</span>&nbsp;<span class="op" id="5584215">+</span>&nbsp;<span class="num" id="5584217">1</span><span class="op" id="5584218">]</span><span class="ident" id="5584219">block</span>&nbsp;<span class="comment" id="5584225">//&nbsp;Quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584268">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584282">[</span><span class="ident" id="5584283">blockSize</span>&nbsp;<span class="op" id="5584293">+</span>&nbsp;<span class="num" id="5584295">1</span><span class="op" id="5584296">]</span><span class="builtintype" id="5584297">byte</span><br>
<span class="lineno"></span><span class="op" id="5584302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5584305">//&nbsp;fill&nbsp;fills&nbsp;up&nbsp;the&nbsp;d.bytes.buf&nbsp;buffer&nbsp;from&nbsp;the&nbsp;underlying&nbsp;io.Reader.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5584379">//&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;when&nbsp;there&nbsp;are&nbsp;no&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;d.bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5584447">func</span>&nbsp;<span class="op" id="5584452">(</span><span class="ident" id="5584453">d</span>&nbsp;<span class="op" id="5584455">*</span><span class="ident" id="5584456">decoder</span><span class="op" id="5584463">)</span>&nbsp;<span class="ident" id="5584465">fill</span><span class="op" id="5584469">(</span><span class="op" id="5584470">)</span>&nbsp;<span class="builtintype" id="5584472">error</span>&nbsp;<span class="op" id="5584478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584481">if</span>&nbsp;<span class="ident" id="5584484">d</span><span class="op" id="5584485">.</span><span class="ident" id="5584486">bytes</span><span class="op" id="5584491">.</span><span class="ident" id="5584492">i</span>&nbsp;<span class="op" id="5584494">!=</span>&nbsp;<span class="ident" id="5584497">d</span><span class="op" id="5584498">.</span><span class="ident" id="5584499">bytes</span><span class="op" id="5584504">.</span><span class="ident" id="5584505">j</span>&nbsp;<span class="op" id="5584507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5584511">panic</span><span class="op" id="5584516">(</span><span class="string" id="5584517">&#34;jpeg:&nbsp;fill&nbsp;called&nbsp;when&nbsp;unread&nbsp;bytes&nbsp;exist&#34;</span><span class="op" id="5584560">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584566">//&nbsp;Move&nbsp;the&nbsp;last&nbsp;2&nbsp;bytes&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer,&nbsp;in&nbsp;case&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584636">//&nbsp;to&nbsp;call&nbsp;unreadByteStuffedByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584671">if</span>&nbsp;<span class="ident" id="5584674">d</span><span class="op" id="5584675">.</span><span class="ident" id="5584676">bytes</span><span class="op" id="5584681">.</span><span class="ident" id="5584682">j</span>&nbsp;<span class="op" id="5584684">&gt;</span>&nbsp;<span class="num" id="5584686">2</span>&nbsp;<span class="op" id="5584688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584692">d</span><span class="op" id="5584693">.</span><span class="ident" id="5584694">bytes</span><span class="op" id="5584699">.</span><span class="ident" id="5584700">buf</span><span class="op" id="5584703">[</span><span class="num" id="5584704">0</span><span class="op" id="5584705">]</span>&nbsp;<span class="op" id="5584707">=</span>&nbsp;<span class="ident" id="5584709">d</span><span class="op" id="5584710">.</span><span class="ident" id="5584711">bytes</span><span class="op" id="5584716">.</span><span class="ident" id="5584717">buf</span><span class="op" id="5584720">[</span><span class="ident" id="5584721">d</span><span class="op" id="5584722">.</span><span class="ident" id="5584723">bytes</span><span class="op" id="5584728">.</span><span class="ident" id="5584729">j</span><span class="op" id="5584730">-</span><span class="num" id="5584731">2</span><span class="op" id="5584732">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584736">d</span><span class="op" id="5584737">.</span><span class="ident" id="5584738">bytes</span><span class="op" id="5584743">.</span><span class="ident" id="5584744">buf</span><span class="op" id="5584747">[</span><span class="num" id="5584748">1</span><span class="op" id="5584749">]</span>&nbsp;<span class="op" id="5584751">=</span>&nbsp;<span class="ident" id="5584753">d</span><span class="op" id="5584754">.</span><span class="ident" id="5584755">bytes</span><span class="op" id="5584760">.</span><span class="ident" id="5584761">buf</span><span class="op" id="5584764">[</span><span class="ident" id="5584765">d</span><span class="op" id="5584766">.</span><span class="ident" id="5584767">bytes</span><span class="op" id="5584772">.</span><span class="ident" id="5584773">j</span><span class="op" id="5584774">-</span><span class="num" id="5584775">1</span><span class="op" id="5584776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584780">d</span><span class="op" id="5584781">.</span><span class="ident" id="5584782">bytes</span><span class="op" id="5584787">.</span><span class="ident" id="5584788">i</span><span class="op" id="5584789">,</span>&nbsp;<span class="ident" id="5584791">d</span><span class="op" id="5584792">.</span><span class="ident" id="5584793">bytes</span><span class="op" id="5584798">.</span><span class="ident" id="5584799">j</span>&nbsp;<span class="op" id="5584801">=</span>&nbsp;<span class="num" id="5584803">2</span><span class="op" id="5584804">,</span>&nbsp;<span class="num" id="5584806">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5584812">//&nbsp;Fill&nbsp;in&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584848">n</span><span class="op" id="5584849">,</span>&nbsp;<span class="ident" id="5584851">err</span>&nbsp;<span class="op" id="5584855">:=</span>&nbsp;<span class="ident" id="5584858">d</span><span class="op" id="5584859">.</span><span class="ident" id="5584860">r</span><span class="op" id="5584861">.</span><span class="ident" id="5584862">Read</span><span class="op" id="5584866">(</span><span class="ident" id="5584867">d</span><span class="op" id="5584868">.</span><span class="ident" id="5584869">bytes</span><span class="op" id="5584874">.</span><span class="ident" id="5584875">buf</span><span class="op" id="5584878">[</span><span class="ident" id="5584879">d</span><span class="op" id="5584880">.</span><span class="ident" id="5584881">bytes</span><span class="op" id="5584886">.</span><span class="ident" id="5584887">j</span><span class="op" id="5584888">:</span><span class="op" id="5584889">]</span><span class="op" id="5584890">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584893">d</span><span class="op" id="5584894">.</span><span class="ident" id="5584895">bytes</span><span class="op" id="5584900">.</span><span class="ident" id="5584901">j</span>&nbsp;<span class="op" id="5584903">+=</span>&nbsp;<span class="ident" id="5584906">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584909">if</span>&nbsp;<span class="ident" id="5584912">n</span>&nbsp;<span class="op" id="5584914">&gt;</span>&nbsp;<span class="num" id="5584916">0</span>&nbsp;<span class="op" id="5584918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5584922">err</span>&nbsp;<span class="op" id="5584926">=</span>&nbsp;<span class="builtintype" id="5584928">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5584933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5584936">return</span>&nbsp;<span class="ident" id="5584943">err</span><br>
<span class="lineno">150</span><span class="op" id="5584947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5584950">//&nbsp;unreadByteStuffedByte&nbsp;undoes&nbsp;the&nbsp;most&nbsp;recent&nbsp;readByteStuffedByte&nbsp;call,</span><br>
<span class="lineno"></span><span class="comment" id="5585024">//&nbsp;giving&nbsp;a&nbsp;byte&nbsp;of&nbsp;data&nbsp;back&nbsp;from&nbsp;d.bits&nbsp;to&nbsp;d.bytes.&nbsp;The&nbsp;Huffman&nbsp;look-up&nbsp;table</span><br>
<span class="lineno"></span><span class="comment" id="5585104">//&nbsp;requires&nbsp;at&nbsp;least&nbsp;8&nbsp;bits&nbsp;for&nbsp;look-up,&nbsp;which&nbsp;means&nbsp;that&nbsp;Huffman&nbsp;decoding&nbsp;can</span><br>
<span class="lineno">155</span><span class="comment" id="5585183">//&nbsp;sometimes&nbsp;overshoot&nbsp;and&nbsp;read&nbsp;one&nbsp;or&nbsp;two&nbsp;too&nbsp;many&nbsp;bytes.&nbsp;Two-byte&nbsp;overshoot</span><br>
<span class="lineno"></span><span class="comment" id="5585261">//&nbsp;can&nbsp;happen&nbsp;when&nbsp;expecting&nbsp;to&nbsp;read&nbsp;a&nbsp;0xff&nbsp;0x00&nbsp;byte-stuffed&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="5585329">func</span>&nbsp;<span class="op" id="5585334">(</span><span class="ident" id="5585335">d</span>&nbsp;<span class="op" id="5585337">*</span><span class="ident" id="5585338">decoder</span><span class="op" id="5585345">)</span>&nbsp;<span class="ident" id="5585347">unreadByteStuffedByte</span><span class="op" id="5585368">(</span><span class="op" id="5585369">)</span>&nbsp;<span class="op" id="5585371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585374">if</span>&nbsp;<span class="ident" id="5585377">d</span><span class="op" id="5585378">.</span><span class="ident" id="5585379">bytes</span><span class="op" id="5585384">.</span><span class="ident" id="5585385">nUnreadable</span>&nbsp;<span class="op" id="5585397">==</span>&nbsp;<span class="num" id="5585400">0</span>&nbsp;<span class="op" id="5585402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5585406">panic</span><span class="op" id="5585411">(</span><span class="string" id="5585412">&#34;jpeg:&nbsp;unreadByteStuffedByte&nbsp;call&nbsp;cannot&nbsp;be&nbsp;fulfilled&#34;</span><span class="op" id="5585466">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585472">d</span><span class="op" id="5585473">.</span><span class="ident" id="5585474">bytes</span><span class="op" id="5585479">.</span><span class="ident" id="5585480">i</span>&nbsp;<span class="op" id="5585482">-=</span>&nbsp;<span class="ident" id="5585485">d</span><span class="op" id="5585486">.</span><span class="ident" id="5585487">bytes</span><span class="op" id="5585492">.</span><span class="ident" id="5585493">nUnreadable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585506">d</span><span class="op" id="5585507">.</span><span class="ident" id="5585508">bytes</span><span class="op" id="5585513">.</span><span class="ident" id="5585514">nUnreadable</span>&nbsp;<span class="op" id="5585526">=</span>&nbsp;<span class="num" id="5585528">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585531">if</span>&nbsp;<span class="ident" id="5585534">d</span><span class="op" id="5585535">.</span><span class="ident" id="5585536">bits</span><span class="op" id="5585540">.</span><span class="ident" id="5585541">n</span>&nbsp;<span class="op" id="5585543">&gt;=</span>&nbsp;<span class="num" id="5585546">8</span>&nbsp;<span class="op" id="5585548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585552">d</span><span class="op" id="5585553">.</span><span class="ident" id="5585554">bits</span><span class="op" id="5585558">.</span><span class="ident" id="5585559">a</span>&nbsp;<span class="op" id="5585561">&gt;&gt;=</span>&nbsp;<span class="num" id="5585565">8</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585569">d</span><span class="op" id="5585570">.</span><span class="ident" id="5585571">bits</span><span class="op" id="5585575">.</span><span class="ident" id="5585576">n</span>&nbsp;<span class="op" id="5585578">-=</span>&nbsp;<span class="num" id="5585581">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585585">d</span><span class="op" id="5585586">.</span><span class="ident" id="5585587">bits</span><span class="op" id="5585591">.</span><span class="ident" id="5585592">m</span>&nbsp;<span class="op" id="5585594">&gt;&gt;=</span>&nbsp;<span class="num" id="5585598">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585601">}</span><br>
<span class="lineno"></span><span class="op" id="5585603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="5585606">//&nbsp;readByte&nbsp;returns&nbsp;the&nbsp;next&nbsp;byte,&nbsp;whether&nbsp;buffered&nbsp;or&nbsp;not&nbsp;buffered.&nbsp;It&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5585683">//&nbsp;not&nbsp;care&nbsp;about&nbsp;byte&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="5585716">func</span>&nbsp;<span class="op" id="5585721">(</span><span class="ident" id="5585722">d</span>&nbsp;<span class="op" id="5585724">*</span><span class="ident" id="5585725">decoder</span><span class="op" id="5585732">)</span>&nbsp;<span class="ident" id="5585734">readByte</span><span class="op" id="5585742">(</span><span class="op" id="5585743">)</span>&nbsp;<span class="op" id="5585745">(</span><span class="ident" id="5585746">x</span>&nbsp;<span class="builtintype" id="5585748">byte</span><span class="op" id="5585752">,</span>&nbsp;<span class="ident" id="5585754">err</span>&nbsp;<span class="builtintype" id="5585758">error</span><span class="op" id="5585763">)</span>&nbsp;<span class="op" id="5585765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585768">for</span>&nbsp;<span class="ident" id="5585772">d</span><span class="op" id="5585773">.</span><span class="ident" id="5585774">bytes</span><span class="op" id="5585779">.</span><span class="ident" id="5585780">i</span>&nbsp;<span class="op" id="5585782">==</span>&nbsp;<span class="ident" id="5585785">d</span><span class="op" id="5585786">.</span><span class="ident" id="5585787">bytes</span><span class="op" id="5585792">.</span><span class="ident" id="5585793">j</span>&nbsp;<span class="op" id="5585795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585799">if</span>&nbsp;<span class="ident" id="5585802">err</span>&nbsp;<span class="op" id="5585806">=</span>&nbsp;<span class="ident" id="5585808">d</span><span class="op" id="5585809">.</span><span class="ident" id="5585810">fill</span><span class="op" id="5585814">(</span><span class="op" id="5585815">)</span><span class="op" id="5585816">;</span>&nbsp;<span class="ident" id="5585818">err</span>&nbsp;<span class="op" id="5585822">!=</span>&nbsp;<span class="builtintype" id="5585825">nil</span>&nbsp;<span class="op" id="5585829">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585834">return</span>&nbsp;<span class="num" id="5585841">0</span><span class="op" id="5585842">,</span>&nbsp;<span class="ident" id="5585844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5585853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585856">x</span>&nbsp;<span class="op" id="5585858">=</span>&nbsp;<span class="ident" id="5585860">d</span><span class="op" id="5585861">.</span><span class="ident" id="5585862">bytes</span><span class="op" id="5585867">.</span><span class="ident" id="5585868">buf</span><span class="op" id="5585871">[</span><span class="ident" id="5585872">d</span><span class="op" id="5585873">.</span><span class="ident" id="5585874">bytes</span><span class="op" id="5585879">.</span><span class="ident" id="5585880">i</span><span class="op" id="5585881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585884">d</span><span class="op" id="5585885">.</span><span class="ident" id="5585886">bytes</span><span class="op" id="5585891">.</span><span class="ident" id="5585892">i</span><span class="op" id="5585893">++</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5585897">d</span><span class="op" id="5585898">.</span><span class="ident" id="5585899">bytes</span><span class="op" id="5585904">.</span><span class="ident" id="5585905">nUnreadable</span>&nbsp;<span class="op" id="5585917">=</span>&nbsp;<span class="num" id="5585919">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5585922">return</span>&nbsp;<span class="ident" id="5585929">x</span><span class="op" id="5585930">,</span>&nbsp;<span class="builtintype" id="5585932">nil</span><br>
<span class="lineno"></span><span class="op" id="5585936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585939">//&nbsp;errMissingFF00&nbsp;means&nbsp;that&nbsp;readByteStuffedByte&nbsp;encountered&nbsp;an&nbsp;0xff&nbsp;byte&nbsp;(a</span><br>
<span class="lineno">185</span><span class="comment" id="5586016">//&nbsp;marker&nbsp;byte)&nbsp;that&nbsp;wasn&#39;t&nbsp;the&nbsp;expected&nbsp;byte-stuffed&nbsp;sequence&nbsp;0xff,&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5586091">var</span>&nbsp;<span class="ident" id="5586095">errMissingFF00</span>&nbsp;<span class="op" id="5586110">=</span>&nbsp;<span class="ident" id="5586112">FormatError</span><span class="op" id="5586123">(</span><span class="string" id="5586124">&#34;missing&nbsp;0xff00&nbsp;sequence&#34;</span><span class="op" id="5586149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586152">//&nbsp;readByteStuffedByte&nbsp;is&nbsp;like&nbsp;readByte&nbsp;but&nbsp;is&nbsp;for&nbsp;byte-stuffed&nbsp;Huffman&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5586230">func</span>&nbsp;<span class="op" id="5586235">(</span><span class="ident" id="5586236">d</span>&nbsp;<span class="op" id="5586238">*</span><span class="ident" id="5586239">decoder</span><span class="op" id="5586246">)</span>&nbsp;<span class="ident" id="5586248">readByteStuffedByte</span><span class="op" id="5586267">(</span><span class="op" id="5586268">)</span>&nbsp;<span class="op" id="5586270">(</span><span class="ident" id="5586271">x</span>&nbsp;<span class="builtintype" id="5586273">byte</span><span class="op" id="5586277">,</span>&nbsp;<span class="ident" id="5586279">err</span>&nbsp;<span class="builtintype" id="5586283">error</span><span class="op" id="5586288">)</span>&nbsp;<span class="op" id="5586290">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5586293">//&nbsp;Take&nbsp;the&nbsp;fast&nbsp;path&nbsp;if&nbsp;d.bytes.buf&nbsp;contains&nbsp;at&nbsp;least&nbsp;two&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586360">if</span>&nbsp;<span class="ident" id="5586363">d</span><span class="op" id="5586364">.</span><span class="ident" id="5586365">bytes</span><span class="op" id="5586370">.</span><span class="ident" id="5586371">i</span><span class="op" id="5586372">+</span><span class="num" id="5586373">2</span>&nbsp;<span class="op" id="5586375">&lt;=</span>&nbsp;<span class="ident" id="5586378">d</span><span class="op" id="5586379">.</span><span class="ident" id="5586380">bytes</span><span class="op" id="5586385">.</span><span class="ident" id="5586386">j</span>&nbsp;<span class="op" id="5586388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586392">x</span>&nbsp;<span class="op" id="5586394">=</span>&nbsp;<span class="ident" id="5586396">d</span><span class="op" id="5586397">.</span><span class="ident" id="5586398">bytes</span><span class="op" id="5586403">.</span><span class="ident" id="5586404">buf</span><span class="op" id="5586407">[</span><span class="ident" id="5586408">d</span><span class="op" id="5586409">.</span><span class="ident" id="5586410">bytes</span><span class="op" id="5586415">.</span><span class="ident" id="5586416">i</span><span class="op" id="5586417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586421">d</span><span class="op" id="5586422">.</span><span class="ident" id="5586423">bytes</span><span class="op" id="5586428">.</span><span class="ident" id="5586429">i</span><span class="op" id="5586430">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586435">d</span><span class="op" id="5586436">.</span><span class="ident" id="5586437">bytes</span><span class="op" id="5586442">.</span><span class="ident" id="5586443">nUnreadable</span>&nbsp;<span class="op" id="5586455">=</span>&nbsp;<span class="num" id="5586457">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586461">if</span>&nbsp;<span class="ident" id="5586464">x</span>&nbsp;<span class="op" id="5586466">!=</span>&nbsp;<span class="num" id="5586469">0xff</span>&nbsp;<span class="op" id="5586474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586479">return</span>&nbsp;<span class="ident" id="5586486">x</span><span class="op" id="5586487">,</span>&nbsp;<span class="ident" id="5586489">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586499">if</span>&nbsp;<span class="ident" id="5586502">d</span><span class="op" id="5586503">.</span><span class="ident" id="5586504">bytes</span><span class="op" id="5586509">.</span><span class="ident" id="5586510">buf</span><span class="op" id="5586513">[</span><span class="ident" id="5586514">d</span><span class="op" id="5586515">.</span><span class="ident" id="5586516">bytes</span><span class="op" id="5586521">.</span><span class="ident" id="5586522">i</span><span class="op" id="5586523">]</span>&nbsp;<span class="op" id="5586525">!=</span>&nbsp;<span class="num" id="5586528">0x00</span>&nbsp;<span class="op" id="5586533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586538">return</span>&nbsp;<span class="num" id="5586545">0</span><span class="op" id="5586546">,</span>&nbsp;<span class="ident" id="5586548">errMissingFF00</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586569">d</span><span class="op" id="5586570">.</span><span class="ident" id="5586571">bytes</span><span class="op" id="5586576">.</span><span class="ident" id="5586577">i</span><span class="op" id="5586578">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586583">d</span><span class="op" id="5586584">.</span><span class="ident" id="5586585">bytes</span><span class="op" id="5586590">.</span><span class="ident" id="5586591">nUnreadable</span>&nbsp;<span class="op" id="5586603">=</span>&nbsp;<span class="num" id="5586605">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586609">return</span>&nbsp;<span class="num" id="5586616">0xff</span><span class="op" id="5586620">,</span>&nbsp;<span class="builtintype" id="5586622">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586627">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586631">x</span><span class="op" id="5586632">,</span>&nbsp;<span class="ident" id="5586634">err</span>&nbsp;<span class="op" id="5586638">=</span>&nbsp;<span class="ident" id="5586640">d</span><span class="op" id="5586641">.</span><span class="ident" id="5586642">readByte</span><span class="op" id="5586650">(</span><span class="op" id="5586651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586654">if</span>&nbsp;<span class="ident" id="5586657">err</span>&nbsp;<span class="op" id="5586661">!=</span>&nbsp;<span class="builtintype" id="5586664">nil</span>&nbsp;<span class="op" id="5586668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586672">return</span>&nbsp;<span class="num" id="5586679">0</span><span class="op" id="5586680">,</span>&nbsp;<span class="ident" id="5586682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586687">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586690">if</span>&nbsp;<span class="ident" id="5586693">x</span>&nbsp;<span class="op" id="5586695">!=</span>&nbsp;<span class="num" id="5586698">0xff</span>&nbsp;<span class="op" id="5586703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586707">d</span><span class="op" id="5586708">.</span><span class="ident" id="5586709">bytes</span><span class="op" id="5586714">.</span><span class="ident" id="5586715">nUnreadable</span>&nbsp;<span class="op" id="5586727">=</span>&nbsp;<span class="num" id="5586729">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586733">return</span>&nbsp;<span class="ident" id="5586740">x</span><span class="op" id="5586741">,</span>&nbsp;<span class="builtintype" id="5586743">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586752">x</span><span class="op" id="5586753">,</span>&nbsp;<span class="ident" id="5586755">err</span>&nbsp;<span class="op" id="5586759">=</span>&nbsp;<span class="ident" id="5586761">d</span><span class="op" id="5586762">.</span><span class="ident" id="5586763">readByte</span><span class="op" id="5586771">(</span><span class="op" id="5586772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586775">if</span>&nbsp;<span class="ident" id="5586778">err</span>&nbsp;<span class="op" id="5586782">!=</span>&nbsp;<span class="builtintype" id="5586785">nil</span>&nbsp;<span class="op" id="5586789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586793">d</span><span class="op" id="5586794">.</span><span class="ident" id="5586795">bytes</span><span class="op" id="5586800">.</span><span class="ident" id="5586801">nUnreadable</span>&nbsp;<span class="op" id="5586813">=</span>&nbsp;<span class="num" id="5586815">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586819">return</span>&nbsp;<span class="num" id="5586826">0</span><span class="op" id="5586827">,</span>&nbsp;<span class="ident" id="5586829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586834">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5586837">d</span><span class="op" id="5586838">.</span><span class="ident" id="5586839">bytes</span><span class="op" id="5586844">.</span><span class="ident" id="5586845">nUnreadable</span>&nbsp;<span class="op" id="5586857">=</span>&nbsp;<span class="num" id="5586859">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586862">if</span>&nbsp;<span class="ident" id="5586865">x</span>&nbsp;<span class="op" id="5586867">!=</span>&nbsp;<span class="num" id="5586870">0x00</span>&nbsp;<span class="op" id="5586875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586879">return</span>&nbsp;<span class="num" id="5586886">0</span><span class="op" id="5586887">,</span>&nbsp;<span class="ident" id="5586889">errMissingFF00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5586905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5586908">return</span>&nbsp;<span class="num" id="5586915">0xff</span><span class="op" id="5586919">,</span>&nbsp;<span class="builtintype" id="5586921">nil</span><br>
<span class="lineno">225</span><span class="op" id="5586925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586928">//&nbsp;readFull&nbsp;reads&nbsp;exactly&nbsp;len(p)&nbsp;bytes&nbsp;into&nbsp;p.&nbsp;It&nbsp;does&nbsp;not&nbsp;care&nbsp;about&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5587003">//&nbsp;stuffing.</span><br>
<span class="lineno"></span><span class="keyword" id="5587016">func</span>&nbsp;<span class="op" id="5587021">(</span><span class="ident" id="5587022">d</span>&nbsp;<span class="op" id="5587024">*</span><span class="ident" id="5587025">decoder</span><span class="op" id="5587032">)</span>&nbsp;<span class="ident" id="5587034">readFull</span><span class="op" id="5587042">(</span><span class="ident" id="5587043">p</span>&nbsp;<span class="op" id="5587045">[</span><span class="op" id="5587046">]</span><span class="builtintype" id="5587047">byte</span><span class="op" id="5587051">)</span>&nbsp;<span class="builtintype" id="5587053">error</span>&nbsp;<span class="op" id="5587059">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587062">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587101">if</span>&nbsp;<span class="ident" id="5587104">d</span><span class="op" id="5587105">.</span><span class="ident" id="5587106">bytes</span><span class="op" id="5587111">.</span><span class="ident" id="5587112">nUnreadable</span>&nbsp;<span class="op" id="5587124">!=</span>&nbsp;<span class="num" id="5587127">0</span>&nbsp;<span class="op" id="5587129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587133">if</span>&nbsp;<span class="ident" id="5587136">d</span><span class="op" id="5587137">.</span><span class="ident" id="5587138">bits</span><span class="op" id="5587142">.</span><span class="ident" id="5587143">n</span>&nbsp;<span class="op" id="5587145">&gt;=</span>&nbsp;<span class="num" id="5587148">8</span>&nbsp;<span class="op" id="5587150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587155">d</span><span class="op" id="5587156">.</span><span class="ident" id="5587157">unreadByteStuffedByte</span><span class="op" id="5587178">(</span><span class="op" id="5587179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587183">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587187">d</span><span class="op" id="5587188">.</span><span class="ident" id="5587189">bytes</span><span class="op" id="5587194">.</span><span class="ident" id="5587195">nUnreadable</span>&nbsp;<span class="op" id="5587207">=</span>&nbsp;<span class="num" id="5587209">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587216">for</span>&nbsp;<span class="op" id="5587220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587224">n</span>&nbsp;<span class="op" id="5587226">:=</span>&nbsp;<span class="builtinfunc" id="5587229">copy</span><span class="op" id="5587233">(</span><span class="ident" id="5587234">p</span><span class="op" id="5587235">,</span>&nbsp;<span class="ident" id="5587237">d</span><span class="op" id="5587238">.</span><span class="ident" id="5587239">bytes</span><span class="op" id="5587244">.</span><span class="ident" id="5587245">buf</span><span class="op" id="5587248">[</span><span class="ident" id="5587249">d</span><span class="op" id="5587250">.</span><span class="ident" id="5587251">bytes</span><span class="op" id="5587256">.</span><span class="ident" id="5587257">i</span><span class="op" id="5587258">:</span><span class="ident" id="5587259">d</span><span class="op" id="5587260">.</span><span class="ident" id="5587261">bytes</span><span class="op" id="5587266">.</span><span class="ident" id="5587267">j</span><span class="op" id="5587268">]</span><span class="op" id="5587269">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587273">p</span>&nbsp;<span class="op" id="5587275">=</span>&nbsp;<span class="ident" id="5587277">p</span><span class="op" id="5587278">[</span><span class="ident" id="5587279">n</span><span class="op" id="5587280">:</span><span class="op" id="5587281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587285">d</span><span class="op" id="5587286">.</span><span class="ident" id="5587287">bytes</span><span class="op" id="5587292">.</span><span class="ident" id="5587293">i</span>&nbsp;<span class="op" id="5587295">+=</span>&nbsp;<span class="ident" id="5587298">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587302">if</span>&nbsp;<span class="builtinfunc" id="5587305">len</span><span class="op" id="5587308">(</span><span class="ident" id="5587309">p</span><span class="op" id="5587310">)</span>&nbsp;<span class="op" id="5587312">==</span>&nbsp;<span class="num" id="5587315">0</span>&nbsp;<span class="op" id="5587317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587322">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587330">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587334">if</span>&nbsp;<span class="ident" id="5587337">err</span>&nbsp;<span class="op" id="5587341">:=</span>&nbsp;<span class="ident" id="5587344">d</span><span class="op" id="5587345">.</span><span class="ident" id="5587346">fill</span><span class="op" id="5587350">(</span><span class="op" id="5587351">)</span><span class="op" id="5587352">;</span>&nbsp;<span class="ident" id="5587354">err</span>&nbsp;<span class="op" id="5587358">!=</span>&nbsp;<span class="builtintype" id="5587361">nil</span>&nbsp;<span class="op" id="5587365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587370">if</span>&nbsp;<span class="ident" id="5587373">err</span>&nbsp;<span class="op" id="5587377">==</span>&nbsp;<span class="ident" id="5587380">io</span><span class="op" id="5587382">.</span><span class="ident" id="5587383">EOF</span>&nbsp;<span class="op" id="5587387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587393">err</span>&nbsp;<span class="op" id="5587397">=</span>&nbsp;<span class="ident" id="5587399">io</span><span class="op" id="5587401">.</span><span class="ident" id="5587402">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587427">return</span>&nbsp;<span class="ident" id="5587434">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587446">return</span>&nbsp;<span class="builtintype" id="5587453">nil</span><br>
<span class="lineno"></span><span class="op" id="5587457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5587460">//&nbsp;ignore&nbsp;ignores&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5587496">func</span>&nbsp;<span class="op" id="5587501">(</span><span class="ident" id="5587502">d</span>&nbsp;<span class="op" id="5587504">*</span><span class="ident" id="5587505">decoder</span><span class="op" id="5587512">)</span>&nbsp;<span class="ident" id="5587514">ignore</span><span class="op" id="5587520">(</span><span class="ident" id="5587521">n</span>&nbsp;<span class="builtintype" id="5587523">int</span><span class="op" id="5587526">)</span>&nbsp;<span class="builtintype" id="5587528">error</span>&nbsp;<span class="op" id="5587534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5587537">//&nbsp;Unread&nbsp;the&nbsp;overshot&nbsp;bytes,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587576">if</span>&nbsp;<span class="ident" id="5587579">d</span><span class="op" id="5587580">.</span><span class="ident" id="5587581">bytes</span><span class="op" id="5587586">.</span><span class="ident" id="5587587">nUnreadable</span>&nbsp;<span class="op" id="5587599">!=</span>&nbsp;<span class="num" id="5587602">0</span>&nbsp;<span class="op" id="5587604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587608">if</span>&nbsp;<span class="ident" id="5587611">d</span><span class="op" id="5587612">.</span><span class="ident" id="5587613">bits</span><span class="op" id="5587617">.</span><span class="ident" id="5587618">n</span>&nbsp;<span class="op" id="5587620">&gt;=</span>&nbsp;<span class="num" id="5587623">8</span>&nbsp;<span class="op" id="5587625">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587630">d</span><span class="op" id="5587631">.</span><span class="ident" id="5587632">unreadByteStuffedByte</span><span class="op" id="5587653">(</span><span class="op" id="5587654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587662">d</span><span class="op" id="5587663">.</span><span class="ident" id="5587664">bytes</span><span class="op" id="5587669">.</span><span class="ident" id="5587670">nUnreadable</span>&nbsp;<span class="op" id="5587682">=</span>&nbsp;<span class="num" id="5587684">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587691">for</span>&nbsp;<span class="op" id="5587695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587699">m</span>&nbsp;<span class="op" id="5587701">:=</span>&nbsp;<span class="ident" id="5587704">d</span><span class="op" id="5587705">.</span><span class="ident" id="5587706">bytes</span><span class="op" id="5587711">.</span><span class="ident" id="5587712">j</span>&nbsp;<span class="op" id="5587714">-</span>&nbsp;<span class="ident" id="5587716">d</span><span class="op" id="5587717">.</span><span class="ident" id="5587718">bytes</span><span class="op" id="5587723">.</span><span class="ident" id="5587724">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587728">if</span>&nbsp;<span class="ident" id="5587731">m</span>&nbsp;<span class="op" id="5587733">&gt;</span>&nbsp;<span class="ident" id="5587735">n</span>&nbsp;<span class="op" id="5587737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587742">m</span>&nbsp;<span class="op" id="5587744">=</span>&nbsp;<span class="ident" id="5587746">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587750">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587754">d</span><span class="op" id="5587755">.</span><span class="ident" id="5587756">bytes</span><span class="op" id="5587761">.</span><span class="ident" id="5587762">i</span>&nbsp;<span class="op" id="5587764">+=</span>&nbsp;<span class="ident" id="5587767">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587771">n</span>&nbsp;<span class="op" id="5587773">-=</span>&nbsp;<span class="ident" id="5587776">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587780">if</span>&nbsp;<span class="ident" id="5587783">n</span>&nbsp;<span class="op" id="5587785">==</span>&nbsp;<span class="num" id="5587788">0</span>&nbsp;<span class="op" id="5587790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587795">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587803">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587807">if</span>&nbsp;<span class="ident" id="5587810">err</span>&nbsp;<span class="op" id="5587814">:=</span>&nbsp;<span class="ident" id="5587817">d</span><span class="op" id="5587818">.</span><span class="ident" id="5587819">fill</span><span class="op" id="5587823">(</span><span class="op" id="5587824">)</span><span class="op" id="5587825">;</span>&nbsp;<span class="ident" id="5587827">err</span>&nbsp;<span class="op" id="5587831">!=</span>&nbsp;<span class="builtintype" id="5587834">nil</span>&nbsp;<span class="op" id="5587838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587843">if</span>&nbsp;<span class="ident" id="5587846">err</span>&nbsp;<span class="op" id="5587850">==</span>&nbsp;<span class="ident" id="5587853">io</span><span class="op" id="5587855">.</span><span class="ident" id="5587856">EOF</span>&nbsp;<span class="op" id="5587860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5587866">err</span>&nbsp;<span class="op" id="5587870">=</span>&nbsp;<span class="ident" id="5587872">io</span><span class="op" id="5587874">.</span><span class="ident" id="5587875">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587900">return</span>&nbsp;<span class="ident" id="5587907">err</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5587916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5587919">return</span>&nbsp;<span class="builtintype" id="5587926">nil</span><br>
<span class="lineno"></span><span class="op" id="5587930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="comment" id="5587933">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.2.</span><br>
<span class="lineno"></span><span class="keyword" id="5587964">func</span>&nbsp;<span class="op" id="5587969">(</span><span class="ident" id="5587970">d</span>&nbsp;<span class="op" id="5587972">*</span><span class="ident" id="5587973">decoder</span><span class="op" id="5587980">)</span>&nbsp;<span class="ident" id="5587982">processSOF</span><span class="op" id="5587992">(</span><span class="ident" id="5587993">n</span>&nbsp;<span class="builtintype" id="5587995">int</span><span class="op" id="5587998">)</span>&nbsp;<span class="builtintype" id="5588000">error</span>&nbsp;<span class="op" id="5588006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588009">switch</span>&nbsp;<span class="ident" id="5588016">n</span>&nbsp;<span class="op" id="5588018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588021">case</span>&nbsp;<span class="num" id="5588026">6</span>&nbsp;<span class="op" id="5588028">+</span>&nbsp;<span class="num" id="5588030">3</span><span class="op" id="5588031">*</span><span class="ident" id="5588032">nGrayComponent</span><span class="op" id="5588046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588050">d</span><span class="op" id="5588051">.</span><span class="ident" id="5588052">nComp</span>&nbsp;<span class="op" id="5588058">=</span>&nbsp;<span class="ident" id="5588060">nGrayComponent</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588076">case</span>&nbsp;<span class="num" id="5588081">6</span>&nbsp;<span class="op" id="5588083">+</span>&nbsp;<span class="num" id="5588085">3</span><span class="op" id="5588086">*</span><span class="ident" id="5588087">nColorComponent</span><span class="op" id="5588102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588106">d</span><span class="op" id="5588107">.</span><span class="ident" id="5588108">nComp</span>&nbsp;<span class="op" id="5588114">=</span>&nbsp;<span class="ident" id="5588116">nColorComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588133">default</span><span class="op" id="5588140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588144">return</span>&nbsp;<span class="ident" id="5588151">UnsupportedError</span><span class="op" id="5588167">(</span><span class="string" id="5588168">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5588190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588193">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588196">if</span>&nbsp;<span class="ident" id="5588199">err</span>&nbsp;<span class="op" id="5588203">:=</span>&nbsp;<span class="ident" id="5588206">d</span><span class="op" id="5588207">.</span><span class="ident" id="5588208">readFull</span><span class="op" id="5588216">(</span><span class="ident" id="5588217">d</span><span class="op" id="5588218">.</span><span class="ident" id="5588219">tmp</span><span class="op" id="5588222">[</span><span class="op" id="5588223">:</span><span class="ident" id="5588224">n</span><span class="op" id="5588225">]</span><span class="op" id="5588226">)</span><span class="op" id="5588227">;</span>&nbsp;<span class="ident" id="5588229">err</span>&nbsp;<span class="op" id="5588233">!=</span>&nbsp;<span class="builtintype" id="5588236">nil</span>&nbsp;<span class="op" id="5588240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588244">return</span>&nbsp;<span class="ident" id="5588251">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588259">//&nbsp;We&nbsp;only&nbsp;support&nbsp;8-bit&nbsp;precision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588296">if</span>&nbsp;<span class="ident" id="5588299">d</span><span class="op" id="5588300">.</span><span class="ident" id="5588301">tmp</span><span class="op" id="5588304">[</span><span class="num" id="5588305">0</span><span class="op" id="5588306">]</span>&nbsp;<span class="op" id="5588308">!=</span>&nbsp;<span class="num" id="5588311">8</span>&nbsp;<span class="op" id="5588313">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588317">return</span>&nbsp;<span class="ident" id="5588324">UnsupportedError</span><span class="op" id="5588340">(</span><span class="string" id="5588341">&#34;precision&#34;</span><span class="op" id="5588352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588358">d</span><span class="op" id="5588359">.</span><span class="ident" id="5588360">height</span>&nbsp;<span class="op" id="5588367">=</span>&nbsp;<span class="builtintype" id="5588369">int</span><span class="op" id="5588372">(</span><span class="ident" id="5588373">d</span><span class="op" id="5588374">.</span><span class="ident" id="5588375">tmp</span><span class="op" id="5588378">[</span><span class="num" id="5588379">1</span><span class="op" id="5588380">]</span><span class="op" id="5588381">)</span><span class="op" id="5588382">&lt;&lt;</span><span class="num" id="5588384">8</span>&nbsp;<span class="op" id="5588386">+</span>&nbsp;<span class="builtintype" id="5588388">int</span><span class="op" id="5588391">(</span><span class="ident" id="5588392">d</span><span class="op" id="5588393">.</span><span class="ident" id="5588394">tmp</span><span class="op" id="5588397">[</span><span class="num" id="5588398">2</span><span class="op" id="5588399">]</span><span class="op" id="5588400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588403">d</span><span class="op" id="5588404">.</span><span class="ident" id="5588405">width</span>&nbsp;<span class="op" id="5588411">=</span>&nbsp;<span class="builtintype" id="5588413">int</span><span class="op" id="5588416">(</span><span class="ident" id="5588417">d</span><span class="op" id="5588418">.</span><span class="ident" id="5588419">tmp</span><span class="op" id="5588422">[</span><span class="num" id="5588423">3</span><span class="op" id="5588424">]</span><span class="op" id="5588425">)</span><span class="op" id="5588426">&lt;&lt;</span><span class="num" id="5588428">8</span>&nbsp;<span class="op" id="5588430">+</span>&nbsp;<span class="builtintype" id="5588432">int</span><span class="op" id="5588435">(</span><span class="ident" id="5588436">d</span><span class="op" id="5588437">.</span><span class="ident" id="5588438">tmp</span><span class="op" id="5588441">[</span><span class="num" id="5588442">4</span><span class="op" id="5588443">]</span><span class="op" id="5588444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588447">if</span>&nbsp;<span class="builtintype" id="5588450">int</span><span class="op" id="5588453">(</span><span class="ident" id="5588454">d</span><span class="op" id="5588455">.</span><span class="ident" id="5588456">tmp</span><span class="op" id="5588459">[</span><span class="num" id="5588460">5</span><span class="op" id="5588461">]</span><span class="op" id="5588462">)</span>&nbsp;<span class="op" id="5588464">!=</span>&nbsp;<span class="ident" id="5588467">d</span><span class="op" id="5588468">.</span><span class="ident" id="5588469">nComp</span>&nbsp;<span class="op" id="5588475">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588479">return</span>&nbsp;<span class="ident" id="5588486">UnsupportedError</span><span class="op" id="5588502">(</span><span class="string" id="5588503">&#34;SOF&nbsp;has&nbsp;wrong&nbsp;number&nbsp;of&nbsp;image&nbsp;components&#34;</span><span class="op" id="5588545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5588548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588551">for</span>&nbsp;<span class="ident" id="5588555">i</span>&nbsp;<span class="op" id="5588557">:=</span>&nbsp;<span class="num" id="5588560">0</span><span class="op" id="5588561">;</span>&nbsp;<span class="ident" id="5588563">i</span>&nbsp;<span class="op" id="5588565">&lt;</span>&nbsp;<span class="ident" id="5588567">d</span><span class="op" id="5588568">.</span><span class="ident" id="5588569">nComp</span><span class="op" id="5588574">;</span>&nbsp;<span class="ident" id="5588576">i</span><span class="op" id="5588577">++</span>&nbsp;<span class="op" id="5588580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588584">d</span><span class="op" id="5588585">.</span><span class="ident" id="5588586">comp</span><span class="op" id="5588590">[</span><span class="ident" id="5588591">i</span><span class="op" id="5588592">]</span><span class="op" id="5588593">.</span><span class="ident" id="5588594">c</span>&nbsp;<span class="op" id="5588596">=</span>&nbsp;<span class="ident" id="5588598">d</span><span class="op" id="5588599">.</span><span class="ident" id="5588600">tmp</span><span class="op" id="5588603">[</span><span class="num" id="5588604">6</span><span class="op" id="5588605">+</span><span class="num" id="5588606">3</span><span class="op" id="5588607">*</span><span class="ident" id="5588608">i</span><span class="op" id="5588609">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5588613">d</span><span class="op" id="5588614">.</span><span class="ident" id="5588615">comp</span><span class="op" id="5588619">[</span><span class="ident" id="5588620">i</span><span class="op" id="5588621">]</span><span class="op" id="5588622">.</span><span class="ident" id="5588623">tq</span>&nbsp;<span class="op" id="5588626">=</span>&nbsp;<span class="ident" id="5588628">d</span><span class="op" id="5588629">.</span><span class="ident" id="5588630">tmp</span><span class="op" id="5588633">[</span><span class="num" id="5588634">8</span><span class="op" id="5588635">+</span><span class="num" id="5588636">3</span><span class="op" id="5588637">*</span><span class="ident" id="5588638">i</span><span class="op" id="5588639">]</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5588643">if</span>&nbsp;<span class="ident" id="5588646">d</span><span class="op" id="5588647">.</span><span class="ident" id="5588648">nComp</span>&nbsp;<span class="op" id="5588654">==</span>&nbsp;<span class="ident" id="5588657">nGrayComponent</span>&nbsp;<span class="op" id="5588672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588677">//&nbsp;If&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;has&nbsp;only&nbsp;one&nbsp;component,&nbsp;section&nbsp;A.2&nbsp;says&nbsp;&#34;this&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588751">//&nbsp;is&nbsp;non-interleaved&nbsp;by&nbsp;definition&#34;&nbsp;and&nbsp;section&nbsp;A.2.2&nbsp;says&nbsp;&#34;[in&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588824">//&nbsp;case...]&nbsp;the&nbsp;order&nbsp;of&nbsp;data&nbsp;units&nbsp;within&nbsp;a&nbsp;scan&nbsp;shall&nbsp;be&nbsp;left-to-right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588900">//&nbsp;and&nbsp;top-to-bottom...&nbsp;regardless&nbsp;of&nbsp;the&nbsp;values&nbsp;of&nbsp;H_1&nbsp;and&nbsp;V_1&#34;.&nbsp;Section</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5588977">//&nbsp;4.8.2&nbsp;also&nbsp;says&nbsp;&#34;[for&nbsp;non-interleaved&nbsp;data],&nbsp;the&nbsp;MCU&nbsp;is&nbsp;defined&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589053">//&nbsp;one&nbsp;data&nbsp;unit&#34;.&nbsp;Similarly,&nbsp;section&nbsp;A.1.1&nbsp;explains&nbsp;that&nbsp;it&nbsp;is&nbsp;the&nbsp;ratio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589130">//&nbsp;of&nbsp;H_i&nbsp;to&nbsp;max_j(H_j)&nbsp;that&nbsp;matters,&nbsp;and&nbsp;similarly&nbsp;for&nbsp;V.&nbsp;For&nbsp;grayscale</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589206">//&nbsp;images,&nbsp;H_1&nbsp;is&nbsp;the&nbsp;maximum&nbsp;H_j&nbsp;for&nbsp;all&nbsp;components&nbsp;j,&nbsp;so&nbsp;that&nbsp;ratio&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589282">//&nbsp;always&nbsp;1.&nbsp;The&nbsp;component&#39;s&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;effectively&nbsp;always&nbsp;(1,&nbsp;1):&nbsp;even&nbsp;if</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589359">//&nbsp;the&nbsp;nominal&nbsp;(h,&nbsp;v)&nbsp;is&nbsp;(2,&nbsp;1),&nbsp;a&nbsp;20x5&nbsp;image&nbsp;is&nbsp;encoded&nbsp;in&nbsp;three&nbsp;8x8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589432">//&nbsp;MCUs,&nbsp;not&nbsp;two&nbsp;16x8&nbsp;MCUs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589463">d</span><span class="op" id="5589464">.</span><span class="ident" id="5589465">comp</span><span class="op" id="5589469">[</span><span class="ident" id="5589470">i</span><span class="op" id="5589471">]</span><span class="op" id="5589472">.</span><span class="ident" id="5589473">h</span>&nbsp;<span class="op" id="5589475">=</span>&nbsp;<span class="num" id="5589477">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589482">d</span><span class="op" id="5589483">.</span><span class="ident" id="5589484">comp</span><span class="op" id="5589488">[</span><span class="ident" id="5589489">i</span><span class="op" id="5589490">]</span><span class="op" id="5589491">.</span><span class="ident" id="5589492">v</span>&nbsp;<span class="op" id="5589494">=</span>&nbsp;<span class="num" id="5589496">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589501">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5589512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589516">hv</span>&nbsp;<span class="op" id="5589519">:=</span>&nbsp;<span class="ident" id="5589522">d</span><span class="op" id="5589523">.</span><span class="ident" id="5589524">tmp</span><span class="op" id="5589527">[</span><span class="num" id="5589528">7</span><span class="op" id="5589529">+</span><span class="num" id="5589530">3</span><span class="op" id="5589531">*</span><span class="ident" id="5589532">i</span><span class="op" id="5589533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589537">d</span><span class="op" id="5589538">.</span><span class="ident" id="5589539">comp</span><span class="op" id="5589543">[</span><span class="ident" id="5589544">i</span><span class="op" id="5589545">]</span><span class="op" id="5589546">.</span><span class="ident" id="5589547">h</span>&nbsp;<span class="op" id="5589549">=</span>&nbsp;<span class="builtintype" id="5589551">int</span><span class="op" id="5589554">(</span><span class="ident" id="5589555">hv</span>&nbsp;<span class="op" id="5589558">&gt;&gt;</span>&nbsp;<span class="num" id="5589561">4</span><span class="op" id="5589562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5589566">d</span><span class="op" id="5589567">.</span><span class="ident" id="5589568">comp</span><span class="op" id="5589572">[</span><span class="ident" id="5589573">i</span><span class="op" id="5589574">]</span><span class="op" id="5589575">.</span><span class="ident" id="5589576">v</span>&nbsp;<span class="op" id="5589578">=</span>&nbsp;<span class="builtintype" id="5589580">int</span><span class="op" id="5589583">(</span><span class="ident" id="5589584">hv</span>&nbsp;<span class="op" id="5589587">&amp;</span>&nbsp;<span class="num" id="5589589">0x0f</span><span class="op" id="5589593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589597">//&nbsp;For&nbsp;color&nbsp;images,&nbsp;we&nbsp;only&nbsp;support&nbsp;4:4:4,&nbsp;4:4:0,&nbsp;4:2:2&nbsp;or&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589672">//&nbsp;downsampling&nbsp;ratios.&nbsp;This&nbsp;implies&nbsp;that&nbsp;the&nbsp;(h,&nbsp;v)&nbsp;values&nbsp;for&nbsp;the&nbsp;Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589744">//&nbsp;component&nbsp;are&nbsp;either&nbsp;(1,&nbsp;1),&nbsp;(1,&nbsp;2),&nbsp;(2,&nbsp;1)&nbsp;or&nbsp;(2,&nbsp;2),&nbsp;and&nbsp;the&nbsp;(h,&nbsp;v)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5589819">//&nbsp;values&nbsp;for&nbsp;the&nbsp;Cr&nbsp;and&nbsp;Cb&nbsp;components&nbsp;must&nbsp;be&nbsp;(1,&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589876">if</span>&nbsp;<span class="ident" id="5589879">i</span>&nbsp;<span class="op" id="5589881">==</span>&nbsp;<span class="num" id="5589884">0</span>&nbsp;<span class="op" id="5589886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589891">if</span>&nbsp;<span class="ident" id="5589894">hv</span>&nbsp;<span class="op" id="5589897">!=</span>&nbsp;<span class="num" id="5589900">0x11</span>&nbsp;<span class="op" id="5589905">&amp;&amp;</span>&nbsp;<span class="ident" id="5589908">hv</span>&nbsp;<span class="op" id="5589911">!=</span>&nbsp;<span class="num" id="5589914">0x21</span>&nbsp;<span class="op" id="5589919">&amp;&amp;</span>&nbsp;<span class="ident" id="5589922">hv</span>&nbsp;<span class="op" id="5589925">!=</span>&nbsp;<span class="num" id="5589928">0x22</span>&nbsp;<span class="op" id="5589933">&amp;&amp;</span>&nbsp;<span class="ident" id="5589936">hv</span>&nbsp;<span class="op" id="5589939">!=</span>&nbsp;<span class="num" id="5589942">0x12</span>&nbsp;<span class="op" id="5589947">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5589953">return</span>&nbsp;<span class="ident" id="5589960">UnsupportedError</span><span class="op" id="5589976">(</span><span class="string" id="5589977">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="5590007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590016">}</span>&nbsp;<span class="keyword" id="5590018">else</span>&nbsp;<span class="keyword" id="5590023">if</span>&nbsp;<span class="ident" id="5590026">hv</span>&nbsp;<span class="op" id="5590029">!=</span>&nbsp;<span class="num" id="5590032">0x11</span>&nbsp;<span class="op" id="5590037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590042">return</span>&nbsp;<span class="ident" id="5590049">UnsupportedError</span><span class="op" id="5590065">(</span><span class="string" id="5590066">&#34;luma/chroma&nbsp;downsample&nbsp;ratio&#34;</span><span class="op" id="5590096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590100">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590106">return</span>&nbsp;<span class="builtintype" id="5590113">nil</span><br>
<span class="lineno"></span><span class="op" id="5590117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5590120">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.1.</span><br>
<span class="lineno">345</span><span class="keyword" id="5590153">func</span>&nbsp;<span class="op" id="5590158">(</span><span class="ident" id="5590159">d</span>&nbsp;<span class="op" id="5590161">*</span><span class="ident" id="5590162">decoder</span><span class="op" id="5590169">)</span>&nbsp;<span class="ident" id="5590171">processDQT</span><span class="op" id="5590181">(</span><span class="ident" id="5590182">n</span>&nbsp;<span class="builtintype" id="5590184">int</span><span class="op" id="5590187">)</span>&nbsp;<span class="builtintype" id="5590189">error</span>&nbsp;<span class="op" id="5590195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590198">const</span>&nbsp;<span class="ident" id="5590204">qtLength</span>&nbsp;<span class="op" id="5590213">=</span>&nbsp;<span class="num" id="5590215">1</span>&nbsp;<span class="op" id="5590217">+</span>&nbsp;<span class="ident" id="5590219">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590230">for</span>&nbsp;<span class="op" id="5590234">;</span>&nbsp;<span class="ident" id="5590236">n</span>&nbsp;<span class="op" id="5590238">&gt;=</span>&nbsp;<span class="ident" id="5590241">qtLength</span><span class="op" id="5590249">;</span>&nbsp;<span class="ident" id="5590251">n</span>&nbsp;<span class="op" id="5590253">-=</span>&nbsp;<span class="ident" id="5590256">qtLength</span>&nbsp;<span class="op" id="5590265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590269">if</span>&nbsp;<span class="ident" id="5590272">err</span>&nbsp;<span class="op" id="5590276">:=</span>&nbsp;<span class="ident" id="5590279">d</span><span class="op" id="5590280">.</span><span class="ident" id="5590281">readFull</span><span class="op" id="5590289">(</span><span class="ident" id="5590290">d</span><span class="op" id="5590291">.</span><span class="ident" id="5590292">tmp</span><span class="op" id="5590295">[</span><span class="op" id="5590296">:</span><span class="ident" id="5590297">qtLength</span><span class="op" id="5590305">]</span><span class="op" id="5590306">)</span><span class="op" id="5590307">;</span>&nbsp;<span class="ident" id="5590309">err</span>&nbsp;<span class="op" id="5590313">!=</span>&nbsp;<span class="builtintype" id="5590316">nil</span>&nbsp;<span class="op" id="5590320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590325">return</span>&nbsp;<span class="ident" id="5590332">err</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590342">pq</span>&nbsp;<span class="op" id="5590345">:=</span>&nbsp;<span class="ident" id="5590348">d</span><span class="op" id="5590349">.</span><span class="ident" id="5590350">tmp</span><span class="op" id="5590353">[</span><span class="num" id="5590354">0</span><span class="op" id="5590355">]</span>&nbsp;<span class="op" id="5590357">&gt;&gt;</span>&nbsp;<span class="num" id="5590360">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590364">if</span>&nbsp;<span class="ident" id="5590367">pq</span>&nbsp;<span class="op" id="5590370">!=</span>&nbsp;<span class="num" id="5590373">0</span>&nbsp;<span class="op" id="5590375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590380">return</span>&nbsp;<span class="ident" id="5590387">UnsupportedError</span><span class="op" id="5590403">(</span><span class="string" id="5590404">&#34;bad&nbsp;Pq&nbsp;value&#34;</span><span class="op" id="5590418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590422">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590426">tq</span>&nbsp;<span class="op" id="5590429">:=</span>&nbsp;<span class="ident" id="5590432">d</span><span class="op" id="5590433">.</span><span class="ident" id="5590434">tmp</span><span class="op" id="5590437">[</span><span class="num" id="5590438">0</span><span class="op" id="5590439">]</span>&nbsp;<span class="op" id="5590441">&amp;</span>&nbsp;<span class="num" id="5590443">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590450">if</span>&nbsp;<span class="ident" id="5590453">tq</span>&nbsp;<span class="op" id="5590456">&gt;</span>&nbsp;<span class="ident" id="5590458">maxTq</span>&nbsp;<span class="op" id="5590464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590469">return</span>&nbsp;<span class="ident" id="5590476">FormatError</span><span class="op" id="5590487">(</span><span class="string" id="5590488">&#34;bad&nbsp;Tq&nbsp;value&#34;</span><span class="op" id="5590502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590510">for</span>&nbsp;<span class="ident" id="5590514">i</span>&nbsp;<span class="op" id="5590516">:=</span>&nbsp;<span class="keyword" id="5590519">range</span>&nbsp;<span class="ident" id="5590525">d</span><span class="op" id="5590526">.</span><span class="ident" id="5590527">quant</span><span class="op" id="5590532">[</span><span class="ident" id="5590533">tq</span><span class="op" id="5590535">]</span>&nbsp;<span class="op" id="5590537">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590542">d</span><span class="op" id="5590543">.</span><span class="ident" id="5590544">quant</span><span class="op" id="5590549">[</span><span class="ident" id="5590550">tq</span><span class="op" id="5590552">]</span><span class="op" id="5590553">[</span><span class="ident" id="5590554">i</span><span class="op" id="5590555">]</span>&nbsp;<span class="op" id="5590557">=</span>&nbsp;<span class="builtintype" id="5590559">int32</span><span class="op" id="5590564">(</span><span class="ident" id="5590565">d</span><span class="op" id="5590566">.</span><span class="ident" id="5590567">tmp</span><span class="op" id="5590570">[</span><span class="ident" id="5590571">i</span><span class="op" id="5590572">+</span><span class="num" id="5590573">1</span><span class="op" id="5590574">]</span><span class="op" id="5590575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590585">if</span>&nbsp;<span class="ident" id="5590588">n</span>&nbsp;<span class="op" id="5590590">!=</span>&nbsp;<span class="num" id="5590593">0</span>&nbsp;<span class="op" id="5590595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590599">return</span>&nbsp;<span class="ident" id="5590606">FormatError</span><span class="op" id="5590617">(</span><span class="string" id="5590618">&#34;DQT&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5590640">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590646">return</span>&nbsp;<span class="builtintype" id="5590653">nil</span><br>
<span class="lineno"></span><span class="op" id="5590657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5590660">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.4.4.</span><br>
<span class="lineno">370</span><span class="keyword" id="5590693">func</span>&nbsp;<span class="op" id="5590698">(</span><span class="ident" id="5590699">d</span>&nbsp;<span class="op" id="5590701">*</span><span class="ident" id="5590702">decoder</span><span class="op" id="5590709">)</span>&nbsp;<span class="ident" id="5590711">processDRI</span><span class="op" id="5590721">(</span><span class="ident" id="5590722">n</span>&nbsp;<span class="builtintype" id="5590724">int</span><span class="op" id="5590727">)</span>&nbsp;<span class="builtintype" id="5590729">error</span>&nbsp;<span class="op" id="5590735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590738">if</span>&nbsp;<span class="ident" id="5590741">n</span>&nbsp;<span class="op" id="5590743">!=</span>&nbsp;<span class="num" id="5590746">2</span>&nbsp;<span class="op" id="5590748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590752">return</span>&nbsp;<span class="ident" id="5590759">FormatError</span><span class="op" id="5590770">(</span><span class="string" id="5590771">&#34;DRI&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="5590793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590799">if</span>&nbsp;<span class="ident" id="5590802">err</span>&nbsp;<span class="op" id="5590806">:=</span>&nbsp;<span class="ident" id="5590809">d</span><span class="op" id="5590810">.</span><span class="ident" id="5590811">readFull</span><span class="op" id="5590819">(</span><span class="ident" id="5590820">d</span><span class="op" id="5590821">.</span><span class="ident" id="5590822">tmp</span><span class="op" id="5590825">[</span><span class="op" id="5590826">:</span><span class="num" id="5590827">2</span><span class="op" id="5590828">]</span><span class="op" id="5590829">)</span><span class="op" id="5590830">;</span>&nbsp;<span class="ident" id="5590832">err</span>&nbsp;<span class="op" id="5590836">!=</span>&nbsp;<span class="builtintype" id="5590839">nil</span>&nbsp;<span class="op" id="5590843">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590847">return</span>&nbsp;<span class="ident" id="5590854">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5590859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5590862">d</span><span class="op" id="5590863">.</span><span class="ident" id="5590864">ri</span>&nbsp;<span class="op" id="5590867">=</span>&nbsp;<span class="builtintype" id="5590869">int</span><span class="op" id="5590872">(</span><span class="ident" id="5590873">d</span><span class="op" id="5590874">.</span><span class="ident" id="5590875">tmp</span><span class="op" id="5590878">[</span><span class="num" id="5590879">0</span><span class="op" id="5590880">]</span><span class="op" id="5590881">)</span><span class="op" id="5590882">&lt;&lt;</span><span class="num" id="5590884">8</span>&nbsp;<span class="op" id="5590886">+</span>&nbsp;<span class="builtintype" id="5590888">int</span><span class="op" id="5590891">(</span><span class="ident" id="5590892">d</span><span class="op" id="5590893">.</span><span class="ident" id="5590894">tmp</span><span class="op" id="5590897">[</span><span class="num" id="5590898">1</span><span class="op" id="5590899">]</span><span class="op" id="5590900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5590903">return</span>&nbsp;<span class="builtintype" id="5590910">nil</span><br>
<span class="lineno"></span><span class="op" id="5590914">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="5590917">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5590987">func</span>&nbsp;<span class="op" id="5590992">(</span><span class="ident" id="5590993">d</span>&nbsp;<span class="op" id="5590995">*</span><span class="ident" id="5590996">decoder</span><span class="op" id="5591003">)</span>&nbsp;<span class="ident" id="5591005">decode</span><span class="op" id="5591011">(</span><span class="ident" id="5591012">r</span>&nbsp;<span class="ident" id="5591014">io</span><span class="op" id="5591016">.</span><span class="ident" id="5591017">Reader</span><span class="op" id="5591023">,</span>&nbsp;<span class="ident" id="5591025">configOnly</span>&nbsp;<span class="builtintype" id="5591036">bool</span><span class="op" id="5591040">)</span>&nbsp;<span class="op" id="5591042">(</span><span class="ident" id="5591043">image</span><span class="op" id="5591048">.</span><span class="ident" id="5591049">Image</span><span class="op" id="5591054">,</span>&nbsp;<span class="builtintype" id="5591056">error</span><span class="op" id="5591061">)</span>&nbsp;<span class="op" id="5591063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591066">d</span><span class="op" id="5591067">.</span><span class="ident" id="5591068">r</span>&nbsp;<span class="op" id="5591070">=</span>&nbsp;<span class="ident" id="5591072">r</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591076">//&nbsp;Check&nbsp;for&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591117">if</span>&nbsp;<span class="ident" id="5591120">err</span>&nbsp;<span class="op" id="5591124">:=</span>&nbsp;<span class="ident" id="5591127">d</span><span class="op" id="5591128">.</span><span class="ident" id="5591129">readFull</span><span class="op" id="5591137">(</span><span class="ident" id="5591138">d</span><span class="op" id="5591139">.</span><span class="ident" id="5591140">tmp</span><span class="op" id="5591143">[</span><span class="op" id="5591144">:</span><span class="num" id="5591145">2</span><span class="op" id="5591146">]</span><span class="op" id="5591147">)</span><span class="op" id="5591148">;</span>&nbsp;<span class="ident" id="5591150">err</span>&nbsp;<span class="op" id="5591154">!=</span>&nbsp;<span class="builtintype" id="5591157">nil</span>&nbsp;<span class="op" id="5591161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591165">return</span>&nbsp;<span class="builtintype" id="5591172">nil</span><span class="op" id="5591175">,</span>&nbsp;<span class="ident" id="5591177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591185">if</span>&nbsp;<span class="ident" id="5591188">d</span><span class="op" id="5591189">.</span><span class="ident" id="5591190">tmp</span><span class="op" id="5591193">[</span><span class="num" id="5591194">0</span><span class="op" id="5591195">]</span>&nbsp;<span class="op" id="5591197">!=</span>&nbsp;<span class="num" id="5591200">0xff</span>&nbsp;<span class="op" id="5591205">||</span>&nbsp;<span class="ident" id="5591208">d</span><span class="op" id="5591209">.</span><span class="ident" id="5591210">tmp</span><span class="op" id="5591213">[</span><span class="num" id="5591214">1</span><span class="op" id="5591215">]</span>&nbsp;<span class="op" id="5591217">!=</span>&nbsp;<span class="ident" id="5591220">soiMarker</span>&nbsp;<span class="op" id="5591230">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591234">return</span>&nbsp;<span class="builtintype" id="5591241">nil</span><span class="op" id="5591244">,</span>&nbsp;<span class="ident" id="5591246">FormatError</span><span class="op" id="5591257">(</span><span class="string" id="5591258">&#34;missing&nbsp;SOI&nbsp;marker&#34;</span><span class="op" id="5591278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591285">//&nbsp;Process&nbsp;the&nbsp;remaining&nbsp;segments&nbsp;until&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591351">for</span>&nbsp;<span class="op" id="5591355">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5591359">err</span>&nbsp;<span class="op" id="5591363">:=</span>&nbsp;<span class="ident" id="5591366">d</span><span class="op" id="5591367">.</span><span class="ident" id="5591368">readFull</span><span class="op" id="5591376">(</span><span class="ident" id="5591377">d</span><span class="op" id="5591378">.</span><span class="ident" id="5591379">tmp</span><span class="op" id="5591382">[</span><span class="op" id="5591383">:</span><span class="num" id="5591384">2</span><span class="op" id="5591385">]</span><span class="op" id="5591386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591390">if</span>&nbsp;<span class="ident" id="5591393">err</span>&nbsp;<span class="op" id="5591397">!=</span>&nbsp;<span class="builtintype" id="5591400">nil</span>&nbsp;<span class="op" id="5591404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591409">return</span>&nbsp;<span class="builtintype" id="5591416">nil</span><span class="op" id="5591419">,</span>&nbsp;<span class="ident" id="5591421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5591427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5591431">for</span>&nbsp;<span class="ident" id="5591435">d</span><span class="op" id="5591436">.</span><span class="ident" id="5591437">tmp</span><span class="op" id="5591440">[</span><span class="num" id="5591441">0</span><span class="op" id="5591442">]</span>&nbsp;<span class="op" id="5591444">!=</span>&nbsp;<span class="num" id="5591447">0xff</span>&nbsp;<span class="op" id="5591452">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591457">//&nbsp;Strictly&nbsp;speaking,&nbsp;this&nbsp;is&nbsp;a&nbsp;format&nbsp;error.&nbsp;However,&nbsp;libjpeg&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591526">//&nbsp;liberal&nbsp;in&nbsp;what&nbsp;it&nbsp;accepts.&nbsp;As&nbsp;of&nbsp;version&nbsp;9,&nbsp;next_marker&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591592">//&nbsp;jdmarker.c&nbsp;treats&nbsp;this&nbsp;as&nbsp;a&nbsp;warning&nbsp;(JWRN_EXTRANEOUS_DATA)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591661">//&nbsp;continues&nbsp;to&nbsp;decode&nbsp;the&nbsp;stream.&nbsp;Even&nbsp;before&nbsp;next_marker&nbsp;sees</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591728">//&nbsp;extraneous&nbsp;data,&nbsp;jpeg_fill_bit_buffer&nbsp;in&nbsp;jdhuff.c&nbsp;reads&nbsp;as&nbsp;many</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591798">//&nbsp;bytes&nbsp;as&nbsp;it&nbsp;can,&nbsp;possibly&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;scan&#39;s&nbsp;data.&nbsp;It</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591864">//&nbsp;effectively&nbsp;puts&nbsp;back&nbsp;any&nbsp;markers&nbsp;that&nbsp;it&nbsp;overscanned&nbsp;(e.g.&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5591933">//&nbsp;&#34;\xff\xd9&#34;&nbsp;EOI&nbsp;marker),&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;put&nbsp;back&nbsp;non-marker&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592005">//&nbsp;and&nbsp;thus&nbsp;it&nbsp;can&nbsp;silently&nbsp;ignore&nbsp;a&nbsp;small&nbsp;number&nbsp;of&nbsp;extraneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592072">//&nbsp;non-marker&nbsp;bytes&nbsp;before&nbsp;next_marker&nbsp;has&nbsp;a&nbsp;chance&nbsp;to&nbsp;see&nbsp;them&nbsp;(and</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592144">//&nbsp;print&nbsp;a&nbsp;warning).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592168">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592174">//&nbsp;We&nbsp;are&nbsp;therefore&nbsp;also&nbsp;liberal&nbsp;in&nbsp;what&nbsp;we&nbsp;accept.&nbsp;Extraneous&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592245">//&nbsp;is&nbsp;silently&nbsp;ignored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592272">//</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592278">//&nbsp;This&nbsp;is&nbsp;similar&nbsp;to,&nbsp;but&nbsp;not&nbsp;exactly&nbsp;the&nbsp;same&nbsp;as,&nbsp;the&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592345">//&nbsp;mechanism&nbsp;within&nbsp;a&nbsp;scan&nbsp;(the&nbsp;RST[0-7]&nbsp;markers).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592399">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592405">//&nbsp;Note&nbsp;that&nbsp;extraneous&nbsp;0xff&nbsp;bytes&nbsp;in&nbsp;e.g.&nbsp;SOS&nbsp;data&nbsp;are&nbsp;escaped&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592475">//&nbsp;&#34;\xff\x00&#34;,&nbsp;and&nbsp;so&nbsp;are&nbsp;detected&nbsp;a&nbsp;little&nbsp;further&nbsp;down&nbsp;below.</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592542">d</span><span class="op" id="5592543">.</span><span class="ident" id="5592544">tmp</span><span class="op" id="5592547">[</span><span class="num" id="5592548">0</span><span class="op" id="5592549">]</span>&nbsp;<span class="op" id="5592551">=</span>&nbsp;<span class="ident" id="5592553">d</span><span class="op" id="5592554">.</span><span class="ident" id="5592555">tmp</span><span class="op" id="5592558">[</span><span class="num" id="5592559">1</span><span class="op" id="5592560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592565">d</span><span class="op" id="5592566">.</span><span class="ident" id="5592567">tmp</span><span class="op" id="5592570">[</span><span class="num" id="5592571">1</span><span class="op" id="5592572">]</span><span class="op" id="5592573">,</span>&nbsp;<span class="ident" id="5592575">err</span>&nbsp;<span class="op" id="5592579">=</span>&nbsp;<span class="ident" id="5592581">d</span><span class="op" id="5592582">.</span><span class="ident" id="5592583">readByte</span><span class="op" id="5592591">(</span><span class="op" id="5592592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592597">if</span>&nbsp;<span class="ident" id="5592600">err</span>&nbsp;<span class="op" id="5592604">!=</span>&nbsp;<span class="builtintype" id="5592607">nil</span>&nbsp;<span class="op" id="5592611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592617">return</span>&nbsp;<span class="builtintype" id="5592624">nil</span><span class="op" id="5592627">,</span>&nbsp;<span class="ident" id="5592629">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592636">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592644">marker</span>&nbsp;<span class="op" id="5592651">:=</span>&nbsp;<span class="ident" id="5592654">d</span><span class="op" id="5592655">.</span><span class="ident" id="5592656">tmp</span><span class="op" id="5592659">[</span><span class="num" id="5592660">1</span><span class="op" id="5592661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592665">if</span>&nbsp;<span class="ident" id="5592668">marker</span>&nbsp;<span class="op" id="5592675">==</span>&nbsp;<span class="num" id="5592678">0</span>&nbsp;<span class="op" id="5592680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592685">//&nbsp;Treat&nbsp;&#34;\xff\x00&#34;&nbsp;as&nbsp;extraneous&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592728">continue</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592743">for</span>&nbsp;<span class="ident" id="5592747">marker</span>&nbsp;<span class="op" id="5592754">==</span>&nbsp;<span class="num" id="5592757">0xff</span>&nbsp;<span class="op" id="5592762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592767">//&nbsp;Section&nbsp;B.1.1.2&nbsp;says,&nbsp;&#34;Any&nbsp;marker&nbsp;may&nbsp;optionally&nbsp;be&nbsp;preceded&nbsp;by&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5592841">//&nbsp;number&nbsp;of&nbsp;fill&nbsp;bytes,&nbsp;which&nbsp;are&nbsp;bytes&nbsp;assigned&nbsp;code&nbsp;X&#39;FF&#39;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5592907">marker</span><span class="op" id="5592913">,</span>&nbsp;<span class="ident" id="5592915">err</span>&nbsp;<span class="op" id="5592919">=</span>&nbsp;<span class="ident" id="5592921">d</span><span class="op" id="5592922">.</span><span class="ident" id="5592923">readByte</span><span class="op" id="5592931">(</span><span class="op" id="5592932">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592937">if</span>&nbsp;<span class="ident" id="5592940">err</span>&nbsp;<span class="op" id="5592944">!=</span>&nbsp;<span class="builtintype" id="5592947">nil</span>&nbsp;<span class="op" id="5592951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592957">return</span>&nbsp;<span class="builtintype" id="5592964">nil</span><span class="op" id="5592967">,</span>&nbsp;<span class="ident" id="5592969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5592980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5592984">if</span>&nbsp;<span class="ident" id="5592987">marker</span>&nbsp;<span class="op" id="5592994">==</span>&nbsp;<span class="ident" id="5592997">eoiMarker</span>&nbsp;<span class="op" id="5593007">{</span>&nbsp;<span class="comment" id="5593009">//&nbsp;End&nbsp;Of&nbsp;Image.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593029">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593041">if</span>&nbsp;<span class="ident" id="5593044">rst0Marker</span>&nbsp;<span class="op" id="5593055">&lt;=</span>&nbsp;<span class="ident" id="5593058">marker</span>&nbsp;<span class="op" id="5593065">&amp;&amp;</span>&nbsp;<span class="ident" id="5593068">marker</span>&nbsp;<span class="op" id="5593075">&lt;=</span>&nbsp;<span class="ident" id="5593078">rst7Marker</span>&nbsp;<span class="op" id="5593089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593094">//&nbsp;Figures&nbsp;B.2&nbsp;and&nbsp;B.16&nbsp;of&nbsp;the&nbsp;specification&nbsp;suggest&nbsp;that&nbsp;restart&nbsp;markers&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593178">//&nbsp;only&nbsp;occur&nbsp;between&nbsp;Entropy&nbsp;Coded&nbsp;Segments&nbsp;and&nbsp;not&nbsp;after&nbsp;the&nbsp;final&nbsp;ECS.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593255">//&nbsp;However,&nbsp;some&nbsp;encoders&nbsp;may&nbsp;generate&nbsp;incorrect&nbsp;JPEGs&nbsp;with&nbsp;a&nbsp;final&nbsp;restart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593334">//&nbsp;marker.&nbsp;That&nbsp;restart&nbsp;marker&nbsp;will&nbsp;be&nbsp;seen&nbsp;here&nbsp;instead&nbsp;of&nbsp;inside&nbsp;the&nbsp;processSOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593419">//&nbsp;method,&nbsp;and&nbsp;is&nbsp;ignored&nbsp;as&nbsp;a&nbsp;harmless&nbsp;error.&nbsp;Restart&nbsp;markers&nbsp;have&nbsp;no&nbsp;extra&nbsp;data,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593505">//&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;this&nbsp;before&nbsp;we&nbsp;read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593581">continue</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593597">//&nbsp;Read&nbsp;the&nbsp;16-bit&nbsp;length&nbsp;of&nbsp;the&nbsp;segment.&nbsp;The&nbsp;value&nbsp;includes&nbsp;the&nbsp;2&nbsp;bytes&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5593680">//&nbsp;length&nbsp;itself,&nbsp;so&nbsp;we&nbsp;subtract&nbsp;2&nbsp;to&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;remaining&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593755">if</span>&nbsp;<span class="ident" id="5593758">err</span>&nbsp;<span class="op" id="5593762">=</span>&nbsp;<span class="ident" id="5593764">d</span><span class="op" id="5593765">.</span><span class="ident" id="5593766">readFull</span><span class="op" id="5593774">(</span><span class="ident" id="5593775">d</span><span class="op" id="5593776">.</span><span class="ident" id="5593777">tmp</span><span class="op" id="5593780">[</span><span class="op" id="5593781">:</span><span class="num" id="5593782">2</span><span class="op" id="5593783">]</span><span class="op" id="5593784">)</span><span class="op" id="5593785">;</span>&nbsp;<span class="ident" id="5593787">err</span>&nbsp;<span class="op" id="5593791">!=</span>&nbsp;<span class="builtintype" id="5593794">nil</span>&nbsp;<span class="op" id="5593798">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593803">return</span>&nbsp;<span class="builtintype" id="5593810">nil</span><span class="op" id="5593813">,</span>&nbsp;<span class="ident" id="5593815">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5593825">n</span>&nbsp;<span class="op" id="5593827">:=</span>&nbsp;<span class="builtintype" id="5593830">int</span><span class="op" id="5593833">(</span><span class="ident" id="5593834">d</span><span class="op" id="5593835">.</span><span class="ident" id="5593836">tmp</span><span class="op" id="5593839">[</span><span class="num" id="5593840">0</span><span class="op" id="5593841">]</span><span class="op" id="5593842">)</span><span class="op" id="5593843">&lt;&lt;</span><span class="num" id="5593845">8</span>&nbsp;<span class="op" id="5593847">+</span>&nbsp;<span class="builtintype" id="5593849">int</span><span class="op" id="5593852">(</span><span class="ident" id="5593853">d</span><span class="op" id="5593854">.</span><span class="ident" id="5593855">tmp</span><span class="op" id="5593858">[</span><span class="num" id="5593859">1</span><span class="op" id="5593860">]</span><span class="op" id="5593861">)</span>&nbsp;<span class="op" id="5593863">-</span>&nbsp;<span class="num" id="5593865">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593869">if</span>&nbsp;<span class="ident" id="5593872">n</span>&nbsp;<span class="op" id="5593874">&lt;</span>&nbsp;<span class="num" id="5593876">0</span>&nbsp;<span class="op" id="5593878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593883">return</span>&nbsp;<span class="builtintype" id="5593890">nil</span><span class="op" id="5593893">,</span>&nbsp;<span class="ident" id="5593895">FormatError</span><span class="op" id="5593906">(</span><span class="string" id="5593907">&#34;short&nbsp;segment&nbsp;length&#34;</span><span class="op" id="5593929">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5593933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593938">switch</span>&nbsp;<span class="op" id="5593945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5593949">case</span>&nbsp;<span class="ident" id="5593954">marker</span>&nbsp;<span class="op" id="5593961">==</span>&nbsp;<span class="ident" id="5593964">sof0Marker</span>&nbsp;<span class="op" id="5593975">||</span>&nbsp;<span class="ident" id="5593978">marker</span>&nbsp;<span class="op" id="5593985">==</span>&nbsp;<span class="ident" id="5593988">sof2Marker</span><span class="op" id="5593998">:</span>&nbsp;<span class="comment" id="5594000">//&nbsp;Start&nbsp;Of&nbsp;Frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594022">d</span><span class="op" id="5594023">.</span><span class="ident" id="5594024">progressive</span>&nbsp;<span class="op" id="5594036">=</span>&nbsp;<span class="ident" id="5594038">marker</span>&nbsp;<span class="op" id="5594045">==</span>&nbsp;<span class="ident" id="5594048">sof2Marker</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594062">err</span>&nbsp;<span class="op" id="5594066">=</span>&nbsp;<span class="ident" id="5594068">d</span><span class="op" id="5594069">.</span><span class="ident" id="5594070">processSOF</span><span class="op" id="5594080">(</span><span class="ident" id="5594081">n</span><span class="op" id="5594082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594087">if</span>&nbsp;<span class="ident" id="5594090">configOnly</span>&nbsp;<span class="op" id="5594101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594107">return</span>&nbsp;<span class="builtintype" id="5594114">nil</span><span class="op" id="5594117">,</span>&nbsp;<span class="ident" id="5594119">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594130">case</span>&nbsp;<span class="ident" id="5594135">marker</span>&nbsp;<span class="op" id="5594142">==</span>&nbsp;<span class="ident" id="5594145">dhtMarker</span><span class="op" id="5594154">:</span>&nbsp;<span class="comment" id="5594156">//&nbsp;Define&nbsp;Huffman&nbsp;Table.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594184">err</span>&nbsp;<span class="op" id="5594188">=</span>&nbsp;<span class="ident" id="5594190">d</span><span class="op" id="5594191">.</span><span class="ident" id="5594192">processDHT</span><span class="op" id="5594202">(</span><span class="ident" id="5594203">n</span><span class="op" id="5594204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594208">case</span>&nbsp;<span class="ident" id="5594213">marker</span>&nbsp;<span class="op" id="5594220">==</span>&nbsp;<span class="ident" id="5594223">dqtMarker</span><span class="op" id="5594232">:</span>&nbsp;<span class="comment" id="5594234">//&nbsp;Define&nbsp;Quantization&nbsp;Table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594267">err</span>&nbsp;<span class="op" id="5594271">=</span>&nbsp;<span class="ident" id="5594273">d</span><span class="op" id="5594274">.</span><span class="ident" id="5594275">processDQT</span><span class="op" id="5594285">(</span><span class="ident" id="5594286">n</span><span class="op" id="5594287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594291">case</span>&nbsp;<span class="ident" id="5594296">marker</span>&nbsp;<span class="op" id="5594303">==</span>&nbsp;<span class="ident" id="5594306">sosMarker</span><span class="op" id="5594315">:</span>&nbsp;<span class="comment" id="5594317">//&nbsp;Start&nbsp;Of&nbsp;Scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594338">err</span>&nbsp;<span class="op" id="5594342">=</span>&nbsp;<span class="ident" id="5594344">d</span><span class="op" id="5594345">.</span><span class="ident" id="5594346">processSOS</span><span class="op" id="5594356">(</span><span class="ident" id="5594357">n</span><span class="op" id="5594358">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594362">case</span>&nbsp;<span class="ident" id="5594367">marker</span>&nbsp;<span class="op" id="5594374">==</span>&nbsp;<span class="ident" id="5594377">driMarker</span><span class="op" id="5594386">:</span>&nbsp;<span class="comment" id="5594388">//&nbsp;Define&nbsp;Restart&nbsp;Interval.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594419">err</span>&nbsp;<span class="op" id="5594423">=</span>&nbsp;<span class="ident" id="5594425">d</span><span class="op" id="5594426">.</span><span class="ident" id="5594427">processDRI</span><span class="op" id="5594437">(</span><span class="ident" id="5594438">n</span><span class="op" id="5594439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594443">case</span>&nbsp;<span class="ident" id="5594448">app0Marker</span>&nbsp;<span class="op" id="5594459">&lt;=</span>&nbsp;<span class="ident" id="5594462">marker</span>&nbsp;<span class="op" id="5594469">&amp;&amp;</span>&nbsp;<span class="ident" id="5594472">marker</span>&nbsp;<span class="op" id="5594479">&lt;=</span>&nbsp;<span class="ident" id="5594482">app15Marker</span>&nbsp;<span class="op" id="5594494">||</span>&nbsp;<span class="ident" id="5594497">marker</span>&nbsp;<span class="op" id="5594504">==</span>&nbsp;<span class="ident" id="5594507">comMarker</span><span class="op" id="5594516">:</span>&nbsp;<span class="comment" id="5594518">//&nbsp;APPlication&nbsp;specific,&nbsp;or&nbsp;COMment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594558">err</span>&nbsp;<span class="op" id="5594562">=</span>&nbsp;<span class="ident" id="5594564">d</span><span class="op" id="5594565">.</span><span class="ident" id="5594566">ignore</span><span class="op" id="5594572">(</span><span class="ident" id="5594573">n</span><span class="op" id="5594574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594578">default</span><span class="op" id="5594585">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5594590">err</span>&nbsp;<span class="op" id="5594594">=</span>&nbsp;<span class="ident" id="5594596">UnsupportedError</span><span class="op" id="5594612">(</span><span class="string" id="5594613">&#34;unknown&nbsp;marker&#34;</span><span class="op" id="5594629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594637">if</span>&nbsp;<span class="ident" id="5594640">err</span>&nbsp;<span class="op" id="5594644">!=</span>&nbsp;<span class="builtintype" id="5594647">nil</span>&nbsp;<span class="op" id="5594651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594656">return</span>&nbsp;<span class="builtintype" id="5594663">nil</span><span class="op" id="5594666">,</span>&nbsp;<span class="ident" id="5594668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594674">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594680">if</span>&nbsp;<span class="ident" id="5594683">d</span><span class="op" id="5594684">.</span><span class="ident" id="5594685">img1</span>&nbsp;<span class="op" id="5594690">!=</span>&nbsp;<span class="builtintype" id="5594693">nil</span>&nbsp;<span class="op" id="5594697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594701">return</span>&nbsp;<span class="ident" id="5594708">d</span><span class="op" id="5594709">.</span><span class="ident" id="5594710">img1</span><span class="op" id="5594714">,</span>&nbsp;<span class="builtintype" id="5594716">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594724">if</span>&nbsp;<span class="ident" id="5594727">d</span><span class="op" id="5594728">.</span><span class="ident" id="5594729">img3</span>&nbsp;<span class="op" id="5594734">!=</span>&nbsp;<span class="builtintype" id="5594737">nil</span>&nbsp;<span class="op" id="5594741">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594745">return</span>&nbsp;<span class="ident" id="5594752">d</span><span class="op" id="5594753">.</span><span class="ident" id="5594754">img3</span><span class="op" id="5594758">,</span>&nbsp;<span class="builtintype" id="5594760">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5594765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594768">return</span>&nbsp;<span class="builtintype" id="5594775">nil</span><span class="op" id="5594778">,</span>&nbsp;<span class="ident" id="5594780">FormatError</span><span class="op" id="5594791">(</span><span class="string" id="5594792">&#34;missing&nbsp;SOS&nbsp;marker&#34;</span><span class="op" id="5594812">)</span><br>
<span class="lineno"></span><span class="op" id="5594814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5594817">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="5594887">func</span>&nbsp;<span class="ident" id="5594892">Decode</span><span class="op" id="5594898">(</span><span class="ident" id="5594899">r</span>&nbsp;<span class="ident" id="5594901">io</span><span class="op" id="5594903">.</span><span class="ident" id="5594904">Reader</span><span class="op" id="5594910">)</span>&nbsp;<span class="op" id="5594912">(</span><span class="ident" id="5594913">image</span><span class="op" id="5594918">.</span><span class="ident" id="5594919">Image</span><span class="op" id="5594924">,</span>&nbsp;<span class="builtintype" id="5594926">error</span><span class="op" id="5594931">)</span>&nbsp;<span class="op" id="5594933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594936">var</span>&nbsp;<span class="ident" id="5594940">d</span>&nbsp;<span class="ident" id="5594942">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5594951">return</span>&nbsp;<span class="ident" id="5594958">d</span><span class="op" id="5594959">.</span><span class="ident" id="5594960">decode</span><span class="op" id="5594966">(</span><span class="ident" id="5594967">r</span><span class="op" id="5594968">,</span>&nbsp;<span class="builtintype" id="5594970">false</span><span class="op" id="5594975">)</span><br>
<span class="lineno"></span><span class="op" id="5594977">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="5594980">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;JPEG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5595059">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5595089">func</span>&nbsp;<span class="ident" id="5595094">DecodeConfig</span><span class="op" id="5595106">(</span><span class="ident" id="5595107">r</span>&nbsp;<span class="ident" id="5595109">io</span><span class="op" id="5595111">.</span><span class="ident" id="5595112">Reader</span><span class="op" id="5595118">)</span>&nbsp;<span class="op" id="5595120">(</span><span class="ident" id="5595121">image</span><span class="op" id="5595126">.</span><span class="ident" id="5595127">Config</span><span class="op" id="5595133">,</span>&nbsp;<span class="builtintype" id="5595135">error</span><span class="op" id="5595140">)</span>&nbsp;<span class="op" id="5595142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595145">var</span>&nbsp;<span class="ident" id="5595149">d</span>&nbsp;<span class="ident" id="5595151">decoder</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595160">if</span>&nbsp;<span class="ident" id="5595163">_</span><span class="op" id="5595164">,</span>&nbsp;<span class="ident" id="5595166">err</span>&nbsp;<span class="op" id="5595170">:=</span>&nbsp;<span class="ident" id="5595173">d</span><span class="op" id="5595174">.</span><span class="ident" id="5595175">decode</span><span class="op" id="5595181">(</span><span class="ident" id="5595182">r</span><span class="op" id="5595183">,</span>&nbsp;<span class="builtintype" id="5595185">true</span><span class="op" id="5595189">)</span><span class="op" id="5595190">;</span>&nbsp;<span class="ident" id="5595192">err</span>&nbsp;<span class="op" id="5595196">!=</span>&nbsp;<span class="builtintype" id="5595199">nil</span>&nbsp;<span class="op" id="5595203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595207">return</span>&nbsp;<span class="ident" id="5595214">image</span><span class="op" id="5595219">.</span><span class="ident" id="5595220">Config</span><span class="op" id="5595226">{</span><span class="op" id="5595227">}</span><span class="op" id="5595228">,</span>&nbsp;<span class="ident" id="5595230">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595238">switch</span>&nbsp;<span class="ident" id="5595245">d</span><span class="op" id="5595246">.</span><span class="ident" id="5595247">nComp</span>&nbsp;<span class="op" id="5595253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595256">case</span>&nbsp;<span class="ident" id="5595261">nGrayComponent</span><span class="op" id="5595275">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595279">return</span>&nbsp;<span class="ident" id="5595286">image</span><span class="op" id="5595291">.</span><span class="ident" id="5595292">Config</span><span class="op" id="5595298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595303">ColorModel</span><span class="op" id="5595313">:</span>&nbsp;<span class="ident" id="5595315">color</span><span class="op" id="5595320">.</span><span class="ident" id="5595321">GrayModel</span><span class="op" id="5595330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595335">Width</span><span class="op" id="5595340">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595347">d</span><span class="op" id="5595348">.</span><span class="ident" id="5595349">width</span><span class="op" id="5595354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595359">Height</span><span class="op" id="5595365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595371">d</span><span class="op" id="5595372">.</span><span class="ident" id="5595373">height</span><span class="op" id="5595379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595383">}</span><span class="op" id="5595384">,</span>&nbsp;<span class="builtintype" id="5595386">nil</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595391">case</span>&nbsp;<span class="ident" id="5595396">nColorComponent</span><span class="op" id="5595411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595415">return</span>&nbsp;<span class="ident" id="5595422">image</span><span class="op" id="5595427">.</span><span class="ident" id="5595428">Config</span><span class="op" id="5595434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595439">ColorModel</span><span class="op" id="5595449">:</span>&nbsp;<span class="ident" id="5595451">color</span><span class="op" id="5595456">.</span><span class="ident" id="5595457">YCbCrModel</span><span class="op" id="5595467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595472">Width</span><span class="op" id="5595477">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595484">d</span><span class="op" id="5595485">.</span><span class="ident" id="5595486">width</span><span class="op" id="5595491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595496">Height</span><span class="op" id="5595502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595508">d</span><span class="op" id="5595509">.</span><span class="ident" id="5595510">height</span><span class="op" id="5595516">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595520">}</span><span class="op" id="5595521">,</span>&nbsp;<span class="builtintype" id="5595523">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5595528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5595531">return</span>&nbsp;<span class="ident" id="5595538">image</span><span class="op" id="5595543">.</span><span class="ident" id="5595544">Config</span><span class="op" id="5595550">{</span><span class="op" id="5595551">}</span><span class="op" id="5595552">,</span>&nbsp;<span class="ident" id="5595554">FormatError</span><span class="op" id="5595565">(</span><span class="string" id="5595566">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="5595586">)</span><br>
<span class="lineno"></span><span class="op" id="5595588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="5595591">func</span>&nbsp;<span class="ident" id="5595596">init</span><span class="op" id="5595600">(</span><span class="op" id="5595601">)</span>&nbsp;<span class="op" id="5595603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5595606">image</span><span class="op" id="5595611">.</span><span class="ident" id="5595612">RegisterFormat</span><span class="op" id="5595626">(</span><span class="string" id="5595627">&#34;jpeg&#34;</span><span class="op" id="5595633">,</span>&nbsp;<span class="string" id="5595635">&#34;\xff\xd8&#34;</span><span class="op" id="5595645">,</span>&nbsp;<span class="ident" id="5595647">Decode</span><span class="op" id="5595653">,</span>&nbsp;<span class="ident" id="5595655">DecodeConfig</span><span class="op" id="5595667">)</span><br>
<span class="lineno"></span><span class="op" id="5595669">}</span>
</div>
</body>
</html>
