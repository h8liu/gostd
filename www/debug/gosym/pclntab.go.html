<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Line&nbsp;tables<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">package</span>&nbsp;<span class="ident">gosym</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;LineTable&nbsp;is&nbsp;a&nbsp;data&nbsp;structure&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;line&nbsp;numbers.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;In&nbsp;Go&nbsp;1.1&nbsp;and&nbsp;earlier,&nbsp;each&nbsp;function&nbsp;(represented&nbsp;by&nbsp;a&nbsp;Func)&nbsp;had&nbsp;its&nbsp;own&nbsp;LineTable,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;the&nbsp;line&nbsp;number&nbsp;corresponded&nbsp;to&nbsp;a&nbsp;numbering&nbsp;of&nbsp;all&nbsp;source&nbsp;lines&nbsp;in&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment">//&nbsp;program,&nbsp;across&nbsp;all&nbsp;files.&nbsp;That&nbsp;absolute&nbsp;line&nbsp;number&nbsp;would&nbsp;then&nbsp;have&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;converted&nbsp;separately&nbsp;to&nbsp;a&nbsp;file&nbsp;name&nbsp;and&nbsp;line&nbsp;number&nbsp;within&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;In&nbsp;Go&nbsp;1.2,&nbsp;the&nbsp;format&nbsp;of&nbsp;the&nbsp;data&nbsp;changed&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;single&nbsp;LineTable</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;for&nbsp;the&nbsp;entire&nbsp;program,&nbsp;shared&nbsp;by&nbsp;all&nbsp;Funcs,&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;absolute&nbsp;line</span><br>
<span class="lineno">25</span><span class="comment">//&nbsp;numbers,&nbsp;just&nbsp;line&nbsp;numbers&nbsp;within&nbsp;specific&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;For&nbsp;the&nbsp;most&nbsp;part,&nbsp;LineTable&#39;s&nbsp;methods&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;internal</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;detail&nbsp;of&nbsp;the&nbsp;package;&nbsp;callers&nbsp;should&nbsp;use&nbsp;the&nbsp;methods&nbsp;on&nbsp;Table&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">LineTable</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">PC</span>&nbsp;&nbsp;&nbsp;<span class="ident">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Line</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Go&nbsp;1.2&nbsp;state</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">sync</span><span class="op">.</span><span class="ident">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">go12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">int</span>&nbsp;<span class="comment">//&nbsp;is&nbsp;this&nbsp;in&nbsp;Go&nbsp;1.2&nbsp;format?&nbsp;-1&nbsp;no,&nbsp;0&nbsp;unknown,&nbsp;1&nbsp;yes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">binary</span>&nbsp;&nbsp;&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">ByteOrder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">quantum</span>&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ptrsize</span>&nbsp;&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">functab</span>&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nfunctab</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filetab</span>&nbsp;&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nfiletab</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileMap</span>&nbsp;&nbsp;<span class="keyword">map</span><span class="op">[</span><span class="builtintype">string</span><span class="op">]</span><span class="builtintype">uint32</span><br>
<span class="lineno">45</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;NOTE(rsc):&nbsp;This&nbsp;is&nbsp;wrong&nbsp;for&nbsp;GOARCH=arm,&nbsp;which&nbsp;uses&nbsp;a&nbsp;quantum&nbsp;of&nbsp;4,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;but&nbsp;we&nbsp;have&nbsp;no&nbsp;idea&nbsp;whether&nbsp;we&#39;re&nbsp;using&nbsp;arm&nbsp;or&nbsp;not.&nbsp;This&nbsp;only</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;matters&nbsp;in&nbsp;the&nbsp;old&nbsp;(pre-Go&nbsp;1.2)&nbsp;symbol&nbsp;table&nbsp;format,&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;worth</span><br>
<span class="lineno">50</span><span class="comment">//&nbsp;fixing.</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">oldQuantum</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">parse</span><span class="op">(</span><span class="ident">targetPC</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">targetLine</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">b</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;PC/line&nbsp;table&nbsp;can&nbsp;be&nbsp;thought&nbsp;of&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;&nbsp;&lt;pc&nbsp;update&gt;*&nbsp;&lt;line&nbsp;update&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;batches.&nbsp;&nbsp;Each&nbsp;update&nbsp;batch&nbsp;results&nbsp;in&nbsp;a&nbsp;(pc,&nbsp;line)&nbsp;pair,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;where&nbsp;line&nbsp;applies&nbsp;to&nbsp;every&nbsp;PC&nbsp;from&nbsp;pc&nbsp;up&nbsp;to&nbsp;but&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;including&nbsp;the&nbsp;pc&nbsp;of&nbsp;the&nbsp;next&nbsp;pair.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Here&nbsp;we&nbsp;process&nbsp;each&nbsp;update&nbsp;individually,&nbsp;which&nbsp;simplifies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;code,&nbsp;but&nbsp;makes&nbsp;the&nbsp;corner&nbsp;cases&nbsp;more&nbsp;confusing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">,</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">PC</span><span class="op">,</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">targetPC</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">targetLine</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">code</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">code</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="num">0</span><span class="op">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">b</span><span class="op">[</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">val</span><span class="op">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">code</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">64</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">code</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">code</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">128</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">code</span>&nbsp;<span class="op">-</span>&nbsp;<span class="num">64</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">oldQuantum</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">code</span><span class="op">-</span><span class="num">128</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">oldQuantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">b</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="ident">line</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">slice</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">data</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">parse</span><span class="op">(</span><span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">&amp;</span><span class="ident">LineTable</span><span class="op">{</span><span class="ident">Data</span><span class="op">:</span>&nbsp;<span class="ident">data</span><span class="op">,</span>&nbsp;<span class="ident">PC</span><span class="op">:</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="ident">Line</span><span class="op">:</span>&nbsp;<span class="ident">line</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;PCToLine&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;program&nbsp;counter.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Callers&nbsp;should&nbsp;use&nbsp;Table&#39;s&nbsp;PCToLine&nbsp;method&nbsp;instead.</span><br>
<span class="lineno">95</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">PCToLine</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">isGo12</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">go12PCToLine</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">parse</span><span class="op">(</span><span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">line</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;LineToPC&nbsp;returns&nbsp;the&nbsp;program&nbsp;counter&nbsp;for&nbsp;the&nbsp;given&nbsp;line&nbsp;number,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;considering&nbsp;only&nbsp;program&nbsp;counters&nbsp;before&nbsp;maxpc.</span><br>
<span class="lineno">105</span><span class="comment">//&nbsp;Callers&nbsp;should&nbsp;use&nbsp;Table&#39;s&nbsp;LineToPC&nbsp;method&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">LineToPC</span><span class="op">(</span><span class="ident">line</span>&nbsp;<span class="builtintype">int</span><span class="op">,</span>&nbsp;<span class="ident">maxpc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">isGo12</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="ident">line1</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">parse</span><span class="op">(</span><span class="ident">maxpc</span><span class="op">,</span>&nbsp;<span class="ident">line</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">line1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Subtract&nbsp;quantum&nbsp;from&nbsp;PC&nbsp;to&nbsp;account&nbsp;for&nbsp;post-line&nbsp;increment</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">-</span>&nbsp;<span class="ident">oldQuantum</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;NewLineTable&nbsp;returns&nbsp;a&nbsp;new&nbsp;PC/line&nbsp;table</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">120</span><span class="comment">//&nbsp;Text&nbsp;must&nbsp;be&nbsp;the&nbsp;start&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;corresponding&nbsp;text&nbsp;segment.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">NewLineTable</span><span class="op">(</span><span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">text</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">&amp;</span><span class="ident">LineTable</span><span class="op">{</span><span class="ident">Data</span><span class="op">:</span>&nbsp;<span class="ident">data</span><span class="op">,</span>&nbsp;<span class="ident">PC</span><span class="op">:</span>&nbsp;<span class="ident">text</span><span class="op">,</span>&nbsp;<span class="ident">Line</span><span class="op">:</span>&nbsp;<span class="num">0</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Go&nbsp;1.2&nbsp;symbol&nbsp;table&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;See&nbsp;golang.org/s/go12symtab.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;general&nbsp;note&nbsp;about&nbsp;the&nbsp;methods&nbsp;here:&nbsp;rather&nbsp;than&nbsp;try&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">130</span><span class="comment">//&nbsp;index&nbsp;out&nbsp;of&nbsp;bounds&nbsp;errors,&nbsp;we&nbsp;trust&nbsp;Go&nbsp;to&nbsp;detect&nbsp;them,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;we&nbsp;recover&nbsp;from&nbsp;the&nbsp;panics&nbsp;and&nbsp;treat&nbsp;them&nbsp;as&nbsp;indicative&nbsp;of&nbsp;a&nbsp;malformed</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;or&nbsp;incomplete&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment">//</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;methods&nbsp;called&nbsp;by&nbsp;symtab.go,&nbsp;which&nbsp;begin&nbsp;with&nbsp;&#34;go12&#34;&nbsp;prefixes,</span><br>
<span class="lineno">135</span><span class="comment">//&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;that&nbsp;recovery&nbsp;logic.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;isGo12&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;a&nbsp;Go&nbsp;1.2&nbsp;(or&nbsp;later)&nbsp;symbol&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">isGo12</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">go12Init</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">go12</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="ident">go12magic</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xfffffffb</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment">//&nbsp;uintptr&nbsp;returns&nbsp;the&nbsp;pointer-sized&nbsp;value&nbsp;encoded&nbsp;at&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;The&nbsp;pointer&nbsp;size&nbsp;is&nbsp;dictated&nbsp;by&nbsp;the&nbsp;table&nbsp;being&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">b</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint64</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12init&nbsp;initializes&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;metadata&nbsp;if&nbsp;t&nbsp;is&nbsp;a&nbsp;Go&nbsp;1.2&nbsp;symbol&nbsp;table.</span><br>
<span class="lineno">155</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12Init</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">mu</span><span class="op">.</span><span class="ident">Lock</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">mu</span><span class="op">.</span><span class="ident">Unlock</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">go12</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;we&nbsp;panic&nbsp;parsing,&nbsp;assume&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;Go&nbsp;1.2&nbsp;symbol&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Check&nbsp;header:&nbsp;4-byte&nbsp;magic,&nbsp;two&nbsp;zeros,&nbsp;pc&nbsp;quantum,&nbsp;pointer&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">go12</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span>&nbsp;<span class="comment">//&nbsp;not&nbsp;Go&nbsp;1.2&nbsp;until&nbsp;proven&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">)</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="num">16</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">4</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">5</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">6</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">4</span><span class="op">)</span>&nbsp;<span class="op">||</span>&nbsp;<span class="comment">//&nbsp;pc&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">4</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">7</span><span class="op">]</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">8</span><span class="op">)</span>&nbsp;<span class="op">{</span>&nbsp;<span class="comment">//&nbsp;pointer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">switch</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">go12magic</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">LittleEndian</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">LittleEndian</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">case</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">)</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">binary</span><span class="op">.</span><span class="ident">BigEndian</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">default</span><span class="op">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">quantum</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">6</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">7</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">nfunctab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">8</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">functab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="num">8</span><span class="op">+</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">functabsize</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nfunctab</span><span class="op">*</span><span class="num">2</span><span class="op">*</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span>&nbsp;<span class="op">+</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileoff</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="ident">functabsize</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">functab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="op">:</span><span class="ident">functabsize</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">fileoff</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">nfiletab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span><span class="op">[</span><span class="op">:</span><span class="ident">t</span><span class="op">.</span><span class="ident">nfiletab</span><span class="op">*</span><span class="num">4</span><span class="op">]</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">go12</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="comment">//&nbsp;so&nbsp;far&nbsp;so&nbsp;good</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12Funcs&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;Funcs&nbsp;derived&nbsp;from&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;pcln&nbsp;table.</span><br>
<span class="lineno">200</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12Funcs</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="ident">Func</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Assume&nbsp;it&nbsp;is&nbsp;malformed&nbsp;and&nbsp;return&nbsp;nil&nbsp;on&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">n</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">)</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">funcs</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="ident">Func</span><span class="op">,</span>&nbsp;<span class="ident">n</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">funcs</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">&amp;</span><span class="ident">funcs</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Entry</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="num">2</span><span class="op">*</span><span class="ident">i</span><span class="op">*</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">End</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="ident">i</span><span class="op">+</span><span class="num">2</span><span class="op">)</span><span class="op">*</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">info</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="op">(</span><span class="num">2</span><span class="op">*</span><span class="ident">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">*</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">LineTable</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">FrameSize</span>&nbsp;<span class="op">=</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">info</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">+</span><span class="num">2</span><span class="op">*</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span><span class="op">.</span><span class="ident">Sym</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">&amp;</span><span class="ident">Sym</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Value</span><span class="op">:</span>&nbsp;&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">Entry</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Type</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;<span class="string">&#39;T&#39;</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Name</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">string</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">info</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">GoType</span><span class="op">:</span>&nbsp;<span class="num">0</span><span class="op">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Func</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;<span class="ident">f</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">funcs</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;findFunc&nbsp;returns&nbsp;the&nbsp;func&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;given&nbsp;program&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">findFunc</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">)</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&gt;=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">)</span><span class="op">-</span><span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;The&nbsp;function&nbsp;table&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;2*nfunctab+1&nbsp;uintptrs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;alternating&nbsp;program&nbsp;counters&nbsp;and&nbsp;offsets&nbsp;to&nbsp;func&nbsp;structures.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nfunctab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">nf</span>&nbsp;<span class="op">&gt;</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">nf</span>&nbsp;<span class="op">/</span>&nbsp;<span class="num">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fm</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">f</span><span class="op">[</span><span class="num">2</span><span class="op">*</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">*</span><span class="ident">m</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">fm</span><span class="op">)</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">fm</span><span class="op">[</span><span class="num">2</span><span class="op">*</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">fm</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="keyword">if</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">fm</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">f</span><span class="op">[</span><span class="op">(</span><span class="ident">m</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">*</span><span class="num">2</span><span class="op">*</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nf</span>&nbsp;<span class="op">-=</span>&nbsp;<span class="ident">m</span>&nbsp;<span class="op">+</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;readvarint&nbsp;reads,&nbsp;removes,&nbsp;and&nbsp;returns&nbsp;a&nbsp;varint&nbsp;from&nbsp;*pp.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">readvarint</span><span class="op">(</span><span class="ident">pp</span>&nbsp;<span class="op">*</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="builtintype">uint32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">var</span>&nbsp;<span class="ident">v</span><span class="op">,</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="builtintype">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="op">*</span><span class="ident">pp</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><span class="op">;</span>&nbsp;<span class="op">;</span>&nbsp;<span class="ident">shift</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="num">7</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">b</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">p</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">p</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">v</span>&nbsp;<span class="op">|=</span>&nbsp;<span class="op">(</span><span class="builtintype">uint32</span><span class="op">(</span><span class="ident">b</span><span class="op">)</span>&nbsp;<span class="op">&amp;</span>&nbsp;<span class="num">0x7F</span><span class="op">)</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">b</span><span class="op">&amp;</span><span class="num">0x80</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">pp</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">v</span><br>
<span class="lineno">265</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;string&nbsp;returns&nbsp;a&nbsp;Go&nbsp;string&nbsp;found&nbsp;at&nbsp;off.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span><span class="op">(</span><span class="ident">off</span>&nbsp;<span class="builtintype">uint32</span><span class="op">)</span>&nbsp;<span class="builtintype">string</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">off</span><span class="op">;</span>&nbsp;<span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">i</span><span class="op">]</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">string</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">off</span><span class="op">:</span><span class="ident">i</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;step&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;pc,&nbsp;value&nbsp;pair&nbsp;in&nbsp;the&nbsp;encoded&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">step</span><span class="op">(</span><span class="ident">p</span>&nbsp;<span class="op">*</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">*</span><span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">val</span>&nbsp;<span class="op">*</span><span class="builtintype">int32</span><span class="op">,</span>&nbsp;<span class="ident">first</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="builtintype">bool</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">uvdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">readvarint</span><span class="op">(</span><span class="ident">p</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">uvdelta</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="op">!</span><span class="ident">first</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">uvdelta</span><span class="op">&amp;</span><span class="num">1</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">uvdelta</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">^</span><span class="op">(</span><span class="ident">uvdelta</span>&nbsp;<span class="op">&gt;&gt;</span>&nbsp;<span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span>&nbsp;<span class="keyword">else</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">uvdelta</span>&nbsp;<span class="op">&gt;&gt;=</span>&nbsp;<span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">vdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">uvdelta</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pcdelta</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">readvarint</span><span class="op">(</span><span class="ident">p</span><span class="op">)</span>&nbsp;<span class="op">*</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">pc</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">uint64</span><span class="op">(</span><span class="ident">pcdelta</span><span class="op">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">*</span><span class="ident">val</span>&nbsp;<span class="op">+=</span>&nbsp;<span class="ident">vdelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">true</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;pcvalue&nbsp;reports&nbsp;the&nbsp;value&nbsp;associated&nbsp;with&nbsp;the&nbsp;target&nbsp;pc.</span><br>
<span class="lineno">295</span><span class="comment">//&nbsp;off&nbsp;is&nbsp;the&nbsp;offset&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;pc-value&nbsp;table,</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;and&nbsp;entry&nbsp;is&nbsp;the&nbsp;start&nbsp;PC&nbsp;for&nbsp;the&nbsp;corresponding&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">pcvalue</span><span class="op">(</span><span class="ident">off</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">entry</span><span class="op">,</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="builtintype">int32</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">off</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">p</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">off</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">val</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">entry</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">step</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">p</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">pc</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">val</span><span class="op">,</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">entry</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">targetpc</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;findFileLine&nbsp;scans&nbsp;one&nbsp;function&nbsp;in&nbsp;the&nbsp;binary&nbsp;looking&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;program&nbsp;counter&nbsp;in&nbsp;the&nbsp;given&nbsp;file&nbsp;on&nbsp;the&nbsp;given&nbsp;line.</span><br>
<span class="lineno">315</span><span class="comment">//&nbsp;It&nbsp;does&nbsp;so&nbsp;by&nbsp;running&nbsp;the&nbsp;pc-value&nbsp;tables&nbsp;mapping&nbsp;program&nbsp;counter</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;to&nbsp;file&nbsp;number.&nbsp;Since&nbsp;most&nbsp;functions&nbsp;come&nbsp;from&nbsp;a&nbsp;single&nbsp;file,&nbsp;these</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;are&nbsp;usually&nbsp;short&nbsp;and&nbsp;quick&nbsp;to&nbsp;scan.&nbsp;If&nbsp;a&nbsp;file&nbsp;match&nbsp;is&nbsp;found,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;code&nbsp;goes&nbsp;to&nbsp;the&nbsp;expense&nbsp;of&nbsp;looking&nbsp;for&nbsp;a&nbsp;simultaneous&nbsp;line&nbsp;number&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">findFileLine</span><span class="op">(</span><span class="ident">entry</span>&nbsp;<span class="ident">uint64</span><span class="op">,</span>&nbsp;<span class="ident">filetab</span><span class="op">,</span>&nbsp;<span class="ident">linetab</span>&nbsp;<span class="builtintype">uint32</span><span class="op">,</span>&nbsp;<span class="ident">filenum</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="builtintype">int32</span><span class="op">)</span>&nbsp;<span class="ident">uint64</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">filetab</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">||</span>&nbsp;<span class="ident">linetab</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fp</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">filetab</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fl</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">linetab</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileVal</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filePC</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lineVal</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">linePC</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">entry</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileStartPC</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">filePC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">step</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">fp</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">filePC</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">fileVal</span><span class="op">,</span>&nbsp;<span class="ident">filePC</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">entry</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fileVal</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">filenum</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">fileStartPC</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">filePC</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;fileVal&nbsp;is&nbsp;in&nbsp;effect&nbsp;starting&nbsp;at&nbsp;fileStartPC&nbsp;up&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;but&nbsp;not&nbsp;including&nbsp;filePC,&nbsp;and&nbsp;it&#39;s&nbsp;the&nbsp;file&nbsp;we&nbsp;want.</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Run&nbsp;the&nbsp;PC&nbsp;table&nbsp;looking&nbsp;for&nbsp;a&nbsp;matching&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;or&nbsp;until&nbsp;we&nbsp;reach&nbsp;filePC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lineStartPC</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">linePC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">linePC</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">filePC</span>&nbsp;<span class="op">&amp;&amp;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">step</span><span class="op">(</span><span class="op">&amp;</span><span class="ident">fl</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">linePC</span><span class="op">,</span>&nbsp;<span class="op">&amp;</span><span class="ident">lineVal</span><span class="op">,</span>&nbsp;<span class="ident">linePC</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">entry</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;lineVal&nbsp;is&nbsp;in&nbsp;effect&nbsp;until&nbsp;linePC,&nbsp;and&nbsp;lineStartPC&nbsp;&lt;&nbsp;filePC.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">lineVal</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fileStartPC</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="ident">lineStartPC</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">lineStartPC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fileStartPC</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">linePC</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">fileStartPC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">lineStartPC</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">linePC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fileStartPC</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">filePC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12PCToLine&nbsp;maps&nbsp;program&nbsp;counter&nbsp;to&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;pcln&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12PCToLine</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">line</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">line</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">findFunc</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">-</span><span class="num">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">entry</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">linetab</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">+</span><span class="num">5</span><span class="op">*</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="builtintype">int</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">pcvalue</span><span class="op">(</span><span class="ident">linetab</span><span class="op">,</span>&nbsp;<span class="ident">entry</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12PCToFile&nbsp;maps&nbsp;program&nbsp;counter&nbsp;to&nbsp;file&nbsp;name&nbsp;for&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;pcln&nbsp;table.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12PCToFile</span><span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">file</span>&nbsp;<span class="builtintype">string</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">file</span>&nbsp;<span class="op">=</span>&nbsp;<span class="string">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">findFunc</span><span class="op">(</span><span class="ident">pc</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">f</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="string">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">entry</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filetab</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">+</span><span class="num">4</span><span class="op">*</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">fno</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">pcvalue</span><span class="op">(</span><span class="ident">filetab</span><span class="op">,</span>&nbsp;<span class="ident">entry</span><span class="op">,</span>&nbsp;<span class="ident">pc</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">fno</span>&nbsp;<span class="op">&lt;=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="string">&#34;&#34;</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">string</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span><span class="op">[</span><span class="num">4</span><span class="op">*</span><span class="ident">fno</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12LineToPC&nbsp;maps&nbsp;a&nbsp;(file,&nbsp;line)&nbsp;pair&nbsp;to&nbsp;a&nbsp;program&nbsp;counter&nbsp;for&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;pcln&nbsp;table.</span><br>
<span class="lineno">395</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12LineToPC</span><span class="op">(</span><span class="ident">file</span>&nbsp;<span class="builtintype">string</span><span class="op">,</span>&nbsp;<span class="ident">line</span>&nbsp;<span class="builtintype">int</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="ident">pc</span>&nbsp;<span class="ident">uint64</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">initFileMap</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filenum</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">fileMap</span><span class="op">[</span><span class="ident">file</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">filenum</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Scan&nbsp;all&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;If&nbsp;this&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;a&nbsp;bottleneck,&nbsp;we&nbsp;could&nbsp;build&nbsp;a&nbsp;map[int32][]int32</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;mapping&nbsp;file&nbsp;number&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;functions&nbsp;with&nbsp;code&nbsp;from&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nfunctab</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">f</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">Data</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">functab</span><span class="op">[</span><span class="num">2</span><span class="op">*</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">*</span><span class="ident">i</span><span class="op">+</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">:</span><span class="op">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">entry</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">uintptr</span><span class="op">(</span><span class="ident">f</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">filetab</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">+</span><span class="num">4</span><span class="op">*</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">linetab</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">f</span><span class="op">[</span><span class="ident">t</span><span class="op">.</span><span class="ident">ptrsize</span><span class="op">+</span><span class="num">5</span><span class="op">*</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">pc</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">findFileLine</span><span class="op">(</span><span class="ident">entry</span><span class="op">,</span>&nbsp;<span class="ident">filetab</span><span class="op">,</span>&nbsp;<span class="ident">linetab</span><span class="op">,</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">filenum</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="builtintype">int32</span><span class="op">(</span><span class="ident">line</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">pc</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="num">0</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="num">0</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;initFileMap&nbsp;initializes&nbsp;the&nbsp;map&nbsp;from&nbsp;file&nbsp;name&nbsp;to&nbsp;file&nbsp;number.</span><br>
<span class="lineno">425</span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">initFileMap</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">mu</span><span class="op">.</span><span class="ident">Lock</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">mu</span><span class="op">.</span><span class="ident">Unlock</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">fileMap</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="keyword">map</span><span class="op">[</span><span class="builtintype">string</span><span class="op">]</span><span class="builtintype">uint32</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtintype">uint32</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="op">;</span>&nbsp;<span class="ident">i</span>&nbsp;<span class="op">&lt;</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">nfiletab</span><span class="op">;</span>&nbsp;<span class="ident">i</span><span class="op">++</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="builtintype">string</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">binary</span><span class="op">.</span><span class="ident">Uint32</span><span class="op">(</span><span class="ident">t</span><span class="op">.</span><span class="ident">filetab</span><span class="op">[</span><span class="num">4</span><span class="op">*</span><span class="ident">i</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span><span class="op">[</span><span class="ident">s</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">fileMap</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">m</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;go12MapFiles&nbsp;adds&nbsp;to&nbsp;m&nbsp;a&nbsp;key&nbsp;for&nbsp;every&nbsp;file&nbsp;in&nbsp;the&nbsp;Go&nbsp;1.2&nbsp;LineTable.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Every&nbsp;key&nbsp;maps&nbsp;to&nbsp;obj.&nbsp;That&#39;s&nbsp;not&nbsp;a&nbsp;very&nbsp;interesting&nbsp;map,&nbsp;but&nbsp;it&nbsp;provides</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a&nbsp;way&nbsp;for&nbsp;callers&nbsp;to&nbsp;obtain&nbsp;the&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;program.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">t</span>&nbsp;<span class="op">*</span><span class="ident">LineTable</span><span class="op">)</span>&nbsp;<span class="ident">go12MapFiles</span><span class="op">(</span><span class="ident">m</span>&nbsp;<span class="keyword">map</span><span class="op">[</span><span class="builtintype">string</span><span class="op">]</span><span class="op">*</span><span class="ident">Obj</span><span class="op">,</span>&nbsp;<span class="ident">obj</span>&nbsp;<span class="op">*</span><span class="ident">Obj</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">defer</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">recover</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">t</span><span class="op">.</span><span class="ident">initFileMap</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">file</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">t</span><span class="op">.</span><span class="ident">fileMap</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">m</span><span class="op">[</span><span class="ident">file</span><span class="op">]</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span>
</div>
</body>
</html>
