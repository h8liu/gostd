<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html" class="current">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3082557">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3082613">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3082667">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3082718">package</span>&nbsp;<span class="ident" id="3082726">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3082731">import</span>&nbsp;<span class="op" id="3082738">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3082741">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3082751">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3082758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3082761">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="3082820">//</span><br>
<span class="lineno"></span><span class="comment" id="3082823">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="3082881">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="3082943">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3083005">type</span>&nbsp;<span class="ident" id="3083010">Dialer</span>&nbsp;<span class="keyword" id="3083017">struct</span>&nbsp;<span class="op" id="3083024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083027">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083090">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083154">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083167">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083171">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083202">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083206">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083269">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083329">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083357">Timeout</span>&nbsp;<span class="ident" id="3083365">time</span><span class="op" id="3083369">.</span><span class="ident" id="3083370">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083381">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083442">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083497">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083562">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083594">Deadline</span>&nbsp;<span class="ident" id="3083603">time</span><span class="op" id="3083607">.</span><span class="ident" id="3083608">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083615">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083673">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083735">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083761">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3083814">LocalAddr</span>&nbsp;<span class="ident" id="3083824">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083831">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083890">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3083953">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084014">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084078">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084095">DualStack</span>&nbsp;<span class="builtintype" id="3084105">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084112">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084172">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084196">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3084256">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084311">KeepAlive</span>&nbsp;<span class="ident" id="3084321">time</span><span class="op" id="3084325">.</span><span class="ident" id="3084326">Duration</span><br>
<span class="lineno"></span><span class="op" id="3084335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3084338">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="3084403">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="3084434">func</span>&nbsp;<span class="op" id="3084439">(</span><span class="ident" id="3084440">d</span>&nbsp;<span class="op" id="3084442">*</span><span class="ident" id="3084443">Dialer</span><span class="op" id="3084449">)</span>&nbsp;<span class="ident" id="3084451">deadline</span><span class="op" id="3084459">(</span><span class="op" id="3084460">)</span>&nbsp;<span class="ident" id="3084462">time</span><span class="op" id="3084466">.</span><span class="ident" id="3084467">Time</span>&nbsp;<span class="op" id="3084472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084475">if</span>&nbsp;<span class="ident" id="3084478">d</span><span class="op" id="3084479">.</span><span class="ident" id="3084480">Timeout</span>&nbsp;<span class="op" id="3084488">==</span>&nbsp;<span class="num" id="3084491">0</span>&nbsp;<span class="op" id="3084493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084497">return</span>&nbsp;<span class="ident" id="3084504">d</span><span class="op" id="3084505">.</span><span class="ident" id="3084506">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084519">timeoutDeadline</span>&nbsp;<span class="op" id="3084535">:=</span>&nbsp;<span class="ident" id="3084538">time</span><span class="op" id="3084542">.</span><span class="ident" id="3084543">Now</span><span class="op" id="3084546">(</span><span class="op" id="3084547">)</span><span class="op" id="3084548">.</span><span class="ident" id="3084549">Add</span><span class="op" id="3084552">(</span><span class="ident" id="3084553">d</span><span class="op" id="3084554">.</span><span class="ident" id="3084555">Timeout</span><span class="op" id="3084562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084565">if</span>&nbsp;<span class="ident" id="3084568">d</span><span class="op" id="3084569">.</span><span class="ident" id="3084570">Deadline</span><span class="op" id="3084578">.</span><span class="ident" id="3084579">IsZero</span><span class="op" id="3084585">(</span><span class="op" id="3084586">)</span>&nbsp;<span class="op" id="3084588">||</span>&nbsp;<span class="ident" id="3084591">timeoutDeadline</span><span class="op" id="3084606">.</span><span class="ident" id="3084607">Before</span><span class="op" id="3084613">(</span><span class="ident" id="3084614">d</span><span class="op" id="3084615">.</span><span class="ident" id="3084616">Deadline</span><span class="op" id="3084624">)</span>&nbsp;<span class="op" id="3084626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084630">return</span>&nbsp;<span class="ident" id="3084637">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084654">}</span>&nbsp;<span class="keyword" id="3084656">else</span>&nbsp;<span class="op" id="3084661">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084665">return</span>&nbsp;<span class="ident" id="3084672">d</span><span class="op" id="3084673">.</span><span class="ident" id="3084674">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3084684">}</span><br>
<span class="lineno"></span><span class="op" id="3084686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3084689">func</span>&nbsp;<span class="ident" id="3084694">parseNetwork</span><span class="op" id="3084706">(</span><span class="ident" id="3084707">net</span>&nbsp;<span class="builtintype" id="3084711">string</span><span class="op" id="3084717">)</span>&nbsp;<span class="op" id="3084719">(</span><span class="ident" id="3084720">afnet</span>&nbsp;<span class="builtintype" id="3084726">string</span><span class="op" id="3084732">,</span>&nbsp;<span class="ident" id="3084734">proto</span>&nbsp;<span class="builtintype" id="3084740">int</span><span class="op" id="3084743">,</span>&nbsp;<span class="ident" id="3084745">err</span>&nbsp;<span class="builtintype" id="3084749">error</span><span class="op" id="3084754">)</span>&nbsp;<span class="op" id="3084756">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3084759">i</span>&nbsp;<span class="op" id="3084761">:=</span>&nbsp;<span class="ident" id="3084764">last</span><span class="op" id="3084768">(</span><span class="ident" id="3084769">net</span><span class="op" id="3084772">,</span>&nbsp;<span class="string" id="3084774">&#39;:&#39;</span><span class="op" id="3084777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084780">if</span>&nbsp;<span class="ident" id="3084783">i</span>&nbsp;<span class="op" id="3084785">&lt;</span>&nbsp;<span class="num" id="3084787">0</span>&nbsp;<span class="op" id="3084789">{</span>&nbsp;<span class="comment" id="3084791">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084805">switch</span>&nbsp;<span class="ident" id="3084812">net</span>&nbsp;<span class="op" id="3084816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084820">case</span>&nbsp;<span class="string" id="3084825">&#34;tcp&#34;</span><span class="op" id="3084830">,</span>&nbsp;<span class="string" id="3084832">&#34;tcp4&#34;</span><span class="op" id="3084838">,</span>&nbsp;<span class="string" id="3084840">&#34;tcp6&#34;</span><span class="op" id="3084846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084850">case</span>&nbsp;<span class="string" id="3084855">&#34;udp&#34;</span><span class="op" id="3084860">,</span>&nbsp;<span class="string" id="3084862">&#34;udp4&#34;</span><span class="op" id="3084868">,</span>&nbsp;<span class="string" id="3084870">&#34;udp6&#34;</span><span class="op" id="3084876">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084880">case</span>&nbsp;<span class="string" id="3084885">&#34;ip&#34;</span><span class="op" id="3084889">,</span>&nbsp;<span class="string" id="3084891">&#34;ip4&#34;</span><span class="op" id="3084896">,</span>&nbsp;<span class="string" id="3084898">&#34;ip6&#34;</span><span class="op" id="3084903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084907">case</span>&nbsp;<span class="string" id="3084912">&#34;unix&#34;</span><span class="op" id="3084918">,</span>&nbsp;<span class="string" id="3084920">&#34;unixgram&#34;</span><span class="op" id="3084930">,</span>&nbsp;<span class="string" id="3084932">&#34;unixpacket&#34;</span><span class="op" id="3084944">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084948">default</span><span class="op" id="3084955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3084960">return</span>&nbsp;<span class="string" id="3084967">&#34;&#34;</span><span class="op" id="3084969">,</span>&nbsp;<span class="num" id="3084971">0</span><span class="op" id="3084972">,</span>&nbsp;<span class="ident" id="3084974">UnknownNetworkError</span><span class="op" id="3084993">(</span><span class="ident" id="3084994">net</span><span class="op" id="3084997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085001">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085005">return</span>&nbsp;<span class="ident" id="3085012">net</span><span class="op" id="3085015">,</span>&nbsp;<span class="num" id="3085017">0</span><span class="op" id="3085018">,</span>&nbsp;<span class="ident" id="3085020">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085028">afnet</span>&nbsp;<span class="op" id="3085034">=</span>&nbsp;<span class="ident" id="3085036">net</span><span class="op" id="3085039">[</span><span class="op" id="3085040">:</span><span class="ident" id="3085041">i</span><span class="op" id="3085042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085045">switch</span>&nbsp;<span class="ident" id="3085052">afnet</span>&nbsp;<span class="op" id="3085058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085061">case</span>&nbsp;<span class="string" id="3085066">&#34;ip&#34;</span><span class="op" id="3085070">,</span>&nbsp;<span class="string" id="3085072">&#34;ip4&#34;</span><span class="op" id="3085077">,</span>&nbsp;<span class="string" id="3085079">&#34;ip6&#34;</span><span class="op" id="3085084">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085088">protostr</span>&nbsp;<span class="op" id="3085097">:=</span>&nbsp;<span class="ident" id="3085100">net</span><span class="op" id="3085103">[</span><span class="ident" id="3085104">i</span><span class="op" id="3085105">+</span><span class="num" id="3085106">1</span><span class="op" id="3085107">:</span><span class="op" id="3085108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085112">proto</span><span class="op" id="3085117">,</span>&nbsp;<span class="ident" id="3085119">i</span><span class="op" id="3085120">,</span>&nbsp;<span class="ident" id="3085122">ok</span>&nbsp;<span class="op" id="3085125">:=</span>&nbsp;<span class="ident" id="3085128">dtoi</span><span class="op" id="3085132">(</span><span class="ident" id="3085133">protostr</span><span class="op" id="3085141">,</span>&nbsp;<span class="num" id="3085143">0</span><span class="op" id="3085144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085148">if</span>&nbsp;<span class="op" id="3085151">!</span><span class="ident" id="3085152">ok</span>&nbsp;<span class="op" id="3085155">||</span>&nbsp;<span class="ident" id="3085158">i</span>&nbsp;<span class="op" id="3085160">!=</span>&nbsp;<span class="builtinfunc" id="3085163">len</span><span class="op" id="3085166">(</span><span class="ident" id="3085167">protostr</span><span class="op" id="3085175">)</span>&nbsp;<span class="op" id="3085177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085182">proto</span><span class="op" id="3085187">,</span>&nbsp;<span class="ident" id="3085189">err</span>&nbsp;<span class="op" id="3085193">=</span>&nbsp;<span class="ident" id="3085195">lookupProtocol</span><span class="op" id="3085209">(</span><span class="ident" id="3085210">protostr</span><span class="op" id="3085218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085223">if</span>&nbsp;<span class="ident" id="3085226">err</span>&nbsp;<span class="op" id="3085230">!=</span>&nbsp;<span class="ident" id="3085233">nil</span>&nbsp;<span class="op" id="3085237">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085243">return</span>&nbsp;<span class="string" id="3085250">&#34;&#34;</span><span class="op" id="3085252">,</span>&nbsp;<span class="num" id="3085254">0</span><span class="op" id="3085255">,</span>&nbsp;<span class="ident" id="3085257">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085272">return</span>&nbsp;<span class="ident" id="3085279">afnet</span><span class="op" id="3085284">,</span>&nbsp;<span class="ident" id="3085286">proto</span><span class="op" id="3085291">,</span>&nbsp;<span class="ident" id="3085293">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085298">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085301">return</span>&nbsp;<span class="string" id="3085308">&#34;&#34;</span><span class="op" id="3085310">,</span>&nbsp;<span class="num" id="3085312">0</span><span class="op" id="3085313">,</span>&nbsp;<span class="ident" id="3085315">UnknownNetworkError</span><span class="op" id="3085334">(</span><span class="ident" id="3085335">net</span><span class="op" id="3085338">)</span><br>
<span class="lineno"></span><span class="op" id="3085340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3085343">func</span>&nbsp;<span class="ident" id="3085348">resolveAddr</span><span class="op" id="3085359">(</span><span class="ident" id="3085360">op</span><span class="op" id="3085362">,</span>&nbsp;<span class="ident" id="3085364">net</span><span class="op" id="3085367">,</span>&nbsp;<span class="ident" id="3085369">addr</span>&nbsp;<span class="builtintype" id="3085374">string</span><span class="op" id="3085380">,</span>&nbsp;<span class="ident" id="3085382">deadline</span>&nbsp;<span class="ident" id="3085391">time</span><span class="op" id="3085395">.</span><span class="ident" id="3085396">Time</span><span class="op" id="3085400">)</span>&nbsp;<span class="op" id="3085402">(</span><span class="ident" id="3085403">netaddr</span><span class="op" id="3085410">,</span>&nbsp;<span class="builtintype" id="3085412">error</span><span class="op" id="3085417">)</span>&nbsp;<span class="op" id="3085419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3085422">afnet</span><span class="op" id="3085427">,</span>&nbsp;<span class="ident" id="3085429">_</span><span class="op" id="3085430">,</span>&nbsp;<span class="ident" id="3085432">err</span>&nbsp;<span class="op" id="3085436">:=</span>&nbsp;<span class="ident" id="3085439">parseNetwork</span><span class="op" id="3085451">(</span><span class="ident" id="3085452">net</span><span class="op" id="3085455">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085458">if</span>&nbsp;<span class="ident" id="3085461">err</span>&nbsp;<span class="op" id="3085465">!=</span>&nbsp;<span class="ident" id="3085468">nil</span>&nbsp;<span class="op" id="3085472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085476">return</span>&nbsp;<span class="ident" id="3085483">nil</span><span class="op" id="3085486">,</span>&nbsp;<span class="ident" id="3085488">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085496">if</span>&nbsp;<span class="ident" id="3085499">op</span>&nbsp;<span class="op" id="3085502">==</span>&nbsp;<span class="string" id="3085505">&#34;dial&#34;</span>&nbsp;<span class="op" id="3085512">&amp;&amp;</span>&nbsp;<span class="ident" id="3085515">addr</span>&nbsp;<span class="op" id="3085520">==</span>&nbsp;<span class="string" id="3085523">&#34;&#34;</span>&nbsp;<span class="op" id="3085526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085530">return</span>&nbsp;<span class="ident" id="3085537">nil</span><span class="op" id="3085540">,</span>&nbsp;<span class="ident" id="3085542">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085564">switch</span>&nbsp;<span class="ident" id="3085571">afnet</span>&nbsp;<span class="op" id="3085577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085580">case</span>&nbsp;<span class="string" id="3085585">&#34;unix&#34;</span><span class="op" id="3085591">,</span>&nbsp;<span class="string" id="3085593">&#34;unixgram&#34;</span><span class="op" id="3085603">,</span>&nbsp;<span class="string" id="3085605">&#34;unixpacket&#34;</span><span class="op" id="3085617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085621">return</span>&nbsp;<span class="ident" id="3085628">ResolveUnixAddr</span><span class="op" id="3085643">(</span><span class="ident" id="3085644">afnet</span><span class="op" id="3085649">,</span>&nbsp;<span class="ident" id="3085651">addr</span><span class="op" id="3085655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3085658">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3085661">return</span>&nbsp;<span class="ident" id="3085668">resolveInternetAddr</span><span class="op" id="3085687">(</span><span class="ident" id="3085688">afnet</span><span class="op" id="3085693">,</span>&nbsp;<span class="ident" id="3085695">addr</span><span class="op" id="3085699">,</span>&nbsp;<span class="ident" id="3085701">deadline</span><span class="op" id="3085709">)</span><br>
<span class="lineno"></span><span class="op" id="3085711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3085714">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3085768">//</span><br>
<span class="lineno">115</span><span class="comment" id="3085771">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="3085840">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3085902">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3085960">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3085977">//</span><br>
<span class="lineno">120</span><span class="comment" id="3085980">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="3086044">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="3086101">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3086166">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="3086235">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="3086252">//</span><br>
<span class="lineno"></span><span class="comment" id="3086255">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3086268">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3086301">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3086335">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="3086372">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3086407">//</span><br>
<span class="lineno"></span><span class="comment" id="3086410">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="3086480">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3086547">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="3086570">//</span><br>
<span class="lineno"></span><span class="comment" id="3086573">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="3086586">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3086616">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3086643">//</span><br>
<span class="lineno">140</span><span class="comment" id="3086646">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="3086708">func</span>&nbsp;<span class="ident" id="3086713">Dial</span><span class="op" id="3086717">(</span><span class="ident" id="3086718">network</span><span class="op" id="3086725">,</span>&nbsp;<span class="ident" id="3086727">address</span>&nbsp;<span class="builtintype" id="3086735">string</span><span class="op" id="3086741">)</span>&nbsp;<span class="op" id="3086743">(</span><span class="ident" id="3086744">Conn</span><span class="op" id="3086748">,</span>&nbsp;<span class="builtintype" id="3086750">error</span><span class="op" id="3086755">)</span>&nbsp;<span class="op" id="3086757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086760">var</span>&nbsp;<span class="ident" id="3086764">d</span>&nbsp;<span class="ident" id="3086766">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3086774">return</span>&nbsp;<span class="ident" id="3086781">d</span><span class="op" id="3086782">.</span><span class="ident" id="3086783">Dial</span><span class="op" id="3086787">(</span><span class="ident" id="3086788">network</span><span class="op" id="3086795">,</span>&nbsp;<span class="ident" id="3086797">address</span><span class="op" id="3086804">)</span><br>
<span class="lineno"></span><span class="op" id="3086806">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="3086809">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="3086860">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="3086914">func</span>&nbsp;<span class="ident" id="3086919">DialTimeout</span><span class="op" id="3086930">(</span><span class="ident" id="3086931">network</span><span class="op" id="3086938">,</span>&nbsp;<span class="ident" id="3086940">address</span>&nbsp;<span class="builtintype" id="3086948">string</span><span class="op" id="3086954">,</span>&nbsp;<span class="ident" id="3086956">timeout</span>&nbsp;<span class="ident" id="3086964">time</span><span class="op" id="3086968">.</span><span class="ident" id="3086969">Duration</span><span class="op" id="3086977">)</span>&nbsp;<span class="op" id="3086979">(</span><span class="ident" id="3086980">Conn</span><span class="op" id="3086984">,</span>&nbsp;<span class="builtintype" id="3086986">error</span><span class="op" id="3086991">)</span>&nbsp;<span class="op" id="3086993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3086996">d</span>&nbsp;<span class="op" id="3086998">:=</span>&nbsp;<span class="ident" id="3087001">Dialer</span><span class="op" id="3087007">{</span><span class="ident" id="3087008">Timeout</span><span class="op" id="3087015">:</span>&nbsp;<span class="ident" id="3087017">timeout</span><span class="op" id="3087024">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087027">return</span>&nbsp;<span class="ident" id="3087034">d</span><span class="op" id="3087035">.</span><span class="ident" id="3087036">Dial</span><span class="op" id="3087040">(</span><span class="ident" id="3087041">network</span><span class="op" id="3087048">,</span>&nbsp;<span class="ident" id="3087050">address</span><span class="op" id="3087057">)</span><br>
<span class="lineno"></span><span class="op" id="3087059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3087062">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="3087116">//</span><br>
<span class="lineno">155</span><span class="comment" id="3087119">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3087181">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="3087196">func</span>&nbsp;<span class="op" id="3087201">(</span><span class="ident" id="3087202">d</span>&nbsp;<span class="op" id="3087204">*</span><span class="ident" id="3087205">Dialer</span><span class="op" id="3087211">)</span>&nbsp;<span class="ident" id="3087213">Dial</span><span class="op" id="3087217">(</span><span class="ident" id="3087218">network</span><span class="op" id="3087225">,</span>&nbsp;<span class="ident" id="3087227">address</span>&nbsp;<span class="builtintype" id="3087235">string</span><span class="op" id="3087241">)</span>&nbsp;<span class="op" id="3087243">(</span><span class="ident" id="3087244">Conn</span><span class="op" id="3087248">,</span>&nbsp;<span class="builtintype" id="3087250">error</span><span class="op" id="3087255">)</span>&nbsp;<span class="op" id="3087257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087260">ra</span><span class="op" id="3087262">,</span>&nbsp;<span class="ident" id="3087264">err</span>&nbsp;<span class="op" id="3087268">:=</span>&nbsp;<span class="ident" id="3087271">resolveAddr</span><span class="op" id="3087282">(</span><span class="string" id="3087283">&#34;dial&#34;</span><span class="op" id="3087289">,</span>&nbsp;<span class="ident" id="3087291">network</span><span class="op" id="3087298">,</span>&nbsp;<span class="ident" id="3087300">address</span><span class="op" id="3087307">,</span>&nbsp;<span class="ident" id="3087309">d</span><span class="op" id="3087310">.</span><span class="ident" id="3087311">deadline</span><span class="op" id="3087319">(</span><span class="op" id="3087320">)</span><span class="op" id="3087321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087324">if</span>&nbsp;<span class="ident" id="3087327">err</span>&nbsp;<span class="op" id="3087331">!=</span>&nbsp;<span class="ident" id="3087334">nil</span>&nbsp;<span class="op" id="3087338">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087342">return</span>&nbsp;<span class="ident" id="3087349">nil</span><span class="op" id="3087352">,</span>&nbsp;<span class="op" id="3087354">&amp;</span><span class="ident" id="3087355">OpError</span><span class="op" id="3087362">{</span><span class="ident" id="3087363">Op</span><span class="op" id="3087365">:</span>&nbsp;<span class="string" id="3087367">&#34;dial&#34;</span><span class="op" id="3087373">,</span>&nbsp;<span class="ident" id="3087375">Net</span><span class="op" id="3087378">:</span>&nbsp;<span class="ident" id="3087380">network</span><span class="op" id="3087387">,</span>&nbsp;<span class="ident" id="3087389">Addr</span><span class="op" id="3087393">:</span>&nbsp;<span class="ident" id="3087395">nil</span><span class="op" id="3087398">,</span>&nbsp;<span class="ident" id="3087400">Err</span><span class="op" id="3087403">:</span>&nbsp;<span class="ident" id="3087405">err</span><span class="op" id="3087408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087414">dialer</span>&nbsp;<span class="op" id="3087421">:=</span>&nbsp;<span class="keyword" id="3087424">func</span><span class="op" id="3087428">(</span><span class="ident" id="3087429">deadline</span>&nbsp;<span class="ident" id="3087438">time</span><span class="op" id="3087442">.</span><span class="ident" id="3087443">Time</span><span class="op" id="3087447">)</span>&nbsp;<span class="op" id="3087449">(</span><span class="ident" id="3087450">Conn</span><span class="op" id="3087454">,</span>&nbsp;<span class="builtintype" id="3087456">error</span><span class="op" id="3087461">)</span>&nbsp;<span class="op" id="3087463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087467">return</span>&nbsp;<span class="ident" id="3087474">dialSingle</span><span class="op" id="3087484">(</span><span class="ident" id="3087485">network</span><span class="op" id="3087492">,</span>&nbsp;<span class="ident" id="3087494">address</span><span class="op" id="3087501">,</span>&nbsp;<span class="ident" id="3087503">d</span><span class="op" id="3087504">.</span><span class="ident" id="3087505">LocalAddr</span><span class="op" id="3087514">,</span>&nbsp;<span class="ident" id="3087516">ra</span><span class="op" id="3087518">.</span><span class="ident" id="3087519">toAddr</span><span class="op" id="3087525">(</span><span class="op" id="3087526">)</span><span class="op" id="3087527">,</span>&nbsp;<span class="ident" id="3087529">deadline</span><span class="op" id="3087537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087540">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087543">if</span>&nbsp;<span class="ident" id="3087546">ras</span><span class="op" id="3087549">,</span>&nbsp;<span class="ident" id="3087551">ok</span>&nbsp;<span class="op" id="3087554">:=</span>&nbsp;<span class="ident" id="3087557">ra</span><span class="op" id="3087559">.</span><span class="op" id="3087560">(</span><span class="ident" id="3087561">addrList</span><span class="op" id="3087569">)</span><span class="op" id="3087570">;</span>&nbsp;<span class="ident" id="3087572">ok</span>&nbsp;<span class="op" id="3087575">&amp;&amp;</span>&nbsp;<span class="ident" id="3087578">d</span><span class="op" id="3087579">.</span><span class="ident" id="3087580">DualStack</span>&nbsp;<span class="op" id="3087590">&amp;&amp;</span>&nbsp;<span class="ident" id="3087593">network</span>&nbsp;<span class="op" id="3087601">==</span>&nbsp;<span class="string" id="3087604">&#34;tcp&#34;</span>&nbsp;<span class="op" id="3087610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087614">dialer</span>&nbsp;<span class="op" id="3087621">=</span>&nbsp;<span class="keyword" id="3087623">func</span><span class="op" id="3087627">(</span><span class="ident" id="3087628">deadline</span>&nbsp;<span class="ident" id="3087637">time</span><span class="op" id="3087641">.</span><span class="ident" id="3087642">Time</span><span class="op" id="3087646">)</span>&nbsp;<span class="op" id="3087648">(</span><span class="ident" id="3087649">Conn</span><span class="op" id="3087653">,</span>&nbsp;<span class="builtintype" id="3087655">error</span><span class="op" id="3087660">)</span>&nbsp;<span class="op" id="3087662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087667">return</span>&nbsp;<span class="ident" id="3087674">dialMulti</span><span class="op" id="3087683">(</span><span class="ident" id="3087684">network</span><span class="op" id="3087691">,</span>&nbsp;<span class="ident" id="3087693">address</span><span class="op" id="3087700">,</span>&nbsp;<span class="ident" id="3087702">d</span><span class="op" id="3087703">.</span><span class="ident" id="3087704">LocalAddr</span><span class="op" id="3087713">,</span>&nbsp;<span class="ident" id="3087715">ras</span><span class="op" id="3087718">,</span>&nbsp;<span class="ident" id="3087720">deadline</span><span class="op" id="3087728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087735">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087738">c</span><span class="op" id="3087739">,</span>&nbsp;<span class="ident" id="3087741">err</span>&nbsp;<span class="op" id="3087745">:=</span>&nbsp;<span class="ident" id="3087748">dial</span><span class="op" id="3087752">(</span><span class="ident" id="3087753">network</span><span class="op" id="3087760">,</span>&nbsp;<span class="ident" id="3087762">ra</span><span class="op" id="3087764">.</span><span class="ident" id="3087765">toAddr</span><span class="op" id="3087771">(</span><span class="op" id="3087772">)</span><span class="op" id="3087773">,</span>&nbsp;<span class="ident" id="3087775">dialer</span><span class="op" id="3087781">,</span>&nbsp;<span class="ident" id="3087783">d</span><span class="op" id="3087784">.</span><span class="ident" id="3087785">deadline</span><span class="op" id="3087793">(</span><span class="op" id="3087794">)</span><span class="op" id="3087795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087798">if</span>&nbsp;<span class="ident" id="3087801">d</span><span class="op" id="3087802">.</span><span class="ident" id="3087803">KeepAlive</span>&nbsp;<span class="op" id="3087813">&gt;</span>&nbsp;<span class="num" id="3087815">0</span>&nbsp;<span class="op" id="3087817">&amp;&amp;</span>&nbsp;<span class="ident" id="3087820">err</span>&nbsp;<span class="op" id="3087824">==</span>&nbsp;<span class="ident" id="3087827">nil</span>&nbsp;<span class="op" id="3087831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087835">if</span>&nbsp;<span class="ident" id="3087838">tc</span><span class="op" id="3087840">,</span>&nbsp;<span class="ident" id="3087842">ok</span>&nbsp;<span class="op" id="3087845">:=</span>&nbsp;<span class="ident" id="3087848">c</span><span class="op" id="3087849">.</span><span class="op" id="3087850">(</span><span class="op" id="3087851">*</span><span class="ident" id="3087852">TCPConn</span><span class="op" id="3087859">)</span><span class="op" id="3087860">;</span>&nbsp;<span class="ident" id="3087862">ok</span>&nbsp;<span class="op" id="3087865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087870">tc</span><span class="op" id="3087872">.</span><span class="ident" id="3087873">SetKeepAlive</span><span class="op" id="3087885">(</span><span class="builtintype" id="3087886">true</span><span class="op" id="3087890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087895">tc</span><span class="op" id="3087897">.</span><span class="ident" id="3087898">SetKeepAlivePeriod</span><span class="op" id="3087916">(</span><span class="ident" id="3087917">d</span><span class="op" id="3087918">.</span><span class="ident" id="3087919">KeepAlive</span><span class="op" id="3087928">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3087933">testHookSetKeepAlive</span><span class="op" id="3087953">(</span><span class="op" id="3087954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3087961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3087964">return</span>&nbsp;<span class="ident" id="3087971">c</span><span class="op" id="3087972">,</span>&nbsp;<span class="ident" id="3087974">err</span><br>
<span class="lineno"></span><span class="op" id="3087978">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="3087981">var</span>&nbsp;<span class="ident" id="3087985">testHookSetKeepAlive</span>&nbsp;<span class="op" id="3088006">=</span>&nbsp;<span class="keyword" id="3088008">func</span><span class="op" id="3088012">(</span><span class="op" id="3088013">)</span>&nbsp;<span class="op" id="3088015">{</span><span class="op" id="3088016">}</span>&nbsp;<span class="comment" id="3088018">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3088046">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3088116">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="3088179">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3088247">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="3088277">func</span>&nbsp;<span class="ident" id="3088282">dialMulti</span><span class="op" id="3088291">(</span><span class="ident" id="3088292">net</span><span class="op" id="3088295">,</span>&nbsp;<span class="ident" id="3088297">addr</span>&nbsp;<span class="builtintype" id="3088302">string</span><span class="op" id="3088308">,</span>&nbsp;<span class="ident" id="3088310">la</span>&nbsp;<span class="ident" id="3088313">Addr</span><span class="op" id="3088317">,</span>&nbsp;<span class="ident" id="3088319">ras</span>&nbsp;<span class="ident" id="3088323">addrList</span><span class="op" id="3088331">,</span>&nbsp;<span class="ident" id="3088333">deadline</span>&nbsp;<span class="ident" id="3088342">time</span><span class="op" id="3088346">.</span><span class="ident" id="3088347">Time</span><span class="op" id="3088351">)</span>&nbsp;<span class="op" id="3088353">(</span><span class="ident" id="3088354">Conn</span><span class="op" id="3088358">,</span>&nbsp;<span class="builtintype" id="3088360">error</span><span class="op" id="3088365">)</span>&nbsp;<span class="op" id="3088367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088370">type</span>&nbsp;<span class="ident" id="3088375">racer</span>&nbsp;<span class="keyword" id="3088381">struct</span>&nbsp;<span class="op" id="3088388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088392">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3088399">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088409">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088472">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088535">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088564">sig</span>&nbsp;<span class="op" id="3088568">:=</span>&nbsp;<span class="builtinfunc" id="3088571">make</span><span class="op" id="3088575">(</span><span class="keyword" id="3088576">chan</span>&nbsp;<span class="builtintype" id="3088581">bool</span><span class="op" id="3088585">,</span>&nbsp;<span class="num" id="3088587">1</span><span class="op" id="3088588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088591">lane</span>&nbsp;<span class="op" id="3088596">:=</span>&nbsp;<span class="builtinfunc" id="3088599">make</span><span class="op" id="3088603">(</span><span class="keyword" id="3088604">chan</span>&nbsp;<span class="ident" id="3088609">racer</span><span class="op" id="3088614">,</span>&nbsp;<span class="num" id="3088616">1</span><span class="op" id="3088617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088620">for</span>&nbsp;<span class="ident" id="3088624">_</span><span class="op" id="3088625">,</span>&nbsp;<span class="ident" id="3088627">ra</span>&nbsp;<span class="op" id="3088630">:=</span>&nbsp;<span class="keyword" id="3088633">range</span>&nbsp;<span class="ident" id="3088639">ras</span>&nbsp;<span class="op" id="3088643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088647">go</span>&nbsp;<span class="keyword" id="3088650">func</span><span class="op" id="3088654">(</span><span class="ident" id="3088655">ra</span>&nbsp;<span class="ident" id="3088658">Addr</span><span class="op" id="3088662">)</span>&nbsp;<span class="op" id="3088664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088669">c</span><span class="op" id="3088670">,</span>&nbsp;<span class="ident" id="3088672">err</span>&nbsp;<span class="op" id="3088676">:=</span>&nbsp;<span class="ident" id="3088679">dialSingle</span><span class="op" id="3088689">(</span><span class="ident" id="3088690">net</span><span class="op" id="3088693">,</span>&nbsp;<span class="ident" id="3088695">addr</span><span class="op" id="3088699">,</span>&nbsp;<span class="ident" id="3088701">la</span><span class="op" id="3088703">,</span>&nbsp;<span class="ident" id="3088705">ra</span><span class="op" id="3088707">,</span>&nbsp;<span class="ident" id="3088709">deadline</span><span class="op" id="3088717">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088722">if</span>&nbsp;<span class="ident" id="3088725">_</span><span class="op" id="3088726">,</span>&nbsp;<span class="ident" id="3088728">ok</span>&nbsp;<span class="op" id="3088731">:=</span>&nbsp;<span class="op" id="3088734">&lt;-</span><span class="ident" id="3088736">sig</span><span class="op" id="3088739">;</span>&nbsp;<span class="ident" id="3088741">ok</span>&nbsp;<span class="op" id="3088744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088750">lane</span>&nbsp;<span class="op" id="3088755">&lt;-</span>&nbsp;<span class="ident" id="3088758">racer</span><span class="op" id="3088763">{</span><span class="ident" id="3088764">c</span><span class="op" id="3088765">,</span>&nbsp;<span class="ident" id="3088767">err</span><span class="op" id="3088770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088775">}</span>&nbsp;<span class="keyword" id="3088777">else</span>&nbsp;<span class="keyword" id="3088782">if</span>&nbsp;<span class="ident" id="3088785">err</span>&nbsp;<span class="op" id="3088789">==</span>&nbsp;<span class="ident" id="3088792">nil</span>&nbsp;<span class="op" id="3088796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088802">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088841">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088873">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3088910">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3088950">c</span><span class="op" id="3088951">.</span><span class="ident" id="3088952">Close</span><span class="op" id="3088957">(</span><span class="op" id="3088958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088967">}</span><span class="op" id="3088968">(</span><span class="ident" id="3088969">ra</span><span class="op" id="3088971">.</span><span class="ident" id="3088972">toAddr</span><span class="op" id="3088978">(</span><span class="op" id="3088979">)</span><span class="op" id="3088980">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3088983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3088986">defer</span>&nbsp;<span class="builtinfunc" id="3088992">close</span><span class="op" id="3088997">(</span><span class="ident" id="3088998">sig</span><span class="op" id="3089001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089004">lastErr</span>&nbsp;<span class="op" id="3089012">:=</span>&nbsp;<span class="ident" id="3089015">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089027">nracers</span>&nbsp;<span class="op" id="3089035">:=</span>&nbsp;<span class="builtinfunc" id="3089038">len</span><span class="op" id="3089041">(</span><span class="ident" id="3089042">ras</span><span class="op" id="3089045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089048">for</span>&nbsp;<span class="ident" id="3089052">nracers</span>&nbsp;<span class="op" id="3089060">&gt;</span>&nbsp;<span class="num" id="3089062">0</span>&nbsp;<span class="op" id="3089064">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089068">sig</span>&nbsp;<span class="op" id="3089072">&lt;-</span>&nbsp;<span class="builtintype" id="3089075">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089082">racer</span>&nbsp;<span class="op" id="3089088">:=</span>&nbsp;<span class="op" id="3089091">&lt;-</span><span class="ident" id="3089093">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089100">if</span>&nbsp;<span class="ident" id="3089103">racer</span><span class="op" id="3089108">.</span><span class="builtintype" id="3089109">error</span>&nbsp;<span class="op" id="3089115">==</span>&nbsp;<span class="ident" id="3089118">nil</span>&nbsp;<span class="op" id="3089122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089127">return</span>&nbsp;<span class="ident" id="3089134">racer</span><span class="op" id="3089139">.</span><span class="ident" id="3089140">Conn</span><span class="op" id="3089144">,</span>&nbsp;<span class="ident" id="3089146">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089152">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089156">lastErr</span>&nbsp;<span class="op" id="3089164">=</span>&nbsp;<span class="ident" id="3089166">racer</span><span class="op" id="3089171">.</span><span class="builtintype" id="3089172">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089180">nracers</span><span class="op" id="3089187">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089194">return</span>&nbsp;<span class="ident" id="3089201">nil</span><span class="op" id="3089204">,</span>&nbsp;<span class="ident" id="3089206">lastErr</span><br>
<span class="lineno"></span><span class="op" id="3089214">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="3089217">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3089288">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3089316">func</span>&nbsp;<span class="ident" id="3089321">dialSingle</span><span class="op" id="3089331">(</span><span class="ident" id="3089332">net</span><span class="op" id="3089335">,</span>&nbsp;<span class="ident" id="3089337">addr</span>&nbsp;<span class="builtintype" id="3089342">string</span><span class="op" id="3089348">,</span>&nbsp;<span class="ident" id="3089350">la</span><span class="op" id="3089352">,</span>&nbsp;<span class="ident" id="3089354">ra</span>&nbsp;<span class="ident" id="3089357">Addr</span><span class="op" id="3089361">,</span>&nbsp;<span class="ident" id="3089363">deadline</span>&nbsp;<span class="ident" id="3089372">time</span><span class="op" id="3089376">.</span><span class="ident" id="3089377">Time</span><span class="op" id="3089381">)</span>&nbsp;<span class="op" id="3089383">(</span><span class="ident" id="3089384">c</span>&nbsp;<span class="ident" id="3089386">Conn</span><span class="op" id="3089390">,</span>&nbsp;<span class="ident" id="3089392">err</span>&nbsp;<span class="builtintype" id="3089396">error</span><span class="op" id="3089401">)</span>&nbsp;<span class="op" id="3089403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089406">if</span>&nbsp;<span class="ident" id="3089409">la</span>&nbsp;<span class="op" id="3089412">!=</span>&nbsp;<span class="ident" id="3089415">nil</span>&nbsp;<span class="op" id="3089419">&amp;&amp;</span>&nbsp;<span class="ident" id="3089422">la</span><span class="op" id="3089424">.</span><span class="ident" id="3089425">Network</span><span class="op" id="3089432">(</span><span class="op" id="3089433">)</span>&nbsp;<span class="op" id="3089435">!=</span>&nbsp;<span class="ident" id="3089438">ra</span><span class="op" id="3089440">.</span><span class="ident" id="3089441">Network</span><span class="op" id="3089448">(</span><span class="op" id="3089449">)</span>&nbsp;<span class="op" id="3089451">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089455">return</span>&nbsp;<span class="ident" id="3089462">nil</span><span class="op" id="3089465">,</span>&nbsp;<span class="op" id="3089467">&amp;</span><span class="ident" id="3089468">OpError</span><span class="op" id="3089475">{</span><span class="ident" id="3089476">Op</span><span class="op" id="3089478">:</span>&nbsp;<span class="string" id="3089480">&#34;dial&#34;</span><span class="op" id="3089486">,</span>&nbsp;<span class="ident" id="3089488">Net</span><span class="op" id="3089491">:</span>&nbsp;<span class="ident" id="3089493">net</span><span class="op" id="3089496">,</span>&nbsp;<span class="ident" id="3089498">Addr</span><span class="op" id="3089502">:</span>&nbsp;<span class="ident" id="3089504">ra</span><span class="op" id="3089506">,</span>&nbsp;<span class="ident" id="3089508">Err</span><span class="op" id="3089511">:</span>&nbsp;<span class="ident" id="3089513">errors</span><span class="op" id="3089519">.</span><span class="ident" id="3089520">New</span><span class="op" id="3089523">(</span><span class="string" id="3089524">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="3089557">+</span>&nbsp;<span class="ident" id="3089559">la</span><span class="op" id="3089561">.</span><span class="ident" id="3089562">Network</span><span class="op" id="3089569">(</span><span class="op" id="3089570">)</span><span class="op" id="3089571">)</span><span class="op" id="3089572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3089575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089578">switch</span>&nbsp;<span class="ident" id="3089585">ra</span>&nbsp;<span class="op" id="3089588">:=</span>&nbsp;<span class="ident" id="3089591">ra</span><span class="op" id="3089593">.</span><span class="op" id="3089594">(</span><span class="keyword" id="3089595">type</span><span class="op" id="3089599">)</span>&nbsp;<span class="op" id="3089601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089604">case</span>&nbsp;<span class="op" id="3089609">*</span><span class="ident" id="3089610">TCPAddr</span><span class="op" id="3089617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089621">la</span><span class="op" id="3089623">,</span>&nbsp;<span class="ident" id="3089625">_</span>&nbsp;<span class="op" id="3089627">:=</span>&nbsp;<span class="ident" id="3089630">la</span><span class="op" id="3089632">.</span><span class="op" id="3089633">(</span><span class="op" id="3089634">*</span><span class="ident" id="3089635">TCPAddr</span><span class="op" id="3089642">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089646">c</span><span class="op" id="3089647">,</span>&nbsp;<span class="ident" id="3089649">err</span>&nbsp;<span class="op" id="3089653">=</span>&nbsp;<span class="ident" id="3089655">dialTCP</span><span class="op" id="3089662">(</span><span class="ident" id="3089663">net</span><span class="op" id="3089666">,</span>&nbsp;<span class="ident" id="3089668">la</span><span class="op" id="3089670">,</span>&nbsp;<span class="ident" id="3089672">ra</span><span class="op" id="3089674">,</span>&nbsp;<span class="ident" id="3089676">deadline</span><span class="op" id="3089684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089687">case</span>&nbsp;<span class="op" id="3089692">*</span><span class="ident" id="3089693">UDPAddr</span><span class="op" id="3089700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089704">la</span><span class="op" id="3089706">,</span>&nbsp;<span class="ident" id="3089708">_</span>&nbsp;<span class="op" id="3089710">:=</span>&nbsp;<span class="ident" id="3089713">la</span><span class="op" id="3089715">.</span><span class="op" id="3089716">(</span><span class="op" id="3089717">*</span><span class="ident" id="3089718">UDPAddr</span><span class="op" id="3089725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089729">c</span><span class="op" id="3089730">,</span>&nbsp;<span class="ident" id="3089732">err</span>&nbsp;<span class="op" id="3089736">=</span>&nbsp;<span class="ident" id="3089738">dialUDP</span><span class="op" id="3089745">(</span><span class="ident" id="3089746">net</span><span class="op" id="3089749">,</span>&nbsp;<span class="ident" id="3089751">la</span><span class="op" id="3089753">,</span>&nbsp;<span class="ident" id="3089755">ra</span><span class="op" id="3089757">,</span>&nbsp;<span class="ident" id="3089759">deadline</span><span class="op" id="3089767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089770">case</span>&nbsp;<span class="op" id="3089775">*</span><span class="ident" id="3089776">IPAddr</span><span class="op" id="3089782">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089786">la</span><span class="op" id="3089788">,</span>&nbsp;<span class="ident" id="3089790">_</span>&nbsp;<span class="op" id="3089792">:=</span>&nbsp;<span class="ident" id="3089795">la</span><span class="op" id="3089797">.</span><span class="op" id="3089798">(</span><span class="op" id="3089799">*</span><span class="ident" id="3089800">IPAddr</span><span class="op" id="3089806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089810">c</span><span class="op" id="3089811">,</span>&nbsp;<span class="ident" id="3089813">err</span>&nbsp;<span class="op" id="3089817">=</span>&nbsp;<span class="ident" id="3089819">dialIP</span><span class="op" id="3089825">(</span><span class="ident" id="3089826">net</span><span class="op" id="3089829">,</span>&nbsp;<span class="ident" id="3089831">la</span><span class="op" id="3089833">,</span>&nbsp;<span class="ident" id="3089835">ra</span><span class="op" id="3089837">,</span>&nbsp;<span class="ident" id="3089839">deadline</span><span class="op" id="3089847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089850">case</span>&nbsp;<span class="op" id="3089855">*</span><span class="ident" id="3089856">UnixAddr</span><span class="op" id="3089864">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089868">la</span><span class="op" id="3089870">,</span>&nbsp;<span class="ident" id="3089872">_</span>&nbsp;<span class="op" id="3089874">:=</span>&nbsp;<span class="ident" id="3089877">la</span><span class="op" id="3089879">.</span><span class="op" id="3089880">(</span><span class="op" id="3089881">*</span><span class="ident" id="3089882">UnixAddr</span><span class="op" id="3089890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3089894">c</span><span class="op" id="3089895">,</span>&nbsp;<span class="ident" id="3089897">err</span>&nbsp;<span class="op" id="3089901">=</span>&nbsp;<span class="ident" id="3089903">dialUnix</span><span class="op" id="3089911">(</span><span class="ident" id="3089912">net</span><span class="op" id="3089915">,</span>&nbsp;<span class="ident" id="3089917">la</span><span class="op" id="3089919">,</span>&nbsp;<span class="ident" id="3089921">ra</span><span class="op" id="3089923">,</span>&nbsp;<span class="ident" id="3089925">deadline</span><span class="op" id="3089933">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089936">default</span><span class="op" id="3089943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3089947">return</span>&nbsp;<span class="ident" id="3089954">nil</span><span class="op" id="3089957">,</span>&nbsp;<span class="op" id="3089959">&amp;</span><span class="ident" id="3089960">OpError</span><span class="op" id="3089967">{</span><span class="ident" id="3089968">Op</span><span class="op" id="3089970">:</span>&nbsp;<span class="string" id="3089972">&#34;dial&#34;</span><span class="op" id="3089978">,</span>&nbsp;<span class="ident" id="3089980">Net</span><span class="op" id="3089983">:</span>&nbsp;<span class="ident" id="3089985">net</span><span class="op" id="3089988">,</span>&nbsp;<span class="ident" id="3089990">Addr</span><span class="op" id="3089994">:</span>&nbsp;<span class="ident" id="3089996">ra</span><span class="op" id="3089998">,</span>&nbsp;<span class="ident" id="3090000">Err</span><span class="op" id="3090003">:</span>&nbsp;<span class="op" id="3090005">&amp;</span><span class="ident" id="3090006">AddrError</span><span class="op" id="3090015">{</span><span class="ident" id="3090016">Err</span><span class="op" id="3090019">:</span>&nbsp;<span class="string" id="3090021">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3090046">,</span>&nbsp;<span class="ident" id="3090048">Addr</span><span class="op" id="3090052">:</span>&nbsp;<span class="ident" id="3090054">addr</span><span class="op" id="3090058">}</span><span class="op" id="3090059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090065">if</span>&nbsp;<span class="ident" id="3090068">err</span>&nbsp;<span class="op" id="3090072">!=</span>&nbsp;<span class="ident" id="3090075">nil</span>&nbsp;<span class="op" id="3090079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090083">return</span>&nbsp;<span class="ident" id="3090090">nil</span><span class="op" id="3090093">,</span>&nbsp;<span class="ident" id="3090095">err</span>&nbsp;<span class="comment" id="3090099">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090152">return</span>&nbsp;<span class="ident" id="3090159">c</span><span class="op" id="3090160">,</span>&nbsp;<span class="ident" id="3090162">nil</span><br>
<span class="lineno"></span><span class="op" id="3090166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3090169">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="3090225">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3090294">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3090329">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3090366">func</span>&nbsp;<span class="ident" id="3090371">Listen</span><span class="op" id="3090377">(</span><span class="ident" id="3090378">net</span><span class="op" id="3090381">,</span>&nbsp;<span class="ident" id="3090383">laddr</span>&nbsp;<span class="builtintype" id="3090389">string</span><span class="op" id="3090395">)</span>&nbsp;<span class="op" id="3090397">(</span><span class="ident" id="3090398">Listener</span><span class="op" id="3090406">,</span>&nbsp;<span class="builtintype" id="3090408">error</span><span class="op" id="3090413">)</span>&nbsp;<span class="op" id="3090415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090418">la</span><span class="op" id="3090420">,</span>&nbsp;<span class="ident" id="3090422">err</span>&nbsp;<span class="op" id="3090426">:=</span>&nbsp;<span class="ident" id="3090429">resolveAddr</span><span class="op" id="3090440">(</span><span class="string" id="3090441">&#34;listen&#34;</span><span class="op" id="3090449">,</span>&nbsp;<span class="ident" id="3090451">net</span><span class="op" id="3090454">,</span>&nbsp;<span class="ident" id="3090456">laddr</span><span class="op" id="3090461">,</span>&nbsp;<span class="ident" id="3090463">noDeadline</span><span class="op" id="3090473">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090476">if</span>&nbsp;<span class="ident" id="3090479">err</span>&nbsp;<span class="op" id="3090483">!=</span>&nbsp;<span class="ident" id="3090486">nil</span>&nbsp;<span class="op" id="3090490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090494">return</span>&nbsp;<span class="ident" id="3090501">nil</span><span class="op" id="3090504">,</span>&nbsp;<span class="op" id="3090506">&amp;</span><span class="ident" id="3090507">OpError</span><span class="op" id="3090514">{</span><span class="ident" id="3090515">Op</span><span class="op" id="3090517">:</span>&nbsp;<span class="string" id="3090519">&#34;listen&#34;</span><span class="op" id="3090527">,</span>&nbsp;<span class="ident" id="3090529">Net</span><span class="op" id="3090532">:</span>&nbsp;<span class="ident" id="3090534">net</span><span class="op" id="3090537">,</span>&nbsp;<span class="ident" id="3090539">Addr</span><span class="op" id="3090543">:</span>&nbsp;<span class="ident" id="3090545">nil</span><span class="op" id="3090548">,</span>&nbsp;<span class="ident" id="3090550">Err</span><span class="op" id="3090553">:</span>&nbsp;<span class="ident" id="3090555">err</span><span class="op" id="3090558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090564">var</span>&nbsp;<span class="ident" id="3090568">l</span>&nbsp;<span class="ident" id="3090570">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090580">switch</span>&nbsp;<span class="ident" id="3090587">la</span>&nbsp;<span class="op" id="3090590">:=</span>&nbsp;<span class="ident" id="3090593">la</span><span class="op" id="3090595">.</span><span class="ident" id="3090596">toAddr</span><span class="op" id="3090602">(</span><span class="op" id="3090603">)</span><span class="op" id="3090604">.</span><span class="op" id="3090605">(</span><span class="keyword" id="3090606">type</span><span class="op" id="3090610">)</span>&nbsp;<span class="op" id="3090612">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090615">case</span>&nbsp;<span class="op" id="3090620">*</span><span class="ident" id="3090621">TCPAddr</span><span class="op" id="3090628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090632">l</span><span class="op" id="3090633">,</span>&nbsp;<span class="ident" id="3090635">err</span>&nbsp;<span class="op" id="3090639">=</span>&nbsp;<span class="ident" id="3090641">ListenTCP</span><span class="op" id="3090650">(</span><span class="ident" id="3090651">net</span><span class="op" id="3090654">,</span>&nbsp;<span class="ident" id="3090656">la</span><span class="op" id="3090658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090661">case</span>&nbsp;<span class="op" id="3090666">*</span><span class="ident" id="3090667">UnixAddr</span><span class="op" id="3090675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3090679">l</span><span class="op" id="3090680">,</span>&nbsp;<span class="ident" id="3090682">err</span>&nbsp;<span class="op" id="3090686">=</span>&nbsp;<span class="ident" id="3090688">ListenUnix</span><span class="op" id="3090698">(</span><span class="ident" id="3090699">net</span><span class="op" id="3090702">,</span>&nbsp;<span class="ident" id="3090704">la</span><span class="op" id="3090706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090709">default</span><span class="op" id="3090716">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090720">return</span>&nbsp;<span class="ident" id="3090727">nil</span><span class="op" id="3090730">,</span>&nbsp;<span class="op" id="3090732">&amp;</span><span class="ident" id="3090733">OpError</span><span class="op" id="3090740">{</span><span class="ident" id="3090741">Op</span><span class="op" id="3090743">:</span>&nbsp;<span class="string" id="3090745">&#34;listen&#34;</span><span class="op" id="3090753">,</span>&nbsp;<span class="ident" id="3090755">Net</span><span class="op" id="3090758">:</span>&nbsp;<span class="ident" id="3090760">net</span><span class="op" id="3090763">,</span>&nbsp;<span class="ident" id="3090765">Addr</span><span class="op" id="3090769">:</span>&nbsp;<span class="ident" id="3090771">la</span><span class="op" id="3090773">,</span>&nbsp;<span class="ident" id="3090775">Err</span><span class="op" id="3090778">:</span>&nbsp;<span class="op" id="3090780">&amp;</span><span class="ident" id="3090781">AddrError</span><span class="op" id="3090790">{</span><span class="ident" id="3090791">Err</span><span class="op" id="3090794">:</span>&nbsp;<span class="string" id="3090796">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3090821">,</span>&nbsp;<span class="ident" id="3090823">Addr</span><span class="op" id="3090827">:</span>&nbsp;<span class="ident" id="3090829">laddr</span><span class="op" id="3090834">}</span><span class="op" id="3090835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090841">if</span>&nbsp;<span class="ident" id="3090844">err</span>&nbsp;<span class="op" id="3090848">!=</span>&nbsp;<span class="ident" id="3090851">nil</span>&nbsp;<span class="op" id="3090855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090859">return</span>&nbsp;<span class="ident" id="3090866">nil</span><span class="op" id="3090869">,</span>&nbsp;<span class="ident" id="3090871">err</span>&nbsp;<span class="comment" id="3090875">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3090925">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3090928">return</span>&nbsp;<span class="ident" id="3090935">l</span><span class="op" id="3090936">,</span>&nbsp;<span class="ident" id="3090938">nil</span><br>
<span class="lineno"></span><span class="op" id="3090942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3090945">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="3091007">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="3091076">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3091121">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="3091158">func</span>&nbsp;<span class="ident" id="3091163">ListenPacket</span><span class="op" id="3091175">(</span><span class="ident" id="3091176">net</span><span class="op" id="3091179">,</span>&nbsp;<span class="ident" id="3091181">laddr</span>&nbsp;<span class="builtintype" id="3091187">string</span><span class="op" id="3091193">)</span>&nbsp;<span class="op" id="3091195">(</span><span class="ident" id="3091196">PacketConn</span><span class="op" id="3091206">,</span>&nbsp;<span class="builtintype" id="3091208">error</span><span class="op" id="3091213">)</span>&nbsp;<span class="op" id="3091215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091218">la</span><span class="op" id="3091220">,</span>&nbsp;<span class="ident" id="3091222">err</span>&nbsp;<span class="op" id="3091226">:=</span>&nbsp;<span class="ident" id="3091229">resolveAddr</span><span class="op" id="3091240">(</span><span class="string" id="3091241">&#34;listen&#34;</span><span class="op" id="3091249">,</span>&nbsp;<span class="ident" id="3091251">net</span><span class="op" id="3091254">,</span>&nbsp;<span class="ident" id="3091256">laddr</span><span class="op" id="3091261">,</span>&nbsp;<span class="ident" id="3091263">noDeadline</span><span class="op" id="3091273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091276">if</span>&nbsp;<span class="ident" id="3091279">err</span>&nbsp;<span class="op" id="3091283">!=</span>&nbsp;<span class="ident" id="3091286">nil</span>&nbsp;<span class="op" id="3091290">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091294">return</span>&nbsp;<span class="ident" id="3091301">nil</span><span class="op" id="3091304">,</span>&nbsp;<span class="op" id="3091306">&amp;</span><span class="ident" id="3091307">OpError</span><span class="op" id="3091314">{</span><span class="ident" id="3091315">Op</span><span class="op" id="3091317">:</span>&nbsp;<span class="string" id="3091319">&#34;listen&#34;</span><span class="op" id="3091327">,</span>&nbsp;<span class="ident" id="3091329">Net</span><span class="op" id="3091332">:</span>&nbsp;<span class="ident" id="3091334">net</span><span class="op" id="3091337">,</span>&nbsp;<span class="ident" id="3091339">Addr</span><span class="op" id="3091343">:</span>&nbsp;<span class="ident" id="3091345">nil</span><span class="op" id="3091348">,</span>&nbsp;<span class="ident" id="3091350">Err</span><span class="op" id="3091353">:</span>&nbsp;<span class="ident" id="3091355">err</span><span class="op" id="3091358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091364">var</span>&nbsp;<span class="ident" id="3091368">l</span>&nbsp;<span class="ident" id="3091370">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091382">switch</span>&nbsp;<span class="ident" id="3091389">la</span>&nbsp;<span class="op" id="3091392">:=</span>&nbsp;<span class="ident" id="3091395">la</span><span class="op" id="3091397">.</span><span class="ident" id="3091398">toAddr</span><span class="op" id="3091404">(</span><span class="op" id="3091405">)</span><span class="op" id="3091406">.</span><span class="op" id="3091407">(</span><span class="keyword" id="3091408">type</span><span class="op" id="3091412">)</span>&nbsp;<span class="op" id="3091414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091417">case</span>&nbsp;<span class="op" id="3091422">*</span><span class="ident" id="3091423">UDPAddr</span><span class="op" id="3091430">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091434">l</span><span class="op" id="3091435">,</span>&nbsp;<span class="ident" id="3091437">err</span>&nbsp;<span class="op" id="3091441">=</span>&nbsp;<span class="ident" id="3091443">ListenUDP</span><span class="op" id="3091452">(</span><span class="ident" id="3091453">net</span><span class="op" id="3091456">,</span>&nbsp;<span class="ident" id="3091458">la</span><span class="op" id="3091460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091463">case</span>&nbsp;<span class="op" id="3091468">*</span><span class="ident" id="3091469">IPAddr</span><span class="op" id="3091475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091479">l</span><span class="op" id="3091480">,</span>&nbsp;<span class="ident" id="3091482">err</span>&nbsp;<span class="op" id="3091486">=</span>&nbsp;<span class="ident" id="3091488">ListenIP</span><span class="op" id="3091496">(</span><span class="ident" id="3091497">net</span><span class="op" id="3091500">,</span>&nbsp;<span class="ident" id="3091502">la</span><span class="op" id="3091504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091507">case</span>&nbsp;<span class="op" id="3091512">*</span><span class="ident" id="3091513">UnixAddr</span><span class="op" id="3091521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3091525">l</span><span class="op" id="3091526">,</span>&nbsp;<span class="ident" id="3091528">err</span>&nbsp;<span class="op" id="3091532">=</span>&nbsp;<span class="ident" id="3091534">ListenUnixgram</span><span class="op" id="3091548">(</span><span class="ident" id="3091549">net</span><span class="op" id="3091552">,</span>&nbsp;<span class="ident" id="3091554">la</span><span class="op" id="3091556">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091559">default</span><span class="op" id="3091566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091570">return</span>&nbsp;<span class="ident" id="3091577">nil</span><span class="op" id="3091580">,</span>&nbsp;<span class="op" id="3091582">&amp;</span><span class="ident" id="3091583">OpError</span><span class="op" id="3091590">{</span><span class="ident" id="3091591">Op</span><span class="op" id="3091593">:</span>&nbsp;<span class="string" id="3091595">&#34;listen&#34;</span><span class="op" id="3091603">,</span>&nbsp;<span class="ident" id="3091605">Net</span><span class="op" id="3091608">:</span>&nbsp;<span class="ident" id="3091610">net</span><span class="op" id="3091613">,</span>&nbsp;<span class="ident" id="3091615">Addr</span><span class="op" id="3091619">:</span>&nbsp;<span class="ident" id="3091621">la</span><span class="op" id="3091623">,</span>&nbsp;<span class="ident" id="3091625">Err</span><span class="op" id="3091628">:</span>&nbsp;<span class="op" id="3091630">&amp;</span><span class="ident" id="3091631">AddrError</span><span class="op" id="3091640">{</span><span class="ident" id="3091641">Err</span><span class="op" id="3091644">:</span>&nbsp;<span class="string" id="3091646">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="3091671">,</span>&nbsp;<span class="ident" id="3091673">Addr</span><span class="op" id="3091677">:</span>&nbsp;<span class="ident" id="3091679">laddr</span><span class="op" id="3091684">}</span><span class="op" id="3091685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091691">if</span>&nbsp;<span class="ident" id="3091694">err</span>&nbsp;<span class="op" id="3091698">!=</span>&nbsp;<span class="ident" id="3091701">nil</span>&nbsp;<span class="op" id="3091705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091709">return</span>&nbsp;<span class="ident" id="3091716">nil</span><span class="op" id="3091719">,</span>&nbsp;<span class="ident" id="3091721">err</span>&nbsp;<span class="comment" id="3091725">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3091775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3091778">return</span>&nbsp;<span class="ident" id="3091785">l</span><span class="op" id="3091786">,</span>&nbsp;<span class="ident" id="3091788">nil</span><br>
<span class="lineno"></span><span class="op" id="3091792">}</span>
</div>
</body>
</html>
