<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html" class="current">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6925170">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6925225">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6925279">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6925330">package</span>&nbsp;<span class="ident" id="6925338">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6925344">import</span>&nbsp;<span class="op" id="6925351">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925354">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925363">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925372">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925385">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6925396">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6925403">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6925406">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6925480">func</span>&nbsp;<span class="ident" id="6925485">TestEmpty</span><span class="op" id="6925494">(</span><span class="ident" id="6925495">t</span>&nbsp;<span class="op" id="6925497">*</span><span class="ident" id="6925498">testing</span><span class="op" id="6925505">.</span><span class="ident" id="6925506">T</span><span class="op" id="6925507">)</span>&nbsp;<span class="op" id="6925509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925512">buf</span>&nbsp;<span class="op" id="6925516">:=</span>&nbsp;<span class="builtinfunc" id="6925519">new</span><span class="op" id="6925522">(</span><span class="ident" id="6925523">bytes</span><span class="op" id="6925528">.</span><span class="ident" id="6925529">Buffer</span><span class="op" id="6925535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925539">if</span>&nbsp;<span class="ident" id="6925542">err</span>&nbsp;<span class="op" id="6925546">:=</span>&nbsp;<span class="ident" id="6925549">NewWriter</span><span class="op" id="6925558">(</span><span class="ident" id="6925559">buf</span><span class="op" id="6925562">)</span><span class="op" id="6925563">.</span><span class="ident" id="6925564">Close</span><span class="op" id="6925569">(</span><span class="op" id="6925570">)</span><span class="op" id="6925571">;</span>&nbsp;<span class="ident" id="6925573">err</span>&nbsp;<span class="op" id="6925577">!=</span>&nbsp;<span class="ident" id="6925580">nil</span>&nbsp;<span class="op" id="6925584">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925588">t</span><span class="op" id="6925589">.</span><span class="ident" id="6925590">Fatalf</span><span class="op" id="6925596">(</span><span class="string" id="6925597">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6925615">,</span>&nbsp;<span class="ident" id="6925617">err</span><span class="op" id="6925620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925627">r</span><span class="op" id="6925628">,</span>&nbsp;<span class="ident" id="6925630">err</span>&nbsp;<span class="op" id="6925634">:=</span>&nbsp;<span class="ident" id="6925637">NewReader</span><span class="op" id="6925646">(</span><span class="ident" id="6925647">buf</span><span class="op" id="6925650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925653">if</span>&nbsp;<span class="ident" id="6925656">err</span>&nbsp;<span class="op" id="6925660">!=</span>&nbsp;<span class="ident" id="6925663">nil</span>&nbsp;<span class="op" id="6925667">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925671">t</span><span class="op" id="6925672">.</span><span class="ident" id="6925673">Fatalf</span><span class="op" id="6925679">(</span><span class="string" id="6925680">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6925695">,</span>&nbsp;<span class="ident" id="6925697">err</span><span class="op" id="6925700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925706">b</span><span class="op" id="6925707">,</span>&nbsp;<span class="ident" id="6925709">err</span>&nbsp;<span class="op" id="6925713">:=</span>&nbsp;<span class="ident" id="6925716">ioutil</span><span class="op" id="6925722">.</span><span class="ident" id="6925723">ReadAll</span><span class="op" id="6925730">(</span><span class="ident" id="6925731">r</span><span class="op" id="6925732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925735">if</span>&nbsp;<span class="ident" id="6925738">err</span>&nbsp;<span class="op" id="6925742">!=</span>&nbsp;<span class="ident" id="6925745">nil</span>&nbsp;<span class="op" id="6925749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925753">t</span><span class="op" id="6925754">.</span><span class="ident" id="6925755">Fatalf</span><span class="op" id="6925761">(</span><span class="string" id="6925762">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6925775">,</span>&nbsp;<span class="ident" id="6925777">err</span><span class="op" id="6925780">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925786">if</span>&nbsp;<span class="builtinfunc" id="6925789">len</span><span class="op" id="6925792">(</span><span class="ident" id="6925793">b</span><span class="op" id="6925794">)</span>&nbsp;<span class="op" id="6925796">!=</span>&nbsp;<span class="num" id="6925799">0</span>&nbsp;<span class="op" id="6925801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925805">t</span><span class="op" id="6925806">.</span><span class="ident" id="6925807">Fatalf</span><span class="op" id="6925813">(</span><span class="string" id="6925814">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6925836">,</span>&nbsp;<span class="builtinfunc" id="6925838">len</span><span class="op" id="6925841">(</span><span class="ident" id="6925842">b</span><span class="op" id="6925843">)</span><span class="op" id="6925844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6925850">if</span>&nbsp;<span class="ident" id="6925853">err</span>&nbsp;<span class="op" id="6925857">:=</span>&nbsp;<span class="ident" id="6925860">r</span><span class="op" id="6925861">.</span><span class="ident" id="6925862">Close</span><span class="op" id="6925867">(</span><span class="op" id="6925868">)</span><span class="op" id="6925869">;</span>&nbsp;<span class="ident" id="6925871">err</span>&nbsp;<span class="op" id="6925875">!=</span>&nbsp;<span class="ident" id="6925878">nil</span>&nbsp;<span class="op" id="6925882">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6925886">t</span><span class="op" id="6925887">.</span><span class="ident" id="6925888">Fatalf</span><span class="op" id="6925894">(</span><span class="string" id="6925895">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6925913">,</span>&nbsp;<span class="ident" id="6925915">err</span><span class="op" id="6925918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6925921">}</span><br>
<span class="lineno"></span><span class="op" id="6925923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6925926">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="6925999">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6926012">func</span>&nbsp;<span class="ident" id="6926017">TestRoundTrip</span><span class="op" id="6926030">(</span><span class="ident" id="6926031">t</span>&nbsp;<span class="op" id="6926033">*</span><span class="ident" id="6926034">testing</span><span class="op" id="6926041">.</span><span class="ident" id="6926042">T</span><span class="op" id="6926043">)</span>&nbsp;<span class="op" id="6926045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926048">buf</span>&nbsp;<span class="op" id="6926052">:=</span>&nbsp;<span class="builtinfunc" id="6926055">new</span><span class="op" id="6926058">(</span><span class="ident" id="6926059">bytes</span><span class="op" id="6926064">.</span><span class="ident" id="6926065">Buffer</span><span class="op" id="6926071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926075">w</span>&nbsp;<span class="op" id="6926077">:=</span>&nbsp;<span class="ident" id="6926080">NewWriter</span><span class="op" id="6926089">(</span><span class="ident" id="6926090">buf</span><span class="op" id="6926093">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926096">w</span><span class="op" id="6926097">.</span><span class="ident" id="6926098">Comment</span>&nbsp;<span class="op" id="6926106">=</span>&nbsp;<span class="string" id="6926108">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926119">w</span><span class="op" id="6926120">.</span><span class="ident" id="6926121">Extra</span>&nbsp;<span class="op" id="6926127">=</span>&nbsp;<span class="op" id="6926129">[</span><span class="op" id="6926130">]</span><span class="builtintype" id="6926131">byte</span><span class="op" id="6926135">(</span><span class="string" id="6926136">&#34;extra&#34;</span><span class="op" id="6926143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926146">w</span><span class="op" id="6926147">.</span><span class="ident" id="6926148">ModTime</span>&nbsp;<span class="op" id="6926156">=</span>&nbsp;<span class="ident" id="6926158">time</span><span class="op" id="6926162">.</span><span class="ident" id="6926163">Unix</span><span class="op" id="6926167">(</span><span class="num" id="6926168">1e8</span><span class="op" id="6926171">,</span>&nbsp;<span class="num" id="6926173">0</span><span class="op" id="6926174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926177">w</span><span class="op" id="6926178">.</span><span class="ident" id="6926179">Name</span>&nbsp;<span class="op" id="6926184">=</span>&nbsp;<span class="string" id="6926186">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926194">if</span>&nbsp;<span class="ident" id="6926197">_</span><span class="op" id="6926198">,</span>&nbsp;<span class="ident" id="6926200">err</span>&nbsp;<span class="op" id="6926204">:=</span>&nbsp;<span class="ident" id="6926207">w</span><span class="op" id="6926208">.</span><span class="ident" id="6926209">Write</span><span class="op" id="6926214">(</span><span class="op" id="6926215">[</span><span class="op" id="6926216">]</span><span class="builtintype" id="6926217">byte</span><span class="op" id="6926221">(</span><span class="string" id="6926222">&#34;payload&#34;</span><span class="op" id="6926231">)</span><span class="op" id="6926232">)</span><span class="op" id="6926233">;</span>&nbsp;<span class="ident" id="6926235">err</span>&nbsp;<span class="op" id="6926239">!=</span>&nbsp;<span class="ident" id="6926242">nil</span>&nbsp;<span class="op" id="6926246">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926250">t</span><span class="op" id="6926251">.</span><span class="ident" id="6926252">Fatalf</span><span class="op" id="6926258">(</span><span class="string" id="6926259">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="6926270">,</span>&nbsp;<span class="ident" id="6926272">err</span><span class="op" id="6926275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926281">if</span>&nbsp;<span class="ident" id="6926284">err</span>&nbsp;<span class="op" id="6926288">:=</span>&nbsp;<span class="ident" id="6926291">w</span><span class="op" id="6926292">.</span><span class="ident" id="6926293">Close</span><span class="op" id="6926298">(</span><span class="op" id="6926299">)</span><span class="op" id="6926300">;</span>&nbsp;<span class="ident" id="6926302">err</span>&nbsp;<span class="op" id="6926306">!=</span>&nbsp;<span class="ident" id="6926309">nil</span>&nbsp;<span class="op" id="6926313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926317">t</span><span class="op" id="6926318">.</span><span class="ident" id="6926319">Fatalf</span><span class="op" id="6926325">(</span><span class="string" id="6926326">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6926344">,</span>&nbsp;<span class="ident" id="6926346">err</span><span class="op" id="6926349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926352">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926356">r</span><span class="op" id="6926357">,</span>&nbsp;<span class="ident" id="6926359">err</span>&nbsp;<span class="op" id="6926363">:=</span>&nbsp;<span class="ident" id="6926366">NewReader</span><span class="op" id="6926375">(</span><span class="ident" id="6926376">buf</span><span class="op" id="6926379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926382">if</span>&nbsp;<span class="ident" id="6926385">err</span>&nbsp;<span class="op" id="6926389">!=</span>&nbsp;<span class="ident" id="6926392">nil</span>&nbsp;<span class="op" id="6926396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926400">t</span><span class="op" id="6926401">.</span><span class="ident" id="6926402">Fatalf</span><span class="op" id="6926408">(</span><span class="string" id="6926409">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6926424">,</span>&nbsp;<span class="ident" id="6926426">err</span><span class="op" id="6926429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926432">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926435">b</span><span class="op" id="6926436">,</span>&nbsp;<span class="ident" id="6926438">err</span>&nbsp;<span class="op" id="6926442">:=</span>&nbsp;<span class="ident" id="6926445">ioutil</span><span class="op" id="6926451">.</span><span class="ident" id="6926452">ReadAll</span><span class="op" id="6926459">(</span><span class="ident" id="6926460">r</span><span class="op" id="6926461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926464">if</span>&nbsp;<span class="ident" id="6926467">err</span>&nbsp;<span class="op" id="6926471">!=</span>&nbsp;<span class="ident" id="6926474">nil</span>&nbsp;<span class="op" id="6926478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926482">t</span><span class="op" id="6926483">.</span><span class="ident" id="6926484">Fatalf</span><span class="op" id="6926490">(</span><span class="string" id="6926491">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6926504">,</span>&nbsp;<span class="ident" id="6926506">err</span><span class="op" id="6926509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926515">if</span>&nbsp;<span class="builtintype" id="6926518">string</span><span class="op" id="6926524">(</span><span class="ident" id="6926525">b</span><span class="op" id="6926526">)</span>&nbsp;<span class="op" id="6926528">!=</span>&nbsp;<span class="string" id="6926531">&#34;payload&#34;</span>&nbsp;<span class="op" id="6926541">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926545">t</span><span class="op" id="6926546">.</span><span class="ident" id="6926547">Fatalf</span><span class="op" id="6926553">(</span><span class="string" id="6926554">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6926578">,</span>&nbsp;<span class="builtintype" id="6926580">string</span><span class="op" id="6926586">(</span><span class="ident" id="6926587">b</span><span class="op" id="6926588">)</span><span class="op" id="6926589">,</span>&nbsp;<span class="string" id="6926591">&#34;payload&#34;</span><span class="op" id="6926600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926606">if</span>&nbsp;<span class="ident" id="6926609">r</span><span class="op" id="6926610">.</span><span class="ident" id="6926611">Comment</span>&nbsp;<span class="op" id="6926619">!=</span>&nbsp;<span class="string" id="6926622">&#34;comment&#34;</span>&nbsp;<span class="op" id="6926632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926636">t</span><span class="op" id="6926637">.</span><span class="ident" id="6926638">Fatalf</span><span class="op" id="6926644">(</span><span class="string" id="6926645">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6926669">,</span>&nbsp;<span class="ident" id="6926671">r</span><span class="op" id="6926672">.</span><span class="ident" id="6926673">Comment</span><span class="op" id="6926680">,</span>&nbsp;<span class="string" id="6926682">&#34;comment&#34;</span><span class="op" id="6926691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926694">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926697">if</span>&nbsp;<span class="builtintype" id="6926700">string</span><span class="op" id="6926706">(</span><span class="ident" id="6926707">r</span><span class="op" id="6926708">.</span><span class="ident" id="6926709">Extra</span><span class="op" id="6926714">)</span>&nbsp;<span class="op" id="6926716">!=</span>&nbsp;<span class="string" id="6926719">&#34;extra&#34;</span>&nbsp;<span class="op" id="6926727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926731">t</span><span class="op" id="6926732">.</span><span class="ident" id="6926733">Fatalf</span><span class="op" id="6926739">(</span><span class="string" id="6926740">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6926762">,</span>&nbsp;<span class="ident" id="6926764">r</span><span class="op" id="6926765">.</span><span class="ident" id="6926766">Extra</span><span class="op" id="6926771">,</span>&nbsp;<span class="string" id="6926773">&#34;extra&#34;</span><span class="op" id="6926780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926786">if</span>&nbsp;<span class="ident" id="6926789">r</span><span class="op" id="6926790">.</span><span class="ident" id="6926791">ModTime</span><span class="op" id="6926798">.</span><span class="ident" id="6926799">Unix</span><span class="op" id="6926803">(</span><span class="op" id="6926804">)</span>&nbsp;<span class="op" id="6926806">!=</span>&nbsp;<span class="num" id="6926809">1e8</span>&nbsp;<span class="op" id="6926813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926817">t</span><span class="op" id="6926818">.</span><span class="ident" id="6926819">Fatalf</span><span class="op" id="6926825">(</span><span class="string" id="6926826">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6926848">,</span>&nbsp;<span class="ident" id="6926850">r</span><span class="op" id="6926851">.</span><span class="ident" id="6926852">ModTime</span><span class="op" id="6926859">.</span><span class="ident" id="6926860">Unix</span><span class="op" id="6926864">(</span><span class="op" id="6926865">)</span><span class="op" id="6926866">,</span>&nbsp;<span class="builtintype" id="6926868">uint32</span><span class="op" id="6926874">(</span><span class="num" id="6926875">1e8</span><span class="op" id="6926878">)</span><span class="op" id="6926879">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926885">if</span>&nbsp;<span class="ident" id="6926888">r</span><span class="op" id="6926889">.</span><span class="ident" id="6926890">Name</span>&nbsp;<span class="op" id="6926895">!=</span>&nbsp;<span class="string" id="6926898">&#34;name&#34;</span>&nbsp;<span class="op" id="6926905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926909">t</span><span class="op" id="6926910">.</span><span class="ident" id="6926911">Fatalf</span><span class="op" id="6926917">(</span><span class="string" id="6926918">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6926939">,</span>&nbsp;<span class="ident" id="6926941">r</span><span class="op" id="6926942">.</span><span class="ident" id="6926943">Name</span><span class="op" id="6926947">,</span>&nbsp;<span class="string" id="6926949">&#34;name&#34;</span><span class="op" id="6926955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6926958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6926961">if</span>&nbsp;<span class="ident" id="6926964">err</span>&nbsp;<span class="op" id="6926968">:=</span>&nbsp;<span class="ident" id="6926971">r</span><span class="op" id="6926972">.</span><span class="ident" id="6926973">Close</span><span class="op" id="6926978">(</span><span class="op" id="6926979">)</span><span class="op" id="6926980">;</span>&nbsp;<span class="ident" id="6926982">err</span>&nbsp;<span class="op" id="6926986">!=</span>&nbsp;<span class="ident" id="6926989">nil</span>&nbsp;<span class="op" id="6926993">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6926997">t</span><span class="op" id="6926998">.</span><span class="ident" id="6926999">Fatalf</span><span class="op" id="6927005">(</span><span class="string" id="6927006">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6927024">,</span>&nbsp;<span class="ident" id="6927026">err</span><span class="op" id="6927029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927032">}</span><br>
<span class="lineno"></span><span class="op" id="6927034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6927037">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="6927116">func</span>&nbsp;<span class="ident" id="6927121">TestLatin1</span><span class="op" id="6927131">(</span><span class="ident" id="6927132">t</span>&nbsp;<span class="op" id="6927134">*</span><span class="ident" id="6927135">testing</span><span class="op" id="6927142">.</span><span class="ident" id="6927143">T</span><span class="op" id="6927144">)</span>&nbsp;<span class="op" id="6927146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927149">latin1</span>&nbsp;<span class="op" id="6927156">:=</span>&nbsp;<span class="op" id="6927159">[</span><span class="op" id="6927160">]</span><span class="builtintype" id="6927161">byte</span><span class="op" id="6927165">{</span><span class="num" id="6927166">0xc4</span><span class="op" id="6927170">,</span>&nbsp;<span class="string" id="6927172">&#39;u&#39;</span><span class="op" id="6927175">,</span>&nbsp;<span class="num" id="6927177">0xdf</span><span class="op" id="6927181">,</span>&nbsp;<span class="string" id="6927183">&#39;e&#39;</span><span class="op" id="6927186">,</span>&nbsp;<span class="string" id="6927188">&#39;r&#39;</span><span class="op" id="6927191">,</span>&nbsp;<span class="string" id="6927193">&#39;u&#39;</span><span class="op" id="6927196">,</span>&nbsp;<span class="string" id="6927198">&#39;n&#39;</span><span class="op" id="6927201">,</span>&nbsp;<span class="string" id="6927203">&#39;g&#39;</span><span class="op" id="6927206">,</span>&nbsp;<span class="num" id="6927208">0</span><span class="op" id="6927209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927212">utf8</span>&nbsp;<span class="op" id="6927217">:=</span>&nbsp;<span class="string" id="6927220">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927234">z</span>&nbsp;<span class="op" id="6927236">:=</span>&nbsp;<span class="ident" id="6927239">Reader</span><span class="op" id="6927245">{</span><span class="ident" id="6927246">r</span><span class="op" id="6927247">:</span>&nbsp;<span class="ident" id="6927249">bufio</span><span class="op" id="6927254">.</span><span class="ident" id="6927255">NewReader</span><span class="op" id="6927264">(</span><span class="ident" id="6927265">bytes</span><span class="op" id="6927270">.</span><span class="ident" id="6927271">NewReader</span><span class="op" id="6927280">(</span><span class="ident" id="6927281">latin1</span><span class="op" id="6927287">)</span><span class="op" id="6927288">)</span><span class="op" id="6927289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927292">s</span><span class="op" id="6927293">,</span>&nbsp;<span class="ident" id="6927295">err</span>&nbsp;<span class="op" id="6927299">:=</span>&nbsp;<span class="ident" id="6927302">z</span><span class="op" id="6927303">.</span><span class="ident" id="6927304">readString</span><span class="op" id="6927314">(</span><span class="op" id="6927315">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927318">if</span>&nbsp;<span class="ident" id="6927321">err</span>&nbsp;<span class="op" id="6927325">!=</span>&nbsp;<span class="ident" id="6927328">nil</span>&nbsp;<span class="op" id="6927332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927336">t</span><span class="op" id="6927337">.</span><span class="ident" id="6927338">Fatalf</span><span class="op" id="6927344">(</span><span class="string" id="6927345">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="6927361">,</span>&nbsp;<span class="ident" id="6927363">err</span><span class="op" id="6927366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927372">if</span>&nbsp;<span class="ident" id="6927375">s</span>&nbsp;<span class="op" id="6927377">!=</span>&nbsp;<span class="ident" id="6927380">utf8</span>&nbsp;<span class="op" id="6927385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927389">t</span><span class="op" id="6927390">.</span><span class="ident" id="6927391">Fatalf</span><span class="op" id="6927397">(</span><span class="string" id="6927398">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6927429">,</span>&nbsp;<span class="ident" id="6927431">s</span><span class="op" id="6927432">,</span>&nbsp;<span class="ident" id="6927434">utf8</span><span class="op" id="6927438">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927445">buf</span>&nbsp;<span class="op" id="6927449">:=</span>&nbsp;<span class="ident" id="6927452">bytes</span><span class="op" id="6927457">.</span><span class="ident" id="6927458">NewBuffer</span><span class="op" id="6927467">(</span><span class="builtinfunc" id="6927468">make</span><span class="op" id="6927472">(</span><span class="op" id="6927473">[</span><span class="op" id="6927474">]</span><span class="builtintype" id="6927475">byte</span><span class="op" id="6927479">,</span>&nbsp;<span class="num" id="6927481">0</span><span class="op" id="6927482">,</span>&nbsp;<span class="builtinfunc" id="6927484">len</span><span class="op" id="6927487">(</span><span class="ident" id="6927488">latin1</span><span class="op" id="6927494">)</span><span class="op" id="6927495">)</span><span class="op" id="6927496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927499">c</span>&nbsp;<span class="op" id="6927501">:=</span>&nbsp;<span class="ident" id="6927504">Writer</span><span class="op" id="6927510">{</span><span class="ident" id="6927511">w</span><span class="op" id="6927512">:</span>&nbsp;<span class="ident" id="6927514">buf</span><span class="op" id="6927517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927520">if</span>&nbsp;<span class="ident" id="6927523">err</span>&nbsp;<span class="op" id="6927527">=</span>&nbsp;<span class="ident" id="6927529">c</span><span class="op" id="6927530">.</span><span class="ident" id="6927531">writeString</span><span class="op" id="6927542">(</span><span class="ident" id="6927543">utf8</span><span class="op" id="6927547">)</span><span class="op" id="6927548">;</span>&nbsp;<span class="ident" id="6927550">err</span>&nbsp;<span class="op" id="6927554">!=</span>&nbsp;<span class="ident" id="6927557">nil</span>&nbsp;<span class="op" id="6927561">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927565">t</span><span class="op" id="6927566">.</span><span class="ident" id="6927567">Fatalf</span><span class="op" id="6927573">(</span><span class="string" id="6927574">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="6927591">,</span>&nbsp;<span class="ident" id="6927593">err</span><span class="op" id="6927596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927602">s</span>&nbsp;<span class="op" id="6927604">=</span>&nbsp;<span class="ident" id="6927606">buf</span><span class="op" id="6927609">.</span><span class="ident" id="6927610">String</span><span class="op" id="6927616">(</span><span class="op" id="6927617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6927620">if</span>&nbsp;<span class="ident" id="6927623">s</span>&nbsp;<span class="op" id="6927625">!=</span>&nbsp;<span class="builtintype" id="6927628">string</span><span class="op" id="6927634">(</span><span class="ident" id="6927635">latin1</span><span class="op" id="6927641">)</span>&nbsp;<span class="op" id="6927643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927647">t</span><span class="op" id="6927648">.</span><span class="ident" id="6927649">Fatalf</span><span class="op" id="6927655">(</span><span class="string" id="6927656">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6927686">,</span>&nbsp;<span class="ident" id="6927688">s</span><span class="op" id="6927689">,</span>&nbsp;<span class="builtintype" id="6927691">string</span><span class="op" id="6927697">(</span><span class="ident" id="6927698">latin1</span><span class="op" id="6927704">)</span><span class="op" id="6927705">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927708">}</span><br>
<span class="lineno"></span><span class="op" id="6927710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6927713">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="6927789">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="6927815">func</span>&nbsp;<span class="ident" id="6927820">TestLatin1RoundTrip</span><span class="op" id="6927839">(</span><span class="ident" id="6927840">t</span>&nbsp;<span class="op" id="6927842">*</span><span class="ident" id="6927843">testing</span><span class="op" id="6927850">.</span><span class="ident" id="6927851">T</span><span class="op" id="6927852">)</span>&nbsp;<span class="op" id="6927854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927857">testCases</span>&nbsp;<span class="op" id="6927867">:=</span>&nbsp;<span class="op" id="6927870">[</span><span class="op" id="6927871">]</span><span class="keyword" id="6927872">struct</span>&nbsp;<span class="op" id="6927879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927883">name</span>&nbsp;<span class="builtintype" id="6927888">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6927897">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6927902">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927908">}</span><span class="op" id="6927909">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927913">{</span><span class="string" id="6927914">&#34;&#34;</span><span class="op" id="6927916">,</span>&nbsp;<span class="builtintype" id="6927918">true</span><span class="op" id="6927922">}</span><span class="op" id="6927923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927927">{</span><span class="string" id="6927928">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="6927941">,</span>&nbsp;<span class="builtintype" id="6927943">true</span><span class="op" id="6927947">}</span><span class="op" id="6927948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927952">{</span><span class="string" id="6927953">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="6927983">,</span>&nbsp;<span class="builtintype" id="6927985">false</span><span class="op" id="6927990">}</span><span class="op" id="6927991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6927995">{</span><span class="string" id="6927996">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="6928025">,</span>&nbsp;<span class="builtintype" id="6928027">false</span><span class="op" id="6928032">}</span><span class="op" id="6928033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928037">{</span><span class="string" id="6928038">&#34;\x00\x00\x00&#34;</span><span class="op" id="6928052">,</span>&nbsp;<span class="builtintype" id="6928054">false</span><span class="op" id="6928059">}</span><span class="op" id="6928060">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928064">{</span><span class="string" id="6928065">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="6928096">,</span>&nbsp;<span class="builtintype" id="6928098">true</span><span class="op" id="6928102">}</span><span class="op" id="6928103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928107">{</span><span class="string" id="6928108">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="6928149">,</span>&nbsp;<span class="builtintype" id="6928151">false</span><span class="op" id="6928156">}</span><span class="op" id="6928157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928161">{</span><span class="string" id="6928162">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="6928186">,</span>&nbsp;<span class="builtintype" id="6928188">false</span><span class="op" id="6928193">}</span><span class="op" id="6928194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928198">{</span><span class="string" id="6928199">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="6928228">,</span>&nbsp;<span class="builtintype" id="6928230">false</span><span class="op" id="6928235">}</span><span class="op" id="6928236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928240">{</span><span class="string" id="6928241">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="6928273">,</span>&nbsp;<span class="builtintype" id="6928275">false</span><span class="op" id="6928280">}</span><span class="op" id="6928281">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928287">for</span>&nbsp;<span class="ident" id="6928291">_</span><span class="op" id="6928292">,</span>&nbsp;<span class="ident" id="6928294">tc</span>&nbsp;<span class="op" id="6928297">:=</span>&nbsp;<span class="keyword" id="6928300">range</span>&nbsp;<span class="ident" id="6928306">testCases</span>&nbsp;<span class="op" id="6928316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928320">buf</span>&nbsp;<span class="op" id="6928324">:=</span>&nbsp;<span class="builtinfunc" id="6928327">new</span><span class="op" id="6928330">(</span><span class="ident" id="6928331">bytes</span><span class="op" id="6928336">.</span><span class="ident" id="6928337">Buffer</span><span class="op" id="6928343">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928348">w</span>&nbsp;<span class="op" id="6928350">:=</span>&nbsp;<span class="ident" id="6928353">NewWriter</span><span class="op" id="6928362">(</span><span class="ident" id="6928363">buf</span><span class="op" id="6928366">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928370">w</span><span class="op" id="6928371">.</span><span class="ident" id="6928372">Name</span>&nbsp;<span class="op" id="6928377">=</span>&nbsp;<span class="ident" id="6928379">tc</span><span class="op" id="6928381">.</span><span class="ident" id="6928382">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928389">err</span>&nbsp;<span class="op" id="6928393">:=</span>&nbsp;<span class="ident" id="6928396">w</span><span class="op" id="6928397">.</span><span class="ident" id="6928398">Close</span><span class="op" id="6928403">(</span><span class="op" id="6928404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928408">if</span>&nbsp;<span class="op" id="6928411">(</span><span class="ident" id="6928412">err</span>&nbsp;<span class="op" id="6928416">==</span>&nbsp;<span class="ident" id="6928419">nil</span><span class="op" id="6928422">)</span>&nbsp;<span class="op" id="6928424">!=</span>&nbsp;<span class="ident" id="6928427">tc</span><span class="op" id="6928429">.</span><span class="ident" id="6928430">ok</span>&nbsp;<span class="op" id="6928433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928438">t</span><span class="op" id="6928439">.</span><span class="ident" id="6928440">Errorf</span><span class="op" id="6928446">(</span><span class="string" id="6928447">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6928482">,</span>&nbsp;<span class="ident" id="6928484">tc</span><span class="op" id="6928486">.</span><span class="ident" id="6928487">name</span><span class="op" id="6928491">,</span>&nbsp;<span class="ident" id="6928493">err</span><span class="op" id="6928496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928501">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928516">if</span>&nbsp;<span class="op" id="6928519">!</span><span class="ident" id="6928520">tc</span><span class="op" id="6928522">.</span><span class="ident" id="6928523">ok</span>&nbsp;<span class="op" id="6928526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928531">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928547">r</span><span class="op" id="6928548">,</span>&nbsp;<span class="ident" id="6928550">err</span>&nbsp;<span class="op" id="6928554">:=</span>&nbsp;<span class="ident" id="6928557">NewReader</span><span class="op" id="6928566">(</span><span class="ident" id="6928567">buf</span><span class="op" id="6928570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928574">if</span>&nbsp;<span class="ident" id="6928577">err</span>&nbsp;<span class="op" id="6928581">!=</span>&nbsp;<span class="ident" id="6928584">nil</span>&nbsp;<span class="op" id="6928588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928593">t</span><span class="op" id="6928594">.</span><span class="ident" id="6928595">Errorf</span><span class="op" id="6928601">(</span><span class="string" id="6928602">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6928617">,</span>&nbsp;<span class="ident" id="6928619">err</span><span class="op" id="6928622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928627">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928638">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928642">_</span><span class="op" id="6928643">,</span>&nbsp;<span class="ident" id="6928645">err</span>&nbsp;<span class="op" id="6928649">=</span>&nbsp;<span class="ident" id="6928651">ioutil</span><span class="op" id="6928657">.</span><span class="ident" id="6928658">ReadAll</span><span class="op" id="6928665">(</span><span class="ident" id="6928666">r</span><span class="op" id="6928667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928671">if</span>&nbsp;<span class="ident" id="6928674">err</span>&nbsp;<span class="op" id="6928678">!=</span>&nbsp;<span class="ident" id="6928681">nil</span>&nbsp;<span class="op" id="6928685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928690">t</span><span class="op" id="6928691">.</span><span class="ident" id="6928692">Errorf</span><span class="op" id="6928698">(</span><span class="string" id="6928699">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6928712">,</span>&nbsp;<span class="ident" id="6928714">err</span><span class="op" id="6928717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928722">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928733">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928737">if</span>&nbsp;<span class="ident" id="6928740">r</span><span class="op" id="6928741">.</span><span class="ident" id="6928742">Name</span>&nbsp;<span class="op" id="6928747">!=</span>&nbsp;<span class="ident" id="6928750">tc</span><span class="op" id="6928752">.</span><span class="ident" id="6928753">name</span>&nbsp;<span class="op" id="6928758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928763">t</span><span class="op" id="6928764">.</span><span class="ident" id="6928765">Errorf</span><span class="op" id="6928771">(</span><span class="string" id="6928772">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6928793">,</span>&nbsp;<span class="ident" id="6928795">r</span><span class="op" id="6928796">.</span><span class="ident" id="6928797">Name</span><span class="op" id="6928801">,</span>&nbsp;<span class="ident" id="6928803">tc</span><span class="op" id="6928805">.</span><span class="ident" id="6928806">name</span><span class="op" id="6928810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928815">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928830">if</span>&nbsp;<span class="ident" id="6928833">err</span>&nbsp;<span class="op" id="6928837">:=</span>&nbsp;<span class="ident" id="6928840">r</span><span class="op" id="6928841">.</span><span class="ident" id="6928842">Close</span><span class="op" id="6928847">(</span><span class="op" id="6928848">)</span><span class="op" id="6928849">;</span>&nbsp;<span class="ident" id="6928851">err</span>&nbsp;<span class="op" id="6928855">!=</span>&nbsp;<span class="ident" id="6928858">nil</span>&nbsp;<span class="op" id="6928862">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928867">t</span><span class="op" id="6928868">.</span><span class="ident" id="6928869">Errorf</span><span class="op" id="6928875">(</span><span class="string" id="6928876">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6928894">,</span>&nbsp;<span class="ident" id="6928896">err</span><span class="op" id="6928899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6928904">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6928918">}</span><br>
<span class="lineno"></span><span class="op" id="6928920">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6928923">func</span>&nbsp;<span class="ident" id="6928928">TestWriterFlush</span><span class="op" id="6928943">(</span><span class="ident" id="6928944">t</span>&nbsp;<span class="op" id="6928946">*</span><span class="ident" id="6928947">testing</span><span class="op" id="6928954">.</span><span class="ident" id="6928955">T</span><span class="op" id="6928956">)</span>&nbsp;<span class="op" id="6928958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928961">buf</span>&nbsp;<span class="op" id="6928965">:=</span>&nbsp;<span class="builtinfunc" id="6928968">new</span><span class="op" id="6928971">(</span><span class="ident" id="6928972">bytes</span><span class="op" id="6928977">.</span><span class="ident" id="6928978">Buffer</span><span class="op" id="6928984">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6928988">w</span>&nbsp;<span class="op" id="6928990">:=</span>&nbsp;<span class="ident" id="6928993">NewWriter</span><span class="op" id="6929002">(</span><span class="ident" id="6929003">buf</span><span class="op" id="6929006">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929009">w</span><span class="op" id="6929010">.</span><span class="ident" id="6929011">Comment</span>&nbsp;<span class="op" id="6929019">=</span>&nbsp;<span class="string" id="6929021">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929032">w</span><span class="op" id="6929033">.</span><span class="ident" id="6929034">Extra</span>&nbsp;<span class="op" id="6929040">=</span>&nbsp;<span class="op" id="6929042">[</span><span class="op" id="6929043">]</span><span class="builtintype" id="6929044">byte</span><span class="op" id="6929048">(</span><span class="string" id="6929049">&#34;extra&#34;</span><span class="op" id="6929056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929059">w</span><span class="op" id="6929060">.</span><span class="ident" id="6929061">ModTime</span>&nbsp;<span class="op" id="6929069">=</span>&nbsp;<span class="ident" id="6929071">time</span><span class="op" id="6929075">.</span><span class="ident" id="6929076">Unix</span><span class="op" id="6929080">(</span><span class="num" id="6929081">1e8</span><span class="op" id="6929084">,</span>&nbsp;<span class="num" id="6929086">0</span><span class="op" id="6929087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929090">w</span><span class="op" id="6929091">.</span><span class="ident" id="6929092">Name</span>&nbsp;<span class="op" id="6929097">=</span>&nbsp;<span class="string" id="6929099">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929108">n0</span>&nbsp;<span class="op" id="6929111">:=</span>&nbsp;<span class="ident" id="6929114">buf</span><span class="op" id="6929117">.</span><span class="ident" id="6929118">Len</span><span class="op" id="6929121">(</span><span class="op" id="6929122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929125">if</span>&nbsp;<span class="ident" id="6929128">n0</span>&nbsp;<span class="op" id="6929131">!=</span>&nbsp;<span class="num" id="6929134">0</span>&nbsp;<span class="op" id="6929136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929140">t</span><span class="op" id="6929141">.</span><span class="ident" id="6929142">Fatalf</span><span class="op" id="6929148">(</span><span class="string" id="6929149">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6929189">,</span>&nbsp;<span class="ident" id="6929191">n0</span><span class="op" id="6929193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929200">if</span>&nbsp;<span class="ident" id="6929203">err</span>&nbsp;<span class="op" id="6929207">:=</span>&nbsp;<span class="ident" id="6929210">w</span><span class="op" id="6929211">.</span><span class="ident" id="6929212">Flush</span><span class="op" id="6929217">(</span><span class="op" id="6929218">)</span><span class="op" id="6929219">;</span>&nbsp;<span class="ident" id="6929221">err</span>&nbsp;<span class="op" id="6929225">!=</span>&nbsp;<span class="ident" id="6929228">nil</span>&nbsp;<span class="op" id="6929232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929236">t</span><span class="op" id="6929237">.</span><span class="ident" id="6929238">Fatal</span><span class="op" id="6929243">(</span><span class="ident" id="6929244">err</span><span class="op" id="6929247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929254">n1</span>&nbsp;<span class="op" id="6929257">:=</span>&nbsp;<span class="ident" id="6929260">buf</span><span class="op" id="6929263">.</span><span class="ident" id="6929264">Len</span><span class="op" id="6929267">(</span><span class="op" id="6929268">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929271">if</span>&nbsp;<span class="ident" id="6929274">n1</span>&nbsp;<span class="op" id="6929277">==</span>&nbsp;<span class="num" id="6929280">0</span>&nbsp;<span class="op" id="6929282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929286">t</span><span class="op" id="6929287">.</span><span class="ident" id="6929288">Fatal</span><span class="op" id="6929293">(</span><span class="string" id="6929294">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="6929321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929328">w</span><span class="op" id="6929329">.</span><span class="ident" id="6929330">Write</span><span class="op" id="6929335">(</span><span class="op" id="6929336">[</span><span class="op" id="6929337">]</span><span class="builtintype" id="6929338">byte</span><span class="op" id="6929342">(</span><span class="string" id="6929343">&#34;x&#34;</span><span class="op" id="6929346">)</span><span class="op" id="6929347">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929351">n2</span>&nbsp;<span class="op" id="6929354">:=</span>&nbsp;<span class="ident" id="6929357">buf</span><span class="op" id="6929360">.</span><span class="ident" id="6929361">Len</span><span class="op" id="6929364">(</span><span class="op" id="6929365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929368">if</span>&nbsp;<span class="ident" id="6929371">n1</span>&nbsp;<span class="op" id="6929374">!=</span>&nbsp;<span class="ident" id="6929377">n2</span>&nbsp;<span class="op" id="6929380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929384">t</span><span class="op" id="6929385">.</span><span class="ident" id="6929386">Fatalf</span><span class="op" id="6929392">(</span><span class="string" id="6929393">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="6929466">,</span>&nbsp;<span class="ident" id="6929468">n1</span><span class="op" id="6929470">,</span>&nbsp;<span class="ident" id="6929472">n2</span><span class="op" id="6929474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929477">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929481">if</span>&nbsp;<span class="ident" id="6929484">err</span>&nbsp;<span class="op" id="6929488">:=</span>&nbsp;<span class="ident" id="6929491">w</span><span class="op" id="6929492">.</span><span class="ident" id="6929493">Flush</span><span class="op" id="6929498">(</span><span class="op" id="6929499">)</span><span class="op" id="6929500">;</span>&nbsp;<span class="ident" id="6929502">err</span>&nbsp;<span class="op" id="6929506">!=</span>&nbsp;<span class="ident" id="6929509">nil</span>&nbsp;<span class="op" id="6929513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929517">t</span><span class="op" id="6929518">.</span><span class="ident" id="6929519">Fatal</span><span class="op" id="6929524">(</span><span class="ident" id="6929525">err</span><span class="op" id="6929528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929535">n3</span>&nbsp;<span class="op" id="6929538">:=</span>&nbsp;<span class="ident" id="6929541">buf</span><span class="op" id="6929544">.</span><span class="ident" id="6929545">Len</span><span class="op" id="6929548">(</span><span class="op" id="6929549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929552">if</span>&nbsp;<span class="ident" id="6929555">n2</span>&nbsp;<span class="op" id="6929558">==</span>&nbsp;<span class="ident" id="6929561">n3</span>&nbsp;<span class="op" id="6929564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929568">t</span><span class="op" id="6929569">.</span><span class="ident" id="6929570">Fatal</span><span class="op" id="6929575">(</span><span class="string" id="6929576">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="6929605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6929608">}</span><br>
<span class="lineno"></span><span class="op" id="6929610">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6929613">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6929673">func</span>&nbsp;<span class="ident" id="6929678">TestConcat</span><span class="op" id="6929688">(</span><span class="ident" id="6929689">t</span>&nbsp;<span class="op" id="6929691">*</span><span class="ident" id="6929692">testing</span><span class="op" id="6929699">.</span><span class="ident" id="6929700">T</span><span class="op" id="6929701">)</span>&nbsp;<span class="op" id="6929703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929706">var</span>&nbsp;<span class="ident" id="6929710">buf</span>&nbsp;<span class="ident" id="6929714">bytes</span><span class="op" id="6929719">.</span><span class="ident" id="6929720">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929728">w</span>&nbsp;<span class="op" id="6929730">:=</span>&nbsp;<span class="ident" id="6929733">NewWriter</span><span class="op" id="6929742">(</span><span class="op" id="6929743">&amp;</span><span class="ident" id="6929744">buf</span><span class="op" id="6929747">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929750">w</span><span class="op" id="6929751">.</span><span class="ident" id="6929752">Write</span><span class="op" id="6929757">(</span><span class="op" id="6929758">[</span><span class="op" id="6929759">]</span><span class="builtintype" id="6929760">byte</span><span class="op" id="6929764">(</span><span class="string" id="6929765">&#34;hello&nbsp;&#34;</span><span class="op" id="6929773">)</span><span class="op" id="6929774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929777">w</span><span class="op" id="6929778">.</span><span class="ident" id="6929779">Close</span><span class="op" id="6929784">(</span><span class="op" id="6929785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929788">w</span>&nbsp;<span class="op" id="6929790">=</span>&nbsp;<span class="ident" id="6929792">NewWriter</span><span class="op" id="6929801">(</span><span class="op" id="6929802">&amp;</span><span class="ident" id="6929803">buf</span><span class="op" id="6929806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929809">w</span><span class="op" id="6929810">.</span><span class="ident" id="6929811">Write</span><span class="op" id="6929816">(</span><span class="op" id="6929817">[</span><span class="op" id="6929818">]</span><span class="builtintype" id="6929819">byte</span><span class="op" id="6929823">(</span><span class="string" id="6929824">&#34;world\n&#34;</span><span class="op" id="6929833">)</span><span class="op" id="6929834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929837">w</span><span class="op" id="6929838">.</span><span class="ident" id="6929839">Close</span><span class="op" id="6929844">(</span><span class="op" id="6929845">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929849">r</span><span class="op" id="6929850">,</span>&nbsp;<span class="ident" id="6929852">err</span>&nbsp;<span class="op" id="6929856">:=</span>&nbsp;<span class="ident" id="6929859">NewReader</span><span class="op" id="6929868">(</span><span class="op" id="6929869">&amp;</span><span class="ident" id="6929870">buf</span><span class="op" id="6929873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929876">data</span><span class="op" id="6929880">,</span>&nbsp;<span class="ident" id="6929882">err</span>&nbsp;<span class="op" id="6929886">:=</span>&nbsp;<span class="ident" id="6929889">ioutil</span><span class="op" id="6929895">.</span><span class="ident" id="6929896">ReadAll</span><span class="op" id="6929903">(</span><span class="ident" id="6929904">r</span><span class="op" id="6929905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6929908">if</span>&nbsp;<span class="builtintype" id="6929911">string</span><span class="op" id="6929917">(</span><span class="ident" id="6929918">data</span><span class="op" id="6929922">)</span>&nbsp;<span class="op" id="6929924">!=</span>&nbsp;<span class="string" id="6929927">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="6929943">||</span>&nbsp;<span class="ident" id="6929946">err</span>&nbsp;<span class="op" id="6929950">!=</span>&nbsp;<span class="ident" id="6929953">nil</span>&nbsp;<span class="op" id="6929957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6929961">t</span><span class="op" id="6929962">.</span><span class="ident" id="6929963">Fatalf</span><span class="op" id="6929969">(</span><span class="string" id="6929970">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="6930002">,</span>&nbsp;<span class="ident" id="6930004">data</span><span class="op" id="6930008">,</span>&nbsp;<span class="ident" id="6930010">err</span><span class="op" id="6930013">,</span>&nbsp;<span class="string" id="6930015">&#34;hello&nbsp;world&#34;</span><span class="op" id="6930028">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930031">}</span><br>
<span class="lineno"></span><span class="op" id="6930033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930036">func</span>&nbsp;<span class="ident" id="6930041">TestWriterReset</span><span class="op" id="6930056">(</span><span class="ident" id="6930057">t</span>&nbsp;<span class="op" id="6930059">*</span><span class="ident" id="6930060">testing</span><span class="op" id="6930067">.</span><span class="ident" id="6930068">T</span><span class="op" id="6930069">)</span>&nbsp;<span class="op" id="6930071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930074">buf</span>&nbsp;<span class="op" id="6930078">:=</span>&nbsp;<span class="builtinfunc" id="6930081">new</span><span class="op" id="6930084">(</span><span class="ident" id="6930085">bytes</span><span class="op" id="6930090">.</span><span class="ident" id="6930091">Buffer</span><span class="op" id="6930097">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930100">buf2</span>&nbsp;<span class="op" id="6930105">:=</span>&nbsp;<span class="builtinfunc" id="6930108">new</span><span class="op" id="6930111">(</span><span class="ident" id="6930112">bytes</span><span class="op" id="6930117">.</span><span class="ident" id="6930118">Buffer</span><span class="op" id="6930124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930127">z</span>&nbsp;<span class="op" id="6930129">:=</span>&nbsp;<span class="ident" id="6930132">NewWriter</span><span class="op" id="6930141">(</span><span class="ident" id="6930142">buf</span><span class="op" id="6930145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930148">msg</span>&nbsp;<span class="op" id="6930152">:=</span>&nbsp;<span class="op" id="6930155">[</span><span class="op" id="6930156">]</span><span class="builtintype" id="6930157">byte</span><span class="op" id="6930161">(</span><span class="string" id="6930162">&#34;hello&nbsp;world&#34;</span><span class="op" id="6930175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930178">z</span><span class="op" id="6930179">.</span><span class="ident" id="6930180">Write</span><span class="op" id="6930185">(</span><span class="ident" id="6930186">msg</span><span class="op" id="6930189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930192">z</span><span class="op" id="6930193">.</span><span class="ident" id="6930194">Close</span><span class="op" id="6930199">(</span><span class="op" id="6930200">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930203">z</span><span class="op" id="6930204">.</span><span class="ident" id="6930205">Reset</span><span class="op" id="6930210">(</span><span class="ident" id="6930211">buf2</span><span class="op" id="6930215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930218">z</span><span class="op" id="6930219">.</span><span class="ident" id="6930220">Write</span><span class="op" id="6930225">(</span><span class="ident" id="6930226">msg</span><span class="op" id="6930229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930232">z</span><span class="op" id="6930233">.</span><span class="ident" id="6930234">Close</span><span class="op" id="6930239">(</span><span class="op" id="6930240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6930243">if</span>&nbsp;<span class="ident" id="6930246">buf</span><span class="op" id="6930249">.</span><span class="ident" id="6930250">String</span><span class="op" id="6930256">(</span><span class="op" id="6930257">)</span>&nbsp;<span class="op" id="6930259">!=</span>&nbsp;<span class="ident" id="6930262">buf2</span><span class="op" id="6930266">.</span><span class="ident" id="6930267">String</span><span class="op" id="6930273">(</span><span class="op" id="6930274">)</span>&nbsp;<span class="op" id="6930276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930280">t</span><span class="op" id="6930281">.</span><span class="ident" id="6930282">Errorf</span><span class="op" id="6930288">(</span><span class="string" id="6930289">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6930320">,</span>&nbsp;<span class="ident" id="6930322">buf2</span><span class="op" id="6930326">.</span><span class="ident" id="6930327">String</span><span class="op" id="6930333">(</span><span class="op" id="6930334">)</span><span class="op" id="6930335">,</span>&nbsp;<span class="ident" id="6930337">buf</span><span class="op" id="6930340">.</span><span class="ident" id="6930341">String</span><span class="op" id="6930347">(</span><span class="op" id="6930348">)</span><span class="op" id="6930349">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930352">}</span><br>
<span class="lineno"></span><span class="op" id="6930354">}</span>
</div>
</body>
</html>
