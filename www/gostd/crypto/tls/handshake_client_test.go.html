<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6561300">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6561355">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6561409">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6561460">package</span>&nbsp;<span class="ident" id="6561468">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6561473">import</span>&nbsp;<span class="op" id="6561480">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561483">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561492">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561508">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561522">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561537">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561553">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561560">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561566">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561573">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561579">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561590">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561607">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561618">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6561629">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6561636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6561639">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="6561714">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6561730">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6561807">type</span>&nbsp;<span class="ident" id="6561812">blockingSource</span>&nbsp;<span class="keyword" id="6561827">chan</span>&nbsp;<span class="builtintype" id="6561832">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6561838">func</span>&nbsp;<span class="op" id="6561843">(</span><span class="ident" id="6561844">b</span>&nbsp;<span class="ident" id="6561846">blockingSource</span><span class="op" id="6561860">)</span>&nbsp;<span class="ident" id="6561862">Read</span><span class="op" id="6561866">(</span><span class="op" id="6561867">[</span><span class="op" id="6561868">]</span><span class="builtintype" id="6561869">byte</span><span class="op" id="6561873">)</span>&nbsp;<span class="op" id="6561875">(</span><span class="ident" id="6561876">n</span>&nbsp;<span class="builtintype" id="6561878">int</span><span class="op" id="6561881">,</span>&nbsp;<span class="ident" id="6561883">err</span>&nbsp;<span class="builtintype" id="6561887">error</span><span class="op" id="6561892">)</span>&nbsp;<span class="op" id="6561894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6561897">&lt;-</span><span class="ident" id="6561899">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6561902">return</span>&nbsp;<span class="num" id="6561909">0</span><span class="op" id="6561910">,</span>&nbsp;<span class="ident" id="6561912">io</span><span class="op" id="6561914">.</span><span class="ident" id="6561915">EOF</span><br>
<span class="lineno"></span><span class="op" id="6561919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6561922">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="6562002">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="6562021">type</span>&nbsp;<span class="ident" id="6562026">clientTest</span>&nbsp;<span class="keyword" id="6562037">struct</span>&nbsp;<span class="op" id="6562044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562047">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562120">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562161">name</span>&nbsp;<span class="builtintype" id="6562166">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562174">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562240">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562285">command</span>&nbsp;<span class="op" id="6562293">[</span><span class="op" id="6562294">]</span><span class="builtintype" id="6562295">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562303">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562374">config</span>&nbsp;<span class="op" id="6562381">*</span><span class="ident" id="6562382">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562390">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562457">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562479">cert</span>&nbsp;<span class="op" id="6562484">[</span><span class="op" id="6562485">]</span><span class="builtintype" id="6562486">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562492">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562550">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562623">key</span>&nbsp;<span class="keyword" id="6562627">interface</span><span class="op" id="6562636">{</span><span class="op" id="6562637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562640">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562709">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6562779">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6562829">validate</span>&nbsp;<span class="keyword" id="6562838">func</span><span class="op" id="6562842">(</span><span class="ident" id="6562843">ConnectionState</span><span class="op" id="6562858">)</span>&nbsp;<span class="builtintype" id="6562860">error</span><br>
<span class="lineno"></span><span class="op" id="6562866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6562869">var</span>&nbsp;<span class="ident" id="6562873">defaultServerCommand</span>&nbsp;<span class="op" id="6562894">=</span>&nbsp;<span class="op" id="6562896">[</span><span class="op" id="6562897">]</span><span class="builtintype" id="6562898">string</span><span class="op" id="6562904">{</span><span class="string" id="6562905">&#34;openssl&#34;</span><span class="op" id="6562914">,</span>&nbsp;<span class="string" id="6562916">&#34;s_server&#34;</span><span class="op" id="6562926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6562929">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6563004">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6563079">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6563158">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="6563180">func</span>&nbsp;<span class="op" id="6563185">(</span><span class="ident" id="6563186">test</span>&nbsp;<span class="op" id="6563191">*</span><span class="ident" id="6563192">clientTest</span><span class="op" id="6563202">)</span>&nbsp;<span class="ident" id="6563204">connFromCommand</span><span class="op" id="6563219">(</span><span class="op" id="6563220">)</span>&nbsp;<span class="op" id="6563222">(</span><span class="ident" id="6563223">conn</span>&nbsp;<span class="op" id="6563228">*</span><span class="ident" id="6563229">recordingConn</span><span class="op" id="6563242">,</span>&nbsp;<span class="ident" id="6563244">child</span>&nbsp;<span class="op" id="6563250">*</span><span class="ident" id="6563251">exec</span><span class="op" id="6563255">.</span><span class="ident" id="6563256">Cmd</span><span class="op" id="6563259">,</span>&nbsp;<span class="ident" id="6563261">stdin</span>&nbsp;<span class="ident" id="6563267">blockingSource</span><span class="op" id="6563281">,</span>&nbsp;<span class="ident" id="6563283">err</span>&nbsp;<span class="builtintype" id="6563287">error</span><span class="op" id="6563292">)</span>&nbsp;<span class="op" id="6563294">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563297">cert</span>&nbsp;<span class="op" id="6563302">:=</span>&nbsp;<span class="ident" id="6563305">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563325">if</span>&nbsp;<span class="builtinfunc" id="6563328">len</span><span class="op" id="6563331">(</span><span class="ident" id="6563332">test</span><span class="op" id="6563336">.</span><span class="ident" id="6563337">cert</span><span class="op" id="6563341">)</span>&nbsp;<span class="op" id="6563343">&gt;</span>&nbsp;<span class="num" id="6563345">0</span>&nbsp;<span class="op" id="6563347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563351">cert</span>&nbsp;<span class="op" id="6563356">=</span>&nbsp;<span class="ident" id="6563358">test</span><span class="op" id="6563362">.</span><span class="ident" id="6563363">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563372">certPath</span>&nbsp;<span class="op" id="6563381">:=</span>&nbsp;<span class="ident" id="6563384">tempFile</span><span class="op" id="6563392">(</span><span class="builtintype" id="6563393">string</span><span class="op" id="6563399">(</span><span class="ident" id="6563400">cert</span><span class="op" id="6563404">)</span><span class="op" id="6563405">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563408">defer</span>&nbsp;<span class="ident" id="6563414">os</span><span class="op" id="6563416">.</span><span class="ident" id="6563417">Remove</span><span class="op" id="6563423">(</span><span class="ident" id="6563424">certPath</span><span class="op" id="6563432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563436">var</span>&nbsp;<span class="ident" id="6563440">key</span>&nbsp;<span class="keyword" id="6563444">interface</span><span class="op" id="6563453">{</span><span class="op" id="6563454">}</span>&nbsp;<span class="op" id="6563456">=</span>&nbsp;<span class="ident" id="6563458">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563477">if</span>&nbsp;<span class="ident" id="6563480">test</span><span class="op" id="6563484">.</span><span class="ident" id="6563485">key</span>&nbsp;<span class="op" id="6563489">!=</span>&nbsp;<span class="builtintype" id="6563492">nil</span>&nbsp;<span class="op" id="6563496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563500">key</span>&nbsp;<span class="op" id="6563504">=</span>&nbsp;<span class="ident" id="6563506">test</span><span class="op" id="6563510">.</span><span class="ident" id="6563511">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563519">var</span>&nbsp;<span class="ident" id="6563523">pemType</span>&nbsp;<span class="builtintype" id="6563531">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563539">var</span>&nbsp;<span class="ident" id="6563543">derBytes</span>&nbsp;<span class="op" id="6563552">[</span><span class="op" id="6563553">]</span><span class="builtintype" id="6563554">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563560">switch</span>&nbsp;<span class="ident" id="6563567">key</span>&nbsp;<span class="op" id="6563571">:=</span>&nbsp;<span class="ident" id="6563574">key</span><span class="op" id="6563577">.</span><span class="op" id="6563578">(</span><span class="keyword" id="6563579">type</span><span class="op" id="6563583">)</span>&nbsp;<span class="op" id="6563585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563588">case</span>&nbsp;<span class="op" id="6563593">*</span><span class="ident" id="6563594">rsa</span><span class="op" id="6563597">.</span><span class="ident" id="6563598">PrivateKey</span><span class="op" id="6563608">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563612">pemType</span>&nbsp;<span class="op" id="6563620">=</span>&nbsp;<span class="string" id="6563622">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563630">derBytes</span>&nbsp;<span class="op" id="6563639">=</span>&nbsp;<span class="ident" id="6563641">x509</span><span class="op" id="6563645">.</span><span class="ident" id="6563646">MarshalPKCS1PrivateKey</span><span class="op" id="6563668">(</span><span class="ident" id="6563669">key</span><span class="op" id="6563672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563675">case</span>&nbsp;<span class="op" id="6563680">*</span><span class="ident" id="6563681">ecdsa</span><span class="op" id="6563686">.</span><span class="ident" id="6563687">PrivateKey</span><span class="op" id="6563697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563701">pemType</span>&nbsp;<span class="op" id="6563709">=</span>&nbsp;<span class="string" id="6563711">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563718">var</span>&nbsp;<span class="ident" id="6563722">err</span>&nbsp;<span class="builtintype" id="6563726">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563734">derBytes</span><span class="op" id="6563742">,</span>&nbsp;<span class="ident" id="6563744">err</span>&nbsp;<span class="op" id="6563748">=</span>&nbsp;<span class="ident" id="6563750">x509</span><span class="op" id="6563754">.</span><span class="ident" id="6563755">MarshalECPrivateKey</span><span class="op" id="6563774">(</span><span class="ident" id="6563775">key</span><span class="op" id="6563778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563782">if</span>&nbsp;<span class="ident" id="6563785">err</span>&nbsp;<span class="op" id="6563789">!=</span>&nbsp;<span class="builtintype" id="6563792">nil</span>&nbsp;<span class="op" id="6563796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6563801">panic</span><span class="op" id="6563806">(</span><span class="ident" id="6563807">err</span><span class="op" id="6563810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563817">default</span><span class="op" id="6563824">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6563828">panic</span><span class="op" id="6563833">(</span><span class="string" id="6563834">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="6563852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6563855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6563859">var</span>&nbsp;<span class="ident" id="6563863">pemOut</span>&nbsp;<span class="ident" id="6563870">bytes</span><span class="op" id="6563875">.</span><span class="ident" id="6563876">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563884">pem</span><span class="op" id="6563887">.</span><span class="ident" id="6563888">Encode</span><span class="op" id="6563894">(</span><span class="op" id="6563895">&amp;</span><span class="ident" id="6563896">pemOut</span><span class="op" id="6563902">,</span>&nbsp;<span class="op" id="6563904">&amp;</span><span class="ident" id="6563905">pem</span><span class="op" id="6563908">.</span><span class="ident" id="6563909">Block</span><span class="op" id="6563914">{</span><span class="ident" id="6563915">Type</span><span class="op" id="6563919">:</span>&nbsp;<span class="ident" id="6563921">pemType</span>&nbsp;<span class="op" id="6563929">+</span>&nbsp;<span class="string" id="6563931">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="6563945">,</span>&nbsp;<span class="ident" id="6563947">Bytes</span><span class="op" id="6563952">:</span>&nbsp;<span class="ident" id="6563954">derBytes</span><span class="op" id="6563962">}</span><span class="op" id="6563963">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6563967">keyPath</span>&nbsp;<span class="op" id="6563975">:=</span>&nbsp;<span class="ident" id="6563978">tempFile</span><span class="op" id="6563986">(</span><span class="builtintype" id="6563987">string</span><span class="op" id="6563993">(</span><span class="ident" id="6563994">pemOut</span><span class="op" id="6564000">.</span><span class="ident" id="6564001">Bytes</span><span class="op" id="6564006">(</span><span class="op" id="6564007">)</span><span class="op" id="6564008">)</span><span class="op" id="6564009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564012">defer</span>&nbsp;<span class="ident" id="6564018">os</span><span class="op" id="6564020">.</span><span class="ident" id="6564021">Remove</span><span class="op" id="6564027">(</span><span class="ident" id="6564028">keyPath</span><span class="op" id="6564035">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564039">var</span>&nbsp;<span class="ident" id="6564043">command</span>&nbsp;<span class="op" id="6564051">[</span><span class="op" id="6564052">]</span><span class="builtintype" id="6564053">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564061">if</span>&nbsp;<span class="builtinfunc" id="6564064">len</span><span class="op" id="6564067">(</span><span class="ident" id="6564068">test</span><span class="op" id="6564072">.</span><span class="ident" id="6564073">command</span><span class="op" id="6564080">)</span>&nbsp;<span class="op" id="6564082">&gt;</span>&nbsp;<span class="num" id="6564084">0</span>&nbsp;<span class="op" id="6564086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564090">command</span>&nbsp;<span class="op" id="6564098">=</span>&nbsp;<span class="builtinfunc" id="6564100">append</span><span class="op" id="6564106">(</span><span class="ident" id="6564107">command</span><span class="op" id="6564114">,</span>&nbsp;<span class="ident" id="6564116">test</span><span class="op" id="6564120">.</span><span class="ident" id="6564121">command</span><span class="op" id="6564128">...</span><span class="op" id="6564131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564134">}</span>&nbsp;<span class="keyword" id="6564136">else</span>&nbsp;<span class="op" id="6564141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564145">command</span>&nbsp;<span class="op" id="6564153">=</span>&nbsp;<span class="builtinfunc" id="6564155">append</span><span class="op" id="6564161">(</span><span class="ident" id="6564162">command</span><span class="op" id="6564169">,</span>&nbsp;<span class="ident" id="6564171">defaultServerCommand</span><span class="op" id="6564191">...</span><span class="op" id="6564194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564197">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564200">command</span>&nbsp;<span class="op" id="6564208">=</span>&nbsp;<span class="builtinfunc" id="6564210">append</span><span class="op" id="6564216">(</span><span class="ident" id="6564217">command</span><span class="op" id="6564224">,</span>&nbsp;<span class="string" id="6564226">&#34;-cert&#34;</span><span class="op" id="6564233">,</span>&nbsp;<span class="ident" id="6564235">certPath</span><span class="op" id="6564243">,</span>&nbsp;<span class="string" id="6564245">&#34;-certform&#34;</span><span class="op" id="6564256">,</span>&nbsp;<span class="string" id="6564258">&#34;DER&#34;</span><span class="op" id="6564263">,</span>&nbsp;<span class="string" id="6564265">&#34;-key&#34;</span><span class="op" id="6564271">,</span>&nbsp;<span class="ident" id="6564273">keyPath</span><span class="op" id="6564280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564283">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564353">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564424">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564493">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564562">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564592">const</span>&nbsp;<span class="ident" id="6564598">serverPort</span>&nbsp;<span class="op" id="6564609">=</span>&nbsp;<span class="num" id="6564611">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564618">command</span>&nbsp;<span class="op" id="6564626">=</span>&nbsp;<span class="builtinfunc" id="6564628">append</span><span class="op" id="6564634">(</span><span class="ident" id="6564635">command</span><span class="op" id="6564642">,</span>&nbsp;<span class="string" id="6564644">&#34;-accept&#34;</span><span class="op" id="6564653">,</span>&nbsp;<span class="ident" id="6564655">strconv</span><span class="op" id="6564662">.</span><span class="ident" id="6564663">Itoa</span><span class="op" id="6564667">(</span><span class="ident" id="6564668">serverPort</span><span class="op" id="6564678">)</span><span class="op" id="6564679">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564683">cmd</span>&nbsp;<span class="op" id="6564687">:=</span>&nbsp;<span class="ident" id="6564690">exec</span><span class="op" id="6564694">.</span><span class="ident" id="6564695">Command</span><span class="op" id="6564702">(</span><span class="ident" id="6564703">command</span><span class="op" id="6564710">[</span><span class="num" id="6564711">0</span><span class="op" id="6564712">]</span><span class="op" id="6564713">,</span>&nbsp;<span class="ident" id="6564715">command</span><span class="op" id="6564722">[</span><span class="num" id="6564723">1</span><span class="op" id="6564724">:</span><span class="op" id="6564725">]</span><span class="op" id="6564726">...</span><span class="op" id="6564729">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564732">stdin</span>&nbsp;<span class="op" id="6564738">=</span>&nbsp;<span class="ident" id="6564740">blockingSource</span><span class="op" id="6564754">(</span><span class="builtinfunc" id="6564755">make</span><span class="op" id="6564759">(</span><span class="keyword" id="6564760">chan</span>&nbsp;<span class="builtintype" id="6564765">bool</span><span class="op" id="6564769">)</span><span class="op" id="6564770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564773">cmd</span><span class="op" id="6564776">.</span><span class="ident" id="6564777">Stdin</span>&nbsp;<span class="op" id="6564783">=</span>&nbsp;<span class="ident" id="6564785">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564792">var</span>&nbsp;<span class="ident" id="6564796">out</span>&nbsp;<span class="ident" id="6564800">bytes</span><span class="op" id="6564805">.</span><span class="ident" id="6564806">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564814">cmd</span><span class="op" id="6564817">.</span><span class="ident" id="6564818">Stdout</span>&nbsp;<span class="op" id="6564825">=</span>&nbsp;<span class="op" id="6564827">&amp;</span><span class="ident" id="6564828">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6564833">cmd</span><span class="op" id="6564836">.</span><span class="ident" id="6564837">Stderr</span>&nbsp;<span class="op" id="6564844">=</span>&nbsp;<span class="op" id="6564846">&amp;</span><span class="ident" id="6564847">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564852">if</span>&nbsp;<span class="ident" id="6564855">err</span>&nbsp;<span class="op" id="6564859">:=</span>&nbsp;<span class="ident" id="6564862">cmd</span><span class="op" id="6564865">.</span><span class="ident" id="6564866">Start</span><span class="op" id="6564871">(</span><span class="op" id="6564872">)</span><span class="op" id="6564873">;</span>&nbsp;<span class="ident" id="6564875">err</span>&nbsp;<span class="op" id="6564879">!=</span>&nbsp;<span class="builtintype" id="6564882">nil</span>&nbsp;<span class="op" id="6564886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6564890">return</span>&nbsp;<span class="builtintype" id="6564897">nil</span><span class="op" id="6564900">,</span>&nbsp;<span class="builtintype" id="6564902">nil</span><span class="op" id="6564905">,</span>&nbsp;<span class="builtintype" id="6564907">nil</span><span class="op" id="6564910">,</span>&nbsp;<span class="ident" id="6564912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6564917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564921">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6564988">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565060">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6565129">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565145">var</span>&nbsp;<span class="ident" id="6565149">tcpConn</span>&nbsp;<span class="ident" id="6565157">net</span><span class="op" id="6565160">.</span><span class="ident" id="6565161">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565167">for</span>&nbsp;<span class="ident" id="6565171">i</span>&nbsp;<span class="op" id="6565173">:=</span>&nbsp;<span class="builtintype" id="6565176">uint</span><span class="op" id="6565180">(</span><span class="num" id="6565181">0</span><span class="op" id="6565182">)</span><span class="op" id="6565183">;</span>&nbsp;<span class="ident" id="6565185">i</span>&nbsp;<span class="op" id="6565187">&lt;</span>&nbsp;<span class="num" id="6565189">5</span><span class="op" id="6565190">;</span>&nbsp;<span class="ident" id="6565192">i</span><span class="op" id="6565193">++</span>&nbsp;<span class="op" id="6565196">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565200">var</span>&nbsp;<span class="ident" id="6565204">err</span>&nbsp;<span class="builtintype" id="6565208">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565216">tcpConn</span><span class="op" id="6565223">,</span>&nbsp;<span class="ident" id="6565225">err</span>&nbsp;<span class="op" id="6565229">=</span>&nbsp;<span class="ident" id="6565231">net</span><span class="op" id="6565234">.</span><span class="ident" id="6565235">DialTCP</span><span class="op" id="6565242">(</span><span class="string" id="6565243">&#34;tcp&#34;</span><span class="op" id="6565248">,</span>&nbsp;<span class="builtintype" id="6565250">nil</span><span class="op" id="6565253">,</span>&nbsp;<span class="op" id="6565255">&amp;</span><span class="ident" id="6565256">net</span><span class="op" id="6565259">.</span><span class="ident" id="6565260">TCPAddr</span><span class="op" id="6565267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565272">IP</span><span class="op" id="6565274">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6565278">net</span><span class="op" id="6565281">.</span><span class="ident" id="6565282">IPv4</span><span class="op" id="6565286">(</span><span class="num" id="6565287">127</span><span class="op" id="6565290">,</span>&nbsp;<span class="num" id="6565292">0</span><span class="op" id="6565293">,</span>&nbsp;<span class="num" id="6565295">0</span><span class="op" id="6565296">,</span>&nbsp;<span class="num" id="6565298">1</span><span class="op" id="6565299">)</span><span class="op" id="6565300">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565305">Port</span><span class="op" id="6565309">:</span>&nbsp;<span class="ident" id="6565311">serverPort</span><span class="op" id="6565321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565325">}</span><span class="op" id="6565326">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565330">if</span>&nbsp;<span class="ident" id="6565333">err</span>&nbsp;<span class="op" id="6565337">==</span>&nbsp;<span class="builtintype" id="6565340">nil</span>&nbsp;<span class="op" id="6565344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565349">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565361">time</span><span class="op" id="6565365">.</span><span class="ident" id="6565366">Sleep</span><span class="op" id="6565371">(</span><span class="op" id="6565372">(</span><span class="num" id="6565373">1</span>&nbsp;<span class="op" id="6565375">&lt;&lt;</span>&nbsp;<span class="ident" id="6565378">i</span><span class="op" id="6565379">)</span>&nbsp;<span class="op" id="6565381">*</span>&nbsp;<span class="num" id="6565383">5</span>&nbsp;<span class="op" id="6565385">*</span>&nbsp;<span class="ident" id="6565387">time</span><span class="op" id="6565391">.</span><span class="ident" id="6565392">Millisecond</span><span class="op" id="6565403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565406">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565409">if</span>&nbsp;<span class="ident" id="6565412">tcpConn</span>&nbsp;<span class="op" id="6565420">==</span>&nbsp;<span class="builtintype" id="6565423">nil</span>&nbsp;<span class="op" id="6565427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6565431">close</span><span class="op" id="6565436">(</span><span class="ident" id="6565437">stdin</span><span class="op" id="6565442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565446">out</span><span class="op" id="6565449">.</span><span class="ident" id="6565450">WriteTo</span><span class="op" id="6565457">(</span><span class="ident" id="6565458">os</span><span class="op" id="6565460">.</span><span class="ident" id="6565461">Stdout</span><span class="op" id="6565467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565471">cmd</span><span class="op" id="6565474">.</span><span class="ident" id="6565475">Process</span><span class="op" id="6565482">.</span><span class="ident" id="6565483">Kill</span><span class="op" id="6565487">(</span><span class="op" id="6565488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565492">return</span>&nbsp;<span class="builtintype" id="6565499">nil</span><span class="op" id="6565502">,</span>&nbsp;<span class="builtintype" id="6565504">nil</span><span class="op" id="6565507">,</span>&nbsp;<span class="builtintype" id="6565509">nil</span><span class="op" id="6565512">,</span>&nbsp;<span class="ident" id="6565514">cmd</span><span class="op" id="6565517">.</span><span class="ident" id="6565518">Wait</span><span class="op" id="6565522">(</span><span class="op" id="6565523">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565530">record</span>&nbsp;<span class="op" id="6565537">:=</span>&nbsp;<span class="op" id="6565540">&amp;</span><span class="ident" id="6565541">recordingConn</span><span class="op" id="6565554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565558">Conn</span><span class="op" id="6565562">:</span>&nbsp;<span class="ident" id="6565564">tcpConn</span><span class="op" id="6565571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565574">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565578">return</span>&nbsp;<span class="ident" id="6565585">record</span><span class="op" id="6565591">,</span>&nbsp;<span class="ident" id="6565593">cmd</span><span class="op" id="6565596">,</span>&nbsp;<span class="ident" id="6565598">stdin</span><span class="op" id="6565603">,</span>&nbsp;<span class="builtintype" id="6565605">nil</span><br>
<span class="lineno"></span><span class="op" id="6565609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565612">func</span>&nbsp;<span class="op" id="6565617">(</span><span class="ident" id="6565618">test</span>&nbsp;<span class="op" id="6565623">*</span><span class="ident" id="6565624">clientTest</span><span class="op" id="6565634">)</span>&nbsp;<span class="ident" id="6565636">dataPath</span><span class="op" id="6565644">(</span><span class="op" id="6565645">)</span>&nbsp;<span class="builtintype" id="6565647">string</span>&nbsp;<span class="op" id="6565654">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565657">return</span>&nbsp;<span class="ident" id="6565664">filepath</span><span class="op" id="6565672">.</span><span class="ident" id="6565673">Join</span><span class="op" id="6565677">(</span><span class="string" id="6565678">&#34;testdata&#34;</span><span class="op" id="6565688">,</span>&nbsp;<span class="string" id="6565690">&#34;Client-&#34;</span><span class="op" id="6565699">+</span><span class="ident" id="6565700">test</span><span class="op" id="6565704">.</span><span class="ident" id="6565705">name</span><span class="op" id="6565709">)</span><br>
<span class="lineno"></span><span class="op" id="6565711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565714">func</span>&nbsp;<span class="op" id="6565719">(</span><span class="ident" id="6565720">test</span>&nbsp;<span class="op" id="6565725">*</span><span class="ident" id="6565726">clientTest</span><span class="op" id="6565736">)</span>&nbsp;<span class="ident" id="6565738">loadData</span><span class="op" id="6565746">(</span><span class="op" id="6565747">)</span>&nbsp;<span class="op" id="6565749">(</span><span class="ident" id="6565750">flows</span>&nbsp;<span class="op" id="6565756">[</span><span class="op" id="6565757">]</span><span class="op" id="6565758">[</span><span class="op" id="6565759">]</span><span class="builtintype" id="6565760">byte</span><span class="op" id="6565764">,</span>&nbsp;<span class="ident" id="6565766">err</span>&nbsp;<span class="builtintype" id="6565770">error</span><span class="op" id="6565775">)</span>&nbsp;<span class="op" id="6565777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6565780">in</span><span class="op" id="6565782">,</span>&nbsp;<span class="ident" id="6565784">err</span>&nbsp;<span class="op" id="6565788">:=</span>&nbsp;<span class="ident" id="6565791">os</span><span class="op" id="6565793">.</span><span class="ident" id="6565794">Open</span><span class="op" id="6565798">(</span><span class="ident" id="6565799">test</span><span class="op" id="6565803">.</span><span class="ident" id="6565804">dataPath</span><span class="op" id="6565812">(</span><span class="op" id="6565813">)</span><span class="op" id="6565814">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565817">if</span>&nbsp;<span class="ident" id="6565820">err</span>&nbsp;<span class="op" id="6565824">!=</span>&nbsp;<span class="builtintype" id="6565827">nil</span>&nbsp;<span class="op" id="6565831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565835">return</span>&nbsp;<span class="builtintype" id="6565842">nil</span><span class="op" id="6565845">,</span>&nbsp;<span class="ident" id="6565847">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6565852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565855">defer</span>&nbsp;<span class="ident" id="6565861">in</span><span class="op" id="6565863">.</span><span class="ident" id="6565864">Close</span><span class="op" id="6565869">(</span><span class="op" id="6565870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565873">return</span>&nbsp;<span class="ident" id="6565880">parseTestData</span><span class="op" id="6565893">(</span><span class="ident" id="6565894">in</span><span class="op" id="6565896">)</span><br>
<span class="lineno">165</span><span class="op" id="6565898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6565901">func</span>&nbsp;<span class="op" id="6565906">(</span><span class="ident" id="6565907">test</span>&nbsp;<span class="op" id="6565912">*</span><span class="ident" id="6565913">clientTest</span><span class="op" id="6565923">)</span>&nbsp;<span class="ident" id="6565925">run</span><span class="op" id="6565928">(</span><span class="ident" id="6565929">t</span>&nbsp;<span class="op" id="6565931">*</span><span class="ident" id="6565932">testing</span><span class="op" id="6565939">.</span><span class="ident" id="6565940">T</span><span class="op" id="6565941">,</span>&nbsp;<span class="ident" id="6565943">write</span>&nbsp;<span class="builtintype" id="6565949">bool</span><span class="op" id="6565953">)</span>&nbsp;<span class="op" id="6565955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565958">var</span>&nbsp;<span class="ident" id="6565962">clientConn</span><span class="op" id="6565972">,</span>&nbsp;<span class="ident" id="6565974">serverConn</span>&nbsp;<span class="ident" id="6565985">net</span><span class="op" id="6565988">.</span><span class="ident" id="6565989">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6565995">var</span>&nbsp;<span class="ident" id="6565999">recordingConn</span>&nbsp;<span class="op" id="6566013">*</span><span class="ident" id="6566014">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566029">var</span>&nbsp;<span class="ident" id="6566033">childProcess</span>&nbsp;<span class="op" id="6566046">*</span><span class="ident" id="6566047">exec</span><span class="op" id="6566051">.</span><span class="ident" id="6566052">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566057">var</span>&nbsp;<span class="ident" id="6566061">stdin</span>&nbsp;<span class="ident" id="6566067">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566084">if</span>&nbsp;<span class="ident" id="6566087">write</span>&nbsp;<span class="op" id="6566093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566097">var</span>&nbsp;<span class="ident" id="6566101">err</span>&nbsp;<span class="builtintype" id="6566105">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566113">recordingConn</span><span class="op" id="6566126">,</span>&nbsp;<span class="ident" id="6566128">childProcess</span><span class="op" id="6566140">,</span>&nbsp;<span class="ident" id="6566142">stdin</span><span class="op" id="6566147">,</span>&nbsp;<span class="ident" id="6566149">err</span>&nbsp;<span class="op" id="6566153">=</span>&nbsp;<span class="ident" id="6566155">test</span><span class="op" id="6566159">.</span><span class="ident" id="6566160">connFromCommand</span><span class="op" id="6566175">(</span><span class="op" id="6566176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566180">if</span>&nbsp;<span class="ident" id="6566183">err</span>&nbsp;<span class="op" id="6566187">!=</span>&nbsp;<span class="builtintype" id="6566190">nil</span>&nbsp;<span class="op" id="6566194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566199">t</span><span class="op" id="6566200">.</span><span class="ident" id="6566201">Fatalf</span><span class="op" id="6566207">(</span><span class="string" id="6566208">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="6566240">,</span>&nbsp;<span class="ident" id="6566242">err</span><span class="op" id="6566245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566253">clientConn</span>&nbsp;<span class="op" id="6566264">=</span>&nbsp;<span class="ident" id="6566266">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566281">}</span>&nbsp;<span class="keyword" id="6566283">else</span>&nbsp;<span class="op" id="6566288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566292">clientConn</span><span class="op" id="6566302">,</span>&nbsp;<span class="ident" id="6566304">serverConn</span>&nbsp;<span class="op" id="6566315">=</span>&nbsp;<span class="ident" id="6566317">net</span><span class="op" id="6566320">.</span><span class="ident" id="6566321">Pipe</span><span class="op" id="6566325">(</span><span class="op" id="6566326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566333">config</span>&nbsp;<span class="op" id="6566340">:=</span>&nbsp;<span class="ident" id="6566343">test</span><span class="op" id="6566347">.</span><span class="ident" id="6566348">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566356">if</span>&nbsp;<span class="ident" id="6566359">config</span>&nbsp;<span class="op" id="6566366">==</span>&nbsp;<span class="builtintype" id="6566369">nil</span>&nbsp;<span class="op" id="6566373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566377">config</span>&nbsp;<span class="op" id="6566384">=</span>&nbsp;<span class="ident" id="6566386">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566401">client</span>&nbsp;<span class="op" id="6566408">:=</span>&nbsp;<span class="ident" id="6566411">Client</span><span class="op" id="6566417">(</span><span class="ident" id="6566418">clientConn</span><span class="op" id="6566428">,</span>&nbsp;<span class="ident" id="6566430">config</span><span class="op" id="6566436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566440">doneChan</span>&nbsp;<span class="op" id="6566449">:=</span>&nbsp;<span class="builtinfunc" id="6566452">make</span><span class="op" id="6566456">(</span><span class="keyword" id="6566457">chan</span>&nbsp;<span class="builtintype" id="6566462">bool</span><span class="op" id="6566466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566469">go</span>&nbsp;<span class="keyword" id="6566472">func</span><span class="op" id="6566476">(</span><span class="op" id="6566477">)</span>&nbsp;<span class="op" id="6566479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566483">if</span>&nbsp;<span class="ident" id="6566486">_</span><span class="op" id="6566487">,</span>&nbsp;<span class="ident" id="6566489">err</span>&nbsp;<span class="op" id="6566493">:=</span>&nbsp;<span class="ident" id="6566496">client</span><span class="op" id="6566502">.</span><span class="ident" id="6566503">Write</span><span class="op" id="6566508">(</span><span class="op" id="6566509">[</span><span class="op" id="6566510">]</span><span class="builtintype" id="6566511">byte</span><span class="op" id="6566515">(</span><span class="string" id="6566516">&#34;hello\n&#34;</span><span class="op" id="6566525">)</span><span class="op" id="6566526">)</span><span class="op" id="6566527">;</span>&nbsp;<span class="ident" id="6566529">err</span>&nbsp;<span class="op" id="6566533">!=</span>&nbsp;<span class="builtintype" id="6566536">nil</span>&nbsp;<span class="op" id="6566540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566545">t</span><span class="op" id="6566546">.</span><span class="ident" id="6566547">Logf</span><span class="op" id="6566551">(</span><span class="string" id="6566552">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6566577">,</span>&nbsp;<span class="ident" id="6566579">err</span><span class="op" id="6566582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566586">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566590">if</span>&nbsp;<span class="ident" id="6566593">test</span><span class="op" id="6566597">.</span><span class="ident" id="6566598">validate</span>&nbsp;<span class="op" id="6566607">!=</span>&nbsp;<span class="builtintype" id="6566610">nil</span>&nbsp;<span class="op" id="6566614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566619">if</span>&nbsp;<span class="ident" id="6566622">err</span>&nbsp;<span class="op" id="6566626">:=</span>&nbsp;<span class="ident" id="6566629">test</span><span class="op" id="6566633">.</span><span class="ident" id="6566634">validate</span><span class="op" id="6566642">(</span><span class="ident" id="6566643">client</span><span class="op" id="6566649">.</span><span class="ident" id="6566650">ConnectionState</span><span class="op" id="6566665">(</span><span class="op" id="6566666">)</span><span class="op" id="6566667">)</span><span class="op" id="6566668">;</span>&nbsp;<span class="ident" id="6566670">err</span>&nbsp;<span class="op" id="6566674">!=</span>&nbsp;<span class="builtintype" id="6566677">nil</span>&nbsp;<span class="op" id="6566681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566687">t</span><span class="op" id="6566688">.</span><span class="ident" id="6566689">Logf</span><span class="op" id="6566693">(</span><span class="string" id="6566694">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6566732">,</span>&nbsp;<span class="ident" id="6566734">err</span><span class="op" id="6566737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566746">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566750">client</span><span class="op" id="6566756">.</span><span class="ident" id="6566757">Close</span><span class="op" id="6566762">(</span><span class="op" id="6566763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566767">clientConn</span><span class="op" id="6566777">.</span><span class="ident" id="6566778">Close</span><span class="op" id="6566783">(</span><span class="op" id="6566784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566788">doneChan</span>&nbsp;<span class="op" id="6566797">&lt;-</span>&nbsp;<span class="builtintype" id="6566800">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566806">}</span><span class="op" id="6566807">(</span><span class="op" id="6566808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566812">if</span>&nbsp;<span class="op" id="6566815">!</span><span class="ident" id="6566816">write</span>&nbsp;<span class="op" id="6566822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566826">flows</span><span class="op" id="6566831">,</span>&nbsp;<span class="ident" id="6566833">err</span>&nbsp;<span class="op" id="6566837">:=</span>&nbsp;<span class="ident" id="6566840">test</span><span class="op" id="6566844">.</span><span class="ident" id="6566845">loadData</span><span class="op" id="6566853">(</span><span class="op" id="6566854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566858">if</span>&nbsp;<span class="ident" id="6566861">err</span>&nbsp;<span class="op" id="6566865">!=</span>&nbsp;<span class="builtintype" id="6566868">nil</span>&nbsp;<span class="op" id="6566872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6566877">t</span><span class="op" id="6566878">.</span><span class="ident" id="6566879">Fatalf</span><span class="op" id="6566885">(</span><span class="string" id="6566886">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6566923">,</span>&nbsp;<span class="ident" id="6566925">test</span><span class="op" id="6566929">.</span><span class="ident" id="6566930">name</span><span class="op" id="6566934">,</span>&nbsp;<span class="ident" id="6566936">test</span><span class="op" id="6566940">.</span><span class="ident" id="6566941">dataPath</span><span class="op" id="6566949">(</span><span class="op" id="6566950">)</span><span class="op" id="6566951">,</span>&nbsp;<span class="ident" id="6566953">err</span><span class="op" id="6566956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6566960">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566964">for</span>&nbsp;<span class="ident" id="6566968">i</span><span class="op" id="6566969">,</span>&nbsp;<span class="ident" id="6566971">b</span>&nbsp;<span class="op" id="6566973">:=</span>&nbsp;<span class="keyword" id="6566976">range</span>&nbsp;<span class="ident" id="6566982">flows</span>&nbsp;<span class="op" id="6566988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6566993">if</span>&nbsp;<span class="ident" id="6566996">i</span><span class="op" id="6566997">%</span><span class="num" id="6566998">2</span>&nbsp;<span class="op" id="6567000">==</span>&nbsp;<span class="num" id="6567003">1</span>&nbsp;<span class="op" id="6567005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567011">serverConn</span><span class="op" id="6567021">.</span><span class="ident" id="6567022">Write</span><span class="op" id="6567027">(</span><span class="ident" id="6567028">b</span><span class="op" id="6567029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567035">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567047">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567052">bb</span>&nbsp;<span class="op" id="6567055">:=</span>&nbsp;<span class="builtinfunc" id="6567058">make</span><span class="op" id="6567062">(</span><span class="op" id="6567063">[</span><span class="op" id="6567064">]</span><span class="builtintype" id="6567065">byte</span><span class="op" id="6567069">,</span>&nbsp;<span class="builtinfunc" id="6567071">len</span><span class="op" id="6567074">(</span><span class="ident" id="6567075">b</span><span class="op" id="6567076">)</span><span class="op" id="6567077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567082">_</span><span class="op" id="6567083">,</span>&nbsp;<span class="ident" id="6567085">err</span>&nbsp;<span class="op" id="6567089">:=</span>&nbsp;<span class="ident" id="6567092">io</span><span class="op" id="6567094">.</span><span class="ident" id="6567095">ReadFull</span><span class="op" id="6567103">(</span><span class="ident" id="6567104">serverConn</span><span class="op" id="6567114">,</span>&nbsp;<span class="ident" id="6567116">bb</span><span class="op" id="6567118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567123">if</span>&nbsp;<span class="ident" id="6567126">err</span>&nbsp;<span class="op" id="6567130">!=</span>&nbsp;<span class="builtintype" id="6567133">nil</span>&nbsp;<span class="op" id="6567137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567143">t</span><span class="op" id="6567144">.</span><span class="ident" id="6567145">Fatalf</span><span class="op" id="6567151">(</span><span class="string" id="6567152">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="6567164">,</span>&nbsp;<span class="ident" id="6567166">test</span><span class="op" id="6567170">.</span><span class="ident" id="6567171">name</span><span class="op" id="6567175">,</span>&nbsp;<span class="ident" id="6567177">i</span><span class="op" id="6567178">,</span>&nbsp;<span class="ident" id="6567180">err</span><span class="op" id="6567183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567188">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567193">if</span>&nbsp;<span class="op" id="6567196">!</span><span class="ident" id="6567197">bytes</span><span class="op" id="6567202">.</span><span class="ident" id="6567203">Equal</span><span class="op" id="6567208">(</span><span class="ident" id="6567209">b</span><span class="op" id="6567210">,</span>&nbsp;<span class="ident" id="6567212">bb</span><span class="op" id="6567214">)</span>&nbsp;<span class="op" id="6567216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567222">t</span><span class="op" id="6567223">.</span><span class="ident" id="6567224">Fatalf</span><span class="op" id="6567230">(</span><span class="string" id="6567231">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="6567273">,</span>&nbsp;<span class="ident" id="6567275">test</span><span class="op" id="6567279">.</span><span class="ident" id="6567280">name</span><span class="op" id="6567284">,</span>&nbsp;<span class="ident" id="6567286">i</span><span class="op" id="6567287">,</span>&nbsp;<span class="ident" id="6567289">bb</span><span class="op" id="6567291">,</span>&nbsp;<span class="ident" id="6567293">b</span><span class="op" id="6567294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567307">serverConn</span><span class="op" id="6567317">.</span><span class="ident" id="6567318">Close</span><span class="op" id="6567323">(</span><span class="op" id="6567324">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567331">&lt;-</span><span class="ident" id="6567333">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567344">if</span>&nbsp;<span class="ident" id="6567347">write</span>&nbsp;<span class="op" id="6567353">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567357">path</span>&nbsp;<span class="op" id="6567362">:=</span>&nbsp;<span class="ident" id="6567365">test</span><span class="op" id="6567369">.</span><span class="ident" id="6567370">dataPath</span><span class="op" id="6567378">(</span><span class="op" id="6567379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567383">out</span><span class="op" id="6567386">,</span>&nbsp;<span class="ident" id="6567388">err</span>&nbsp;<span class="op" id="6567392">:=</span>&nbsp;<span class="ident" id="6567395">os</span><span class="op" id="6567397">.</span><span class="ident" id="6567398">OpenFile</span><span class="op" id="6567406">(</span><span class="ident" id="6567407">path</span><span class="op" id="6567411">,</span>&nbsp;<span class="ident" id="6567413">os</span><span class="op" id="6567415">.</span><span class="ident" id="6567416">O_WRONLY</span><span class="op" id="6567424">|</span><span class="ident" id="6567425">os</span><span class="op" id="6567427">.</span><span class="ident" id="6567428">O_CREATE</span><span class="op" id="6567436">|</span><span class="ident" id="6567437">os</span><span class="op" id="6567439">.</span><span class="ident" id="6567440">O_TRUNC</span><span class="op" id="6567447">,</span>&nbsp;<span class="num" id="6567449">0644</span><span class="op" id="6567453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567457">if</span>&nbsp;<span class="ident" id="6567460">err</span>&nbsp;<span class="op" id="6567464">!=</span>&nbsp;<span class="builtintype" id="6567467">nil</span>&nbsp;<span class="op" id="6567471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567476">t</span><span class="op" id="6567477">.</span><span class="ident" id="6567478">Fatalf</span><span class="op" id="6567484">(</span><span class="string" id="6567485">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="6567519">,</span>&nbsp;<span class="ident" id="6567521">err</span><span class="op" id="6567524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567528">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567532">defer</span>&nbsp;<span class="ident" id="6567538">out</span><span class="op" id="6567541">.</span><span class="ident" id="6567542">Close</span><span class="op" id="6567547">(</span><span class="op" id="6567548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567552">recordingConn</span><span class="op" id="6567565">.</span><span class="ident" id="6567566">Close</span><span class="op" id="6567571">(</span><span class="op" id="6567572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6567576">close</span><span class="op" id="6567581">(</span><span class="ident" id="6567582">stdin</span><span class="op" id="6567587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567591">childProcess</span><span class="op" id="6567603">.</span><span class="ident" id="6567604">Process</span><span class="op" id="6567611">.</span><span class="ident" id="6567612">Kill</span><span class="op" id="6567616">(</span><span class="op" id="6567617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567621">childProcess</span><span class="op" id="6567633">.</span><span class="ident" id="6567634">Wait</span><span class="op" id="6567638">(</span><span class="op" id="6567639">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567643">if</span>&nbsp;<span class="builtinfunc" id="6567646">len</span><span class="op" id="6567649">(</span><span class="ident" id="6567650">recordingConn</span><span class="op" id="6567663">.</span><span class="ident" id="6567664">flows</span><span class="op" id="6567669">)</span>&nbsp;<span class="op" id="6567671">&lt;</span>&nbsp;<span class="num" id="6567673">3</span>&nbsp;<span class="op" id="6567675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567680">childProcess</span><span class="op" id="6567692">.</span><span class="ident" id="6567693">Stdout</span><span class="op" id="6567699">.</span><span class="op" id="6567700">(</span><span class="op" id="6567701">*</span><span class="ident" id="6567702">bytes</span><span class="op" id="6567707">.</span><span class="ident" id="6567708">Buffer</span><span class="op" id="6567714">)</span><span class="op" id="6567715">.</span><span class="ident" id="6567716">WriteTo</span><span class="op" id="6567723">(</span><span class="ident" id="6567724">os</span><span class="op" id="6567726">.</span><span class="ident" id="6567727">Stdout</span><span class="op" id="6567733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567738">t</span><span class="op" id="6567739">.</span><span class="ident" id="6567740">Fatalf</span><span class="op" id="6567746">(</span><span class="string" id="6567747">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="6567778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567786">recordingConn</span><span class="op" id="6567799">.</span><span class="ident" id="6567800">WriteTo</span><span class="op" id="6567807">(</span><span class="ident" id="6567808">out</span><span class="op" id="6567811">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567815">fmt</span><span class="op" id="6567818">.</span><span class="ident" id="6567819">Printf</span><span class="op" id="6567825">(</span><span class="string" id="6567826">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="6567838">,</span>&nbsp;<span class="ident" id="6567840">path</span><span class="op" id="6567844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6567847">}</span><br>
<span class="lineno"></span><span class="op" id="6567849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6567852">func</span>&nbsp;<span class="ident" id="6567857">runClientTestForVersion</span><span class="op" id="6567880">(</span><span class="ident" id="6567881">t</span>&nbsp;<span class="op" id="6567883">*</span><span class="ident" id="6567884">testing</span><span class="op" id="6567891">.</span><span class="ident" id="6567892">T</span><span class="op" id="6567893">,</span>&nbsp;<span class="ident" id="6567895">template</span>&nbsp;<span class="op" id="6567904">*</span><span class="ident" id="6567905">clientTest</span><span class="op" id="6567915">,</span>&nbsp;<span class="ident" id="6567917">prefix</span><span class="op" id="6567923">,</span>&nbsp;<span class="ident" id="6567925">option</span>&nbsp;<span class="builtintype" id="6567932">string</span><span class="op" id="6567938">)</span>&nbsp;<span class="op" id="6567940">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567943">test</span>&nbsp;<span class="op" id="6567948">:=</span>&nbsp;<span class="op" id="6567951">*</span><span class="ident" id="6567952">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6567962">test</span><span class="op" id="6567966">.</span><span class="ident" id="6567967">name</span>&nbsp;<span class="op" id="6567972">=</span>&nbsp;<span class="ident" id="6567974">prefix</span>&nbsp;<span class="op" id="6567981">+</span>&nbsp;<span class="ident" id="6567983">test</span><span class="op" id="6567987">.</span><span class="ident" id="6567988">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6567994">if</span>&nbsp;<span class="builtinfunc" id="6567997">len</span><span class="op" id="6568000">(</span><span class="ident" id="6568001">test</span><span class="op" id="6568005">.</span><span class="ident" id="6568006">command</span><span class="op" id="6568013">)</span>&nbsp;<span class="op" id="6568015">==</span>&nbsp;<span class="num" id="6568018">0</span>&nbsp;<span class="op" id="6568020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568024">test</span><span class="op" id="6568028">.</span><span class="ident" id="6568029">command</span>&nbsp;<span class="op" id="6568037">=</span>&nbsp;<span class="ident" id="6568039">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568061">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568064">test</span><span class="op" id="6568068">.</span><span class="ident" id="6568069">command</span>&nbsp;<span class="op" id="6568077">=</span>&nbsp;<span class="builtinfunc" id="6568079">append</span><span class="op" id="6568085">(</span><span class="op" id="6568086">[</span><span class="op" id="6568087">]</span><span class="builtintype" id="6568088">string</span><span class="op" id="6568094">(</span><span class="builtintype" id="6568095">nil</span><span class="op" id="6568098">)</span><span class="op" id="6568099">,</span>&nbsp;<span class="ident" id="6568101">test</span><span class="op" id="6568105">.</span><span class="ident" id="6568106">command</span><span class="op" id="6568113">...</span><span class="op" id="6568116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568119">test</span><span class="op" id="6568123">.</span><span class="ident" id="6568124">command</span>&nbsp;<span class="op" id="6568132">=</span>&nbsp;<span class="builtinfunc" id="6568134">append</span><span class="op" id="6568140">(</span><span class="ident" id="6568141">test</span><span class="op" id="6568145">.</span><span class="ident" id="6568146">command</span><span class="op" id="6568153">,</span>&nbsp;<span class="ident" id="6568155">option</span><span class="op" id="6568161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568164">test</span><span class="op" id="6568168">.</span><span class="ident" id="6568169">run</span><span class="op" id="6568172">(</span><span class="ident" id="6568173">t</span><span class="op" id="6568174">,</span>&nbsp;<span class="op" id="6568176">*</span><span class="ident" id="6568177">update</span><span class="op" id="6568183">)</span><br>
<span class="lineno"></span><span class="op" id="6568185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="6568188">func</span>&nbsp;<span class="ident" id="6568193">runClientTestTLS10</span><span class="op" id="6568211">(</span><span class="ident" id="6568212">t</span>&nbsp;<span class="op" id="6568214">*</span><span class="ident" id="6568215">testing</span><span class="op" id="6568222">.</span><span class="ident" id="6568223">T</span><span class="op" id="6568224">,</span>&nbsp;<span class="ident" id="6568226">template</span>&nbsp;<span class="op" id="6568235">*</span><span class="ident" id="6568236">clientTest</span><span class="op" id="6568246">)</span>&nbsp;<span class="op" id="6568248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568251">runClientTestForVersion</span><span class="op" id="6568274">(</span><span class="ident" id="6568275">t</span><span class="op" id="6568276">,</span>&nbsp;<span class="ident" id="6568278">template</span><span class="op" id="6568286">,</span>&nbsp;<span class="string" id="6568288">&#34;TLSv10-&#34;</span><span class="op" id="6568297">,</span>&nbsp;<span class="string" id="6568299">&#34;-tls1&#34;</span><span class="op" id="6568306">)</span><br>
<span class="lineno"></span><span class="op" id="6568308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6568311">func</span>&nbsp;<span class="ident" id="6568316">runClientTestTLS11</span><span class="op" id="6568334">(</span><span class="ident" id="6568335">t</span>&nbsp;<span class="op" id="6568337">*</span><span class="ident" id="6568338">testing</span><span class="op" id="6568345">.</span><span class="ident" id="6568346">T</span><span class="op" id="6568347">,</span>&nbsp;<span class="ident" id="6568349">template</span>&nbsp;<span class="op" id="6568358">*</span><span class="ident" id="6568359">clientTest</span><span class="op" id="6568369">)</span>&nbsp;<span class="op" id="6568371">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568374">runClientTestForVersion</span><span class="op" id="6568397">(</span><span class="ident" id="6568398">t</span><span class="op" id="6568399">,</span>&nbsp;<span class="ident" id="6568401">template</span><span class="op" id="6568409">,</span>&nbsp;<span class="string" id="6568411">&#34;TLSv11-&#34;</span><span class="op" id="6568420">,</span>&nbsp;<span class="string" id="6568422">&#34;-tls1_1&#34;</span><span class="op" id="6568431">)</span><br>
<span class="lineno"></span><span class="op" id="6568433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6568436">func</span>&nbsp;<span class="ident" id="6568441">runClientTestTLS12</span><span class="op" id="6568459">(</span><span class="ident" id="6568460">t</span>&nbsp;<span class="op" id="6568462">*</span><span class="ident" id="6568463">testing</span><span class="op" id="6568470">.</span><span class="ident" id="6568471">T</span><span class="op" id="6568472">,</span>&nbsp;<span class="ident" id="6568474">template</span>&nbsp;<span class="op" id="6568483">*</span><span class="ident" id="6568484">clientTest</span><span class="op" id="6568494">)</span>&nbsp;<span class="op" id="6568496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568499">runClientTestForVersion</span><span class="op" id="6568522">(</span><span class="ident" id="6568523">t</span><span class="op" id="6568524">,</span>&nbsp;<span class="ident" id="6568526">template</span><span class="op" id="6568534">,</span>&nbsp;<span class="string" id="6568536">&#34;TLSv12-&#34;</span><span class="op" id="6568545">,</span>&nbsp;<span class="string" id="6568547">&#34;-tls1_2&#34;</span><span class="op" id="6568556">)</span><br>
<span class="lineno">270</span><span class="op" id="6568558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6568561">func</span>&nbsp;<span class="ident" id="6568566">TestHandshakeClientRSARC4</span><span class="op" id="6568591">(</span><span class="ident" id="6568592">t</span>&nbsp;<span class="op" id="6568594">*</span><span class="ident" id="6568595">testing</span><span class="op" id="6568602">.</span><span class="ident" id="6568603">T</span><span class="op" id="6568604">)</span>&nbsp;<span class="op" id="6568606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568609">test</span>&nbsp;<span class="op" id="6568614">:=</span>&nbsp;<span class="op" id="6568617">&amp;</span><span class="ident" id="6568618">clientTest</span><span class="op" id="6568628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568632">name</span><span class="op" id="6568636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6568641">&#34;RSA-RC4&#34;</span><span class="op" id="6568650">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568654">command</span><span class="op" id="6568661">:</span>&nbsp;<span class="op" id="6568663">[</span><span class="op" id="6568664">]</span><span class="builtintype" id="6568665">string</span><span class="op" id="6568671">{</span><span class="string" id="6568672">&#34;openssl&#34;</span><span class="op" id="6568681">,</span>&nbsp;<span class="string" id="6568683">&#34;s_server&#34;</span><span class="op" id="6568693">,</span>&nbsp;<span class="string" id="6568695">&#34;-cipher&#34;</span><span class="op" id="6568704">,</span>&nbsp;<span class="string" id="6568706">&#34;RC4-SHA&#34;</span><span class="op" id="6568715">}</span><span class="op" id="6568716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568722">runClientTestTLS10</span><span class="op" id="6568740">(</span><span class="ident" id="6568741">t</span><span class="op" id="6568742">,</span>&nbsp;<span class="ident" id="6568744">test</span><span class="op" id="6568748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568751">runClientTestTLS11</span><span class="op" id="6568769">(</span><span class="ident" id="6568770">t</span><span class="op" id="6568771">,</span>&nbsp;<span class="ident" id="6568773">test</span><span class="op" id="6568777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568780">runClientTestTLS12</span><span class="op" id="6568798">(</span><span class="ident" id="6568799">t</span><span class="op" id="6568800">,</span>&nbsp;<span class="ident" id="6568802">test</span><span class="op" id="6568806">)</span><br>
<span class="lineno">280</span><span class="op" id="6568808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6568811">func</span>&nbsp;<span class="ident" id="6568816">TestHandshakeClientECDHERSAAES</span><span class="op" id="6568846">(</span><span class="ident" id="6568847">t</span>&nbsp;<span class="op" id="6568849">*</span><span class="ident" id="6568850">testing</span><span class="op" id="6568857">.</span><span class="ident" id="6568858">T</span><span class="op" id="6568859">)</span>&nbsp;<span class="op" id="6568861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568864">test</span>&nbsp;<span class="op" id="6568869">:=</span>&nbsp;<span class="op" id="6568872">&amp;</span><span class="ident" id="6568873">clientTest</span><span class="op" id="6568883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568887">name</span><span class="op" id="6568891">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6568896">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="6568911">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568915">command</span><span class="op" id="6568922">:</span>&nbsp;<span class="op" id="6568924">[</span><span class="op" id="6568925">]</span><span class="builtintype" id="6568926">string</span><span class="op" id="6568932">{</span><span class="string" id="6568933">&#34;openssl&#34;</span><span class="op" id="6568942">,</span>&nbsp;<span class="string" id="6568944">&#34;s_server&#34;</span><span class="op" id="6568954">,</span>&nbsp;<span class="string" id="6568956">&#34;-cipher&#34;</span><span class="op" id="6568965">,</span>&nbsp;<span class="string" id="6568967">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="6568989">}</span><span class="op" id="6568990">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6568993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6568996">runClientTestTLS10</span><span class="op" id="6569014">(</span><span class="ident" id="6569015">t</span><span class="op" id="6569016">,</span>&nbsp;<span class="ident" id="6569018">test</span><span class="op" id="6569022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569025">runClientTestTLS11</span><span class="op" id="6569043">(</span><span class="ident" id="6569044">t</span><span class="op" id="6569045">,</span>&nbsp;<span class="ident" id="6569047">test</span><span class="op" id="6569051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569054">runClientTestTLS12</span><span class="op" id="6569072">(</span><span class="ident" id="6569073">t</span><span class="op" id="6569074">,</span>&nbsp;<span class="ident" id="6569076">test</span><span class="op" id="6569080">)</span><br>
<span class="lineno">290</span><span class="op" id="6569082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569085">func</span>&nbsp;<span class="ident" id="6569090">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="6569122">(</span><span class="ident" id="6569123">t</span>&nbsp;<span class="op" id="6569125">*</span><span class="ident" id="6569126">testing</span><span class="op" id="6569133">.</span><span class="ident" id="6569134">T</span><span class="op" id="6569135">)</span>&nbsp;<span class="op" id="6569137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569140">test</span>&nbsp;<span class="op" id="6569145">:=</span>&nbsp;<span class="op" id="6569148">&amp;</span><span class="ident" id="6569149">clientTest</span><span class="op" id="6569159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569163">name</span><span class="op" id="6569167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6569172">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="6569189">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569193">command</span><span class="op" id="6569200">:</span>&nbsp;<span class="op" id="6569202">[</span><span class="op" id="6569203">]</span><span class="builtintype" id="6569204">string</span><span class="op" id="6569210">{</span><span class="string" id="6569211">&#34;openssl&#34;</span><span class="op" id="6569220">,</span>&nbsp;<span class="string" id="6569222">&#34;s_server&#34;</span><span class="op" id="6569232">,</span>&nbsp;<span class="string" id="6569234">&#34;-cipher&#34;</span><span class="op" id="6569243">,</span>&nbsp;<span class="string" id="6569245">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6569269">}</span><span class="op" id="6569270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569274">cert</span><span class="op" id="6569278">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569283">testECDSACertificate</span><span class="op" id="6569303">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569307">key</span><span class="op" id="6569310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569316">testECDSAPrivateKey</span><span class="op" id="6569335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569341">runClientTestTLS10</span><span class="op" id="6569359">(</span><span class="ident" id="6569360">t</span><span class="op" id="6569361">,</span>&nbsp;<span class="ident" id="6569363">test</span><span class="op" id="6569367">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569370">runClientTestTLS11</span><span class="op" id="6569388">(</span><span class="ident" id="6569389">t</span><span class="op" id="6569390">,</span>&nbsp;<span class="ident" id="6569392">test</span><span class="op" id="6569396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569399">runClientTestTLS12</span><span class="op" id="6569417">(</span><span class="ident" id="6569418">t</span><span class="op" id="6569419">,</span>&nbsp;<span class="ident" id="6569421">test</span><span class="op" id="6569425">)</span><br>
<span class="lineno"></span><span class="op" id="6569427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569430">func</span>&nbsp;<span class="ident" id="6569435">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="6569470">(</span><span class="ident" id="6569471">t</span>&nbsp;<span class="op" id="6569473">*</span><span class="ident" id="6569474">testing</span><span class="op" id="6569481">.</span><span class="ident" id="6569482">T</span><span class="op" id="6569483">)</span>&nbsp;<span class="op" id="6569485">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569488">test</span>&nbsp;<span class="op" id="6569493">:=</span>&nbsp;<span class="op" id="6569496">&amp;</span><span class="ident" id="6569497">clientTest</span><span class="op" id="6569507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569511">name</span><span class="op" id="6569515">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6569520">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="6569541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569545">command</span><span class="op" id="6569552">:</span>&nbsp;<span class="op" id="6569554">[</span><span class="op" id="6569555">]</span><span class="builtintype" id="6569556">string</span><span class="op" id="6569562">{</span><span class="string" id="6569563">&#34;openssl&#34;</span><span class="op" id="6569572">,</span>&nbsp;<span class="string" id="6569574">&#34;s_server&#34;</span><span class="op" id="6569584">,</span>&nbsp;<span class="string" id="6569586">&#34;-cipher&#34;</span><span class="op" id="6569595">,</span>&nbsp;<span class="string" id="6569597">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="6569628">}</span><span class="op" id="6569629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569633">cert</span><span class="op" id="6569637">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569642">testECDSACertificate</span><span class="op" id="6569662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569666">key</span><span class="op" id="6569669">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569675">testECDSAPrivateKey</span><span class="op" id="6569694">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6569697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569700">runClientTestTLS12</span><span class="op" id="6569718">(</span><span class="ident" id="6569719">t</span><span class="op" id="6569720">,</span>&nbsp;<span class="ident" id="6569722">test</span><span class="op" id="6569726">)</span><br>
<span class="lineno"></span><span class="op" id="6569728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6569731">func</span>&nbsp;<span class="ident" id="6569736">TestHandshakeClientCertRSA</span><span class="op" id="6569762">(</span><span class="ident" id="6569763">t</span>&nbsp;<span class="op" id="6569765">*</span><span class="ident" id="6569766">testing</span><span class="op" id="6569773">.</span><span class="ident" id="6569774">T</span><span class="op" id="6569775">)</span>&nbsp;<span class="op" id="6569777">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569780">config</span>&nbsp;<span class="op" id="6569787">:=</span>&nbsp;<span class="op" id="6569790">*</span><span class="ident" id="6569791">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569803">cert</span><span class="op" id="6569807">,</span>&nbsp;<span class="ident" id="6569809">_</span>&nbsp;<span class="op" id="6569811">:=</span>&nbsp;<span class="ident" id="6569814">X509KeyPair</span><span class="op" id="6569825">(</span><span class="op" id="6569826">[</span><span class="op" id="6569827">]</span><span class="builtintype" id="6569828">byte</span><span class="op" id="6569832">(</span><span class="ident" id="6569833">clientCertificatePEM</span><span class="op" id="6569853">)</span><span class="op" id="6569854">,</span>&nbsp;<span class="op" id="6569856">[</span><span class="op" id="6569857">]</span><span class="builtintype" id="6569858">byte</span><span class="op" id="6569862">(</span><span class="ident" id="6569863">clientKeyPEM</span><span class="op" id="6569875">)</span><span class="op" id="6569876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569879">config</span><span class="op" id="6569885">.</span><span class="ident" id="6569886">Certificates</span>&nbsp;<span class="op" id="6569899">=</span>&nbsp;<span class="op" id="6569901">[</span><span class="op" id="6569902">]</span><span class="ident" id="6569903">Certificate</span><span class="op" id="6569914">{</span><span class="ident" id="6569915">cert</span><span class="op" id="6569919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569923">test</span>&nbsp;<span class="op" id="6569928">:=</span>&nbsp;<span class="op" id="6569931">&amp;</span><span class="ident" id="6569932">clientTest</span><span class="op" id="6569942">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569946">name</span><span class="op" id="6569950">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6569955">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="6569975">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6569979">command</span><span class="op" id="6569986">:</span>&nbsp;<span class="op" id="6569988">[</span><span class="op" id="6569989">]</span><span class="builtintype" id="6569990">string</span><span class="op" id="6569996">{</span><span class="string" id="6569997">&#34;openssl&#34;</span><span class="op" id="6570006">,</span>&nbsp;<span class="string" id="6570008">&#34;s_server&#34;</span><span class="op" id="6570018">,</span>&nbsp;<span class="string" id="6570020">&#34;-cipher&#34;</span><span class="op" id="6570029">,</span>&nbsp;<span class="string" id="6570031">&#34;RC4-SHA&#34;</span><span class="op" id="6570040">,</span>&nbsp;<span class="string" id="6570042">&#34;-verify&#34;</span><span class="op" id="6570051">,</span>&nbsp;<span class="string" id="6570053">&#34;1&#34;</span><span class="op" id="6570056">}</span><span class="op" id="6570057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570061">config</span><span class="op" id="6570067">:</span>&nbsp;&nbsp;<span class="op" id="6570070">&amp;</span><span class="ident" id="6570071">config</span><span class="op" id="6570077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570084">runClientTestTLS10</span><span class="op" id="6570102">(</span><span class="ident" id="6570103">t</span><span class="op" id="6570104">,</span>&nbsp;<span class="ident" id="6570106">test</span><span class="op" id="6570110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570113">runClientTestTLS12</span><span class="op" id="6570131">(</span><span class="ident" id="6570132">t</span><span class="op" id="6570133">,</span>&nbsp;<span class="ident" id="6570135">test</span><span class="op" id="6570139">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570143">test</span>&nbsp;<span class="op" id="6570148">=</span>&nbsp;<span class="op" id="6570150">&amp;</span><span class="ident" id="6570151">clientTest</span><span class="op" id="6570161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570165">name</span><span class="op" id="6570169">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6570174">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="6570196">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570200">command</span><span class="op" id="6570207">:</span>&nbsp;<span class="op" id="6570209">[</span><span class="op" id="6570210">]</span><span class="builtintype" id="6570211">string</span><span class="op" id="6570217">{</span><span class="string" id="6570218">&#34;openssl&#34;</span><span class="op" id="6570227">,</span>&nbsp;<span class="string" id="6570229">&#34;s_server&#34;</span><span class="op" id="6570239">,</span>&nbsp;<span class="string" id="6570241">&#34;-cipher&#34;</span><span class="op" id="6570250">,</span>&nbsp;<span class="string" id="6570252">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6570276">,</span>&nbsp;<span class="string" id="6570278">&#34;-verify&#34;</span><span class="op" id="6570287">,</span>&nbsp;<span class="string" id="6570289">&#34;1&#34;</span><span class="op" id="6570292">}</span><span class="op" id="6570293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570297">config</span><span class="op" id="6570303">:</span>&nbsp;&nbsp;<span class="op" id="6570306">&amp;</span><span class="ident" id="6570307">config</span><span class="op" id="6570313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570317">cert</span><span class="op" id="6570321">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570326">testECDSACertificate</span><span class="op" id="6570346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570350">key</span><span class="op" id="6570353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570359">testECDSAPrivateKey</span><span class="op" id="6570378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570381">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570385">runClientTestTLS10</span><span class="op" id="6570403">(</span><span class="ident" id="6570404">t</span><span class="op" id="6570405">,</span>&nbsp;<span class="ident" id="6570407">test</span><span class="op" id="6570411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570414">runClientTestTLS12</span><span class="op" id="6570432">(</span><span class="ident" id="6570433">t</span><span class="op" id="6570434">,</span>&nbsp;<span class="ident" id="6570436">test</span><span class="op" id="6570440">)</span><br>
<span class="lineno"></span><span class="op" id="6570442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6570445">func</span>&nbsp;<span class="ident" id="6570450">TestHandshakeClientCertECDSA</span><span class="op" id="6570478">(</span><span class="ident" id="6570479">t</span>&nbsp;<span class="op" id="6570481">*</span><span class="ident" id="6570482">testing</span><span class="op" id="6570489">.</span><span class="ident" id="6570490">T</span><span class="op" id="6570491">)</span>&nbsp;<span class="op" id="6570493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570496">config</span>&nbsp;<span class="op" id="6570503">:=</span>&nbsp;<span class="op" id="6570506">*</span><span class="ident" id="6570507">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570519">cert</span><span class="op" id="6570523">,</span>&nbsp;<span class="ident" id="6570525">_</span>&nbsp;<span class="op" id="6570527">:=</span>&nbsp;<span class="ident" id="6570530">X509KeyPair</span><span class="op" id="6570541">(</span><span class="op" id="6570542">[</span><span class="op" id="6570543">]</span><span class="builtintype" id="6570544">byte</span><span class="op" id="6570548">(</span><span class="ident" id="6570549">clientECDSACertificatePEM</span><span class="op" id="6570574">)</span><span class="op" id="6570575">,</span>&nbsp;<span class="op" id="6570577">[</span><span class="op" id="6570578">]</span><span class="builtintype" id="6570579">byte</span><span class="op" id="6570583">(</span><span class="ident" id="6570584">clientECDSAKeyPEM</span><span class="op" id="6570601">)</span><span class="op" id="6570602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570605">config</span><span class="op" id="6570611">.</span><span class="ident" id="6570612">Certificates</span>&nbsp;<span class="op" id="6570625">=</span>&nbsp;<span class="op" id="6570627">[</span><span class="op" id="6570628">]</span><span class="ident" id="6570629">Certificate</span><span class="op" id="6570640">{</span><span class="ident" id="6570641">cert</span><span class="op" id="6570645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570649">test</span>&nbsp;<span class="op" id="6570654">:=</span>&nbsp;<span class="op" id="6570657">&amp;</span><span class="ident" id="6570658">clientTest</span><span class="op" id="6570668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570672">name</span><span class="op" id="6570676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6570681">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="6570703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570707">command</span><span class="op" id="6570714">:</span>&nbsp;<span class="op" id="6570716">[</span><span class="op" id="6570717">]</span><span class="builtintype" id="6570718">string</span><span class="op" id="6570724">{</span><span class="string" id="6570725">&#34;openssl&#34;</span><span class="op" id="6570734">,</span>&nbsp;<span class="string" id="6570736">&#34;s_server&#34;</span><span class="op" id="6570746">,</span>&nbsp;<span class="string" id="6570748">&#34;-cipher&#34;</span><span class="op" id="6570757">,</span>&nbsp;<span class="string" id="6570759">&#34;RC4-SHA&#34;</span><span class="op" id="6570768">,</span>&nbsp;<span class="string" id="6570770">&#34;-verify&#34;</span><span class="op" id="6570779">,</span>&nbsp;<span class="string" id="6570781">&#34;1&#34;</span><span class="op" id="6570784">}</span><span class="op" id="6570785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570789">config</span><span class="op" id="6570795">:</span>&nbsp;&nbsp;<span class="op" id="6570798">&amp;</span><span class="ident" id="6570799">config</span><span class="op" id="6570805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6570808">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570812">runClientTestTLS10</span><span class="op" id="6570830">(</span><span class="ident" id="6570831">t</span><span class="op" id="6570832">,</span>&nbsp;<span class="ident" id="6570834">test</span><span class="op" id="6570838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570841">runClientTestTLS12</span><span class="op" id="6570859">(</span><span class="ident" id="6570860">t</span><span class="op" id="6570861">,</span>&nbsp;<span class="ident" id="6570863">test</span><span class="op" id="6570867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570871">test</span>&nbsp;<span class="op" id="6570876">=</span>&nbsp;<span class="op" id="6570878">&amp;</span><span class="ident" id="6570879">clientTest</span><span class="op" id="6570889">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570893">name</span><span class="op" id="6570897">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6570902">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="6570926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6570930">command</span><span class="op" id="6570937">:</span>&nbsp;<span class="op" id="6570939">[</span><span class="op" id="6570940">]</span><span class="builtintype" id="6570941">string</span><span class="op" id="6570947">{</span><span class="string" id="6570948">&#34;openssl&#34;</span><span class="op" id="6570957">,</span>&nbsp;<span class="string" id="6570959">&#34;s_server&#34;</span><span class="op" id="6570969">,</span>&nbsp;<span class="string" id="6570971">&#34;-cipher&#34;</span><span class="op" id="6570980">,</span>&nbsp;<span class="string" id="6570982">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="6571006">,</span>&nbsp;<span class="string" id="6571008">&#34;-verify&#34;</span><span class="op" id="6571017">,</span>&nbsp;<span class="string" id="6571019">&#34;1&#34;</span><span class="op" id="6571022">}</span><span class="op" id="6571023">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571027">config</span><span class="op" id="6571033">:</span>&nbsp;&nbsp;<span class="op" id="6571036">&amp;</span><span class="ident" id="6571037">config</span><span class="op" id="6571043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571047">cert</span><span class="op" id="6571051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571056">testECDSACertificate</span><span class="op" id="6571076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571080">key</span><span class="op" id="6571083">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571089">testECDSAPrivateKey</span><span class="op" id="6571108">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571115">runClientTestTLS10</span><span class="op" id="6571133">(</span><span class="ident" id="6571134">t</span><span class="op" id="6571135">,</span>&nbsp;<span class="ident" id="6571137">test</span><span class="op" id="6571141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571144">runClientTestTLS12</span><span class="op" id="6571162">(</span><span class="ident" id="6571163">t</span><span class="op" id="6571164">,</span>&nbsp;<span class="ident" id="6571166">test</span><span class="op" id="6571170">)</span><br>
<span class="lineno"></span><span class="op" id="6571172">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="6571175">func</span>&nbsp;<span class="ident" id="6571180">TestClientResumption</span><span class="op" id="6571200">(</span><span class="ident" id="6571201">t</span>&nbsp;<span class="op" id="6571203">*</span><span class="ident" id="6571204">testing</span><span class="op" id="6571211">.</span><span class="ident" id="6571212">T</span><span class="op" id="6571213">)</span>&nbsp;<span class="op" id="6571215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571218">serverConfig</span>&nbsp;<span class="op" id="6571231">:=</span>&nbsp;<span class="op" id="6571234">&amp;</span><span class="ident" id="6571235">Config</span><span class="op" id="6571241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571245">CipherSuites</span><span class="op" id="6571257">:</span>&nbsp;<span class="op" id="6571259">[</span><span class="op" id="6571260">]</span><span class="builtintype" id="6571261">uint16</span><span class="op" id="6571267">{</span><span class="ident" id="6571268">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6571292">,</span>&nbsp;<span class="ident" id="6571294">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6571324">}</span><span class="op" id="6571325">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571329">Certificates</span><span class="op" id="6571341">:</span>&nbsp;<span class="ident" id="6571343">testConfig</span><span class="op" id="6571353">.</span><span class="ident" id="6571354">Certificates</span><span class="op" id="6571366">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571372">clientConfig</span>&nbsp;<span class="op" id="6571385">:=</span>&nbsp;<span class="op" id="6571388">&amp;</span><span class="ident" id="6571389">Config</span><span class="op" id="6571395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571399">CipherSuites</span><span class="op" id="6571411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571419">[</span><span class="op" id="6571420">]</span><span class="builtintype" id="6571421">uint16</span><span class="op" id="6571427">{</span><span class="ident" id="6571428">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="6571452">}</span><span class="op" id="6571453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571457">InsecureSkipVerify</span><span class="op" id="6571475">:</span>&nbsp;<span class="builtintype" id="6571477">true</span><span class="op" id="6571481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571485">ClientSessionCache</span><span class="op" id="6571503">:</span>&nbsp;<span class="ident" id="6571505">NewLRUClientSessionCache</span><span class="op" id="6571529">(</span><span class="num" id="6571530">32</span><span class="op" id="6571532">)</span><span class="op" id="6571533">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571540">testResumeState</span>&nbsp;<span class="op" id="6571556">:=</span>&nbsp;<span class="keyword" id="6571559">func</span><span class="op" id="6571563">(</span><span class="ident" id="6571564">test</span>&nbsp;<span class="builtintype" id="6571569">string</span><span class="op" id="6571575">,</span>&nbsp;<span class="ident" id="6571577">didResume</span>&nbsp;<span class="builtintype" id="6571587">bool</span><span class="op" id="6571591">)</span>&nbsp;<span class="op" id="6571593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571597">hs</span><span class="op" id="6571599">,</span>&nbsp;<span class="ident" id="6571601">err</span>&nbsp;<span class="op" id="6571605">:=</span>&nbsp;<span class="ident" id="6571608">testHandshake</span><span class="op" id="6571621">(</span><span class="ident" id="6571622">clientConfig</span><span class="op" id="6571634">,</span>&nbsp;<span class="ident" id="6571636">serverConfig</span><span class="op" id="6571648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571652">if</span>&nbsp;<span class="ident" id="6571655">err</span>&nbsp;<span class="op" id="6571659">!=</span>&nbsp;<span class="builtintype" id="6571662">nil</span>&nbsp;<span class="op" id="6571666">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571671">t</span><span class="op" id="6571672">.</span><span class="ident" id="6571673">Fatalf</span><span class="op" id="6571679">(</span><span class="string" id="6571680">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="6571706">,</span>&nbsp;<span class="ident" id="6571708">test</span><span class="op" id="6571712">,</span>&nbsp;<span class="ident" id="6571714">err</span><span class="op" id="6571717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571725">if</span>&nbsp;<span class="ident" id="6571728">hs</span><span class="op" id="6571730">.</span><span class="ident" id="6571731">DidResume</span>&nbsp;<span class="op" id="6571741">!=</span>&nbsp;<span class="ident" id="6571744">didResume</span>&nbsp;<span class="op" id="6571754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571759">t</span><span class="op" id="6571760">.</span><span class="ident" id="6571761">Fatalf</span><span class="op" id="6571767">(</span><span class="string" id="6571768">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="6571798">,</span>&nbsp;<span class="ident" id="6571800">test</span><span class="op" id="6571804">,</span>&nbsp;<span class="ident" id="6571806">hs</span><span class="op" id="6571808">.</span><span class="ident" id="6571809">DidResume</span><span class="op" id="6571818">,</span>&nbsp;<span class="ident" id="6571820">didResume</span><span class="op" id="6571829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571833">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6571836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571840">testResumeState</span><span class="op" id="6571855">(</span><span class="string" id="6571856">&#34;Handshake&#34;</span><span class="op" id="6571867">,</span>&nbsp;<span class="builtintype" id="6571869">false</span><span class="op" id="6571874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6571877">testResumeState</span><span class="op" id="6571892">(</span><span class="string" id="6571893">&#34;Resume&#34;</span><span class="op" id="6571901">,</span>&nbsp;<span class="builtintype" id="6571903">true</span><span class="op" id="6571907">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6571911">if</span>&nbsp;<span class="ident" id="6571914">_</span><span class="op" id="6571915">,</span>&nbsp;<span class="ident" id="6571917">err</span>&nbsp;<span class="op" id="6571921">:=</span>&nbsp;<span class="ident" id="6571924">io</span><span class="op" id="6571926">.</span><span class="ident" id="6571927">ReadFull</span><span class="op" id="6571935">(</span><span class="ident" id="6571936">serverConfig</span><span class="op" id="6571948">.</span><span class="ident" id="6571949">rand</span><span class="op" id="6571953">(</span><span class="op" id="6571954">)</span><span class="op" id="6571955">,</span>&nbsp;<span class="ident" id="6571957">serverConfig</span><span class="op" id="6571969">.</span><span class="ident" id="6571970">SessionTicketKey</span><span class="op" id="6571986">[</span><span class="op" id="6571987">:</span><span class="op" id="6571988">]</span><span class="op" id="6571989">)</span><span class="op" id="6571990">;</span>&nbsp;<span class="ident" id="6571992">err</span>&nbsp;<span class="op" id="6571996">!=</span>&nbsp;<span class="builtintype" id="6571999">nil</span>&nbsp;<span class="op" id="6572003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572007">t</span><span class="op" id="6572008">.</span><span class="ident" id="6572009">Fatalf</span><span class="op" id="6572015">(</span><span class="string" id="6572016">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="6572055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572061">testResumeState</span><span class="op" id="6572076">(</span><span class="string" id="6572077">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="6572102">,</span>&nbsp;<span class="builtintype" id="6572104">false</span><span class="op" id="6572109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572112">testResumeState</span><span class="op" id="6572127">(</span><span class="string" id="6572128">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="6572164">,</span>&nbsp;<span class="builtintype" id="6572166">true</span><span class="op" id="6572170">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572174">clientConfig</span><span class="op" id="6572186">.</span><span class="ident" id="6572187">CipherSuites</span>&nbsp;<span class="op" id="6572200">=</span>&nbsp;<span class="op" id="6572202">[</span><span class="op" id="6572203">]</span><span class="builtintype" id="6572204">uint16</span><span class="op" id="6572210">{</span><span class="ident" id="6572211">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="6572241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572244">testResumeState</span><span class="op" id="6572259">(</span><span class="string" id="6572260">&#34;DifferentCipherSuite&#34;</span><span class="op" id="6572282">,</span>&nbsp;<span class="builtintype" id="6572284">false</span><span class="op" id="6572289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572292">testResumeState</span><span class="op" id="6572307">(</span><span class="string" id="6572308">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="6572338">,</span>&nbsp;<span class="builtintype" id="6572340">true</span><span class="op" id="6572344">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572348">clientConfig</span><span class="op" id="6572360">.</span><span class="ident" id="6572361">ClientSessionCache</span>&nbsp;<span class="op" id="6572380">=</span>&nbsp;<span class="builtintype" id="6572382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572387">testResumeState</span><span class="op" id="6572402">(</span><span class="string" id="6572403">&#34;WithoutSessionCache&#34;</span><span class="op" id="6572424">,</span>&nbsp;<span class="builtintype" id="6572426">false</span><span class="op" id="6572431">)</span><br>
<span class="lineno"></span><span class="op" id="6572433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6572436">func</span>&nbsp;<span class="ident" id="6572441">TestLRUClientSessionCache</span><span class="op" id="6572466">(</span><span class="ident" id="6572467">t</span>&nbsp;<span class="op" id="6572469">*</span><span class="ident" id="6572470">testing</span><span class="op" id="6572477">.</span><span class="ident" id="6572478">T</span><span class="op" id="6572479">)</span>&nbsp;<span class="op" id="6572481">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6572484">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572520">cache</span>&nbsp;<span class="op" id="6572526">:=</span>&nbsp;<span class="ident" id="6572529">NewLRUClientSessionCache</span><span class="op" id="6572553">(</span><span class="num" id="6572554">4</span><span class="op" id="6572555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572558">cs</span>&nbsp;<span class="op" id="6572561">:=</span>&nbsp;<span class="builtinfunc" id="6572564">make</span><span class="op" id="6572568">(</span><span class="op" id="6572569">[</span><span class="op" id="6572570">]</span><span class="ident" id="6572571">ClientSessionState</span><span class="op" id="6572589">,</span>&nbsp;<span class="num" id="6572591">6</span><span class="op" id="6572592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572595">keys</span>&nbsp;<span class="op" id="6572600">:=</span>&nbsp;<span class="op" id="6572603">[</span><span class="op" id="6572604">]</span><span class="builtintype" id="6572605">string</span><span class="op" id="6572611">{</span><span class="string" id="6572612">&#34;0&#34;</span><span class="op" id="6572615">,</span>&nbsp;<span class="string" id="6572617">&#34;1&#34;</span><span class="op" id="6572620">,</span>&nbsp;<span class="string" id="6572622">&#34;2&#34;</span><span class="op" id="6572625">,</span>&nbsp;<span class="string" id="6572627">&#34;3&#34;</span><span class="op" id="6572630">,</span>&nbsp;<span class="string" id="6572632">&#34;4&#34;</span><span class="op" id="6572635">,</span>&nbsp;<span class="string" id="6572637">&#34;5&#34;</span><span class="op" id="6572640">,</span>&nbsp;<span class="string" id="6572642">&#34;6&#34;</span><span class="op" id="6572645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6572649">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572698">for</span>&nbsp;<span class="ident" id="6572702">i</span>&nbsp;<span class="op" id="6572704">:=</span>&nbsp;<span class="num" id="6572707">0</span><span class="op" id="6572708">;</span>&nbsp;<span class="ident" id="6572710">i</span>&nbsp;<span class="op" id="6572712">&lt;</span>&nbsp;<span class="num" id="6572714">4</span><span class="op" id="6572715">;</span>&nbsp;<span class="ident" id="6572717">i</span><span class="op" id="6572718">++</span>&nbsp;<span class="op" id="6572721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572725">cache</span><span class="op" id="6572730">.</span><span class="ident" id="6572731">Put</span><span class="op" id="6572734">(</span><span class="ident" id="6572735">keys</span><span class="op" id="6572739">[</span><span class="ident" id="6572740">i</span><span class="op" id="6572741">]</span><span class="op" id="6572742">,</span>&nbsp;<span class="op" id="6572744">&amp;</span><span class="ident" id="6572745">cs</span><span class="op" id="6572747">[</span><span class="ident" id="6572748">i</span><span class="op" id="6572749">]</span><span class="op" id="6572750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572756">for</span>&nbsp;<span class="ident" id="6572760">i</span>&nbsp;<span class="op" id="6572762">:=</span>&nbsp;<span class="num" id="6572765">0</span><span class="op" id="6572766">;</span>&nbsp;<span class="ident" id="6572768">i</span>&nbsp;<span class="op" id="6572770">&lt;</span>&nbsp;<span class="num" id="6572772">4</span><span class="op" id="6572773">;</span>&nbsp;<span class="ident" id="6572775">i</span><span class="op" id="6572776">++</span>&nbsp;<span class="op" id="6572779">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572783">if</span>&nbsp;<span class="ident" id="6572786">s</span><span class="op" id="6572787">,</span>&nbsp;<span class="ident" id="6572789">ok</span>&nbsp;<span class="op" id="6572792">:=</span>&nbsp;<span class="ident" id="6572795">cache</span><span class="op" id="6572800">.</span><span class="ident" id="6572801">Get</span><span class="op" id="6572804">(</span><span class="ident" id="6572805">keys</span><span class="op" id="6572809">[</span><span class="ident" id="6572810">i</span><span class="op" id="6572811">]</span><span class="op" id="6572812">)</span><span class="op" id="6572813">;</span>&nbsp;<span class="op" id="6572815">!</span><span class="ident" id="6572816">ok</span>&nbsp;<span class="op" id="6572819">||</span>&nbsp;<span class="ident" id="6572822">s</span>&nbsp;<span class="op" id="6572824">!=</span>&nbsp;<span class="op" id="6572827">&amp;</span><span class="ident" id="6572828">cs</span><span class="op" id="6572830">[</span><span class="ident" id="6572831">i</span><span class="op" id="6572832">]</span>&nbsp;<span class="op" id="6572834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6572839">t</span><span class="op" id="6572840">.</span><span class="ident" id="6572841">Fatalf</span><span class="op" id="6572847">(</span><span class="string" id="6572848">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6572895">,</span>&nbsp;<span class="ident" id="6572897">keys</span><span class="op" id="6572901">[</span><span class="ident" id="6572902">i</span><span class="op" id="6572903">]</span><span class="op" id="6572904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6572911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6572915">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6572979">for</span>&nbsp;<span class="ident" id="6572983">i</span>&nbsp;<span class="op" id="6572985">:=</span>&nbsp;<span class="num" id="6572988">4</span><span class="op" id="6572989">;</span>&nbsp;<span class="ident" id="6572991">i</span>&nbsp;<span class="op" id="6572993">&lt;</span>&nbsp;<span class="num" id="6572995">6</span><span class="op" id="6572996">;</span>&nbsp;<span class="ident" id="6572998">i</span><span class="op" id="6572999">++</span>&nbsp;<span class="op" id="6573002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573006">cache</span><span class="op" id="6573011">.</span><span class="ident" id="6573012">Put</span><span class="op" id="6573015">(</span><span class="ident" id="6573016">keys</span><span class="op" id="6573020">[</span><span class="ident" id="6573021">i</span><span class="op" id="6573022">]</span><span class="op" id="6573023">,</span>&nbsp;<span class="op" id="6573025">&amp;</span><span class="ident" id="6573026">cs</span><span class="op" id="6573028">[</span><span class="ident" id="6573029">i</span><span class="op" id="6573030">]</span><span class="op" id="6573031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573037">for</span>&nbsp;<span class="ident" id="6573041">i</span>&nbsp;<span class="op" id="6573043">:=</span>&nbsp;<span class="num" id="6573046">0</span><span class="op" id="6573047">;</span>&nbsp;<span class="ident" id="6573049">i</span>&nbsp;<span class="op" id="6573051">&lt;</span>&nbsp;<span class="num" id="6573053">2</span><span class="op" id="6573054">;</span>&nbsp;<span class="ident" id="6573056">i</span><span class="op" id="6573057">++</span>&nbsp;<span class="op" id="6573060">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573064">if</span>&nbsp;<span class="ident" id="6573067">s</span><span class="op" id="6573068">,</span>&nbsp;<span class="ident" id="6573070">ok</span>&nbsp;<span class="op" id="6573073">:=</span>&nbsp;<span class="ident" id="6573076">cache</span><span class="op" id="6573081">.</span><span class="ident" id="6573082">Get</span><span class="op" id="6573085">(</span><span class="ident" id="6573086">keys</span><span class="op" id="6573090">[</span><span class="ident" id="6573091">i</span><span class="op" id="6573092">]</span><span class="op" id="6573093">)</span><span class="op" id="6573094">;</span>&nbsp;<span class="ident" id="6573096">ok</span>&nbsp;<span class="op" id="6573099">||</span>&nbsp;<span class="ident" id="6573102">s</span>&nbsp;<span class="op" id="6573104">!=</span>&nbsp;<span class="builtintype" id="6573107">nil</span>&nbsp;<span class="op" id="6573111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573116">t</span><span class="op" id="6573117">.</span><span class="ident" id="6573118">Fatalf</span><span class="op" id="6573124">(</span><span class="string" id="6573125">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="6573168">,</span>&nbsp;<span class="ident" id="6573170">keys</span><span class="op" id="6573174">[</span><span class="ident" id="6573175">i</span><span class="op" id="6573176">]</span><span class="op" id="6573177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6573188">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573232">cache</span><span class="op" id="6573237">.</span><span class="ident" id="6573238">Get</span><span class="op" id="6573241">(</span><span class="ident" id="6573242">keys</span><span class="op" id="6573246">[</span><span class="num" id="6573247">2</span><span class="op" id="6573248">]</span><span class="op" id="6573249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573252">cache</span><span class="op" id="6573257">.</span><span class="ident" id="6573258">Put</span><span class="op" id="6573261">(</span><span class="ident" id="6573262">keys</span><span class="op" id="6573266">[</span><span class="num" id="6573267">0</span><span class="op" id="6573268">]</span><span class="op" id="6573269">,</span>&nbsp;<span class="op" id="6573271">&amp;</span><span class="ident" id="6573272">cs</span><span class="op" id="6573274">[</span><span class="num" id="6573275">0</span><span class="op" id="6573276">]</span><span class="op" id="6573277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573280">if</span>&nbsp;<span class="ident" id="6573283">s</span><span class="op" id="6573284">,</span>&nbsp;<span class="ident" id="6573286">ok</span>&nbsp;<span class="op" id="6573289">:=</span>&nbsp;<span class="ident" id="6573292">cache</span><span class="op" id="6573297">.</span><span class="ident" id="6573298">Get</span><span class="op" id="6573301">(</span><span class="ident" id="6573302">keys</span><span class="op" id="6573306">[</span><span class="num" id="6573307">3</span><span class="op" id="6573308">]</span><span class="op" id="6573309">)</span><span class="op" id="6573310">;</span>&nbsp;<span class="ident" id="6573312">ok</span>&nbsp;<span class="op" id="6573315">||</span>&nbsp;<span class="ident" id="6573318">s</span>&nbsp;<span class="op" id="6573320">!=</span>&nbsp;<span class="builtintype" id="6573323">nil</span>&nbsp;<span class="op" id="6573327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573331">t</span><span class="op" id="6573332">.</span><span class="ident" id="6573333">Fatalf</span><span class="op" id="6573339">(</span><span class="string" id="6573340">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="6573381">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6573388">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573417">cache</span><span class="op" id="6573422">.</span><span class="ident" id="6573423">Put</span><span class="op" id="6573426">(</span><span class="ident" id="6573427">keys</span><span class="op" id="6573431">[</span><span class="num" id="6573432">0</span><span class="op" id="6573433">]</span><span class="op" id="6573434">,</span>&nbsp;<span class="op" id="6573436">&amp;</span><span class="ident" id="6573437">cs</span><span class="op" id="6573439">[</span><span class="num" id="6573440">3</span><span class="op" id="6573441">]</span><span class="op" id="6573442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573445">if</span>&nbsp;<span class="ident" id="6573448">s</span><span class="op" id="6573449">,</span>&nbsp;<span class="ident" id="6573451">ok</span>&nbsp;<span class="op" id="6573454">:=</span>&nbsp;<span class="ident" id="6573457">cache</span><span class="op" id="6573462">.</span><span class="ident" id="6573463">Get</span><span class="op" id="6573466">(</span><span class="ident" id="6573467">keys</span><span class="op" id="6573471">[</span><span class="num" id="6573472">0</span><span class="op" id="6573473">]</span><span class="op" id="6573474">)</span><span class="op" id="6573475">;</span>&nbsp;<span class="op" id="6573477">!</span><span class="ident" id="6573478">ok</span>&nbsp;<span class="op" id="6573481">||</span>&nbsp;<span class="ident" id="6573484">s</span>&nbsp;<span class="op" id="6573486">!=</span>&nbsp;<span class="op" id="6573489">&amp;</span><span class="ident" id="6573490">cs</span><span class="op" id="6573492">[</span><span class="num" id="6573493">3</span><span class="op" id="6573494">]</span>&nbsp;<span class="op" id="6573496">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573500">t</span><span class="op" id="6573501">.</span><span class="ident" id="6573502">Fatalf</span><span class="op" id="6573508">(</span><span class="string" id="6573509">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="6573548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6573555">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573588">cache</span><span class="op" id="6573593">.</span><span class="ident" id="6573594">Put</span><span class="op" id="6573597">(</span><span class="ident" id="6573598">keys</span><span class="op" id="6573602">[</span><span class="num" id="6573603">0</span><span class="op" id="6573604">]</span><span class="op" id="6573605">,</span>&nbsp;<span class="builtintype" id="6573607">nil</span><span class="op" id="6573610">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6573613">if</span>&nbsp;<span class="ident" id="6573616">s</span><span class="op" id="6573617">,</span>&nbsp;<span class="ident" id="6573619">ok</span>&nbsp;<span class="op" id="6573622">:=</span>&nbsp;<span class="ident" id="6573625">cache</span><span class="op" id="6573630">.</span><span class="ident" id="6573631">Get</span><span class="op" id="6573634">(</span><span class="ident" id="6573635">keys</span><span class="op" id="6573639">[</span><span class="num" id="6573640">0</span><span class="op" id="6573641">]</span><span class="op" id="6573642">)</span><span class="op" id="6573643">;</span>&nbsp;<span class="op" id="6573645">!</span><span class="ident" id="6573646">ok</span>&nbsp;<span class="op" id="6573649">||</span>&nbsp;<span class="ident" id="6573652">s</span>&nbsp;<span class="op" id="6573654">!=</span>&nbsp;<span class="builtintype" id="6573657">nil</span>&nbsp;<span class="op" id="6573661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573665">t</span><span class="op" id="6573666">.</span><span class="ident" id="6573667">Fatalf</span><span class="op" id="6573673">(</span><span class="string" id="6573674">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="6573708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6573711">}</span><br>
<span class="lineno"></span><span class="op" id="6573713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="6573716">func</span>&nbsp;<span class="ident" id="6573721">TestHandshakeClientALPNMatch</span><span class="op" id="6573749">(</span><span class="ident" id="6573750">t</span>&nbsp;<span class="op" id="6573752">*</span><span class="ident" id="6573753">testing</span><span class="op" id="6573760">.</span><span class="ident" id="6573761">T</span><span class="op" id="6573762">)</span>&nbsp;<span class="op" id="6573764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573767">config</span>&nbsp;<span class="op" id="6573774">:=</span>&nbsp;<span class="op" id="6573777">*</span><span class="ident" id="6573778">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573790">config</span><span class="op" id="6573796">.</span><span class="ident" id="6573797">NextProtos</span>&nbsp;<span class="op" id="6573808">=</span>&nbsp;<span class="op" id="6573810">[</span><span class="op" id="6573811">]</span><span class="builtintype" id="6573812">string</span><span class="op" id="6573818">{</span><span class="string" id="6573819">&#34;proto2&#34;</span><span class="op" id="6573827">,</span>&nbsp;<span class="string" id="6573829">&#34;proto1&#34;</span><span class="op" id="6573837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573841">test</span>&nbsp;<span class="op" id="6573846">:=</span>&nbsp;<span class="op" id="6573849">&amp;</span><span class="ident" id="6573850">clientTest</span><span class="op" id="6573860">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573864">name</span><span class="op" id="6573868">:</span>&nbsp;<span class="string" id="6573870">&#34;ALPN&#34;</span><span class="op" id="6573876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6573880">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6573946">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6573989">command</span><span class="op" id="6573996">:</span>&nbsp;<span class="op" id="6573998">[</span><span class="op" id="6573999">]</span><span class="builtintype" id="6574000">string</span><span class="op" id="6574006">{</span><span class="string" id="6574007">&#34;openssl&#34;</span><span class="op" id="6574016">,</span>&nbsp;<span class="string" id="6574018">&#34;s_server&#34;</span><span class="op" id="6574028">,</span>&nbsp;<span class="string" id="6574030">&#34;-alpn&#34;</span><span class="op" id="6574037">,</span>&nbsp;<span class="string" id="6574039">&#34;proto1,proto2&#34;</span><span class="op" id="6574054">}</span><span class="op" id="6574055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574059">config</span><span class="op" id="6574065">:</span>&nbsp;&nbsp;<span class="op" id="6574068">&amp;</span><span class="ident" id="6574069">config</span><span class="op" id="6574075">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574079">validate</span><span class="op" id="6574087">:</span>&nbsp;<span class="keyword" id="6574089">func</span><span class="op" id="6574093">(</span><span class="ident" id="6574094">state</span>&nbsp;<span class="ident" id="6574100">ConnectionState</span><span class="op" id="6574115">)</span>&nbsp;<span class="builtintype" id="6574117">error</span>&nbsp;<span class="op" id="6574123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574128">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574187">if</span>&nbsp;<span class="ident" id="6574190">state</span><span class="op" id="6574195">.</span><span class="ident" id="6574196">NegotiatedProtocol</span>&nbsp;<span class="op" id="6574215">!=</span>&nbsp;<span class="string" id="6574218">&#34;proto1&#34;</span>&nbsp;<span class="op" id="6574227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574233">return</span>&nbsp;<span class="ident" id="6574240">fmt</span><span class="op" id="6574243">.</span><span class="ident" id="6574244">Errorf</span><span class="op" id="6574250">(</span><span class="string" id="6574251">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="6574283">,</span>&nbsp;<span class="ident" id="6574285">state</span><span class="op" id="6574290">.</span><span class="ident" id="6574291">NegotiatedProtocol</span><span class="op" id="6574309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574314">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574319">return</span>&nbsp;<span class="builtintype" id="6574326">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574332">}</span><span class="op" id="6574333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574339">runClientTestTLS12</span><span class="op" id="6574357">(</span><span class="ident" id="6574358">t</span><span class="op" id="6574359">,</span>&nbsp;<span class="ident" id="6574361">test</span><span class="op" id="6574365">)</span><br>
<span class="lineno"></span><span class="op" id="6574367">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="6574370">func</span>&nbsp;<span class="ident" id="6574375">TestHandshakeClientALPNNoMatch</span><span class="op" id="6574405">(</span><span class="ident" id="6574406">t</span>&nbsp;<span class="op" id="6574408">*</span><span class="ident" id="6574409">testing</span><span class="op" id="6574416">.</span><span class="ident" id="6574417">T</span><span class="op" id="6574418">)</span>&nbsp;<span class="op" id="6574420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574423">config</span>&nbsp;<span class="op" id="6574430">:=</span>&nbsp;<span class="op" id="6574433">*</span><span class="ident" id="6574434">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574446">config</span><span class="op" id="6574452">.</span><span class="ident" id="6574453">NextProtos</span>&nbsp;<span class="op" id="6574464">=</span>&nbsp;<span class="op" id="6574466">[</span><span class="op" id="6574467">]</span><span class="builtintype" id="6574468">string</span><span class="op" id="6574474">{</span><span class="string" id="6574475">&#34;proto3&#34;</span><span class="op" id="6574483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574487">test</span>&nbsp;<span class="op" id="6574492">:=</span>&nbsp;<span class="op" id="6574495">&amp;</span><span class="ident" id="6574496">clientTest</span><span class="op" id="6574506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574510">name</span><span class="op" id="6574514">:</span>&nbsp;<span class="string" id="6574516">&#34;ALPN-NoMatch&#34;</span><span class="op" id="6574530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574534">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574600">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574643">command</span><span class="op" id="6574650">:</span>&nbsp;<span class="op" id="6574652">[</span><span class="op" id="6574653">]</span><span class="builtintype" id="6574654">string</span><span class="op" id="6574660">{</span><span class="string" id="6574661">&#34;openssl&#34;</span><span class="op" id="6574670">,</span>&nbsp;<span class="string" id="6574672">&#34;s_server&#34;</span><span class="op" id="6574682">,</span>&nbsp;<span class="string" id="6574684">&#34;-alpn&#34;</span><span class="op" id="6574691">,</span>&nbsp;<span class="string" id="6574693">&#34;proto1,proto2&#34;</span><span class="op" id="6574708">}</span><span class="op" id="6574709">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574713">config</span><span class="op" id="6574719">:</span>&nbsp;&nbsp;<span class="op" id="6574722">&amp;</span><span class="ident" id="6574723">config</span><span class="op" id="6574729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574733">validate</span><span class="op" id="6574741">:</span>&nbsp;<span class="keyword" id="6574743">func</span><span class="op" id="6574747">(</span><span class="ident" id="6574748">state</span>&nbsp;<span class="ident" id="6574754">ConnectionState</span><span class="op" id="6574769">)</span>&nbsp;<span class="builtintype" id="6574771">error</span>&nbsp;<span class="op" id="6574777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6574782">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574846">if</span>&nbsp;<span class="ident" id="6574849">state</span><span class="op" id="6574854">.</span><span class="ident" id="6574855">NegotiatedProtocol</span>&nbsp;<span class="op" id="6574874">!=</span>&nbsp;<span class="string" id="6574877">&#34;&#34;</span>&nbsp;<span class="op" id="6574880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574886">return</span>&nbsp;<span class="ident" id="6574893">fmt</span><span class="op" id="6574896">.</span><span class="ident" id="6574897">Errorf</span><span class="op" id="6574903">(</span><span class="string" id="6574904">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="6574932">,</span>&nbsp;<span class="ident" id="6574934">state</span><span class="op" id="6574939">.</span><span class="ident" id="6574940">NegotiatedProtocol</span><span class="op" id="6574958">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6574968">return</span>&nbsp;<span class="builtintype" id="6574975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574981">}</span><span class="op" id="6574982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6574985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6574988">runClientTestTLS12</span><span class="op" id="6575006">(</span><span class="ident" id="6575007">t</span><span class="op" id="6575008">,</span>&nbsp;<span class="ident" id="6575010">test</span><span class="op" id="6575014">)</span><br>
<span class="lineno">490</span><span class="op" id="6575016">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
