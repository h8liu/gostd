<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3590960">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3591015">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3591069">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3591120">package</span>&nbsp;<span class="ident" id="3591128">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3591133">import</span>&nbsp;<span class="op" id="3591140">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3591143">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3591152">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3591159">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3591171">&#34;sort&#34;</span><br>
<span class="lineno"></span><span class="op" id="3591178">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3591181">type</span>&nbsp;<span class="ident" id="3591186">byPos</span>&nbsp;<span class="op" id="3591192">[</span><span class="op" id="3591193">]</span><span class="op" id="3591194">*</span><span class="ident" id="3591195">CommentGroup</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3591209">func</span>&nbsp;<span class="op" id="3591214">(</span><span class="ident" id="3591215">a</span>&nbsp;<span class="ident" id="3591217">byPos</span><span class="op" id="3591222">)</span>&nbsp;<span class="ident" id="3591224">Len</span><span class="op" id="3591227">(</span><span class="op" id="3591228">)</span>&nbsp;<span class="builtintype" id="3591230">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3591244">{</span>&nbsp;<span class="keyword" id="3591246">return</span>&nbsp;<span class="builtinfunc" id="3591253">len</span><span class="op" id="3591256">(</span><span class="ident" id="3591257">a</span><span class="op" id="3591258">)</span>&nbsp;<span class="op" id="3591260">}</span><br>
<span class="lineno"></span><span class="keyword" id="3591262">func</span>&nbsp;<span class="op" id="3591267">(</span><span class="ident" id="3591268">a</span>&nbsp;<span class="ident" id="3591270">byPos</span><span class="op" id="3591275">)</span>&nbsp;<span class="ident" id="3591277">Less</span><span class="op" id="3591281">(</span><span class="ident" id="3591282">i</span><span class="op" id="3591283">,</span>&nbsp;<span class="ident" id="3591285">j</span>&nbsp;<span class="builtintype" id="3591287">int</span><span class="op" id="3591290">)</span>&nbsp;<span class="builtintype" id="3591292">bool</span>&nbsp;<span class="op" id="3591297">{</span>&nbsp;<span class="keyword" id="3591299">return</span>&nbsp;<span class="ident" id="3591306">a</span><span class="op" id="3591307">[</span><span class="ident" id="3591308">i</span><span class="op" id="3591309">]</span><span class="op" id="3591310">.</span><span class="ident" id="3591311">Pos</span><span class="op" id="3591314">(</span><span class="op" id="3591315">)</span>&nbsp;<span class="op" id="3591317">&lt;</span>&nbsp;<span class="ident" id="3591319">a</span><span class="op" id="3591320">[</span><span class="ident" id="3591321">j</span><span class="op" id="3591322">]</span><span class="op" id="3591323">.</span><span class="ident" id="3591324">Pos</span><span class="op" id="3591327">(</span><span class="op" id="3591328">)</span>&nbsp;<span class="op" id="3591330">}</span><br>
<span class="lineno"></span><span class="keyword" id="3591332">func</span>&nbsp;<span class="op" id="3591337">(</span><span class="ident" id="3591338">a</span>&nbsp;<span class="ident" id="3591340">byPos</span><span class="op" id="3591345">)</span>&nbsp;<span class="ident" id="3591347">Swap</span><span class="op" id="3591351">(</span><span class="ident" id="3591352">i</span><span class="op" id="3591353">,</span>&nbsp;<span class="ident" id="3591355">j</span>&nbsp;<span class="builtintype" id="3591357">int</span><span class="op" id="3591360">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3591367">{</span>&nbsp;<span class="ident" id="3591369">a</span><span class="op" id="3591370">[</span><span class="ident" id="3591371">i</span><span class="op" id="3591372">]</span><span class="op" id="3591373">,</span>&nbsp;<span class="ident" id="3591375">a</span><span class="op" id="3591376">[</span><span class="ident" id="3591377">j</span><span class="op" id="3591378">]</span>&nbsp;<span class="op" id="3591380">=</span>&nbsp;<span class="ident" id="3591382">a</span><span class="op" id="3591383">[</span><span class="ident" id="3591384">j</span><span class="op" id="3591385">]</span><span class="op" id="3591386">,</span>&nbsp;<span class="ident" id="3591388">a</span><span class="op" id="3591389">[</span><span class="ident" id="3591390">i</span><span class="op" id="3591391">]</span>&nbsp;<span class="op" id="3591393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3591396">//&nbsp;sortComments&nbsp;sorts&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3591462">//</span><br>
<span class="lineno"></span><span class="keyword" id="3591465">func</span>&nbsp;<span class="ident" id="3591470">sortComments</span><span class="op" id="3591482">(</span><span class="ident" id="3591483">list</span>&nbsp;<span class="op" id="3591488">[</span><span class="op" id="3591489">]</span><span class="op" id="3591490">*</span><span class="ident" id="3591491">CommentGroup</span><span class="op" id="3591503">)</span>&nbsp;<span class="op" id="3591505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3591508">//&nbsp;TODO(gri):&nbsp;Does&nbsp;it&nbsp;make&nbsp;sense&nbsp;to&nbsp;check&nbsp;for&nbsp;sorted-ness</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3591567">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first&nbsp;(because&nbsp;we&nbsp;know&nbsp;that&nbsp;sorted-ness&nbsp;is</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3591625">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;likely)?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3591654">if</span>&nbsp;<span class="ident" id="3591657">orderedList</span>&nbsp;<span class="op" id="3591669">:=</span>&nbsp;<span class="ident" id="3591672">byPos</span><span class="op" id="3591677">(</span><span class="ident" id="3591678">list</span><span class="op" id="3591682">)</span><span class="op" id="3591683">;</span>&nbsp;<span class="op" id="3591685">!</span><span class="ident" id="3591686">sort</span><span class="op" id="3591690">.</span><span class="ident" id="3591691">IsSorted</span><span class="op" id="3591699">(</span><span class="ident" id="3591700">orderedList</span><span class="op" id="3591711">)</span>&nbsp;<span class="op" id="3591713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3591717">sort</span><span class="op" id="3591721">.</span><span class="ident" id="3591722">Sort</span><span class="op" id="3591726">(</span><span class="ident" id="3591727">orderedList</span><span class="op" id="3591738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3591741">}</span><br>
<span class="lineno"></span><span class="op" id="3591743">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3591746">//&nbsp;A&nbsp;CommentMap&nbsp;maps&nbsp;an&nbsp;AST&nbsp;node&nbsp;to&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3591807">//&nbsp;associated&nbsp;with&nbsp;it.&nbsp;See&nbsp;NewCommentMap&nbsp;for&nbsp;a&nbsp;description&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3591869">//&nbsp;the&nbsp;association.</span><br>
<span class="lineno"></span><span class="comment" id="3591889">//</span><br>
<span class="lineno">35</span><span class="keyword" id="3591892">type</span>&nbsp;<span class="ident" id="3591897">CommentMap</span>&nbsp;<span class="keyword" id="3591908">map</span><span class="op" id="3591911">[</span><span class="ident" id="3591912">Node</span><span class="op" id="3591916">]</span><span class="op" id="3591917">[</span><span class="op" id="3591918">]</span><span class="op" id="3591919">*</span><span class="ident" id="3591920">CommentGroup</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3591934">func</span>&nbsp;<span class="op" id="3591939">(</span><span class="ident" id="3591940">cmap</span>&nbsp;<span class="ident" id="3591945">CommentMap</span><span class="op" id="3591955">)</span>&nbsp;<span class="ident" id="3591957">addComment</span><span class="op" id="3591967">(</span><span class="ident" id="3591968">n</span>&nbsp;<span class="ident" id="3591970">Node</span><span class="op" id="3591974">,</span>&nbsp;<span class="ident" id="3591976">c</span>&nbsp;<span class="op" id="3591978">*</span><span class="ident" id="3591979">CommentGroup</span><span class="op" id="3591991">)</span>&nbsp;<span class="op" id="3591993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3591996">list</span>&nbsp;<span class="op" id="3592001">:=</span>&nbsp;<span class="ident" id="3592004">cmap</span><span class="op" id="3592008">[</span><span class="ident" id="3592009">n</span><span class="op" id="3592010">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592013">if</span>&nbsp;<span class="builtinfunc" id="3592016">len</span><span class="op" id="3592019">(</span><span class="ident" id="3592020">list</span><span class="op" id="3592024">)</span>&nbsp;<span class="op" id="3592026">==</span>&nbsp;<span class="num" id="3592029">0</span>&nbsp;<span class="op" id="3592031">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592035">list</span>&nbsp;<span class="op" id="3592040">=</span>&nbsp;<span class="op" id="3592042">[</span><span class="op" id="3592043">]</span><span class="op" id="3592044">*</span><span class="ident" id="3592045">CommentGroup</span><span class="op" id="3592057">{</span><span class="ident" id="3592058">c</span><span class="op" id="3592059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3592062">}</span>&nbsp;<span class="keyword" id="3592064">else</span>&nbsp;<span class="op" id="3592069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592073">list</span>&nbsp;<span class="op" id="3592078">=</span>&nbsp;<span class="builtinfunc" id="3592080">append</span><span class="op" id="3592086">(</span><span class="ident" id="3592087">list</span><span class="op" id="3592091">,</span>&nbsp;<span class="ident" id="3592093">c</span><span class="op" id="3592094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3592097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592100">cmap</span><span class="op" id="3592104">[</span><span class="ident" id="3592105">n</span><span class="op" id="3592106">]</span>&nbsp;<span class="op" id="3592108">=</span>&nbsp;<span class="ident" id="3592110">list</span><br>
<span class="lineno">45</span><span class="op" id="3592115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3592118">type</span>&nbsp;<span class="ident" id="3592123">byInterval</span>&nbsp;<span class="op" id="3592134">[</span><span class="op" id="3592135">]</span><span class="ident" id="3592136">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3592142">func</span>&nbsp;<span class="op" id="3592147">(</span><span class="ident" id="3592148">a</span>&nbsp;<span class="ident" id="3592150">byInterval</span><span class="op" id="3592160">)</span>&nbsp;<span class="ident" id="3592162">Len</span><span class="op" id="3592165">(</span><span class="op" id="3592166">)</span>&nbsp;<span class="builtintype" id="3592168">int</span>&nbsp;<span class="op" id="3592172">{</span>&nbsp;<span class="keyword" id="3592174">return</span>&nbsp;<span class="builtinfunc" id="3592181">len</span><span class="op" id="3592184">(</span><span class="ident" id="3592185">a</span><span class="op" id="3592186">)</span>&nbsp;<span class="op" id="3592188">}</span><br>
<span class="lineno">50</span><span class="keyword" id="3592190">func</span>&nbsp;<span class="op" id="3592195">(</span><span class="ident" id="3592196">a</span>&nbsp;<span class="ident" id="3592198">byInterval</span><span class="op" id="3592208">)</span>&nbsp;<span class="ident" id="3592210">Less</span><span class="op" id="3592214">(</span><span class="ident" id="3592215">i</span><span class="op" id="3592216">,</span>&nbsp;<span class="ident" id="3592218">j</span>&nbsp;<span class="builtintype" id="3592220">int</span><span class="op" id="3592223">)</span>&nbsp;<span class="builtintype" id="3592225">bool</span>&nbsp;<span class="op" id="3592230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592233">pi</span><span class="op" id="3592235">,</span>&nbsp;<span class="ident" id="3592237">pj</span>&nbsp;<span class="op" id="3592240">:=</span>&nbsp;<span class="ident" id="3592243">a</span><span class="op" id="3592244">[</span><span class="ident" id="3592245">i</span><span class="op" id="3592246">]</span><span class="op" id="3592247">.</span><span class="ident" id="3592248">Pos</span><span class="op" id="3592251">(</span><span class="op" id="3592252">)</span><span class="op" id="3592253">,</span>&nbsp;<span class="ident" id="3592255">a</span><span class="op" id="3592256">[</span><span class="ident" id="3592257">j</span><span class="op" id="3592258">]</span><span class="op" id="3592259">.</span><span class="ident" id="3592260">Pos</span><span class="op" id="3592263">(</span><span class="op" id="3592264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592267">return</span>&nbsp;<span class="ident" id="3592274">pi</span>&nbsp;<span class="op" id="3592277">&lt;</span>&nbsp;<span class="ident" id="3592279">pj</span>&nbsp;<span class="op" id="3592282">||</span>&nbsp;<span class="ident" id="3592285">pi</span>&nbsp;<span class="op" id="3592288">==</span>&nbsp;<span class="ident" id="3592291">pj</span>&nbsp;<span class="op" id="3592294">&amp;&amp;</span>&nbsp;<span class="ident" id="3592297">a</span><span class="op" id="3592298">[</span><span class="ident" id="3592299">i</span><span class="op" id="3592300">]</span><span class="op" id="3592301">.</span><span class="ident" id="3592302">End</span><span class="op" id="3592305">(</span><span class="op" id="3592306">)</span>&nbsp;<span class="op" id="3592308">&gt;</span>&nbsp;<span class="ident" id="3592310">a</span><span class="op" id="3592311">[</span><span class="ident" id="3592312">j</span><span class="op" id="3592313">]</span><span class="op" id="3592314">.</span><span class="ident" id="3592315">End</span><span class="op" id="3592318">(</span><span class="op" id="3592319">)</span><br>
<span class="lineno"></span><span class="op" id="3592321">}</span><br>
<span class="lineno"></span><span class="keyword" id="3592323">func</span>&nbsp;<span class="op" id="3592328">(</span><span class="ident" id="3592329">a</span>&nbsp;<span class="ident" id="3592331">byInterval</span><span class="op" id="3592341">)</span>&nbsp;<span class="ident" id="3592343">Swap</span><span class="op" id="3592347">(</span><span class="ident" id="3592348">i</span><span class="op" id="3592349">,</span>&nbsp;<span class="ident" id="3592351">j</span>&nbsp;<span class="builtintype" id="3592353">int</span><span class="op" id="3592356">)</span>&nbsp;<span class="op" id="3592358">{</span>&nbsp;<span class="ident" id="3592360">a</span><span class="op" id="3592361">[</span><span class="ident" id="3592362">i</span><span class="op" id="3592363">]</span><span class="op" id="3592364">,</span>&nbsp;<span class="ident" id="3592366">a</span><span class="op" id="3592367">[</span><span class="ident" id="3592368">j</span><span class="op" id="3592369">]</span>&nbsp;<span class="op" id="3592371">=</span>&nbsp;<span class="ident" id="3592373">a</span><span class="op" id="3592374">[</span><span class="ident" id="3592375">j</span><span class="op" id="3592376">]</span><span class="op" id="3592377">,</span>&nbsp;<span class="ident" id="3592379">a</span><span class="op" id="3592380">[</span><span class="ident" id="3592381">i</span><span class="op" id="3592382">]</span>&nbsp;<span class="op" id="3592384">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3592387">//&nbsp;nodeList&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;n&nbsp;in&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3592455">//</span><br>
<span class="lineno"></span><span class="keyword" id="3592458">func</span>&nbsp;<span class="ident" id="3592463">nodeList</span><span class="op" id="3592471">(</span><span class="ident" id="3592472">n</span>&nbsp;<span class="ident" id="3592474">Node</span><span class="op" id="3592478">)</span>&nbsp;<span class="op" id="3592480">[</span><span class="op" id="3592481">]</span><span class="ident" id="3592482">Node</span>&nbsp;<span class="op" id="3592487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592490">var</span>&nbsp;<span class="ident" id="3592494">list</span>&nbsp;<span class="op" id="3592499">[</span><span class="op" id="3592500">]</span><span class="ident" id="3592501">Node</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592507">Inspect</span><span class="op" id="3592514">(</span><span class="ident" id="3592515">n</span><span class="op" id="3592516">,</span>&nbsp;<span class="keyword" id="3592518">func</span><span class="op" id="3592522">(</span><span class="ident" id="3592523">n</span>&nbsp;<span class="ident" id="3592525">Node</span><span class="op" id="3592529">)</span>&nbsp;<span class="builtintype" id="3592531">bool</span>&nbsp;<span class="op" id="3592536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592540">//&nbsp;don&#39;t&nbsp;collect&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592568">switch</span>&nbsp;<span class="ident" id="3592575">n</span><span class="op" id="3592576">.</span><span class="op" id="3592577">(</span><span class="keyword" id="3592578">type</span><span class="op" id="3592582">)</span>&nbsp;<span class="op" id="3592584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592588">case</span>&nbsp;<span class="ident" id="3592593">nil</span><span class="op" id="3592596">,</span>&nbsp;<span class="op" id="3592598">*</span><span class="ident" id="3592599">CommentGroup</span><span class="op" id="3592611">,</span>&nbsp;<span class="op" id="3592613">*</span><span class="ident" id="3592614">Comment</span><span class="op" id="3592621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592626">return</span>&nbsp;<span class="builtintype" id="3592633">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3592641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3592645">list</span>&nbsp;<span class="op" id="3592650">=</span>&nbsp;<span class="builtinfunc" id="3592652">append</span><span class="op" id="3592658">(</span><span class="ident" id="3592659">list</span><span class="op" id="3592663">,</span>&nbsp;<span class="ident" id="3592665">n</span><span class="op" id="3592666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592670">return</span>&nbsp;<span class="builtintype" id="3592677">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3592683">}</span><span class="op" id="3592684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592687">//&nbsp;Note:&nbsp;The&nbsp;current&nbsp;implementation&nbsp;assumes&nbsp;that&nbsp;Inspect&nbsp;traverses&nbsp;the</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592759">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AST&nbsp;in&nbsp;depth-first&nbsp;and&nbsp;thus&nbsp;_source_&nbsp;order.&nbsp;If&nbsp;AST&nbsp;traversal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592830">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;does&nbsp;not&nbsp;follow&nbsp;source&nbsp;order,&nbsp;the&nbsp;sorting&nbsp;call&nbsp;below&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592901">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3592921">//&nbsp;sort.Sort(byInterval(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3592953">return</span>&nbsp;<span class="ident" id="3592960">list</span><br>
<span class="lineno">75</span><span class="op" id="3592965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3592968">//&nbsp;A&nbsp;commentListReader&nbsp;helps&nbsp;iterating&nbsp;through&nbsp;a&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups.</span><br>
<span class="lineno"></span><span class="comment" id="3593041">//</span><br>
<span class="lineno"></span><span class="keyword" id="3593044">type</span>&nbsp;<span class="ident" id="3593049">commentListReader</span>&nbsp;<span class="keyword" id="3593067">struct</span>&nbsp;<span class="op" id="3593074">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593077">fset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3593086">*</span><span class="ident" id="3593087">token</span><span class="op" id="3593092">.</span><span class="ident" id="3593093">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593102">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3593111">[</span><span class="op" id="3593112">]</span><span class="op" id="3593113">*</span><span class="ident" id="3593114">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593128">index</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3593137">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593142">comment</span>&nbsp;&nbsp;<span class="op" id="3593151">*</span><span class="ident" id="3593152">CommentGroup</span>&nbsp;&nbsp;<span class="comment" id="3593166">//&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593201">pos</span><span class="op" id="3593204">,</span>&nbsp;<span class="ident" id="3593206">end</span>&nbsp;<span class="ident" id="3593210">token</span><span class="op" id="3593215">.</span><span class="ident" id="3593216">Position</span>&nbsp;<span class="comment" id="3593225">//&nbsp;source&nbsp;interval&nbsp;of&nbsp;comment&nbsp;group&nbsp;at&nbsp;current&nbsp;index</span><br>
<span class="lineno">85</span><span class="op" id="3593278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3593281">func</span>&nbsp;<span class="op" id="3593286">(</span><span class="ident" id="3593287">r</span>&nbsp;<span class="op" id="3593289">*</span><span class="ident" id="3593290">commentListReader</span><span class="op" id="3593307">)</span>&nbsp;<span class="ident" id="3593309">eol</span><span class="op" id="3593312">(</span><span class="op" id="3593313">)</span>&nbsp;<span class="builtintype" id="3593315">bool</span>&nbsp;<span class="op" id="3593320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593323">return</span>&nbsp;<span class="ident" id="3593330">r</span><span class="op" id="3593331">.</span><span class="ident" id="3593332">index</span>&nbsp;<span class="op" id="3593338">&gt;=</span>&nbsp;<span class="builtinfunc" id="3593341">len</span><span class="op" id="3593344">(</span><span class="ident" id="3593345">r</span><span class="op" id="3593346">.</span><span class="ident" id="3593347">list</span><span class="op" id="3593351">)</span><br>
<span class="lineno"></span><span class="op" id="3593353">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3593356">func</span>&nbsp;<span class="op" id="3593361">(</span><span class="ident" id="3593362">r</span>&nbsp;<span class="op" id="3593364">*</span><span class="ident" id="3593365">commentListReader</span><span class="op" id="3593382">)</span>&nbsp;<span class="ident" id="3593384">next</span><span class="op" id="3593388">(</span><span class="op" id="3593389">)</span>&nbsp;<span class="op" id="3593391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3593394">if</span>&nbsp;<span class="op" id="3593397">!</span><span class="ident" id="3593398">r</span><span class="op" id="3593399">.</span><span class="ident" id="3593400">eol</span><span class="op" id="3593403">(</span><span class="op" id="3593404">)</span>&nbsp;<span class="op" id="3593406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593410">r</span><span class="op" id="3593411">.</span><span class="ident" id="3593412">comment</span>&nbsp;<span class="op" id="3593420">=</span>&nbsp;<span class="ident" id="3593422">r</span><span class="op" id="3593423">.</span><span class="ident" id="3593424">list</span><span class="op" id="3593428">[</span><span class="ident" id="3593429">r</span><span class="op" id="3593430">.</span><span class="ident" id="3593431">index</span><span class="op" id="3593436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593440">r</span><span class="op" id="3593441">.</span><span class="ident" id="3593442">pos</span>&nbsp;<span class="op" id="3593446">=</span>&nbsp;<span class="ident" id="3593448">r</span><span class="op" id="3593449">.</span><span class="ident" id="3593450">fset</span><span class="op" id="3593454">.</span><span class="ident" id="3593455">Position</span><span class="op" id="3593463">(</span><span class="ident" id="3593464">r</span><span class="op" id="3593465">.</span><span class="ident" id="3593466">comment</span><span class="op" id="3593473">.</span><span class="ident" id="3593474">Pos</span><span class="op" id="3593477">(</span><span class="op" id="3593478">)</span><span class="op" id="3593479">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593483">r</span><span class="op" id="3593484">.</span><span class="ident" id="3593485">end</span>&nbsp;<span class="op" id="3593489">=</span>&nbsp;<span class="ident" id="3593491">r</span><span class="op" id="3593492">.</span><span class="ident" id="3593493">fset</span><span class="op" id="3593497">.</span><span class="ident" id="3593498">Position</span><span class="op" id="3593506">(</span><span class="ident" id="3593507">r</span><span class="op" id="3593508">.</span><span class="ident" id="3593509">comment</span><span class="op" id="3593516">.</span><span class="ident" id="3593517">End</span><span class="op" id="3593520">(</span><span class="op" id="3593521">)</span><span class="op" id="3593522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593526">r</span><span class="op" id="3593527">.</span><span class="ident" id="3593528">index</span><span class="op" id="3593533">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593537">}</span><br>
<span class="lineno"></span><span class="op" id="3593539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="3593542">//&nbsp;A&nbsp;nodeStack&nbsp;keeps&nbsp;track&nbsp;of&nbsp;nested&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="3593586">//&nbsp;A&nbsp;node&nbsp;lower&nbsp;on&nbsp;the&nbsp;stack&nbsp;lexically&nbsp;contains&nbsp;the&nbsp;nodes&nbsp;higher&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3593665">//</span><br>
<span class="lineno"></span><span class="keyword" id="3593668">type</span>&nbsp;<span class="ident" id="3593673">nodeStack</span>&nbsp;<span class="op" id="3593683">[</span><span class="op" id="3593684">]</span><span class="ident" id="3593685">Node</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3593691">//&nbsp;push&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3593745">//&nbsp;and&nbsp;then&nbsp;pushes&nbsp;n&nbsp;on&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="3593780">//</span><br>
<span class="lineno"></span><span class="keyword" id="3593783">func</span>&nbsp;<span class="op" id="3593788">(</span><span class="ident" id="3593789">s</span>&nbsp;<span class="op" id="3593791">*</span><span class="ident" id="3593792">nodeStack</span><span class="op" id="3593801">)</span>&nbsp;<span class="ident" id="3593803">push</span><span class="op" id="3593807">(</span><span class="ident" id="3593808">n</span>&nbsp;<span class="ident" id="3593810">Node</span><span class="op" id="3593814">)</span>&nbsp;<span class="op" id="3593816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3593819">s</span><span class="op" id="3593820">.</span><span class="ident" id="3593821">pop</span><span class="op" id="3593824">(</span><span class="ident" id="3593825">n</span><span class="op" id="3593826">.</span><span class="ident" id="3593827">Pos</span><span class="op" id="3593830">(</span><span class="op" id="3593831">)</span><span class="op" id="3593832">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3593835">*</span><span class="ident" id="3593836">s</span>&nbsp;<span class="op" id="3593838">=</span>&nbsp;<span class="builtinfunc" id="3593840">append</span><span class="op" id="3593846">(</span><span class="op" id="3593847">(</span><span class="op" id="3593848">*</span><span class="ident" id="3593849">s</span><span class="op" id="3593850">)</span><span class="op" id="3593851">,</span>&nbsp;<span class="ident" id="3593853">n</span><span class="op" id="3593854">)</span><br>
<span class="lineno"></span><span class="op" id="3593856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3593859">//&nbsp;pop&nbsp;pops&nbsp;all&nbsp;nodes&nbsp;that&nbsp;appear&nbsp;lexically&nbsp;before&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="3593914">//&nbsp;(i.e.,&nbsp;whose&nbsp;lexical&nbsp;extent&nbsp;has&nbsp;ended&nbsp;before&nbsp;or&nbsp;at&nbsp;pos).</span><br>
<span class="lineno">115</span><span class="comment" id="3593974">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;last&nbsp;node&nbsp;popped.</span><br>
<span class="lineno"></span><span class="comment" id="3594010">//</span><br>
<span class="lineno"></span><span class="keyword" id="3594013">func</span>&nbsp;<span class="op" id="3594018">(</span><span class="ident" id="3594019">s</span>&nbsp;<span class="op" id="3594021">*</span><span class="ident" id="3594022">nodeStack</span><span class="op" id="3594031">)</span>&nbsp;<span class="ident" id="3594033">pop</span><span class="op" id="3594036">(</span><span class="ident" id="3594037">pos</span>&nbsp;<span class="ident" id="3594041">token</span><span class="op" id="3594046">.</span><span class="ident" id="3594047">Pos</span><span class="op" id="3594050">)</span>&nbsp;<span class="op" id="3594052">(</span><span class="ident" id="3594053">top</span>&nbsp;<span class="ident" id="3594057">Node</span><span class="op" id="3594061">)</span>&nbsp;<span class="op" id="3594063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594066">i</span>&nbsp;<span class="op" id="3594068">:=</span>&nbsp;<span class="builtinfunc" id="3594071">len</span><span class="op" id="3594074">(</span><span class="op" id="3594075">*</span><span class="ident" id="3594076">s</span><span class="op" id="3594077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3594080">for</span>&nbsp;<span class="ident" id="3594084">i</span>&nbsp;<span class="op" id="3594086">&gt;</span>&nbsp;<span class="num" id="3594088">0</span>&nbsp;<span class="op" id="3594090">&amp;&amp;</span>&nbsp;<span class="op" id="3594093">(</span><span class="op" id="3594094">*</span><span class="ident" id="3594095">s</span><span class="op" id="3594096">)</span><span class="op" id="3594097">[</span><span class="ident" id="3594098">i</span><span class="op" id="3594099">-</span><span class="num" id="3594100">1</span><span class="op" id="3594101">]</span><span class="op" id="3594102">.</span><span class="ident" id="3594103">End</span><span class="op" id="3594106">(</span><span class="op" id="3594107">)</span>&nbsp;<span class="op" id="3594109">&lt;=</span>&nbsp;<span class="ident" id="3594112">pos</span>&nbsp;<span class="op" id="3594116">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594120">top</span>&nbsp;<span class="op" id="3594124">=</span>&nbsp;<span class="op" id="3594126">(</span><span class="op" id="3594127">*</span><span class="ident" id="3594128">s</span><span class="op" id="3594129">)</span><span class="op" id="3594130">[</span><span class="ident" id="3594131">i</span><span class="op" id="3594132">-</span><span class="num" id="3594133">1</span><span class="op" id="3594134">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3594138">i</span><span class="op" id="3594139">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3594143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3594146">*</span><span class="ident" id="3594147">s</span>&nbsp;<span class="op" id="3594149">=</span>&nbsp;<span class="op" id="3594151">(</span><span class="op" id="3594152">*</span><span class="ident" id="3594153">s</span><span class="op" id="3594154">)</span><span class="op" id="3594155">[</span><span class="num" id="3594156">0</span><span class="op" id="3594157">:</span><span class="ident" id="3594158">i</span><span class="op" id="3594159">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3594162">return</span>&nbsp;<span class="ident" id="3594169">top</span><br>
<span class="lineno">125</span><span class="op" id="3594173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3594176">//&nbsp;NewCommentMap&nbsp;creates&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;by&nbsp;associating&nbsp;comment&nbsp;groups</span><br>
<span class="lineno"></span><span class="comment" id="3594249">//&nbsp;of&nbsp;the&nbsp;comments&nbsp;list&nbsp;with&nbsp;the&nbsp;nodes&nbsp;of&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3594318">//</span><br>
<span class="lineno">130</span><span class="comment" id="3594321">//&nbsp;A&nbsp;comment&nbsp;group&nbsp;g&nbsp;is&nbsp;associated&nbsp;with&nbsp;a&nbsp;node&nbsp;n&nbsp;if:</span><br>
<span class="lineno"></span><span class="comment" id="3594374">//</span><br>
<span class="lineno"></span><span class="comment" id="3594377">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;same&nbsp;line&nbsp;as&nbsp;n&nbsp;ends</span><br>
<span class="lineno"></span><span class="comment" id="3594420">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;following&nbsp;n,&nbsp;and&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3594486">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;least&nbsp;one&nbsp;empty&nbsp;line&nbsp;after&nbsp;g&nbsp;and&nbsp;before&nbsp;the&nbsp;next&nbsp;node</span><br>
<span class="lineno">135</span><span class="comment" id="3594550">//&nbsp;&nbsp;&nbsp;-&nbsp;g&nbsp;starts&nbsp;before&nbsp;n&nbsp;and&nbsp;is&nbsp;not&nbsp;associated&nbsp;to&nbsp;the&nbsp;node&nbsp;before&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3594618">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via&nbsp;the&nbsp;previous&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3594648">//</span><br>
<span class="lineno"></span><span class="comment" id="3594651">//&nbsp;NewCommentMap&nbsp;tries&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;&#34;largest&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3594720">//&nbsp;node&nbsp;possible:&nbsp;For&nbsp;instance,&nbsp;if&nbsp;the&nbsp;comment&nbsp;is&nbsp;a&nbsp;line&nbsp;comment</span><br>
<span class="lineno">140</span><span class="comment" id="3594785">//&nbsp;trailing&nbsp;an&nbsp;assignment,&nbsp;the&nbsp;comment&nbsp;is&nbsp;associated&nbsp;with&nbsp;the&nbsp;entire</span><br>
<span class="lineno"></span><span class="comment" id="3594854">//&nbsp;assignment&nbsp;rather&nbsp;than&nbsp;just&nbsp;the&nbsp;last&nbsp;operand&nbsp;in&nbsp;the&nbsp;assignment.</span><br>
<span class="lineno"></span><span class="comment" id="3594921">//</span><br>
<span class="lineno"></span><span class="keyword" id="3594924">func</span>&nbsp;<span class="ident" id="3594929">NewCommentMap</span><span class="op" id="3594942">(</span><span class="ident" id="3594943">fset</span>&nbsp;<span class="op" id="3594948">*</span><span class="ident" id="3594949">token</span><span class="op" id="3594954">.</span><span class="ident" id="3594955">FileSet</span><span class="op" id="3594962">,</span>&nbsp;<span class="ident" id="3594964">node</span>&nbsp;<span class="ident" id="3594969">Node</span><span class="op" id="3594973">,</span>&nbsp;<span class="ident" id="3594975">comments</span>&nbsp;<span class="op" id="3594984">[</span><span class="op" id="3594985">]</span><span class="op" id="3594986">*</span><span class="ident" id="3594987">CommentGroup</span><span class="op" id="3594999">)</span>&nbsp;<span class="ident" id="3595001">CommentMap</span>&nbsp;<span class="op" id="3595012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595015">if</span>&nbsp;<span class="builtinfunc" id="3595018">len</span><span class="op" id="3595021">(</span><span class="ident" id="3595022">comments</span><span class="op" id="3595030">)</span>&nbsp;<span class="op" id="3595032">==</span>&nbsp;<span class="num" id="3595035">0</span>&nbsp;<span class="op" id="3595037">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595041">return</span>&nbsp;<span class="ident" id="3595048">nil</span>&nbsp;<span class="comment" id="3595052">//&nbsp;no&nbsp;comments&nbsp;to&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3595075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595079">cmap</span>&nbsp;<span class="op" id="3595084">:=</span>&nbsp;<span class="builtinfunc" id="3595087">make</span><span class="op" id="3595091">(</span><span class="ident" id="3595092">CommentMap</span><span class="op" id="3595102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3595106">//&nbsp;set&nbsp;up&nbsp;comment&nbsp;reader&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595134">tmp</span>&nbsp;<span class="op" id="3595138">:=</span>&nbsp;<span class="builtinfunc" id="3595141">make</span><span class="op" id="3595145">(</span><span class="op" id="3595146">[</span><span class="op" id="3595147">]</span><span class="op" id="3595148">*</span><span class="ident" id="3595149">CommentGroup</span><span class="op" id="3595161">,</span>&nbsp;<span class="builtinfunc" id="3595163">len</span><span class="op" id="3595166">(</span><span class="ident" id="3595167">comments</span><span class="op" id="3595175">)</span><span class="op" id="3595176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3595179">copy</span><span class="op" id="3595183">(</span><span class="ident" id="3595184">tmp</span><span class="op" id="3595187">,</span>&nbsp;<span class="ident" id="3595189">comments</span><span class="op" id="3595197">)</span>&nbsp;<span class="comment" id="3595199">//&nbsp;don&#39;t&nbsp;change&nbsp;incoming&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595234">sortComments</span><span class="op" id="3595246">(</span><span class="ident" id="3595247">tmp</span><span class="op" id="3595250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595253">r</span>&nbsp;<span class="op" id="3595255">:=</span>&nbsp;<span class="ident" id="3595258">commentListReader</span><span class="op" id="3595275">{</span><span class="ident" id="3595276">fset</span><span class="op" id="3595280">:</span>&nbsp;<span class="ident" id="3595282">fset</span><span class="op" id="3595286">,</span>&nbsp;<span class="ident" id="3595288">list</span><span class="op" id="3595292">:</span>&nbsp;<span class="ident" id="3595294">tmp</span><span class="op" id="3595297">}</span>&nbsp;<span class="comment" id="3595299">//&nbsp;!r.eol()&nbsp;because&nbsp;len(comments)&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595338">r</span><span class="op" id="3595339">.</span><span class="ident" id="3595340">next</span><span class="op" id="3595344">(</span><span class="op" id="3595345">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3595349">//&nbsp;create&nbsp;node&nbsp;list&nbsp;in&nbsp;lexical&nbsp;order</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595387">nodes</span>&nbsp;<span class="op" id="3595393">:=</span>&nbsp;<span class="ident" id="3595396">nodeList</span><span class="op" id="3595404">(</span><span class="ident" id="3595405">node</span><span class="op" id="3595409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595412">nodes</span>&nbsp;<span class="op" id="3595418">=</span>&nbsp;<span class="builtinfunc" id="3595420">append</span><span class="op" id="3595426">(</span><span class="ident" id="3595427">nodes</span><span class="op" id="3595432">,</span>&nbsp;<span class="ident" id="3595434">nil</span><span class="op" id="3595437">)</span>&nbsp;<span class="comment" id="3595439">//&nbsp;append&nbsp;sentinel</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3595460">//&nbsp;set&nbsp;up&nbsp;iteration&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595491">var</span>&nbsp;<span class="op" id="3595495">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595499">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595505">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3595520">//&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595539">pend</span>&nbsp;&nbsp;<span class="ident" id="3595545">token</span><span class="op" id="3595550">.</span><span class="ident" id="3595551">Position</span>&nbsp;<span class="comment" id="3595560">//&nbsp;end&nbsp;of&nbsp;p</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595574">pg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595580">Node</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3595595">//&nbsp;previous&nbsp;node&nbsp;group&nbsp;(enclosing&nbsp;nodes&nbsp;of&nbsp;&#34;importance&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595654">pgend</span>&nbsp;<span class="ident" id="3595660">token</span><span class="op" id="3595665">.</span><span class="ident" id="3595666">Position</span>&nbsp;<span class="comment" id="3595675">//&nbsp;end&nbsp;of&nbsp;pg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595690">stack</span>&nbsp;<span class="ident" id="3595696">nodeStack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3595711">//&nbsp;stack&nbsp;of&nbsp;node&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3595736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595740">for</span>&nbsp;<span class="ident" id="3595744">_</span><span class="op" id="3595745">,</span>&nbsp;<span class="ident" id="3595747">q</span>&nbsp;<span class="op" id="3595749">:=</span>&nbsp;<span class="keyword" id="3595752">range</span>&nbsp;<span class="ident" id="3595758">nodes</span>&nbsp;<span class="op" id="3595764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595768">var</span>&nbsp;<span class="ident" id="3595772">qpos</span>&nbsp;<span class="ident" id="3595777">token</span><span class="op" id="3595782">.</span><span class="ident" id="3595783">Position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595794">if</span>&nbsp;<span class="ident" id="3595797">q</span>&nbsp;<span class="op" id="3595799">!=</span>&nbsp;<span class="ident" id="3595802">nil</span>&nbsp;<span class="op" id="3595806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3595811">qpos</span>&nbsp;<span class="op" id="3595816">=</span>&nbsp;<span class="ident" id="3595818">fset</span><span class="op" id="3595822">.</span><span class="ident" id="3595823">Position</span><span class="op" id="3595831">(</span><span class="ident" id="3595832">q</span><span class="op" id="3595833">.</span><span class="ident" id="3595834">Pos</span><span class="op" id="3595837">(</span><span class="op" id="3595838">)</span><span class="op" id="3595839">)</span>&nbsp;<span class="comment" id="3595841">//&nbsp;current&nbsp;node&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3595868">}</span>&nbsp;<span class="keyword" id="3595870">else</span>&nbsp;<span class="op" id="3595875">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3595880">//&nbsp;set&nbsp;fake&nbsp;sentinel&nbsp;position&nbsp;to&nbsp;infinity&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3595933">//&nbsp;all&nbsp;comments&nbsp;get&nbsp;processed&nbsp;before&nbsp;the&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3595986">const</span>&nbsp;<span class="ident" id="3595992">infinity</span>&nbsp;<span class="op" id="3596001">=</span>&nbsp;<span class="num" id="3596003">1</span>&nbsp;<span class="op" id="3596005">&lt;&lt;</span>&nbsp;<span class="num" id="3596008">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596014">qpos</span><span class="op" id="3596018">.</span><span class="ident" id="3596019">Offset</span>&nbsp;<span class="op" id="3596026">=</span>&nbsp;<span class="ident" id="3596028">infinity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596040">qpos</span><span class="op" id="3596044">.</span><span class="ident" id="3596045">Line</span>&nbsp;<span class="op" id="3596050">=</span>&nbsp;<span class="ident" id="3596052">infinity</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3596063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596068">//&nbsp;process&nbsp;comments&nbsp;before&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596110">for</span>&nbsp;<span class="ident" id="3596114">r</span><span class="op" id="3596115">.</span><span class="ident" id="3596116">end</span><span class="op" id="3596119">.</span><span class="ident" id="3596120">Offset</span>&nbsp;<span class="op" id="3596127">&lt;=</span>&nbsp;<span class="ident" id="3596130">qpos</span><span class="op" id="3596134">.</span><span class="ident" id="3596135">Offset</span>&nbsp;<span class="op" id="3596142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596147">//&nbsp;determine&nbsp;recent&nbsp;node&nbsp;group</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596181">if</span>&nbsp;<span class="ident" id="3596184">top</span>&nbsp;<span class="op" id="3596188">:=</span>&nbsp;<span class="ident" id="3596191">stack</span><span class="op" id="3596196">.</span><span class="ident" id="3596197">pop</span><span class="op" id="3596200">(</span><span class="ident" id="3596201">r</span><span class="op" id="3596202">.</span><span class="ident" id="3596203">comment</span><span class="op" id="3596210">.</span><span class="ident" id="3596211">Pos</span><span class="op" id="3596214">(</span><span class="op" id="3596215">)</span><span class="op" id="3596216">)</span><span class="op" id="3596217">;</span>&nbsp;<span class="ident" id="3596219">top</span>&nbsp;<span class="op" id="3596223">!=</span>&nbsp;<span class="ident" id="3596226">nil</span>&nbsp;<span class="op" id="3596230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596236">pg</span>&nbsp;<span class="op" id="3596239">=</span>&nbsp;<span class="ident" id="3596241">top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596249">pgend</span>&nbsp;<span class="op" id="3596255">=</span>&nbsp;<span class="ident" id="3596257">fset</span><span class="op" id="3596261">.</span><span class="ident" id="3596262">Position</span><span class="op" id="3596270">(</span><span class="ident" id="3596271">pg</span><span class="op" id="3596273">.</span><span class="ident" id="3596274">End</span><span class="op" id="3596277">(</span><span class="op" id="3596278">)</span><span class="op" id="3596279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3596284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596289">//&nbsp;Try&nbsp;to&nbsp;associate&nbsp;a&nbsp;comment&nbsp;first&nbsp;with&nbsp;a&nbsp;node&nbsp;group</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596346">//&nbsp;(i.e.,&nbsp;a&nbsp;node&nbsp;of&nbsp;&#34;importance&#34;&nbsp;such&nbsp;as&nbsp;a&nbsp;declaration);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596406">//&nbsp;if&nbsp;that&nbsp;fails,&nbsp;try&nbsp;to&nbsp;associate&nbsp;it&nbsp;with&nbsp;the&nbsp;most&nbsp;recent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596468">//&nbsp;node.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596480">//&nbsp;TODO(gri)&nbsp;try&nbsp;to&nbsp;simplify&nbsp;the&nbsp;logic&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596528">var</span>&nbsp;<span class="ident" id="3596532">assoc</span>&nbsp;<span class="ident" id="3596538">Node</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596546">switch</span>&nbsp;<span class="op" id="3596553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596558">case</span>&nbsp;<span class="ident" id="3596563">pg</span>&nbsp;<span class="op" id="3596566">!=</span>&nbsp;<span class="ident" id="3596569">nil</span>&nbsp;<span class="op" id="3596573">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3596580">(</span><span class="ident" id="3596581">pgend</span><span class="op" id="3596586">.</span><span class="ident" id="3596587">Line</span>&nbsp;<span class="op" id="3596592">==</span>&nbsp;<span class="ident" id="3596595">r</span><span class="op" id="3596596">.</span><span class="ident" id="3596597">pos</span><span class="op" id="3596600">.</span><span class="ident" id="3596601">Line</span>&nbsp;<span class="op" id="3596606">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596614">pgend</span><span class="op" id="3596619">.</span><span class="ident" id="3596620">Line</span><span class="op" id="3596624">+</span><span class="num" id="3596625">1</span>&nbsp;<span class="op" id="3596627">==</span>&nbsp;<span class="ident" id="3596630">r</span><span class="op" id="3596631">.</span><span class="ident" id="3596632">pos</span><span class="op" id="3596635">.</span><span class="ident" id="3596636">Line</span>&nbsp;<span class="op" id="3596641">&amp;&amp;</span>&nbsp;<span class="ident" id="3596644">r</span><span class="op" id="3596645">.</span><span class="ident" id="3596646">end</span><span class="op" id="3596649">.</span><span class="ident" id="3596650">Line</span><span class="op" id="3596654">+</span><span class="num" id="3596655">1</span>&nbsp;<span class="op" id="3596657">&lt;</span>&nbsp;<span class="ident" id="3596659">qpos</span><span class="op" id="3596663">.</span><span class="ident" id="3596664">Line</span><span class="op" id="3596668">)</span><span class="op" id="3596669">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596675">//&nbsp;1)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;previous&nbsp;node&nbsp;group&nbsp;ends,&nbsp;or</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596745">//&nbsp;2)&nbsp;comment&nbsp;starts&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596804">//&nbsp;&nbsp;&nbsp;&nbsp;previous&nbsp;node&nbsp;group&nbsp;and&nbsp;there&nbsp;is&nbsp;an&nbsp;empty&nbsp;line&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596868">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3596895">//&nbsp;=&gt;&nbsp;associate&nbsp;comment&nbsp;with&nbsp;previous&nbsp;node&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3596948">assoc</span>&nbsp;<span class="op" id="3596954">=</span>&nbsp;<span class="ident" id="3596956">pg</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3596962">case</span>&nbsp;<span class="ident" id="3596967">p</span>&nbsp;<span class="op" id="3596969">!=</span>&nbsp;<span class="ident" id="3596972">nil</span>&nbsp;<span class="op" id="3596976">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3596983">(</span><span class="ident" id="3596984">pend</span><span class="op" id="3596988">.</span><span class="ident" id="3596989">Line</span>&nbsp;<span class="op" id="3596994">==</span>&nbsp;<span class="ident" id="3596997">r</span><span class="op" id="3596998">.</span><span class="ident" id="3596999">pos</span><span class="op" id="3597002">.</span><span class="ident" id="3597003">Line</span>&nbsp;<span class="op" id="3597008">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597016">pend</span><span class="op" id="3597020">.</span><span class="ident" id="3597021">Line</span><span class="op" id="3597025">+</span><span class="num" id="3597026">1</span>&nbsp;<span class="op" id="3597028">==</span>&nbsp;<span class="ident" id="3597031">r</span><span class="op" id="3597032">.</span><span class="ident" id="3597033">pos</span><span class="op" id="3597036">.</span><span class="ident" id="3597037">Line</span>&nbsp;<span class="op" id="3597042">&amp;&amp;</span>&nbsp;<span class="ident" id="3597045">r</span><span class="op" id="3597046">.</span><span class="ident" id="3597047">end</span><span class="op" id="3597050">.</span><span class="ident" id="3597051">Line</span><span class="op" id="3597055">+</span><span class="num" id="3597056">1</span>&nbsp;<span class="op" id="3597058">&lt;</span>&nbsp;<span class="ident" id="3597060">qpos</span><span class="op" id="3597064">.</span><span class="ident" id="3597065">Line</span>&nbsp;<span class="op" id="3597070">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597078">q</span>&nbsp;<span class="op" id="3597080">==</span>&nbsp;<span class="ident" id="3597083">nil</span><span class="op" id="3597086">)</span><span class="op" id="3597087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597093">//&nbsp;same&nbsp;rules&nbsp;apply&nbsp;as&nbsp;above&nbsp;for&nbsp;p&nbsp;rather&nbsp;than&nbsp;pg,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597148">//&nbsp;but&nbsp;also&nbsp;associate&nbsp;with&nbsp;p&nbsp;if&nbsp;we&nbsp;are&nbsp;at&nbsp;the&nbsp;end&nbsp;(q&nbsp;==&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597213">assoc</span>&nbsp;<span class="op" id="3597219">=</span>&nbsp;<span class="ident" id="3597221">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597226">default</span><span class="op" id="3597233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597239">//&nbsp;otherwise,&nbsp;associate&nbsp;comment&nbsp;with&nbsp;current&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597293">if</span>&nbsp;<span class="ident" id="3597296">q</span>&nbsp;<span class="op" id="3597298">==</span>&nbsp;<span class="ident" id="3597301">nil</span>&nbsp;<span class="op" id="3597305">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597312">//&nbsp;we&nbsp;can&nbsp;only&nbsp;reach&nbsp;here&nbsp;if&nbsp;there&nbsp;was&nbsp;no&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597361">//&nbsp;which&nbsp;would&nbsp;imply&nbsp;that&nbsp;there&nbsp;were&nbsp;no&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3597412">panic</span><span class="op" id="3597417">(</span><span class="string" id="3597418">&#34;internal&nbsp;error:&nbsp;no&nbsp;comments&nbsp;should&nbsp;be&nbsp;associated&nbsp;with&nbsp;sentinel&#34;</span><span class="op" id="3597482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597494">assoc</span>&nbsp;<span class="op" id="3597500">=</span>&nbsp;<span class="ident" id="3597502">q</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597512">cmap</span><span class="op" id="3597516">.</span><span class="ident" id="3597517">addComment</span><span class="op" id="3597527">(</span><span class="ident" id="3597528">assoc</span><span class="op" id="3597533">,</span>&nbsp;<span class="ident" id="3597535">r</span><span class="op" id="3597536">.</span><span class="ident" id="3597537">comment</span><span class="op" id="3597544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597549">if</span>&nbsp;<span class="ident" id="3597552">r</span><span class="op" id="3597553">.</span><span class="ident" id="3597554">eol</span><span class="op" id="3597557">(</span><span class="op" id="3597558">)</span>&nbsp;<span class="op" id="3597560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597566">return</span>&nbsp;<span class="ident" id="3597573">cmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597581">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597586">r</span><span class="op" id="3597587">.</span><span class="ident" id="3597588">next</span><span class="op" id="3597592">(</span><span class="op" id="3597593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597602">//&nbsp;update&nbsp;previous&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597628">p</span>&nbsp;<span class="op" id="3597630">=</span>&nbsp;<span class="ident" id="3597632">q</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597636">pend</span>&nbsp;<span class="op" id="3597641">=</span>&nbsp;<span class="ident" id="3597643">fset</span><span class="op" id="3597647">.</span><span class="ident" id="3597648">Position</span><span class="op" id="3597656">(</span><span class="ident" id="3597657">p</span><span class="op" id="3597658">.</span><span class="ident" id="3597659">End</span><span class="op" id="3597662">(</span><span class="op" id="3597663">)</span><span class="op" id="3597664">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3597669">//&nbsp;update&nbsp;previous&nbsp;node&nbsp;group&nbsp;if&nbsp;we&nbsp;see&nbsp;an&nbsp;&#34;important&#34;&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597731">switch</span>&nbsp;<span class="ident" id="3597738">q</span><span class="op" id="3597739">.</span><span class="op" id="3597740">(</span><span class="keyword" id="3597741">type</span><span class="op" id="3597745">)</span>&nbsp;<span class="op" id="3597747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597751">case</span>&nbsp;<span class="op" id="3597756">*</span><span class="ident" id="3597757">File</span><span class="op" id="3597761">,</span>&nbsp;<span class="op" id="3597763">*</span><span class="ident" id="3597764">Field</span><span class="op" id="3597769">,</span>&nbsp;<span class="ident" id="3597771">Decl</span><span class="op" id="3597775">,</span>&nbsp;<span class="ident" id="3597777">Spec</span><span class="op" id="3597781">,</span>&nbsp;<span class="ident" id="3597783">Stmt</span><span class="op" id="3597787">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3597792">stack</span><span class="op" id="3597797">.</span><span class="ident" id="3597798">push</span><span class="op" id="3597802">(</span><span class="ident" id="3597803">q</span><span class="op" id="3597804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3597811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3597815">return</span>&nbsp;<span class="ident" id="3597822">cmap</span><br>
<span class="lineno">240</span><span class="op" id="3597827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3597830">//&nbsp;Update&nbsp;replaces&nbsp;an&nbsp;old&nbsp;node&nbsp;in&nbsp;the&nbsp;comment&nbsp;map&nbsp;with&nbsp;the&nbsp;new&nbsp;node</span><br>
<span class="lineno"></span><span class="comment" id="3597898">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;node.&nbsp;Comments&nbsp;that&nbsp;were&nbsp;associated&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3597966">//&nbsp;old&nbsp;node&nbsp;are&nbsp;associated&nbsp;with&nbsp;the&nbsp;new&nbsp;node.</span><br>
<span class="lineno">245</span><span class="comment" id="3598012">//</span><br>
<span class="lineno"></span><span class="keyword" id="3598015">func</span>&nbsp;<span class="op" id="3598020">(</span><span class="ident" id="3598021">cmap</span>&nbsp;<span class="ident" id="3598026">CommentMap</span><span class="op" id="3598036">)</span>&nbsp;<span class="ident" id="3598038">Update</span><span class="op" id="3598044">(</span><span class="ident" id="3598045">old</span><span class="op" id="3598048">,</span>&nbsp;<span class="builtinfunc" id="3598050">new</span>&nbsp;<span class="ident" id="3598054">Node</span><span class="op" id="3598058">)</span>&nbsp;<span class="ident" id="3598060">Node</span>&nbsp;<span class="op" id="3598065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598068">if</span>&nbsp;<span class="ident" id="3598071">list</span>&nbsp;<span class="op" id="3598076">:=</span>&nbsp;<span class="ident" id="3598079">cmap</span><span class="op" id="3598083">[</span><span class="ident" id="3598084">old</span><span class="op" id="3598087">]</span><span class="op" id="3598088">;</span>&nbsp;<span class="builtinfunc" id="3598090">len</span><span class="op" id="3598093">(</span><span class="ident" id="3598094">list</span><span class="op" id="3598098">)</span>&nbsp;<span class="op" id="3598100">&gt;</span>&nbsp;<span class="num" id="3598102">0</span>&nbsp;<span class="op" id="3598104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3598108">delete</span><span class="op" id="3598114">(</span><span class="ident" id="3598115">cmap</span><span class="op" id="3598119">,</span>&nbsp;<span class="ident" id="3598121">old</span><span class="op" id="3598124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598128">cmap</span><span class="op" id="3598132">[</span><span class="builtinfunc" id="3598133">new</span><span class="op" id="3598136">]</span>&nbsp;<span class="op" id="3598138">=</span>&nbsp;<span class="builtinfunc" id="3598140">append</span><span class="op" id="3598146">(</span><span class="ident" id="3598147">cmap</span><span class="op" id="3598151">[</span><span class="builtinfunc" id="3598152">new</span><span class="op" id="3598155">]</span><span class="op" id="3598156">,</span>&nbsp;<span class="ident" id="3598158">list</span><span class="op" id="3598162">...</span><span class="op" id="3598165">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598171">return</span>&nbsp;<span class="builtinfunc" id="3598178">new</span><br>
<span class="lineno"></span><span class="op" id="3598182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3598185">//&nbsp;Filter&nbsp;returns&nbsp;a&nbsp;new&nbsp;comment&nbsp;map&nbsp;consisting&nbsp;of&nbsp;only&nbsp;those</span><br>
<span class="lineno">255</span><span class="comment" id="3598246">//&nbsp;entries&nbsp;of&nbsp;cmap&nbsp;for&nbsp;which&nbsp;a&nbsp;corresponding&nbsp;node&nbsp;exists&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3598306">//&nbsp;the&nbsp;AST&nbsp;specified&nbsp;by&nbsp;node.</span><br>
<span class="lineno"></span><span class="comment" id="3598336">//</span><br>
<span class="lineno"></span><span class="keyword" id="3598339">func</span>&nbsp;<span class="op" id="3598344">(</span><span class="ident" id="3598345">cmap</span>&nbsp;<span class="ident" id="3598350">CommentMap</span><span class="op" id="3598360">)</span>&nbsp;<span class="ident" id="3598362">Filter</span><span class="op" id="3598368">(</span><span class="ident" id="3598369">node</span>&nbsp;<span class="ident" id="3598374">Node</span><span class="op" id="3598378">)</span>&nbsp;<span class="ident" id="3598380">CommentMap</span>&nbsp;<span class="op" id="3598391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598394">umap</span>&nbsp;<span class="op" id="3598399">:=</span>&nbsp;<span class="builtinfunc" id="3598402">make</span><span class="op" id="3598406">(</span><span class="ident" id="3598407">CommentMap</span><span class="op" id="3598417">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598420">Inspect</span><span class="op" id="3598427">(</span><span class="ident" id="3598428">node</span><span class="op" id="3598432">,</span>&nbsp;<span class="keyword" id="3598434">func</span><span class="op" id="3598438">(</span><span class="ident" id="3598439">n</span>&nbsp;<span class="ident" id="3598441">Node</span><span class="op" id="3598445">)</span>&nbsp;<span class="builtintype" id="3598447">bool</span>&nbsp;<span class="op" id="3598452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598456">if</span>&nbsp;<span class="ident" id="3598459">g</span>&nbsp;<span class="op" id="3598461">:=</span>&nbsp;<span class="ident" id="3598464">cmap</span><span class="op" id="3598468">[</span><span class="ident" id="3598469">n</span><span class="op" id="3598470">]</span><span class="op" id="3598471">;</span>&nbsp;<span class="builtinfunc" id="3598473">len</span><span class="op" id="3598476">(</span><span class="ident" id="3598477">g</span><span class="op" id="3598478">)</span>&nbsp;<span class="op" id="3598480">&gt;</span>&nbsp;<span class="num" id="3598482">0</span>&nbsp;<span class="op" id="3598484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598489">umap</span><span class="op" id="3598493">[</span><span class="ident" id="3598494">n</span><span class="op" id="3598495">]</span>&nbsp;<span class="op" id="3598497">=</span>&nbsp;<span class="ident" id="3598499">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598507">return</span>&nbsp;<span class="builtintype" id="3598514">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598520">}</span><span class="op" id="3598521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598524">return</span>&nbsp;<span class="ident" id="3598531">umap</span><br>
<span class="lineno"></span><span class="op" id="3598536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3598539">//&nbsp;Comments&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;comment&nbsp;groups&nbsp;in&nbsp;the&nbsp;comment&nbsp;map.</span><br>
<span class="lineno">270</span><span class="comment" id="3598606">//&nbsp;The&nbsp;result&nbsp;is&nbsp;sorted&nbsp;is&nbsp;source&nbsp;order.</span><br>
<span class="lineno"></span><span class="comment" id="3598647">//</span><br>
<span class="lineno"></span><span class="keyword" id="3598650">func</span>&nbsp;<span class="op" id="3598655">(</span><span class="ident" id="3598656">cmap</span>&nbsp;<span class="ident" id="3598661">CommentMap</span><span class="op" id="3598671">)</span>&nbsp;<span class="ident" id="3598673">Comments</span><span class="op" id="3598681">(</span><span class="op" id="3598682">)</span>&nbsp;<span class="op" id="3598684">[</span><span class="op" id="3598685">]</span><span class="op" id="3598686">*</span><span class="ident" id="3598687">CommentGroup</span>&nbsp;<span class="op" id="3598700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598703">list</span>&nbsp;<span class="op" id="3598708">:=</span>&nbsp;<span class="builtinfunc" id="3598711">make</span><span class="op" id="3598715">(</span><span class="op" id="3598716">[</span><span class="op" id="3598717">]</span><span class="op" id="3598718">*</span><span class="ident" id="3598719">CommentGroup</span><span class="op" id="3598731">,</span>&nbsp;<span class="num" id="3598733">0</span><span class="op" id="3598734">,</span>&nbsp;<span class="builtinfunc" id="3598736">len</span><span class="op" id="3598739">(</span><span class="ident" id="3598740">cmap</span><span class="op" id="3598744">)</span><span class="op" id="3598745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598748">for</span>&nbsp;<span class="ident" id="3598752">_</span><span class="op" id="3598753">,</span>&nbsp;<span class="ident" id="3598755">e</span>&nbsp;<span class="op" id="3598757">:=</span>&nbsp;<span class="keyword" id="3598760">range</span>&nbsp;<span class="ident" id="3598766">cmap</span>&nbsp;<span class="op" id="3598771">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598775">list</span>&nbsp;<span class="op" id="3598780">=</span>&nbsp;<span class="builtinfunc" id="3598782">append</span><span class="op" id="3598788">(</span><span class="ident" id="3598789">list</span><span class="op" id="3598793">,</span>&nbsp;<span class="ident" id="3598795">e</span><span class="op" id="3598796">...</span><span class="op" id="3598799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3598802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3598805">sortComments</span><span class="op" id="3598817">(</span><span class="ident" id="3598818">list</span><span class="op" id="3598822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598825">return</span>&nbsp;<span class="ident" id="3598832">list</span><br>
<span class="lineno"></span><span class="op" id="3598837">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="3598840">func</span>&nbsp;<span class="ident" id="3598845">summary</span><span class="op" id="3598852">(</span><span class="ident" id="3598853">list</span>&nbsp;<span class="op" id="3598858">[</span><span class="op" id="3598859">]</span><span class="op" id="3598860">*</span><span class="ident" id="3598861">CommentGroup</span><span class="op" id="3598873">)</span>&nbsp;<span class="builtintype" id="3598875">string</span>&nbsp;<span class="op" id="3598882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598885">const</span>&nbsp;<span class="ident" id="3598891">maxLen</span>&nbsp;<span class="op" id="3598898">=</span>&nbsp;<span class="num" id="3598900">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598904">var</span>&nbsp;<span class="ident" id="3598908">buf</span>&nbsp;<span class="ident" id="3598912">bytes</span><span class="op" id="3598917">.</span><span class="ident" id="3598918">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3598927">//&nbsp;collect&nbsp;comments&nbsp;text</span><br>
<span class="lineno"></span><span class="ident" id="3598952">loop</span><span class="op" id="3598956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3598959">for</span>&nbsp;<span class="ident" id="3598963">_</span><span class="op" id="3598964">,</span>&nbsp;<span class="ident" id="3598966">group</span>&nbsp;<span class="op" id="3598972">:=</span>&nbsp;<span class="keyword" id="3598975">range</span>&nbsp;<span class="ident" id="3598981">list</span>&nbsp;<span class="op" id="3598986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3598990">//&nbsp;Note:&nbsp;CommentGroup.Text()&nbsp;does&nbsp;too&nbsp;much&nbsp;work&nbsp;for&nbsp;what&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3599052">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;and&nbsp;would&nbsp;only&nbsp;replace&nbsp;this&nbsp;innermost&nbsp;loop.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3599112">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Just&nbsp;do&nbsp;it&nbsp;explicitly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599146">for</span>&nbsp;<span class="ident" id="3599150">_</span><span class="op" id="3599151">,</span>&nbsp;<span class="ident" id="3599153">comment</span>&nbsp;<span class="op" id="3599161">:=</span>&nbsp;<span class="keyword" id="3599164">range</span>&nbsp;<span class="ident" id="3599170">group</span><span class="op" id="3599175">.</span><span class="ident" id="3599176">List</span>&nbsp;<span class="op" id="3599181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599186">if</span>&nbsp;<span class="ident" id="3599189">buf</span><span class="op" id="3599192">.</span><span class="ident" id="3599193">Len</span><span class="op" id="3599196">(</span><span class="op" id="3599197">)</span>&nbsp;<span class="op" id="3599199">&gt;=</span>&nbsp;<span class="ident" id="3599202">maxLen</span>&nbsp;<span class="op" id="3599209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599215">break</span>&nbsp;<span class="ident" id="3599221">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599229">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599234">buf</span><span class="op" id="3599237">.</span><span class="ident" id="3599238">WriteString</span><span class="op" id="3599249">(</span><span class="ident" id="3599250">comment</span><span class="op" id="3599257">.</span><span class="ident" id="3599258">Text</span><span class="op" id="3599262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3599273">//&nbsp;truncate&nbsp;if&nbsp;too&nbsp;long</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599298">if</span>&nbsp;<span class="ident" id="3599301">buf</span><span class="op" id="3599304">.</span><span class="ident" id="3599305">Len</span><span class="op" id="3599308">(</span><span class="op" id="3599309">)</span>&nbsp;<span class="op" id="3599311">&gt;</span>&nbsp;<span class="ident" id="3599313">maxLen</span>&nbsp;<span class="op" id="3599320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599324">buf</span><span class="op" id="3599327">.</span><span class="ident" id="3599328">Truncate</span><span class="op" id="3599336">(</span><span class="ident" id="3599337">maxLen</span>&nbsp;<span class="op" id="3599344">-</span>&nbsp;<span class="num" id="3599346">3</span><span class="op" id="3599347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599351">buf</span><span class="op" id="3599354">.</span><span class="ident" id="3599355">WriteString</span><span class="op" id="3599366">(</span><span class="string" id="3599367">&#34;...&#34;</span><span class="op" id="3599372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3599379">//&nbsp;replace&nbsp;any&nbsp;invisibles&nbsp;with&nbsp;blanks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599418">bytes</span>&nbsp;<span class="op" id="3599424">:=</span>&nbsp;<span class="ident" id="3599427">buf</span><span class="op" id="3599430">.</span><span class="ident" id="3599431">Bytes</span><span class="op" id="3599436">(</span><span class="op" id="3599437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599440">for</span>&nbsp;<span class="ident" id="3599444">i</span><span class="op" id="3599445">,</span>&nbsp;<span class="ident" id="3599447">b</span>&nbsp;<span class="op" id="3599449">:=</span>&nbsp;<span class="keyword" id="3599452">range</span>&nbsp;<span class="ident" id="3599458">bytes</span>&nbsp;<span class="op" id="3599464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599468">switch</span>&nbsp;<span class="ident" id="3599475">b</span>&nbsp;<span class="op" id="3599477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599481">case</span>&nbsp;<span class="string" id="3599486">&#39;\t&#39;</span><span class="op" id="3599490">,</span>&nbsp;<span class="string" id="3599492">&#39;\n&#39;</span><span class="op" id="3599496">,</span>&nbsp;<span class="string" id="3599498">&#39;\r&#39;</span><span class="op" id="3599502">:</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599507">bytes</span><span class="op" id="3599512">[</span><span class="ident" id="3599513">i</span><span class="op" id="3599514">]</span>&nbsp;<span class="op" id="3599516">=</span>&nbsp;<span class="string" id="3599518">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599531">return</span>&nbsp;<span class="builtintype" id="3599538">string</span><span class="op" id="3599544">(</span><span class="ident" id="3599545">bytes</span><span class="op" id="3599550">)</span><br>
<span class="lineno">315</span><span class="op" id="3599552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3599555">func</span>&nbsp;<span class="op" id="3599560">(</span><span class="ident" id="3599561">cmap</span>&nbsp;<span class="ident" id="3599566">CommentMap</span><span class="op" id="3599576">)</span>&nbsp;<span class="ident" id="3599578">String</span><span class="op" id="3599584">(</span><span class="op" id="3599585">)</span>&nbsp;<span class="builtintype" id="3599587">string</span>&nbsp;<span class="op" id="3599594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599597">var</span>&nbsp;<span class="ident" id="3599601">buf</span>&nbsp;<span class="ident" id="3599605">bytes</span><span class="op" id="3599610">.</span><span class="ident" id="3599611">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599619">fmt</span><span class="op" id="3599622">.</span><span class="ident" id="3599623">Fprintln</span><span class="op" id="3599631">(</span><span class="op" id="3599632">&amp;</span><span class="ident" id="3599633">buf</span><span class="op" id="3599636">,</span>&nbsp;<span class="string" id="3599638">&#34;CommentMap&nbsp;{&#34;</span><span class="op" id="3599652">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599655">for</span>&nbsp;<span class="ident" id="3599659">node</span><span class="op" id="3599663">,</span>&nbsp;<span class="ident" id="3599665">comment</span>&nbsp;<span class="op" id="3599673">:=</span>&nbsp;<span class="keyword" id="3599676">range</span>&nbsp;<span class="ident" id="3599682">cmap</span>&nbsp;<span class="op" id="3599687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3599691">//&nbsp;print&nbsp;name&nbsp;of&nbsp;identifiers;&nbsp;print&nbsp;node&nbsp;type&nbsp;for&nbsp;other&nbsp;nodes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599755">var</span>&nbsp;<span class="ident" id="3599759">s</span>&nbsp;<span class="builtintype" id="3599761">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599770">if</span>&nbsp;<span class="ident" id="3599773">ident</span><span class="op" id="3599778">,</span>&nbsp;<span class="ident" id="3599780">ok</span>&nbsp;<span class="op" id="3599783">:=</span>&nbsp;<span class="ident" id="3599786">node</span><span class="op" id="3599790">.</span><span class="op" id="3599791">(</span><span class="op" id="3599792">*</span><span class="ident" id="3599793">Ident</span><span class="op" id="3599798">)</span><span class="op" id="3599799">;</span>&nbsp;<span class="ident" id="3599801">ok</span>&nbsp;<span class="op" id="3599804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599809">s</span>&nbsp;<span class="op" id="3599811">=</span>&nbsp;<span class="ident" id="3599813">ident</span><span class="op" id="3599818">.</span><span class="ident" id="3599819">Name</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599826">}</span>&nbsp;<span class="keyword" id="3599828">else</span>&nbsp;<span class="op" id="3599833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599838">s</span>&nbsp;<span class="op" id="3599840">=</span>&nbsp;<span class="ident" id="3599842">fmt</span><span class="op" id="3599845">.</span><span class="ident" id="3599846">Sprintf</span><span class="op" id="3599853">(</span><span class="string" id="3599854">&#34;%T&#34;</span><span class="op" id="3599858">,</span>&nbsp;<span class="ident" id="3599860">node</span><span class="op" id="3599864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599872">fmt</span><span class="op" id="3599875">.</span><span class="ident" id="3599876">Fprintf</span><span class="op" id="3599883">(</span><span class="op" id="3599884">&amp;</span><span class="ident" id="3599885">buf</span><span class="op" id="3599888">,</span>&nbsp;<span class="string" id="3599890">&#34;\t%p&nbsp;&nbsp;%20s:&nbsp;&nbsp;%s\n&#34;</span><span class="op" id="3599909">,</span>&nbsp;<span class="ident" id="3599911">node</span><span class="op" id="3599915">,</span>&nbsp;<span class="ident" id="3599917">s</span><span class="op" id="3599918">,</span>&nbsp;<span class="ident" id="3599920">summary</span><span class="op" id="3599927">(</span><span class="ident" id="3599928">comment</span><span class="op" id="3599935">)</span><span class="op" id="3599936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3599939">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3599942">fmt</span><span class="op" id="3599945">.</span><span class="ident" id="3599946">Fprintln</span><span class="op" id="3599954">(</span><span class="op" id="3599955">&amp;</span><span class="ident" id="3599956">buf</span><span class="op" id="3599959">,</span>&nbsp;<span class="string" id="3599961">&#34;}&#34;</span><span class="op" id="3599964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3599967">return</span>&nbsp;<span class="ident" id="3599974">buf</span><span class="op" id="3599977">.</span><span class="ident" id="3599978">String</span><span class="op" id="3599984">(</span><span class="op" id="3599985">)</span><br>
<span class="lineno"></span><span class="op" id="3599987">}</span>
</div>
</body>
</html>
