<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>io</h2>
<ul>
<li><a href="/gostd/io/io.go.html">io.go</a></li>
<li><a href="/gostd/io/io_test.go.html">io_test.go</a></li>
<li><a href="/gostd/io/multi.go.html">multi.go</a></li>
<li><a href="/gostd/io/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/io/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/io/pipe_test.go.html">pipe_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1355525">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1355580">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1355634">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1355685">package</span>&nbsp;<span class="ident" id="1355693">io</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1355697">type</span>&nbsp;<span class="ident" id="1355702">multiReader</span>&nbsp;<span class="keyword" id="1355714">struct</span>&nbsp;<span class="op" id="1355721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355724">readers</span>&nbsp;<span class="op" id="1355732">[</span><span class="op" id="1355733">]</span><span class="ident" id="1355734">Reader</span><br>
<span class="lineno"></span><span class="op" id="1355741">}</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1355744">func</span>&nbsp;<span class="op" id="1355749">(</span><span class="ident" id="1355750">mr</span>&nbsp;<span class="op" id="1355753">*</span><span class="ident" id="1355754">multiReader</span><span class="op" id="1355765">)</span>&nbsp;<span class="ident" id="1355767">Read</span><span class="op" id="1355771">(</span><span class="ident" id="1355772">p</span>&nbsp;<span class="op" id="1355774">[</span><span class="op" id="1355775">]</span><span class="builtintype" id="1355776">byte</span><span class="op" id="1355780">)</span>&nbsp;<span class="op" id="1355782">(</span><span class="ident" id="1355783">n</span>&nbsp;<span class="builtintype" id="1355785">int</span><span class="op" id="1355788">,</span>&nbsp;<span class="ident" id="1355790">err</span>&nbsp;<span class="builtintype" id="1355794">error</span><span class="op" id="1355799">)</span>&nbsp;<span class="op" id="1355801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355804">for</span>&nbsp;<span class="builtinfunc" id="1355808">len</span><span class="op" id="1355811">(</span><span class="ident" id="1355812">mr</span><span class="op" id="1355814">.</span><span class="ident" id="1355815">readers</span><span class="op" id="1355822">)</span>&nbsp;<span class="op" id="1355824">&gt;</span>&nbsp;<span class="num" id="1355826">0</span>&nbsp;<span class="op" id="1355828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355832">n</span><span class="op" id="1355833">,</span>&nbsp;<span class="ident" id="1355835">err</span>&nbsp;<span class="op" id="1355839">=</span>&nbsp;<span class="ident" id="1355841">mr</span><span class="op" id="1355843">.</span><span class="ident" id="1355844">readers</span><span class="op" id="1355851">[</span><span class="num" id="1355852">0</span><span class="op" id="1355853">]</span><span class="op" id="1355854">.</span><span class="ident" id="1355855">Read</span><span class="op" id="1355859">(</span><span class="ident" id="1355860">p</span><span class="op" id="1355861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355865">if</span>&nbsp;<span class="ident" id="1355868">n</span>&nbsp;<span class="op" id="1355870">&gt;</span>&nbsp;<span class="num" id="1355872">0</span>&nbsp;<span class="op" id="1355874">||</span>&nbsp;<span class="ident" id="1355877">err</span>&nbsp;<span class="op" id="1355881">!=</span>&nbsp;<span class="ident" id="1355884">EOF</span>&nbsp;<span class="op" id="1355888">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355893">if</span>&nbsp;<span class="ident" id="1355896">err</span>&nbsp;<span class="op" id="1355900">==</span>&nbsp;<span class="ident" id="1355903">EOF</span>&nbsp;<span class="op" id="1355907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355913">//&nbsp;Don&#39;t&nbsp;return&nbsp;EOF&nbsp;yet.&nbsp;There&nbsp;may&nbsp;be&nbsp;more&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355966">//&nbsp;in&nbsp;the&nbsp;remaining&nbsp;readers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355999">err</span>&nbsp;<span class="op" id="1356003">=</span>&nbsp;<span class="ident" id="1356005">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356012">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356017">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356030">mr</span><span class="op" id="1356032">.</span><span class="ident" id="1356033">readers</span>&nbsp;<span class="op" id="1356041">=</span>&nbsp;<span class="ident" id="1356043">mr</span><span class="op" id="1356045">.</span><span class="ident" id="1356046">readers</span><span class="op" id="1356053">[</span><span class="num" id="1356054">1</span><span class="op" id="1356055">:</span><span class="op" id="1356056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356062">return</span>&nbsp;<span class="num" id="1356069">0</span><span class="op" id="1356070">,</span>&nbsp;<span class="ident" id="1356072">EOF</span><br>
<span class="lineno">25</span><span class="op" id="1356076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1356079">//&nbsp;MultiReader&nbsp;returns&nbsp;a&nbsp;Reader&nbsp;that&#39;s&nbsp;the&nbsp;logical&nbsp;concatenation&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1356147">//&nbsp;the&nbsp;provided&nbsp;input&nbsp;readers.&nbsp;&nbsp;They&#39;re&nbsp;read&nbsp;sequentially.&nbsp;&nbsp;Once&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="1356216">//&nbsp;inputs&nbsp;have&nbsp;returned&nbsp;EOF,&nbsp;Read&nbsp;will&nbsp;return&nbsp;EOF.&nbsp;&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;readers</span><br>
<span class="lineno">30</span><span class="comment" id="1356290">//&nbsp;return&nbsp;a&nbsp;non-nil,&nbsp;non-EOF&nbsp;error,&nbsp;Read&nbsp;will&nbsp;return&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="1356355">func</span>&nbsp;<span class="ident" id="1356360">MultiReader</span><span class="op" id="1356371">(</span><span class="ident" id="1356372">readers</span>&nbsp;<span class="op" id="1356380">...</span><span class="ident" id="1356383">Reader</span><span class="op" id="1356389">)</span>&nbsp;<span class="ident" id="1356391">Reader</span>&nbsp;<span class="op" id="1356398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356401">r</span>&nbsp;<span class="op" id="1356403">:=</span>&nbsp;<span class="builtinfunc" id="1356406">make</span><span class="op" id="1356410">(</span><span class="op" id="1356411">[</span><span class="op" id="1356412">]</span><span class="ident" id="1356413">Reader</span><span class="op" id="1356419">,</span>&nbsp;<span class="builtinfunc" id="1356421">len</span><span class="op" id="1356424">(</span><span class="ident" id="1356425">readers</span><span class="op" id="1356432">)</span><span class="op" id="1356433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1356436">copy</span><span class="op" id="1356440">(</span><span class="ident" id="1356441">r</span><span class="op" id="1356442">,</span>&nbsp;<span class="ident" id="1356444">readers</span><span class="op" id="1356451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356454">return</span>&nbsp;<span class="op" id="1356461">&amp;</span><span class="ident" id="1356462">multiReader</span><span class="op" id="1356473">{</span><span class="ident" id="1356474">r</span><span class="op" id="1356475">}</span><br>
<span class="lineno">35</span><span class="op" id="1356477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1356480">type</span>&nbsp;<span class="ident" id="1356485">multiWriter</span>&nbsp;<span class="keyword" id="1356497">struct</span>&nbsp;<span class="op" id="1356504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356507">writers</span>&nbsp;<span class="op" id="1356515">[</span><span class="op" id="1356516">]</span><span class="ident" id="1356517">Writer</span><br>
<span class="lineno"></span><span class="op" id="1356524">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1356527">func</span>&nbsp;<span class="op" id="1356532">(</span><span class="ident" id="1356533">t</span>&nbsp;<span class="op" id="1356535">*</span><span class="ident" id="1356536">multiWriter</span><span class="op" id="1356547">)</span>&nbsp;<span class="ident" id="1356549">Write</span><span class="op" id="1356554">(</span><span class="ident" id="1356555">p</span>&nbsp;<span class="op" id="1356557">[</span><span class="op" id="1356558">]</span><span class="builtintype" id="1356559">byte</span><span class="op" id="1356563">)</span>&nbsp;<span class="op" id="1356565">(</span><span class="ident" id="1356566">n</span>&nbsp;<span class="builtintype" id="1356568">int</span><span class="op" id="1356571">,</span>&nbsp;<span class="ident" id="1356573">err</span>&nbsp;<span class="builtintype" id="1356577">error</span><span class="op" id="1356582">)</span>&nbsp;<span class="op" id="1356584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356587">for</span>&nbsp;<span class="ident" id="1356591">_</span><span class="op" id="1356592">,</span>&nbsp;<span class="ident" id="1356594">w</span>&nbsp;<span class="op" id="1356596">:=</span>&nbsp;<span class="keyword" id="1356599">range</span>&nbsp;<span class="ident" id="1356605">t</span><span class="op" id="1356606">.</span><span class="ident" id="1356607">writers</span>&nbsp;<span class="op" id="1356615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356619">n</span><span class="op" id="1356620">,</span>&nbsp;<span class="ident" id="1356622">err</span>&nbsp;<span class="op" id="1356626">=</span>&nbsp;<span class="ident" id="1356628">w</span><span class="op" id="1356629">.</span><span class="ident" id="1356630">Write</span><span class="op" id="1356635">(</span><span class="ident" id="1356636">p</span><span class="op" id="1356637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356641">if</span>&nbsp;<span class="ident" id="1356644">err</span>&nbsp;<span class="op" id="1356648">!=</span>&nbsp;<span class="ident" id="1356651">nil</span>&nbsp;<span class="op" id="1356655">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356673">if</span>&nbsp;<span class="ident" id="1356676">n</span>&nbsp;<span class="op" id="1356678">!=</span>&nbsp;<span class="builtinfunc" id="1356681">len</span><span class="op" id="1356684">(</span><span class="ident" id="1356685">p</span><span class="op" id="1356686">)</span>&nbsp;<span class="op" id="1356688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356693">err</span>&nbsp;<span class="op" id="1356697">=</span>&nbsp;<span class="ident" id="1356699">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356716">return</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1356728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356731">return</span>&nbsp;<span class="builtinfunc" id="1356738">len</span><span class="op" id="1356741">(</span><span class="ident" id="1356742">p</span><span class="op" id="1356743">)</span><span class="op" id="1356744">,</span>&nbsp;<span class="ident" id="1356746">nil</span><br>
<span class="lineno"></span><span class="op" id="1356750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1356753">//&nbsp;MultiWriter&nbsp;creates&nbsp;a&nbsp;writer&nbsp;that&nbsp;duplicates&nbsp;its&nbsp;writes&nbsp;to&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1356823">//&nbsp;provided&nbsp;writers,&nbsp;similar&nbsp;to&nbsp;the&nbsp;Unix&nbsp;tee(1)&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="1356880">func</span>&nbsp;<span class="ident" id="1356885">MultiWriter</span><span class="op" id="1356896">(</span><span class="ident" id="1356897">writers</span>&nbsp;<span class="op" id="1356905">...</span><span class="ident" id="1356908">Writer</span><span class="op" id="1356914">)</span>&nbsp;<span class="ident" id="1356916">Writer</span>&nbsp;<span class="op" id="1356923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356926">w</span>&nbsp;<span class="op" id="1356928">:=</span>&nbsp;<span class="builtinfunc" id="1356931">make</span><span class="op" id="1356935">(</span><span class="op" id="1356936">[</span><span class="op" id="1356937">]</span><span class="ident" id="1356938">Writer</span><span class="op" id="1356944">,</span>&nbsp;<span class="builtinfunc" id="1356946">len</span><span class="op" id="1356949">(</span><span class="ident" id="1356950">writers</span><span class="op" id="1356957">)</span><span class="op" id="1356958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1356961">copy</span><span class="op" id="1356965">(</span><span class="ident" id="1356966">w</span><span class="op" id="1356967">,</span>&nbsp;<span class="ident" id="1356969">writers</span><span class="op" id="1356976">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356979">return</span>&nbsp;<span class="op" id="1356986">&amp;</span><span class="ident" id="1356987">multiWriter</span><span class="op" id="1356998">{</span><span class="ident" id="1356999">w</span><span class="op" id="1357000">}</span><br>
<span class="lineno"></span><span class="op" id="1357002">}</span>
</div>
</body>
</html>
