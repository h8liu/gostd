<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4580029">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4580084">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4580138">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4580189">package</span>&nbsp;<span class="ident" id="4580197">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4580207">import</span>&nbsp;<span class="op" id="4580214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4580217">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4580226">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4580233">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4580244">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4580259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4580262">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="4580336">func</span>&nbsp;<span class="ident" id="4580341">htmlNospaceEscaper</span><span class="op" id="4580359">(</span><span class="ident" id="4580360">args</span>&nbsp;<span class="op" id="4580365">...</span><span class="keyword" id="4580368">interface</span><span class="op" id="4580377">{</span><span class="op" id="4580378">}</span><span class="op" id="4580379">)</span>&nbsp;<span class="builtintype" id="4580381">string</span>&nbsp;<span class="op" id="4580388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580391">s</span><span class="op" id="4580392">,</span>&nbsp;<span class="ident" id="4580394">t</span>&nbsp;<span class="op" id="4580396">:=</span>&nbsp;<span class="ident" id="4580399">stringify</span><span class="op" id="4580408">(</span><span class="ident" id="4580409">args</span><span class="op" id="4580413">...</span><span class="op" id="4580416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580419">if</span>&nbsp;<span class="ident" id="4580422">t</span>&nbsp;<span class="op" id="4580424">==</span>&nbsp;<span class="ident" id="4580427">contentTypeHTML</span>&nbsp;<span class="op" id="4580443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580447">return</span>&nbsp;<span class="ident" id="4580454">htmlReplacer</span><span class="op" id="4580466">(</span><span class="ident" id="4580467">stripTags</span><span class="op" id="4580476">(</span><span class="ident" id="4580477">s</span><span class="op" id="4580478">)</span><span class="op" id="4580479">,</span>&nbsp;<span class="ident" id="4580481">htmlNospaceNormReplacementTable</span><span class="op" id="4580512">,</span>&nbsp;<span class="builtintype" id="4580514">false</span><span class="op" id="4580519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580522">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580525">return</span>&nbsp;<span class="ident" id="4580532">htmlReplacer</span><span class="op" id="4580544">(</span><span class="ident" id="4580545">s</span><span class="op" id="4580546">,</span>&nbsp;<span class="ident" id="4580548">htmlNospaceReplacementTable</span><span class="op" id="4580575">,</span>&nbsp;<span class="builtintype" id="4580577">false</span><span class="op" id="4580582">)</span><br>
<span class="lineno"></span><span class="op" id="4580584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4580587">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4580652">func</span>&nbsp;<span class="ident" id="4580657">attrEscaper</span><span class="op" id="4580668">(</span><span class="ident" id="4580669">args</span>&nbsp;<span class="op" id="4580674">...</span><span class="keyword" id="4580677">interface</span><span class="op" id="4580686">{</span><span class="op" id="4580687">}</span><span class="op" id="4580688">)</span>&nbsp;<span class="builtintype" id="4580690">string</span>&nbsp;<span class="op" id="4580697">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580700">s</span><span class="op" id="4580701">,</span>&nbsp;<span class="ident" id="4580703">t</span>&nbsp;<span class="op" id="4580705">:=</span>&nbsp;<span class="ident" id="4580708">stringify</span><span class="op" id="4580717">(</span><span class="ident" id="4580718">args</span><span class="op" id="4580722">...</span><span class="op" id="4580725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580728">if</span>&nbsp;<span class="ident" id="4580731">t</span>&nbsp;<span class="op" id="4580733">==</span>&nbsp;<span class="ident" id="4580736">contentTypeHTML</span>&nbsp;<span class="op" id="4580752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580756">return</span>&nbsp;<span class="ident" id="4580763">htmlReplacer</span><span class="op" id="4580775">(</span><span class="ident" id="4580776">stripTags</span><span class="op" id="4580785">(</span><span class="ident" id="4580786">s</span><span class="op" id="4580787">)</span><span class="op" id="4580788">,</span>&nbsp;<span class="ident" id="4580790">htmlNormReplacementTable</span><span class="op" id="4580814">,</span>&nbsp;<span class="builtintype" id="4580816">true</span><span class="op" id="4580820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4580823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4580826">return</span>&nbsp;<span class="ident" id="4580833">htmlReplacer</span><span class="op" id="4580845">(</span><span class="ident" id="4580846">s</span><span class="op" id="4580847">,</span>&nbsp;<span class="ident" id="4580849">htmlReplacementTable</span><span class="op" id="4580869">,</span>&nbsp;<span class="builtintype" id="4580871">true</span><span class="op" id="4580875">)</span><br>
<span class="lineno">30</span><span class="op" id="4580877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4580880">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4580946">func</span>&nbsp;<span class="ident" id="4580951">rcdataEscaper</span><span class="op" id="4580964">(</span><span class="ident" id="4580965">args</span>&nbsp;<span class="op" id="4580970">...</span><span class="keyword" id="4580973">interface</span><span class="op" id="4580982">{</span><span class="op" id="4580983">}</span><span class="op" id="4580984">)</span>&nbsp;<span class="builtintype" id="4580986">string</span>&nbsp;<span class="op" id="4580993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4580996">s</span><span class="op" id="4580997">,</span>&nbsp;<span class="ident" id="4580999">t</span>&nbsp;<span class="op" id="4581001">:=</span>&nbsp;<span class="ident" id="4581004">stringify</span><span class="op" id="4581013">(</span><span class="ident" id="4581014">args</span><span class="op" id="4581018">...</span><span class="op" id="4581021">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581024">if</span>&nbsp;<span class="ident" id="4581027">t</span>&nbsp;<span class="op" id="4581029">==</span>&nbsp;<span class="ident" id="4581032">contentTypeHTML</span>&nbsp;<span class="op" id="4581048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581052">return</span>&nbsp;<span class="ident" id="4581059">htmlReplacer</span><span class="op" id="4581071">(</span><span class="ident" id="4581072">s</span><span class="op" id="4581073">,</span>&nbsp;<span class="ident" id="4581075">htmlNormReplacementTable</span><span class="op" id="4581099">,</span>&nbsp;<span class="builtintype" id="4581101">true</span><span class="op" id="4581105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4581108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581111">return</span>&nbsp;<span class="ident" id="4581118">htmlReplacer</span><span class="op" id="4581130">(</span><span class="ident" id="4581131">s</span><span class="op" id="4581132">,</span>&nbsp;<span class="ident" id="4581134">htmlReplacementTable</span><span class="op" id="4581154">,</span>&nbsp;<span class="builtintype" id="4581156">true</span><span class="op" id="4581160">)</span><br>
<span class="lineno"></span><span class="op" id="4581162">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4581165">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4581216">func</span>&nbsp;<span class="ident" id="4581221">htmlEscaper</span><span class="op" id="4581232">(</span><span class="ident" id="4581233">args</span>&nbsp;<span class="op" id="4581238">...</span><span class="keyword" id="4581241">interface</span><span class="op" id="4581250">{</span><span class="op" id="4581251">}</span><span class="op" id="4581252">)</span>&nbsp;<span class="builtintype" id="4581254">string</span>&nbsp;<span class="op" id="4581261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4581264">s</span><span class="op" id="4581265">,</span>&nbsp;<span class="ident" id="4581267">t</span>&nbsp;<span class="op" id="4581269">:=</span>&nbsp;<span class="ident" id="4581272">stringify</span><span class="op" id="4581281">(</span><span class="ident" id="4581282">args</span><span class="op" id="4581286">...</span><span class="op" id="4581289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581292">if</span>&nbsp;<span class="ident" id="4581295">t</span>&nbsp;<span class="op" id="4581297">==</span>&nbsp;<span class="ident" id="4581300">contentTypeHTML</span>&nbsp;<span class="op" id="4581316">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581320">return</span>&nbsp;<span class="ident" id="4581327">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4581330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4581333">return</span>&nbsp;<span class="ident" id="4581340">htmlReplacer</span><span class="op" id="4581352">(</span><span class="ident" id="4581353">s</span><span class="op" id="4581354">,</span>&nbsp;<span class="ident" id="4581356">htmlReplacementTable</span><span class="op" id="4581376">,</span>&nbsp;<span class="builtintype" id="4581378">true</span><span class="op" id="4581382">)</span><br>
<span class="lineno"></span><span class="op" id="4581384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4581387">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="4581454">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4581508">var</span>&nbsp;<span class="ident" id="4581512">htmlReplacementTable</span>&nbsp;<span class="op" id="4581533">=</span>&nbsp;<span class="op" id="4581535">[</span><span class="op" id="4581536">]</span><span class="builtintype" id="4581537">string</span><span class="op" id="4581543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581546">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581622">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581679">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581737">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581743">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4581761">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4581833">0</span><span class="op" id="4581834">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4581839">&#34;\uFFFD&#34;</span><span class="op" id="4581847">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581850">&#39;&#34;&#39;</span><span class="op" id="4581853">:</span>&nbsp;&nbsp;<span class="string" id="4581856">&#34;&amp;#34;&#34;</span><span class="op" id="4581863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581866">&#39;&amp;&#39;</span><span class="op" id="4581869">:</span>&nbsp;&nbsp;<span class="string" id="4581872">&#34;&amp;amp;&#34;</span><span class="op" id="4581879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581882">&#39;\&#39;&#39;</span><span class="op" id="4581886">:</span>&nbsp;<span class="string" id="4581888">&#34;&amp;#39;&#34;</span><span class="op" id="4581895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581898">&#39;+&#39;</span><span class="op" id="4581901">:</span>&nbsp;&nbsp;<span class="string" id="4581904">&#34;&amp;#43;&#34;</span><span class="op" id="4581911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581914">&#39;&lt;&#39;</span><span class="op" id="4581917">:</span>&nbsp;&nbsp;<span class="string" id="4581920">&#34;&amp;lt;&#34;</span><span class="op" id="4581926">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4581929">&#39;&gt;&#39;</span><span class="op" id="4581932">:</span>&nbsp;&nbsp;<span class="string" id="4581935">&#34;&amp;gt;&#34;</span><span class="op" id="4581941">,</span><br>
<span class="lineno"></span><span class="op" id="4581943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4581946">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4582022">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="4582064">var</span>&nbsp;<span class="ident" id="4582068">htmlNormReplacementTable</span>&nbsp;<span class="op" id="4582093">=</span>&nbsp;<span class="op" id="4582095">[</span><span class="op" id="4582096">]</span><span class="builtintype" id="4582097">string</span><span class="op" id="4582103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4582106">0</span><span class="op" id="4582107">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4582112">&#34;\uFFFD&#34;</span><span class="op" id="4582120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582123">&#39;&#34;&#39;</span><span class="op" id="4582126">:</span>&nbsp;&nbsp;<span class="string" id="4582129">&#34;&amp;#34;&#34;</span><span class="op" id="4582136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582139">&#39;\&#39;&#39;</span><span class="op" id="4582143">:</span>&nbsp;<span class="string" id="4582145">&#34;&amp;#39;&#34;</span><span class="op" id="4582152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582155">&#39;+&#39;</span><span class="op" id="4582158">:</span>&nbsp;&nbsp;<span class="string" id="4582161">&#34;&amp;#43;&#34;</span><span class="op" id="4582168">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582171">&#39;&lt;&#39;</span><span class="op" id="4582174">:</span>&nbsp;&nbsp;<span class="string" id="4582177">&#34;&amp;lt;&#34;</span><span class="op" id="4582183">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582186">&#39;&gt;&#39;</span><span class="op" id="4582189">:</span>&nbsp;&nbsp;<span class="string" id="4582192">&#34;&amp;gt;&#34;</span><span class="op" id="4582198">,</span><br>
<span class="lineno"></span><span class="op" id="4582200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4582203">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="4582277">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4582316">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4582382">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="4582439">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4582459">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="4582485">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="4582543">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4582578">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="4582611">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4582673">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="4582717">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4582786">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4582791">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="4582824">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="4582841">var</span>&nbsp;<span class="ident" id="4582845">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="4582873">=</span>&nbsp;<span class="op" id="4582875">[</span><span class="op" id="4582876">]</span><span class="builtintype" id="4582877">string</span><span class="op" id="4582883">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4582886">0</span><span class="op" id="4582887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4582892">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4582902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582905">&#39;\t&#39;</span><span class="op" id="4582909">:</span>&nbsp;<span class="string" id="4582911">&#34;&amp;#9;&#34;</span><span class="op" id="4582917">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582920">&#39;\n&#39;</span><span class="op" id="4582924">:</span>&nbsp;<span class="string" id="4582926">&#34;&amp;#10;&#34;</span><span class="op" id="4582933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582936">&#39;\v&#39;</span><span class="op" id="4582940">:</span>&nbsp;<span class="string" id="4582942">&#34;&amp;#11;&#34;</span><span class="op" id="4582949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582952">&#39;\f&#39;</span><span class="op" id="4582956">:</span>&nbsp;<span class="string" id="4582958">&#34;&amp;#12;&#34;</span><span class="op" id="4582965">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582968">&#39;\r&#39;</span><span class="op" id="4582972">:</span>&nbsp;<span class="string" id="4582974">&#34;&amp;#13;&#34;</span><span class="op" id="4582981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4582984">&#39;&nbsp;&#39;</span><span class="op" id="4582987">:</span>&nbsp;&nbsp;<span class="string" id="4582990">&#34;&amp;#32;&#34;</span><span class="op" id="4582997">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583000">&#39;&#34;&#39;</span><span class="op" id="4583003">:</span>&nbsp;&nbsp;<span class="string" id="4583006">&#34;&amp;#34;&#34;</span><span class="op" id="4583013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583016">&#39;&amp;&#39;</span><span class="op" id="4583019">:</span>&nbsp;&nbsp;<span class="string" id="4583022">&#34;&amp;amp;&#34;</span><span class="op" id="4583029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583032">&#39;\&#39;&#39;</span><span class="op" id="4583036">:</span>&nbsp;<span class="string" id="4583038">&#34;&amp;#39;&#34;</span><span class="op" id="4583045">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583048">&#39;+&#39;</span><span class="op" id="4583051">:</span>&nbsp;&nbsp;<span class="string" id="4583054">&#34;&amp;#43;&#34;</span><span class="op" id="4583061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583064">&#39;&lt;&#39;</span><span class="op" id="4583067">:</span>&nbsp;&nbsp;<span class="string" id="4583070">&#34;&amp;lt;&#34;</span><span class="op" id="4583076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583079">&#39;=&#39;</span><span class="op" id="4583082">:</span>&nbsp;&nbsp;<span class="string" id="4583085">&#34;&amp;#61;&#34;</span><span class="op" id="4583092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583095">&#39;&gt;&#39;</span><span class="op" id="4583098">:</span>&nbsp;&nbsp;<span class="string" id="4583101">&#34;&amp;gt;&#34;</span><span class="op" id="4583107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583110">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583166">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583201">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583243">&#39;`&#39;</span><span class="op" id="4583246">:</span>&nbsp;<span class="string" id="4583248">&#34;&amp;#96;&#34;</span><span class="op" id="4583255">,</span><br>
<span class="lineno"></span><span class="op" id="4583257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4583260">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4583335">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="4583392">var</span>&nbsp;<span class="ident" id="4583396">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="4583428">=</span>&nbsp;<span class="op" id="4583430">[</span><span class="op" id="4583431">]</span><span class="builtintype" id="4583432">string</span><span class="op" id="4583438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4583441">0</span><span class="op" id="4583442">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583447">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4583457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583460">&#39;\t&#39;</span><span class="op" id="4583464">:</span>&nbsp;<span class="string" id="4583466">&#34;&amp;#9;&#34;</span><span class="op" id="4583472">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583475">&#39;\n&#39;</span><span class="op" id="4583479">:</span>&nbsp;<span class="string" id="4583481">&#34;&amp;#10;&#34;</span><span class="op" id="4583488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583491">&#39;\v&#39;</span><span class="op" id="4583495">:</span>&nbsp;<span class="string" id="4583497">&#34;&amp;#11;&#34;</span><span class="op" id="4583504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583507">&#39;\f&#39;</span><span class="op" id="4583511">:</span>&nbsp;<span class="string" id="4583513">&#34;&amp;#12;&#34;</span><span class="op" id="4583520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583523">&#39;\r&#39;</span><span class="op" id="4583527">:</span>&nbsp;<span class="string" id="4583529">&#34;&amp;#13;&#34;</span><span class="op" id="4583536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583539">&#39;&nbsp;&#39;</span><span class="op" id="4583542">:</span>&nbsp;&nbsp;<span class="string" id="4583545">&#34;&amp;#32;&#34;</span><span class="op" id="4583552">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583555">&#39;&#34;&#39;</span><span class="op" id="4583558">:</span>&nbsp;&nbsp;<span class="string" id="4583561">&#34;&amp;#34;&#34;</span><span class="op" id="4583568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583571">&#39;\&#39;&#39;</span><span class="op" id="4583575">:</span>&nbsp;<span class="string" id="4583577">&#34;&amp;#39;&#34;</span><span class="op" id="4583584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583587">&#39;+&#39;</span><span class="op" id="4583590">:</span>&nbsp;&nbsp;<span class="string" id="4583593">&#34;&amp;#43;&#34;</span><span class="op" id="4583600">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583603">&#39;&lt;&#39;</span><span class="op" id="4583606">:</span>&nbsp;&nbsp;<span class="string" id="4583609">&#34;&amp;lt;&#34;</span><span class="op" id="4583615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583618">&#39;=&#39;</span><span class="op" id="4583621">:</span>&nbsp;&nbsp;<span class="string" id="4583624">&#34;&amp;#61;&#34;</span><span class="op" id="4583631">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583634">&#39;&gt;&#39;</span><span class="op" id="4583637">:</span>&nbsp;&nbsp;<span class="string" id="4583640">&#34;&amp;gt;&#34;</span><span class="op" id="4583646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583649">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583705">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4583740">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4583782">&#39;`&#39;</span><span class="op" id="4583785">:</span>&nbsp;<span class="string" id="4583787">&#34;&amp;#96;&#34;</span><span class="op" id="4583794">,</span><br>
<span class="lineno">135</span><span class="op" id="4583796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4583799">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="4583875">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4583954">func</span>&nbsp;<span class="ident" id="4583959">htmlReplacer</span><span class="op" id="4583971">(</span><span class="ident" id="4583972">s</span>&nbsp;<span class="builtintype" id="4583974">string</span><span class="op" id="4583980">,</span>&nbsp;<span class="ident" id="4583982">replacementTable</span>&nbsp;<span class="op" id="4583999">[</span><span class="op" id="4584000">]</span><span class="builtintype" id="4584001">string</span><span class="op" id="4584007">,</span>&nbsp;<span class="ident" id="4584009">badRunes</span>&nbsp;<span class="builtintype" id="4584018">bool</span><span class="op" id="4584022">)</span>&nbsp;<span class="builtintype" id="4584024">string</span>&nbsp;<span class="op" id="4584031">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584034">written</span><span class="op" id="4584041">,</span>&nbsp;<span class="ident" id="4584043">b</span>&nbsp;<span class="op" id="4584045">:=</span>&nbsp;<span class="num" id="4584048">0</span><span class="op" id="4584049">,</span>&nbsp;<span class="builtinfunc" id="4584051">new</span><span class="op" id="4584054">(</span><span class="ident" id="4584055">bytes</span><span class="op" id="4584060">.</span><span class="ident" id="4584061">Buffer</span><span class="op" id="4584067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584070">for</span>&nbsp;<span class="ident" id="4584074">i</span><span class="op" id="4584075">,</span>&nbsp;<span class="ident" id="4584077">r</span>&nbsp;<span class="op" id="4584079">:=</span>&nbsp;<span class="keyword" id="4584082">range</span>&nbsp;<span class="ident" id="4584088">s</span>&nbsp;<span class="op" id="4584090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584094">if</span>&nbsp;<span class="builtintype" id="4584097">int</span><span class="op" id="4584100">(</span><span class="ident" id="4584101">r</span><span class="op" id="4584102">)</span>&nbsp;<span class="op" id="4584104">&lt;</span>&nbsp;<span class="builtinfunc" id="4584106">len</span><span class="op" id="4584109">(</span><span class="ident" id="4584110">replacementTable</span><span class="op" id="4584126">)</span>&nbsp;<span class="op" id="4584128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584133">if</span>&nbsp;<span class="ident" id="4584136">repl</span>&nbsp;<span class="op" id="4584141">:=</span>&nbsp;<span class="ident" id="4584144">replacementTable</span><span class="op" id="4584160">[</span><span class="ident" id="4584161">r</span><span class="op" id="4584162">]</span><span class="op" id="4584163">;</span>&nbsp;<span class="builtinfunc" id="4584165">len</span><span class="op" id="4584168">(</span><span class="ident" id="4584169">repl</span><span class="op" id="4584173">)</span>&nbsp;<span class="op" id="4584175">!=</span>&nbsp;<span class="num" id="4584178">0</span>&nbsp;<span class="op" id="4584180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584186">b</span><span class="op" id="4584187">.</span><span class="ident" id="4584188">WriteString</span><span class="op" id="4584199">(</span><span class="ident" id="4584200">s</span><span class="op" id="4584201">[</span><span class="ident" id="4584202">written</span><span class="op" id="4584209">:</span><span class="ident" id="4584210">i</span><span class="op" id="4584211">]</span><span class="op" id="4584212">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584218">b</span><span class="op" id="4584219">.</span><span class="ident" id="4584220">WriteString</span><span class="op" id="4584231">(</span><span class="ident" id="4584232">repl</span><span class="op" id="4584236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584242">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584291">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584327">written</span>&nbsp;<span class="op" id="4584335">=</span>&nbsp;<span class="ident" id="4584337">i</span>&nbsp;<span class="op" id="4584339">+</span>&nbsp;<span class="ident" id="4584341">utf8</span><span class="op" id="4584345">.</span><span class="ident" id="4584346">RuneLen</span><span class="op" id="4584353">(</span><span class="ident" id="4584354">r</span><span class="op" id="4584355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584360">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584364">}</span>&nbsp;<span class="keyword" id="4584366">else</span>&nbsp;<span class="keyword" id="4584371">if</span>&nbsp;<span class="ident" id="4584374">badRunes</span>&nbsp;<span class="op" id="4584383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584388">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584401">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584456">}</span>&nbsp;<span class="keyword" id="4584458">else</span>&nbsp;<span class="keyword" id="4584463">if</span>&nbsp;<span class="num" id="4584466">0xfdd0</span>&nbsp;<span class="op" id="4584473">&lt;=</span>&nbsp;<span class="ident" id="4584476">r</span>&nbsp;<span class="op" id="4584478">&amp;&amp;</span>&nbsp;<span class="ident" id="4584481">r</span>&nbsp;<span class="op" id="4584483">&lt;=</span>&nbsp;<span class="num" id="4584486">0xfdef</span>&nbsp;<span class="op" id="4584493">||</span>&nbsp;<span class="num" id="4584496">0xfff0</span>&nbsp;<span class="op" id="4584503">&lt;=</span>&nbsp;<span class="ident" id="4584506">r</span>&nbsp;<span class="op" id="4584508">&amp;&amp;</span>&nbsp;<span class="ident" id="4584511">r</span>&nbsp;<span class="op" id="4584513">&lt;=</span>&nbsp;<span class="num" id="4584516">0xffff</span>&nbsp;<span class="op" id="4584523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584528">fmt</span><span class="op" id="4584531">.</span><span class="ident" id="4584532">Fprintf</span><span class="op" id="4584539">(</span><span class="ident" id="4584540">b</span><span class="op" id="4584541">,</span>&nbsp;<span class="string" id="4584543">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="4584553">,</span>&nbsp;<span class="ident" id="4584555">s</span><span class="op" id="4584556">[</span><span class="ident" id="4584557">written</span><span class="op" id="4584564">:</span><span class="ident" id="4584565">i</span><span class="op" id="4584566">]</span><span class="op" id="4584567">,</span>&nbsp;<span class="ident" id="4584569">r</span><span class="op" id="4584570">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584575">written</span>&nbsp;<span class="op" id="4584583">=</span>&nbsp;<span class="ident" id="4584585">i</span>&nbsp;<span class="op" id="4584587">+</span>&nbsp;<span class="ident" id="4584589">utf8</span><span class="op" id="4584593">.</span><span class="ident" id="4584594">RuneLen</span><span class="op" id="4584601">(</span><span class="ident" id="4584602">r</span><span class="op" id="4584603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584613">if</span>&nbsp;<span class="ident" id="4584616">written</span>&nbsp;<span class="op" id="4584624">==</span>&nbsp;<span class="num" id="4584627">0</span>&nbsp;<span class="op" id="4584629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584633">return</span>&nbsp;<span class="ident" id="4584640">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4584643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584646">b</span><span class="op" id="4584647">.</span><span class="ident" id="4584648">WriteString</span><span class="op" id="4584659">(</span><span class="ident" id="4584660">s</span><span class="op" id="4584661">[</span><span class="ident" id="4584662">written</span><span class="op" id="4584669">:</span><span class="op" id="4584670">]</span><span class="op" id="4584671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584674">return</span>&nbsp;<span class="ident" id="4584681">b</span><span class="op" id="4584682">.</span><span class="ident" id="4584683">String</span><span class="op" id="4584689">(</span><span class="op" id="4584690">)</span><br>
<span class="lineno"></span><span class="op" id="4584692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4584695">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="4584767">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="4584842">func</span>&nbsp;<span class="ident" id="4584847">stripTags</span><span class="op" id="4584856">(</span><span class="ident" id="4584857">html</span>&nbsp;<span class="builtintype" id="4584862">string</span><span class="op" id="4584868">)</span>&nbsp;<span class="builtintype" id="4584870">string</span>&nbsp;<span class="op" id="4584877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4584880">var</span>&nbsp;<span class="ident" id="4584884">b</span>&nbsp;<span class="ident" id="4584886">bytes</span><span class="op" id="4584891">.</span><span class="ident" id="4584892">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4584900">s</span><span class="op" id="4584901">,</span>&nbsp;<span class="ident" id="4584903">c</span><span class="op" id="4584904">,</span>&nbsp;<span class="ident" id="4584906">i</span><span class="op" id="4584907">,</span>&nbsp;<span class="ident" id="4584909">allText</span>&nbsp;<span class="op" id="4584917">:=</span>&nbsp;<span class="op" id="4584920">[</span><span class="op" id="4584921">]</span><span class="builtintype" id="4584922">byte</span><span class="op" id="4584926">(</span><span class="ident" id="4584927">html</span><span class="op" id="4584931">)</span><span class="op" id="4584932">,</span>&nbsp;<span class="ident" id="4584934">context</span><span class="op" id="4584941">{</span><span class="op" id="4584942">}</span><span class="op" id="4584943">,</span>&nbsp;<span class="num" id="4584945">0</span><span class="op" id="4584946">,</span>&nbsp;<span class="builtintype" id="4584948">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4584954">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585009">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585052">for</span>&nbsp;<span class="ident" id="4585056">i</span>&nbsp;<span class="op" id="4585058">!=</span>&nbsp;<span class="builtinfunc" id="4585061">len</span><span class="op" id="4585064">(</span><span class="ident" id="4585065">s</span><span class="op" id="4585066">)</span>&nbsp;<span class="op" id="4585068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585072">if</span>&nbsp;<span class="ident" id="4585075">c</span><span class="op" id="4585076">.</span><span class="ident" id="4585077">delim</span>&nbsp;<span class="op" id="4585083">==</span>&nbsp;<span class="ident" id="4585086">delimNone</span>&nbsp;<span class="op" id="4585096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585101">st</span>&nbsp;<span class="op" id="4585104">:=</span>&nbsp;<span class="ident" id="4585107">c</span><span class="op" id="4585108">.</span><span class="ident" id="4585109">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585118">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585177">if</span>&nbsp;<span class="ident" id="4585180">c</span><span class="op" id="4585181">.</span><span class="ident" id="4585182">element</span>&nbsp;<span class="op" id="4585190">!=</span>&nbsp;<span class="ident" id="4585193">elementNone</span>&nbsp;<span class="op" id="4585205">&amp;&amp;</span>&nbsp;<span class="op" id="4585208">!</span><span class="ident" id="4585209">isInTag</span><span class="op" id="4585216">(</span><span class="ident" id="4585217">st</span><span class="op" id="4585219">)</span>&nbsp;<span class="op" id="4585221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585227">st</span>&nbsp;<span class="op" id="4585230">=</span>&nbsp;<span class="ident" id="4585232">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585252">d</span><span class="op" id="4585253">,</span>&nbsp;<span class="ident" id="4585255">nread</span>&nbsp;<span class="op" id="4585261">:=</span>&nbsp;<span class="ident" id="4585264">transitionFunc</span><span class="op" id="4585278">[</span><span class="ident" id="4585279">st</span><span class="op" id="4585281">]</span><span class="op" id="4585282">(</span><span class="ident" id="4585283">c</span><span class="op" id="4585284">,</span>&nbsp;<span class="ident" id="4585286">s</span><span class="op" id="4585287">[</span><span class="ident" id="4585288">i</span><span class="op" id="4585289">:</span><span class="op" id="4585290">]</span><span class="op" id="4585291">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585296">i1</span>&nbsp;<span class="op" id="4585299">:=</span>&nbsp;<span class="ident" id="4585302">i</span>&nbsp;<span class="op" id="4585304">+</span>&nbsp;<span class="ident" id="4585306">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585315">if</span>&nbsp;<span class="ident" id="4585318">c</span><span class="op" id="4585319">.</span><span class="ident" id="4585320">state</span>&nbsp;<span class="op" id="4585326">==</span>&nbsp;<span class="ident" id="4585329">stateText</span>&nbsp;<span class="op" id="4585339">||</span>&nbsp;<span class="ident" id="4585342">c</span><span class="op" id="4585343">.</span><span class="ident" id="4585344">state</span>&nbsp;<span class="op" id="4585350">==</span>&nbsp;<span class="ident" id="4585353">stateRCDATA</span>&nbsp;<span class="op" id="4585365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585371">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585427">j</span>&nbsp;<span class="op" id="4585429">:=</span>&nbsp;<span class="ident" id="4585432">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585439">if</span>&nbsp;<span class="ident" id="4585442">d</span><span class="op" id="4585443">.</span><span class="ident" id="4585444">state</span>&nbsp;<span class="op" id="4585450">!=</span>&nbsp;<span class="ident" id="4585453">c</span><span class="op" id="4585454">.</span><span class="ident" id="4585455">state</span>&nbsp;<span class="op" id="4585461">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585468">for</span>&nbsp;<span class="ident" id="4585472">j1</span>&nbsp;<span class="op" id="4585475">:=</span>&nbsp;<span class="ident" id="4585478">j</span>&nbsp;<span class="op" id="4585480">-</span>&nbsp;<span class="num" id="4585482">1</span><span class="op" id="4585483">;</span>&nbsp;<span class="ident" id="4585485">j1</span>&nbsp;<span class="op" id="4585488">&gt;=</span>&nbsp;<span class="ident" id="4585491">i</span><span class="op" id="4585492">;</span>&nbsp;<span class="ident" id="4585494">j1</span><span class="op" id="4585496">--</span>&nbsp;<span class="op" id="4585499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585507">if</span>&nbsp;<span class="ident" id="4585510">s</span><span class="op" id="4585511">[</span><span class="ident" id="4585512">j1</span><span class="op" id="4585514">]</span>&nbsp;<span class="op" id="4585516">==</span>&nbsp;<span class="string" id="4585519">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4585523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585532">j</span>&nbsp;<span class="op" id="4585534">=</span>&nbsp;<span class="ident" id="4585536">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585546">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585558">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585577">b</span><span class="op" id="4585578">.</span><span class="ident" id="4585579">Write</span><span class="op" id="4585584">(</span><span class="ident" id="4585585">s</span><span class="op" id="4585586">[</span><span class="ident" id="4585587">i</span><span class="op" id="4585588">:</span><span class="ident" id="4585589">j</span><span class="op" id="4585590">]</span><span class="op" id="4585591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585596">}</span>&nbsp;<span class="keyword" id="4585598">else</span>&nbsp;<span class="op" id="4585603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585609">allText</span>&nbsp;<span class="op" id="4585617">=</span>&nbsp;<span class="builtintype" id="4585619">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585633">c</span><span class="op" id="4585634">,</span>&nbsp;<span class="ident" id="4585636">i</span>&nbsp;<span class="op" id="4585638">=</span>&nbsp;<span class="ident" id="4585640">d</span><span class="op" id="4585641">,</span>&nbsp;<span class="ident" id="4585643">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585649">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585664">i1</span>&nbsp;<span class="op" id="4585667">:=</span>&nbsp;<span class="ident" id="4585670">i</span>&nbsp;<span class="op" id="4585672">+</span>&nbsp;<span class="ident" id="4585674">bytes</span><span class="op" id="4585679">.</span><span class="ident" id="4585680">IndexAny</span><span class="op" id="4585688">(</span><span class="ident" id="4585689">s</span><span class="op" id="4585690">[</span><span class="ident" id="4585691">i</span><span class="op" id="4585692">:</span><span class="op" id="4585693">]</span><span class="op" id="4585694">,</span>&nbsp;<span class="ident" id="4585696">delimEnds</span><span class="op" id="4585705">[</span><span class="ident" id="4585706">c</span><span class="op" id="4585707">.</span><span class="ident" id="4585708">delim</span><span class="op" id="4585713">]</span><span class="op" id="4585714">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585718">if</span>&nbsp;<span class="ident" id="4585721">i1</span>&nbsp;<span class="op" id="4585724">&lt;</span>&nbsp;<span class="ident" id="4585726">i</span>&nbsp;<span class="op" id="4585728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585733">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585745">if</span>&nbsp;<span class="ident" id="4585748">c</span><span class="op" id="4585749">.</span><span class="ident" id="4585750">delim</span>&nbsp;<span class="op" id="4585756">!=</span>&nbsp;<span class="ident" id="4585759">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="4585778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4585783">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585808">i1</span><span class="op" id="4585810">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585819">c</span><span class="op" id="4585820">,</span>&nbsp;<span class="ident" id="4585822">i</span>&nbsp;<span class="op" id="4585824">=</span>&nbsp;<span class="ident" id="4585826">context</span><span class="op" id="4585833">{</span><span class="ident" id="4585834">state</span><span class="op" id="4585839">:</span>&nbsp;<span class="ident" id="4585841">stateTag</span><span class="op" id="4585849">,</span>&nbsp;<span class="ident" id="4585851">element</span><span class="op" id="4585858">:</span>&nbsp;<span class="ident" id="4585860">c</span><span class="op" id="4585861">.</span><span class="ident" id="4585862">element</span><span class="op" id="4585869">}</span><span class="op" id="4585870">,</span>&nbsp;<span class="ident" id="4585872">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585879">if</span>&nbsp;<span class="ident" id="4585882">allText</span>&nbsp;<span class="op" id="4585890">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585894">return</span>&nbsp;<span class="ident" id="4585901">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585907">}</span>&nbsp;<span class="keyword" id="4585909">else</span>&nbsp;<span class="keyword" id="4585914">if</span>&nbsp;<span class="ident" id="4585917">c</span><span class="op" id="4585918">.</span><span class="ident" id="4585919">state</span>&nbsp;<span class="op" id="4585925">==</span>&nbsp;<span class="ident" id="4585928">stateText</span>&nbsp;<span class="op" id="4585938">||</span>&nbsp;<span class="ident" id="4585941">c</span><span class="op" id="4585942">.</span><span class="ident" id="4585943">state</span>&nbsp;<span class="op" id="4585949">==</span>&nbsp;<span class="ident" id="4585952">stateRCDATA</span>&nbsp;<span class="op" id="4585964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4585968">b</span><span class="op" id="4585969">.</span><span class="ident" id="4585970">Write</span><span class="op" id="4585975">(</span><span class="ident" id="4585976">s</span><span class="op" id="4585977">[</span><span class="ident" id="4585978">i</span><span class="op" id="4585979">:</span><span class="op" id="4585980">]</span><span class="op" id="4585981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4585984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4585987">return</span>&nbsp;<span class="ident" id="4585994">b</span><span class="op" id="4585995">.</span><span class="ident" id="4585996">String</span><span class="op" id="4586002">(</span><span class="op" id="4586003">)</span><br>
<span class="lineno">215</span><span class="op" id="4586005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4586008">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4586082">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4586114">func</span>&nbsp;<span class="ident" id="4586119">htmlNameFilter</span><span class="op" id="4586133">(</span><span class="ident" id="4586134">args</span>&nbsp;<span class="op" id="4586139">...</span><span class="keyword" id="4586142">interface</span><span class="op" id="4586151">{</span><span class="op" id="4586152">}</span><span class="op" id="4586153">)</span>&nbsp;<span class="builtintype" id="4586155">string</span>&nbsp;<span class="op" id="4586162">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586165">s</span><span class="op" id="4586166">,</span>&nbsp;<span class="ident" id="4586168">t</span>&nbsp;<span class="op" id="4586170">:=</span>&nbsp;<span class="ident" id="4586173">stringify</span><span class="op" id="4586182">(</span><span class="ident" id="4586183">args</span><span class="op" id="4586187">...</span><span class="op" id="4586190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586193">if</span>&nbsp;<span class="ident" id="4586196">t</span>&nbsp;<span class="op" id="4586198">==</span>&nbsp;<span class="ident" id="4586201">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="4586221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586225">return</span>&nbsp;<span class="ident" id="4586232">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586238">if</span>&nbsp;<span class="builtinfunc" id="4586241">len</span><span class="op" id="4586244">(</span><span class="ident" id="4586245">s</span><span class="op" id="4586246">)</span>&nbsp;<span class="op" id="4586248">==</span>&nbsp;<span class="num" id="4586251">0</span>&nbsp;<span class="op" id="4586253">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586257">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586305">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586341">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586399">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586460">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586475">return</span>&nbsp;<span class="ident" id="4586482">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4586501">s</span>&nbsp;<span class="op" id="4586503">=</span>&nbsp;<span class="ident" id="4586505">strings</span><span class="op" id="4586512">.</span><span class="ident" id="4586513">ToLower</span><span class="op" id="4586520">(</span><span class="ident" id="4586521">s</span><span class="op" id="4586522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586525">if</span>&nbsp;<span class="ident" id="4586528">t</span>&nbsp;<span class="op" id="4586530">:=</span>&nbsp;<span class="ident" id="4586533">attrType</span><span class="op" id="4586541">(</span><span class="ident" id="4586542">s</span><span class="op" id="4586543">)</span><span class="op" id="4586544">;</span>&nbsp;<span class="ident" id="4586546">t</span>&nbsp;<span class="op" id="4586548">!=</span>&nbsp;<span class="ident" id="4586551">contentTypePlain</span>&nbsp;<span class="op" id="4586568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586572">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4586644">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586661">return</span>&nbsp;<span class="ident" id="4586668">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586687">for</span>&nbsp;<span class="ident" id="4586691">_</span><span class="op" id="4586692">,</span>&nbsp;<span class="ident" id="4586694">r</span>&nbsp;<span class="op" id="4586696">:=</span>&nbsp;<span class="keyword" id="4586699">range</span>&nbsp;<span class="ident" id="4586705">s</span>&nbsp;<span class="op" id="4586707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586711">switch</span>&nbsp;<span class="op" id="4586718">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586722">case</span>&nbsp;<span class="string" id="4586727">&#39;0&#39;</span>&nbsp;<span class="op" id="4586731">&lt;=</span>&nbsp;<span class="ident" id="4586734">r</span>&nbsp;<span class="op" id="4586736">&amp;&amp;</span>&nbsp;<span class="ident" id="4586739">r</span>&nbsp;<span class="op" id="4586741">&lt;=</span>&nbsp;<span class="string" id="4586744">&#39;9&#39;</span><span class="op" id="4586747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586751">case</span>&nbsp;<span class="string" id="4586756">&#39;a&#39;</span>&nbsp;<span class="op" id="4586760">&lt;=</span>&nbsp;<span class="ident" id="4586763">r</span>&nbsp;<span class="op" id="4586765">&amp;&amp;</span>&nbsp;<span class="ident" id="4586768">r</span>&nbsp;<span class="op" id="4586770">&lt;=</span>&nbsp;<span class="string" id="4586773">&#39;z&#39;</span><span class="op" id="4586776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586780">default</span><span class="op" id="4586787">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586792">return</span>&nbsp;<span class="ident" id="4586799">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586816">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4586819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4586822">return</span>&nbsp;<span class="ident" id="4586829">s</span><br>
<span class="lineno"></span><span class="op" id="4586831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4586834">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="4586898">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4586964">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="4587041">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4587080">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4587155">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="4587185">func</span>&nbsp;<span class="ident" id="4587190">commentEscaper</span><span class="op" id="4587204">(</span><span class="ident" id="4587205">args</span>&nbsp;<span class="op" id="4587210">...</span><span class="keyword" id="4587213">interface</span><span class="op" id="4587222">{</span><span class="op" id="4587223">}</span><span class="op" id="4587224">)</span>&nbsp;<span class="builtintype" id="4587226">string</span>&nbsp;<span class="op" id="4587233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4587236">return</span>&nbsp;<span class="string" id="4587243">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4587246">}</span>
</div>
</body>
</html>
