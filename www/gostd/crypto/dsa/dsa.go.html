<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/dsa</h2>
<ul>
<li><a href="/gostd/crypto/dsa/dsa.go.html" class="current">dsa.go</a></li>
<li><a href="/gostd/crypto/dsa/dsa_test.go.html">dsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4619697">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4619752">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4619806">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4619857">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4619942">package</span>&nbsp;<span class="ident" id="4619950">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4619955">import</span>&nbsp;<span class="op" id="4619962">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4619965">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4619975">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4619981">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4619992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4619995">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4620074">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4620150">type</span>&nbsp;<span class="ident" id="4620155">Parameters</span>&nbsp;<span class="keyword" id="4620166">struct</span>&nbsp;<span class="op" id="4620173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620176">P</span><span class="op" id="4620177">,</span>&nbsp;<span class="ident" id="4620179">Q</span><span class="op" id="4620180">,</span>&nbsp;<span class="ident" id="4620182">G</span>&nbsp;<span class="op" id="4620184">*</span><span class="ident" id="4620185">big</span><span class="op" id="4620188">.</span><span class="ident" id="4620189">Int</span><br>
<span class="lineno"></span><span class="op" id="4620193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4620196">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4620238">type</span>&nbsp;<span class="ident" id="4620243">PublicKey</span>&nbsp;<span class="keyword" id="4620253">struct</span>&nbsp;<span class="op" id="4620260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620263">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620275">Y</span>&nbsp;<span class="op" id="4620277">*</span><span class="ident" id="4620278">big</span><span class="op" id="4620281">.</span><span class="ident" id="4620282">Int</span><br>
<span class="lineno"></span><span class="op" id="4620286">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4620289">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4620333">type</span>&nbsp;<span class="ident" id="4620338">PrivateKey</span>&nbsp;<span class="keyword" id="4620349">struct</span>&nbsp;<span class="op" id="4620356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620359">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620370">X</span>&nbsp;<span class="op" id="4620372">*</span><span class="ident" id="4620373">big</span><span class="op" id="4620376">.</span><span class="ident" id="4620377">Int</span><br>
<span class="lineno">30</span><span class="op" id="4620381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620384">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4620461">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4620537">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4620616">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4620647">var</span>&nbsp;<span class="ident" id="4620651">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4620671">=</span>&nbsp;<span class="ident" id="4620673">errors</span><span class="op" id="4620679">.</span><span class="ident" id="4620680">New</span><span class="op" id="4620683">(</span><span class="string" id="4620684">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4620716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620719">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4620798">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4620858">type</span>&nbsp;<span class="ident" id="4620863">ParameterSizes</span>&nbsp;<span class="builtintype" id="4620878">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4620883">const</span>&nbsp;<span class="op" id="4620889">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620892">L1024N160</span>&nbsp;<span class="ident" id="4620902">ParameterSizes</span>&nbsp;<span class="op" id="4620917">=</span>&nbsp;<span class="ident" id="4620919">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620925">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620936">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620947">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4620957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4620960">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4621040">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4621109">const</span>&nbsp;<span class="ident" id="4621115">numMRTests</span>&nbsp;<span class="op" id="4621126">=</span>&nbsp;<span class="num" id="4621128">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621132">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4621210">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4621270">func</span>&nbsp;<span class="ident" id="4621275">GenerateParameters</span><span class="op" id="4621293">(</span><span class="ident" id="4621294">params</span>&nbsp;<span class="op" id="4621301">*</span><span class="ident" id="4621302">Parameters</span><span class="op" id="4621312">,</span>&nbsp;<span class="ident" id="4621314">rand</span>&nbsp;<span class="ident" id="4621319">io</span><span class="op" id="4621321">.</span><span class="ident" id="4621322">Reader</span><span class="op" id="4621328">,</span>&nbsp;<span class="ident" id="4621330">sizes</span>&nbsp;<span class="ident" id="4621336">ParameterSizes</span><span class="op" id="4621350">)</span>&nbsp;<span class="op" id="4621352">(</span><span class="ident" id="4621353">err</span>&nbsp;<span class="builtintype" id="4621357">error</span><span class="op" id="4621362">)</span>&nbsp;<span class="op" id="4621364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4621367">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4621438">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4621507">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4621572">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621613">var</span>&nbsp;<span class="ident" id="4621617">L</span><span class="op" id="4621618">,</span>&nbsp;<span class="ident" id="4621620">N</span>&nbsp;<span class="builtintype" id="4621622">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621627">switch</span>&nbsp;<span class="ident" id="4621634">sizes</span>&nbsp;<span class="op" id="4621640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621643">case</span>&nbsp;<span class="ident" id="4621648">L1024N160</span><span class="op" id="4621657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621661">L</span>&nbsp;<span class="op" id="4621663">=</span>&nbsp;<span class="num" id="4621665">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621672">N</span>&nbsp;<span class="op" id="4621674">=</span>&nbsp;<span class="num" id="4621676">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621681">case</span>&nbsp;<span class="ident" id="4621686">L2048N224</span><span class="op" id="4621695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621699">L</span>&nbsp;<span class="op" id="4621701">=</span>&nbsp;<span class="num" id="4621703">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621710">N</span>&nbsp;<span class="op" id="4621712">=</span>&nbsp;<span class="num" id="4621714">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621719">case</span>&nbsp;<span class="ident" id="4621724">L2048N256</span><span class="op" id="4621733">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621737">L</span>&nbsp;<span class="op" id="4621739">=</span>&nbsp;<span class="num" id="4621741">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621748">N</span>&nbsp;<span class="op" id="4621750">=</span>&nbsp;<span class="num" id="4621752">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621757">case</span>&nbsp;<span class="ident" id="4621762">L3072N256</span><span class="op" id="4621771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621775">L</span>&nbsp;<span class="op" id="4621777">=</span>&nbsp;<span class="num" id="4621779">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621786">N</span>&nbsp;<span class="op" id="4621788">=</span>&nbsp;<span class="num" id="4621790">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621795">default</span><span class="op" id="4621802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4621806">return</span>&nbsp;<span class="ident" id="4621813">errors</span><span class="op" id="4621819">.</span><span class="ident" id="4621820">New</span><span class="op" id="4621823">(</span><span class="string" id="4621824">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4621860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4621863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621867">qBytes</span>&nbsp;<span class="op" id="4621874">:=</span>&nbsp;<span class="builtinfunc" id="4621877">make</span><span class="op" id="4621881">(</span><span class="op" id="4621882">[</span><span class="op" id="4621883">]</span><span class="builtintype" id="4621884">byte</span><span class="op" id="4621888">,</span>&nbsp;<span class="ident" id="4621890">N</span><span class="op" id="4621891">/</span><span class="num" id="4621892">8</span><span class="op" id="4621893">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621896">pBytes</span>&nbsp;<span class="op" id="4621903">:=</span>&nbsp;<span class="builtinfunc" id="4621906">make</span><span class="op" id="4621910">(</span><span class="op" id="4621911">[</span><span class="op" id="4621912">]</span><span class="builtintype" id="4621913">byte</span><span class="op" id="4621917">,</span>&nbsp;<span class="ident" id="4621919">L</span><span class="op" id="4621920">/</span><span class="num" id="4621921">8</span><span class="op" id="4621922">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621926">q</span>&nbsp;<span class="op" id="4621928">:=</span>&nbsp;<span class="builtinfunc" id="4621931">new</span><span class="op" id="4621934">(</span><span class="ident" id="4621935">big</span><span class="op" id="4621938">.</span><span class="ident" id="4621939">Int</span><span class="op" id="4621942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621945">p</span>&nbsp;<span class="op" id="4621947">:=</span>&nbsp;<span class="builtinfunc" id="4621950">new</span><span class="op" id="4621953">(</span><span class="ident" id="4621954">big</span><span class="op" id="4621957">.</span><span class="ident" id="4621958">Int</span><span class="op" id="4621961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621964">rem</span>&nbsp;<span class="op" id="4621968">:=</span>&nbsp;<span class="builtinfunc" id="4621971">new</span><span class="op" id="4621974">(</span><span class="ident" id="4621975">big</span><span class="op" id="4621978">.</span><span class="ident" id="4621979">Int</span><span class="op" id="4621982">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4621985">one</span>&nbsp;<span class="op" id="4621989">:=</span>&nbsp;<span class="builtinfunc" id="4621992">new</span><span class="op" id="4621995">(</span><span class="ident" id="4621996">big</span><span class="op" id="4621999">.</span><span class="ident" id="4622000">Int</span><span class="op" id="4622003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622006">one</span><span class="op" id="4622009">.</span><span class="ident" id="4622010">SetInt64</span><span class="op" id="4622018">(</span><span class="num" id="4622019">1</span><span class="op" id="4622020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4622023">GeneratePrimes</span><span class="op" id="4622037">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622040">for</span>&nbsp;<span class="op" id="4622044">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622048">_</span><span class="op" id="4622049">,</span>&nbsp;<span class="ident" id="4622051">err</span>&nbsp;<span class="op" id="4622055">=</span>&nbsp;<span class="ident" id="4622057">io</span><span class="op" id="4622059">.</span><span class="ident" id="4622060">ReadFull</span><span class="op" id="4622068">(</span><span class="ident" id="4622069">rand</span><span class="op" id="4622073">,</span>&nbsp;<span class="ident" id="4622075">qBytes</span><span class="op" id="4622081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622085">if</span>&nbsp;<span class="ident" id="4622088">err</span>&nbsp;<span class="op" id="4622092">!=</span>&nbsp;<span class="builtintype" id="4622095">nil</span>&nbsp;<span class="op" id="4622099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622104">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622118">qBytes</span><span class="op" id="4622124">[</span><span class="builtinfunc" id="4622125">len</span><span class="op" id="4622128">(</span><span class="ident" id="4622129">qBytes</span><span class="op" id="4622135">)</span><span class="op" id="4622136">-</span><span class="num" id="4622137">1</span><span class="op" id="4622138">]</span>&nbsp;<span class="op" id="4622140">|=</span>&nbsp;<span class="num" id="4622143">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622147">qBytes</span><span class="op" id="4622153">[</span><span class="num" id="4622154">0</span><span class="op" id="4622155">]</span>&nbsp;<span class="op" id="4622157">|=</span>&nbsp;<span class="num" id="4622160">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622167">q</span><span class="op" id="4622168">.</span><span class="ident" id="4622169">SetBytes</span><span class="op" id="4622177">(</span><span class="ident" id="4622178">qBytes</span><span class="op" id="4622184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622189">if</span>&nbsp;<span class="op" id="4622192">!</span><span class="ident" id="4622193">q</span><span class="op" id="4622194">.</span><span class="ident" id="4622195">ProbablyPrime</span><span class="op" id="4622208">(</span><span class="ident" id="4622209">numMRTests</span><span class="op" id="4622219">)</span>&nbsp;<span class="op" id="4622221">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622226">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622242">for</span>&nbsp;<span class="ident" id="4622246">i</span>&nbsp;<span class="op" id="4622248">:=</span>&nbsp;<span class="num" id="4622251">0</span><span class="op" id="4622252">;</span>&nbsp;<span class="ident" id="4622254">i</span>&nbsp;<span class="op" id="4622256">&lt;</span>&nbsp;<span class="num" id="4622258">4</span><span class="op" id="4622259">*</span><span class="ident" id="4622260">L</span><span class="op" id="4622261">;</span>&nbsp;<span class="ident" id="4622263">i</span><span class="op" id="4622264">++</span>&nbsp;<span class="op" id="4622267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622272">_</span><span class="op" id="4622273">,</span>&nbsp;<span class="ident" id="4622275">err</span>&nbsp;<span class="op" id="4622279">=</span>&nbsp;<span class="ident" id="4622281">io</span><span class="op" id="4622283">.</span><span class="ident" id="4622284">ReadFull</span><span class="op" id="4622292">(</span><span class="ident" id="4622293">rand</span><span class="op" id="4622297">,</span>&nbsp;<span class="ident" id="4622299">pBytes</span><span class="op" id="4622305">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622310">if</span>&nbsp;<span class="ident" id="4622313">err</span>&nbsp;<span class="op" id="4622317">!=</span>&nbsp;<span class="builtintype" id="4622320">nil</span>&nbsp;<span class="op" id="4622324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622330">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622346">pBytes</span><span class="op" id="4622352">[</span><span class="builtinfunc" id="4622353">len</span><span class="op" id="4622356">(</span><span class="ident" id="4622357">pBytes</span><span class="op" id="4622363">)</span><span class="op" id="4622364">-</span><span class="num" id="4622365">1</span><span class="op" id="4622366">]</span>&nbsp;<span class="op" id="4622368">|=</span>&nbsp;<span class="num" id="4622371">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622376">pBytes</span><span class="op" id="4622382">[</span><span class="num" id="4622383">0</span><span class="op" id="4622384">]</span>&nbsp;<span class="op" id="4622386">|=</span>&nbsp;<span class="num" id="4622389">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622398">p</span><span class="op" id="4622399">.</span><span class="ident" id="4622400">SetBytes</span><span class="op" id="4622408">(</span><span class="ident" id="4622409">pBytes</span><span class="op" id="4622415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622420">rem</span><span class="op" id="4622423">.</span><span class="ident" id="4622424">Mod</span><span class="op" id="4622427">(</span><span class="ident" id="4622428">p</span><span class="op" id="4622429">,</span>&nbsp;<span class="ident" id="4622431">q</span><span class="op" id="4622432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622437">rem</span><span class="op" id="4622440">.</span><span class="ident" id="4622441">Sub</span><span class="op" id="4622444">(</span><span class="ident" id="4622445">rem</span><span class="op" id="4622448">,</span>&nbsp;<span class="ident" id="4622450">one</span><span class="op" id="4622453">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622458">p</span><span class="op" id="4622459">.</span><span class="ident" id="4622460">Sub</span><span class="op" id="4622463">(</span><span class="ident" id="4622464">p</span><span class="op" id="4622465">,</span>&nbsp;<span class="ident" id="4622467">rem</span><span class="op" id="4622470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622475">if</span>&nbsp;<span class="ident" id="4622478">p</span><span class="op" id="4622479">.</span><span class="ident" id="4622480">BitLen</span><span class="op" id="4622486">(</span><span class="op" id="4622487">)</span>&nbsp;<span class="op" id="4622489">&lt;</span>&nbsp;<span class="ident" id="4622491">L</span>&nbsp;<span class="op" id="4622493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622499">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622517">if</span>&nbsp;<span class="op" id="4622520">!</span><span class="ident" id="4622521">p</span><span class="op" id="4622522">.</span><span class="ident" id="4622523">ProbablyPrime</span><span class="op" id="4622536">(</span><span class="ident" id="4622537">numMRTests</span><span class="op" id="4622547">)</span>&nbsp;<span class="op" id="4622549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622555">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622573">params</span><span class="op" id="4622579">.</span><span class="ident" id="4622580">P</span>&nbsp;<span class="op" id="4622582">=</span>&nbsp;<span class="ident" id="4622584">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622589">params</span><span class="op" id="4622595">.</span><span class="ident" id="4622596">Q</span>&nbsp;<span class="op" id="4622598">=</span>&nbsp;<span class="ident" id="4622600">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622605">break</span>&nbsp;<span class="ident" id="4622611">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622635">h</span>&nbsp;<span class="op" id="4622637">:=</span>&nbsp;<span class="builtinfunc" id="4622640">new</span><span class="op" id="4622643">(</span><span class="ident" id="4622644">big</span><span class="op" id="4622647">.</span><span class="ident" id="4622648">Int</span><span class="op" id="4622651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622654">h</span><span class="op" id="4622655">.</span><span class="ident" id="4622656">SetInt64</span><span class="op" id="4622664">(</span><span class="num" id="4622665">2</span><span class="op" id="4622666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622669">g</span>&nbsp;<span class="op" id="4622671">:=</span>&nbsp;<span class="builtinfunc" id="4622674">new</span><span class="op" id="4622677">(</span><span class="ident" id="4622678">big</span><span class="op" id="4622681">.</span><span class="ident" id="4622682">Int</span><span class="op" id="4622685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622689">pm1</span>&nbsp;<span class="op" id="4622693">:=</span>&nbsp;<span class="builtinfunc" id="4622696">new</span><span class="op" id="4622699">(</span><span class="ident" id="4622700">big</span><span class="op" id="4622703">.</span><span class="ident" id="4622704">Int</span><span class="op" id="4622707">)</span><span class="op" id="4622708">.</span><span class="ident" id="4622709">Sub</span><span class="op" id="4622712">(</span><span class="ident" id="4622713">p</span><span class="op" id="4622714">,</span>&nbsp;<span class="ident" id="4622716">one</span><span class="op" id="4622719">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622722">e</span>&nbsp;<span class="op" id="4622724">:=</span>&nbsp;<span class="builtinfunc" id="4622727">new</span><span class="op" id="4622730">(</span><span class="ident" id="4622731">big</span><span class="op" id="4622734">.</span><span class="ident" id="4622735">Int</span><span class="op" id="4622738">)</span><span class="op" id="4622739">.</span><span class="ident" id="4622740">Div</span><span class="op" id="4622743">(</span><span class="ident" id="4622744">pm1</span><span class="op" id="4622747">,</span>&nbsp;<span class="ident" id="4622749">q</span><span class="op" id="4622750">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622754">for</span>&nbsp;<span class="op" id="4622758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622762">g</span><span class="op" id="4622763">.</span><span class="ident" id="4622764">Exp</span><span class="op" id="4622767">(</span><span class="ident" id="4622768">h</span><span class="op" id="4622769">,</span>&nbsp;<span class="ident" id="4622771">e</span><span class="op" id="4622772">,</span>&nbsp;<span class="ident" id="4622774">p</span><span class="op" id="4622775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622779">if</span>&nbsp;<span class="ident" id="4622782">g</span><span class="op" id="4622783">.</span><span class="ident" id="4622784">Cmp</span><span class="op" id="4622787">(</span><span class="ident" id="4622788">one</span><span class="op" id="4622791">)</span>&nbsp;<span class="op" id="4622793">==</span>&nbsp;<span class="num" id="4622796">0</span>&nbsp;<span class="op" id="4622798">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622803">h</span><span class="op" id="4622804">.</span><span class="ident" id="4622805">Add</span><span class="op" id="4622808">(</span><span class="ident" id="4622809">h</span><span class="op" id="4622810">,</span>&nbsp;<span class="ident" id="4622812">one</span><span class="op" id="4622815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622820">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4622836">params</span><span class="op" id="4622842">.</span><span class="ident" id="4622843">G</span>&nbsp;<span class="op" id="4622845">=</span>&nbsp;<span class="ident" id="4622847">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4622851">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4622859">}</span><br>
<span class="lineno"></span><span class="op" id="4622861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4622864">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4622938">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4623000">func</span>&nbsp;<span class="ident" id="4623005">GenerateKey</span><span class="op" id="4623016">(</span><span class="ident" id="4623017">priv</span>&nbsp;<span class="op" id="4623022">*</span><span class="ident" id="4623023">PrivateKey</span><span class="op" id="4623033">,</span>&nbsp;<span class="ident" id="4623035">rand</span>&nbsp;<span class="ident" id="4623040">io</span><span class="op" id="4623042">.</span><span class="ident" id="4623043">Reader</span><span class="op" id="4623049">)</span>&nbsp;<span class="builtintype" id="4623051">error</span>&nbsp;<span class="op" id="4623057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623060">if</span>&nbsp;<span class="ident" id="4623063">priv</span><span class="op" id="4623067">.</span><span class="ident" id="4623068">P</span>&nbsp;<span class="op" id="4623070">==</span>&nbsp;<span class="builtintype" id="4623073">nil</span>&nbsp;<span class="op" id="4623077">||</span>&nbsp;<span class="ident" id="4623080">priv</span><span class="op" id="4623084">.</span><span class="ident" id="4623085">Q</span>&nbsp;<span class="op" id="4623087">==</span>&nbsp;<span class="builtintype" id="4623090">nil</span>&nbsp;<span class="op" id="4623094">||</span>&nbsp;<span class="ident" id="4623097">priv</span><span class="op" id="4623101">.</span><span class="ident" id="4623102">G</span>&nbsp;<span class="op" id="4623104">==</span>&nbsp;<span class="builtintype" id="4623107">nil</span>&nbsp;<span class="op" id="4623111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623115">return</span>&nbsp;<span class="ident" id="4623122">errors</span><span class="op" id="4623128">.</span><span class="ident" id="4623129">New</span><span class="op" id="4623132">(</span><span class="string" id="4623133">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4623190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623193">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623197">x</span>&nbsp;<span class="op" id="4623199">:=</span>&nbsp;<span class="builtinfunc" id="4623202">new</span><span class="op" id="4623205">(</span><span class="ident" id="4623206">big</span><span class="op" id="4623209">.</span><span class="ident" id="4623210">Int</span><span class="op" id="4623213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623216">xBytes</span>&nbsp;<span class="op" id="4623223">:=</span>&nbsp;<span class="builtinfunc" id="4623226">make</span><span class="op" id="4623230">(</span><span class="op" id="4623231">[</span><span class="op" id="4623232">]</span><span class="builtintype" id="4623233">byte</span><span class="op" id="4623237">,</span>&nbsp;<span class="ident" id="4623239">priv</span><span class="op" id="4623243">.</span><span class="ident" id="4623244">Q</span><span class="op" id="4623245">.</span><span class="ident" id="4623246">BitLen</span><span class="op" id="4623252">(</span><span class="op" id="4623253">)</span><span class="op" id="4623254">/</span><span class="num" id="4623255">8</span><span class="op" id="4623256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623260">for</span>&nbsp;<span class="op" id="4623264">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623268">_</span><span class="op" id="4623269">,</span>&nbsp;<span class="ident" id="4623271">err</span>&nbsp;<span class="op" id="4623275">:=</span>&nbsp;<span class="ident" id="4623278">io</span><span class="op" id="4623280">.</span><span class="ident" id="4623281">ReadFull</span><span class="op" id="4623289">(</span><span class="ident" id="4623290">rand</span><span class="op" id="4623294">,</span>&nbsp;<span class="ident" id="4623296">xBytes</span><span class="op" id="4623302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623306">if</span>&nbsp;<span class="ident" id="4623309">err</span>&nbsp;<span class="op" id="4623313">!=</span>&nbsp;<span class="builtintype" id="4623316">nil</span>&nbsp;<span class="op" id="4623320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623325">return</span>&nbsp;<span class="ident" id="4623332">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623342">x</span><span class="op" id="4623343">.</span><span class="ident" id="4623344">SetBytes</span><span class="op" id="4623352">(</span><span class="ident" id="4623353">xBytes</span><span class="op" id="4623359">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623363">if</span>&nbsp;<span class="ident" id="4623366">x</span><span class="op" id="4623367">.</span><span class="ident" id="4623368">Sign</span><span class="op" id="4623372">(</span><span class="op" id="4623373">)</span>&nbsp;<span class="op" id="4623375">!=</span>&nbsp;<span class="num" id="4623378">0</span>&nbsp;<span class="op" id="4623380">&amp;&amp;</span>&nbsp;<span class="ident" id="4623383">x</span><span class="op" id="4623384">.</span><span class="ident" id="4623385">Cmp</span><span class="op" id="4623388">(</span><span class="ident" id="4623389">priv</span><span class="op" id="4623393">.</span><span class="ident" id="4623394">Q</span><span class="op" id="4623395">)</span>&nbsp;<span class="op" id="4623397">&lt;</span>&nbsp;<span class="num" id="4623399">0</span>&nbsp;<span class="op" id="4623401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623406">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4623417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623421">priv</span><span class="op" id="4623425">.</span><span class="ident" id="4623426">X</span>&nbsp;<span class="op" id="4623428">=</span>&nbsp;<span class="ident" id="4623430">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623433">priv</span><span class="op" id="4623437">.</span><span class="ident" id="4623438">Y</span>&nbsp;<span class="op" id="4623440">=</span>&nbsp;<span class="builtinfunc" id="4623442">new</span><span class="op" id="4623445">(</span><span class="ident" id="4623446">big</span><span class="op" id="4623449">.</span><span class="ident" id="4623450">Int</span><span class="op" id="4623453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623456">priv</span><span class="op" id="4623460">.</span><span class="ident" id="4623461">Y</span><span class="op" id="4623462">.</span><span class="ident" id="4623463">Exp</span><span class="op" id="4623466">(</span><span class="ident" id="4623467">priv</span><span class="op" id="4623471">.</span><span class="ident" id="4623472">G</span><span class="op" id="4623473">,</span>&nbsp;<span class="ident" id="4623475">x</span><span class="op" id="4623476">,</span>&nbsp;<span class="ident" id="4623478">priv</span><span class="op" id="4623482">.</span><span class="ident" id="4623483">P</span><span class="op" id="4623484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623487">return</span>&nbsp;<span class="builtintype" id="4623494">nil</span><br>
<span class="lineno"></span><span class="op" id="4623498">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4623501">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4623578">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4623656">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4623727">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4623765">func</span>&nbsp;<span class="ident" id="4623770">fermatInverse</span><span class="op" id="4623783">(</span><span class="ident" id="4623784">k</span><span class="op" id="4623785">,</span>&nbsp;<span class="ident" id="4623787">P</span>&nbsp;<span class="op" id="4623789">*</span><span class="ident" id="4623790">big</span><span class="op" id="4623793">.</span><span class="ident" id="4623794">Int</span><span class="op" id="4623797">)</span>&nbsp;<span class="op" id="4623799">*</span><span class="ident" id="4623800">big</span><span class="op" id="4623803">.</span><span class="ident" id="4623804">Int</span>&nbsp;<span class="op" id="4623808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623811">two</span>&nbsp;<span class="op" id="4623815">:=</span>&nbsp;<span class="ident" id="4623818">big</span><span class="op" id="4623821">.</span><span class="ident" id="4623822">NewInt</span><span class="op" id="4623828">(</span><span class="num" id="4623829">2</span><span class="op" id="4623830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623833">pMinus2</span>&nbsp;<span class="op" id="4623841">:=</span>&nbsp;<span class="builtinfunc" id="4623844">new</span><span class="op" id="4623847">(</span><span class="ident" id="4623848">big</span><span class="op" id="4623851">.</span><span class="ident" id="4623852">Int</span><span class="op" id="4623855">)</span><span class="op" id="4623856">.</span><span class="ident" id="4623857">Sub</span><span class="op" id="4623860">(</span><span class="ident" id="4623861">P</span><span class="op" id="4623862">,</span>&nbsp;<span class="ident" id="4623864">two</span><span class="op" id="4623867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4623870">return</span>&nbsp;<span class="builtinfunc" id="4623877">new</span><span class="op" id="4623880">(</span><span class="ident" id="4623881">big</span><span class="op" id="4623884">.</span><span class="ident" id="4623885">Int</span><span class="op" id="4623888">)</span><span class="op" id="4623889">.</span><span class="ident" id="4623890">Exp</span><span class="op" id="4623893">(</span><span class="ident" id="4623894">k</span><span class="op" id="4623895">,</span>&nbsp;<span class="ident" id="4623897">pMinus2</span><span class="op" id="4623904">,</span>&nbsp;<span class="ident" id="4623906">P</span><span class="op" id="4623907">)</span><br>
<span class="lineno"></span><span class="op" id="4623909">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4623912">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4623992">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4624070">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4624149">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4624158">//</span><br>
<span class="lineno"></span><span class="comment" id="4624161">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4624241">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4624316">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4624338">func</span>&nbsp;<span class="ident" id="4624343">Sign</span><span class="op" id="4624347">(</span><span class="ident" id="4624348">rand</span>&nbsp;<span class="ident" id="4624353">io</span><span class="op" id="4624355">.</span><span class="ident" id="4624356">Reader</span><span class="op" id="4624362">,</span>&nbsp;<span class="ident" id="4624364">priv</span>&nbsp;<span class="op" id="4624369">*</span><span class="ident" id="4624370">PrivateKey</span><span class="op" id="4624380">,</span>&nbsp;<span class="ident" id="4624382">hash</span>&nbsp;<span class="op" id="4624387">[</span><span class="op" id="4624388">]</span><span class="builtintype" id="4624389">byte</span><span class="op" id="4624393">)</span>&nbsp;<span class="op" id="4624395">(</span><span class="ident" id="4624396">r</span><span class="op" id="4624397">,</span>&nbsp;<span class="ident" id="4624399">s</span>&nbsp;<span class="op" id="4624401">*</span><span class="ident" id="4624402">big</span><span class="op" id="4624405">.</span><span class="ident" id="4624406">Int</span><span class="op" id="4624409">,</span>&nbsp;<span class="ident" id="4624411">err</span>&nbsp;<span class="builtintype" id="4624415">error</span><span class="op" id="4624420">)</span>&nbsp;<span class="op" id="4624422">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4624425">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624454">n</span>&nbsp;<span class="op" id="4624456">:=</span>&nbsp;<span class="ident" id="4624459">priv</span><span class="op" id="4624463">.</span><span class="ident" id="4624464">Q</span><span class="op" id="4624465">.</span><span class="ident" id="4624466">BitLen</span><span class="op" id="4624472">(</span><span class="op" id="4624473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624476">if</span>&nbsp;<span class="ident" id="4624479">n</span><span class="op" id="4624480">&amp;</span><span class="num" id="4624481">7</span>&nbsp;<span class="op" id="4624483">!=</span>&nbsp;<span class="num" id="4624486">0</span>&nbsp;<span class="op" id="4624488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624492">err</span>&nbsp;<span class="op" id="4624496">=</span>&nbsp;<span class="ident" id="4624498">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624531">n</span>&nbsp;<span class="op" id="4624533">&gt;&gt;=</span>&nbsp;<span class="num" id="4624537">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624541">for</span>&nbsp;<span class="op" id="4624545">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624549">k</span>&nbsp;<span class="op" id="4624551">:=</span>&nbsp;<span class="builtinfunc" id="4624554">new</span><span class="op" id="4624557">(</span><span class="ident" id="4624558">big</span><span class="op" id="4624561">.</span><span class="ident" id="4624562">Int</span><span class="op" id="4624565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624569">buf</span>&nbsp;<span class="op" id="4624573">:=</span>&nbsp;<span class="builtinfunc" id="4624576">make</span><span class="op" id="4624580">(</span><span class="op" id="4624581">[</span><span class="op" id="4624582">]</span><span class="builtintype" id="4624583">byte</span><span class="op" id="4624587">,</span>&nbsp;<span class="ident" id="4624589">n</span><span class="op" id="4624590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624594">for</span>&nbsp;<span class="op" id="4624598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624603">_</span><span class="op" id="4624604">,</span>&nbsp;<span class="ident" id="4624606">err</span>&nbsp;<span class="op" id="4624610">=</span>&nbsp;<span class="ident" id="4624612">io</span><span class="op" id="4624614">.</span><span class="ident" id="4624615">ReadFull</span><span class="op" id="4624623">(</span><span class="ident" id="4624624">rand</span><span class="op" id="4624628">,</span>&nbsp;<span class="ident" id="4624630">buf</span><span class="op" id="4624633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624638">if</span>&nbsp;<span class="ident" id="4624641">err</span>&nbsp;<span class="op" id="4624645">!=</span>&nbsp;<span class="builtintype" id="4624648">nil</span>&nbsp;<span class="op" id="4624652">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624658">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624673">k</span><span class="op" id="4624674">.</span><span class="ident" id="4624675">SetBytes</span><span class="op" id="4624683">(</span><span class="ident" id="4624684">buf</span><span class="op" id="4624687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624692">if</span>&nbsp;<span class="ident" id="4624695">k</span><span class="op" id="4624696">.</span><span class="ident" id="4624697">Sign</span><span class="op" id="4624701">(</span><span class="op" id="4624702">)</span>&nbsp;<span class="op" id="4624704">&gt;</span>&nbsp;<span class="num" id="4624706">0</span>&nbsp;<span class="op" id="4624708">&amp;&amp;</span>&nbsp;<span class="ident" id="4624711">k</span><span class="op" id="4624712">.</span><span class="ident" id="4624713">Cmp</span><span class="op" id="4624716">(</span><span class="ident" id="4624717">priv</span><span class="op" id="4624721">.</span><span class="ident" id="4624722">Q</span><span class="op" id="4624723">)</span>&nbsp;<span class="op" id="4624725">&lt;</span>&nbsp;<span class="num" id="4624727">0</span>&nbsp;<span class="op" id="4624729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624735">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624753">kInv</span>&nbsp;<span class="op" id="4624758">:=</span>&nbsp;<span class="ident" id="4624761">fermatInverse</span><span class="op" id="4624774">(</span><span class="ident" id="4624775">k</span><span class="op" id="4624776">,</span>&nbsp;<span class="ident" id="4624778">priv</span><span class="op" id="4624782">.</span><span class="ident" id="4624783">Q</span><span class="op" id="4624784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624789">r</span>&nbsp;<span class="op" id="4624791">=</span>&nbsp;<span class="builtinfunc" id="4624793">new</span><span class="op" id="4624796">(</span><span class="ident" id="4624797">big</span><span class="op" id="4624800">.</span><span class="ident" id="4624801">Int</span><span class="op" id="4624804">)</span><span class="op" id="4624805">.</span><span class="ident" id="4624806">Exp</span><span class="op" id="4624809">(</span><span class="ident" id="4624810">priv</span><span class="op" id="4624814">.</span><span class="ident" id="4624815">G</span><span class="op" id="4624816">,</span>&nbsp;<span class="ident" id="4624818">k</span><span class="op" id="4624819">,</span>&nbsp;<span class="ident" id="4624821">priv</span><span class="op" id="4624825">.</span><span class="ident" id="4624826">P</span><span class="op" id="4624827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624831">r</span><span class="op" id="4624832">.</span><span class="ident" id="4624833">Mod</span><span class="op" id="4624836">(</span><span class="ident" id="4624837">r</span><span class="op" id="4624838">,</span>&nbsp;<span class="ident" id="4624840">priv</span><span class="op" id="4624844">.</span><span class="ident" id="4624845">Q</span><span class="op" id="4624846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624851">if</span>&nbsp;<span class="ident" id="4624854">r</span><span class="op" id="4624855">.</span><span class="ident" id="4624856">Sign</span><span class="op" id="4624860">(</span><span class="op" id="4624861">)</span>&nbsp;<span class="op" id="4624863">==</span>&nbsp;<span class="num" id="4624866">0</span>&nbsp;<span class="op" id="4624868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4624873">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4624884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624889">z</span>&nbsp;<span class="op" id="4624891">:=</span>&nbsp;<span class="ident" id="4624894">k</span><span class="op" id="4624895">.</span><span class="ident" id="4624896">SetBytes</span><span class="op" id="4624904">(</span><span class="ident" id="4624905">hash</span><span class="op" id="4624909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624914">s</span>&nbsp;<span class="op" id="4624916">=</span>&nbsp;<span class="builtinfunc" id="4624918">new</span><span class="op" id="4624921">(</span><span class="ident" id="4624922">big</span><span class="op" id="4624925">.</span><span class="ident" id="4624926">Int</span><span class="op" id="4624929">)</span><span class="op" id="4624930">.</span><span class="ident" id="4624931">Mul</span><span class="op" id="4624934">(</span><span class="ident" id="4624935">priv</span><span class="op" id="4624939">.</span><span class="ident" id="4624940">X</span><span class="op" id="4624941">,</span>&nbsp;<span class="ident" id="4624943">r</span><span class="op" id="4624944">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624948">s</span><span class="op" id="4624949">.</span><span class="ident" id="4624950">Add</span><span class="op" id="4624953">(</span><span class="ident" id="4624954">s</span><span class="op" id="4624955">,</span>&nbsp;<span class="ident" id="4624957">z</span><span class="op" id="4624958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624962">s</span><span class="op" id="4624963">.</span><span class="ident" id="4624964">Mod</span><span class="op" id="4624967">(</span><span class="ident" id="4624968">s</span><span class="op" id="4624969">,</span>&nbsp;<span class="ident" id="4624971">priv</span><span class="op" id="4624975">.</span><span class="ident" id="4624976">Q</span><span class="op" id="4624977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624981">s</span><span class="op" id="4624982">.</span><span class="ident" id="4624983">Mul</span><span class="op" id="4624986">(</span><span class="ident" id="4624987">s</span><span class="op" id="4624988">,</span>&nbsp;<span class="ident" id="4624990">kInv</span><span class="op" id="4624994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4624998">s</span><span class="op" id="4624999">.</span><span class="ident" id="4625000">Mod</span><span class="op" id="4625003">(</span><span class="ident" id="4625004">s</span><span class="op" id="4625005">,</span>&nbsp;<span class="ident" id="4625007">priv</span><span class="op" id="4625011">.</span><span class="ident" id="4625012">Q</span><span class="op" id="4625013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625018">if</span>&nbsp;<span class="ident" id="4625021">s</span><span class="op" id="4625022">.</span><span class="ident" id="4625023">Sign</span><span class="op" id="4625027">(</span><span class="op" id="4625028">)</span>&nbsp;<span class="op" id="4625030">!=</span>&nbsp;<span class="num" id="4625033">0</span>&nbsp;<span class="op" id="4625035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625040">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625055">return</span><br>
<span class="lineno"></span><span class="op" id="4625062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4625065">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4625144">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4625187">//</span><br>
<span class="lineno"></span><span class="comment" id="4625190">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4625270">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4625345">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4625367">func</span>&nbsp;<span class="ident" id="4625372">Verify</span><span class="op" id="4625378">(</span><span class="ident" id="4625379">pub</span>&nbsp;<span class="op" id="4625383">*</span><span class="ident" id="4625384">PublicKey</span><span class="op" id="4625393">,</span>&nbsp;<span class="ident" id="4625395">hash</span>&nbsp;<span class="op" id="4625400">[</span><span class="op" id="4625401">]</span><span class="builtintype" id="4625402">byte</span><span class="op" id="4625406">,</span>&nbsp;<span class="ident" id="4625408">r</span><span class="op" id="4625409">,</span>&nbsp;<span class="ident" id="4625411">s</span>&nbsp;<span class="op" id="4625413">*</span><span class="ident" id="4625414">big</span><span class="op" id="4625417">.</span><span class="ident" id="4625418">Int</span><span class="op" id="4625421">)</span>&nbsp;<span class="builtintype" id="4625423">bool</span>&nbsp;<span class="op" id="4625428">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4625431">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625460">if</span>&nbsp;<span class="ident" id="4625463">r</span><span class="op" id="4625464">.</span><span class="ident" id="4625465">Sign</span><span class="op" id="4625469">(</span><span class="op" id="4625470">)</span>&nbsp;<span class="op" id="4625472">&lt;</span>&nbsp;<span class="num" id="4625474">1</span>&nbsp;<span class="op" id="4625476">||</span>&nbsp;<span class="ident" id="4625479">r</span><span class="op" id="4625480">.</span><span class="ident" id="4625481">Cmp</span><span class="op" id="4625484">(</span><span class="ident" id="4625485">pub</span><span class="op" id="4625488">.</span><span class="ident" id="4625489">Q</span><span class="op" id="4625490">)</span>&nbsp;<span class="op" id="4625492">&gt;=</span>&nbsp;<span class="num" id="4625495">0</span>&nbsp;<span class="op" id="4625497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625501">return</span>&nbsp;<span class="builtintype" id="4625508">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625515">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625518">if</span>&nbsp;<span class="ident" id="4625521">s</span><span class="op" id="4625522">.</span><span class="ident" id="4625523">Sign</span><span class="op" id="4625527">(</span><span class="op" id="4625528">)</span>&nbsp;<span class="op" id="4625530">&lt;</span>&nbsp;<span class="num" id="4625532">1</span>&nbsp;<span class="op" id="4625534">||</span>&nbsp;<span class="ident" id="4625537">s</span><span class="op" id="4625538">.</span><span class="ident" id="4625539">Cmp</span><span class="op" id="4625542">(</span><span class="ident" id="4625543">pub</span><span class="op" id="4625546">.</span><span class="ident" id="4625547">Q</span><span class="op" id="4625548">)</span>&nbsp;<span class="op" id="4625550">&gt;=</span>&nbsp;<span class="num" id="4625553">0</span>&nbsp;<span class="op" id="4625555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625559">return</span>&nbsp;<span class="builtintype" id="4625566">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625577">w</span>&nbsp;<span class="op" id="4625579">:=</span>&nbsp;<span class="builtinfunc" id="4625582">new</span><span class="op" id="4625585">(</span><span class="ident" id="4625586">big</span><span class="op" id="4625589">.</span><span class="ident" id="4625590">Int</span><span class="op" id="4625593">)</span><span class="op" id="4625594">.</span><span class="ident" id="4625595">ModInverse</span><span class="op" id="4625605">(</span><span class="ident" id="4625606">s</span><span class="op" id="4625607">,</span>&nbsp;<span class="ident" id="4625609">pub</span><span class="op" id="4625612">.</span><span class="ident" id="4625613">Q</span><span class="op" id="4625614">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625618">n</span>&nbsp;<span class="op" id="4625620">:=</span>&nbsp;<span class="ident" id="4625623">pub</span><span class="op" id="4625626">.</span><span class="ident" id="4625627">Q</span><span class="op" id="4625628">.</span><span class="ident" id="4625629">BitLen</span><span class="op" id="4625635">(</span><span class="op" id="4625636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625639">if</span>&nbsp;<span class="ident" id="4625642">n</span><span class="op" id="4625643">&amp;</span><span class="num" id="4625644">7</span>&nbsp;<span class="op" id="4625646">!=</span>&nbsp;<span class="num" id="4625649">0</span>&nbsp;<span class="op" id="4625651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625655">return</span>&nbsp;<span class="builtintype" id="4625662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4625669">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625672">z</span>&nbsp;<span class="op" id="4625674">:=</span>&nbsp;<span class="builtinfunc" id="4625677">new</span><span class="op" id="4625680">(</span><span class="ident" id="4625681">big</span><span class="op" id="4625684">.</span><span class="ident" id="4625685">Int</span><span class="op" id="4625688">)</span><span class="op" id="4625689">.</span><span class="ident" id="4625690">SetBytes</span><span class="op" id="4625698">(</span><span class="ident" id="4625699">hash</span><span class="op" id="4625703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625707">u1</span>&nbsp;<span class="op" id="4625710">:=</span>&nbsp;<span class="builtinfunc" id="4625713">new</span><span class="op" id="4625716">(</span><span class="ident" id="4625717">big</span><span class="op" id="4625720">.</span><span class="ident" id="4625721">Int</span><span class="op" id="4625724">)</span><span class="op" id="4625725">.</span><span class="ident" id="4625726">Mul</span><span class="op" id="4625729">(</span><span class="ident" id="4625730">z</span><span class="op" id="4625731">,</span>&nbsp;<span class="ident" id="4625733">w</span><span class="op" id="4625734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625737">u1</span><span class="op" id="4625739">.</span><span class="ident" id="4625740">Mod</span><span class="op" id="4625743">(</span><span class="ident" id="4625744">u1</span><span class="op" id="4625746">,</span>&nbsp;<span class="ident" id="4625748">pub</span><span class="op" id="4625751">.</span><span class="ident" id="4625752">Q</span><span class="op" id="4625753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625756">u2</span>&nbsp;<span class="op" id="4625759">:=</span>&nbsp;<span class="ident" id="4625762">w</span><span class="op" id="4625763">.</span><span class="ident" id="4625764">Mul</span><span class="op" id="4625767">(</span><span class="ident" id="4625768">r</span><span class="op" id="4625769">,</span>&nbsp;<span class="ident" id="4625771">w</span><span class="op" id="4625772">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625775">u2</span><span class="op" id="4625777">.</span><span class="ident" id="4625778">Mod</span><span class="op" id="4625781">(</span><span class="ident" id="4625782">u2</span><span class="op" id="4625784">,</span>&nbsp;<span class="ident" id="4625786">pub</span><span class="op" id="4625789">.</span><span class="ident" id="4625790">Q</span><span class="op" id="4625791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625794">v</span>&nbsp;<span class="op" id="4625796">:=</span>&nbsp;<span class="ident" id="4625799">u1</span><span class="op" id="4625801">.</span><span class="ident" id="4625802">Exp</span><span class="op" id="4625805">(</span><span class="ident" id="4625806">pub</span><span class="op" id="4625809">.</span><span class="ident" id="4625810">G</span><span class="op" id="4625811">,</span>&nbsp;<span class="ident" id="4625813">u1</span><span class="op" id="4625815">,</span>&nbsp;<span class="ident" id="4625817">pub</span><span class="op" id="4625820">.</span><span class="ident" id="4625821">P</span><span class="op" id="4625822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625825">u2</span><span class="op" id="4625827">.</span><span class="ident" id="4625828">Exp</span><span class="op" id="4625831">(</span><span class="ident" id="4625832">pub</span><span class="op" id="4625835">.</span><span class="ident" id="4625836">Y</span><span class="op" id="4625837">,</span>&nbsp;<span class="ident" id="4625839">u2</span><span class="op" id="4625841">,</span>&nbsp;<span class="ident" id="4625843">pub</span><span class="op" id="4625846">.</span><span class="ident" id="4625847">P</span><span class="op" id="4625848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625851">v</span><span class="op" id="4625852">.</span><span class="ident" id="4625853">Mul</span><span class="op" id="4625856">(</span><span class="ident" id="4625857">v</span><span class="op" id="4625858">,</span>&nbsp;<span class="ident" id="4625860">u2</span><span class="op" id="4625862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625865">v</span><span class="op" id="4625866">.</span><span class="ident" id="4625867">Mod</span><span class="op" id="4625870">(</span><span class="ident" id="4625871">v</span><span class="op" id="4625872">,</span>&nbsp;<span class="ident" id="4625874">pub</span><span class="op" id="4625877">.</span><span class="ident" id="4625878">P</span><span class="op" id="4625879">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4625882">v</span><span class="op" id="4625883">.</span><span class="ident" id="4625884">Mod</span><span class="op" id="4625887">(</span><span class="ident" id="4625888">v</span><span class="op" id="4625889">,</span>&nbsp;<span class="ident" id="4625891">pub</span><span class="op" id="4625894">.</span><span class="ident" id="4625895">Q</span><span class="op" id="4625896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4625900">return</span>&nbsp;<span class="ident" id="4625907">v</span><span class="op" id="4625908">.</span><span class="ident" id="4625909">Cmp</span><span class="op" id="4625912">(</span><span class="ident" id="4625913">r</span><span class="op" id="4625914">)</span>&nbsp;<span class="op" id="4625916">==</span>&nbsp;<span class="num" id="4625919">0</span><br>
<span class="lineno"></span><span class="op" id="4625921">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
