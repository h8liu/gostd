<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5512178">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5512233">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5512287">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5512338">package</span>&nbsp;<span class="ident" id="5512346">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5512353">import</span>&nbsp;<span class="string" id="5512360">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5512368">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5512444">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5512455">type</span>&nbsp;<span class="ident" id="5512460">huffmanTree</span>&nbsp;<span class="keyword" id="5512472">struct</span>&nbsp;<span class="op" id="5512479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512482">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512553">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5512626">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512682">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5512691">[</span><span class="op" id="5512692">]</span><span class="ident" id="5512693">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5512706">nextNode</span>&nbsp;<span class="builtintype" id="5512715">int</span><br>
<span class="lineno"></span><span class="op" id="5512719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5512722">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5512802">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5512882">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5512942">//</span><br>
<span class="lineno"></span><span class="comment" id="5512945">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5513022">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5513100">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5513150">type</span>&nbsp;<span class="ident" id="5513155">huffmanNode</span>&nbsp;<span class="keyword" id="5513167">struct</span>&nbsp;<span class="op" id="5513174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513177">left</span><span class="op" id="5513181">,</span>&nbsp;<span class="ident" id="5513183">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5513199">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513207">leftValue</span><span class="op" id="5513216">,</span>&nbsp;<span class="ident" id="5513218">rightValue</span>&nbsp;<span class="builtintype" id="5513229">uint16</span><br>
<span class="lineno"></span><span class="op" id="5513236">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5513239">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5513316">const</span>&nbsp;<span class="ident" id="5513322">invalidNodeValue</span>&nbsp;<span class="op" id="5513339">=</span>&nbsp;<span class="num" id="5513341">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513349">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5513426">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5513446">func</span>&nbsp;<span class="op" id="5513451">(</span><span class="ident" id="5513452">t</span>&nbsp;<span class="op" id="5513454">*</span><span class="ident" id="5513455">huffmanTree</span><span class="op" id="5513466">)</span>&nbsp;<span class="ident" id="5513468">Decode</span><span class="op" id="5513474">(</span><span class="ident" id="5513475">br</span>&nbsp;<span class="op" id="5513478">*</span><span class="ident" id="5513479">bitReader</span><span class="op" id="5513488">)</span>&nbsp;<span class="op" id="5513490">(</span><span class="ident" id="5513491">v</span>&nbsp;<span class="builtintype" id="5513493">uint16</span><span class="op" id="5513499">)</span>&nbsp;<span class="op" id="5513501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513504">nodeIndex</span>&nbsp;<span class="op" id="5513514">:=</span>&nbsp;<span class="builtintype" id="5513517">uint16</span><span class="op" id="5513523">(</span><span class="num" id="5513524">0</span><span class="op" id="5513525">)</span>&nbsp;<span class="comment" id="5513527">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513564">for</span>&nbsp;<span class="op" id="5513568">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513572">node</span>&nbsp;<span class="op" id="5513577">:=</span>&nbsp;<span class="op" id="5513580">&amp;</span><span class="ident" id="5513581">t</span><span class="op" id="5513582">.</span><span class="ident" id="5513583">nodes</span><span class="op" id="5513588">[</span><span class="ident" id="5513589">nodeIndex</span><span class="op" id="5513598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513602">bit</span><span class="op" id="5513605">,</span>&nbsp;<span class="ident" id="5513607">ok</span>&nbsp;<span class="op" id="5513610">:=</span>&nbsp;<span class="ident" id="5513613">br</span><span class="op" id="5513615">.</span><span class="ident" id="5513616">TryReadBit</span><span class="op" id="5513626">(</span><span class="op" id="5513627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513631">if</span>&nbsp;<span class="op" id="5513634">!</span><span class="ident" id="5513635">ok</span>&nbsp;<span class="op" id="5513638">&amp;&amp;</span>&nbsp;<span class="ident" id="5513641">br</span><span class="op" id="5513643">.</span><span class="ident" id="5513644">ReadBit</span><span class="op" id="5513651">(</span><span class="op" id="5513652">)</span>&nbsp;<span class="op" id="5513654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513659">bit</span>&nbsp;<span class="op" id="5513663">=</span>&nbsp;<span class="num" id="5513665">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513669">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5513673">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513712">if</span>&nbsp;<span class="ident" id="5513715">bit</span>&nbsp;<span class="op" id="5513719">!=</span>&nbsp;<span class="num" id="5513722">0</span>&nbsp;<span class="op" id="5513724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5513729">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513740">if</span>&nbsp;<span class="ident" id="5513743">node</span><span class="op" id="5513747">.</span><span class="ident" id="5513748">left</span>&nbsp;<span class="op" id="5513753">==</span>&nbsp;<span class="ident" id="5513756">invalidNodeValue</span>&nbsp;<span class="op" id="5513773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513779">return</span>&nbsp;<span class="ident" id="5513786">node</span><span class="op" id="5513790">.</span><span class="ident" id="5513791">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513809">nodeIndex</span>&nbsp;<span class="op" id="5513819">=</span>&nbsp;<span class="ident" id="5513821">node</span><span class="op" id="5513825">.</span><span class="ident" id="5513826">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513833">}</span>&nbsp;<span class="keyword" id="5513835">else</span>&nbsp;<span class="op" id="5513840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5513845">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513857">if</span>&nbsp;<span class="ident" id="5513860">node</span><span class="op" id="5513864">.</span><span class="ident" id="5513865">right</span>&nbsp;<span class="op" id="5513871">==</span>&nbsp;<span class="ident" id="5513874">invalidNodeValue</span>&nbsp;<span class="op" id="5513891">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5513897">return</span>&nbsp;<span class="ident" id="5513904">node</span><span class="op" id="5513908">.</span><span class="ident" id="5513909">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5513928">nodeIndex</span>&nbsp;<span class="op" id="5513938">=</span>&nbsp;<span class="ident" id="5513940">node</span><span class="op" id="5513944">.</span><span class="ident" id="5513945">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5513956">}</span><br>
<span class="lineno">60</span><span class="op" id="5513958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5513961">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5514034">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5514097">func</span>&nbsp;<span class="ident" id="5514102">newHuffmanTree</span><span class="op" id="5514116">(</span><span class="ident" id="5514117">lengths</span>&nbsp;<span class="op" id="5514125">[</span><span class="op" id="5514126">]</span><span class="builtintype" id="5514127">uint8</span><span class="op" id="5514132">)</span>&nbsp;<span class="op" id="5514134">(</span><span class="ident" id="5514135">huffmanTree</span><span class="op" id="5514146">,</span>&nbsp;<span class="builtintype" id="5514148">error</span><span class="op" id="5514153">)</span>&nbsp;<span class="op" id="5514155">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514158">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514228">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514293">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514355">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514423">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514494">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514564">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514603">if</span>&nbsp;<span class="builtinfunc" id="5514606">len</span><span class="op" id="5514609">(</span><span class="ident" id="5514610">lengths</span><span class="op" id="5514617">)</span>&nbsp;<span class="op" id="5514619">&lt;</span>&nbsp;<span class="num" id="5514621">2</span>&nbsp;<span class="op" id="5514623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5514627">panic</span><span class="op" id="5514632">(</span><span class="string" id="5514633">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5514666">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514673">var</span>&nbsp;<span class="ident" id="5514677">t</span>&nbsp;<span class="ident" id="5514679">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514693">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5514765">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514807">pairs</span>&nbsp;<span class="op" id="5514813">:=</span>&nbsp;<span class="ident" id="5514816">huffmanSymbolLengthPairs</span><span class="op" id="5514840">(</span><span class="builtinfunc" id="5514841">make</span><span class="op" id="5514845">(</span><span class="op" id="5514846">[</span><span class="op" id="5514847">]</span><span class="ident" id="5514848">huffmanSymbolLengthPair</span><span class="op" id="5514871">,</span>&nbsp;<span class="builtinfunc" id="5514873">len</span><span class="op" id="5514876">(</span><span class="ident" id="5514877">lengths</span><span class="op" id="5514884">)</span><span class="op" id="5514885">)</span><span class="op" id="5514886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5514889">for</span>&nbsp;<span class="ident" id="5514893">i</span><span class="op" id="5514894">,</span>&nbsp;<span class="ident" id="5514896">length</span>&nbsp;<span class="op" id="5514903">:=</span>&nbsp;<span class="keyword" id="5514906">range</span>&nbsp;<span class="ident" id="5514912">lengths</span>&nbsp;<span class="op" id="5514920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514924">pairs</span><span class="op" id="5514929">[</span><span class="ident" id="5514930">i</span><span class="op" id="5514931">]</span><span class="op" id="5514932">.</span><span class="ident" id="5514933">value</span>&nbsp;<span class="op" id="5514939">=</span>&nbsp;<span class="builtintype" id="5514941">uint16</span><span class="op" id="5514947">(</span><span class="ident" id="5514948">i</span><span class="op" id="5514949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514953">pairs</span><span class="op" id="5514958">[</span><span class="ident" id="5514959">i</span><span class="op" id="5514960">]</span><span class="op" id="5514961">.</span><span class="ident" id="5514962">length</span>&nbsp;<span class="op" id="5514969">=</span>&nbsp;<span class="ident" id="5514971">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5514979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5514983">sort</span><span class="op" id="5514987">.</span><span class="ident" id="5514988">Sort</span><span class="op" id="5514992">(</span><span class="ident" id="5514993">pairs</span><span class="op" id="5514998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515002">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515074">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515147">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515219">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515240">code</span>&nbsp;<span class="op" id="5515245">:=</span>&nbsp;<span class="builtintype" id="5515248">uint32</span><span class="op" id="5515254">(</span><span class="num" id="5515255">0</span><span class="op" id="5515256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515259">length</span>&nbsp;<span class="op" id="5515266">:=</span>&nbsp;<span class="builtintype" id="5515269">uint8</span><span class="op" id="5515274">(</span><span class="num" id="5515275">32</span><span class="op" id="5515277">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515281">codes</span>&nbsp;<span class="op" id="5515287">:=</span>&nbsp;<span class="ident" id="5515290">huffmanCodes</span><span class="op" id="5515302">(</span><span class="builtinfunc" id="5515303">make</span><span class="op" id="5515307">(</span><span class="op" id="5515308">[</span><span class="op" id="5515309">]</span><span class="ident" id="5515310">huffmanCode</span><span class="op" id="5515321">,</span>&nbsp;<span class="builtinfunc" id="5515323">len</span><span class="op" id="5515326">(</span><span class="ident" id="5515327">lengths</span><span class="op" id="5515334">)</span><span class="op" id="5515335">)</span><span class="op" id="5515336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515339">for</span>&nbsp;<span class="ident" id="5515343">i</span>&nbsp;<span class="op" id="5515345">:=</span>&nbsp;<span class="builtinfunc" id="5515348">len</span><span class="op" id="5515351">(</span><span class="ident" id="5515352">pairs</span><span class="op" id="5515357">)</span>&nbsp;<span class="op" id="5515359">-</span>&nbsp;<span class="num" id="5515361">1</span><span class="op" id="5515362">;</span>&nbsp;<span class="ident" id="5515364">i</span>&nbsp;<span class="op" id="5515366">&gt;=</span>&nbsp;<span class="num" id="5515369">0</span><span class="op" id="5515370">;</span>&nbsp;<span class="ident" id="5515372">i</span><span class="op" id="5515373">--</span>&nbsp;<span class="op" id="5515376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5515380">if</span>&nbsp;<span class="ident" id="5515383">length</span>&nbsp;<span class="op" id="5515390">&gt;</span>&nbsp;<span class="ident" id="5515392">pairs</span><span class="op" id="5515397">[</span><span class="ident" id="5515398">i</span><span class="op" id="5515399">]</span><span class="op" id="5515400">.</span><span class="ident" id="5515401">length</span>&nbsp;<span class="op" id="5515408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515413">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515469">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515517">length</span>&nbsp;<span class="op" id="5515524">&gt;&gt;=</span>&nbsp;<span class="num" id="5515528">32</span>&nbsp;<span class="op" id="5515531">-</span>&nbsp;<span class="ident" id="5515533">pairs</span><span class="op" id="5515538">[</span><span class="ident" id="5515539">i</span><span class="op" id="5515540">]</span><span class="op" id="5515541">.</span><span class="ident" id="5515542">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515552">length</span>&nbsp;<span class="op" id="5515559">&lt;&lt;=</span>&nbsp;<span class="num" id="5515563">32</span>&nbsp;<span class="op" id="5515566">-</span>&nbsp;<span class="ident" id="5515568">pairs</span><span class="op" id="5515573">[</span><span class="ident" id="5515574">i</span><span class="op" id="5515575">]</span><span class="op" id="5515576">.</span><span class="ident" id="5515577">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515587">length</span>&nbsp;<span class="op" id="5515594">=</span>&nbsp;<span class="ident" id="5515596">pairs</span><span class="op" id="5515601">[</span><span class="ident" id="5515602">i</span><span class="op" id="5515603">]</span><span class="op" id="5515604">.</span><span class="ident" id="5515605">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515614">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515618">codes</span><span class="op" id="5515623">[</span><span class="ident" id="5515624">i</span><span class="op" id="5515625">]</span><span class="op" id="5515626">.</span><span class="ident" id="5515627">code</span>&nbsp;<span class="op" id="5515632">=</span>&nbsp;<span class="ident" id="5515634">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515641">codes</span><span class="op" id="5515646">[</span><span class="ident" id="5515647">i</span><span class="op" id="5515648">]</span><span class="op" id="5515649">.</span><span class="ident" id="5515650">codeLen</span>&nbsp;<span class="op" id="5515658">=</span>&nbsp;<span class="ident" id="5515660">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515669">codes</span><span class="op" id="5515674">[</span><span class="ident" id="5515675">i</span><span class="op" id="5515676">]</span><span class="op" id="5515677">.</span><span class="ident" id="5515678">value</span>&nbsp;<span class="op" id="5515684">=</span>&nbsp;<span class="ident" id="5515686">pairs</span><span class="op" id="5515691">[</span><span class="ident" id="5515692">i</span><span class="op" id="5515693">]</span><span class="op" id="5515694">.</span><span class="ident" id="5515695">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515703">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515769">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515802">code</span>&nbsp;<span class="op" id="5515807">+=</span>&nbsp;<span class="num" id="5515810">1</span>&nbsp;<span class="op" id="5515812">&lt;&lt;</span>&nbsp;<span class="op" id="5515815">(</span><span class="num" id="5515816">32</span>&nbsp;<span class="op" id="5515819">-</span>&nbsp;<span class="ident" id="5515821">length</span><span class="op" id="5515827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5515830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515834">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5515907">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515942">sort</span><span class="op" id="5515946">.</span><span class="ident" id="5515947">Sort</span><span class="op" id="5515951">(</span><span class="ident" id="5515952">codes</span><span class="op" id="5515957">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5515961">t</span><span class="op" id="5515962">.</span><span class="ident" id="5515963">nodes</span>&nbsp;<span class="op" id="5515969">=</span>&nbsp;<span class="builtinfunc" id="5515971">make</span><span class="op" id="5515975">(</span><span class="op" id="5515976">[</span><span class="op" id="5515977">]</span><span class="ident" id="5515978">huffmanNode</span><span class="op" id="5515989">,</span>&nbsp;<span class="builtinfunc" id="5515991">len</span><span class="op" id="5515994">(</span><span class="ident" id="5515995">codes</span><span class="op" id="5516000">)</span><span class="op" id="5516001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516004">_</span><span class="op" id="5516005">,</span>&nbsp;<span class="ident" id="5516007">err</span>&nbsp;<span class="op" id="5516011">:=</span>&nbsp;<span class="ident" id="5516014">buildHuffmanNode</span><span class="op" id="5516030">(</span><span class="op" id="5516031">&amp;</span><span class="ident" id="5516032">t</span><span class="op" id="5516033">,</span>&nbsp;<span class="ident" id="5516035">codes</span><span class="op" id="5516040">,</span>&nbsp;<span class="num" id="5516042">0</span><span class="op" id="5516043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516046">return</span>&nbsp;<span class="ident" id="5516053">t</span><span class="op" id="5516054">,</span>&nbsp;<span class="ident" id="5516056">err</span><br>
<span class="lineno">120</span><span class="op" id="5516060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516063">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5516129">type</span>&nbsp;<span class="ident" id="5516134">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5516158">struct</span>&nbsp;<span class="op" id="5516165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516168">value</span>&nbsp;&nbsp;<span class="builtintype" id="5516175">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516183">length</span>&nbsp;<span class="builtintype" id="5516190">uint8</span><br>
<span class="lineno"></span><span class="op" id="5516196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516199">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5516271">type</span>&nbsp;<span class="ident" id="5516276">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5516301">[</span><span class="op" id="5516302">]</span><span class="ident" id="5516303">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5516328">func</span>&nbsp;<span class="op" id="5516333">(</span><span class="ident" id="5516334">h</span>&nbsp;<span class="ident" id="5516336">huffmanSymbolLengthPairs</span><span class="op" id="5516360">)</span>&nbsp;<span class="ident" id="5516362">Len</span><span class="op" id="5516365">(</span><span class="op" id="5516366">)</span>&nbsp;<span class="builtintype" id="5516368">int</span>&nbsp;<span class="op" id="5516372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516375">return</span>&nbsp;<span class="builtinfunc" id="5516382">len</span><span class="op" id="5516385">(</span><span class="ident" id="5516386">h</span><span class="op" id="5516387">)</span><br>
<span class="lineno"></span><span class="op" id="5516389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5516392">func</span>&nbsp;<span class="op" id="5516397">(</span><span class="ident" id="5516398">h</span>&nbsp;<span class="ident" id="5516400">huffmanSymbolLengthPairs</span><span class="op" id="5516424">)</span>&nbsp;<span class="ident" id="5516426">Less</span><span class="op" id="5516430">(</span><span class="ident" id="5516431">i</span><span class="op" id="5516432">,</span>&nbsp;<span class="ident" id="5516434">j</span>&nbsp;<span class="builtintype" id="5516436">int</span><span class="op" id="5516439">)</span>&nbsp;<span class="builtintype" id="5516441">bool</span>&nbsp;<span class="op" id="5516446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516449">if</span>&nbsp;<span class="ident" id="5516452">h</span><span class="op" id="5516453">[</span><span class="ident" id="5516454">i</span><span class="op" id="5516455">]</span><span class="op" id="5516456">.</span><span class="ident" id="5516457">length</span>&nbsp;<span class="op" id="5516464">&lt;</span>&nbsp;<span class="ident" id="5516466">h</span><span class="op" id="5516467">[</span><span class="ident" id="5516468">j</span><span class="op" id="5516469">]</span><span class="op" id="5516470">.</span><span class="ident" id="5516471">length</span>&nbsp;<span class="op" id="5516478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516482">return</span>&nbsp;<span class="builtintype" id="5516489">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516498">if</span>&nbsp;<span class="ident" id="5516501">h</span><span class="op" id="5516502">[</span><span class="ident" id="5516503">i</span><span class="op" id="5516504">]</span><span class="op" id="5516505">.</span><span class="ident" id="5516506">length</span>&nbsp;<span class="op" id="5516513">&gt;</span>&nbsp;<span class="ident" id="5516515">h</span><span class="op" id="5516516">[</span><span class="ident" id="5516517">j</span><span class="op" id="5516518">]</span><span class="op" id="5516519">.</span><span class="ident" id="5516520">length</span>&nbsp;<span class="op" id="5516527">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516531">return</span>&nbsp;<span class="builtintype" id="5516538">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516548">if</span>&nbsp;<span class="ident" id="5516551">h</span><span class="op" id="5516552">[</span><span class="ident" id="5516553">i</span><span class="op" id="5516554">]</span><span class="op" id="5516555">.</span><span class="ident" id="5516556">value</span>&nbsp;<span class="op" id="5516562">&lt;</span>&nbsp;<span class="ident" id="5516564">h</span><span class="op" id="5516565">[</span><span class="ident" id="5516566">j</span><span class="op" id="5516567">]</span><span class="op" id="5516568">.</span><span class="ident" id="5516569">value</span>&nbsp;<span class="op" id="5516575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516579">return</span>&nbsp;<span class="builtintype" id="5516586">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5516592">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516595">return</span>&nbsp;<span class="builtintype" id="5516602">false</span><br>
<span class="lineno"></span><span class="op" id="5516608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5516611">func</span>&nbsp;<span class="op" id="5516616">(</span><span class="ident" id="5516617">h</span>&nbsp;<span class="ident" id="5516619">huffmanSymbolLengthPairs</span><span class="op" id="5516643">)</span>&nbsp;<span class="ident" id="5516645">Swap</span><span class="op" id="5516649">(</span><span class="ident" id="5516650">i</span><span class="op" id="5516651">,</span>&nbsp;<span class="ident" id="5516653">j</span>&nbsp;<span class="builtintype" id="5516655">int</span><span class="op" id="5516658">)</span>&nbsp;<span class="op" id="5516660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516663">h</span><span class="op" id="5516664">[</span><span class="ident" id="5516665">i</span><span class="op" id="5516666">]</span><span class="op" id="5516667">,</span>&nbsp;<span class="ident" id="5516669">h</span><span class="op" id="5516670">[</span><span class="ident" id="5516671">j</span><span class="op" id="5516672">]</span>&nbsp;<span class="op" id="5516674">=</span>&nbsp;<span class="ident" id="5516676">h</span><span class="op" id="5516677">[</span><span class="ident" id="5516678">j</span><span class="op" id="5516679">]</span><span class="op" id="5516680">,</span>&nbsp;<span class="ident" id="5516682">h</span><span class="op" id="5516683">[</span><span class="ident" id="5516684">i</span><span class="op" id="5516685">]</span><br>
<span class="lineno">150</span><span class="op" id="5516687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516690">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5516750">type</span>&nbsp;<span class="ident" id="5516755">huffmanCode</span>&nbsp;<span class="keyword" id="5516767">struct</span>&nbsp;<span class="op" id="5516774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516777">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5516785">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516793">codeLen</span>&nbsp;<span class="builtintype" id="5516801">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5516808">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5516816">uint16</span><br>
<span class="lineno"></span><span class="op" id="5516823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5516826">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5516887">type</span>&nbsp;<span class="ident" id="5516892">huffmanCodes</span>&nbsp;<span class="op" id="5516905">[</span><span class="op" id="5516906">]</span><span class="ident" id="5516907">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5516920">func</span>&nbsp;<span class="op" id="5516925">(</span><span class="ident" id="5516926">n</span>&nbsp;<span class="ident" id="5516928">huffmanCodes</span><span class="op" id="5516940">)</span>&nbsp;<span class="ident" id="5516942">Len</span><span class="op" id="5516945">(</span><span class="op" id="5516946">)</span>&nbsp;<span class="builtintype" id="5516948">int</span>&nbsp;<span class="op" id="5516952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5516955">return</span>&nbsp;<span class="builtinfunc" id="5516962">len</span><span class="op" id="5516965">(</span><span class="ident" id="5516966">n</span><span class="op" id="5516967">)</span><br>
<span class="lineno"></span><span class="op" id="5516969">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5516972">func</span>&nbsp;<span class="op" id="5516977">(</span><span class="ident" id="5516978">n</span>&nbsp;<span class="ident" id="5516980">huffmanCodes</span><span class="op" id="5516992">)</span>&nbsp;<span class="ident" id="5516994">Less</span><span class="op" id="5516998">(</span><span class="ident" id="5516999">i</span><span class="op" id="5517000">,</span>&nbsp;<span class="ident" id="5517002">j</span>&nbsp;<span class="builtintype" id="5517004">int</span><span class="op" id="5517007">)</span>&nbsp;<span class="builtintype" id="5517009">bool</span>&nbsp;<span class="op" id="5517014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517017">return</span>&nbsp;<span class="ident" id="5517024">n</span><span class="op" id="5517025">[</span><span class="ident" id="5517026">i</span><span class="op" id="5517027">]</span><span class="op" id="5517028">.</span><span class="ident" id="5517029">code</span>&nbsp;<span class="op" id="5517034">&lt;</span>&nbsp;<span class="ident" id="5517036">n</span><span class="op" id="5517037">[</span><span class="ident" id="5517038">j</span><span class="op" id="5517039">]</span><span class="op" id="5517040">.</span><span class="ident" id="5517041">code</span><br>
<span class="lineno"></span><span class="op" id="5517046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5517049">func</span>&nbsp;<span class="op" id="5517054">(</span><span class="ident" id="5517055">n</span>&nbsp;<span class="ident" id="5517057">huffmanCodes</span><span class="op" id="5517069">)</span>&nbsp;<span class="ident" id="5517071">Swap</span><span class="op" id="5517075">(</span><span class="ident" id="5517076">i</span><span class="op" id="5517077">,</span>&nbsp;<span class="ident" id="5517079">j</span>&nbsp;<span class="builtintype" id="5517081">int</span><span class="op" id="5517084">)</span>&nbsp;<span class="op" id="5517086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517089">n</span><span class="op" id="5517090">[</span><span class="ident" id="5517091">i</span><span class="op" id="5517092">]</span><span class="op" id="5517093">,</span>&nbsp;<span class="ident" id="5517095">n</span><span class="op" id="5517096">[</span><span class="ident" id="5517097">j</span><span class="op" id="5517098">]</span>&nbsp;<span class="op" id="5517100">=</span>&nbsp;<span class="ident" id="5517102">n</span><span class="op" id="5517103">[</span><span class="ident" id="5517104">j</span><span class="op" id="5517105">]</span><span class="op" id="5517106">,</span>&nbsp;<span class="ident" id="5517108">n</span><span class="op" id="5517109">[</span><span class="ident" id="5517110">i</span><span class="op" id="5517111">]</span><br>
<span class="lineno"></span><span class="op" id="5517113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5517116">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5517194">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5517268">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5517289">func</span>&nbsp;<span class="ident" id="5517294">buildHuffmanNode</span><span class="op" id="5517310">(</span><span class="ident" id="5517311">t</span>&nbsp;<span class="op" id="5517313">*</span><span class="ident" id="5517314">huffmanTree</span><span class="op" id="5517325">,</span>&nbsp;<span class="ident" id="5517327">codes</span>&nbsp;<span class="op" id="5517333">[</span><span class="op" id="5517334">]</span><span class="ident" id="5517335">huffmanCode</span><span class="op" id="5517346">,</span>&nbsp;<span class="ident" id="5517348">level</span>&nbsp;<span class="builtintype" id="5517354">uint32</span><span class="op" id="5517360">)</span>&nbsp;<span class="op" id="5517362">(</span><span class="ident" id="5517363">nodeIndex</span>&nbsp;<span class="builtintype" id="5517373">uint16</span><span class="op" id="5517379">,</span>&nbsp;<span class="ident" id="5517381">err</span>&nbsp;<span class="builtintype" id="5517385">error</span><span class="op" id="5517390">)</span>&nbsp;<span class="op" id="5517392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517395">test</span>&nbsp;<span class="op" id="5517400">:=</span>&nbsp;<span class="builtintype" id="5517403">uint32</span><span class="op" id="5517409">(</span><span class="num" id="5517410">1</span><span class="op" id="5517411">)</span>&nbsp;<span class="op" id="5517413">&lt;&lt;</span>&nbsp;<span class="op" id="5517416">(</span><span class="num" id="5517417">31</span>&nbsp;<span class="op" id="5517420">-</span>&nbsp;<span class="ident" id="5517422">level</span><span class="op" id="5517427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517431">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517524">firstRightIndex</span>&nbsp;<span class="op" id="5517540">:=</span>&nbsp;<span class="builtinfunc" id="5517543">len</span><span class="op" id="5517546">(</span><span class="ident" id="5517547">codes</span><span class="op" id="5517552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517555">for</span>&nbsp;<span class="ident" id="5517559">i</span><span class="op" id="5517560">,</span>&nbsp;<span class="ident" id="5517562">code</span>&nbsp;<span class="op" id="5517567">:=</span>&nbsp;<span class="keyword" id="5517570">range</span>&nbsp;<span class="ident" id="5517576">codes</span>&nbsp;<span class="op" id="5517582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517586">if</span>&nbsp;<span class="ident" id="5517589">code</span><span class="op" id="5517593">.</span><span class="ident" id="5517594">code</span><span class="op" id="5517598">&amp;</span><span class="ident" id="5517599">test</span>&nbsp;<span class="op" id="5517604">!=</span>&nbsp;<span class="num" id="5517607">0</span>&nbsp;<span class="op" id="5517609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517614">firstRightIndex</span>&nbsp;<span class="op" id="5517630">=</span>&nbsp;<span class="ident" id="5517632">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517637">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5517648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517652">left</span>&nbsp;<span class="op" id="5517657">:=</span>&nbsp;<span class="ident" id="5517660">codes</span><span class="op" id="5517665">[</span><span class="op" id="5517666">:</span><span class="ident" id="5517667">firstRightIndex</span><span class="op" id="5517682">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5517685">right</span>&nbsp;<span class="op" id="5517691">:=</span>&nbsp;<span class="ident" id="5517694">codes</span><span class="op" id="5517699">[</span><span class="ident" id="5517700">firstRightIndex</span><span class="op" id="5517715">:</span><span class="op" id="5517716">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5517720">if</span>&nbsp;<span class="builtinfunc" id="5517723">len</span><span class="op" id="5517726">(</span><span class="ident" id="5517727">left</span><span class="op" id="5517731">)</span>&nbsp;<span class="op" id="5517733">==</span>&nbsp;<span class="num" id="5517736">0</span>&nbsp;<span class="op" id="5517738">||</span>&nbsp;<span class="builtinfunc" id="5517741">len</span><span class="op" id="5517744">(</span><span class="ident" id="5517745">right</span><span class="op" id="5517750">)</span>&nbsp;<span class="op" id="5517752">==</span>&nbsp;<span class="num" id="5517755">0</span>&nbsp;<span class="op" id="5517757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517761">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517826">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517892">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517924">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5517987">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518050">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518098">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518103">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518168">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518234">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518296">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518351">if</span>&nbsp;<span class="builtinfunc" id="5518354">len</span><span class="op" id="5518357">(</span><span class="ident" id="5518358">codes</span><span class="op" id="5518363">)</span>&nbsp;<span class="op" id="5518365">&lt;</span>&nbsp;<span class="num" id="5518367">2</span>&nbsp;<span class="op" id="5518369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518374">return</span>&nbsp;<span class="num" id="5518381">0</span><span class="op" id="5518382">,</span>&nbsp;<span class="ident" id="5518384">StructuralError</span><span class="op" id="5518399">(</span><span class="string" id="5518400">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5518420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518429">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518494">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518553">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518569">if</span>&nbsp;<span class="ident" id="5518572">level</span>&nbsp;<span class="op" id="5518578">==</span>&nbsp;<span class="num" id="5518581">31</span>&nbsp;<span class="op" id="5518584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518589">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518646">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518705">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5518756">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518782">return</span>&nbsp;<span class="num" id="5518789">0</span><span class="op" id="5518790">,</span>&nbsp;<span class="ident" id="5518792">StructuralError</span><span class="op" id="5518807">(</span><span class="string" id="5518808">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5518839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518848">if</span>&nbsp;<span class="builtinfunc" id="5518851">len</span><span class="op" id="5518854">(</span><span class="ident" id="5518855">left</span><span class="op" id="5518859">)</span>&nbsp;<span class="op" id="5518861">==</span>&nbsp;<span class="num" id="5518864">0</span>&nbsp;<span class="op" id="5518866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518871">return</span>&nbsp;<span class="ident" id="5518878">buildHuffmanNode</span><span class="op" id="5518894">(</span><span class="ident" id="5518895">t</span><span class="op" id="5518896">,</span>&nbsp;<span class="ident" id="5518898">right</span><span class="op" id="5518903">,</span>&nbsp;<span class="ident" id="5518905">level</span><span class="op" id="5518910">+</span><span class="num" id="5518911">1</span><span class="op" id="5518912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5518920">return</span>&nbsp;<span class="ident" id="5518927">buildHuffmanNode</span><span class="op" id="5518943">(</span><span class="ident" id="5518944">t</span><span class="op" id="5518945">,</span>&nbsp;<span class="ident" id="5518947">left</span><span class="op" id="5518951">,</span>&nbsp;<span class="ident" id="5518953">level</span><span class="op" id="5518958">+</span><span class="num" id="5518959">1</span><span class="op" id="5518960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5518963">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518967">nodeIndex</span>&nbsp;<span class="op" id="5518977">=</span>&nbsp;<span class="builtintype" id="5518979">uint16</span><span class="op" id="5518985">(</span><span class="ident" id="5518986">t</span><span class="op" id="5518987">.</span><span class="ident" id="5518988">nextNode</span><span class="op" id="5518996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5518999">node</span>&nbsp;<span class="op" id="5519004">:=</span>&nbsp;<span class="op" id="5519007">&amp;</span><span class="ident" id="5519008">t</span><span class="op" id="5519009">.</span><span class="ident" id="5519010">nodes</span><span class="op" id="5519015">[</span><span class="ident" id="5519016">t</span><span class="op" id="5519017">.</span><span class="ident" id="5519018">nextNode</span><span class="op" id="5519026">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519029">t</span><span class="op" id="5519030">.</span><span class="ident" id="5519031">nextNode</span><span class="op" id="5519039">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519044">if</span>&nbsp;<span class="builtinfunc" id="5519047">len</span><span class="op" id="5519050">(</span><span class="ident" id="5519051">left</span><span class="op" id="5519055">)</span>&nbsp;<span class="op" id="5519057">==</span>&nbsp;<span class="num" id="5519060">1</span>&nbsp;<span class="op" id="5519062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519066">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519081">node</span><span class="op" id="5519085">.</span><span class="ident" id="5519086">left</span>&nbsp;<span class="op" id="5519091">=</span>&nbsp;<span class="ident" id="5519093">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519112">node</span><span class="op" id="5519116">.</span><span class="ident" id="5519117">leftValue</span>&nbsp;<span class="op" id="5519127">=</span>&nbsp;<span class="ident" id="5519129">left</span><span class="op" id="5519133">[</span><span class="num" id="5519134">0</span><span class="op" id="5519135">]</span><span class="op" id="5519136">.</span><span class="ident" id="5519137">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519144">}</span>&nbsp;<span class="keyword" id="5519146">else</span>&nbsp;<span class="op" id="5519151">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519155">node</span><span class="op" id="5519159">.</span><span class="ident" id="5519160">left</span><span class="op" id="5519164">,</span>&nbsp;<span class="ident" id="5519166">err</span>&nbsp;<span class="op" id="5519170">=</span>&nbsp;<span class="ident" id="5519172">buildHuffmanNode</span><span class="op" id="5519188">(</span><span class="ident" id="5519189">t</span><span class="op" id="5519190">,</span>&nbsp;<span class="ident" id="5519192">left</span><span class="op" id="5519196">,</span>&nbsp;<span class="ident" id="5519198">level</span><span class="op" id="5519203">+</span><span class="num" id="5519204">1</span><span class="op" id="5519205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519212">if</span>&nbsp;<span class="ident" id="5519215">err</span>&nbsp;<span class="op" id="5519219">!=</span>&nbsp;<span class="ident" id="5519222">nil</span>&nbsp;<span class="op" id="5519226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519230">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519242">if</span>&nbsp;<span class="builtinfunc" id="5519245">len</span><span class="op" id="5519248">(</span><span class="ident" id="5519249">right</span><span class="op" id="5519254">)</span>&nbsp;<span class="op" id="5519256">==</span>&nbsp;<span class="num" id="5519259">1</span>&nbsp;<span class="op" id="5519261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5519265">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519280">node</span><span class="op" id="5519284">.</span><span class="ident" id="5519285">right</span>&nbsp;<span class="op" id="5519291">=</span>&nbsp;<span class="ident" id="5519293">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519312">node</span><span class="op" id="5519316">.</span><span class="ident" id="5519317">rightValue</span>&nbsp;<span class="op" id="5519328">=</span>&nbsp;<span class="ident" id="5519330">right</span><span class="op" id="5519335">[</span><span class="num" id="5519336">0</span><span class="op" id="5519337">]</span><span class="op" id="5519338">.</span><span class="ident" id="5519339">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519346">}</span>&nbsp;<span class="keyword" id="5519348">else</span>&nbsp;<span class="op" id="5519353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5519357">node</span><span class="op" id="5519361">.</span><span class="ident" id="5519362">right</span><span class="op" id="5519367">,</span>&nbsp;<span class="ident" id="5519369">err</span>&nbsp;<span class="op" id="5519373">=</span>&nbsp;<span class="ident" id="5519375">buildHuffmanNode</span><span class="op" id="5519391">(</span><span class="ident" id="5519392">t</span><span class="op" id="5519393">,</span>&nbsp;<span class="ident" id="5519395">right</span><span class="op" id="5519400">,</span>&nbsp;<span class="ident" id="5519402">level</span><span class="op" id="5519407">+</span><span class="num" id="5519408">1</span><span class="op" id="5519409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5519412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5519416">return</span><br>
<span class="lineno"></span><span class="op" id="5519423">}</span>
</div>
</body>
</html>
