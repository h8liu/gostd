<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6546033">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6546088">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6546142">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6546193">package</span>&nbsp;<span class="ident" id="6546201">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546206">import</span>&nbsp;<span class="op" id="6546213">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546216">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546225">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546232">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546241">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546256">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546262">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546275">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546281">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546292">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6546302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546305">var</span>&nbsp;<span class="ident" id="6546309">filenames</span>&nbsp;<span class="op" id="6546319">=</span>&nbsp;<span class="op" id="6546321">[</span><span class="op" id="6546322">]</span><span class="builtintype" id="6546323">string</span><span class="op" id="6546329">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546332">&#34;basn0g01&#34;</span><span class="op" id="6546342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546345">&#34;basn0g01-30&#34;</span><span class="op" id="6546358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546361">&#34;basn0g02&#34;</span><span class="op" id="6546371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546374">&#34;basn0g02-29&#34;</span><span class="op" id="6546387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546390">&#34;basn0g04&#34;</span><span class="op" id="6546400">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546403">&#34;basn0g04-31&#34;</span><span class="op" id="6546416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546419">&#34;basn0g08&#34;</span><span class="op" id="6546429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546432">&#34;basn0g16&#34;</span><span class="op" id="6546442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546445">&#34;basn2c08&#34;</span><span class="op" id="6546455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546458">&#34;basn2c16&#34;</span><span class="op" id="6546468">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546471">&#34;basn3p01&#34;</span><span class="op" id="6546481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546484">&#34;basn3p02&#34;</span><span class="op" id="6546494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546497">&#34;basn3p04&#34;</span><span class="op" id="6546507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546510">&#34;basn3p04-31i&#34;</span><span class="op" id="6546524">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546527">&#34;basn3p08&#34;</span><span class="op" id="6546537">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546540">&#34;basn3p08-trns&#34;</span><span class="op" id="6546555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546558">&#34;basn4a08&#34;</span><span class="op" id="6546568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546571">&#34;basn4a16&#34;</span><span class="op" id="6546581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546584">&#34;basn6a08&#34;</span><span class="op" id="6546594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546597">&#34;basn6a16&#34;</span><span class="op" id="6546607">,</span><br>
<span class="lineno">40</span><span class="op" id="6546609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6546612">var</span>&nbsp;<span class="ident" id="6546616">filenamesPaletted</span>&nbsp;<span class="op" id="6546634">=</span>&nbsp;<span class="op" id="6546636">[</span><span class="op" id="6546637">]</span><span class="builtintype" id="6546638">string</span><span class="op" id="6546644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546647">&#34;basn3p01&#34;</span><span class="op" id="6546657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546660">&#34;basn3p02&#34;</span><span class="op" id="6546670">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546673">&#34;basn3p04&#34;</span><span class="op" id="6546683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546686">&#34;basn3p08&#34;</span><span class="op" id="6546696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546699">&#34;basn3p08-trns&#34;</span><span class="op" id="6546714">,</span><br>
<span class="lineno"></span><span class="op" id="6546716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6546719">var</span>&nbsp;<span class="ident" id="6546723">filenamesShort</span>&nbsp;<span class="op" id="6546738">=</span>&nbsp;<span class="op" id="6546740">[</span><span class="op" id="6546741">]</span><span class="builtintype" id="6546742">string</span><span class="op" id="6546748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546751">&#34;basn0g01&#34;</span><span class="op" id="6546761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546764">&#34;basn0g04-31&#34;</span><span class="op" id="6546777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6546780">&#34;basn6a16&#34;</span><span class="op" id="6546790">,</span><br>
<span class="lineno"></span><span class="op" id="6546792">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6546795">func</span>&nbsp;<span class="ident" id="6546800">readPNG</span><span class="op" id="6546807">(</span><span class="ident" id="6546808">filename</span>&nbsp;<span class="builtintype" id="6546817">string</span><span class="op" id="6546823">)</span>&nbsp;<span class="op" id="6546825">(</span><span class="ident" id="6546826">image</span><span class="op" id="6546831">.</span><span class="ident" id="6546832">Image</span><span class="op" id="6546837">,</span>&nbsp;<span class="builtintype" id="6546839">error</span><span class="op" id="6546844">)</span>&nbsp;<span class="op" id="6546846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6546849">f</span><span class="op" id="6546850">,</span>&nbsp;<span class="ident" id="6546852">err</span>&nbsp;<span class="op" id="6546856">:=</span>&nbsp;<span class="ident" id="6546859">os</span><span class="op" id="6546861">.</span><span class="ident" id="6546862">Open</span><span class="op" id="6546866">(</span><span class="ident" id="6546867">filename</span><span class="op" id="6546875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546878">if</span>&nbsp;<span class="ident" id="6546881">err</span>&nbsp;<span class="op" id="6546885">!=</span>&nbsp;<span class="ident" id="6546888">nil</span>&nbsp;<span class="op" id="6546892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546896">return</span>&nbsp;<span class="ident" id="6546903">nil</span><span class="op" id="6546906">,</span>&nbsp;<span class="ident" id="6546908">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6546913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546916">defer</span>&nbsp;<span class="ident" id="6546922">f</span><span class="op" id="6546923">.</span><span class="ident" id="6546924">Close</span><span class="op" id="6546929">(</span><span class="op" id="6546930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6546933">return</span>&nbsp;<span class="ident" id="6546940">Decode</span><span class="op" id="6546946">(</span><span class="ident" id="6546947">f</span><span class="op" id="6546948">)</span><br>
<span class="lineno"></span><span class="op" id="6546950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6546953">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="6547003">func</span>&nbsp;<span class="ident" id="6547008">sng</span><span class="op" id="6547011">(</span><span class="ident" id="6547012">w</span>&nbsp;<span class="ident" id="6547014">io</span><span class="op" id="6547016">.</span><span class="ident" id="6547017">WriteCloser</span><span class="op" id="6547028">,</span>&nbsp;<span class="ident" id="6547030">filename</span>&nbsp;<span class="builtintype" id="6547039">string</span><span class="op" id="6547045">,</span>&nbsp;<span class="ident" id="6547047">png</span>&nbsp;<span class="ident" id="6547051">image</span><span class="op" id="6547056">.</span><span class="ident" id="6547057">Image</span><span class="op" id="6547062">)</span>&nbsp;<span class="op" id="6547064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547067">defer</span>&nbsp;<span class="ident" id="6547073">w</span><span class="op" id="6547074">.</span><span class="ident" id="6547075">Close</span><span class="op" id="6547080">(</span><span class="op" id="6547081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547084">bounds</span>&nbsp;<span class="op" id="6547091">:=</span>&nbsp;<span class="ident" id="6547094">png</span><span class="op" id="6547097">.</span><span class="ident" id="6547098">Bounds</span><span class="op" id="6547104">(</span><span class="op" id="6547105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547108">cm</span>&nbsp;<span class="op" id="6547111">:=</span>&nbsp;<span class="ident" id="6547114">png</span><span class="op" id="6547117">.</span><span class="ident" id="6547118">ColorModel</span><span class="op" id="6547128">(</span><span class="op" id="6547129">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547132">var</span>&nbsp;<span class="ident" id="6547136">bitdepth</span>&nbsp;<span class="builtintype" id="6547145">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547150">switch</span>&nbsp;<span class="ident" id="6547157">cm</span>&nbsp;<span class="op" id="6547160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547163">case</span>&nbsp;<span class="ident" id="6547168">color</span><span class="op" id="6547173">.</span><span class="ident" id="6547174">RGBAModel</span><span class="op" id="6547183">,</span>&nbsp;<span class="ident" id="6547185">color</span><span class="op" id="6547190">.</span><span class="ident" id="6547191">NRGBAModel</span><span class="op" id="6547201">,</span>&nbsp;<span class="ident" id="6547203">color</span><span class="op" id="6547208">.</span><span class="ident" id="6547209">AlphaModel</span><span class="op" id="6547219">,</span>&nbsp;<span class="ident" id="6547221">color</span><span class="op" id="6547226">.</span><span class="ident" id="6547227">GrayModel</span><span class="op" id="6547236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547240">bitdepth</span>&nbsp;<span class="op" id="6547249">=</span>&nbsp;<span class="num" id="6547251">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547254">default</span><span class="op" id="6547261">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547265">bitdepth</span>&nbsp;<span class="op" id="6547274">=</span>&nbsp;<span class="num" id="6547276">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547283">cpm</span><span class="op" id="6547286">,</span>&nbsp;<span class="ident" id="6547288">_</span>&nbsp;<span class="op" id="6547290">:=</span>&nbsp;<span class="ident" id="6547293">cm</span><span class="op" id="6547295">.</span><span class="op" id="6547296">(</span><span class="ident" id="6547297">color</span><span class="op" id="6547302">.</span><span class="ident" id="6547303">Palette</span><span class="op" id="6547310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547313">var</span>&nbsp;<span class="ident" id="6547317">paletted</span>&nbsp;<span class="op" id="6547326">*</span><span class="ident" id="6547327">image</span><span class="op" id="6547332">.</span><span class="ident" id="6547333">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547343">if</span>&nbsp;<span class="ident" id="6547346">cpm</span>&nbsp;<span class="op" id="6547350">!=</span>&nbsp;<span class="ident" id="6547353">nil</span>&nbsp;<span class="op" id="6547357">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547361">switch</span>&nbsp;<span class="op" id="6547368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547372">case</span>&nbsp;<span class="builtinfunc" id="6547377">len</span><span class="op" id="6547380">(</span><span class="ident" id="6547381">cpm</span><span class="op" id="6547384">)</span>&nbsp;<span class="op" id="6547386">&lt;=</span>&nbsp;<span class="num" id="6547389">2</span><span class="op" id="6547390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547395">bitdepth</span>&nbsp;<span class="op" id="6547404">=</span>&nbsp;<span class="num" id="6547406">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547410">case</span>&nbsp;<span class="builtinfunc" id="6547415">len</span><span class="op" id="6547418">(</span><span class="ident" id="6547419">cpm</span><span class="op" id="6547422">)</span>&nbsp;<span class="op" id="6547424">&lt;=</span>&nbsp;<span class="num" id="6547427">4</span><span class="op" id="6547428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547433">bitdepth</span>&nbsp;<span class="op" id="6547442">=</span>&nbsp;<span class="num" id="6547444">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547448">case</span>&nbsp;<span class="builtinfunc" id="6547453">len</span><span class="op" id="6547456">(</span><span class="ident" id="6547457">cpm</span><span class="op" id="6547460">)</span>&nbsp;<span class="op" id="6547462">&lt;=</span>&nbsp;<span class="num" id="6547465">16</span><span class="op" id="6547467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547472">bitdepth</span>&nbsp;<span class="op" id="6547481">=</span>&nbsp;<span class="num" id="6547483">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547487">default</span><span class="op" id="6547494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547499">bitdepth</span>&nbsp;<span class="op" id="6547508">=</span>&nbsp;<span class="num" id="6547510">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547514">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547518">paletted</span>&nbsp;<span class="op" id="6547527">=</span>&nbsp;<span class="ident" id="6547529">png</span><span class="op" id="6547532">.</span><span class="op" id="6547533">(</span><span class="op" id="6547534">*</span><span class="ident" id="6547535">image</span><span class="op" id="6547540">.</span><span class="ident" id="6547541">Paletted</span><span class="op" id="6547549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6547552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6547556">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547589">io</span><span class="op" id="6547591">.</span><span class="ident" id="6547592">WriteString</span><span class="op" id="6547603">(</span><span class="ident" id="6547604">w</span><span class="op" id="6547605">,</span>&nbsp;<span class="string" id="6547607">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="6547620">+</span><span class="ident" id="6547621">filename</span><span class="op" id="6547629">+</span><span class="string" id="6547630">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="6547646">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547649">fmt</span><span class="op" id="6547652">.</span><span class="ident" id="6547653">Fprintf</span><span class="op" id="6547660">(</span><span class="ident" id="6547661">w</span><span class="op" id="6547662">,</span>&nbsp;<span class="string" id="6547664">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="6547708">,</span>&nbsp;<span class="ident" id="6547710">bounds</span><span class="op" id="6547716">.</span><span class="ident" id="6547717">Dx</span><span class="op" id="6547719">(</span><span class="op" id="6547720">)</span><span class="op" id="6547721">,</span>&nbsp;<span class="ident" id="6547723">bounds</span><span class="op" id="6547729">.</span><span class="ident" id="6547730">Dy</span><span class="op" id="6547732">(</span><span class="op" id="6547733">)</span><span class="op" id="6547734">,</span>&nbsp;<span class="ident" id="6547736">bitdepth</span><span class="op" id="6547744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547747">switch</span>&nbsp;<span class="op" id="6547754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547757">case</span>&nbsp;<span class="ident" id="6547762">cm</span>&nbsp;<span class="op" id="6547765">==</span>&nbsp;<span class="ident" id="6547768">color</span><span class="op" id="6547773">.</span><span class="ident" id="6547774">RGBAModel</span><span class="op" id="6547783">,</span>&nbsp;<span class="ident" id="6547785">cm</span>&nbsp;<span class="op" id="6547788">==</span>&nbsp;<span class="ident" id="6547791">color</span><span class="op" id="6547796">.</span><span class="ident" id="6547797">RGBA64Model</span><span class="op" id="6547808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547812">io</span><span class="op" id="6547814">.</span><span class="ident" id="6547815">WriteString</span><span class="op" id="6547826">(</span><span class="ident" id="6547827">w</span><span class="op" id="6547828">,</span>&nbsp;<span class="string" id="6547830">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="6547850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547853">case</span>&nbsp;<span class="ident" id="6547858">cm</span>&nbsp;<span class="op" id="6547861">==</span>&nbsp;<span class="ident" id="6547864">color</span><span class="op" id="6547869">.</span><span class="ident" id="6547870">NRGBAModel</span><span class="op" id="6547880">,</span>&nbsp;<span class="ident" id="6547882">cm</span>&nbsp;<span class="op" id="6547885">==</span>&nbsp;<span class="ident" id="6547888">color</span><span class="op" id="6547893">.</span><span class="ident" id="6547894">NRGBA64Model</span><span class="op" id="6547906">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6547910">io</span><span class="op" id="6547912">.</span><span class="ident" id="6547913">WriteString</span><span class="op" id="6547924">(</span><span class="ident" id="6547925">w</span><span class="op" id="6547926">,</span>&nbsp;<span class="string" id="6547928">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="6547954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6547957">case</span>&nbsp;<span class="ident" id="6547962">cm</span>&nbsp;<span class="op" id="6547965">==</span>&nbsp;<span class="ident" id="6547968">color</span><span class="op" id="6547973">.</span><span class="ident" id="6547974">GrayModel</span><span class="op" id="6547983">,</span>&nbsp;<span class="ident" id="6547985">cm</span>&nbsp;<span class="op" id="6547988">==</span>&nbsp;<span class="ident" id="6547991">color</span><span class="op" id="6547996">.</span><span class="ident" id="6547997">Gray16Model</span><span class="op" id="6548008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548012">io</span><span class="op" id="6548014">.</span><span class="ident" id="6548015">WriteString</span><span class="op" id="6548026">(</span><span class="ident" id="6548027">w</span><span class="op" id="6548028">,</span>&nbsp;<span class="string" id="6548030">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="6548054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548057">case</span>&nbsp;<span class="ident" id="6548062">cpm</span>&nbsp;<span class="op" id="6548066">!=</span>&nbsp;<span class="ident" id="6548069">nil</span><span class="op" id="6548072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548076">io</span><span class="op" id="6548078">.</span><span class="ident" id="6548079">WriteString</span><span class="op" id="6548090">(</span><span class="ident" id="6548091">w</span><span class="op" id="6548092">,</span>&nbsp;<span class="string" id="6548094">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="6548122">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548125">default</span><span class="op" id="6548132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548136">io</span><span class="op" id="6548138">.</span><span class="ident" id="6548139">WriteString</span><span class="op" id="6548150">(</span><span class="ident" id="6548151">w</span><span class="op" id="6548152">,</span>&nbsp;<span class="string" id="6548154">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="6548189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548195">io</span><span class="op" id="6548197">.</span><span class="ident" id="6548198">WriteString</span><span class="op" id="6548209">(</span><span class="ident" id="6548210">w</span><span class="op" id="6548211">,</span>&nbsp;<span class="string" id="6548213">&#34;}\n&#34;</span><span class="op" id="6548218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6548222">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6548315">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548400">io</span><span class="op" id="6548402">.</span><span class="ident" id="6548403">WriteString</span><span class="op" id="6548414">(</span><span class="ident" id="6548415">w</span><span class="op" id="6548416">,</span>&nbsp;<span class="string" id="6548418">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="6548435">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6548439">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548484">if</span>&nbsp;<span class="ident" id="6548487">cpm</span>&nbsp;<span class="op" id="6548491">!=</span>&nbsp;<span class="ident" id="6548494">nil</span>&nbsp;<span class="op" id="6548498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548502">lastAlpha</span>&nbsp;<span class="op" id="6548512">:=</span>&nbsp;<span class="op" id="6548515">-</span><span class="num" id="6548516">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548520">io</span><span class="op" id="6548522">.</span><span class="ident" id="6548523">WriteString</span><span class="op" id="6548534">(</span><span class="ident" id="6548535">w</span><span class="op" id="6548536">,</span>&nbsp;<span class="string" id="6548538">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="6548548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548552">for</span>&nbsp;<span class="ident" id="6548556">i</span><span class="op" id="6548557">,</span>&nbsp;<span class="ident" id="6548559">c</span>&nbsp;<span class="op" id="6548561">:=</span>&nbsp;<span class="keyword" id="6548564">range</span>&nbsp;<span class="ident" id="6548570">cpm</span>&nbsp;<span class="op" id="6548574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548579">var</span>&nbsp;<span class="ident" id="6548583">r</span><span class="op" id="6548584">,</span>&nbsp;<span class="ident" id="6548586">g</span><span class="op" id="6548587">,</span>&nbsp;<span class="ident" id="6548589">b</span><span class="op" id="6548590">,</span>&nbsp;<span class="ident" id="6548592">a</span>&nbsp;<span class="builtintype" id="6548594">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548603">switch</span>&nbsp;<span class="ident" id="6548610">c</span>&nbsp;<span class="op" id="6548612">:=</span>&nbsp;<span class="ident" id="6548615">c</span><span class="op" id="6548616">.</span><span class="op" id="6548617">(</span><span class="keyword" id="6548618">type</span><span class="op" id="6548622">)</span>&nbsp;<span class="op" id="6548624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548629">case</span>&nbsp;<span class="ident" id="6548634">color</span><span class="op" id="6548639">.</span><span class="ident" id="6548640">RGBA</span><span class="op" id="6548644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548650">r</span><span class="op" id="6548651">,</span>&nbsp;<span class="ident" id="6548653">g</span><span class="op" id="6548654">,</span>&nbsp;<span class="ident" id="6548656">b</span><span class="op" id="6548657">,</span>&nbsp;<span class="ident" id="6548659">a</span>&nbsp;<span class="op" id="6548661">=</span>&nbsp;<span class="ident" id="6548663">c</span><span class="op" id="6548664">.</span><span class="ident" id="6548665">R</span><span class="op" id="6548666">,</span>&nbsp;<span class="ident" id="6548668">c</span><span class="op" id="6548669">.</span><span class="ident" id="6548670">G</span><span class="op" id="6548671">,</span>&nbsp;<span class="ident" id="6548673">c</span><span class="op" id="6548674">.</span><span class="ident" id="6548675">B</span><span class="op" id="6548676">,</span>&nbsp;<span class="num" id="6548678">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548686">case</span>&nbsp;<span class="ident" id="6548691">color</span><span class="op" id="6548696">.</span><span class="ident" id="6548697">NRGBA</span><span class="op" id="6548702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548708">r</span><span class="op" id="6548709">,</span>&nbsp;<span class="ident" id="6548711">g</span><span class="op" id="6548712">,</span>&nbsp;<span class="ident" id="6548714">b</span><span class="op" id="6548715">,</span>&nbsp;<span class="ident" id="6548717">a</span>&nbsp;<span class="op" id="6548719">=</span>&nbsp;<span class="ident" id="6548721">c</span><span class="op" id="6548722">.</span><span class="ident" id="6548723">R</span><span class="op" id="6548724">,</span>&nbsp;<span class="ident" id="6548726">c</span><span class="op" id="6548727">.</span><span class="ident" id="6548728">G</span><span class="op" id="6548729">,</span>&nbsp;<span class="ident" id="6548731">c</span><span class="op" id="6548732">.</span><span class="ident" id="6548733">B</span><span class="op" id="6548734">,</span>&nbsp;<span class="ident" id="6548736">c</span><span class="op" id="6548737">.</span><span class="ident" id="6548738">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548743">default</span><span class="op" id="6548750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6548756">panic</span><span class="op" id="6548761">(</span><span class="string" id="6548762">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="6548790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548800">if</span>&nbsp;<span class="ident" id="6548803">a</span>&nbsp;<span class="op" id="6548805">!=</span>&nbsp;<span class="num" id="6548808">0xff</span>&nbsp;<span class="op" id="6548813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548819">lastAlpha</span>&nbsp;<span class="op" id="6548829">=</span>&nbsp;<span class="ident" id="6548831">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548841">fmt</span><span class="op" id="6548844">.</span><span class="ident" id="6548845">Fprintf</span><span class="op" id="6548852">(</span><span class="ident" id="6548853">w</span><span class="op" id="6548854">,</span>&nbsp;<span class="string" id="6548856">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="6548912">,</span>&nbsp;<span class="ident" id="6548914">r</span><span class="op" id="6548915">,</span>&nbsp;<span class="ident" id="6548917">g</span><span class="op" id="6548918">,</span>&nbsp;<span class="ident" id="6548920">b</span><span class="op" id="6548921">,</span>&nbsp;<span class="ident" id="6548923">r</span><span class="op" id="6548924">,</span>&nbsp;<span class="ident" id="6548926">g</span><span class="op" id="6548927">,</span>&nbsp;<span class="ident" id="6548929">b</span><span class="op" id="6548930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6548934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548938">io</span><span class="op" id="6548940">.</span><span class="ident" id="6548941">WriteString</span><span class="op" id="6548952">(</span><span class="ident" id="6548953">w</span><span class="op" id="6548954">,</span>&nbsp;<span class="string" id="6548956">&#34;}\n&#34;</span><span class="op" id="6548961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6548965">if</span>&nbsp;<span class="ident" id="6548968">lastAlpha</span>&nbsp;<span class="op" id="6548978">!=</span>&nbsp;<span class="op" id="6548981">-</span><span class="num" id="6548982">1</span>&nbsp;<span class="op" id="6548984">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6548989">io</span><span class="op" id="6548991">.</span><span class="ident" id="6548992">WriteString</span><span class="op" id="6549003">(</span><span class="ident" id="6549004">w</span><span class="op" id="6549005">,</span>&nbsp;<span class="string" id="6549007">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="6549017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549022">for</span>&nbsp;<span class="ident" id="6549026">i</span>&nbsp;<span class="op" id="6549028">:=</span>&nbsp;<span class="num" id="6549031">0</span><span class="op" id="6549032">;</span>&nbsp;<span class="ident" id="6549034">i</span>&nbsp;<span class="op" id="6549036">&lt;=</span>&nbsp;<span class="ident" id="6549039">lastAlpha</span><span class="op" id="6549048">;</span>&nbsp;<span class="ident" id="6549050">i</span><span class="op" id="6549051">++</span>&nbsp;<span class="op" id="6549054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549060">_</span><span class="op" id="6549061">,</span>&nbsp;<span class="ident" id="6549063">_</span><span class="op" id="6549064">,</span>&nbsp;<span class="ident" id="6549066">_</span><span class="op" id="6549067">,</span>&nbsp;<span class="ident" id="6549069">a</span>&nbsp;<span class="op" id="6549071">:=</span>&nbsp;<span class="ident" id="6549074">cpm</span><span class="op" id="6549077">[</span><span class="ident" id="6549078">i</span><span class="op" id="6549079">]</span><span class="op" id="6549080">.</span><span class="ident" id="6549081">RGBA</span><span class="op" id="6549085">(</span><span class="op" id="6549086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549092">a</span>&nbsp;<span class="op" id="6549094">&gt;&gt;=</span>&nbsp;<span class="num" id="6549098">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549104">fmt</span><span class="op" id="6549107">.</span><span class="ident" id="6549108">Fprintf</span><span class="op" id="6549115">(</span><span class="ident" id="6549116">w</span><span class="op" id="6549117">,</span>&nbsp;<span class="string" id="6549119">&#34;&nbsp;%d&#34;</span><span class="op" id="6549124">,</span>&nbsp;<span class="ident" id="6549126">a</span><span class="op" id="6549127">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549137">io</span><span class="op" id="6549139">.</span><span class="ident" id="6549140">WriteString</span><span class="op" id="6549151">(</span><span class="ident" id="6549152">w</span><span class="op" id="6549153">,</span>&nbsp;<span class="string" id="6549155">&#34;}\n&#34;</span><span class="op" id="6549160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6549171">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549192">io</span><span class="op" id="6549194">.</span><span class="ident" id="6549195">WriteString</span><span class="op" id="6549206">(</span><span class="ident" id="6549207">w</span><span class="op" id="6549208">,</span>&nbsp;<span class="string" id="6549210">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="6549237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549240">for</span>&nbsp;<span class="ident" id="6549244">y</span>&nbsp;<span class="op" id="6549246">:=</span>&nbsp;<span class="ident" id="6549249">bounds</span><span class="op" id="6549255">.</span><span class="ident" id="6549256">Min</span><span class="op" id="6549259">.</span><span class="ident" id="6549260">Y</span><span class="op" id="6549261">;</span>&nbsp;<span class="ident" id="6549263">y</span>&nbsp;<span class="op" id="6549265">&lt;</span>&nbsp;<span class="ident" id="6549267">bounds</span><span class="op" id="6549273">.</span><span class="ident" id="6549274">Max</span><span class="op" id="6549277">.</span><span class="ident" id="6549278">Y</span><span class="op" id="6549279">;</span>&nbsp;<span class="ident" id="6549281">y</span><span class="op" id="6549282">++</span>&nbsp;<span class="op" id="6549285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549289">switch</span>&nbsp;<span class="op" id="6549296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549300">case</span>&nbsp;<span class="ident" id="6549305">cm</span>&nbsp;<span class="op" id="6549308">==</span>&nbsp;<span class="ident" id="6549311">color</span><span class="op" id="6549316">.</span><span class="ident" id="6549317">GrayModel</span><span class="op" id="6549326">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549331">for</span>&nbsp;<span class="ident" id="6549335">x</span>&nbsp;<span class="op" id="6549337">:=</span>&nbsp;<span class="ident" id="6549340">bounds</span><span class="op" id="6549346">.</span><span class="ident" id="6549347">Min</span><span class="op" id="6549350">.</span><span class="ident" id="6549351">X</span><span class="op" id="6549352">;</span>&nbsp;<span class="ident" id="6549354">x</span>&nbsp;<span class="op" id="6549356">&lt;</span>&nbsp;<span class="ident" id="6549358">bounds</span><span class="op" id="6549364">.</span><span class="ident" id="6549365">Max</span><span class="op" id="6549368">.</span><span class="ident" id="6549369">X</span><span class="op" id="6549370">;</span>&nbsp;<span class="ident" id="6549372">x</span><span class="op" id="6549373">++</span>&nbsp;<span class="op" id="6549376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549382">gray</span>&nbsp;<span class="op" id="6549387">:=</span>&nbsp;<span class="ident" id="6549390">png</span><span class="op" id="6549393">.</span><span class="ident" id="6549394">At</span><span class="op" id="6549396">(</span><span class="ident" id="6549397">x</span><span class="op" id="6549398">,</span>&nbsp;<span class="ident" id="6549400">y</span><span class="op" id="6549401">)</span><span class="op" id="6549402">.</span><span class="op" id="6549403">(</span><span class="ident" id="6549404">color</span><span class="op" id="6549409">.</span><span class="ident" id="6549410">Gray</span><span class="op" id="6549414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549420">fmt</span><span class="op" id="6549423">.</span><span class="ident" id="6549424">Fprintf</span><span class="op" id="6549431">(</span><span class="ident" id="6549432">w</span><span class="op" id="6549433">,</span>&nbsp;<span class="string" id="6549435">&#34;%02x&#34;</span><span class="op" id="6549441">,</span>&nbsp;<span class="ident" id="6549443">gray</span><span class="op" id="6549447">.</span><span class="ident" id="6549448">Y</span><span class="op" id="6549449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549458">case</span>&nbsp;<span class="ident" id="6549463">cm</span>&nbsp;<span class="op" id="6549466">==</span>&nbsp;<span class="ident" id="6549469">color</span><span class="op" id="6549474">.</span><span class="ident" id="6549475">Gray16Model</span><span class="op" id="6549486">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549491">for</span>&nbsp;<span class="ident" id="6549495">x</span>&nbsp;<span class="op" id="6549497">:=</span>&nbsp;<span class="ident" id="6549500">bounds</span><span class="op" id="6549506">.</span><span class="ident" id="6549507">Min</span><span class="op" id="6549510">.</span><span class="ident" id="6549511">X</span><span class="op" id="6549512">;</span>&nbsp;<span class="ident" id="6549514">x</span>&nbsp;<span class="op" id="6549516">&lt;</span>&nbsp;<span class="ident" id="6549518">bounds</span><span class="op" id="6549524">.</span><span class="ident" id="6549525">Max</span><span class="op" id="6549528">.</span><span class="ident" id="6549529">X</span><span class="op" id="6549530">;</span>&nbsp;<span class="ident" id="6549532">x</span><span class="op" id="6549533">++</span>&nbsp;<span class="op" id="6549536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549542">gray16</span>&nbsp;<span class="op" id="6549549">:=</span>&nbsp;<span class="ident" id="6549552">png</span><span class="op" id="6549555">.</span><span class="ident" id="6549556">At</span><span class="op" id="6549558">(</span><span class="ident" id="6549559">x</span><span class="op" id="6549560">,</span>&nbsp;<span class="ident" id="6549562">y</span><span class="op" id="6549563">)</span><span class="op" id="6549564">.</span><span class="op" id="6549565">(</span><span class="ident" id="6549566">color</span><span class="op" id="6549571">.</span><span class="ident" id="6549572">Gray16</span><span class="op" id="6549578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549584">fmt</span><span class="op" id="6549587">.</span><span class="ident" id="6549588">Fprintf</span><span class="op" id="6549595">(</span><span class="ident" id="6549596">w</span><span class="op" id="6549597">,</span>&nbsp;<span class="string" id="6549599">&#34;%04x&nbsp;&#34;</span><span class="op" id="6549606">,</span>&nbsp;<span class="ident" id="6549608">gray16</span><span class="op" id="6549614">.</span><span class="ident" id="6549615">Y</span><span class="op" id="6549616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549625">case</span>&nbsp;<span class="ident" id="6549630">cm</span>&nbsp;<span class="op" id="6549633">==</span>&nbsp;<span class="ident" id="6549636">color</span><span class="op" id="6549641">.</span><span class="ident" id="6549642">RGBAModel</span><span class="op" id="6549651">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549656">for</span>&nbsp;<span class="ident" id="6549660">x</span>&nbsp;<span class="op" id="6549662">:=</span>&nbsp;<span class="ident" id="6549665">bounds</span><span class="op" id="6549671">.</span><span class="ident" id="6549672">Min</span><span class="op" id="6549675">.</span><span class="ident" id="6549676">X</span><span class="op" id="6549677">;</span>&nbsp;<span class="ident" id="6549679">x</span>&nbsp;<span class="op" id="6549681">&lt;</span>&nbsp;<span class="ident" id="6549683">bounds</span><span class="op" id="6549689">.</span><span class="ident" id="6549690">Max</span><span class="op" id="6549693">.</span><span class="ident" id="6549694">X</span><span class="op" id="6549695">;</span>&nbsp;<span class="ident" id="6549697">x</span><span class="op" id="6549698">++</span>&nbsp;<span class="op" id="6549701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549707">rgba</span>&nbsp;<span class="op" id="6549712">:=</span>&nbsp;<span class="ident" id="6549715">png</span><span class="op" id="6549718">.</span><span class="ident" id="6549719">At</span><span class="op" id="6549721">(</span><span class="ident" id="6549722">x</span><span class="op" id="6549723">,</span>&nbsp;<span class="ident" id="6549725">y</span><span class="op" id="6549726">)</span><span class="op" id="6549727">.</span><span class="op" id="6549728">(</span><span class="ident" id="6549729">color</span><span class="op" id="6549734">.</span><span class="ident" id="6549735">RGBA</span><span class="op" id="6549739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549745">fmt</span><span class="op" id="6549748">.</span><span class="ident" id="6549749">Fprintf</span><span class="op" id="6549756">(</span><span class="ident" id="6549757">w</span><span class="op" id="6549758">,</span>&nbsp;<span class="string" id="6549760">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6549775">,</span>&nbsp;<span class="ident" id="6549777">rgba</span><span class="op" id="6549781">.</span><span class="ident" id="6549782">R</span><span class="op" id="6549783">,</span>&nbsp;<span class="ident" id="6549785">rgba</span><span class="op" id="6549789">.</span><span class="ident" id="6549790">G</span><span class="op" id="6549791">,</span>&nbsp;<span class="ident" id="6549793">rgba</span><span class="op" id="6549797">.</span><span class="ident" id="6549798">B</span><span class="op" id="6549799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549808">case</span>&nbsp;<span class="ident" id="6549813">cm</span>&nbsp;<span class="op" id="6549816">==</span>&nbsp;<span class="ident" id="6549819">color</span><span class="op" id="6549824">.</span><span class="ident" id="6549825">RGBA64Model</span><span class="op" id="6549836">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6549841">for</span>&nbsp;<span class="ident" id="6549845">x</span>&nbsp;<span class="op" id="6549847">:=</span>&nbsp;<span class="ident" id="6549850">bounds</span><span class="op" id="6549856">.</span><span class="ident" id="6549857">Min</span><span class="op" id="6549860">.</span><span class="ident" id="6549861">X</span><span class="op" id="6549862">;</span>&nbsp;<span class="ident" id="6549864">x</span>&nbsp;<span class="op" id="6549866">&lt;</span>&nbsp;<span class="ident" id="6549868">bounds</span><span class="op" id="6549874">.</span><span class="ident" id="6549875">Max</span><span class="op" id="6549878">.</span><span class="ident" id="6549879">X</span><span class="op" id="6549880">;</span>&nbsp;<span class="ident" id="6549882">x</span><span class="op" id="6549883">++</span>&nbsp;<span class="op" id="6549886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549892">rgba64</span>&nbsp;<span class="op" id="6549899">:=</span>&nbsp;<span class="ident" id="6549902">png</span><span class="op" id="6549905">.</span><span class="ident" id="6549906">At</span><span class="op" id="6549908">(</span><span class="ident" id="6549909">x</span><span class="op" id="6549910">,</span>&nbsp;<span class="ident" id="6549912">y</span><span class="op" id="6549913">)</span><span class="op" id="6549914">.</span><span class="op" id="6549915">(</span><span class="ident" id="6549916">color</span><span class="op" id="6549921">.</span><span class="ident" id="6549922">RGBA64</span><span class="op" id="6549928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6549934">fmt</span><span class="op" id="6549937">.</span><span class="ident" id="6549938">Fprintf</span><span class="op" id="6549945">(</span><span class="ident" id="6549946">w</span><span class="op" id="6549947">,</span>&nbsp;<span class="string" id="6549949">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6549964">,</span>&nbsp;<span class="ident" id="6549966">rgba64</span><span class="op" id="6549972">.</span><span class="ident" id="6549973">R</span><span class="op" id="6549974">,</span>&nbsp;<span class="ident" id="6549976">rgba64</span><span class="op" id="6549982">.</span><span class="ident" id="6549983">G</span><span class="op" id="6549984">,</span>&nbsp;<span class="ident" id="6549986">rgba64</span><span class="op" id="6549992">.</span><span class="ident" id="6549993">B</span><span class="op" id="6549994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6549999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550003">case</span>&nbsp;<span class="ident" id="6550008">cm</span>&nbsp;<span class="op" id="6550011">==</span>&nbsp;<span class="ident" id="6550014">color</span><span class="op" id="6550019">.</span><span class="ident" id="6550020">NRGBAModel</span><span class="op" id="6550030">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550035">for</span>&nbsp;<span class="ident" id="6550039">x</span>&nbsp;<span class="op" id="6550041">:=</span>&nbsp;<span class="ident" id="6550044">bounds</span><span class="op" id="6550050">.</span><span class="ident" id="6550051">Min</span><span class="op" id="6550054">.</span><span class="ident" id="6550055">X</span><span class="op" id="6550056">;</span>&nbsp;<span class="ident" id="6550058">x</span>&nbsp;<span class="op" id="6550060">&lt;</span>&nbsp;<span class="ident" id="6550062">bounds</span><span class="op" id="6550068">.</span><span class="ident" id="6550069">Max</span><span class="op" id="6550072">.</span><span class="ident" id="6550073">X</span><span class="op" id="6550074">;</span>&nbsp;<span class="ident" id="6550076">x</span><span class="op" id="6550077">++</span>&nbsp;<span class="op" id="6550080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550086">nrgba</span>&nbsp;<span class="op" id="6550092">:=</span>&nbsp;<span class="ident" id="6550095">png</span><span class="op" id="6550098">.</span><span class="ident" id="6550099">At</span><span class="op" id="6550101">(</span><span class="ident" id="6550102">x</span><span class="op" id="6550103">,</span>&nbsp;<span class="ident" id="6550105">y</span><span class="op" id="6550106">)</span><span class="op" id="6550107">.</span><span class="op" id="6550108">(</span><span class="ident" id="6550109">color</span><span class="op" id="6550114">.</span><span class="ident" id="6550115">NRGBA</span><span class="op" id="6550120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550126">fmt</span><span class="op" id="6550129">.</span><span class="ident" id="6550130">Fprintf</span><span class="op" id="6550137">(</span><span class="ident" id="6550138">w</span><span class="op" id="6550139">,</span>&nbsp;<span class="string" id="6550141">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6550160">,</span>&nbsp;<span class="ident" id="6550162">nrgba</span><span class="op" id="6550167">.</span><span class="ident" id="6550168">R</span><span class="op" id="6550169">,</span>&nbsp;<span class="ident" id="6550171">nrgba</span><span class="op" id="6550176">.</span><span class="ident" id="6550177">G</span><span class="op" id="6550178">,</span>&nbsp;<span class="ident" id="6550180">nrgba</span><span class="op" id="6550185">.</span><span class="ident" id="6550186">B</span><span class="op" id="6550187">,</span>&nbsp;<span class="ident" id="6550189">nrgba</span><span class="op" id="6550194">.</span><span class="ident" id="6550195">A</span><span class="op" id="6550196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550205">case</span>&nbsp;<span class="ident" id="6550210">cm</span>&nbsp;<span class="op" id="6550213">==</span>&nbsp;<span class="ident" id="6550216">color</span><span class="op" id="6550221">.</span><span class="ident" id="6550222">NRGBA64Model</span><span class="op" id="6550234">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550239">for</span>&nbsp;<span class="ident" id="6550243">x</span>&nbsp;<span class="op" id="6550245">:=</span>&nbsp;<span class="ident" id="6550248">bounds</span><span class="op" id="6550254">.</span><span class="ident" id="6550255">Min</span><span class="op" id="6550258">.</span><span class="ident" id="6550259">X</span><span class="op" id="6550260">;</span>&nbsp;<span class="ident" id="6550262">x</span>&nbsp;<span class="op" id="6550264">&lt;</span>&nbsp;<span class="ident" id="6550266">bounds</span><span class="op" id="6550272">.</span><span class="ident" id="6550273">Max</span><span class="op" id="6550276">.</span><span class="ident" id="6550277">X</span><span class="op" id="6550278">;</span>&nbsp;<span class="ident" id="6550280">x</span><span class="op" id="6550281">++</span>&nbsp;<span class="op" id="6550284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550290">nrgba64</span>&nbsp;<span class="op" id="6550298">:=</span>&nbsp;<span class="ident" id="6550301">png</span><span class="op" id="6550304">.</span><span class="ident" id="6550305">At</span><span class="op" id="6550307">(</span><span class="ident" id="6550308">x</span><span class="op" id="6550309">,</span>&nbsp;<span class="ident" id="6550311">y</span><span class="op" id="6550312">)</span><span class="op" id="6550313">.</span><span class="op" id="6550314">(</span><span class="ident" id="6550315">color</span><span class="op" id="6550320">.</span><span class="ident" id="6550321">NRGBA64</span><span class="op" id="6550328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550334">fmt</span><span class="op" id="6550337">.</span><span class="ident" id="6550338">Fprintf</span><span class="op" id="6550345">(</span><span class="ident" id="6550346">w</span><span class="op" id="6550347">,</span>&nbsp;<span class="string" id="6550349">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6550368">,</span>&nbsp;<span class="ident" id="6550370">nrgba64</span><span class="op" id="6550377">.</span><span class="ident" id="6550378">R</span><span class="op" id="6550379">,</span>&nbsp;<span class="ident" id="6550381">nrgba64</span><span class="op" id="6550388">.</span><span class="ident" id="6550389">G</span><span class="op" id="6550390">,</span>&nbsp;<span class="ident" id="6550392">nrgba64</span><span class="op" id="6550399">.</span><span class="ident" id="6550400">B</span><span class="op" id="6550401">,</span>&nbsp;<span class="ident" id="6550403">nrgba64</span><span class="op" id="6550410">.</span><span class="ident" id="6550411">A</span><span class="op" id="6550412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550421">case</span>&nbsp;<span class="ident" id="6550426">cpm</span>&nbsp;<span class="op" id="6550430">!=</span>&nbsp;<span class="ident" id="6550433">nil</span><span class="op" id="6550436">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550441">var</span>&nbsp;<span class="ident" id="6550445">b</span><span class="op" id="6550446">,</span>&nbsp;<span class="ident" id="6550448">c</span>&nbsp;<span class="builtintype" id="6550450">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550457">for</span>&nbsp;<span class="ident" id="6550461">x</span>&nbsp;<span class="op" id="6550463">:=</span>&nbsp;<span class="ident" id="6550466">bounds</span><span class="op" id="6550472">.</span><span class="ident" id="6550473">Min</span><span class="op" id="6550476">.</span><span class="ident" id="6550477">X</span><span class="op" id="6550478">;</span>&nbsp;<span class="ident" id="6550480">x</span>&nbsp;<span class="op" id="6550482">&lt;</span>&nbsp;<span class="ident" id="6550484">bounds</span><span class="op" id="6550490">.</span><span class="ident" id="6550491">Max</span><span class="op" id="6550494">.</span><span class="ident" id="6550495">X</span><span class="op" id="6550496">;</span>&nbsp;<span class="ident" id="6550498">x</span><span class="op" id="6550499">++</span>&nbsp;<span class="op" id="6550502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550508">b</span>&nbsp;<span class="op" id="6550510">=</span>&nbsp;<span class="ident" id="6550512">b</span><span class="op" id="6550513">&lt;&lt;</span><span class="builtintype" id="6550515">uint</span><span class="op" id="6550519">(</span><span class="ident" id="6550520">bitdepth</span><span class="op" id="6550528">)</span>&nbsp;<span class="op" id="6550530">|</span>&nbsp;<span class="builtintype" id="6550532">int</span><span class="op" id="6550535">(</span><span class="ident" id="6550536">paletted</span><span class="op" id="6550544">.</span><span class="ident" id="6550545">ColorIndexAt</span><span class="op" id="6550557">(</span><span class="ident" id="6550558">x</span><span class="op" id="6550559">,</span>&nbsp;<span class="ident" id="6550561">y</span><span class="op" id="6550562">)</span><span class="op" id="6550563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550569">c</span><span class="op" id="6550570">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550577">if</span>&nbsp;<span class="ident" id="6550580">c</span>&nbsp;<span class="op" id="6550582">==</span>&nbsp;<span class="num" id="6550585">8</span><span class="op" id="6550586">/</span><span class="ident" id="6550587">bitdepth</span>&nbsp;<span class="op" id="6550596">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550603">fmt</span><span class="op" id="6550606">.</span><span class="ident" id="6550607">Fprintf</span><span class="op" id="6550614">(</span><span class="ident" id="6550615">w</span><span class="op" id="6550616">,</span>&nbsp;<span class="string" id="6550618">&#34;%02x&#34;</span><span class="op" id="6550624">,</span>&nbsp;<span class="ident" id="6550626">b</span><span class="op" id="6550627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550634">b</span>&nbsp;<span class="op" id="6550636">=</span>&nbsp;<span class="num" id="6550638">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550645">c</span>&nbsp;<span class="op" id="6550647">=</span>&nbsp;<span class="num" id="6550649">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550660">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550665">if</span>&nbsp;<span class="ident" id="6550668">c</span>&nbsp;<span class="op" id="6550670">!=</span>&nbsp;<span class="num" id="6550673">0</span>&nbsp;<span class="op" id="6550675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550681">for</span>&nbsp;<span class="ident" id="6550685">c</span>&nbsp;<span class="op" id="6550687">!=</span>&nbsp;<span class="num" id="6550690">8</span><span class="op" id="6550691">/</span><span class="ident" id="6550692">bitdepth</span>&nbsp;<span class="op" id="6550701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550708">b</span>&nbsp;<span class="op" id="6550710">=</span>&nbsp;<span class="ident" id="6550712">b</span>&nbsp;<span class="op" id="6550714">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6550717">uint</span><span class="op" id="6550721">(</span><span class="ident" id="6550722">bitdepth</span><span class="op" id="6550730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550737">c</span><span class="op" id="6550738">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550745">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550751">fmt</span><span class="op" id="6550754">.</span><span class="ident" id="6550755">Fprintf</span><span class="op" id="6550762">(</span><span class="ident" id="6550763">w</span><span class="op" id="6550764">,</span>&nbsp;<span class="string" id="6550766">&#34;%02x&#34;</span><span class="op" id="6550772">,</span>&nbsp;<span class="ident" id="6550774">b</span><span class="op" id="6550775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550788">io</span><span class="op" id="6550790">.</span><span class="ident" id="6550791">WriteString</span><span class="op" id="6550802">(</span><span class="ident" id="6550803">w</span><span class="op" id="6550804">,</span>&nbsp;<span class="string" id="6550806">&#34;\n&#34;</span><span class="op" id="6550810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550813">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550816">io</span><span class="op" id="6550818">.</span><span class="ident" id="6550819">WriteString</span><span class="op" id="6550830">(</span><span class="ident" id="6550831">w</span><span class="op" id="6550832">,</span>&nbsp;<span class="string" id="6550834">&#34;}\n&#34;</span><span class="op" id="6550839">)</span><br>
<span class="lineno"></span><span class="op" id="6550841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6550844">func</span>&nbsp;<span class="ident" id="6550849">TestReader</span><span class="op" id="6550859">(</span><span class="ident" id="6550860">t</span>&nbsp;<span class="op" id="6550862">*</span><span class="ident" id="6550863">testing</span><span class="op" id="6550870">.</span><span class="ident" id="6550871">T</span><span class="op" id="6550872">)</span>&nbsp;<span class="op" id="6550874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550877">names</span>&nbsp;<span class="op" id="6550883">:=</span>&nbsp;<span class="ident" id="6550886">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550897">if</span>&nbsp;<span class="ident" id="6550900">testing</span><span class="op" id="6550907">.</span><span class="ident" id="6550908">Short</span><span class="op" id="6550913">(</span><span class="op" id="6550914">)</span>&nbsp;<span class="op" id="6550916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6550920">names</span>&nbsp;<span class="op" id="6550926">=</span>&nbsp;<span class="ident" id="6550928">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6550944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6550947">for</span>&nbsp;<span class="ident" id="6550951">_</span><span class="op" id="6550952">,</span>&nbsp;<span class="ident" id="6550954">fn</span>&nbsp;<span class="op" id="6550957">:=</span>&nbsp;<span class="keyword" id="6550960">range</span>&nbsp;<span class="ident" id="6550966">names</span>&nbsp;<span class="op" id="6550972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6550976">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551001">img</span><span class="op" id="6551004">,</span>&nbsp;<span class="ident" id="6551006">err</span>&nbsp;<span class="op" id="6551010">:=</span>&nbsp;<span class="ident" id="6551013">readPNG</span><span class="op" id="6551020">(</span><span class="string" id="6551021">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6551042">+</span>&nbsp;<span class="ident" id="6551044">fn</span>&nbsp;<span class="op" id="6551047">+</span>&nbsp;<span class="string" id="6551049">&#34;.png&#34;</span><span class="op" id="6551055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551059">if</span>&nbsp;<span class="ident" id="6551062">err</span>&nbsp;<span class="op" id="6551066">!=</span>&nbsp;<span class="ident" id="6551069">nil</span>&nbsp;<span class="op" id="6551073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551078">t</span><span class="op" id="6551079">.</span><span class="ident" id="6551080">Error</span><span class="op" id="6551085">(</span><span class="ident" id="6551086">fn</span><span class="op" id="6551088">,</span>&nbsp;<span class="ident" id="6551090">err</span><span class="op" id="6551093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551098">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551109">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551114">if</span>&nbsp;<span class="ident" id="6551117">fn</span>&nbsp;<span class="op" id="6551120">==</span>&nbsp;<span class="string" id="6551123">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="6551134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6551139">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6551216">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551262">c</span>&nbsp;<span class="op" id="6551264">:=</span>&nbsp;<span class="ident" id="6551267">img</span><span class="op" id="6551270">.</span><span class="ident" id="6551271">At</span><span class="op" id="6551273">(</span><span class="num" id="6551274">2</span><span class="op" id="6551275">,</span>&nbsp;<span class="num" id="6551277">1</span><span class="op" id="6551278">)</span><span class="op" id="6551279">.</span><span class="op" id="6551280">(</span><span class="ident" id="6551281">color</span><span class="op" id="6551286">.</span><span class="ident" id="6551287">NRGBA64</span><span class="op" id="6551294">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551299">if</span>&nbsp;<span class="ident" id="6551302">c</span><span class="op" id="6551303">.</span><span class="ident" id="6551304">R</span>&nbsp;<span class="op" id="6551306">!=</span>&nbsp;<span class="num" id="6551309">0x11a7</span>&nbsp;<span class="op" id="6551316">||</span>&nbsp;<span class="ident" id="6551319">c</span><span class="op" id="6551320">.</span><span class="ident" id="6551321">G</span>&nbsp;<span class="op" id="6551323">!=</span>&nbsp;<span class="num" id="6551326">0x11a7</span>&nbsp;<span class="op" id="6551333">||</span>&nbsp;<span class="ident" id="6551336">c</span><span class="op" id="6551337">.</span><span class="ident" id="6551338">B</span>&nbsp;<span class="op" id="6551340">!=</span>&nbsp;<span class="num" id="6551343">0x11a7</span>&nbsp;<span class="op" id="6551350">||</span>&nbsp;<span class="ident" id="6551353">c</span><span class="op" id="6551354">.</span><span class="ident" id="6551355">A</span>&nbsp;<span class="op" id="6551357">!=</span>&nbsp;<span class="num" id="6551360">0x1085</span>&nbsp;<span class="op" id="6551367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551373">t</span><span class="op" id="6551374">.</span><span class="ident" id="6551375">Error</span><span class="op" id="6551380">(</span><span class="ident" id="6551381">fn</span><span class="op" id="6551383">,</span>&nbsp;<span class="ident" id="6551385">fmt</span><span class="op" id="6551388">.</span><span class="ident" id="6551389">Errorf</span><span class="op" id="6551395">(</span><span class="string" id="6551396">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="6551429">,</span>&nbsp;<span class="ident" id="6551431">c</span><span class="op" id="6551432">)</span><span class="op" id="6551433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551443">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551454">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551459">piper</span><span class="op" id="6551464">,</span>&nbsp;<span class="ident" id="6551466">pipew</span>&nbsp;<span class="op" id="6551472">:=</span>&nbsp;<span class="ident" id="6551475">io</span><span class="op" id="6551477">.</span><span class="ident" id="6551478">Pipe</span><span class="op" id="6551482">(</span><span class="op" id="6551483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551487">pb</span>&nbsp;<span class="op" id="6551490">:=</span>&nbsp;<span class="ident" id="6551493">bufio</span><span class="op" id="6551498">.</span><span class="ident" id="6551499">NewScanner</span><span class="op" id="6551509">(</span><span class="ident" id="6551510">piper</span><span class="op" id="6551515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551519">go</span>&nbsp;<span class="ident" id="6551522">sng</span><span class="op" id="6551525">(</span><span class="ident" id="6551526">pipew</span><span class="op" id="6551531">,</span>&nbsp;<span class="ident" id="6551533">fn</span><span class="op" id="6551535">,</span>&nbsp;<span class="ident" id="6551537">img</span><span class="op" id="6551540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551544">defer</span>&nbsp;<span class="ident" id="6551550">piper</span><span class="op" id="6551555">.</span><span class="ident" id="6551556">Close</span><span class="op" id="6551561">(</span><span class="op" id="6551562">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6551567">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551592">sf</span><span class="op" id="6551594">,</span>&nbsp;<span class="ident" id="6551596">err</span>&nbsp;<span class="op" id="6551600">:=</span>&nbsp;<span class="ident" id="6551603">os</span><span class="op" id="6551605">.</span><span class="ident" id="6551606">Open</span><span class="op" id="6551610">(</span><span class="string" id="6551611">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6551632">+</span>&nbsp;<span class="ident" id="6551634">fn</span>&nbsp;<span class="op" id="6551637">+</span>&nbsp;<span class="string" id="6551639">&#34;.sng&#34;</span><span class="op" id="6551645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551649">if</span>&nbsp;<span class="ident" id="6551652">err</span>&nbsp;<span class="op" id="6551656">!=</span>&nbsp;<span class="ident" id="6551659">nil</span>&nbsp;<span class="op" id="6551663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551668">t</span><span class="op" id="6551669">.</span><span class="ident" id="6551670">Error</span><span class="op" id="6551675">(</span><span class="ident" id="6551676">fn</span><span class="op" id="6551678">,</span>&nbsp;<span class="ident" id="6551680">err</span><span class="op" id="6551683">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551688">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551703">defer</span>&nbsp;<span class="ident" id="6551709">sf</span><span class="op" id="6551711">.</span><span class="ident" id="6551712">Close</span><span class="op" id="6551717">(</span><span class="op" id="6551718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551722">sb</span>&nbsp;<span class="op" id="6551725">:=</span>&nbsp;<span class="ident" id="6551728">bufio</span><span class="op" id="6551733">.</span><span class="ident" id="6551734">NewScanner</span><span class="op" id="6551744">(</span><span class="ident" id="6551745">sf</span><span class="op" id="6551747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551751">if</span>&nbsp;<span class="ident" id="6551754">err</span>&nbsp;<span class="op" id="6551758">!=</span>&nbsp;<span class="ident" id="6551761">nil</span>&nbsp;<span class="op" id="6551765">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551770">t</span><span class="op" id="6551771">.</span><span class="ident" id="6551772">Error</span><span class="op" id="6551777">(</span><span class="ident" id="6551778">fn</span><span class="op" id="6551780">,</span>&nbsp;<span class="ident" id="6551782">err</span><span class="op" id="6551785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551790">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6551806">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551857">for</span>&nbsp;<span class="op" id="6551861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551866">pdone</span>&nbsp;<span class="op" id="6551872">:=</span>&nbsp;<span class="op" id="6551875">!</span><span class="ident" id="6551876">pb</span><span class="op" id="6551878">.</span><span class="ident" id="6551879">Scan</span><span class="op" id="6551883">(</span><span class="op" id="6551884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551889">sdone</span>&nbsp;<span class="op" id="6551895">:=</span>&nbsp;<span class="op" id="6551898">!</span><span class="ident" id="6551899">sb</span><span class="op" id="6551901">.</span><span class="ident" id="6551902">Scan</span><span class="op" id="6551906">(</span><span class="op" id="6551907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551912">if</span>&nbsp;<span class="ident" id="6551915">pdone</span>&nbsp;<span class="op" id="6551921">&amp;&amp;</span>&nbsp;<span class="ident" id="6551924">sdone</span>&nbsp;<span class="op" id="6551930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551936">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6551945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6551950">if</span>&nbsp;<span class="ident" id="6551953">pdone</span>&nbsp;<span class="op" id="6551959">||</span>&nbsp;<span class="ident" id="6551962">sdone</span>&nbsp;<span class="op" id="6551968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6551974">t</span><span class="op" id="6551975">.</span><span class="ident" id="6551976">Errorf</span><span class="op" id="6551982">(</span><span class="string" id="6551983">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="6552004">,</span>&nbsp;<span class="ident" id="6552006">fn</span><span class="op" id="6552008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552014">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552023">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552028">ps</span>&nbsp;<span class="op" id="6552031">:=</span>&nbsp;<span class="ident" id="6552034">pb</span><span class="op" id="6552036">.</span><span class="ident" id="6552037">Text</span><span class="op" id="6552041">(</span><span class="op" id="6552042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552047">ss</span>&nbsp;<span class="op" id="6552050">:=</span>&nbsp;<span class="ident" id="6552053">sb</span><span class="op" id="6552055">.</span><span class="ident" id="6552056">Text</span><span class="op" id="6552060">(</span><span class="op" id="6552061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552066">if</span>&nbsp;<span class="ident" id="6552069">ps</span>&nbsp;<span class="op" id="6552072">!=</span>&nbsp;<span class="ident" id="6552075">ss</span>&nbsp;<span class="op" id="6552078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552084">t</span><span class="op" id="6552085">.</span><span class="ident" id="6552086">Errorf</span><span class="op" id="6552092">(</span><span class="string" id="6552093">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="6552123">,</span>&nbsp;<span class="ident" id="6552125">fn</span><span class="op" id="6552127">,</span>&nbsp;<span class="ident" id="6552129">ps</span><span class="op" id="6552131">,</span>&nbsp;<span class="ident" id="6552133">ss</span><span class="op" id="6552135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552141">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552158">if</span>&nbsp;<span class="ident" id="6552161">pb</span><span class="op" id="6552163">.</span><span class="ident" id="6552164">Err</span><span class="op" id="6552167">(</span><span class="op" id="6552168">)</span>&nbsp;<span class="op" id="6552170">!=</span>&nbsp;<span class="ident" id="6552173">nil</span>&nbsp;<span class="op" id="6552177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552182">t</span><span class="op" id="6552183">.</span><span class="ident" id="6552184">Error</span><span class="op" id="6552189">(</span><span class="ident" id="6552190">fn</span><span class="op" id="6552192">,</span>&nbsp;<span class="ident" id="6552194">pb</span><span class="op" id="6552196">.</span><span class="ident" id="6552197">Err</span><span class="op" id="6552200">(</span><span class="op" id="6552201">)</span><span class="op" id="6552202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552206">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552210">if</span>&nbsp;<span class="ident" id="6552213">sb</span><span class="op" id="6552215">.</span><span class="ident" id="6552216">Err</span><span class="op" id="6552219">(</span><span class="op" id="6552220">)</span>&nbsp;<span class="op" id="6552222">!=</span>&nbsp;<span class="ident" id="6552225">nil</span>&nbsp;<span class="op" id="6552229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552234">t</span><span class="op" id="6552235">.</span><span class="ident" id="6552236">Error</span><span class="op" id="6552241">(</span><span class="ident" id="6552242">fn</span><span class="op" id="6552244">,</span>&nbsp;<span class="ident" id="6552246">sb</span><span class="op" id="6552248">.</span><span class="ident" id="6552249">Err</span><span class="op" id="6552252">(</span><span class="op" id="6552253">)</span><span class="op" id="6552254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552261">}</span><br>
<span class="lineno"></span><span class="op" id="6552263">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6552266">var</span>&nbsp;<span class="ident" id="6552270">readerErrors</span>&nbsp;<span class="op" id="6552283">=</span>&nbsp;<span class="op" id="6552285">[</span><span class="op" id="6552286">]</span><span class="keyword" id="6552287">struct</span>&nbsp;<span class="op" id="6552294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552297">file</span>&nbsp;<span class="builtintype" id="6552302">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552310">err</span>&nbsp;&nbsp;<span class="builtintype" id="6552315">string</span><br>
<span class="lineno"></span><span class="op" id="6552322">}</span><span class="op" id="6552323">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552326">{</span><span class="string" id="6552327">&#34;invalid-zlib.png&#34;</span><span class="op" id="6552345">,</span>&nbsp;<span class="string" id="6552347">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="6552371">}</span><span class="op" id="6552372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552375">{</span><span class="string" id="6552376">&#34;invalid-crc32.png&#34;</span><span class="op" id="6552395">,</span>&nbsp;<span class="string" id="6552397">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6552415">}</span><span class="op" id="6552416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552419">{</span><span class="string" id="6552420">&#34;invalid-noend.png&#34;</span><span class="op" id="6552439">,</span>&nbsp;<span class="string" id="6552441">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6552457">}</span><span class="op" id="6552458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552461">{</span><span class="string" id="6552462">&#34;invalid-trunc.png&#34;</span><span class="op" id="6552481">,</span>&nbsp;<span class="string" id="6552483">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6552499">}</span><span class="op" id="6552500">,</span><br>
<span class="lineno"></span><span class="op" id="6552502">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6552505">func</span>&nbsp;<span class="ident" id="6552510">TestReaderError</span><span class="op" id="6552525">(</span><span class="ident" id="6552526">t</span>&nbsp;<span class="op" id="6552528">*</span><span class="ident" id="6552529">testing</span><span class="op" id="6552536">.</span><span class="ident" id="6552537">T</span><span class="op" id="6552538">)</span>&nbsp;<span class="op" id="6552540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552543">for</span>&nbsp;<span class="ident" id="6552547">_</span><span class="op" id="6552548">,</span>&nbsp;<span class="ident" id="6552550">tt</span>&nbsp;<span class="op" id="6552553">:=</span>&nbsp;<span class="keyword" id="6552556">range</span>&nbsp;<span class="ident" id="6552562">readerErrors</span>&nbsp;<span class="op" id="6552575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552579">img</span><span class="op" id="6552582">,</span>&nbsp;<span class="ident" id="6552584">err</span>&nbsp;<span class="op" id="6552588">:=</span>&nbsp;<span class="ident" id="6552591">readPNG</span><span class="op" id="6552598">(</span><span class="string" id="6552599">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="6552611">+</span>&nbsp;<span class="ident" id="6552613">tt</span><span class="op" id="6552615">.</span><span class="ident" id="6552616">file</span><span class="op" id="6552620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552624">if</span>&nbsp;<span class="ident" id="6552627">err</span>&nbsp;<span class="op" id="6552631">==</span>&nbsp;<span class="ident" id="6552634">nil</span>&nbsp;<span class="op" id="6552638">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552643">t</span><span class="op" id="6552644">.</span><span class="ident" id="6552645">Errorf</span><span class="op" id="6552651">(</span><span class="string" id="6552652">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="6552680">,</span>&nbsp;<span class="ident" id="6552682">tt</span><span class="op" id="6552684">.</span><span class="ident" id="6552685">file</span><span class="op" id="6552689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552694">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552709">if</span>&nbsp;<span class="op" id="6552712">!</span><span class="ident" id="6552713">strings</span><span class="op" id="6552720">.</span><span class="ident" id="6552721">Contains</span><span class="op" id="6552729">(</span><span class="ident" id="6552730">err</span><span class="op" id="6552733">.</span><span class="ident" id="6552734">Error</span><span class="op" id="6552739">(</span><span class="op" id="6552740">)</span><span class="op" id="6552741">,</span>&nbsp;<span class="ident" id="6552743">tt</span><span class="op" id="6552745">.</span><span class="ident" id="6552746">err</span><span class="op" id="6552749">)</span>&nbsp;<span class="op" id="6552751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552756">t</span><span class="op" id="6552757">.</span><span class="ident" id="6552758">Errorf</span><span class="op" id="6552764">(</span><span class="string" id="6552765">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6552791">,</span>&nbsp;<span class="ident" id="6552793">tt</span><span class="op" id="6552795">.</span><span class="ident" id="6552796">file</span><span class="op" id="6552800">,</span>&nbsp;<span class="ident" id="6552802">err</span><span class="op" id="6552805">,</span>&nbsp;<span class="ident" id="6552807">tt</span><span class="op" id="6552809">.</span><span class="ident" id="6552810">err</span><span class="op" id="6552813">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552821">if</span>&nbsp;<span class="ident" id="6552824">img</span>&nbsp;<span class="op" id="6552828">!=</span>&nbsp;<span class="ident" id="6552831">nil</span>&nbsp;<span class="op" id="6552835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552840">t</span><span class="op" id="6552841">.</span><span class="ident" id="6552842">Errorf</span><span class="op" id="6552848">(</span><span class="string" id="6552849">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="6552882">,</span>&nbsp;<span class="ident" id="6552884">tt</span><span class="op" id="6552886">.</span><span class="ident" id="6552887">file</span><span class="op" id="6552891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6552898">}</span><br>
<span class="lineno">295</span><span class="op" id="6552900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6552903">func</span>&nbsp;<span class="ident" id="6552908">TestPalettedDecodeConfig</span><span class="op" id="6552932">(</span><span class="ident" id="6552933">t</span>&nbsp;<span class="op" id="6552935">*</span><span class="ident" id="6552936">testing</span><span class="op" id="6552943">.</span><span class="ident" id="6552944">T</span><span class="op" id="6552945">)</span>&nbsp;<span class="op" id="6552947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6552950">for</span>&nbsp;<span class="ident" id="6552954">_</span><span class="op" id="6552955">,</span>&nbsp;<span class="ident" id="6552957">fn</span>&nbsp;<span class="op" id="6552960">:=</span>&nbsp;<span class="keyword" id="6552963">range</span>&nbsp;<span class="ident" id="6552969">filenamesPaletted</span>&nbsp;<span class="op" id="6552987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6552991">f</span><span class="op" id="6552992">,</span>&nbsp;<span class="ident" id="6552994">err</span>&nbsp;<span class="op" id="6552998">:=</span>&nbsp;<span class="ident" id="6553001">os</span><span class="op" id="6553003">.</span><span class="ident" id="6553004">Open</span><span class="op" id="6553008">(</span><span class="string" id="6553009">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6553030">+</span>&nbsp;<span class="ident" id="6553032">fn</span>&nbsp;<span class="op" id="6553035">+</span>&nbsp;<span class="string" id="6553037">&#34;.png&#34;</span><span class="op" id="6553043">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553047">if</span>&nbsp;<span class="ident" id="6553050">err</span>&nbsp;<span class="op" id="6553054">!=</span>&nbsp;<span class="ident" id="6553057">nil</span>&nbsp;<span class="op" id="6553061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553066">t</span><span class="op" id="6553067">.</span><span class="ident" id="6553068">Errorf</span><span class="op" id="6553074">(</span><span class="string" id="6553075">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6553096">,</span>&nbsp;<span class="ident" id="6553098">fn</span><span class="op" id="6553100">,</span>&nbsp;<span class="ident" id="6553102">err</span><span class="op" id="6553105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553110">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553125">defer</span>&nbsp;<span class="ident" id="6553131">f</span><span class="op" id="6553132">.</span><span class="ident" id="6553133">Close</span><span class="op" id="6553138">(</span><span class="op" id="6553139">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553143">cfg</span><span class="op" id="6553146">,</span>&nbsp;<span class="ident" id="6553148">err</span>&nbsp;<span class="op" id="6553152">:=</span>&nbsp;<span class="ident" id="6553155">DecodeConfig</span><span class="op" id="6553167">(</span><span class="ident" id="6553168">f</span><span class="op" id="6553169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553173">if</span>&nbsp;<span class="ident" id="6553176">err</span>&nbsp;<span class="op" id="6553180">!=</span>&nbsp;<span class="ident" id="6553183">nil</span>&nbsp;<span class="op" id="6553187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553192">t</span><span class="op" id="6553193">.</span><span class="ident" id="6553194">Errorf</span><span class="op" id="6553200">(</span><span class="string" id="6553201">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6553209">,</span>&nbsp;<span class="ident" id="6553211">fn</span><span class="op" id="6553213">,</span>&nbsp;<span class="ident" id="6553215">err</span><span class="op" id="6553218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553223">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553234">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553238">pal</span><span class="op" id="6553241">,</span>&nbsp;<span class="ident" id="6553243">ok</span>&nbsp;<span class="op" id="6553246">:=</span>&nbsp;<span class="ident" id="6553249">cfg</span><span class="op" id="6553252">.</span><span class="ident" id="6553253">ColorModel</span><span class="op" id="6553263">.</span><span class="op" id="6553264">(</span><span class="ident" id="6553265">color</span><span class="op" id="6553270">.</span><span class="ident" id="6553271">Palette</span><span class="op" id="6553278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553282">if</span>&nbsp;<span class="op" id="6553285">!</span><span class="ident" id="6553286">ok</span>&nbsp;<span class="op" id="6553289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553294">t</span><span class="op" id="6553295">.</span><span class="ident" id="6553296">Errorf</span><span class="op" id="6553302">(</span><span class="string" id="6553303">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="6553338">,</span>&nbsp;<span class="ident" id="6553340">fn</span><span class="op" id="6553342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553347">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553358">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553362">if</span>&nbsp;<span class="ident" id="6553365">pal</span>&nbsp;<span class="op" id="6553369">==</span>&nbsp;<span class="ident" id="6553372">nil</span>&nbsp;<span class="op" id="6553376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553381">t</span><span class="op" id="6553382">.</span><span class="ident" id="6553383">Errorf</span><span class="op" id="6553389">(</span><span class="string" id="6553390">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="6553419">,</span>&nbsp;<span class="ident" id="6553421">fn</span><span class="op" id="6553423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553428">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553442">}</span><br>
<span class="lineno">320</span><span class="op" id="6553444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553447">func</span>&nbsp;<span class="ident" id="6553452">benchmarkDecode</span><span class="op" id="6553467">(</span><span class="ident" id="6553468">b</span>&nbsp;<span class="op" id="6553470">*</span><span class="ident" id="6553471">testing</span><span class="op" id="6553478">.</span><span class="ident" id="6553479">B</span><span class="op" id="6553480">,</span>&nbsp;<span class="ident" id="6553482">filename</span>&nbsp;<span class="builtintype" id="6553491">string</span><span class="op" id="6553497">,</span>&nbsp;<span class="ident" id="6553499">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6553513">int</span><span class="op" id="6553516">)</span>&nbsp;<span class="op" id="6553518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553521">b</span><span class="op" id="6553522">.</span><span class="ident" id="6553523">StopTimer</span><span class="op" id="6553532">(</span><span class="op" id="6553533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553536">data</span><span class="op" id="6553540">,</span>&nbsp;<span class="ident" id="6553542">err</span>&nbsp;<span class="op" id="6553546">:=</span>&nbsp;<span class="ident" id="6553549">ioutil</span><span class="op" id="6553555">.</span><span class="ident" id="6553556">ReadFile</span><span class="op" id="6553564">(</span><span class="ident" id="6553565">filename</span><span class="op" id="6553573">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553576">if</span>&nbsp;<span class="ident" id="6553579">err</span>&nbsp;<span class="op" id="6553583">!=</span>&nbsp;<span class="ident" id="6553586">nil</span>&nbsp;<span class="op" id="6553590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553594">b</span><span class="op" id="6553595">.</span><span class="ident" id="6553596">Fatal</span><span class="op" id="6553601">(</span><span class="ident" id="6553602">err</span><span class="op" id="6553605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553611">s</span>&nbsp;<span class="op" id="6553613">:=</span>&nbsp;<span class="builtintype" id="6553616">string</span><span class="op" id="6553622">(</span><span class="ident" id="6553623">data</span><span class="op" id="6553627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553630">cfg</span><span class="op" id="6553633">,</span>&nbsp;<span class="ident" id="6553635">err</span>&nbsp;<span class="op" id="6553639">:=</span>&nbsp;<span class="ident" id="6553642">DecodeConfig</span><span class="op" id="6553654">(</span><span class="ident" id="6553655">strings</span><span class="op" id="6553662">.</span><span class="ident" id="6553663">NewReader</span><span class="op" id="6553672">(</span><span class="ident" id="6553673">s</span><span class="op" id="6553674">)</span><span class="op" id="6553675">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553678">if</span>&nbsp;<span class="ident" id="6553681">err</span>&nbsp;<span class="op" id="6553685">!=</span>&nbsp;<span class="ident" id="6553688">nil</span>&nbsp;<span class="op" id="6553692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553696">b</span><span class="op" id="6553697">.</span><span class="ident" id="6553698">Fatal</span><span class="op" id="6553703">(</span><span class="ident" id="6553704">err</span><span class="op" id="6553707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553713">b</span><span class="op" id="6553714">.</span><span class="ident" id="6553715">SetBytes</span><span class="op" id="6553723">(</span><span class="ident" id="6553724">int64</span><span class="op" id="6553729">(</span><span class="ident" id="6553730">cfg</span><span class="op" id="6553733">.</span><span class="ident" id="6553734">Width</span>&nbsp;<span class="op" id="6553740">*</span>&nbsp;<span class="ident" id="6553742">cfg</span><span class="op" id="6553745">.</span><span class="ident" id="6553746">Height</span>&nbsp;<span class="op" id="6553753">*</span>&nbsp;<span class="ident" id="6553755">bytesPerPixel</span><span class="op" id="6553768">)</span><span class="op" id="6553769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553772">b</span><span class="op" id="6553773">.</span><span class="ident" id="6553774">StartTimer</span><span class="op" id="6553784">(</span><span class="op" id="6553785">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6553788">for</span>&nbsp;<span class="ident" id="6553792">i</span>&nbsp;<span class="op" id="6553794">:=</span>&nbsp;<span class="num" id="6553797">0</span><span class="op" id="6553798">;</span>&nbsp;<span class="ident" id="6553800">i</span>&nbsp;<span class="op" id="6553802">&lt;</span>&nbsp;<span class="ident" id="6553804">b</span><span class="op" id="6553805">.</span><span class="ident" id="6553806">N</span><span class="op" id="6553807">;</span>&nbsp;<span class="ident" id="6553809">i</span><span class="op" id="6553810">++</span>&nbsp;<span class="op" id="6553813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553817">Decode</span><span class="op" id="6553823">(</span><span class="ident" id="6553824">strings</span><span class="op" id="6553831">.</span><span class="ident" id="6553832">NewReader</span><span class="op" id="6553841">(</span><span class="ident" id="6553842">s</span><span class="op" id="6553843">)</span><span class="op" id="6553844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6553847">}</span><br>
<span class="lineno"></span><span class="op" id="6553849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6553852">func</span>&nbsp;<span class="ident" id="6553857">BenchmarkDecodeGray</span><span class="op" id="6553876">(</span><span class="ident" id="6553877">b</span>&nbsp;<span class="op" id="6553879">*</span><span class="ident" id="6553880">testing</span><span class="op" id="6553887">.</span><span class="ident" id="6553888">B</span><span class="op" id="6553889">)</span>&nbsp;<span class="op" id="6553891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553894">benchmarkDecode</span><span class="op" id="6553909">(</span><span class="ident" id="6553910">b</span><span class="op" id="6553911">,</span>&nbsp;<span class="string" id="6553913">&#34;testdata/benchGray.png&#34;</span><span class="op" id="6553937">,</span>&nbsp;<span class="num" id="6553939">1</span><span class="op" id="6553940">)</span><br>
<span class="lineno"></span><span class="op" id="6553942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6553945">func</span>&nbsp;<span class="ident" id="6553950">BenchmarkDecodeNRGBAGradient</span><span class="op" id="6553978">(</span><span class="ident" id="6553979">b</span>&nbsp;<span class="op" id="6553981">*</span><span class="ident" id="6553982">testing</span><span class="op" id="6553989">.</span><span class="ident" id="6553990">B</span><span class="op" id="6553991">)</span>&nbsp;<span class="op" id="6553993">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6553996">benchmarkDecode</span><span class="op" id="6554011">(</span><span class="ident" id="6554012">b</span><span class="op" id="6554013">,</span>&nbsp;<span class="string" id="6554015">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="6554049">,</span>&nbsp;<span class="num" id="6554051">4</span><span class="op" id="6554052">)</span><br>
<span class="lineno"></span><span class="op" id="6554054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554057">func</span>&nbsp;<span class="ident" id="6554062">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="6554088">(</span><span class="ident" id="6554089">b</span>&nbsp;<span class="op" id="6554091">*</span><span class="ident" id="6554092">testing</span><span class="op" id="6554099">.</span><span class="ident" id="6554100">B</span><span class="op" id="6554101">)</span>&nbsp;<span class="op" id="6554103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554106">benchmarkDecode</span><span class="op" id="6554121">(</span><span class="ident" id="6554122">b</span><span class="op" id="6554123">,</span>&nbsp;<span class="string" id="6554125">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="6554157">,</span>&nbsp;<span class="num" id="6554159">4</span><span class="op" id="6554160">)</span><br>
<span class="lineno">350</span><span class="op" id="6554162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6554165">func</span>&nbsp;<span class="ident" id="6554170">BenchmarkDecodePaletted</span><span class="op" id="6554193">(</span><span class="ident" id="6554194">b</span>&nbsp;<span class="op" id="6554196">*</span><span class="ident" id="6554197">testing</span><span class="op" id="6554204">.</span><span class="ident" id="6554205">B</span><span class="op" id="6554206">)</span>&nbsp;<span class="op" id="6554208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554211">benchmarkDecode</span><span class="op" id="6554226">(</span><span class="ident" id="6554227">b</span><span class="op" id="6554228">,</span>&nbsp;<span class="string" id="6554230">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="6554258">,</span>&nbsp;<span class="num" id="6554260">1</span><span class="op" id="6554261">)</span><br>
<span class="lineno"></span><span class="op" id="6554263">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6554266">func</span>&nbsp;<span class="ident" id="6554271">BenchmarkDecodeRGB</span><span class="op" id="6554289">(</span><span class="ident" id="6554290">b</span>&nbsp;<span class="op" id="6554292">*</span><span class="ident" id="6554293">testing</span><span class="op" id="6554300">.</span><span class="ident" id="6554301">B</span><span class="op" id="6554302">)</span>&nbsp;<span class="op" id="6554304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554307">benchmarkDecode</span><span class="op" id="6554322">(</span><span class="ident" id="6554323">b</span><span class="op" id="6554324">,</span>&nbsp;<span class="string" id="6554326">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="6554349">,</span>&nbsp;<span class="num" id="6554351">4</span><span class="op" id="6554352">)</span><br>
<span class="lineno"></span><span class="op" id="6554354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="6554357">func</span>&nbsp;<span class="ident" id="6554362">BenchmarkDecodeInterlacing</span><span class="op" id="6554388">(</span><span class="ident" id="6554389">b</span>&nbsp;<span class="op" id="6554391">*</span><span class="ident" id="6554392">testing</span><span class="op" id="6554399">.</span><span class="ident" id="6554400">B</span><span class="op" id="6554401">)</span>&nbsp;<span class="op" id="6554403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6554406">benchmarkDecode</span><span class="op" id="6554421">(</span><span class="ident" id="6554422">b</span><span class="op" id="6554423">,</span>&nbsp;<span class="string" id="6554425">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="6554458">,</span>&nbsp;<span class="num" id="6554460">4</span><span class="op" id="6554461">)</span><br>
<span class="lineno"></span><span class="op" id="6554463">}</span>
</div>
</body>
</html>
