<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4077759">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4077814">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4077868">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4077919">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="4077987">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="4078033">//</span><br>
<span class="lineno"></span><span class="comment" id="4078036">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;signed&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="4078061">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsp;rational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="4078087">//</span><br>
<span class="lineno"></span><span class="comment" id="4078090">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="4078128">//</span><br>
<span class="lineno"></span><span class="comment" id="4078131">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp;(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="4078186">//</span><br>
<span class="lineno">15</span><span class="comment" id="4078189">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="4078263">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="4078336">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="4078410">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4078484">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="4078501">//</span><br>
<span class="lineno"></span><span class="keyword" id="4078504">package</span>&nbsp;<span class="ident" id="4078512">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4078517">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="4078588">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="4078659">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4078678">import</span>&nbsp;<span class="op" id="4078685">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4078688">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4078698">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4078704">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4078712">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4078725">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4078732">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4078735">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4078772">//</span><br>
<span class="lineno"></span><span class="comment" id="4078775">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="4078841">//</span><br>
<span class="lineno"></span><span class="comment" id="4078844">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="4078916">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="4078963">//</span><br>
<span class="lineno"></span><span class="comment" id="4078966">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="4079035">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4079106">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="4079177">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4079240">//</span><br>
<span class="lineno"></span><span class="keyword" id="4079243">type</span>&nbsp;<span class="ident" id="4079248">nat</span>&nbsp;<span class="op" id="4079252">[</span><span class="op" id="4079253">]</span><span class="ident" id="4079254">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4079260">var</span>&nbsp;<span class="op" id="4079264">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079267">natOne</span>&nbsp;<span class="op" id="4079274">=</span>&nbsp;<span class="ident" id="4079276">nat</span><span class="op" id="4079279">{</span><span class="num" id="4079280">1</span><span class="op" id="4079281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079284">natTwo</span>&nbsp;<span class="op" id="4079291">=</span>&nbsp;<span class="ident" id="4079293">nat</span><span class="op" id="4079296">{</span><span class="num" id="4079297">2</span><span class="op" id="4079298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079301">natTen</span>&nbsp;<span class="op" id="4079308">=</span>&nbsp;<span class="ident" id="4079310">nat</span><span class="op" id="4079313">{</span><span class="num" id="4079314">10</span><span class="op" id="4079316">}</span><br>
<span class="lineno"></span><span class="op" id="4079318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4079321">func</span>&nbsp;<span class="op" id="4079326">(</span><span class="ident" id="4079327">z</span>&nbsp;<span class="ident" id="4079329">nat</span><span class="op" id="4079332">)</span>&nbsp;<span class="ident" id="4079334">clear</span><span class="op" id="4079339">(</span><span class="op" id="4079340">)</span>&nbsp;<span class="op" id="4079342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079345">for</span>&nbsp;<span class="ident" id="4079349">i</span>&nbsp;<span class="op" id="4079351">:=</span>&nbsp;<span class="keyword" id="4079354">range</span>&nbsp;<span class="ident" id="4079360">z</span>&nbsp;<span class="op" id="4079362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079366">z</span><span class="op" id="4079367">[</span><span class="ident" id="4079368">i</span><span class="op" id="4079369">]</span>&nbsp;<span class="op" id="4079371">=</span>&nbsp;<span class="num" id="4079373">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079376">}</span><br>
<span class="lineno"></span><span class="op" id="4079378">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4079381">func</span>&nbsp;<span class="op" id="4079386">(</span><span class="ident" id="4079387">z</span>&nbsp;<span class="ident" id="4079389">nat</span><span class="op" id="4079392">)</span>&nbsp;<span class="ident" id="4079394">norm</span><span class="op" id="4079398">(</span><span class="op" id="4079399">)</span>&nbsp;<span class="ident" id="4079401">nat</span>&nbsp;<span class="op" id="4079405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079408">i</span>&nbsp;<span class="op" id="4079410">:=</span>&nbsp;<span class="builtinfunc" id="4079413">len</span><span class="op" id="4079416">(</span><span class="ident" id="4079417">z</span><span class="op" id="4079418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079421">for</span>&nbsp;<span class="ident" id="4079425">i</span>&nbsp;<span class="op" id="4079427">&gt;</span>&nbsp;<span class="num" id="4079429">0</span>&nbsp;<span class="op" id="4079431">&amp;&amp;</span>&nbsp;<span class="ident" id="4079434">z</span><span class="op" id="4079435">[</span><span class="ident" id="4079436">i</span><span class="op" id="4079437">-</span><span class="num" id="4079438">1</span><span class="op" id="4079439">]</span>&nbsp;<span class="op" id="4079441">==</span>&nbsp;<span class="num" id="4079444">0</span>&nbsp;<span class="op" id="4079446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079450">i</span><span class="op" id="4079451">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079458">return</span>&nbsp;<span class="ident" id="4079465">z</span><span class="op" id="4079466">[</span><span class="num" id="4079467">0</span><span class="op" id="4079468">:</span><span class="ident" id="4079469">i</span><span class="op" id="4079470">]</span><br>
<span class="lineno"></span><span class="op" id="4079472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4079475">func</span>&nbsp;<span class="op" id="4079480">(</span><span class="ident" id="4079481">z</span>&nbsp;<span class="ident" id="4079483">nat</span><span class="op" id="4079486">)</span>&nbsp;<span class="builtinfunc" id="4079488">make</span><span class="op" id="4079492">(</span><span class="ident" id="4079493">n</span>&nbsp;<span class="builtintype" id="4079495">int</span><span class="op" id="4079498">)</span>&nbsp;<span class="ident" id="4079500">nat</span>&nbsp;<span class="op" id="4079504">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079507">if</span>&nbsp;<span class="ident" id="4079510">n</span>&nbsp;<span class="op" id="4079512">&lt;=</span>&nbsp;<span class="builtinfunc" id="4079515">cap</span><span class="op" id="4079518">(</span><span class="ident" id="4079519">z</span><span class="op" id="4079520">)</span>&nbsp;<span class="op" id="4079522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079526">return</span>&nbsp;<span class="ident" id="4079533">z</span><span class="op" id="4079534">[</span><span class="num" id="4079535">0</span><span class="op" id="4079536">:</span><span class="ident" id="4079537">n</span><span class="op" id="4079538">]</span>&nbsp;<span class="comment" id="4079540">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4079555">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4079622">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079686">const</span>&nbsp;<span class="ident" id="4079692">e</span>&nbsp;<span class="op" id="4079694">=</span>&nbsp;<span class="num" id="4079696">4</span>&nbsp;<span class="comment" id="4079698">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079717">return</span>&nbsp;<span class="builtinfunc" id="4079724">make</span><span class="op" id="4079728">(</span><span class="ident" id="4079729">nat</span><span class="op" id="4079732">,</span>&nbsp;<span class="ident" id="4079734">n</span><span class="op" id="4079735">,</span>&nbsp;<span class="ident" id="4079737">n</span><span class="op" id="4079738">+</span><span class="ident" id="4079739">e</span><span class="op" id="4079740">)</span><br>
<span class="lineno"></span><span class="op" id="4079742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4079745">func</span>&nbsp;<span class="op" id="4079750">(</span><span class="ident" id="4079751">z</span>&nbsp;<span class="ident" id="4079753">nat</span><span class="op" id="4079756">)</span>&nbsp;<span class="ident" id="4079758">setWord</span><span class="op" id="4079765">(</span><span class="ident" id="4079766">x</span>&nbsp;<span class="ident" id="4079768">Word</span><span class="op" id="4079772">)</span>&nbsp;<span class="ident" id="4079774">nat</span>&nbsp;<span class="op" id="4079778">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079781">if</span>&nbsp;<span class="ident" id="4079784">x</span>&nbsp;<span class="op" id="4079786">==</span>&nbsp;<span class="num" id="4079789">0</span>&nbsp;<span class="op" id="4079791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079795">return</span>&nbsp;<span class="ident" id="4079802">z</span><span class="op" id="4079803">.</span><span class="builtinfunc" id="4079804">make</span><span class="op" id="4079808">(</span><span class="num" id="4079809">0</span><span class="op" id="4079810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079816">z</span>&nbsp;<span class="op" id="4079818">=</span>&nbsp;<span class="ident" id="4079820">z</span><span class="op" id="4079821">.</span><span class="builtinfunc" id="4079822">make</span><span class="op" id="4079826">(</span><span class="num" id="4079827">1</span><span class="op" id="4079828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4079831">z</span><span class="op" id="4079832">[</span><span class="num" id="4079833">0</span><span class="op" id="4079834">]</span>&nbsp;<span class="op" id="4079836">=</span>&nbsp;<span class="ident" id="4079838">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079841">return</span>&nbsp;<span class="ident" id="4079848">z</span><br>
<span class="lineno"></span><span class="op" id="4079850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4079853">func</span>&nbsp;<span class="op" id="4079858">(</span><span class="ident" id="4079859">z</span>&nbsp;<span class="ident" id="4079861">nat</span><span class="op" id="4079864">)</span>&nbsp;<span class="ident" id="4079866">setUint64</span><span class="op" id="4079875">(</span><span class="ident" id="4079876">x</span>&nbsp;<span class="builtintype" id="4079878">uint64</span><span class="op" id="4079884">)</span>&nbsp;<span class="ident" id="4079886">nat</span>&nbsp;<span class="op" id="4079890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4079893">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079917">if</span>&nbsp;<span class="ident" id="4079920">w</span>&nbsp;<span class="op" id="4079922">:=</span>&nbsp;<span class="ident" id="4079925">Word</span><span class="op" id="4079929">(</span><span class="ident" id="4079930">x</span><span class="op" id="4079931">)</span><span class="op" id="4079932">;</span>&nbsp;<span class="builtintype" id="4079934">uint64</span><span class="op" id="4079940">(</span><span class="ident" id="4079941">w</span><span class="op" id="4079942">)</span>&nbsp;<span class="op" id="4079944">==</span>&nbsp;<span class="ident" id="4079947">x</span>&nbsp;<span class="op" id="4079949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4079953">return</span>&nbsp;<span class="ident" id="4079960">z</span><span class="op" id="4079961">.</span><span class="ident" id="4079962">setWord</span><span class="op" id="4079969">(</span><span class="ident" id="4079970">w</span><span class="op" id="4079971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4079974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4079978">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080032">n</span>&nbsp;<span class="op" id="4080034">:=</span>&nbsp;<span class="num" id="4080037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080040">for</span>&nbsp;<span class="ident" id="4080044">t</span>&nbsp;<span class="op" id="4080046">:=</span>&nbsp;<span class="ident" id="4080049">x</span><span class="op" id="4080050">;</span>&nbsp;<span class="ident" id="4080052">t</span>&nbsp;<span class="op" id="4080054">&gt;</span>&nbsp;<span class="num" id="4080056">0</span><span class="op" id="4080057">;</span>&nbsp;<span class="ident" id="4080059">t</span>&nbsp;<span class="op" id="4080061">&gt;&gt;=</span>&nbsp;<span class="ident" id="4080065">_W</span>&nbsp;<span class="op" id="4080068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080072">n</span><span class="op" id="4080073">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080081">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080106">z</span>&nbsp;<span class="op" id="4080108">=</span>&nbsp;<span class="ident" id="4080110">z</span><span class="op" id="4080111">.</span><span class="builtinfunc" id="4080112">make</span><span class="op" id="4080116">(</span><span class="ident" id="4080117">n</span><span class="op" id="4080118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080121">for</span>&nbsp;<span class="ident" id="4080125">i</span>&nbsp;<span class="op" id="4080127">:=</span>&nbsp;<span class="keyword" id="4080130">range</span>&nbsp;<span class="ident" id="4080136">z</span>&nbsp;<span class="op" id="4080138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080142">z</span><span class="op" id="4080143">[</span><span class="ident" id="4080144">i</span><span class="op" id="4080145">]</span>&nbsp;<span class="op" id="4080147">=</span>&nbsp;<span class="ident" id="4080149">Word</span><span class="op" id="4080153">(</span><span class="ident" id="4080154">x</span>&nbsp;<span class="op" id="4080156">&amp;</span>&nbsp;<span class="ident" id="4080158">_M</span><span class="op" id="4080160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080164">x</span>&nbsp;<span class="op" id="4080166">&gt;&gt;=</span>&nbsp;<span class="ident" id="4080170">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080178">return</span>&nbsp;<span class="ident" id="4080185">z</span><br>
<span class="lineno"></span><span class="op" id="4080187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="4080190">func</span>&nbsp;<span class="op" id="4080195">(</span><span class="ident" id="4080196">z</span>&nbsp;<span class="ident" id="4080198">nat</span><span class="op" id="4080201">)</span>&nbsp;<span class="ident" id="4080203">set</span><span class="op" id="4080206">(</span><span class="ident" id="4080207">x</span>&nbsp;<span class="ident" id="4080209">nat</span><span class="op" id="4080212">)</span>&nbsp;<span class="ident" id="4080214">nat</span>&nbsp;<span class="op" id="4080218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080221">z</span>&nbsp;<span class="op" id="4080223">=</span>&nbsp;<span class="ident" id="4080225">z</span><span class="op" id="4080226">.</span><span class="builtinfunc" id="4080227">make</span><span class="op" id="4080231">(</span><span class="builtinfunc" id="4080232">len</span><span class="op" id="4080235">(</span><span class="ident" id="4080236">x</span><span class="op" id="4080237">)</span><span class="op" id="4080238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4080241">copy</span><span class="op" id="4080245">(</span><span class="ident" id="4080246">z</span><span class="op" id="4080247">,</span>&nbsp;<span class="ident" id="4080249">x</span><span class="op" id="4080250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080253">return</span>&nbsp;<span class="ident" id="4080260">z</span><br>
<span class="lineno"></span><span class="op" id="4080262">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="4080265">func</span>&nbsp;<span class="op" id="4080270">(</span><span class="ident" id="4080271">z</span>&nbsp;<span class="ident" id="4080273">nat</span><span class="op" id="4080276">)</span>&nbsp;<span class="ident" id="4080278">add</span><span class="op" id="4080281">(</span><span class="ident" id="4080282">x</span><span class="op" id="4080283">,</span>&nbsp;<span class="ident" id="4080285">y</span>&nbsp;<span class="ident" id="4080287">nat</span><span class="op" id="4080290">)</span>&nbsp;<span class="ident" id="4080292">nat</span>&nbsp;<span class="op" id="4080296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080299">m</span>&nbsp;<span class="op" id="4080301">:=</span>&nbsp;<span class="builtinfunc" id="4080304">len</span><span class="op" id="4080307">(</span><span class="ident" id="4080308">x</span><span class="op" id="4080309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080312">n</span>&nbsp;<span class="op" id="4080314">:=</span>&nbsp;<span class="builtinfunc" id="4080317">len</span><span class="op" id="4080320">(</span><span class="ident" id="4080321">y</span><span class="op" id="4080322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080326">switch</span>&nbsp;<span class="op" id="4080333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080336">case</span>&nbsp;<span class="ident" id="4080341">m</span>&nbsp;<span class="op" id="4080343">&lt;</span>&nbsp;<span class="ident" id="4080345">n</span><span class="op" id="4080346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080350">return</span>&nbsp;<span class="ident" id="4080357">z</span><span class="op" id="4080358">.</span><span class="ident" id="4080359">add</span><span class="op" id="4080362">(</span><span class="ident" id="4080363">y</span><span class="op" id="4080364">,</span>&nbsp;<span class="ident" id="4080366">x</span><span class="op" id="4080367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080370">case</span>&nbsp;<span class="ident" id="4080375">m</span>&nbsp;<span class="op" id="4080377">==</span>&nbsp;<span class="num" id="4080380">0</span><span class="op" id="4080381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080385">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080425">return</span>&nbsp;<span class="ident" id="4080432">z</span><span class="op" id="4080433">.</span><span class="builtinfunc" id="4080434">make</span><span class="op" id="4080438">(</span><span class="num" id="4080439">0</span><span class="op" id="4080440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080443">case</span>&nbsp;<span class="ident" id="4080448">n</span>&nbsp;<span class="op" id="4080450">==</span>&nbsp;<span class="num" id="4080453">0</span><span class="op" id="4080454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080458">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080475">return</span>&nbsp;<span class="ident" id="4080482">z</span><span class="op" id="4080483">.</span><span class="ident" id="4080484">set</span><span class="op" id="4080487">(</span><span class="ident" id="4080488">x</span><span class="op" id="4080489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080492">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080495">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080506">z</span>&nbsp;<span class="op" id="4080508">=</span>&nbsp;<span class="ident" id="4080510">z</span><span class="op" id="4080511">.</span><span class="builtinfunc" id="4080512">make</span><span class="op" id="4080516">(</span><span class="ident" id="4080517">m</span>&nbsp;<span class="op" id="4080519">+</span>&nbsp;<span class="num" id="4080521">1</span><span class="op" id="4080522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080525">c</span>&nbsp;<span class="op" id="4080527">:=</span>&nbsp;<span class="ident" id="4080530">addVV</span><span class="op" id="4080535">(</span><span class="ident" id="4080536">z</span><span class="op" id="4080537">[</span><span class="num" id="4080538">0</span><span class="op" id="4080539">:</span><span class="ident" id="4080540">n</span><span class="op" id="4080541">]</span><span class="op" id="4080542">,</span>&nbsp;<span class="ident" id="4080544">x</span><span class="op" id="4080545">,</span>&nbsp;<span class="ident" id="4080547">y</span><span class="op" id="4080548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080551">if</span>&nbsp;<span class="ident" id="4080554">m</span>&nbsp;<span class="op" id="4080556">&gt;</span>&nbsp;<span class="ident" id="4080558">n</span>&nbsp;<span class="op" id="4080560">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080564">c</span>&nbsp;<span class="op" id="4080566">=</span>&nbsp;<span class="ident" id="4080568">addVW</span><span class="op" id="4080573">(</span><span class="ident" id="4080574">z</span><span class="op" id="4080575">[</span><span class="ident" id="4080576">n</span><span class="op" id="4080577">:</span><span class="ident" id="4080578">m</span><span class="op" id="4080579">]</span><span class="op" id="4080580">,</span>&nbsp;<span class="ident" id="4080582">x</span><span class="op" id="4080583">[</span><span class="ident" id="4080584">n</span><span class="op" id="4080585">:</span><span class="op" id="4080586">]</span><span class="op" id="4080587">,</span>&nbsp;<span class="ident" id="4080589">c</span><span class="op" id="4080590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080596">z</span><span class="op" id="4080597">[</span><span class="ident" id="4080598">m</span><span class="op" id="4080599">]</span>&nbsp;<span class="op" id="4080601">=</span>&nbsp;<span class="ident" id="4080603">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080607">return</span>&nbsp;<span class="ident" id="4080614">z</span><span class="op" id="4080615">.</span><span class="ident" id="4080616">norm</span><span class="op" id="4080620">(</span><span class="op" id="4080621">)</span><br>
<span class="lineno">140</span><span class="op" id="4080623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4080626">func</span>&nbsp;<span class="op" id="4080631">(</span><span class="ident" id="4080632">z</span>&nbsp;<span class="ident" id="4080634">nat</span><span class="op" id="4080637">)</span>&nbsp;<span class="ident" id="4080639">sub</span><span class="op" id="4080642">(</span><span class="ident" id="4080643">x</span><span class="op" id="4080644">,</span>&nbsp;<span class="ident" id="4080646">y</span>&nbsp;<span class="ident" id="4080648">nat</span><span class="op" id="4080651">)</span>&nbsp;<span class="ident" id="4080653">nat</span>&nbsp;<span class="op" id="4080657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080660">m</span>&nbsp;<span class="op" id="4080662">:=</span>&nbsp;<span class="builtinfunc" id="4080665">len</span><span class="op" id="4080668">(</span><span class="ident" id="4080669">x</span><span class="op" id="4080670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080673">n</span>&nbsp;<span class="op" id="4080675">:=</span>&nbsp;<span class="builtinfunc" id="4080678">len</span><span class="op" id="4080681">(</span><span class="ident" id="4080682">y</span><span class="op" id="4080683">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080687">switch</span>&nbsp;<span class="op" id="4080694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080697">case</span>&nbsp;<span class="ident" id="4080702">m</span>&nbsp;<span class="op" id="4080704">&lt;</span>&nbsp;<span class="ident" id="4080706">n</span><span class="op" id="4080707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4080711">panic</span><span class="op" id="4080716">(</span><span class="string" id="4080717">&#34;underflow&#34;</span><span class="op" id="4080728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080731">case</span>&nbsp;<span class="ident" id="4080736">m</span>&nbsp;<span class="op" id="4080738">==</span>&nbsp;<span class="num" id="4080741">0</span><span class="op" id="4080742">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080746">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080786">return</span>&nbsp;<span class="ident" id="4080793">z</span><span class="op" id="4080794">.</span><span class="builtinfunc" id="4080795">make</span><span class="op" id="4080799">(</span><span class="num" id="4080800">0</span><span class="op" id="4080801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080804">case</span>&nbsp;<span class="ident" id="4080809">n</span>&nbsp;<span class="op" id="4080811">==</span>&nbsp;<span class="num" id="4080814">0</span><span class="op" id="4080815">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080819">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080836">return</span>&nbsp;<span class="ident" id="4080843">z</span><span class="op" id="4080844">.</span><span class="ident" id="4080845">set</span><span class="op" id="4080848">(</span><span class="ident" id="4080849">x</span><span class="op" id="4080850">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4080856">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080867">z</span>&nbsp;<span class="op" id="4080869">=</span>&nbsp;<span class="ident" id="4080871">z</span><span class="op" id="4080872">.</span><span class="builtinfunc" id="4080873">make</span><span class="op" id="4080877">(</span><span class="ident" id="4080878">m</span><span class="op" id="4080879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080882">c</span>&nbsp;<span class="op" id="4080884">:=</span>&nbsp;<span class="ident" id="4080887">subVV</span><span class="op" id="4080892">(</span><span class="ident" id="4080893">z</span><span class="op" id="4080894">[</span><span class="num" id="4080895">0</span><span class="op" id="4080896">:</span><span class="ident" id="4080897">n</span><span class="op" id="4080898">]</span><span class="op" id="4080899">,</span>&nbsp;<span class="ident" id="4080901">x</span><span class="op" id="4080902">,</span>&nbsp;<span class="ident" id="4080904">y</span><span class="op" id="4080905">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080908">if</span>&nbsp;<span class="ident" id="4080911">m</span>&nbsp;<span class="op" id="4080913">&gt;</span>&nbsp;<span class="ident" id="4080915">n</span>&nbsp;<span class="op" id="4080917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4080921">c</span>&nbsp;<span class="op" id="4080923">=</span>&nbsp;<span class="ident" id="4080925">subVW</span><span class="op" id="4080930">(</span><span class="ident" id="4080931">z</span><span class="op" id="4080932">[</span><span class="ident" id="4080933">n</span><span class="op" id="4080934">:</span><span class="op" id="4080935">]</span><span class="op" id="4080936">,</span>&nbsp;<span class="ident" id="4080938">x</span><span class="op" id="4080939">[</span><span class="ident" id="4080940">n</span><span class="op" id="4080941">:</span><span class="op" id="4080942">]</span><span class="op" id="4080943">,</span>&nbsp;<span class="ident" id="4080945">c</span><span class="op" id="4080946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080952">if</span>&nbsp;<span class="ident" id="4080955">c</span>&nbsp;<span class="op" id="4080957">!=</span>&nbsp;<span class="num" id="4080960">0</span>&nbsp;<span class="op" id="4080962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4080966">panic</span><span class="op" id="4080971">(</span><span class="string" id="4080972">&#34;underflow&#34;</span><span class="op" id="4080983">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4080986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4080990">return</span>&nbsp;<span class="ident" id="4080997">z</span><span class="op" id="4080998">.</span><span class="ident" id="4080999">norm</span><span class="op" id="4081003">(</span><span class="op" id="4081004">)</span><br>
<span class="lineno"></span><span class="op" id="4081006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="4081009">func</span>&nbsp;<span class="op" id="4081014">(</span><span class="ident" id="4081015">x</span>&nbsp;<span class="ident" id="4081017">nat</span><span class="op" id="4081020">)</span>&nbsp;<span class="ident" id="4081022">cmp</span><span class="op" id="4081025">(</span><span class="ident" id="4081026">y</span>&nbsp;<span class="ident" id="4081028">nat</span><span class="op" id="4081031">)</span>&nbsp;<span class="op" id="4081033">(</span><span class="ident" id="4081034">r</span>&nbsp;<span class="builtintype" id="4081036">int</span><span class="op" id="4081039">)</span>&nbsp;<span class="op" id="4081041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081044">m</span>&nbsp;<span class="op" id="4081046">:=</span>&nbsp;<span class="builtinfunc" id="4081049">len</span><span class="op" id="4081052">(</span><span class="ident" id="4081053">x</span><span class="op" id="4081054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081057">n</span>&nbsp;<span class="op" id="4081059">:=</span>&nbsp;<span class="builtinfunc" id="4081062">len</span><span class="op" id="4081065">(</span><span class="ident" id="4081066">y</span><span class="op" id="4081067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081070">if</span>&nbsp;<span class="ident" id="4081073">m</span>&nbsp;<span class="op" id="4081075">!=</span>&nbsp;<span class="ident" id="4081078">n</span>&nbsp;<span class="op" id="4081080">||</span>&nbsp;<span class="ident" id="4081083">m</span>&nbsp;<span class="op" id="4081085">==</span>&nbsp;<span class="num" id="4081088">0</span>&nbsp;<span class="op" id="4081090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081094">switch</span>&nbsp;<span class="op" id="4081101">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081105">case</span>&nbsp;<span class="ident" id="4081110">m</span>&nbsp;<span class="op" id="4081112">&lt;</span>&nbsp;<span class="ident" id="4081114">n</span><span class="op" id="4081115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081120">r</span>&nbsp;<span class="op" id="4081122">=</span>&nbsp;<span class="op" id="4081124">-</span><span class="num" id="4081125">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081129">case</span>&nbsp;<span class="ident" id="4081134">m</span>&nbsp;<span class="op" id="4081136">&gt;</span>&nbsp;<span class="ident" id="4081138">n</span><span class="op" id="4081139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081144">r</span>&nbsp;<span class="op" id="4081146">=</span>&nbsp;<span class="num" id="4081148">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081152">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081168">i</span>&nbsp;<span class="op" id="4081170">:=</span>&nbsp;<span class="ident" id="4081173">m</span>&nbsp;<span class="op" id="4081175">-</span>&nbsp;<span class="num" id="4081177">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081180">for</span>&nbsp;<span class="ident" id="4081184">i</span>&nbsp;<span class="op" id="4081186">&gt;</span>&nbsp;<span class="num" id="4081188">0</span>&nbsp;<span class="op" id="4081190">&amp;&amp;</span>&nbsp;<span class="ident" id="4081193">x</span><span class="op" id="4081194">[</span><span class="ident" id="4081195">i</span><span class="op" id="4081196">]</span>&nbsp;<span class="op" id="4081198">==</span>&nbsp;<span class="ident" id="4081201">y</span><span class="op" id="4081202">[</span><span class="ident" id="4081203">i</span><span class="op" id="4081204">]</span>&nbsp;<span class="op" id="4081206">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081210">i</span><span class="op" id="4081211">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081219">switch</span>&nbsp;<span class="op" id="4081226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081229">case</span>&nbsp;<span class="ident" id="4081234">x</span><span class="op" id="4081235">[</span><span class="ident" id="4081236">i</span><span class="op" id="4081237">]</span>&nbsp;<span class="op" id="4081239">&lt;</span>&nbsp;<span class="ident" id="4081241">y</span><span class="op" id="4081242">[</span><span class="ident" id="4081243">i</span><span class="op" id="4081244">]</span><span class="op" id="4081245">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081249">r</span>&nbsp;<span class="op" id="4081251">=</span>&nbsp;<span class="op" id="4081253">-</span><span class="num" id="4081254">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081257">case</span>&nbsp;<span class="ident" id="4081262">x</span><span class="op" id="4081263">[</span><span class="ident" id="4081264">i</span><span class="op" id="4081265">]</span>&nbsp;<span class="op" id="4081267">&gt;</span>&nbsp;<span class="ident" id="4081269">y</span><span class="op" id="4081270">[</span><span class="ident" id="4081271">i</span><span class="op" id="4081272">]</span><span class="op" id="4081273">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081277">r</span>&nbsp;<span class="op" id="4081279">=</span>&nbsp;<span class="num" id="4081281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081287">return</span><br>
<span class="lineno">195</span><span class="op" id="4081294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4081297">func</span>&nbsp;<span class="op" id="4081302">(</span><span class="ident" id="4081303">z</span>&nbsp;<span class="ident" id="4081305">nat</span><span class="op" id="4081308">)</span>&nbsp;<span class="ident" id="4081310">mulAddWW</span><span class="op" id="4081318">(</span><span class="ident" id="4081319">x</span>&nbsp;<span class="ident" id="4081321">nat</span><span class="op" id="4081324">,</span>&nbsp;<span class="ident" id="4081326">y</span><span class="op" id="4081327">,</span>&nbsp;<span class="ident" id="4081329">r</span>&nbsp;<span class="ident" id="4081331">Word</span><span class="op" id="4081335">)</span>&nbsp;<span class="ident" id="4081337">nat</span>&nbsp;<span class="op" id="4081341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081344">m</span>&nbsp;<span class="op" id="4081346">:=</span>&nbsp;<span class="builtinfunc" id="4081349">len</span><span class="op" id="4081352">(</span><span class="ident" id="4081353">x</span><span class="op" id="4081354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081357">if</span>&nbsp;<span class="ident" id="4081360">m</span>&nbsp;<span class="op" id="4081362">==</span>&nbsp;<span class="num" id="4081365">0</span>&nbsp;<span class="op" id="4081367">||</span>&nbsp;<span class="ident" id="4081370">y</span>&nbsp;<span class="op" id="4081372">==</span>&nbsp;<span class="num" id="4081375">0</span>&nbsp;<span class="op" id="4081377">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081381">return</span>&nbsp;<span class="ident" id="4081388">z</span><span class="op" id="4081389">.</span><span class="ident" id="4081390">setWord</span><span class="op" id="4081397">(</span><span class="ident" id="4081398">r</span><span class="op" id="4081399">)</span>&nbsp;<span class="comment" id="4081401">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4081420">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081431">z</span>&nbsp;<span class="op" id="4081433">=</span>&nbsp;<span class="ident" id="4081435">z</span><span class="op" id="4081436">.</span><span class="builtinfunc" id="4081437">make</span><span class="op" id="4081441">(</span><span class="ident" id="4081442">m</span>&nbsp;<span class="op" id="4081444">+</span>&nbsp;<span class="num" id="4081446">1</span><span class="op" id="4081447">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081450">z</span><span class="op" id="4081451">[</span><span class="ident" id="4081452">m</span><span class="op" id="4081453">]</span>&nbsp;<span class="op" id="4081455">=</span>&nbsp;<span class="ident" id="4081457">mulAddVWW</span><span class="op" id="4081466">(</span><span class="ident" id="4081467">z</span><span class="op" id="4081468">[</span><span class="num" id="4081469">0</span><span class="op" id="4081470">:</span><span class="ident" id="4081471">m</span><span class="op" id="4081472">]</span><span class="op" id="4081473">,</span>&nbsp;<span class="ident" id="4081475">x</span><span class="op" id="4081476">,</span>&nbsp;<span class="ident" id="4081478">y</span><span class="op" id="4081479">,</span>&nbsp;<span class="ident" id="4081481">r</span><span class="op" id="4081482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081486">return</span>&nbsp;<span class="ident" id="4081493">z</span><span class="op" id="4081494">.</span><span class="ident" id="4081495">norm</span><span class="op" id="4081499">(</span><span class="op" id="4081500">)</span><br>
<span class="lineno"></span><span class="op" id="4081502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="4081505">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4081564">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="4081632">func</span>&nbsp;<span class="ident" id="4081637">basicMul</span><span class="op" id="4081645">(</span><span class="ident" id="4081646">z</span><span class="op" id="4081647">,</span>&nbsp;<span class="ident" id="4081649">x</span><span class="op" id="4081650">,</span>&nbsp;<span class="ident" id="4081652">y</span>&nbsp;<span class="ident" id="4081654">nat</span><span class="op" id="4081657">)</span>&nbsp;<span class="op" id="4081659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081662">z</span><span class="op" id="4081663">[</span><span class="num" id="4081664">0</span>&nbsp;<span class="op" id="4081666">:</span>&nbsp;<span class="builtinfunc" id="4081668">len</span><span class="op" id="4081671">(</span><span class="ident" id="4081672">x</span><span class="op" id="4081673">)</span><span class="op" id="4081674">+</span><span class="builtinfunc" id="4081675">len</span><span class="op" id="4081678">(</span><span class="ident" id="4081679">y</span><span class="op" id="4081680">)</span><span class="op" id="4081681">]</span><span class="op" id="4081682">.</span><span class="ident" id="4081683">clear</span><span class="op" id="4081688">(</span><span class="op" id="4081689">)</span>&nbsp;<span class="comment" id="4081691">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081708">for</span>&nbsp;<span class="ident" id="4081712">i</span><span class="op" id="4081713">,</span>&nbsp;<span class="ident" id="4081715">d</span>&nbsp;<span class="op" id="4081717">:=</span>&nbsp;<span class="keyword" id="4081720">range</span>&nbsp;<span class="ident" id="4081726">y</span>&nbsp;<span class="op" id="4081728">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081732">if</span>&nbsp;<span class="ident" id="4081735">d</span>&nbsp;<span class="op" id="4081737">!=</span>&nbsp;<span class="num" id="4081740">0</span>&nbsp;<span class="op" id="4081742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4081747">z</span><span class="op" id="4081748">[</span><span class="builtinfunc" id="4081749">len</span><span class="op" id="4081752">(</span><span class="ident" id="4081753">x</span><span class="op" id="4081754">)</span><span class="op" id="4081755">+</span><span class="ident" id="4081756">i</span><span class="op" id="4081757">]</span>&nbsp;<span class="op" id="4081759">=</span>&nbsp;<span class="ident" id="4081761">addMulVVW</span><span class="op" id="4081770">(</span><span class="ident" id="4081771">z</span><span class="op" id="4081772">[</span><span class="ident" id="4081773">i</span><span class="op" id="4081774">:</span><span class="ident" id="4081775">i</span><span class="op" id="4081776">+</span><span class="builtinfunc" id="4081777">len</span><span class="op" id="4081780">(</span><span class="ident" id="4081781">x</span><span class="op" id="4081782">)</span><span class="op" id="4081783">]</span><span class="op" id="4081784">,</span>&nbsp;<span class="ident" id="4081786">x</span><span class="op" id="4081787">,</span>&nbsp;<span class="ident" id="4081789">d</span><span class="op" id="4081790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4081797">}</span><br>
<span class="lineno"></span><span class="op" id="4081799">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4081802">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="4081877">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="4081941">func</span>&nbsp;<span class="ident" id="4081946">karatsubaAdd</span><span class="op" id="4081958">(</span><span class="ident" id="4081959">z</span><span class="op" id="4081960">,</span>&nbsp;<span class="ident" id="4081962">x</span>&nbsp;<span class="ident" id="4081964">nat</span><span class="op" id="4081967">,</span>&nbsp;<span class="ident" id="4081969">n</span>&nbsp;<span class="builtintype" id="4081971">int</span><span class="op" id="4081974">)</span>&nbsp;<span class="op" id="4081976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4081979">if</span>&nbsp;<span class="ident" id="4081982">c</span>&nbsp;<span class="op" id="4081984">:=</span>&nbsp;<span class="ident" id="4081987">addVV</span><span class="op" id="4081992">(</span><span class="ident" id="4081993">z</span><span class="op" id="4081994">[</span><span class="num" id="4081995">0</span><span class="op" id="4081996">:</span><span class="ident" id="4081997">n</span><span class="op" id="4081998">]</span><span class="op" id="4081999">,</span>&nbsp;<span class="ident" id="4082001">z</span><span class="op" id="4082002">,</span>&nbsp;<span class="ident" id="4082004">x</span><span class="op" id="4082005">)</span><span class="op" id="4082006">;</span>&nbsp;<span class="ident" id="4082008">c</span>&nbsp;<span class="op" id="4082010">!=</span>&nbsp;<span class="num" id="4082013">0</span>&nbsp;<span class="op" id="4082015">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4082019">addVW</span><span class="op" id="4082024">(</span><span class="ident" id="4082025">z</span><span class="op" id="4082026">[</span><span class="ident" id="4082027">n</span><span class="op" id="4082028">:</span><span class="ident" id="4082029">n</span><span class="op" id="4082030">+</span><span class="ident" id="4082031">n</span><span class="op" id="4082032">&gt;&gt;</span><span class="num" id="4082034">1</span><span class="op" id="4082035">]</span><span class="op" id="4082036">,</span>&nbsp;<span class="ident" id="4082038">z</span><span class="op" id="4082039">[</span><span class="ident" id="4082040">n</span><span class="op" id="4082041">:</span><span class="op" id="4082042">]</span><span class="op" id="4082043">,</span>&nbsp;<span class="ident" id="4082045">c</span><span class="op" id="4082046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4082049">}</span><br>
<span class="lineno"></span><span class="op" id="4082051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4082054">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="4082095">func</span>&nbsp;<span class="ident" id="4082100">karatsubaSub</span><span class="op" id="4082112">(</span><span class="ident" id="4082113">z</span><span class="op" id="4082114">,</span>&nbsp;<span class="ident" id="4082116">x</span>&nbsp;<span class="ident" id="4082118">nat</span><span class="op" id="4082121">,</span>&nbsp;<span class="ident" id="4082123">n</span>&nbsp;<span class="builtintype" id="4082125">int</span><span class="op" id="4082128">)</span>&nbsp;<span class="op" id="4082130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4082133">if</span>&nbsp;<span class="ident" id="4082136">c</span>&nbsp;<span class="op" id="4082138">:=</span>&nbsp;<span class="ident" id="4082141">subVV</span><span class="op" id="4082146">(</span><span class="ident" id="4082147">z</span><span class="op" id="4082148">[</span><span class="num" id="4082149">0</span><span class="op" id="4082150">:</span><span class="ident" id="4082151">n</span><span class="op" id="4082152">]</span><span class="op" id="4082153">,</span>&nbsp;<span class="ident" id="4082155">z</span><span class="op" id="4082156">,</span>&nbsp;<span class="ident" id="4082158">x</span><span class="op" id="4082159">)</span><span class="op" id="4082160">;</span>&nbsp;<span class="ident" id="4082162">c</span>&nbsp;<span class="op" id="4082164">!=</span>&nbsp;<span class="num" id="4082167">0</span>&nbsp;<span class="op" id="4082169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4082173">subVW</span><span class="op" id="4082178">(</span><span class="ident" id="4082179">z</span><span class="op" id="4082180">[</span><span class="ident" id="4082181">n</span><span class="op" id="4082182">:</span><span class="ident" id="4082183">n</span><span class="op" id="4082184">+</span><span class="ident" id="4082185">n</span><span class="op" id="4082186">&gt;&gt;</span><span class="num" id="4082188">1</span><span class="op" id="4082189">]</span><span class="op" id="4082190">,</span>&nbsp;<span class="ident" id="4082192">z</span><span class="op" id="4082193">[</span><span class="ident" id="4082194">n</span><span class="op" id="4082195">:</span><span class="op" id="4082196">]</span><span class="op" id="4082197">,</span>&nbsp;<span class="ident" id="4082199">c</span><span class="op" id="4082200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4082203">}</span><br>
<span class="lineno"></span><span class="op" id="4082205">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="4082208">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4082282">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="4082360">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4082372">var</span>&nbsp;<span class="ident" id="4082376">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="4082395">int</span>&nbsp;<span class="op" id="4082399">=</span>&nbsp;<span class="num" id="4082401">40</span>&nbsp;<span class="comment" id="4082404">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="4082433">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="4082493">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4082553">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="4082613">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="4082669">func</span>&nbsp;<span class="ident" id="4082674">karatsuba</span><span class="op" id="4082683">(</span><span class="ident" id="4082684">z</span><span class="op" id="4082685">,</span>&nbsp;<span class="ident" id="4082687">x</span><span class="op" id="4082688">,</span>&nbsp;<span class="ident" id="4082690">y</span>&nbsp;<span class="ident" id="4082692">nat</span><span class="op" id="4082695">)</span>&nbsp;<span class="op" id="4082697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4082700">n</span>&nbsp;<span class="op" id="4082702">:=</span>&nbsp;<span class="builtinfunc" id="4082705">len</span><span class="op" id="4082708">(</span><span class="ident" id="4082709">y</span><span class="op" id="4082710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4082714">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4082778">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4082838">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4082856">if</span>&nbsp;<span class="ident" id="4082859">n</span><span class="op" id="4082860">&amp;</span><span class="num" id="4082861">1</span>&nbsp;<span class="op" id="4082863">!=</span>&nbsp;<span class="num" id="4082866">0</span>&nbsp;<span class="op" id="4082868">||</span>&nbsp;<span class="ident" id="4082871">n</span>&nbsp;<span class="op" id="4082873">&lt;</span>&nbsp;<span class="ident" id="4082875">karatsubaThreshold</span>&nbsp;<span class="op" id="4082894">||</span>&nbsp;<span class="ident" id="4082897">n</span>&nbsp;<span class="op" id="4082899">&lt;</span>&nbsp;<span class="num" id="4082901">2</span>&nbsp;<span class="op" id="4082903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4082907">basicMul</span><span class="op" id="4082915">(</span><span class="ident" id="4082916">z</span><span class="op" id="4082917">,</span>&nbsp;<span class="ident" id="4082919">x</span><span class="op" id="4082920">,</span>&nbsp;<span class="ident" id="4082922">y</span><span class="op" id="4082923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4082927">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4082935">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4082938">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4082989">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083051">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083085">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083089">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083109">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083129">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083133">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083196">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083214">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083218">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083268">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083318">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083322">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083332">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083336">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083355">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083374">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083378">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083429">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083480">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083531">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083582">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083624">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4083653">n2</span>&nbsp;<span class="op" id="4083656">:=</span>&nbsp;<span class="ident" id="4083659">n</span>&nbsp;<span class="op" id="4083661">&gt;&gt;</span>&nbsp;<span class="num" id="4083664">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083679">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4083691">x1</span><span class="op" id="4083693">,</span>&nbsp;<span class="ident" id="4083695">x0</span>&nbsp;<span class="op" id="4083698">:=</span>&nbsp;<span class="ident" id="4083701">x</span><span class="op" id="4083702">[</span><span class="ident" id="4083703">n2</span><span class="op" id="4083705">:</span><span class="op" id="4083706">]</span><span class="op" id="4083707">,</span>&nbsp;<span class="ident" id="4083709">x</span><span class="op" id="4083710">[</span><span class="num" id="4083711">0</span><span class="op" id="4083712">:</span><span class="ident" id="4083713">n2</span><span class="op" id="4083715">]</span>&nbsp;<span class="comment" id="4083717">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4083735">y1</span><span class="op" id="4083737">,</span>&nbsp;<span class="ident" id="4083739">y0</span>&nbsp;<span class="op" id="4083742">:=</span>&nbsp;<span class="ident" id="4083745">y</span><span class="op" id="4083746">[</span><span class="ident" id="4083747">n2</span><span class="op" id="4083749">:</span><span class="op" id="4083750">]</span><span class="op" id="4083751">,</span>&nbsp;<span class="ident" id="4083753">y</span><span class="op" id="4083754">[</span><span class="num" id="4083755">0</span><span class="op" id="4083756">:</span><span class="ident" id="4083757">n2</span><span class="op" id="4083759">]</span>&nbsp;<span class="comment" id="4083761">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083780">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083832">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083836">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083894">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083952">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4083956">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084017">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084079">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084096">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084150">karatsuba</span><span class="op" id="4084159">(</span><span class="ident" id="4084160">z</span><span class="op" id="4084161">,</span>&nbsp;<span class="ident" id="4084163">x0</span><span class="op" id="4084165">,</span>&nbsp;<span class="ident" id="4084167">y0</span><span class="op" id="4084169">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084175">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084190">karatsuba</span><span class="op" id="4084199">(</span><span class="ident" id="4084200">z</span><span class="op" id="4084201">[</span><span class="ident" id="4084202">n</span><span class="op" id="4084203">:</span><span class="op" id="4084204">]</span><span class="op" id="4084205">,</span>&nbsp;<span class="ident" id="4084207">x1</span><span class="op" id="4084209">,</span>&nbsp;<span class="ident" id="4084211">y1</span><span class="op" id="4084213">)</span>&nbsp;<span class="comment" id="4084215">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084231">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084290">s</span>&nbsp;<span class="op" id="4084292">:=</span>&nbsp;<span class="num" id="4084295">1</span>&nbsp;<span class="comment" id="4084297">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084323">xd</span>&nbsp;<span class="op" id="4084326">:=</span>&nbsp;<span class="ident" id="4084329">z</span><span class="op" id="4084330">[</span><span class="num" id="4084331">2</span><span class="op" id="4084332">*</span><span class="ident" id="4084333">n</span>&nbsp;<span class="op" id="4084335">:</span>&nbsp;<span class="num" id="4084337">2</span><span class="op" id="4084338">*</span><span class="ident" id="4084339">n</span><span class="op" id="4084340">+</span><span class="ident" id="4084341">n2</span><span class="op" id="4084343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4084346">if</span>&nbsp;<span class="ident" id="4084349">subVV</span><span class="op" id="4084354">(</span><span class="ident" id="4084355">xd</span><span class="op" id="4084357">,</span>&nbsp;<span class="ident" id="4084359">x1</span><span class="op" id="4084361">,</span>&nbsp;<span class="ident" id="4084363">x0</span><span class="op" id="4084365">)</span>&nbsp;<span class="op" id="4084367">!=</span>&nbsp;<span class="num" id="4084370">0</span>&nbsp;<span class="op" id="4084372">{</span>&nbsp;<span class="comment" id="4084374">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084385">s</span>&nbsp;<span class="op" id="4084387">=</span>&nbsp;<span class="op" id="4084389">-</span><span class="ident" id="4084390">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084394">subVV</span><span class="op" id="4084399">(</span><span class="ident" id="4084400">xd</span><span class="op" id="4084402">,</span>&nbsp;<span class="ident" id="4084404">x0</span><span class="op" id="4084406">,</span>&nbsp;<span class="ident" id="4084408">x1</span><span class="op" id="4084410">)</span>&nbsp;<span class="comment" id="4084412">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4084422">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084426">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084485">yd</span>&nbsp;<span class="op" id="4084488">:=</span>&nbsp;<span class="ident" id="4084491">z</span><span class="op" id="4084492">[</span><span class="num" id="4084493">2</span><span class="op" id="4084494">*</span><span class="ident" id="4084495">n</span><span class="op" id="4084496">+</span><span class="ident" id="4084497">n2</span>&nbsp;<span class="op" id="4084500">:</span>&nbsp;<span class="num" id="4084502">3</span><span class="op" id="4084503">*</span><span class="ident" id="4084504">n</span><span class="op" id="4084505">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4084508">if</span>&nbsp;<span class="ident" id="4084511">subVV</span><span class="op" id="4084516">(</span><span class="ident" id="4084517">yd</span><span class="op" id="4084519">,</span>&nbsp;<span class="ident" id="4084521">y0</span><span class="op" id="4084523">,</span>&nbsp;<span class="ident" id="4084525">y1</span><span class="op" id="4084527">)</span>&nbsp;<span class="op" id="4084529">!=</span>&nbsp;<span class="num" id="4084532">0</span>&nbsp;<span class="op" id="4084534">{</span>&nbsp;<span class="comment" id="4084536">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084547">s</span>&nbsp;<span class="op" id="4084549">=</span>&nbsp;<span class="op" id="4084551">-</span><span class="ident" id="4084552">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084556">subVV</span><span class="op" id="4084561">(</span><span class="ident" id="4084562">yd</span><span class="op" id="4084564">,</span>&nbsp;<span class="ident" id="4084566">y1</span><span class="op" id="4084568">,</span>&nbsp;<span class="ident" id="4084570">y0</span><span class="op" id="4084572">)</span>&nbsp;<span class="comment" id="4084574">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4084584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084588">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084655">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084722">p</span>&nbsp;<span class="op" id="4084724">:=</span>&nbsp;<span class="ident" id="4084727">z</span><span class="op" id="4084728">[</span><span class="ident" id="4084729">n</span><span class="op" id="4084730">*</span><span class="num" id="4084731">3</span><span class="op" id="4084732">:</span><span class="op" id="4084733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084736">karatsuba</span><span class="op" id="4084745">(</span><span class="ident" id="4084746">p</span><span class="op" id="4084747">,</span>&nbsp;<span class="ident" id="4084749">xd</span><span class="op" id="4084751">,</span>&nbsp;<span class="ident" id="4084753">yd</span><span class="op" id="4084755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084759">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084783">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4084842">r</span>&nbsp;<span class="op" id="4084844">:=</span>&nbsp;<span class="ident" id="4084847">z</span><span class="op" id="4084848">[</span><span class="ident" id="4084849">n</span><span class="op" id="4084850">*</span><span class="num" id="4084851">4</span><span class="op" id="4084852">:</span><span class="op" id="4084853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4084856">copy</span><span class="op" id="4084860">(</span><span class="ident" id="4084861">r</span><span class="op" id="4084862">,</span>&nbsp;<span class="ident" id="4084864">z</span><span class="op" id="4084865">[</span><span class="op" id="4084866">:</span><span class="ident" id="4084867">n</span><span class="op" id="4084868">*</span><span class="num" id="4084869">2</span><span class="op" id="4084870">]</span><span class="op" id="4084871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084875">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084907">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084911">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084933">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084955">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084974">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4084993">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4085012">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085016">karatsubaAdd</span><span class="op" id="4085028">(</span><span class="ident" id="4085029">z</span><span class="op" id="4085030">[</span><span class="ident" id="4085031">n2</span><span class="op" id="4085033">:</span><span class="op" id="4085034">]</span><span class="op" id="4085035">,</span>&nbsp;<span class="ident" id="4085037">r</span><span class="op" id="4085038">,</span>&nbsp;<span class="ident" id="4085040">n</span><span class="op" id="4085041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085044">karatsubaAdd</span><span class="op" id="4085056">(</span><span class="ident" id="4085057">z</span><span class="op" id="4085058">[</span><span class="ident" id="4085059">n2</span><span class="op" id="4085061">:</span><span class="op" id="4085062">]</span><span class="op" id="4085063">,</span>&nbsp;<span class="ident" id="4085065">r</span><span class="op" id="4085066">[</span><span class="ident" id="4085067">n</span><span class="op" id="4085068">:</span><span class="op" id="4085069">]</span><span class="op" id="4085070">,</span>&nbsp;<span class="ident" id="4085072">n</span><span class="op" id="4085073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085076">if</span>&nbsp;<span class="ident" id="4085079">s</span>&nbsp;<span class="op" id="4085081">&gt;</span>&nbsp;<span class="num" id="4085083">0</span>&nbsp;<span class="op" id="4085085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085089">karatsubaAdd</span><span class="op" id="4085101">(</span><span class="ident" id="4085102">z</span><span class="op" id="4085103">[</span><span class="ident" id="4085104">n2</span><span class="op" id="4085106">:</span><span class="op" id="4085107">]</span><span class="op" id="4085108">,</span>&nbsp;<span class="ident" id="4085110">p</span><span class="op" id="4085111">,</span>&nbsp;<span class="ident" id="4085113">n</span><span class="op" id="4085114">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085117">}</span>&nbsp;<span class="keyword" id="4085119">else</span>&nbsp;<span class="op" id="4085124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085128">karatsubaSub</span><span class="op" id="4085140">(</span><span class="ident" id="4085141">z</span><span class="op" id="4085142">[</span><span class="ident" id="4085143">n2</span><span class="op" id="4085145">:</span><span class="op" id="4085146">]</span><span class="op" id="4085147">,</span>&nbsp;<span class="ident" id="4085149">p</span><span class="op" id="4085150">,</span>&nbsp;<span class="ident" id="4085152">n</span><span class="op" id="4085153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085156">}</span><br>
<span class="lineno"></span><span class="op" id="4085158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="4085161">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="4085221">func</span>&nbsp;<span class="ident" id="4085226">alias</span><span class="op" id="4085231">(</span><span class="ident" id="4085232">x</span><span class="op" id="4085233">,</span>&nbsp;<span class="ident" id="4085235">y</span>&nbsp;<span class="ident" id="4085237">nat</span><span class="op" id="4085240">)</span>&nbsp;<span class="builtintype" id="4085242">bool</span>&nbsp;<span class="op" id="4085247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085250">return</span>&nbsp;<span class="builtinfunc" id="4085257">cap</span><span class="op" id="4085260">(</span><span class="ident" id="4085261">x</span><span class="op" id="4085262">)</span>&nbsp;<span class="op" id="4085264">&gt;</span>&nbsp;<span class="num" id="4085266">0</span>&nbsp;<span class="op" id="4085268">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4085271">cap</span><span class="op" id="4085274">(</span><span class="ident" id="4085275">y</span><span class="op" id="4085276">)</span>&nbsp;<span class="op" id="4085278">&gt;</span>&nbsp;<span class="num" id="4085280">0</span>&nbsp;<span class="op" id="4085282">&amp;&amp;</span>&nbsp;<span class="op" id="4085285">&amp;</span><span class="ident" id="4085286">x</span><span class="op" id="4085287">[</span><span class="num" id="4085288">0</span><span class="op" id="4085289">:</span><span class="builtinfunc" id="4085290">cap</span><span class="op" id="4085293">(</span><span class="ident" id="4085294">x</span><span class="op" id="4085295">)</span><span class="op" id="4085296">]</span><span class="op" id="4085297">[</span><span class="builtinfunc" id="4085298">cap</span><span class="op" id="4085301">(</span><span class="ident" id="4085302">x</span><span class="op" id="4085303">)</span><span class="op" id="4085304">-</span><span class="num" id="4085305">1</span><span class="op" id="4085306">]</span>&nbsp;<span class="op" id="4085308">==</span>&nbsp;<span class="op" id="4085311">&amp;</span><span class="ident" id="4085312">y</span><span class="op" id="4085313">[</span><span class="num" id="4085314">0</span><span class="op" id="4085315">:</span><span class="builtinfunc" id="4085316">cap</span><span class="op" id="4085319">(</span><span class="ident" id="4085320">y</span><span class="op" id="4085321">)</span><span class="op" id="4085322">]</span><span class="op" id="4085323">[</span><span class="builtinfunc" id="4085324">cap</span><span class="op" id="4085327">(</span><span class="ident" id="4085328">y</span><span class="op" id="4085329">)</span><span class="op" id="4085330">-</span><span class="num" id="4085331">1</span><span class="op" id="4085332">]</span><br>
<span class="lineno"></span><span class="op" id="4085334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="4085337">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="4085396">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4085456">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="4085520">func</span>&nbsp;<span class="ident" id="4085525">addAt</span><span class="op" id="4085530">(</span><span class="ident" id="4085531">z</span><span class="op" id="4085532">,</span>&nbsp;<span class="ident" id="4085534">x</span>&nbsp;<span class="ident" id="4085536">nat</span><span class="op" id="4085539">,</span>&nbsp;<span class="ident" id="4085541">i</span>&nbsp;<span class="builtintype" id="4085543">int</span><span class="op" id="4085546">)</span>&nbsp;<span class="op" id="4085548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085551">if</span>&nbsp;<span class="ident" id="4085554">n</span>&nbsp;<span class="op" id="4085556">:=</span>&nbsp;<span class="builtinfunc" id="4085559">len</span><span class="op" id="4085562">(</span><span class="ident" id="4085563">x</span><span class="op" id="4085564">)</span><span class="op" id="4085565">;</span>&nbsp;<span class="ident" id="4085567">n</span>&nbsp;<span class="op" id="4085569">&gt;</span>&nbsp;<span class="num" id="4085571">0</span>&nbsp;<span class="op" id="4085573">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085577">if</span>&nbsp;<span class="ident" id="4085580">c</span>&nbsp;<span class="op" id="4085582">:=</span>&nbsp;<span class="ident" id="4085585">addVV</span><span class="op" id="4085590">(</span><span class="ident" id="4085591">z</span><span class="op" id="4085592">[</span><span class="ident" id="4085593">i</span><span class="op" id="4085594">:</span><span class="ident" id="4085595">i</span><span class="op" id="4085596">+</span><span class="ident" id="4085597">n</span><span class="op" id="4085598">]</span><span class="op" id="4085599">,</span>&nbsp;<span class="ident" id="4085601">z</span><span class="op" id="4085602">[</span><span class="ident" id="4085603">i</span><span class="op" id="4085604">:</span><span class="op" id="4085605">]</span><span class="op" id="4085606">,</span>&nbsp;<span class="ident" id="4085608">x</span><span class="op" id="4085609">)</span><span class="op" id="4085610">;</span>&nbsp;<span class="ident" id="4085612">c</span>&nbsp;<span class="op" id="4085614">!=</span>&nbsp;<span class="num" id="4085617">0</span>&nbsp;<span class="op" id="4085619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085624">j</span>&nbsp;<span class="op" id="4085626">:=</span>&nbsp;<span class="ident" id="4085629">i</span>&nbsp;<span class="op" id="4085631">+</span>&nbsp;<span class="ident" id="4085633">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085638">if</span>&nbsp;<span class="ident" id="4085641">j</span>&nbsp;<span class="op" id="4085643">&lt;</span>&nbsp;<span class="builtinfunc" id="4085645">len</span><span class="op" id="4085648">(</span><span class="ident" id="4085649">z</span><span class="op" id="4085650">)</span>&nbsp;<span class="op" id="4085652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4085658">addVW</span><span class="op" id="4085663">(</span><span class="ident" id="4085664">z</span><span class="op" id="4085665">[</span><span class="ident" id="4085666">j</span><span class="op" id="4085667">:</span><span class="op" id="4085668">]</span><span class="op" id="4085669">,</span>&nbsp;<span class="ident" id="4085671">z</span><span class="op" id="4085672">[</span><span class="ident" id="4085673">j</span><span class="op" id="4085674">:</span><span class="op" id="4085675">]</span><span class="op" id="4085676">,</span>&nbsp;<span class="ident" id="4085678">c</span><span class="op" id="4085679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085684">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085691">}</span><br>
<span class="lineno"></span><span class="op" id="4085693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4085696">func</span>&nbsp;<span class="ident" id="4085701">max</span><span class="op" id="4085704">(</span><span class="ident" id="4085705">x</span><span class="op" id="4085706">,</span>&nbsp;<span class="ident" id="4085708">y</span>&nbsp;<span class="builtintype" id="4085710">int</span><span class="op" id="4085713">)</span>&nbsp;<span class="builtintype" id="4085715">int</span>&nbsp;<span class="op" id="4085719">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085722">if</span>&nbsp;<span class="ident" id="4085725">x</span>&nbsp;<span class="op" id="4085727">&gt;</span>&nbsp;<span class="ident" id="4085729">y</span>&nbsp;<span class="op" id="4085731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085735">return</span>&nbsp;<span class="ident" id="4085742">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4085745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4085748">return</span>&nbsp;<span class="ident" id="4085755">y</span><br>
<span class="lineno"></span><span class="op" id="4085757">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="4085760">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4085834">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4085908">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4085983">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="4086034">func</span>&nbsp;<span class="ident" id="4086039">karatsubaLen</span><span class="op" id="4086051">(</span><span class="ident" id="4086052">n</span>&nbsp;<span class="builtintype" id="4086054">int</span><span class="op" id="4086057">)</span>&nbsp;<span class="builtintype" id="4086059">int</span>&nbsp;<span class="op" id="4086063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086066">i</span>&nbsp;<span class="op" id="4086068">:=</span>&nbsp;<span class="builtintype" id="4086071">uint</span><span class="op" id="4086075">(</span><span class="num" id="4086076">0</span><span class="op" id="4086077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086080">for</span>&nbsp;<span class="ident" id="4086084">n</span>&nbsp;<span class="op" id="4086086">&gt;</span>&nbsp;<span class="ident" id="4086088">karatsubaThreshold</span>&nbsp;<span class="op" id="4086107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086111">n</span>&nbsp;<span class="op" id="4086113">&gt;&gt;=</span>&nbsp;<span class="num" id="4086117">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086121">i</span><span class="op" id="4086122">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086129">return</span>&nbsp;<span class="ident" id="4086136">n</span>&nbsp;<span class="op" id="4086138">&lt;&lt;</span>&nbsp;<span class="ident" id="4086141">i</span><br>
<span class="lineno"></span><span class="op" id="4086143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4086146">func</span>&nbsp;<span class="op" id="4086151">(</span><span class="ident" id="4086152">z</span>&nbsp;<span class="ident" id="4086154">nat</span><span class="op" id="4086157">)</span>&nbsp;<span class="ident" id="4086159">mul</span><span class="op" id="4086162">(</span><span class="ident" id="4086163">x</span><span class="op" id="4086164">,</span>&nbsp;<span class="ident" id="4086166">y</span>&nbsp;<span class="ident" id="4086168">nat</span><span class="op" id="4086171">)</span>&nbsp;<span class="ident" id="4086173">nat</span>&nbsp;<span class="op" id="4086177">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086180">m</span>&nbsp;<span class="op" id="4086182">:=</span>&nbsp;<span class="builtinfunc" id="4086185">len</span><span class="op" id="4086188">(</span><span class="ident" id="4086189">x</span><span class="op" id="4086190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086193">n</span>&nbsp;<span class="op" id="4086195">:=</span>&nbsp;<span class="builtinfunc" id="4086198">len</span><span class="op" id="4086201">(</span><span class="ident" id="4086202">y</span><span class="op" id="4086203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086207">switch</span>&nbsp;<span class="op" id="4086214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086217">case</span>&nbsp;<span class="ident" id="4086222">m</span>&nbsp;<span class="op" id="4086224">&lt;</span>&nbsp;<span class="ident" id="4086226">n</span><span class="op" id="4086227">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086231">return</span>&nbsp;<span class="ident" id="4086238">z</span><span class="op" id="4086239">.</span><span class="ident" id="4086240">mul</span><span class="op" id="4086243">(</span><span class="ident" id="4086244">y</span><span class="op" id="4086245">,</span>&nbsp;<span class="ident" id="4086247">x</span><span class="op" id="4086248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086251">case</span>&nbsp;<span class="ident" id="4086256">m</span>&nbsp;<span class="op" id="4086258">==</span>&nbsp;<span class="num" id="4086261">0</span>&nbsp;<span class="op" id="4086263">||</span>&nbsp;<span class="ident" id="4086266">n</span>&nbsp;<span class="op" id="4086268">==</span>&nbsp;<span class="num" id="4086271">0</span><span class="op" id="4086272">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086276">return</span>&nbsp;<span class="ident" id="4086283">z</span><span class="op" id="4086284">.</span><span class="builtinfunc" id="4086285">make</span><span class="op" id="4086289">(</span><span class="num" id="4086290">0</span><span class="op" id="4086291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086294">case</span>&nbsp;<span class="ident" id="4086299">n</span>&nbsp;<span class="op" id="4086301">==</span>&nbsp;<span class="num" id="4086304">1</span><span class="op" id="4086305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086309">return</span>&nbsp;<span class="ident" id="4086316">z</span><span class="op" id="4086317">.</span><span class="ident" id="4086318">mulAddWW</span><span class="op" id="4086326">(</span><span class="ident" id="4086327">x</span><span class="op" id="4086328">,</span>&nbsp;<span class="ident" id="4086330">y</span><span class="op" id="4086331">[</span><span class="num" id="4086332">0</span><span class="op" id="4086333">]</span><span class="op" id="4086334">,</span>&nbsp;<span class="num" id="4086336">0</span><span class="op" id="4086337">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086343">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086359">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086392">if</span>&nbsp;<span class="ident" id="4086395">alias</span><span class="op" id="4086400">(</span><span class="ident" id="4086401">z</span><span class="op" id="4086402">,</span>&nbsp;<span class="ident" id="4086404">x</span><span class="op" id="4086405">)</span>&nbsp;<span class="op" id="4086407">||</span>&nbsp;<span class="ident" id="4086410">alias</span><span class="op" id="4086415">(</span><span class="ident" id="4086416">z</span><span class="op" id="4086417">,</span>&nbsp;<span class="ident" id="4086419">y</span><span class="op" id="4086420">)</span>&nbsp;<span class="op" id="4086422">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086426">z</span>&nbsp;<span class="op" id="4086428">=</span>&nbsp;<span class="builtintype" id="4086430">nil</span>&nbsp;<span class="comment" id="4086434">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086482">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086536">if</span>&nbsp;<span class="ident" id="4086539">n</span>&nbsp;<span class="op" id="4086541">&lt;</span>&nbsp;<span class="ident" id="4086543">karatsubaThreshold</span>&nbsp;<span class="op" id="4086562">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086566">z</span>&nbsp;<span class="op" id="4086568">=</span>&nbsp;<span class="ident" id="4086570">z</span><span class="op" id="4086571">.</span><span class="builtinfunc" id="4086572">make</span><span class="op" id="4086576">(</span><span class="ident" id="4086577">m</span>&nbsp;<span class="op" id="4086579">+</span>&nbsp;<span class="ident" id="4086581">n</span><span class="op" id="4086582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086586">basicMul</span><span class="op" id="4086594">(</span><span class="ident" id="4086595">z</span><span class="op" id="4086596">,</span>&nbsp;<span class="ident" id="4086598">x</span><span class="op" id="4086599">,</span>&nbsp;<span class="ident" id="4086601">y</span><span class="op" id="4086602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4086606">return</span>&nbsp;<span class="ident" id="4086613">z</span><span class="op" id="4086614">.</span><span class="ident" id="4086615">norm</span><span class="op" id="4086619">(</span><span class="op" id="4086620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4086623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086626">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086675">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086718">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086722">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086757">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086792">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086839">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086843">k</span>&nbsp;<span class="op" id="4086845">:=</span>&nbsp;<span class="ident" id="4086848">karatsubaLen</span><span class="op" id="4086860">(</span><span class="ident" id="4086861">n</span><span class="op" id="4086862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086865">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086877">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086914">x0</span>&nbsp;<span class="op" id="4086917">:=</span>&nbsp;<span class="ident" id="4086920">x</span><span class="op" id="4086921">[</span><span class="num" id="4086922">0</span><span class="op" id="4086923">:</span><span class="ident" id="4086924">k</span><span class="op" id="4086925">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086940">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4086965">y0</span>&nbsp;<span class="op" id="4086968">:=</span>&nbsp;<span class="ident" id="4086971">y</span><span class="op" id="4086972">[</span><span class="num" id="4086973">0</span><span class="op" id="4086974">:</span><span class="ident" id="4086975">k</span><span class="op" id="4086976">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4086991">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087016">z</span>&nbsp;<span class="op" id="4087018">=</span>&nbsp;<span class="ident" id="4087020">z</span><span class="op" id="4087021">.</span><span class="builtinfunc" id="4087022">make</span><span class="op" id="4087026">(</span><span class="ident" id="4087027">max</span><span class="op" id="4087030">(</span><span class="num" id="4087031">6</span><span class="op" id="4087032">*</span><span class="ident" id="4087033">k</span><span class="op" id="4087034">,</span>&nbsp;<span class="ident" id="4087036">m</span><span class="op" id="4087037">+</span><span class="ident" id="4087038">n</span><span class="op" id="4087039">)</span><span class="op" id="4087040">)</span>&nbsp;<span class="comment" id="4087042">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087105">karatsuba</span><span class="op" id="4087114">(</span><span class="ident" id="4087115">z</span><span class="op" id="4087116">,</span>&nbsp;<span class="ident" id="4087118">x0</span><span class="op" id="4087120">,</span>&nbsp;<span class="ident" id="4087122">y0</span><span class="op" id="4087124">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087127">z</span>&nbsp;<span class="op" id="4087129">=</span>&nbsp;<span class="ident" id="4087131">z</span><span class="op" id="4087132">[</span><span class="num" id="4087133">0</span>&nbsp;<span class="op" id="4087135">:</span>&nbsp;<span class="ident" id="4087137">m</span><span class="op" id="4087138">+</span><span class="ident" id="4087139">n</span><span class="op" id="4087140">]</span>&nbsp;&nbsp;<span class="comment" id="4087143">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087188">z</span><span class="op" id="4087189">[</span><span class="num" id="4087190">2</span><span class="op" id="4087191">*</span><span class="ident" id="4087192">k</span><span class="op" id="4087193">:</span><span class="op" id="4087194">]</span><span class="op" id="4087195">.</span><span class="ident" id="4087196">clear</span><span class="op" id="4087201">(</span><span class="op" id="4087202">)</span>&nbsp;<span class="comment" id="4087204">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087274">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087333">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087337">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087391">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087445">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087449">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087475">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087479">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087532">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087536">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087604">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087672">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087742">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4087746">if</span>&nbsp;<span class="ident" id="4087749">k</span>&nbsp;<span class="op" id="4087751">&lt;</span>&nbsp;<span class="ident" id="4087753">n</span>&nbsp;<span class="op" id="4087755">||</span>&nbsp;<span class="ident" id="4087758">m</span>&nbsp;<span class="op" id="4087760">!=</span>&nbsp;<span class="ident" id="4087763">n</span>&nbsp;<span class="op" id="4087765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4087769">var</span>&nbsp;<span class="ident" id="4087773">t</span>&nbsp;<span class="ident" id="4087775">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087782">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087799">x0</span>&nbsp;<span class="op" id="4087802">:=</span>&nbsp;<span class="ident" id="4087805">x0</span><span class="op" id="4087807">.</span><span class="ident" id="4087808">norm</span><span class="op" id="4087812">(</span><span class="op" id="4087813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087817">y1</span>&nbsp;<span class="op" id="4087820">:=</span>&nbsp;<span class="ident" id="4087823">y</span><span class="op" id="4087824">[</span><span class="ident" id="4087825">k</span><span class="op" id="4087826">:</span><span class="op" id="4087827">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087835">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087870">t</span>&nbsp;<span class="op" id="4087872">=</span>&nbsp;<span class="ident" id="4087874">t</span><span class="op" id="4087875">.</span><span class="ident" id="4087876">mul</span><span class="op" id="4087879">(</span><span class="ident" id="4087880">x0</span><span class="op" id="4087882">,</span>&nbsp;<span class="ident" id="4087884">y1</span><span class="op" id="4087886">)</span>&nbsp;<span class="comment" id="4087888">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087940">addAt</span><span class="op" id="4087945">(</span><span class="ident" id="4087946">z</span><span class="op" id="4087947">,</span>&nbsp;<span class="ident" id="4087949">t</span><span class="op" id="4087950">,</span>&nbsp;<span class="ident" id="4087952">k</span><span class="op" id="4087953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4087958">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4087992">y0</span>&nbsp;<span class="op" id="4087995">:=</span>&nbsp;<span class="ident" id="4087998">y0</span><span class="op" id="4088000">.</span><span class="ident" id="4088001">norm</span><span class="op" id="4088005">(</span><span class="op" id="4088006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088010">for</span>&nbsp;<span class="ident" id="4088014">i</span>&nbsp;<span class="op" id="4088016">:=</span>&nbsp;<span class="ident" id="4088019">k</span><span class="op" id="4088020">;</span>&nbsp;<span class="ident" id="4088022">i</span>&nbsp;<span class="op" id="4088024">&lt;</span>&nbsp;<span class="builtinfunc" id="4088026">len</span><span class="op" id="4088029">(</span><span class="ident" id="4088030">x</span><span class="op" id="4088031">)</span><span class="op" id="4088032">;</span>&nbsp;<span class="ident" id="4088034">i</span>&nbsp;<span class="op" id="4088036">+=</span>&nbsp;<span class="ident" id="4088039">k</span>&nbsp;<span class="op" id="4088041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088046">xi</span>&nbsp;<span class="op" id="4088049">:=</span>&nbsp;<span class="ident" id="4088052">x</span><span class="op" id="4088053">[</span><span class="ident" id="4088054">i</span><span class="op" id="4088055">:</span><span class="op" id="4088056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088061">if</span>&nbsp;<span class="builtinfunc" id="4088064">len</span><span class="op" id="4088067">(</span><span class="ident" id="4088068">xi</span><span class="op" id="4088070">)</span>&nbsp;<span class="op" id="4088072">&gt;</span>&nbsp;<span class="ident" id="4088074">k</span>&nbsp;<span class="op" id="4088076">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088082">xi</span>&nbsp;<span class="op" id="4088085">=</span>&nbsp;<span class="ident" id="4088087">xi</span><span class="op" id="4088089">[</span><span class="op" id="4088090">:</span><span class="ident" id="4088091">k</span><span class="op" id="4088092">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4088097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088102">xi</span>&nbsp;<span class="op" id="4088105">=</span>&nbsp;<span class="ident" id="4088107">xi</span><span class="op" id="4088109">.</span><span class="ident" id="4088110">norm</span><span class="op" id="4088114">(</span><span class="op" id="4088115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088120">t</span>&nbsp;<span class="op" id="4088122">=</span>&nbsp;<span class="ident" id="4088124">t</span><span class="op" id="4088125">.</span><span class="ident" id="4088126">mul</span><span class="op" id="4088129">(</span><span class="ident" id="4088130">xi</span><span class="op" id="4088132">,</span>&nbsp;<span class="ident" id="4088134">y0</span><span class="op" id="4088136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088141">addAt</span><span class="op" id="4088146">(</span><span class="ident" id="4088147">z</span><span class="op" id="4088148">,</span>&nbsp;<span class="ident" id="4088150">t</span><span class="op" id="4088151">,</span>&nbsp;<span class="ident" id="4088153">i</span><span class="op" id="4088154">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088159">t</span>&nbsp;<span class="op" id="4088161">=</span>&nbsp;<span class="ident" id="4088163">t</span><span class="op" id="4088164">.</span><span class="ident" id="4088165">mul</span><span class="op" id="4088168">(</span><span class="ident" id="4088169">xi</span><span class="op" id="4088171">,</span>&nbsp;<span class="ident" id="4088173">y1</span><span class="op" id="4088175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088180">addAt</span><span class="op" id="4088185">(</span><span class="ident" id="4088186">z</span><span class="op" id="4088187">,</span>&nbsp;<span class="ident" id="4088189">t</span><span class="op" id="4088190">,</span>&nbsp;<span class="ident" id="4088192">i</span><span class="op" id="4088193">+</span><span class="ident" id="4088194">k</span><span class="op" id="4088195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4088199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4088202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088206">return</span>&nbsp;<span class="ident" id="4088213">z</span><span class="op" id="4088214">.</span><span class="ident" id="4088215">norm</span><span class="op" id="4088219">(</span><span class="op" id="4088220">)</span><br>
<span class="lineno"></span><span class="op" id="4088222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4088225">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4088294">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="4088364">func</span>&nbsp;<span class="op" id="4088369">(</span><span class="ident" id="4088370">z</span>&nbsp;<span class="ident" id="4088372">nat</span><span class="op" id="4088375">)</span>&nbsp;<span class="ident" id="4088377">mulRange</span><span class="op" id="4088385">(</span><span class="ident" id="4088386">a</span><span class="op" id="4088387">,</span>&nbsp;<span class="ident" id="4088389">b</span>&nbsp;<span class="builtintype" id="4088391">uint64</span><span class="op" id="4088397">)</span>&nbsp;<span class="ident" id="4088399">nat</span>&nbsp;<span class="op" id="4088403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088406">switch</span>&nbsp;<span class="op" id="4088413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088416">case</span>&nbsp;<span class="ident" id="4088421">a</span>&nbsp;<span class="op" id="4088423">==</span>&nbsp;<span class="num" id="4088426">0</span><span class="op" id="4088427">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4088431">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088473">return</span>&nbsp;<span class="ident" id="4088480">z</span><span class="op" id="4088481">.</span><span class="ident" id="4088482">setUint64</span><span class="op" id="4088491">(</span><span class="num" id="4088492">0</span><span class="op" id="4088493">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088496">case</span>&nbsp;<span class="ident" id="4088501">a</span>&nbsp;<span class="op" id="4088503">&gt;</span>&nbsp;<span class="ident" id="4088505">b</span><span class="op" id="4088506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088510">return</span>&nbsp;<span class="ident" id="4088517">z</span><span class="op" id="4088518">.</span><span class="ident" id="4088519">setUint64</span><span class="op" id="4088528">(</span><span class="num" id="4088529">1</span><span class="op" id="4088530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088533">case</span>&nbsp;<span class="ident" id="4088538">a</span>&nbsp;<span class="op" id="4088540">==</span>&nbsp;<span class="ident" id="4088543">b</span><span class="op" id="4088544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088548">return</span>&nbsp;<span class="ident" id="4088555">z</span><span class="op" id="4088556">.</span><span class="ident" id="4088557">setUint64</span><span class="op" id="4088566">(</span><span class="ident" id="4088567">a</span><span class="op" id="4088568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088571">case</span>&nbsp;<span class="ident" id="4088576">a</span><span class="op" id="4088577">+</span><span class="num" id="4088578">1</span>&nbsp;<span class="op" id="4088580">==</span>&nbsp;<span class="ident" id="4088583">b</span><span class="op" id="4088584">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088588">return</span>&nbsp;<span class="ident" id="4088595">z</span><span class="op" id="4088596">.</span><span class="ident" id="4088597">mul</span><span class="op" id="4088600">(</span><span class="ident" id="4088601">nat</span><span class="op" id="4088604">(</span><span class="builtintype" id="4088605">nil</span><span class="op" id="4088608">)</span><span class="op" id="4088609">.</span><span class="ident" id="4088610">setUint64</span><span class="op" id="4088619">(</span><span class="ident" id="4088620">a</span><span class="op" id="4088621">)</span><span class="op" id="4088622">,</span>&nbsp;<span class="ident" id="4088624">nat</span><span class="op" id="4088627">(</span><span class="builtintype" id="4088628">nil</span><span class="op" id="4088631">)</span><span class="op" id="4088632">.</span><span class="ident" id="4088633">setUint64</span><span class="op" id="4088642">(</span><span class="ident" id="4088643">b</span><span class="op" id="4088644">)</span><span class="op" id="4088645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4088648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088651">m</span>&nbsp;<span class="op" id="4088653">:=</span>&nbsp;<span class="op" id="4088656">(</span><span class="ident" id="4088657">a</span>&nbsp;<span class="op" id="4088659">+</span>&nbsp;<span class="ident" id="4088661">b</span><span class="op" id="4088662">)</span>&nbsp;<span class="op" id="4088664">/</span>&nbsp;<span class="num" id="4088666">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088669">return</span>&nbsp;<span class="ident" id="4088676">z</span><span class="op" id="4088677">.</span><span class="ident" id="4088678">mul</span><span class="op" id="4088681">(</span><span class="ident" id="4088682">nat</span><span class="op" id="4088685">(</span><span class="builtintype" id="4088686">nil</span><span class="op" id="4088689">)</span><span class="op" id="4088690">.</span><span class="ident" id="4088691">mulRange</span><span class="op" id="4088699">(</span><span class="ident" id="4088700">a</span><span class="op" id="4088701">,</span>&nbsp;<span class="ident" id="4088703">m</span><span class="op" id="4088704">)</span><span class="op" id="4088705">,</span>&nbsp;<span class="ident" id="4088707">nat</span><span class="op" id="4088710">(</span><span class="builtintype" id="4088711">nil</span><span class="op" id="4088714">)</span><span class="op" id="4088715">.</span><span class="ident" id="4088716">mulRange</span><span class="op" id="4088724">(</span><span class="ident" id="4088725">m</span><span class="op" id="4088726">+</span><span class="num" id="4088727">1</span><span class="op" id="4088728">,</span>&nbsp;<span class="ident" id="4088730">b</span><span class="op" id="4088731">)</span><span class="op" id="4088732">)</span><br>
<span class="lineno"></span><span class="op" id="4088734">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4088737">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="4088769">func</span>&nbsp;<span class="op" id="4088774">(</span><span class="ident" id="4088775">z</span>&nbsp;<span class="ident" id="4088777">nat</span><span class="op" id="4088780">)</span>&nbsp;<span class="ident" id="4088782">divW</span><span class="op" id="4088786">(</span><span class="ident" id="4088787">x</span>&nbsp;<span class="ident" id="4088789">nat</span><span class="op" id="4088792">,</span>&nbsp;<span class="ident" id="4088794">y</span>&nbsp;<span class="ident" id="4088796">Word</span><span class="op" id="4088800">)</span>&nbsp;<span class="op" id="4088802">(</span><span class="ident" id="4088803">q</span>&nbsp;<span class="ident" id="4088805">nat</span><span class="op" id="4088808">,</span>&nbsp;<span class="ident" id="4088810">r</span>&nbsp;<span class="ident" id="4088812">Word</span><span class="op" id="4088816">)</span>&nbsp;<span class="op" id="4088818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088821">m</span>&nbsp;<span class="op" id="4088823">:=</span>&nbsp;<span class="builtinfunc" id="4088826">len</span><span class="op" id="4088829">(</span><span class="ident" id="4088830">x</span><span class="op" id="4088831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088834">switch</span>&nbsp;<span class="op" id="4088841">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088844">case</span>&nbsp;<span class="ident" id="4088849">y</span>&nbsp;<span class="op" id="4088851">==</span>&nbsp;<span class="num" id="4088854">0</span><span class="op" id="4088855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4088859">panic</span><span class="op" id="4088864">(</span><span class="string" id="4088865">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4088883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088886">case</span>&nbsp;<span class="ident" id="4088891">y</span>&nbsp;<span class="op" id="4088893">==</span>&nbsp;<span class="num" id="4088896">1</span><span class="op" id="4088897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088901">q</span>&nbsp;<span class="op" id="4088903">=</span>&nbsp;<span class="ident" id="4088905">z</span><span class="op" id="4088906">.</span><span class="ident" id="4088907">set</span><span class="op" id="4088910">(</span><span class="ident" id="4088911">x</span><span class="op" id="4088912">)</span>&nbsp;<span class="comment" id="4088914">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088931">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088939">case</span>&nbsp;<span class="ident" id="4088944">m</span>&nbsp;<span class="op" id="4088946">==</span>&nbsp;<span class="num" id="4088949">0</span><span class="op" id="4088950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4088954">q</span>&nbsp;<span class="op" id="4088956">=</span>&nbsp;<span class="ident" id="4088958">z</span><span class="op" id="4088959">.</span><span class="builtinfunc" id="4088960">make</span><span class="op" id="4088964">(</span><span class="num" id="4088965">0</span><span class="op" id="4088966">)</span>&nbsp;<span class="comment" id="4088968">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4088985">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4088993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4088996">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089006">z</span>&nbsp;<span class="op" id="4089008">=</span>&nbsp;<span class="ident" id="4089010">z</span><span class="op" id="4089011">.</span><span class="builtinfunc" id="4089012">make</span><span class="op" id="4089016">(</span><span class="ident" id="4089017">m</span><span class="op" id="4089018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089021">r</span>&nbsp;<span class="op" id="4089023">=</span>&nbsp;<span class="ident" id="4089025">divWVW</span><span class="op" id="4089031">(</span><span class="ident" id="4089032">z</span><span class="op" id="4089033">,</span>&nbsp;<span class="num" id="4089035">0</span><span class="op" id="4089036">,</span>&nbsp;<span class="ident" id="4089038">x</span><span class="op" id="4089039">,</span>&nbsp;<span class="ident" id="4089041">y</span><span class="op" id="4089042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089045">q</span>&nbsp;<span class="op" id="4089047">=</span>&nbsp;<span class="ident" id="4089049">z</span><span class="op" id="4089050">.</span><span class="ident" id="4089051">norm</span><span class="op" id="4089055">(</span><span class="op" id="4089056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089059">return</span><br>
<span class="lineno"></span><span class="op" id="4089066">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="4089069">func</span>&nbsp;<span class="op" id="4089074">(</span><span class="ident" id="4089075">z</span>&nbsp;<span class="ident" id="4089077">nat</span><span class="op" id="4089080">)</span>&nbsp;<span class="ident" id="4089082">div</span><span class="op" id="4089085">(</span><span class="ident" id="4089086">z2</span><span class="op" id="4089088">,</span>&nbsp;<span class="ident" id="4089090">u</span><span class="op" id="4089091">,</span>&nbsp;<span class="ident" id="4089093">v</span>&nbsp;<span class="ident" id="4089095">nat</span><span class="op" id="4089098">)</span>&nbsp;<span class="op" id="4089100">(</span><span class="ident" id="4089101">q</span><span class="op" id="4089102">,</span>&nbsp;<span class="ident" id="4089104">r</span>&nbsp;<span class="ident" id="4089106">nat</span><span class="op" id="4089109">)</span>&nbsp;<span class="op" id="4089111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089114">if</span>&nbsp;<span class="builtinfunc" id="4089117">len</span><span class="op" id="4089120">(</span><span class="ident" id="4089121">v</span><span class="op" id="4089122">)</span>&nbsp;<span class="op" id="4089124">==</span>&nbsp;<span class="num" id="4089127">0</span>&nbsp;<span class="op" id="4089129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4089133">panic</span><span class="op" id="4089138">(</span><span class="string" id="4089139">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="4089157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4089160">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089164">if</span>&nbsp;<span class="ident" id="4089167">u</span><span class="op" id="4089168">.</span><span class="ident" id="4089169">cmp</span><span class="op" id="4089172">(</span><span class="ident" id="4089173">v</span><span class="op" id="4089174">)</span>&nbsp;<span class="op" id="4089176">&lt;</span>&nbsp;<span class="num" id="4089178">0</span>&nbsp;<span class="op" id="4089180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089184">q</span>&nbsp;<span class="op" id="4089186">=</span>&nbsp;<span class="ident" id="4089188">z</span><span class="op" id="4089189">.</span><span class="builtinfunc" id="4089190">make</span><span class="op" id="4089194">(</span><span class="num" id="4089195">0</span><span class="op" id="4089196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089200">r</span>&nbsp;<span class="op" id="4089202">=</span>&nbsp;<span class="ident" id="4089204">z2</span><span class="op" id="4089206">.</span><span class="ident" id="4089207">set</span><span class="op" id="4089210">(</span><span class="ident" id="4089211">u</span><span class="op" id="4089212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089216">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4089224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089228">if</span>&nbsp;<span class="builtinfunc" id="4089231">len</span><span class="op" id="4089234">(</span><span class="ident" id="4089235">v</span><span class="op" id="4089236">)</span>&nbsp;<span class="op" id="4089238">==</span>&nbsp;<span class="num" id="4089241">1</span>&nbsp;<span class="op" id="4089243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089247">var</span>&nbsp;<span class="ident" id="4089251">r2</span>&nbsp;<span class="ident" id="4089254">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089261">q</span><span class="op" id="4089262">,</span>&nbsp;<span class="ident" id="4089264">r2</span>&nbsp;<span class="op" id="4089267">=</span>&nbsp;<span class="ident" id="4089269">z</span><span class="op" id="4089270">.</span><span class="ident" id="4089271">divW</span><span class="op" id="4089275">(</span><span class="ident" id="4089276">u</span><span class="op" id="4089277">,</span>&nbsp;<span class="ident" id="4089279">v</span><span class="op" id="4089280">[</span><span class="num" id="4089281">0</span><span class="op" id="4089282">]</span><span class="op" id="4089283">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089287">r</span>&nbsp;<span class="op" id="4089289">=</span>&nbsp;<span class="ident" id="4089291">z2</span><span class="op" id="4089293">.</span><span class="ident" id="4089294">setWord</span><span class="op" id="4089301">(</span><span class="ident" id="4089302">r2</span><span class="op" id="4089304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089308">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4089316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089320">q</span><span class="op" id="4089321">,</span>&nbsp;<span class="ident" id="4089323">r</span>&nbsp;<span class="op" id="4089325">=</span>&nbsp;<span class="ident" id="4089327">z</span><span class="op" id="4089328">.</span><span class="ident" id="4089329">divLarge</span><span class="op" id="4089337">(</span><span class="ident" id="4089338">z2</span><span class="op" id="4089340">,</span>&nbsp;<span class="ident" id="4089342">u</span><span class="op" id="4089343">,</span>&nbsp;<span class="ident" id="4089345">v</span><span class="op" id="4089346">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089349">return</span><br>
<span class="lineno"></span><span class="op" id="4089356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4089359">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="4089393">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="4089457">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="4089509">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="4089527">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="4089545">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="4089570">func</span>&nbsp;<span class="op" id="4089575">(</span><span class="ident" id="4089576">z</span>&nbsp;<span class="ident" id="4089578">nat</span><span class="op" id="4089581">)</span>&nbsp;<span class="ident" id="4089583">divLarge</span><span class="op" id="4089591">(</span><span class="ident" id="4089592">u</span><span class="op" id="4089593">,</span>&nbsp;<span class="ident" id="4089595">uIn</span><span class="op" id="4089598">,</span>&nbsp;<span class="ident" id="4089600">v</span>&nbsp;<span class="ident" id="4089602">nat</span><span class="op" id="4089605">)</span>&nbsp;<span class="op" id="4089607">(</span><span class="ident" id="4089608">q</span><span class="op" id="4089609">,</span>&nbsp;<span class="ident" id="4089611">r</span>&nbsp;<span class="ident" id="4089613">nat</span><span class="op" id="4089616">)</span>&nbsp;<span class="op" id="4089618">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089621">n</span>&nbsp;<span class="op" id="4089623">:=</span>&nbsp;<span class="builtinfunc" id="4089626">len</span><span class="op" id="4089629">(</span><span class="ident" id="4089630">v</span><span class="op" id="4089631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089634">m</span>&nbsp;<span class="op" id="4089636">:=</span>&nbsp;<span class="builtinfunc" id="4089639">len</span><span class="op" id="4089642">(</span><span class="ident" id="4089643">uIn</span><span class="op" id="4089646">)</span>&nbsp;<span class="op" id="4089648">-</span>&nbsp;<span class="ident" id="4089650">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4089654">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4089687">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4089751">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089817">if</span>&nbsp;<span class="ident" id="4089820">alias</span><span class="op" id="4089825">(</span><span class="ident" id="4089826">z</span><span class="op" id="4089827">,</span>&nbsp;<span class="ident" id="4089829">uIn</span><span class="op" id="4089832">)</span>&nbsp;<span class="op" id="4089834">||</span>&nbsp;<span class="ident" id="4089837">alias</span><span class="op" id="4089842">(</span><span class="ident" id="4089843">z</span><span class="op" id="4089844">,</span>&nbsp;<span class="ident" id="4089846">v</span><span class="op" id="4089847">)</span>&nbsp;<span class="op" id="4089849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089853">z</span>&nbsp;<span class="op" id="4089855">=</span>&nbsp;<span class="builtintype" id="4089857">nil</span>&nbsp;<span class="comment" id="4089861">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4089907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089910">q</span>&nbsp;<span class="op" id="4089912">=</span>&nbsp;<span class="ident" id="4089914">z</span><span class="op" id="4089915">.</span><span class="builtinfunc" id="4089916">make</span><span class="op" id="4089920">(</span><span class="ident" id="4089921">m</span>&nbsp;<span class="op" id="4089923">+</span>&nbsp;<span class="num" id="4089925">1</span><span class="op" id="4089926">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089930">qhatv</span>&nbsp;<span class="op" id="4089936">:=</span>&nbsp;<span class="builtinfunc" id="4089939">make</span><span class="op" id="4089943">(</span><span class="ident" id="4089944">nat</span><span class="op" id="4089947">,</span>&nbsp;<span class="ident" id="4089949">n</span><span class="op" id="4089950">+</span><span class="num" id="4089951">1</span><span class="op" id="4089952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4089955">if</span>&nbsp;<span class="ident" id="4089958">alias</span><span class="op" id="4089963">(</span><span class="ident" id="4089964">u</span><span class="op" id="4089965">,</span>&nbsp;<span class="ident" id="4089967">uIn</span><span class="op" id="4089970">)</span>&nbsp;<span class="op" id="4089972">||</span>&nbsp;<span class="ident" id="4089975">alias</span><span class="op" id="4089980">(</span><span class="ident" id="4089981">u</span><span class="op" id="4089982">,</span>&nbsp;<span class="ident" id="4089984">v</span><span class="op" id="4089985">)</span>&nbsp;<span class="op" id="4089987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4089991">u</span>&nbsp;<span class="op" id="4089993">=</span>&nbsp;<span class="builtintype" id="4089995">nil</span>&nbsp;<span class="comment" id="4089999">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090045">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090048">u</span>&nbsp;<span class="op" id="4090050">=</span>&nbsp;<span class="ident" id="4090052">u</span><span class="op" id="4090053">.</span><span class="builtinfunc" id="4090054">make</span><span class="op" id="4090058">(</span><span class="builtinfunc" id="4090059">len</span><span class="op" id="4090062">(</span><span class="ident" id="4090063">uIn</span><span class="op" id="4090066">)</span>&nbsp;<span class="op" id="4090068">+</span>&nbsp;<span class="num" id="4090070">1</span><span class="op" id="4090071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090074">u</span><span class="op" id="4090075">.</span><span class="ident" id="4090076">clear</span><span class="op" id="4090081">(</span><span class="op" id="4090082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090086">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090094">shift</span>&nbsp;<span class="op" id="4090100">:=</span>&nbsp;<span class="ident" id="4090103">leadingZeros</span><span class="op" id="4090115">(</span><span class="ident" id="4090116">v</span><span class="op" id="4090117">[</span><span class="ident" id="4090118">n</span><span class="op" id="4090119">-</span><span class="num" id="4090120">1</span><span class="op" id="4090121">]</span><span class="op" id="4090122">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090125">if</span>&nbsp;<span class="ident" id="4090128">shift</span>&nbsp;<span class="op" id="4090134">&gt;</span>&nbsp;<span class="num" id="4090136">0</span>&nbsp;<span class="op" id="4090138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090142">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090215">v1</span>&nbsp;<span class="op" id="4090218">:=</span>&nbsp;<span class="builtinfunc" id="4090221">make</span><span class="op" id="4090225">(</span><span class="ident" id="4090226">nat</span><span class="op" id="4090229">,</span>&nbsp;<span class="ident" id="4090231">n</span><span class="op" id="4090232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090236">shlVU</span><span class="op" id="4090241">(</span><span class="ident" id="4090242">v1</span><span class="op" id="4090244">,</span>&nbsp;<span class="ident" id="4090246">v</span><span class="op" id="4090247">,</span>&nbsp;<span class="ident" id="4090249">shift</span><span class="op" id="4090254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090258">v</span>&nbsp;<span class="op" id="4090260">=</span>&nbsp;<span class="ident" id="4090262">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090269">u</span><span class="op" id="4090270">[</span><span class="builtinfunc" id="4090271">len</span><span class="op" id="4090274">(</span><span class="ident" id="4090275">uIn</span><span class="op" id="4090278">)</span><span class="op" id="4090279">]</span>&nbsp;<span class="op" id="4090281">=</span>&nbsp;<span class="ident" id="4090283">shlVU</span><span class="op" id="4090288">(</span><span class="ident" id="4090289">u</span><span class="op" id="4090290">[</span><span class="num" id="4090291">0</span><span class="op" id="4090292">:</span><span class="builtinfunc" id="4090293">len</span><span class="op" id="4090296">(</span><span class="ident" id="4090297">uIn</span><span class="op" id="4090300">)</span><span class="op" id="4090301">]</span><span class="op" id="4090302">,</span>&nbsp;<span class="ident" id="4090304">uIn</span><span class="op" id="4090307">,</span>&nbsp;<span class="ident" id="4090309">shift</span><span class="op" id="4090314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090318">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090326">for</span>&nbsp;<span class="ident" id="4090330">j</span>&nbsp;<span class="op" id="4090332">:=</span>&nbsp;<span class="ident" id="4090335">m</span><span class="op" id="4090336">;</span>&nbsp;<span class="ident" id="4090338">j</span>&nbsp;<span class="op" id="4090340">&gt;=</span>&nbsp;<span class="num" id="4090343">0</span><span class="op" id="4090344">;</span>&nbsp;<span class="ident" id="4090346">j</span><span class="op" id="4090347">--</span>&nbsp;<span class="op" id="4090350">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090354">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090363">qhat</span>&nbsp;<span class="op" id="4090368">:=</span>&nbsp;<span class="ident" id="4090371">Word</span><span class="op" id="4090375">(</span><span class="ident" id="4090376">_M</span><span class="op" id="4090378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090382">if</span>&nbsp;<span class="ident" id="4090385">u</span><span class="op" id="4090386">[</span><span class="ident" id="4090387">j</span><span class="op" id="4090388">+</span><span class="ident" id="4090389">n</span><span class="op" id="4090390">]</span>&nbsp;<span class="op" id="4090392">!=</span>&nbsp;<span class="ident" id="4090395">v</span><span class="op" id="4090396">[</span><span class="ident" id="4090397">n</span><span class="op" id="4090398">-</span><span class="num" id="4090399">1</span><span class="op" id="4090400">]</span>&nbsp;<span class="op" id="4090402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090407">var</span>&nbsp;<span class="ident" id="4090411">rhat</span>&nbsp;<span class="ident" id="4090416">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090424">qhat</span><span class="op" id="4090428">,</span>&nbsp;<span class="ident" id="4090430">rhat</span>&nbsp;<span class="op" id="4090435">=</span>&nbsp;<span class="ident" id="4090437">divWW</span><span class="op" id="4090442">(</span><span class="ident" id="4090443">u</span><span class="op" id="4090444">[</span><span class="ident" id="4090445">j</span><span class="op" id="4090446">+</span><span class="ident" id="4090447">n</span><span class="op" id="4090448">]</span><span class="op" id="4090449">,</span>&nbsp;<span class="ident" id="4090451">u</span><span class="op" id="4090452">[</span><span class="ident" id="4090453">j</span><span class="op" id="4090454">+</span><span class="ident" id="4090455">n</span><span class="op" id="4090456">-</span><span class="num" id="4090457">1</span><span class="op" id="4090458">]</span><span class="op" id="4090459">,</span>&nbsp;<span class="ident" id="4090461">v</span><span class="op" id="4090462">[</span><span class="ident" id="4090463">n</span><span class="op" id="4090464">-</span><span class="num" id="4090465">1</span><span class="op" id="4090466">]</span><span class="op" id="4090467">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090473">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;q̂v_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090500">x1</span><span class="op" id="4090502">,</span>&nbsp;<span class="ident" id="4090504">x2</span>&nbsp;<span class="op" id="4090507">:=</span>&nbsp;<span class="ident" id="4090510">mulWW</span><span class="op" id="4090515">(</span><span class="ident" id="4090516">qhat</span><span class="op" id="4090520">,</span>&nbsp;<span class="ident" id="4090522">v</span><span class="op" id="4090523">[</span><span class="ident" id="4090524">n</span><span class="op" id="4090525">-</span><span class="num" id="4090526">2</span><span class="op" id="4090527">]</span><span class="op" id="4090528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090533">//&nbsp;test&nbsp;if&nbsp;q̂v_{n-2}&nbsp;&gt;&nbsp;br̂&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090577">for</span>&nbsp;<span class="ident" id="4090581">greaterThan</span><span class="op" id="4090592">(</span><span class="ident" id="4090593">x1</span><span class="op" id="4090595">,</span>&nbsp;<span class="ident" id="4090597">x2</span><span class="op" id="4090599">,</span>&nbsp;<span class="ident" id="4090601">rhat</span><span class="op" id="4090605">,</span>&nbsp;<span class="ident" id="4090607">u</span><span class="op" id="4090608">[</span><span class="ident" id="4090609">j</span><span class="op" id="4090610">+</span><span class="ident" id="4090611">n</span><span class="op" id="4090612">-</span><span class="num" id="4090613">2</span><span class="op" id="4090614">]</span><span class="op" id="4090615">)</span>&nbsp;<span class="op" id="4090617">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090623">qhat</span><span class="op" id="4090627">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090634">prevRhat</span>&nbsp;<span class="op" id="4090643">:=</span>&nbsp;<span class="ident" id="4090646">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090655">rhat</span>&nbsp;<span class="op" id="4090660">+=</span>&nbsp;<span class="ident" id="4090663">v</span><span class="op" id="4090664">[</span><span class="ident" id="4090665">n</span><span class="op" id="4090666">-</span><span class="num" id="4090667">1</span><span class="op" id="4090668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090674">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090722">if</span>&nbsp;<span class="ident" id="4090725">rhat</span>&nbsp;<span class="op" id="4090730">&lt;</span>&nbsp;<span class="ident" id="4090732">prevRhat</span>&nbsp;<span class="op" id="4090741">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090748">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090764">x1</span><span class="op" id="4090766">,</span>&nbsp;<span class="ident" id="4090768">x2</span>&nbsp;<span class="op" id="4090771">=</span>&nbsp;<span class="ident" id="4090773">mulWW</span><span class="op" id="4090778">(</span><span class="ident" id="4090779">qhat</span><span class="op" id="4090783">,</span>&nbsp;<span class="ident" id="4090785">v</span><span class="op" id="4090786">[</span><span class="ident" id="4090787">n</span><span class="op" id="4090788">-</span><span class="num" id="4090789">2</span><span class="op" id="4090790">]</span><span class="op" id="4090791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090800">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4090805">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090814">qhatv</span><span class="op" id="4090819">[</span><span class="ident" id="4090820">n</span><span class="op" id="4090821">]</span>&nbsp;<span class="op" id="4090823">=</span>&nbsp;<span class="ident" id="4090825">mulAddVWW</span><span class="op" id="4090834">(</span><span class="ident" id="4090835">qhatv</span><span class="op" id="4090840">[</span><span class="num" id="4090841">0</span><span class="op" id="4090842">:</span><span class="ident" id="4090843">n</span><span class="op" id="4090844">]</span><span class="op" id="4090845">,</span>&nbsp;<span class="ident" id="4090847">v</span><span class="op" id="4090848">,</span>&nbsp;<span class="ident" id="4090850">qhat</span><span class="op" id="4090854">,</span>&nbsp;<span class="num" id="4090856">0</span><span class="op" id="4090857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090862">c</span>&nbsp;<span class="op" id="4090864">:=</span>&nbsp;<span class="ident" id="4090867">subVV</span><span class="op" id="4090872">(</span><span class="ident" id="4090873">u</span><span class="op" id="4090874">[</span><span class="ident" id="4090875">j</span><span class="op" id="4090876">:</span><span class="ident" id="4090877">j</span><span class="op" id="4090878">+</span><span class="builtinfunc" id="4090879">len</span><span class="op" id="4090882">(</span><span class="ident" id="4090883">qhatv</span><span class="op" id="4090888">)</span><span class="op" id="4090889">]</span><span class="op" id="4090890">,</span>&nbsp;<span class="ident" id="4090892">u</span><span class="op" id="4090893">[</span><span class="ident" id="4090894">j</span><span class="op" id="4090895">:</span><span class="op" id="4090896">]</span><span class="op" id="4090897">,</span>&nbsp;<span class="ident" id="4090899">qhatv</span><span class="op" id="4090904">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4090908">if</span>&nbsp;<span class="ident" id="4090911">c</span>&nbsp;<span class="op" id="4090913">!=</span>&nbsp;<span class="num" id="4090916">0</span>&nbsp;<span class="op" id="4090918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090923">c</span>&nbsp;<span class="op" id="4090925">:=</span>&nbsp;<span class="ident" id="4090928">addVV</span><span class="op" id="4090933">(</span><span class="ident" id="4090934">u</span><span class="op" id="4090935">[</span><span class="ident" id="4090936">j</span><span class="op" id="4090937">:</span><span class="ident" id="4090938">j</span><span class="op" id="4090939">+</span><span class="ident" id="4090940">n</span><span class="op" id="4090941">]</span><span class="op" id="4090942">,</span>&nbsp;<span class="ident" id="4090944">u</span><span class="op" id="4090945">[</span><span class="ident" id="4090946">j</span><span class="op" id="4090947">:</span><span class="op" id="4090948">]</span><span class="op" id="4090949">,</span>&nbsp;<span class="ident" id="4090951">v</span><span class="op" id="4090952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090957">u</span><span class="op" id="4090958">[</span><span class="ident" id="4090959">j</span><span class="op" id="4090960">+</span><span class="ident" id="4090961">n</span><span class="op" id="4090962">]</span>&nbsp;<span class="op" id="4090964">+=</span>&nbsp;<span class="ident" id="4090967">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090972">qhat</span><span class="op" id="4090976">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090981">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4090986">q</span><span class="op" id="4090987">[</span><span class="ident" id="4090988">j</span><span class="op" id="4090989">]</span>&nbsp;<span class="op" id="4090991">=</span>&nbsp;<span class="ident" id="4090993">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4090999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091003">q</span>&nbsp;<span class="op" id="4091005">=</span>&nbsp;<span class="ident" id="4091007">q</span><span class="op" id="4091008">.</span><span class="ident" id="4091009">norm</span><span class="op" id="4091013">(</span><span class="op" id="4091014">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091017">shrVU</span><span class="op" id="4091022">(</span><span class="ident" id="4091023">u</span><span class="op" id="4091024">,</span>&nbsp;<span class="ident" id="4091026">u</span><span class="op" id="4091027">,</span>&nbsp;<span class="ident" id="4091029">shift</span><span class="op" id="4091034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091037">r</span>&nbsp;<span class="op" id="4091039">=</span>&nbsp;<span class="ident" id="4091041">u</span><span class="op" id="4091042">.</span><span class="ident" id="4091043">norm</span><span class="op" id="4091047">(</span><span class="op" id="4091048">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091052">return</span>&nbsp;<span class="ident" id="4091059">q</span><span class="op" id="4091060">,</span>&nbsp;<span class="ident" id="4091062">r</span><br>
<span class="lineno"></span><span class="op" id="4091064">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="4091067">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="4091113">func</span>&nbsp;<span class="op" id="4091118">(</span><span class="ident" id="4091119">x</span>&nbsp;<span class="ident" id="4091121">nat</span><span class="op" id="4091124">)</span>&nbsp;<span class="ident" id="4091126">bitLen</span><span class="op" id="4091132">(</span><span class="op" id="4091133">)</span>&nbsp;<span class="builtintype" id="4091135">int</span>&nbsp;<span class="op" id="4091139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091142">if</span>&nbsp;<span class="ident" id="4091145">i</span>&nbsp;<span class="op" id="4091147">:=</span>&nbsp;<span class="builtinfunc" id="4091150">len</span><span class="op" id="4091153">(</span><span class="ident" id="4091154">x</span><span class="op" id="4091155">)</span>&nbsp;<span class="op" id="4091157">-</span>&nbsp;<span class="num" id="4091159">1</span><span class="op" id="4091160">;</span>&nbsp;<span class="ident" id="4091162">i</span>&nbsp;<span class="op" id="4091164">&gt;=</span>&nbsp;<span class="num" id="4091167">0</span>&nbsp;<span class="op" id="4091169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091173">return</span>&nbsp;<span class="ident" id="4091180">i</span><span class="op" id="4091181">*</span><span class="ident" id="4091182">_W</span>&nbsp;<span class="op" id="4091185">+</span>&nbsp;<span class="ident" id="4091187">bitLen</span><span class="op" id="4091193">(</span><span class="ident" id="4091194">x</span><span class="op" id="4091195">[</span><span class="ident" id="4091196">i</span><span class="op" id="4091197">]</span><span class="op" id="4091198">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4091201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091204">return</span>&nbsp;<span class="num" id="4091211">0</span><br>
<span class="lineno"></span><span class="op" id="4091213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4091216">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="4091287">const</span>&nbsp;<span class="ident" id="4091293">MaxBase</span>&nbsp;<span class="op" id="4091301">=</span>&nbsp;<span class="string" id="4091303">&#39;z&#39;</span>&nbsp;<span class="op" id="4091307">-</span>&nbsp;<span class="string" id="4091309">&#39;a&#39;</span>&nbsp;<span class="op" id="4091313">+</span>&nbsp;<span class="num" id="4091315">10</span>&nbsp;<span class="op" id="4091318">+</span>&nbsp;<span class="num" id="4091320">1</span>&nbsp;<span class="comment" id="4091322">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4091346">func</span>&nbsp;<span class="ident" id="4091351">hexValue</span><span class="op" id="4091359">(</span><span class="ident" id="4091360">ch</span>&nbsp;<span class="builtintype" id="4091363">rune</span><span class="op" id="4091367">)</span>&nbsp;<span class="ident" id="4091369">Word</span>&nbsp;<span class="op" id="4091374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091377">d</span>&nbsp;<span class="op" id="4091379">:=</span>&nbsp;<span class="builtintype" id="4091382">int</span><span class="op" id="4091385">(</span><span class="ident" id="4091386">MaxBase</span>&nbsp;<span class="op" id="4091394">+</span>&nbsp;<span class="num" id="4091396">1</span><span class="op" id="4091397">)</span>&nbsp;<span class="comment" id="4091399">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091416">switch</span>&nbsp;<span class="op" id="4091423">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091426">case</span>&nbsp;<span class="string" id="4091431">&#39;0&#39;</span>&nbsp;<span class="op" id="4091435">&lt;=</span>&nbsp;<span class="ident" id="4091438">ch</span>&nbsp;<span class="op" id="4091441">&amp;&amp;</span>&nbsp;<span class="ident" id="4091444">ch</span>&nbsp;<span class="op" id="4091447">&lt;=</span>&nbsp;<span class="string" id="4091450">&#39;9&#39;</span><span class="op" id="4091453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091457">d</span>&nbsp;<span class="op" id="4091459">=</span>&nbsp;<span class="builtintype" id="4091461">int</span><span class="op" id="4091464">(</span><span class="ident" id="4091465">ch</span>&nbsp;<span class="op" id="4091468">-</span>&nbsp;<span class="string" id="4091470">&#39;0&#39;</span><span class="op" id="4091473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091476">case</span>&nbsp;<span class="string" id="4091481">&#39;a&#39;</span>&nbsp;<span class="op" id="4091485">&lt;=</span>&nbsp;<span class="ident" id="4091488">ch</span>&nbsp;<span class="op" id="4091491">&amp;&amp;</span>&nbsp;<span class="ident" id="4091494">ch</span>&nbsp;<span class="op" id="4091497">&lt;=</span>&nbsp;<span class="string" id="4091500">&#39;z&#39;</span><span class="op" id="4091503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091507">d</span>&nbsp;<span class="op" id="4091509">=</span>&nbsp;<span class="builtintype" id="4091511">int</span><span class="op" id="4091514">(</span><span class="ident" id="4091515">ch</span>&nbsp;<span class="op" id="4091518">-</span>&nbsp;<span class="string" id="4091520">&#39;a&#39;</span>&nbsp;<span class="op" id="4091524">+</span>&nbsp;<span class="num" id="4091526">10</span><span class="op" id="4091528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091531">case</span>&nbsp;<span class="string" id="4091536">&#39;A&#39;</span>&nbsp;<span class="op" id="4091540">&lt;=</span>&nbsp;<span class="ident" id="4091543">ch</span>&nbsp;<span class="op" id="4091546">&amp;&amp;</span>&nbsp;<span class="ident" id="4091549">ch</span>&nbsp;<span class="op" id="4091552">&lt;=</span>&nbsp;<span class="string" id="4091555">&#39;Z&#39;</span><span class="op" id="4091558">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4091562">d</span>&nbsp;<span class="op" id="4091564">=</span>&nbsp;<span class="builtintype" id="4091566">int</span><span class="op" id="4091569">(</span><span class="ident" id="4091570">ch</span>&nbsp;<span class="op" id="4091573">-</span>&nbsp;<span class="string" id="4091575">&#39;A&#39;</span>&nbsp;<span class="op" id="4091579">+</span>&nbsp;<span class="num" id="4091581">10</span><span class="op" id="4091583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4091586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4091589">return</span>&nbsp;<span class="ident" id="4091596">Word</span><span class="op" id="4091600">(</span><span class="ident" id="4091601">d</span><span class="op" id="4091602">)</span><br>
<span class="lineno"></span><span class="op" id="4091604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="4091607">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="4091689">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="4091765">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4091844">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4091921">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="4091957">//</span><br>
<span class="lineno"></span><span class="comment" id="4091960">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="4092038">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4092116">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4092192">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="4092270">//</span><br>
<span class="lineno"></span><span class="keyword" id="4092273">func</span>&nbsp;<span class="op" id="4092278">(</span><span class="ident" id="4092279">z</span>&nbsp;<span class="ident" id="4092281">nat</span><span class="op" id="4092284">)</span>&nbsp;<span class="ident" id="4092286">scan</span><span class="op" id="4092290">(</span><span class="ident" id="4092291">r</span>&nbsp;<span class="ident" id="4092293">io</span><span class="op" id="4092295">.</span><span class="ident" id="4092296">RuneScanner</span><span class="op" id="4092307">,</span>&nbsp;<span class="ident" id="4092309">base</span>&nbsp;<span class="builtintype" id="4092314">int</span><span class="op" id="4092317">)</span>&nbsp;<span class="op" id="4092319">(</span><span class="ident" id="4092320">nat</span><span class="op" id="4092323">,</span>&nbsp;<span class="builtintype" id="4092325">int</span><span class="op" id="4092328">,</span>&nbsp;<span class="builtintype" id="4092330">error</span><span class="op" id="4092335">)</span>&nbsp;<span class="op" id="4092337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4092340">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092365">if</span>&nbsp;<span class="ident" id="4092368">base</span>&nbsp;<span class="op" id="4092373">&lt;</span>&nbsp;<span class="num" id="4092375">0</span>&nbsp;<span class="op" id="4092377">||</span>&nbsp;<span class="ident" id="4092380">base</span>&nbsp;<span class="op" id="4092385">==</span>&nbsp;<span class="num" id="4092388">1</span>&nbsp;<span class="op" id="4092390">||</span>&nbsp;<span class="ident" id="4092393">MaxBase</span>&nbsp;<span class="op" id="4092401">&lt;</span>&nbsp;<span class="ident" id="4092403">base</span>&nbsp;<span class="op" id="4092408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092412">return</span>&nbsp;<span class="ident" id="4092419">z</span><span class="op" id="4092420">,</span>&nbsp;<span class="num" id="4092422">0</span><span class="op" id="4092423">,</span>&nbsp;<span class="ident" id="4092425">errors</span><span class="op" id="4092431">.</span><span class="ident" id="4092432">New</span><span class="op" id="4092435">(</span><span class="string" id="4092436">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="4092457">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4092464">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092488">ch</span><span class="op" id="4092490">,</span>&nbsp;<span class="ident" id="4092492">_</span><span class="op" id="4092493">,</span>&nbsp;<span class="ident" id="4092495">err</span>&nbsp;<span class="op" id="4092499">:=</span>&nbsp;<span class="ident" id="4092502">r</span><span class="op" id="4092503">.</span><span class="ident" id="4092504">ReadRune</span><span class="op" id="4092512">(</span><span class="op" id="4092513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092516">if</span>&nbsp;<span class="ident" id="4092519">err</span>&nbsp;<span class="op" id="4092523">!=</span>&nbsp;<span class="builtintype" id="4092526">nil</span>&nbsp;<span class="op" id="4092530">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092534">return</span>&nbsp;<span class="ident" id="4092541">z</span><span class="op" id="4092542">,</span>&nbsp;<span class="num" id="4092544">0</span><span class="op" id="4092545">,</span>&nbsp;<span class="ident" id="4092547">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4092556">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092588">b</span>&nbsp;<span class="op" id="4092590">:=</span>&nbsp;<span class="ident" id="4092593">Word</span><span class="op" id="4092597">(</span><span class="ident" id="4092598">base</span><span class="op" id="4092602">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092605">if</span>&nbsp;<span class="ident" id="4092608">base</span>&nbsp;<span class="op" id="4092613">==</span>&nbsp;<span class="num" id="4092616">0</span>&nbsp;<span class="op" id="4092618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092622">b</span>&nbsp;<span class="op" id="4092624">=</span>&nbsp;<span class="num" id="4092626">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092631">if</span>&nbsp;<span class="ident" id="4092634">ch</span>&nbsp;<span class="op" id="4092637">==</span>&nbsp;<span class="string" id="4092640">&#39;0&#39;</span>&nbsp;<span class="op" id="4092644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092649">switch</span>&nbsp;<span class="ident" id="4092656">ch</span><span class="op" id="4092658">,</span>&nbsp;<span class="ident" id="4092660">_</span><span class="op" id="4092661">,</span>&nbsp;<span class="ident" id="4092663">err</span>&nbsp;<span class="op" id="4092667">=</span>&nbsp;<span class="ident" id="4092669">r</span><span class="op" id="4092670">.</span><span class="ident" id="4092671">ReadRune</span><span class="op" id="4092679">(</span><span class="op" id="4092680">)</span><span class="op" id="4092681">;</span>&nbsp;<span class="ident" id="4092683">err</span>&nbsp;<span class="op" id="4092687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092692">case</span>&nbsp;<span class="builtintype" id="4092697">nil</span><span class="op" id="4092700">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092706">b</span>&nbsp;<span class="op" id="4092708">=</span>&nbsp;<span class="num" id="4092710">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092716">switch</span>&nbsp;<span class="ident" id="4092723">ch</span>&nbsp;<span class="op" id="4092726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092732">case</span>&nbsp;<span class="string" id="4092737">&#39;x&#39;</span><span class="op" id="4092740">,</span>&nbsp;<span class="string" id="4092742">&#39;X&#39;</span><span class="op" id="4092745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092752">b</span>&nbsp;<span class="op" id="4092754">=</span>&nbsp;<span class="num" id="4092756">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092763">case</span>&nbsp;<span class="string" id="4092768">&#39;b&#39;</span><span class="op" id="4092771">,</span>&nbsp;<span class="string" id="4092773">&#39;B&#39;</span><span class="op" id="4092776">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4092783">b</span>&nbsp;<span class="op" id="4092785">=</span>&nbsp;<span class="num" id="4092787">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092799">if</span>&nbsp;<span class="ident" id="4092802">b</span>&nbsp;<span class="op" id="4092804">==</span>&nbsp;<span class="num" id="4092807">2</span>&nbsp;<span class="op" id="4092809">||</span>&nbsp;<span class="ident" id="4092812">b</span>&nbsp;<span class="op" id="4092814">==</span>&nbsp;<span class="num" id="4092817">16</span>&nbsp;<span class="op" id="4092820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092827">if</span>&nbsp;<span class="ident" id="4092830">ch</span><span class="op" id="4092832">,</span>&nbsp;<span class="ident" id="4092834">_</span><span class="op" id="4092835">,</span>&nbsp;<span class="ident" id="4092837">err</span>&nbsp;<span class="op" id="4092841">=</span>&nbsp;<span class="ident" id="4092843">r</span><span class="op" id="4092844">.</span><span class="ident" id="4092845">ReadRune</span><span class="op" id="4092853">(</span><span class="op" id="4092854">)</span><span class="op" id="4092855">;</span>&nbsp;<span class="ident" id="4092857">err</span>&nbsp;<span class="op" id="4092861">!=</span>&nbsp;<span class="builtintype" id="4092864">nil</span>&nbsp;<span class="op" id="4092868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092876">return</span>&nbsp;<span class="ident" id="4092883">z</span><span class="op" id="4092884">,</span>&nbsp;<span class="num" id="4092886">0</span><span class="op" id="4092887">,</span>&nbsp;<span class="ident" id="4092889">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092909">case</span>&nbsp;<span class="ident" id="4092914">io</span><span class="op" id="4092916">.</span><span class="ident" id="4092917">EOF</span><span class="op" id="4092920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092926">return</span>&nbsp;<span class="ident" id="4092933">z</span><span class="op" id="4092934">.</span><span class="builtinfunc" id="4092935">make</span><span class="op" id="4092939">(</span><span class="num" id="4092940">0</span><span class="op" id="4092941">)</span><span class="op" id="4092942">,</span>&nbsp;<span class="num" id="4092944">10</span><span class="op" id="4092946">,</span>&nbsp;<span class="builtintype" id="4092948">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092955">default</span><span class="op" id="4092962">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4092968">return</span>&nbsp;<span class="ident" id="4092975">z</span><span class="op" id="4092976">,</span>&nbsp;<span class="num" id="4092978">10</span><span class="op" id="4092980">,</span>&nbsp;<span class="ident" id="4092982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4092996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093000">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093019">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093114">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093209">z</span>&nbsp;<span class="op" id="4093211">=</span>&nbsp;<span class="ident" id="4093213">z</span><span class="op" id="4093214">.</span><span class="builtinfunc" id="4093215">make</span><span class="op" id="4093219">(</span><span class="num" id="4093220">0</span><span class="op" id="4093221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093224">bb</span>&nbsp;<span class="op" id="4093227">:=</span>&nbsp;<span class="ident" id="4093230">Word</span><span class="op" id="4093234">(</span><span class="num" id="4093235">1</span><span class="op" id="4093236">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093239">dd</span>&nbsp;<span class="op" id="4093242">:=</span>&nbsp;<span class="ident" id="4093245">Word</span><span class="op" id="4093249">(</span><span class="num" id="4093250">0</span><span class="op" id="4093251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093254">for</span>&nbsp;<span class="ident" id="4093258">max</span>&nbsp;<span class="op" id="4093262">:=</span>&nbsp;<span class="ident" id="4093265">_M</span>&nbsp;<span class="op" id="4093268">/</span>&nbsp;<span class="ident" id="4093270">b</span><span class="op" id="4093271">;</span>&nbsp;<span class="op" id="4093273">;</span>&nbsp;<span class="op" id="4093275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093279">d</span>&nbsp;<span class="op" id="4093281">:=</span>&nbsp;<span class="ident" id="4093284">hexValue</span><span class="op" id="4093292">(</span><span class="ident" id="4093293">ch</span><span class="op" id="4093295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093299">if</span>&nbsp;<span class="ident" id="4093302">d</span>&nbsp;<span class="op" id="4093304">&gt;=</span>&nbsp;<span class="ident" id="4093307">b</span>&nbsp;<span class="op" id="4093309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093314">r</span><span class="op" id="4093315">.</span><span class="ident" id="4093316">UnreadRune</span><span class="op" id="4093326">(</span><span class="op" id="4093327">)</span>&nbsp;<span class="comment" id="4093329">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093372">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093385">if</span>&nbsp;<span class="ident" id="4093388">bb</span>&nbsp;<span class="op" id="4093391">&lt;=</span>&nbsp;<span class="ident" id="4093394">max</span>&nbsp;<span class="op" id="4093398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093403">bb</span>&nbsp;<span class="op" id="4093406">*=</span>&nbsp;<span class="ident" id="4093409">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093414">dd</span>&nbsp;<span class="op" id="4093417">=</span>&nbsp;<span class="ident" id="4093419">dd</span><span class="op" id="4093421">*</span><span class="ident" id="4093422">b</span>&nbsp;<span class="op" id="4093424">+</span>&nbsp;<span class="ident" id="4093426">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093430">}</span>&nbsp;<span class="keyword" id="4093432">else</span>&nbsp;<span class="op" id="4093437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093442">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093470">z</span>&nbsp;<span class="op" id="4093472">=</span>&nbsp;<span class="ident" id="4093474">z</span><span class="op" id="4093475">.</span><span class="ident" id="4093476">mulAddWW</span><span class="op" id="4093484">(</span><span class="ident" id="4093485">z</span><span class="op" id="4093486">,</span>&nbsp;<span class="ident" id="4093488">bb</span><span class="op" id="4093490">,</span>&nbsp;<span class="ident" id="4093492">dd</span><span class="op" id="4093494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093499">bb</span>&nbsp;<span class="op" id="4093502">=</span>&nbsp;<span class="ident" id="4093504">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093509">dd</span>&nbsp;<span class="op" id="4093512">=</span>&nbsp;<span class="ident" id="4093514">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093523">if</span>&nbsp;<span class="ident" id="4093526">ch</span><span class="op" id="4093528">,</span>&nbsp;<span class="ident" id="4093530">_</span><span class="op" id="4093531">,</span>&nbsp;<span class="ident" id="4093533">err</span>&nbsp;<span class="op" id="4093537">=</span>&nbsp;<span class="ident" id="4093539">r</span><span class="op" id="4093540">.</span><span class="ident" id="4093541">ReadRune</span><span class="op" id="4093549">(</span><span class="op" id="4093550">)</span><span class="op" id="4093551">;</span>&nbsp;<span class="ident" id="4093553">err</span>&nbsp;<span class="op" id="4093557">!=</span>&nbsp;<span class="builtintype" id="4093560">nil</span>&nbsp;<span class="op" id="4093564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093569">if</span>&nbsp;<span class="ident" id="4093572">err</span>&nbsp;<span class="op" id="4093576">!=</span>&nbsp;<span class="ident" id="4093579">io</span><span class="op" id="4093581">.</span><span class="ident" id="4093582">EOF</span>&nbsp;<span class="op" id="4093586">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093592">return</span>&nbsp;<span class="ident" id="4093599">z</span><span class="op" id="4093600">,</span>&nbsp;<span class="builtintype" id="4093602">int</span><span class="op" id="4093605">(</span><span class="ident" id="4093606">b</span><span class="op" id="4093607">)</span><span class="op" id="4093608">,</span>&nbsp;<span class="ident" id="4093610">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093622">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4093633">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093637">switch</span>&nbsp;<span class="op" id="4093644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093647">case</span>&nbsp;<span class="ident" id="4093652">bb</span>&nbsp;<span class="op" id="4093655">&gt;</span>&nbsp;<span class="num" id="4093657">1</span><span class="op" id="4093658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093662">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4093705">z</span>&nbsp;<span class="op" id="4093707">=</span>&nbsp;<span class="ident" id="4093709">z</span><span class="op" id="4093710">.</span><span class="ident" id="4093711">mulAddWW</span><span class="op" id="4093719">(</span><span class="ident" id="4093720">z</span><span class="op" id="4093721">,</span>&nbsp;<span class="ident" id="4093723">bb</span><span class="op" id="4093725">,</span>&nbsp;<span class="ident" id="4093727">dd</span><span class="op" id="4093729">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093732">case</span>&nbsp;<span class="ident" id="4093737">base</span>&nbsp;<span class="op" id="4093742">==</span>&nbsp;<span class="num" id="4093745">0</span>&nbsp;<span class="op" id="4093747">&amp;&amp;</span>&nbsp;<span class="ident" id="4093750">b</span>&nbsp;<span class="op" id="4093752">==</span>&nbsp;<span class="num" id="4093755">8</span><span class="op" id="4093756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093760">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093834">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093861">return</span>&nbsp;<span class="ident" id="4093868">z</span><span class="op" id="4093869">,</span>&nbsp;<span class="num" id="4093871">10</span><span class="op" id="4093873">,</span>&nbsp;<span class="builtintype" id="4093875">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093880">case</span>&nbsp;<span class="ident" id="4093885">base</span>&nbsp;<span class="op" id="4093890">!=</span>&nbsp;<span class="num" id="4093893">0</span>&nbsp;<span class="op" id="4093895">||</span>&nbsp;<span class="ident" id="4093898">b</span>&nbsp;<span class="op" id="4093900">!=</span>&nbsp;<span class="num" id="4093903">8</span><span class="op" id="4093904">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4093908">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4093971">return</span>&nbsp;<span class="ident" id="4093978">z</span><span class="op" id="4093979">,</span>&nbsp;<span class="builtintype" id="4093981">int</span><span class="op" id="4093984">(</span><span class="ident" id="4093985">b</span><span class="op" id="4093986">)</span><span class="op" id="4093987">,</span>&nbsp;<span class="ident" id="4093989">errors</span><span class="op" id="4093995">.</span><span class="ident" id="4093996">New</span><span class="op" id="4093999">(</span><span class="string" id="4094000">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="4094030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4094033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094037">return</span>&nbsp;<span class="ident" id="4094044">z</span><span class="op" id="4094045">.</span><span class="ident" id="4094046">norm</span><span class="op" id="4094050">(</span><span class="op" id="4094051">)</span><span class="op" id="4094052">,</span>&nbsp;<span class="builtintype" id="4094054">int</span><span class="op" id="4094057">(</span><span class="ident" id="4094058">b</span><span class="op" id="4094059">)</span><span class="op" id="4094060">,</span>&nbsp;<span class="builtintype" id="4094062">nil</span><br>
<span class="lineno">720</span><span class="op" id="4094066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4094069">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="4094110">const</span>&nbsp;<span class="op" id="4094116">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4094119">lowercaseDigits</span>&nbsp;<span class="op" id="4094135">=</span>&nbsp;<span class="string" id="4094137">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4094177">uppercaseDigits</span>&nbsp;<span class="op" id="4094193">=</span>&nbsp;<span class="string" id="4094195">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="4094234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4094237">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4094293">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="4094345">func</span>&nbsp;<span class="op" id="4094350">(</span><span class="ident" id="4094351">x</span>&nbsp;<span class="ident" id="4094353">nat</span><span class="op" id="4094356">)</span>&nbsp;<span class="ident" id="4094358">decimalString</span><span class="op" id="4094371">(</span><span class="op" id="4094372">)</span>&nbsp;<span class="builtintype" id="4094374">string</span>&nbsp;<span class="op" id="4094381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094384">return</span>&nbsp;<span class="ident" id="4094391">x</span><span class="op" id="4094392">.</span><span class="builtintype" id="4094393">string</span><span class="op" id="4094399">(</span><span class="ident" id="4094400">lowercaseDigits</span><span class="op" id="4094415">[</span><span class="num" id="4094416">0</span><span class="op" id="4094417">:</span><span class="num" id="4094418">10</span><span class="op" id="4094420">]</span><span class="op" id="4094421">)</span><br>
<span class="lineno"></span><span class="op" id="4094423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4094426">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="4094501">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="4094576">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="4094627">func</span>&nbsp;<span class="op" id="4094632">(</span><span class="ident" id="4094633">x</span>&nbsp;<span class="ident" id="4094635">nat</span><span class="op" id="4094638">)</span>&nbsp;<span class="builtintype" id="4094640">string</span><span class="op" id="4094646">(</span><span class="ident" id="4094647">charset</span>&nbsp;<span class="builtintype" id="4094655">string</span><span class="op" id="4094661">)</span>&nbsp;<span class="builtintype" id="4094663">string</span>&nbsp;<span class="op" id="4094670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4094673">b</span>&nbsp;<span class="op" id="4094675">:=</span>&nbsp;<span class="ident" id="4094678">Word</span><span class="op" id="4094682">(</span><span class="builtinfunc" id="4094683">len</span><span class="op" id="4094686">(</span><span class="ident" id="4094687">charset</span><span class="op" id="4094694">)</span><span class="op" id="4094695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4094699">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094717">switch</span>&nbsp;<span class="op" id="4094724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094727">case</span>&nbsp;<span class="ident" id="4094732">b</span>&nbsp;<span class="op" id="4094734">&lt;</span>&nbsp;<span class="num" id="4094736">2</span>&nbsp;<span class="op" id="4094738">||</span>&nbsp;<span class="ident" id="4094741">MaxBase</span>&nbsp;<span class="op" id="4094749">&gt;</span>&nbsp;<span class="num" id="4094751">256</span><span class="op" id="4094754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4094758">panic</span><span class="op" id="4094763">(</span><span class="string" id="4094764">&#34;illegal&nbsp;base&#34;</span><span class="op" id="4094778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094781">case</span>&nbsp;<span class="builtinfunc" id="4094786">len</span><span class="op" id="4094789">(</span><span class="ident" id="4094790">x</span><span class="op" id="4094791">)</span>&nbsp;<span class="op" id="4094793">==</span>&nbsp;<span class="num" id="4094796">0</span><span class="op" id="4094797">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4094801">return</span>&nbsp;<span class="builtintype" id="4094808">string</span><span class="op" id="4094814">(</span><span class="ident" id="4094815">charset</span><span class="op" id="4094822">[</span><span class="num" id="4094823">0</span><span class="op" id="4094824">]</span><span class="op" id="4094825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4094828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4094832">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4094867">i</span>&nbsp;<span class="op" id="4094869">:=</span>&nbsp;<span class="builtintype" id="4094872">int</span><span class="op" id="4094875">(</span><span class="builtintype" id="4094876">float64</span><span class="op" id="4094883">(</span><span class="ident" id="4094884">x</span><span class="op" id="4094885">.</span><span class="ident" id="4094886">bitLen</span><span class="op" id="4094892">(</span><span class="op" id="4094893">)</span><span class="op" id="4094894">)</span><span class="op" id="4094895">/</span><span class="ident" id="4094896">math</span><span class="op" id="4094900">.</span><span class="ident" id="4094901">Log2</span><span class="op" id="4094905">(</span><span class="builtintype" id="4094906">float64</span><span class="op" id="4094913">(</span><span class="ident" id="4094914">b</span><span class="op" id="4094915">)</span><span class="op" id="4094916">)</span><span class="op" id="4094917">)</span>&nbsp;<span class="op" id="4094919">+</span>&nbsp;<span class="num" id="4094921">1</span>&nbsp;<span class="comment" id="4094923">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4094946">s</span>&nbsp;<span class="op" id="4094948">:=</span>&nbsp;<span class="builtinfunc" id="4094951">make</span><span class="op" id="4094955">(</span><span class="op" id="4094956">[</span><span class="op" id="4094957">]</span><span class="builtintype" id="4094958">byte</span><span class="op" id="4094962">,</span>&nbsp;<span class="ident" id="4094964">i</span><span class="op" id="4094965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4094969">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4095032">if</span>&nbsp;<span class="ident" id="4095035">b</span>&nbsp;<span class="op" id="4095037">==</span>&nbsp;<span class="ident" id="4095040">b</span><span class="op" id="4095041">&amp;</span><span class="op" id="4095042">-</span><span class="ident" id="4095043">b</span>&nbsp;<span class="op" id="4095045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095049">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095089">shift</span>&nbsp;<span class="op" id="4095095">:=</span>&nbsp;<span class="ident" id="4095098">trailingZeroBits</span><span class="op" id="4095114">(</span><span class="ident" id="4095115">b</span><span class="op" id="4095116">)</span>&nbsp;<span class="comment" id="4095118">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095148">mask</span>&nbsp;<span class="op" id="4095153">:=</span>&nbsp;<span class="ident" id="4095156">Word</span><span class="op" id="4095160">(</span><span class="num" id="4095161">1</span><span class="op" id="4095162">)</span><span class="op" id="4095163">&lt;&lt;</span><span class="ident" id="4095165">shift</span>&nbsp;<span class="op" id="4095171">-</span>&nbsp;<span class="num" id="4095173">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095177">w</span>&nbsp;<span class="op" id="4095179">:=</span>&nbsp;<span class="ident" id="4095182">x</span><span class="op" id="4095183">[</span><span class="num" id="4095184">0</span><span class="op" id="4095185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095189">nbits</span>&nbsp;<span class="op" id="4095195">:=</span>&nbsp;<span class="builtintype" id="4095198">uint</span><span class="op" id="4095202">(</span><span class="ident" id="4095203">_W</span><span class="op" id="4095205">)</span>&nbsp;<span class="comment" id="4095207">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095245">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4095281">for</span>&nbsp;<span class="ident" id="4095285">k</span>&nbsp;<span class="op" id="4095287">:=</span>&nbsp;<span class="num" id="4095290">1</span><span class="op" id="4095291">;</span>&nbsp;<span class="ident" id="4095293">k</span>&nbsp;<span class="op" id="4095295">&lt;</span>&nbsp;<span class="builtinfunc" id="4095297">len</span><span class="op" id="4095300">(</span><span class="ident" id="4095301">x</span><span class="op" id="4095302">)</span><span class="op" id="4095303">;</span>&nbsp;<span class="ident" id="4095305">k</span><span class="op" id="4095306">++</span>&nbsp;<span class="op" id="4095309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095314">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4095340">for</span>&nbsp;<span class="ident" id="4095344">nbits</span>&nbsp;<span class="op" id="4095350">&gt;=</span>&nbsp;<span class="ident" id="4095353">shift</span>&nbsp;<span class="op" id="4095359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095365">i</span><span class="op" id="4095366">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095373">s</span><span class="op" id="4095374">[</span><span class="ident" id="4095375">i</span><span class="op" id="4095376">]</span>&nbsp;<span class="op" id="4095378">=</span>&nbsp;<span class="ident" id="4095380">charset</span><span class="op" id="4095387">[</span><span class="ident" id="4095388">w</span><span class="op" id="4095389">&amp;</span><span class="ident" id="4095390">mask</span><span class="op" id="4095394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095400">w</span>&nbsp;<span class="op" id="4095402">&gt;&gt;=</span>&nbsp;<span class="ident" id="4095406">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095416">nbits</span>&nbsp;<span class="op" id="4095422">-=</span>&nbsp;<span class="ident" id="4095425">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095440">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4095505">if</span>&nbsp;<span class="ident" id="4095508">nbits</span>&nbsp;<span class="op" id="4095514">==</span>&nbsp;<span class="num" id="4095517">0</span>&nbsp;<span class="op" id="4095519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095525">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095573">w</span>&nbsp;<span class="op" id="4095575">=</span>&nbsp;<span class="ident" id="4095577">x</span><span class="op" id="4095578">[</span><span class="ident" id="4095579">k</span><span class="op" id="4095580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095586">nbits</span>&nbsp;<span class="op" id="4095592">=</span>&nbsp;<span class="ident" id="4095594">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095600">}</span>&nbsp;<span class="keyword" id="4095602">else</span>&nbsp;<span class="op" id="4095607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095613">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095669">w</span>&nbsp;<span class="op" id="4095671">|=</span>&nbsp;<span class="ident" id="4095674">x</span><span class="op" id="4095675">[</span><span class="ident" id="4095676">k</span><span class="op" id="4095677">]</span>&nbsp;<span class="op" id="4095679">&lt;&lt;</span>&nbsp;<span class="ident" id="4095682">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095692">i</span><span class="op" id="4095693">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095700">s</span><span class="op" id="4095701">[</span><span class="ident" id="4095702">i</span><span class="op" id="4095703">]</span>&nbsp;<span class="op" id="4095705">=</span>&nbsp;<span class="ident" id="4095707">charset</span><span class="op" id="4095714">[</span><span class="ident" id="4095715">w</span><span class="op" id="4095716">&amp;</span><span class="ident" id="4095717">mask</span><span class="op" id="4095721">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095728">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095743">w</span>&nbsp;<span class="op" id="4095745">=</span>&nbsp;<span class="ident" id="4095747">x</span><span class="op" id="4095748">[</span><span class="ident" id="4095749">k</span><span class="op" id="4095750">]</span>&nbsp;<span class="op" id="4095752">&gt;&gt;</span>&nbsp;<span class="op" id="4095755">(</span><span class="ident" id="4095756">shift</span>&nbsp;<span class="op" id="4095762">-</span>&nbsp;<span class="ident" id="4095764">nbits</span><span class="op" id="4095769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095775">nbits</span>&nbsp;<span class="op" id="4095781">=</span>&nbsp;<span class="ident" id="4095783">_W</span>&nbsp;<span class="op" id="4095786">-</span>&nbsp;<span class="op" id="4095788">(</span><span class="ident" id="4095789">shift</span>&nbsp;<span class="op" id="4095795">-</span>&nbsp;<span class="ident" id="4095797">nbits</span><span class="op" id="4095802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095807">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095816">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4095882">for</span>&nbsp;<span class="ident" id="4095886">nbits</span>&nbsp;<span class="op" id="4095892">&gt;=</span>&nbsp;<span class="num" id="4095895">0</span>&nbsp;<span class="op" id="4095897">&amp;&amp;</span>&nbsp;<span class="ident" id="4095900">w</span>&nbsp;<span class="op" id="4095902">!=</span>&nbsp;<span class="num" id="4095905">0</span>&nbsp;<span class="op" id="4095907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095912">i</span><span class="op" id="4095913">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095919">s</span><span class="op" id="4095920">[</span><span class="ident" id="4095921">i</span><span class="op" id="4095922">]</span>&nbsp;<span class="op" id="4095924">=</span>&nbsp;<span class="ident" id="4095926">charset</span><span class="op" id="4095933">[</span><span class="ident" id="4095934">w</span><span class="op" id="4095935">&amp;</span><span class="ident" id="4095936">mask</span><span class="op" id="4095940">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095945">w</span>&nbsp;<span class="op" id="4095947">&gt;&gt;=</span>&nbsp;<span class="ident" id="4095951">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4095960">nbits</span>&nbsp;<span class="op" id="4095966">-=</span>&nbsp;<span class="ident" id="4095969">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4095981">}</span>&nbsp;<span class="keyword" id="4095983">else</span>&nbsp;<span class="op" id="4095988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4095992">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096055">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096113">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096170">bb</span>&nbsp;<span class="op" id="4096173">:=</span>&nbsp;<span class="ident" id="4096176">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096183">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096211">ndigits</span>&nbsp;<span class="op" id="4096219">:=</span>&nbsp;<span class="num" id="4096222">1</span>&nbsp;<span class="comment" id="4096224">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4096253">for</span>&nbsp;<span class="ident" id="4096257">max</span>&nbsp;<span class="op" id="4096261">:=</span>&nbsp;<span class="ident" id="4096264">Word</span><span class="op" id="4096268">(</span><span class="ident" id="4096269">_M</span>&nbsp;<span class="op" id="4096272">/</span>&nbsp;<span class="ident" id="4096274">b</span><span class="op" id="4096275">)</span><span class="op" id="4096276">;</span>&nbsp;<span class="ident" id="4096278">bb</span>&nbsp;<span class="op" id="4096281">&lt;=</span>&nbsp;<span class="ident" id="4096284">max</span><span class="op" id="4096287">;</span>&nbsp;<span class="ident" id="4096289">bb</span>&nbsp;<span class="op" id="4096292">*=</span>&nbsp;<span class="ident" id="4096295">b</span>&nbsp;<span class="op" id="4096297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096302">ndigits</span><span class="op" id="4096309">++</span>&nbsp;<span class="comment" id="4096312">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096371">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096452">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096507">table</span>&nbsp;<span class="op" id="4096513">:=</span>&nbsp;<span class="ident" id="4096516">divisors</span><span class="op" id="4096524">(</span><span class="builtinfunc" id="4096525">len</span><span class="op" id="4096528">(</span><span class="ident" id="4096529">x</span><span class="op" id="4096530">)</span><span class="op" id="4096531">,</span>&nbsp;<span class="ident" id="4096533">b</span><span class="op" id="4096534">,</span>&nbsp;<span class="ident" id="4096536">ndigits</span><span class="op" id="4096543">,</span>&nbsp;<span class="ident" id="4096545">bb</span><span class="op" id="4096547">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096552">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096611">q</span>&nbsp;<span class="op" id="4096613">:=</span>&nbsp;<span class="ident" id="4096616">nat</span><span class="op" id="4096619">(</span><span class="builtintype" id="4096620">nil</span><span class="op" id="4096623">)</span><span class="op" id="4096624">.</span><span class="ident" id="4096625">set</span><span class="op" id="4096628">(</span><span class="ident" id="4096629">x</span><span class="op" id="4096630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096635">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096672">q</span><span class="op" id="4096673">.</span><span class="ident" id="4096674">convertWords</span><span class="op" id="4096686">(</span><span class="ident" id="4096687">s</span><span class="op" id="4096688">,</span>&nbsp;<span class="ident" id="4096690">charset</span><span class="op" id="4096697">,</span>&nbsp;<span class="ident" id="4096699">b</span><span class="op" id="4096700">,</span>&nbsp;<span class="ident" id="4096702">ndigits</span><span class="op" id="4096709">,</span>&nbsp;<span class="ident" id="4096711">bb</span><span class="op" id="4096713">,</span>&nbsp;<span class="ident" id="4096715">table</span><span class="op" id="4096720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096725">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096750">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4096812">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096846">i</span>&nbsp;<span class="op" id="4096848">=</span>&nbsp;<span class="num" id="4096850">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4096854">for</span>&nbsp;<span class="ident" id="4096858">zero</span>&nbsp;<span class="op" id="4096863">:=</span>&nbsp;<span class="ident" id="4096866">charset</span><span class="op" id="4096873">[</span><span class="num" id="4096874">0</span><span class="op" id="4096875">]</span><span class="op" id="4096876">;</span>&nbsp;<span class="ident" id="4096878">s</span><span class="op" id="4096879">[</span><span class="ident" id="4096880">i</span><span class="op" id="4096881">]</span>&nbsp;<span class="op" id="4096883">==</span>&nbsp;<span class="ident" id="4096886">zero</span><span class="op" id="4096890">;</span>&nbsp;<span class="op" id="4096892">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4096897">i</span><span class="op" id="4096898">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4096906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4096910">return</span>&nbsp;<span class="builtintype" id="4096917">string</span><span class="op" id="4096923">(</span><span class="ident" id="4096924">s</span><span class="op" id="4096925">[</span><span class="ident" id="4096926">i</span><span class="op" id="4096927">:</span><span class="op" id="4096928">]</span><span class="op" id="4096929">)</span><br>
<span class="lineno">825</span><span class="op" id="4096931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4096934">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4097028">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="4097122">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="4097153">//</span><br>
<span class="lineno"></span><span class="comment" id="4097156">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4097256">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="4097353">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="4097449">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="4097545">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4097643">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="4097740">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4097837">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4097935">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="4098031">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4098124">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="4098146">//</span><br>
<span class="lineno"></span><span class="keyword" id="4098149">func</span>&nbsp;<span class="op" id="4098154">(</span><span class="ident" id="4098155">q</span>&nbsp;<span class="ident" id="4098157">nat</span><span class="op" id="4098160">)</span>&nbsp;<span class="ident" id="4098162">convertWords</span><span class="op" id="4098174">(</span><span class="ident" id="4098175">s</span>&nbsp;<span class="op" id="4098177">[</span><span class="op" id="4098178">]</span><span class="builtintype" id="4098179">byte</span><span class="op" id="4098183">,</span>&nbsp;<span class="ident" id="4098185">charset</span>&nbsp;<span class="builtintype" id="4098193">string</span><span class="op" id="4098199">,</span>&nbsp;<span class="ident" id="4098201">b</span>&nbsp;<span class="ident" id="4098203">Word</span><span class="op" id="4098207">,</span>&nbsp;<span class="ident" id="4098209">ndigits</span>&nbsp;<span class="builtintype" id="4098217">int</span><span class="op" id="4098220">,</span>&nbsp;<span class="ident" id="4098222">bb</span>&nbsp;<span class="ident" id="4098225">Word</span><span class="op" id="4098229">,</span>&nbsp;<span class="ident" id="4098231">table</span>&nbsp;<span class="op" id="4098237">[</span><span class="op" id="4098238">]</span><span class="ident" id="4098239">divisor</span><span class="op" id="4098246">)</span>&nbsp;<span class="op" id="4098248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098251">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098287">if</span>&nbsp;<span class="ident" id="4098290">table</span>&nbsp;<span class="op" id="4098296">!=</span>&nbsp;<span class="builtintype" id="4098299">nil</span>&nbsp;<span class="op" id="4098303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098307">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098334">var</span>&nbsp;<span class="ident" id="4098338">r</span>&nbsp;<span class="ident" id="4098340">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098346">index</span>&nbsp;<span class="op" id="4098352">:=</span>&nbsp;<span class="builtinfunc" id="4098355">len</span><span class="op" id="4098358">(</span><span class="ident" id="4098359">table</span><span class="op" id="4098364">)</span>&nbsp;<span class="op" id="4098366">-</span>&nbsp;<span class="num" id="4098368">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098372">for</span>&nbsp;<span class="builtinfunc" id="4098376">len</span><span class="op" id="4098379">(</span><span class="ident" id="4098380">q</span><span class="op" id="4098381">)</span>&nbsp;<span class="op" id="4098383">&gt;</span>&nbsp;<span class="ident" id="4098385">leafSize</span>&nbsp;<span class="op" id="4098394">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098399">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098468">maxLength</span>&nbsp;<span class="op" id="4098478">:=</span>&nbsp;<span class="ident" id="4098481">q</span><span class="op" id="4098482">.</span><span class="ident" id="4098483">bitLen</span><span class="op" id="4098489">(</span><span class="op" id="4098490">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098496">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098566">minLength</span>&nbsp;<span class="op" id="4098576">:=</span>&nbsp;<span class="ident" id="4098579">maxLength</span>&nbsp;<span class="op" id="4098589">&gt;&gt;</span>&nbsp;<span class="num" id="4098592">1</span>&nbsp;<span class="comment" id="4098594">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098616">for</span>&nbsp;<span class="ident" id="4098620">index</span>&nbsp;<span class="op" id="4098626">&gt;</span>&nbsp;<span class="num" id="4098628">0</span>&nbsp;<span class="op" id="4098630">&amp;&amp;</span>&nbsp;<span class="ident" id="4098633">table</span><span class="op" id="4098638">[</span><span class="ident" id="4098639">index</span><span class="op" id="4098644">-</span><span class="num" id="4098645">1</span><span class="op" id="4098646">]</span><span class="op" id="4098647">.</span><span class="ident" id="4098648">nbits</span>&nbsp;<span class="op" id="4098654">&gt;</span>&nbsp;<span class="ident" id="4098656">minLength</span>&nbsp;<span class="op" id="4098666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098672">index</span><span class="op" id="4098677">--</span>&nbsp;<span class="comment" id="4098680">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098699">if</span>&nbsp;<span class="ident" id="4098702">table</span><span class="op" id="4098707">[</span><span class="ident" id="4098708">index</span><span class="op" id="4098713">]</span><span class="op" id="4098714">.</span><span class="ident" id="4098715">nbits</span>&nbsp;<span class="op" id="4098721">&gt;=</span>&nbsp;<span class="ident" id="4098724">maxLength</span>&nbsp;<span class="op" id="4098734">&amp;&amp;</span>&nbsp;<span class="ident" id="4098737">table</span><span class="op" id="4098742">[</span><span class="ident" id="4098743">index</span><span class="op" id="4098748">]</span><span class="op" id="4098749">.</span><span class="ident" id="4098750">bbb</span><span class="op" id="4098753">.</span><span class="ident" id="4098754">cmp</span><span class="op" id="4098757">(</span><span class="ident" id="4098758">q</span><span class="op" id="4098759">)</span>&nbsp;<span class="op" id="4098761">&gt;=</span>&nbsp;<span class="num" id="4098764">0</span>&nbsp;<span class="op" id="4098766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098772">index</span><span class="op" id="4098777">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4098784">if</span>&nbsp;<span class="ident" id="4098787">index</span>&nbsp;<span class="op" id="4098793">&lt;</span>&nbsp;<span class="num" id="4098795">0</span>&nbsp;<span class="op" id="4098797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4098804">panic</span><span class="op" id="4098809">(</span><span class="string" id="4098810">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="4098834">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4098845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098851">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4098934">q</span><span class="op" id="4098935">,</span>&nbsp;<span class="ident" id="4098937">r</span>&nbsp;<span class="op" id="4098939">=</span>&nbsp;<span class="ident" id="4098941">q</span><span class="op" id="4098942">.</span><span class="ident" id="4098943">div</span><span class="op" id="4098946">(</span><span class="ident" id="4098947">r</span><span class="op" id="4098948">,</span>&nbsp;<span class="ident" id="4098950">q</span><span class="op" id="4098951">,</span>&nbsp;<span class="ident" id="4098953">table</span><span class="op" id="4098958">[</span><span class="ident" id="4098959">index</span><span class="op" id="4098964">]</span><span class="op" id="4098965">.</span><span class="ident" id="4098966">bbb</span><span class="op" id="4098969">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4098975">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099038">h</span>&nbsp;<span class="op" id="4099040">:=</span>&nbsp;<span class="builtinfunc" id="4099043">len</span><span class="op" id="4099046">(</span><span class="ident" id="4099047">s</span><span class="op" id="4099048">)</span>&nbsp;<span class="op" id="4099050">-</span>&nbsp;<span class="ident" id="4099052">table</span><span class="op" id="4099057">[</span><span class="ident" id="4099058">index</span><span class="op" id="4099063">]</span><span class="op" id="4099064">.</span><span class="ident" id="4099065">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099076">r</span><span class="op" id="4099077">.</span><span class="ident" id="4099078">convertWords</span><span class="op" id="4099090">(</span><span class="ident" id="4099091">s</span><span class="op" id="4099092">[</span><span class="ident" id="4099093">h</span><span class="op" id="4099094">:</span><span class="op" id="4099095">]</span><span class="op" id="4099096">,</span>&nbsp;<span class="ident" id="4099098">charset</span><span class="op" id="4099105">,</span>&nbsp;<span class="ident" id="4099107">b</span><span class="op" id="4099108">,</span>&nbsp;<span class="ident" id="4099110">ndigits</span><span class="op" id="4099117">,</span>&nbsp;<span class="ident" id="4099119">bb</span><span class="op" id="4099121">,</span>&nbsp;<span class="ident" id="4099123">table</span><span class="op" id="4099128">[</span><span class="num" id="4099129">0</span><span class="op" id="4099130">:</span><span class="ident" id="4099131">index</span><span class="op" id="4099136">]</span><span class="op" id="4099137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099142">s</span>&nbsp;<span class="op" id="4099144">=</span>&nbsp;<span class="ident" id="4099146">s</span><span class="op" id="4099147">[</span><span class="op" id="4099148">:</span><span class="ident" id="4099149">h</span><span class="op" id="4099150">]</span>&nbsp;<span class="comment" id="4099152">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099228">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099314">i</span>&nbsp;<span class="op" id="4099316">:=</span>&nbsp;<span class="builtinfunc" id="4099319">len</span><span class="op" id="4099322">(</span><span class="ident" id="4099323">s</span><span class="op" id="4099324">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099327">var</span>&nbsp;<span class="ident" id="4099331">r</span>&nbsp;<span class="ident" id="4099333">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099339">if</span>&nbsp;<span class="ident" id="4099342">b</span>&nbsp;<span class="op" id="4099344">==</span>&nbsp;<span class="num" id="4099347">10</span>&nbsp;<span class="op" id="4099350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099354">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099441">for</span>&nbsp;<span class="builtinfunc" id="4099445">len</span><span class="op" id="4099448">(</span><span class="ident" id="4099449">q</span><span class="op" id="4099450">)</span>&nbsp;<span class="op" id="4099452">&gt;</span>&nbsp;<span class="num" id="4099454">0</span>&nbsp;<span class="op" id="4099456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099461">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099510">q</span><span class="op" id="4099511">,</span>&nbsp;<span class="ident" id="4099513">r</span>&nbsp;<span class="op" id="4099515">=</span>&nbsp;<span class="ident" id="4099517">q</span><span class="op" id="4099518">.</span><span class="ident" id="4099519">divW</span><span class="op" id="4099523">(</span><span class="ident" id="4099524">q</span><span class="op" id="4099525">,</span>&nbsp;<span class="ident" id="4099527">bb</span><span class="op" id="4099529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099534">for</span>&nbsp;<span class="ident" id="4099538">j</span>&nbsp;<span class="op" id="4099540">:=</span>&nbsp;<span class="num" id="4099543">0</span><span class="op" id="4099544">;</span>&nbsp;<span class="ident" id="4099546">j</span>&nbsp;<span class="op" id="4099548">&lt;</span>&nbsp;<span class="ident" id="4099550">ndigits</span>&nbsp;<span class="op" id="4099558">&amp;&amp;</span>&nbsp;<span class="ident" id="4099561">i</span>&nbsp;<span class="op" id="4099563">&gt;</span>&nbsp;<span class="num" id="4099565">0</span><span class="op" id="4099566">;</span>&nbsp;<span class="ident" id="4099568">j</span><span class="op" id="4099569">++</span>&nbsp;<span class="op" id="4099572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099578">i</span><span class="op" id="4099579">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099586">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099645">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099709">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099771">t</span>&nbsp;<span class="op" id="4099773">:=</span>&nbsp;<span class="ident" id="4099776">r</span>&nbsp;<span class="op" id="4099778">/</span>&nbsp;<span class="num" id="4099780">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099787">s</span><span class="op" id="4099788">[</span><span class="ident" id="4099789">i</span><span class="op" id="4099790">]</span>&nbsp;<span class="op" id="4099792">=</span>&nbsp;<span class="ident" id="4099794">charset</span><span class="op" id="4099801">[</span><span class="ident" id="4099802">r</span><span class="op" id="4099803">-</span><span class="ident" id="4099804">t</span><span class="op" id="4099805">&lt;&lt;</span><span class="num" id="4099807">3</span><span class="op" id="4099808">-</span><span class="ident" id="4099809">t</span><span class="op" id="4099810">-</span><span class="ident" id="4099811">t</span><span class="op" id="4099812">]</span>&nbsp;<span class="comment" id="4099814">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099882">r</span>&nbsp;<span class="op" id="4099884">=</span>&nbsp;<span class="ident" id="4099886">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099891">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4099898">}</span>&nbsp;<span class="keyword" id="4099900">else</span>&nbsp;<span class="op" id="4099905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4099909">for</span>&nbsp;<span class="builtinfunc" id="4099913">len</span><span class="op" id="4099916">(</span><span class="ident" id="4099917">q</span><span class="op" id="4099918">)</span>&nbsp;<span class="op" id="4099920">&gt;</span>&nbsp;<span class="num" id="4099922">0</span>&nbsp;<span class="op" id="4099924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4099929">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4099978">q</span><span class="op" id="4099979">,</span>&nbsp;<span class="ident" id="4099981">r</span>&nbsp;<span class="op" id="4099983">=</span>&nbsp;<span class="ident" id="4099985">q</span><span class="op" id="4099986">.</span><span class="ident" id="4099987">divW</span><span class="op" id="4099991">(</span><span class="ident" id="4099992">q</span><span class="op" id="4099993">,</span>&nbsp;<span class="ident" id="4099995">bb</span><span class="op" id="4099997">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100002">for</span>&nbsp;<span class="ident" id="4100006">j</span>&nbsp;<span class="op" id="4100008">:=</span>&nbsp;<span class="num" id="4100011">0</span><span class="op" id="4100012">;</span>&nbsp;<span class="ident" id="4100014">j</span>&nbsp;<span class="op" id="4100016">&lt;</span>&nbsp;<span class="ident" id="4100018">ndigits</span>&nbsp;<span class="op" id="4100026">&amp;&amp;</span>&nbsp;<span class="ident" id="4100029">i</span>&nbsp;<span class="op" id="4100031">&gt;</span>&nbsp;<span class="num" id="4100033">0</span><span class="op" id="4100034">;</span>&nbsp;<span class="ident" id="4100036">j</span><span class="op" id="4100037">++</span>&nbsp;<span class="op" id="4100040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100046">i</span><span class="op" id="4100047">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100054">s</span><span class="op" id="4100055">[</span><span class="ident" id="4100056">i</span><span class="op" id="4100057">]</span>&nbsp;<span class="op" id="4100059">=</span>&nbsp;<span class="ident" id="4100061">charset</span><span class="op" id="4100068">[</span><span class="ident" id="4100069">r</span><span class="op" id="4100070">%</span><span class="ident" id="4100071">b</span><span class="op" id="4100072">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100078">r</span>&nbsp;<span class="op" id="4100080">/=</span>&nbsp;<span class="ident" id="4100083">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100088">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4100099">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100129">zero</span>&nbsp;<span class="op" id="4100134">:=</span>&nbsp;<span class="ident" id="4100137">charset</span><span class="op" id="4100144">[</span><span class="num" id="4100145">0</span><span class="op" id="4100146">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100149">for</span>&nbsp;<span class="ident" id="4100153">i</span>&nbsp;<span class="op" id="4100155">&gt;</span>&nbsp;<span class="num" id="4100157">0</span>&nbsp;<span class="op" id="4100159">{</span>&nbsp;<span class="comment" id="4100161">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100197">i</span><span class="op" id="4100198">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100203">s</span><span class="op" id="4100204">[</span><span class="ident" id="4100205">i</span><span class="op" id="4100206">]</span>&nbsp;<span class="op" id="4100208">=</span>&nbsp;<span class="ident" id="4100210">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4100216">}</span><br>
<span class="lineno"></span><span class="op" id="4100218">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="4100221">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="4100311">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4100376">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="4100456">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="4100516">var</span>&nbsp;<span class="ident" id="4100520">leafSize</span>&nbsp;<span class="builtintype" id="4100529">int</span>&nbsp;<span class="op" id="4100533">=</span>&nbsp;<span class="num" id="4100535">8</span>&nbsp;<span class="comment" id="4100537">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100603">type</span>&nbsp;<span class="ident" id="4100608">divisor</span>&nbsp;<span class="keyword" id="4100616">struct</span>&nbsp;<span class="op" id="4100623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100626">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100634">nat</span>&nbsp;<span class="comment" id="4100638">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100650">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4100658">int</span>&nbsp;<span class="comment" id="4100662">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100730">ndigits</span>&nbsp;<span class="builtintype" id="4100738">int</span>&nbsp;<span class="comment" id="4100742">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="4100800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4100803">var</span>&nbsp;<span class="ident" id="4100807">cacheBase10</span>&nbsp;<span class="keyword" id="4100819">struct</span>&nbsp;<span class="op" id="4100826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100829">sync</span><span class="op" id="4100833">.</span><span class="ident" id="4100834">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4100841">table</span>&nbsp;<span class="op" id="4100847">[</span><span class="num" id="4100848">64</span><span class="op" id="4100850">]</span><span class="ident" id="4100851">divisor</span>&nbsp;<span class="comment" id="4100859">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="4100890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4100893">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="4100916">func</span>&nbsp;<span class="op" id="4100921">(</span><span class="ident" id="4100922">z</span>&nbsp;<span class="ident" id="4100924">nat</span><span class="op" id="4100927">)</span>&nbsp;<span class="ident" id="4100929">expWW</span><span class="op" id="4100934">(</span><span class="ident" id="4100935">x</span><span class="op" id="4100936">,</span>&nbsp;<span class="ident" id="4100938">y</span>&nbsp;<span class="ident" id="4100940">Word</span><span class="op" id="4100944">)</span>&nbsp;<span class="ident" id="4100946">nat</span>&nbsp;<span class="op" id="4100950">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4100953">return</span>&nbsp;<span class="ident" id="4100960">z</span><span class="op" id="4100961">.</span><span class="ident" id="4100962">expNN</span><span class="op" id="4100967">(</span><span class="ident" id="4100968">nat</span><span class="op" id="4100971">(</span><span class="builtintype" id="4100972">nil</span><span class="op" id="4100975">)</span><span class="op" id="4100976">.</span><span class="ident" id="4100977">setWord</span><span class="op" id="4100984">(</span><span class="ident" id="4100985">x</span><span class="op" id="4100986">)</span><span class="op" id="4100987">,</span>&nbsp;<span class="ident" id="4100989">nat</span><span class="op" id="4100992">(</span><span class="builtintype" id="4100993">nil</span><span class="op" id="4100996">)</span><span class="op" id="4100997">.</span><span class="ident" id="4100998">setWord</span><span class="op" id="4101005">(</span><span class="ident" id="4101006">y</span><span class="op" id="4101007">)</span><span class="op" id="4101008">,</span>&nbsp;<span class="builtintype" id="4101010">nil</span><span class="op" id="4101013">)</span><br>
<span class="lineno"></span><span class="op" id="4101015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4101018">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="4101085">func</span>&nbsp;<span class="ident" id="4101090">divisors</span><span class="op" id="4101098">(</span><span class="ident" id="4101099">m</span>&nbsp;<span class="builtintype" id="4101101">int</span><span class="op" id="4101104">,</span>&nbsp;<span class="ident" id="4101106">b</span>&nbsp;<span class="ident" id="4101108">Word</span><span class="op" id="4101112">,</span>&nbsp;<span class="ident" id="4101114">ndigits</span>&nbsp;<span class="builtintype" id="4101122">int</span><span class="op" id="4101125">,</span>&nbsp;<span class="ident" id="4101127">bb</span>&nbsp;<span class="ident" id="4101130">Word</span><span class="op" id="4101134">)</span>&nbsp;<span class="op" id="4101136">[</span><span class="op" id="4101137">]</span><span class="ident" id="4101138">divisor</span>&nbsp;<span class="op" id="4101146">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101149">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101224">if</span>&nbsp;<span class="ident" id="4101227">leafSize</span>&nbsp;<span class="op" id="4101236">==</span>&nbsp;<span class="num" id="4101239">0</span>&nbsp;<span class="op" id="4101241">||</span>&nbsp;<span class="ident" id="4101244">m</span>&nbsp;<span class="op" id="4101246">&lt;=</span>&nbsp;<span class="ident" id="4101249">leafSize</span>&nbsp;<span class="op" id="4101258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101262">return</span>&nbsp;<span class="builtintype" id="4101269">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101278">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101334">k</span>&nbsp;<span class="op" id="4101336">:=</span>&nbsp;<span class="num" id="4101339">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101342">for</span>&nbsp;<span class="ident" id="4101346">words</span>&nbsp;<span class="op" id="4101352">:=</span>&nbsp;<span class="ident" id="4101355">leafSize</span><span class="op" id="4101363">;</span>&nbsp;<span class="ident" id="4101365">words</span>&nbsp;<span class="op" id="4101371">&lt;</span>&nbsp;<span class="ident" id="4101373">m</span><span class="op" id="4101374">&gt;&gt;</span><span class="num" id="4101376">1</span>&nbsp;<span class="op" id="4101378">&amp;&amp;</span>&nbsp;<span class="ident" id="4101381">k</span>&nbsp;<span class="op" id="4101383">&lt;</span>&nbsp;<span class="builtinfunc" id="4101385">len</span><span class="op" id="4101388">(</span><span class="ident" id="4101389">cacheBase10</span><span class="op" id="4101400">.</span><span class="ident" id="4101401">table</span><span class="op" id="4101406">)</span><span class="op" id="4101407">;</span>&nbsp;<span class="ident" id="4101409">words</span>&nbsp;<span class="op" id="4101415">&lt;&lt;=</span>&nbsp;<span class="num" id="4101419">1</span>&nbsp;<span class="op" id="4101421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101425">k</span><span class="op" id="4101426">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101430">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101434">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101517">var</span>&nbsp;<span class="ident" id="4101521">table</span>&nbsp;<span class="op" id="4101527">[</span><span class="op" id="4101528">]</span><span class="ident" id="4101529">divisor</span>&nbsp;<span class="comment" id="4101537">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101592">if</span>&nbsp;<span class="ident" id="4101595">b</span>&nbsp;<span class="op" id="4101597">==</span>&nbsp;<span class="num" id="4101600">10</span>&nbsp;<span class="op" id="4101603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101607">cacheBase10</span><span class="op" id="4101618">.</span><span class="ident" id="4101619">Lock</span><span class="op" id="4101623">(</span><span class="op" id="4101624">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101628">table</span>&nbsp;<span class="op" id="4101634">=</span>&nbsp;<span class="ident" id="4101636">cacheBase10</span><span class="op" id="4101647">.</span><span class="ident" id="4101648">table</span><span class="op" id="4101653">[</span><span class="num" id="4101654">0</span><span class="op" id="4101655">:</span><span class="ident" id="4101656">k</span><span class="op" id="4101657">]</span>&nbsp;<span class="comment" id="4101659">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101699">}</span>&nbsp;<span class="keyword" id="4101701">else</span>&nbsp;<span class="op" id="4101706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101710">table</span>&nbsp;<span class="op" id="4101716">=</span>&nbsp;<span class="builtinfunc" id="4101718">make</span><span class="op" id="4101722">(</span><span class="op" id="4101723">[</span><span class="op" id="4101724">]</span><span class="ident" id="4101725">divisor</span><span class="op" id="4101732">,</span>&nbsp;<span class="ident" id="4101734">k</span><span class="op" id="4101735">)</span>&nbsp;<span class="comment" id="4101737">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4101778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101782">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101799">if</span>&nbsp;<span class="ident" id="4101802">table</span><span class="op" id="4101807">[</span><span class="ident" id="4101808">k</span><span class="op" id="4101809">-</span><span class="num" id="4101810">1</span><span class="op" id="4101811">]</span><span class="op" id="4101812">.</span><span class="ident" id="4101813">ndigits</span>&nbsp;<span class="op" id="4101821">==</span>&nbsp;<span class="num" id="4101824">0</span>&nbsp;<span class="op" id="4101826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4101830">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101861">var</span>&nbsp;<span class="ident" id="4101865">larger</span>&nbsp;<span class="ident" id="4101872">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101878">for</span>&nbsp;<span class="ident" id="4101882">i</span>&nbsp;<span class="op" id="4101884">:=</span>&nbsp;<span class="num" id="4101887">0</span><span class="op" id="4101888">;</span>&nbsp;<span class="ident" id="4101890">i</span>&nbsp;<span class="op" id="4101892">&lt;</span>&nbsp;<span class="ident" id="4101894">k</span><span class="op" id="4101895">;</span>&nbsp;<span class="ident" id="4101897">i</span><span class="op" id="4101898">++</span>&nbsp;<span class="op" id="4101901">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101906">if</span>&nbsp;<span class="ident" id="4101909">table</span><span class="op" id="4101914">[</span><span class="ident" id="4101915">i</span><span class="op" id="4101916">]</span><span class="op" id="4101917">.</span><span class="ident" id="4101918">ndigits</span>&nbsp;<span class="op" id="4101926">==</span>&nbsp;<span class="num" id="4101929">0</span>&nbsp;<span class="op" id="4101931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4101937">if</span>&nbsp;<span class="ident" id="4101940">i</span>&nbsp;<span class="op" id="4101942">==</span>&nbsp;<span class="num" id="4101945">0</span>&nbsp;<span class="op" id="4101947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4101954">table</span><span class="op" id="4101959">[</span><span class="num" id="4101960">0</span><span class="op" id="4101961">]</span><span class="op" id="4101962">.</span><span class="ident" id="4101963">bbb</span>&nbsp;<span class="op" id="4101967">=</span>&nbsp;<span class="ident" id="4101969">nat</span><span class="op" id="4101972">(</span><span class="builtintype" id="4101973">nil</span><span class="op" id="4101976">)</span><span class="op" id="4101977">.</span><span class="ident" id="4101978">expWW</span><span class="op" id="4101983">(</span><span class="ident" id="4101984">bb</span><span class="op" id="4101986">,</span>&nbsp;<span class="ident" id="4101988">Word</span><span class="op" id="4101992">(</span><span class="ident" id="4101993">leafSize</span><span class="op" id="4102001">)</span><span class="op" id="4102002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102009">table</span><span class="op" id="4102014">[</span><span class="num" id="4102015">0</span><span class="op" id="4102016">]</span><span class="op" id="4102017">.</span><span class="ident" id="4102018">ndigits</span>&nbsp;<span class="op" id="4102026">=</span>&nbsp;<span class="ident" id="4102028">ndigits</span>&nbsp;<span class="op" id="4102036">*</span>&nbsp;<span class="ident" id="4102038">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102051">}</span>&nbsp;<span class="keyword" id="4102053">else</span>&nbsp;<span class="op" id="4102058">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102065">table</span><span class="op" id="4102070">[</span><span class="ident" id="4102071">i</span><span class="op" id="4102072">]</span><span class="op" id="4102073">.</span><span class="ident" id="4102074">bbb</span>&nbsp;<span class="op" id="4102078">=</span>&nbsp;<span class="ident" id="4102080">nat</span><span class="op" id="4102083">(</span><span class="builtintype" id="4102084">nil</span><span class="op" id="4102087">)</span><span class="op" id="4102088">.</span><span class="ident" id="4102089">mul</span><span class="op" id="4102092">(</span><span class="ident" id="4102093">table</span><span class="op" id="4102098">[</span><span class="ident" id="4102099">i</span><span class="op" id="4102100">-</span><span class="num" id="4102101">1</span><span class="op" id="4102102">]</span><span class="op" id="4102103">.</span><span class="ident" id="4102104">bbb</span><span class="op" id="4102107">,</span>&nbsp;<span class="ident" id="4102109">table</span><span class="op" id="4102114">[</span><span class="ident" id="4102115">i</span><span class="op" id="4102116">-</span><span class="num" id="4102117">1</span><span class="op" id="4102118">]</span><span class="op" id="4102119">.</span><span class="ident" id="4102120">bbb</span><span class="op" id="4102123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102130">table</span><span class="op" id="4102135">[</span><span class="ident" id="4102136">i</span><span class="op" id="4102137">]</span><span class="op" id="4102138">.</span><span class="ident" id="4102139">ndigits</span>&nbsp;<span class="op" id="4102147">=</span>&nbsp;<span class="num" id="4102149">2</span>&nbsp;<span class="op" id="4102151">*</span>&nbsp;<span class="ident" id="4102153">table</span><span class="op" id="4102158">[</span><span class="ident" id="4102159">i</span><span class="op" id="4102160">-</span><span class="num" id="4102161">1</span><span class="op" id="4102162">]</span><span class="op" id="4102163">.</span><span class="ident" id="4102164">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4102183">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102250">larger</span>&nbsp;<span class="op" id="4102257">=</span>&nbsp;<span class="ident" id="4102259">nat</span><span class="op" id="4102262">(</span><span class="builtintype" id="4102263">nil</span><span class="op" id="4102266">)</span><span class="op" id="4102267">.</span><span class="ident" id="4102268">set</span><span class="op" id="4102271">(</span><span class="ident" id="4102272">table</span><span class="op" id="4102277">[</span><span class="ident" id="4102278">i</span><span class="op" id="4102279">]</span><span class="op" id="4102280">.</span><span class="ident" id="4102281">bbb</span><span class="op" id="4102284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4102290">for</span>&nbsp;<span class="ident" id="4102294">mulAddVWW</span><span class="op" id="4102303">(</span><span class="ident" id="4102304">larger</span><span class="op" id="4102310">,</span>&nbsp;<span class="ident" id="4102312">larger</span><span class="op" id="4102318">,</span>&nbsp;<span class="ident" id="4102320">b</span><span class="op" id="4102321">,</span>&nbsp;<span class="num" id="4102323">0</span><span class="op" id="4102324">)</span>&nbsp;<span class="op" id="4102326">==</span>&nbsp;<span class="num" id="4102329">0</span>&nbsp;<span class="op" id="4102331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102338">table</span><span class="op" id="4102343">[</span><span class="ident" id="4102344">i</span><span class="op" id="4102345">]</span><span class="op" id="4102346">.</span><span class="ident" id="4102347">bbb</span>&nbsp;<span class="op" id="4102351">=</span>&nbsp;<span class="ident" id="4102353">table</span><span class="op" id="4102358">[</span><span class="ident" id="4102359">i</span><span class="op" id="4102360">]</span><span class="op" id="4102361">.</span><span class="ident" id="4102362">bbb</span><span class="op" id="4102365">.</span><span class="ident" id="4102366">set</span><span class="op" id="4102369">(</span><span class="ident" id="4102370">larger</span><span class="op" id="4102376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102383">table</span><span class="op" id="4102388">[</span><span class="ident" id="4102389">i</span><span class="op" id="4102390">]</span><span class="op" id="4102391">.</span><span class="ident" id="4102392">ndigits</span><span class="op" id="4102399">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102406">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102413">table</span><span class="op" id="4102418">[</span><span class="ident" id="4102419">i</span><span class="op" id="4102420">]</span><span class="op" id="4102421">.</span><span class="ident" id="4102422">nbits</span>&nbsp;<span class="op" id="4102428">=</span>&nbsp;<span class="ident" id="4102430">table</span><span class="op" id="4102435">[</span><span class="ident" id="4102436">i</span><span class="op" id="4102437">]</span><span class="op" id="4102438">.</span><span class="ident" id="4102439">bbb</span><span class="op" id="4102442">.</span><span class="ident" id="4102443">bitLen</span><span class="op" id="4102449">(</span><span class="op" id="4102450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102462">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4102466">if</span>&nbsp;<span class="ident" id="4102469">b</span>&nbsp;<span class="op" id="4102471">==</span>&nbsp;<span class="num" id="4102474">10</span>&nbsp;<span class="op" id="4102477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4102481">cacheBase10</span><span class="op" id="4102492">.</span><span class="ident" id="4102493">Unlock</span><span class="op" id="4102499">(</span><span class="op" id="4102500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4102503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4102507">return</span>&nbsp;<span class="ident" id="4102514">table</span><br>
<span class="lineno"></span><span class="op" id="4102520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4102523">const</span>&nbsp;<span class="ident" id="4102529">deBruijn32</span>&nbsp;<span class="op" id="4102540">=</span>&nbsp;<span class="num" id="4102542">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="4102554">var</span>&nbsp;<span class="ident" id="4102558">deBruijn32Lookup</span>&nbsp;<span class="op" id="4102575">=</span>&nbsp;<span class="op" id="4102577">[</span><span class="op" id="4102578">]</span><span class="builtintype" id="4102579">byte</span><span class="op" id="4102583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102586">0</span><span class="op" id="4102587">,</span>&nbsp;<span class="num" id="4102589">1</span><span class="op" id="4102590">,</span>&nbsp;<span class="num" id="4102592">28</span><span class="op" id="4102594">,</span>&nbsp;<span class="num" id="4102596">2</span><span class="op" id="4102597">,</span>&nbsp;<span class="num" id="4102599">29</span><span class="op" id="4102601">,</span>&nbsp;<span class="num" id="4102603">14</span><span class="op" id="4102605">,</span>&nbsp;<span class="num" id="4102607">24</span><span class="op" id="4102609">,</span>&nbsp;<span class="num" id="4102611">3</span><span class="op" id="4102612">,</span>&nbsp;<span class="num" id="4102614">30</span><span class="op" id="4102616">,</span>&nbsp;<span class="num" id="4102618">22</span><span class="op" id="4102620">,</span>&nbsp;<span class="num" id="4102622">20</span><span class="op" id="4102624">,</span>&nbsp;<span class="num" id="4102626">15</span><span class="op" id="4102628">,</span>&nbsp;<span class="num" id="4102630">25</span><span class="op" id="4102632">,</span>&nbsp;<span class="num" id="4102634">17</span><span class="op" id="4102636">,</span>&nbsp;<span class="num" id="4102638">4</span><span class="op" id="4102639">,</span>&nbsp;<span class="num" id="4102641">8</span><span class="op" id="4102642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102645">31</span><span class="op" id="4102647">,</span>&nbsp;<span class="num" id="4102649">27</span><span class="op" id="4102651">,</span>&nbsp;<span class="num" id="4102653">13</span><span class="op" id="4102655">,</span>&nbsp;<span class="num" id="4102657">23</span><span class="op" id="4102659">,</span>&nbsp;<span class="num" id="4102661">21</span><span class="op" id="4102663">,</span>&nbsp;<span class="num" id="4102665">19</span><span class="op" id="4102667">,</span>&nbsp;<span class="num" id="4102669">16</span><span class="op" id="4102671">,</span>&nbsp;<span class="num" id="4102673">7</span><span class="op" id="4102674">,</span>&nbsp;<span class="num" id="4102676">26</span><span class="op" id="4102678">,</span>&nbsp;<span class="num" id="4102680">12</span><span class="op" id="4102682">,</span>&nbsp;<span class="num" id="4102684">18</span><span class="op" id="4102686">,</span>&nbsp;<span class="num" id="4102688">6</span><span class="op" id="4102689">,</span>&nbsp;<span class="num" id="4102691">11</span><span class="op" id="4102693">,</span>&nbsp;<span class="num" id="4102695">5</span><span class="op" id="4102696">,</span>&nbsp;<span class="num" id="4102698">10</span><span class="op" id="4102700">,</span>&nbsp;<span class="num" id="4102702">9</span><span class="op" id="4102703">,</span><br>
<span class="lineno"></span><span class="op" id="4102705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="4102708">const</span>&nbsp;<span class="ident" id="4102714">deBruijn64</span>&nbsp;<span class="op" id="4102725">=</span>&nbsp;<span class="num" id="4102727">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4102747">var</span>&nbsp;<span class="ident" id="4102751">deBruijn64Lookup</span>&nbsp;<span class="op" id="4102768">=</span>&nbsp;<span class="op" id="4102770">[</span><span class="op" id="4102771">]</span><span class="builtintype" id="4102772">byte</span><span class="op" id="4102776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102779">0</span><span class="op" id="4102780">,</span>&nbsp;<span class="num" id="4102782">1</span><span class="op" id="4102783">,</span>&nbsp;<span class="num" id="4102785">56</span><span class="op" id="4102787">,</span>&nbsp;<span class="num" id="4102789">2</span><span class="op" id="4102790">,</span>&nbsp;<span class="num" id="4102792">57</span><span class="op" id="4102794">,</span>&nbsp;<span class="num" id="4102796">49</span><span class="op" id="4102798">,</span>&nbsp;<span class="num" id="4102800">28</span><span class="op" id="4102802">,</span>&nbsp;<span class="num" id="4102804">3</span><span class="op" id="4102805">,</span>&nbsp;<span class="num" id="4102807">61</span><span class="op" id="4102809">,</span>&nbsp;<span class="num" id="4102811">58</span><span class="op" id="4102813">,</span>&nbsp;<span class="num" id="4102815">42</span><span class="op" id="4102817">,</span>&nbsp;<span class="num" id="4102819">50</span><span class="op" id="4102821">,</span>&nbsp;<span class="num" id="4102823">38</span><span class="op" id="4102825">,</span>&nbsp;<span class="num" id="4102827">29</span><span class="op" id="4102829">,</span>&nbsp;<span class="num" id="4102831">17</span><span class="op" id="4102833">,</span>&nbsp;<span class="num" id="4102835">4</span><span class="op" id="4102836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102839">62</span><span class="op" id="4102841">,</span>&nbsp;<span class="num" id="4102843">47</span><span class="op" id="4102845">,</span>&nbsp;<span class="num" id="4102847">59</span><span class="op" id="4102849">,</span>&nbsp;<span class="num" id="4102851">36</span><span class="op" id="4102853">,</span>&nbsp;<span class="num" id="4102855">45</span><span class="op" id="4102857">,</span>&nbsp;<span class="num" id="4102859">43</span><span class="op" id="4102861">,</span>&nbsp;<span class="num" id="4102863">51</span><span class="op" id="4102865">,</span>&nbsp;<span class="num" id="4102867">22</span><span class="op" id="4102869">,</span>&nbsp;<span class="num" id="4102871">53</span><span class="op" id="4102873">,</span>&nbsp;<span class="num" id="4102875">39</span><span class="op" id="4102877">,</span>&nbsp;<span class="num" id="4102879">33</span><span class="op" id="4102881">,</span>&nbsp;<span class="num" id="4102883">30</span><span class="op" id="4102885">,</span>&nbsp;<span class="num" id="4102887">24</span><span class="op" id="4102889">,</span>&nbsp;<span class="num" id="4102891">18</span><span class="op" id="4102893">,</span>&nbsp;<span class="num" id="4102895">12</span><span class="op" id="4102897">,</span>&nbsp;<span class="num" id="4102899">5</span><span class="op" id="4102900">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102903">63</span><span class="op" id="4102905">,</span>&nbsp;<span class="num" id="4102907">55</span><span class="op" id="4102909">,</span>&nbsp;<span class="num" id="4102911">48</span><span class="op" id="4102913">,</span>&nbsp;<span class="num" id="4102915">27</span><span class="op" id="4102917">,</span>&nbsp;<span class="num" id="4102919">60</span><span class="op" id="4102921">,</span>&nbsp;<span class="num" id="4102923">41</span><span class="op" id="4102925">,</span>&nbsp;<span class="num" id="4102927">37</span><span class="op" id="4102929">,</span>&nbsp;<span class="num" id="4102931">16</span><span class="op" id="4102933">,</span>&nbsp;<span class="num" id="4102935">46</span><span class="op" id="4102937">,</span>&nbsp;<span class="num" id="4102939">35</span><span class="op" id="4102941">,</span>&nbsp;<span class="num" id="4102943">44</span><span class="op" id="4102945">,</span>&nbsp;<span class="num" id="4102947">21</span><span class="op" id="4102949">,</span>&nbsp;<span class="num" id="4102951">52</span><span class="op" id="4102953">,</span>&nbsp;<span class="num" id="4102955">32</span><span class="op" id="4102957">,</span>&nbsp;<span class="num" id="4102959">23</span><span class="op" id="4102961">,</span>&nbsp;<span class="num" id="4102963">11</span><span class="op" id="4102965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4102968">54</span><span class="op" id="4102970">,</span>&nbsp;<span class="num" id="4102972">26</span><span class="op" id="4102974">,</span>&nbsp;<span class="num" id="4102976">40</span><span class="op" id="4102978">,</span>&nbsp;<span class="num" id="4102980">15</span><span class="op" id="4102982">,</span>&nbsp;<span class="num" id="4102984">34</span><span class="op" id="4102986">,</span>&nbsp;<span class="num" id="4102988">20</span><span class="op" id="4102990">,</span>&nbsp;<span class="num" id="4102992">31</span><span class="op" id="4102994">,</span>&nbsp;<span class="num" id="4102996">10</span><span class="op" id="4102998">,</span>&nbsp;<span class="num" id="4103000">25</span><span class="op" id="4103002">,</span>&nbsp;<span class="num" id="4103004">14</span><span class="op" id="4103006">,</span>&nbsp;<span class="num" id="4103008">19</span><span class="op" id="4103010">,</span>&nbsp;<span class="num" id="4103012">9</span><span class="op" id="4103013">,</span>&nbsp;<span class="num" id="4103015">13</span><span class="op" id="4103017">,</span>&nbsp;<span class="num" id="4103019">8</span><span class="op" id="4103020">,</span>&nbsp;<span class="num" id="4103022">7</span><span class="op" id="4103023">,</span>&nbsp;<span class="num" id="4103025">6</span><span class="op" id="4103026">,</span><br>
<span class="lineno"></span><span class="op" id="4103028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4103031">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="4103108">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4103122">func</span>&nbsp;<span class="ident" id="4103127">trailingZeroBits</span><span class="op" id="4103143">(</span><span class="ident" id="4103144">x</span>&nbsp;<span class="ident" id="4103146">Word</span><span class="op" id="4103150">)</span>&nbsp;<span class="builtintype" id="4103152">uint</span>&nbsp;<span class="op" id="4103157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103160">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103232">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103304">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103374">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103444">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103508">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103581">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103650">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4103697">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103734">switch</span>&nbsp;<span class="ident" id="4103741">_W</span>&nbsp;<span class="op" id="4103744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103747">case</span>&nbsp;<span class="num" id="4103752">32</span><span class="op" id="4103754">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103758">return</span>&nbsp;<span class="builtintype" id="4103765">uint</span><span class="op" id="4103769">(</span><span class="ident" id="4103770">deBruijn32Lookup</span><span class="op" id="4103786">[</span><span class="op" id="4103787">(</span><span class="op" id="4103788">(</span><span class="ident" id="4103789">x</span><span class="op" id="4103790">&amp;</span><span class="op" id="4103791">-</span><span class="ident" id="4103792">x</span><span class="op" id="4103793">)</span><span class="op" id="4103794">*</span><span class="ident" id="4103795">deBruijn32</span><span class="op" id="4103805">)</span><span class="op" id="4103806">&gt;&gt;</span><span class="num" id="4103808">27</span><span class="op" id="4103810">]</span><span class="op" id="4103811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103814">case</span>&nbsp;<span class="num" id="4103819">64</span><span class="op" id="4103821">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103825">return</span>&nbsp;<span class="builtintype" id="4103832">uint</span><span class="op" id="4103836">(</span><span class="ident" id="4103837">deBruijn64Lookup</span><span class="op" id="4103853">[</span><span class="op" id="4103854">(</span><span class="op" id="4103855">(</span><span class="ident" id="4103856">x</span><span class="op" id="4103857">&amp;</span><span class="op" id="4103858">-</span><span class="ident" id="4103859">x</span><span class="op" id="4103860">)</span><span class="op" id="4103861">*</span><span class="op" id="4103862">(</span><span class="ident" id="4103863">deBruijn64</span><span class="op" id="4103873">&amp;</span><span class="ident" id="4103874">_M</span><span class="op" id="4103876">)</span><span class="op" id="4103877">)</span><span class="op" id="4103878">&gt;&gt;</span><span class="num" id="4103880">58</span><span class="op" id="4103882">]</span><span class="op" id="4103883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4103886">default</span><span class="op" id="4103893">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4103897">panic</span><span class="op" id="4103902">(</span><span class="string" id="4103903">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4103922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4103925">}</span><br>
<span class="lineno"></span><span class="op" id="4103927">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="4103930">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4104007">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="4104021">func</span>&nbsp;<span class="op" id="4104026">(</span><span class="ident" id="4104027">x</span>&nbsp;<span class="ident" id="4104029">nat</span><span class="op" id="4104032">)</span>&nbsp;<span class="ident" id="4104034">trailingZeroBits</span><span class="op" id="4104050">(</span><span class="op" id="4104051">)</span>&nbsp;<span class="builtintype" id="4104053">uint</span>&nbsp;<span class="op" id="4104058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104061">if</span>&nbsp;<span class="builtinfunc" id="4104064">len</span><span class="op" id="4104067">(</span><span class="ident" id="4104068">x</span><span class="op" id="4104069">)</span>&nbsp;<span class="op" id="4104071">==</span>&nbsp;<span class="num" id="4104074">0</span>&nbsp;<span class="op" id="4104076">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104080">return</span>&nbsp;<span class="num" id="4104087">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104093">var</span>&nbsp;<span class="ident" id="4104097">i</span>&nbsp;<span class="builtintype" id="4104099">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104105">for</span>&nbsp;<span class="ident" id="4104109">x</span><span class="op" id="4104110">[</span><span class="ident" id="4104111">i</span><span class="op" id="4104112">]</span>&nbsp;<span class="op" id="4104114">==</span>&nbsp;<span class="num" id="4104117">0</span>&nbsp;<span class="op" id="4104119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104123">i</span><span class="op" id="4104124">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4104131">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104145">return</span>&nbsp;<span class="ident" id="4104152">i</span><span class="op" id="4104153">*</span><span class="ident" id="4104154">_W</span>&nbsp;<span class="op" id="4104157">+</span>&nbsp;<span class="ident" id="4104159">trailingZeroBits</span><span class="op" id="4104175">(</span><span class="ident" id="4104176">x</span><span class="op" id="4104177">[</span><span class="ident" id="4104178">i</span><span class="op" id="4104179">]</span><span class="op" id="4104180">)</span><br>
<span class="lineno"></span><span class="op" id="4104182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="4104185">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4104199">func</span>&nbsp;<span class="op" id="4104204">(</span><span class="ident" id="4104205">z</span>&nbsp;<span class="ident" id="4104207">nat</span><span class="op" id="4104210">)</span>&nbsp;<span class="ident" id="4104212">shl</span><span class="op" id="4104215">(</span><span class="ident" id="4104216">x</span>&nbsp;<span class="ident" id="4104218">nat</span><span class="op" id="4104221">,</span>&nbsp;<span class="ident" id="4104223">s</span>&nbsp;<span class="builtintype" id="4104225">uint</span><span class="op" id="4104229">)</span>&nbsp;<span class="ident" id="4104231">nat</span>&nbsp;<span class="op" id="4104235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104238">m</span>&nbsp;<span class="op" id="4104240">:=</span>&nbsp;<span class="builtinfunc" id="4104243">len</span><span class="op" id="4104246">(</span><span class="ident" id="4104247">x</span><span class="op" id="4104248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104251">if</span>&nbsp;<span class="ident" id="4104254">m</span>&nbsp;<span class="op" id="4104256">==</span>&nbsp;<span class="num" id="4104259">0</span>&nbsp;<span class="op" id="4104261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104265">return</span>&nbsp;<span class="ident" id="4104272">z</span><span class="op" id="4104273">.</span><span class="builtinfunc" id="4104274">make</span><span class="op" id="4104278">(</span><span class="num" id="4104279">0</span><span class="op" id="4104280">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4104286">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104297">n</span>&nbsp;<span class="op" id="4104299">:=</span>&nbsp;<span class="ident" id="4104302">m</span>&nbsp;<span class="op" id="4104304">+</span>&nbsp;<span class="builtintype" id="4104306">int</span><span class="op" id="4104309">(</span><span class="ident" id="4104310">s</span><span class="op" id="4104311">/</span><span class="ident" id="4104312">_W</span><span class="op" id="4104314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104317">z</span>&nbsp;<span class="op" id="4104319">=</span>&nbsp;<span class="ident" id="4104321">z</span><span class="op" id="4104322">.</span><span class="builtinfunc" id="4104323">make</span><span class="op" id="4104327">(</span><span class="ident" id="4104328">n</span>&nbsp;<span class="op" id="4104330">+</span>&nbsp;<span class="num" id="4104332">1</span><span class="op" id="4104333">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104336">z</span><span class="op" id="4104337">[</span><span class="ident" id="4104338">n</span><span class="op" id="4104339">]</span>&nbsp;<span class="op" id="4104341">=</span>&nbsp;<span class="ident" id="4104343">shlVU</span><span class="op" id="4104348">(</span><span class="ident" id="4104349">z</span><span class="op" id="4104350">[</span><span class="ident" id="4104351">n</span><span class="op" id="4104352">-</span><span class="ident" id="4104353">m</span><span class="op" id="4104354">:</span><span class="ident" id="4104355">n</span><span class="op" id="4104356">]</span><span class="op" id="4104357">,</span>&nbsp;<span class="ident" id="4104359">x</span><span class="op" id="4104360">,</span>&nbsp;<span class="ident" id="4104362">s</span><span class="op" id="4104363">%</span><span class="ident" id="4104364">_W</span><span class="op" id="4104366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104369">z</span><span class="op" id="4104370">[</span><span class="num" id="4104371">0</span>&nbsp;<span class="op" id="4104373">:</span>&nbsp;<span class="ident" id="4104375">n</span><span class="op" id="4104376">-</span><span class="ident" id="4104377">m</span><span class="op" id="4104378">]</span><span class="op" id="4104379">.</span><span class="ident" id="4104380">clear</span><span class="op" id="4104385">(</span><span class="op" id="4104386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104390">return</span>&nbsp;<span class="ident" id="4104397">z</span><span class="op" id="4104398">.</span><span class="ident" id="4104399">norm</span><span class="op" id="4104403">(</span><span class="op" id="4104404">)</span><br>
<span class="lineno"></span><span class="op" id="4104406">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="4104409">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="4104423">func</span>&nbsp;<span class="op" id="4104428">(</span><span class="ident" id="4104429">z</span>&nbsp;<span class="ident" id="4104431">nat</span><span class="op" id="4104434">)</span>&nbsp;<span class="ident" id="4104436">shr</span><span class="op" id="4104439">(</span><span class="ident" id="4104440">x</span>&nbsp;<span class="ident" id="4104442">nat</span><span class="op" id="4104445">,</span>&nbsp;<span class="ident" id="4104447">s</span>&nbsp;<span class="builtintype" id="4104449">uint</span><span class="op" id="4104453">)</span>&nbsp;<span class="ident" id="4104455">nat</span>&nbsp;<span class="op" id="4104459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104462">m</span>&nbsp;<span class="op" id="4104464">:=</span>&nbsp;<span class="builtinfunc" id="4104467">len</span><span class="op" id="4104470">(</span><span class="ident" id="4104471">x</span><span class="op" id="4104472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104475">n</span>&nbsp;<span class="op" id="4104477">:=</span>&nbsp;<span class="ident" id="4104480">m</span>&nbsp;<span class="op" id="4104482">-</span>&nbsp;<span class="builtintype" id="4104484">int</span><span class="op" id="4104487">(</span><span class="ident" id="4104488">s</span><span class="op" id="4104489">/</span><span class="ident" id="4104490">_W</span><span class="op" id="4104492">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104495">if</span>&nbsp;<span class="ident" id="4104498">n</span>&nbsp;<span class="op" id="4104500">&lt;=</span>&nbsp;<span class="num" id="4104503">0</span>&nbsp;<span class="op" id="4104505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104509">return</span>&nbsp;<span class="ident" id="4104516">z</span><span class="op" id="4104517">.</span><span class="builtinfunc" id="4104518">make</span><span class="op" id="4104522">(</span><span class="num" id="4104523">0</span><span class="op" id="4104524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4104530">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104541">z</span>&nbsp;<span class="op" id="4104543">=</span>&nbsp;<span class="ident" id="4104545">z</span><span class="op" id="4104546">.</span><span class="builtinfunc" id="4104547">make</span><span class="op" id="4104551">(</span><span class="ident" id="4104552">n</span><span class="op" id="4104553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104556">shrVU</span><span class="op" id="4104561">(</span><span class="ident" id="4104562">z</span><span class="op" id="4104563">,</span>&nbsp;<span class="ident" id="4104565">x</span><span class="op" id="4104566">[</span><span class="ident" id="4104567">m</span><span class="op" id="4104568">-</span><span class="ident" id="4104569">n</span><span class="op" id="4104570">:</span><span class="op" id="4104571">]</span><span class="op" id="4104572">,</span>&nbsp;<span class="ident" id="4104574">s</span><span class="op" id="4104575">%</span><span class="ident" id="4104576">_W</span><span class="op" id="4104578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104582">return</span>&nbsp;<span class="ident" id="4104589">z</span><span class="op" id="4104590">.</span><span class="ident" id="4104591">norm</span><span class="op" id="4104595">(</span><span class="op" id="4104596">)</span><br>
<span class="lineno"></span><span class="op" id="4104598">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="4104601">func</span>&nbsp;<span class="op" id="4104606">(</span><span class="ident" id="4104607">z</span>&nbsp;<span class="ident" id="4104609">nat</span><span class="op" id="4104612">)</span>&nbsp;<span class="ident" id="4104614">setBit</span><span class="op" id="4104620">(</span><span class="ident" id="4104621">x</span>&nbsp;<span class="ident" id="4104623">nat</span><span class="op" id="4104626">,</span>&nbsp;<span class="ident" id="4104628">i</span>&nbsp;<span class="builtintype" id="4104630">uint</span><span class="op" id="4104634">,</span>&nbsp;<span class="ident" id="4104636">b</span>&nbsp;<span class="builtintype" id="4104638">uint</span><span class="op" id="4104642">)</span>&nbsp;<span class="ident" id="4104644">nat</span>&nbsp;<span class="op" id="4104648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104651">j</span>&nbsp;<span class="op" id="4104653">:=</span>&nbsp;<span class="builtintype" id="4104656">int</span><span class="op" id="4104659">(</span><span class="ident" id="4104660">i</span>&nbsp;<span class="op" id="4104662">/</span>&nbsp;<span class="ident" id="4104664">_W</span><span class="op" id="4104666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104669">m</span>&nbsp;<span class="op" id="4104671">:=</span>&nbsp;<span class="ident" id="4104674">Word</span><span class="op" id="4104678">(</span><span class="num" id="4104679">1</span><span class="op" id="4104680">)</span>&nbsp;<span class="op" id="4104682">&lt;&lt;</span>&nbsp;<span class="op" id="4104685">(</span><span class="ident" id="4104686">i</span>&nbsp;<span class="op" id="4104688">%</span>&nbsp;<span class="ident" id="4104690">_W</span><span class="op" id="4104692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104695">n</span>&nbsp;<span class="op" id="4104697">:=</span>&nbsp;<span class="builtinfunc" id="4104700">len</span><span class="op" id="4104703">(</span><span class="ident" id="4104704">x</span><span class="op" id="4104705">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104708">switch</span>&nbsp;<span class="ident" id="4104715">b</span>&nbsp;<span class="op" id="4104717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104720">case</span>&nbsp;<span class="num" id="4104725">0</span><span class="op" id="4104726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104730">z</span>&nbsp;<span class="op" id="4104732">=</span>&nbsp;<span class="ident" id="4104734">z</span><span class="op" id="4104735">.</span><span class="builtinfunc" id="4104736">make</span><span class="op" id="4104740">(</span><span class="ident" id="4104741">n</span><span class="op" id="4104742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4104746">copy</span><span class="op" id="4104750">(</span><span class="ident" id="4104751">z</span><span class="op" id="4104752">,</span>&nbsp;<span class="ident" id="4104754">x</span><span class="op" id="4104755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104759">if</span>&nbsp;<span class="ident" id="4104762">j</span>&nbsp;<span class="op" id="4104764">&gt;=</span>&nbsp;<span class="ident" id="4104767">n</span>&nbsp;<span class="op" id="4104769">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4104774">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104796">return</span>&nbsp;<span class="ident" id="4104803">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104811">z</span><span class="op" id="4104812">[</span><span class="ident" id="4104813">j</span><span class="op" id="4104814">]</span>&nbsp;<span class="op" id="4104816">&amp;^=</span>&nbsp;<span class="ident" id="4104820">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104824">return</span>&nbsp;<span class="ident" id="4104831">z</span><span class="op" id="4104832">.</span><span class="ident" id="4104833">norm</span><span class="op" id="4104837">(</span><span class="op" id="4104838">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104841">case</span>&nbsp;<span class="num" id="4104846">1</span><span class="op" id="4104847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104851">if</span>&nbsp;<span class="ident" id="4104854">j</span>&nbsp;<span class="op" id="4104856">&gt;=</span>&nbsp;<span class="ident" id="4104859">n</span>&nbsp;<span class="op" id="4104861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104866">z</span>&nbsp;<span class="op" id="4104868">=</span>&nbsp;<span class="ident" id="4104870">z</span><span class="op" id="4104871">.</span><span class="builtinfunc" id="4104872">make</span><span class="op" id="4104876">(</span><span class="ident" id="4104877">j</span>&nbsp;<span class="op" id="4104879">+</span>&nbsp;<span class="num" id="4104881">1</span><span class="op" id="4104882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104887">z</span><span class="op" id="4104888">[</span><span class="ident" id="4104889">n</span><span class="op" id="4104890">:</span><span class="op" id="4104891">]</span><span class="op" id="4104892">.</span><span class="ident" id="4104893">clear</span><span class="op" id="4104898">(</span><span class="op" id="4104899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104903">}</span>&nbsp;<span class="keyword" id="4104905">else</span>&nbsp;<span class="op" id="4104910">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104915">z</span>&nbsp;<span class="op" id="4104917">=</span>&nbsp;<span class="ident" id="4104919">z</span><span class="op" id="4104920">.</span><span class="builtinfunc" id="4104921">make</span><span class="op" id="4104925">(</span><span class="ident" id="4104926">n</span><span class="op" id="4104927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4104935">copy</span><span class="op" id="4104939">(</span><span class="ident" id="4104940">z</span><span class="op" id="4104941">,</span>&nbsp;<span class="ident" id="4104943">x</span><span class="op" id="4104944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4104948">z</span><span class="op" id="4104949">[</span><span class="ident" id="4104950">j</span><span class="op" id="4104951">]</span>&nbsp;<span class="op" id="4104953">|=</span>&nbsp;<span class="ident" id="4104956">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4104960">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4104986">return</span>&nbsp;<span class="ident" id="4104993">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4104996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4104999">panic</span><span class="op" id="4105004">(</span><span class="string" id="4105005">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="4105028">)</span><br>
<span class="lineno"></span><span class="op" id="4105030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="4105033">func</span>&nbsp;<span class="op" id="4105038">(</span><span class="ident" id="4105039">z</span>&nbsp;<span class="ident" id="4105041">nat</span><span class="op" id="4105044">)</span>&nbsp;<span class="ident" id="4105046">bit</span><span class="op" id="4105049">(</span><span class="ident" id="4105050">i</span>&nbsp;<span class="builtintype" id="4105052">uint</span><span class="op" id="4105056">)</span>&nbsp;<span class="builtintype" id="4105058">uint</span>&nbsp;<span class="op" id="4105063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105066">j</span>&nbsp;<span class="op" id="4105068">:=</span>&nbsp;<span class="builtintype" id="4105071">int</span><span class="op" id="4105074">(</span><span class="ident" id="4105075">i</span>&nbsp;<span class="op" id="4105077">/</span>&nbsp;<span class="ident" id="4105079">_W</span><span class="op" id="4105081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105084">if</span>&nbsp;<span class="ident" id="4105087">j</span>&nbsp;<span class="op" id="4105089">&gt;=</span>&nbsp;<span class="builtinfunc" id="4105092">len</span><span class="op" id="4105095">(</span><span class="ident" id="4105096">z</span><span class="op" id="4105097">)</span>&nbsp;<span class="op" id="4105099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105103">return</span>&nbsp;<span class="num" id="4105110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105113">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105116">return</span>&nbsp;<span class="builtintype" id="4105123">uint</span><span class="op" id="4105127">(</span><span class="ident" id="4105128">z</span><span class="op" id="4105129">[</span><span class="ident" id="4105130">j</span><span class="op" id="4105131">]</span>&nbsp;<span class="op" id="4105133">&gt;&gt;</span>&nbsp;<span class="op" id="4105136">(</span><span class="ident" id="4105137">i</span>&nbsp;<span class="op" id="4105139">%</span>&nbsp;<span class="ident" id="4105141">_W</span><span class="op" id="4105143">)</span>&nbsp;<span class="op" id="4105145">&amp;</span>&nbsp;<span class="num" id="4105147">1</span><span class="op" id="4105148">)</span><br>
<span class="lineno"></span><span class="op" id="4105150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4105153">func</span>&nbsp;<span class="op" id="4105158">(</span><span class="ident" id="4105159">z</span>&nbsp;<span class="ident" id="4105161">nat</span><span class="op" id="4105164">)</span>&nbsp;<span class="ident" id="4105166">and</span><span class="op" id="4105169">(</span><span class="ident" id="4105170">x</span><span class="op" id="4105171">,</span>&nbsp;<span class="ident" id="4105173">y</span>&nbsp;<span class="ident" id="4105175">nat</span><span class="op" id="4105178">)</span>&nbsp;<span class="ident" id="4105180">nat</span>&nbsp;<span class="op" id="4105184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105187">m</span>&nbsp;<span class="op" id="4105189">:=</span>&nbsp;<span class="builtinfunc" id="4105192">len</span><span class="op" id="4105195">(</span><span class="ident" id="4105196">x</span><span class="op" id="4105197">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105200">n</span>&nbsp;<span class="op" id="4105202">:=</span>&nbsp;<span class="builtinfunc" id="4105205">len</span><span class="op" id="4105208">(</span><span class="ident" id="4105209">y</span><span class="op" id="4105210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105213">if</span>&nbsp;<span class="ident" id="4105216">m</span>&nbsp;<span class="op" id="4105218">&gt;</span>&nbsp;<span class="ident" id="4105220">n</span>&nbsp;<span class="op" id="4105222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105226">m</span>&nbsp;<span class="op" id="4105228">=</span>&nbsp;<span class="ident" id="4105230">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4105236">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105248">z</span>&nbsp;<span class="op" id="4105250">=</span>&nbsp;<span class="ident" id="4105252">z</span><span class="op" id="4105253">.</span><span class="builtinfunc" id="4105254">make</span><span class="op" id="4105258">(</span><span class="ident" id="4105259">m</span><span class="op" id="4105260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105263">for</span>&nbsp;<span class="ident" id="4105267">i</span>&nbsp;<span class="op" id="4105269">:=</span>&nbsp;<span class="num" id="4105272">0</span><span class="op" id="4105273">;</span>&nbsp;<span class="ident" id="4105275">i</span>&nbsp;<span class="op" id="4105277">&lt;</span>&nbsp;<span class="ident" id="4105279">m</span><span class="op" id="4105280">;</span>&nbsp;<span class="ident" id="4105282">i</span><span class="op" id="4105283">++</span>&nbsp;<span class="op" id="4105286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105290">z</span><span class="op" id="4105291">[</span><span class="ident" id="4105292">i</span><span class="op" id="4105293">]</span>&nbsp;<span class="op" id="4105295">=</span>&nbsp;<span class="ident" id="4105297">x</span><span class="op" id="4105298">[</span><span class="ident" id="4105299">i</span><span class="op" id="4105300">]</span>&nbsp;<span class="op" id="4105302">&amp;</span>&nbsp;<span class="ident" id="4105304">y</span><span class="op" id="4105305">[</span><span class="ident" id="4105306">i</span><span class="op" id="4105307">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105310">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105314">return</span>&nbsp;<span class="ident" id="4105321">z</span><span class="op" id="4105322">.</span><span class="ident" id="4105323">norm</span><span class="op" id="4105327">(</span><span class="op" id="4105328">)</span><br>
<span class="lineno"></span><span class="op" id="4105330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4105333">func</span>&nbsp;<span class="op" id="4105338">(</span><span class="ident" id="4105339">z</span>&nbsp;<span class="ident" id="4105341">nat</span><span class="op" id="4105344">)</span>&nbsp;<span class="ident" id="4105346">andNot</span><span class="op" id="4105352">(</span><span class="ident" id="4105353">x</span><span class="op" id="4105354">,</span>&nbsp;<span class="ident" id="4105356">y</span>&nbsp;<span class="ident" id="4105358">nat</span><span class="op" id="4105361">)</span>&nbsp;<span class="ident" id="4105363">nat</span>&nbsp;<span class="op" id="4105367">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105370">m</span>&nbsp;<span class="op" id="4105372">:=</span>&nbsp;<span class="builtinfunc" id="4105375">len</span><span class="op" id="4105378">(</span><span class="ident" id="4105379">x</span><span class="op" id="4105380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105383">n</span>&nbsp;<span class="op" id="4105385">:=</span>&nbsp;<span class="builtinfunc" id="4105388">len</span><span class="op" id="4105391">(</span><span class="ident" id="4105392">y</span><span class="op" id="4105393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105396">if</span>&nbsp;<span class="ident" id="4105399">n</span>&nbsp;<span class="op" id="4105401">&gt;</span>&nbsp;<span class="ident" id="4105403">m</span>&nbsp;<span class="op" id="4105405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105409">n</span>&nbsp;<span class="op" id="4105411">=</span>&nbsp;<span class="ident" id="4105413">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105416">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4105419">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105431">z</span>&nbsp;<span class="op" id="4105433">=</span>&nbsp;<span class="ident" id="4105435">z</span><span class="op" id="4105436">.</span><span class="builtinfunc" id="4105437">make</span><span class="op" id="4105441">(</span><span class="ident" id="4105442">m</span><span class="op" id="4105443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105446">for</span>&nbsp;<span class="ident" id="4105450">i</span>&nbsp;<span class="op" id="4105452">:=</span>&nbsp;<span class="num" id="4105455">0</span><span class="op" id="4105456">;</span>&nbsp;<span class="ident" id="4105458">i</span>&nbsp;<span class="op" id="4105460">&lt;</span>&nbsp;<span class="ident" id="4105462">n</span><span class="op" id="4105463">;</span>&nbsp;<span class="ident" id="4105465">i</span><span class="op" id="4105466">++</span>&nbsp;<span class="op" id="4105469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105473">z</span><span class="op" id="4105474">[</span><span class="ident" id="4105475">i</span><span class="op" id="4105476">]</span>&nbsp;<span class="op" id="4105478">=</span>&nbsp;<span class="ident" id="4105480">x</span><span class="op" id="4105481">[</span><span class="ident" id="4105482">i</span><span class="op" id="4105483">]</span>&nbsp;<span class="op" id="4105485">&amp;^</span>&nbsp;<span class="ident" id="4105488">y</span><span class="op" id="4105489">[</span><span class="ident" id="4105490">i</span><span class="op" id="4105491">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4105497">copy</span><span class="op" id="4105501">(</span><span class="ident" id="4105502">z</span><span class="op" id="4105503">[</span><span class="ident" id="4105504">n</span><span class="op" id="4105505">:</span><span class="ident" id="4105506">m</span><span class="op" id="4105507">]</span><span class="op" id="4105508">,</span>&nbsp;<span class="ident" id="4105510">x</span><span class="op" id="4105511">[</span><span class="ident" id="4105512">n</span><span class="op" id="4105513">:</span><span class="ident" id="4105514">m</span><span class="op" id="4105515">]</span><span class="op" id="4105516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105520">return</span>&nbsp;<span class="ident" id="4105527">z</span><span class="op" id="4105528">.</span><span class="ident" id="4105529">norm</span><span class="op" id="4105533">(</span><span class="op" id="4105534">)</span><br>
<span class="lineno"></span><span class="op" id="4105536">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="4105539">func</span>&nbsp;<span class="op" id="4105544">(</span><span class="ident" id="4105545">z</span>&nbsp;<span class="ident" id="4105547">nat</span><span class="op" id="4105550">)</span>&nbsp;<span class="ident" id="4105552">or</span><span class="op" id="4105554">(</span><span class="ident" id="4105555">x</span><span class="op" id="4105556">,</span>&nbsp;<span class="ident" id="4105558">y</span>&nbsp;<span class="ident" id="4105560">nat</span><span class="op" id="4105563">)</span>&nbsp;<span class="ident" id="4105565">nat</span>&nbsp;<span class="op" id="4105569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105572">m</span>&nbsp;<span class="op" id="4105574">:=</span>&nbsp;<span class="builtinfunc" id="4105577">len</span><span class="op" id="4105580">(</span><span class="ident" id="4105581">x</span><span class="op" id="4105582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105585">n</span>&nbsp;<span class="op" id="4105587">:=</span>&nbsp;<span class="builtinfunc" id="4105590">len</span><span class="op" id="4105593">(</span><span class="ident" id="4105594">y</span><span class="op" id="4105595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105598">s</span>&nbsp;<span class="op" id="4105600">:=</span>&nbsp;<span class="ident" id="4105603">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105606">if</span>&nbsp;<span class="ident" id="4105609">m</span>&nbsp;<span class="op" id="4105611">&lt;</span>&nbsp;<span class="ident" id="4105613">n</span>&nbsp;<span class="op" id="4105615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105619">n</span><span class="op" id="4105620">,</span>&nbsp;<span class="ident" id="4105622">m</span>&nbsp;<span class="op" id="4105624">=</span>&nbsp;<span class="ident" id="4105626">m</span><span class="op" id="4105627">,</span>&nbsp;<span class="ident" id="4105629">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105633">s</span>&nbsp;<span class="op" id="4105635">=</span>&nbsp;<span class="ident" id="4105637">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4105643">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105655">z</span>&nbsp;<span class="op" id="4105657">=</span>&nbsp;<span class="ident" id="4105659">z</span><span class="op" id="4105660">.</span><span class="builtinfunc" id="4105661">make</span><span class="op" id="4105665">(</span><span class="ident" id="4105666">m</span><span class="op" id="4105667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105670">for</span>&nbsp;<span class="ident" id="4105674">i</span>&nbsp;<span class="op" id="4105676">:=</span>&nbsp;<span class="num" id="4105679">0</span><span class="op" id="4105680">;</span>&nbsp;<span class="ident" id="4105682">i</span>&nbsp;<span class="op" id="4105684">&lt;</span>&nbsp;<span class="ident" id="4105686">n</span><span class="op" id="4105687">;</span>&nbsp;<span class="ident" id="4105689">i</span><span class="op" id="4105690">++</span>&nbsp;<span class="op" id="4105693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105697">z</span><span class="op" id="4105698">[</span><span class="ident" id="4105699">i</span><span class="op" id="4105700">]</span>&nbsp;<span class="op" id="4105702">=</span>&nbsp;<span class="ident" id="4105704">x</span><span class="op" id="4105705">[</span><span class="ident" id="4105706">i</span><span class="op" id="4105707">]</span>&nbsp;<span class="op" id="4105709">|</span>&nbsp;<span class="ident" id="4105711">y</span><span class="op" id="4105712">[</span><span class="ident" id="4105713">i</span><span class="op" id="4105714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105717">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4105720">copy</span><span class="op" id="4105724">(</span><span class="ident" id="4105725">z</span><span class="op" id="4105726">[</span><span class="ident" id="4105727">n</span><span class="op" id="4105728">:</span><span class="ident" id="4105729">m</span><span class="op" id="4105730">]</span><span class="op" id="4105731">,</span>&nbsp;<span class="ident" id="4105733">s</span><span class="op" id="4105734">[</span><span class="ident" id="4105735">n</span><span class="op" id="4105736">:</span><span class="ident" id="4105737">m</span><span class="op" id="4105738">]</span><span class="op" id="4105739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105743">return</span>&nbsp;<span class="ident" id="4105750">z</span><span class="op" id="4105751">.</span><span class="ident" id="4105752">norm</span><span class="op" id="4105756">(</span><span class="op" id="4105757">)</span><br>
<span class="lineno"></span><span class="op" id="4105759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="4105762">func</span>&nbsp;<span class="op" id="4105767">(</span><span class="ident" id="4105768">z</span>&nbsp;<span class="ident" id="4105770">nat</span><span class="op" id="4105773">)</span>&nbsp;<span class="ident" id="4105775">xor</span><span class="op" id="4105778">(</span><span class="ident" id="4105779">x</span><span class="op" id="4105780">,</span>&nbsp;<span class="ident" id="4105782">y</span>&nbsp;<span class="ident" id="4105784">nat</span><span class="op" id="4105787">)</span>&nbsp;<span class="ident" id="4105789">nat</span>&nbsp;<span class="op" id="4105793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105796">m</span>&nbsp;<span class="op" id="4105798">:=</span>&nbsp;<span class="builtinfunc" id="4105801">len</span><span class="op" id="4105804">(</span><span class="ident" id="4105805">x</span><span class="op" id="4105806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105809">n</span>&nbsp;<span class="op" id="4105811">:=</span>&nbsp;<span class="builtinfunc" id="4105814">len</span><span class="op" id="4105817">(</span><span class="ident" id="4105818">y</span><span class="op" id="4105819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105822">s</span>&nbsp;<span class="op" id="4105824">:=</span>&nbsp;<span class="ident" id="4105827">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105830">if</span>&nbsp;<span class="ident" id="4105833">m</span>&nbsp;<span class="op" id="4105835">&lt;</span>&nbsp;<span class="ident" id="4105837">n</span>&nbsp;<span class="op" id="4105839">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105843">n</span><span class="op" id="4105844">,</span>&nbsp;<span class="ident" id="4105846">m</span>&nbsp;<span class="op" id="4105848">=</span>&nbsp;<span class="ident" id="4105850">m</span><span class="op" id="4105851">,</span>&nbsp;<span class="ident" id="4105853">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105857">s</span>&nbsp;<span class="op" id="4105859">=</span>&nbsp;<span class="ident" id="4105861">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4105867">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105879">z</span>&nbsp;<span class="op" id="4105881">=</span>&nbsp;<span class="ident" id="4105883">z</span><span class="op" id="4105884">.</span><span class="builtinfunc" id="4105885">make</span><span class="op" id="4105889">(</span><span class="ident" id="4105890">m</span><span class="op" id="4105891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105894">for</span>&nbsp;<span class="ident" id="4105898">i</span>&nbsp;<span class="op" id="4105900">:=</span>&nbsp;<span class="num" id="4105903">0</span><span class="op" id="4105904">;</span>&nbsp;<span class="ident" id="4105906">i</span>&nbsp;<span class="op" id="4105908">&lt;</span>&nbsp;<span class="ident" id="4105910">n</span><span class="op" id="4105911">;</span>&nbsp;<span class="ident" id="4105913">i</span><span class="op" id="4105914">++</span>&nbsp;<span class="op" id="4105917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4105921">z</span><span class="op" id="4105922">[</span><span class="ident" id="4105923">i</span><span class="op" id="4105924">]</span>&nbsp;<span class="op" id="4105926">=</span>&nbsp;<span class="ident" id="4105928">x</span><span class="op" id="4105929">[</span><span class="ident" id="4105930">i</span><span class="op" id="4105931">]</span>&nbsp;<span class="op" id="4105933">^</span>&nbsp;<span class="ident" id="4105935">y</span><span class="op" id="4105936">[</span><span class="ident" id="4105937">i</span><span class="op" id="4105938">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4105941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4105944">copy</span><span class="op" id="4105948">(</span><span class="ident" id="4105949">z</span><span class="op" id="4105950">[</span><span class="ident" id="4105951">n</span><span class="op" id="4105952">:</span><span class="ident" id="4105953">m</span><span class="op" id="4105954">]</span><span class="op" id="4105955">,</span>&nbsp;<span class="ident" id="4105957">s</span><span class="op" id="4105958">[</span><span class="ident" id="4105959">n</span><span class="op" id="4105960">:</span><span class="ident" id="4105961">m</span><span class="op" id="4105962">]</span><span class="op" id="4105963">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4105967">return</span>&nbsp;<span class="ident" id="4105974">z</span><span class="op" id="4105975">.</span><span class="ident" id="4105976">norm</span><span class="op" id="4105980">(</span><span class="op" id="4105981">)</span><br>
<span class="lineno"></span><span class="op" id="4105983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4105986">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="4106048">func</span>&nbsp;<span class="ident" id="4106053">greaterThan</span><span class="op" id="4106064">(</span><span class="ident" id="4106065">x1</span><span class="op" id="4106067">,</span>&nbsp;<span class="ident" id="4106069">x2</span><span class="op" id="4106071">,</span>&nbsp;<span class="ident" id="4106073">y1</span><span class="op" id="4106075">,</span>&nbsp;<span class="ident" id="4106077">y2</span>&nbsp;<span class="ident" id="4106080">Word</span><span class="op" id="4106084">)</span>&nbsp;<span class="builtintype" id="4106086">bool</span>&nbsp;<span class="op" id="4106091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106094">return</span>&nbsp;<span class="ident" id="4106101">x1</span>&nbsp;<span class="op" id="4106104">&gt;</span>&nbsp;<span class="ident" id="4106106">y1</span>&nbsp;<span class="op" id="4106109">||</span>&nbsp;<span class="ident" id="4106112">x1</span>&nbsp;<span class="op" id="4106115">==</span>&nbsp;<span class="ident" id="4106118">y1</span>&nbsp;<span class="op" id="4106121">&amp;&amp;</span>&nbsp;<span class="ident" id="4106124">x2</span>&nbsp;<span class="op" id="4106127">&gt;</span>&nbsp;<span class="ident" id="4106129">y2</span><br>
<span class="lineno"></span><span class="op" id="4106132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4106135">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="4106158">func</span>&nbsp;<span class="op" id="4106163">(</span><span class="ident" id="4106164">x</span>&nbsp;<span class="ident" id="4106166">nat</span><span class="op" id="4106169">)</span>&nbsp;<span class="ident" id="4106171">modW</span><span class="op" id="4106175">(</span><span class="ident" id="4106176">d</span>&nbsp;<span class="ident" id="4106178">Word</span><span class="op" id="4106182">)</span>&nbsp;<span class="op" id="4106184">(</span><span class="ident" id="4106185">r</span>&nbsp;<span class="ident" id="4106187">Word</span><span class="op" id="4106191">)</span>&nbsp;<span class="op" id="4106193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4106196">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106256">var</span>&nbsp;<span class="ident" id="4106260">q</span>&nbsp;<span class="ident" id="4106262">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106267">q</span>&nbsp;<span class="op" id="4106269">=</span>&nbsp;<span class="ident" id="4106271">q</span><span class="op" id="4106272">.</span><span class="builtinfunc" id="4106273">make</span><span class="op" id="4106277">(</span><span class="builtinfunc" id="4106278">len</span><span class="op" id="4106281">(</span><span class="ident" id="4106282">x</span><span class="op" id="4106283">)</span><span class="op" id="4106284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106287">return</span>&nbsp;<span class="ident" id="4106294">divWVW</span><span class="op" id="4106300">(</span><span class="ident" id="4106301">q</span><span class="op" id="4106302">,</span>&nbsp;<span class="num" id="4106304">0</span><span class="op" id="4106305">,</span>&nbsp;<span class="ident" id="4106307">x</span><span class="op" id="4106308">,</span>&nbsp;<span class="ident" id="4106310">d</span><span class="op" id="4106311">)</span><br>
<span class="lineno">1190</span><span class="op" id="4106313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4106316">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4106390">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="4106433">func</span>&nbsp;<span class="op" id="4106438">(</span><span class="ident" id="4106439">z</span>&nbsp;<span class="ident" id="4106441">nat</span><span class="op" id="4106444">)</span>&nbsp;<span class="ident" id="4106446">random</span><span class="op" id="4106452">(</span><span class="ident" id="4106453">rand</span>&nbsp;<span class="op" id="4106458">*</span><span class="ident" id="4106459">rand</span><span class="op" id="4106463">.</span><span class="ident" id="4106464">Rand</span><span class="op" id="4106468">,</span>&nbsp;<span class="ident" id="4106470">limit</span>&nbsp;<span class="ident" id="4106476">nat</span><span class="op" id="4106479">,</span>&nbsp;<span class="ident" id="4106481">n</span>&nbsp;<span class="builtintype" id="4106483">int</span><span class="op" id="4106486">)</span>&nbsp;<span class="ident" id="4106488">nat</span>&nbsp;<span class="op" id="4106492">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106495">if</span>&nbsp;<span class="ident" id="4106498">alias</span><span class="op" id="4106503">(</span><span class="ident" id="4106504">z</span><span class="op" id="4106505">,</span>&nbsp;<span class="ident" id="4106507">limit</span><span class="op" id="4106512">)</span>&nbsp;<span class="op" id="4106514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106518">z</span>&nbsp;<span class="op" id="4106520">=</span>&nbsp;<span class="builtintype" id="4106522">nil</span>&nbsp;<span class="comment" id="4106526">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106572">z</span>&nbsp;<span class="op" id="4106574">=</span>&nbsp;<span class="ident" id="4106576">z</span><span class="op" id="4106577">.</span><span class="builtinfunc" id="4106578">make</span><span class="op" id="4106582">(</span><span class="builtinfunc" id="4106583">len</span><span class="op" id="4106586">(</span><span class="ident" id="4106587">limit</span><span class="op" id="4106592">)</span><span class="op" id="4106593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106597">bitLengthOfMSW</span>&nbsp;<span class="op" id="4106612">:=</span>&nbsp;<span class="builtintype" id="4106615">uint</span><span class="op" id="4106619">(</span><span class="ident" id="4106620">n</span>&nbsp;<span class="op" id="4106622">%</span>&nbsp;<span class="ident" id="4106624">_W</span><span class="op" id="4106626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106629">if</span>&nbsp;<span class="ident" id="4106632">bitLengthOfMSW</span>&nbsp;<span class="op" id="4106647">==</span>&nbsp;<span class="num" id="4106650">0</span>&nbsp;<span class="op" id="4106652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106656">bitLengthOfMSW</span>&nbsp;<span class="op" id="4106671">=</span>&nbsp;<span class="ident" id="4106673">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106680">mask</span>&nbsp;<span class="op" id="4106685">:=</span>&nbsp;<span class="ident" id="4106688">Word</span><span class="op" id="4106692">(</span><span class="op" id="4106693">(</span><span class="num" id="4106694">1</span>&nbsp;<span class="op" id="4106696">&lt;&lt;</span>&nbsp;<span class="ident" id="4106699">bitLengthOfMSW</span><span class="op" id="4106713">)</span>&nbsp;<span class="op" id="4106715">-</span>&nbsp;<span class="num" id="4106717">1</span><span class="op" id="4106718">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106722">for</span>&nbsp;<span class="op" id="4106726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106730">switch</span>&nbsp;<span class="ident" id="4106737">_W</span>&nbsp;<span class="op" id="4106740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106744">case</span>&nbsp;<span class="num" id="4106749">32</span><span class="op" id="4106751">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106756">for</span>&nbsp;<span class="ident" id="4106760">i</span>&nbsp;<span class="op" id="4106762">:=</span>&nbsp;<span class="keyword" id="4106765">range</span>&nbsp;<span class="ident" id="4106771">z</span>&nbsp;<span class="op" id="4106773">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106779">z</span><span class="op" id="4106780">[</span><span class="ident" id="4106781">i</span><span class="op" id="4106782">]</span>&nbsp;<span class="op" id="4106784">=</span>&nbsp;<span class="ident" id="4106786">Word</span><span class="op" id="4106790">(</span><span class="ident" id="4106791">rand</span><span class="op" id="4106795">.</span><span class="ident" id="4106796">Uint32</span><span class="op" id="4106802">(</span><span class="op" id="4106803">)</span><span class="op" id="4106804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106813">case</span>&nbsp;<span class="num" id="4106818">64</span><span class="op" id="4106820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106825">for</span>&nbsp;<span class="ident" id="4106829">i</span>&nbsp;<span class="op" id="4106831">:=</span>&nbsp;<span class="keyword" id="4106834">range</span>&nbsp;<span class="ident" id="4106840">z</span>&nbsp;<span class="op" id="4106842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106848">z</span><span class="op" id="4106849">[</span><span class="ident" id="4106850">i</span><span class="op" id="4106851">]</span>&nbsp;<span class="op" id="4106853">=</span>&nbsp;<span class="ident" id="4106855">Word</span><span class="op" id="4106859">(</span><span class="ident" id="4106860">rand</span><span class="op" id="4106864">.</span><span class="ident" id="4106865">Uint32</span><span class="op" id="4106871">(</span><span class="op" id="4106872">)</span><span class="op" id="4106873">)</span>&nbsp;<span class="op" id="4106875">|</span>&nbsp;<span class="ident" id="4106877">Word</span><span class="op" id="4106881">(</span><span class="ident" id="4106882">rand</span><span class="op" id="4106886">.</span><span class="ident" id="4106887">Uint32</span><span class="op" id="4106893">(</span><span class="op" id="4106894">)</span><span class="op" id="4106895">)</span><span class="op" id="4106896">&lt;&lt;</span><span class="num" id="4106898">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106908">default</span><span class="op" id="4106915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4106920">panic</span><span class="op" id="4106925">(</span><span class="string" id="4106926">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4106945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4106949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4106953">z</span><span class="op" id="4106954">[</span><span class="builtinfunc" id="4106955">len</span><span class="op" id="4106958">(</span><span class="ident" id="4106959">limit</span><span class="op" id="4106964">)</span><span class="op" id="4106965">-</span><span class="num" id="4106966">1</span><span class="op" id="4106967">]</span>&nbsp;<span class="op" id="4106969">&amp;=</span>&nbsp;<span class="ident" id="4106972">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4106979">if</span>&nbsp;<span class="ident" id="4106982">z</span><span class="op" id="4106983">.</span><span class="ident" id="4106984">cmp</span><span class="op" id="4106987">(</span><span class="ident" id="4106988">limit</span><span class="op" id="4106993">)</span>&nbsp;<span class="op" id="4106995">&lt;</span>&nbsp;<span class="num" id="4106997">0</span>&nbsp;<span class="op" id="4106999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107004">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107019">return</span>&nbsp;<span class="ident" id="4107026">z</span><span class="op" id="4107027">.</span><span class="ident" id="4107028">norm</span><span class="op" id="4107032">(</span><span class="op" id="4107033">)</span><br>
<span class="lineno"></span><span class="op" id="4107035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4107038">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="4107100">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="4107162">func</span>&nbsp;<span class="op" id="4107167">(</span><span class="ident" id="4107168">z</span>&nbsp;<span class="ident" id="4107170">nat</span><span class="op" id="4107173">)</span>&nbsp;<span class="ident" id="4107175">expNN</span><span class="op" id="4107180">(</span><span class="ident" id="4107181">x</span><span class="op" id="4107182">,</span>&nbsp;<span class="ident" id="4107184">y</span><span class="op" id="4107185">,</span>&nbsp;<span class="ident" id="4107187">m</span>&nbsp;<span class="ident" id="4107189">nat</span><span class="op" id="4107192">)</span>&nbsp;<span class="ident" id="4107194">nat</span>&nbsp;<span class="op" id="4107198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107201">if</span>&nbsp;<span class="ident" id="4107204">alias</span><span class="op" id="4107209">(</span><span class="ident" id="4107210">z</span><span class="op" id="4107211">,</span>&nbsp;<span class="ident" id="4107213">x</span><span class="op" id="4107214">)</span>&nbsp;<span class="op" id="4107216">||</span>&nbsp;<span class="ident" id="4107219">alias</span><span class="op" id="4107224">(</span><span class="ident" id="4107225">z</span><span class="op" id="4107226">,</span>&nbsp;<span class="ident" id="4107228">y</span><span class="op" id="4107229">)</span>&nbsp;<span class="op" id="4107231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107235">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4107289">z</span>&nbsp;<span class="op" id="4107291">=</span>&nbsp;<span class="builtintype" id="4107293">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107298">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107302">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107322">if</span>&nbsp;<span class="builtinfunc" id="4107325">len</span><span class="op" id="4107328">(</span><span class="ident" id="4107329">m</span><span class="op" id="4107330">)</span>&nbsp;<span class="op" id="4107332">==</span>&nbsp;<span class="num" id="4107335">1</span>&nbsp;<span class="op" id="4107337">&amp;&amp;</span>&nbsp;<span class="ident" id="4107340">m</span><span class="op" id="4107341">[</span><span class="num" id="4107342">0</span><span class="op" id="4107343">]</span>&nbsp;<span class="op" id="4107345">==</span>&nbsp;<span class="num" id="4107348">1</span>&nbsp;<span class="op" id="4107350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107354">return</span>&nbsp;<span class="ident" id="4107361">z</span><span class="op" id="4107362">.</span><span class="ident" id="4107363">setWord</span><span class="op" id="4107370">(</span><span class="num" id="4107371">0</span><span class="op" id="4107372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107375">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107378">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107399">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107413">if</span>&nbsp;<span class="builtinfunc" id="4107416">len</span><span class="op" id="4107419">(</span><span class="ident" id="4107420">y</span><span class="op" id="4107421">)</span>&nbsp;<span class="op" id="4107423">==</span>&nbsp;<span class="num" id="4107426">0</span>&nbsp;<span class="op" id="4107428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107432">return</span>&nbsp;<span class="ident" id="4107439">z</span><span class="op" id="4107440">.</span><span class="ident" id="4107441">setWord</span><span class="op" id="4107448">(</span><span class="num" id="4107449">1</span><span class="op" id="4107450">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107456">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107467">if</span>&nbsp;<span class="builtinfunc" id="4107470">len</span><span class="op" id="4107473">(</span><span class="ident" id="4107474">m</span><span class="op" id="4107475">)</span>&nbsp;<span class="op" id="4107477">!=</span>&nbsp;<span class="num" id="4107480">0</span>&nbsp;<span class="op" id="4107482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107486">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4107538">z</span>&nbsp;<span class="op" id="4107540">=</span>&nbsp;<span class="ident" id="4107542">z</span><span class="op" id="4107543">.</span><span class="builtinfunc" id="4107544">make</span><span class="op" id="4107548">(</span><span class="builtinfunc" id="4107549">len</span><span class="op" id="4107552">(</span><span class="ident" id="4107553">m</span><span class="op" id="4107554">)</span><span class="op" id="4107555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4107561">z</span>&nbsp;<span class="op" id="4107563">=</span>&nbsp;<span class="ident" id="4107565">z</span><span class="op" id="4107566">.</span><span class="ident" id="4107567">set</span><span class="op" id="4107570">(</span><span class="ident" id="4107571">x</span><span class="op" id="4107572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107576">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107641">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107714">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107784">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4107850">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107866">if</span>&nbsp;<span class="builtinfunc" id="4107869">len</span><span class="op" id="4107872">(</span><span class="ident" id="4107873">x</span><span class="op" id="4107874">)</span>&nbsp;<span class="op" id="4107876">&gt;</span>&nbsp;<span class="num" id="4107878">1</span>&nbsp;<span class="op" id="4107880">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4107883">len</span><span class="op" id="4107886">(</span><span class="ident" id="4107887">y</span><span class="op" id="4107888">)</span>&nbsp;<span class="op" id="4107890">&gt;</span>&nbsp;<span class="num" id="4107892">1</span>&nbsp;<span class="op" id="4107894">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4107897">len</span><span class="op" id="4107900">(</span><span class="ident" id="4107901">m</span><span class="op" id="4107902">)</span>&nbsp;<span class="op" id="4107904">&gt;</span>&nbsp;<span class="num" id="4107906">0</span>&nbsp;<span class="op" id="4107908">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4107912">return</span>&nbsp;<span class="ident" id="4107919">z</span><span class="op" id="4107920">.</span><span class="ident" id="4107921">expNNWindowed</span><span class="op" id="4107934">(</span><span class="ident" id="4107935">x</span><span class="op" id="4107936">,</span>&nbsp;<span class="ident" id="4107938">y</span><span class="op" id="4107939">,</span>&nbsp;<span class="ident" id="4107941">m</span><span class="op" id="4107942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4107945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4107949">v</span>&nbsp;<span class="op" id="4107951">:=</span>&nbsp;<span class="ident" id="4107954">y</span><span class="op" id="4107955">[</span><span class="builtinfunc" id="4107956">len</span><span class="op" id="4107959">(</span><span class="ident" id="4107960">y</span><span class="op" id="4107961">)</span><span class="op" id="4107962">-</span><span class="num" id="4107963">1</span><span class="op" id="4107964">]</span>&nbsp;<span class="comment" id="4107966">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108010">shift</span>&nbsp;<span class="op" id="4108016">:=</span>&nbsp;<span class="ident" id="4108019">leadingZeros</span><span class="op" id="4108031">(</span><span class="ident" id="4108032">v</span><span class="op" id="4108033">)</span>&nbsp;<span class="op" id="4108035">+</span>&nbsp;<span class="num" id="4108037">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108040">v</span>&nbsp;<span class="op" id="4108042">&lt;&lt;=</span>&nbsp;<span class="ident" id="4108046">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108053">var</span>&nbsp;<span class="ident" id="4108057">q</span>&nbsp;<span class="ident" id="4108059">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108065">const</span>&nbsp;<span class="ident" id="4108071">mask</span>&nbsp;<span class="op" id="4108076">=</span>&nbsp;<span class="num" id="4108078">1</span>&nbsp;<span class="op" id="4108080">&lt;&lt;</span>&nbsp;<span class="op" id="4108083">(</span><span class="ident" id="4108084">_W</span>&nbsp;<span class="op" id="4108087">-</span>&nbsp;<span class="num" id="4108089">1</span><span class="op" id="4108090">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108094">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108164">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108236">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108294">w</span>&nbsp;<span class="op" id="4108296">:=</span>&nbsp;<span class="ident" id="4108299">_W</span>&nbsp;<span class="op" id="4108302">-</span>&nbsp;<span class="builtintype" id="4108304">int</span><span class="op" id="4108307">(</span><span class="ident" id="4108308">shift</span><span class="op" id="4108313">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108316">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4108376">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108417">var</span>&nbsp;<span class="ident" id="4108421">zz</span><span class="op" id="4108423">,</span>&nbsp;<span class="ident" id="4108425">r</span>&nbsp;<span class="ident" id="4108427">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108432">for</span>&nbsp;<span class="ident" id="4108436">j</span>&nbsp;<span class="op" id="4108438">:=</span>&nbsp;<span class="num" id="4108441">0</span><span class="op" id="4108442">;</span>&nbsp;<span class="ident" id="4108444">j</span>&nbsp;<span class="op" id="4108446">&lt;</span>&nbsp;<span class="ident" id="4108448">w</span><span class="op" id="4108449">;</span>&nbsp;<span class="ident" id="4108451">j</span><span class="op" id="4108452">++</span>&nbsp;<span class="op" id="4108455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108459">zz</span>&nbsp;<span class="op" id="4108462">=</span>&nbsp;<span class="ident" id="4108464">zz</span><span class="op" id="4108466">.</span><span class="ident" id="4108467">mul</span><span class="op" id="4108470">(</span><span class="ident" id="4108471">z</span><span class="op" id="4108472">,</span>&nbsp;<span class="ident" id="4108474">z</span><span class="op" id="4108475">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108479">zz</span><span class="op" id="4108481">,</span>&nbsp;<span class="ident" id="4108483">z</span>&nbsp;<span class="op" id="4108485">=</span>&nbsp;<span class="ident" id="4108487">z</span><span class="op" id="4108488">,</span>&nbsp;<span class="ident" id="4108490">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108496">if</span>&nbsp;<span class="ident" id="4108499">v</span><span class="op" id="4108500">&amp;</span><span class="ident" id="4108501">mask</span>&nbsp;<span class="op" id="4108506">!=</span>&nbsp;<span class="num" id="4108509">0</span>&nbsp;<span class="op" id="4108511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108516">zz</span>&nbsp;<span class="op" id="4108519">=</span>&nbsp;<span class="ident" id="4108521">zz</span><span class="op" id="4108523">.</span><span class="ident" id="4108524">mul</span><span class="op" id="4108527">(</span><span class="ident" id="4108528">z</span><span class="op" id="4108529">,</span>&nbsp;<span class="ident" id="4108531">x</span><span class="op" id="4108532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108537">zz</span><span class="op" id="4108539">,</span>&nbsp;<span class="ident" id="4108541">z</span>&nbsp;<span class="op" id="4108543">=</span>&nbsp;<span class="ident" id="4108545">z</span><span class="op" id="4108546">,</span>&nbsp;<span class="ident" id="4108548">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108558">if</span>&nbsp;<span class="builtinfunc" id="4108561">len</span><span class="op" id="4108564">(</span><span class="ident" id="4108565">m</span><span class="op" id="4108566">)</span>&nbsp;<span class="op" id="4108568">!=</span>&nbsp;<span class="num" id="4108571">0</span>&nbsp;<span class="op" id="4108573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108578">zz</span><span class="op" id="4108580">,</span>&nbsp;<span class="ident" id="4108582">r</span>&nbsp;<span class="op" id="4108584">=</span>&nbsp;<span class="ident" id="4108586">zz</span><span class="op" id="4108588">.</span><span class="ident" id="4108589">div</span><span class="op" id="4108592">(</span><span class="ident" id="4108593">r</span><span class="op" id="4108594">,</span>&nbsp;<span class="ident" id="4108596">z</span><span class="op" id="4108597">,</span>&nbsp;<span class="ident" id="4108599">m</span><span class="op" id="4108600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108605">zz</span><span class="op" id="4108607">,</span>&nbsp;<span class="ident" id="4108609">r</span><span class="op" id="4108610">,</span>&nbsp;<span class="ident" id="4108612">q</span><span class="op" id="4108613">,</span>&nbsp;<span class="ident" id="4108615">z</span>&nbsp;<span class="op" id="4108617">=</span>&nbsp;<span class="ident" id="4108619">q</span><span class="op" id="4108620">,</span>&nbsp;<span class="ident" id="4108622">z</span><span class="op" id="4108623">,</span>&nbsp;<span class="ident" id="4108625">zz</span><span class="op" id="4108627">,</span>&nbsp;<span class="ident" id="4108629">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108638">v</span>&nbsp;<span class="op" id="4108640">&lt;&lt;=</span>&nbsp;<span class="num" id="4108644">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108651">for</span>&nbsp;<span class="ident" id="4108655">i</span>&nbsp;<span class="op" id="4108657">:=</span>&nbsp;<span class="builtinfunc" id="4108660">len</span><span class="op" id="4108663">(</span><span class="ident" id="4108664">y</span><span class="op" id="4108665">)</span>&nbsp;<span class="op" id="4108667">-</span>&nbsp;<span class="num" id="4108669">2</span><span class="op" id="4108670">;</span>&nbsp;<span class="ident" id="4108672">i</span>&nbsp;<span class="op" id="4108674">&gt;=</span>&nbsp;<span class="num" id="4108677">0</span><span class="op" id="4108678">;</span>&nbsp;<span class="ident" id="4108680">i</span><span class="op" id="4108681">--</span>&nbsp;<span class="op" id="4108684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108688">v</span>&nbsp;<span class="op" id="4108690">=</span>&nbsp;<span class="ident" id="4108692">y</span><span class="op" id="4108693">[</span><span class="ident" id="4108694">i</span><span class="op" id="4108695">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108700">for</span>&nbsp;<span class="ident" id="4108704">j</span>&nbsp;<span class="op" id="4108706">:=</span>&nbsp;<span class="num" id="4108709">0</span><span class="op" id="4108710">;</span>&nbsp;<span class="ident" id="4108712">j</span>&nbsp;<span class="op" id="4108714">&lt;</span>&nbsp;<span class="ident" id="4108716">_W</span><span class="op" id="4108718">;</span>&nbsp;<span class="ident" id="4108720">j</span><span class="op" id="4108721">++</span>&nbsp;<span class="op" id="4108724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108729">zz</span>&nbsp;<span class="op" id="4108732">=</span>&nbsp;<span class="ident" id="4108734">zz</span><span class="op" id="4108736">.</span><span class="ident" id="4108737">mul</span><span class="op" id="4108740">(</span><span class="ident" id="4108741">z</span><span class="op" id="4108742">,</span>&nbsp;<span class="ident" id="4108744">z</span><span class="op" id="4108745">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108750">zz</span><span class="op" id="4108752">,</span>&nbsp;<span class="ident" id="4108754">z</span>&nbsp;<span class="op" id="4108756">=</span>&nbsp;<span class="ident" id="4108758">z</span><span class="op" id="4108759">,</span>&nbsp;<span class="ident" id="4108761">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108768">if</span>&nbsp;<span class="ident" id="4108771">v</span><span class="op" id="4108772">&amp;</span><span class="ident" id="4108773">mask</span>&nbsp;<span class="op" id="4108778">!=</span>&nbsp;<span class="num" id="4108781">0</span>&nbsp;<span class="op" id="4108783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108789">zz</span>&nbsp;<span class="op" id="4108792">=</span>&nbsp;<span class="ident" id="4108794">zz</span><span class="op" id="4108796">.</span><span class="ident" id="4108797">mul</span><span class="op" id="4108800">(</span><span class="ident" id="4108801">z</span><span class="op" id="4108802">,</span>&nbsp;<span class="ident" id="4108804">x</span><span class="op" id="4108805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108811">zz</span><span class="op" id="4108813">,</span>&nbsp;<span class="ident" id="4108815">z</span>&nbsp;<span class="op" id="4108817">=</span>&nbsp;<span class="ident" id="4108819">z</span><span class="op" id="4108820">,</span>&nbsp;<span class="ident" id="4108822">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108834">if</span>&nbsp;<span class="builtinfunc" id="4108837">len</span><span class="op" id="4108840">(</span><span class="ident" id="4108841">m</span><span class="op" id="4108842">)</span>&nbsp;<span class="op" id="4108844">!=</span>&nbsp;<span class="num" id="4108847">0</span>&nbsp;<span class="op" id="4108849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108855">zz</span><span class="op" id="4108857">,</span>&nbsp;<span class="ident" id="4108859">r</span>&nbsp;<span class="op" id="4108861">=</span>&nbsp;<span class="ident" id="4108863">zz</span><span class="op" id="4108865">.</span><span class="ident" id="4108866">div</span><span class="op" id="4108869">(</span><span class="ident" id="4108870">r</span><span class="op" id="4108871">,</span>&nbsp;<span class="ident" id="4108873">z</span><span class="op" id="4108874">,</span>&nbsp;<span class="ident" id="4108876">m</span><span class="op" id="4108877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108883">zz</span><span class="op" id="4108885">,</span>&nbsp;<span class="ident" id="4108887">r</span><span class="op" id="4108888">,</span>&nbsp;<span class="ident" id="4108890">q</span><span class="op" id="4108891">,</span>&nbsp;<span class="ident" id="4108893">z</span>&nbsp;<span class="op" id="4108895">=</span>&nbsp;<span class="ident" id="4108897">q</span><span class="op" id="4108898">,</span>&nbsp;<span class="ident" id="4108900">z</span><span class="op" id="4108901">,</span>&nbsp;<span class="ident" id="4108903">zz</span><span class="op" id="4108905">,</span>&nbsp;<span class="ident" id="4108907">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4108918">v</span>&nbsp;<span class="op" id="4108920">&lt;&lt;=</span>&nbsp;<span class="num" id="4108924">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4108931">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4108935">return</span>&nbsp;<span class="ident" id="4108942">z</span><span class="op" id="4108943">.</span><span class="ident" id="4108944">norm</span><span class="op" id="4108948">(</span><span class="op" id="4108949">)</span><br>
<span class="lineno"></span><span class="op" id="4108951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4108954">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="4109022">func</span>&nbsp;<span class="op" id="4109027">(</span><span class="ident" id="4109028">z</span>&nbsp;<span class="ident" id="4109030">nat</span><span class="op" id="4109033">)</span>&nbsp;<span class="ident" id="4109035">expNNWindowed</span><span class="op" id="4109048">(</span><span class="ident" id="4109049">x</span><span class="op" id="4109050">,</span>&nbsp;<span class="ident" id="4109052">y</span><span class="op" id="4109053">,</span>&nbsp;<span class="ident" id="4109055">m</span>&nbsp;<span class="ident" id="4109057">nat</span><span class="op" id="4109060">)</span>&nbsp;<span class="ident" id="4109062">nat</span>&nbsp;<span class="op" id="4109066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109069">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109139">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109170">var</span>&nbsp;<span class="ident" id="4109174">zz</span><span class="op" id="4109176">,</span>&nbsp;<span class="ident" id="4109178">r</span>&nbsp;<span class="ident" id="4109180">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109186">const</span>&nbsp;<span class="ident" id="4109192">n</span>&nbsp;<span class="op" id="4109194">=</span>&nbsp;<span class="num" id="4109196">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109199">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109227">var</span>&nbsp;<span class="ident" id="4109231">powers</span>&nbsp;<span class="op" id="4109238">[</span><span class="num" id="4109239">1</span>&nbsp;<span class="op" id="4109241">&lt;&lt;</span>&nbsp;<span class="ident" id="4109244">n</span><span class="op" id="4109245">]</span><span class="ident" id="4109246">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109251">powers</span><span class="op" id="4109257">[</span><span class="num" id="4109258">0</span><span class="op" id="4109259">]</span>&nbsp;<span class="op" id="4109261">=</span>&nbsp;<span class="ident" id="4109263">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109271">powers</span><span class="op" id="4109277">[</span><span class="num" id="4109278">1</span><span class="op" id="4109279">]</span>&nbsp;<span class="op" id="4109281">=</span>&nbsp;<span class="ident" id="4109283">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109286">for</span>&nbsp;<span class="ident" id="4109290">i</span>&nbsp;<span class="op" id="4109292">:=</span>&nbsp;<span class="num" id="4109295">2</span><span class="op" id="4109296">;</span>&nbsp;<span class="ident" id="4109298">i</span>&nbsp;<span class="op" id="4109300">&lt;</span>&nbsp;<span class="num" id="4109302">1</span><span class="op" id="4109303">&lt;&lt;</span><span class="ident" id="4109305">n</span><span class="op" id="4109306">;</span>&nbsp;<span class="ident" id="4109308">i</span>&nbsp;<span class="op" id="4109310">+=</span>&nbsp;<span class="num" id="4109313">2</span>&nbsp;<span class="op" id="4109315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109319">p2</span><span class="op" id="4109321">,</span>&nbsp;<span class="ident" id="4109323">p</span><span class="op" id="4109324">,</span>&nbsp;<span class="ident" id="4109326">p1</span>&nbsp;<span class="op" id="4109329">:=</span>&nbsp;<span class="op" id="4109332">&amp;</span><span class="ident" id="4109333">powers</span><span class="op" id="4109339">[</span><span class="ident" id="4109340">i</span><span class="op" id="4109341">/</span><span class="num" id="4109342">2</span><span class="op" id="4109343">]</span><span class="op" id="4109344">,</span>&nbsp;<span class="op" id="4109346">&amp;</span><span class="ident" id="4109347">powers</span><span class="op" id="4109353">[</span><span class="ident" id="4109354">i</span><span class="op" id="4109355">]</span><span class="op" id="4109356">,</span>&nbsp;<span class="op" id="4109358">&amp;</span><span class="ident" id="4109359">powers</span><span class="op" id="4109365">[</span><span class="ident" id="4109366">i</span><span class="op" id="4109367">+</span><span class="num" id="4109368">1</span><span class="op" id="4109369">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109373">*</span><span class="ident" id="4109374">p</span>&nbsp;<span class="op" id="4109376">=</span>&nbsp;<span class="ident" id="4109378">p</span><span class="op" id="4109379">.</span><span class="ident" id="4109380">mul</span><span class="op" id="4109383">(</span><span class="op" id="4109384">*</span><span class="ident" id="4109385">p2</span><span class="op" id="4109387">,</span>&nbsp;<span class="op" id="4109389">*</span><span class="ident" id="4109390">p2</span><span class="op" id="4109392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109396">zz</span><span class="op" id="4109398">,</span>&nbsp;<span class="ident" id="4109400">r</span>&nbsp;<span class="op" id="4109402">=</span>&nbsp;<span class="ident" id="4109404">zz</span><span class="op" id="4109406">.</span><span class="ident" id="4109407">div</span><span class="op" id="4109410">(</span><span class="ident" id="4109411">r</span><span class="op" id="4109412">,</span>&nbsp;<span class="op" id="4109414">*</span><span class="ident" id="4109415">p</span><span class="op" id="4109416">,</span>&nbsp;<span class="ident" id="4109418">m</span><span class="op" id="4109419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109423">*</span><span class="ident" id="4109424">p</span><span class="op" id="4109425">,</span>&nbsp;<span class="ident" id="4109427">r</span>&nbsp;<span class="op" id="4109429">=</span>&nbsp;<span class="ident" id="4109431">r</span><span class="op" id="4109432">,</span>&nbsp;<span class="op" id="4109434">*</span><span class="ident" id="4109435">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109439">*</span><span class="ident" id="4109440">p1</span>&nbsp;<span class="op" id="4109443">=</span>&nbsp;<span class="ident" id="4109445">p1</span><span class="op" id="4109447">.</span><span class="ident" id="4109448">mul</span><span class="op" id="4109451">(</span><span class="op" id="4109452">*</span><span class="ident" id="4109453">p</span><span class="op" id="4109454">,</span>&nbsp;<span class="ident" id="4109456">x</span><span class="op" id="4109457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109461">zz</span><span class="op" id="4109463">,</span>&nbsp;<span class="ident" id="4109465">r</span>&nbsp;<span class="op" id="4109467">=</span>&nbsp;<span class="ident" id="4109469">zz</span><span class="op" id="4109471">.</span><span class="ident" id="4109472">div</span><span class="op" id="4109475">(</span><span class="ident" id="4109476">r</span><span class="op" id="4109477">,</span>&nbsp;<span class="op" id="4109479">*</span><span class="ident" id="4109480">p1</span><span class="op" id="4109482">,</span>&nbsp;<span class="ident" id="4109484">m</span><span class="op" id="4109485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109489">*</span><span class="ident" id="4109490">p1</span><span class="op" id="4109492">,</span>&nbsp;<span class="ident" id="4109494">r</span>&nbsp;<span class="op" id="4109496">=</span>&nbsp;<span class="ident" id="4109498">r</span><span class="op" id="4109499">,</span>&nbsp;<span class="op" id="4109501">*</span><span class="ident" id="4109502">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4109506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109510">z</span>&nbsp;<span class="op" id="4109512">=</span>&nbsp;<span class="ident" id="4109514">z</span><span class="op" id="4109515">.</span><span class="ident" id="4109516">setWord</span><span class="op" id="4109523">(</span><span class="num" id="4109524">1</span><span class="op" id="4109525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109529">for</span>&nbsp;<span class="ident" id="4109533">i</span>&nbsp;<span class="op" id="4109535">:=</span>&nbsp;<span class="builtinfunc" id="4109538">len</span><span class="op" id="4109541">(</span><span class="ident" id="4109542">y</span><span class="op" id="4109543">)</span>&nbsp;<span class="op" id="4109545">-</span>&nbsp;<span class="num" id="4109547">1</span><span class="op" id="4109548">;</span>&nbsp;<span class="ident" id="4109550">i</span>&nbsp;<span class="op" id="4109552">&gt;=</span>&nbsp;<span class="num" id="4109555">0</span><span class="op" id="4109556">;</span>&nbsp;<span class="ident" id="4109558">i</span><span class="op" id="4109559">--</span>&nbsp;<span class="op" id="4109562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109566">yi</span>&nbsp;<span class="op" id="4109569">:=</span>&nbsp;<span class="ident" id="4109572">y</span><span class="op" id="4109573">[</span><span class="ident" id="4109574">i</span><span class="op" id="4109575">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109579">for</span>&nbsp;<span class="ident" id="4109583">j</span>&nbsp;<span class="op" id="4109585">:=</span>&nbsp;<span class="num" id="4109588">0</span><span class="op" id="4109589">;</span>&nbsp;<span class="ident" id="4109591">j</span>&nbsp;<span class="op" id="4109593">&lt;</span>&nbsp;<span class="ident" id="4109595">_W</span><span class="op" id="4109597">;</span>&nbsp;<span class="ident" id="4109599">j</span>&nbsp;<span class="op" id="4109601">+=</span>&nbsp;<span class="ident" id="4109604">n</span>&nbsp;<span class="op" id="4109606">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4109611">if</span>&nbsp;<span class="ident" id="4109614">i</span>&nbsp;<span class="op" id="4109616">!=</span>&nbsp;<span class="builtinfunc" id="4109619">len</span><span class="op" id="4109622">(</span><span class="ident" id="4109623">y</span><span class="op" id="4109624">)</span><span class="op" id="4109625">-</span><span class="num" id="4109626">1</span>&nbsp;<span class="op" id="4109628">||</span>&nbsp;<span class="ident" id="4109631">j</span>&nbsp;<span class="op" id="4109633">!=</span>&nbsp;<span class="num" id="4109636">0</span>&nbsp;<span class="op" id="4109638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109644">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109693">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4109745">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109796">zz</span>&nbsp;<span class="op" id="4109799">=</span>&nbsp;<span class="ident" id="4109801">zz</span><span class="op" id="4109803">.</span><span class="ident" id="4109804">mul</span><span class="op" id="4109807">(</span><span class="ident" id="4109808">z</span><span class="op" id="4109809">,</span>&nbsp;<span class="ident" id="4109811">z</span><span class="op" id="4109812">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109818">zz</span><span class="op" id="4109820">,</span>&nbsp;<span class="ident" id="4109822">z</span>&nbsp;<span class="op" id="4109824">=</span>&nbsp;<span class="ident" id="4109826">z</span><span class="op" id="4109827">,</span>&nbsp;<span class="ident" id="4109829">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109836">zz</span><span class="op" id="4109838">,</span>&nbsp;<span class="ident" id="4109840">r</span>&nbsp;<span class="op" id="4109842">=</span>&nbsp;<span class="ident" id="4109844">zz</span><span class="op" id="4109846">.</span><span class="ident" id="4109847">div</span><span class="op" id="4109850">(</span><span class="ident" id="4109851">r</span><span class="op" id="4109852">,</span>&nbsp;<span class="ident" id="4109854">z</span><span class="op" id="4109855">,</span>&nbsp;<span class="ident" id="4109857">m</span><span class="op" id="4109858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109864">z</span><span class="op" id="4109865">,</span>&nbsp;<span class="ident" id="4109867">r</span>&nbsp;<span class="op" id="4109869">=</span>&nbsp;<span class="ident" id="4109871">r</span><span class="op" id="4109872">,</span>&nbsp;<span class="ident" id="4109874">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109881">zz</span>&nbsp;<span class="op" id="4109884">=</span>&nbsp;<span class="ident" id="4109886">zz</span><span class="op" id="4109888">.</span><span class="ident" id="4109889">mul</span><span class="op" id="4109892">(</span><span class="ident" id="4109893">z</span><span class="op" id="4109894">,</span>&nbsp;<span class="ident" id="4109896">z</span><span class="op" id="4109897">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109903">zz</span><span class="op" id="4109905">,</span>&nbsp;<span class="ident" id="4109907">z</span>&nbsp;<span class="op" id="4109909">=</span>&nbsp;<span class="ident" id="4109911">z</span><span class="op" id="4109912">,</span>&nbsp;<span class="ident" id="4109914">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109921">zz</span><span class="op" id="4109923">,</span>&nbsp;<span class="ident" id="4109925">r</span>&nbsp;<span class="op" id="4109927">=</span>&nbsp;<span class="ident" id="4109929">zz</span><span class="op" id="4109931">.</span><span class="ident" id="4109932">div</span><span class="op" id="4109935">(</span><span class="ident" id="4109936">r</span><span class="op" id="4109937">,</span>&nbsp;<span class="ident" id="4109939">z</span><span class="op" id="4109940">,</span>&nbsp;<span class="ident" id="4109942">m</span><span class="op" id="4109943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109949">z</span><span class="op" id="4109950">,</span>&nbsp;<span class="ident" id="4109952">r</span>&nbsp;<span class="op" id="4109954">=</span>&nbsp;<span class="ident" id="4109956">r</span><span class="op" id="4109957">,</span>&nbsp;<span class="ident" id="4109959">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109966">zz</span>&nbsp;<span class="op" id="4109969">=</span>&nbsp;<span class="ident" id="4109971">zz</span><span class="op" id="4109973">.</span><span class="ident" id="4109974">mul</span><span class="op" id="4109977">(</span><span class="ident" id="4109978">z</span><span class="op" id="4109979">,</span>&nbsp;<span class="ident" id="4109981">z</span><span class="op" id="4109982">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4109988">zz</span><span class="op" id="4109990">,</span>&nbsp;<span class="ident" id="4109992">z</span>&nbsp;<span class="op" id="4109994">=</span>&nbsp;<span class="ident" id="4109996">z</span><span class="op" id="4109997">,</span>&nbsp;<span class="ident" id="4109999">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110006">zz</span><span class="op" id="4110008">,</span>&nbsp;<span class="ident" id="4110010">r</span>&nbsp;<span class="op" id="4110012">=</span>&nbsp;<span class="ident" id="4110014">zz</span><span class="op" id="4110016">.</span><span class="ident" id="4110017">div</span><span class="op" id="4110020">(</span><span class="ident" id="4110021">r</span><span class="op" id="4110022">,</span>&nbsp;<span class="ident" id="4110024">z</span><span class="op" id="4110025">,</span>&nbsp;<span class="ident" id="4110027">m</span><span class="op" id="4110028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110034">z</span><span class="op" id="4110035">,</span>&nbsp;<span class="ident" id="4110037">r</span>&nbsp;<span class="op" id="4110039">=</span>&nbsp;<span class="ident" id="4110041">r</span><span class="op" id="4110042">,</span>&nbsp;<span class="ident" id="4110044">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110051">zz</span>&nbsp;<span class="op" id="4110054">=</span>&nbsp;<span class="ident" id="4110056">zz</span><span class="op" id="4110058">.</span><span class="ident" id="4110059">mul</span><span class="op" id="4110062">(</span><span class="ident" id="4110063">z</span><span class="op" id="4110064">,</span>&nbsp;<span class="ident" id="4110066">z</span><span class="op" id="4110067">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110073">zz</span><span class="op" id="4110075">,</span>&nbsp;<span class="ident" id="4110077">z</span>&nbsp;<span class="op" id="4110079">=</span>&nbsp;<span class="ident" id="4110081">z</span><span class="op" id="4110082">,</span>&nbsp;<span class="ident" id="4110084">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110091">zz</span><span class="op" id="4110093">,</span>&nbsp;<span class="ident" id="4110095">r</span>&nbsp;<span class="op" id="4110097">=</span>&nbsp;<span class="ident" id="4110099">zz</span><span class="op" id="4110101">.</span><span class="ident" id="4110102">div</span><span class="op" id="4110105">(</span><span class="ident" id="4110106">r</span><span class="op" id="4110107">,</span>&nbsp;<span class="ident" id="4110109">z</span><span class="op" id="4110110">,</span>&nbsp;<span class="ident" id="4110112">m</span><span class="op" id="4110113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110119">z</span><span class="op" id="4110120">,</span>&nbsp;<span class="ident" id="4110122">r</span>&nbsp;<span class="op" id="4110124">=</span>&nbsp;<span class="ident" id="4110126">r</span><span class="op" id="4110127">,</span>&nbsp;<span class="ident" id="4110129">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110140">zz</span>&nbsp;<span class="op" id="4110143">=</span>&nbsp;<span class="ident" id="4110145">zz</span><span class="op" id="4110147">.</span><span class="ident" id="4110148">mul</span><span class="op" id="4110151">(</span><span class="ident" id="4110152">z</span><span class="op" id="4110153">,</span>&nbsp;<span class="ident" id="4110155">powers</span><span class="op" id="4110161">[</span><span class="ident" id="4110162">yi</span><span class="op" id="4110164">&gt;&gt;</span><span class="op" id="4110166">(</span><span class="ident" id="4110167">_W</span><span class="op" id="4110169">-</span><span class="ident" id="4110170">n</span><span class="op" id="4110171">)</span><span class="op" id="4110172">]</span><span class="op" id="4110173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110178">zz</span><span class="op" id="4110180">,</span>&nbsp;<span class="ident" id="4110182">z</span>&nbsp;<span class="op" id="4110184">=</span>&nbsp;<span class="ident" id="4110186">z</span><span class="op" id="4110187">,</span>&nbsp;<span class="ident" id="4110189">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110195">zz</span><span class="op" id="4110197">,</span>&nbsp;<span class="ident" id="4110199">r</span>&nbsp;<span class="op" id="4110201">=</span>&nbsp;<span class="ident" id="4110203">zz</span><span class="op" id="4110205">.</span><span class="ident" id="4110206">div</span><span class="op" id="4110209">(</span><span class="ident" id="4110210">r</span><span class="op" id="4110211">,</span>&nbsp;<span class="ident" id="4110213">z</span><span class="op" id="4110214">,</span>&nbsp;<span class="ident" id="4110216">m</span><span class="op" id="4110217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110222">z</span><span class="op" id="4110223">,</span>&nbsp;<span class="ident" id="4110225">r</span>&nbsp;<span class="op" id="4110227">=</span>&nbsp;<span class="ident" id="4110229">r</span><span class="op" id="4110230">,</span>&nbsp;<span class="ident" id="4110232">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4110238">yi</span>&nbsp;<span class="op" id="4110241">&lt;&lt;=</span>&nbsp;<span class="ident" id="4110245">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110256">return</span>&nbsp;<span class="ident" id="4110263">z</span><span class="op" id="4110264">.</span><span class="ident" id="4110265">norm</span><span class="op" id="4110269">(</span><span class="op" id="4110270">)</span><br>
<span class="lineno">1380</span><span class="op" id="4110272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4110275">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="4110354">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="4110419">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="4110459">func</span>&nbsp;<span class="op" id="4110464">(</span><span class="ident" id="4110465">n</span>&nbsp;<span class="ident" id="4110467">nat</span><span class="op" id="4110470">)</span>&nbsp;<span class="ident" id="4110472">probablyPrime</span><span class="op" id="4110485">(</span><span class="ident" id="4110486">reps</span>&nbsp;<span class="builtintype" id="4110491">int</span><span class="op" id="4110494">)</span>&nbsp;<span class="builtintype" id="4110496">bool</span>&nbsp;<span class="op" id="4110501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110504">if</span>&nbsp;<span class="builtinfunc" id="4110507">len</span><span class="op" id="4110510">(</span><span class="ident" id="4110511">n</span><span class="op" id="4110512">)</span>&nbsp;<span class="op" id="4110514">==</span>&nbsp;<span class="num" id="4110517">0</span>&nbsp;<span class="op" id="4110519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110523">return</span>&nbsp;<span class="builtintype" id="4110530">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110541">if</span>&nbsp;<span class="builtinfunc" id="4110544">len</span><span class="op" id="4110547">(</span><span class="ident" id="4110548">n</span><span class="op" id="4110549">)</span>&nbsp;<span class="op" id="4110551">==</span>&nbsp;<span class="num" id="4110554">1</span>&nbsp;<span class="op" id="4110556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110560">if</span>&nbsp;<span class="ident" id="4110563">n</span><span class="op" id="4110564">[</span><span class="num" id="4110565">0</span><span class="op" id="4110566">]</span>&nbsp;<span class="op" id="4110568">&lt;</span>&nbsp;<span class="num" id="4110570">2</span>&nbsp;<span class="op" id="4110572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110577">return</span>&nbsp;<span class="builtintype" id="4110584">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110597">if</span>&nbsp;<span class="ident" id="4110600">n</span><span class="op" id="4110601">[</span><span class="num" id="4110602">0</span><span class="op" id="4110603">]</span><span class="op" id="4110604">%</span><span class="num" id="4110605">2</span>&nbsp;<span class="op" id="4110607">==</span>&nbsp;<span class="num" id="4110610">0</span>&nbsp;<span class="op" id="4110612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110617">return</span>&nbsp;<span class="ident" id="4110624">n</span><span class="op" id="4110625">[</span><span class="num" id="4110626">0</span><span class="op" id="4110627">]</span>&nbsp;<span class="op" id="4110629">==</span>&nbsp;<span class="num" id="4110632">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4110641">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4110699">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110738">switch</span>&nbsp;<span class="ident" id="4110745">n</span><span class="op" id="4110746">[</span><span class="num" id="4110747">0</span><span class="op" id="4110748">]</span>&nbsp;<span class="op" id="4110750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110754">case</span>&nbsp;<span class="num" id="4110759">3</span><span class="op" id="4110760">,</span>&nbsp;<span class="num" id="4110762">5</span><span class="op" id="4110763">,</span>&nbsp;<span class="num" id="4110765">7</span><span class="op" id="4110766">,</span>&nbsp;<span class="num" id="4110768">11</span><span class="op" id="4110770">,</span>&nbsp;<span class="num" id="4110772">13</span><span class="op" id="4110774">,</span>&nbsp;<span class="num" id="4110776">17</span><span class="op" id="4110778">,</span>&nbsp;<span class="num" id="4110780">19</span><span class="op" id="4110782">,</span>&nbsp;<span class="num" id="4110784">23</span><span class="op" id="4110786">,</span>&nbsp;<span class="num" id="4110788">29</span><span class="op" id="4110790">,</span>&nbsp;<span class="num" id="4110792">31</span><span class="op" id="4110794">,</span>&nbsp;<span class="num" id="4110796">37</span><span class="op" id="4110798">,</span>&nbsp;<span class="num" id="4110800">41</span><span class="op" id="4110802">,</span>&nbsp;<span class="num" id="4110804">43</span><span class="op" id="4110806">,</span>&nbsp;<span class="num" id="4110808">47</span><span class="op" id="4110810">,</span>&nbsp;<span class="num" id="4110812">53</span><span class="op" id="4110814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110819">return</span>&nbsp;<span class="builtintype" id="4110826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110833">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4110836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110840">const</span>&nbsp;<span class="ident" id="4110846">primesProduct32</span>&nbsp;<span class="op" id="4110862">=</span>&nbsp;<span class="num" id="4110864">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4110883">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110918">const</span>&nbsp;<span class="ident" id="4110924">primesProduct64</span>&nbsp;<span class="op" id="4110940">=</span>&nbsp;<span class="num" id="4110942">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="4110961">//&nbsp;Π&nbsp;{p&nbsp;∈&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4110997">var</span>&nbsp;<span class="ident" id="4111001">r</span>&nbsp;<span class="ident" id="4111003">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111009">switch</span>&nbsp;<span class="ident" id="4111016">_W</span>&nbsp;<span class="op" id="4111019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111022">case</span>&nbsp;<span class="num" id="4111027">32</span><span class="op" id="4111029">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111033">r</span>&nbsp;<span class="op" id="4111035">=</span>&nbsp;<span class="ident" id="4111037">n</span><span class="op" id="4111038">.</span><span class="ident" id="4111039">modW</span><span class="op" id="4111043">(</span><span class="ident" id="4111044">primesProduct32</span><span class="op" id="4111059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111062">case</span>&nbsp;<span class="num" id="4111067">64</span><span class="op" id="4111069">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111073">r</span>&nbsp;<span class="op" id="4111075">=</span>&nbsp;<span class="ident" id="4111077">n</span><span class="op" id="4111078">.</span><span class="ident" id="4111079">modW</span><span class="op" id="4111083">(</span><span class="ident" id="4111084">primesProduct64</span>&nbsp;<span class="op" id="4111100">&amp;</span>&nbsp;<span class="ident" id="4111102">_M</span><span class="op" id="4111104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111107">default</span><span class="op" id="4111114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4111118">panic</span><span class="op" id="4111123">(</span><span class="string" id="4111124">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="4111143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111150">if</span>&nbsp;<span class="ident" id="4111153">r</span><span class="op" id="4111154">%</span><span class="num" id="4111155">3</span>&nbsp;<span class="op" id="4111157">==</span>&nbsp;<span class="num" id="4111160">0</span>&nbsp;<span class="op" id="4111162">||</span>&nbsp;<span class="ident" id="4111165">r</span><span class="op" id="4111166">%</span><span class="num" id="4111167">5</span>&nbsp;<span class="op" id="4111169">==</span>&nbsp;<span class="num" id="4111172">0</span>&nbsp;<span class="op" id="4111174">||</span>&nbsp;<span class="ident" id="4111177">r</span><span class="op" id="4111178">%</span><span class="num" id="4111179">7</span>&nbsp;<span class="op" id="4111181">==</span>&nbsp;<span class="num" id="4111184">0</span>&nbsp;<span class="op" id="4111186">||</span>&nbsp;<span class="ident" id="4111189">r</span><span class="op" id="4111190">%</span><span class="num" id="4111191">11</span>&nbsp;<span class="op" id="4111194">==</span>&nbsp;<span class="num" id="4111197">0</span>&nbsp;<span class="op" id="4111199">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111204">r</span><span class="op" id="4111205">%</span><span class="num" id="4111206">13</span>&nbsp;<span class="op" id="4111209">==</span>&nbsp;<span class="num" id="4111212">0</span>&nbsp;<span class="op" id="4111214">||</span>&nbsp;<span class="ident" id="4111217">r</span><span class="op" id="4111218">%</span><span class="num" id="4111219">17</span>&nbsp;<span class="op" id="4111222">==</span>&nbsp;<span class="num" id="4111225">0</span>&nbsp;<span class="op" id="4111227">||</span>&nbsp;<span class="ident" id="4111230">r</span><span class="op" id="4111231">%</span><span class="num" id="4111232">19</span>&nbsp;<span class="op" id="4111235">==</span>&nbsp;<span class="num" id="4111238">0</span>&nbsp;<span class="op" id="4111240">||</span>&nbsp;<span class="ident" id="4111243">r</span><span class="op" id="4111244">%</span><span class="num" id="4111245">23</span>&nbsp;<span class="op" id="4111248">==</span>&nbsp;<span class="num" id="4111251">0</span>&nbsp;<span class="op" id="4111253">||</span>&nbsp;<span class="ident" id="4111256">r</span><span class="op" id="4111257">%</span><span class="num" id="4111258">29</span>&nbsp;<span class="op" id="4111261">==</span>&nbsp;<span class="num" id="4111264">0</span>&nbsp;<span class="op" id="4111266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111270">return</span>&nbsp;<span class="builtintype" id="4111277">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111288">if</span>&nbsp;<span class="ident" id="4111291">_W</span>&nbsp;<span class="op" id="4111294">==</span>&nbsp;<span class="num" id="4111297">64</span>&nbsp;<span class="op" id="4111300">&amp;&amp;</span>&nbsp;<span class="op" id="4111303">(</span><span class="ident" id="4111304">r</span><span class="op" id="4111305">%</span><span class="num" id="4111306">31</span>&nbsp;<span class="op" id="4111309">==</span>&nbsp;<span class="num" id="4111312">0</span>&nbsp;<span class="op" id="4111314">||</span>&nbsp;<span class="ident" id="4111317">r</span><span class="op" id="4111318">%</span><span class="num" id="4111319">37</span>&nbsp;<span class="op" id="4111322">==</span>&nbsp;<span class="num" id="4111325">0</span>&nbsp;<span class="op" id="4111327">||</span>&nbsp;<span class="ident" id="4111330">r</span><span class="op" id="4111331">%</span><span class="num" id="4111332">41</span>&nbsp;<span class="op" id="4111335">==</span>&nbsp;<span class="num" id="4111338">0</span>&nbsp;<span class="op" id="4111340">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111345">r</span><span class="op" id="4111346">%</span><span class="num" id="4111347">43</span>&nbsp;<span class="op" id="4111350">==</span>&nbsp;<span class="num" id="4111353">0</span>&nbsp;<span class="op" id="4111355">||</span>&nbsp;<span class="ident" id="4111358">r</span><span class="op" id="4111359">%</span><span class="num" id="4111360">47</span>&nbsp;<span class="op" id="4111363">==</span>&nbsp;<span class="num" id="4111366">0</span>&nbsp;<span class="op" id="4111368">||</span>&nbsp;<span class="ident" id="4111371">r</span><span class="op" id="4111372">%</span><span class="num" id="4111373">53</span>&nbsp;<span class="op" id="4111376">==</span>&nbsp;<span class="num" id="4111379">0</span><span class="op" id="4111380">)</span>&nbsp;<span class="op" id="4111382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111386">return</span>&nbsp;<span class="builtintype" id="4111393">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111404">nm1</span>&nbsp;<span class="op" id="4111408">:=</span>&nbsp;<span class="ident" id="4111411">nat</span><span class="op" id="4111414">(</span><span class="builtintype" id="4111415">nil</span><span class="op" id="4111418">)</span><span class="op" id="4111419">.</span><span class="ident" id="4111420">sub</span><span class="op" id="4111423">(</span><span class="ident" id="4111424">n</span><span class="op" id="4111425">,</span>&nbsp;<span class="ident" id="4111427">natOne</span><span class="op" id="4111433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4111436">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111478">k</span>&nbsp;<span class="op" id="4111480">:=</span>&nbsp;<span class="ident" id="4111483">nm1</span><span class="op" id="4111486">.</span><span class="ident" id="4111487">trailingZeroBits</span><span class="op" id="4111503">(</span><span class="op" id="4111504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111507">q</span>&nbsp;<span class="op" id="4111509">:=</span>&nbsp;<span class="ident" id="4111512">nat</span><span class="op" id="4111515">(</span><span class="builtintype" id="4111516">nil</span><span class="op" id="4111519">)</span><span class="op" id="4111520">.</span><span class="ident" id="4111521">shr</span><span class="op" id="4111524">(</span><span class="ident" id="4111525">nm1</span><span class="op" id="4111528">,</span>&nbsp;<span class="ident" id="4111530">k</span><span class="op" id="4111531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111535">nm3</span>&nbsp;<span class="op" id="4111539">:=</span>&nbsp;<span class="ident" id="4111542">nat</span><span class="op" id="4111545">(</span><span class="builtintype" id="4111546">nil</span><span class="op" id="4111549">)</span><span class="op" id="4111550">.</span><span class="ident" id="4111551">sub</span><span class="op" id="4111554">(</span><span class="ident" id="4111555">nm1</span><span class="op" id="4111558">,</span>&nbsp;<span class="ident" id="4111560">natTwo</span><span class="op" id="4111566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111569">rand</span>&nbsp;<span class="op" id="4111574">:=</span>&nbsp;<span class="ident" id="4111577">rand</span><span class="op" id="4111581">.</span><span class="ident" id="4111582">New</span><span class="op" id="4111585">(</span><span class="ident" id="4111586">rand</span><span class="op" id="4111590">.</span><span class="ident" id="4111591">NewSource</span><span class="op" id="4111600">(</span><span class="builtintype" id="4111601">int64</span><span class="op" id="4111606">(</span><span class="ident" id="4111607">n</span><span class="op" id="4111608">[</span><span class="num" id="4111609">0</span><span class="op" id="4111610">]</span><span class="op" id="4111611">)</span><span class="op" id="4111612">)</span><span class="op" id="4111613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111617">var</span>&nbsp;<span class="ident" id="4111621">x</span><span class="op" id="4111622">,</span>&nbsp;<span class="ident" id="4111624">y</span><span class="op" id="4111625">,</span>&nbsp;<span class="ident" id="4111627">quotient</span>&nbsp;<span class="ident" id="4111636">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111641">nm3Len</span>&nbsp;<span class="op" id="4111648">:=</span>&nbsp;<span class="ident" id="4111651">nm3</span><span class="op" id="4111654">.</span><span class="ident" id="4111655">bitLen</span><span class="op" id="4111661">(</span><span class="op" id="4111662">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="4111665">NextRandom</span><span class="op" id="4111675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111678">for</span>&nbsp;<span class="ident" id="4111682">i</span>&nbsp;<span class="op" id="4111684">:=</span>&nbsp;<span class="num" id="4111687">0</span><span class="op" id="4111688">;</span>&nbsp;<span class="ident" id="4111690">i</span>&nbsp;<span class="op" id="4111692">&lt;</span>&nbsp;<span class="ident" id="4111694">reps</span><span class="op" id="4111698">;</span>&nbsp;<span class="ident" id="4111700">i</span><span class="op" id="4111701">++</span>&nbsp;<span class="op" id="4111704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111708">x</span>&nbsp;<span class="op" id="4111710">=</span>&nbsp;<span class="ident" id="4111712">x</span><span class="op" id="4111713">.</span><span class="ident" id="4111714">random</span><span class="op" id="4111720">(</span><span class="ident" id="4111721">rand</span><span class="op" id="4111725">,</span>&nbsp;<span class="ident" id="4111727">nm3</span><span class="op" id="4111730">,</span>&nbsp;<span class="ident" id="4111732">nm3Len</span><span class="op" id="4111738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111742">x</span>&nbsp;<span class="op" id="4111744">=</span>&nbsp;<span class="ident" id="4111746">x</span><span class="op" id="4111747">.</span><span class="ident" id="4111748">add</span><span class="op" id="4111751">(</span><span class="ident" id="4111752">x</span><span class="op" id="4111753">,</span>&nbsp;<span class="ident" id="4111755">natTwo</span><span class="op" id="4111761">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111765">y</span>&nbsp;<span class="op" id="4111767">=</span>&nbsp;<span class="ident" id="4111769">y</span><span class="op" id="4111770">.</span><span class="ident" id="4111771">expNN</span><span class="op" id="4111776">(</span><span class="ident" id="4111777">x</span><span class="op" id="4111778">,</span>&nbsp;<span class="ident" id="4111780">q</span><span class="op" id="4111781">,</span>&nbsp;<span class="ident" id="4111783">n</span><span class="op" id="4111784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111788">if</span>&nbsp;<span class="ident" id="4111791">y</span><span class="op" id="4111792">.</span><span class="ident" id="4111793">cmp</span><span class="op" id="4111796">(</span><span class="ident" id="4111797">natOne</span><span class="op" id="4111803">)</span>&nbsp;<span class="op" id="4111805">==</span>&nbsp;<span class="num" id="4111808">0</span>&nbsp;<span class="op" id="4111810">||</span>&nbsp;<span class="ident" id="4111813">y</span><span class="op" id="4111814">.</span><span class="ident" id="4111815">cmp</span><span class="op" id="4111818">(</span><span class="ident" id="4111819">nm1</span><span class="op" id="4111822">)</span>&nbsp;<span class="op" id="4111824">==</span>&nbsp;<span class="num" id="4111827">0</span>&nbsp;<span class="op" id="4111829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111834">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111849">for</span>&nbsp;<span class="ident" id="4111853">j</span>&nbsp;<span class="op" id="4111855">:=</span>&nbsp;<span class="builtintype" id="4111858">uint</span><span class="op" id="4111862">(</span><span class="num" id="4111863">1</span><span class="op" id="4111864">)</span><span class="op" id="4111865">;</span>&nbsp;<span class="ident" id="4111867">j</span>&nbsp;<span class="op" id="4111869">&lt;</span>&nbsp;<span class="ident" id="4111871">k</span><span class="op" id="4111872">;</span>&nbsp;<span class="ident" id="4111874">j</span><span class="op" id="4111875">++</span>&nbsp;<span class="op" id="4111878">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111883">y</span>&nbsp;<span class="op" id="4111885">=</span>&nbsp;<span class="ident" id="4111887">y</span><span class="op" id="4111888">.</span><span class="ident" id="4111889">mul</span><span class="op" id="4111892">(</span><span class="ident" id="4111893">y</span><span class="op" id="4111894">,</span>&nbsp;<span class="ident" id="4111896">y</span><span class="op" id="4111897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4111902">quotient</span><span class="op" id="4111910">,</span>&nbsp;<span class="ident" id="4111912">y</span>&nbsp;<span class="op" id="4111914">=</span>&nbsp;<span class="ident" id="4111916">quotient</span><span class="op" id="4111924">.</span><span class="ident" id="4111925">div</span><span class="op" id="4111928">(</span><span class="ident" id="4111929">y</span><span class="op" id="4111930">,</span>&nbsp;<span class="ident" id="4111932">y</span><span class="op" id="4111933">,</span>&nbsp;<span class="ident" id="4111935">n</span><span class="op" id="4111936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111941">if</span>&nbsp;<span class="ident" id="4111944">y</span><span class="op" id="4111945">.</span><span class="ident" id="4111946">cmp</span><span class="op" id="4111949">(</span><span class="ident" id="4111950">nm1</span><span class="op" id="4111953">)</span>&nbsp;<span class="op" id="4111955">==</span>&nbsp;<span class="num" id="4111958">0</span>&nbsp;<span class="op" id="4111960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111966">continue</span>&nbsp;<span class="ident" id="4111975">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4111989">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4111994">if</span>&nbsp;<span class="ident" id="4111997">y</span><span class="op" id="4111998">.</span><span class="ident" id="4111999">cmp</span><span class="op" id="4112002">(</span><span class="ident" id="4112003">natOne</span><span class="op" id="4112009">)</span>&nbsp;<span class="op" id="4112011">==</span>&nbsp;<span class="num" id="4112014">0</span>&nbsp;<span class="op" id="4112016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112022">return</span>&nbsp;<span class="builtintype" id="4112029">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112046">return</span>&nbsp;<span class="builtintype" id="4112053">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112064">return</span>&nbsp;<span class="builtintype" id="4112071">true</span><br>
<span class="lineno"></span><span class="op" id="4112076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="4112079">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4112146">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4112213">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4112280">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="4112310">func</span>&nbsp;<span class="op" id="4112315">(</span><span class="ident" id="4112316">z</span>&nbsp;<span class="ident" id="4112318">nat</span><span class="op" id="4112321">)</span>&nbsp;<span class="ident" id="4112323">bytes</span><span class="op" id="4112328">(</span><span class="ident" id="4112329">buf</span>&nbsp;<span class="op" id="4112333">[</span><span class="op" id="4112334">]</span><span class="builtintype" id="4112335">byte</span><span class="op" id="4112339">)</span>&nbsp;<span class="op" id="4112341">(</span><span class="ident" id="4112342">i</span>&nbsp;<span class="builtintype" id="4112344">int</span><span class="op" id="4112347">)</span>&nbsp;<span class="op" id="4112349">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112352">i</span>&nbsp;<span class="op" id="4112354">=</span>&nbsp;<span class="builtinfunc" id="4112356">len</span><span class="op" id="4112359">(</span><span class="ident" id="4112360">buf</span><span class="op" id="4112363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112366">for</span>&nbsp;<span class="ident" id="4112370">_</span><span class="op" id="4112371">,</span>&nbsp;<span class="ident" id="4112373">d</span>&nbsp;<span class="op" id="4112375">:=</span>&nbsp;<span class="keyword" id="4112378">range</span>&nbsp;<span class="ident" id="4112384">z</span>&nbsp;<span class="op" id="4112386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112390">for</span>&nbsp;<span class="ident" id="4112394">j</span>&nbsp;<span class="op" id="4112396">:=</span>&nbsp;<span class="num" id="4112399">0</span><span class="op" id="4112400">;</span>&nbsp;<span class="ident" id="4112402">j</span>&nbsp;<span class="op" id="4112404">&lt;</span>&nbsp;<span class="ident" id="4112406">_S</span><span class="op" id="4112408">;</span>&nbsp;<span class="ident" id="4112410">j</span><span class="op" id="4112411">++</span>&nbsp;<span class="op" id="4112414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112419">i</span><span class="op" id="4112420">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112426">buf</span><span class="op" id="4112429">[</span><span class="ident" id="4112430">i</span><span class="op" id="4112431">]</span>&nbsp;<span class="op" id="4112433">=</span>&nbsp;<span class="builtintype" id="4112435">byte</span><span class="op" id="4112439">(</span><span class="ident" id="4112440">d</span><span class="op" id="4112441">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112446">d</span>&nbsp;<span class="op" id="4112448">&gt;&gt;=</span>&nbsp;<span class="num" id="4112452">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112463">for</span>&nbsp;<span class="ident" id="4112467">i</span>&nbsp;<span class="op" id="4112469">&lt;</span>&nbsp;<span class="builtinfunc" id="4112471">len</span><span class="op" id="4112474">(</span><span class="ident" id="4112475">buf</span><span class="op" id="4112478">)</span>&nbsp;<span class="op" id="4112480">&amp;&amp;</span>&nbsp;<span class="ident" id="4112483">buf</span><span class="op" id="4112486">[</span><span class="ident" id="4112487">i</span><span class="op" id="4112488">]</span>&nbsp;<span class="op" id="4112490">==</span>&nbsp;<span class="num" id="4112493">0</span>&nbsp;<span class="op" id="4112495">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112499">i</span><span class="op" id="4112500">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112508">return</span><br>
<span class="lineno"></span><span class="op" id="4112515">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="4112518">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="4112583">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="4112632">func</span>&nbsp;<span class="op" id="4112637">(</span><span class="ident" id="4112638">z</span>&nbsp;<span class="ident" id="4112640">nat</span><span class="op" id="4112643">)</span>&nbsp;<span class="ident" id="4112645">setBytes</span><span class="op" id="4112653">(</span><span class="ident" id="4112654">buf</span>&nbsp;<span class="op" id="4112658">[</span><span class="op" id="4112659">]</span><span class="builtintype" id="4112660">byte</span><span class="op" id="4112664">)</span>&nbsp;<span class="ident" id="4112666">nat</span>&nbsp;<span class="op" id="4112670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112673">z</span>&nbsp;<span class="op" id="4112675">=</span>&nbsp;<span class="ident" id="4112677">z</span><span class="op" id="4112678">.</span><span class="builtinfunc" id="4112679">make</span><span class="op" id="4112683">(</span><span class="op" id="4112684">(</span><span class="builtinfunc" id="4112685">len</span><span class="op" id="4112688">(</span><span class="ident" id="4112689">buf</span><span class="op" id="4112692">)</span>&nbsp;<span class="op" id="4112694">+</span>&nbsp;<span class="ident" id="4112696">_S</span>&nbsp;<span class="op" id="4112699">-</span>&nbsp;<span class="num" id="4112701">1</span><span class="op" id="4112702">)</span>&nbsp;<span class="op" id="4112704">/</span>&nbsp;<span class="ident" id="4112706">_S</span><span class="op" id="4112708">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112712">k</span>&nbsp;<span class="op" id="4112714">:=</span>&nbsp;<span class="num" id="4112717">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112720">s</span>&nbsp;<span class="op" id="4112722">:=</span>&nbsp;<span class="builtintype" id="4112725">uint</span><span class="op" id="4112729">(</span><span class="num" id="4112730">0</span><span class="op" id="4112731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112734">var</span>&nbsp;<span class="ident" id="4112738">d</span>&nbsp;<span class="ident" id="4112740">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112746">for</span>&nbsp;<span class="ident" id="4112750">i</span>&nbsp;<span class="op" id="4112752">:=</span>&nbsp;<span class="builtinfunc" id="4112755">len</span><span class="op" id="4112758">(</span><span class="ident" id="4112759">buf</span><span class="op" id="4112762">)</span><span class="op" id="4112763">;</span>&nbsp;<span class="ident" id="4112765">i</span>&nbsp;<span class="op" id="4112767">&gt;</span>&nbsp;<span class="num" id="4112769">0</span><span class="op" id="4112770">;</span>&nbsp;<span class="ident" id="4112772">i</span><span class="op" id="4112773">--</span>&nbsp;<span class="op" id="4112776">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112780">d</span>&nbsp;<span class="op" id="4112782">|=</span>&nbsp;<span class="ident" id="4112785">Word</span><span class="op" id="4112789">(</span><span class="ident" id="4112790">buf</span><span class="op" id="4112793">[</span><span class="ident" id="4112794">i</span><span class="op" id="4112795">-</span><span class="num" id="4112796">1</span><span class="op" id="4112797">]</span><span class="op" id="4112798">)</span>&nbsp;<span class="op" id="4112800">&lt;&lt;</span>&nbsp;<span class="ident" id="4112803">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112807">if</span>&nbsp;<span class="ident" id="4112810">s</span>&nbsp;<span class="op" id="4112812">+=</span>&nbsp;<span class="num" id="4112815">8</span><span class="op" id="4112816">;</span>&nbsp;<span class="ident" id="4112818">s</span>&nbsp;<span class="op" id="4112820">==</span>&nbsp;<span class="ident" id="4112823">_S</span><span class="op" id="4112825">*</span><span class="num" id="4112826">8</span>&nbsp;<span class="op" id="4112828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112833">z</span><span class="op" id="4112834">[</span><span class="ident" id="4112835">k</span><span class="op" id="4112836">]</span>&nbsp;<span class="op" id="4112838">=</span>&nbsp;<span class="ident" id="4112840">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112845">k</span><span class="op" id="4112846">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112852">s</span>&nbsp;<span class="op" id="4112854">=</span>&nbsp;<span class="num" id="4112856">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112861">d</span>&nbsp;<span class="op" id="4112863">=</span>&nbsp;<span class="num" id="4112865">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112875">if</span>&nbsp;<span class="ident" id="4112878">k</span>&nbsp;<span class="op" id="4112880">&lt;</span>&nbsp;<span class="builtinfunc" id="4112882">len</span><span class="op" id="4112885">(</span><span class="ident" id="4112886">z</span><span class="op" id="4112887">)</span>&nbsp;<span class="op" id="4112889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4112893">z</span><span class="op" id="4112894">[</span><span class="ident" id="4112895">k</span><span class="op" id="4112896">]</span>&nbsp;<span class="op" id="4112898">=</span>&nbsp;<span class="ident" id="4112900">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4112903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4112907">return</span>&nbsp;<span class="ident" id="4112914">z</span><span class="op" id="4112915">.</span><span class="ident" id="4112916">norm</span><span class="op" id="4112920">(</span><span class="op" id="4112921">)</span><br>
<span class="lineno"></span><span class="op" id="4112923">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
