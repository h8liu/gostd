<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3260240">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3260295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3260349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3260400">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3260449">package</span>&nbsp;<span class="ident" id="3260457">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3260462">import</span>&nbsp;<span class="op" id="3260469">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3260472">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3260480">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3260487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3260490">const</span>&nbsp;<span class="ident" id="3260496">cacheMaxAge</span>&nbsp;<span class="op" id="3260508">=</span>&nbsp;<span class="num" id="3260510">5</span>&nbsp;<span class="op" id="3260512">*</span>&nbsp;<span class="ident" id="3260514">time</span><span class="op" id="3260518">.</span><span class="ident" id="3260519">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3260527">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3260591">var</span>&nbsp;<span class="ident" id="3260595">hostsPath</span>&nbsp;<span class="op" id="3260605">=</span>&nbsp;<span class="string" id="3260607">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3260621">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3260638">var</span>&nbsp;<span class="ident" id="3260642">hosts</span>&nbsp;<span class="keyword" id="3260648">struct</span>&nbsp;<span class="op" id="3260655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260658">sync</span><span class="op" id="3260662">.</span><span class="ident" id="3260663">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260670">byName</span>&nbsp;<span class="keyword" id="3260677">map</span><span class="op" id="3260680">[</span><span class="builtintype" id="3260681">string</span><span class="op" id="3260687">]</span><span class="op" id="3260688">[</span><span class="op" id="3260689">]</span><span class="builtintype" id="3260690">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260698">byAddr</span>&nbsp;<span class="keyword" id="3260705">map</span><span class="op" id="3260708">[</span><span class="builtintype" id="3260709">string</span><span class="op" id="3260715">]</span><span class="op" id="3260716">[</span><span class="op" id="3260717">]</span><span class="builtintype" id="3260718">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260726">expire</span>&nbsp;<span class="ident" id="3260733">time</span><span class="op" id="3260737">.</span><span class="ident" id="3260738">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260744">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3260751">string</span><br>
<span class="lineno"></span><span class="op" id="3260758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3260761">func</span>&nbsp;<span class="ident" id="3260766">readHosts</span><span class="op" id="3260775">(</span><span class="op" id="3260776">)</span>&nbsp;<span class="op" id="3260778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260781">now</span>&nbsp;<span class="op" id="3260785">:=</span>&nbsp;<span class="ident" id="3260788">time</span><span class="op" id="3260792">.</span><span class="ident" id="3260793">Now</span><span class="op" id="3260796">(</span><span class="op" id="3260797">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260800">hp</span>&nbsp;<span class="op" id="3260803">:=</span>&nbsp;<span class="ident" id="3260806">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260817">if</span>&nbsp;<span class="builtinfunc" id="3260820">len</span><span class="op" id="3260823">(</span><span class="ident" id="3260824">hosts</span><span class="op" id="3260829">.</span><span class="ident" id="3260830">byName</span><span class="op" id="3260836">)</span>&nbsp;<span class="op" id="3260838">==</span>&nbsp;<span class="num" id="3260841">0</span>&nbsp;<span class="op" id="3260843">||</span>&nbsp;<span class="ident" id="3260846">now</span><span class="op" id="3260849">.</span><span class="ident" id="3260850">After</span><span class="op" id="3260855">(</span><span class="ident" id="3260856">hosts</span><span class="op" id="3260861">.</span><span class="ident" id="3260862">expire</span><span class="op" id="3260868">)</span>&nbsp;<span class="op" id="3260870">||</span>&nbsp;<span class="ident" id="3260873">hosts</span><span class="op" id="3260878">.</span><span class="ident" id="3260879">path</span>&nbsp;<span class="op" id="3260884">!=</span>&nbsp;<span class="ident" id="3260887">hp</span>&nbsp;<span class="op" id="3260890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260894">hs</span>&nbsp;<span class="op" id="3260897">:=</span>&nbsp;<span class="builtinfunc" id="3260900">make</span><span class="op" id="3260904">(</span><span class="keyword" id="3260905">map</span><span class="op" id="3260908">[</span><span class="builtintype" id="3260909">string</span><span class="op" id="3260915">]</span><span class="op" id="3260916">[</span><span class="op" id="3260917">]</span><span class="builtintype" id="3260918">string</span><span class="op" id="3260924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260928">is</span>&nbsp;<span class="op" id="3260931">:=</span>&nbsp;<span class="builtinfunc" id="3260934">make</span><span class="op" id="3260938">(</span><span class="keyword" id="3260939">map</span><span class="op" id="3260942">[</span><span class="builtintype" id="3260943">string</span><span class="op" id="3260949">]</span><span class="op" id="3260950">[</span><span class="op" id="3260951">]</span><span class="builtintype" id="3260952">string</span><span class="op" id="3260958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260962">var</span>&nbsp;<span class="ident" id="3260966">file</span>&nbsp;<span class="op" id="3260971">*</span><span class="ident" id="3260972">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260979">if</span>&nbsp;<span class="ident" id="3260982">file</span><span class="op" id="3260986">,</span>&nbsp;<span class="ident" id="3260988">_</span>&nbsp;<span class="op" id="3260990">=</span>&nbsp;<span class="ident" id="3260992">open</span><span class="op" id="3260996">(</span><span class="ident" id="3260997">hp</span><span class="op" id="3260999">)</span><span class="op" id="3261000">;</span>&nbsp;<span class="ident" id="3261002">file</span>&nbsp;<span class="op" id="3261007">==</span>&nbsp;<span class="builtintype" id="3261010">nil</span>&nbsp;<span class="op" id="3261014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261019">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261032">for</span>&nbsp;<span class="ident" id="3261036">line</span><span class="op" id="3261040">,</span>&nbsp;<span class="ident" id="3261042">ok</span>&nbsp;<span class="op" id="3261045">:=</span>&nbsp;<span class="ident" id="3261048">file</span><span class="op" id="3261052">.</span><span class="ident" id="3261053">readLine</span><span class="op" id="3261061">(</span><span class="op" id="3261062">)</span><span class="op" id="3261063">;</span>&nbsp;<span class="ident" id="3261065">ok</span><span class="op" id="3261067">;</span>&nbsp;<span class="ident" id="3261069">line</span><span class="op" id="3261073">,</span>&nbsp;<span class="ident" id="3261075">ok</span>&nbsp;<span class="op" id="3261078">=</span>&nbsp;<span class="ident" id="3261080">file</span><span class="op" id="3261084">.</span><span class="ident" id="3261085">readLine</span><span class="op" id="3261093">(</span><span class="op" id="3261094">)</span>&nbsp;<span class="op" id="3261096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261101">if</span>&nbsp;<span class="ident" id="3261104">i</span>&nbsp;<span class="op" id="3261106">:=</span>&nbsp;<span class="ident" id="3261109">byteIndex</span><span class="op" id="3261118">(</span><span class="ident" id="3261119">line</span><span class="op" id="3261123">,</span>&nbsp;<span class="string" id="3261125">&#39;#&#39;</span><span class="op" id="3261128">)</span><span class="op" id="3261129">;</span>&nbsp;<span class="ident" id="3261131">i</span>&nbsp;<span class="op" id="3261133">&gt;=</span>&nbsp;<span class="num" id="3261136">0</span>&nbsp;<span class="op" id="3261138">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261144">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261169">line</span>&nbsp;<span class="op" id="3261174">=</span>&nbsp;<span class="ident" id="3261176">line</span><span class="op" id="3261180">[</span><span class="num" id="3261181">0</span><span class="op" id="3261182">:</span><span class="ident" id="3261183">i</span><span class="op" id="3261184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261194">f</span>&nbsp;<span class="op" id="3261196">:=</span>&nbsp;<span class="ident" id="3261199">getFields</span><span class="op" id="3261208">(</span><span class="ident" id="3261209">line</span><span class="op" id="3261213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261218">if</span>&nbsp;<span class="builtinfunc" id="3261221">len</span><span class="op" id="3261224">(</span><span class="ident" id="3261225">f</span><span class="op" id="3261226">)</span>&nbsp;<span class="op" id="3261228">&lt;</span>&nbsp;<span class="num" id="3261230">2</span>&nbsp;<span class="op" id="3261232">||</span>&nbsp;<span class="ident" id="3261235">ParseIP</span><span class="op" id="3261242">(</span><span class="ident" id="3261243">f</span><span class="op" id="3261244">[</span><span class="num" id="3261245">0</span><span class="op" id="3261246">]</span><span class="op" id="3261247">)</span>&nbsp;<span class="op" id="3261249">==</span>&nbsp;<span class="builtintype" id="3261252">nil</span>&nbsp;<span class="op" id="3261256">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261262">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261279">for</span>&nbsp;<span class="ident" id="3261283">i</span>&nbsp;<span class="op" id="3261285">:=</span>&nbsp;<span class="num" id="3261288">1</span><span class="op" id="3261289">;</span>&nbsp;<span class="ident" id="3261291">i</span>&nbsp;<span class="op" id="3261293">&lt;</span>&nbsp;<span class="builtinfunc" id="3261295">len</span><span class="op" id="3261298">(</span><span class="ident" id="3261299">f</span><span class="op" id="3261300">)</span><span class="op" id="3261301">;</span>&nbsp;<span class="ident" id="3261303">i</span><span class="op" id="3261304">++</span>&nbsp;<span class="op" id="3261307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261313">h</span>&nbsp;<span class="op" id="3261315">:=</span>&nbsp;<span class="ident" id="3261318">f</span><span class="op" id="3261319">[</span><span class="ident" id="3261320">i</span><span class="op" id="3261321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261327">hs</span><span class="op" id="3261329">[</span><span class="ident" id="3261330">h</span><span class="op" id="3261331">]</span>&nbsp;<span class="op" id="3261333">=</span>&nbsp;<span class="builtinfunc" id="3261335">append</span><span class="op" id="3261341">(</span><span class="ident" id="3261342">hs</span><span class="op" id="3261344">[</span><span class="ident" id="3261345">h</span><span class="op" id="3261346">]</span><span class="op" id="3261347">,</span>&nbsp;<span class="ident" id="3261349">f</span><span class="op" id="3261350">[</span><span class="num" id="3261351">0</span><span class="op" id="3261352">]</span><span class="op" id="3261353">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261359">is</span><span class="op" id="3261361">[</span><span class="ident" id="3261362">f</span><span class="op" id="3261363">[</span><span class="num" id="3261364">0</span><span class="op" id="3261365">]</span><span class="op" id="3261366">]</span>&nbsp;<span class="op" id="3261368">=</span>&nbsp;<span class="builtinfunc" id="3261370">append</span><span class="op" id="3261376">(</span><span class="ident" id="3261377">is</span><span class="op" id="3261379">[</span><span class="ident" id="3261380">f</span><span class="op" id="3261381">[</span><span class="num" id="3261382">0</span><span class="op" id="3261383">]</span><span class="op" id="3261384">]</span><span class="op" id="3261385">,</span>&nbsp;<span class="ident" id="3261387">h</span><span class="op" id="3261388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261401">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261429">hosts</span><span class="op" id="3261434">.</span><span class="ident" id="3261435">expire</span>&nbsp;<span class="op" id="3261442">=</span>&nbsp;<span class="ident" id="3261444">now</span><span class="op" id="3261447">.</span><span class="ident" id="3261448">Add</span><span class="op" id="3261451">(</span><span class="ident" id="3261452">cacheMaxAge</span><span class="op" id="3261463">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261467">hosts</span><span class="op" id="3261472">.</span><span class="ident" id="3261473">path</span>&nbsp;<span class="op" id="3261478">=</span>&nbsp;<span class="ident" id="3261480">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261485">hosts</span><span class="op" id="3261490">.</span><span class="ident" id="3261491">byName</span>&nbsp;<span class="op" id="3261498">=</span>&nbsp;<span class="ident" id="3261500">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261505">hosts</span><span class="op" id="3261510">.</span><span class="ident" id="3261511">byAddr</span>&nbsp;<span class="op" id="3261518">=</span>&nbsp;<span class="ident" id="3261520">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261525">file</span><span class="op" id="3261529">.</span><span class="builtinfunc" id="3261530">close</span><span class="op" id="3261535">(</span><span class="op" id="3261536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261539">}</span><br>
<span class="lineno">60</span><span class="op" id="3261541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3261544">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3261623">func</span>&nbsp;<span class="ident" id="3261628">lookupStaticHost</span><span class="op" id="3261644">(</span><span class="ident" id="3261645">host</span>&nbsp;<span class="builtintype" id="3261650">string</span><span class="op" id="3261656">)</span>&nbsp;<span class="op" id="3261658">[</span><span class="op" id="3261659">]</span><span class="builtintype" id="3261660">string</span>&nbsp;<span class="op" id="3261667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261670">hosts</span><span class="op" id="3261675">.</span><span class="ident" id="3261676">Lock</span><span class="op" id="3261680">(</span><span class="op" id="3261681">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261684">defer</span>&nbsp;<span class="ident" id="3261690">hosts</span><span class="op" id="3261695">.</span><span class="ident" id="3261696">Unlock</span><span class="op" id="3261702">(</span><span class="op" id="3261703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261706">readHosts</span><span class="op" id="3261715">(</span><span class="op" id="3261716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261719">if</span>&nbsp;<span class="builtinfunc" id="3261722">len</span><span class="op" id="3261725">(</span><span class="ident" id="3261726">hosts</span><span class="op" id="3261731">.</span><span class="ident" id="3261732">byName</span><span class="op" id="3261738">)</span>&nbsp;<span class="op" id="3261740">!=</span>&nbsp;<span class="num" id="3261743">0</span>&nbsp;<span class="op" id="3261745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261749">if</span>&nbsp;<span class="ident" id="3261752">ips</span><span class="op" id="3261755">,</span>&nbsp;<span class="ident" id="3261757">ok</span>&nbsp;<span class="op" id="3261760">:=</span>&nbsp;<span class="ident" id="3261763">hosts</span><span class="op" id="3261768">.</span><span class="ident" id="3261769">byName</span><span class="op" id="3261775">[</span><span class="ident" id="3261776">host</span><span class="op" id="3261780">]</span><span class="op" id="3261781">;</span>&nbsp;<span class="ident" id="3261783">ok</span>&nbsp;<span class="op" id="3261786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261791">return</span>&nbsp;<span class="ident" id="3261798">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261810">return</span>&nbsp;<span class="builtintype" id="3261817">nil</span><br>
<span class="lineno"></span><span class="op" id="3261821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3261824">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3261902">func</span>&nbsp;<span class="ident" id="3261907">lookupStaticAddr</span><span class="op" id="3261923">(</span><span class="ident" id="3261924">addr</span>&nbsp;<span class="builtintype" id="3261929">string</span><span class="op" id="3261935">)</span>&nbsp;<span class="op" id="3261937">[</span><span class="op" id="3261938">]</span><span class="builtintype" id="3261939">string</span>&nbsp;<span class="op" id="3261946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261949">hosts</span><span class="op" id="3261954">.</span><span class="ident" id="3261955">Lock</span><span class="op" id="3261959">(</span><span class="op" id="3261960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261963">defer</span>&nbsp;<span class="ident" id="3261969">hosts</span><span class="op" id="3261974">.</span><span class="ident" id="3261975">Unlock</span><span class="op" id="3261981">(</span><span class="op" id="3261982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261985">readHosts</span><span class="op" id="3261994">(</span><span class="op" id="3261995">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261998">if</span>&nbsp;<span class="builtinfunc" id="3262001">len</span><span class="op" id="3262004">(</span><span class="ident" id="3262005">hosts</span><span class="op" id="3262010">.</span><span class="ident" id="3262011">byAddr</span><span class="op" id="3262017">)</span>&nbsp;<span class="op" id="3262019">!=</span>&nbsp;<span class="num" id="3262022">0</span>&nbsp;<span class="op" id="3262024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262028">if</span>&nbsp;<span class="ident" id="3262031">hosts</span><span class="op" id="3262036">,</span>&nbsp;<span class="ident" id="3262038">ok</span>&nbsp;<span class="op" id="3262041">:=</span>&nbsp;<span class="ident" id="3262044">hosts</span><span class="op" id="3262049">.</span><span class="ident" id="3262050">byAddr</span><span class="op" id="3262056">[</span><span class="ident" id="3262057">addr</span><span class="op" id="3262061">]</span><span class="op" id="3262062">;</span>&nbsp;<span class="ident" id="3262064">ok</span>&nbsp;<span class="op" id="3262067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262072">return</span>&nbsp;<span class="ident" id="3262079">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262090">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262093">return</span>&nbsp;<span class="builtintype" id="3262100">nil</span><br>
<span class="lineno"></span><span class="op" id="3262104">}</span>
</div>
</body>
</html>
