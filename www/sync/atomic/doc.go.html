<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1856473">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1856529">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1856583">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1856634">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1856696">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1856751">//</span><br>
<span class="lineno"></span><span class="comment" id="1856754">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1856814">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1856887">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1856948">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1856982">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1857022">//</span><br>
<span class="lineno"></span><span class="comment" id="1857025">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1857098">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1857116">//</span><br>
<span class="lineno"></span><span class="comment" id="1857119">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1857134">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1857149">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1857163">//</span><br>
<span class="lineno"></span><span class="comment" id="1857166">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1857236">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1857279">//</span><br>
<span class="lineno"></span><span class="comment" id="1857282">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1857303">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1857319">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1857335">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1857340">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1857356">//</span><br>
<span class="lineno">30</span><span class="comment" id="1857359">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1857430">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1857448">//</span><br>
<span class="lineno"></span><span class="comment" id="1857451">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1857469">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1857485">//</span><br>
<span class="lineno"></span><span class="comment" id="1857488">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1857558">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1857621">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1857639">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1857642">package</span>&nbsp;<span class="ident" id="1857650">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1857658">import</span>&nbsp;<span class="op" id="1857665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1857668">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1857677">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1857680">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1857778">//</span><br>
<span class="lineno"></span><span class="comment" id="1857781">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1857876">//</span><br>
<span class="lineno">50</span><span class="comment" id="1857879">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1857962">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1858039">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1858111">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1858131">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1858215">func</span>&nbsp;<span class="ident" id="1858220">SwapInt32</span><span class="op" id="1858229">(</span><span class="ident" id="1858230">addr</span>&nbsp;<span class="op" id="1858235">*</span><span class="builtintype" id="1858236">int32</span><span class="op" id="1858241">,</span>&nbsp;<span class="builtinfunc" id="1858243">new</span>&nbsp;<span class="builtintype" id="1858247">int32</span><span class="op" id="1858252">)</span>&nbsp;<span class="op" id="1858254">(</span><span class="ident" id="1858255">old</span>&nbsp;<span class="builtintype" id="1858259">int32</span><span class="op" id="1858264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858267">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1858351">func</span>&nbsp;<span class="ident" id="1858356">SwapInt64</span><span class="op" id="1858365">(</span><span class="ident" id="1858366">addr</span>&nbsp;<span class="op" id="1858371">*</span><span class="ident" id="1858372">int64</span><span class="op" id="1858377">,</span>&nbsp;<span class="builtinfunc" id="1858379">new</span>&nbsp;<span class="ident" id="1858383">int64</span><span class="op" id="1858388">)</span>&nbsp;<span class="op" id="1858390">(</span><span class="ident" id="1858391">old</span>&nbsp;<span class="ident" id="1858395">int64</span><span class="op" id="1858400">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1858403">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1858488">func</span>&nbsp;<span class="ident" id="1858493">SwapUint32</span><span class="op" id="1858503">(</span><span class="ident" id="1858504">addr</span>&nbsp;<span class="op" id="1858509">*</span><span class="builtintype" id="1858510">uint32</span><span class="op" id="1858516">,</span>&nbsp;<span class="builtinfunc" id="1858518">new</span>&nbsp;<span class="builtintype" id="1858522">uint32</span><span class="op" id="1858528">)</span>&nbsp;<span class="op" id="1858530">(</span><span class="ident" id="1858531">old</span>&nbsp;<span class="builtintype" id="1858535">uint32</span><span class="op" id="1858541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858544">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1858629">func</span>&nbsp;<span class="ident" id="1858634">SwapUint64</span><span class="op" id="1858644">(</span><span class="ident" id="1858645">addr</span>&nbsp;<span class="op" id="1858650">*</span><span class="ident" id="1858651">uint64</span><span class="op" id="1858657">,</span>&nbsp;<span class="builtinfunc" id="1858659">new</span>&nbsp;<span class="ident" id="1858663">uint64</span><span class="op" id="1858669">)</span>&nbsp;<span class="op" id="1858671">(</span><span class="ident" id="1858672">old</span>&nbsp;<span class="ident" id="1858676">uint64</span><span class="op" id="1858682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858685">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1858771">func</span>&nbsp;<span class="ident" id="1858776">SwapUintptr</span><span class="op" id="1858787">(</span><span class="ident" id="1858788">addr</span>&nbsp;<span class="op" id="1858793">*</span><span class="builtintype" id="1858794">uintptr</span><span class="op" id="1858801">,</span>&nbsp;<span class="builtinfunc" id="1858803">new</span>&nbsp;<span class="builtintype" id="1858807">uintptr</span><span class="op" id="1858814">)</span>&nbsp;<span class="op" id="1858816">(</span><span class="ident" id="1858817">old</span>&nbsp;<span class="builtintype" id="1858821">uintptr</span><span class="op" id="1858828">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1858831">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1858917">func</span>&nbsp;<span class="ident" id="1858922">SwapPointer</span><span class="op" id="1858933">(</span><span class="ident" id="1858934">addr</span>&nbsp;<span class="op" id="1858939">*</span><span class="ident" id="1858940"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1858946">.</span><span class="ident" id="1858947">Pointer</span><span class="op" id="1858954">,</span>&nbsp;<span class="builtinfunc" id="1858956">new</span>&nbsp;<span class="ident" id="1858960"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1858966">.</span><span class="ident" id="1858967">Pointer</span><span class="op" id="1858974">)</span>&nbsp;<span class="op" id="1858976">(</span><span class="ident" id="1858977">old</span>&nbsp;<span class="ident" id="1858981"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1858987">.</span><span class="ident" id="1858988">Pointer</span><span class="op" id="1858995">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1858998">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1859081">func</span>&nbsp;<span class="ident" id="1859086">CompareAndSwapInt32</span><span class="op" id="1859105">(</span><span class="ident" id="1859106">addr</span>&nbsp;<span class="op" id="1859111">*</span><span class="builtintype" id="1859112">int32</span><span class="op" id="1859117">,</span>&nbsp;<span class="ident" id="1859119">old</span><span class="op" id="1859122">,</span>&nbsp;<span class="builtinfunc" id="1859124">new</span>&nbsp;<span class="builtintype" id="1859128">int32</span><span class="op" id="1859133">)</span>&nbsp;<span class="op" id="1859135">(</span><span class="ident" id="1859136">swapped</span>&nbsp;<span class="builtintype" id="1859144">bool</span><span class="op" id="1859148">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1859151">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1859234">func</span>&nbsp;<span class="ident" id="1859239">CompareAndSwapInt64</span><span class="op" id="1859258">(</span><span class="ident" id="1859259">addr</span>&nbsp;<span class="op" id="1859264">*</span><span class="ident" id="1859265">int64</span><span class="op" id="1859270">,</span>&nbsp;<span class="ident" id="1859272">old</span><span class="op" id="1859275">,</span>&nbsp;<span class="builtinfunc" id="1859277">new</span>&nbsp;<span class="ident" id="1859281">int64</span><span class="op" id="1859286">)</span>&nbsp;<span class="op" id="1859288">(</span><span class="ident" id="1859289">swapped</span>&nbsp;<span class="builtintype" id="1859297">bool</span><span class="op" id="1859301">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859304">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1859388">func</span>&nbsp;<span class="ident" id="1859393">CompareAndSwapUint32</span><span class="op" id="1859413">(</span><span class="ident" id="1859414">addr</span>&nbsp;<span class="op" id="1859419">*</span><span class="builtintype" id="1859420">uint32</span><span class="op" id="1859426">,</span>&nbsp;<span class="ident" id="1859428">old</span><span class="op" id="1859431">,</span>&nbsp;<span class="builtinfunc" id="1859433">new</span>&nbsp;<span class="builtintype" id="1859437">uint32</span><span class="op" id="1859443">)</span>&nbsp;<span class="op" id="1859445">(</span><span class="ident" id="1859446">swapped</span>&nbsp;<span class="builtintype" id="1859454">bool</span><span class="op" id="1859458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859461">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1859545">func</span>&nbsp;<span class="ident" id="1859550">CompareAndSwapUint64</span><span class="op" id="1859570">(</span><span class="ident" id="1859571">addr</span>&nbsp;<span class="op" id="1859576">*</span><span class="ident" id="1859577">uint64</span><span class="op" id="1859583">,</span>&nbsp;<span class="ident" id="1859585">old</span><span class="op" id="1859588">,</span>&nbsp;<span class="builtinfunc" id="1859590">new</span>&nbsp;<span class="ident" id="1859594">uint64</span><span class="op" id="1859600">)</span>&nbsp;<span class="op" id="1859602">(</span><span class="ident" id="1859603">swapped</span>&nbsp;<span class="builtintype" id="1859611">bool</span><span class="op" id="1859615">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1859618">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1859704">func</span>&nbsp;<span class="ident" id="1859709">CompareAndSwapUintptr</span><span class="op" id="1859730">(</span><span class="ident" id="1859731">addr</span>&nbsp;<span class="op" id="1859736">*</span><span class="builtintype" id="1859737">uintptr</span><span class="op" id="1859744">,</span>&nbsp;<span class="ident" id="1859746">old</span><span class="op" id="1859749">,</span>&nbsp;<span class="builtinfunc" id="1859751">new</span>&nbsp;<span class="builtintype" id="1859755">uintptr</span><span class="op" id="1859762">)</span>&nbsp;<span class="op" id="1859764">(</span><span class="ident" id="1859765">swapped</span>&nbsp;<span class="builtintype" id="1859773">bool</span><span class="op" id="1859777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1859780">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1859873">func</span>&nbsp;<span class="ident" id="1859878">CompareAndSwapPointer</span><span class="op" id="1859899">(</span><span class="ident" id="1859900">addr</span>&nbsp;<span class="op" id="1859905">*</span><span class="ident" id="1859906"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1859912">.</span><span class="ident" id="1859913">Pointer</span><span class="op" id="1859920">,</span>&nbsp;<span class="ident" id="1859922">old</span><span class="op" id="1859925">,</span>&nbsp;<span class="builtinfunc" id="1859927">new</span>&nbsp;<span class="ident" id="1859931"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1859937">.</span><span class="ident" id="1859938">Pointer</span><span class="op" id="1859945">)</span>&nbsp;<span class="op" id="1859947">(</span><span class="ident" id="1859948">swapped</span>&nbsp;<span class="builtintype" id="1859956">bool</span><span class="op" id="1859960">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1859963">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1860033">func</span>&nbsp;<span class="ident" id="1860038">AddInt32</span><span class="op" id="1860046">(</span><span class="ident" id="1860047">addr</span>&nbsp;<span class="op" id="1860052">*</span><span class="builtintype" id="1860053">int32</span><span class="op" id="1860058">,</span>&nbsp;<span class="ident" id="1860060">delta</span>&nbsp;<span class="builtintype" id="1860066">int32</span><span class="op" id="1860071">)</span>&nbsp;<span class="op" id="1860073">(</span><span class="builtinfunc" id="1860074">new</span>&nbsp;<span class="builtintype" id="1860078">int32</span><span class="op" id="1860083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860086">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1860157">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1860247">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1860311">func</span>&nbsp;<span class="ident" id="1860316">AddUint32</span><span class="op" id="1860325">(</span><span class="ident" id="1860326">addr</span>&nbsp;<span class="op" id="1860331">*</span><span class="builtintype" id="1860332">uint32</span><span class="op" id="1860338">,</span>&nbsp;<span class="ident" id="1860340">delta</span>&nbsp;<span class="builtintype" id="1860346">uint32</span><span class="op" id="1860352">)</span>&nbsp;<span class="op" id="1860354">(</span><span class="builtinfunc" id="1860355">new</span>&nbsp;<span class="builtintype" id="1860359">uint32</span><span class="op" id="1860365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860368">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1860438">func</span>&nbsp;<span class="ident" id="1860443">AddInt64</span><span class="op" id="1860451">(</span><span class="ident" id="1860452">addr</span>&nbsp;<span class="op" id="1860457">*</span><span class="ident" id="1860458">int64</span><span class="op" id="1860463">,</span>&nbsp;<span class="ident" id="1860465">delta</span>&nbsp;<span class="ident" id="1860471">int64</span><span class="op" id="1860476">)</span>&nbsp;<span class="op" id="1860478">(</span><span class="builtinfunc" id="1860479">new</span>&nbsp;<span class="ident" id="1860483">int64</span><span class="op" id="1860488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860491">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1860562">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1860652">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1860716">func</span>&nbsp;<span class="ident" id="1860721">AddUint64</span><span class="op" id="1860730">(</span><span class="ident" id="1860731">addr</span>&nbsp;<span class="op" id="1860736">*</span><span class="ident" id="1860737">uint64</span><span class="op" id="1860743">,</span>&nbsp;<span class="ident" id="1860745">delta</span>&nbsp;<span class="ident" id="1860751">uint64</span><span class="op" id="1860757">)</span>&nbsp;<span class="op" id="1860759">(</span><span class="builtinfunc" id="1860760">new</span>&nbsp;<span class="ident" id="1860764">uint64</span><span class="op" id="1860770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860773">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1860845">func</span>&nbsp;<span class="ident" id="1860850">AddUintptr</span><span class="op" id="1860860">(</span><span class="ident" id="1860861">addr</span>&nbsp;<span class="op" id="1860866">*</span><span class="builtintype" id="1860867">uintptr</span><span class="op" id="1860874">,</span>&nbsp;<span class="ident" id="1860876">delta</span>&nbsp;<span class="builtintype" id="1860882">uintptr</span><span class="op" id="1860889">)</span>&nbsp;<span class="op" id="1860891">(</span><span class="builtinfunc" id="1860892">new</span>&nbsp;<span class="builtintype" id="1860896">uintptr</span><span class="op" id="1860903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1860906">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1860943">func</span>&nbsp;<span class="ident" id="1860948">LoadInt32</span><span class="op" id="1860957">(</span><span class="ident" id="1860958">addr</span>&nbsp;<span class="op" id="1860963">*</span><span class="builtintype" id="1860964">int32</span><span class="op" id="1860969">)</span>&nbsp;<span class="op" id="1860971">(</span><span class="ident" id="1860972">val</span>&nbsp;<span class="builtintype" id="1860976">int32</span><span class="op" id="1860981">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1860984">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861021">func</span>&nbsp;<span class="ident" id="1861026">LoadInt64</span><span class="op" id="1861035">(</span><span class="ident" id="1861036">addr</span>&nbsp;<span class="op" id="1861041">*</span><span class="ident" id="1861042">int64</span><span class="op" id="1861047">)</span>&nbsp;<span class="op" id="1861049">(</span><span class="ident" id="1861050">val</span>&nbsp;<span class="ident" id="1861054">int64</span><span class="op" id="1861059">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1861062">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861100">func</span>&nbsp;<span class="ident" id="1861105">LoadUint32</span><span class="op" id="1861115">(</span><span class="ident" id="1861116">addr</span>&nbsp;<span class="op" id="1861121">*</span><span class="builtintype" id="1861122">uint32</span><span class="op" id="1861128">)</span>&nbsp;<span class="op" id="1861130">(</span><span class="ident" id="1861131">val</span>&nbsp;<span class="builtintype" id="1861135">uint32</span><span class="op" id="1861141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861144">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1861182">func</span>&nbsp;<span class="ident" id="1861187">LoadUint64</span><span class="op" id="1861197">(</span><span class="ident" id="1861198">addr</span>&nbsp;<span class="op" id="1861203">*</span><span class="ident" id="1861204">uint64</span><span class="op" id="1861210">)</span>&nbsp;<span class="op" id="1861212">(</span><span class="ident" id="1861213">val</span>&nbsp;<span class="ident" id="1861217">uint64</span><span class="op" id="1861223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861226">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861265">func</span>&nbsp;<span class="ident" id="1861270">LoadUintptr</span><span class="op" id="1861281">(</span><span class="ident" id="1861282">addr</span>&nbsp;<span class="op" id="1861287">*</span><span class="builtintype" id="1861288">uintptr</span><span class="op" id="1861295">)</span>&nbsp;<span class="op" id="1861297">(</span><span class="ident" id="1861298">val</span>&nbsp;<span class="builtintype" id="1861302">uintptr</span><span class="op" id="1861309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1861312">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861351">func</span>&nbsp;<span class="ident" id="1861356">LoadPointer</span><span class="op" id="1861367">(</span><span class="ident" id="1861368">addr</span>&nbsp;<span class="op" id="1861373">*</span><span class="ident" id="1861374"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1861380">.</span><span class="ident" id="1861381">Pointer</span><span class="op" id="1861388">)</span>&nbsp;<span class="op" id="1861390">(</span><span class="ident" id="1861391">val</span>&nbsp;<span class="ident" id="1861395"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1861401">.</span><span class="ident" id="1861402">Pointer</span><span class="op" id="1861409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861412">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861460">func</span>&nbsp;<span class="ident" id="1861465">StoreInt32</span><span class="op" id="1861475">(</span><span class="ident" id="1861476">addr</span>&nbsp;<span class="op" id="1861481">*</span><span class="builtintype" id="1861482">int32</span><span class="op" id="1861487">,</span>&nbsp;<span class="ident" id="1861489">val</span>&nbsp;<span class="builtintype" id="1861493">int32</span><span class="op" id="1861498">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1861501">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861549">func</span>&nbsp;<span class="ident" id="1861554">StoreInt64</span><span class="op" id="1861564">(</span><span class="ident" id="1861565">addr</span>&nbsp;<span class="op" id="1861570">*</span><span class="ident" id="1861571">int64</span><span class="op" id="1861576">,</span>&nbsp;<span class="ident" id="1861578">val</span>&nbsp;<span class="ident" id="1861582">int64</span><span class="op" id="1861587">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861590">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1861639">func</span>&nbsp;<span class="ident" id="1861644">StoreUint32</span><span class="op" id="1861655">(</span><span class="ident" id="1861656">addr</span>&nbsp;<span class="op" id="1861661">*</span><span class="builtintype" id="1861662">uint32</span><span class="op" id="1861668">,</span>&nbsp;<span class="ident" id="1861670">val</span>&nbsp;<span class="builtintype" id="1861674">uint32</span><span class="op" id="1861680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861683">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861732">func</span>&nbsp;<span class="ident" id="1861737">StoreUint64</span><span class="op" id="1861748">(</span><span class="ident" id="1861749">addr</span>&nbsp;<span class="op" id="1861754">*</span><span class="ident" id="1861755">uint64</span><span class="op" id="1861761">,</span>&nbsp;<span class="ident" id="1861763">val</span>&nbsp;<span class="ident" id="1861767">uint64</span><span class="op" id="1861773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1861776">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861826">func</span>&nbsp;<span class="ident" id="1861831">StoreUintptr</span><span class="op" id="1861843">(</span><span class="ident" id="1861844">addr</span>&nbsp;<span class="op" id="1861849">*</span><span class="builtintype" id="1861850">uintptr</span><span class="op" id="1861857">,</span>&nbsp;<span class="ident" id="1861859">val</span>&nbsp;<span class="builtintype" id="1861863">uintptr</span><span class="op" id="1861870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1861873">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1861923">func</span>&nbsp;<span class="ident" id="1861928">StorePointer</span><span class="op" id="1861940">(</span><span class="ident" id="1861941">addr</span>&nbsp;<span class="op" id="1861946">*</span><span class="ident" id="1861947"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1861953">.</span><span class="ident" id="1861954">Pointer</span><span class="op" id="1861961">,</span>&nbsp;<span class="ident" id="1861963">val</span>&nbsp;<span class="ident" id="1861967"><a href="/sync/atomic/doc.go.html#1857668">unsafe</a></span><span class="op" id="1861973">.</span><span class="ident" id="1861974">Pointer</span><span class="op" id="1861981">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1861984">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1862041">func</span>&nbsp;<span class="ident" id="1862046">panic64</span><span class="op" id="1862053">(</span><span class="op" id="1862054">)</span>&nbsp;<span class="op" id="1862056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1862059">panic</span><span class="op" id="1862064">(</span><span class="string" id="1862065">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1862124">)</span><br>
<span class="lineno"></span><span class="op" id="1862126">}</span>
</div>
</body>
</html>
