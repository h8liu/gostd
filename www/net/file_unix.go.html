<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3345331">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3345386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3345440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3345491">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345556">package</span>&nbsp;<span class="ident" id="3345564">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345569">import</span>&nbsp;<span class="op" id="3345576">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345579">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3345585">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3345595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3345598">func</span>&nbsp;<span class="ident" id="3345603">newFileFD</span><span class="op" id="3345612">(</span><span class="ident" id="3345613">f</span>&nbsp;<span class="op" id="3345615">*</span><span class="ident" id="3345616">os</span><span class="op" id="3345618">.</span><span class="ident" id="3345619">File</span><span class="op" id="3345623">)</span>&nbsp;<span class="op" id="3345625">(</span><span class="op" id="3345626">*</span><span class="ident" id="3345627">netFD</span><span class="op" id="3345632">,</span>&nbsp;<span class="builtintype" id="3345634">error</span><span class="op" id="3345639">)</span>&nbsp;<span class="op" id="3345641">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345644">fd</span><span class="op" id="3345646">,</span>&nbsp;<span class="ident" id="3345648">err</span>&nbsp;<span class="op" id="3345652">:=</span>&nbsp;<span class="ident" id="3345655">dupCloseOnExec</span><span class="op" id="3345669">(</span><span class="builtintype" id="3345670">int</span><span class="op" id="3345673">(</span><span class="ident" id="3345674">f</span><span class="op" id="3345675">.</span><span class="ident" id="3345676">Fd</span><span class="op" id="3345678">(</span><span class="op" id="3345679">)</span><span class="op" id="3345680">)</span><span class="op" id="3345681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345684">if</span>&nbsp;<span class="ident" id="3345687">err</span>&nbsp;<span class="op" id="3345691">!=</span>&nbsp;<span class="ident" id="3345694">nil</span>&nbsp;<span class="op" id="3345698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345702">return</span>&nbsp;<span class="ident" id="3345709">nil</span><span class="op" id="3345712">,</span>&nbsp;<span class="ident" id="3345714">os</span><span class="op" id="3345716">.</span><span class="ident" id="3345717">NewSyscallError</span><span class="op" id="3345732">(</span><span class="string" id="3345733">&#34;dup&#34;</span><span class="op" id="3345738">,</span>&nbsp;<span class="ident" id="3345740">err</span><span class="op" id="3345743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345750">if</span>&nbsp;<span class="ident" id="3345753">err</span>&nbsp;<span class="op" id="3345757">=</span>&nbsp;<span class="ident" id="3345759">syscall</span><span class="op" id="3345766">.</span><span class="ident" id="3345767">SetNonblock</span><span class="op" id="3345778">(</span><span class="ident" id="3345779">fd</span><span class="op" id="3345781">,</span>&nbsp;<span class="ident" id="3345783">true</span><span class="op" id="3345787">)</span><span class="op" id="3345788">;</span>&nbsp;<span class="ident" id="3345790">err</span>&nbsp;<span class="op" id="3345794">!=</span>&nbsp;<span class="ident" id="3345797">nil</span>&nbsp;<span class="op" id="3345801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345805">closesocket</span><span class="op" id="3345816">(</span><span class="ident" id="3345817">fd</span><span class="op" id="3345819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345823">return</span>&nbsp;<span class="ident" id="3345830">nil</span><span class="op" id="3345833">,</span>&nbsp;<span class="ident" id="3345835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3345840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345844">sotype</span><span class="op" id="3345850">,</span>&nbsp;<span class="ident" id="3345852">err</span>&nbsp;<span class="op" id="3345856">:=</span>&nbsp;<span class="ident" id="3345859">syscall</span><span class="op" id="3345866">.</span><span class="ident" id="3345867">GetsockoptInt</span><span class="op" id="3345880">(</span><span class="ident" id="3345881">fd</span><span class="op" id="3345883">,</span>&nbsp;<span class="ident" id="3345885">syscall</span><span class="op" id="3345892">.</span><span class="ident" id="3345893">SOL_SOCKET</span><span class="op" id="3345903">,</span>&nbsp;<span class="ident" id="3345905">syscall</span><span class="op" id="3345912">.</span><span class="ident" id="3345913">SO_TYPE</span><span class="op" id="3345920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345923">if</span>&nbsp;<span class="ident" id="3345926">err</span>&nbsp;<span class="op" id="3345930">!=</span>&nbsp;<span class="ident" id="3345933">nil</span>&nbsp;<span class="op" id="3345937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3345941">closesocket</span><span class="op" id="3345952">(</span><span class="ident" id="3345953">fd</span><span class="op" id="3345955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3345959">return</span>&nbsp;<span class="ident" id="3345966">nil</span><span class="op" id="3345969">,</span>&nbsp;<span class="ident" id="3345971">os</span><span class="op" id="3345973">.</span><span class="ident" id="3345974">NewSyscallError</span><span class="op" id="3345989">(</span><span class="string" id="3345990">&#34;getsockopt&#34;</span><span class="op" id="3346002">,</span>&nbsp;<span class="ident" id="3346004">err</span><span class="op" id="3346007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346010">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346014">family</span>&nbsp;<span class="op" id="3346021">:=</span>&nbsp;<span class="ident" id="3346024">syscall</span><span class="op" id="3346031">.</span><span class="ident" id="3346032">AF_UNSPEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346043">toAddr</span>&nbsp;<span class="op" id="3346050">:=</span>&nbsp;<span class="ident" id="3346053">sockaddrToTCP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346068">lsa</span><span class="op" id="3346071">,</span>&nbsp;<span class="ident" id="3346073">_</span>&nbsp;<span class="op" id="3346075">:=</span>&nbsp;<span class="ident" id="3346078">syscall</span><span class="op" id="3346085">.</span><span class="ident" id="3346086">Getsockname</span><span class="op" id="3346097">(</span><span class="ident" id="3346098">fd</span><span class="op" id="3346100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346103">switch</span>&nbsp;<span class="ident" id="3346110">lsa</span><span class="op" id="3346113">.</span><span class="op" id="3346114">(</span><span class="keyword" id="3346115">type</span><span class="op" id="3346119">)</span>&nbsp;<span class="op" id="3346121">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346124">default</span><span class="op" id="3346131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346135">closesocket</span><span class="op" id="3346146">(</span><span class="ident" id="3346147">fd</span><span class="op" id="3346149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346153">return</span>&nbsp;<span class="ident" id="3346160">nil</span><span class="op" id="3346163">,</span>&nbsp;<span class="ident" id="3346165">syscall</span><span class="op" id="3346172">.</span><span class="ident" id="3346173">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346181">case</span>&nbsp;<span class="op" id="3346186">*</span><span class="ident" id="3346187">syscall</span><span class="op" id="3346194">.</span><span class="ident" id="3346195">SockaddrInet4</span><span class="op" id="3346208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346212">family</span>&nbsp;<span class="op" id="3346219">=</span>&nbsp;<span class="ident" id="3346221">syscall</span><span class="op" id="3346228">.</span><span class="ident" id="3346229">AF_INET</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346239">if</span>&nbsp;<span class="ident" id="3346242">sotype</span>&nbsp;<span class="op" id="3346249">==</span>&nbsp;<span class="ident" id="3346252">syscall</span><span class="op" id="3346259">.</span><span class="ident" id="3346260">SOCK_DGRAM</span>&nbsp;<span class="op" id="3346271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346276">toAddr</span>&nbsp;<span class="op" id="3346283">=</span>&nbsp;<span class="ident" id="3346285">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346301">}</span>&nbsp;<span class="keyword" id="3346303">else</span>&nbsp;<span class="keyword" id="3346308">if</span>&nbsp;<span class="ident" id="3346311">sotype</span>&nbsp;<span class="op" id="3346318">==</span>&nbsp;<span class="ident" id="3346321">syscall</span><span class="op" id="3346328">.</span><span class="ident" id="3346329">SOCK_RAW</span>&nbsp;<span class="op" id="3346338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346343">toAddr</span>&nbsp;<span class="op" id="3346350">=</span>&nbsp;<span class="ident" id="3346352">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346367">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346370">case</span>&nbsp;<span class="op" id="3346375">*</span><span class="ident" id="3346376">syscall</span><span class="op" id="3346383">.</span><span class="ident" id="3346384">SockaddrInet6</span><span class="op" id="3346397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346401">family</span>&nbsp;<span class="op" id="3346408">=</span>&nbsp;<span class="ident" id="3346410">syscall</span><span class="op" id="3346417">.</span><span class="ident" id="3346418">AF_INET6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346429">if</span>&nbsp;<span class="ident" id="3346432">sotype</span>&nbsp;<span class="op" id="3346439">==</span>&nbsp;<span class="ident" id="3346442">syscall</span><span class="op" id="3346449">.</span><span class="ident" id="3346450">SOCK_DGRAM</span>&nbsp;<span class="op" id="3346461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346466">toAddr</span>&nbsp;<span class="op" id="3346473">=</span>&nbsp;<span class="ident" id="3346475">sockaddrToUDP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346491">}</span>&nbsp;<span class="keyword" id="3346493">else</span>&nbsp;<span class="keyword" id="3346498">if</span>&nbsp;<span class="ident" id="3346501">sotype</span>&nbsp;<span class="op" id="3346508">==</span>&nbsp;<span class="ident" id="3346511">syscall</span><span class="op" id="3346518">.</span><span class="ident" id="3346519">SOCK_RAW</span>&nbsp;<span class="op" id="3346528">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346533">toAddr</span>&nbsp;<span class="op" id="3346540">=</span>&nbsp;<span class="ident" id="3346542">sockaddrToIP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346560">case</span>&nbsp;<span class="op" id="3346565">*</span><span class="ident" id="3346566">syscall</span><span class="op" id="3346573">.</span><span class="ident" id="3346574">SockaddrUnix</span><span class="op" id="3346586">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346590">family</span>&nbsp;<span class="op" id="3346597">=</span>&nbsp;<span class="ident" id="3346599">syscall</span><span class="op" id="3346606">.</span><span class="ident" id="3346607">AF_UNIX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346617">toAddr</span>&nbsp;<span class="op" id="3346624">=</span>&nbsp;<span class="ident" id="3346626">sockaddrToUnix</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346643">if</span>&nbsp;<span class="ident" id="3346646">sotype</span>&nbsp;<span class="op" id="3346653">==</span>&nbsp;<span class="ident" id="3346656">syscall</span><span class="op" id="3346663">.</span><span class="ident" id="3346664">SOCK_DGRAM</span>&nbsp;<span class="op" id="3346675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346680">toAddr</span>&nbsp;<span class="op" id="3346687">=</span>&nbsp;<span class="ident" id="3346689">sockaddrToUnixgram</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346710">}</span>&nbsp;<span class="keyword" id="3346712">else</span>&nbsp;<span class="keyword" id="3346717">if</span>&nbsp;<span class="ident" id="3346720">sotype</span>&nbsp;<span class="op" id="3346727">==</span>&nbsp;<span class="ident" id="3346730">syscall</span><span class="op" id="3346737">.</span><span class="ident" id="3346738">SOCK_SEQPACKET</span>&nbsp;<span class="op" id="3346753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346758">toAddr</span>&nbsp;<span class="op" id="3346765">=</span>&nbsp;<span class="ident" id="3346767">sockaddrToUnixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346790">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346796">laddr</span>&nbsp;<span class="op" id="3346802">:=</span>&nbsp;<span class="ident" id="3346805">toAddr</span><span class="op" id="3346811">(</span><span class="ident" id="3346812">lsa</span><span class="op" id="3346815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346818">rsa</span><span class="op" id="3346821">,</span>&nbsp;<span class="ident" id="3346823">_</span>&nbsp;<span class="op" id="3346825">:=</span>&nbsp;<span class="ident" id="3346828">syscall</span><span class="op" id="3346835">.</span><span class="ident" id="3346836">Getpeername</span><span class="op" id="3346847">(</span><span class="ident" id="3346848">fd</span><span class="op" id="3346850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346853">raddr</span>&nbsp;<span class="op" id="3346859">:=</span>&nbsp;<span class="ident" id="3346862">toAddr</span><span class="op" id="3346868">(</span><span class="ident" id="3346869">rsa</span><span class="op" id="3346872">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346876">netfd</span><span class="op" id="3346881">,</span>&nbsp;<span class="ident" id="3346883">err</span>&nbsp;<span class="op" id="3346887">:=</span>&nbsp;<span class="ident" id="3346890">newFD</span><span class="op" id="3346895">(</span><span class="ident" id="3346896">fd</span><span class="op" id="3346898">,</span>&nbsp;<span class="ident" id="3346900">family</span><span class="op" id="3346906">,</span>&nbsp;<span class="ident" id="3346908">sotype</span><span class="op" id="3346914">,</span>&nbsp;<span class="ident" id="3346916">laddr</span><span class="op" id="3346921">.</span><span class="ident" id="3346922">Network</span><span class="op" id="3346929">(</span><span class="op" id="3346930">)</span><span class="op" id="3346931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346934">if</span>&nbsp;<span class="ident" id="3346937">err</span>&nbsp;<span class="op" id="3346941">!=</span>&nbsp;<span class="ident" id="3346944">nil</span>&nbsp;<span class="op" id="3346948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3346952">closesocket</span><span class="op" id="3346963">(</span><span class="ident" id="3346964">fd</span><span class="op" id="3346966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346970">return</span>&nbsp;<span class="ident" id="3346977">nil</span><span class="op" id="3346980">,</span>&nbsp;<span class="ident" id="3346982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3346987">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3346990">if</span>&nbsp;<span class="ident" id="3346993">err</span>&nbsp;<span class="op" id="3346997">:=</span>&nbsp;<span class="ident" id="3347000">netfd</span><span class="op" id="3347005">.</span><span class="ident" id="3347006">init</span><span class="op" id="3347010">(</span><span class="op" id="3347011">)</span><span class="op" id="3347012">;</span>&nbsp;<span class="ident" id="3347014">err</span>&nbsp;<span class="op" id="3347018">!=</span>&nbsp;<span class="ident" id="3347021">nil</span>&nbsp;<span class="op" id="3347025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347029">netfd</span><span class="op" id="3347034">.</span><span class="ident" id="3347035">Close</span><span class="op" id="3347040">(</span><span class="op" id="3347041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347045">return</span>&nbsp;<span class="ident" id="3347052">nil</span><span class="op" id="3347055">,</span>&nbsp;<span class="ident" id="3347057">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347065">netfd</span><span class="op" id="3347070">.</span><span class="ident" id="3347071">setAddr</span><span class="op" id="3347078">(</span><span class="ident" id="3347079">laddr</span><span class="op" id="3347084">,</span>&nbsp;<span class="ident" id="3347086">raddr</span><span class="op" id="3347091">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347094">return</span>&nbsp;<span class="ident" id="3347101">netfd</span><span class="op" id="3347106">,</span>&nbsp;<span class="ident" id="3347108">nil</span><br>
<span class="lineno"></span><span class="op" id="3347112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3347115">//&nbsp;FileConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;connection&nbsp;corresponding&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3347185">//&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when</span><br>
<span class="lineno">80</span><span class="comment" id="3347256">//&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3347322">//&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3347335">func</span>&nbsp;<span class="ident" id="3347340">FileConn</span><span class="op" id="3347348">(</span><span class="ident" id="3347349">f</span>&nbsp;<span class="op" id="3347351">*</span><span class="ident" id="3347352">os</span><span class="op" id="3347354">.</span><span class="ident" id="3347355">File</span><span class="op" id="3347359">)</span>&nbsp;<span class="op" id="3347361">(</span><span class="ident" id="3347362">c</span>&nbsp;<span class="ident" id="3347364">Conn</span><span class="op" id="3347368">,</span>&nbsp;<span class="ident" id="3347370">err</span>&nbsp;<span class="builtintype" id="3347374">error</span><span class="op" id="3347379">)</span>&nbsp;<span class="op" id="3347381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347384">fd</span><span class="op" id="3347386">,</span>&nbsp;<span class="ident" id="3347388">err</span>&nbsp;<span class="op" id="3347392">:=</span>&nbsp;<span class="ident" id="3347395">newFileFD</span><span class="op" id="3347404">(</span><span class="ident" id="3347405">f</span><span class="op" id="3347406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347409">if</span>&nbsp;<span class="ident" id="3347412">err</span>&nbsp;<span class="op" id="3347416">!=</span>&nbsp;<span class="ident" id="3347419">nil</span>&nbsp;<span class="op" id="3347423">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347427">return</span>&nbsp;<span class="ident" id="3347434">nil</span><span class="op" id="3347437">,</span>&nbsp;<span class="ident" id="3347439">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347447">switch</span>&nbsp;<span class="ident" id="3347454">fd</span><span class="op" id="3347456">.</span><span class="ident" id="3347457">laddr</span><span class="op" id="3347462">.</span><span class="op" id="3347463">(</span><span class="keyword" id="3347464">type</span><span class="op" id="3347468">)</span>&nbsp;<span class="op" id="3347470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347473">case</span>&nbsp;<span class="op" id="3347478">*</span><span class="ident" id="3347479">TCPAddr</span><span class="op" id="3347486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347490">return</span>&nbsp;<span class="ident" id="3347497">newTCPConn</span><span class="op" id="3347507">(</span><span class="ident" id="3347508">fd</span><span class="op" id="3347510">)</span><span class="op" id="3347511">,</span>&nbsp;<span class="ident" id="3347513">nil</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347518">case</span>&nbsp;<span class="op" id="3347523">*</span><span class="ident" id="3347524">UDPAddr</span><span class="op" id="3347531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347535">return</span>&nbsp;<span class="ident" id="3347542">newUDPConn</span><span class="op" id="3347552">(</span><span class="ident" id="3347553">fd</span><span class="op" id="3347555">)</span><span class="op" id="3347556">,</span>&nbsp;<span class="ident" id="3347558">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347563">case</span>&nbsp;<span class="op" id="3347568">*</span><span class="ident" id="3347569">IPAddr</span><span class="op" id="3347575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347579">return</span>&nbsp;<span class="ident" id="3347586">newIPConn</span><span class="op" id="3347595">(</span><span class="ident" id="3347596">fd</span><span class="op" id="3347598">)</span><span class="op" id="3347599">,</span>&nbsp;<span class="ident" id="3347601">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347606">case</span>&nbsp;<span class="op" id="3347611">*</span><span class="ident" id="3347612">UnixAddr</span><span class="op" id="3347620">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347624">return</span>&nbsp;<span class="ident" id="3347631">newUnixConn</span><span class="op" id="3347642">(</span><span class="ident" id="3347643">fd</span><span class="op" id="3347645">)</span><span class="op" id="3347646">,</span>&nbsp;<span class="ident" id="3347648">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3347653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347656">fd</span><span class="op" id="3347658">.</span><span class="ident" id="3347659">Close</span><span class="op" id="3347664">(</span><span class="op" id="3347665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3347668">return</span>&nbsp;<span class="ident" id="3347675">nil</span><span class="op" id="3347678">,</span>&nbsp;<span class="ident" id="3347680">syscall</span><span class="op" id="3347687">.</span><span class="ident" id="3347688">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3347695">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3347698">//&nbsp;FileListener&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;network&nbsp;listener&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3347767">//&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;l</span><br>
<span class="lineno"></span><span class="comment" id="3347836">//&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3347907">//&nbsp;affect&nbsp;l.</span><br>
<span class="lineno">105</span><span class="keyword" id="3347920">func</span>&nbsp;<span class="ident" id="3347925">FileListener</span><span class="op" id="3347937">(</span><span class="ident" id="3347938">f</span>&nbsp;<span class="op" id="3347940">*</span><span class="ident" id="3347941">os</span><span class="op" id="3347943">.</span><span class="ident" id="3347944">File</span><span class="op" id="3347948">)</span>&nbsp;<span class="op" id="3347950">(</span><span class="ident" id="3347951">l</span>&nbsp;<span class="ident" id="3347953">Listener</span><span class="op" id="3347961">,</span>&nbsp;<span class="ident" id="3347963">err</span>&nbsp;<span class="builtintype" id="3347967">error</span><span class="op" id="3347972">)</span>&nbsp;<span class="op" id="3347974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3347977">fd</span><span class="op" id="3347979">,</span>&nbsp;<span class="ident" id="3347981">err</span>&nbsp;<span class="op" id="3347985">:=</span>&nbsp;<span class="ident" id="3347988">newFileFD</span><span class="op" id="3347997">(</span><span class="ident" id="3347998">f</span><span class="op" id="3347999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348002">if</span>&nbsp;<span class="ident" id="3348005">err</span>&nbsp;<span class="op" id="3348009">!=</span>&nbsp;<span class="ident" id="3348012">nil</span>&nbsp;<span class="op" id="3348016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348020">return</span>&nbsp;<span class="ident" id="3348027">nil</span><span class="op" id="3348030">,</span>&nbsp;<span class="ident" id="3348032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348037">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348040">switch</span>&nbsp;<span class="ident" id="3348047">laddr</span>&nbsp;<span class="op" id="3348053">:=</span>&nbsp;<span class="ident" id="3348056">fd</span><span class="op" id="3348058">.</span><span class="ident" id="3348059">laddr</span><span class="op" id="3348064">.</span><span class="op" id="3348065">(</span><span class="keyword" id="3348066">type</span><span class="op" id="3348070">)</span>&nbsp;<span class="op" id="3348072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348075">case</span>&nbsp;<span class="op" id="3348080">*</span><span class="ident" id="3348081">TCPAddr</span><span class="op" id="3348088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348092">return</span>&nbsp;<span class="op" id="3348099">&amp;</span><span class="ident" id="3348100">TCPListener</span><span class="op" id="3348111">{</span><span class="ident" id="3348112">fd</span><span class="op" id="3348114">}</span><span class="op" id="3348115">,</span>&nbsp;<span class="ident" id="3348117">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348122">case</span>&nbsp;<span class="op" id="3348127">*</span><span class="ident" id="3348128">UnixAddr</span><span class="op" id="3348136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348140">return</span>&nbsp;<span class="op" id="3348147">&amp;</span><span class="ident" id="3348148">UnixListener</span><span class="op" id="3348160">{</span><span class="ident" id="3348161">fd</span><span class="op" id="3348163">,</span>&nbsp;<span class="ident" id="3348165">laddr</span><span class="op" id="3348170">.</span><span class="ident" id="3348171">Name</span><span class="op" id="3348175">}</span><span class="op" id="3348176">,</span>&nbsp;<span class="ident" id="3348178">nil</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348186">fd</span><span class="op" id="3348188">.</span><span class="ident" id="3348189">Close</span><span class="op" id="3348194">(</span><span class="op" id="3348195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348198">return</span>&nbsp;<span class="ident" id="3348205">nil</span><span class="op" id="3348208">,</span>&nbsp;<span class="ident" id="3348210">syscall</span><span class="op" id="3348217">.</span><span class="ident" id="3348218">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3348225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3348228">//&nbsp;FilePacketConn&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;packet&nbsp;network&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="3348294">//&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;open&nbsp;file&nbsp;f.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3348351">//&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.&nbsp;&nbsp;Closing&nbsp;c&nbsp;does&nbsp;not&nbsp;affect</span><br>
<span class="lineno"></span><span class="comment" id="3348422">//&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="3348461">func</span>&nbsp;<span class="ident" id="3348466">FilePacketConn</span><span class="op" id="3348480">(</span><span class="ident" id="3348481">f</span>&nbsp;<span class="op" id="3348483">*</span><span class="ident" id="3348484">os</span><span class="op" id="3348486">.</span><span class="ident" id="3348487">File</span><span class="op" id="3348491">)</span>&nbsp;<span class="op" id="3348493">(</span><span class="ident" id="3348494">c</span>&nbsp;<span class="ident" id="3348496">PacketConn</span><span class="op" id="3348506">,</span>&nbsp;<span class="ident" id="3348508">err</span>&nbsp;<span class="builtintype" id="3348512">error</span><span class="op" id="3348517">)</span>&nbsp;<span class="op" id="3348519">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348522">fd</span><span class="op" id="3348524">,</span>&nbsp;<span class="ident" id="3348526">err</span>&nbsp;<span class="op" id="3348530">:=</span>&nbsp;<span class="ident" id="3348533">newFileFD</span><span class="op" id="3348542">(</span><span class="ident" id="3348543">f</span><span class="op" id="3348544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348547">if</span>&nbsp;<span class="ident" id="3348550">err</span>&nbsp;<span class="op" id="3348554">!=</span>&nbsp;<span class="ident" id="3348557">nil</span>&nbsp;<span class="op" id="3348561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348565">return</span>&nbsp;<span class="ident" id="3348572">nil</span><span class="op" id="3348575">,</span>&nbsp;<span class="ident" id="3348577">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348585">switch</span>&nbsp;<span class="ident" id="3348592">fd</span><span class="op" id="3348594">.</span><span class="ident" id="3348595">laddr</span><span class="op" id="3348600">.</span><span class="op" id="3348601">(</span><span class="keyword" id="3348602">type</span><span class="op" id="3348606">)</span>&nbsp;<span class="op" id="3348608">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348611">case</span>&nbsp;<span class="op" id="3348616">*</span><span class="ident" id="3348617">UDPAddr</span><span class="op" id="3348624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348628">return</span>&nbsp;<span class="ident" id="3348635">newUDPConn</span><span class="op" id="3348645">(</span><span class="ident" id="3348646">fd</span><span class="op" id="3348648">)</span><span class="op" id="3348649">,</span>&nbsp;<span class="ident" id="3348651">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348656">case</span>&nbsp;<span class="op" id="3348661">*</span><span class="ident" id="3348662">IPAddr</span><span class="op" id="3348668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348672">return</span>&nbsp;<span class="ident" id="3348679">newIPConn</span><span class="op" id="3348688">(</span><span class="ident" id="3348689">fd</span><span class="op" id="3348691">)</span><span class="op" id="3348692">,</span>&nbsp;<span class="ident" id="3348694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348699">case</span>&nbsp;<span class="op" id="3348704">*</span><span class="ident" id="3348705">UnixAddr</span><span class="op" id="3348713">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348717">return</span>&nbsp;<span class="ident" id="3348724">newUnixConn</span><span class="op" id="3348735">(</span><span class="ident" id="3348736">fd</span><span class="op" id="3348738">)</span><span class="op" id="3348739">,</span>&nbsp;<span class="ident" id="3348741">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3348746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3348749">fd</span><span class="op" id="3348751">.</span><span class="ident" id="3348752">Close</span><span class="op" id="3348757">(</span><span class="op" id="3348758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3348761">return</span>&nbsp;<span class="ident" id="3348768">nil</span><span class="op" id="3348771">,</span>&nbsp;<span class="ident" id="3348773">syscall</span><span class="op" id="3348780">.</span><span class="ident" id="3348781">EINVAL</span><br>
<span class="lineno"></span><span class="op" id="3348788">}</span>
</div>
</body>
</html>
