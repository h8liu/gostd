<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2150539">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2150595">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2150649">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2150700">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="2150767">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="2150826">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="2150867">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="2150914">//</span><br>
<span class="lineno">10</span><span class="comment" id="2150917">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2150982">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="2151016">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="2151067">//</span><br>
<span class="lineno"></span><span class="comment" id="2151070">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="2151124">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2151153">//</span><br>
<span class="lineno"></span><span class="comment" id="2151156">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="2151222">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2151290">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="2151335">//</span><br>
<span class="lineno"></span><span class="comment" id="2151338">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2151354">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="2151415">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="2151423">//</span><br>
<span class="lineno">25</span><span class="comment" id="2151426">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="2151482">//</span><br>
<span class="lineno"></span><span class="comment" id="2151485">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="2151541">//</span><br>
<span class="lineno"></span><span class="comment" id="2151544">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="2151586">//</span><br>
<span class="lineno"></span><span class="comment" id="2151589">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="2151648">//</span><br>
<span class="lineno"></span><span class="comment" id="2151651">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="2151700">//</span><br>
<span class="lineno">35</span><span class="comment" id="2151703">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="2151760">//</span><br>
<span class="lineno"></span><span class="comment" id="2151763">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="2151838">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="2151858">//</span><br>
<span class="lineno">40</span><span class="comment" id="2151861">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="2151909">//</span><br>
<span class="lineno"></span><span class="comment" id="2151912">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="2151973">//</span><br>
<span class="lineno"></span><span class="keyword" id="2151976">package</span>&nbsp;<span class="ident" id="2151984">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="2151991">import</span>&nbsp;<span class="op" id="2151998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152001">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152010">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152019">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152026">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152043">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152049">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152056">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152068">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152074">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152085">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152102">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152113">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2152124">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="2152131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2152134">func</span>&nbsp;<span class="ident" id="2152139">init</span><span class="op" id="2152143">(</span><span class="op" id="2152144">)</span>&nbsp;<span class="op" id="2152146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152149">http</span><span class="op" id="2152153">.</span><span class="ident" id="2152154">Handle</span><span class="op" id="2152160">(</span><span class="string" id="2152161">&#34;/debug/pprof/&#34;</span><span class="op" id="2152176">,</span>&nbsp;<span class="ident" id="2152178">http</span><span class="op" id="2152182">.</span><span class="ident" id="2152183">HandlerFunc</span><span class="op" id="2152194">(</span><span class="ident" id="2152195">Index</span><span class="op" id="2152200">)</span><span class="op" id="2152201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152204">http</span><span class="op" id="2152208">.</span><span class="ident" id="2152209">Handle</span><span class="op" id="2152215">(</span><span class="string" id="2152216">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="2152238">,</span>&nbsp;<span class="ident" id="2152240">http</span><span class="op" id="2152244">.</span><span class="ident" id="2152245">HandlerFunc</span><span class="op" id="2152256">(</span><span class="ident" id="2152257">Cmdline</span><span class="op" id="2152264">)</span><span class="op" id="2152265">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152268">http</span><span class="op" id="2152272">.</span><span class="ident" id="2152273">Handle</span><span class="op" id="2152279">(</span><span class="string" id="2152280">&#34;/debug/pprof/profile&#34;</span><span class="op" id="2152302">,</span>&nbsp;<span class="ident" id="2152304">http</span><span class="op" id="2152308">.</span><span class="ident" id="2152309">HandlerFunc</span><span class="op" id="2152320">(</span><span class="ident" id="2152321">Profile</span><span class="op" id="2152328">)</span><span class="op" id="2152329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152332">http</span><span class="op" id="2152336">.</span><span class="ident" id="2152337">Handle</span><span class="op" id="2152343">(</span><span class="string" id="2152344">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="2152365">,</span>&nbsp;<span class="ident" id="2152367">http</span><span class="op" id="2152371">.</span><span class="ident" id="2152372">HandlerFunc</span><span class="op" id="2152383">(</span><span class="ident" id="2152384">Symbol</span><span class="op" id="2152390">)</span><span class="op" id="2152391">)</span><br>
<span class="lineno"></span><span class="op" id="2152393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2152396">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="2152443">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2152499">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="2152567">func</span>&nbsp;<span class="ident" id="2152572">Cmdline</span><span class="op" id="2152579">(</span><span class="ident" id="2152580">w</span>&nbsp;<span class="ident" id="2152582">http</span><span class="op" id="2152586">.</span><span class="ident" id="2152587">ResponseWriter</span><span class="op" id="2152601">,</span>&nbsp;<span class="ident" id="2152603">r</span>&nbsp;<span class="op" id="2152605">*</span><span class="ident" id="2152606">http</span><span class="op" id="2152610">.</span><span class="ident" id="2152611">Request</span><span class="op" id="2152618">)</span>&nbsp;<span class="op" id="2152620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152623">w</span><span class="op" id="2152624">.</span><span class="ident" id="2152625">Header</span><span class="op" id="2152631">(</span><span class="op" id="2152632">)</span><span class="op" id="2152633">.</span><span class="ident" id="2152634">Set</span><span class="op" id="2152637">(</span><span class="string" id="2152638">&#34;Content-Type&#34;</span><span class="op" id="2152652">,</span>&nbsp;<span class="string" id="2152654">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2152681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152684">fmt</span><span class="op" id="2152687">.</span><span class="ident" id="2152688">Fprintf</span><span class="op" id="2152695">(</span><span class="ident" id="2152696">w</span><span class="op" id="2152697">,</span>&nbsp;<span class="ident" id="2152699">strings</span><span class="op" id="2152706">.</span><span class="ident" id="2152707">Join</span><span class="op" id="2152711">(</span><span class="ident" id="2152712">os</span><span class="op" id="2152714">.</span><span class="ident" id="2152715">Args</span><span class="op" id="2152719">,</span>&nbsp;<span class="string" id="2152721">&#34;\x00&#34;</span><span class="op" id="2152727">)</span><span class="op" id="2152728">)</span><br>
<span class="lineno">75</span><span class="op" id="2152730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2152733">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="2152791">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="2152859">func</span>&nbsp;<span class="ident" id="2152864">Profile</span><span class="op" id="2152871">(</span><span class="ident" id="2152872">w</span>&nbsp;<span class="ident" id="2152874">http</span><span class="op" id="2152878">.</span><span class="ident" id="2152879">ResponseWriter</span><span class="op" id="2152893">,</span>&nbsp;<span class="ident" id="2152895">r</span>&nbsp;<span class="op" id="2152897">*</span><span class="ident" id="2152898">http</span><span class="op" id="2152902">.</span><span class="ident" id="2152903">Request</span><span class="op" id="2152910">)</span>&nbsp;<span class="op" id="2152912">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152915">sec</span><span class="op" id="2152918">,</span>&nbsp;<span class="ident" id="2152920">_</span>&nbsp;<span class="op" id="2152922">:=</span>&nbsp;<span class="ident" id="2152925">strconv</span><span class="op" id="2152932">.</span><span class="ident" id="2152933">ParseInt</span><span class="op" id="2152941">(</span><span class="ident" id="2152942">r</span><span class="op" id="2152943">.</span><span class="ident" id="2152944">FormValue</span><span class="op" id="2152953">(</span><span class="string" id="2152954">&#34;seconds&#34;</span><span class="op" id="2152963">)</span><span class="op" id="2152964">,</span>&nbsp;<span class="num" id="2152966">10</span><span class="op" id="2152968">,</span>&nbsp;<span class="num" id="2152970">64</span><span class="op" id="2152972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2152975">if</span>&nbsp;<span class="ident" id="2152978">sec</span>&nbsp;<span class="op" id="2152982">==</span>&nbsp;<span class="num" id="2152985">0</span>&nbsp;<span class="op" id="2152987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2152991">sec</span>&nbsp;<span class="op" id="2152995">=</span>&nbsp;<span class="num" id="2152997">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2153001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153005">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153062">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153104">w</span><span class="op" id="2153105">.</span><span class="ident" id="2153106">Header</span><span class="op" id="2153112">(</span><span class="op" id="2153113">)</span><span class="op" id="2153114">.</span><span class="ident" id="2153115">Set</span><span class="op" id="2153118">(</span><span class="string" id="2153119">&#34;Content-Type&#34;</span><span class="op" id="2153133">,</span>&nbsp;<span class="string" id="2153135">&#34;application/octet-stream&#34;</span><span class="op" id="2153161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153164">if</span>&nbsp;<span class="ident" id="2153167">err</span>&nbsp;<span class="op" id="2153171">:=</span>&nbsp;<span class="ident" id="2153174">pprof</span><span class="op" id="2153179">.</span><span class="ident" id="2153180">StartCPUProfile</span><span class="op" id="2153195">(</span><span class="ident" id="2153196">w</span><span class="op" id="2153197">)</span><span class="op" id="2153198">;</span>&nbsp;<span class="ident" id="2153200">err</span>&nbsp;<span class="op" id="2153204">!=</span>&nbsp;<span class="ident" id="2153207">nil</span>&nbsp;<span class="op" id="2153211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153215">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153262">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153306">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153332">w</span><span class="op" id="2153333">.</span><span class="ident" id="2153334">Header</span><span class="op" id="2153340">(</span><span class="op" id="2153341">)</span><span class="op" id="2153342">.</span><span class="ident" id="2153343">Set</span><span class="op" id="2153346">(</span><span class="string" id="2153347">&#34;Content-Type&#34;</span><span class="op" id="2153361">,</span>&nbsp;<span class="string" id="2153363">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2153390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153394">w</span><span class="op" id="2153395">.</span><span class="ident" id="2153396">WriteHeader</span><span class="op" id="2153407">(</span><span class="ident" id="2153408">http</span><span class="op" id="2153412">.</span><span class="ident" id="2153413">StatusInternalServerError</span><span class="op" id="2153438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153442">fmt</span><span class="op" id="2153445">.</span><span class="ident" id="2153446">Fprintf</span><span class="op" id="2153453">(</span><span class="ident" id="2153454">w</span><span class="op" id="2153455">,</span>&nbsp;<span class="string" id="2153457">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="2153495">,</span>&nbsp;<span class="ident" id="2153497">err</span><span class="op" id="2153500">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2153504">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2153512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153515">time</span><span class="op" id="2153519">.</span><span class="ident" id="2153520">Sleep</span><span class="op" id="2153525">(</span><span class="ident" id="2153526">time</span><span class="op" id="2153530">.</span><span class="ident" id="2153531">Duration</span><span class="op" id="2153539">(</span><span class="ident" id="2153540">sec</span><span class="op" id="2153543">)</span>&nbsp;<span class="op" id="2153545">*</span>&nbsp;<span class="ident" id="2153547">time</span><span class="op" id="2153551">.</span><span class="ident" id="2153552">Second</span><span class="op" id="2153558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153561">pprof</span><span class="op" id="2153566">.</span><span class="ident" id="2153567">StopCPUProfile</span><span class="op" id="2153581">(</span><span class="op" id="2153582">)</span><br>
<span class="lineno"></span><span class="op" id="2153584">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="2153587">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="2153650">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="2153721">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="2153788">func</span>&nbsp;<span class="ident" id="2153793">Symbol</span><span class="op" id="2153799">(</span><span class="ident" id="2153800">w</span>&nbsp;<span class="ident" id="2153802">http</span><span class="op" id="2153806">.</span><span class="ident" id="2153807">ResponseWriter</span><span class="op" id="2153821">,</span>&nbsp;<span class="ident" id="2153823">r</span>&nbsp;<span class="op" id="2153825">*</span><span class="ident" id="2153826">http</span><span class="op" id="2153830">.</span><span class="ident" id="2153831">Request</span><span class="op" id="2153838">)</span>&nbsp;<span class="op" id="2153840">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2153843">w</span><span class="op" id="2153844">.</span><span class="ident" id="2153845">Header</span><span class="op" id="2153851">(</span><span class="op" id="2153852">)</span><span class="op" id="2153853">.</span><span class="ident" id="2153854">Set</span><span class="op" id="2153857">(</span><span class="string" id="2153858">&#34;Content-Type&#34;</span><span class="op" id="2153872">,</span>&nbsp;<span class="string" id="2153874">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2153901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153905">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2153952">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154001">var</span>&nbsp;<span class="ident" id="2154005">buf</span>&nbsp;<span class="ident" id="2154009">bytes</span><span class="op" id="2154014">.</span><span class="ident" id="2154015">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154024">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154075">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154133">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154185">fmt</span><span class="op" id="2154188">.</span><span class="ident" id="2154189">Fprintf</span><span class="op" id="2154196">(</span><span class="op" id="2154197">&amp;</span><span class="ident" id="2154198">buf</span><span class="op" id="2154201">,</span>&nbsp;<span class="string" id="2154203">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="2154221">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154225">var</span>&nbsp;<span class="ident" id="2154229">b</span>&nbsp;<span class="op" id="2154231">*</span><span class="ident" id="2154232">bufio</span><span class="op" id="2154237">.</span><span class="ident" id="2154238">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154246">if</span>&nbsp;<span class="ident" id="2154249">r</span><span class="op" id="2154250">.</span><span class="ident" id="2154251">Method</span>&nbsp;<span class="op" id="2154258">==</span>&nbsp;<span class="string" id="2154261">&#34;POST&#34;</span>&nbsp;<span class="op" id="2154268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154272">b</span>&nbsp;<span class="op" id="2154274">=</span>&nbsp;<span class="ident" id="2154276">bufio</span><span class="op" id="2154281">.</span><span class="ident" id="2154282">NewReader</span><span class="op" id="2154291">(</span><span class="ident" id="2154292">r</span><span class="op" id="2154293">.</span><span class="ident" id="2154294">Body</span><span class="op" id="2154298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154301">}</span>&nbsp;<span class="keyword" id="2154303">else</span>&nbsp;<span class="op" id="2154308">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154312">b</span>&nbsp;<span class="op" id="2154314">=</span>&nbsp;<span class="ident" id="2154316">bufio</span><span class="op" id="2154321">.</span><span class="ident" id="2154322">NewReader</span><span class="op" id="2154331">(</span><span class="ident" id="2154332">strings</span><span class="op" id="2154339">.</span><span class="ident" id="2154340">NewReader</span><span class="op" id="2154349">(</span><span class="ident" id="2154350">r</span><span class="op" id="2154351">.</span><span class="ident" id="2154352">URL</span><span class="op" id="2154355">.</span><span class="ident" id="2154356">RawQuery</span><span class="op" id="2154364">)</span><span class="op" id="2154365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154372">for</span>&nbsp;<span class="op" id="2154376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154380">word</span><span class="op" id="2154384">,</span>&nbsp;<span class="ident" id="2154386">err</span>&nbsp;<span class="op" id="2154390">:=</span>&nbsp;<span class="ident" id="2154393">b</span><span class="op" id="2154394">.</span><span class="ident" id="2154395">ReadSlice</span><span class="op" id="2154404">(</span><span class="string" id="2154405">&#39;+&#39;</span><span class="op" id="2154408">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154412">if</span>&nbsp;<span class="ident" id="2154415">err</span>&nbsp;<span class="op" id="2154419">==</span>&nbsp;<span class="ident" id="2154422">nil</span>&nbsp;<span class="op" id="2154426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154431">word</span>&nbsp;<span class="op" id="2154436">=</span>&nbsp;<span class="ident" id="2154438">word</span><span class="op" id="2154442">[</span><span class="num" id="2154443">0</span>&nbsp;<span class="op" id="2154445">:</span>&nbsp;<span class="builtinfunc" id="2154447">len</span><span class="op" id="2154450">(</span><span class="ident" id="2154451">word</span><span class="op" id="2154455">)</span><span class="op" id="2154456">-</span><span class="num" id="2154457">1</span><span class="op" id="2154458">]</span>&nbsp;<span class="comment" id="2154460">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154476">pc</span><span class="op" id="2154478">,</span>&nbsp;<span class="ident" id="2154480">_</span>&nbsp;<span class="op" id="2154482">:=</span>&nbsp;<span class="ident" id="2154485">strconv</span><span class="op" id="2154492">.</span><span class="ident" id="2154493">ParseUint</span><span class="op" id="2154502">(</span><span class="builtintype" id="2154503">string</span><span class="op" id="2154509">(</span><span class="ident" id="2154510">word</span><span class="op" id="2154514">)</span><span class="op" id="2154515">,</span>&nbsp;<span class="num" id="2154517">0</span><span class="op" id="2154518">,</span>&nbsp;<span class="num" id="2154520">64</span><span class="op" id="2154522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154526">if</span>&nbsp;<span class="ident" id="2154529">pc</span>&nbsp;<span class="op" id="2154532">!=</span>&nbsp;<span class="num" id="2154535">0</span>&nbsp;<span class="op" id="2154537">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154542">f</span>&nbsp;<span class="op" id="2154544">:=</span>&nbsp;<span class="ident" id="2154547">runtime</span><span class="op" id="2154554">.</span><span class="ident" id="2154555">FuncForPC</span><span class="op" id="2154564">(</span><span class="builtintype" id="2154565">uintptr</span><span class="op" id="2154572">(</span><span class="ident" id="2154573">pc</span><span class="op" id="2154575">)</span><span class="op" id="2154576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154581">if</span>&nbsp;<span class="ident" id="2154584">f</span>&nbsp;<span class="op" id="2154586">!=</span>&nbsp;<span class="ident" id="2154589">nil</span>&nbsp;<span class="op" id="2154593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154599">fmt</span><span class="op" id="2154602">.</span><span class="ident" id="2154603">Fprintf</span><span class="op" id="2154610">(</span><span class="op" id="2154611">&amp;</span><span class="ident" id="2154612">buf</span><span class="op" id="2154615">,</span>&nbsp;<span class="string" id="2154617">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="2154627">,</span>&nbsp;<span class="ident" id="2154629">pc</span><span class="op" id="2154631">,</span>&nbsp;<span class="ident" id="2154633">f</span><span class="op" id="2154634">.</span><span class="ident" id="2154635">Name</span><span class="op" id="2154639">(</span><span class="op" id="2154640">)</span><span class="op" id="2154641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154650">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154655">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2154703">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154761">if</span>&nbsp;<span class="ident" id="2154764">err</span>&nbsp;<span class="op" id="2154768">!=</span>&nbsp;<span class="ident" id="2154771">nil</span>&nbsp;<span class="op" id="2154775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154780">if</span>&nbsp;<span class="ident" id="2154783">err</span>&nbsp;<span class="op" id="2154787">!=</span>&nbsp;<span class="ident" id="2154790">io</span><span class="op" id="2154792">.</span><span class="ident" id="2154793">EOF</span>&nbsp;<span class="op" id="2154797">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154803">fmt</span><span class="op" id="2154806">.</span><span class="ident" id="2154807">Fprintf</span><span class="op" id="2154814">(</span><span class="op" id="2154815">&amp;</span><span class="ident" id="2154816">buf</span><span class="op" id="2154819">,</span>&nbsp;<span class="string" id="2154821">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="2154844">,</span>&nbsp;<span class="ident" id="2154846">err</span><span class="op" id="2154849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2154859">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2154870">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2154874">w</span><span class="op" id="2154875">.</span><span class="ident" id="2154876">Write</span><span class="op" id="2154881">(</span><span class="ident" id="2154882">buf</span><span class="op" id="2154885">.</span><span class="ident" id="2154886">Bytes</span><span class="op" id="2154891">(</span><span class="op" id="2154892">)</span><span class="op" id="2154893">)</span><br>
<span class="lineno"></span><span class="op" id="2154895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2154898">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="2154964">func</span>&nbsp;<span class="ident" id="2154969">Handler</span><span class="op" id="2154976">(</span><span class="ident" id="2154977">name</span>&nbsp;<span class="builtintype" id="2154982">string</span><span class="op" id="2154988">)</span>&nbsp;<span class="ident" id="2154990">http</span><span class="op" id="2154994">.</span><span class="ident" id="2154995">Handler</span>&nbsp;<span class="op" id="2155003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155006">return</span>&nbsp;<span class="ident" id="2155013">handler</span><span class="op" id="2155020">(</span><span class="ident" id="2155021">name</span><span class="op" id="2155025">)</span><br>
<span class="lineno"></span><span class="op" id="2155027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2155030">type</span>&nbsp;<span class="ident" id="2155035">handler</span>&nbsp;<span class="builtintype" id="2155043">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="2155051">func</span>&nbsp;<span class="op" id="2155056">(</span><span class="ident" id="2155057">name</span>&nbsp;<span class="ident" id="2155062">handler</span><span class="op" id="2155069">)</span>&nbsp;<span class="ident" id="2155071">ServeHTTP</span><span class="op" id="2155080">(</span><span class="ident" id="2155081">w</span>&nbsp;<span class="ident" id="2155083">http</span><span class="op" id="2155087">.</span><span class="ident" id="2155088">ResponseWriter</span><span class="op" id="2155102">,</span>&nbsp;<span class="ident" id="2155104">r</span>&nbsp;<span class="op" id="2155106">*</span><span class="ident" id="2155107">http</span><span class="op" id="2155111">.</span><span class="ident" id="2155112">Request</span><span class="op" id="2155119">)</span>&nbsp;<span class="op" id="2155121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155124">w</span><span class="op" id="2155125">.</span><span class="ident" id="2155126">Header</span><span class="op" id="2155132">(</span><span class="op" id="2155133">)</span><span class="op" id="2155134">.</span><span class="ident" id="2155135">Set</span><span class="op" id="2155138">(</span><span class="string" id="2155139">&#34;Content-Type&#34;</span><span class="op" id="2155153">,</span>&nbsp;<span class="string" id="2155155">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="2155182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155185">debug</span><span class="op" id="2155190">,</span>&nbsp;<span class="ident" id="2155192">_</span>&nbsp;<span class="op" id="2155194">:=</span>&nbsp;<span class="ident" id="2155197">strconv</span><span class="op" id="2155204">.</span><span class="ident" id="2155205">Atoi</span><span class="op" id="2155209">(</span><span class="ident" id="2155210">r</span><span class="op" id="2155211">.</span><span class="ident" id="2155212">FormValue</span><span class="op" id="2155221">(</span><span class="string" id="2155222">&#34;debug&#34;</span><span class="op" id="2155229">)</span><span class="op" id="2155230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155233">p</span>&nbsp;<span class="op" id="2155235">:=</span>&nbsp;<span class="ident" id="2155238">pprof</span><span class="op" id="2155243">.</span><span class="ident" id="2155244">Lookup</span><span class="op" id="2155250">(</span><span class="builtintype" id="2155251">string</span><span class="op" id="2155257">(</span><span class="ident" id="2155258">name</span><span class="op" id="2155262">)</span><span class="op" id="2155263">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155266">if</span>&nbsp;<span class="ident" id="2155269">p</span>&nbsp;<span class="op" id="2155271">==</span>&nbsp;<span class="ident" id="2155274">nil</span>&nbsp;<span class="op" id="2155278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155282">w</span><span class="op" id="2155283">.</span><span class="ident" id="2155284">WriteHeader</span><span class="op" id="2155295">(</span><span class="num" id="2155296">404</span><span class="op" id="2155299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155303">fmt</span><span class="op" id="2155306">.</span><span class="ident" id="2155307">Fprintf</span><span class="op" id="2155314">(</span><span class="ident" id="2155315">w</span><span class="op" id="2155316">,</span>&nbsp;<span class="string" id="2155318">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="2155341">,</span>&nbsp;<span class="ident" id="2155343">name</span><span class="op" id="2155347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155351">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155359">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155362">gc</span><span class="op" id="2155364">,</span>&nbsp;<span class="ident" id="2155366">_</span>&nbsp;<span class="op" id="2155368">:=</span>&nbsp;<span class="ident" id="2155371">strconv</span><span class="op" id="2155378">.</span><span class="ident" id="2155379">Atoi</span><span class="op" id="2155383">(</span><span class="ident" id="2155384">r</span><span class="op" id="2155385">.</span><span class="ident" id="2155386">FormValue</span><span class="op" id="2155395">(</span><span class="string" id="2155396">&#34;gc&#34;</span><span class="op" id="2155400">)</span><span class="op" id="2155401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155404">if</span>&nbsp;<span class="ident" id="2155407">name</span>&nbsp;<span class="op" id="2155412">==</span>&nbsp;<span class="string" id="2155415">&#34;heap&#34;</span>&nbsp;<span class="op" id="2155422">&amp;&amp;</span>&nbsp;<span class="ident" id="2155425">gc</span>&nbsp;<span class="op" id="2155428">&gt;</span>&nbsp;<span class="num" id="2155430">0</span>&nbsp;<span class="op" id="2155432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155436">runtime</span><span class="op" id="2155443">.</span><span class="ident" id="2155444">GC</span><span class="op" id="2155446">(</span><span class="op" id="2155447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155453">p</span><span class="op" id="2155454">.</span><span class="ident" id="2155455">WriteTo</span><span class="op" id="2155462">(</span><span class="ident" id="2155463">w</span><span class="op" id="2155464">,</span>&nbsp;<span class="ident" id="2155466">debug</span><span class="op" id="2155471">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155474">return</span><br>
<span class="lineno"></span><span class="op" id="2155481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2155484">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2155557">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="2155620">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="2155689">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="2155724">func</span>&nbsp;<span class="ident" id="2155729">Index</span><span class="op" id="2155734">(</span><span class="ident" id="2155735">w</span>&nbsp;<span class="ident" id="2155737">http</span><span class="op" id="2155741">.</span><span class="ident" id="2155742">ResponseWriter</span><span class="op" id="2155756">,</span>&nbsp;<span class="ident" id="2155758">r</span>&nbsp;<span class="op" id="2155760">*</span><span class="ident" id="2155761">http</span><span class="op" id="2155765">.</span><span class="ident" id="2155766">Request</span><span class="op" id="2155773">)</span>&nbsp;<span class="op" id="2155775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155778">if</span>&nbsp;<span class="ident" id="2155781">strings</span><span class="op" id="2155788">.</span><span class="ident" id="2155789">HasPrefix</span><span class="op" id="2155798">(</span><span class="ident" id="2155799">r</span><span class="op" id="2155800">.</span><span class="ident" id="2155801">URL</span><span class="op" id="2155804">.</span><span class="ident" id="2155805">Path</span><span class="op" id="2155809">,</span>&nbsp;<span class="string" id="2155811">&#34;/debug/pprof/&#34;</span><span class="op" id="2155826">)</span>&nbsp;<span class="op" id="2155828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155832">name</span>&nbsp;<span class="op" id="2155837">:=</span>&nbsp;<span class="ident" id="2155840">strings</span><span class="op" id="2155847">.</span><span class="ident" id="2155848">TrimPrefix</span><span class="op" id="2155858">(</span><span class="ident" id="2155859">r</span><span class="op" id="2155860">.</span><span class="ident" id="2155861">URL</span><span class="op" id="2155864">.</span><span class="ident" id="2155865">Path</span><span class="op" id="2155869">,</span>&nbsp;<span class="string" id="2155871">&#34;/debug/pprof/&#34;</span><span class="op" id="2155886">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155890">if</span>&nbsp;<span class="ident" id="2155893">name</span>&nbsp;<span class="op" id="2155898">!=</span>&nbsp;<span class="string" id="2155901">&#34;&#34;</span>&nbsp;<span class="op" id="2155904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155909">handler</span><span class="op" id="2155916">(</span><span class="ident" id="2155917">name</span><span class="op" id="2155921">)</span><span class="op" id="2155922">.</span><span class="ident" id="2155923">ServeHTTP</span><span class="op" id="2155932">(</span><span class="ident" id="2155933">w</span><span class="op" id="2155934">,</span>&nbsp;<span class="ident" id="2155936">r</span><span class="op" id="2155937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155942">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2155954">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2155958">profiles</span>&nbsp;<span class="op" id="2155967">:=</span>&nbsp;<span class="ident" id="2155970">pprof</span><span class="op" id="2155975">.</span><span class="ident" id="2155976">Profiles</span><span class="op" id="2155984">(</span><span class="op" id="2155985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2155988">if</span>&nbsp;<span class="ident" id="2155991">err</span>&nbsp;<span class="op" id="2155995">:=</span>&nbsp;<span class="ident" id="2155998">indexTmpl</span><span class="op" id="2156007">.</span><span class="ident" id="2156008">Execute</span><span class="op" id="2156015">(</span><span class="ident" id="2156016">w</span><span class="op" id="2156017">,</span>&nbsp;<span class="ident" id="2156019">profiles</span><span class="op" id="2156027">)</span><span class="op" id="2156028">;</span>&nbsp;<span class="ident" id="2156030">err</span>&nbsp;<span class="op" id="2156034">!=</span>&nbsp;<span class="ident" id="2156037">nil</span>&nbsp;<span class="op" id="2156041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2156045">log</span><span class="op" id="2156048">.</span><span class="ident" id="2156049">Print</span><span class="op" id="2156054">(</span><span class="ident" id="2156055">err</span><span class="op" id="2156058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2156061">}</span><br>
<span class="lineno">190</span><span class="op" id="2156063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2156066">var</span>&nbsp;<span class="ident" id="2156070">indexTmpl</span>&nbsp;<span class="op" id="2156080">=</span>&nbsp;<span class="ident" id="2156082">template</span><span class="op" id="2156090">.</span><span class="ident" id="2156091">Must</span><span class="op" id="2156095">(</span><span class="ident" id="2156096">template</span><span class="op" id="2156104">.</span><span class="ident" id="2156105">New</span><span class="op" id="2156108">(</span><span class="string" id="2156109">&#34;index&#34;</span><span class="op" id="2156116">)</span><span class="op" id="2156117">.</span><span class="ident" id="2156118">Parse</span><span class="op" id="2156123">(</span><span class="string" id="2156124">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="2156443">)</span><span class="op" id="2156444">)</span>
</div>
</body>
</html>
