<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5847325">package</span>&nbsp;<span class="ident" id="5847333">link8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5847340">import</span>&nbsp;<span class="op" id="5847347">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5847350">&#34;fmt&#34;</span><br>
<span class="lineno">5</span><span class="op" id="5847356">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5847359">//&nbsp;LinkMain&nbsp;produces&nbsp;a&nbsp;image&nbsp;for&nbsp;a&nbsp;main()&nbsp;in&nbsp;a&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="5847415">func</span>&nbsp;<span class="ident" id="5847420">LinkMain</span><span class="op" id="5847428">(</span><span class="ident" id="5847429">main</span>&nbsp;<span class="op" id="5847434">*</span><span class="ident" id="5847435">Package</span><span class="op" id="5847442">)</span>&nbsp;<span class="op" id="5847444">(</span><span class="op" id="5847445">[</span><span class="op" id="5847446">]</span><span class="builtintype" id="5847447">byte</span><span class="op" id="5847451">,</span>&nbsp;<span class="builtintype" id="5847453">error</span><span class="op" id="5847458">)</span>&nbsp;<span class="op" id="5847460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847463">lnk</span>&nbsp;<span class="op" id="5847467">:=</span>&nbsp;<span class="ident" id="5847470">NewLinker</span><span class="op" id="5847479">(</span><span class="op" id="5847480">)</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847483">lnk</span><span class="op" id="5847486">.</span><span class="ident" id="5847487">AddPkgs</span><span class="op" id="5847494">(</span><span class="ident" id="5847495">main</span><span class="op" id="5847499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847503">funcMain</span><span class="op" id="5847511">,</span>&nbsp;<span class="ident" id="5847513">index</span>&nbsp;<span class="op" id="5847519">:=</span>&nbsp;<span class="ident" id="5847522">main</span><span class="op" id="5847526">.</span><span class="ident" id="5847527">Query</span><span class="op" id="5847532">(</span><span class="string" id="5847533">&#34;main&#34;</span><span class="op" id="5847539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847542">if</span>&nbsp;<span class="ident" id="5847545">funcMain</span>&nbsp;<span class="op" id="5847554">==</span>&nbsp;<span class="ident" id="5847557">nil</span>&nbsp;<span class="op" id="5847561">||</span>&nbsp;<span class="ident" id="5847564">funcMain</span><span class="op" id="5847572">.</span><span class="ident" id="5847573">Type</span>&nbsp;<span class="op" id="5847578">!=</span>&nbsp;<span class="ident" id="5847581">SymFunc</span>&nbsp;<span class="op" id="5847589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847593">return</span>&nbsp;<span class="ident" id="5847600">nil</span><span class="op" id="5847603">,</span>&nbsp;<span class="ident" id="5847605">fmt</span><span class="op" id="5847608">.</span><span class="ident" id="5847609">Errorf</span><span class="op" id="5847615">(</span><span class="string" id="5847616">&#34;main&nbsp;function&nbsp;missing&#34;</span><span class="op" id="5847639">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847646">used</span>&nbsp;<span class="op" id="5847651">:=</span>&nbsp;<span class="ident" id="5847654">traceUsed</span><span class="op" id="5847663">(</span><span class="ident" id="5847664">lnk</span><span class="op" id="5847667">,</span>&nbsp;<span class="ident" id="5847669">main</span><span class="op" id="5847673">,</span>&nbsp;<span class="ident" id="5847675">index</span><span class="op" id="5847680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847684">funcs</span><span class="op" id="5847689">,</span>&nbsp;<span class="ident" id="5847691">vars</span><span class="op" id="5847695">,</span>&nbsp;<span class="ident" id="5847697">e</span>&nbsp;<span class="op" id="5847699">:=</span>&nbsp;<span class="ident" id="5847702">layout</span><span class="op" id="5847708">(</span><span class="ident" id="5847709">used</span><span class="op" id="5847713">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847716">if</span>&nbsp;<span class="ident" id="5847719">e</span>&nbsp;<span class="op" id="5847721">!=</span>&nbsp;<span class="ident" id="5847724">nil</span>&nbsp;<span class="op" id="5847728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847732">return</span>&nbsp;<span class="ident" id="5847739">nil</span><span class="op" id="5847742">,</span>&nbsp;<span class="ident" id="5847744">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847751">w</span>&nbsp;<span class="op" id="5847753">:=</span>&nbsp;<span class="ident" id="5847756">newWriter</span><span class="op" id="5847765">(</span><span class="op" id="5847766">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847769">for</span>&nbsp;<span class="ident" id="5847773">_</span><span class="op" id="5847774">,</span>&nbsp;<span class="ident" id="5847776">f</span>&nbsp;<span class="op" id="5847778">:=</span>&nbsp;<span class="keyword" id="5847781">range</span>&nbsp;<span class="ident" id="5847787">funcs</span>&nbsp;<span class="op" id="5847793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847797">writeFunc</span><span class="op" id="5847806">(</span><span class="ident" id="5847807">w</span><span class="op" id="5847808">,</span>&nbsp;<span class="ident" id="5847810">f</span><span class="op" id="5847811">.</span><span class="ident" id="5847812">pkg</span><span class="op" id="5847815">,</span>&nbsp;<span class="ident" id="5847817">f</span><span class="op" id="5847818">.</span><span class="ident" id="5847819">Func</span><span class="op" id="5847823">(</span><span class="op" id="5847824">)</span><span class="op" id="5847825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847832">for</span>&nbsp;<span class="ident" id="5847836">_</span><span class="op" id="5847837">,</span>&nbsp;<span class="ident" id="5847839">v</span>&nbsp;<span class="op" id="5847841">:=</span>&nbsp;<span class="keyword" id="5847844">range</span>&nbsp;<span class="ident" id="5847850">vars</span>&nbsp;<span class="op" id="5847855">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5847859">writeVar</span><span class="op" id="5847867">(</span><span class="ident" id="5847868">w</span><span class="op" id="5847869">,</span>&nbsp;<span class="ident" id="5847871">v</span><span class="op" id="5847872">.</span><span class="ident" id="5847873">Var</span><span class="op" id="5847876">(</span><span class="op" id="5847877">)</span><span class="op" id="5847878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5847881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5847885">return</span>&nbsp;<span class="ident" id="5847892">w</span><span class="op" id="5847893">.</span><span class="ident" id="5847894">bytes</span><span class="op" id="5847899">(</span><span class="op" id="5847900">)</span><span class="op" id="5847901">,</span>&nbsp;<span class="ident" id="5847903">nil</span><br>
<span class="lineno"></span><span class="op" id="5847907">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5847910">//&nbsp;LinkBareFunc&nbsp;produces&nbsp;a&nbsp;image&nbsp;of&nbsp;a&nbsp;single&nbsp;function&nbsp;that&nbsp;has&nbsp;no&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="5847983">func</span>&nbsp;<span class="ident" id="5847988">LinkBareFunc</span><span class="op" id="5848000">(</span><span class="ident" id="5848001">f</span>&nbsp;<span class="op" id="5848003">*</span><span class="ident" id="5848004">Func</span><span class="op" id="5848008">)</span>&nbsp;<span class="op" id="5848010">(</span><span class="op" id="5848011">[</span><span class="op" id="5848012">]</span><span class="builtintype" id="5848013">byte</span><span class="op" id="5848017">,</span>&nbsp;<span class="builtintype" id="5848019">error</span><span class="op" id="5848024">)</span>&nbsp;<span class="op" id="5848026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848029">if</span>&nbsp;<span class="ident" id="5848032">f</span><span class="op" id="5848033">.</span><span class="ident" id="5848034">TooLarge</span><span class="op" id="5848042">(</span><span class="op" id="5848043">)</span>&nbsp;<span class="op" id="5848045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848049">return</span>&nbsp;<span class="ident" id="5848056">nil</span><span class="op" id="5848059">,</span>&nbsp;<span class="ident" id="5848061">fmt</span><span class="op" id="5848064">.</span><span class="ident" id="5848065">Errorf</span><span class="op" id="5848071">(</span><span class="string" id="5848072">&#34;code&nbsp;section&nbsp;too&nbsp;large&#34;</span><span class="op" id="5848096">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5848099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848103">w</span>&nbsp;<span class="op" id="5848105">:=</span>&nbsp;<span class="ident" id="5848108">newWriter</span><span class="op" id="5848117">(</span><span class="op" id="5848118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5848121">w</span><span class="op" id="5848122">.</span><span class="ident" id="5848123">writeBareFunc</span><span class="op" id="5848136">(</span><span class="ident" id="5848137">f</span><span class="op" id="5848138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5848141">return</span>&nbsp;<span class="ident" id="5848148">w</span><span class="op" id="5848149">.</span><span class="ident" id="5848150">bytes</span><span class="op" id="5848155">(</span><span class="op" id="5848156">)</span><span class="op" id="5848157">,</span>&nbsp;<span class="ident" id="5848159">nil</span><br>
<span class="lineno">45</span><span class="op" id="5848163">}</span>
</div>
</body>
</html>
