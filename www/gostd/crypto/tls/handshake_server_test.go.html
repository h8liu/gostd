<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8132320">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8132375">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8132429">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8132480">package</span>&nbsp;<span class="ident" id="8132488">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8132493">import</span>&nbsp;<span class="op" id="8132500">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132503">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132512">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132528">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132547">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132561">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132577">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132593">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132603">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132610">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132616">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132628">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132635">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132641">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132652">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132669">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132680">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8132691">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="8132698">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8132701">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8132779">type</span>&nbsp;<span class="ident" id="8132784">zeroSource</span>&nbsp;<span class="keyword" id="8132795">struct</span><span class="op" id="8132801">{</span><span class="op" id="8132802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8132805">func</span>&nbsp;<span class="op" id="8132810">(</span><span class="ident" id="8132811"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132784">zeroSource</a></span><span class="op" id="8132821">)</span>&nbsp;<span class="ident" id="8132823">Read</span><span class="op" id="8132827">(</span><span class="ident" id="8132828">b</span>&nbsp;<span class="op" id="8132830">[</span><span class="op" id="8132831">]</span><span class="builtintype" id="8132832">byte</span><span class="op" id="8132836">)</span>&nbsp;<span class="op" id="8132838">(</span><span class="ident" id="8132839">n</span>&nbsp;<span class="builtintype" id="8132841">int</span><span class="op" id="8132844">,</span>&nbsp;<span class="ident" id="8132846">err</span>&nbsp;<span class="builtintype" id="8132850">error</span><span class="op" id="8132855">)</span>&nbsp;<span class="op" id="8132857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132860">for</span>&nbsp;<span class="ident" id="8132864">i</span>&nbsp;<span class="op" id="8132866">:=</span>&nbsp;<span class="keyword" id="8132869">range</span>&nbsp;<span class="ident" id="8132875"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132828">b</a></span>&nbsp;<span class="op" id="8132877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132881"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132828">b</a></span><span class="op" id="8132882">[</span><span class="ident" id="8132883"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132864">i</a></span><span class="op" id="8132884">]</span>&nbsp;<span class="op" id="8132886">=</span>&nbsp;<span class="num" id="8132888">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8132891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8132895">return</span>&nbsp;<span class="builtinfunc" id="8132902">len</span><span class="op" id="8132905">(</span><span class="ident" id="8132906"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132828">b</a></span><span class="op" id="8132907">)</span><span class="op" id="8132908">,</span>&nbsp;<span class="builtintype" id="8132910">nil</span><br>
<span class="lineno"></span><span class="op" id="8132914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8132917">var</span>&nbsp;<span class="ident" id="8132921">testConfig</span>&nbsp;<span class="op" id="8132932">*</span><span class="ident" id="8132933"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8132941">func</span>&nbsp;<span class="ident" id="8132946">init</span><span class="op" id="8132950">(</span><span class="op" id="8132951">)</span>&nbsp;<span class="op" id="8132953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132956"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span>&nbsp;<span class="op" id="8132967">=</span>&nbsp;<span class="op" id="8132969">&amp;</span><span class="ident" id="8132970"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8132976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8132980"><a href="/gostd/crypto/tls/common.go.html#4450848">Time</a></span><span class="op" id="8132984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133000">func</span><span class="op" id="8133004">(</span><span class="op" id="8133005">)</span>&nbsp;<span class="ident" id="8133007"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132691">time</a></span><span class="op" id="8133011">.</span><span class="ident" id="8133012"><a href="/gostd/time/time.go.html#2722087">Time</a></span>&nbsp;<span class="op" id="8133017">{</span>&nbsp;<span class="keyword" id="8133019">return</span>&nbsp;<span class="ident" id="8133026"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132691">time</a></span><span class="op" id="8133030">.</span><span class="ident" id="8133031"><a href="/gostd/time/time.go.html#2748704">Unix</a></span><span class="op" id="8133035">(</span><span class="num" id="8133036">0</span><span class="op" id="8133037">,</span>&nbsp;<span class="num" id="8133039">0</span><span class="op" id="8133040">)</span>&nbsp;<span class="op" id="8133042">}</span><span class="op" id="8133043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133047"><a href="/gostd/crypto/tls/common.go.html#4450716">Rand</a></span><span class="op" id="8133051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133067"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132784">zeroSource</a></span><span class="op" id="8133077">{</span><span class="op" id="8133078">}</span><span class="op" id="8133079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133083"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8133095">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8133103">make</span><span class="op" id="8133107">(</span><span class="op" id="8133108">[</span><span class="op" id="8133109">]</span><span class="ident" id="8133110"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8133121">,</span>&nbsp;<span class="num" id="8133123">2</span><span class="op" id="8133124">)</span><span class="op" id="8133125">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133129"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span><span class="op" id="8133147">:</span>&nbsp;<span class="builtintype" id="8133149">true</span><span class="op" id="8133153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133157"><a href="/gostd/crypto/tls/common.go.html#4454285">MinVersion</a></span><span class="op" id="8133167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133177"><a href="/gostd/crypto/tls/common.go.html#4442440">VersionSSL30</a></span><span class="op" id="8133189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133193"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span><span class="op" id="8133203">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133213"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span><span class="op" id="8133225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133231"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133241">.</span><span class="ident" id="8133242"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8133254">[</span><span class="num" id="8133255">0</span><span class="op" id="8133256">]</span><span class="op" id="8133257">.</span><span class="ident" id="8133258"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span>&nbsp;<span class="op" id="8133270">=</span>&nbsp;<span class="op" id="8133272">[</span><span class="op" id="8133273">]</span><span class="op" id="8133274">[</span><span class="op" id="8133275">]</span><span class="builtintype" id="8133276">byte</span><span class="op" id="8133280">{</span><span class="ident" id="8133281"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8158000">testRSACertificate</a></span><span class="op" id="8133299">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133302"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133312">.</span><span class="ident" id="8133313"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8133325">[</span><span class="num" id="8133326">0</span><span class="op" id="8133327">]</span><span class="op" id="8133328">.</span><span class="ident" id="8133329"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span>&nbsp;<span class="op" id="8133340">=</span>&nbsp;<span class="ident" id="8133342"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8161536">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133361"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133371">.</span><span class="ident" id="8133372"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8133384">[</span><span class="num" id="8133385">1</span><span class="op" id="8133386">]</span><span class="op" id="8133387">.</span><span class="ident" id="8133388"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span>&nbsp;<span class="op" id="8133400">=</span>&nbsp;<span class="op" id="8133402">[</span><span class="op" id="8133403">]</span><span class="op" id="8133404">[</span><span class="op" id="8133405">]</span><span class="builtintype" id="8133406">byte</span><span class="op" id="8133410">{</span><span class="ident" id="8133411"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8160494">testSNICertificate</a></span><span class="op" id="8133429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133432"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133442">.</span><span class="ident" id="8133443"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8133455">[</span><span class="num" id="8133456">1</span><span class="op" id="8133457">]</span><span class="op" id="8133458">.</span><span class="ident" id="8133459"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span>&nbsp;<span class="op" id="8133470">=</span>&nbsp;<span class="ident" id="8133472"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8161536">testRSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133491"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133501">.</span><span class="ident" id="8133502"><a href="/gostd/crypto/tls/common.go.html#4457481">BuildNameToCertificate</a></span><span class="op" id="8133524">(</span><span class="op" id="8133525">)</span><br>
<span class="lineno"></span><span class="op" id="8133527">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8133530">func</span>&nbsp;<span class="ident" id="8133535">testClientHelloFailure</span><span class="op" id="8133557">(</span><span class="ident" id="8133558">t</span>&nbsp;<span class="op" id="8133560">*</span><span class="ident" id="8133561"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8133568">.</span><span class="ident" id="8133569"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8133570">,</span>&nbsp;<span class="ident" id="8133572">m</span>&nbsp;<span class="ident" id="8133574"><a href="/gostd/crypto/tls/common.go.html#4458876">handshakeMessage</a></span><span class="op" id="8133590">,</span>&nbsp;<span class="ident" id="8133592">expectedSubStr</span>&nbsp;<span class="builtintype" id="8133607">string</span><span class="op" id="8133613">)</span>&nbsp;<span class="op" id="8133615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8133618">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8133659">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8133702">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133722">c</span><span class="op" id="8133723">,</span>&nbsp;<span class="ident" id="8133725">s</span>&nbsp;<span class="op" id="8133727">:=</span>&nbsp;<span class="ident" id="8133730"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8133733">.</span><span class="ident" id="8133734"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8133738">(</span><span class="op" id="8133739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133742">go</span>&nbsp;<span class="keyword" id="8133745">func</span><span class="op" id="8133749">(</span><span class="op" id="8133750">)</span>&nbsp;<span class="op" id="8133752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133756">cli</span>&nbsp;<span class="op" id="8133760">:=</span>&nbsp;<span class="ident" id="8133763"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="8133769">(</span><span class="ident" id="8133770"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133722">c</a></span><span class="op" id="8133771">,</span>&nbsp;<span class="ident" id="8133773"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133787">if</span>&nbsp;<span class="ident" id="8133790">ch</span><span class="op" id="8133792">,</span>&nbsp;<span class="ident" id="8133794">ok</span>&nbsp;<span class="op" id="8133797">:=</span>&nbsp;<span class="ident" id="8133800"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133572">m</a></span><span class="op" id="8133801">.</span><span class="op" id="8133802">(</span><span class="op" id="8133803">*</span><span class="ident" id="8133804"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="8133818">)</span><span class="op" id="8133819">;</span>&nbsp;<span class="ident" id="8133821"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133794">ok</a></span>&nbsp;<span class="op" id="8133824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133829"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133756">cli</a></span><span class="op" id="8133832">.</span><span class="ident" id="8133833"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span>&nbsp;<span class="op" id="8133838">=</span>&nbsp;<span class="ident" id="8133840"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133790">ch</a></span><span class="op" id="8133842">.</span><span class="ident" id="8133843"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133854"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133756">cli</a></span><span class="op" id="8133857">.</span><span class="ident" id="8133858"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="8133869">(</span><span class="ident" id="8133870"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="8133889">,</span>&nbsp;<span class="ident" id="8133891"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133572">m</a></span><span class="op" id="8133892">.</span><span class="ident" id="8133893"><a href="/gostd/crypto/tls/common.go.html#4458906">marshal</a></span><span class="op" id="8133900">(</span><span class="op" id="8133901">)</span><span class="op" id="8133902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133906"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133722">c</a></span><span class="op" id="8133907">.</span><span class="ident" id="8133908"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8133913">(</span><span class="op" id="8133914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8133917">}</span><span class="op" id="8133918">(</span><span class="op" id="8133919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133922">err</span>&nbsp;<span class="op" id="8133926">:=</span>&nbsp;<span class="ident" id="8133929"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8133935">(</span><span class="ident" id="8133936"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133725">s</a></span><span class="op" id="8133937">,</span>&nbsp;<span class="ident" id="8133939"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8133949">)</span><span class="op" id="8133950">.</span><span class="ident" id="8133951"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8133960">(</span><span class="op" id="8133961">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8133964"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133725">s</a></span><span class="op" id="8133965">.</span><span class="ident" id="8133966"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8133971">(</span><span class="op" id="8133972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8133975">if</span>&nbsp;<span class="ident" id="8133978"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133922">err</a></span>&nbsp;<span class="op" id="8133982">==</span>&nbsp;<span class="builtintype" id="8133985">nil</span>&nbsp;<span class="op" id="8133989">||</span>&nbsp;<span class="op" id="8133992">!</span><span class="ident" id="8133993"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132669">strings</a></span><span class="op" id="8134000">.</span><span class="ident" id="8134001"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="8134009">(</span><span class="ident" id="8134010"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133922">err</a></span><span class="op" id="8134013">.</span><span class="ident" id="8134014">Error</span><span class="op" id="8134019">(</span><span class="op" id="8134020">)</span><span class="op" id="8134021">,</span>&nbsp;<span class="ident" id="8134023"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133592">expectedSubStr</a></span><span class="op" id="8134037">)</span>&nbsp;<span class="op" id="8134039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134043"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133558">t</a></span><span class="op" id="8134044">.</span><span class="ident" id="8134045"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="8134051">(</span><span class="string" id="8134052">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8134101">,</span>&nbsp;<span class="ident" id="8134103"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133922">err</a></span><span class="op" id="8134106">,</span>&nbsp;<span class="ident" id="8134108"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133592">expectedSubStr</a></span><span class="op" id="8134122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134125">}</span><br>
<span class="lineno"></span><span class="op" id="8134127">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8134130">func</span>&nbsp;<span class="ident" id="8134135">TestSimpleError</span><span class="op" id="8134150">(</span><span class="ident" id="8134151">t</span>&nbsp;<span class="op" id="8134153">*</span><span class="ident" id="8134154"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8134161">.</span><span class="ident" id="8134162"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8134163">)</span>&nbsp;<span class="op" id="8134165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134168"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133535">testClientHelloFailure</a></span><span class="op" id="8134190">(</span><span class="ident" id="8134191"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134151">t</a></span><span class="op" id="8134192">,</span>&nbsp;<span class="op" id="8134194">&amp;</span><span class="ident" id="8134195"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528418">serverHelloDoneMsg</a></span><span class="op" id="8134213">{</span><span class="op" id="8134214">}</span><span class="op" id="8134215">,</span>&nbsp;<span class="string" id="8134217">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="8134247">)</span><br>
<span class="lineno"></span><span class="op" id="8134249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8134252">var</span>&nbsp;<span class="ident" id="8134256">badProtocolVersions</span>&nbsp;<span class="op" id="8134276">=</span>&nbsp;<span class="op" id="8134278">[</span><span class="op" id="8134279">]</span><span class="builtintype" id="8134280">uint16</span><span class="op" id="8134286">{</span><span class="num" id="8134287">0x0000</span><span class="op" id="8134293">,</span>&nbsp;<span class="num" id="8134295">0x0005</span><span class="op" id="8134301">,</span>&nbsp;<span class="num" id="8134303">0x0100</span><span class="op" id="8134309">,</span>&nbsp;<span class="num" id="8134311">0x0105</span><span class="op" id="8134317">,</span>&nbsp;<span class="num" id="8134319">0x0200</span><span class="op" id="8134325">,</span>&nbsp;<span class="num" id="8134327">0x0205</span><span class="op" id="8134333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8134336">func</span>&nbsp;<span class="ident" id="8134341">TestRejectBadProtocolVersion</span><span class="op" id="8134369">(</span><span class="ident" id="8134370">t</span>&nbsp;<span class="op" id="8134372">*</span><span class="ident" id="8134373"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8134380">.</span><span class="ident" id="8134381"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8134382">)</span>&nbsp;<span class="op" id="8134384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8134387">for</span>&nbsp;<span class="ident" id="8134391">_</span><span class="op" id="8134392">,</span>&nbsp;<span class="ident" id="8134394">v</span>&nbsp;<span class="op" id="8134396">:=</span>&nbsp;<span class="keyword" id="8134399">range</span>&nbsp;<span class="ident" id="8134405"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134256">badProtocolVersions</a></span>&nbsp;<span class="op" id="8134425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134429"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133535">testClientHelloFailure</a></span><span class="op" id="8134451">(</span><span class="ident" id="8134452"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134370">t</a></span><span class="op" id="8134453">,</span>&nbsp;<span class="op" id="8134455">&amp;</span><span class="ident" id="8134456"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="8134470">{</span><span class="ident" id="8134471"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="8134475">:</span>&nbsp;<span class="ident" id="8134477"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134394">v</a></span><span class="op" id="8134478">}</span><span class="op" id="8134479">,</span>&nbsp;<span class="string" id="8134481">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="8134520">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134523">}</span><br>
<span class="lineno"></span><span class="op" id="8134525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8134528">func</span>&nbsp;<span class="ident" id="8134533">TestNoSuiteOverlap</span><span class="op" id="8134551">(</span><span class="ident" id="8134552">t</span>&nbsp;<span class="op" id="8134554">*</span><span class="ident" id="8134555"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8134562">.</span><span class="ident" id="8134563"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8134564">)</span>&nbsp;<span class="op" id="8134566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134569">clientHello</span>&nbsp;<span class="op" id="8134581">:=</span>&nbsp;<span class="op" id="8134584">&amp;</span><span class="ident" id="8134585"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="8134599">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134603"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="8134607">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8134623">0x0301</span><span class="op" id="8134629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134633"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><span class="op" id="8134645">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134653">[</span><span class="op" id="8134654">]</span><span class="builtintype" id="8134655">uint16</span><span class="op" id="8134661">{</span><span class="num" id="8134662">0xff00</span><span class="op" id="8134668">}</span><span class="op" id="8134669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134673"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508433">compressionMethods</a></span><span class="op" id="8134691">:</span>&nbsp;<span class="op" id="8134693">[</span><span class="op" id="8134694">]</span><span class="builtintype" id="8134695">uint8</span><span class="op" id="8134700">{</span><span class="num" id="8134701">0</span><span class="op" id="8134702">}</span><span class="op" id="8134703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134709"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133535">testClientHelloFailure</a></span><span class="op" id="8134731">(</span><span class="ident" id="8134732"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134552">t</a></span><span class="op" id="8134733">,</span>&nbsp;<span class="ident" id="8134735"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134569">clientHello</a></span><span class="op" id="8134746">,</span>&nbsp;<span class="string" id="8134748">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="8134801">)</span><br>
<span class="lineno">95</span><span class="op" id="8134803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8134806">func</span>&nbsp;<span class="ident" id="8134811">TestNoCompressionOverlap</span><span class="op" id="8134835">(</span><span class="ident" id="8134836">t</span>&nbsp;<span class="op" id="8134838">*</span><span class="ident" id="8134839"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8134846">.</span><span class="ident" id="8134847"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8134848">)</span>&nbsp;<span class="op" id="8134850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134853">clientHello</span>&nbsp;<span class="op" id="8134865">:=</span>&nbsp;<span class="op" id="8134868">&amp;</span><span class="ident" id="8134869"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="8134883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134887"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="8134891">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8134907">0x0301</span><span class="op" id="8134913">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134917"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><span class="op" id="8134929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8134937">[</span><span class="op" id="8134938">]</span><span class="builtintype" id="8134939">uint16</span><span class="op" id="8134945">{</span><span class="ident" id="8134946"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8134970">}</span><span class="op" id="8134971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8134975"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508433">compressionMethods</a></span><span class="op" id="8134993">:</span>&nbsp;<span class="op" id="8134995">[</span><span class="op" id="8134996">]</span><span class="builtintype" id="8134997">uint8</span><span class="op" id="8135002">{</span><span class="num" id="8135003">0xff</span><span class="op" id="8135007">}</span><span class="op" id="8135008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135014"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8133535">testClientHelloFailure</a></span><span class="op" id="8135036">(</span><span class="ident" id="8135037"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134836">t</a></span><span class="op" id="8135038">,</span>&nbsp;<span class="ident" id="8135040"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8134853">clientHello</a></span><span class="op" id="8135051">,</span>&nbsp;<span class="string" id="8135053">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="8135103">)</span><br>
<span class="lineno"></span><span class="op" id="8135105">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8135108">func</span>&nbsp;<span class="ident" id="8135113">TestTLS12OnlyCipherSuites</span><span class="op" id="8135138">(</span><span class="ident" id="8135139">t</span>&nbsp;<span class="op" id="8135141">*</span><span class="ident" id="8135142"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8135149">.</span><span class="ident" id="8135150"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8135151">)</span>&nbsp;<span class="op" id="8135153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135156">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135227">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135262">var</span>&nbsp;<span class="ident" id="8135266">zeros</span>&nbsp;<span class="op" id="8135272">[</span><span class="num" id="8135273">32</span><span class="op" id="8135275">]</span><span class="builtintype" id="8135276">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135283">clientHello</span>&nbsp;<span class="op" id="8135295">:=</span>&nbsp;<span class="op" id="8135298">&amp;</span><span class="ident" id="8135299"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="8135313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135317"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="8135321">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8135325"><a href="/gostd/crypto/tls/common.go.html#4442486">VersionTLS11</a></span><span class="op" id="8135337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135341"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="8135347">:</span>&nbsp;<span class="ident" id="8135349"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135266">zeros</a></span><span class="op" id="8135354">[</span><span class="op" id="8135355">:</span><span class="op" id="8135356">]</span><span class="op" id="8135357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135361"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><span class="op" id="8135373">:</span>&nbsp;<span class="op" id="8135375">[</span><span class="op" id="8135376">]</span><span class="builtintype" id="8135377">uint16</span><span class="op" id="8135383">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135388">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135440">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135488">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8135540">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135582"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441798">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</a></span><span class="op" id="8135619">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135624"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8135648">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135652">}</span><span class="op" id="8135653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135657"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508433">compressionMethods</a></span><span class="op" id="8135675">:</span>&nbsp;<span class="op" id="8135677">[</span><span class="op" id="8135678">]</span><span class="builtintype" id="8135679">uint8</span><span class="op" id="8135684">{</span><span class="ident" id="8135685"><a href="/gostd/crypto/tls/common.go.html#4443628">compressionNone</a></span><span class="op" id="8135700">}</span><span class="op" id="8135701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135705"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508542">supportedCurves</a></span><span class="op" id="8135720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135725">[</span><span class="op" id="8135726">]</span><span class="ident" id="8135727"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><span class="op" id="8135734">{</span><span class="ident" id="8135735"><a href="/gostd/crypto/tls/common.go.html#4444366">CurveP256</a></span><span class="op" id="8135744">,</span>&nbsp;<span class="ident" id="8135746"><a href="/gostd/crypto/tls/common.go.html#4444390">CurveP384</a></span><span class="op" id="8135755">,</span>&nbsp;<span class="ident" id="8135757"><a href="/gostd/crypto/tls/common.go.html#4444414">CurveP521</a></span><span class="op" id="8135766">}</span><span class="op" id="8135767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135771"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508573">supportedPoints</a></span><span class="op" id="8135786">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135791">[</span><span class="op" id="8135792">]</span><span class="builtintype" id="8135793">uint8</span><span class="op" id="8135798">{</span><span class="ident" id="8135799"><a href="/gostd/crypto/tls/common.go.html#4444571">pointFormatUncompressed</a></span><span class="op" id="8135822">}</span><span class="op" id="8135823">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8135826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135830">c</span><span class="op" id="8135831">,</span>&nbsp;<span class="ident" id="8135833">s</span>&nbsp;<span class="op" id="8135835">:=</span>&nbsp;<span class="ident" id="8135838"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8135841">.</span><span class="ident" id="8135842"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8135846">(</span><span class="op" id="8135847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135850">var</span>&nbsp;<span class="ident" id="8135854">reply</span>&nbsp;<span class="keyword" id="8135860">interface</span><span class="op" id="8135869">{</span><span class="op" id="8135870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135873">var</span>&nbsp;<span class="ident" id="8135877">clientErr</span>&nbsp;<span class="builtintype" id="8135887">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8135894">go</span>&nbsp;<span class="keyword" id="8135897">func</span><span class="op" id="8135901">(</span><span class="op" id="8135902">)</span>&nbsp;<span class="op" id="8135904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135908">cli</span>&nbsp;<span class="op" id="8135912">:=</span>&nbsp;<span class="ident" id="8135915"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="8135921">(</span><span class="ident" id="8135922"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135830">c</a></span><span class="op" id="8135923">,</span>&nbsp;<span class="ident" id="8135925"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8135935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135939"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135908">cli</a></span><span class="op" id="8135942">.</span><span class="ident" id="8135943"><a href="/gostd/crypto/tls/conn.go.html#4462168">vers</a></span>&nbsp;<span class="op" id="8135948">=</span>&nbsp;<span class="ident" id="8135950"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135283">clientHello</a></span><span class="op" id="8135961">.</span><span class="ident" id="8135962"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8135969"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135908">cli</a></span><span class="op" id="8135972">.</span><span class="ident" id="8135973"><a href="/gostd/crypto/tls/conn.go.html#4481088">writeRecord</a></span><span class="op" id="8135984">(</span><span class="ident" id="8135985"><a href="/gostd/crypto/tls/common.go.html#4443022">recordTypeHandshake</a></span><span class="op" id="8136004">,</span>&nbsp;<span class="ident" id="8136006"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135283">clientHello</a></span><span class="op" id="8136017">.</span><span class="ident" id="8136018"><a href="/gostd/crypto/tls/handshake_messages.go.html#4509641">marshal</a></span><span class="op" id="8136025">(</span><span class="op" id="8136026">)</span><span class="op" id="8136027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136031"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135854">reply</a></span><span class="op" id="8136036">,</span>&nbsp;<span class="ident" id="8136038"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135877">clientErr</a></span>&nbsp;<span class="op" id="8136048">=</span>&nbsp;<span class="ident" id="8136050"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135908">cli</a></span><span class="op" id="8136053">.</span><span class="ident" id="8136054"><a href="/gostd/crypto/tls/conn.go.html#4483177">readHandshake</a></span><span class="op" id="8136067">(</span><span class="op" id="8136068">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136072"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135830">c</a></span><span class="op" id="8136073">.</span><span class="ident" id="8136074"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136079">(</span><span class="op" id="8136080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136083">}</span><span class="op" id="8136084">(</span><span class="op" id="8136085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136088">config</span>&nbsp;<span class="op" id="8136095">:=</span>&nbsp;<span class="op" id="8136098">*</span><span class="ident" id="8136099"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136111"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136088">config</a></span><span class="op" id="8136117">.</span><span class="ident" id="8136118"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span>&nbsp;<span class="op" id="8136131">=</span>&nbsp;<span class="ident" id="8136133"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135283">clientHello</a></span><span class="op" id="8136144">.</span><span class="ident" id="8136145"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508403">cipherSuites</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136159"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8136165">(</span><span class="ident" id="8136166"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135833">s</a></span><span class="op" id="8136167">,</span>&nbsp;<span class="op" id="8136169">&amp;</span><span class="ident" id="8136170"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136088">config</a></span><span class="op" id="8136176">)</span><span class="op" id="8136177">.</span><span class="ident" id="8136178"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8136187">(</span><span class="op" id="8136188">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136191"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135833">s</a></span><span class="op" id="8136192">.</span><span class="ident" id="8136193"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136198">(</span><span class="op" id="8136199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136202">if</span>&nbsp;<span class="ident" id="8136205"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135877">clientErr</a></span>&nbsp;<span class="op" id="8136215">!=</span>&nbsp;<span class="builtintype" id="8136218">nil</span>&nbsp;<span class="op" id="8136222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136226"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135139">t</a></span><span class="op" id="8136227">.</span><span class="ident" id="8136228"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="8136233">(</span><span class="ident" id="8136234"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135877">clientErr</a></span><span class="op" id="8136243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136249">serverHello</span><span class="op" id="8136260">,</span>&nbsp;<span class="ident" id="8136262">ok</span>&nbsp;<span class="op" id="8136265">:=</span>&nbsp;<span class="ident" id="8136268"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135854">reply</a></span><span class="op" id="8136273">.</span><span class="op" id="8136274">(</span><span class="op" id="8136275">*</span><span class="ident" id="8136276"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="8136290">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136293">if</span>&nbsp;<span class="op" id="8136296">!</span><span class="ident" id="8136297"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136262">ok</a></span>&nbsp;<span class="op" id="8136300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136304"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135139">t</a></span><span class="op" id="8136305">.</span><span class="ident" id="8136306"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8136312">(</span><span class="string" id="8136313">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="8136364">,</span>&nbsp;<span class="ident" id="8136366"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135854">reply</a></span><span class="op" id="8136371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136377">if</span>&nbsp;<span class="ident" id="8136380">s</span>&nbsp;<span class="op" id="8136382">:=</span>&nbsp;<span class="ident" id="8136385"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136249">serverHello</a></span><span class="op" id="8136396">.</span><span class="ident" id="8136397"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519519">cipherSuite</a></span><span class="op" id="8136408">;</span>&nbsp;<span class="ident" id="8136410"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136380">s</a></span>&nbsp;<span class="op" id="8136412">!=</span>&nbsp;<span class="ident" id="8136415"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="8136440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136444"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8135139">t</a></span><span class="op" id="8136445">.</span><span class="ident" id="8136446"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8136452">(</span><span class="string" id="8136453">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="8136487">,</span>&nbsp;<span class="ident" id="8136489"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136380">s</a></span><span class="op" id="8136490">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136493">}</span><br>
<span class="lineno"></span><span class="op" id="8136495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136498">func</span>&nbsp;<span class="ident" id="8136503">TestAlertForwarding</span><span class="op" id="8136522">(</span><span class="ident" id="8136523">t</span>&nbsp;<span class="op" id="8136525">*</span><span class="ident" id="8136526"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8136533">.</span><span class="ident" id="8136534"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8136535">)</span>&nbsp;<span class="op" id="8136537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136540">c</span><span class="op" id="8136541">,</span>&nbsp;<span class="ident" id="8136543">s</span>&nbsp;<span class="op" id="8136545">:=</span>&nbsp;<span class="ident" id="8136548"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8136551">.</span><span class="ident" id="8136552"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8136556">(</span><span class="op" id="8136557">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136560">go</span>&nbsp;<span class="keyword" id="8136563">func</span><span class="op" id="8136567">(</span><span class="op" id="8136568">)</span>&nbsp;<span class="op" id="8136570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136574"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="8136580">(</span><span class="ident" id="8136581"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136540">c</a></span><span class="op" id="8136582">,</span>&nbsp;<span class="ident" id="8136584"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8136594">)</span><span class="op" id="8136595">.</span><span class="ident" id="8136596"><a href="/gostd/crypto/tls/conn.go.html#4480829">sendAlert</a></span><span class="op" id="8136605">(</span><span class="ident" id="8136606"><a href="/gostd/crypto/tls/alert.go.html#4430776">alertUnknownCA</a></span><span class="op" id="8136620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136624"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136540">c</a></span><span class="op" id="8136625">.</span><span class="ident" id="8136626"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136631">(</span><span class="op" id="8136632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136635">}</span><span class="op" id="8136636">(</span><span class="op" id="8136637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136641">err</span>&nbsp;<span class="op" id="8136645">:=</span>&nbsp;<span class="ident" id="8136648"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8136654">(</span><span class="ident" id="8136655"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136543">s</a></span><span class="op" id="8136656">,</span>&nbsp;<span class="ident" id="8136658"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8136668">)</span><span class="op" id="8136669">.</span><span class="ident" id="8136670"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8136679">(</span><span class="op" id="8136680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136683"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136543">s</a></span><span class="op" id="8136684">.</span><span class="ident" id="8136685"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136690">(</span><span class="op" id="8136691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136694">if</span>&nbsp;<span class="ident" id="8136697">e</span><span class="op" id="8136698">,</span>&nbsp;<span class="ident" id="8136700">ok</span>&nbsp;<span class="op" id="8136703">:=</span>&nbsp;<span class="ident" id="8136706"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136641">err</a></span><span class="op" id="8136709">.</span><span class="op" id="8136710">(</span><span class="op" id="8136711">*</span><span class="ident" id="8136712"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8136715">.</span><span class="ident" id="8136716"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="8136723">)</span><span class="op" id="8136724">;</span>&nbsp;<span class="op" id="8136726">!</span><span class="ident" id="8136727"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136700">ok</a></span>&nbsp;<span class="op" id="8136730">||</span>&nbsp;<span class="ident" id="8136733"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136697">e</a></span><span class="op" id="8136734">.</span><span class="ident" id="8136735"><a href="/gostd/net/net.go.html#3341902">Err</a></span>&nbsp;<span class="op" id="8136739">!=</span>&nbsp;<span class="builtintype" id="8136742">error</span><span class="op" id="8136747">(</span><span class="ident" id="8136748"><a href="/gostd/crypto/tls/alert.go.html#4430776">alertUnknownCA</a></span><span class="op" id="8136762">)</span>&nbsp;<span class="op" id="8136764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136768"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136523">t</a></span><span class="op" id="8136769">.</span><span class="ident" id="8136770"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="8136776">(</span><span class="string" id="8136777">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8136806">,</span>&nbsp;<span class="ident" id="8136808"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136641">err</a></span><span class="op" id="8136811">,</span>&nbsp;<span class="builtintype" id="8136813">error</span><span class="op" id="8136818">(</span><span class="ident" id="8136819"><a href="/gostd/crypto/tls/alert.go.html#4430776">alertUnknownCA</a></span><span class="op" id="8136833">)</span><span class="op" id="8136834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8136837">}</span><br>
<span class="lineno">165</span><span class="op" id="8136839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8136842">func</span>&nbsp;<span class="ident" id="8136847">TestClose</span><span class="op" id="8136856">(</span><span class="ident" id="8136857">t</span>&nbsp;<span class="op" id="8136859">*</span><span class="ident" id="8136860"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8136867">.</span><span class="ident" id="8136868"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8136869">)</span>&nbsp;<span class="op" id="8136871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136874">c</span><span class="op" id="8136875">,</span>&nbsp;<span class="ident" id="8136877">s</span>&nbsp;<span class="op" id="8136879">:=</span>&nbsp;<span class="ident" id="8136882"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8136885">.</span><span class="ident" id="8136886"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8136890">(</span><span class="op" id="8136891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136894">go</span>&nbsp;<span class="ident" id="8136897"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136874">c</a></span><span class="op" id="8136898">.</span><span class="ident" id="8136899"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136904">(</span><span class="op" id="8136905">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136909">err</span>&nbsp;<span class="op" id="8136913">:=</span>&nbsp;<span class="ident" id="8136916"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8136922">(</span><span class="ident" id="8136923"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136877">s</a></span><span class="op" id="8136924">,</span>&nbsp;<span class="ident" id="8136926"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8136936">)</span><span class="op" id="8136937">.</span><span class="ident" id="8136938"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8136947">(</span><span class="op" id="8136948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136951"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136877">s</a></span><span class="op" id="8136952">.</span><span class="ident" id="8136953"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8136958">(</span><span class="op" id="8136959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8136962">if</span>&nbsp;<span class="ident" id="8136965"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136909">err</a></span>&nbsp;<span class="op" id="8136969">!=</span>&nbsp;<span class="ident" id="8136972"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132610">io</a></span><span class="op" id="8136974">.</span><span class="ident" id="8136975"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="8136979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8136983"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136857">t</a></span><span class="op" id="8136984">.</span><span class="ident" id="8136985"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="8136991">(</span><span class="string" id="8136992">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8137021">,</span>&nbsp;<span class="ident" id="8137023"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8136909">err</a></span><span class="op" id="8137026">,</span>&nbsp;<span class="ident" id="8137028"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132610">io</a></span><span class="op" id="8137030">.</span><span class="ident" id="8137031"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><span class="op" id="8137034">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137037">}</span><br>
<span class="lineno"></span><span class="op" id="8137039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137042">func</span>&nbsp;<span class="ident" id="8137047">testHandshake</span><span class="op" id="8137060">(</span><span class="ident" id="8137061">clientConfig</span><span class="op" id="8137073">,</span>&nbsp;<span class="ident" id="8137075">serverConfig</span>&nbsp;<span class="op" id="8137088">*</span><span class="ident" id="8137089"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8137095">)</span>&nbsp;<span class="op" id="8137097">(</span><span class="ident" id="8137098">state</span>&nbsp;<span class="ident" id="8137104"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8137119">,</span>&nbsp;<span class="ident" id="8137121">err</span>&nbsp;<span class="builtintype" id="8137125">error</span><span class="op" id="8137130">)</span>&nbsp;<span class="op" id="8137132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137135">c</span><span class="op" id="8137136">,</span>&nbsp;<span class="ident" id="8137138">s</span>&nbsp;<span class="op" id="8137140">:=</span>&nbsp;<span class="ident" id="8137143"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8137146">.</span><span class="ident" id="8137147"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8137151">(</span><span class="op" id="8137152">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137155">done</span>&nbsp;<span class="op" id="8137160">:=</span>&nbsp;<span class="builtinfunc" id="8137163">make</span><span class="op" id="8137167">(</span><span class="keyword" id="8137168">chan</span>&nbsp;<span class="builtintype" id="8137173">bool</span><span class="op" id="8137177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137180">go</span>&nbsp;<span class="keyword" id="8137183">func</span><span class="op" id="8137187">(</span><span class="op" id="8137188">)</span>&nbsp;<span class="op" id="8137190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137194">cli</span>&nbsp;<span class="op" id="8137198">:=</span>&nbsp;<span class="ident" id="8137201"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="8137207">(</span><span class="ident" id="8137208"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137135">c</a></span><span class="op" id="8137209">,</span>&nbsp;<span class="ident" id="8137211"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137061">clientConfig</a></span><span class="op" id="8137223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137227"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137194">cli</a></span><span class="op" id="8137230">.</span><span class="ident" id="8137231"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8137240">(</span><span class="op" id="8137241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137245"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137135">c</a></span><span class="op" id="8137246">.</span><span class="ident" id="8137247"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8137252">(</span><span class="op" id="8137253">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137257"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137155">done</a></span>&nbsp;<span class="op" id="8137262">&lt;-</span>&nbsp;<span class="builtintype" id="8137265">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137271">}</span><span class="op" id="8137272">(</span><span class="op" id="8137273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137276">server</span>&nbsp;<span class="op" id="8137283">:=</span>&nbsp;<span class="ident" id="8137286"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8137292">(</span><span class="ident" id="8137293"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137138">s</a></span><span class="op" id="8137294">,</span>&nbsp;<span class="ident" id="8137296"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137075">serverConfig</a></span><span class="op" id="8137308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137311"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137121">err</a></span>&nbsp;<span class="op" id="8137315">=</span>&nbsp;<span class="ident" id="8137317"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137276">server</a></span><span class="op" id="8137323">.</span><span class="ident" id="8137324"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="8137333">(</span><span class="op" id="8137334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137337">if</span>&nbsp;<span class="ident" id="8137340"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137121">err</a></span>&nbsp;<span class="op" id="8137344">==</span>&nbsp;<span class="builtintype" id="8137347">nil</span>&nbsp;<span class="op" id="8137351">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137355"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137098">state</a></span>&nbsp;<span class="op" id="8137361">=</span>&nbsp;<span class="ident" id="8137363"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137276">server</a></span><span class="op" id="8137369">.</span><span class="ident" id="8137370"><a href="/gostd/crypto/tls/conn.go.html#4488867">ConnectionState</a></span><span class="op" id="8137385">(</span><span class="op" id="8137386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137392"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137138">s</a></span><span class="op" id="8137393">.</span><span class="ident" id="8137394"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8137399">(</span><span class="op" id="8137400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137403">&lt;-</span><span class="ident" id="8137405"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137155">done</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137411">return</span><br>
<span class="lineno">195</span><span class="op" id="8137418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137421">func</span>&nbsp;<span class="ident" id="8137426">TestVersion</span><span class="op" id="8137437">(</span><span class="ident" id="8137438">t</span>&nbsp;<span class="op" id="8137440">*</span><span class="ident" id="8137441"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8137448">.</span><span class="ident" id="8137449"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8137450">)</span>&nbsp;<span class="op" id="8137452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137455">serverConfig</span>&nbsp;<span class="op" id="8137468">:=</span>&nbsp;<span class="op" id="8137471">&amp;</span><span class="ident" id="8137472"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8137478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137482"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8137494">:</span>&nbsp;<span class="ident" id="8137496"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8137506">.</span><span class="ident" id="8137507"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8137519">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137523"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span><span class="op" id="8137533">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8137537"><a href="/gostd/crypto/tls/common.go.html#4442486">VersionTLS11</a></span><span class="op" id="8137549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137555">clientConfig</span>&nbsp;<span class="op" id="8137568">:=</span>&nbsp;<span class="op" id="8137571">&amp;</span><span class="ident" id="8137572"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8137578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137582"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span><span class="op" id="8137600">:</span>&nbsp;<span class="builtintype" id="8137602">true</span><span class="op" id="8137606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137609">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137612">state</span><span class="op" id="8137617">,</span>&nbsp;<span class="ident" id="8137619">err</span>&nbsp;<span class="op" id="8137623">:=</span>&nbsp;<span class="ident" id="8137626"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137047">testHandshake</a></span><span class="op" id="8137639">(</span><span class="ident" id="8137640"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137555">clientConfig</a></span><span class="op" id="8137652">,</span>&nbsp;<span class="ident" id="8137654"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137455">serverConfig</a></span><span class="op" id="8137666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137669">if</span>&nbsp;<span class="ident" id="8137672"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137619">err</a></span>&nbsp;<span class="op" id="8137676">!=</span>&nbsp;<span class="builtintype" id="8137679">nil</span>&nbsp;<span class="op" id="8137683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137687"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137438">t</a></span><span class="op" id="8137688">.</span><span class="ident" id="8137689"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8137695">(</span><span class="string" id="8137696">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8137718">,</span>&nbsp;<span class="ident" id="8137720"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137619">err</a></span><span class="op" id="8137723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8137729">if</span>&nbsp;<span class="ident" id="8137732"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137612">state</a></span><span class="op" id="8137737">.</span><span class="ident" id="8137738"><a href="/gostd/crypto/tls/common.go.html#4446520">Version</a></span>&nbsp;<span class="op" id="8137746">!=</span>&nbsp;<span class="ident" id="8137749"><a href="/gostd/crypto/tls/common.go.html#4442486">VersionTLS11</a></span>&nbsp;<span class="op" id="8137762">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137766"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137438">t</a></span><span class="op" id="8137767">.</span><span class="ident" id="8137768"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8137774">(</span><span class="string" id="8137775">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="8137811">,</span>&nbsp;<span class="ident" id="8137813"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137612">state</a></span><span class="op" id="8137818">.</span><span class="ident" id="8137819"><a href="/gostd/crypto/tls/common.go.html#4446520">Version</a></span><span class="op" id="8137826">,</span>&nbsp;<span class="ident" id="8137828"><a href="/gostd/crypto/tls/common.go.html#4442486">VersionTLS11</a></span><span class="op" id="8137840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8137843">}</span><br>
<span class="lineno"></span><span class="op" id="8137845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8137848">func</span>&nbsp;<span class="ident" id="8137853">TestCipherSuitePreference</span><span class="op" id="8137878">(</span><span class="ident" id="8137879">t</span>&nbsp;<span class="op" id="8137881">*</span><span class="ident" id="8137882"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8137889">.</span><span class="ident" id="8137890"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8137891">)</span>&nbsp;<span class="op" id="8137893">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137896">serverConfig</span>&nbsp;<span class="op" id="8137909">:=</span>&nbsp;<span class="op" id="8137912">&amp;</span><span class="ident" id="8137913"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8137919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8137923"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span><span class="op" id="8137935">:</span>&nbsp;<span class="op" id="8137937">[</span><span class="op" id="8137938">]</span><span class="builtintype" id="8137939">uint16</span><span class="op" id="8137945">{</span><span class="ident" id="8137946"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8137970">,</span>&nbsp;<span class="ident" id="8137972"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441285">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="8138000">,</span>&nbsp;<span class="ident" id="8138002"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441570">TLS_ECDHE_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8138032">}</span><span class="op" id="8138033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138037"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8138049">:</span>&nbsp;<span class="ident" id="8138051"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><span class="op" id="8138061">.</span><span class="ident" id="8138062"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8138074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138078"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span><span class="op" id="8138088">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8138092"><a href="/gostd/crypto/tls/common.go.html#4442486">VersionTLS11</a></span><span class="op" id="8138104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138107">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138110">clientConfig</span>&nbsp;<span class="op" id="8138123">:=</span>&nbsp;<span class="op" id="8138126">&amp;</span><span class="ident" id="8138127"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="8138133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138137"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span><span class="op" id="8138149">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138157">[</span><span class="op" id="8138158">]</span><span class="builtintype" id="8138159">uint16</span><span class="op" id="8138165">{</span><span class="ident" id="8138166"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441285">TLS_RSA_WITH_AES_128_CBC_SHA</a></span><span class="op" id="8138194">,</span>&nbsp;<span class="ident" id="8138196"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span><span class="op" id="8138220">}</span><span class="op" id="8138221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138225"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span><span class="op" id="8138243">:</span>&nbsp;<span class="builtintype" id="8138245">true</span><span class="op" id="8138249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138255">state</span><span class="op" id="8138260">,</span>&nbsp;<span class="ident" id="8138262">err</span>&nbsp;<span class="op" id="8138266">:=</span>&nbsp;<span class="ident" id="8138269"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137047">testHandshake</a></span><span class="op" id="8138282">(</span><span class="ident" id="8138283"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138110">clientConfig</a></span><span class="op" id="8138295">,</span>&nbsp;<span class="ident" id="8138297"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137896">serverConfig</a></span><span class="op" id="8138309">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8138312">if</span>&nbsp;<span class="ident" id="8138315"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138262">err</a></span>&nbsp;<span class="op" id="8138319">!=</span>&nbsp;<span class="builtintype" id="8138322">nil</span>&nbsp;<span class="op" id="8138326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138330"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137879">t</a></span><span class="op" id="8138331">.</span><span class="ident" id="8138332"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8138338">(</span><span class="string" id="8138339">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8138361">,</span>&nbsp;<span class="ident" id="8138363"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138262">err</a></span><span class="op" id="8138366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8138372">if</span>&nbsp;<span class="ident" id="8138375"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138255">state</a></span><span class="op" id="8138380">.</span><span class="ident" id="8138381"><a href="/gostd/crypto/tls/common.go.html#4446805">CipherSuite</a></span>&nbsp;<span class="op" id="8138393">!=</span>&nbsp;<span class="ident" id="8138396"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441285">TLS_RSA_WITH_AES_128_CBC_SHA</a></span>&nbsp;<span class="op" id="8138425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8138429">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138492"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137879">t</a></span><span class="op" id="8138493">.</span><span class="ident" id="8138494"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8138500">(</span><span class="string" id="8138501">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8138543">,</span>&nbsp;<span class="ident" id="8138545"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138255">state</a></span><span class="op" id="8138550">.</span><span class="ident" id="8138551"><a href="/gostd/crypto/tls/common.go.html#4446805">CipherSuite</a></span><span class="op" id="8138562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138569"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137896">serverConfig</a></span><span class="op" id="8138581">.</span><span class="ident" id="8138582"><a href="/gostd/crypto/tls/common.go.html#4453426">PreferServerCipherSuites</a></span>&nbsp;<span class="op" id="8138607">=</span>&nbsp;<span class="builtintype" id="8138609">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138615"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138255">state</a></span><span class="op" id="8138620">,</span>&nbsp;<span class="ident" id="8138622"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138262">err</a></span>&nbsp;<span class="op" id="8138626">=</span>&nbsp;<span class="ident" id="8138628"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137047">testHandshake</a></span><span class="op" id="8138641">(</span><span class="ident" id="8138642"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138110">clientConfig</a></span><span class="op" id="8138654">,</span>&nbsp;<span class="ident" id="8138656"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137896">serverConfig</a></span><span class="op" id="8138668">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8138671">if</span>&nbsp;<span class="ident" id="8138674"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138262">err</a></span>&nbsp;<span class="op" id="8138678">!=</span>&nbsp;<span class="builtintype" id="8138681">nil</span>&nbsp;<span class="op" id="8138685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138689"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137879">t</a></span><span class="op" id="8138690">.</span><span class="ident" id="8138691"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8138697">(</span><span class="string" id="8138698">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8138720">,</span>&nbsp;<span class="ident" id="8138722"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138262">err</a></span><span class="op" id="8138725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8138731">if</span>&nbsp;<span class="ident" id="8138734"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138255">state</a></span><span class="op" id="8138739">.</span><span class="ident" id="8138740"><a href="/gostd/crypto/tls/common.go.html#4446805">CipherSuite</a></span>&nbsp;<span class="op" id="8138752">!=</span>&nbsp;<span class="ident" id="8138755"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441171">TLS_RSA_WITH_RC4_128_SHA</a></span>&nbsp;<span class="op" id="8138780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8138784"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8137879">t</a></span><span class="op" id="8138785">.</span><span class="ident" id="8138786"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8138792">(</span><span class="string" id="8138793">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8138835">,</span>&nbsp;<span class="ident" id="8138837"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8138255">state</a></span><span class="op" id="8138842">.</span><span class="ident" id="8138843"><a href="/gostd/crypto/tls/common.go.html#4446805">CipherSuite</a></span><span class="op" id="8138854">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8138857">}</span><br>
<span class="lineno"></span><span class="op" id="8138859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8138862">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8138937">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8138953">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8139033">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8139052">type</span>&nbsp;<span class="ident" id="8139057">serverTest</span>&nbsp;<span class="keyword" id="8139068">struct</span>&nbsp;<span class="op" id="8139075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139078">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139151">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139192">name</span>&nbsp;<span class="builtintype" id="8139197">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139205">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139271">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139316">command</span>&nbsp;<span class="op" id="8139324">[</span><span class="op" id="8139325">]</span><span class="builtintype" id="8139326">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139334">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139398">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139432">expectedPeerCerts</span>&nbsp;<span class="op" id="8139450">[</span><span class="op" id="8139451">]</span><span class="builtintype" id="8139452">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139460">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139531">config</span>&nbsp;<span class="op" id="8139538">*</span><span class="ident" id="8139539"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139547">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139621">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139659">expectAlert</span>&nbsp;<span class="builtintype" id="8139671">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139677">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139746">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8139818">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="8139848">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139856">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139925">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8139998">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140035">validate</span>&nbsp;<span class="keyword" id="8140044">func</span><span class="op" id="8140048">(</span><span class="ident" id="8140049"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8140064">)</span>&nbsp;<span class="builtintype" id="8140066">error</span><br>
<span class="lineno">270</span><span class="op" id="8140072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8140075">var</span>&nbsp;<span class="ident" id="8140079">defaultClientCommand</span>&nbsp;<span class="op" id="8140100">=</span>&nbsp;<span class="op" id="8140102">[</span><span class="op" id="8140103">]</span><span class="builtintype" id="8140104">string</span><span class="op" id="8140110">{</span><span class="string" id="8140111">&#34;openssl&#34;</span><span class="op" id="8140120">,</span>&nbsp;<span class="string" id="8140122">&#34;s_client&#34;</span><span class="op" id="8140132">,</span>&nbsp;<span class="string" id="8140134">&#34;-no_ticket&#34;</span><span class="op" id="8140146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8140149">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="8140225">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8140305">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="8140320">func</span>&nbsp;<span class="op" id="8140325">(</span><span class="ident" id="8140326">test</span>&nbsp;<span class="op" id="8140331">*</span><span class="ident" id="8140332"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8140342">)</span>&nbsp;<span class="ident" id="8140344">connFromCommand</span><span class="op" id="8140359">(</span><span class="op" id="8140360">)</span>&nbsp;<span class="op" id="8140362">(</span><span class="ident" id="8140363">conn</span>&nbsp;<span class="op" id="8140368">*</span><span class="ident" id="8140369"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><span class="op" id="8140382">,</span>&nbsp;<span class="ident" id="8140384">child</span>&nbsp;<span class="op" id="8140390">*</span><span class="ident" id="8140391"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132641">exec</a></span><span class="op" id="8140395">.</span><span class="ident" id="8140396"><a href="/gostd/os/exec/exec.go.html#5578012">Cmd</a></span><span class="op" id="8140399">,</span>&nbsp;<span class="ident" id="8140401">err</span>&nbsp;<span class="builtintype" id="8140405">error</span><span class="op" id="8140410">)</span>&nbsp;<span class="op" id="8140412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140415">l</span><span class="op" id="8140416">,</span>&nbsp;<span class="ident" id="8140418"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140401">err</a></span>&nbsp;<span class="op" id="8140422">:=</span>&nbsp;<span class="ident" id="8140425"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8140428">.</span><span class="ident" id="8140429"><a href="/gostd/net/tcpsock_posix.go.html#3383816">ListenTCP</a></span><span class="op" id="8140438">(</span><span class="string" id="8140439">&#34;tcp&#34;</span><span class="op" id="8140444">,</span>&nbsp;<span class="op" id="8140446">&amp;</span><span class="ident" id="8140447"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8140450">.</span><span class="ident" id="8140451"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="8140458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140462"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="8140464">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8140468"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8140471">.</span><span class="ident" id="8140472"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="8140476">(</span><span class="num" id="8140477">127</span><span class="op" id="8140480">,</span>&nbsp;<span class="num" id="8140482">0</span><span class="op" id="8140483">,</span>&nbsp;<span class="num" id="8140485">0</span><span class="op" id="8140486">,</span>&nbsp;<span class="num" id="8140488">1</span><span class="op" id="8140489">)</span><span class="op" id="8140490">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140494"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><span class="op" id="8140498">:</span>&nbsp;<span class="num" id="8140500">0</span><span class="op" id="8140501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8140504">}</span><span class="op" id="8140505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140508">if</span>&nbsp;<span class="ident" id="8140511"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140401">err</a></span>&nbsp;<span class="op" id="8140515">!=</span>&nbsp;<span class="builtintype" id="8140518">nil</span>&nbsp;<span class="op" id="8140522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140526">return</span>&nbsp;<span class="builtintype" id="8140533">nil</span><span class="op" id="8140536">,</span>&nbsp;<span class="builtintype" id="8140538">nil</span><span class="op" id="8140541">,</span>&nbsp;<span class="ident" id="8140543"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140401">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8140548">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140551">defer</span>&nbsp;<span class="ident" id="8140557"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140415">l</a></span><span class="op" id="8140558">.</span><span class="ident" id="8140559"><a href="/gostd/net/tcpsock_posix.go.html#3382598">Close</a></span><span class="op" id="8140564">(</span><span class="op" id="8140565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140569">port</span>&nbsp;<span class="op" id="8140574">:=</span>&nbsp;<span class="ident" id="8140577"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140415">l</a></span><span class="op" id="8140578">.</span><span class="ident" id="8140579"><a href="/gostd/net/tcpsock_posix.go.html#3382777">Addr</a></span><span class="op" id="8140583">(</span><span class="op" id="8140584">)</span><span class="op" id="8140585">.</span><span class="op" id="8140586">(</span><span class="op" id="8140587">*</span><span class="ident" id="8140588"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8140591">.</span><span class="ident" id="8140592"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="8140599">)</span><span class="op" id="8140600">.</span><span class="ident" id="8140601"><a href="/gostd/net/tcpsock.go.html#3373496">Port</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140608">var</span>&nbsp;<span class="ident" id="8140612">command</span>&nbsp;<span class="op" id="8140620">[</span><span class="op" id="8140621">]</span><span class="builtintype" id="8140622">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140630"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span>&nbsp;<span class="op" id="8140638">=</span>&nbsp;<span class="builtinfunc" id="8140640">append</span><span class="op" id="8140646">(</span><span class="ident" id="8140647"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140654">,</span>&nbsp;<span class="ident" id="8140656"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140326">test</a></span><span class="op" id="8140660">.</span><span class="ident" id="8140661"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8140668">...</span><span class="op" id="8140671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140674">if</span>&nbsp;<span class="builtinfunc" id="8140677">len</span><span class="op" id="8140680">(</span><span class="ident" id="8140681"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140688">)</span>&nbsp;<span class="op" id="8140690">==</span>&nbsp;<span class="num" id="8140693">0</span>&nbsp;<span class="op" id="8140695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140699"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span>&nbsp;<span class="op" id="8140707">=</span>&nbsp;<span class="ident" id="8140709"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140079">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8140731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140734"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span>&nbsp;<span class="op" id="8140742">=</span>&nbsp;<span class="builtinfunc" id="8140744">append</span><span class="op" id="8140750">(</span><span class="ident" id="8140751"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140758">,</span>&nbsp;<span class="string" id="8140760">&#34;-connect&#34;</span><span class="op" id="8140770">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140773"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span>&nbsp;<span class="op" id="8140781">=</span>&nbsp;<span class="builtinfunc" id="8140783">append</span><span class="op" id="8140789">(</span><span class="ident" id="8140790"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140797">,</span>&nbsp;<span class="ident" id="8140799"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132603">fmt</a></span><span class="op" id="8140802">.</span><span class="ident" id="8140803"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="8140810">(</span><span class="string" id="8140811">&#34;127.0.0.1:%d&#34;</span><span class="op" id="8140825">,</span>&nbsp;<span class="ident" id="8140827"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140569">port</a></span><span class="op" id="8140831">)</span><span class="op" id="8140832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140835">cmd</span>&nbsp;<span class="op" id="8140839">:=</span>&nbsp;<span class="ident" id="8140842"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132641">exec</a></span><span class="op" id="8140846">.</span><span class="ident" id="8140847"><a href="/gostd/os/exec/exec.go.html#5581161">Command</a></span><span class="op" id="8140854">(</span><span class="ident" id="8140855"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140862">[</span><span class="num" id="8140863">0</span><span class="op" id="8140864">]</span><span class="op" id="8140865">,</span>&nbsp;<span class="ident" id="8140867"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140612">command</a></span><span class="op" id="8140874">[</span><span class="num" id="8140875">1</span><span class="op" id="8140876">:</span><span class="op" id="8140877">]</span><span class="op" id="8140878">...</span><span class="op" id="8140881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140884"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140835">cmd</a></span><span class="op" id="8140887">.</span><span class="ident" id="8140888"><a href="/gostd/os/exec/exec.go.html#5579298">Stdin</a></span>&nbsp;<span class="op" id="8140894">=</span>&nbsp;<span class="builtintype" id="8140896">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140901">var</span>&nbsp;<span class="ident" id="8140905">output</span>&nbsp;<span class="ident" id="8140912"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132503">bytes</a></span><span class="op" id="8140917">.</span><span class="ident" id="8140918"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140926"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140835">cmd</a></span><span class="op" id="8140929">.</span><span class="ident" id="8140930"><a href="/gostd/os/exec/exec.go.html#5579600">Stdout</a></span>&nbsp;<span class="op" id="8140937">=</span>&nbsp;<span class="op" id="8140939">&amp;</span><span class="ident" id="8140940"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140905">output</a></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8140948"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140835">cmd</a></span><span class="op" id="8140951">.</span><span class="ident" id="8140952"><a href="/gostd/os/exec/exec.go.html#5579618">Stderr</a></span>&nbsp;<span class="op" id="8140959">=</span>&nbsp;<span class="op" id="8140961">&amp;</span><span class="ident" id="8140962"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140905">output</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8140970">if</span>&nbsp;<span class="ident" id="8140973">err</span>&nbsp;<span class="op" id="8140977">:=</span>&nbsp;<span class="ident" id="8140980"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140835">cmd</a></span><span class="op" id="8140983">.</span><span class="ident" id="8140984"><a href="/gostd/os/exec/exec.go.html#5584773">Start</a></span><span class="op" id="8140989">(</span><span class="op" id="8140990">)</span><span class="op" id="8140991">;</span>&nbsp;<span class="ident" id="8140993"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140973">err</a></span>&nbsp;<span class="op" id="8140997">!=</span>&nbsp;<span class="builtintype" id="8141000">nil</span>&nbsp;<span class="op" id="8141004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141008">return</span>&nbsp;<span class="builtintype" id="8141015">nil</span><span class="op" id="8141018">,</span>&nbsp;<span class="builtintype" id="8141020">nil</span><span class="op" id="8141023">,</span>&nbsp;<span class="ident" id="8141025"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140973">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141034">connChan</span>&nbsp;<span class="op" id="8141043">:=</span>&nbsp;<span class="builtinfunc" id="8141046">make</span><span class="op" id="8141050">(</span><span class="keyword" id="8141051">chan</span>&nbsp;<span class="keyword" id="8141056">interface</span><span class="op" id="8141065">{</span><span class="op" id="8141066">}</span><span class="op" id="8141067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141070">go</span>&nbsp;<span class="keyword" id="8141073">func</span><span class="op" id="8141077">(</span><span class="op" id="8141078">)</span>&nbsp;<span class="op" id="8141080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141084">tcpConn</span><span class="op" id="8141091">,</span>&nbsp;<span class="ident" id="8141093">err</span>&nbsp;<span class="op" id="8141097">:=</span>&nbsp;<span class="ident" id="8141100"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140415">l</a></span><span class="op" id="8141101">.</span><span class="ident" id="8141102"><a href="/gostd/net/tcpsock_posix.go.html#3382377">Accept</a></span><span class="op" id="8141108">(</span><span class="op" id="8141109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141113">if</span>&nbsp;<span class="ident" id="8141116"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141093">err</a></span>&nbsp;<span class="op" id="8141120">!=</span>&nbsp;<span class="builtintype" id="8141123">nil</span>&nbsp;<span class="op" id="8141127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141132"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141034">connChan</a></span>&nbsp;<span class="op" id="8141141">&lt;-</span>&nbsp;<span class="ident" id="8141144"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141093">err</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141154"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141034">connChan</a></span>&nbsp;<span class="op" id="8141163">&lt;-</span>&nbsp;<span class="ident" id="8141166"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141084">tcpConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141175">}</span><span class="op" id="8141176">(</span><span class="op" id="8141177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141181">var</span>&nbsp;<span class="ident" id="8141185">tcpConn</span>&nbsp;<span class="ident" id="8141193"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8141196">.</span><span class="ident" id="8141197"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141203">select</span>&nbsp;<span class="op" id="8141210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141213">case</span>&nbsp;<span class="ident" id="8141218">connOrError</span>&nbsp;<span class="op" id="8141230">:=</span>&nbsp;<span class="op" id="8141233">&lt;-</span><span class="ident" id="8141235"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141034">connChan</a></span><span class="op" id="8141243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141247">if</span>&nbsp;<span class="ident" id="8141250">err</span><span class="op" id="8141253">,</span>&nbsp;<span class="ident" id="8141255">ok</span>&nbsp;<span class="op" id="8141258">:=</span>&nbsp;<span class="ident" id="8141261"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141218">connOrError</a></span><span class="op" id="8141272">.</span><span class="op" id="8141273">(</span><span class="builtintype" id="8141274">error</span><span class="op" id="8141279">)</span><span class="op" id="8141280">;</span>&nbsp;<span class="ident" id="8141282"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141255">ok</a></span>&nbsp;<span class="op" id="8141285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141290">return</span>&nbsp;<span class="builtintype" id="8141297">nil</span><span class="op" id="8141300">,</span>&nbsp;<span class="builtintype" id="8141302">nil</span><span class="op" id="8141305">,</span>&nbsp;<span class="ident" id="8141307"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141250">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141313">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141317"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141185">tcpConn</a></span>&nbsp;<span class="op" id="8141325">=</span>&nbsp;<span class="ident" id="8141327"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141218">connOrError</a></span><span class="op" id="8141338">.</span><span class="op" id="8141339">(</span><span class="ident" id="8141340"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8141343">.</span><span class="ident" id="8141344"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="8141348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141351">case</span>&nbsp;<span class="op" id="8141356">&lt;-</span><span class="ident" id="8141358"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132691">time</a></span><span class="op" id="8141362">.</span><span class="ident" id="8141363"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="8141368">(</span><span class="num" id="8141369">2</span>&nbsp;<span class="op" id="8141371">*</span>&nbsp;<span class="ident" id="8141373"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132691">time</a></span><span class="op" id="8141377">.</span><span class="ident" id="8141378"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="8141384">)</span><span class="op" id="8141385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141389"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140905">output</a></span><span class="op" id="8141395">.</span><span class="ident" id="8141396"><a href="/gostd/bytes/buffer.go.html#1389373">WriteTo</a></span><span class="op" id="8141403">(</span><span class="ident" id="8141404"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8141406">.</span><span class="ident" id="8141407"><a href="/gostd/os/file.go.html#2441814">Stdout</a></span><span class="op" id="8141413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141417">return</span>&nbsp;<span class="builtintype" id="8141424">nil</span><span class="op" id="8141427">,</span>&nbsp;<span class="builtintype" id="8141429">nil</span><span class="op" id="8141432">,</span>&nbsp;<span class="ident" id="8141434"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132593">errors</a></span><span class="op" id="8141440">.</span><span class="ident" id="8141441"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="8141444">(</span><span class="string" id="8141445">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="8141498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141501">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141505">record</span>&nbsp;<span class="op" id="8141512">:=</span>&nbsp;<span class="op" id="8141515">&amp;</span><span class="ident" id="8141516"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><span class="op" id="8141529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141533"><a href="/gostd/crypto/tls/handshake_test.go.html#8164826">Conn</a></span><span class="op" id="8141537">:</span>&nbsp;<span class="ident" id="8141539"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141185">tcpConn</a></span><span class="op" id="8141546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141553">return</span>&nbsp;<span class="ident" id="8141560"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141505">record</a></span><span class="op" id="8141566">,</span>&nbsp;<span class="ident" id="8141568"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140835">cmd</a></span><span class="op" id="8141571">,</span>&nbsp;<span class="builtintype" id="8141573">nil</span><br>
<span class="lineno"></span><span class="op" id="8141577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141580">func</span>&nbsp;<span class="op" id="8141585">(</span><span class="ident" id="8141586">test</span>&nbsp;<span class="op" id="8141591">*</span><span class="ident" id="8141592"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8141602">)</span>&nbsp;<span class="ident" id="8141604">dataPath</span><span class="op" id="8141612">(</span><span class="op" id="8141613">)</span>&nbsp;<span class="builtintype" id="8141615">string</span>&nbsp;<span class="op" id="8141622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141625">return</span>&nbsp;<span class="ident" id="8141632"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132652">filepath</a></span><span class="op" id="8141640">.</span><span class="ident" id="8141641"><a href="/gostd/path/filepath/path.go.html#3783597">Join</a></span><span class="op" id="8141645">(</span><span class="string" id="8141646">&#34;testdata&#34;</span><span class="op" id="8141656">,</span>&nbsp;<span class="string" id="8141658">&#34;Server-&#34;</span><span class="op" id="8141667">+</span><span class="ident" id="8141668"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141586">test</a></span><span class="op" id="8141672">.</span><span class="ident" id="8141673"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8141677">)</span><br>
<span class="lineno">335</span><span class="op" id="8141679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8141682">func</span>&nbsp;<span class="op" id="8141687">(</span><span class="ident" id="8141688">test</span>&nbsp;<span class="op" id="8141693">*</span><span class="ident" id="8141694"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8141704">)</span>&nbsp;<span class="ident" id="8141706">loadData</span><span class="op" id="8141714">(</span><span class="op" id="8141715">)</span>&nbsp;<span class="op" id="8141717">(</span><span class="ident" id="8141718">flows</span>&nbsp;<span class="op" id="8141724">[</span><span class="op" id="8141725">]</span><span class="op" id="8141726">[</span><span class="op" id="8141727">]</span><span class="builtintype" id="8141728">byte</span><span class="op" id="8141732">,</span>&nbsp;<span class="ident" id="8141734">err</span>&nbsp;<span class="builtintype" id="8141738">error</span><span class="op" id="8141743">)</span>&nbsp;<span class="op" id="8141745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8141748">in</span><span class="op" id="8141750">,</span>&nbsp;<span class="ident" id="8141752"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141734">err</a></span>&nbsp;<span class="op" id="8141756">:=</span>&nbsp;<span class="ident" id="8141759"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8141761">.</span><span class="ident" id="8141762"><a href="/gostd/os/file.go.html#2446863">Open</a></span><span class="op" id="8141766">(</span><span class="ident" id="8141767"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141688">test</a></span><span class="op" id="8141771">.</span><span class="ident" id="8141772"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141604">dataPath</a></span><span class="op" id="8141780">(</span><span class="op" id="8141781">)</span><span class="op" id="8141782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141785">if</span>&nbsp;<span class="ident" id="8141788"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141734">err</a></span>&nbsp;<span class="op" id="8141792">!=</span>&nbsp;<span class="builtintype" id="8141795">nil</span>&nbsp;<span class="op" id="8141799">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141803">return</span>&nbsp;<span class="builtintype" id="8141810">nil</span><span class="op" id="8141813">,</span>&nbsp;<span class="ident" id="8141815"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141734">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8141820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141823">defer</span>&nbsp;<span class="ident" id="8141829"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141748">in</a></span><span class="op" id="8141831">.</span><span class="ident" id="8141832"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="8141837">(</span><span class="op" id="8141838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141841">return</span>&nbsp;<span class="ident" id="8141848"><a href="/gostd/crypto/tls/handshake_test.go.html#8166113">parseTestData</a></span><span class="op" id="8141861">(</span><span class="ident" id="8141862"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141748">in</a></span><span class="op" id="8141864">)</span><br>
<span class="lineno"></span><span class="op" id="8141866">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8141869">func</span>&nbsp;<span class="op" id="8141874">(</span><span class="ident" id="8141875">test</span>&nbsp;<span class="op" id="8141880">*</span><span class="ident" id="8141881"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8141891">)</span>&nbsp;<span class="ident" id="8141893">run</span><span class="op" id="8141896">(</span><span class="ident" id="8141897">t</span>&nbsp;<span class="op" id="8141899">*</span><span class="ident" id="8141900"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8141907">.</span><span class="ident" id="8141908"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8141909">,</span>&nbsp;<span class="ident" id="8141911">write</span>&nbsp;<span class="builtintype" id="8141917">bool</span><span class="op" id="8141921">)</span>&nbsp;<span class="op" id="8141923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141926">var</span>&nbsp;<span class="ident" id="8141930">clientConn</span><span class="op" id="8141940">,</span>&nbsp;<span class="ident" id="8141942">serverConn</span>&nbsp;<span class="ident" id="8141953"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8141956">.</span><span class="ident" id="8141957"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141963">var</span>&nbsp;<span class="ident" id="8141967">recordingConn</span>&nbsp;<span class="op" id="8141981">*</span><span class="ident" id="8141982"><a href="/gostd/crypto/tls/handshake_test.go.html#8164802">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8141997">var</span>&nbsp;<span class="ident" id="8142001">childProcess</span>&nbsp;<span class="op" id="8142014">*</span><span class="ident" id="8142015"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132641">exec</a></span><span class="op" id="8142019">.</span><span class="ident" id="8142020"><a href="/gostd/os/exec/exec.go.html#5578012">Cmd</a></span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142026">if</span>&nbsp;<span class="ident" id="8142029"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141911">write</a></span>&nbsp;<span class="op" id="8142035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142039">var</span>&nbsp;<span class="ident" id="8142043">err</span>&nbsp;<span class="builtintype" id="8142047">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142055"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141967">recordingConn</a></span><span class="op" id="8142068">,</span>&nbsp;<span class="ident" id="8142070"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142001">childProcess</a></span><span class="op" id="8142082">,</span>&nbsp;<span class="ident" id="8142084"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142043">err</a></span>&nbsp;<span class="op" id="8142088">=</span>&nbsp;<span class="ident" id="8142090"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8142094">.</span><span class="ident" id="8142095"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140344">connFromCommand</a></span><span class="op" id="8142110">(</span><span class="op" id="8142111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142115">if</span>&nbsp;<span class="ident" id="8142118"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142043">err</a></span>&nbsp;<span class="op" id="8142122">!=</span>&nbsp;<span class="builtintype" id="8142125">nil</span>&nbsp;<span class="op" id="8142129">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142134"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8142135">.</span><span class="ident" id="8142136"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8142142">(</span><span class="string" id="8142143">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8142175">,</span>&nbsp;<span class="ident" id="8142177"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142043">err</a></span><span class="op" id="8142180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142188"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141942">serverConn</a></span>&nbsp;<span class="op" id="8142199">=</span>&nbsp;<span class="ident" id="8142201"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141967">recordingConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142216">}</span>&nbsp;<span class="keyword" id="8142218">else</span>&nbsp;<span class="op" id="8142223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142227"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141930">clientConn</a></span><span class="op" id="8142237">,</span>&nbsp;<span class="ident" id="8142239"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141942">serverConn</a></span>&nbsp;<span class="op" id="8142250">=</span>&nbsp;<span class="ident" id="8142252"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132628">net</a></span><span class="op" id="8142255">.</span><span class="ident" id="8142256"><a href="/gostd/net/pipe.go.html#3349719">Pipe</a></span><span class="op" id="8142260">(</span><span class="op" id="8142261">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142267">config</span>&nbsp;<span class="op" id="8142274">:=</span>&nbsp;<span class="ident" id="8142277"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8142281">.</span><span class="ident" id="8142282"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142290">if</span>&nbsp;<span class="ident" id="8142293"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142267">config</a></span>&nbsp;<span class="op" id="8142300">==</span>&nbsp;<span class="builtintype" id="8142303">nil</span>&nbsp;<span class="op" id="8142307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142311"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142267">config</a></span>&nbsp;<span class="op" id="8142318">=</span>&nbsp;<span class="ident" id="8142320"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142332">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142335">server</span>&nbsp;<span class="op" id="8142342">:=</span>&nbsp;<span class="ident" id="8142345"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="8142351">(</span><span class="ident" id="8142352"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141942">serverConn</a></span><span class="op" id="8142362">,</span>&nbsp;<span class="ident" id="8142364"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142267">config</a></span><span class="op" id="8142370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142373">connStateChan</span>&nbsp;<span class="op" id="8142387">:=</span>&nbsp;<span class="builtinfunc" id="8142390">make</span><span class="op" id="8142394">(</span><span class="keyword" id="8142395">chan</span>&nbsp;<span class="ident" id="8142400"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8142415">,</span>&nbsp;<span class="num" id="8142417">1</span><span class="op" id="8142418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142421">go</span>&nbsp;<span class="keyword" id="8142424">func</span><span class="op" id="8142428">(</span><span class="op" id="8142429">)</span>&nbsp;<span class="op" id="8142431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142435">var</span>&nbsp;<span class="ident" id="8142439">err</span>&nbsp;<span class="builtintype" id="8142443">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142451">if</span>&nbsp;<span class="ident" id="8142454">_</span><span class="op" id="8142455">,</span>&nbsp;<span class="ident" id="8142457"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142439">err</a></span>&nbsp;<span class="op" id="8142461">=</span>&nbsp;<span class="ident" id="8142463"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142335">server</a></span><span class="op" id="8142469">.</span><span class="ident" id="8142470"><a href="/gostd/crypto/tls/conn.go.html#4484996">Write</a></span><span class="op" id="8142475">(</span><span class="op" id="8142476">[</span><span class="op" id="8142477">]</span><span class="builtintype" id="8142478">byte</span><span class="op" id="8142482">(</span><span class="string" id="8142483">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="8142499">)</span><span class="op" id="8142500">)</span><span class="op" id="8142501">;</span>&nbsp;<span class="ident" id="8142503"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142439">err</a></span>&nbsp;<span class="op" id="8142507">!=</span>&nbsp;<span class="builtintype" id="8142510">nil</span>&nbsp;<span class="op" id="8142514">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142519"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8142520">.</span><span class="ident" id="8142521"><a href="/gostd/testing/testing.go.html#5479816">Logf</a></span><span class="op" id="8142525">(</span><span class="string" id="8142526">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="8142555">,</span>&nbsp;<span class="ident" id="8142557"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142439">err</a></span><span class="op" id="8142560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142568">if</span>&nbsp;<span class="builtinfunc" id="8142571">len</span><span class="op" id="8142574">(</span><span class="ident" id="8142575"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8142579">.</span><span class="ident" id="8142580"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139818">expectHandshakeErrorIncluding</a></span><span class="op" id="8142609">)</span>&nbsp;<span class="op" id="8142611">&gt;</span>&nbsp;<span class="num" id="8142613">0</span>&nbsp;<span class="op" id="8142615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142620">if</span>&nbsp;<span class="ident" id="8142623"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142439">err</a></span>&nbsp;<span class="op" id="8142627">==</span>&nbsp;<span class="builtintype" id="8142630">nil</span>&nbsp;<span class="op" id="8142634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142640"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8142641">.</span><span class="ident" id="8142642"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="8142648">(</span><span class="string" id="8142649">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="8142688">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142693">}</span>&nbsp;<span class="keyword" id="8142695">else</span>&nbsp;<span class="keyword" id="8142700">if</span>&nbsp;<span class="ident" id="8142703">s</span>&nbsp;<span class="op" id="8142705">:=</span>&nbsp;<span class="ident" id="8142708"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142439">err</a></span><span class="op" id="8142711">.</span><span class="ident" id="8142712">Error</span><span class="op" id="8142717">(</span><span class="op" id="8142718">)</span><span class="op" id="8142719">;</span>&nbsp;<span class="op" id="8142721">!</span><span class="ident" id="8142722"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132669">strings</a></span><span class="op" id="8142729">.</span><span class="ident" id="8142730"><a href="/gostd/strings/strings.go.html#2968416">Contains</a></span><span class="op" id="8142738">(</span><span class="ident" id="8142739"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142703">s</a></span><span class="op" id="8142740">,</span>&nbsp;<span class="ident" id="8142742"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8142746">.</span><span class="ident" id="8142747"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139818">expectHandshakeErrorIncluding</a></span><span class="op" id="8142776">)</span>&nbsp;<span class="op" id="8142778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142784"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8142785">.</span><span class="ident" id="8142786"><a href="/gostd/testing/testing.go.html#5480102">Errorf</a></span><span class="op" id="8142792">(</span><span class="string" id="8142793">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8142838">,</span>&nbsp;<span class="ident" id="8142840"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8142844">.</span><span class="ident" id="8142845"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139818">expectHandshakeErrorIncluding</a></span><span class="op" id="8142874">,</span>&nbsp;<span class="ident" id="8142876"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142703">s</a></span><span class="op" id="8142877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142890"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142335">server</a></span><span class="op" id="8142896">.</span><span class="ident" id="8142897"><a href="/gostd/crypto/tls/conn.go.html#4488006">Close</a></span><span class="op" id="8142902">(</span><span class="op" id="8142903">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142907"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141942">serverConn</a></span><span class="op" id="8142917">.</span><span class="ident" id="8142918"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8142923">(</span><span class="op" id="8142924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142928"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142373">connStateChan</a></span>&nbsp;<span class="op" id="8142942">&lt;-</span>&nbsp;<span class="ident" id="8142945"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142335">server</a></span><span class="op" id="8142951">.</span><span class="ident" id="8142952"><a href="/gostd/crypto/tls/conn.go.html#4488867">ConnectionState</a></span><span class="op" id="8142967">(</span><span class="op" id="8142968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8142971">}</span><span class="op" id="8142972">(</span><span class="op" id="8142973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8142977">if</span>&nbsp;<span class="op" id="8142980">!</span><span class="ident" id="8142981"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141911">write</a></span>&nbsp;<span class="op" id="8142987">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8142991">flows</span><span class="op" id="8142996">,</span>&nbsp;<span class="ident" id="8142998">err</span>&nbsp;<span class="op" id="8143002">:=</span>&nbsp;<span class="ident" id="8143005"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143009">.</span><span class="ident" id="8143010"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141706">loadData</a></span><span class="op" id="8143018">(</span><span class="op" id="8143019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143023">if</span>&nbsp;<span class="ident" id="8143026"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142998">err</a></span>&nbsp;<span class="op" id="8143030">!=</span>&nbsp;<span class="builtintype" id="8143033">nil</span>&nbsp;<span class="op" id="8143037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143042">if</span>&nbsp;<span class="op" id="8143045">!</span><span class="ident" id="8143046"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143050">.</span><span class="ident" id="8143051"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139659">expectAlert</a></span>&nbsp;<span class="op" id="8143063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143069"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8143070">.</span><span class="ident" id="8143071"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8143077">(</span><span class="string" id="8143078">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="8143111">,</span>&nbsp;<span class="ident" id="8143113"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143117">.</span><span class="ident" id="8143118"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8143122">,</span>&nbsp;<span class="ident" id="8143124"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143128">.</span><span class="ident" id="8143129"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141604">dataPath</a></span><span class="op" id="8143137">(</span><span class="op" id="8143138">)</span><span class="op" id="8143139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143144">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143152">for</span>&nbsp;<span class="ident" id="8143156">i</span><span class="op" id="8143157">,</span>&nbsp;<span class="ident" id="8143159">b</span>&nbsp;<span class="op" id="8143161">:=</span>&nbsp;<span class="keyword" id="8143164">range</span>&nbsp;<span class="ident" id="8143170"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142991">flows</a></span>&nbsp;<span class="op" id="8143176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143181">if</span>&nbsp;<span class="ident" id="8143184"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143156">i</a></span><span class="op" id="8143185">%</span><span class="num" id="8143186">2</span>&nbsp;<span class="op" id="8143188">==</span>&nbsp;<span class="num" id="8143191">0</span>&nbsp;<span class="op" id="8143193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143199"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141930">clientConn</a></span><span class="op" id="8143209">.</span><span class="ident" id="8143210"><a href="/gostd/net/net.go.html#3334839">Write</a></span><span class="op" id="8143215">(</span><span class="ident" id="8143216"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143159">b</a></span><span class="op" id="8143217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143223">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143240">bb</span>&nbsp;<span class="op" id="8143243">:=</span>&nbsp;<span class="builtinfunc" id="8143246">make</span><span class="op" id="8143250">(</span><span class="op" id="8143251">[</span><span class="op" id="8143252">]</span><span class="builtintype" id="8143253">byte</span><span class="op" id="8143257">,</span>&nbsp;<span class="builtinfunc" id="8143259">len</span><span class="op" id="8143262">(</span><span class="ident" id="8143263"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143159">b</a></span><span class="op" id="8143264">)</span><span class="op" id="8143265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143270">n</span><span class="op" id="8143271">,</span>&nbsp;<span class="ident" id="8143273">err</span>&nbsp;<span class="op" id="8143277">:=</span>&nbsp;<span class="ident" id="8143280"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132610">io</a></span><span class="op" id="8143282">.</span><span class="ident" id="8143283"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="8143291">(</span><span class="ident" id="8143292"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141930">clientConn</a></span><span class="op" id="8143302">,</span>&nbsp;<span class="ident" id="8143304"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143240">bb</a></span><span class="op" id="8143306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143311">if</span>&nbsp;<span class="ident" id="8143314"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143318">.</span><span class="ident" id="8143319"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139659">expectAlert</a></span>&nbsp;<span class="op" id="8143331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143337">if</span>&nbsp;<span class="ident" id="8143340"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143273">err</a></span>&nbsp;<span class="op" id="8143344">==</span>&nbsp;<span class="builtintype" id="8143347">nil</span>&nbsp;<span class="op" id="8143351">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143358"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8143359">.</span><span class="ident" id="8143360"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="8143365">(</span><span class="string" id="8143366">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="8143408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143419">}</span>&nbsp;<span class="keyword" id="8143421">else</span>&nbsp;<span class="op" id="8143426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143432">if</span>&nbsp;<span class="ident" id="8143435"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143273">err</a></span>&nbsp;<span class="op" id="8143439">!=</span>&nbsp;<span class="builtintype" id="8143442">nil</span>&nbsp;<span class="op" id="8143446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143453"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8143454">.</span><span class="ident" id="8143455"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8143461">(</span><span class="string" id="8143462">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="8143515">,</span>&nbsp;<span class="ident" id="8143517"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143521">.</span><span class="ident" id="8143522"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8143526">,</span>&nbsp;<span class="ident" id="8143528"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143156">i</a></span><span class="op" id="8143529">+</span><span class="num" id="8143530">1</span><span class="op" id="8143531">,</span>&nbsp;<span class="ident" id="8143533"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143273">err</a></span><span class="op" id="8143536">,</span>&nbsp;<span class="ident" id="8143538"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143270">n</a></span><span class="op" id="8143539">,</span>&nbsp;<span class="builtinfunc" id="8143541">len</span><span class="op" id="8143544">(</span><span class="ident" id="8143545"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143240">bb</a></span><span class="op" id="8143547">)</span><span class="op" id="8143548">,</span>&nbsp;<span class="ident" id="8143550"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143240">bb</a></span><span class="op" id="8143552">[</span><span class="op" id="8143553">:</span><span class="ident" id="8143554"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143270">n</a></span><span class="op" id="8143555">]</span><span class="op" id="8143556">,</span>&nbsp;<span class="ident" id="8143558"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143159">b</a></span><span class="op" id="8143559">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143571">if</span>&nbsp;<span class="op" id="8143574">!</span><span class="ident" id="8143575"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132503">bytes</a></span><span class="op" id="8143580">.</span><span class="ident" id="8143581"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="8143586">(</span><span class="ident" id="8143587"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143159">b</a></span><span class="op" id="8143588">,</span>&nbsp;<span class="ident" id="8143590"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143240">bb</a></span><span class="op" id="8143592">)</span>&nbsp;<span class="op" id="8143594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143601"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8143602">.</span><span class="ident" id="8143603"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8143609">(</span><span class="string" id="8143610">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8143652">,</span>&nbsp;<span class="ident" id="8143654"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143658">.</span><span class="ident" id="8143659"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8143663">,</span>&nbsp;<span class="ident" id="8143665"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143156">i</a></span><span class="op" id="8143666">+</span><span class="num" id="8143667">1</span><span class="op" id="8143668">,</span>&nbsp;<span class="ident" id="8143670"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143240">bb</a></span><span class="op" id="8143672">,</span>&nbsp;<span class="ident" id="8143674"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143159">b</a></span><span class="op" id="8143675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143686">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143694"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141930">clientConn</a></span><span class="op" id="8143704">.</span><span class="ident" id="8143705"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8143710">(</span><span class="op" id="8143711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8143714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143718">connState</span>&nbsp;<span class="op" id="8143728">:=</span>&nbsp;<span class="op" id="8143731">&lt;-</span><span class="ident" id="8143733"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142373">connStateChan</a></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143748">peerCerts</span>&nbsp;<span class="op" id="8143758">:=</span>&nbsp;<span class="ident" id="8143761"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143718">connState</a></span><span class="op" id="8143770">.</span><span class="ident" id="8143771"><a href="/gostd/crypto/tls/common.go.html#4447223">PeerCertificates</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143789">if</span>&nbsp;<span class="builtinfunc" id="8143792">len</span><span class="op" id="8143795">(</span><span class="ident" id="8143796"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143748">peerCerts</a></span><span class="op" id="8143805">)</span>&nbsp;<span class="op" id="8143807">==</span>&nbsp;<span class="builtinfunc" id="8143810">len</span><span class="op" id="8143813">(</span><span class="ident" id="8143814"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143818">.</span><span class="ident" id="8143819"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139432">expectedPeerCerts</a></span><span class="op" id="8143836">)</span>&nbsp;<span class="op" id="8143838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143842">for</span>&nbsp;<span class="ident" id="8143846">i</span><span class="op" id="8143847">,</span>&nbsp;<span class="ident" id="8143849">peerCert</span>&nbsp;<span class="op" id="8143858">:=</span>&nbsp;<span class="keyword" id="8143861">range</span>&nbsp;<span class="ident" id="8143867"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143748">peerCerts</a></span>&nbsp;<span class="op" id="8143877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143882">block</span><span class="op" id="8143887">,</span>&nbsp;<span class="ident" id="8143889">_</span>&nbsp;<span class="op" id="8143891">:=</span>&nbsp;<span class="ident" id="8143894"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132577">pem</a></span><span class="op" id="8143897">.</span><span class="ident" id="8143898"><a href="/gostd/encoding/pem/pem.go.html#4705239">Decode</a></span><span class="op" id="8143904">(</span><span class="op" id="8143905">[</span><span class="op" id="8143906">]</span><span class="builtintype" id="8143907">byte</span><span class="op" id="8143911">(</span><span class="ident" id="8143912"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8143916">.</span><span class="ident" id="8143917"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139432">expectedPeerCerts</a></span><span class="op" id="8143934">[</span><span class="ident" id="8143935"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143846">i</a></span><span class="op" id="8143936">]</span><span class="op" id="8143937">)</span><span class="op" id="8143938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8143943">if</span>&nbsp;<span class="op" id="8143946">!</span><span class="ident" id="8143947"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132503">bytes</a></span><span class="op" id="8143952">.</span><span class="ident" id="8143953"><a href="/gostd/bytes/bytes_decl.go.html#1414806">Equal</a></span><span class="op" id="8143958">(</span><span class="ident" id="8143959"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143882">block</a></span><span class="op" id="8143964">.</span><span class="ident" id="8143965"><a href="/gostd/encoding/pem/pem.go.html#4703859">Bytes</a></span><span class="op" id="8143970">,</span>&nbsp;<span class="ident" id="8143972"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143849">peerCert</a></span><span class="op" id="8143980">.</span><span class="ident" id="8143981"><a href="/gostd/crypto/x509/x509.go.html#4659788">Raw</a></span><span class="op" id="8143984">)</span>&nbsp;<span class="op" id="8143986">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8143992"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8143993">.</span><span class="ident" id="8143994"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8144000">(</span><span class="string" id="8144001">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="8144031">,</span>&nbsp;<span class="ident" id="8144033"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144037">.</span><span class="ident" id="8144038"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8144042">,</span>&nbsp;<span class="ident" id="8144044"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143846">i</a></span><span class="op" id="8144045">+</span><span class="num" id="8144046">1</span><span class="op" id="8144047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144059">}</span>&nbsp;<span class="keyword" id="8144061">else</span>&nbsp;<span class="op" id="8144066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144070"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8144071">.</span><span class="ident" id="8144072"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8144078">(</span><span class="string" id="8144079">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="8144138">,</span>&nbsp;<span class="ident" id="8144140"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144144">.</span><span class="ident" id="8144145"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8144149">,</span>&nbsp;<span class="builtinfunc" id="8144151">len</span><span class="op" id="8144154">(</span><span class="ident" id="8144155"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144159">.</span><span class="ident" id="8144160"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139432">expectedPeerCerts</a></span><span class="op" id="8144177">)</span><span class="op" id="8144178">,</span>&nbsp;<span class="builtinfunc" id="8144180">len</span><span class="op" id="8144183">(</span><span class="ident" id="8144184"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143748">peerCerts</a></span><span class="op" id="8144193">)</span><span class="op" id="8144194">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144201">if</span>&nbsp;<span class="ident" id="8144204"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144208">.</span><span class="ident" id="8144209"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140035">validate</a></span>&nbsp;<span class="op" id="8144218">!=</span>&nbsp;<span class="builtintype" id="8144221">nil</span>&nbsp;<span class="op" id="8144225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144229">if</span>&nbsp;<span class="ident" id="8144232">err</span>&nbsp;<span class="op" id="8144236">:=</span>&nbsp;<span class="ident" id="8144239"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144243">.</span><span class="ident" id="8144244"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140035">validate</a></span><span class="op" id="8144252">(</span><span class="ident" id="8144253"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8143718">connState</a></span><span class="op" id="8144262">)</span><span class="op" id="8144263">;</span>&nbsp;<span class="ident" id="8144265"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144232">err</a></span>&nbsp;<span class="op" id="8144269">!=</span>&nbsp;<span class="builtintype" id="8144272">nil</span>&nbsp;<span class="op" id="8144276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144281"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8144282">.</span><span class="ident" id="8144283"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8144289">(</span><span class="string" id="8144290">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8144328">,</span>&nbsp;<span class="ident" id="8144330"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144232">err</a></span><span class="op" id="8144333">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144344">if</span>&nbsp;<span class="ident" id="8144347"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141911">write</a></span>&nbsp;<span class="op" id="8144353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144357">path</span>&nbsp;<span class="op" id="8144362">:=</span>&nbsp;<span class="ident" id="8144365"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144369">.</span><span class="ident" id="8144370"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141604">dataPath</a></span><span class="op" id="8144378">(</span><span class="op" id="8144379">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144383">out</span><span class="op" id="8144386">,</span>&nbsp;<span class="ident" id="8144388">err</span>&nbsp;<span class="op" id="8144392">:=</span>&nbsp;<span class="ident" id="8144395"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8144397">.</span><span class="ident" id="8144398"><a href="/gostd/os/file_unix.go.html#2454095">OpenFile</a></span><span class="op" id="8144406">(</span><span class="ident" id="8144407"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144357">path</a></span><span class="op" id="8144411">,</span>&nbsp;<span class="ident" id="8144413"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8144415">.</span><span class="ident" id="8144416"><a href="/gostd/os/file.go.html#2442115">O_WRONLY</a></span><span class="op" id="8144424">|</span><span class="ident" id="8144425"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8144427">.</span><span class="ident" id="8144428"><a href="/gostd/os/file.go.html#2442313">O_CREATE</a></span><span class="op" id="8144436">|</span><span class="ident" id="8144437"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8144439">.</span><span class="ident" id="8144440"><a href="/gostd/os/file.go.html#2442521">O_TRUNC</a></span><span class="op" id="8144447">,</span>&nbsp;<span class="num" id="8144449">0644</span><span class="op" id="8144453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144457">if</span>&nbsp;<span class="ident" id="8144460"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144388">err</a></span>&nbsp;<span class="op" id="8144464">!=</span>&nbsp;<span class="builtintype" id="8144467">nil</span>&nbsp;<span class="op" id="8144471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144476"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8144477">.</span><span class="ident" id="8144478"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8144484">(</span><span class="string" id="8144485">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8144519">,</span>&nbsp;<span class="ident" id="8144521"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144388">err</a></span><span class="op" id="8144524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144532">defer</span>&nbsp;<span class="ident" id="8144538"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144383">out</a></span><span class="op" id="8144541">.</span><span class="ident" id="8144542"><a href="/gostd/os/file_unix.go.html#2454611">Close</a></span><span class="op" id="8144547">(</span><span class="op" id="8144548">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144552"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141967">recordingConn</a></span><span class="op" id="8144565">.</span><span class="ident" id="8144566"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="8144571">(</span><span class="op" id="8144572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144576">if</span>&nbsp;<span class="builtinfunc" id="8144579">len</span><span class="op" id="8144582">(</span><span class="ident" id="8144583"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141967">recordingConn</a></span><span class="op" id="8144596">.</span><span class="ident" id="8144597"><a href="/gostd/crypto/tls/handshake_test.go.html#8164848">flows</a></span><span class="op" id="8144602">)</span>&nbsp;<span class="op" id="8144604">&lt;</span>&nbsp;<span class="num" id="8144606">3</span>&nbsp;<span class="op" id="8144608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144613"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142001">childProcess</a></span><span class="op" id="8144625">.</span><span class="ident" id="8144626"><a href="/gostd/os/exec/exec.go.html#5579600">Stdout</a></span><span class="op" id="8144632">.</span><span class="op" id="8144633">(</span><span class="op" id="8144634">*</span><span class="ident" id="8144635"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132503">bytes</a></span><span class="op" id="8144640">.</span><span class="ident" id="8144641"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><span class="op" id="8144647">)</span><span class="op" id="8144648">.</span><span class="ident" id="8144649"><a href="/gostd/bytes/buffer.go.html#1389373">WriteTo</a></span><span class="op" id="8144656">(</span><span class="ident" id="8144657"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8144659">.</span><span class="ident" id="8144660"><a href="/gostd/os/file.go.html#2441814">Stdout</a></span><span class="op" id="8144666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144671">if</span>&nbsp;<span class="builtinfunc" id="8144674">len</span><span class="op" id="8144677">(</span><span class="ident" id="8144678"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141875">test</a></span><span class="op" id="8144682">.</span><span class="ident" id="8144683"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139818">expectHandshakeErrorIncluding</a></span><span class="op" id="8144712">)</span>&nbsp;<span class="op" id="8144714">==</span>&nbsp;<span class="num" id="8144717">0</span>&nbsp;<span class="op" id="8144719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144725"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141897">t</a></span><span class="op" id="8144726">.</span><span class="ident" id="8144727"><a href="/gostd/testing/testing.go.html#5480410">Fatalf</a></span><span class="op" id="8144733">(</span><span class="string" id="8144734">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="8144752">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144765"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141967">recordingConn</a></span><span class="op" id="8144778">.</span><span class="ident" id="8144779"><a href="/gostd/crypto/tls/handshake_test.go.html#8165712">WriteTo</a></span><span class="op" id="8144786">(</span><span class="ident" id="8144787"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144383">out</a></span><span class="op" id="8144790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144794"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132603">fmt</a></span><span class="op" id="8144797">.</span><span class="ident" id="8144798"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="8144804">(</span><span class="string" id="8144805">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8144817">,</span>&nbsp;<span class="ident" id="8144819"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144357">path</a></span><span class="op" id="8144823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144827"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8142001">childProcess</a></span><span class="op" id="8144839">.</span><span class="ident" id="8144840"><a href="/gostd/os/exec/exec.go.html#5586661">Wait</a></span><span class="op" id="8144844">(</span><span class="op" id="8144845">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8144848">}</span><br>
<span class="lineno"></span><span class="op" id="8144850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8144853">func</span>&nbsp;<span class="ident" id="8144858">runServerTestForVersion</span><span class="op" id="8144881">(</span><span class="ident" id="8144882">t</span>&nbsp;<span class="op" id="8144884">*</span><span class="ident" id="8144885"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8144892">.</span><span class="ident" id="8144893"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8144894">,</span>&nbsp;<span class="ident" id="8144896">template</span>&nbsp;<span class="op" id="8144905">*</span><span class="ident" id="8144906"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8144916">,</span>&nbsp;<span class="ident" id="8144918">prefix</span><span class="op" id="8144924">,</span>&nbsp;<span class="ident" id="8144926">option</span>&nbsp;<span class="builtintype" id="8144933">string</span><span class="op" id="8144939">)</span>&nbsp;<span class="op" id="8144941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144944">test</span>&nbsp;<span class="op" id="8144949">:=</span>&nbsp;<span class="op" id="8144952">*</span><span class="ident" id="8144953"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144896">template</a></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8144963"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8144967">.</span><span class="ident" id="8144968"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span>&nbsp;<span class="op" id="8144973">=</span>&nbsp;<span class="ident" id="8144975"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144918">prefix</a></span>&nbsp;<span class="op" id="8144982">+</span>&nbsp;<span class="ident" id="8144984"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8144988">.</span><span class="ident" id="8144989"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8144995">if</span>&nbsp;<span class="builtinfunc" id="8144998">len</span><span class="op" id="8145001">(</span><span class="ident" id="8145002"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145006">.</span><span class="ident" id="8145007"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8145014">)</span>&nbsp;<span class="op" id="8145016">==</span>&nbsp;<span class="num" id="8145019">0</span>&nbsp;<span class="op" id="8145021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145025"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145029">.</span><span class="ident" id="8145030"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span>&nbsp;<span class="op" id="8145038">=</span>&nbsp;<span class="ident" id="8145040"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140079">defaultClientCommand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145065"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145069">.</span><span class="ident" id="8145070"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span>&nbsp;<span class="op" id="8145078">=</span>&nbsp;<span class="builtinfunc" id="8145080">append</span><span class="op" id="8145086">(</span><span class="op" id="8145087">[</span><span class="op" id="8145088">]</span><span class="builtintype" id="8145089">string</span><span class="op" id="8145095">(</span><span class="builtintype" id="8145096">nil</span><span class="op" id="8145099">)</span><span class="op" id="8145100">,</span>&nbsp;<span class="ident" id="8145102"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145106">.</span><span class="ident" id="8145107"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8145114">...</span><span class="op" id="8145117">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145120"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145124">.</span><span class="ident" id="8145125"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span>&nbsp;<span class="op" id="8145133">=</span>&nbsp;<span class="builtinfunc" id="8145135">append</span><span class="op" id="8145141">(</span><span class="ident" id="8145142"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145146">.</span><span class="ident" id="8145147"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8145154">,</span>&nbsp;<span class="ident" id="8145156"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144926">option</a></span><span class="op" id="8145162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145165"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144944">test</a></span><span class="op" id="8145169">.</span><span class="ident" id="8145170"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8141893">run</a></span><span class="op" id="8145173">(</span><span class="ident" id="8145174"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144882">t</a></span><span class="op" id="8145175">,</span>&nbsp;<span class="op" id="8145177">*</span><span class="ident" id="8145178"><a href="/gostd/crypto/tls/handshake_test.go.html#8164557">update</a></span><span class="op" id="8145184">)</span><br>
<span class="lineno"></span><span class="op" id="8145186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145189">func</span>&nbsp;<span class="ident" id="8145194">runServerTestSSLv3</span><span class="op" id="8145212">(</span><span class="ident" id="8145213">t</span>&nbsp;<span class="op" id="8145215">*</span><span class="ident" id="8145216"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8145223">.</span><span class="ident" id="8145224"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8145225">,</span>&nbsp;<span class="ident" id="8145227">template</span>&nbsp;<span class="op" id="8145236">*</span><span class="ident" id="8145237"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8145247">)</span>&nbsp;<span class="op" id="8145249">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145252"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144858">runServerTestForVersion</a></span><span class="op" id="8145275">(</span><span class="ident" id="8145276"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145213">t</a></span><span class="op" id="8145277">,</span>&nbsp;<span class="ident" id="8145279"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145227">template</a></span><span class="op" id="8145287">,</span>&nbsp;<span class="string" id="8145289">&#34;SSLv3-&#34;</span><span class="op" id="8145297">,</span>&nbsp;<span class="string" id="8145299">&#34;-ssl3&#34;</span><span class="op" id="8145306">)</span><br>
<span class="lineno"></span><span class="op" id="8145308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145311">func</span>&nbsp;<span class="ident" id="8145316">runServerTestTLS10</span><span class="op" id="8145334">(</span><span class="ident" id="8145335">t</span>&nbsp;<span class="op" id="8145337">*</span><span class="ident" id="8145338"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8145345">.</span><span class="ident" id="8145346"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8145347">,</span>&nbsp;<span class="ident" id="8145349">template</span>&nbsp;<span class="op" id="8145358">*</span><span class="ident" id="8145359"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8145369">)</span>&nbsp;<span class="op" id="8145371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145374"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144858">runServerTestForVersion</a></span><span class="op" id="8145397">(</span><span class="ident" id="8145398"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145335">t</a></span><span class="op" id="8145399">,</span>&nbsp;<span class="ident" id="8145401"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145349">template</a></span><span class="op" id="8145409">,</span>&nbsp;<span class="string" id="8145411">&#34;TLSv10-&#34;</span><span class="op" id="8145420">,</span>&nbsp;<span class="string" id="8145422">&#34;-tls1&#34;</span><span class="op" id="8145429">)</span><br>
<span class="lineno">470</span><span class="op" id="8145431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8145434">func</span>&nbsp;<span class="ident" id="8145439">runServerTestTLS11</span><span class="op" id="8145457">(</span><span class="ident" id="8145458">t</span>&nbsp;<span class="op" id="8145460">*</span><span class="ident" id="8145461"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8145468">.</span><span class="ident" id="8145469"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8145470">,</span>&nbsp;<span class="ident" id="8145472">template</span>&nbsp;<span class="op" id="8145481">*</span><span class="ident" id="8145482"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8145492">)</span>&nbsp;<span class="op" id="8145494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145497"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144858">runServerTestForVersion</a></span><span class="op" id="8145520">(</span><span class="ident" id="8145521"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145458">t</a></span><span class="op" id="8145522">,</span>&nbsp;<span class="ident" id="8145524"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145472">template</a></span><span class="op" id="8145532">,</span>&nbsp;<span class="string" id="8145534">&#34;TLSv11-&#34;</span><span class="op" id="8145543">,</span>&nbsp;<span class="string" id="8145545">&#34;-tls1_1&#34;</span><span class="op" id="8145554">)</span><br>
<span class="lineno"></span><span class="op" id="8145556">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8145559">func</span>&nbsp;<span class="ident" id="8145564">runServerTestTLS12</span><span class="op" id="8145582">(</span><span class="ident" id="8145583">t</span>&nbsp;<span class="op" id="8145585">*</span><span class="ident" id="8145586"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8145593">.</span><span class="ident" id="8145594"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8145595">,</span>&nbsp;<span class="ident" id="8145597">template</span>&nbsp;<span class="op" id="8145606">*</span><span class="ident" id="8145607"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8145617">)</span>&nbsp;<span class="op" id="8145619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145622"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8144858">runServerTestForVersion</a></span><span class="op" id="8145645">(</span><span class="ident" id="8145646"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145583">t</a></span><span class="op" id="8145647">,</span>&nbsp;<span class="ident" id="8145649"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145597">template</a></span><span class="op" id="8145657">,</span>&nbsp;<span class="string" id="8145659">&#34;TLSv12-&#34;</span><span class="op" id="8145668">,</span>&nbsp;<span class="string" id="8145670">&#34;-tls1_2&#34;</span><span class="op" id="8145679">)</span><br>
<span class="lineno"></span><span class="op" id="8145681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8145684">func</span>&nbsp;<span class="ident" id="8145689">TestHandshakeServerRSARC4</span><span class="op" id="8145714">(</span><span class="ident" id="8145715">t</span>&nbsp;<span class="op" id="8145717">*</span><span class="ident" id="8145718"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8145725">.</span><span class="ident" id="8145726"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8145727">)</span>&nbsp;<span class="op" id="8145729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145732">test</span>&nbsp;<span class="op" id="8145737">:=</span>&nbsp;<span class="op" id="8145740">&amp;</span><span class="ident" id="8145741"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8145751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145755"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8145759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8145764">&#34;RSA-RC4&#34;</span><span class="op" id="8145773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145777"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8145784">:</span>&nbsp;<span class="op" id="8145786">[</span><span class="op" id="8145787">]</span><span class="builtintype" id="8145788">string</span><span class="op" id="8145794">{</span><span class="string" id="8145795">&#34;openssl&#34;</span><span class="op" id="8145804">,</span>&nbsp;<span class="string" id="8145806">&#34;s_client&#34;</span><span class="op" id="8145816">,</span>&nbsp;<span class="string" id="8145818">&#34;-no_ticket&#34;</span><span class="op" id="8145830">,</span>&nbsp;<span class="string" id="8145832">&#34;-cipher&#34;</span><span class="op" id="8145841">,</span>&nbsp;<span class="string" id="8145843">&#34;RC4-SHA&#34;</span><span class="op" id="8145852">}</span><span class="op" id="8145853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8145856">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145859"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145194">runServerTestSSLv3</a></span><span class="op" id="8145877">(</span><span class="ident" id="8145878"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145715">t</a></span><span class="op" id="8145879">,</span>&nbsp;<span class="ident" id="8145881"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145732">test</a></span><span class="op" id="8145885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145888"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145316">runServerTestTLS10</a></span><span class="op" id="8145906">(</span><span class="ident" id="8145907"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145715">t</a></span><span class="op" id="8145908">,</span>&nbsp;<span class="ident" id="8145910"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145732">test</a></span><span class="op" id="8145914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145917"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145439">runServerTestTLS11</a></span><span class="op" id="8145935">(</span><span class="ident" id="8145936"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145715">t</a></span><span class="op" id="8145937">,</span>&nbsp;<span class="ident" id="8145939"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145732">test</a></span><span class="op" id="8145943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8145946"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8145964">(</span><span class="ident" id="8145965"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145715">t</a></span><span class="op" id="8145966">,</span>&nbsp;<span class="ident" id="8145968"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145732">test</a></span><span class="op" id="8145972">)</span><br>
<span class="lineno"></span><span class="op" id="8145974">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="8145977">func</span>&nbsp;<span class="ident" id="8145982">TestHandshakeServerRSA3DES</span><span class="op" id="8146008">(</span><span class="ident" id="8146009">t</span>&nbsp;<span class="op" id="8146011">*</span><span class="ident" id="8146012"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8146019">.</span><span class="ident" id="8146020"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8146021">)</span>&nbsp;<span class="op" id="8146023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146026">test</span>&nbsp;<span class="op" id="8146031">:=</span>&nbsp;<span class="op" id="8146034">&amp;</span><span class="ident" id="8146035"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8146045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146049"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8146053">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8146058">&#34;RSA-3DES&#34;</span><span class="op" id="8146068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146072"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8146079">:</span>&nbsp;<span class="op" id="8146081">[</span><span class="op" id="8146082">]</span><span class="builtintype" id="8146083">string</span><span class="op" id="8146089">{</span><span class="string" id="8146090">&#34;openssl&#34;</span><span class="op" id="8146099">,</span>&nbsp;<span class="string" id="8146101">&#34;s_client&#34;</span><span class="op" id="8146111">,</span>&nbsp;<span class="string" id="8146113">&#34;-no_ticket&#34;</span><span class="op" id="8146125">,</span>&nbsp;<span class="string" id="8146127">&#34;-cipher&#34;</span><span class="op" id="8146136">,</span>&nbsp;<span class="string" id="8146138">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="8146152">}</span><span class="op" id="8146153">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146159"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145194">runServerTestSSLv3</a></span><span class="op" id="8146177">(</span><span class="ident" id="8146178"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146009">t</a></span><span class="op" id="8146179">,</span>&nbsp;<span class="ident" id="8146181"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146026">test</a></span><span class="op" id="8146185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146188"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145316">runServerTestTLS10</a></span><span class="op" id="8146206">(</span><span class="ident" id="8146207"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146009">t</a></span><span class="op" id="8146208">,</span>&nbsp;<span class="ident" id="8146210"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146026">test</a></span><span class="op" id="8146214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146217"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8146235">(</span><span class="ident" id="8146236"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146009">t</a></span><span class="op" id="8146237">,</span>&nbsp;<span class="ident" id="8146239"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146026">test</a></span><span class="op" id="8146243">)</span><br>
<span class="lineno"></span><span class="op" id="8146245">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="8146248">func</span>&nbsp;<span class="ident" id="8146253">TestHandshakeServerRSAAES</span><span class="op" id="8146278">(</span><span class="ident" id="8146279">t</span>&nbsp;<span class="op" id="8146281">*</span><span class="ident" id="8146282"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8146289">.</span><span class="ident" id="8146290"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8146291">)</span>&nbsp;<span class="op" id="8146293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146296">test</span>&nbsp;<span class="op" id="8146301">:=</span>&nbsp;<span class="op" id="8146304">&amp;</span><span class="ident" id="8146305"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8146315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146319"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8146323">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8146328">&#34;RSA-AES&#34;</span><span class="op" id="8146337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146341"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8146348">:</span>&nbsp;<span class="op" id="8146350">[</span><span class="op" id="8146351">]</span><span class="builtintype" id="8146352">string</span><span class="op" id="8146358">{</span><span class="string" id="8146359">&#34;openssl&#34;</span><span class="op" id="8146368">,</span>&nbsp;<span class="string" id="8146370">&#34;s_client&#34;</span><span class="op" id="8146380">,</span>&nbsp;<span class="string" id="8146382">&#34;-no_ticket&#34;</span><span class="op" id="8146394">,</span>&nbsp;<span class="string" id="8146396">&#34;-cipher&#34;</span><span class="op" id="8146405">,</span>&nbsp;<span class="string" id="8146407">&#34;AES128-SHA&#34;</span><span class="op" id="8146419">}</span><span class="op" id="8146420">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146426"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145194">runServerTestSSLv3</a></span><span class="op" id="8146444">(</span><span class="ident" id="8146445"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146279">t</a></span><span class="op" id="8146446">,</span>&nbsp;<span class="ident" id="8146448"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146296">test</a></span><span class="op" id="8146452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146455"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145316">runServerTestTLS10</a></span><span class="op" id="8146473">(</span><span class="ident" id="8146474"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146279">t</a></span><span class="op" id="8146475">,</span>&nbsp;<span class="ident" id="8146477"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146296">test</a></span><span class="op" id="8146481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146484"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8146502">(</span><span class="ident" id="8146503"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146279">t</a></span><span class="op" id="8146504">,</span>&nbsp;<span class="ident" id="8146506"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146296">test</a></span><span class="op" id="8146510">)</span><br>
<span class="lineno"></span><span class="op" id="8146512">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="8146515">func</span>&nbsp;<span class="ident" id="8146520">TestHandshakeServerAESGCM</span><span class="op" id="8146545">(</span><span class="ident" id="8146546">t</span>&nbsp;<span class="op" id="8146548">*</span><span class="ident" id="8146549"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8146556">.</span><span class="ident" id="8146557"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8146558">)</span>&nbsp;<span class="op" id="8146560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146563">test</span>&nbsp;<span class="op" id="8146568">:=</span>&nbsp;<span class="op" id="8146571">&amp;</span><span class="ident" id="8146572"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8146582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146586"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8146590">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8146595">&#34;RSA-AES-GCM&#34;</span><span class="op" id="8146608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146612"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8146619">:</span>&nbsp;<span class="op" id="8146621">[</span><span class="op" id="8146622">]</span><span class="builtintype" id="8146623">string</span><span class="op" id="8146629">{</span><span class="string" id="8146630">&#34;openssl&#34;</span><span class="op" id="8146639">,</span>&nbsp;<span class="string" id="8146641">&#34;s_client&#34;</span><span class="op" id="8146651">,</span>&nbsp;<span class="string" id="8146653">&#34;-no_ticket&#34;</span><span class="op" id="8146665">,</span>&nbsp;<span class="string" id="8146667">&#34;-cipher&#34;</span><span class="op" id="8146676">,</span>&nbsp;<span class="string" id="8146678">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8146707">}</span><span class="op" id="8146708">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8146711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146714"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8146732">(</span><span class="ident" id="8146733"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146546">t</a></span><span class="op" id="8146734">,</span>&nbsp;<span class="ident" id="8146736"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146563">test</a></span><span class="op" id="8146740">)</span><br>
<span class="lineno"></span><span class="op" id="8146742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8146745">func</span>&nbsp;<span class="ident" id="8146750">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="8146782">(</span><span class="ident" id="8146783">t</span>&nbsp;<span class="op" id="8146785">*</span><span class="ident" id="8146786"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8146793">.</span><span class="ident" id="8146794"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8146795">)</span>&nbsp;<span class="op" id="8146797">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146800">config</span>&nbsp;<span class="op" id="8146807">:=</span>&nbsp;<span class="op" id="8146810">*</span><span class="ident" id="8146811"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146823"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146800">config</a></span><span class="op" id="8146829">.</span><span class="ident" id="8146830"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="8146843">=</span>&nbsp;<span class="builtinfunc" id="8146845">make</span><span class="op" id="8146849">(</span><span class="op" id="8146850">[</span><span class="op" id="8146851">]</span><span class="ident" id="8146852"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8146863">,</span>&nbsp;<span class="num" id="8146865">1</span><span class="op" id="8146866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146869"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146800">config</a></span><span class="op" id="8146875">.</span><span class="ident" id="8146876"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8146888">[</span><span class="num" id="8146889">0</span><span class="op" id="8146890">]</span><span class="op" id="8146891">.</span><span class="ident" id="8146892"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span>&nbsp;<span class="op" id="8146904">=</span>&nbsp;<span class="op" id="8146906">[</span><span class="op" id="8146907">]</span><span class="op" id="8146908">[</span><span class="op" id="8146909">]</span><span class="builtintype" id="8146910">byte</span><span class="op" id="8146914">{</span><span class="ident" id="8146915"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8146935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146938"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146800">config</a></span><span class="op" id="8146944">.</span><span class="ident" id="8146945"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="8146957">[</span><span class="num" id="8146958">0</span><span class="op" id="8146959">]</span><span class="op" id="8146960">.</span><span class="ident" id="8146961"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span>&nbsp;<span class="op" id="8146972">=</span>&nbsp;<span class="ident" id="8146974"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8146995"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146800">config</a></span><span class="op" id="8147001">.</span><span class="ident" id="8147002"><a href="/gostd/crypto/tls/common.go.html#4457481">BuildNameToCertificate</a></span><span class="op" id="8147024">(</span><span class="op" id="8147025">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147029">test</span>&nbsp;<span class="op" id="8147034">:=</span>&nbsp;<span class="op" id="8147037">&amp;</span><span class="ident" id="8147038"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8147048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147052"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8147056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8147061">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8147078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147082"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8147089">:</span>&nbsp;<span class="op" id="8147091">[</span><span class="op" id="8147092">]</span><span class="builtintype" id="8147093">string</span><span class="op" id="8147099">{</span><span class="string" id="8147100">&#34;openssl&#34;</span><span class="op" id="8147109">,</span>&nbsp;<span class="string" id="8147111">&#34;s_client&#34;</span><span class="op" id="8147121">,</span>&nbsp;<span class="string" id="8147123">&#34;-no_ticket&#34;</span><span class="op" id="8147135">,</span>&nbsp;<span class="string" id="8147137">&#34;-cipher&#34;</span><span class="op" id="8147146">,</span>&nbsp;<span class="string" id="8147148">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="8147172">}</span><span class="op" id="8147173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147177"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8147183">:</span>&nbsp;&nbsp;<span class="op" id="8147186">&amp;</span><span class="ident" id="8147187"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146800">config</a></span><span class="op" id="8147193">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147199"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145316">runServerTestTLS10</a></span><span class="op" id="8147217">(</span><span class="ident" id="8147218"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146783">t</a></span><span class="op" id="8147219">,</span>&nbsp;<span class="ident" id="8147221"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147029">test</a></span><span class="op" id="8147225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147228"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8147246">(</span><span class="ident" id="8147247"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8146783">t</a></span><span class="op" id="8147248">,</span>&nbsp;<span class="ident" id="8147250"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147029">test</a></span><span class="op" id="8147254">)</span><br>
<span class="lineno"></span><span class="op" id="8147256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="8147259">func</span>&nbsp;<span class="ident" id="8147264">TestHandshakeServerALPN</span><span class="op" id="8147287">(</span><span class="ident" id="8147288">t</span>&nbsp;<span class="op" id="8147290">*</span><span class="ident" id="8147291"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8147298">.</span><span class="ident" id="8147299"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8147300">)</span>&nbsp;<span class="op" id="8147302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147305">config</span>&nbsp;<span class="op" id="8147312">:=</span>&nbsp;<span class="op" id="8147315">*</span><span class="ident" id="8147316"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147328"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147305">config</a></span><span class="op" id="8147334">.</span><span class="ident" id="8147335"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="8147346">=</span>&nbsp;<span class="op" id="8147348">[</span><span class="op" id="8147349">]</span><span class="builtintype" id="8147350">string</span><span class="op" id="8147356">{</span><span class="string" id="8147357">&#34;proto1&#34;</span><span class="op" id="8147365">,</span>&nbsp;<span class="string" id="8147367">&#34;proto2&#34;</span><span class="op" id="8147375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147379">test</span>&nbsp;<span class="op" id="8147384">:=</span>&nbsp;<span class="op" id="8147387">&amp;</span><span class="ident" id="8147388"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8147398">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147402"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8147406">:</span>&nbsp;<span class="string" id="8147408">&#34;ALPN&#34;</span><span class="op" id="8147414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8147418">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8147484">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147527"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8147534">:</span>&nbsp;<span class="op" id="8147536">[</span><span class="op" id="8147537">]</span><span class="builtintype" id="8147538">string</span><span class="op" id="8147544">{</span><span class="string" id="8147545">&#34;openssl&#34;</span><span class="op" id="8147554">,</span>&nbsp;<span class="string" id="8147556">&#34;s_client&#34;</span><span class="op" id="8147566">,</span>&nbsp;<span class="string" id="8147568">&#34;-alpn&#34;</span><span class="op" id="8147575">,</span>&nbsp;<span class="string" id="8147577">&#34;proto2,proto1&#34;</span><span class="op" id="8147592">}</span><span class="op" id="8147593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147597"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8147603">:</span>&nbsp;&nbsp;<span class="op" id="8147606">&amp;</span><span class="ident" id="8147607"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147305">config</a></span><span class="op" id="8147613">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147617"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140035">validate</a></span><span class="op" id="8147625">:</span>&nbsp;<span class="keyword" id="8147627">func</span><span class="op" id="8147631">(</span><span class="ident" id="8147632">state</span>&nbsp;<span class="ident" id="8147638"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8147653">)</span>&nbsp;<span class="builtintype" id="8147655">error</span>&nbsp;<span class="op" id="8147661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8147666">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147725">if</span>&nbsp;<span class="ident" id="8147728"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147632">state</a></span><span class="op" id="8147733">.</span><span class="ident" id="8147734"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span>&nbsp;<span class="op" id="8147753">!=</span>&nbsp;<span class="string" id="8147756">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8147765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147771">return</span>&nbsp;<span class="ident" id="8147778"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132603">fmt</a></span><span class="op" id="8147781">.</span><span class="ident" id="8147782"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="8147788">(</span><span class="string" id="8147789">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8147821">,</span>&nbsp;<span class="ident" id="8147823"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147632">state</a></span><span class="op" id="8147828">.</span><span class="ident" id="8147829"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span><span class="op" id="8147847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147852">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8147857">return</span>&nbsp;<span class="builtintype" id="8147864">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147870">}</span><span class="op" id="8147871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8147874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147877"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8147895">(</span><span class="ident" id="8147896"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147288">t</a></span><span class="op" id="8147897">,</span>&nbsp;<span class="ident" id="8147899"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147379">test</a></span><span class="op" id="8147903">)</span><br>
<span class="lineno"></span><span class="op" id="8147905">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="8147908">func</span>&nbsp;<span class="ident" id="8147913">TestHandshakeServerALPNNoMatch</span><span class="op" id="8147943">(</span><span class="ident" id="8147944">t</span>&nbsp;<span class="op" id="8147946">*</span><span class="ident" id="8147947"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8147954">.</span><span class="ident" id="8147955"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8147956">)</span>&nbsp;<span class="op" id="8147958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147961">config</span>&nbsp;<span class="op" id="8147968">:=</span>&nbsp;<span class="op" id="8147971">*</span><span class="ident" id="8147972"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8147984"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147961">config</a></span><span class="op" id="8147990">.</span><span class="ident" id="8147991"><a href="/gostd/crypto/tls/common.go.html#4452064">NextProtos</a></span>&nbsp;<span class="op" id="8148002">=</span>&nbsp;<span class="op" id="8148004">[</span><span class="op" id="8148005">]</span><span class="builtintype" id="8148006">string</span><span class="op" id="8148012">{</span><span class="string" id="8148013">&#34;proto3&#34;</span><span class="op" id="8148021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148025">test</span>&nbsp;<span class="op" id="8148030">:=</span>&nbsp;<span class="op" id="8148033">&amp;</span><span class="ident" id="8148034"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8148044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148048"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8148052">:</span>&nbsp;<span class="string" id="8148054">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8148068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148072">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148138">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148181"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8148188">:</span>&nbsp;<span class="op" id="8148190">[</span><span class="op" id="8148191">]</span><span class="builtintype" id="8148192">string</span><span class="op" id="8148198">{</span><span class="string" id="8148199">&#34;openssl&#34;</span><span class="op" id="8148208">,</span>&nbsp;<span class="string" id="8148210">&#34;s_client&#34;</span><span class="op" id="8148220">,</span>&nbsp;<span class="string" id="8148222">&#34;-alpn&#34;</span><span class="op" id="8148229">,</span>&nbsp;<span class="string" id="8148231">&#34;proto2,proto1&#34;</span><span class="op" id="8148246">}</span><span class="op" id="8148247">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148251"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8148257">:</span>&nbsp;&nbsp;<span class="op" id="8148260">&amp;</span><span class="ident" id="8148261"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147961">config</a></span><span class="op" id="8148267">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148271"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8140035">validate</a></span><span class="op" id="8148279">:</span>&nbsp;<span class="keyword" id="8148281">func</span><span class="op" id="8148285">(</span><span class="ident" id="8148286">state</span>&nbsp;<span class="ident" id="8148292"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><span class="op" id="8148307">)</span>&nbsp;<span class="builtintype" id="8148309">error</span>&nbsp;<span class="op" id="8148315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148320">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8148379">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8148422">if</span>&nbsp;<span class="ident" id="8148425"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8148286">state</a></span><span class="op" id="8148430">.</span><span class="ident" id="8148431"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span>&nbsp;<span class="op" id="8148450">!=</span>&nbsp;<span class="string" id="8148453">&#34;&#34;</span>&nbsp;<span class="op" id="8148456">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8148462">return</span>&nbsp;<span class="ident" id="8148469"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132603">fmt</a></span><span class="op" id="8148472">.</span><span class="ident" id="8148473"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="8148479">(</span><span class="string" id="8148480">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8148508">,</span>&nbsp;<span class="ident" id="8148510"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8148286">state</a></span><span class="op" id="8148515">.</span><span class="ident" id="8148516"><a href="/gostd/crypto/tls/common.go.html#4446910">NegotiatedProtocol</a></span><span class="op" id="8148534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8148539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8148544">return</span>&nbsp;<span class="builtintype" id="8148551">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8148557">}</span><span class="op" id="8148558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8148561">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148564"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8148582">(</span><span class="ident" id="8148583"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8147944">t</a></span><span class="op" id="8148584">,</span>&nbsp;<span class="ident" id="8148586"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8148025">test</a></span><span class="op" id="8148590">)</span><br>
<span class="lineno"></span><span class="op" id="8148592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8148595">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8148667">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="8148747">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8148811">func</span>&nbsp;<span class="ident" id="8148816">TestHandshakeServerSNI</span><span class="op" id="8148838">(</span><span class="ident" id="8148839">t</span>&nbsp;<span class="op" id="8148841">*</span><span class="ident" id="8148842"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8148849">.</span><span class="ident" id="8148850"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8148851">)</span>&nbsp;<span class="op" id="8148853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148856">test</span>&nbsp;<span class="op" id="8148861">:=</span>&nbsp;<span class="op" id="8148864">&amp;</span><span class="ident" id="8148865"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8148875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148879"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8148883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8148888">&#34;SNI&#34;</span><span class="op" id="8148893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8148897"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8148904">:</span>&nbsp;<span class="op" id="8148906">[</span><span class="op" id="8148907">]</span><span class="builtintype" id="8148908">string</span><span class="op" id="8148914">{</span><span class="string" id="8148915">&#34;openssl&#34;</span><span class="op" id="8148924">,</span>&nbsp;<span class="string" id="8148926">&#34;s_client&#34;</span><span class="op" id="8148936">,</span>&nbsp;<span class="string" id="8148938">&#34;-no_ticket&#34;</span><span class="op" id="8148950">,</span>&nbsp;<span class="string" id="8148952">&#34;-cipher&#34;</span><span class="op" id="8148961">,</span>&nbsp;<span class="string" id="8148963">&#34;AES128-SHA&#34;</span><span class="op" id="8148975">,</span>&nbsp;<span class="string" id="8148977">&#34;-servername&#34;</span><span class="op" id="8148990">,</span>&nbsp;<span class="string" id="8148992">&#34;snitest.com&#34;</span><span class="op" id="8149005">}</span><span class="op" id="8149006">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8149009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149012"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8149030">(</span><span class="ident" id="8149031"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8148839">t</a></span><span class="op" id="8149032">,</span>&nbsp;<span class="ident" id="8149034"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8148856">test</a></span><span class="op" id="8149038">)</span><br>
<span class="lineno"></span><span class="op" id="8149040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8149043">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="8149122">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="8149165">func</span>&nbsp;<span class="ident" id="8149170">TestHandshakeServerSNIGetCertificate</span><span class="op" id="8149206">(</span><span class="ident" id="8149207">t</span>&nbsp;<span class="op" id="8149209">*</span><span class="ident" id="8149210"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8149217">.</span><span class="ident" id="8149218"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8149219">)</span>&nbsp;<span class="op" id="8149221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149224">config</span>&nbsp;<span class="op" id="8149231">:=</span>&nbsp;<span class="op" id="8149234">*</span><span class="ident" id="8149235"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8149248">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149317">nameToCert</span>&nbsp;<span class="op" id="8149328">:=</span>&nbsp;<span class="ident" id="8149331"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149224">config</a></span><span class="op" id="8149337">.</span><span class="ident" id="8149338"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149357"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149224">config</a></span><span class="op" id="8149363">.</span><span class="ident" id="8149364"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span>&nbsp;<span class="op" id="8149382">=</span>&nbsp;<span class="builtintype" id="8149384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149389"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149224">config</a></span><span class="op" id="8149395">.</span><span class="ident" id="8149396"><a href="/gostd/crypto/tls/common.go.html#4451724">GetCertificate</a></span>&nbsp;<span class="op" id="8149411">=</span>&nbsp;<span class="keyword" id="8149413">func</span><span class="op" id="8149417">(</span><span class="ident" id="8149418">clientHello</span>&nbsp;<span class="op" id="8149430">*</span><span class="ident" id="8149431"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="8149446">)</span>&nbsp;<span class="op" id="8149448">(</span><span class="op" id="8149449">*</span><span class="ident" id="8149450"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8149461">,</span>&nbsp;<span class="builtintype" id="8149463">error</span><span class="op" id="8149468">)</span>&nbsp;<span class="op" id="8149470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149474">cert</span><span class="op" id="8149478">,</span>&nbsp;<span class="ident" id="8149480">_</span>&nbsp;<span class="op" id="8149482">:=</span>&nbsp;<span class="ident" id="8149485"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149317">nameToCert</a></span><span class="op" id="8149495">[</span><span class="ident" id="8149496"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149418">clientHello</a></span><span class="op" id="8149507">.</span><span class="ident" id="8149508"><a href="/gostd/crypto/tls/common.go.html#4449747">ServerName</a></span><span class="op" id="8149518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8149522">return</span>&nbsp;<span class="ident" id="8149529"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149474">cert</a></span><span class="op" id="8149533">,</span>&nbsp;<span class="builtintype" id="8149535">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8149540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149543">test</span>&nbsp;<span class="op" id="8149548">:=</span>&nbsp;<span class="op" id="8149551">&amp;</span><span class="ident" id="8149552"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8149562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149566"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8149570">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149575">&#34;SNI&#34;</span><span class="op" id="8149580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149584"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8149591">:</span>&nbsp;<span class="op" id="8149593">[</span><span class="op" id="8149594">]</span><span class="builtintype" id="8149595">string</span><span class="op" id="8149601">{</span><span class="string" id="8149602">&#34;openssl&#34;</span><span class="op" id="8149611">,</span>&nbsp;<span class="string" id="8149613">&#34;s_client&#34;</span><span class="op" id="8149623">,</span>&nbsp;<span class="string" id="8149625">&#34;-no_ticket&#34;</span><span class="op" id="8149637">,</span>&nbsp;<span class="string" id="8149639">&#34;-cipher&#34;</span><span class="op" id="8149648">,</span>&nbsp;<span class="string" id="8149650">&#34;AES128-SHA&#34;</span><span class="op" id="8149662">,</span>&nbsp;<span class="string" id="8149664">&#34;-servername&#34;</span><span class="op" id="8149677">,</span>&nbsp;<span class="string" id="8149679">&#34;snitest.com&#34;</span><span class="op" id="8149692">}</span><span class="op" id="8149693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149697"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8149703">:</span>&nbsp;&nbsp;<span class="op" id="8149706">&amp;</span><span class="ident" id="8149707"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149224">config</a></span><span class="op" id="8149713">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8149716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8149719"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8149737">(</span><span class="ident" id="8149738"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149207">t</a></span><span class="op" id="8149739">,</span>&nbsp;<span class="ident" id="8149741"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8149543">test</a></span><span class="op" id="8149745">)</span><br>
<span class="lineno"></span><span class="op" id="8149747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8149750">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="8149809">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8149884">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8149958">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8149988">func</span>&nbsp;<span class="ident" id="8149993">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="8150037">(</span><span class="ident" id="8150038">t</span>&nbsp;<span class="op" id="8150040">*</span><span class="ident" id="8150041"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8150048">.</span><span class="ident" id="8150049"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8150050">)</span>&nbsp;<span class="op" id="8150052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150055">config</span>&nbsp;<span class="op" id="8150062">:=</span>&nbsp;<span class="op" id="8150065">*</span><span class="ident" id="8150066"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150079"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150055">config</a></span><span class="op" id="8150085">.</span><span class="ident" id="8150086"><a href="/gostd/crypto/tls/common.go.html#4451724">GetCertificate</a></span>&nbsp;<span class="op" id="8150101">=</span>&nbsp;<span class="keyword" id="8150103">func</span><span class="op" id="8150107">(</span><span class="ident" id="8150108">clientHello</span>&nbsp;<span class="op" id="8150120">*</span><span class="ident" id="8150121"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="8150136">)</span>&nbsp;<span class="op" id="8150138">(</span><span class="op" id="8150139">*</span><span class="ident" id="8150140"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8150151">,</span>&nbsp;<span class="builtintype" id="8150153">error</span><span class="op" id="8150158">)</span>&nbsp;<span class="op" id="8150160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8150164">return</span>&nbsp;<span class="builtintype" id="8150171">nil</span><span class="op" id="8150174">,</span>&nbsp;<span class="builtintype" id="8150176">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150184">test</span>&nbsp;<span class="op" id="8150189">:=</span>&nbsp;<span class="op" id="8150192">&amp;</span><span class="ident" id="8150193"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8150203">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150207"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8150211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150216">&#34;SNI&#34;</span><span class="op" id="8150221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150225"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8150232">:</span>&nbsp;<span class="op" id="8150234">[</span><span class="op" id="8150235">]</span><span class="builtintype" id="8150236">string</span><span class="op" id="8150242">{</span><span class="string" id="8150243">&#34;openssl&#34;</span><span class="op" id="8150252">,</span>&nbsp;<span class="string" id="8150254">&#34;s_client&#34;</span><span class="op" id="8150264">,</span>&nbsp;<span class="string" id="8150266">&#34;-no_ticket&#34;</span><span class="op" id="8150278">,</span>&nbsp;<span class="string" id="8150280">&#34;-cipher&#34;</span><span class="op" id="8150289">,</span>&nbsp;<span class="string" id="8150291">&#34;AES128-SHA&#34;</span><span class="op" id="8150303">,</span>&nbsp;<span class="string" id="8150305">&#34;-servername&#34;</span><span class="op" id="8150318">,</span>&nbsp;<span class="string" id="8150320">&#34;snitest.com&#34;</span><span class="op" id="8150333">}</span><span class="op" id="8150334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150338"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8150344">:</span>&nbsp;&nbsp;<span class="op" id="8150347">&amp;</span><span class="ident" id="8150348"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150055">config</a></span><span class="op" id="8150354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150360"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8150378">(</span><span class="ident" id="8150379"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150038">t</a></span><span class="op" id="8150380">,</span>&nbsp;<span class="ident" id="8150382"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150184">test</a></span><span class="op" id="8150386">)</span><br>
<span class="lineno">625</span><span class="op" id="8150388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8150391">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8150467">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="8150508">func</span>&nbsp;<span class="ident" id="8150513">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="8150554">(</span><span class="ident" id="8150555">t</span>&nbsp;<span class="op" id="8150557">*</span><span class="ident" id="8150558"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8150565">.</span><span class="ident" id="8150566"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8150567">)</span>&nbsp;<span class="op" id="8150569">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150572">config</span>&nbsp;<span class="op" id="8150579">:=</span>&nbsp;<span class="op" id="8150582">*</span><span class="ident" id="8150583"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150596"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150572">config</a></span><span class="op" id="8150602">.</span><span class="ident" id="8150603"><a href="/gostd/crypto/tls/common.go.html#4451724">GetCertificate</a></span>&nbsp;<span class="op" id="8150618">=</span>&nbsp;<span class="keyword" id="8150620">func</span><span class="op" id="8150624">(</span><span class="ident" id="8150625">clientHello</span>&nbsp;<span class="op" id="8150637">*</span><span class="ident" id="8150638"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="8150653">)</span>&nbsp;<span class="op" id="8150655">(</span><span class="op" id="8150656">*</span><span class="ident" id="8150657"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8150668">,</span>&nbsp;<span class="builtintype" id="8150670">error</span><span class="op" id="8150675">)</span>&nbsp;<span class="op" id="8150677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8150681">return</span>&nbsp;<span class="builtintype" id="8150688">nil</span><span class="op" id="8150691">,</span>&nbsp;<span class="ident" id="8150693"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132603">fmt</a></span><span class="op" id="8150696">.</span><span class="ident" id="8150697"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="8150703">(</span><span class="string" id="8150704">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="8150734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150737">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150740">test</span>&nbsp;<span class="op" id="8150745">:=</span>&nbsp;<span class="op" id="8150748">&amp;</span><span class="ident" id="8150749"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8150759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150763"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8150767">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150776">&#34;SNI&#34;</span><span class="op" id="8150781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150785"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8150792">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150798">[</span><span class="op" id="8150799">]</span><span class="builtintype" id="8150800">string</span><span class="op" id="8150806">{</span><span class="string" id="8150807">&#34;openssl&#34;</span><span class="op" id="8150816">,</span>&nbsp;<span class="string" id="8150818">&#34;s_client&#34;</span><span class="op" id="8150828">,</span>&nbsp;<span class="string" id="8150830">&#34;-no_ticket&#34;</span><span class="op" id="8150842">,</span>&nbsp;<span class="string" id="8150844">&#34;-cipher&#34;</span><span class="op" id="8150853">,</span>&nbsp;<span class="string" id="8150855">&#34;AES128-SHA&#34;</span><span class="op" id="8150867">,</span>&nbsp;<span class="string" id="8150869">&#34;-servername&#34;</span><span class="op" id="8150882">,</span>&nbsp;<span class="string" id="8150884">&#34;snitest.com&#34;</span><span class="op" id="8150897">}</span><span class="op" id="8150898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150902"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8150908">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150915">&amp;</span><span class="ident" id="8150916"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150572">config</a></span><span class="op" id="8150922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150926"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139659">expectAlert</a></span><span class="op" id="8150937">:</span>&nbsp;<span class="builtintype" id="8150939">true</span><span class="op" id="8150943">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8150946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8150949"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8150967">(</span><span class="ident" id="8150968"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150555">t</a></span><span class="op" id="8150969">,</span>&nbsp;<span class="ident" id="8150971"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8150740">test</a></span><span class="op" id="8150975">)</span><br>
<span class="lineno"></span><span class="op" id="8150977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8150980">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="8151060">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8151134">func</span>&nbsp;<span class="ident" id="8151139">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="8151173">(</span><span class="ident" id="8151174">t</span>&nbsp;<span class="op" id="8151176">*</span><span class="ident" id="8151177"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8151184">.</span><span class="ident" id="8151185"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8151186">)</span>&nbsp;<span class="op" id="8151188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151191">config</span>&nbsp;<span class="op" id="8151198">:=</span>&nbsp;<span class="op" id="8151201">*</span><span class="ident" id="8151202"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151214"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151220">.</span><span class="ident" id="8151221"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span>&nbsp;<span class="op" id="8151234">=</span>&nbsp;<span class="op" id="8151236">[</span><span class="op" id="8151237">]</span><span class="builtintype" id="8151238">uint16</span><span class="op" id="8151244">{</span><span class="ident" id="8151245"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441513">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="8151281">,</span>&nbsp;<span class="ident" id="8151283"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441741">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="8151317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151320"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151326">.</span><span class="ident" id="8151327"><a href="/gostd/crypto/tls/common.go.html#4453426">PreferServerCipherSuites</a></span>&nbsp;<span class="op" id="8151352">=</span>&nbsp;<span class="builtintype" id="8151354">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151361">test</span>&nbsp;<span class="op" id="8151366">:=</span>&nbsp;<span class="op" id="8151369">&amp;</span><span class="ident" id="8151370"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8151380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151384"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8151388">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8151392">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="8151422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151426"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8151432">:</span>&nbsp;<span class="op" id="8151434">&amp;</span><span class="ident" id="8151435"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151441">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151444">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151447"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8151465">(</span><span class="ident" id="8151466"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151174">t</a></span><span class="op" id="8151467">,</span>&nbsp;<span class="ident" id="8151469"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151361">test</a></span><span class="op" id="8151473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151477"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span>&nbsp;<span class="op" id="8151484">=</span>&nbsp;<span class="op" id="8151486">*</span><span class="ident" id="8151487"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151499"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151505">.</span><span class="ident" id="8151506"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span>&nbsp;<span class="op" id="8151519">=</span>&nbsp;<span class="op" id="8151521">[</span><span class="op" id="8151522">]</span><span class="builtintype" id="8151523">uint16</span><span class="op" id="8151529">{</span><span class="ident" id="8151530"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441741">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="8151564">,</span>&nbsp;<span class="ident" id="8151566"><a href="/gostd/crypto/tls/cipher_suites.go.html#4441513">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</a></span><span class="op" id="8151602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151605"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151611">.</span><span class="ident" id="8151612"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="8151625">=</span>&nbsp;<span class="op" id="8151627">[</span><span class="op" id="8151628">]</span><span class="ident" id="8151629"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="8151640">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151649"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><span class="op" id="8151660">:</span>&nbsp;<span class="op" id="8151662">[</span><span class="op" id="8151663">]</span><span class="op" id="8151664">[</span><span class="op" id="8151665">]</span><span class="builtintype" id="8151666">byte</span><span class="op" id="8151670">{</span><span class="ident" id="8151671"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8159422">testECDSACertificate</a></span><span class="op" id="8151691">}</span><span class="op" id="8151692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151697"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="8151707">:</span>&nbsp;&nbsp;<span class="ident" id="8151710"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8162664">testECDSAPrivateKey</a></span><span class="op" id="8151729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151733">}</span><span class="op" id="8151734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151737">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151740"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151746">.</span><span class="ident" id="8151747"><a href="/gostd/crypto/tls/common.go.html#4457481">BuildNameToCertificate</a></span><span class="op" id="8151769">(</span><span class="op" id="8151770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151773"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151779">.</span><span class="ident" id="8151780"><a href="/gostd/crypto/tls/common.go.html#4453426">PreferServerCipherSuites</a></span>&nbsp;<span class="op" id="8151805">=</span>&nbsp;<span class="builtintype" id="8151807">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151814"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151361">test</a></span>&nbsp;<span class="op" id="8151819">=</span>&nbsp;<span class="op" id="8151821">&amp;</span><span class="ident" id="8151822"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8151832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151836"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8151840">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8151844">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="8151876">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151880"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8151886">:</span>&nbsp;<span class="op" id="8151888">&amp;</span><span class="ident" id="8151889"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151191">config</a></span><span class="op" id="8151895">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8151898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151901"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8151919">(</span><span class="ident" id="8151920"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151174">t</a></span><span class="op" id="8151921">,</span>&nbsp;<span class="ident" id="8151923"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151361">test</a></span><span class="op" id="8151927">)</span><br>
<span class="lineno"></span><span class="op" id="8151929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="8151932">func</span>&nbsp;<span class="ident" id="8151937">TestResumption</span><span class="op" id="8151951">(</span><span class="ident" id="8151952">t</span>&nbsp;<span class="op" id="8151954">*</span><span class="ident" id="8151955"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8151962">.</span><span class="ident" id="8151963"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8151964">)</span>&nbsp;<span class="op" id="8151966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8151969">sessionFilePath</span>&nbsp;<span class="op" id="8151985">:=</span>&nbsp;<span class="ident" id="8151988"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8151996">(</span><span class="string" id="8151997">&#34;&#34;</span><span class="op" id="8151999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152002">defer</span>&nbsp;<span class="ident" id="8152008"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8152010">.</span><span class="ident" id="8152011"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8152017">(</span><span class="ident" id="8152018"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151969">sessionFilePath</a></span><span class="op" id="8152033">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152037">test</span>&nbsp;<span class="op" id="8152042">:=</span>&nbsp;<span class="op" id="8152045">&amp;</span><span class="ident" id="8152046"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8152056">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152060"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8152064">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152069">&#34;IssueTicket&#34;</span><span class="op" id="8152082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152086"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8152093">:</span>&nbsp;<span class="op" id="8152095">[</span><span class="op" id="8152096">]</span><span class="builtintype" id="8152097">string</span><span class="op" id="8152103">{</span><span class="string" id="8152104">&#34;openssl&#34;</span><span class="op" id="8152113">,</span>&nbsp;<span class="string" id="8152115">&#34;s_client&#34;</span><span class="op" id="8152125">,</span>&nbsp;<span class="string" id="8152127">&#34;-cipher&#34;</span><span class="op" id="8152136">,</span>&nbsp;<span class="string" id="8152138">&#34;RC4-SHA&#34;</span><span class="op" id="8152147">,</span>&nbsp;<span class="string" id="8152149">&#34;-sess_out&#34;</span><span class="op" id="8152160">,</span>&nbsp;<span class="ident" id="8152162"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151969">sessionFilePath</a></span><span class="op" id="8152177">}</span><span class="op" id="8152178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152184"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8152202">(</span><span class="ident" id="8152203"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151952">t</a></span><span class="op" id="8152204">,</span>&nbsp;<span class="ident" id="8152206"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152037">test</a></span><span class="op" id="8152210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152214"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152037">test</a></span>&nbsp;<span class="op" id="8152219">=</span>&nbsp;<span class="op" id="8152221">&amp;</span><span class="ident" id="8152222"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8152232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152236"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8152240">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152245">&#34;Resume&#34;</span><span class="op" id="8152253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152257"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8152264">:</span>&nbsp;<span class="op" id="8152266">[</span><span class="op" id="8152267">]</span><span class="builtintype" id="8152268">string</span><span class="op" id="8152274">{</span><span class="string" id="8152275">&#34;openssl&#34;</span><span class="op" id="8152284">,</span>&nbsp;<span class="string" id="8152286">&#34;s_client&#34;</span><span class="op" id="8152296">,</span>&nbsp;<span class="string" id="8152298">&#34;-cipher&#34;</span><span class="op" id="8152307">,</span>&nbsp;<span class="string" id="8152309">&#34;RC4-SHA&#34;</span><span class="op" id="8152318">,</span>&nbsp;<span class="string" id="8152320">&#34;-sess_in&#34;</span><span class="op" id="8152330">,</span>&nbsp;<span class="ident" id="8152332"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151969">sessionFilePath</a></span><span class="op" id="8152347">}</span><span class="op" id="8152348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152354"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8152372">(</span><span class="ident" id="8152373"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8151952">t</a></span><span class="op" id="8152374">,</span>&nbsp;<span class="ident" id="8152376"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152037">test</a></span><span class="op" id="8152380">)</span><br>
<span class="lineno">690</span><span class="op" id="8152382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8152385">func</span>&nbsp;<span class="ident" id="8152390">TestResumptionDisabled</span><span class="op" id="8152412">(</span><span class="ident" id="8152413">t</span>&nbsp;<span class="op" id="8152415">*</span><span class="ident" id="8152416"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8152423">.</span><span class="ident" id="8152424"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8152425">)</span>&nbsp;<span class="op" id="8152427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152430">sessionFilePath</span>&nbsp;<span class="op" id="8152446">:=</span>&nbsp;<span class="ident" id="8152449"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8152457">(</span><span class="string" id="8152458">&#34;&#34;</span><span class="op" id="8152460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8152463">defer</span>&nbsp;<span class="ident" id="8152469"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8152471">.</span><span class="ident" id="8152472"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8152478">(</span><span class="ident" id="8152479"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152430">sessionFilePath</a></span><span class="op" id="8152494">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152498">config</span>&nbsp;<span class="op" id="8152505">:=</span>&nbsp;<span class="op" id="8152508">*</span><span class="ident" id="8152509"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152522">test</span>&nbsp;<span class="op" id="8152527">:=</span>&nbsp;<span class="op" id="8152530">&amp;</span><span class="ident" id="8152531"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8152541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152545"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8152549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152554">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="8152577">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152581"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8152588">:</span>&nbsp;<span class="op" id="8152590">[</span><span class="op" id="8152591">]</span><span class="builtintype" id="8152592">string</span><span class="op" id="8152598">{</span><span class="string" id="8152599">&#34;openssl&#34;</span><span class="op" id="8152608">,</span>&nbsp;<span class="string" id="8152610">&#34;s_client&#34;</span><span class="op" id="8152620">,</span>&nbsp;<span class="string" id="8152622">&#34;-cipher&#34;</span><span class="op" id="8152631">,</span>&nbsp;<span class="string" id="8152633">&#34;RC4-SHA&#34;</span><span class="op" id="8152642">,</span>&nbsp;<span class="string" id="8152644">&#34;-sess_out&#34;</span><span class="op" id="8152655">,</span>&nbsp;<span class="ident" id="8152657"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152430">sessionFilePath</a></span><span class="op" id="8152672">}</span><span class="op" id="8152673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152677"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8152683">:</span>&nbsp;&nbsp;<span class="op" id="8152686">&amp;</span><span class="ident" id="8152687"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152498">config</a></span><span class="op" id="8152693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152699"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8152717">(</span><span class="ident" id="8152718"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152413">t</a></span><span class="op" id="8152719">,</span>&nbsp;<span class="ident" id="8152721"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152522">test</a></span><span class="op" id="8152725">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152729"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152498">config</a></span><span class="op" id="8152735">.</span><span class="ident" id="8152736"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span>&nbsp;<span class="op" id="8152759">=</span>&nbsp;<span class="builtintype" id="8152761">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152768"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152522">test</a></span>&nbsp;<span class="op" id="8152773">=</span>&nbsp;<span class="op" id="8152775">&amp;</span><span class="ident" id="8152776"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8152786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152790"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8152794">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152799">&#34;ResumeDisabled&#34;</span><span class="op" id="8152815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152819"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8152826">:</span>&nbsp;<span class="op" id="8152828">[</span><span class="op" id="8152829">]</span><span class="builtintype" id="8152830">string</span><span class="op" id="8152836">{</span><span class="string" id="8152837">&#34;openssl&#34;</span><span class="op" id="8152846">,</span>&nbsp;<span class="string" id="8152848">&#34;s_client&#34;</span><span class="op" id="8152858">,</span>&nbsp;<span class="string" id="8152860">&#34;-cipher&#34;</span><span class="op" id="8152869">,</span>&nbsp;<span class="string" id="8152871">&#34;RC4-SHA&#34;</span><span class="op" id="8152880">,</span>&nbsp;<span class="string" id="8152882">&#34;-sess_in&#34;</span><span class="op" id="8152892">,</span>&nbsp;<span class="ident" id="8152894"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152430">sessionFilePath</a></span><span class="op" id="8152909">}</span><span class="op" id="8152910">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152914"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8152920">:</span>&nbsp;&nbsp;<span class="op" id="8152923">&amp;</span><span class="ident" id="8152924"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152498">config</a></span><span class="op" id="8152930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8152933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8152936"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8152954">(</span><span class="ident" id="8152955"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152413">t</a></span><span class="op" id="8152956">,</span>&nbsp;<span class="ident" id="8152958"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8152522">test</a></span><span class="op" id="8152962">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8152966">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8153038">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="8153106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8153109">func</span>&nbsp;<span class="ident" id="8153114">TestFallbackSCSV</span><span class="op" id="8153130">(</span><span class="ident" id="8153131">t</span>&nbsp;<span class="op" id="8153133">*</span><span class="ident" id="8153134"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8153141">.</span><span class="ident" id="8153142"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8153143">)</span>&nbsp;<span class="op" id="8153145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153148">test</span>&nbsp;<span class="op" id="8153153">:=</span>&nbsp;<span class="op" id="8153156">&amp;</span><span class="ident" id="8153157"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8153167">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153171"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8153175">:</span>&nbsp;<span class="string" id="8153177">&#34;FallbackSCSV&#34;</span><span class="op" id="8153191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8153195">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153256"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8153263">:</span>&nbsp;<span class="op" id="8153265">[</span><span class="op" id="8153266">]</span><span class="builtintype" id="8153267">string</span><span class="op" id="8153273">{</span><span class="string" id="8153274">&#34;openssl&#34;</span><span class="op" id="8153283">,</span>&nbsp;<span class="string" id="8153285">&#34;s_client&#34;</span><span class="op" id="8153295">,</span>&nbsp;<span class="string" id="8153297">&#34;-fallback_scsv&#34;</span><span class="op" id="8153313">}</span><span class="op" id="8153314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153318"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139818">expectHandshakeErrorIncluding</a></span><span class="op" id="8153347">:</span>&nbsp;<span class="string" id="8153349">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="8153381">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8153384">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8153387"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145439">runServerTestTLS11</a></span><span class="op" id="8153405">(</span><span class="ident" id="8153406"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8153131">t</a></span><span class="op" id="8153407">,</span>&nbsp;<span class="ident" id="8153409"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8153148">test</a></span><span class="op" id="8153413">)</span><br>
<span class="lineno"></span><span class="op" id="8153415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8153418">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="8153479">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="8153541">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8153577">const</span>&nbsp;<span class="ident" id="8153583">clientCertificatePEM</span>&nbsp;<span class="op" id="8153604">=</span>&nbsp;<span class="string" id="8153606">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8154339">const</span>&nbsp;<span class="ident" id="8154345">clientKeyPEM</span>&nbsp;<span class="op" id="8154358">=</span>&nbsp;<span class="string" id="8154360">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8155247">const</span>&nbsp;<span class="ident" id="8155253">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="8155279">=</span>&nbsp;<span class="string" id="8155281">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8156034">const</span>&nbsp;<span class="ident" id="8156040">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="8156058">=</span>&nbsp;<span class="string" id="8156060">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="8156500">func</span>&nbsp;<span class="ident" id="8156505">TestClientAuth</span><span class="op" id="8156519">(</span><span class="ident" id="8156520">t</span>&nbsp;<span class="op" id="8156522">*</span><span class="ident" id="8156523"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132680">testing</a></span><span class="op" id="8156530">.</span><span class="ident" id="8156531"><a href="/gostd/testing/testing.go.html#5477412">T</a></span><span class="op" id="8156532">)</span>&nbsp;<span class="op" id="8156534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156537">var</span>&nbsp;<span class="ident" id="8156541">certPath</span><span class="op" id="8156549">,</span>&nbsp;<span class="ident" id="8156551">keyPath</span><span class="op" id="8156558">,</span>&nbsp;<span class="ident" id="8156560">ecdsaCertPath</span><span class="op" id="8156573">,</span>&nbsp;<span class="ident" id="8156575">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="8156588">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156597">if</span>&nbsp;<span class="op" id="8156600">*</span><span class="ident" id="8156601"><a href="/gostd/crypto/tls/handshake_test.go.html#8164557">update</a></span>&nbsp;<span class="op" id="8156608">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156612"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156541">certPath</a></span>&nbsp;<span class="op" id="8156621">=</span>&nbsp;<span class="ident" id="8156623"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8156631">(</span><span class="ident" id="8156632"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8153583">clientCertificatePEM</a></span><span class="op" id="8156652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156656">defer</span>&nbsp;<span class="ident" id="8156662"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8156664">.</span><span class="ident" id="8156665"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8156671">(</span><span class="ident" id="8156672"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156541">certPath</a></span><span class="op" id="8156680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156684"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156551">keyPath</a></span>&nbsp;<span class="op" id="8156692">=</span>&nbsp;<span class="ident" id="8156694"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8156702">(</span><span class="ident" id="8156703"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8154345">clientKeyPEM</a></span><span class="op" id="8156715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156719">defer</span>&nbsp;<span class="ident" id="8156725"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8156727">.</span><span class="ident" id="8156728"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8156734">(</span><span class="ident" id="8156735"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156551">keyPath</a></span><span class="op" id="8156742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156746"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156560">ecdsaCertPath</a></span>&nbsp;<span class="op" id="8156760">=</span>&nbsp;<span class="ident" id="8156762"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8156770">(</span><span class="ident" id="8156771"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8155253">clientECDSACertificatePEM</a></span><span class="op" id="8156796">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156800">defer</span>&nbsp;<span class="ident" id="8156806"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8156808">.</span><span class="ident" id="8156809"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8156815">(</span><span class="ident" id="8156816"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156560">ecdsaCertPath</a></span><span class="op" id="8156829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156833"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156575">ecdsaKeyPath</a></span>&nbsp;<span class="op" id="8156846">=</span>&nbsp;<span class="ident" id="8156848"><a href="/gostd/crypto/tls/handshake_test.go.html#8167413">tempFile</a></span><span class="op" id="8156856">(</span><span class="ident" id="8156857"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156040">clientECDSAKeyPEM</a></span><span class="op" id="8156874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8156878">defer</span>&nbsp;<span class="ident" id="8156884"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132635">os</a></span><span class="op" id="8156886">.</span><span class="ident" id="8156887"><a href="/gostd/os/file_unix.go.html#2459394">Remove</a></span><span class="op" id="8156893">(</span><span class="ident" id="8156894"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156575">ecdsaKeyPath</a></span><span class="op" id="8156906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8156909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156913">config</span>&nbsp;<span class="op" id="8156920">:=</span>&nbsp;<span class="op" id="8156923">*</span><span class="ident" id="8156924"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132921">testConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156936"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156913">config</a></span><span class="op" id="8156942">.</span><span class="ident" id="8156943"><a href="/gostd/crypto/tls/common.go.html#4452409">ClientAuth</a></span>&nbsp;<span class="op" id="8156954">=</span>&nbsp;<span class="ident" id="8156956"><a href="/gostd/crypto/tls/common.go.html#4447972">RequestClientCert</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156976">test</span>&nbsp;<span class="op" id="8156981">:=</span>&nbsp;<span class="op" id="8156984">&amp;</span><span class="ident" id="8156985"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8156995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8156999"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8157003">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8157008">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="8157037">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157041"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8157048">:</span>&nbsp;<span class="op" id="8157050">[</span><span class="op" id="8157051">]</span><span class="builtintype" id="8157052">string</span><span class="op" id="8157058">{</span><span class="string" id="8157059">&#34;openssl&#34;</span><span class="op" id="8157068">,</span>&nbsp;<span class="string" id="8157070">&#34;s_client&#34;</span><span class="op" id="8157080">,</span>&nbsp;<span class="string" id="8157082">&#34;-no_ticket&#34;</span><span class="op" id="8157094">,</span>&nbsp;<span class="string" id="8157096">&#34;-cipher&#34;</span><span class="op" id="8157105">,</span>&nbsp;<span class="string" id="8157107">&#34;RC4-SHA&#34;</span><span class="op" id="8157116">}</span><span class="op" id="8157117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157121"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8157127">:</span>&nbsp;&nbsp;<span class="op" id="8157130">&amp;</span><span class="ident" id="8157131"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156913">config</a></span><span class="op" id="8157137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157143"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8157161">(</span><span class="ident" id="8157162"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156520">t</a></span><span class="op" id="8157163">,</span>&nbsp;<span class="ident" id="8157165"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156976">test</a></span><span class="op" id="8157169">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157173"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156976">test</a></span>&nbsp;<span class="op" id="8157178">=</span>&nbsp;<span class="op" id="8157180">&amp;</span><span class="ident" id="8157181"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8157191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157195"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8157199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8157214">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="8157243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157247"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8157254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157266">[</span><span class="op" id="8157267">]</span><span class="builtintype" id="8157268">string</span><span class="op" id="8157274">{</span><span class="string" id="8157275">&#34;openssl&#34;</span><span class="op" id="8157284">,</span>&nbsp;<span class="string" id="8157286">&#34;s_client&#34;</span><span class="op" id="8157296">,</span>&nbsp;<span class="string" id="8157298">&#34;-no_ticket&#34;</span><span class="op" id="8157310">,</span>&nbsp;<span class="string" id="8157312">&#34;-cipher&#34;</span><span class="op" id="8157321">,</span>&nbsp;<span class="string" id="8157323">&#34;RC4-SHA&#34;</span><span class="op" id="8157332">,</span>&nbsp;<span class="string" id="8157334">&#34;-cert&#34;</span><span class="op" id="8157341">,</span>&nbsp;<span class="ident" id="8157343"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156541">certPath</a></span><span class="op" id="8157351">,</span>&nbsp;<span class="string" id="8157353">&#34;-key&#34;</span><span class="op" id="8157359">,</span>&nbsp;<span class="ident" id="8157361"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156551">keyPath</a></span><span class="op" id="8157368">}</span><span class="op" id="8157369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157373"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8157379">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157392">&amp;</span><span class="ident" id="8157393"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156913">config</a></span><span class="op" id="8157399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157403"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139432">expectedPeerCerts</a></span><span class="op" id="8157420">:</span>&nbsp;<span class="op" id="8157422">[</span><span class="op" id="8157423">]</span><span class="builtintype" id="8157424">string</span><span class="op" id="8157430">{</span><span class="ident" id="8157431"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8153583">clientCertificatePEM</a></span><span class="op" id="8157451">}</span><span class="op" id="8157452">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157458"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8157476">(</span><span class="ident" id="8157477"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156520">t</a></span><span class="op" id="8157478">,</span>&nbsp;<span class="ident" id="8157480"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156976">test</a></span><span class="op" id="8157484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157488"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156976">test</a></span>&nbsp;<span class="op" id="8157493">=</span>&nbsp;<span class="op" id="8157495">&amp;</span><span class="ident" id="8157496"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139057">serverTest</a></span><span class="op" id="8157506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157510"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139192">name</a></span><span class="op" id="8157514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8157529">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="8157563">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157567"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139316">command</a></span><span class="op" id="8157574">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157586">[</span><span class="op" id="8157587">]</span><span class="builtintype" id="8157588">string</span><span class="op" id="8157594">{</span><span class="string" id="8157595">&#34;openssl&#34;</span><span class="op" id="8157604">,</span>&nbsp;<span class="string" id="8157606">&#34;s_client&#34;</span><span class="op" id="8157616">,</span>&nbsp;<span class="string" id="8157618">&#34;-no_ticket&#34;</span><span class="op" id="8157630">,</span>&nbsp;<span class="string" id="8157632">&#34;-cipher&#34;</span><span class="op" id="8157641">,</span>&nbsp;<span class="string" id="8157643">&#34;RC4-SHA&#34;</span><span class="op" id="8157652">,</span>&nbsp;<span class="string" id="8157654">&#34;-cert&#34;</span><span class="op" id="8157661">,</span>&nbsp;<span class="ident" id="8157663"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156560">ecdsaCertPath</a></span><span class="op" id="8157676">,</span>&nbsp;<span class="string" id="8157678">&#34;-key&#34;</span><span class="op" id="8157684">,</span>&nbsp;<span class="ident" id="8157686"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156575">ecdsaKeyPath</a></span><span class="op" id="8157698">}</span><span class="op" id="8157699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157703"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139531">config</a></span><span class="op" id="8157709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157722">&amp;</span><span class="ident" id="8157723"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156913">config</a></span><span class="op" id="8157729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157733"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8139432">expectedPeerCerts</a></span><span class="op" id="8157750">:</span>&nbsp;<span class="op" id="8157752">[</span><span class="op" id="8157753">]</span><span class="builtintype" id="8157754">string</span><span class="op" id="8157760">{</span><span class="ident" id="8157761"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8155253">clientECDSACertificatePEM</a></span><span class="op" id="8157786">}</span><span class="op" id="8157787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8157790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157793"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8145564">runServerTestTLS12</a></span><span class="op" id="8157811">(</span><span class="ident" id="8157812"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156520">t</a></span><span class="op" id="8157813">,</span>&nbsp;<span class="ident" id="8157815"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8156976">test</a></span><span class="op" id="8157819">)</span><br>
<span class="lineno">830</span><span class="op" id="8157821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8157824">func</span>&nbsp;<span class="ident" id="8157829">bigFromString</span><span class="op" id="8157842">(</span><span class="ident" id="8157843">s</span>&nbsp;<span class="builtintype" id="8157845">string</span><span class="op" id="8157851">)</span>&nbsp;<span class="op" id="8157853">*</span><span class="ident" id="8157854"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132616">big</a></span><span class="op" id="8157857">.</span><span class="ident" id="8157858"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span>&nbsp;<span class="op" id="8157862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157865">ret</span>&nbsp;<span class="op" id="8157869">:=</span>&nbsp;<span class="builtinfunc" id="8157872">new</span><span class="op" id="8157875">(</span><span class="ident" id="8157876"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132616">big</a></span><span class="op" id="8157879">.</span><span class="ident" id="8157880"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="8157883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157886"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157865">ret</a></span><span class="op" id="8157889">.</span><span class="ident" id="8157890"><a href="/gostd/math/big/int.go.html#2049625">SetString</a></span><span class="op" id="8157899">(</span><span class="ident" id="8157900"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157843">s</a></span><span class="op" id="8157901">,</span>&nbsp;<span class="num" id="8157903">10</span><span class="op" id="8157905">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157908">return</span>&nbsp;<span class="ident" id="8157915"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157865">ret</a></span><br>
<span class="lineno"></span><span class="op" id="8157919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8157922">func</span>&nbsp;<span class="ident" id="8157927">fromHex</span><span class="op" id="8157934">(</span><span class="ident" id="8157935">s</span>&nbsp;<span class="builtintype" id="8157937">string</span><span class="op" id="8157943">)</span>&nbsp;<span class="op" id="8157945">[</span><span class="op" id="8157946">]</span><span class="builtintype" id="8157947">byte</span>&nbsp;<span class="op" id="8157952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8157955">b</span><span class="op" id="8157956">,</span>&nbsp;<span class="ident" id="8157958">_</span>&nbsp;<span class="op" id="8157960">:=</span>&nbsp;<span class="ident" id="8157963"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132561">hex</a></span><span class="op" id="8157966">.</span><span class="ident" id="8157967"><a href="/gostd/encoding/hex/hex.go.html#4721563">DecodeString</a></span><span class="op" id="8157979">(</span><span class="ident" id="8157980"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157935">s</a></span><span class="op" id="8157981">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8157984">return</span>&nbsp;<span class="ident" id="8157991"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157955">b</a></span><br>
<span class="lineno"></span><span class="op" id="8157993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8157996">var</span>&nbsp;<span class="ident" id="8158000">testRSACertificate</span>&nbsp;<span class="op" id="8158019">=</span>&nbsp;<span class="ident" id="8158021"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157927">fromHex</a></span><span class="op" id="8158028">(</span><span class="string" id="8158029">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="8159415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="8159418">var</span>&nbsp;<span class="ident" id="8159422">testECDSACertificate</span>&nbsp;<span class="op" id="8159443">=</span>&nbsp;<span class="ident" id="8159445"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157927">fromHex</a></span><span class="op" id="8159452">(</span><span class="string" id="8159453">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="8160487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8160490">var</span>&nbsp;<span class="ident" id="8160494">testSNICertificate</span>&nbsp;<span class="op" id="8160513">=</span>&nbsp;<span class="ident" id="8160515"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157927">fromHex</a></span><span class="op" id="8160522">(</span><span class="string" id="8160523">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="8161529">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8161532">var</span>&nbsp;<span class="ident" id="8161536">testRSAPrivateKey</span>&nbsp;<span class="op" id="8161554">=</span>&nbsp;<span class="op" id="8161556">&amp;</span><span class="ident" id="8161557"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132547">rsa</a></span><span class="op" id="8161560">.</span><span class="ident" id="8161561"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="8161571">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161574"><a href="/gostd/crypto/rsa/rsa.go.html#4743795">PublicKey</a></span><span class="op" id="8161583">:</span>&nbsp;<span class="ident" id="8161585"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132547">rsa</a></span><span class="op" id="8161588">.</span><span class="ident" id="8161589"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="8161598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161602"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="8161603">:</span>&nbsp;<span class="ident" id="8161605"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8161618">(</span><span class="string" id="8161619">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="8161930">)</span><span class="op" id="8161931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161935"><a href="/gostd/crypto/rsa/rsa.go.html#4742986">E</a></span><span class="op" id="8161936">:</span>&nbsp;<span class="num" id="8161938">65537</span><span class="op" id="8161943">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8161946">}</span><span class="op" id="8161947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8161950"><a href="/gostd/crypto/rsa/rsa.go.html#4743833">D</a></span><span class="op" id="8161951">:</span>&nbsp;<span class="ident" id="8161953"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8161966">(</span><span class="string" id="8161967">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="8162277">)</span><span class="op" id="8162278">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162281"><a href="/gostd/crypto/rsa/rsa.go.html#4743875">Primes</a></span><span class="op" id="8162287">:</span>&nbsp;<span class="op" id="8162289">[</span><span class="op" id="8162290">]</span><span class="op" id="8162291">*</span><span class="ident" id="8162292"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132616">big</a></span><span class="op" id="8162295">.</span><span class="ident" id="8162296"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="8162299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162303"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8162316">(</span><span class="string" id="8162317">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="8162474">)</span><span class="op" id="8162475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162479"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8162492">(</span><span class="string" id="8162493">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="8162650">)</span><span class="op" id="8162651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8162654">}</span><span class="op" id="8162655">,</span><br>
<span class="lineno"></span><span class="op" id="8162657">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="8162660">var</span>&nbsp;<span class="ident" id="8162664">testECDSAPrivateKey</span>&nbsp;<span class="op" id="8162684">=</span>&nbsp;<span class="op" id="8162686">&amp;</span><span class="ident" id="8162687"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132512">ecdsa</a></span><span class="op" id="8162692">.</span><span class="ident" id="8162693"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="8162703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162706"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005534">PublicKey</a></span><span class="op" id="8162715">:</span>&nbsp;<span class="ident" id="8162717"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132512">ecdsa</a></span><span class="op" id="8162722">.</span><span class="ident" id="8162723"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="8162732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162736"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005429">Curve</a></span><span class="op" id="8162741">:</span>&nbsp;<span class="ident" id="8162743"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8132528">elliptic</a></span><span class="op" id="8162751">.</span><span class="ident" id="8162752"><a href="/gostd/crypto/elliptic/elliptic.go.html#3026093">P521</a></span><span class="op" id="8162756">(</span><span class="op" id="8162757">)</span><span class="op" id="8162758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162762"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005445">X</a></span><span class="op" id="8162763">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162769"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8162782">(</span><span class="string" id="8162783">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="8162942">)</span><span class="op" id="8162943">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162947"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005448">Y</a></span><span class="op" id="8162948">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8162954"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8162967">(</span><span class="string" id="8162968">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="8163127">)</span><span class="op" id="8163128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8163131">}</span><span class="op" id="8163132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8163135"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005545">D</a></span><span class="op" id="8163136">:</span>&nbsp;<span class="ident" id="8163138"><a href="/gostd/crypto/tls/handshake_server_test.go.html#8157829">bigFromString</a></span><span class="op" id="8163151">(</span><span class="string" id="8163152">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="8163311">)</span><span class="op" id="8163312">,</span><br>
<span class="lineno"></span><span class="op" id="8163314">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
