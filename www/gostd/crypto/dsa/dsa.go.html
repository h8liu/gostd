<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4211521">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4211576">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4211630">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4211681">//&nbsp;Package&nbsp;dsa&nbsp;implements&nbsp;the&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4211766">package</span>&nbsp;<span class="ident" id="4211774">dsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4211779">import</span>&nbsp;<span class="op" id="4211786">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4211789">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4211799">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4211805">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4211816">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4211819">//&nbsp;Parameters&nbsp;represents&nbsp;the&nbsp;domain&nbsp;parameters&nbsp;for&nbsp;a&nbsp;key.&nbsp;These&nbsp;parameters&nbsp;can</span><br>
<span class="lineno">15</span><span class="comment" id="4211898">//&nbsp;be&nbsp;shared&nbsp;across&nbsp;many&nbsp;keys.&nbsp;The&nbsp;bit&nbsp;length&nbsp;of&nbsp;Q&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="4211974">type</span>&nbsp;<span class="ident" id="4211979">Parameters</span>&nbsp;<span class="keyword" id="4211990">struct</span>&nbsp;<span class="op" id="4211997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212000">P</span><span class="op" id="4212001">,</span>&nbsp;<span class="ident" id="4212003">Q</span><span class="op" id="4212004">,</span>&nbsp;<span class="ident" id="4212006">G</span>&nbsp;<span class="op" id="4212008">*</span><span class="ident" id="4212009">big</span><span class="op" id="4212012">.</span><span class="ident" id="4212013">Int</span><br>
<span class="lineno"></span><span class="op" id="4212017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4212020">//&nbsp;PublicKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4212062">type</span>&nbsp;<span class="ident" id="4212067">PublicKey</span>&nbsp;<span class="keyword" id="4212077">struct</span>&nbsp;<span class="op" id="4212084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212087">Parameters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212099">Y</span>&nbsp;<span class="op" id="4212101">*</span><span class="ident" id="4212102">big</span><span class="op" id="4212105">.</span><span class="ident" id="4212106">Int</span><br>
<span class="lineno"></span><span class="op" id="4212110">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4212113">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;DSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4212157">type</span>&nbsp;<span class="ident" id="4212162">PrivateKey</span>&nbsp;<span class="keyword" id="4212173">struct</span>&nbsp;<span class="op" id="4212180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212183">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212194">X</span>&nbsp;<span class="op" id="4212196">*</span><span class="ident" id="4212197">big</span><span class="op" id="4212200">.</span><span class="ident" id="4212201">Int</span><br>
<span class="lineno">30</span><span class="op" id="4212205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4212208">//&nbsp;ErrInvalidPublicKey&nbsp;results&nbsp;when&nbsp;a&nbsp;public&nbsp;key&nbsp;is&nbsp;not&nbsp;usable&nbsp;by&nbsp;this&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4212285">//&nbsp;FIPS&nbsp;is&nbsp;quite&nbsp;strict&nbsp;about&nbsp;the&nbsp;format&nbsp;of&nbsp;DSA&nbsp;keys,&nbsp;but&nbsp;other&nbsp;code&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4212361">//&nbsp;less&nbsp;so.&nbsp;Thus,&nbsp;when&nbsp;using&nbsp;keys&nbsp;which&nbsp;may&nbsp;have&nbsp;been&nbsp;generated&nbsp;by&nbsp;other&nbsp;code,</span><br>
<span class="lineno">35</span><span class="comment" id="4212440">//&nbsp;this&nbsp;error&nbsp;must&nbsp;be&nbsp;handled.</span><br>
<span class="lineno"></span><span class="keyword" id="4212471">var</span>&nbsp;<span class="ident" id="4212475">ErrInvalidPublicKey</span>&nbsp;<span class="op" id="4212495">=</span>&nbsp;<span class="ident" id="4212497">errors</span><span class="op" id="4212503">.</span><span class="ident" id="4212504">New</span><span class="op" id="4212507">(</span><span class="string" id="4212508">&#34;crypto/dsa:&nbsp;invalid&nbsp;public&nbsp;key&#34;</span><span class="op" id="4212540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4212543">//&nbsp;ParameterSizes&nbsp;is&nbsp;a&nbsp;enumeration&nbsp;of&nbsp;the&nbsp;acceptable&nbsp;bit&nbsp;lengths&nbsp;of&nbsp;the&nbsp;primes</span><br>
<span class="lineno"></span><span class="comment" id="4212622">//&nbsp;in&nbsp;a&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters.&nbsp;See&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.2.</span><br>
<span class="lineno">40</span><span class="keyword" id="4212682">type</span>&nbsp;<span class="ident" id="4212687">ParameterSizes</span>&nbsp;<span class="builtintype" id="4212702">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4212707">const</span>&nbsp;<span class="op" id="4212713">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212716">L1024N160</span>&nbsp;<span class="ident" id="4212726">ParameterSizes</span>&nbsp;<span class="op" id="4212741">=</span>&nbsp;<span class="ident" id="4212743">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212749">L2048N224</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212760">L2048N256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4212771">L3072N256</span><br>
<span class="lineno"></span><span class="op" id="4212781">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4212784">//&nbsp;numMRTests&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;Miller-Rabin&nbsp;primality&nbsp;tests&nbsp;that&nbsp;we&nbsp;perform.&nbsp;We</span><br>
<span class="lineno">50</span><span class="comment" id="4212864">//&nbsp;pick&nbsp;the&nbsp;largest&nbsp;recommended&nbsp;number&nbsp;from&nbsp;table&nbsp;C.1&nbsp;of&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4212933">const</span>&nbsp;<span class="ident" id="4212939">numMRTests</span>&nbsp;<span class="op" id="4212950">=</span>&nbsp;<span class="num" id="4212952">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4212956">//&nbsp;GenerateParameters&nbsp;puts&nbsp;a&nbsp;random,&nbsp;valid&nbsp;set&nbsp;of&nbsp;DSA&nbsp;parameters&nbsp;into&nbsp;params.</span><br>
<span class="lineno"></span><span class="comment" id="4213034">//&nbsp;This&nbsp;function&nbsp;takes&nbsp;many&nbsp;seconds,&nbsp;even&nbsp;on&nbsp;fast&nbsp;machines.</span><br>
<span class="lineno">55</span><span class="keyword" id="4213094">func</span>&nbsp;<span class="ident" id="4213099">GenerateParameters</span><span class="op" id="4213117">(</span><span class="ident" id="4213118">params</span>&nbsp;<span class="op" id="4213125">*</span><span class="ident" id="4213126">Parameters</span><span class="op" id="4213136">,</span>&nbsp;<span class="ident" id="4213138">rand</span>&nbsp;<span class="ident" id="4213143">io</span><span class="op" id="4213145">.</span><span class="ident" id="4213146">Reader</span><span class="op" id="4213152">,</span>&nbsp;<span class="ident" id="4213154">sizes</span>&nbsp;<span class="ident" id="4213160">ParameterSizes</span><span class="op" id="4213174">)</span>&nbsp;<span class="op" id="4213176">(</span><span class="ident" id="4213177">err</span>&nbsp;<span class="builtintype" id="4213181">error</span><span class="op" id="4213186">)</span>&nbsp;<span class="op" id="4213188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4213191">//&nbsp;This&nbsp;function&nbsp;doesn&#39;t&nbsp;follow&nbsp;FIPS&nbsp;186-3&nbsp;exactly&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4213262">//&nbsp;use&nbsp;a&nbsp;verification&nbsp;seed&nbsp;to&nbsp;generate&nbsp;the&nbsp;primes.&nbsp;The&nbsp;verification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4213331">//&nbsp;seed&nbsp;doesn&#39;t&nbsp;appear&nbsp;to&nbsp;be&nbsp;exported&nbsp;or&nbsp;used&nbsp;by&nbsp;other&nbsp;code&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4213396">//&nbsp;omitting&nbsp;it&nbsp;makes&nbsp;the&nbsp;code&nbsp;cleaner.</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213437">var</span>&nbsp;<span class="ident" id="4213441">L</span><span class="op" id="4213442">,</span>&nbsp;<span class="ident" id="4213444">N</span>&nbsp;<span class="builtintype" id="4213446">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213451">switch</span>&nbsp;<span class="ident" id="4213458">sizes</span>&nbsp;<span class="op" id="4213464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213467">case</span>&nbsp;<span class="ident" id="4213472">L1024N160</span><span class="op" id="4213481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213485">L</span>&nbsp;<span class="op" id="4213487">=</span>&nbsp;<span class="num" id="4213489">1024</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213496">N</span>&nbsp;<span class="op" id="4213498">=</span>&nbsp;<span class="num" id="4213500">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213505">case</span>&nbsp;<span class="ident" id="4213510">L2048N224</span><span class="op" id="4213519">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213523">L</span>&nbsp;<span class="op" id="4213525">=</span>&nbsp;<span class="num" id="4213527">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213534">N</span>&nbsp;<span class="op" id="4213536">=</span>&nbsp;<span class="num" id="4213538">224</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213543">case</span>&nbsp;<span class="ident" id="4213548">L2048N256</span><span class="op" id="4213557">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213561">L</span>&nbsp;<span class="op" id="4213563">=</span>&nbsp;<span class="num" id="4213565">2048</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213572">N</span>&nbsp;<span class="op" id="4213574">=</span>&nbsp;<span class="num" id="4213576">256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213581">case</span>&nbsp;<span class="ident" id="4213586">L3072N256</span><span class="op" id="4213595">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213599">L</span>&nbsp;<span class="op" id="4213601">=</span>&nbsp;<span class="num" id="4213603">3072</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213610">N</span>&nbsp;<span class="op" id="4213612">=</span>&nbsp;<span class="num" id="4213614">256</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213619">default</span><span class="op" id="4213626">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213630">return</span>&nbsp;<span class="ident" id="4213637">errors</span><span class="op" id="4213643">.</span><span class="ident" id="4213644">New</span><span class="op" id="4213647">(</span><span class="string" id="4213648">&#34;crypto/dsa:&nbsp;invalid&nbsp;ParameterSizes&#34;</span><span class="op" id="4213684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213691">qBytes</span>&nbsp;<span class="op" id="4213698">:=</span>&nbsp;<span class="builtinfunc" id="4213701">make</span><span class="op" id="4213705">(</span><span class="op" id="4213706">[</span><span class="op" id="4213707">]</span><span class="builtintype" id="4213708">byte</span><span class="op" id="4213712">,</span>&nbsp;<span class="ident" id="4213714">N</span><span class="op" id="4213715">/</span><span class="num" id="4213716">8</span><span class="op" id="4213717">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213720">pBytes</span>&nbsp;<span class="op" id="4213727">:=</span>&nbsp;<span class="builtinfunc" id="4213730">make</span><span class="op" id="4213734">(</span><span class="op" id="4213735">[</span><span class="op" id="4213736">]</span><span class="builtintype" id="4213737">byte</span><span class="op" id="4213741">,</span>&nbsp;<span class="ident" id="4213743">L</span><span class="op" id="4213744">/</span><span class="num" id="4213745">8</span><span class="op" id="4213746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213750">q</span>&nbsp;<span class="op" id="4213752">:=</span>&nbsp;<span class="builtinfunc" id="4213755">new</span><span class="op" id="4213758">(</span><span class="ident" id="4213759">big</span><span class="op" id="4213762">.</span><span class="ident" id="4213763">Int</span><span class="op" id="4213766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213769">p</span>&nbsp;<span class="op" id="4213771">:=</span>&nbsp;<span class="builtinfunc" id="4213774">new</span><span class="op" id="4213777">(</span><span class="ident" id="4213778">big</span><span class="op" id="4213781">.</span><span class="ident" id="4213782">Int</span><span class="op" id="4213785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213788">rem</span>&nbsp;<span class="op" id="4213792">:=</span>&nbsp;<span class="builtinfunc" id="4213795">new</span><span class="op" id="4213798">(</span><span class="ident" id="4213799">big</span><span class="op" id="4213802">.</span><span class="ident" id="4213803">Int</span><span class="op" id="4213806">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213809">one</span>&nbsp;<span class="op" id="4213813">:=</span>&nbsp;<span class="builtinfunc" id="4213816">new</span><span class="op" id="4213819">(</span><span class="ident" id="4213820">big</span><span class="op" id="4213823">.</span><span class="ident" id="4213824">Int</span><span class="op" id="4213827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213830">one</span><span class="op" id="4213833">.</span><span class="ident" id="4213834">SetInt64</span><span class="op" id="4213842">(</span><span class="num" id="4213843">1</span><span class="op" id="4213844">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4213847">GeneratePrimes</span><span class="op" id="4213861">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213864">for</span>&nbsp;<span class="op" id="4213868">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213872">_</span><span class="op" id="4213873">,</span>&nbsp;<span class="ident" id="4213875">err</span>&nbsp;<span class="op" id="4213879">=</span>&nbsp;<span class="ident" id="4213881">io</span><span class="op" id="4213883">.</span><span class="ident" id="4213884">ReadFull</span><span class="op" id="4213892">(</span><span class="ident" id="4213893">rand</span><span class="op" id="4213897">,</span>&nbsp;<span class="ident" id="4213899">qBytes</span><span class="op" id="4213905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213909">if</span>&nbsp;<span class="ident" id="4213912">err</span>&nbsp;<span class="op" id="4213916">!=</span>&nbsp;<span class="ident" id="4213919">nil</span>&nbsp;<span class="op" id="4213923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4213928">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4213937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213942">qBytes</span><span class="op" id="4213948">[</span><span class="builtinfunc" id="4213949">len</span><span class="op" id="4213952">(</span><span class="ident" id="4213953">qBytes</span><span class="op" id="4213959">)</span><span class="op" id="4213960">-</span><span class="num" id="4213961">1</span><span class="op" id="4213962">]</span>&nbsp;<span class="op" id="4213964">|=</span>&nbsp;<span class="num" id="4213967">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213971">qBytes</span><span class="op" id="4213977">[</span><span class="num" id="4213978">0</span><span class="op" id="4213979">]</span>&nbsp;<span class="op" id="4213981">|=</span>&nbsp;<span class="num" id="4213984">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4213991">q</span><span class="op" id="4213992">.</span><span class="ident" id="4213993">SetBytes</span><span class="op" id="4214001">(</span><span class="ident" id="4214002">qBytes</span><span class="op" id="4214008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214013">if</span>&nbsp;<span class="op" id="4214016">!</span><span class="ident" id="4214017">q</span><span class="op" id="4214018">.</span><span class="ident" id="4214019">ProbablyPrime</span><span class="op" id="4214032">(</span><span class="ident" id="4214033">numMRTests</span><span class="op" id="4214043">)</span>&nbsp;<span class="op" id="4214045">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214050">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214066">for</span>&nbsp;<span class="ident" id="4214070">i</span>&nbsp;<span class="op" id="4214072">:=</span>&nbsp;<span class="num" id="4214075">0</span><span class="op" id="4214076">;</span>&nbsp;<span class="ident" id="4214078">i</span>&nbsp;<span class="op" id="4214080">&lt;</span>&nbsp;<span class="num" id="4214082">4</span><span class="op" id="4214083">*</span><span class="ident" id="4214084">L</span><span class="op" id="4214085">;</span>&nbsp;<span class="ident" id="4214087">i</span><span class="op" id="4214088">++</span>&nbsp;<span class="op" id="4214091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214096">_</span><span class="op" id="4214097">,</span>&nbsp;<span class="ident" id="4214099">err</span>&nbsp;<span class="op" id="4214103">=</span>&nbsp;<span class="ident" id="4214105">io</span><span class="op" id="4214107">.</span><span class="ident" id="4214108">ReadFull</span><span class="op" id="4214116">(</span><span class="ident" id="4214117">rand</span><span class="op" id="4214121">,</span>&nbsp;<span class="ident" id="4214123">pBytes</span><span class="op" id="4214129">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214134">if</span>&nbsp;<span class="ident" id="4214137">err</span>&nbsp;<span class="op" id="4214141">!=</span>&nbsp;<span class="ident" id="4214144">nil</span>&nbsp;<span class="op" id="4214148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214170">pBytes</span><span class="op" id="4214176">[</span><span class="builtinfunc" id="4214177">len</span><span class="op" id="4214180">(</span><span class="ident" id="4214181">pBytes</span><span class="op" id="4214187">)</span><span class="op" id="4214188">-</span><span class="num" id="4214189">1</span><span class="op" id="4214190">]</span>&nbsp;<span class="op" id="4214192">|=</span>&nbsp;<span class="num" id="4214195">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214200">pBytes</span><span class="op" id="4214206">[</span><span class="num" id="4214207">0</span><span class="op" id="4214208">]</span>&nbsp;<span class="op" id="4214210">|=</span>&nbsp;<span class="num" id="4214213">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214222">p</span><span class="op" id="4214223">.</span><span class="ident" id="4214224">SetBytes</span><span class="op" id="4214232">(</span><span class="ident" id="4214233">pBytes</span><span class="op" id="4214239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214244">rem</span><span class="op" id="4214247">.</span><span class="ident" id="4214248">Mod</span><span class="op" id="4214251">(</span><span class="ident" id="4214252">p</span><span class="op" id="4214253">,</span>&nbsp;<span class="ident" id="4214255">q</span><span class="op" id="4214256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214261">rem</span><span class="op" id="4214264">.</span><span class="ident" id="4214265">Sub</span><span class="op" id="4214268">(</span><span class="ident" id="4214269">rem</span><span class="op" id="4214272">,</span>&nbsp;<span class="ident" id="4214274">one</span><span class="op" id="4214277">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214282">p</span><span class="op" id="4214283">.</span><span class="ident" id="4214284">Sub</span><span class="op" id="4214287">(</span><span class="ident" id="4214288">p</span><span class="op" id="4214289">,</span>&nbsp;<span class="ident" id="4214291">rem</span><span class="op" id="4214294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214299">if</span>&nbsp;<span class="ident" id="4214302">p</span><span class="op" id="4214303">.</span><span class="ident" id="4214304">BitLen</span><span class="op" id="4214310">(</span><span class="op" id="4214311">)</span>&nbsp;<span class="op" id="4214313">&lt;</span>&nbsp;<span class="ident" id="4214315">L</span>&nbsp;<span class="op" id="4214317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214323">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214341">if</span>&nbsp;<span class="op" id="4214344">!</span><span class="ident" id="4214345">p</span><span class="op" id="4214346">.</span><span class="ident" id="4214347">ProbablyPrime</span><span class="op" id="4214360">(</span><span class="ident" id="4214361">numMRTests</span><span class="op" id="4214371">)</span>&nbsp;<span class="op" id="4214373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214379">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214397">params</span><span class="op" id="4214403">.</span><span class="ident" id="4214404">P</span>&nbsp;<span class="op" id="4214406">=</span>&nbsp;<span class="ident" id="4214408">p</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214413">params</span><span class="op" id="4214419">.</span><span class="ident" id="4214420">Q</span>&nbsp;<span class="op" id="4214422">=</span>&nbsp;<span class="ident" id="4214424">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214429">break</span>&nbsp;<span class="ident" id="4214435">GeneratePrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214459">h</span>&nbsp;<span class="op" id="4214461">:=</span>&nbsp;<span class="builtinfunc" id="4214464">new</span><span class="op" id="4214467">(</span><span class="ident" id="4214468">big</span><span class="op" id="4214471">.</span><span class="ident" id="4214472">Int</span><span class="op" id="4214475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214478">h</span><span class="op" id="4214479">.</span><span class="ident" id="4214480">SetInt64</span><span class="op" id="4214488">(</span><span class="num" id="4214489">2</span><span class="op" id="4214490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214493">g</span>&nbsp;<span class="op" id="4214495">:=</span>&nbsp;<span class="builtinfunc" id="4214498">new</span><span class="op" id="4214501">(</span><span class="ident" id="4214502">big</span><span class="op" id="4214505">.</span><span class="ident" id="4214506">Int</span><span class="op" id="4214509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214513">pm1</span>&nbsp;<span class="op" id="4214517">:=</span>&nbsp;<span class="builtinfunc" id="4214520">new</span><span class="op" id="4214523">(</span><span class="ident" id="4214524">big</span><span class="op" id="4214527">.</span><span class="ident" id="4214528">Int</span><span class="op" id="4214531">)</span><span class="op" id="4214532">.</span><span class="ident" id="4214533">Sub</span><span class="op" id="4214536">(</span><span class="ident" id="4214537">p</span><span class="op" id="4214538">,</span>&nbsp;<span class="ident" id="4214540">one</span><span class="op" id="4214543">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214546">e</span>&nbsp;<span class="op" id="4214548">:=</span>&nbsp;<span class="builtinfunc" id="4214551">new</span><span class="op" id="4214554">(</span><span class="ident" id="4214555">big</span><span class="op" id="4214558">.</span><span class="ident" id="4214559">Int</span><span class="op" id="4214562">)</span><span class="op" id="4214563">.</span><span class="ident" id="4214564">Div</span><span class="op" id="4214567">(</span><span class="ident" id="4214568">pm1</span><span class="op" id="4214571">,</span>&nbsp;<span class="ident" id="4214573">q</span><span class="op" id="4214574">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214578">for</span>&nbsp;<span class="op" id="4214582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214586">g</span><span class="op" id="4214587">.</span><span class="ident" id="4214588">Exp</span><span class="op" id="4214591">(</span><span class="ident" id="4214592">h</span><span class="op" id="4214593">,</span>&nbsp;<span class="ident" id="4214595">e</span><span class="op" id="4214596">,</span>&nbsp;<span class="ident" id="4214598">p</span><span class="op" id="4214599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214603">if</span>&nbsp;<span class="ident" id="4214606">g</span><span class="op" id="4214607">.</span><span class="ident" id="4214608">Cmp</span><span class="op" id="4214611">(</span><span class="ident" id="4214612">one</span><span class="op" id="4214615">)</span>&nbsp;<span class="op" id="4214617">==</span>&nbsp;<span class="num" id="4214620">0</span>&nbsp;<span class="op" id="4214622">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214627">h</span><span class="op" id="4214628">.</span><span class="ident" id="4214629">Add</span><span class="op" id="4214632">(</span><span class="ident" id="4214633">h</span><span class="op" id="4214634">,</span>&nbsp;<span class="ident" id="4214636">one</span><span class="op" id="4214639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214644">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4214660">params</span><span class="op" id="4214666">.</span><span class="ident" id="4214667">G</span>&nbsp;<span class="op" id="4214669">=</span>&nbsp;<span class="ident" id="4214671">g</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214675">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4214683">}</span><br>
<span class="lineno"></span><span class="op" id="4214685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4214688">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&amp;private&nbsp;key&nbsp;pair.&nbsp;The&nbsp;Parameters&nbsp;of&nbsp;the</span><br>
<span class="lineno">150</span><span class="comment" id="4214762">//&nbsp;PrivateKey&nbsp;must&nbsp;already&nbsp;be&nbsp;valid&nbsp;(see&nbsp;GenerateParameters).</span><br>
<span class="lineno"></span><span class="keyword" id="4214824">func</span>&nbsp;<span class="ident" id="4214829">GenerateKey</span><span class="op" id="4214840">(</span><span class="ident" id="4214841">priv</span>&nbsp;<span class="op" id="4214846">*</span><span class="ident" id="4214847">PrivateKey</span><span class="op" id="4214857">,</span>&nbsp;<span class="ident" id="4214859">rand</span>&nbsp;<span class="ident" id="4214864">io</span><span class="op" id="4214866">.</span><span class="ident" id="4214867">Reader</span><span class="op" id="4214873">)</span>&nbsp;<span class="builtintype" id="4214875">error</span>&nbsp;<span class="op" id="4214881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214884">if</span>&nbsp;<span class="ident" id="4214887">priv</span><span class="op" id="4214891">.</span><span class="ident" id="4214892">P</span>&nbsp;<span class="op" id="4214894">==</span>&nbsp;<span class="ident" id="4214897">nil</span>&nbsp;<span class="op" id="4214901">||</span>&nbsp;<span class="ident" id="4214904">priv</span><span class="op" id="4214908">.</span><span class="ident" id="4214909">Q</span>&nbsp;<span class="op" id="4214911">==</span>&nbsp;<span class="ident" id="4214914">nil</span>&nbsp;<span class="op" id="4214918">||</span>&nbsp;<span class="ident" id="4214921">priv</span><span class="op" id="4214925">.</span><span class="ident" id="4214926">G</span>&nbsp;<span class="op" id="4214928">==</span>&nbsp;<span class="ident" id="4214931">nil</span>&nbsp;<span class="op" id="4214935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4214939">return</span>&nbsp;<span class="ident" id="4214946">errors</span><span class="op" id="4214952">.</span><span class="ident" id="4214953">New</span><span class="op" id="4214956">(</span><span class="string" id="4214957">&#34;crypto/dsa:&nbsp;parameters&nbsp;not&nbsp;set&nbsp;up&nbsp;before&nbsp;generating&nbsp;key&#34;</span><span class="op" id="4215014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215017">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215021">x</span>&nbsp;<span class="op" id="4215023">:=</span>&nbsp;<span class="builtinfunc" id="4215026">new</span><span class="op" id="4215029">(</span><span class="ident" id="4215030">big</span><span class="op" id="4215033">.</span><span class="ident" id="4215034">Int</span><span class="op" id="4215037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215040">xBytes</span>&nbsp;<span class="op" id="4215047">:=</span>&nbsp;<span class="builtinfunc" id="4215050">make</span><span class="op" id="4215054">(</span><span class="op" id="4215055">[</span><span class="op" id="4215056">]</span><span class="builtintype" id="4215057">byte</span><span class="op" id="4215061">,</span>&nbsp;<span class="ident" id="4215063">priv</span><span class="op" id="4215067">.</span><span class="ident" id="4215068">Q</span><span class="op" id="4215069">.</span><span class="ident" id="4215070">BitLen</span><span class="op" id="4215076">(</span><span class="op" id="4215077">)</span><span class="op" id="4215078">/</span><span class="num" id="4215079">8</span><span class="op" id="4215080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215084">for</span>&nbsp;<span class="op" id="4215088">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215092">_</span><span class="op" id="4215093">,</span>&nbsp;<span class="ident" id="4215095">err</span>&nbsp;<span class="op" id="4215099">:=</span>&nbsp;<span class="ident" id="4215102">io</span><span class="op" id="4215104">.</span><span class="ident" id="4215105">ReadFull</span><span class="op" id="4215113">(</span><span class="ident" id="4215114">rand</span><span class="op" id="4215118">,</span>&nbsp;<span class="ident" id="4215120">xBytes</span><span class="op" id="4215126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215130">if</span>&nbsp;<span class="ident" id="4215133">err</span>&nbsp;<span class="op" id="4215137">!=</span>&nbsp;<span class="ident" id="4215140">nil</span>&nbsp;<span class="op" id="4215144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215149">return</span>&nbsp;<span class="ident" id="4215156">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215166">x</span><span class="op" id="4215167">.</span><span class="ident" id="4215168">SetBytes</span><span class="op" id="4215176">(</span><span class="ident" id="4215177">xBytes</span><span class="op" id="4215183">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215187">if</span>&nbsp;<span class="ident" id="4215190">x</span><span class="op" id="4215191">.</span><span class="ident" id="4215192">Sign</span><span class="op" id="4215196">(</span><span class="op" id="4215197">)</span>&nbsp;<span class="op" id="4215199">!=</span>&nbsp;<span class="num" id="4215202">0</span>&nbsp;<span class="op" id="4215204">&amp;&amp;</span>&nbsp;<span class="ident" id="4215207">x</span><span class="op" id="4215208">.</span><span class="ident" id="4215209">Cmp</span><span class="op" id="4215212">(</span><span class="ident" id="4215213">priv</span><span class="op" id="4215217">.</span><span class="ident" id="4215218">Q</span><span class="op" id="4215219">)</span>&nbsp;<span class="op" id="4215221">&lt;</span>&nbsp;<span class="num" id="4215223">0</span>&nbsp;<span class="op" id="4215225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215230">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4215241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215245">priv</span><span class="op" id="4215249">.</span><span class="ident" id="4215250">X</span>&nbsp;<span class="op" id="4215252">=</span>&nbsp;<span class="ident" id="4215254">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215257">priv</span><span class="op" id="4215261">.</span><span class="ident" id="4215262">Y</span>&nbsp;<span class="op" id="4215264">=</span>&nbsp;<span class="builtinfunc" id="4215266">new</span><span class="op" id="4215269">(</span><span class="ident" id="4215270">big</span><span class="op" id="4215273">.</span><span class="ident" id="4215274">Int</span><span class="op" id="4215277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215280">priv</span><span class="op" id="4215284">.</span><span class="ident" id="4215285">Y</span><span class="op" id="4215286">.</span><span class="ident" id="4215287">Exp</span><span class="op" id="4215290">(</span><span class="ident" id="4215291">priv</span><span class="op" id="4215295">.</span><span class="ident" id="4215296">G</span><span class="op" id="4215297">,</span>&nbsp;<span class="ident" id="4215299">x</span><span class="op" id="4215300">,</span>&nbsp;<span class="ident" id="4215302">priv</span><span class="op" id="4215306">.</span><span class="ident" id="4215307">P</span><span class="op" id="4215308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215311">return</span>&nbsp;<span class="ident" id="4215318">nil</span><br>
<span class="lineno"></span><span class="op" id="4215322">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4215325">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4215402">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4215480">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4215551">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">180</span><span class="keyword" id="4215589">func</span>&nbsp;<span class="ident" id="4215594">fermatInverse</span><span class="op" id="4215607">(</span><span class="ident" id="4215608">k</span><span class="op" id="4215609">,</span>&nbsp;<span class="ident" id="4215611">P</span>&nbsp;<span class="op" id="4215613">*</span><span class="ident" id="4215614">big</span><span class="op" id="4215617">.</span><span class="ident" id="4215618">Int</span><span class="op" id="4215621">)</span>&nbsp;<span class="op" id="4215623">*</span><span class="ident" id="4215624">big</span><span class="op" id="4215627">.</span><span class="ident" id="4215628">Int</span>&nbsp;<span class="op" id="4215632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215635">two</span>&nbsp;<span class="op" id="4215639">:=</span>&nbsp;<span class="ident" id="4215642">big</span><span class="op" id="4215645">.</span><span class="ident" id="4215646">NewInt</span><span class="op" id="4215652">(</span><span class="num" id="4215653">2</span><span class="op" id="4215654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4215657">pMinus2</span>&nbsp;<span class="op" id="4215665">:=</span>&nbsp;<span class="builtinfunc" id="4215668">new</span><span class="op" id="4215671">(</span><span class="ident" id="4215672">big</span><span class="op" id="4215675">.</span><span class="ident" id="4215676">Int</span><span class="op" id="4215679">)</span><span class="op" id="4215680">.</span><span class="ident" id="4215681">Sub</span><span class="op" id="4215684">(</span><span class="ident" id="4215685">P</span><span class="op" id="4215686">,</span>&nbsp;<span class="ident" id="4215688">two</span><span class="op" id="4215691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4215694">return</span>&nbsp;<span class="builtinfunc" id="4215701">new</span><span class="op" id="4215704">(</span><span class="ident" id="4215705">big</span><span class="op" id="4215708">.</span><span class="ident" id="4215709">Int</span><span class="op" id="4215712">)</span><span class="op" id="4215713">.</span><span class="ident" id="4215714">Exp</span><span class="op" id="4215717">(</span><span class="ident" id="4215718">k</span><span class="op" id="4215719">,</span>&nbsp;<span class="ident" id="4215721">pMinus2</span><span class="op" id="4215728">,</span>&nbsp;<span class="ident" id="4215730">P</span><span class="op" id="4215731">)</span><br>
<span class="lineno"></span><span class="op" id="4215733">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="4215736">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4215816">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4215894">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4215973">//&nbsp;rand.</span><br>
<span class="lineno">190</span><span class="comment" id="4215982">//</span><br>
<span class="lineno"></span><span class="comment" id="4215985">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4216065">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4216140">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4216162">func</span>&nbsp;<span class="ident" id="4216167">Sign</span><span class="op" id="4216171">(</span><span class="ident" id="4216172">rand</span>&nbsp;<span class="ident" id="4216177">io</span><span class="op" id="4216179">.</span><span class="ident" id="4216180">Reader</span><span class="op" id="4216186">,</span>&nbsp;<span class="ident" id="4216188">priv</span>&nbsp;<span class="op" id="4216193">*</span><span class="ident" id="4216194">PrivateKey</span><span class="op" id="4216204">,</span>&nbsp;<span class="ident" id="4216206">hash</span>&nbsp;<span class="op" id="4216211">[</span><span class="op" id="4216212">]</span><span class="builtintype" id="4216213">byte</span><span class="op" id="4216217">)</span>&nbsp;<span class="op" id="4216219">(</span><span class="ident" id="4216220">r</span><span class="op" id="4216221">,</span>&nbsp;<span class="ident" id="4216223">s</span>&nbsp;<span class="op" id="4216225">*</span><span class="ident" id="4216226">big</span><span class="op" id="4216229">.</span><span class="ident" id="4216230">Int</span><span class="op" id="4216233">,</span>&nbsp;<span class="ident" id="4216235">err</span>&nbsp;<span class="builtintype" id="4216239">error</span><span class="op" id="4216244">)</span>&nbsp;<span class="op" id="4216246">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4216249">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.6</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216278">n</span>&nbsp;<span class="op" id="4216280">:=</span>&nbsp;<span class="ident" id="4216283">priv</span><span class="op" id="4216287">.</span><span class="ident" id="4216288">Q</span><span class="op" id="4216289">.</span><span class="ident" id="4216290">BitLen</span><span class="op" id="4216296">(</span><span class="op" id="4216297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216300">if</span>&nbsp;<span class="ident" id="4216303">n</span><span class="op" id="4216304">&amp;</span><span class="num" id="4216305">7</span>&nbsp;<span class="op" id="4216307">!=</span>&nbsp;<span class="num" id="4216310">0</span>&nbsp;<span class="op" id="4216312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216316">err</span>&nbsp;<span class="op" id="4216320">=</span>&nbsp;<span class="ident" id="4216322">ErrInvalidPublicKey</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216355">n</span>&nbsp;<span class="op" id="4216357">&gt;&gt;=</span>&nbsp;<span class="num" id="4216361">3</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216365">for</span>&nbsp;<span class="op" id="4216369">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216373">k</span>&nbsp;<span class="op" id="4216375">:=</span>&nbsp;<span class="builtinfunc" id="4216378">new</span><span class="op" id="4216381">(</span><span class="ident" id="4216382">big</span><span class="op" id="4216385">.</span><span class="ident" id="4216386">Int</span><span class="op" id="4216389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216393">buf</span>&nbsp;<span class="op" id="4216397">:=</span>&nbsp;<span class="builtinfunc" id="4216400">make</span><span class="op" id="4216404">(</span><span class="op" id="4216405">[</span><span class="op" id="4216406">]</span><span class="builtintype" id="4216407">byte</span><span class="op" id="4216411">,</span>&nbsp;<span class="ident" id="4216413">n</span><span class="op" id="4216414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216418">for</span>&nbsp;<span class="op" id="4216422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216427">_</span><span class="op" id="4216428">,</span>&nbsp;<span class="ident" id="4216430">err</span>&nbsp;<span class="op" id="4216434">=</span>&nbsp;<span class="ident" id="4216436">io</span><span class="op" id="4216438">.</span><span class="ident" id="4216439">ReadFull</span><span class="op" id="4216447">(</span><span class="ident" id="4216448">rand</span><span class="op" id="4216452">,</span>&nbsp;<span class="ident" id="4216454">buf</span><span class="op" id="4216457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216462">if</span>&nbsp;<span class="ident" id="4216465">err</span>&nbsp;<span class="op" id="4216469">!=</span>&nbsp;<span class="ident" id="4216472">nil</span>&nbsp;<span class="op" id="4216476">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216497">k</span><span class="op" id="4216498">.</span><span class="ident" id="4216499">SetBytes</span><span class="op" id="4216507">(</span><span class="ident" id="4216508">buf</span><span class="op" id="4216511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216516">if</span>&nbsp;<span class="ident" id="4216519">k</span><span class="op" id="4216520">.</span><span class="ident" id="4216521">Sign</span><span class="op" id="4216525">(</span><span class="op" id="4216526">)</span>&nbsp;<span class="op" id="4216528">&gt;</span>&nbsp;<span class="num" id="4216530">0</span>&nbsp;<span class="op" id="4216532">&amp;&amp;</span>&nbsp;<span class="ident" id="4216535">k</span><span class="op" id="4216536">.</span><span class="ident" id="4216537">Cmp</span><span class="op" id="4216540">(</span><span class="ident" id="4216541">priv</span><span class="op" id="4216545">.</span><span class="ident" id="4216546">Q</span><span class="op" id="4216547">)</span>&nbsp;<span class="op" id="4216549">&lt;</span>&nbsp;<span class="num" id="4216551">0</span>&nbsp;<span class="op" id="4216553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216559">break</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216577">kInv</span>&nbsp;<span class="op" id="4216582">:=</span>&nbsp;<span class="ident" id="4216585">fermatInverse</span><span class="op" id="4216598">(</span><span class="ident" id="4216599">k</span><span class="op" id="4216600">,</span>&nbsp;<span class="ident" id="4216602">priv</span><span class="op" id="4216606">.</span><span class="ident" id="4216607">Q</span><span class="op" id="4216608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216613">r</span>&nbsp;<span class="op" id="4216615">=</span>&nbsp;<span class="builtinfunc" id="4216617">new</span><span class="op" id="4216620">(</span><span class="ident" id="4216621">big</span><span class="op" id="4216624">.</span><span class="ident" id="4216625">Int</span><span class="op" id="4216628">)</span><span class="op" id="4216629">.</span><span class="ident" id="4216630">Exp</span><span class="op" id="4216633">(</span><span class="ident" id="4216634">priv</span><span class="op" id="4216638">.</span><span class="ident" id="4216639">G</span><span class="op" id="4216640">,</span>&nbsp;<span class="ident" id="4216642">k</span><span class="op" id="4216643">,</span>&nbsp;<span class="ident" id="4216645">priv</span><span class="op" id="4216649">.</span><span class="ident" id="4216650">P</span><span class="op" id="4216651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216655">r</span><span class="op" id="4216656">.</span><span class="ident" id="4216657">Mod</span><span class="op" id="4216660">(</span><span class="ident" id="4216661">r</span><span class="op" id="4216662">,</span>&nbsp;<span class="ident" id="4216664">priv</span><span class="op" id="4216668">.</span><span class="ident" id="4216669">Q</span><span class="op" id="4216670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216675">if</span>&nbsp;<span class="ident" id="4216678">r</span><span class="op" id="4216679">.</span><span class="ident" id="4216680">Sign</span><span class="op" id="4216684">(</span><span class="op" id="4216685">)</span>&nbsp;<span class="op" id="4216687">==</span>&nbsp;<span class="num" id="4216690">0</span>&nbsp;<span class="op" id="4216692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216697">continue</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216713">z</span>&nbsp;<span class="op" id="4216715">:=</span>&nbsp;<span class="ident" id="4216718">k</span><span class="op" id="4216719">.</span><span class="ident" id="4216720">SetBytes</span><span class="op" id="4216728">(</span><span class="ident" id="4216729">hash</span><span class="op" id="4216733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216738">s</span>&nbsp;<span class="op" id="4216740">=</span>&nbsp;<span class="builtinfunc" id="4216742">new</span><span class="op" id="4216745">(</span><span class="ident" id="4216746">big</span><span class="op" id="4216749">.</span><span class="ident" id="4216750">Int</span><span class="op" id="4216753">)</span><span class="op" id="4216754">.</span><span class="ident" id="4216755">Mul</span><span class="op" id="4216758">(</span><span class="ident" id="4216759">priv</span><span class="op" id="4216763">.</span><span class="ident" id="4216764">X</span><span class="op" id="4216765">,</span>&nbsp;<span class="ident" id="4216767">r</span><span class="op" id="4216768">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216772">s</span><span class="op" id="4216773">.</span><span class="ident" id="4216774">Add</span><span class="op" id="4216777">(</span><span class="ident" id="4216778">s</span><span class="op" id="4216779">,</span>&nbsp;<span class="ident" id="4216781">z</span><span class="op" id="4216782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216786">s</span><span class="op" id="4216787">.</span><span class="ident" id="4216788">Mod</span><span class="op" id="4216791">(</span><span class="ident" id="4216792">s</span><span class="op" id="4216793">,</span>&nbsp;<span class="ident" id="4216795">priv</span><span class="op" id="4216799">.</span><span class="ident" id="4216800">Q</span><span class="op" id="4216801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216805">s</span><span class="op" id="4216806">.</span><span class="ident" id="4216807">Mul</span><span class="op" id="4216810">(</span><span class="ident" id="4216811">s</span><span class="op" id="4216812">,</span>&nbsp;<span class="ident" id="4216814">kInv</span><span class="op" id="4216818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4216822">s</span><span class="op" id="4216823">.</span><span class="ident" id="4216824">Mod</span><span class="op" id="4216827">(</span><span class="ident" id="4216828">s</span><span class="op" id="4216829">,</span>&nbsp;<span class="ident" id="4216831">priv</span><span class="op" id="4216835">.</span><span class="ident" id="4216836">Q</span><span class="op" id="4216837">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216842">if</span>&nbsp;<span class="ident" id="4216845">s</span><span class="op" id="4216846">.</span><span class="ident" id="4216847">Sign</span><span class="op" id="4216851">(</span><span class="op" id="4216852">)</span>&nbsp;<span class="op" id="4216854">!=</span>&nbsp;<span class="num" id="4216857">0</span>&nbsp;<span class="op" id="4216859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216864">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4216875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4216879">return</span><br>
<span class="lineno"></span><span class="op" id="4216886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4216889">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4216968">//&nbsp;reports&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno">245</span><span class="comment" id="4217011">//</span><br>
<span class="lineno"></span><span class="comment" id="4217014">//&nbsp;Note&nbsp;that&nbsp;FIPS&nbsp;186-3&nbsp;section&nbsp;4.6&nbsp;specifies&nbsp;that&nbsp;the&nbsp;hash&nbsp;should&nbsp;be&nbsp;truncated</span><br>
<span class="lineno"></span><span class="comment" id="4217094">//&nbsp;to&nbsp;the&nbsp;byte-length&nbsp;of&nbsp;the&nbsp;subgroup.&nbsp;This&nbsp;function&nbsp;does&nbsp;not&nbsp;perform&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4217169">//&nbsp;truncation&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4217191">func</span>&nbsp;<span class="ident" id="4217196">Verify</span><span class="op" id="4217202">(</span><span class="ident" id="4217203">pub</span>&nbsp;<span class="op" id="4217207">*</span><span class="ident" id="4217208">PublicKey</span><span class="op" id="4217217">,</span>&nbsp;<span class="ident" id="4217219">hash</span>&nbsp;<span class="op" id="4217224">[</span><span class="op" id="4217225">]</span><span class="builtintype" id="4217226">byte</span><span class="op" id="4217230">,</span>&nbsp;<span class="ident" id="4217232">r</span><span class="op" id="4217233">,</span>&nbsp;<span class="ident" id="4217235">s</span>&nbsp;<span class="op" id="4217237">*</span><span class="ident" id="4217238">big</span><span class="op" id="4217241">.</span><span class="ident" id="4217242">Int</span><span class="op" id="4217245">)</span>&nbsp;<span class="builtintype" id="4217247">bool</span>&nbsp;<span class="op" id="4217252">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4217255">//&nbsp;FIPS&nbsp;186-3,&nbsp;section&nbsp;4.7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217284">if</span>&nbsp;<span class="ident" id="4217287">r</span><span class="op" id="4217288">.</span><span class="ident" id="4217289">Sign</span><span class="op" id="4217293">(</span><span class="op" id="4217294">)</span>&nbsp;<span class="op" id="4217296">&lt;</span>&nbsp;<span class="num" id="4217298">1</span>&nbsp;<span class="op" id="4217300">||</span>&nbsp;<span class="ident" id="4217303">r</span><span class="op" id="4217304">.</span><span class="ident" id="4217305">Cmp</span><span class="op" id="4217308">(</span><span class="ident" id="4217309">pub</span><span class="op" id="4217312">.</span><span class="ident" id="4217313">Q</span><span class="op" id="4217314">)</span>&nbsp;<span class="op" id="4217316">&gt;=</span>&nbsp;<span class="num" id="4217319">0</span>&nbsp;<span class="op" id="4217321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217325">return</span>&nbsp;<span class="builtintype" id="4217332">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217339">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217342">if</span>&nbsp;<span class="ident" id="4217345">s</span><span class="op" id="4217346">.</span><span class="ident" id="4217347">Sign</span><span class="op" id="4217351">(</span><span class="op" id="4217352">)</span>&nbsp;<span class="op" id="4217354">&lt;</span>&nbsp;<span class="num" id="4217356">1</span>&nbsp;<span class="op" id="4217358">||</span>&nbsp;<span class="ident" id="4217361">s</span><span class="op" id="4217362">.</span><span class="ident" id="4217363">Cmp</span><span class="op" id="4217366">(</span><span class="ident" id="4217367">pub</span><span class="op" id="4217370">.</span><span class="ident" id="4217371">Q</span><span class="op" id="4217372">)</span>&nbsp;<span class="op" id="4217374">&gt;=</span>&nbsp;<span class="num" id="4217377">0</span>&nbsp;<span class="op" id="4217379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217383">return</span>&nbsp;<span class="builtintype" id="4217390">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217401">w</span>&nbsp;<span class="op" id="4217403">:=</span>&nbsp;<span class="builtinfunc" id="4217406">new</span><span class="op" id="4217409">(</span><span class="ident" id="4217410">big</span><span class="op" id="4217413">.</span><span class="ident" id="4217414">Int</span><span class="op" id="4217417">)</span><span class="op" id="4217418">.</span><span class="ident" id="4217419">ModInverse</span><span class="op" id="4217429">(</span><span class="ident" id="4217430">s</span><span class="op" id="4217431">,</span>&nbsp;<span class="ident" id="4217433">pub</span><span class="op" id="4217436">.</span><span class="ident" id="4217437">Q</span><span class="op" id="4217438">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217442">n</span>&nbsp;<span class="op" id="4217444">:=</span>&nbsp;<span class="ident" id="4217447">pub</span><span class="op" id="4217450">.</span><span class="ident" id="4217451">Q</span><span class="op" id="4217452">.</span><span class="ident" id="4217453">BitLen</span><span class="op" id="4217459">(</span><span class="op" id="4217460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217463">if</span>&nbsp;<span class="ident" id="4217466">n</span><span class="op" id="4217467">&amp;</span><span class="num" id="4217468">7</span>&nbsp;<span class="op" id="4217470">!=</span>&nbsp;<span class="num" id="4217473">0</span>&nbsp;<span class="op" id="4217475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217479">return</span>&nbsp;<span class="builtintype" id="4217486">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4217493">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217496">z</span>&nbsp;<span class="op" id="4217498">:=</span>&nbsp;<span class="builtinfunc" id="4217501">new</span><span class="op" id="4217504">(</span><span class="ident" id="4217505">big</span><span class="op" id="4217508">.</span><span class="ident" id="4217509">Int</span><span class="op" id="4217512">)</span><span class="op" id="4217513">.</span><span class="ident" id="4217514">SetBytes</span><span class="op" id="4217522">(</span><span class="ident" id="4217523">hash</span><span class="op" id="4217527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217531">u1</span>&nbsp;<span class="op" id="4217534">:=</span>&nbsp;<span class="builtinfunc" id="4217537">new</span><span class="op" id="4217540">(</span><span class="ident" id="4217541">big</span><span class="op" id="4217544">.</span><span class="ident" id="4217545">Int</span><span class="op" id="4217548">)</span><span class="op" id="4217549">.</span><span class="ident" id="4217550">Mul</span><span class="op" id="4217553">(</span><span class="ident" id="4217554">z</span><span class="op" id="4217555">,</span>&nbsp;<span class="ident" id="4217557">w</span><span class="op" id="4217558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217561">u1</span><span class="op" id="4217563">.</span><span class="ident" id="4217564">Mod</span><span class="op" id="4217567">(</span><span class="ident" id="4217568">u1</span><span class="op" id="4217570">,</span>&nbsp;<span class="ident" id="4217572">pub</span><span class="op" id="4217575">.</span><span class="ident" id="4217576">Q</span><span class="op" id="4217577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217580">u2</span>&nbsp;<span class="op" id="4217583">:=</span>&nbsp;<span class="ident" id="4217586">w</span><span class="op" id="4217587">.</span><span class="ident" id="4217588">Mul</span><span class="op" id="4217591">(</span><span class="ident" id="4217592">r</span><span class="op" id="4217593">,</span>&nbsp;<span class="ident" id="4217595">w</span><span class="op" id="4217596">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217599">u2</span><span class="op" id="4217601">.</span><span class="ident" id="4217602">Mod</span><span class="op" id="4217605">(</span><span class="ident" id="4217606">u2</span><span class="op" id="4217608">,</span>&nbsp;<span class="ident" id="4217610">pub</span><span class="op" id="4217613">.</span><span class="ident" id="4217614">Q</span><span class="op" id="4217615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217618">v</span>&nbsp;<span class="op" id="4217620">:=</span>&nbsp;<span class="ident" id="4217623">u1</span><span class="op" id="4217625">.</span><span class="ident" id="4217626">Exp</span><span class="op" id="4217629">(</span><span class="ident" id="4217630">pub</span><span class="op" id="4217633">.</span><span class="ident" id="4217634">G</span><span class="op" id="4217635">,</span>&nbsp;<span class="ident" id="4217637">u1</span><span class="op" id="4217639">,</span>&nbsp;<span class="ident" id="4217641">pub</span><span class="op" id="4217644">.</span><span class="ident" id="4217645">P</span><span class="op" id="4217646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217649">u2</span><span class="op" id="4217651">.</span><span class="ident" id="4217652">Exp</span><span class="op" id="4217655">(</span><span class="ident" id="4217656">pub</span><span class="op" id="4217659">.</span><span class="ident" id="4217660">Y</span><span class="op" id="4217661">,</span>&nbsp;<span class="ident" id="4217663">u2</span><span class="op" id="4217665">,</span>&nbsp;<span class="ident" id="4217667">pub</span><span class="op" id="4217670">.</span><span class="ident" id="4217671">P</span><span class="op" id="4217672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217675">v</span><span class="op" id="4217676">.</span><span class="ident" id="4217677">Mul</span><span class="op" id="4217680">(</span><span class="ident" id="4217681">v</span><span class="op" id="4217682">,</span>&nbsp;<span class="ident" id="4217684">u2</span><span class="op" id="4217686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217689">v</span><span class="op" id="4217690">.</span><span class="ident" id="4217691">Mod</span><span class="op" id="4217694">(</span><span class="ident" id="4217695">v</span><span class="op" id="4217696">,</span>&nbsp;<span class="ident" id="4217698">pub</span><span class="op" id="4217701">.</span><span class="ident" id="4217702">P</span><span class="op" id="4217703">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4217706">v</span><span class="op" id="4217707">.</span><span class="ident" id="4217708">Mod</span><span class="op" id="4217711">(</span><span class="ident" id="4217712">v</span><span class="op" id="4217713">,</span>&nbsp;<span class="ident" id="4217715">pub</span><span class="op" id="4217718">.</span><span class="ident" id="4217719">Q</span><span class="op" id="4217720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4217724">return</span>&nbsp;<span class="ident" id="4217731">v</span><span class="op" id="4217732">.</span><span class="ident" id="4217733">Cmp</span><span class="op" id="4217736">(</span><span class="ident" id="4217737">r</span><span class="op" id="4217738">)</span>&nbsp;<span class="op" id="4217740">==</span>&nbsp;<span class="num" id="4217743">0</span><br>
<span class="lineno"></span><span class="op" id="4217745">}</span>
</div>
</body>
</html>
