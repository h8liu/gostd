<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html" class="current">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8104395">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8104450">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8104504">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8104555">package</span>&nbsp;<span class="ident" id="8104563">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8104570">import</span>&nbsp;<span class="op" id="8104577">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8104580">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8104593">&#34;os&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8104599">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8104610">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8104620">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8104623">func</span>&nbsp;<span class="ident" id="8104628">TestWriteHeapDumpNonempty</span><span class="op" id="8104653">(</span><span class="ident" id="8104654">t</span>&nbsp;<span class="op" id="8104656">*</span><span class="ident" id="8104657">testing</span><span class="op" id="8104664">.</span><span class="ident" id="8104665">T</span><span class="op" id="8104666">)</span>&nbsp;<span class="op" id="8104668">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8104671">if</span>&nbsp;<span class="ident" id="8104674">runtime</span><span class="op" id="8104681">.</span><span class="ident" id="8104682">GOOS</span>&nbsp;<span class="op" id="8104687">==</span>&nbsp;<span class="string" id="8104690">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8104697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104701">t</span><span class="op" id="8104702">.</span><span class="ident" id="8104703">Skip</span><span class="op" id="8104707">(</span><span class="string" id="8104708">&#34;WriteHeapDump&nbsp;is&nbsp;not&nbsp;available&nbsp;on&nbsp;NaCl.&#34;</span><span class="op" id="8104749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8104752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104755">f</span><span class="op" id="8104756">,</span>&nbsp;<span class="ident" id="8104758">err</span>&nbsp;<span class="op" id="8104762">:=</span>&nbsp;<span class="ident" id="8104765">ioutil</span><span class="op" id="8104771">.</span><span class="ident" id="8104772">TempFile</span><span class="op" id="8104780">(</span><span class="string" id="8104781">&#34;&#34;</span><span class="op" id="8104783">,</span>&nbsp;<span class="string" id="8104785">&#34;heapdumptest&#34;</span><span class="op" id="8104799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8104802">if</span>&nbsp;<span class="ident" id="8104805">err</span>&nbsp;<span class="op" id="8104809">!=</span>&nbsp;<span class="builtintype" id="8104812">nil</span>&nbsp;<span class="op" id="8104816">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104820">t</span><span class="op" id="8104821">.</span><span class="ident" id="8104822">Fatalf</span><span class="op" id="8104828">(</span><span class="string" id="8104829">&#34;TempFile&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8104850">,</span>&nbsp;<span class="ident" id="8104852">err</span><span class="op" id="8104855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8104858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8104861">defer</span>&nbsp;<span class="ident" id="8104867">os</span><span class="op" id="8104869">.</span><span class="ident" id="8104870">Remove</span><span class="op" id="8104876">(</span><span class="ident" id="8104877">f</span><span class="op" id="8104878">.</span><span class="ident" id="8104879">Name</span><span class="op" id="8104883">(</span><span class="op" id="8104884">)</span><span class="op" id="8104885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8104888">defer</span>&nbsp;<span class="ident" id="8104894">f</span><span class="op" id="8104895">.</span><span class="ident" id="8104896">Close</span><span class="op" id="8104901">(</span><span class="op" id="8104902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104905">WriteHeapDump</span><span class="op" id="8104918">(</span><span class="ident" id="8104919">f</span><span class="op" id="8104920">.</span><span class="ident" id="8104921">Fd</span><span class="op" id="8104923">(</span><span class="op" id="8104924">)</span><span class="op" id="8104925">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104928">fi</span><span class="op" id="8104930">,</span>&nbsp;<span class="ident" id="8104932">err</span>&nbsp;<span class="op" id="8104936">:=</span>&nbsp;<span class="ident" id="8104939">f</span><span class="op" id="8104940">.</span><span class="ident" id="8104941">Stat</span><span class="op" id="8104945">(</span><span class="op" id="8104946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8104949">if</span>&nbsp;<span class="ident" id="8104952">err</span>&nbsp;<span class="op" id="8104956">!=</span>&nbsp;<span class="builtintype" id="8104959">nil</span>&nbsp;<span class="op" id="8104963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8104967">t</span><span class="op" id="8104968">.</span><span class="ident" id="8104969">Fatalf</span><span class="op" id="8104975">(</span><span class="string" id="8104976">&#34;Stat&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8104993">,</span>&nbsp;<span class="ident" id="8104995">err</span><span class="op" id="8104998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8105004">const</span>&nbsp;<span class="ident" id="8105010">minSize</span>&nbsp;<span class="op" id="8105018">=</span>&nbsp;<span class="num" id="8105020">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8105023">if</span>&nbsp;<span class="ident" id="8105026">size</span>&nbsp;<span class="op" id="8105031">:=</span>&nbsp;<span class="ident" id="8105034">fi</span><span class="op" id="8105036">.</span><span class="ident" id="8105037">Size</span><span class="op" id="8105041">(</span><span class="op" id="8105042">)</span><span class="op" id="8105043">;</span>&nbsp;<span class="ident" id="8105045">size</span>&nbsp;<span class="op" id="8105050">&lt;</span>&nbsp;<span class="ident" id="8105052">minSize</span>&nbsp;<span class="op" id="8105060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105064">t</span><span class="op" id="8105065">.</span><span class="ident" id="8105066">Fatalf</span><span class="op" id="8105072">(</span><span class="string" id="8105073">&#34;Heap&nbsp;dump&nbsp;size&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;at&nbsp;least&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8105126">,</span>&nbsp;<span class="ident" id="8105128">size</span><span class="op" id="8105132">,</span>&nbsp;<span class="ident" id="8105134">minSize</span><span class="op" id="8105141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105144">}</span><br>
<span class="lineno"></span><span class="op" id="8105146">}</span>
</div>
</body>
</html>
