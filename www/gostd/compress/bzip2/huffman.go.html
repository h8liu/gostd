<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6233825">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6233880">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6233934">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6233985">package</span>&nbsp;<span class="ident" id="6233993">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6234000">import</span>&nbsp;<span class="string" id="6234007">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6234015">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="6234091">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6234102">type</span>&nbsp;<span class="ident" id="6234107">huffmanTree</span>&nbsp;<span class="keyword" id="6234119">struct</span>&nbsp;<span class="op" id="6234126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234129">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234200">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6234273">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234329">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6234338">[</span><span class="op" id="6234339">]</span><span class="ident" id="6234340">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234353">nextNode</span>&nbsp;<span class="builtintype" id="6234362">int</span><br>
<span class="lineno"></span><span class="op" id="6234366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6234369">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6234449">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6234529">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="6234589">//</span><br>
<span class="lineno"></span><span class="comment" id="6234592">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6234669">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="6234747">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6234797">type</span>&nbsp;<span class="ident" id="6234802">huffmanNode</span>&nbsp;<span class="keyword" id="6234814">struct</span>&nbsp;<span class="op" id="6234821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234824">left</span><span class="op" id="6234828">,</span>&nbsp;<span class="ident" id="6234830">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6234846">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6234854">leftValue</span><span class="op" id="6234863">,</span>&nbsp;<span class="ident" id="6234865">rightValue</span>&nbsp;<span class="builtintype" id="6234876">uint16</span><br>
<span class="lineno"></span><span class="op" id="6234883">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6234886">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="6234963">const</span>&nbsp;<span class="ident" id="6234969">invalidNodeValue</span>&nbsp;<span class="op" id="6234986">=</span>&nbsp;<span class="num" id="6234988">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6234996">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="6235073">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6235093">func</span>&nbsp;<span class="op" id="6235098">(</span><span class="ident" id="6235099">t</span>&nbsp;<span class="op" id="6235101">*</span><span class="ident" id="6235102">huffmanTree</span><span class="op" id="6235113">)</span>&nbsp;<span class="ident" id="6235115">Decode</span><span class="op" id="6235121">(</span><span class="ident" id="6235122">br</span>&nbsp;<span class="op" id="6235125">*</span><span class="ident" id="6235126">bitReader</span><span class="op" id="6235135">)</span>&nbsp;<span class="op" id="6235137">(</span><span class="ident" id="6235138">v</span>&nbsp;<span class="builtintype" id="6235140">uint16</span><span class="op" id="6235146">)</span>&nbsp;<span class="op" id="6235148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235151">nodeIndex</span>&nbsp;<span class="op" id="6235161">:=</span>&nbsp;<span class="builtintype" id="6235164">uint16</span><span class="op" id="6235170">(</span><span class="num" id="6235171">0</span><span class="op" id="6235172">)</span>&nbsp;<span class="comment" id="6235174">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235211">for</span>&nbsp;<span class="op" id="6235215">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235219">node</span>&nbsp;<span class="op" id="6235224">:=</span>&nbsp;<span class="op" id="6235227">&amp;</span><span class="ident" id="6235228">t</span><span class="op" id="6235229">.</span><span class="ident" id="6235230">nodes</span><span class="op" id="6235235">[</span><span class="ident" id="6235236">nodeIndex</span><span class="op" id="6235245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235249">bit</span><span class="op" id="6235252">,</span>&nbsp;<span class="ident" id="6235254">ok</span>&nbsp;<span class="op" id="6235257">:=</span>&nbsp;<span class="ident" id="6235260">br</span><span class="op" id="6235262">.</span><span class="ident" id="6235263">TryReadBit</span><span class="op" id="6235273">(</span><span class="op" id="6235274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235278">if</span>&nbsp;<span class="op" id="6235281">!</span><span class="ident" id="6235282">ok</span>&nbsp;<span class="op" id="6235285">&amp;&amp;</span>&nbsp;<span class="ident" id="6235288">br</span><span class="op" id="6235290">.</span><span class="ident" id="6235291">ReadBit</span><span class="op" id="6235298">(</span><span class="op" id="6235299">)</span>&nbsp;<span class="op" id="6235301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235306">bit</span>&nbsp;<span class="op" id="6235310">=</span>&nbsp;<span class="num" id="6235312">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235316">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235320">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235359">if</span>&nbsp;<span class="ident" id="6235362">bit</span>&nbsp;<span class="op" id="6235366">!=</span>&nbsp;<span class="num" id="6235369">0</span>&nbsp;<span class="op" id="6235371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235376">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235387">if</span>&nbsp;<span class="ident" id="6235390">node</span><span class="op" id="6235394">.</span><span class="ident" id="6235395">left</span>&nbsp;<span class="op" id="6235400">==</span>&nbsp;<span class="ident" id="6235403">invalidNodeValue</span>&nbsp;<span class="op" id="6235420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235426">return</span>&nbsp;<span class="ident" id="6235433">node</span><span class="op" id="6235437">.</span><span class="ident" id="6235438">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235456">nodeIndex</span>&nbsp;<span class="op" id="6235466">=</span>&nbsp;<span class="ident" id="6235468">node</span><span class="op" id="6235472">.</span><span class="ident" id="6235473">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235480">}</span>&nbsp;<span class="keyword" id="6235482">else</span>&nbsp;<span class="op" id="6235487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235492">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235504">if</span>&nbsp;<span class="ident" id="6235507">node</span><span class="op" id="6235511">.</span><span class="ident" id="6235512">right</span>&nbsp;<span class="op" id="6235518">==</span>&nbsp;<span class="ident" id="6235521">invalidNodeValue</span>&nbsp;<span class="op" id="6235538">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6235544">return</span>&nbsp;<span class="ident" id="6235551">node</span><span class="op" id="6235555">.</span><span class="ident" id="6235556">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6235575">nodeIndex</span>&nbsp;<span class="op" id="6235585">=</span>&nbsp;<span class="ident" id="6235587">node</span><span class="op" id="6235591">.</span><span class="ident" id="6235592">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6235603">}</span><br>
<span class="lineno">60</span><span class="op" id="6235605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6235608">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6235681">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6235744">func</span>&nbsp;<span class="ident" id="6235749">newHuffmanTree</span><span class="op" id="6235763">(</span><span class="ident" id="6235764">lengths</span>&nbsp;<span class="op" id="6235772">[</span><span class="op" id="6235773">]</span><span class="builtintype" id="6235774">uint8</span><span class="op" id="6235779">)</span>&nbsp;<span class="op" id="6235781">(</span><span class="ident" id="6235782">huffmanTree</span><span class="op" id="6235793">,</span>&nbsp;<span class="builtintype" id="6235795">error</span><span class="op" id="6235800">)</span>&nbsp;<span class="op" id="6235802">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235805">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235875">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6235940">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236002">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236070">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236141">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236211">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236250">if</span>&nbsp;<span class="builtinfunc" id="6236253">len</span><span class="op" id="6236256">(</span><span class="ident" id="6236257">lengths</span><span class="op" id="6236264">)</span>&nbsp;<span class="op" id="6236266">&lt;</span>&nbsp;<span class="num" id="6236268">2</span>&nbsp;<span class="op" id="6236270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6236274">panic</span><span class="op" id="6236279">(</span><span class="string" id="6236280">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="6236313">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236320">var</span>&nbsp;<span class="ident" id="6236324">t</span>&nbsp;<span class="ident" id="6236326">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236340">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236412">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236454">pairs</span>&nbsp;<span class="op" id="6236460">:=</span>&nbsp;<span class="ident" id="6236463">huffmanSymbolLengthPairs</span><span class="op" id="6236487">(</span><span class="builtinfunc" id="6236488">make</span><span class="op" id="6236492">(</span><span class="op" id="6236493">[</span><span class="op" id="6236494">]</span><span class="ident" id="6236495">huffmanSymbolLengthPair</span><span class="op" id="6236518">,</span>&nbsp;<span class="builtinfunc" id="6236520">len</span><span class="op" id="6236523">(</span><span class="ident" id="6236524">lengths</span><span class="op" id="6236531">)</span><span class="op" id="6236532">)</span><span class="op" id="6236533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236536">for</span>&nbsp;<span class="ident" id="6236540">i</span><span class="op" id="6236541">,</span>&nbsp;<span class="ident" id="6236543">length</span>&nbsp;<span class="op" id="6236550">:=</span>&nbsp;<span class="keyword" id="6236553">range</span>&nbsp;<span class="ident" id="6236559">lengths</span>&nbsp;<span class="op" id="6236567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236571">pairs</span><span class="op" id="6236576">[</span><span class="ident" id="6236577">i</span><span class="op" id="6236578">]</span><span class="op" id="6236579">.</span><span class="ident" id="6236580">value</span>&nbsp;<span class="op" id="6236586">=</span>&nbsp;<span class="builtintype" id="6236588">uint16</span><span class="op" id="6236594">(</span><span class="ident" id="6236595">i</span><span class="op" id="6236596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236600">pairs</span><span class="op" id="6236605">[</span><span class="ident" id="6236606">i</span><span class="op" id="6236607">]</span><span class="op" id="6236608">.</span><span class="ident" id="6236609">length</span>&nbsp;<span class="op" id="6236616">=</span>&nbsp;<span class="ident" id="6236618">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6236626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236630">sort</span><span class="op" id="6236634">.</span><span class="ident" id="6236635">Sort</span><span class="op" id="6236639">(</span><span class="ident" id="6236640">pairs</span><span class="op" id="6236645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236649">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236721">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236794">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6236866">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236887">code</span>&nbsp;<span class="op" id="6236892">:=</span>&nbsp;<span class="builtintype" id="6236895">uint32</span><span class="op" id="6236901">(</span><span class="num" id="6236902">0</span><span class="op" id="6236903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236906">length</span>&nbsp;<span class="op" id="6236913">:=</span>&nbsp;<span class="builtintype" id="6236916">uint8</span><span class="op" id="6236921">(</span><span class="num" id="6236922">32</span><span class="op" id="6236924">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6236928">codes</span>&nbsp;<span class="op" id="6236934">:=</span>&nbsp;<span class="ident" id="6236937">huffmanCodes</span><span class="op" id="6236949">(</span><span class="builtinfunc" id="6236950">make</span><span class="op" id="6236954">(</span><span class="op" id="6236955">[</span><span class="op" id="6236956">]</span><span class="ident" id="6236957">huffmanCode</span><span class="op" id="6236968">,</span>&nbsp;<span class="builtinfunc" id="6236970">len</span><span class="op" id="6236973">(</span><span class="ident" id="6236974">lengths</span><span class="op" id="6236981">)</span><span class="op" id="6236982">)</span><span class="op" id="6236983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6236986">for</span>&nbsp;<span class="ident" id="6236990">i</span>&nbsp;<span class="op" id="6236992">:=</span>&nbsp;<span class="builtinfunc" id="6236995">len</span><span class="op" id="6236998">(</span><span class="ident" id="6236999">pairs</span><span class="op" id="6237004">)</span>&nbsp;<span class="op" id="6237006">-</span>&nbsp;<span class="num" id="6237008">1</span><span class="op" id="6237009">;</span>&nbsp;<span class="ident" id="6237011">i</span>&nbsp;<span class="op" id="6237013">&gt;=</span>&nbsp;<span class="num" id="6237016">0</span><span class="op" id="6237017">;</span>&nbsp;<span class="ident" id="6237019">i</span><span class="op" id="6237020">--</span>&nbsp;<span class="op" id="6237023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237027">if</span>&nbsp;<span class="ident" id="6237030">length</span>&nbsp;<span class="op" id="6237037">&gt;</span>&nbsp;<span class="ident" id="6237039">pairs</span><span class="op" id="6237044">[</span><span class="ident" id="6237045">i</span><span class="op" id="6237046">]</span><span class="op" id="6237047">.</span><span class="ident" id="6237048">length</span>&nbsp;<span class="op" id="6237055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237060">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237116">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237164">length</span>&nbsp;<span class="op" id="6237171">&gt;&gt;=</span>&nbsp;<span class="num" id="6237175">32</span>&nbsp;<span class="op" id="6237178">-</span>&nbsp;<span class="ident" id="6237180">pairs</span><span class="op" id="6237185">[</span><span class="ident" id="6237186">i</span><span class="op" id="6237187">]</span><span class="op" id="6237188">.</span><span class="ident" id="6237189">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237199">length</span>&nbsp;<span class="op" id="6237206">&lt;&lt;=</span>&nbsp;<span class="num" id="6237210">32</span>&nbsp;<span class="op" id="6237213">-</span>&nbsp;<span class="ident" id="6237215">pairs</span><span class="op" id="6237220">[</span><span class="ident" id="6237221">i</span><span class="op" id="6237222">]</span><span class="op" id="6237223">.</span><span class="ident" id="6237224">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237234">length</span>&nbsp;<span class="op" id="6237241">=</span>&nbsp;<span class="ident" id="6237243">pairs</span><span class="op" id="6237248">[</span><span class="ident" id="6237249">i</span><span class="op" id="6237250">]</span><span class="op" id="6237251">.</span><span class="ident" id="6237252">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237261">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237265">codes</span><span class="op" id="6237270">[</span><span class="ident" id="6237271">i</span><span class="op" id="6237272">]</span><span class="op" id="6237273">.</span><span class="ident" id="6237274">code</span>&nbsp;<span class="op" id="6237279">=</span>&nbsp;<span class="ident" id="6237281">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237288">codes</span><span class="op" id="6237293">[</span><span class="ident" id="6237294">i</span><span class="op" id="6237295">]</span><span class="op" id="6237296">.</span><span class="ident" id="6237297">codeLen</span>&nbsp;<span class="op" id="6237305">=</span>&nbsp;<span class="ident" id="6237307">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237316">codes</span><span class="op" id="6237321">[</span><span class="ident" id="6237322">i</span><span class="op" id="6237323">]</span><span class="op" id="6237324">.</span><span class="ident" id="6237325">value</span>&nbsp;<span class="op" id="6237331">=</span>&nbsp;<span class="ident" id="6237333">pairs</span><span class="op" id="6237338">[</span><span class="ident" id="6237339">i</span><span class="op" id="6237340">]</span><span class="op" id="6237341">.</span><span class="ident" id="6237342">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237350">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237416">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237449">code</span>&nbsp;<span class="op" id="6237454">+=</span>&nbsp;<span class="num" id="6237457">1</span>&nbsp;<span class="op" id="6237459">&lt;&lt;</span>&nbsp;<span class="op" id="6237462">(</span><span class="num" id="6237463">32</span>&nbsp;<span class="op" id="6237466">-</span>&nbsp;<span class="ident" id="6237468">length</span><span class="op" id="6237474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6237477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237481">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6237554">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237589">sort</span><span class="op" id="6237593">.</span><span class="ident" id="6237594">Sort</span><span class="op" id="6237598">(</span><span class="ident" id="6237599">codes</span><span class="op" id="6237604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237608">t</span><span class="op" id="6237609">.</span><span class="ident" id="6237610">nodes</span>&nbsp;<span class="op" id="6237616">=</span>&nbsp;<span class="builtinfunc" id="6237618">make</span><span class="op" id="6237622">(</span><span class="op" id="6237623">[</span><span class="op" id="6237624">]</span><span class="ident" id="6237625">huffmanNode</span><span class="op" id="6237636">,</span>&nbsp;<span class="builtinfunc" id="6237638">len</span><span class="op" id="6237641">(</span><span class="ident" id="6237642">codes</span><span class="op" id="6237647">)</span><span class="op" id="6237648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237651">_</span><span class="op" id="6237652">,</span>&nbsp;<span class="ident" id="6237654">err</span>&nbsp;<span class="op" id="6237658">:=</span>&nbsp;<span class="ident" id="6237661">buildHuffmanNode</span><span class="op" id="6237677">(</span><span class="op" id="6237678">&amp;</span><span class="ident" id="6237679">t</span><span class="op" id="6237680">,</span>&nbsp;<span class="ident" id="6237682">codes</span><span class="op" id="6237687">,</span>&nbsp;<span class="num" id="6237689">0</span><span class="op" id="6237690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6237693">return</span>&nbsp;<span class="ident" id="6237700">t</span><span class="op" id="6237701">,</span>&nbsp;<span class="ident" id="6237703">err</span><br>
<span class="lineno">120</span><span class="op" id="6237707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6237710">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6237776">type</span>&nbsp;<span class="ident" id="6237781">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="6237805">struct</span>&nbsp;<span class="op" id="6237812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237815">value</span>&nbsp;&nbsp;<span class="builtintype" id="6237822">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6237830">length</span>&nbsp;<span class="builtintype" id="6237837">uint8</span><br>
<span class="lineno"></span><span class="op" id="6237843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6237846">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="6237918">type</span>&nbsp;<span class="ident" id="6237923">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="6237948">[</span><span class="op" id="6237949">]</span><span class="ident" id="6237950">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6237975">func</span>&nbsp;<span class="op" id="6237980">(</span><span class="ident" id="6237981">h</span>&nbsp;<span class="ident" id="6237983">huffmanSymbolLengthPairs</span><span class="op" id="6238007">)</span>&nbsp;<span class="ident" id="6238009">Len</span><span class="op" id="6238012">(</span><span class="op" id="6238013">)</span>&nbsp;<span class="builtintype" id="6238015">int</span>&nbsp;<span class="op" id="6238019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238022">return</span>&nbsp;<span class="builtinfunc" id="6238029">len</span><span class="op" id="6238032">(</span><span class="ident" id="6238033">h</span><span class="op" id="6238034">)</span><br>
<span class="lineno"></span><span class="op" id="6238036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6238039">func</span>&nbsp;<span class="op" id="6238044">(</span><span class="ident" id="6238045">h</span>&nbsp;<span class="ident" id="6238047">huffmanSymbolLengthPairs</span><span class="op" id="6238071">)</span>&nbsp;<span class="ident" id="6238073">Less</span><span class="op" id="6238077">(</span><span class="ident" id="6238078">i</span><span class="op" id="6238079">,</span>&nbsp;<span class="ident" id="6238081">j</span>&nbsp;<span class="builtintype" id="6238083">int</span><span class="op" id="6238086">)</span>&nbsp;<span class="builtintype" id="6238088">bool</span>&nbsp;<span class="op" id="6238093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238096">if</span>&nbsp;<span class="ident" id="6238099">h</span><span class="op" id="6238100">[</span><span class="ident" id="6238101">i</span><span class="op" id="6238102">]</span><span class="op" id="6238103">.</span><span class="ident" id="6238104">length</span>&nbsp;<span class="op" id="6238111">&lt;</span>&nbsp;<span class="ident" id="6238113">h</span><span class="op" id="6238114">[</span><span class="ident" id="6238115">j</span><span class="op" id="6238116">]</span><span class="op" id="6238117">.</span><span class="ident" id="6238118">length</span>&nbsp;<span class="op" id="6238125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238129">return</span>&nbsp;<span class="builtintype" id="6238136">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238145">if</span>&nbsp;<span class="ident" id="6238148">h</span><span class="op" id="6238149">[</span><span class="ident" id="6238150">i</span><span class="op" id="6238151">]</span><span class="op" id="6238152">.</span><span class="ident" id="6238153">length</span>&nbsp;<span class="op" id="6238160">&gt;</span>&nbsp;<span class="ident" id="6238162">h</span><span class="op" id="6238163">[</span><span class="ident" id="6238164">j</span><span class="op" id="6238165">]</span><span class="op" id="6238166">.</span><span class="ident" id="6238167">length</span>&nbsp;<span class="op" id="6238174">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238178">return</span>&nbsp;<span class="builtintype" id="6238185">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238195">if</span>&nbsp;<span class="ident" id="6238198">h</span><span class="op" id="6238199">[</span><span class="ident" id="6238200">i</span><span class="op" id="6238201">]</span><span class="op" id="6238202">.</span><span class="ident" id="6238203">value</span>&nbsp;<span class="op" id="6238209">&lt;</span>&nbsp;<span class="ident" id="6238211">h</span><span class="op" id="6238212">[</span><span class="ident" id="6238213">j</span><span class="op" id="6238214">]</span><span class="op" id="6238215">.</span><span class="ident" id="6238216">value</span>&nbsp;<span class="op" id="6238222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238226">return</span>&nbsp;<span class="builtintype" id="6238233">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6238239">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238242">return</span>&nbsp;<span class="builtintype" id="6238249">false</span><br>
<span class="lineno"></span><span class="op" id="6238255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6238258">func</span>&nbsp;<span class="op" id="6238263">(</span><span class="ident" id="6238264">h</span>&nbsp;<span class="ident" id="6238266">huffmanSymbolLengthPairs</span><span class="op" id="6238290">)</span>&nbsp;<span class="ident" id="6238292">Swap</span><span class="op" id="6238296">(</span><span class="ident" id="6238297">i</span><span class="op" id="6238298">,</span>&nbsp;<span class="ident" id="6238300">j</span>&nbsp;<span class="builtintype" id="6238302">int</span><span class="op" id="6238305">)</span>&nbsp;<span class="op" id="6238307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238310">h</span><span class="op" id="6238311">[</span><span class="ident" id="6238312">i</span><span class="op" id="6238313">]</span><span class="op" id="6238314">,</span>&nbsp;<span class="ident" id="6238316">h</span><span class="op" id="6238317">[</span><span class="ident" id="6238318">j</span><span class="op" id="6238319">]</span>&nbsp;<span class="op" id="6238321">=</span>&nbsp;<span class="ident" id="6238323">h</span><span class="op" id="6238324">[</span><span class="ident" id="6238325">j</span><span class="op" id="6238326">]</span><span class="op" id="6238327">,</span>&nbsp;<span class="ident" id="6238329">h</span><span class="op" id="6238330">[</span><span class="ident" id="6238331">i</span><span class="op" id="6238332">]</span><br>
<span class="lineno">150</span><span class="op" id="6238334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6238337">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6238397">type</span>&nbsp;<span class="ident" id="6238402">huffmanCode</span>&nbsp;<span class="keyword" id="6238414">struct</span>&nbsp;<span class="op" id="6238421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238424">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6238432">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238440">codeLen</span>&nbsp;<span class="builtintype" id="6238448">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238455">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6238463">uint16</span><br>
<span class="lineno"></span><span class="op" id="6238470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6238473">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="6238534">type</span>&nbsp;<span class="ident" id="6238539">huffmanCodes</span>&nbsp;<span class="op" id="6238552">[</span><span class="op" id="6238553">]</span><span class="ident" id="6238554">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6238567">func</span>&nbsp;<span class="op" id="6238572">(</span><span class="ident" id="6238573">n</span>&nbsp;<span class="ident" id="6238575">huffmanCodes</span><span class="op" id="6238587">)</span>&nbsp;<span class="ident" id="6238589">Len</span><span class="op" id="6238592">(</span><span class="op" id="6238593">)</span>&nbsp;<span class="builtintype" id="6238595">int</span>&nbsp;<span class="op" id="6238599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238602">return</span>&nbsp;<span class="builtinfunc" id="6238609">len</span><span class="op" id="6238612">(</span><span class="ident" id="6238613">n</span><span class="op" id="6238614">)</span><br>
<span class="lineno"></span><span class="op" id="6238616">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6238619">func</span>&nbsp;<span class="op" id="6238624">(</span><span class="ident" id="6238625">n</span>&nbsp;<span class="ident" id="6238627">huffmanCodes</span><span class="op" id="6238639">)</span>&nbsp;<span class="ident" id="6238641">Less</span><span class="op" id="6238645">(</span><span class="ident" id="6238646">i</span><span class="op" id="6238647">,</span>&nbsp;<span class="ident" id="6238649">j</span>&nbsp;<span class="builtintype" id="6238651">int</span><span class="op" id="6238654">)</span>&nbsp;<span class="builtintype" id="6238656">bool</span>&nbsp;<span class="op" id="6238661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6238664">return</span>&nbsp;<span class="ident" id="6238671">n</span><span class="op" id="6238672">[</span><span class="ident" id="6238673">i</span><span class="op" id="6238674">]</span><span class="op" id="6238675">.</span><span class="ident" id="6238676">code</span>&nbsp;<span class="op" id="6238681">&lt;</span>&nbsp;<span class="ident" id="6238683">n</span><span class="op" id="6238684">[</span><span class="ident" id="6238685">j</span><span class="op" id="6238686">]</span><span class="op" id="6238687">.</span><span class="ident" id="6238688">code</span><br>
<span class="lineno"></span><span class="op" id="6238693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6238696">func</span>&nbsp;<span class="op" id="6238701">(</span><span class="ident" id="6238702">n</span>&nbsp;<span class="ident" id="6238704">huffmanCodes</span><span class="op" id="6238716">)</span>&nbsp;<span class="ident" id="6238718">Swap</span><span class="op" id="6238722">(</span><span class="ident" id="6238723">i</span><span class="op" id="6238724">,</span>&nbsp;<span class="ident" id="6238726">j</span>&nbsp;<span class="builtintype" id="6238728">int</span><span class="op" id="6238731">)</span>&nbsp;<span class="op" id="6238733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6238736">n</span><span class="op" id="6238737">[</span><span class="ident" id="6238738">i</span><span class="op" id="6238739">]</span><span class="op" id="6238740">,</span>&nbsp;<span class="ident" id="6238742">n</span><span class="op" id="6238743">[</span><span class="ident" id="6238744">j</span><span class="op" id="6238745">]</span>&nbsp;<span class="op" id="6238747">=</span>&nbsp;<span class="ident" id="6238749">n</span><span class="op" id="6238750">[</span><span class="ident" id="6238751">j</span><span class="op" id="6238752">]</span><span class="op" id="6238753">,</span>&nbsp;<span class="ident" id="6238755">n</span><span class="op" id="6238756">[</span><span class="ident" id="6238757">i</span><span class="op" id="6238758">]</span><br>
<span class="lineno"></span><span class="op" id="6238760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6238763">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="6238841">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="6238915">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6238936">func</span>&nbsp;<span class="ident" id="6238941">buildHuffmanNode</span><span class="op" id="6238957">(</span><span class="ident" id="6238958">t</span>&nbsp;<span class="op" id="6238960">*</span><span class="ident" id="6238961">huffmanTree</span><span class="op" id="6238972">,</span>&nbsp;<span class="ident" id="6238974">codes</span>&nbsp;<span class="op" id="6238980">[</span><span class="op" id="6238981">]</span><span class="ident" id="6238982">huffmanCode</span><span class="op" id="6238993">,</span>&nbsp;<span class="ident" id="6238995">level</span>&nbsp;<span class="builtintype" id="6239001">uint32</span><span class="op" id="6239007">)</span>&nbsp;<span class="op" id="6239009">(</span><span class="ident" id="6239010">nodeIndex</span>&nbsp;<span class="builtintype" id="6239020">uint16</span><span class="op" id="6239026">,</span>&nbsp;<span class="ident" id="6239028">err</span>&nbsp;<span class="builtintype" id="6239032">error</span><span class="op" id="6239037">)</span>&nbsp;<span class="op" id="6239039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239042">test</span>&nbsp;<span class="op" id="6239047">:=</span>&nbsp;<span class="builtintype" id="6239050">uint32</span><span class="op" id="6239056">(</span><span class="num" id="6239057">1</span><span class="op" id="6239058">)</span>&nbsp;<span class="op" id="6239060">&lt;&lt;</span>&nbsp;<span class="op" id="6239063">(</span><span class="num" id="6239064">31</span>&nbsp;<span class="op" id="6239067">-</span>&nbsp;<span class="ident" id="6239069">level</span><span class="op" id="6239074">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239078">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239171">firstRightIndex</span>&nbsp;<span class="op" id="6239187">:=</span>&nbsp;<span class="builtinfunc" id="6239190">len</span><span class="op" id="6239193">(</span><span class="ident" id="6239194">codes</span><span class="op" id="6239199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239202">for</span>&nbsp;<span class="ident" id="6239206">i</span><span class="op" id="6239207">,</span>&nbsp;<span class="ident" id="6239209">code</span>&nbsp;<span class="op" id="6239214">:=</span>&nbsp;<span class="keyword" id="6239217">range</span>&nbsp;<span class="ident" id="6239223">codes</span>&nbsp;<span class="op" id="6239229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239233">if</span>&nbsp;<span class="ident" id="6239236">code</span><span class="op" id="6239240">.</span><span class="ident" id="6239241">code</span><span class="op" id="6239245">&amp;</span><span class="ident" id="6239246">test</span>&nbsp;<span class="op" id="6239251">!=</span>&nbsp;<span class="num" id="6239254">0</span>&nbsp;<span class="op" id="6239256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239261">firstRightIndex</span>&nbsp;<span class="op" id="6239277">=</span>&nbsp;<span class="ident" id="6239279">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239284">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6239295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239299">left</span>&nbsp;<span class="op" id="6239304">:=</span>&nbsp;<span class="ident" id="6239307">codes</span><span class="op" id="6239312">[</span><span class="op" id="6239313">:</span><span class="ident" id="6239314">firstRightIndex</span><span class="op" id="6239329">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6239332">right</span>&nbsp;<span class="op" id="6239338">:=</span>&nbsp;<span class="ident" id="6239341">codes</span><span class="op" id="6239346">[</span><span class="ident" id="6239347">firstRightIndex</span><span class="op" id="6239362">:</span><span class="op" id="6239363">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239367">if</span>&nbsp;<span class="builtinfunc" id="6239370">len</span><span class="op" id="6239373">(</span><span class="ident" id="6239374">left</span><span class="op" id="6239378">)</span>&nbsp;<span class="op" id="6239380">==</span>&nbsp;<span class="num" id="6239383">0</span>&nbsp;<span class="op" id="6239385">||</span>&nbsp;<span class="builtinfunc" id="6239388">len</span><span class="op" id="6239391">(</span><span class="ident" id="6239392">right</span><span class="op" id="6239397">)</span>&nbsp;<span class="op" id="6239399">==</span>&nbsp;<span class="num" id="6239402">0</span>&nbsp;<span class="op" id="6239404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239408">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239473">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239539">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239571">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239634">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239697">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239745">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239750">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239815">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239881">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6239943">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6239998">if</span>&nbsp;<span class="builtinfunc" id="6240001">len</span><span class="op" id="6240004">(</span><span class="ident" id="6240005">codes</span><span class="op" id="6240010">)</span>&nbsp;<span class="op" id="6240012">&lt;</span>&nbsp;<span class="num" id="6240014">2</span>&nbsp;<span class="op" id="6240016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240021">return</span>&nbsp;<span class="num" id="6240028">0</span><span class="op" id="6240029">,</span>&nbsp;<span class="ident" id="6240031">StructuralError</span><span class="op" id="6240046">(</span><span class="string" id="6240047">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6240067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240076">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240141">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240200">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240216">if</span>&nbsp;<span class="ident" id="6240219">level</span>&nbsp;<span class="op" id="6240225">==</span>&nbsp;<span class="num" id="6240228">31</span>&nbsp;<span class="op" id="6240231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240236">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240293">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240352">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240403">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240429">return</span>&nbsp;<span class="num" id="6240436">0</span><span class="op" id="6240437">,</span>&nbsp;<span class="ident" id="6240439">StructuralError</span><span class="op" id="6240454">(</span><span class="string" id="6240455">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6240486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240495">if</span>&nbsp;<span class="builtinfunc" id="6240498">len</span><span class="op" id="6240501">(</span><span class="ident" id="6240502">left</span><span class="op" id="6240506">)</span>&nbsp;<span class="op" id="6240508">==</span>&nbsp;<span class="num" id="6240511">0</span>&nbsp;<span class="op" id="6240513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240518">return</span>&nbsp;<span class="ident" id="6240525">buildHuffmanNode</span><span class="op" id="6240541">(</span><span class="ident" id="6240542">t</span><span class="op" id="6240543">,</span>&nbsp;<span class="ident" id="6240545">right</span><span class="op" id="6240550">,</span>&nbsp;<span class="ident" id="6240552">level</span><span class="op" id="6240557">+</span><span class="num" id="6240558">1</span><span class="op" id="6240559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240567">return</span>&nbsp;<span class="ident" id="6240574">buildHuffmanNode</span><span class="op" id="6240590">(</span><span class="ident" id="6240591">t</span><span class="op" id="6240592">,</span>&nbsp;<span class="ident" id="6240594">left</span><span class="op" id="6240598">,</span>&nbsp;<span class="ident" id="6240600">level</span><span class="op" id="6240605">+</span><span class="num" id="6240606">1</span><span class="op" id="6240607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240610">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240614">nodeIndex</span>&nbsp;<span class="op" id="6240624">=</span>&nbsp;<span class="builtintype" id="6240626">uint16</span><span class="op" id="6240632">(</span><span class="ident" id="6240633">t</span><span class="op" id="6240634">.</span><span class="ident" id="6240635">nextNode</span><span class="op" id="6240643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240646">node</span>&nbsp;<span class="op" id="6240651">:=</span>&nbsp;<span class="op" id="6240654">&amp;</span><span class="ident" id="6240655">t</span><span class="op" id="6240656">.</span><span class="ident" id="6240657">nodes</span><span class="op" id="6240662">[</span><span class="ident" id="6240663">t</span><span class="op" id="6240664">.</span><span class="ident" id="6240665">nextNode</span><span class="op" id="6240673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240676">t</span><span class="op" id="6240677">.</span><span class="ident" id="6240678">nextNode</span><span class="op" id="6240686">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240691">if</span>&nbsp;<span class="builtinfunc" id="6240694">len</span><span class="op" id="6240697">(</span><span class="ident" id="6240698">left</span><span class="op" id="6240702">)</span>&nbsp;<span class="op" id="6240704">==</span>&nbsp;<span class="num" id="6240707">1</span>&nbsp;<span class="op" id="6240709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240713">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240728">node</span><span class="op" id="6240732">.</span><span class="ident" id="6240733">left</span>&nbsp;<span class="op" id="6240738">=</span>&nbsp;<span class="ident" id="6240740">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240759">node</span><span class="op" id="6240763">.</span><span class="ident" id="6240764">leftValue</span>&nbsp;<span class="op" id="6240774">=</span>&nbsp;<span class="ident" id="6240776">left</span><span class="op" id="6240780">[</span><span class="num" id="6240781">0</span><span class="op" id="6240782">]</span><span class="op" id="6240783">.</span><span class="ident" id="6240784">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240791">}</span>&nbsp;<span class="keyword" id="6240793">else</span>&nbsp;<span class="op" id="6240798">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240802">node</span><span class="op" id="6240806">.</span><span class="ident" id="6240807">left</span><span class="op" id="6240811">,</span>&nbsp;<span class="ident" id="6240813">err</span>&nbsp;<span class="op" id="6240817">=</span>&nbsp;<span class="ident" id="6240819">buildHuffmanNode</span><span class="op" id="6240835">(</span><span class="ident" id="6240836">t</span><span class="op" id="6240837">,</span>&nbsp;<span class="ident" id="6240839">left</span><span class="op" id="6240843">,</span>&nbsp;<span class="ident" id="6240845">level</span><span class="op" id="6240850">+</span><span class="num" id="6240851">1</span><span class="op" id="6240852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240859">if</span>&nbsp;<span class="ident" id="6240862">err</span>&nbsp;<span class="op" id="6240866">!=</span>&nbsp;<span class="ident" id="6240869">nil</span>&nbsp;<span class="op" id="6240873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240877">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6240889">if</span>&nbsp;<span class="builtinfunc" id="6240892">len</span><span class="op" id="6240895">(</span><span class="ident" id="6240896">right</span><span class="op" id="6240901">)</span>&nbsp;<span class="op" id="6240903">==</span>&nbsp;<span class="num" id="6240906">1</span>&nbsp;<span class="op" id="6240908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6240912">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240927">node</span><span class="op" id="6240931">.</span><span class="ident" id="6240932">right</span>&nbsp;<span class="op" id="6240938">=</span>&nbsp;<span class="ident" id="6240940">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6240959">node</span><span class="op" id="6240963">.</span><span class="ident" id="6240964">rightValue</span>&nbsp;<span class="op" id="6240975">=</span>&nbsp;<span class="ident" id="6240977">right</span><span class="op" id="6240982">[</span><span class="num" id="6240983">0</span><span class="op" id="6240984">]</span><span class="op" id="6240985">.</span><span class="ident" id="6240986">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6240993">}</span>&nbsp;<span class="keyword" id="6240995">else</span>&nbsp;<span class="op" id="6241000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6241004">node</span><span class="op" id="6241008">.</span><span class="ident" id="6241009">right</span><span class="op" id="6241014">,</span>&nbsp;<span class="ident" id="6241016">err</span>&nbsp;<span class="op" id="6241020">=</span>&nbsp;<span class="ident" id="6241022">buildHuffmanNode</span><span class="op" id="6241038">(</span><span class="ident" id="6241039">t</span><span class="op" id="6241040">,</span>&nbsp;<span class="ident" id="6241042">right</span><span class="op" id="6241047">,</span>&nbsp;<span class="ident" id="6241049">level</span><span class="op" id="6241054">+</span><span class="num" id="6241055">1</span><span class="op" id="6241056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6241059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6241063">return</span><br>
<span class="lineno"></span><span class="op" id="6241070">}</span>
</div>
</body>
</html>
